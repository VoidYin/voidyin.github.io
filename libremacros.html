<!DOCTYPE html><html>
<head>
<title></title>
<style type="text/css">
<!--
.xflip {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    filter: fliph;
}
.yflip {
    -moz-transform: scaleY(-1);
    -webkit-transform: scaleY(-1);
    -o-transform: scaleY(-1);
    transform: scaleY(-1);
    filter: flipv;
}
.xyflip {
    -moz-transform: scaleX(-1) scaleY(-1);
    -webkit-transform: scaleX(-1) scaleY(-1);
    -o-transform: scaleX(-1) scaleY(-1);
    transform: scaleX(-1) scaleY(-1);
    filter: fliph + flipv;
}
-->
</style>
</head>
<body>
<a name=1></a><hr/>
<a name=2></a><b>OpenOffice.org&#160;Macros&#160;Explained</b><br/>
<b>OOME&#160;Third&#160;Edition</b><br/>
Last&#160;Modified<br/>
Saturday,&#160;April&#160;30, 2016&#160;at&#160;09:05:51&#160;AM&#160;<br/>
Document&#160;Revision:&#160;567<br/>
<hr/>
<a name=3></a><b>General&#160;Information<br/></b>The&#160;contents&#160;of this&#160;document&#160;is&#160;Copyright&#160;2011&#160;-&#160;2014 by&#160;Andrew&#160;D. Pitonyak. I&#160;will&#160;make&#160;<br/>a&#160;final&#160;license&#160;decision when I&#160;am&#160;finished.<br/>
I&#160;created a&#160;second edition that&#160;was&#160;never released, which is&#160;why&#160;I&#160;refer to&#160;this&#160;book as&#160;the&#160;<br/>third&#160;edition.&#160;<br/>
I&#160;have&#160;been repeatedly&#160;asked about&#160;the&#160;cover page&#160;so.... I&#160;am&#160;neither an artist&#160;nor a&#160;designer,&#160;<br/>the&#160;cover was&#160;created&#160;by&#160;Amanda&#160;Barham&#160;(see<a href="http://www.amandabarham.com/">&#160;http://www.amandabarham.com)</a>. She&#160;did&#160;an&#160;<br/>awesome&#160;job.<br/>
Many&#160;people&#160;contributed to&#160;this&#160;document&#160;in&#160;one&#160;form&#160;or another.&#160;Feedback from&#160;community<br/>members&#160;helps&#160;greatly.&#160;For&#160;reasons&#160;I&#160;don't&#160;understand,&#160;my&#160;wife&#160;allows&#160;me&#160;to take&#160;time&#160;away&#160;<br/>from&#160;my&#160;family&#160;to&#160;work on this&#160;document,&#160;so, I&#160;suppose&#160;that&#160;the&#160;person to really&#160;thank is&#160;her&#160;<br/>(send her enough money&#160;that&#160;she&#160;can get&#160;a&#160;fully&#160;body&#160;massage&#160;and she&#160;may&#160;force&#160;me&#160;to&#160;work&#160;<br/>on this&#160;document).<br/>
While&#160;taking this&#160;document&#160;to&#160;the&#160;latest&#160;version, many&#160;errors, corrections, and suggestions&#160;<br/>were&#160;provided by&#160;Volker Lenhardt&#160;who is&#160;providing a&#160;full&#160;translation&#160;into German.&#160;This&#160;<br/>document&#160;has&#160;been greatly&#160;improved based on his&#160;work.<br/>
Thank you&#160;Volker Lenhardt<a href="https://www.uni-due.de/~abi070/ooo.html">&#160;(https://www.uni-due.de/~abi070/ooo.html)</a>.<br/>
<hr/>
<a name=4></a><b>Table&#160;of&#160;Contents<br/></b><a href="libremacros.html#3">General Information............................................................................................................</a>.......1<br/>
<a href="libremacros.html#4">Table of Contents................................................................................................................</a>........i<br/>
<a href="libremacros.html#16"> 1. Introduction and housekeeping.............................................................................</a>..............13<br/>
<a href="libremacros.html#16"> 1.1. Comments from the author........................................................................................</a>..13<br/>
<a href="libremacros.html#16"> 1.2. Environment and comments..................................................................................</a>......13<br/>
<a href="libremacros.html#17"> 2. Getting Started...............................................................................................</a>.....................14<br/>
<a href="libremacros.html#17"> 2.1. Macro storage.....................................................................................................</a>.........14<br/>
<a href="libremacros.html#17"> 2.1.1. Library container............................................................................</a>.....................14<br/>
<a href="libremacros.html#18"> 2.1.2. Libraries...........................................................................................................</a>....15<br/>
<a href="libremacros.html#19"> 2.1.3. Modules and dialogs....................................................................................</a>........16<br/>
<a href="libremacros.html#19"> 2.1.4. Key points........................................................................................................</a>....16<br/>
<a href="libremacros.html#19"> 2.2. Creating new modules and libraries...............................................................</a>.............16<br/>
<a href="libremacros.html#21"> 2.3. Macro language..............................................................................................</a>.............18<br/>
<a href="libremacros.html#21"> 2.4. Create a module in a document......................................................................</a>.............18<br/>
<a href="libremacros.html#24"> 2.5. Integrated Debugging Environment...............................................................</a>.............21<br/>
<a href="libremacros.html#27"> 2.6. Enter the macro....................................................................................</a>.......................24<br/>
<a href="libremacros.html#28"> 2.7. Run a macro......................................................................................</a>..........................25<br/>
<a href="libremacros.html#28"> 2.8. Macro security.......................................................................................................</a>......25<br/>
<a href="libremacros.html#31"> 2.9. Using breakpoints......................................................................................................</a>..28<br/>
<a href="libremacros.html#31"> 2.10. How libraries are stored.....................................................................</a>.......................28<br/>
<a href="libremacros.html#32"> 2.11. How documents are stored........................................................................</a>................29<br/>
<a href="libremacros.html#33"> 2.12. Conclusion...............................................................................................................</a>..30<br/>
<a href="libremacros.html#34"> 3. Language Constructs.......................................................................................................</a>....31<br/>
<a href="libremacros.html#35"> 3.1. Compatibility with Visual Basic..............................................................</a>...................32<br/>
<a href="libremacros.html#36"> 3.2. Compiler options and directives................................................................................</a>..33<br/>
<a href="libremacros.html#36"> 3.3. Variables........................................................................................</a>.............................33<br/>
<a href="libremacros.html#36"> 3.3.1. Constant, subroutine, function, label, and variable names....................</a>..............33<br/>
<a href="libremacros.html#37"> 3.3.2. Declaring variables...................................................................................</a>...........34<br/>
<a href="libremacros.html#39"> 3.3.3. Assigning values to variables............................................................</a>..................36<br/>
<a href="libremacros.html#39"> 3.3.4. Boolean variables are True or False..................................................</a>..................36<br/>
<a href="libremacros.html#40"> 3.3.5. Numeric variables............................................................................................</a>....37<br/>
<a href="libremacros.html#41">Integer variables......................................................................................................</a>...38<br/>
<a href="libremacros.html#42">Long Integer variables...........................................................................</a>....................39<br/>
<a href="libremacros.html#42">Currency variables.....................................................................................</a>................39<br/>
<a href="libremacros.html#43">Single variables....................................................................................................</a>......40<br/>
<a href="libremacros.html#43">Double variables....................................................................................</a>....................40<br/>
<a href="libremacros.html#43"> 3.3.6. String variables contain text..............................................................</a>..................40<br/>
<a href="libremacros.html#44"> 3.3.7. Date variables....................................................................................</a>..................41<br/>
<a href="libremacros.html#45"> 3.3.8. Create your own data types.........................................................</a>........................42<br/>
<a href="libremacros.html#46"> 3.3.9. Declare variables with special types...................................................................</a>.43<br/>
<a href="libremacros.html#47"> 3.3.10. Object variables...................................................................................</a>..............44<br/>
i<br/>
<hr/>
<a name=5></a><a href="libremacros.html#47"> 3.3.11. Variant variables............................................................................................</a>....44<br/>
<a href="libremacros.html#48"> 3.3.12. Constants...................................................................................</a>........................45<br/>
<a href="libremacros.html#49"> 3.4. The With statement...............................................................................</a>......................46<br/>
<a href="libremacros.html#50"> 3.5. Arrays..............................................................................................................</a>............47<br/>
<a href="libremacros.html#52"> 3.5.1. Changing the dimension of an array................................................................</a>....49<br/>
<a href="libremacros.html#54"> 3.5.2. The unexpected behavior of arrays.....................................................................</a>.51<br/>
<a href="libremacros.html#56"> 3.6. Subroutines and functions...........................................................................</a>................53<br/>
<a href="libremacros.html#57"> 3.6.1. Arguments...................................................................................</a>........................54<br/>
<a href="libremacros.html#57">Pass by reference or by value..........................................................</a>..........................54<br/>
<a href="libremacros.html#60">Optional arguments..............................................................................................</a>......57<br/>
<a href="libremacros.html#61">Default argument values............................................................................</a>................58<br/>
<a href="libremacros.html#61"> 3.6.2. Recursive routines..........................................................................</a>.....................58<br/>
<a href="libremacros.html#62"> 3.7. Scope of variables, subroutines, and functions........................................</a>...................59<br/>
<a href="libremacros.html#63"> 3.7.1. Local variables defined in a subroutine or function..........................</a>..................60<br/>
<a href="libremacros.html#63"> 3.7.2. Variables defined in a module..................................................................</a>...........60<br/>
<a href="libremacros.html#64">Global...........................................................................................</a>.............................61<br/>
<a href="libremacros.html#64">Public......................................................................................................</a>...................61<br/>
<a href="libremacros.html#65">Private or Dim.........................................................................................................</a>...62<br/>
<a href="libremacros.html#65"> 3.8. Operators.....................................................................................................</a>................62<br/>
<a href="libremacros.html#66"> 3.8.1. Mathematical and string operators..............................................</a>........................63<br/>
<a href="libremacros.html#67">Unary plus (+) and minus (­)...............................................................</a>......................64<br/>
<a href="libremacros.html#67">Exponentiation (^)...........................................................................</a>..........................64<br/>
<a href="libremacros.html#68">Multiplication (*) and Division (/)...............................................</a>.............................65<br/>
<a href="libremacros.html#68">Remainder after division (MOD)............................................................................</a>...65<br/>
<a href="libremacros.html#69">Integer division (\)...........................................................................</a>..........................66<br/>
<a href="libremacros.html#70">Addition (+), subtraction (­), and string concatenation (&amp; and +)............................</a>.67<br/>
<a href="libremacros.html#70"> 3.8.2. Logical and bit­wise operators....................................................</a>........................67<br/>
<a href="libremacros.html#73">AND.....................................................................................................................</a>......70<br/>
<a href="libremacros.html#73">OR.....................................................................................................................</a>.........70<br/>
<a href="libremacros.html#74">XOR..............................................................................................................</a>.............71<br/>
<a href="libremacros.html#74">EQV........................................................................................................</a>...................71<br/>
<a href="libremacros.html#75">IMP.....................................................................................................</a>.......................72<br/>
<a href="libremacros.html#76">NOT........................................................................................................</a>...................73<br/>
<a href="libremacros.html#76"> 3.8.3. Comparison operators......................................................................................</a>....73<br/>
<a href="libremacros.html#77"> 3.9. Flow control..........................................................................................</a>......................74<br/>
<a href="libremacros.html#77"> 3.9.1. Define a label as a jump target.......................................................</a>.....................74<br/>
<a href="libremacros.html#77"> 3.9.2. GoSub....................................................................................................</a>..............74<br/>
<a href="libremacros.html#78"> 3.9.3. GoTo............................................................................................................</a>........75<br/>
<a href="libremacros.html#78"> 3.9.4. On GoTo and On GoSub...................................................................</a>..................75<br/>
<a href="libremacros.html#79"> 3.9.5. If Then Else.................................................................................</a>........................76<br/>
<a href="libremacros.html#80"> 3.9.6. IIf.......................................................................................................</a>..................77<br/>
ii<br/>
<hr/>
<a name=6></a><a href="libremacros.html#80"> 3.9.7. Choose................................................................................................</a>.................77<br/>
<a href="libremacros.html#81"> 3.9.8. Select Case..........................................................................................................</a>.78<br/>
<a href="libremacros.html#81">Case expressions...........................................................................................</a>.............78<br/>
<a href="libremacros.html#82">If Case statements are easy, why are they frequently incorrect?.................</a>..............79<br/>
<a href="libremacros.html#83">Writing correct Case expressions....................................................</a>..........................80<br/>
<a href="libremacros.html#85"> 3.9.9. While ... Wend.............................................................................................</a>........82<br/>
<a href="libremacros.html#85"> 3.9.10. Do ... Loop.................................................................................................</a>........82<br/>
<a href="libremacros.html#86">Exit the Do Loop..........................................................................</a>.............................83<br/>
<a href="libremacros.html#86">Which Do Loop should I use?............................................................</a>.......................83<br/>
<a href="libremacros.html#87"> 3.9.11. For ... Next.................................................................................................</a>........84<br/>
<a href="libremacros.html#88"> 3.9.12. Exit Sub and Exit Function...............................................................................</a>.85<br/>
<a href="libremacros.html#89"> 3.10. Error handling using On Error........................................................</a>..........................86<br/>
<a href="libremacros.html#90"> 3.10.1. CVErr....................................................................................</a>............................87<br/>
<a href="libremacros.html#91"> 3.10.2. Ignore errors with On Error Resume Next...................................</a>.....................88<br/>
<a href="libremacros.html#91"> 3.10.3. Clear an error handler with On Error GoTo 0.................................</a>..................88<br/>
<a href="libremacros.html#92"> 3.10.4. Specify your own error handler with On Error GoTo Label..............</a>...............89<br/>
<a href="libremacros.html#94"> 3.10.5. Error handlers — why use them?....................................................</a>..................91<br/>
<a href="libremacros.html#96"> 3.11. Conclusion...............................................................................................................</a>..93<br/>
<a href="libremacros.html#97"> 4. Numerical Routines.................................................................................</a>...........................94<br/>
<a href="libremacros.html#98"> 4.1. Trigonometric functions.....................................................................................</a>.........95<br/>
<a href="libremacros.html#100"> 4.2. Rounding errors and precision.............................................................</a>.......................97<br/>
<a href="libremacros.html#103"> 4.3. Mathematical functions.................................................................................</a>............100<br/>
<a href="libremacros.html#104"> 4.4. Numeric conversions...........................................................................................</a>......101<br/>
<a href="libremacros.html#110"> 4.5. Number to string conversions.........................................................</a>..........................107<br/>
<a href="libremacros.html#110"> 4.6. Simple formatting....................................................................................................</a>..107<br/>
<a href="libremacros.html#111"> 4.7. Other number bases, hexadecimal, octal, and binary......................................</a>..........108<br/>
<a href="libremacros.html#114"> 4.8. Random numbers.........................................................................</a>.............................111<br/>
<a href="libremacros.html#115"> 4.9. Conclusion...............................................................................................................</a>..112<br/>
<a href="libremacros.html#116"> 5. Array Routines....................................................................................................</a>..............113<br/>
<a href="libremacros.html#117"> 5.1. Array() quickly builds a one­dimensional array with data.....................................</a>...114<br/>
<a href="libremacros.html#119"> 5.2. DimArray creates empty multi­dimensional arrays...............................</a>...................116<br/>
<a href="libremacros.html#120"> 5.3. Change the dimension of an array.......................................................................</a>......117<br/>
<a href="libremacros.html#121"> 5.4. Array to String and back again...............................................................................</a>...118<br/>
<a href="libremacros.html#122"> 5.5. Array inspection functions.....................................................................</a>...................119<br/>
<a href="libremacros.html#125"> 5.6. Conclusion...............................................................................................................</a>..122<br/>
<a href="libremacros.html#126"> 6. Date Routines.............................................................................................................</a>.......123<br/>
<a href="libremacros.html#127"> 6.1. Compatibility issues...................................................................................</a>...............124<br/>
<a href="libremacros.html#127"> 6.2. Retrieve the current date and time...............................................</a>.............................124<br/>
<a href="libremacros.html#127"> 6.3. Dates, numbers, and strings.........................................................</a>.............................124<br/>
<a href="libremacros.html#129"> 6.4. Locale formatted dates...........................................................................</a>...................126<br/>
<a href="libremacros.html#129"> 6.5. ISO 8601 dates.......................................................................................</a>...................126<br/>
iii<br/>
<hr/>
<a name=7></a><a href="libremacros.html#130"> 6.6. Problems with dates........................................................................</a>..........................127<br/>
<a href="libremacros.html#134"> 6.7. Extract each part of a date............................................................................</a>.............131<br/>
<a href="libremacros.html#138"> 6.8. Date arithmetic..........................................................................................</a>................135<br/>
<a href="libremacros.html#139"> 6.9. Assembling dates from components...............................................</a>..........................136<br/>
<a href="libremacros.html#140"> 6.10. Measuring elapsed time over short intervals.....................................................</a>......137<br/>
<a href="libremacros.html#142"> 6.11. How fast does this run? A real­world example!...................................................</a>...139<br/>
<a href="libremacros.html#145"> 6.12. Long time intervals and special dates...........................................</a>..........................142<br/>
<a href="libremacros.html#146"> 6.13. Conclusion.............................................................................................................</a>..143<br/>
<a href="libremacros.html#147"> 7. String Routines..................................................................................................................</a>144<br/>
<a href="libremacros.html#149"> 7.1. ASCII and Unicode values...............................................................................</a>.........146<br/>
<a href="libremacros.html#152"> 7.2. Standard string functions.........................................................................................</a>..149<br/>
<a href="libremacros.html#156"> 7.3. Locale and strings........................................................................</a>.............................153<br/>
<a href="libremacros.html#156"> 7.4. Substrings......................................................................................................</a>............153<br/>
<a href="libremacros.html#157"> 7.5. Replace..........................................................................................................</a>............154<br/>
<a href="libremacros.html#158"> 7.6. Aligning strings with LSet and RSet...................................................................</a>......155<br/>
<a href="libremacros.html#160"> 7.7. Fancy formatting with Format.....................................................</a>.............................157<br/>
<a href="libremacros.html#165"> 7.8. Converting data to a string.....................................................................</a>...................162<br/>
<a href="libremacros.html#166"> 7.9. Advanced searching...........................................................................</a>.......................163<br/>
<a href="libremacros.html#167"> 7.10. Conclusion.............................................................................................................</a>..164<br/>
<a href="libremacros.html#169"> 8. File Routines....................................................................................................</a>.................166<br/>
<a href="libremacros.html#170"> 8.1. Using URL notation to specify a file..............................................</a>..........................167<br/>
<a href="libremacros.html#171"> 8.2. Directory manipulation functions................................................</a>.............................168<br/>
<a href="libremacros.html#172"> 8.3. File manipulation functions.....................................................................................</a>..169<br/>
<a href="libremacros.html#175"> 8.4. File attributes, bitmasks, and binary numbers.....................................................</a>......172<br/>
<a href="libremacros.html#177"> 8.5. Obtaining a directory listing....................................................................................</a>..174<br/>
<a href="libremacros.html#178"> 8.6. Open a file.................................................................................................</a>................175<br/>
<a href="libremacros.html#180"> 8.7. Information about open files..................................................................</a>...................177<br/>
<a href="libremacros.html#183"> 8.8. Reading and writing data.............................................................</a>.............................180<br/>
<a href="libremacros.html#189"> 8.9. File and directory related services..........................................................................</a>...186<br/>
<a href="libremacros.html#189"> 8.9.1. Path Settings.....................................................................................</a>.................186<br/>
<a href="libremacros.html#193"> 8.9.2. Path Substitution............................................................................................</a>....190<br/>
<a href="libremacros.html#195"> 8.9.3. Simple File Access.......................................................................</a>.....................192<br/>
<a href="libremacros.html#195"> 8.9.4. Streams.........................................................................................</a>.....................192<br/>
<a href="libremacros.html#199"> 8.9.5. Pipes.......................................................................................</a>...........................196<br/>
<a href="libremacros.html#200"> 8.10. Conclusion.............................................................................................................</a>..197<br/>
<a href="libremacros.html#201"> 9. Miscellaneous Routines...............................................................................</a>.....................198<br/>
<a href="libremacros.html#201"> 9.1. Display and color............................................................................</a>..........................198<br/>
<a href="libremacros.html#201"> 9.1.1. Determine the GUI type............................................................</a>........................198<br/>
<a href="libremacros.html#202"> 9.1.2. Determine pixel size (in twips).........................................................................</a>.199<br/>
<a href="libremacros.html#203"> 9.1.3. Use color functions....................................................................................</a>........200<br/>
<a href="libremacros.html#205"> 9.2. Flow control........................................................................................</a>......................202<br/>
iv<br/>
<hr/>
<a name=8></a><a href="libremacros.html#206"> 9.2.1. Return an argument...................................................................</a>........................203<br/>
<a href="libremacros.html#207"> 9.2.2. Pause or end the macro..............................................................................</a>........204<br/>
<a href="libremacros.html#208"> 9.2.3. Dynamic Link Libraries........................................................</a>............................205<br/>
<a href="libremacros.html#209"> 9.2.4. Calling external applications...........................................................</a>..................206<br/>
<a href="libremacros.html#210"> 9.2.5. Dynamic Data Exchange.................................................................</a>..................207<br/>
<a href="libremacros.html#211"> 9.3. User input and output................................................................................</a>................208<br/>
<a href="libremacros.html#212"> 9.3.1. Simple output....................................................................................................</a>.209<br/>
<a href="libremacros.html#213"> 9.3.2. Multi­line output............................................................................................</a>....210<br/>
<a href="libremacros.html#215"> 9.3.3. Prompting for input...................................................................</a>........................212<br/>
<a href="libremacros.html#217"> 9.4. Error­related routines.........................................................................</a>.......................214<br/>
<a href="libremacros.html#218"> 9.5. Miscellaneous routines.....................................................................................</a>.........215<br/>
<a href="libremacros.html#221"> 9.6. Partition.....................................................................................................</a>................218<br/>
<a href="libremacros.html#223"> 9.7. Inspection and identification of variables..........................................</a>.......................220<br/>
<a href="libremacros.html#228"> 9.8. Routines you should not use and other curiosities....................................</a>................225<br/>
<a href="libremacros.html#229"> 9.9. Routines I do not understand...................................................................................</a>..226<br/>
<a href="libremacros.html#230"> 9.10. Conclusion.............................................................................................................</a>..227<br/>
<a href="libremacros.html#231"> 10. Universal Network Objects......................................................................................</a>.......228<br/>
<a href="libremacros.html#232"> 10.1. Base types and structures.................................................................</a>.......................229<br/>
<a href="libremacros.html#234"> 10.2. UNO interface......................................................................................</a>...................231<br/>
<a href="libremacros.html#235"> 10.3. UNO service...................................................................................................</a>.........232<br/>
<a href="libremacros.html#239"> 10.3.1. Setting a Read­Only Value...................................................................</a>...........236<br/>
<a href="libremacros.html#240"> 10.4. Context.................................................................................................</a>...................237<br/>
<a href="libremacros.html#240"> 10.5. Inspecting Universal Network Objects.........................................</a>..........................237<br/>
<a href="libremacros.html#245"> 10.6. Using the type description manager...........................................................</a>.............242<br/>
<a href="libremacros.html#248"> 10.7. Use Object or Variant...........................................................................................</a>...245<br/>
<a href="libremacros.html#249"> 10.8. Comparing UNO variables................................................................................</a>......246<br/>
<a href="libremacros.html#250"> 10.9. Built­in global UNO variables..........................................................</a>......................247<br/>
<a href="libremacros.html#253"> 10.10. Creating UNO values for OOo internals..................................................</a>.............250<br/>
<a href="libremacros.html#254"> 10.11. Finding objects and properties........................................................</a>......................251<br/>
<a href="libremacros.html#255"> 10.12. UNO listeners...............................................................................................</a>.........252<br/>
<a href="libremacros.html#256"> 10.12.1. Your first listener.......................................................................................</a>....253<br/>
<a href="libremacros.html#257"> 10.12.2. A complete listener: selection change listener.....................</a>.........................254<br/>
<a href="libremacros.html#259"> 10.13. Creating a UNO dialog.......................................................................................</a>...256<br/>
<a href="libremacros.html#263"> 10.14. Conclusion...........................................................................................................</a>..260<br/>
<a href="libremacros.html#264"> 11. The Dispatcher..................................................................................................</a>..............261<br/>
<a href="libremacros.html#264"> 11.1. The environment...........................................................................</a>..........................261<br/>
<a href="libremacros.html#264"> 11.1.1. Two different methods to control OOo......................................</a>.....................261<br/>
<a href="libremacros.html#266"> 11.1.2. Finding dispatch commands..............................................................</a>..............263<br/>
<a href="libremacros.html#266">Use the WIKI..............................................................................................</a>.............263<br/>
<a href="libremacros.html#266">Probe the interface...............................................................................</a>....................263<br/>
<a href="libremacros.html#269">Read source code.................................................................................</a>....................266<br/>
v<br/>
<hr/>
<a name=9></a><a href="libremacros.html#269"> 11.2. Writing a macro using the dispatcher...................................................................</a>...266<br/>
<a href="libremacros.html#269"> 11.3. Dispatch failure – an advanced clipboard example..............................................</a>...266<br/>
<a href="libremacros.html#270"> 11.4. Conclusion.............................................................................................................</a>..267<br/>
<a href="libremacros.html#271"> 12. StarDesktop..............................................................................................................</a>.......268<br/>
<a href="libremacros.html#271"> 12.1. The Frame service...................................................................................</a>................268<br/>
<a href="libremacros.html#272"> 12.1.1. The XIndexAccess interface...........................................................................</a>.269<br/>
<a href="libremacros.html#272"> 12.1.2. Find frames with FrameSearchFlag constants.............................................</a>....269<br/>
<a href="libremacros.html#274"> 12.2. The XEventBroadcaster interface....................................................</a>.......................271<br/>
<a href="libremacros.html#274"> 12.3. The XDesktop interface................................................................</a>..........................271<br/>
<a href="libremacros.html#274"> 12.3.1. Closing the desktop and contained components..........................................</a>....271<br/>
<a href="libremacros.html#275"> 12.3.2. Enumerating components using XEnumerationAccess..................................</a>.272<br/>
<a href="libremacros.html#276"> 12.3.3. Current component........................................................................</a>..................273<br/>
<a href="libremacros.html#277"> 12.3.4. Current component (again)......................................................................</a>........274<br/>
<a href="libremacros.html#277"> 12.3.5. Current frame..................................................................................................</a>.274<br/>
<a href="libremacros.html#278"> 12.4. Load a document.....................................................................................</a>................275<br/>
<a href="libremacros.html#282"> 12.4.1. Named arguments.................................................................................</a>...........279<br/>
<a href="libremacros.html#284"> 12.4.2. Loading a template.....................................................................</a>.....................281<br/>
<a href="libremacros.html#285"> 12.4.3. Enabling macros while loading a document................................................</a>....282<br/>
<a href="libremacros.html#286"> 12.4.4. Importing and exporting....................................................................</a>..............283<br/>
<a href="libremacros.html#286"> 12.4.5. Filter names................................................................................</a>.....................283<br/>
<a href="libremacros.html#292"> 12.4.6. Loading and saving documents..................................................</a>.....................289<br/>
<a href="libremacros.html#294"> 12.4.7. Error handling while loading a document..................................</a>.....................291<br/>
<a href="libremacros.html#294"> 12.5. Conclusion.............................................................................................................</a>..291<br/>
<a href="libremacros.html#295"> 13. Generic Document Methods......................................................................</a>.....................292<br/>
<a href="libremacros.html#295"> 13.1. Service Manager...................................................................................................</a>...292<br/>
<a href="libremacros.html#296"> 13.2. Services and interfaces...............................................................................</a>.............293<br/>
<a href="libremacros.html#297"> 13.3. Getting and setting properties.......................................................</a>..........................294<br/>
<a href="libremacros.html#299"> 13.4. Document properties............................................................................</a>...................296<br/>
<a href="libremacros.html#301"> 13.4.1. Document properties from a closed document.....................................</a>...........298<br/>
<a href="libremacros.html#301"> 13.4.2. Custom properties........................................................................................</a>....298<br/>
<a href="libremacros.html#302"> 13.4.3. Deprecated document information object...........................</a>............................299<br/>
<a href="libremacros.html#303"> 13.5. List events.....................................................................................</a>..........................300<br/>
<a href="libremacros.html#304"> 13.5.1. Registering your own listener......................................................................</a>....301<br/>
<a href="libremacros.html#305"> 13.5.2. Intercepting dispatch commands...................................................</a>..................302<br/>
<a href="libremacros.html#307"> 13.6. Link targets............................................................................................................</a>..304<br/>
<a href="libremacros.html#309"> 13.7. Accessing view data: XViewDataSupplier..........................................</a>...................306<br/>
<a href="libremacros.html#310"> 13.8. Close a document: XCloseable.....................................................</a>..........................307<br/>
<a href="libremacros.html#311"> 13.9. Draw Pages: XDrawPagesSupplier................................................................</a>.........308<br/>
<a href="libremacros.html#311"> 13.9.1. Draw and Impress....................................................................................</a>........308<br/>
<a href="libremacros.html#314"> 13.9.2. Draw lines with arrows in Calc..................................................</a>.....................311<br/>
<a href="libremacros.html#315"> 13.9.3. Writer...........................................................................................................</a>....312<br/>
vi<br/>
<hr/>
<a name=10></a><a href="libremacros.html#316"> 13.10. The model............................................................................................................</a>..313<br/>
<a href="libremacros.html#317"> 13.10.1. Document arguments.............................................................................</a>........314<br/>
<a href="libremacros.html#319"> 13.11. Saving a document.............................................................................</a>...................316<br/>
<a href="libremacros.html#322"> 13.12. Manipulating styles............................................................................</a>...................319<br/>
<a href="libremacros.html#327"> 13.12.1. Style utilities.......................................................................................</a>...........324<br/>
<a href="libremacros.html#332"> 13.13. Dealing with locale..................................................................</a>.............................329<br/>
<a href="libremacros.html#340"> 13.14. Enumerating printers.................................................................................</a>............337<br/>
<a href="libremacros.html#340"> 13.15. Printing documents..............................................................................................</a>..337<br/>
<a href="libremacros.html#344"> 13.15.1. Printing Writer documents................................................</a>............................341<br/>
<a href="libremacros.html#346"> 13.15.2. Printing Calc documents...............................................................................</a>.343<br/>
<a href="libremacros.html#347"> 13.15.3. A Calc example with a Print listener..................................................</a>...........344<br/>
<a href="libremacros.html#349"> 13.15.4. Print examples by Vincent Van Houtte...........................................</a>..............346<br/>
<a href="libremacros.html#359"> 13.16. Creating services................................................................................</a>...................356<br/>
<a href="libremacros.html#360"> 13.17. Document settings.....................................................................................</a>............357<br/>
<a href="libremacros.html#362"> 13.18. The coolest trick I know..................................................................................</a>......359<br/>
<a href="libremacros.html#362"> 13.19. Converting to a URL in other languages............................................................</a>...359<br/>
<a href="libremacros.html#362"> 13.20. Conclusion...........................................................................................................</a>..359<br/>
<a href="libremacros.html#363"> 14. Writer Documents................................................................................................</a>...........360<br/>
<a href="libremacros.html#364"> 14.1. Basic building blocks...........................................................................</a>...................361<br/>
<a href="libremacros.html#364"> 14.1.1. Primary text content: the XText interface..................................</a>.....................361<br/>
<a href="libremacros.html#365"> 14.1.2. Text ranges: the XTextRange interface................................................</a>...........362<br/>
<a href="libremacros.html#367"> 14.1.3. Inserting simple text...................................................................</a>.....................364<br/>
<a href="libremacros.html#367"> 14.1.4. Text content: the TextContent service.........................................................</a>....364<br/>
<a href="libremacros.html#369"> 14.2. Enumerating paragraphs.......................................................................................</a>...366<br/>
<a href="libremacros.html#369"> 14.2.1. Paragraph properties.............................................................................</a>...........366<br/>
<a href="libremacros.html#373">Insert a page break...................................................................................</a>................370<br/>
<a href="libremacros.html#374">Set the paragraph style...................................................................................</a>..........371<br/>
<a href="libremacros.html#374"> 14.2.2. Character properties........................................................................................</a>.371<br/>
<a href="libremacros.html#379"> 14.2.3. Enumerating text sections (paragraph portions)......................................</a>........376<br/>
<a href="libremacros.html#381"> 14.3. Graphics........................................................................................</a>..........................378<br/>
<a href="libremacros.html#384"> 14.4. Paste HTML then embed linked graphics..................................................</a>.............381<br/>
<a href="libremacros.html#386"> 14.5. Cursors..........................................................................................</a>..........................383<br/>
<a href="libremacros.html#386"> 14.5.1. View cursors.........................................................................................</a>...........383<br/>
<a href="libremacros.html#388"> 14.5.2. Text (non­view) cursors......................................................</a>............................385<br/>
<a href="libremacros.html#389"> 14.5.3. Using cursors to traverse text.....................................................</a>.....................386<br/>
<a href="libremacros.html#391">Keep the view cursor and text cursor in sync.........................................</a>.................388<br/>
<a href="libremacros.html#392"> 14.5.4. Accessing content using cursors..................................................................</a>....389<br/>
<a href="libremacros.html#394"> 14.6. Selected text......................................................................................</a>......................391<br/>
<a href="libremacros.html#395"> 14.6.1. Is text selected?...............................................................................................</a>.392<br/>
<a href="libremacros.html#396"> 14.6.2. Selected text: Which end is which?.........................................................</a>........393<br/>
<a href="libremacros.html#397"> 14.6.3. Selected text framework....................................................................</a>..............394<br/>
vii<br/>
<hr/>
<a name=11></a><a href="libremacros.html#399"> 14.6.4. Remove empty spaces and lines: A larger example......................</a>..................396<br/>
<a href="libremacros.html#399">What is white space?.................................................................</a>..............................396<br/>
<a href="libremacros.html#400">Rank characters for deletion................................................................</a>....................397<br/>
<a href="libremacros.html#401">Use the standard framework................................................................</a>....................398<br/>
<a href="libremacros.html#401">The worker macro..........................................................................................</a>..........398<br/>
<a href="libremacros.html#403"> 14.6.5. Selected text, closing thoughts...................................................</a>.....................400<br/>
<a href="libremacros.html#403"> 14.7. Search and replace................................................................................................</a>...400<br/>
<a href="libremacros.html#404"> 14.7.1. Searching selected text or a specified range............................................</a>........401<br/>
<a href="libremacros.html#405">Searching for all occurrences..............................................................</a>.........................402<br/>
<a href="libremacros.html#406"> 14.7.2. Searching and replacing......................................................</a>............................403<br/>
<a href="libremacros.html#406"> 14.7.3. Advanced search and replace.................................................</a>.........................403<br/>
<a href="libremacros.html#409"> 14.8. Text content.......................................................................................................</a>......406<br/>
<a href="libremacros.html#410"> 14.9. Text tables............................................................................................</a>...................407<br/>
<a href="libremacros.html#412"> 14.9.1. Using the correct text object....................................................................</a>........409<br/>
<a href="libremacros.html#413"> 14.9.2. Methods and properties...........................................................</a>........................410<br/>
<a href="libremacros.html#415"> 14.9.3. Simple and complex tables...................................................................</a>...........412<br/>
<a href="libremacros.html#418"> 14.9.4. Tables contain cells.................................................................</a>........................415<br/>
<a href="libremacros.html#420"> 14.9.5. Using a table cursor...........................................................................</a>..............417<br/>
<a href="libremacros.html#423"> 14.9.6. Formatting a text table.............................................................................</a>........420<br/>
<a href="libremacros.html#424"> 14.10. Text fields............................................................................................................</a>..421<br/>
<a href="libremacros.html#433"> 14.10.1. Text master fields.....................................................................</a>.....................430<br/>
<a href="libremacros.html#435"> 14.10.2. Creating and adding text fields..............................................................</a>........432<br/>
<a href="libremacros.html#438"> 14.11. Bookmarks..................................................................................</a>..........................435<br/>
<a href="libremacros.html#439"> 14.12. Sequence fields, references, and formatting...........................</a>..............................436<br/>
<a href="libremacros.html#439"> 14.12.1. Formatting numbers and dates......................................................................</a>.436<br/>
<a href="libremacros.html#440">List formats known to the current document..............................................</a>.............437<br/>
<a href="libremacros.html#440">Find or create a numeric format............................................................................</a>...437<br/>
<a href="libremacros.html#441">Default formats....................................................................................</a>....................438<br/>
<a href="libremacros.html#442"> 14.12.2. Create a field master...........................................................................</a>...........439<br/>
<a href="libremacros.html#442"> 14.12.3. Insert a sequence field..............................................................</a>.....................439<br/>
<a href="libremacros.html#443"> 14.12.4. Replace text with a sequence field.......................................</a>.........................440<br/>
<a href="libremacros.html#444"> 14.12.5. Create a GetReference field..........................................................................</a>.441<br/>
<a href="libremacros.html#445"> 14.12.6. Replace text with a GetReference field..........................................</a>...............442<br/>
<a href="libremacros.html#447"> 14.12.7. The worker that ties it all together.............................................................</a>....444<br/>
<a href="libremacros.html#448"> 14.13. Table of contents...................................................................................</a>................445<br/>
<a href="libremacros.html#454"> 14.14. Conclusion...........................................................................................................</a>..451<br/>
<a href="libremacros.html#455"> 15. Calc Documents................................................................................................</a>..............452<br/>
<a href="libremacros.html#456"> 15.1. Accessing sheets...................................................................................................</a>...453<br/>
<a href="libremacros.html#458"> 15.2. Sheet cells contain the data..............................................................</a>.......................455<br/>
<a href="libremacros.html#459"> 15.2.1. Cell address.........................................................................</a>............................456<br/>
<a href="libremacros.html#459"> 15.2.2. Cell data...................................................................................................</a>........456<br/>
viii<br/>
<hr/>
<a name=12></a><a href="libremacros.html#461"> 15.2.3. Cell properties.....................................................................</a>............................458<br/>
<a href="libremacros.html#466"> 15.2.4. Cell annotations.................................................................................</a>..............463<br/>
<a href="libremacros.html#467"> 15.3. Uninterpreted XML Attributes..........................................................................</a>......464<br/>
<a href="libremacros.html#469"> 15.4. Sheet cell ranges................................................................................................</a>......466<br/>
<a href="libremacros.html#469"> 15.4.1. Sheet cell range properties..............................................................................</a>.466<br/>
<a href="libremacros.html#470">Validation settings............................................................................</a>.......................467<br/>
<a href="libremacros.html#473">Conditional formatting..........................................................................................</a>...470<br/>
<a href="libremacros.html#473"> 15.4.2. Sheet cell range services.............................................................................</a>.....470<br/>
<a href="libremacros.html#473">Retrieving cells and ranges.........................................................................</a>.............470<br/>
<a href="libremacros.html#474">Querying cells.............................................................................................</a>.............471<br/>
<a href="libremacros.html#475">Finding non­empty cells in a range............................................</a>.............................472<br/>
<a href="libremacros.html#476">Using complex queries...............................................................</a>.............................473<br/>
<a href="libremacros.html#477">Query Precedents and Dependents.................................................................</a>.....474<br/>
<a href="libremacros.html#478">Query Column Differences...............................................................</a>..................475<br/>
<a href="libremacros.html#478"> 15.4.3. Searching and replacing......................................................</a>............................475<br/>
<a href="libremacros.html#479"> 15.4.4. Merging cells.....................................................................................</a>..............476<br/>
<a href="libremacros.html#479"> 15.4.5. Retrieving, inserting, and deleting columns and rows........</a>............................476<br/>
<a href="libremacros.html#481"> 15.4.6. Retrieving and setting data as an array....................................................</a>........478<br/>
<a href="libremacros.html#482"> 15.4.7. Computing functions on a range.....................................................................</a>.479<br/>
<a href="libremacros.html#483"> 15.4.8. Clearing cells and cell ranges............................................................</a>..............480<br/>
<a href="libremacros.html#483"> 15.4.9. Automatic data fill................................................................................</a>...........480<br/>
<a href="libremacros.html#484"> 15.4.10. Array formulas..............................................................................................</a>.481<br/>
<a href="libremacros.html#486"> 15.4.11. Computing multiple functions on a range................................</a>.....................483<br/>
<a href="libremacros.html#488"> 15.4.12. Cells with the same formatting..............................................................</a>........485<br/>
<a href="libremacros.html#490"> 15.4.13. Sorting...................................................................................</a>........................487<br/>
<a href="libremacros.html#493"> 15.5. Sheets............................................................................................</a>..........................490<br/>
<a href="libremacros.html#494"> 15.5.1. Linking to an external spreadsheet....................................................</a>..............491<br/>
<a href="libremacros.html#496"> 15.5.2. Finding dependencies by using auditing functions.............</a>............................493<br/>
<a href="libremacros.html#498"> 15.5.3. Outlines...........................................................................................................</a>.495<br/>
<a href="libremacros.html#498"> 15.5.4. Copying, moving, and inserting cells................................................</a>..............495<br/>
<a href="libremacros.html#500"> 15.5.5. Copy data between documents......................................................</a>..................497<br/>
<a href="libremacros.html#500">Data functions.............................................................................................</a>.............497<br/>
<a href="libremacros.html#500">Clipboard.......................................................................................</a>..........................497<br/>
<a href="libremacros.html#501">Transferable content......................................................................</a>..........................498<br/>
<a href="libremacros.html#501"> 15.5.6. Data pilot and pivot tables....................................................................</a>...........498<br/>
<a href="libremacros.html#501">A data pilot example...................................................................................</a>.............498<br/>
<a href="libremacros.html#502">Generating the data....................................................................</a>.........................499<br/>
<a href="libremacros.html#503">Creating the data pilot table...........................................................</a>.....................500<br/>
<a href="libremacros.html#505">Manipulating data pilot tables....................................................</a>.............................502<br/>
<a href="libremacros.html#505">Data pilot fields........................................................................................</a>...........502<br/>
<a href="libremacros.html#506">Filtering data pilot fields.......................................................................</a>..............503<br/>
ix<br/>
<hr/>
<a name=13></a><a href="libremacros.html#507">Tables...................................................................................................</a>...............504<br/>
<a href="libremacros.html#507"> 15.5.7. Sheet cursors................................................................................................</a>....504<br/>
<a href="libremacros.html#509"> 15.6. Calc documents....................................................................................</a>...................506<br/>
<a href="libremacros.html#510"> 15.6.1. Named range................................................................................................</a>....507<br/>
<a href="libremacros.html#512"> 15.6.2. Database range................................................................................................</a>.509<br/>
<a href="libremacros.html#513"> 15.6.3. Filters....................................................................................................</a>...........510<br/>
<a href="libremacros.html#516"> 15.6.4. Protecting documents and sheets.............................................................</a>........513<br/>
<a href="libremacros.html#516"> 15.6.5. Controlling recalculation...................................................................</a>..............513<br/>
<a href="libremacros.html#516"> 15.6.6. Using Goal Seek................................................................................</a>..............513<br/>
<a href="libremacros.html#517"> 15.7. Write your own Calc functions........................................................</a>.......................514<br/>
<a href="libremacros.html#519"> 15.8. Using the current controller.......................................................</a>.............................516<br/>
<a href="libremacros.html#519"> 15.8.1. Selected cells..............................................................................</a>.....................516<br/>
<a href="libremacros.html#520">Enumerating the selected cells..............................................................................</a>...517<br/>
<a href="libremacros.html#521">Selecting text..............................................................................</a>.............................518<br/>
<a href="libremacros.html#521">The active cell................................................................................................</a>..........518<br/>
<a href="libremacros.html#522"> 15.8.2. General functionality.........................................................................</a>..............519<br/>
<a href="libremacros.html#524"> 15.9. Control Calc from Microsoft Office..........................................</a>.............................521<br/>
<a href="libremacros.html#525"> 15.10. Accessing Calc functions...................................................................</a>...................522<br/>
<a href="libremacros.html#525"> 15.11. Finding URLs in Calc.................................................................</a>..........................522<br/>
<a href="libremacros.html#526"> 15.12. Importing and Exporting XML Files Using Calc....................</a>.............................523<br/>
<a href="libremacros.html#526"> 15.12.1. Read an XML file...............................................................................</a>...........523<br/>
<a href="libremacros.html#534"> 15.12.2. Write XML File..................................................................................</a>...........531<br/>
<a href="libremacros.html#544"> 15.13. Charts..........................................................................................</a>..........................541<br/>
<a href="libremacros.html#550"> 15.14. Conclusion...........................................................................................................</a>..547<br/>
<a href="libremacros.html#551"> 16. Draw and Impress Documents..........................................................................</a>..............548<br/>
<a href="libremacros.html#552"> 16.1. Draw pages.....................................................................................................</a>.........549<br/>
<a href="libremacros.html#553"> 16.1.1. Generic draw page................................................................................</a>...........550<br/>
<a href="libremacros.html#555"> 16.1.2. Combining shapes................................................................</a>...........................552<br/>
<a href="libremacros.html#557"> 16.2. Shapes........................................................................................</a>.............................554<br/>
<a href="libremacros.html#560"> 16.2.1. Common attributes..................................................................</a>........................557<br/>
<a href="libremacros.html#566">Drawing text service................................................................................</a>................563<br/>
<a href="libremacros.html#568">MeasureShape................................................................................................</a>..........565<br/>
<a href="libremacros.html#569">Drawing line properties.................................................................</a>..........................566<br/>
<a href="libremacros.html#570">Filling space with a ClosedBezierShape...............................................................</a>...567<br/>
<a href="libremacros.html#573">Shadows and a RectangleShape............................................................................</a>...570<br/>
<a href="libremacros.html#574">Rotation and shearing.......................................................................</a>.......................571<br/>
<a href="libremacros.html#575"> 16.2.2. Shape types...........................................................................................</a>...........572<br/>
<a href="libremacros.html#575">Simple lines................................................................................</a>.............................572<br/>
<a href="libremacros.html#576">PolyLineShape............................................................................................</a>.............573<br/>
<a href="libremacros.html#578">PolyPolygonShape......................................................................................</a>.............575<br/>
<a href="libremacros.html#578">RectangleShape and TextShape.........................................................................</a>......575<br/>
x<br/>
<hr/>
<a name=14></a><a href="libremacros.html#579">EllipseShape...............................................................................</a>.............................576<br/>
<a href="libremacros.html#581">Bezier curves.............................................................................</a>..............................578<br/>
<a href="libremacros.html#584">ConnectorShape..........................................................................................</a>.............581<br/>
<a href="libremacros.html#587">Creating your own glue points.............................................................</a>...............584<br/>
<a href="libremacros.html#587">Adding arrows by using styles.............................................................</a>...............584<br/>
<a href="libremacros.html#589">Insert a TableShape...............................................................................................</a>...586<br/>
<a href="libremacros.html#590"> 16.3. Forms.....................................................................................................................</a>..587<br/>
<a href="libremacros.html#592"> 16.4. Presentations..............................................................................</a>.............................589<br/>
<a href="libremacros.html#594"> 16.4.1. Presentation draw pages.............................................................</a>.....................591<br/>
<a href="libremacros.html#595"> 16.4.2. Presentation shapes......................................................................................</a>....592<br/>
<a href="libremacros.html#597"> 16.5. Conclusion.............................................................................................................</a>..594<br/>
<a href="libremacros.html#598"> 17. Library Management...................................................................................................</a>....595<br/>
<a href="libremacros.html#598"> 17.1. Accessing libraries using OOo Basic.........................................................</a>.............595<br/>
<a href="libremacros.html#602"> 17.2. Libraries contained in a document.......................................................</a>...................599<br/>
<a href="libremacros.html#602"> 17.3. Writing an installer............................................................................................</a>......599<br/>
<a href="libremacros.html#604"> 17.4. Conclusion.............................................................................................................</a>..601<br/>
<a href="libremacros.html#605"> 18. Dialogs and Controls.......................................................................................................</a>602<br/>
<a href="libremacros.html#605"> 18.1. My first dialog................................................................................................</a>.........602<br/>
<a href="libremacros.html#608"> 18.1.1. The Properties dialog...................................................................................</a>....605<br/>
<a href="libremacros.html#610"> 18.1.2. Starting a dialog from a macro......................................................</a>..................607<br/>
<a href="libremacros.html#611"> 18.1.3. Assign an event handler..................................................................................</a>.608<br/>
<a href="libremacros.html#614"> 18.2. Dialog and control paradigm.............................................................................</a>......611<br/>
<a href="libremacros.html#614"> 18.2.1. Dialog and control similarities................................................</a>........................611<br/>
<a href="libremacros.html#616"> 18.2.2. Dialog­specific methods.......................................................................</a>...........613<br/>
<a href="libremacros.html#617"> 18.2.3. The dialog model..................................................................................</a>...........614<br/>
<a href="libremacros.html#619"> 18.3. Controls...................................................................................................</a>................616<br/>
<a href="libremacros.html#620"> 18.3.1. Control button..............................................................................................</a>....617<br/>
<a href="libremacros.html#623"> 18.3.2. Check box.............................................................................................</a>...........620<br/>
<a href="libremacros.html#624"> 18.3.3. Radio button............................................................................</a>........................621<br/>
<a href="libremacros.html#625"> 18.3.4. Group box.............................................................................................</a>...........622<br/>
<a href="libremacros.html#626"> 18.3.5. Fixed line control.........................................................................................</a>....623<br/>
<a href="libremacros.html#626"> 18.3.6. Combo box..............................................................................</a>........................623<br/>
<a href="libremacros.html#627"> 18.3.7. Text edit controls..................................................................................</a>...........624<br/>
<a href="libremacros.html#629">Currency control..................................................................................</a>....................626<br/>
<a href="libremacros.html#630">Numeric control.......................................................................................</a>................627<br/>
<a href="libremacros.html#630">Date control................................................................................</a>.............................627<br/>
<a href="libremacros.html#633">Time control..........................................................................................................</a>...630<br/>
<a href="libremacros.html#635">Formatted control..................................................................................................</a>...632<br/>
<a href="libremacros.html#638">Pattern control....................................................................................................</a>......635<br/>
<a href="libremacros.html#640">Fixed text control........................................................................................</a>.............637<br/>
<a href="libremacros.html#640">File control......................................................................................................</a>.........637<br/>
xi<br/>
<hr/>
<a name=15></a><a href="libremacros.html#642"> 18.3.8. Image control...........................................................................................</a>........639<br/>
<a href="libremacros.html#642"> 18.3.9. Progress control.................................................................................</a>..............639<br/>
<a href="libremacros.html#643"> 18.3.10. List box control.............................................................................................</a>.640<br/>
<a href="libremacros.html#644"> 18.3.11. Scroll bar control.........................................................................</a>..................641<br/>
<a href="libremacros.html#647"> 18.4. Using the Step property for multi­page AutoPilot dialogs....................................</a>..644<br/>
<a href="libremacros.html#647"> 18.5. The object inspector example...............................................................................</a>...644<br/>
<a href="libremacros.html#647"> 18.5.1. Utility subroutines and functions....................................................................</a>.644<br/>
<a href="libremacros.html#648">Identifying and removing white space from a string...............................</a>................645<br/>
<a href="libremacros.html#649">Convert a simple object to a string...................................................</a>.......................646<br/>
<a href="libremacros.html#652">Object inspection using Basic methods................................................</a>...................649<br/>
<a href="libremacros.html#653">Sort an array.......................................................................................................</a>......650<br/>
<a href="libremacros.html#654"> 18.5.2. Creating a dialog at run time......................................................</a>.....................651<br/>
<a href="libremacros.html#658"> 18.5.3. Listeners..............................................................................</a>............................655<br/>
<a href="libremacros.html#658">Radio buttons...........................................................................................</a>................655<br/>
<a href="libremacros.html#659">Inspect selected...........................................................................................</a>.............656<br/>
<a href="libremacros.html#660">Inspect previous.......................................................................................</a>................657<br/>
<a href="libremacros.html#660"> 18.5.4. Obtaining the debug information....................................................................</a>.657<br/>
<a href="libremacros.html#665"> 18.5.5. Getting property values...........................................................</a>........................662<br/>
<a href="libremacros.html#667"> 18.6. Conclusion.............................................................................................................</a>..664<br/>
<a href="libremacros.html#668"> 19. Sources of Information........................................................................</a>...........................665<br/>
<a href="libremacros.html#668"> 19.1. Help pages included with OpenOffice.org.....................................................</a>.........665<br/>
<a href="libremacros.html#668"> 19.2. Macros included with OpenOffice.org..............................................................</a>......665<br/>
<a href="libremacros.html#669"> 19.3. Web sites..............................................................................................</a>...................666<br/>
<a href="libremacros.html#669"> 19.3.1. Reference material...................................................................................</a>........666<br/>
<a href="libremacros.html#669"> 19.3.2. Macro examples..............................................................................................</a>.666<br/>
<a href="libremacros.html#669"> 19.3.3. Miscellaneous....................................................................................</a>..............666<br/>
<a href="libremacros.html#670"> 19.4. http://www.openoffice.org/api/ or http://api.libreoffice.org............</a>.......................667<br/>
<a href="libremacros.html#671"> 19.5. Mailing lists and newsgroups.........................................................................</a>.........668<br/>
<a href="libremacros.html#672"> 19.6. How to find answers.............................................................................................</a>...669<br/>
<a href="libremacros.html#672"> 19.7. Conclusion.............................................................................................................</a>..669<br/>
xii<br/>
<hr/>
<a name=16></a><b>&#160;1.&#160;Introduction&#160;and&#160;housekeeping<br/></b>First, there&#160;was&#160;the&#160;first&#160;edition of OpenOffice.org&#160;Macros&#160;Explained&#160;(OOME).&#160;A&#160;few&#160;years&#160;later I&#160;produced&#160;<br/>the&#160;second edition, updated to&#160;match&#160;OpenOffice.org&#160;(OOo) version 2.x, but&#160;the&#160;second edition was&#160;never&#160;<br/>released. Now,&#160;I&#160;feel&#160;that&#160;it&#160;is&#160;time&#160;for a&#160;third&#160;edition.&#160;<br/>
Most&#160;of the&#160;content&#160;from&#160;previous&#160;editions&#160;is&#160;still&#160;here.&#160;The&#160;initial&#160;chapters&#160;dealing with&#160;language&#160;syntax&#160;are<br/>mostly&#160;unchanged except&#160;for new&#160;features&#160;added to&#160;the&#160;language.&#160;<br/>
The&#160;number of services&#160;supported by&#160;OOo has&#160;more&#160;than&#160;doubled since&#160;I&#160;last&#160;published, and there&#160;is&#160;<br/>significant&#160;new&#160;capability.&#160;There&#160;is,&#160;unfortunately,&#160;more&#160;capability&#160;than I&#160;have&#160;time&#160;or room&#160;to&#160;document.&#160;<br/>Unfortunately,&#160;as&#160;extensive&#160;as&#160;this&#160;book is, much&#160;is&#160;missing.&#160;You should use&#160;this&#160;book, therefore, as&#160;a&#160;&#160;<br/>reference&#160;with numerous&#160;examples,&#160;but, always&#160;remember that&#160;OOo is&#160;constantly&#160;changing&#160;and supporting&#160;<br/>more&#160;features.&#160;<br/>
The&#160;document&#160;contains&#160;buttons&#160;that&#160;trigger the&#160;macros&#160;in&#160;the&#160;text.&#160;This&#160;is&#160;fabulous&#160;while&#160;reading the&#160;original<br/>source, but&#160;it&#160;provides&#160;for undesirable&#160;artifacts&#160;in printed form;&#160;sorry&#160;about&#160;that.&#160;<br/>
<i><b>&#160;1.1.&#160;Comments&#160;from&#160;the&#160;author<br/></b></i>I&#160;am&#160;the&#160;primary&#160;author of this&#160;document.&#160;I&#160;do not&#160;make&#160;a&#160;living working with OOo, and nothing in here&#160;is&#160;<br/>related to&#160;my&#160;primary&#160;day&#160;job.&#160;In&#160;other words, I&#160;am&#160;simply&#160;another member of the&#160;OOo community&#160;who&#160;<br/>does&#160;this&#160;without&#160;remuneration.<br/>
I&#160;receive&#160;numerous&#160;requests&#160;for help because&#160;I&#160;am&#160;highly&#160;visible&#160;in the&#160;OOo community.&#160;Unfortunately,&#160;I&#160;am<br/>over-time-committed, and it&#160;is&#160;difficult&#160;to provide&#160;personal&#160;help to&#160;all.&#160;I&#160;enjoy&#160;helping people&#160;in my&#160;non-<br/>existent&#160;spare&#160;time,&#160;but, be&#160;certain to&#160;use&#160;existing material, mailing&#160;lists,&#160;and forums&#160;if possible. I&#160;<br/>occasionally&#160;provide&#160;solutions&#160;on a&#160;commission&#160;basis, but&#160;I&#160;lack the&#160;time&#160;for large&#160;tasks.&#160;<br/>
I&#160;appreciate&#160;comments&#160;and bug reports. If&#160;you&#160;have&#160;something interesting that&#160;you think&#160;should be&#160;included,&#160;<br/>let&#160;me&#160;know.&#160;If&#160;you want&#160;to&#160;write&#160;an entire&#160;section&#160;or chapter,&#160;do so. I&#160;will&#160;likely&#160;highly&#160;edit&#160;what&#160;you&#160;<br/>produce. Please, provide&#160;feedback and suggestions&#160;by&#160;sending an email&#160;to<a href="mailto:andrew@pitonyak.org">&#160;andrew@pitonyak.org.</a><br/>
<i><b>&#160;1.2.&#160;Environment&#160;and&#160;comments<br/></b></i>My&#160;primary&#160;work is&#160;performed using 64-bit&#160;Fedora&#160;Linux&#160;with the&#160;en-US&#160;locale. Gnome&#160;is&#160;my&#160;desktop&#160;<br/>environment,&#160;which&#160;affects&#160;screen shots. Little&#160;to&#160;no testing has&#160;been done&#160;by&#160;me&#160;in other environments. I&#160;<br/>use&#160;both&#160;LibreOffice&#160;(LO) and&#160;Apache&#160;OpenOffice&#160;(AOO) and I&#160;use&#160;the&#160;term&#160;OpenOffice, OO, or OOo to&#160;<br/>generically&#160;refer to&#160;either product.&#160;<br/>
AOO&#160;and LO&#160;are&#160;changing independently,&#160;and as&#160;time&#160;passes, the&#160;APIs, features, and user interfaces&#160;become<br/>less&#160;similar.&#160;The&#160;result&#160;is&#160;a&#160;macro that&#160;works&#160;in&#160;LO&#160;may&#160;fail&#160;in&#160;AOO, and&#160;vice&#160;versa.&#160;Also, rapid&#160;<br/>development&#160; means&#160;that&#160;changes&#160;occur faster than&#160;time&#160;permits&#160;me&#160;to produce&#160;documentation;&#160;I&#160;receive&#160;no&#160;<br/>renumeration for my&#160;time&#160;spent&#160;on this&#160;document.&#160;<br/>
The&#160;best&#160;way&#160;to find out&#160;what&#160;works&#160;on your chosen platform&#160;is&#160;testing&#160;and inspection. By&#160;inspection, I&#160;<br/>mean that&#160;you&#160;should&#160;inspect&#160;object&#160;instances&#160;to&#160;determine&#160;the&#160;supported properties, methods,&#160;constants,&#160;<br/>enumerations, structures, services, and interfaces.<br/>
13<br/>
<hr/>
<a name=17></a><b>&#160;2.&#160;Getting&#160;Started<br/></b>In&#160;OpenOffice.org&#160;(OOo), macros&#160;and dialogs&#160;are&#160;stored in documents&#160;and libraries.&#160;The&#160;included integrated<br/>development&#160;environment&#160;(IDE) is&#160;used to&#160;create&#160;and debug&#160;macros&#160;and dialogs.&#160;This&#160;chapter introduces&#160;the<br/>basic&#160;concepts&#160;of starting the&#160;IDE&#160;and creating macros&#160;by&#160;showing the&#160;steps&#160;to&#160;produce&#160;a&#160;simple&#160;macro,&#160;<br/>which&#160;displays&#160;the&#160;text&#160;“Hello&#160;World”&#160;on the&#160;screen.<br/>
A&#160;macro is&#160;a&#160;saved sequence&#160;of commands&#160;or keystrokes&#160;stored for later use.&#160;An example&#160;of a&#160;simple&#160;macro&#160;<br/>is&#160;one&#160;that&#160;“types”&#160;your&#160;address. Macros&#160;support&#160;commands&#160;that&#160;allow&#160;a&#160;variety&#160;of advanced functions,&#160;such&#160;<br/>as&#160;making decisions&#160;(for example, if the&#160;balance&#160;is&#160;less&#160;than zero, color it&#160;red;&#160;if not,&#160;color it&#160;black), looping&#160;<br/>(while&#160;the&#160;balance&#160;is&#160;greater than&#160;zero, subtract&#160;10), and even interacting with a&#160;person (asking the&#160;user for a<br/>number). Some&#160;of these&#160;commands&#160;are&#160;based on the&#160;BASIC programming language. (BASIC is&#160;an acronym&#160;<br/>for Beginner’s&#160;All-purpose&#160;Symbolic&#160;Instruction Code.) It&#160;is&#160;common to&#160;assign a&#160;macro to&#160;a&#160;keystroke&#160;or&#160;<br/>toolbar icon&#160;so that&#160;it&#160;can be&#160;quickly&#160;started.<br/>
A&#160;dialog – or dialog box – is&#160;a&#160;type&#160;of window&#160;used to&#160;have&#160;a&#160;“dialog”&#160;with&#160;a&#160;user.&#160;The&#160;dialog may&#160;present&#160;<br/>information to&#160;the&#160;user,&#160;or obtain input&#160;from&#160;the&#160;user.&#160;You can create&#160;your&#160;own dialogs&#160;and store&#160;them&#160;in a&#160;<br/>module&#160;with your&#160;macros.<br/>
The&#160;OpenOffice.org&#160;macro language&#160;is&#160;very&#160;flexible, allowing automation&#160;of both simple&#160;and complex&#160;tasks.<br/>Although writing macros&#160;and learning&#160;about&#160;the&#160;inner workings&#160;of OpenOffice.org&#160;can be&#160;a&#160;lot&#160;of fun, it&#160;is&#160;<br/>not&#160;always&#160;the&#160;best&#160;approach. Macros&#160;are&#160;especially&#160;useful&#160;when you&#160;have&#160;to&#160;do a&#160;task&#160;the&#160;same&#160;way&#160;over&#160;<br/>and over again, or when you&#160;want&#160;to&#160;press&#160;a&#160;single&#160;button to&#160;do something that&#160;normally&#160;takes&#160;several&#160;steps.&#160;<br/>Once&#160;in a&#160;while,&#160;you&#160;might&#160;write&#160;a&#160;macro to&#160;do something you&#160;can’t&#160;otherwise&#160;do in&#160;OpenOffice.org, but&#160;in&#160;<br/>that&#160;case&#160;you&#160;should&#160;investigate&#160;thoroughly&#160;to&#160;be&#160;sure&#160;OOo cannot&#160;do it.&#160;For instance, a&#160;common&#160;request&#160;on&#160;<br/>some&#160;of the&#160;OpenOffice.org&#160;mailing lists&#160;is&#160;for a&#160;macro that&#160;removes&#160;empty&#160;paragraphs.&#160;This&#160;functionality&#160;is<br/>provided&#160;with&#160;AutoFormat&#160;(select&#160;<b>Tools&#160;&gt;&#160;AutoCorrect Options&#160;&gt;&#160;Options</b>&#160;tab&#160;and check&#160;<i>Remove&#160;blank&#160;<br/>paragraphs</i>). It&#160;is&#160;also possible&#160;to use&#160;regular expressions&#160;to search for and replace&#160;empty&#160;space.&#160;There&#160;is&#160;a&#160;<br/>time&#160;and a&#160;purpose&#160;for macros, and a&#160;time&#160;for other solutions.&#160;This&#160;chapter will&#160;prepare&#160;you for the&#160;times&#160;<br/>when a&#160;macro is&#160;the&#160;solution&#160;of choice.<br/>
<i><b>&#160;2.1.&#160;Macro&#160;storage<br/></b></i>In&#160;OpenOffice.org, routines&#160;that&#160;are&#160;logically&#160;related&#160;are&#160;stored in a&#160;module. For example, a&#160;module&#160;might&#160;<br/>contain&#160;routines&#160;for finding common&#160;mistakes&#160;that&#160;require&#160;editing. Logically&#160;related modules&#160;are&#160;stored in&#160;a&#160;<br/>library,&#160;and libraries&#160;are&#160;stored in&#160;library&#160;containers.&#160;The&#160;OpenOffice.org&#160;application&#160;can act&#160;as&#160;a&#160;library&#160;<br/>container,&#160;as&#160;can any&#160;OOo document. Simply&#160;stated, the&#160;OpenOffice.org&#160;application&#160;and every&#160;<br/>OpenOffice.org&#160;document&#160;can contain&#160;libraries, modules, and macros.<br/>
Container<br/>
A&#160;library&#160;container contains&#160;zero or more&#160;libraries.&#160;<br/>
Library<br/>
A&#160;library&#160;contains&#160;zero&#160;or more&#160;modules&#160;and dialogs.<br/>
Module<br/>
A&#160;module&#160;contains&#160;zero or more&#160;subroutines&#160;or functions.<br/>
<b>&#160;2.1.1.&#160;Library&#160;container<br/></b>An OOo document&#160;is&#160;a&#160;library&#160;container,&#160;as&#160;is&#160;the&#160;application itself. If&#160;a&#160;specific&#160;document&#160;requires&#160;a&#160;macro,&#160;<br/>it&#160;is&#160;useful&#160;to&#160;store&#160;that&#160;macro in&#160;the&#160;document.&#160;The&#160;advantage&#160;is&#160;that&#160;the&#160;macro stays&#160;with&#160;the&#160;document.&#160;<br/>This&#160;is&#160;also an easy&#160;way&#160;to&#160;send macros&#160;to&#160;others.<br/>
If&#160;several&#160;documents&#160;use&#160;the&#160;same&#160;macros, however,&#160;then every&#160;document&#160;will&#160;have&#160;a&#160;copy,&#160;and, if you &#160;<br/>change&#160;the&#160;macro, then&#160;you&#160;must&#160;change&#160;it&#160;in&#160;every&#160;document&#160;that&#160;contains&#160;the&#160;macro. Macros&#160;contained&#160;in&#160;<br/>
14<br/>
<hr/>
<a name=18></a>a&#160;document&#160;are&#160;visible&#160;only&#160;to&#160;that&#160;document. It&#160;is&#160;not&#160;easy,&#160;therefore, to call&#160;a&#160;macro in a&#160;document&#160;from&#160;<br/>outside&#160;of that&#160;document.<br/>
<b>TIP</b><br/>
Do not&#160;(except&#160;in rare&#160;exceptions)&#160;store&#160;macros&#160;that&#160;will&#160;be&#160;called&#160;from&#160;outside&#160;a&#160;document&#160;in&#160;a&#160;document;&#160;<br/>
because&#160;macros&#160;contained in&#160;a&#160;document&#160;are&#160;visible&#160;only&#160;to that&#160;document.<br/>
The&#160;application&#160;library&#160;container has&#160;two primary&#160;components, macros&#160;distributed with&#160;OOo, and macros&#160;<br/>that&#160;you&#160;create.&#160;The&#160;OOo macro dialog shows&#160;your macros&#160;in&#160;a&#160;container named “My&#160;Macros”, and those&#160;<br/>distributed as&#160;“OpenOffice.org&#160;Macros”&#160;(see<a href="libremacros.html#18">&#160;Figure&#160;1)</a>. OpenOffice.org&#160;Macros&#160;are&#160;stored in a&#160;directory&#160;with<br/>the&#160;application,&#160;and My&#160;Macros&#160;are&#160;stored in your&#160;user directories.<br/>
Use&#160;<b>Tools&#160;&gt;&#160;Macros&#160;&gt;&#160;Organize&#160;Macros&#160;&gt;&#160;OpenOffice.org Basic</b>&#160;to open the&#160;OOo Basic&#160;Macros&#160;dialog&#160;<br/>(see<a href="libremacros.html#18">&#160;Figure&#160;1)</a>.&#160;The&#160;library&#160;containers&#160;are&#160;the&#160;highest&#160;level&#160;objects&#160;shown in&#160;the&#160;“Macro from”&#160;area.<br/>
<i><b>Figure&#160;1.</b>&#160;Use&#160;the&#160;OOo Macros&#160;dialog&#160;to create&#160;new&#160;macros&#160;and organize&#160;libraries.</i><br/>
<b>&#160;2.1.2.&#160;Libraries<br/></b>A&#160;<i>library&#160;container</i>&#160;contains&#160;one&#160;or more&#160;libraries, and a&#160;<i>library</i>&#160;contains&#160;one&#160;or more&#160;modules&#160;and dialogs.&#160;<br/>Double-click on a&#160;library&#160;container i<a href="libremacros.html#18">n&#160;Figure&#160;1&#160;t</a>o&#160;see&#160;the&#160;contained libraries. Double-click on a&#160;library&#160;to&#160;<br/>load the&#160;library&#160;and see&#160;the&#160;contained modules&#160;and dialogs.<br/>
The&#160;OOo Macros&#160;dialog uses&#160;a&#160;different&#160;icon to&#160;distinguish loaded&#160;libraries;&#160;i<a href="libremacros.html#19">n&#160;Figure&#160;2, S</a>tandard and&#160;<br/>XrayDyn&#160;are&#160;loaded, the&#160;other libraries&#160;are&#160;not.&#160;<br/>
<b>TIP</b><br/>
The&#160;icons and colors that&#160;you see&#160;on your&#160;computer&#160;may&#160;be&#160;different&#160;than those&#160;shown&#160;in&#160;the&#160;screen shots.&#160;<br/>Different&#160;versions&#160;of&#160;OOo may&#160;use&#160;different&#160;icons&#160;and&#160;colors. and more&#160;than one&#160;icon set&#160;is supported.&#160;Use<br/>
<b>Tools &gt; Options &gt; OpenOffice.org&#160;&gt;&#160;View</b>&#160;to change&#160;the&#160;icon size&#160;and&#160;style.<br/>
15<br/>
<hr/>
<a name=19></a><i><b>Figure&#160;2.</b>&#160;Loaded libraries&#160;are&#160;shown differently.</i><br/>
<b>&#160;2.1.3.&#160;Modules&#160;and&#160;dialogs<br/></b>A&#160;module&#160;is&#160;typically&#160;used to group similar functionality&#160;at&#160;a&#160;lower level&#160;than&#160;a&#160;library.&#160;The&#160;macros&#160;are&#160;<br/>stored in the&#160;modules.&#160;To&#160;create&#160;a&#160;new&#160;module, select&#160;a&#160;library&#160;and click New.<br/>
<b>&#160;2.1.4.&#160;Key&#160;points<br/></b>Things&#160;to&#160;consider:<br/>
•<br/>
You can import&#160;libraries&#160;from&#160;one&#160;library&#160;container to&#160;another.&#160;<br/>
•<br/>
Import&#160;a&#160;module&#160;by&#160;importing the&#160;library&#160;that&#160;contains&#160;the&#160;module.&#160;It&#160;is&#160;not&#160;possible&#160;to&#160;simply&#160;import<br/>a&#160;single&#160;module&#160;using&#160;the&#160;GUI.<br/>
•<br/>
Use&#160;descriptive&#160;names&#160;for libraries, modules, and macros. Descriptive&#160;names&#160;reduce&#160;the&#160;likelihood&#160;<br/>of a&#160;name&#160;collision, which hampers&#160;library&#160;import.<br/>
•<br/>
The&#160;Standard library&#160;is&#160;special;&#160;it&#160;is&#160;automatically&#160;loaded so the&#160;contained&#160;macros&#160;are&#160;always&#160;<br/>available.<br/>
•<br/>
The&#160;Standard library&#160;is&#160;automatically&#160;created by&#160;OOo and cannot&#160;be&#160;imported.<br/>
•<br/>
Macros&#160;contained in&#160;a&#160;library&#160;are&#160;not&#160;available&#160;until&#160;after the&#160;library&#160;is&#160;loaded.<br/>
•<br/>
The&#160;Macro organizer&#160;dialog&#160;allows&#160;you&#160;to&#160;create&#160;new&#160;modules, but&#160;not&#160;new&#160;libraries.<br/>
The&#160;key&#160;points&#160;listed above&#160;have&#160;certain&#160;consequences;&#160;for example, I&#160;rarely&#160;store&#160;macros&#160;in&#160;the&#160;Standard&#160;<br/>library&#160;because&#160;I&#160;cannot&#160;import&#160;the&#160;library&#160;to&#160;another location.&#160;My&#160;usual&#160;usage&#160;for the&#160;standard library&#160;is&#160;for&#160;<br/>macros&#160;called from&#160;buttons&#160;in a&#160;document.&#160;The&#160;macros&#160;in&#160;the&#160;standard library&#160;then&#160;load the&#160;actual&#160;work&#160;<br/>macros&#160;in&#160;other libraries, and call&#160;them.<br/>
<i><b>&#160;2.2.&#160;Creating&#160;new&#160;modules&#160;and&#160;libraries<br/></b></i>The&#160;New&#160;button&#160;on the&#160;Macros&#160;dialog always&#160;creates&#160;a&#160;new&#160;subroutine&#160;in&#160;the&#160;selected library&#160;(see<a href="libremacros.html#18">&#160;Figure&#160;1&#160;<br/></a>a<a href="libremacros.html#19">nd&#160;Figure&#160;2)</a>.&#160;A&#160;new&#160;module&#160;is&#160;created if&#160;the&#160;library&#160;does&#160;not&#160;yet&#160;contain a&#160;module.&#160;<br/>
16<br/>
<hr/>
<a name=20></a>From&#160;the&#160;Macros&#160;dialog, click&#160;the&#160;Organizer button&#160;to open the&#160;OOo Macro Organizer dialog (see<a href="libremacros.html#20">&#160;Figure&#160;3).&#160;<br/></a>The&#160;Modules&#160;and Dialogs&#160;tabs&#160;are&#160;almost&#160;identical. Use&#160;the&#160;Modules&#160;or Dialogs&#160;tab&#160;to create,&#160;delete, and&#160;<br/>rename&#160;modules&#160;or dialogs.&#160;<br/>
<i><b>Figure&#160;3.</b>&#160;Modules&#160;tab&#160;of&#160;the&#160;OOo Macro&#160;Organizer&#160;dialog.</i><br/>
Use&#160;the&#160;Libraries&#160;tab (see<a href="libremacros.html#20">&#160;Figure&#160;4) t</a>o create, delete, rename, import, and export&#160;libraries.&#160;<br/>
<i><b>Figure&#160;4.</b>&#160;Libraries&#160;tab&#160;of&#160;the&#160;OOo Macro&#160;Organizer&#160;dialog.</i><br/>
The&#160;first&#160;step is&#160;to select&#160;the&#160;desired library&#160;container from&#160;the&#160;Location drop-down.&#160;To&#160;rename&#160;a&#160;library,&#160;<br/>double&#160;click on the&#160;library&#160;and then edit&#160;the&#160;name&#160;in place.<br/>
17<br/>
<hr/>
<a name=21></a><b>TIP</b><br/>
I&#160;find renaming&#160;modules and libraries in the&#160;Macro&#160;Organizer&#160;dialogs&#160;to be&#160;frustrating. For&#160;renaming&#160;<br/>
libraries,&#160;double&#160;or&#160;triple&#160;click on the&#160;library&#160;name&#160;then wait&#160;a&#160;few&#160;seconds.&#160;Try&#160;again.&#160;Try&#160;one&#160;more&#160;time.&#160;<br/>Click on&#160;another&#160;library.&#160;Double&#160;or&#160;triple&#160;click on the&#160;library&#160;name;&#160;you get&#160;the&#160;idea.&#160;<br/>The&#160;easiest&#160;method to change&#160;a&#160;module&#160;name&#160;is to right&#160;click on&#160;the&#160;module&#160;name&#160;in&#160;the&#160;tabs at&#160;the&#160;bottom&#160;<br/>of&#160;the&#160;IDE&#160;and choose&#160;rename&#160;(see<a href="libremacros.html#25">&#160;Figure&#160;11)</a>.<br/>
<i><b>&#160;2.3.&#160;Macro&#160;language<br/></b></i>The&#160;OpenOffice.org&#160;macro language&#160;is&#160;based on the&#160;BASIC&#160;programming language.&#160;The&#160;standard macro&#160;<br/>language&#160;is&#160;officially&#160;titled StarBasic,&#160;but, it&#160;is&#160;also referred to as&#160;OOo Basic, or Basic. Many&#160;different&#160;<br/>programming languages&#160;can be&#160;used to automate&#160;OOo. OOo provides&#160;easy&#160;support&#160;for macros&#160;written in&#160;<br/>Basic, JavaScript, Python, and BeanShell. In&#160;this&#160;document, my&#160;primary&#160;concern is&#160;Basic.<br/>
<i><b>&#160;2.4.&#160;Create&#160;a&#160;module&#160;in&#160;a&#160;document<br/></b></i>Each OOo document&#160;is&#160;a&#160;library&#160;container able&#160;to&#160;contain&#160;macros&#160;and dialogs.&#160;When a&#160;document&#160;contains&#160;<br/>the&#160;macros&#160;that&#160;it&#160;uses, possession&#160;of the&#160;document&#160;implies&#160;possession of the&#160;macros.&#160;This&#160;is&#160;a&#160;convenient&#160;<br/>distribution and storage&#160;method. Send the&#160;document&#160;to another person or location, and the&#160;macros&#160;are&#160;still&#160;<br/>available&#160;and usable.<br/>
1)&#160;To&#160;add a&#160;macro to&#160;any&#160;OOo document,&#160;the&#160;document&#160;must&#160;be&#160;open for editing. Start&#160;by&#160;opening&#160;a&#160;<br/>
new&#160;text&#160;document, which will&#160;be&#160;named “Untitled&#160;1”&#160;—&#160;assuming that&#160;no other untitled document&#160;<br/>is&#160;currently&#160;open.<br/>
2)&#160;Use&#160;<b>Tools&#160;&gt;&#160;Macros&#160;&gt;&#160;Organize&#160;Macros&#160;&gt;&#160;OpenOffice.org Basic</b>&#160;to&#160;open the&#160;OOo Basic&#160;Macros&#160;<br/>
dialog (see<a href="libremacros.html#18">&#160;Figure&#160;1).&#160;</a><br/>
3)&#160;Click&#160;the&#160;Organizer button to open the&#160;OOo Macro Organizer dialog, then click on the&#160;Libraries&#160;tab&#160;<br/>
(see<a href="libremacros.html#20">&#160;Figure&#160;4).</a><br/>
4)&#160;Select&#160;“Untitled 1”&#160;from&#160;the&#160;location&#160;drop-down.<br/>
<i><b>Figure&#160;5.</b>&#160;Libraries&#160;tab&#160;of&#160;the&#160;OOo Macro&#160;Organizer&#160;dialog.</i><br/>
5)&#160;Click&#160;New&#160;to&#160;open the&#160;New&#160;Library&#160;dialog.<br/>
18<br/>
<hr/>
<a name=22></a><i><b>Figure&#160;6.</b>&#160;New library&#160;dialog.</i><br/>
6)&#160;The&#160;default&#160;name&#160;is&#160;Library1, which is&#160;not&#160;very&#160;descriptive. Choose&#160;a&#160;descriptive&#160;name&#160;and click&#160;<br/>
OK.&#160;The&#160;new&#160;library&#160;is&#160;shown in&#160;the&#160;list.&#160;For&#160;this&#160;example, I&#160;named the&#160;library&#160;“HelloWorld”.<br/>
<i><b>Figure&#160;7.</b>&#160;The&#160;new library&#160;is&#160;shown in&#160;the&#160;list.</i><br/>
7)&#160;In&#160;the&#160;Modules&#160;tab, select&#160;the&#160;HelloWorld library.&#160;OOo created&#160;the&#160;module&#160;named “Module1”&#160;when&#160;<br/>
the&#160;library&#160;was&#160;created.<br/>
<b>Tip</b><br/>
Although Module1&#160;is created&#160;when the&#160;library&#160;is created, a&#160;bug&#160;in OOo&#160;3.2&#160;may&#160;prevent&#160;the&#160;module&#160;from&#160;<br/>
displaying without&#160;closing&#160;and re-opening&#160;the&#160;dialog.<br/>
19<br/>
<hr/>
<a name=23></a><i><b>Figure&#160;8.</b>&#160;The&#160;new library&#160;is&#160;shown in&#160;the&#160;list.</i><br/>
8)&#160;Click&#160;New&#160;to&#160;open the&#160;New&#160;Module&#160;dialog.&#160;The&#160;default&#160;name&#160;is&#160;Module2, because&#160;Module1&#160;already&#160;<br/>
exists.<br/>
<i><b>Figure&#160;9.</b>&#160;New&#160;module&#160;dialog.</i><br/>
9)&#160;Use&#160;a&#160;descriptive&#160;name&#160;and click OK. Module1 is&#160;finally&#160;displayed&#160;(bug in 3.2.0), as&#160;is&#160;the&#160;newly&#160;<br/>
created&#160;module.<br/>
20<br/>
<hr/>
<a name=24></a><i><b>Figure&#160;10.</b>&#160;The&#160;new module&#160;is&#160;shown&#160;in the&#160;list.</i><br/>
10)&#160;Select&#160;HelloModule&#160;and click Edit.<br/>
11)&#160;At&#160;this&#160;point, I&#160;saved the&#160;document&#160;and named it&#160;“DelMeDoc”&#160;because&#160;I&#160;intended&#160;to delete&#160;the&#160;<br/>
document&#160;when I&#160;was&#160;finished with the&#160;example.&#160;Select&#160;a&#160;name&#160;that&#160;works&#160;well&#160;for you. If&#160;you&#160;<br/>reopen the&#160;dialog shown i<a href="libremacros.html#24">n&#160;Figure&#160;10, t</a>he&#160;document&#160;name&#160;will&#160;be&#160;shown rather than&#160;“Untitled 1”.<br/>
At&#160;this&#160;point,&#160;the&#160;Integrated&#160;Debugging Environment&#160;(IDE) is&#160;opened to&#160;edit&#160;the&#160;macro.<br/>
<i><b>&#160;2.5.&#160;Integrated&#160;Debugging&#160;Environment<br/></b></i>Use&#160;the&#160;Basic&#160;Integrated&#160;Debugging Environment&#160;(IDE) to&#160;create&#160;and run macros&#160;(see<a href="libremacros.html#25">&#160;Figure&#160;11).&#160;</a>The&#160;IDE&#160;<br/>places&#160;significant&#160;functionality&#160;in&#160;a&#160;little&#160;space.&#160;The&#160;toolbar icons&#160;are&#160;described&#160;i<a href="libremacros.html#25">n&#160;Table&#160;1.&#160;</a>The&#160;top left&#160;<br/>
corner just&#160;above&#160;the&#160;editing window&#160;<br/>
&#160;contains&#160;a&#160;drop-down list&#160;that&#160;<br/>
shows&#160;the&#160;current&#160;library.&#160;The&#160;portion in&#160;the&#160;square&#160;brackets&#160;identifies&#160;the&#160;library&#160;container,&#160;and the&#160;portion&#160;<br/>following&#160;identifies&#160;the&#160;library.&#160;This&#160;provides&#160;a&#160;quick&#160;method&#160;to choose&#160;a&#160;library.<br/>
21<br/>
<hr/>
<a name=25></a><i><b>Figure&#160;11.</b>&#160;Basic&#160;Integrated Debugging Environment.</i><br/>
Rest&#160;your&#160;mouse&#160;cursor on a&#160;toolbar icon for a&#160;few&#160;seconds&#160;to&#160;read the&#160;text&#160;that&#160;appears;&#160;this&#160;provides&#160;a&#160;hint&#160;<br/>at&#160;what&#160;that&#160;icon does.&#160;<br/>
<i><b>Table&#160;1.</b>&#160;Toolbar&#160;icons&#160;in&#160;the&#160;Basic&#160;IDE.</i><br/>
<i><b>Icon</b></i><br/>
<i><b>Key</b></i><br/>
<i><b>Description</b></i><br/>
Ctrl+N<br/>
Create&#160;a&#160;new&#160;OOo document.<br/>
Ctrl+O<br/>
Open an existing&#160;OOo document.<br/>
Ctrl+S<br/>
Save&#160;the&#160;current&#160;library.&#160;If&#160;the&#160;library&#160;is in a&#160;document, then&#160;the&#160;document&#160;is&#160;saved.<br/>
Ctrl+P<br/>
Print&#160;the&#160;macro&#160;to the&#160;printer.<br/>
Ctrl+V<br/>
Paste&#160;the&#160;clipboard.<br/>
Ctrl+Z<br/>
Undo the&#160;last&#160;operation.<br/>
Ctrl+Y<br/>
Redo&#160;the&#160;last&#160;operation that&#160;was undone.<br/>
Open the&#160;Object&#160;catalog (see<a href="libremacros.html#27">&#160;Figure&#160;12)</a>.&#160;Select&#160;the&#160;macro&#160;and&#160;double-click on the&#160;macro.<br/>
Open the&#160;OOo Macros&#160;dialog&#160;(see<a href="libremacros.html#19">&#160;Figure&#160;2)</a>. Select&#160;a&#160;macro and click edit&#160;or&#160;run.&#160;This is&#160;a&#160;short-<br/>cut&#160;for&#160;<b>Tools&#160;&gt;&#160;Macros &gt;&#160;Organize&#160;Macros &gt; OpenOffice.org&#160;Basic</b>.<br/>Select&#160;a&#160;module.&#160;This opens the&#160;OOo&#160;Macro&#160;Organizer&#160;dialog with the&#160;Modules tab selected (se<a href="libremacros.html#20">e<br/>Figure&#160;3)</a>. Select&#160;a&#160;module&#160;and&#160;click Edit.<br/>
22<br/>
<hr/>
<a name=26></a><i><b>Icon</b></i><br/>
<i><b>Key</b></i><br/>
<i><b>Description</b></i><br/>
Open the&#160;OOo help, which&#160;contains numerous useful&#160;examples for&#160;Basic.<br/>
Click the&#160;Compile&#160;icon&#160;to check&#160;the&#160;macro&#160;for&#160;syntax errors.&#160;No message&#160;is&#160;displayed&#160;unless&#160;an&#160;<br/>
error&#160;is&#160;found.&#160;The&#160;Compile&#160;icon compiles only&#160;the&#160;current&#160;module.<br/>
F5<br/>
Run the&#160;first&#160;macro&#160;in&#160;the&#160;current&#160;module.&#160;While&#160;stopped&#160;(from&#160;a&#160;breakpoint, or&#160;single&#160;stepping,&#160;<br/>
this&#160;continues the&#160;execution).&#160;To&#160;run a&#160;specific&#160;macro, use&#160;<br/>
&#160;to open the&#160;OOo&#160;Basic&#160;Macros&#160;<br/>
dialog, select&#160;the&#160;desired&#160;macro,&#160;and&#160;click Run.<br/>
Shift+F5<br/>
Stop&#160;the&#160;currently&#160;running&#160;macro.<br/>
Shift+F8<br/>
Step&#160;over&#160;the&#160;current&#160;statement.&#160;When&#160;a&#160;macro&#160;stops at&#160;a&#160;breakpoint, this&#160;executes&#160;the&#160;current&#160;<br/>
statement. Can&#160;also&#160;be&#160;used to start&#160;a&#160;macro running&#160;in single&#160;step mode.<br/>
F8<br/>
Step&#160;into.&#160;This&#160;is the&#160;same&#160;as Step&#160;over&#160;except&#160;if&#160;the&#160;current&#160;statement&#160;calls another&#160;macro,&#160;it&#160;<br/>
single&#160;steps into that&#160;macro&#160;so that&#160;you&#160;can watch that&#160;macro&#160;execute.<br/>Step&#160;out&#160;runs the&#160;macro&#160;to the&#160;end&#160;of&#160;the&#160;current&#160;subroutine&#160;or&#160;function.<br/>
Shift+F9<br/>
Toggles a&#160;breakpoint&#160;on&#160;/&#160;off&#160;at&#160;the&#160;current&#160;cursor&#160;position in the&#160;IDE.&#160;An&#160;icon (<br/>
)&#160;is&#160;displayed&#160;to<br/>
the&#160;left&#160;of&#160;the&#160;line&#160;to show&#160;that&#160;a&#160;breakpoint&#160;is&#160;set&#160;for&#160;that&#160;line.&#160;You can also double-click&#160;in&#160;the&#160;<br/>breakpoint&#160;area&#160;to toggle&#160;a&#160;breakpoint&#160;on /&#160;off.<br/>Open the&#160;manage&#160;breakpoints dialog (see<a href="libremacros.html#31">&#160;Figure&#160;17)</a>,&#160;which allows&#160;you to selectively&#160;turn&#160;<br/>breakpoints on or&#160;off, and also,&#160;to prevent&#160;a&#160;breakpoint&#160;from&#160;triggering&#160;until&#160;it&#160;has been reached&#160;a&#160;<br/>
certain&#160;number&#160;of&#160;times.<br/>
F7<br/>
Select&#160;a&#160;variable&#160;and&#160;click the&#160;Watch icon to add&#160;the&#160;variable&#160;to the&#160;watch window.&#160;You can also&#160;<br/>
enter&#160;the&#160;variable&#160;name&#160;into&#160;the&#160;Watch input&#160;line&#160;and press&#160;enter.<br/>Find parentheses.<br/>
Insert&#160;Basic&#160;source. Open a&#160;dialog to select&#160;a&#160;previously&#160;saved&#160;basic&#160;file&#160;and insert&#160;it.<br/>
Save&#160;the&#160;current&#160;module&#160;as a&#160;text&#160;file&#160;on&#160;disk.&#160;OOo stores modules on disk in a&#160;special&#160;encoded&#160;<br/>
format.&#160;Files saved&#160;using&#160;this method&#160;are&#160;standard&#160;text&#160;files.&#160;This is&#160;an excellent&#160;way&#160;to create&#160;a&#160;<br/>backup of&#160;a&#160;macro&#160;or&#160;to create&#160;a&#160;text&#160;file&#160;that&#160;can be&#160;easily&#160;sent&#160;to&#160;another&#160;person.&#160;This is different&#160;<br/>
from&#160;the&#160;Disk icon, which&#160;is&#160;used to save&#160;the&#160;entire&#160;library&#160;or&#160;document&#160;that&#160;contains the&#160;module.<br/>Import&#160;a&#160;dialog from&#160;another&#160;module.<br/>
Module&#160;names&#160;are&#160;listed&#160;along the&#160;bottom&#160;of the&#160;IDE. Module&#160;navigation buttons&#160;<br/>
&#160;are&#160;to the&#160;left&#160;of&#160;<br/>
the&#160;module&#160;names.&#160;The&#160;buttons&#160;display&#160;the&#160;first,&#160;previous, next,&#160;and last&#160;module&#160;in the&#160;current&#160;library.&#160;Right&#160;<br/>click&#160;on a&#160;module&#160;name&#160;to:<br/>
•<br/>
Insert&#160;a&#160;new&#160;module&#160;or dialog.<br/>
•<br/>
Delete&#160;a&#160;module&#160;or dialog.<br/>
•<br/>
Rename&#160;a&#160;module;&#160;this&#160;is&#160;the&#160;easiest&#160;way&#160;that&#160;I&#160;know&#160;to rename&#160;a&#160;module&#160;or dialog.&#160;<br/>
•<br/>
Hide&#160;a&#160;module&#160;or dialog.<br/>
•<br/>
Open the&#160;OOo Basic&#160;Organization dialog.<br/>
Use&#160;<br/>
&#160;to open the&#160;Objects&#160;catalog (see<a href="libremacros.html#27">&#160;Figure&#160;12)</a>, select&#160;a&#160;macro and double-click on the&#160;macro to&#160;edit&#160;<br/>
that&#160;macro.<br/>
23<br/>
<hr/>
<a name=27></a><i><b>Figure&#160;12.</b>&#160;Objects&#160;catalog.</i><br/>
<i><b>&#160;2.6.&#160;Enter&#160;the&#160;macro<br/></b></i>Change&#160;the&#160;text&#160;in&#160;the&#160;IDE&#160;to&#160;read as&#160;shown i<a href="libremacros.html#27">n&#160;Listing&#160;1. C</a>lick&#160;the&#160;run icon.<br/>
<i><b>Listing&#160;1.</b>&#160;Hello World macro<br/></i>REM &#160;***** &#160;BASIC &#160;*****<br/>Option&#160;Explicit<br/>
Sub&#160;Main<br/>&#160;&#160;Print&#160;&#34;Hello World&#34;<br/>End&#160;Sub<br/>
<i><b>Table&#160;2.</b>&#160;Line&#160;by&#160;line&#160;description&#160;of<a href="libremacros.html#27">&#160;Listing 1.</a></i><br/>
<i><b>Line</b></i><br/>
<i><b>Description</b></i><br/>
REM &#160;***** &#160;BASIC &#160;*****<br/>
Basic&#160;comment,&#160;this&#160;line&#160;is ignored.&#160;A&#160;comment&#160;may&#160;also begin with&#160;a&#160;single&#160;quote&#160;<br/>character.<br/>
Option&#160;Explicit<br/>
Tells the&#160;basic&#160;interpreter&#160;that&#160;it&#160;is an error&#160;to use&#160;a&#160;variable&#160;that&#160;is not&#160;explicitly&#160;<br/>defined.&#160;Misspelled&#160;variables are&#160;likely&#160;to be&#160;caught&#160;as an error&#160;at&#160;compile&#160;time.<br/>
Sub&#160;Main<br/>
Indicates that&#160;this is the&#160;beginning&#160;of&#160;the&#160;definition of&#160;a&#160;subroutine&#160;named&#160;Main.<br/>
&#160;&#160;Print&#160;&#34;Hello World&#34;<br/>
The&#160;Print&#160;command.<br/>
End&#160;Sub<br/>
End&#160;the&#160;Main subroutine.<br/>
The&#160;macro i<a href="libremacros.html#27">n&#160;Listing&#160;1&#160;i</a>s&#160;text&#160;that&#160;a&#160;human can read.&#160;The&#160;computer must&#160;translate&#160;macro text&#160;into&#160;something<br/>that&#160;the&#160;computer can use.&#160;The&#160;process&#160;of converting the&#160;human&#160;readable&#160;macro into something&#160;that&#160;the&#160;<br/>computer can read is&#160;called compiling. In&#160;other words, a&#160;macro is&#160;written&#160;as&#160;lines&#160;of text&#160;that&#160;are&#160;compiled to<br/>prepare&#160;a&#160;runnable&#160;program.<br/>
24<br/>
<hr/>
<a name=28></a><i><b>&#160;2.7.&#160;Run&#160;a&#160;macro<br/></b></i>The&#160;Run icon&#160;always&#160;runs&#160;the&#160;first&#160;macro in&#160;the&#160;current&#160;module.&#160;As&#160;a&#160;result,&#160;a&#160;different&#160;approach is&#160;required&#160;<br/>if more&#160;than one&#160;macro is&#160;in&#160;a&#160;module.&#160;The&#160;following options&#160;can be&#160;used:<br/>
•<br/>
Place the macro first in the module, and click the Run icon. <br/>
•<br/>
Use the first macro to call the desired macro. I like this method during development. I keep a main <br/>
macro as the first thing that does nothing. During development, I change the main macro to call the <br/>
macro of interest. For general use, I let the main macro at the top call the most frequently run macro.<br/>
•<br/>
Use the Macro dialog (see<a href="libremacros.html#19"> Figure 2)</a> to run any routine in the module.<br/>
•<br/>
Add a button to your a document or toolbar that calls the macro. <br/>
•<br/>
Assign the macro to a keystroke. Use <b>Tools&#160;&gt;&#160;Customize</b> to open the Customize dialog. Select the <br/>
Keyboard tab. Macro libraries are at the bottom of the Category list. This is also available with <b>Tools<br/>&gt;&#160;Macros&#160;&gt;&#160;Organize&#160;Macros&#160;&gt;&#160;OpenOffice.org Basic</b>, select the macro, and click the Assign <br/>
button to launch the Customize dialog. Various tabs in this dialog allow you to assign the macro to <br/>
execute as a menu item, from a toolbar icon, or a system event.<br/>
To&#160;use&#160;the&#160;Macro dialog to&#160;run any&#160;subroutine&#160;in&#160;a&#160;module, follow&#160;these&#160;steps:<br/>
1.&#160;Select <b>Tools&#160;&gt;&#160;Macros&#160;&gt;&#160;Organize&#160;Macros&#160;&gt;&#160;OpenOffice.org Basic</b> to open the Macro dialog (se<a href="libremacros.html#19">e</a><br/>
<a href="libremacros.html#19">Figure 2)</a>.<br/>
2.&#160;Find the document that contains the module in the “Macro from” list.<br/>3.&#160;Double­click a library to toggle the display of the contained modules. <br/>4.&#160;Select the module to display the contained subroutines and functions in the “Existing macros in: <br/>
&lt;selected module name&gt;” list.<br/>
5.&#160;Select the desired subroutine or function to run — for example, HelloWorld.<br/>6.&#160;Click the Run button to run the subroutine or function.<br/>
<i><b>&#160;2.8.&#160;Macro&#160;security<br/></b></i>Depending on how&#160;OOo is&#160;configured, you&#160;may&#160;not&#160;be&#160;able&#160;to run macros&#160;in a&#160;document.&#160;When I&#160;open a&#160;<br/>document&#160;containing a&#160;macro, the&#160;warning in<a href="libremacros.html#29">&#160;Figure&#160;13&#160;i</a>s&#160;displayed. If&#160;you&#160;do not&#160;expect&#160;a&#160;macro or do not&#160;<br/>trust&#160;the&#160;source, then choose&#160;to disable&#160;macros. Remember,&#160;I&#160;am&#160;able&#160;to&#160;write&#160;a&#160;macro that&#160;destroys&#160;your&#160;<br/>computer.<br/>
25<br/>
<hr/>
<a name=29></a><i><b>Figure&#160;13.</b>&#160;The&#160;opened document&#160;contains&#160;a macro.</i><br/>
Use&#160;<b>Tools&#160;&gt;&#160;Options&#160;&gt;&#160;OpenOffice.org &gt;&#160;Security</b>&#160;to open the&#160;Security&#160;tab of the&#160;Options&#160;dialog.<br/>
<i><b>Figure&#160;14.</b>&#160;Options&#160;dialog, security&#160;tab.</i><br/>
Click the&#160;Macro Security&#160;button&#160;to open the&#160;Macro Security&#160;dialog. Choose&#160;a&#160;level&#160;that&#160;fits&#160;your comfort&#160;<br/>level.&#160;Medium&#160;security&#160;uses&#160;the&#160;confirmation&#160;dialog i<a href="libremacros.html#29">n&#160;Figure&#160;13, w</a>hich is&#160;relatively&#160;quick&#160;and unobtrusive.<br/>
26<br/>
<hr/>
<a name=30></a><i><b>Figure&#160;15.</b>&#160;Macro&#160;Security&#160;dialog, Security&#160;Level&#160;tab.</i><br/>
You can set&#160;trusted locations&#160;and certificates&#160;that&#160;allow&#160;documents&#160;to load&#160;without&#160;confirmation based on&#160;<br/>either where&#160;they&#160;are&#160;stored, or the&#160;certificate&#160;used to sign a&#160;document.<br/>
<i><b>Figure&#160;16.</b>&#160;Macro&#160;Security&#160;dialog,&#160;Trusted&#160;Sources&#160;tab.</i><br/>
27<br/>
<hr/>
<a name=31></a><i><b>&#160;2.9.&#160;Using&#160;breakpoints<br/></b></i>If&#160;you&#160;set&#160;a&#160;breakpoint&#160;in&#160;the&#160;code, the&#160;macro stops&#160;running&#160;at&#160;that&#160;point.&#160;You can then&#160;inspect&#160;variables,&#160;<br/>continue&#160;running the&#160;macro, or single-step the&#160;macro. If&#160;a&#160;macro fails&#160;and you&#160;don’t&#160;know&#160;why,&#160;single-<br/>stepping&#160;(running one&#160;statement&#160;at&#160;a&#160;time) allows&#160;you&#160;to&#160;watch&#160;a&#160;macro in&#160;action.&#160;When the&#160;macro fails,&#160;<br/>you’ll&#160;know&#160;how&#160;it&#160;got&#160;there. If&#160;a&#160;large&#160;number of statements&#160;run before&#160;the&#160;problem&#160;occurs, it&#160;may&#160;not&#160;be&#160;<br/>feasible&#160;to run one&#160;statement&#160;at&#160;a&#160;time, so you&#160;can set&#160;a&#160;breakpoint&#160;at&#160;or near the&#160;line&#160;that&#160;causes&#160;the&#160;<br/>problem.&#160;The&#160;program&#160;stops&#160;running at&#160;that&#160;point, and you&#160;can single-step the&#160;macro and watch the&#160;behavior.<br/>
The&#160;breakpoint&#160;On/Off&#160;icon&#160;sets&#160;a&#160;breakpoint&#160;at&#160;the&#160;statement&#160;containing the&#160;cursor.&#160;A&#160;red stop sign marks&#160;<br/>the&#160;line&#160;in&#160;the&#160;breakpoint&#160;column.&#160;Double-click&#160;in the&#160;breakpoint&#160;column to&#160;toggle&#160;a&#160;breakpoint&#160;at&#160;that&#160;<br/>statement. Right-click a&#160;breakpoint&#160;in&#160;the&#160;Break-point&#160;column&#160;to activate&#160;or deactivate&#160;it.<br/>
Use&#160;the&#160;Manage&#160;Breakpoints&#160;icon&#160;<br/>
&#160;to&#160;load the&#160;Manage&#160;Breakpoints&#160;dialog.&#160;All&#160;of the&#160;active&#160;breakpoints&#160;<br/>
in the&#160;current&#160;module&#160;are&#160;listed&#160;by&#160;line&#160;number.&#160;To&#160;add a&#160;breakpoint, enter a&#160;line&#160;number in the&#160;entry&#160;field&#160;<br/>and click New.&#160;To&#160;delete&#160;a&#160;breakpoint,&#160;select&#160;a&#160;breakpoint&#160;in&#160;the&#160;list&#160;and click&#160;the&#160;Delete&#160;button. Clear the&#160;<br/>Active&#160;check box&#160;to disable&#160;the&#160;highlighted breakpoint&#160;without&#160;deleting it.&#160;The&#160;Pass&#160;Count&#160;input&#160;box&#160;<br/>indicates&#160;the&#160;number of times&#160;a&#160;breakpoint&#160;must&#160;be&#160;reached before&#160;it&#160;is&#160;considered active. If&#160;the&#160;pass&#160;count&#160;is<br/>four (4), then&#160;the&#160;fourth&#160;time&#160;that&#160;the&#160;statement&#160;containing the&#160;breakpoint&#160;is&#160;to be&#160;run, it&#160;will&#160;stop&#160;rather than<br/>run.&#160;This&#160;is&#160;extremely&#160;useful&#160;when a&#160;portion&#160;of the&#160;macro does&#160;not&#160;fail&#160;until&#160;it&#160;has&#160;been called multiple&#160;<br/>times.<br/>
<i><b>Figure&#160;17.</b>&#160;Manage&#160;Breakpoints&#160;dialog.</i><br/>
There&#160;are&#160;two things&#160;that&#160;cause&#160;a&#160;breakpoint&#160;to be&#160;ignored:&#160;a&#160;pass&#160;count&#160;that&#160;is&#160;not&#160;zero, and explicitly&#160;<br/>marking the&#160;breakpoint&#160;as&#160;“not&#160;active”&#160;in&#160;the&#160;Manage&#160;breakpoints&#160;dialog. Every&#160;breakpoint&#160;has&#160;a&#160;pass&#160;count&#160;<br/>that&#160;is&#160;decremented toward zero when it&#160;is&#160;reached. If&#160;the&#160;result&#160;of decrementing is&#160;zero, the&#160;breakpoint&#160;<br/>becomes&#160;active&#160;and stays&#160;active&#160;because&#160;the&#160;pass&#160;count&#160;stays&#160;at&#160;zero thereafter.&#160;The&#160;pass&#160;count&#160;is&#160;not&#160;<br/>restored to&#160;its&#160;original&#160;value&#160;when the&#160;macro is&#160;finished or restarted.<br/>
<i><b>&#160;2.10.&#160;How&#160;libraries&#160;are&#160;stored<br/></b></i>Macro libraries&#160;are&#160;stored as&#160;XML&#160;files&#160;that&#160;are&#160;easily&#160;editable&#160;using any&#160;text&#160;editor.&#160;In&#160;other words, it&#160;is&#160;<br/>easy&#160;for you&#160;to&#160;poke&#160;around and damage&#160;your files.&#160;This&#160;is&#160;advanced material&#160;that&#160;you may&#160;want&#160;to&#160;ignore. If<br/>you&#160;do not&#160;understand XML&#160;and why&#160;the&#160;file&#160;contains&#160;&amp;gt;&#160;rather than &gt;, perhaps&#160;you should&#160;not&#160;edit&#160;the&#160;<br/>files.&#160;Although manually&#160;editing your external&#160;libraries&#160;is&#160;generally&#160;considered foolish, I&#160;have&#160;had at&#160;least&#160;<br/>one&#160;instance&#160;where&#160;this&#160;was&#160;required, because&#160;OOo was&#160;unable&#160;to&#160;load a&#160;module&#160;that&#160;contained a&#160;syntax&#160;<br/>error.<br/>
28<br/>
<hr/>
<a name=32></a>Each library&#160;is&#160;stored in&#160;a&#160;single&#160;directory,&#160;and each module&#160;and dialog&#160;is&#160;contained in&#160;a&#160;single&#160;file.&#160;The&#160;<br/>global&#160;libraries&#160;that&#160;are&#160;included with&#160;OpenOffice.org&#160;are&#160;stored in&#160;a&#160;shared basic&#160;directory&#160;under the&#160;<br/>directory&#160;in&#160;which&#160;OOo is&#160;installed.&#160;Examples:<br/>
C:\Program Files\OpenOffice3.2\share\basic &#160; 'A Windows installation<br/>/opt/openoffice.org/basis3.2/share/basic &#160; &#160; 'A Linux installation<br/>
OpenOffice.org&#160;stores&#160;user-specific&#160;data&#160;in a&#160;directory&#160;under the&#160;user’s&#160;home&#160;directory.&#160;The&#160;location&#160;is&#160;<br/>operating system&#160;specific. Use&#160;<b>Tools&#160;&gt;&#160;Options&#160;&gt;&#160;OpenOffice.org &gt;&#160;Paths</b>&#160;to&#160;view&#160;where&#160;other&#160;<br/>configuration data&#160;is&#160;stored. Here&#160;are&#160;some&#160;examples&#160;where&#160;my&#160;basic&#160;macros&#160;are&#160;stored:<br/>
C:\Documents and Settings\andy\Application Data\OpenOffice.org\3\user\basic &#160;'Windows XP<br/>C:\Users\pitonyaka\AppData\Roaming\OpenOffice.org\3\user\basic<br/>
&#160; &#160; &#160; &#160; &#160; 'Windows 7<br/>
/home/andy/OpenOffice.org/3/user/basic &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'Linux<br/>
User macros&#160;are&#160;stored in&#160;OpenOffice.org\3\user\basic. Each library&#160;is&#160;stored in its&#160;own directory&#160;off&#160;the&#160;<br/>basic&#160;directory.&#160;The&#160;user directory&#160;contains&#160;two files&#160;and one&#160;directory&#160;for each library&#160;(see<a href="libremacros.html#32">&#160;Table&#160;3).</a><br/>
<i><b>Table&#160;3.</b>&#160;Files&#160;and some&#160;directories&#160;in&#160;my&#160;user/basic&#160;directory.</i><br/>
<i><b>Entry</b></i><br/>
<i><b>Description</b></i><br/>
dialog.xlc<br/>
XML&#160;file&#160;that&#160;references&#160;every&#160;dialog file&#160;known&#160;to this&#160;user&#160;in OpenOffice.org.<br/>
script.xlc<br/>
XML&#160;file&#160;that&#160;references&#160;every&#160;library&#160;file&#160;known to this user&#160;in OpenOffice.org.<br/>
Standard<br/>
Directory&#160;containing&#160;the&#160;Standard library.<br/>
Pitonyak<br/>
Directory&#160;containing&#160;a&#160;the&#160;library&#160;named Pitonyak.<br/>
PitonyakDialogs<br/>
Directory&#160;containing&#160;the&#160;library&#160;named&#160;PitonyakDialogs.<br/>
The&#160;files&#160;dialog.xlc&#160;and script.xlc&#160;contain a&#160;reference&#160;to all&#160;of the&#160;dialogs&#160;and libraries&#160;known to OOo. If&#160;<br/>these&#160;two files&#160;are&#160;overwritten, OOo will&#160;not&#160;know&#160;about&#160;your personal&#160;libraries&#160;even if&#160;they&#160;exist.&#160;You can,&#160;<br/>however,&#160;either manually&#160;edit&#160;the&#160;files,&#160;or,&#160;even easier,&#160;use&#160;the&#160;OOo Macro Organizer&#160;dialog&#160;to&#160;import&#160;the&#160;<br/>libraries&#160;(because&#160;you&#160;can import&#160;a&#160;library&#160;based on the&#160;directory).<br/>
The&#160;directory&#160;containing&#160;a&#160;library&#160;contains&#160;a&#160;single&#160;file&#160;for each module&#160;and dialog in the&#160;library.&#160;The&#160;<br/>directory&#160;also contains&#160;the&#160;files&#160;dialog.xlb and script.xlb, which references&#160;the&#160;modules.&#160;<br/>
<i><b>&#160;2.11.&#160;How&#160;documents&#160;are&#160;stored<br/></b></i>The&#160;standard OOo formats&#160;use&#160;a&#160;standard ZIP&#160;file&#160;to&#160;store&#160;all&#160;of the&#160;components.&#160;Any&#160;program&#160;that&#160;can view&#160;<br/>and extract&#160;ZIP&#160;files&#160;can be&#160;used to&#160;inspect&#160;an OOo document&#160;—&#160;however,&#160;some&#160;programs&#160;will&#160;require&#160;you&#160;<br/>to change&#160;the&#160;file&#160;extension to&#160;end with ZIP.<br/>
After unzipping an OOo document, you will&#160;find files&#160;that&#160;contain the&#160;primary&#160;content,&#160;styles, and settings.&#160;<br/>The&#160;extracted document&#160;also contains&#160;three&#160;directories.&#160;The&#160;META-INF&#160;directory&#160;references&#160;all&#160;of the&#160;other&#160;<br/>files, embedded pictures, code&#160;libraries, and dialogs.&#160;The&#160;Dialogs&#160;directory&#160;contains&#160;all&#160;of the&#160;embedded&#160;<br/>dialogs, and the&#160;Basic&#160;directory&#160;contains&#160;all&#160;of the&#160;embedded libraries.&#160;<br/>
The&#160;point&#160;to&#160;all&#160;this&#160;is&#160;that&#160;in&#160;an emergency,&#160;you can manually&#160;inspect&#160;a&#160;document’s&#160;XML&#160;and potentially&#160;fix<br/>problems.&#160;<br/>
29<br/>
<hr/>
<a name=33></a><i><b>&#160;2.12.&#160;Conclusion<br/></b></i>Macros&#160;and dialogs&#160;are&#160;stored in&#160;modules, modules&#160;are&#160;stored in&#160;libraries, and libraries&#160;are&#160;stored in&#160;library&#160;<br/>containers.&#160;The&#160;application is&#160;a&#160;library&#160;container,&#160;as&#160;is&#160;every&#160;document.&#160;The&#160;IDE&#160;is&#160;used to&#160;create&#160;and debug&#160;<br/>macros&#160;and dialogs.<br/>
You have&#160;just&#160;completed one&#160;of the&#160;most&#160;difficult&#160;steps&#160;in writing macros&#160;for OpenOffice.org:&#160;writing your&#160;<br/>first&#160;macro!&#160;You are&#160;now&#160;ready&#160;to&#160;explore,&#160;try&#160;other macro examples,&#160;and create&#160;a&#160;few&#160;of your&#160;own.&#160;<br/>
30<br/>
<hr/>
<a name=34></a><b>&#160;3.&#160;Language&#160;Constructs<br/></b>The&#160;OpenOffice.org&#160;macro language&#160;is&#160;similar to the&#160;one&#160;in Microsoft&#160;Office&#160;because&#160;they&#160;are&#160;both&#160;based on<br/>BASIC. Both macro languages&#160;access&#160;the&#160;underlying&#160;implementation&#160;structures, which differ significantly&#160;<br/>and are&#160;therefore&#160;incompatible.&#160;This&#160;chapter emphasizes&#160;the&#160;portions&#160;of the&#160;language&#160;that&#160;do not&#160;access&#160;the&#160;<br/>underlying implementation.<br/>
This&#160;chapter shows&#160;how&#160;to&#160;assemble&#160;different&#160;components&#160;to&#160;produce&#160;an OOo macro that&#160;will&#160;compile&#160;and&#160;<br/>run. In&#160;a&#160;word:&#160;syntax.&#160;Correct&#160;syntax does&#160;not&#160;imply&#160;that&#160;the&#160;macro does&#160;what&#160;you want,&#160;only&#160;that&#160;the&#160;<br/>pieces&#160;are&#160;put&#160;together in a&#160;correct&#160;way.&#160;The&#160;phrases&#160;“Can I&#160;drive?”&#160;and “May&#160;I&#160;drive?”&#160;are&#160;both&#160;<br/>syntactically&#160;correct.&#160;The&#160;first&#160;phrase&#160;is&#160;about&#160;ability,&#160;and the&#160;second phrase&#160;is&#160;about&#160;permission.&#160;In&#160;speech,&#160;<br/>these&#160;two questions&#160;may&#160;be&#160;understood&#160;to have&#160;the&#160;same&#160;meaning.&#160;The&#160;computer,&#160;on the&#160;other hand, does&#160;<br/>exactly&#160;what&#160;you&#160;ask, rather than&#160;what&#160;you mean.<br/>
The&#160;primary&#160;components&#160;that&#160;syntactically&#160;constitute&#160;an OpenOffice.org&#160;macro are&#160;statements, variables, &#160;<br/>subroutines, and functions, and flow-control&#160;constructs.&#160;A&#160;statement&#160;is&#160;a&#160;small,&#160;runnable&#160;portion&#160;of code&#160;that<br/>is&#160;usually&#160;written as&#160;a&#160;single&#160;line&#160;of text.&#160;Variables&#160;are&#160;containers&#160;that&#160;hold values&#160;that&#160;can change&#160;during&#160;<br/>macro execution. Subroutines&#160;and functions&#160;separate&#160;a&#160;macro into functional&#160;named groups&#160;of statements,&#160;<br/>allowing for better organization.&#160;Flow&#160;control&#160;directs&#160;which statements&#160;run and how&#160;many&#160;times.<br/>
OOo runs&#160;one&#160;line&#160;of a&#160;macro at&#160;a&#160;time.&#160;Each line&#160;of a&#160;macro is&#160;delimited&#160;exactly&#160;the&#160;way&#160;it&#160;sounds;&#160;by&#160;a&#160;<br/>new&#160;line&#160;(see<a href="libremacros.html#34">&#160;Listing 2)</a>.<br/>
<i><b>Listing&#160;2.</b>&#160;Two&#160;line&#160;macro<br/></i>Print&#160;&#34;This is line one&#34;<br/>Print&#160;&#34;This is line two&#34;<br/>
Lines&#160;that&#160;are&#160;too&#160;long may&#160;use&#160;more&#160;than&#160;one&#160;line&#160;by&#160;appending an underscore&#160;(_) to&#160;the&#160;end of the&#160;line&#160;(see<br/><a href="libremacros.html#34">Listing 3)</a>.&#160;The&#160;underscore&#160;must&#160;be&#160;the&#160;last&#160;character on the&#160;line&#160;for it&#160;to&#160;act&#160;as&#160;a&#160;line-continuation&#160;character.&#160;<br/>The&#160;underscore&#160;has&#160;no special&#160;meaning when it&#160;isn’t&#160;the&#160;last&#160;character of a&#160;line,&#160;allowing it&#160;to be&#160;used inside&#160;<br/>strings&#160;and in variable&#160;names.&#160;When used as&#160;a&#160;continuation&#160;character,&#160;spaces&#160;may&#160;precede&#160;the&#160;underscore&#160;<br/>and are&#160;in some&#160;cases&#160;required to&#160;separate&#160;the&#160;underscore&#160;from&#160;what&#160;precedes&#160;it.&#160;For example, splitting the&#160;<br/>line&#160;“a+b+c”&#160;after the&#160;b requires&#160;a&#160;space&#160;between the&#160;b and the&#160;underscore, or the&#160;underscore&#160;is&#160;considered&#160;<br/>part&#160;of the&#160;variable&#160;name. Spaces&#160;that&#160;inadvertently&#160;follow&#160;a&#160;continuation character may&#160;cause&#160;a&#160;compile-<br/>time&#160;error.&#160;Unfortunately,&#160;the&#160;error does&#160;not&#160;state&#160;that&#160;something follows&#160;the&#160;underscore, but&#160;that&#160;the&#160;next&#160;<br/>line&#160;is&#160;invalid.<br/>
<i><b>Listing&#160;3.</b>&#160;Append an underscore&#160;to&#160;the&#160;end of&#160;a line&#160;to continue&#160;on the&#160;next&#160;line.</i><br/>
Print&#160;&#34;Strings are concatenated together &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;with the ampersand character&#34;<br/>
<b>TIP</b><br/>
When&#160;anything&#160;follows a&#160;line-continuation&#160;character,&#160;the&#160;next&#160;line&#160;is&#160;not&#160;taken as its&#160;continuation.&#160;<br/>
Sometimes, when I&#160;copy&#160;code&#160;listings from&#160;web&#160;sites and paste&#160;them&#160;into the&#160;IDE,&#160;an extra&#160;space&#160;is added&#160;<br/>at&#160;the&#160;end&#160;of&#160;a&#160;line, which&#160;breaks line&#160;continuation.<br/>
You can place&#160;multiple&#160;statements&#160;on a&#160;single&#160;line&#160;by&#160;separating them&#160;with colons.&#160;This&#160;is&#160;usually&#160;done&#160;for&#160;<br/>improved code&#160;readability.&#160;Each of the&#160;combined statements&#160;act&#160;as&#160;a&#160;single&#160;line&#160;of code&#160;while&#160;debugging&#160;the&#160;<br/>macro in the&#160;Integrated&#160;Development&#160;Environment&#160;(IDE<a href="libremacros.html#34">).&#160;Listing 4, t</a>herefore, acts&#160;like&#160;three&#160;separate&#160;<br/>statements&#160;while&#160;using the&#160;IDE&#160;to&#160;single-step through the&#160;macro.<br/>
<i><b>Listing&#160;4.</b>&#160;Set&#160;the&#160;variables&#160;x, y,&#160;and z&#160;to&#160;zero.<br/></i>x&#160;=&#160;0&#160;:&#160;y&#160;=&#160;0&#160;:&#160;z&#160;=&#160;0<br/>
31<br/>
<hr/>
<a name=35></a>You should&#160;liberally&#160;add remarks, which are&#160;also called comments,&#160;to all&#160;of the&#160;macros&#160;that&#160;you&#160;write.&#160;While<br/>writing&#160;a&#160;macro, remember that&#160;what&#160;is&#160;clear today&#160;may&#160;not&#160;be&#160;clear tomorrow,&#160;as&#160;time&#160;passes&#160;and new&#160;<br/>projects&#160;arise&#160;and memory&#160;fades&#160;all&#160;too&#160;quickly.&#160;You can start&#160;a&#160;comment&#160;with&#160;either the&#160;single&#160;quotation&#160;<br/>character,&#160;or the&#160;keyword REM.&#160;All&#160;text&#160;on the&#160;same&#160;line&#160;following a&#160;comment&#160;indicator is&#160;ignored.&#160;<br/>Comments&#160;are&#160;not&#160;considered runnable&#160;statements;&#160;they&#160;are&#160;ignored while&#160;single-stepping a&#160;macro.<br/>
<i><b>Listing&#160;5.</b>&#160;Add comments&#160;to&#160;all&#160;of&#160;the&#160;macros&#160;that&#160;you write.<br/></i>REM Comments may start with the keyword REM.<br/>ReM It is not case-sensitive so this is also a comment.<br/>' All text following the start of the comment is ignored<br/>X&#160;=&#160;0&#160;' A comment may also start with a<br/>&#160; &#160; &#160;&#160;' single quote<br/>z&#160;=&#160;0&#160;REM All text following the start of the comment is ignored<br/>
<b>TIP</b><br/>
Keywords, variables, and&#160;routine&#160;names in OOo&#160;Basic&#160;are&#160;not&#160;case-sensitive.&#160;<br/>Therefore,&#160;REM, Rem, and&#160;rEm&#160;all&#160;start&#160;a&#160;comment.<br/>
Nothing can follow&#160;a&#160;line-continuation character,&#160;and this&#160;includes&#160;comments.&#160;All&#160;text&#160;following a&#160;comment&#160;<br/>indicator is&#160;ignored&#160;—&#160;even the&#160;continuation&#160;character.&#160;The&#160;logical&#160;result&#160;from&#160;these&#160;two rules&#160;is&#160;that&#160;a&#160;line-<br/>continuation&#160;character can never occur on the&#160;same&#160;line&#160;as&#160;a&#160;comment.<br/>
<i><b>&#160;3.1.&#160;Compatibility&#160;with&#160;Visual&#160;Basic<br/></b></i>With respect&#160;to syntax&#160;and BASIC&#160;functionality,&#160;OOo Basic&#160;is&#160;very&#160;similar to&#160;Visual&#160;Basic.&#160;The&#160;two Basic&#160;<br/>dialects&#160;are&#160;nothing alike&#160;when it&#160;comes&#160;to&#160;manipulating documents,&#160;but&#160;the&#160;general&#160;command set&#160;is&#160;very&#160;<br/>similar.&#160;Steps&#160;were&#160;taken to&#160;improve&#160;the&#160;general&#160;compatibility&#160;between the&#160;two dialects. Many&#160;<br/>enhancements&#160;were&#160;released with OOo 2.0. Many&#160;of the&#160;changes&#160;are&#160;not&#160;backward compatible&#160;with&#160;existing&#160;<br/>behavior.&#160;To&#160;help&#160;resolve&#160;these&#160;conflicts, a&#160;new&#160;compiler option&#160;and a&#160;new&#160;run-time&#160;mode&#160;were&#160;introduced&#160;<br/>to specify&#160;the&#160;new&#160;compatible&#160;behavior.&#160;<br/>
The&#160;compiler option&#160;“Option Compatible”&#160;directs&#160;some&#160;features.&#160;This&#160;option affects&#160;only&#160;the&#160;module&#160;in&#160;<br/>which&#160;it&#160;is&#160;contained.&#160;Because&#160;a&#160;macro calls&#160;different&#160;modules&#160;during its&#160;execution,&#160;both&#160;the&#160;old&#160;and new&#160;<br/>behavior&#160;may&#160;be&#160;used, depending upon the&#160;existence&#160;of “Option&#160;Compatible”&#160;in each called module. Setting<br/>the&#160;option in&#160;one&#160;module&#160;and then calling another module&#160;has&#160;no effect&#160;in&#160;the&#160;called module.<br/>
A&#160;run-time&#160;function, CompatibilityMode(&#160;True/False&#160;), allows&#160;the&#160;behavior of run-time&#160;functions&#160;to&#160;be&#160;<br/>modified during the&#160;execution of a&#160;macro.&#160;This&#160;provides&#160;the&#160;flexibility&#160;to&#160;enable&#160;the&#160;new&#160;run-time&#160;behavior,&#160;<br/>perform&#160;some&#160;operations, and then&#160;disable&#160;the&#160;new&#160;run-time&#160;behavior.&#160;CompatibilityMode(False) overrides&#160;<br/>Option Compatible&#160;for the&#160;new&#160;runtime&#160;behavior.&#160;Hopefully,&#160;some&#160;method&#160;of probing&#160;the&#160;current&#160;mode&#160;will&#160;<br/>be&#160;provided.<br/>
Visual&#160;basic&#160;allows&#160;any&#160;Latin-1 (ISO&#160;8859-1) character as&#160;a&#160;valid variable&#160;name,&#160;OOo does&#160;not.&#160;Setting&#160;<br/>“Option Compatible”&#160;allows&#160;“ä”&#160;to&#160;be&#160;considered a&#160;valid&#160;variable&#160;name.&#160;This&#160;is&#160;just&#160;one&#160;of many&#160;changes&#160;<br/>that&#160;use&#160;“Option&#160;Compatible.”&#160;The&#160;CompatibilityMode() function&#160;neither enables&#160;nor disables&#160;the&#160;new&#160;<br/>extended identifier names&#160;because&#160;CompatibilityMode() is&#160;not&#160;called until&#160;run time&#160;and variable&#160;names&#160;are&#160;<br/>recognized at&#160;compile&#160;time.<br/>
Both&#160;Visual&#160;Basic&#160;and OOo Basic&#160;support&#160;the&#160;rmdir() command to&#160;remove&#160;a&#160;directory.&#160;VBA&#160;can remove&#160;<br/>only&#160;empty&#160;directories, but&#160;OOo Basic&#160;can recursively&#160;remove&#160;an entire&#160;directory&#160;tree. If&#160;<br/>CompatibilityMode(True) is&#160;called prior to&#160;calling rmdir(), OOo Basic&#160;will&#160;act&#160;like&#160;VBA&#160;and generate&#160;an&#160;<br/>error if&#160;the&#160;specified directory&#160;is&#160;not&#160;empty.&#160;This&#160;is&#160;just&#160;one&#160;of many&#160;changes&#160;that&#160;use&#160;CompatibilityMode().<br/>
32<br/>
<hr/>
<a name=36></a>StarBasic&#160;is&#160;much more&#160;forgiving than&#160;VBA. It&#160;is&#160;easier,&#160;therefore, to&#160;convert&#160;simple&#160;macros&#160;from&#160;VBA&#160;to&#160;<br/>OOo Basic.&#160;A&#160;few&#160;examples, in&#160;OOo Basic, “set”&#160;is&#160;optional&#160;during assignment.&#160;Therefore, “set&#160;x&#160;=&#160;5”&#160;<br/>works&#160;in both&#160;VBA&#160;and OOo Basic, but&#160;“x&#160;=&#160;5”&#160;fails&#160;in&#160;VBA&#160;and works&#160;with&#160;OOo Basic.<br/>Another example&#160;is&#160;that&#160;array&#160;methods&#160;are&#160;far more&#160;stable&#160;and forgiving in OOo than in&#160;VBA;&#160;for example,&#160;<br/>the&#160;functions&#160;to determine&#160;array&#160;bounds&#160;(LBound and UBound) work fine&#160;with empty&#160;arrays, whereas&#160;VBA&#160;<br/>crashes.<br/>
<i><b>&#160;3.2.&#160;Compiler&#160;options&#160;and&#160;directives<br/></b></i>A&#160;compiler converts&#160;a&#160;macro into something that&#160;the&#160;computer is&#160;able&#160;to&#160;run. Compiler behavior&#160;can be&#160;<br/>controlled&#160;through commands&#160;such as&#160;“Option&#160;Explicit”&#160;at&#160;the&#160;top&#160;of a&#160;module&#160;before&#160;all&#160;variables,&#160;<br/>subroutines, and functions.&#160;A&#160;compiler option controls&#160;the&#160;compilers&#160;behavior for the&#160;module&#160;containing the&#160;<br/>option.&#160;<br/>
<i><b>Table&#160;4.</b>&#160;Compiler&#160;options&#160;and directives.</i><br/>
<i><b>Option</b></i><br/>
<i><b>Description</b></i><br/>
Def<br/>
Give&#160;a&#160;default&#160;type&#160;to undeclared&#160;variables based on the&#160;variables name.<br/>
Option Base<br/>
Control&#160;whether&#160;the&#160;first&#160;array&#160;index is&#160;0 or&#160;1;&#160;assuming&#160;it&#160;is&#160;not&#160;specified.<br/>
Option Compatible<br/>
Cause&#160;Star&#160;Basic&#160;to act&#160;more&#160;like&#160;VB.<br/>
Option Explicit<br/>
Force&#160;all&#160;variables to be&#160;defined.&#160;While&#160;the&#160;macro&#160;runs,&#160;if&#160;a&#160;variable&#160;that&#160;has not&#160;yet&#160;been&#160;<br/>defined&#160;is used,&#160;an&#160;error&#160;occurs.&#160;<br/>
<i><b>&#160;3.3.&#160;Variables<br/></b></i>Variables&#160;are&#160;containers&#160;that&#160;hold&#160;values.&#160;OpenOffice.org&#160;supports&#160;different&#160;types&#160;of variables&#160;designed to&#160;<br/>hold different&#160;types&#160;of values.&#160;This&#160;section&#160;shows&#160;how&#160;to&#160;create, name, and use&#160;variables.&#160;Although OOo&#160;<br/>Basic&#160;does&#160;not&#160;force&#160;you&#160;to&#160;declare&#160;variables, you should declare&#160;every&#160;variable&#160;that&#160;you use.&#160;The&#160;reasons&#160;for<br/>this&#160;are&#160;developed throughout&#160;this&#160;section.<br/>
<b>&#160;3.3.1.&#160;Constant,&#160;subroutine,&#160;function,&#160;label,&#160;and&#160;variable&#160;names<br/></b>Always&#160;choose&#160;meaningful&#160;names&#160;for your variables.&#160;Although the&#160;variable&#160;name&#160;“var1”&#160;requires&#160;little&#160;<br/>thought&#160;during creation,&#160;“FirstName”&#160;is&#160;more&#160;meaningful.&#160;Some&#160;variable&#160;names&#160;are&#160;not&#160;particularly&#160;<br/>descriptive&#160;but&#160;are&#160;commonly&#160;used by&#160;programmers&#160;anyway.&#160;For example, “i”&#160;is&#160;commonly&#160;used as&#160;a&#160;<br/>shortened version of “index,”<i>&#160;</i>for a&#160;variable&#160;that&#160;is&#160;used to&#160;count&#160;the&#160;number of times&#160;a&#160;repetitive&#160;task is&#160;<br/>executed&#160;in a&#160;loop. OOo Basic&#160;imposes&#160;restrictions&#160;on variable&#160;names, including the&#160;following:&#160;<br/>
•<br/>
A variable name cannot exceed 255 characters in length. Well, <i>officially</i> a variable name cannot <br/>
exceed 255 characters. I tested names with more than 300 characters with no problems, but I don’t <br/>
recommend this!<br/>
•<br/>
The first character of a variable name must be a letter: A­Z or a­z. If Option Compatible is <br/>
used, then all characters defined as letters in the Latin­1 (ISO 8859­1) character set are accepted as <br/>
part of an identifier name.<br/>
•<br/>
The numbers 0­9 and the underscore character (_) may be used in a variable name, but not as the <br/>
first character. If a variable name ends with an underscore, it won’t be mistaken for a line­<br/>
continuation character.<br/>
33<br/>
<hr/>
<a name=37></a>•<br/>
Variable names are not case sensitive, so “FirstName” and “firstNAME” both refer to the same <br/>
variable.<br/>
•<br/>
Variable names may contain spaces but must be enclosed in square brackets if they do. For example,<br/>[First&#160;Name]. Although this is allowed, it is considered poor programming practice.<br/>
<b>TIP</b><br/>
These&#160;restrictions also&#160;apply&#160;to constant,&#160;subroutine,&#160;function, and&#160;label&#160;names.<br/>
<b>&#160;3.3.2.&#160;Declaring&#160;variables<br/></b>Some&#160;programming languages&#160;require&#160;that&#160;you&#160;explicitly&#160;list&#160;all&#160;variables&#160;used.&#160;This&#160;process&#160;is&#160;called&#160;<br/>“declaring variables.”&#160;OOo Basic&#160;does&#160;not&#160;require&#160;this.&#160;You are&#160;free&#160;to use&#160;variables&#160;without&#160;declaring them.<br/>
Although it&#160;is&#160;convenient&#160;to&#160;use&#160;variables&#160;without&#160;declaring them,&#160;it&#160;is&#160;error-prone. If&#160;you mistype&#160;a&#160;variable&#160;<br/>name, it&#160;becomes&#160;a&#160;new&#160;variable&#160;rather than raising an error.&#160;Place&#160;the&#160;keywords&#160;“Option Explicit”&#160;before&#160;<br/>any&#160;runnable&#160;code&#160;in&#160;every&#160;module&#160;to cause&#160;OOo Basic&#160;to&#160;treat&#160;undeclared variables&#160;as&#160;run-time&#160;errors.&#160;<br/>Comments&#160;may&#160;precede&#160;Option&#160;Explicit&#160;because&#160;they&#160;are&#160;not&#160;runnable.&#160;Although it&#160;would be&#160;even better if&#160;<br/>this&#160;became&#160;a&#160;compile-time&#160;error,&#160;OOo Basic&#160;does&#160;not&#160;resolve&#160;all&#160;variables&#160;and routines&#160;until&#160;run time.<br/>
<i><b>Listing&#160;6.</b>&#160;Use&#160;Option Explicit&#160;before&#160;the&#160;first&#160;runnable&#160;line&#160;in a module.</i><br/>
REM &#160;***** &#160;BASIC &#160;*****<br/>Option&#160;Explicit<br/>
<b>TIP</b><br/>
Use&#160;“Option Explicit”&#160;at&#160;the&#160;top&#160;of&#160;every&#160;module&#160;that&#160;you write;&#160;it&#160;will&#160;save&#160;you a&#160;lot&#160;of&#160;time&#160;searching&#160;for&#160;<br/>
errors in your&#160;code.&#160;When I&#160;am&#160;asked&#160;to debug a&#160;macro,&#160;the&#160;first&#160;thing&#160;I&#160;do&#160;is&#160;add&#160;“Option Explicit”&#160;at&#160;the&#160;<br/>top of&#160;each module.<br/>
The&#160;scope&#160;for options&#160;is&#160;the&#160;module&#160;which contains&#160;the&#160;option. In&#160;other words, setting&#160;option&#160;explicit&#160;in one&#160;<br/>module,&#160;then calling&#160;another module, will&#160;not&#160;cause&#160;undeclared variables&#160;in the&#160;called module&#160;to&#160;cause&#160;a&#160;<br/>runtime&#160;error;&#160;unless&#160;the&#160;called module&#160;also has&#160;“option&#160;explicit”.<br/>
You can declare&#160;a&#160;variable&#160;with&#160;or without&#160;a&#160;type.&#160;A&#160;variable&#160;without&#160;an explicit&#160;type&#160;becomes&#160;a&#160;Variant,&#160;<br/>which&#160;is&#160;able&#160;to&#160;take&#160;on any&#160;type.&#160;This&#160;means&#160;that&#160;you can use&#160;a&#160;Variant&#160;to hold&#160;a&#160;numeric&#160;value&#160;and then, in&#160;<br/>the&#160;next&#160;line&#160;of code, overwrite&#160;the&#160;number with text.<a href="libremacros.html#37">&#160;Table&#160;5&#160;s</a>hows&#160;the&#160;variable&#160;types&#160;supported&#160;by&#160;OOo&#160;<br/>Basic, the&#160;value&#160;that&#160;each type&#160;of variable&#160;contains&#160;immediately&#160;after declaration&#160;(“initial&#160;value”), and the&#160;<br/>number of bytes&#160;that&#160;each type&#160;uses. In&#160;OOo Basic, a&#160;variable's&#160;type&#160;can be&#160;declared by&#160;appending a&#160;special&#160;<br/>character to the&#160;end of the&#160;name&#160;when it&#160;is&#160;declared.&#160;The&#160;Post&#160;column&#160;in<a href="libremacros.html#37">&#160;Table&#160;5&#160;c</a>ontains&#160;the&#160;supported&#160;<br/>characters&#160;that&#160;can be&#160;post-fixed&#160;to&#160;a&#160;variable's&#160;name&#160;when the&#160;variable&#160;is&#160;declared.<br/>
<i><b>Table&#160;5.</b>&#160;Supported variable&#160;types&#160;and their&#160;initial&#160;values.</i><br/>
<i><b>Type</b></i><br/>
<i><b>Post</b></i><br/>
<i><b>Initial</b></i><br/>
<i><b>Bytes</b></i><br/>
<i><b>Convert</b></i><br/>
<i><b>Description</b></i><br/>
Boolean<br/>
False<br/>
1<br/>
CBool<br/>
True&#160;or&#160;False<br/>
Currency<br/>
@<br/>
0.0000<br/>
8<br/>
CCur<br/>
Currency&#160;with&#160;4 decimal&#160;places&#160;<br/>
Date<br/>
00:00:00<br/>
8<br/>
CDate<br/>
Dates and&#160;times<br/>
Double<br/>
#<br/>
0.0<br/>
8<br/>
CDbl<br/>
Decimal&#160;numbers in the&#160;range&#160;of&#160;<br/>+/-1.79769313486232&#160;x&#160;10E308<br/>
Integer<br/>
%<br/>
0<br/>
2<br/>
CInt<br/>
Integer&#160;from&#160;-32,768&#160;through&#160;32,767<br/>
Long<br/>
&amp;<br/>
0<br/>
4<br/>
CLng<br/>
Integer&#160;from&#160;-2147483648&#160;through&#160;<br/>
2147483647<br/>
34<br/>
<hr/>
<a name=38></a><i><b>Type</b></i><br/>
<i><b>Post</b></i><br/>
<i><b>Initial</b></i><br/>
<i><b>Bytes</b></i><br/>
<i><b>Convert</b></i><br/>
<i><b>Description</b></i><br/>
Object<br/>
Null<br/>
varies<br/>
Object<br/>
Single<br/>
!<br/>
0.0<br/>
4<br/>
CSng<br/>
Decimal&#160;numbers in the&#160;range&#160;of&#160;<br/>+/-3.402823&#160;x&#160;10E38<br/>
String<br/>
$<br/>
&#34;&#34;<br/>
varies<br/>
CStr<br/>
Text&#160;with&#160;up to&#160;65536&#160;characters<br/>
Variant<br/>
Empty<br/>
varies<br/>
CVar<br/>
May&#160;contain any&#160;data&#160;type<br/>
Although OOo Basic&#160;supports&#160;a&#160;Byte&#160;variable&#160;type, you&#160;can’t&#160;directly&#160;declare&#160;and use&#160;one.&#160;The&#160;function&#160;<br/>CByte, as&#160;discussed later,&#160;returns&#160;a&#160;Byte&#160;value&#160;that&#160;may&#160;be&#160;assigned to a&#160;variable&#160;of type&#160;Variant.&#160;With&#160;OOo&#160;<br/>version&#160;2.0, you&#160;can declare&#160;a&#160;variable&#160;of type&#160;Byte, but&#160;the&#160;variable&#160;is&#160;assumed&#160;to be&#160;an externally&#160;defined&#160;<br/>object&#160;of type&#160;Byte&#160;rather than&#160;an internally&#160;defined Byte&#160;variable.<br/>
Use&#160;the&#160;DIM&#160;keyword to explicitly&#160;declare&#160;a&#160;variable&#160;before&#160;use&#160;(see<a href="libremacros.html#38">&#160;Table&#160;6).&#160;</a>You can declare&#160;multiple&#160;<br/>variables&#160;on a&#160;single&#160;line, and you&#160;can give&#160;each variable&#160;a&#160;type&#160;when it&#160;is&#160;declared.&#160;Variables&#160;with&#160;no&#160;<br/>declared type&#160;default&#160;to&#160;type&#160;Variant.<br/>
<i><b>Table&#160;6.</b>&#160;Declaring simple&#160;variables.</i><br/>
<i><b>Declaration</b></i><br/>
<i><b>Description</b></i><br/>
Dim&#160;Name<br/>
Name&#160;is type&#160;Variant&#160;because&#160;no type&#160;is stated.<br/>
Dim&#160;Name&#160;As&#160;String<br/>
Name&#160;is type&#160;String&#160;because&#160;the&#160;type&#160;is&#160;explicitly&#160;stated.<br/>
Dim&#160;Name$<br/>
Name$ is&#160;type&#160;String&#160;because&#160;Name$ ends with&#160;a&#160;$.<br/>
Dim&#160;Name&#160;As&#160;String,&#160;Weight&#160;As&#160;Single<br/>
Name&#160;is type&#160;String&#160;and&#160;Weight&#160;is type&#160;Single.<br/>
Dim&#160;Width, Length<br/>
Width and Length are&#160;type&#160;Variant.<br/>
Dim&#160;Weight,&#160;Height&#160;As&#160;Single<br/>
Weight&#160;is type&#160;Variant&#160;and Height&#160;is type&#160;Single.<br/>
<b>TIP</b><br/>
When&#160;multiple&#160;variables are&#160;declared in&#160;a&#160;single&#160;line,&#160;the&#160;type&#160;for&#160;each variable&#160;must&#160;be&#160;<br/>listed&#160;separately.&#160;In&#160;the&#160;last&#160;line&#160;of&#160;Table&#160;5,&#160;Weight&#160;is a&#160;Variant,&#160;even though it&#160;looks&#160;like&#160;it&#160;may&#160;be&#160;of&#160;type&#160;<br/>
Single.<br/>
Much of the&#160;available&#160;literature&#160;on OOo macro programming&#160;uses&#160;a&#160;variable&#160;naming scheme&#160;based on&#160;<br/>Hungarian&#160;notation.&#160;With Hungarian notation,&#160;you&#160;can determine&#160;a&#160;variable’s&#160;type&#160;from&#160;its&#160;name.&#160;In&#160;<br/>practice, everyone&#160;does&#160;this&#160;differently&#160;and with differing levels&#160;of adherence.&#160;This&#160;is&#160;a&#160;stylistic&#160;decision that<br/>some&#160;people&#160;love&#160;and some&#160;people&#160;hate.<br/>
OOo Basic&#160;uses&#160;Def&lt;type&gt;&#160;statements&#160;to facilitate&#160;the&#160;use&#160;of Hungarian&#160;notion.&#160;The&#160;Def statements,&#160;which&#160;<br/>are&#160;local&#160;to each module&#160;that&#160;uses&#160;them, provide&#160;a&#160;default&#160;type&#160;for an undeclared variable&#160;based on its&#160;name.&#160;<br/>Normally,&#160;all&#160;undeclared variables&#160;are&#160;of type&#160;Variant.<br/>
The&#160;Def statement&#160;is&#160;followed by&#160;a&#160;comma-separated list&#160;of character ranges&#160;that&#160;specify&#160;the&#160;starting&#160;<br/>characters&#160;(see<a href="libremacros.html#38">&#160;Listing&#160;7).</a><br/>
<i><b>Listing&#160;7.</b>&#160;Declare&#160;untyped variables&#160;starting with&#160;i, j,&#160;k, or&#160;n to be&#160;of&#160;type&#160;Integer.</i><br/>
DefInt&#160;i-k,n<br/>
<a href="libremacros.html#39">Table&#160;7&#160;c</a>ontains&#160;an example&#160;of each supported&#160;Def statement. Def statements, like&#160;Option&#160;statements, are&#160;<br/>placed in the&#160;module&#160;before&#160;any&#160;runnable&#160;line&#160;or variable&#160;declaration.&#160;The&#160;Def&#160;statement&#160;does&#160;not&#160;force&#160;a&#160;<br/>variable&#160;with&#160;a&#160;specific&#160;first&#160;letter to be&#160;of a&#160;certain&#160;type, but&#160;rather provides&#160;a&#160;default&#160;type&#160;other than&#160;Variant<br/>
35<br/>
<hr/>
<a name=39></a>for variables&#160;that&#160;are&#160;used but&#160;not&#160;declared. I&#160;have&#160;never seen the&#160;Def statement&#160;used and I&#160;recommend that&#160;<br/>you&#160;do not&#160;use&#160;the&#160;Def statement.<br/>
<b>TIP</b><br/>
If&#160;you&#160;use&#160;“Option&#160;Explicit,”&#160;and you should,&#160;you must&#160;declare&#160;all&#160;variables.&#160;This renders&#160;the&#160;Def&lt;type&gt;&#160;<br/>
statements&#160;useless&#160;because&#160;they&#160;affect&#160;only&#160;undeclared&#160;variables.<br/>
<i><b>Table&#160;7.</b>&#160;Examples&#160;of&#160;supported Def&#160;statements&#160;in OpenOffice.org.</i><br/>
<i><b>Def&#160;Statement</b></i><br/>
<i><b>Type</b></i><br/>
DefBool&#160;b<br/>
Boolean<br/>
DefDate&#160;t<br/>
Date<br/>
DebDbl&#160;d<br/>
Double<br/>
DefInt&#160;i<br/>
Integer<br/>
DefLng&#160;l<br/>
Long<br/>
DefObj&#160;o<br/>
Object<br/>
DefVar&#160;v<br/>
Variant<br/>
<b>&#160;3.3.3.&#160;Assigning&#160;values&#160;to&#160;variables<br/></b>The&#160;purpose&#160;of a&#160;variable&#160;is&#160;to&#160;hold values.&#160;To&#160;assign a&#160;value&#160;to&#160;a&#160;variable,&#160;type&#160;the&#160;name&#160;of the&#160;variable,&#160;<br/>optional&#160;spaces, an equals&#160;sign, optional&#160;spaces, and the&#160;value&#160;to&#160;assign to the&#160;variable, like&#160;so:<br/>
X&#160;=&#160;3.141592654<br/>y&#160;=&#160;6<br/>
The&#160;optional&#160;keyword Let&#160;may&#160;precede&#160;the&#160;variable&#160;name&#160;but&#160;serves&#160;no purpose&#160;other than readability.&#160;A&#160;<br/>similar optional&#160;keyword, Set,&#160;meant&#160;for Object&#160;variables, serves&#160;no purpose&#160;other than readability.&#160;These&#160;<br/>keywords&#160;are&#160;rarely&#160;used.<br/>
<b>&#160;3.3.4.&#160;Boolean&#160;variables&#160;are&#160;True&#160;or&#160;False<br/></b>Boolean variables&#160;have&#160;two valid&#160;values:&#160;True&#160;or False.&#160;They&#160;are&#160;internally&#160;represented by&#160;the&#160;Integer values<br/>-1 and 0, respectively.&#160;Any&#160;numeric&#160;value&#160;assigned to a&#160;Boolean that&#160;does&#160;not&#160;precisely&#160;evaluate&#160;to&#160;0 is&#160;<br/>converted to&#160;True.&#160;The&#160;macro i<a href="libremacros.html#39">n&#160;Listing&#160;8&#160;i</a>ntroduces&#160;a&#160;few&#160;new&#160;concepts.&#160;A&#160;string&#160;variable,&#160;s, accumulates&#160;<br/>the&#160;results&#160;of the&#160;calculations,&#160;which&#160;are&#160;displayed in a&#160;dialog (see<a href="libremacros.html#40">&#160;Figure&#160;18)</a>.&#160;Adding CHR$(10) to&#160;the&#160;<br/>string causes&#160;a&#160;new&#160;line&#160;to&#160;be&#160;printed in&#160;the&#160;dialog. Unfortunately,&#160;accumulating the&#160;results&#160;in&#160;a&#160;string&#160;<br/>provides&#160;a&#160;more&#160;complicated macro than using&#160;simple&#160;statements&#160;such as&#160;“Print&#160;CBool(5=3)”, but&#160;the&#160;<br/>results&#160;are&#160;easier to understand&#160;(see<a href="libremacros.html#40">&#160;Figure&#160;18)</a>. In&#160;the&#160;OOo version&#160;of the&#160;document, a&#160;button is&#160;frequently&#160;<br/>available&#160;that&#160;allows&#160;you&#160;to&#160;run the&#160;macro immediately.<br/>
<i><b>Listing&#160;8.</b>&#160;Demonstrate&#160;conversion&#160;to type&#160;boolean.<br/></i>Sub&#160;ExampleBooleanType<br/>&#160;&#160;Dim&#160;b&#160;as&#160;Boolean&#160;<br/>&#160;&#160;Dim&#160;s&#160;as&#160;String<br/>&#160;&#160;b&#160;=&#160;True<br/>
&#160;&#160;b&#160;=&#160;False<br/>&#160;&#160;b&#160;=&#160;(5&#160;=&#160;3)&#160;REM Set to False<br/>&#160;&#160;s&#160;=&#160;&#34;(5 = 3) =&gt; &#34;&#160;&amp;&#160;b<br/>&#160;&#160;b&#160;=&#160;(5&#160;&lt;&#160;7)&#160;REM Set to True<br/>
36<br/>
<hr/>
<a name=40></a>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;(5 &lt; 7) =&gt; &#34;&#160;&amp;&#160;b<br/>&#160;&#160;b&#160;=&#160;7&#160; &#160; &#160; &#160;REM Set to True because 7 is not 0<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;(7) =&gt; &#34;&#160;&amp;&#160;b<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<i><b>Figure&#160;18.</b>&#160;The&#160;dialog&#160;displayed&#160;by<a href="libremacros.html#39">&#160;Listing 8.</a></i><br/>
The&#160;internal&#160;binary&#160;representation of&#160;True&#160;as&#160;-1 has&#160;all&#160;of the&#160;bits&#160;set&#160;to&#160;1.&#160;The&#160;internal&#160;binary&#160;representation&#160;<br/>of False&#160;as&#160;0 has&#160;all&#160;of the&#160;bits&#160;set&#160;to 0.<br/>
<b>&#160;3.3.5.&#160;Numeric&#160;variables<br/></b>Numeric&#160;variables&#160;contain numbers. OOo Basic&#160;supports&#160;integers, floating-point,&#160;and currency&#160;numbers.&#160;<br/>Integers&#160;may&#160;be&#160;expressed as&#160;hexadecimal&#160;(base&#160;16), octal&#160;(base&#160;8), or the&#160;default&#160;decimal&#160;numbers&#160;(base&#160;<br/>10). In&#160;common&#160;practice,&#160;OOo users&#160;almost&#160;always&#160;use&#160;decimal&#160;numbers, but&#160;the&#160;other types&#160;are&#160;presented&#160;<br/>here&#160;as&#160;well,&#160;for completeness.<br/>
A&#160;discussion of other number bases&#160;is&#160;important&#160;because&#160;internally,&#160;computers&#160;represent&#160;their data&#160;in&#160;binary&#160;<br/>format.&#160;It&#160;is&#160;easy&#160;to&#160;convert&#160;between the&#160;binary,&#160;hexadecimal, and octal&#160;number bases;&#160;and for humans&#160;it&#160;<br/>may&#160;be&#160;easier to visualize&#160;binary&#160;numbers&#160;when represented&#160;in other number bases.<br/>
Decimal&#160;numbers, base&#160;10, are&#160;composed of the&#160;10 digits&#160;0, 1, 2, 3, 4, 5, 6, 7, 8, and 9.&#160;Add 1 to&#160;9 in decimal<br/>and the&#160;result&#160;is&#160;10. Binary&#160;(base&#160;2), octal&#160;(base&#160;8), and hexadecimal&#160;(base&#160;16) numbers&#160;are&#160;also commonly&#160;<br/>used in&#160;computing. Octal&#160;numbers&#160;are&#160;composed&#160;of the&#160;numbers&#160;0, 1, 2, 3, 4, 5, 6, and 7. In&#160;octal, add 1 to&#160;7&#160;<br/>and the&#160;result&#160;is&#160;10 (base&#160;8). Hexadecimal&#160;numbers&#160;are&#160;composed of the&#160;16 digits&#160;0, 1, 2, 3, 4, 5, 6, 7, 8, 9,&#160;<br/>A, B,&#160;C,&#160;D, E, and F.&#160;Binary&#160;numbers&#160;are&#160;composed of the&#160;two digits&#160;0 a<a href="libremacros.html#40">nd 1.&#160;Table&#160;8<b>&#160;</b></a>contains&#160;the&#160;numbers&#160;<br/>from&#160;0 through 18 in decimal, and their corresponding values&#160;in binary,&#160;octal, and hexadecimal&#160;bases.&#160;<br/>
<i><b>Table&#160;8.</b>&#160;Numbers&#160;in different&#160;bases.</i><br/>
<i><b>Decimal</b></i><br/>
<i><b>Binary</b></i><br/>
<i><b>Octal</b></i><br/>
<i><b>Hexadecimal</b></i><br/>
0<br/>
0<br/>
0<br/>
0<br/>
1<br/>
1<br/>
1<br/>
1<br/>
2<br/>
10<br/>
2<br/>
2<br/>
3<br/>
11<br/>
3<br/>
3<br/>
4<br/>
100<br/>
4<br/>
4<br/>
5<br/>
101<br/>
5<br/>
5<br/>
6<br/>
110<br/>
6<br/>
6<br/>
7<br/>
111<br/>
7<br/>
7<br/>
8<br/>
1000<br/>
10<br/>
8<br/>
9<br/>
1001<br/>
11<br/>
9<br/>
37<br/>
<hr/>
<a name=41></a><i><b>Decimal</b></i><br/>
<i><b>Binary</b></i><br/>
<i><b>Octal</b></i><br/>
<i><b>Hexadecimal</b></i><br/>
10<br/>
1010<br/>
12<br/>
A<br/>
11<br/>
1011<br/>
13<br/>
B<br/>
12<br/>
1100<br/>
14<br/>
C<br/>
13<br/>
1101<br/>
15<br/>
D<br/>
14<br/>
1110<br/>
16<br/>
E<br/>
15<br/>
1111<br/>
17<br/>
F<br/>
16<br/>
10000<br/>
20<br/>
10<br/>
17<br/>
10001<br/>
21<br/>
11<br/>
18<br/>
10010<br/>
22<br/>
12<br/>
Integers&#160;are&#160;assumed to&#160;be&#160;expressed as&#160;decimal&#160;numbers. Commas&#160;are&#160;not&#160;allowed. Hexadecimal&#160;numbers&#160;<br/>are&#160;preceded by&#160;“&amp;H”&#160;and octal&#160;numbers&#160;are&#160;preceded by&#160;“&amp;O”&#160;(letter O, not&#160;a&#160;zero). Unfortunately,&#160;there&#160;is<br/>no easy&#160;method&#160;to enter binary&#160;numbers<a href="libremacros.html#41">.&#160;Table&#160;9&#160;pre</a>sents&#160;a&#160;few&#160;simple&#160;guidelines&#160;for entering numbers.<br/>
<i><b>Table&#160;9.</b>&#160;A&#160;few guidelines&#160;for&#160;entering&#160;numbers&#160;in OOo Basic.</i><br/>
<i><b>Example</b></i><br/>
<i><b>Description</b></i><br/>
Use&#160;1000&#160;not&#160;1,000<br/>
Write&#160;numbers&#160;without&#160;a&#160;thousands separator;&#160;do&#160;not&#160;use&#160;commas.<br/>
+&#160;&#160;1000<br/>
A&#160;space&#160;is&#160;permitted between a&#160;leading&#160;plus or&#160;minus&#160;sign and&#160;the&#160;number.<br/>
&amp;HFE is&#160;the&#160;same&#160;as 254<br/>
Precede&#160;a&#160;hexadecimal&#160;number&#160;with&#160;&amp;H.<br/>
&amp;O11&#160;is the&#160;same&#160;as 9<br/>
Precede&#160;an octal&#160;number&#160;with&#160;&amp;O.<br/>
Use&#160;3.1415&#160;not&#160;3,1415<br/>
Do&#160;not&#160;use&#160;commas&#160;for&#160;the&#160;decimal.<br/>
6.022E23<br/>
In&#160;scientific&#160;notation,&#160;the&#160;“e”&#160;can&#160;be&#160;uppercase&#160;or&#160;lowercase.<br/>
Use&#160; 6.6e-34&#160;not&#160;6.6e&#160; -34<br/>
Spaces&#160;are&#160;not&#160;allowed in&#160;a&#160;number.&#160;With the&#160;space,&#160;this&#160;evaluates as 6.6&#160;-&#160;34 =&#160;-27.4.<br/>
6.022e+23<br/>
The&#160;exponent&#160;may&#160;contain&#160;a&#160;leading&#160;plus or&#160;minus&#160;sign.<br/>
1.1e2.2 evaluates as 1.1e2<br/>
The&#160;exponent&#160;must&#160;be&#160;an integer.&#160;The&#160;fractional&#160;portion is&#160;ignored.<br/>
In&#160;general, assigning a&#160;String to&#160;a&#160;numeric&#160;variable&#160;sets&#160;the&#160;variable&#160;to zero and does&#160;not&#160;generate&#160;an error.&#160;If<br/>the&#160;first&#160;characters&#160;in&#160;the&#160;string&#160;represent&#160;a&#160;number,&#160;however,&#160;then&#160;the&#160;string&#160;is&#160;converted to&#160;a&#160;number and&#160;<br/>the&#160;non-numeric&#160;portion&#160;of the&#160;string&#160;is&#160;ignored — numeric&#160;overflow&#160;is&#160;possible.<br/>
<i><b>Integer&#160;variables<br/></b></i>An integer is&#160;a&#160;whole&#160;number that&#160;may&#160;be&#160;positive, negative,&#160;or equal&#160;to zero.&#160;Integer variables&#160;are&#160;a&#160;good&#160;<br/>choice&#160;for numbers&#160;representing&#160;non-fractional&#160;quantities, such as&#160;age&#160;or number of children. In&#160;OOo Basic,&#160;<br/>Integer variables&#160;are&#160;16-bit&#160;numbers&#160;supporting a&#160;range&#160;from&#160;-32768 through 32767. Floating-point&#160;numbers<br/>assigned to&#160;an integer are&#160;rounded to the&#160;nearest&#160;Integer value.&#160;Appending&#160;a&#160;variable&#160;name&#160;with “%”&#160;when it<br/>is&#160;declared is&#160;a&#160;shortcut&#160;to&#160;declaring it&#160;as&#160;type&#160;Integer.<br/>
<i><b>Listing&#160;9.</b>&#160;Demonstrate&#160;integer&#160;variables.<br/></i>Sub&#160;ExampleIntegerType<br/>&#160;&#160;Dim&#160;i1&#160;As&#160;Integer,&#160;i2%&#160;&#160;REM i1 and i2 are both Integer variables<br/>&#160;&#160;Dim&#160;f2&#160;As&#160;Double<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;f2=&#160;3.5<br/>
38<br/>
<hr/>
<a name=42></a>&#160;&#160;i1=&#160;f2&#160; &#160;&#160;REM i1 is rounded to 4<br/>
&#160;&#160;s&#160;=&#160;&#34;3.50 =&gt; &#34;&#160;&amp;&#160;i1<br/>&#160;&#160;f2=&#160;3.49<br/>&#160;&#160;i2=&#160;f2&#160; &#160;&#160;REM i2 is rounded to 3<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;3.49 =&gt; &#34;&#160;&amp;&#160;i2<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<i><b>Figure&#160;19.</b>&#160;Demonstrating&#160;integer&#160;variables&#160;i<a href="libremacros.html#41">n&#160;Listing 9.</a></i><br/>
<i><b>Long&#160;Integer&#160;variables<br/></b></i>“Long”&#160;is&#160;an integer type&#160;that&#160;has&#160;a&#160;greater range&#160;than type&#160;Integer.&#160;Long&#160;variables&#160;are&#160;32-bit&#160;numbers&#160;<br/>supporting a&#160;range&#160;from&#160;-2,147,483,648 through 2,147,483,647. Long&#160;variables&#160;use&#160;twice&#160;as&#160;much&#160;memory&#160;<br/>as&#160;Integer variables&#160;but&#160;they&#160;can hold&#160;numbers&#160;that&#160;are&#160;<i>much</i>&#160;larger in magnitude. Floating-point&#160;numbers&#160;<br/>assigned to&#160;type&#160;Long&#160;are&#160;rounded to&#160;the&#160;nearest&#160;Long&#160;value.&#160;Appending a&#160;variable&#160;name&#160;with “&amp;”&#160;when it&#160;<br/>is&#160;declared is&#160;a&#160;shortcut&#160;to&#160;declaring it&#160;as&#160;type&#160;Long.&#160;The&#160;output&#160;from<a href="libremacros.html#42">&#160;Listing 10&#160;i</a>s&#160;the&#160;same&#160;as<a href="libremacros.html#41">&#160;Listing&#160;9&#160;(s</a>ee<br/><a href="libremacros.html#42">Figure&#160;19)</a>.<br/>
<i><b>Listing&#160;10.</b>&#160;Demonstrate&#160;long&#160;variables.<br/></i>Sub&#160;ExampleLongType<br/>&#160;&#160;Dim&#160;NumberOfDogs&amp;,&#160;NumberOfCats&#160;As&#160;Long&#160;&#160;' Both variables are Long<br/>&#160;&#160;Dim&#160;f2&#160;As&#160;Double<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;f2=&#160;3.5<br/>&#160;&#160;NumberOfDogs&#160;=&#160;f2&#160; &#160;REM round to 4<br/>&#160;&#160;s&#160;=&#160;&#34;3.50 =&gt; &#34;&#160;&amp;&#160;NumberOfDogs<br/>&#160;&#160;f2=&#160;3.49<br/>&#160;&#160;NumberOfCats&#160;=&#160;f2&#160; &#160;REM round to 3<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;3.49 =&gt; &#34;&#160;&amp;&#160;NumberOfCats<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<i><b>Currency&#160;variables<br/></b></i>Currency&#160;variables, as&#160;the&#160;name&#160;implies,&#160;are&#160;designed to hold&#160;financial&#160;information.&#160;The&#160;Currency&#160;type&#160;was&#160;<br/>originally&#160;introduced to&#160;avoid the&#160;rounding behavior of the&#160;floating-point&#160;types&#160;Single&#160;and Double.&#160;Visual&#160;<br/>Basic&#160;.NET&#160;removed the&#160;Currency&#160;type&#160;in&#160;favor of the&#160;Decimal&#160;type.&#160;<br/>
Currency&#160;variables&#160;are&#160;64-bit, fixed-precision numbers. Calculations&#160;are&#160;performed to&#160;four decimal&#160;places&#160;<br/>and 15&#160;non-decimal&#160;digits&#160;accuracy.&#160;This&#160;yields&#160;a&#160;range&#160;from&#160;-922,337,203,658,477.5808 through&#160;<br/>+922,337,203,658,477.5807.&#160;Appending&#160;a&#160;variable&#160;name&#160;with “@”&#160;when it&#160;is&#160;declared is&#160;a&#160;shortcut&#160;to&#160;<br/>declaring it&#160;as&#160;type&#160;Currency.<br/>
<i><b>Listing&#160;11.</b>&#160;Demonstrate&#160;currency&#160;variables.</i><br/>
Sub&#160;ExampleCurrencyType<br/>&#160;&#160;Dim&#160;Income@,&#160;CostPerDog&#160;As&#160;Currency<br/>
39<br/>
<hr/>
<a name=43></a>&#160;&#160;Income@&#160;=&#160;22134.37<br/>&#160;&#160;CostPerDog&#160;=&#160;100.0&#160;/&#160;3.0<br/>&#160;&#160;REM Prints as 22134.3700<br/>&#160;&#160;Print&#160;&#34;Income = &#34;&#160;&amp;&#160;Income@<br/>&#160;&#160;REM Prints as 33.3333<br/>&#160;&#160;Print&#160;&#34;Cost Per dog = &#34;&#160;&amp;&#160;CostPerDog&#160;<br/>End&#160;Sub<br/>
<i><b>Single&#160;variables<br/></b></i>Single&#160;variables, unlike&#160;Integer variables,&#160;can have&#160;a&#160;fractional&#160;portion.&#160;They&#160;are&#160;called&#160;“floating-point&#160;<br/>numbers”&#160;because, unlike&#160;Currency&#160;variables, the&#160;number of decimals&#160;allowed is&#160;not&#160;fixed. Single&#160;variables&#160;<br/>are&#160;32-bit&#160;numbers&#160;that&#160;are&#160;accurate&#160;to&#160;about&#160;seven displayed&#160;digits,&#160;making them&#160;suitable&#160;for mathematical&#160;<br/>operations&#160;of average&#160;precision.&#160;They&#160;support&#160;positive&#160;or negative&#160;values&#160;from&#160;3.402823&#160;x&#160;10E38 to&#160;<br/>1.401298&#160;x&#160;10E-45.&#160;Any&#160;number smaller in&#160;magnitude&#160;than 1.401298&#160;x&#160;10E-45 becomes&#160;zero.&#160;Appending a&#160;<br/>variable&#160;name&#160;with&#160;“!”&#160;when it&#160;is&#160;declared is&#160;a&#160;shortcut&#160;to declaring&#160;it&#160;as&#160;type&#160;Single.<br/>
<i><b>Listing&#160;12.</b>&#160;Demonstrate&#160;single&#160;variables.<br/></i>Sub&#160;ExampleSingleType<br/>&#160;&#160;Dim&#160;GallonsUsed&#160;As&#160;Single,&#160;Miles&#160;As&#160;Single,&#160;mpg!<br/>&#160;&#160;GallonsUsed&#160;=&#160;17.3<br/>&#160;&#160;Miles&#160;=&#160;542.9<br/>&#160;&#160;mpg!&#160;=&#160;Miles&#160;/&#160;GallonsUsed<br/>&#160;&#160;Print&#160;&#34;Fuel efficiency = &#34;&#160;&amp;&#160;mpg!<br/>End&#160;Sub&#160;<br/>
<i><b>Double&#160;variables<br/></b></i>Double&#160;variables&#160;are&#160;similar to&#160;Single&#160;variables&#160;except&#160;that&#160;they&#160;use&#160;64 bits&#160;and have&#160;about&#160;15 significant&#160;<br/>digits.&#160;They&#160;are&#160;suitable&#160;for high-precision&#160;mathematical&#160;operations.&#160;Double&#160;variables&#160;support&#160;positive&#160;or&#160;<br/>negative&#160;values&#160;from&#160;1.79769313486232&#160;x&#160;10E308 to&#160;4.94065645841247&#160;x&#160;10E-324.&#160;Any&#160;number smaller&#160;<br/>in magnitude&#160;than 4.94065645841247&#160;x&#160;10E-324 becomes&#160;zero.&#160;Appending a&#160;variable&#160;with&#160;“#”&#160;when it&#160;is&#160;<br/>declared is&#160;a&#160;shortcut&#160;to declaring&#160;it&#160;as&#160;type&#160;Double.<br/>
<i><b>Listing&#160;13.</b>&#160;Demonstrate&#160;double&#160;variables.<br/></i>Sub&#160;ExampleDoubleType<br/>&#160;&#160;Dim&#160;GallonsUsed&#160;As&#160;Double,&#160;Miles&#160;As&#160;Double,&#160;mpg#<br/>&#160;&#160;GallonsUsed&#160;=&#160;17.3<br/>&#160;&#160;Miles&#160;=&#160;542.9<br/>
&#160;&#160;mpg#&#160;=&#160;Miles&#160;/&#160;GallonsUsed<br/>&#160;&#160;Print&#160;&#34;Fuel efficiency = &#34;&#160;&amp;&#160;mpg#<br/>End&#160;Sub<br/>
<b>&#160;3.3.6.&#160;String&#160;variables&#160;contain&#160;text<br/></b>String variables&#160;are&#160;used to&#160;hold&#160;text.&#160;In&#160;OOo, text&#160;is&#160;stored as&#160;Unicode&#160;version 2.0 values, which provides&#160;<br/>good support&#160;for multiple&#160;languages. Each String variable&#160;can hold&#160;up to&#160;65,535 characters.&#160;Appending a&#160;<br/>variable&#160;with&#160;“$”&#160;when it&#160;is&#160;declared is&#160;a&#160;shortcut&#160;to&#160;declaring it&#160;as&#160;type&#160;String.<br/>
<i><b>Listing&#160;14.</b>&#160;Demonstrate&#160;string&#160;variables.</i><br/>
Sub&#160;ExampleStringType<br/>&#160;&#160;Dim&#160;FirstName&#160;As&#160;String,&#160;LastName$<br/>&#160;&#160;FirstName&#160;=&#160;&#34;Andrew&#34;<br/>
40<br/>
<hr/>
<a name=44></a>&#160;&#160;LastName$&#160;=&#160;&#34;Pitonyak&#34;<br/>&#160;&#160;Print&#160;&#34;Hello &#34;&#160;&amp;&#160;FirstName&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;LastName$<br/>End&#160;Sub<br/>
<i><b>Figure&#160;20.</b>&#160;Demonstrating&#160;string&#160;variables&#160;in<a href="libremacros.html#43">&#160;Listing&#160;14.</a></i><br/>
Always&#160;remember that&#160;strings&#160;are&#160;limited to&#160;65,535 characters.&#160;A&#160;macro counted the&#160;number of characters&#160;in&#160;<br/>a&#160;text&#160;document&#160;by&#160;converting the&#160;document&#160;to&#160;a&#160;string and then taking the&#160;length.&#160;The&#160;macro worked until&#160;<br/>the&#160;document&#160;contained&#160;more&#160;than 65,535 characters. In&#160;Visual&#160;Basic&#160;.NET,&#160;String variables&#160;may&#160;contain&#160;<br/>approximately&#160;2 billion Unicode&#160;characters.<br/>
Place&#160;two double&#160;quote&#160;characters&#160;in&#160;a&#160;row&#160;to insert&#160;a&#160;double&#160;quotation&#160;character into&#160;a&#160;string.<br/>
S&#160;=&#160;&#34;She said &#34;&#34;Hello&#34;&#34;&#34;&#160;&#160;REM She said &#34;Hello&#34;<br/>
Visual&#160;Basic&#160;string&#160;constants&#160;are&#160;available&#160;when using&#160;“Option&#160;Compatible”&#160;(see<a href="libremacros.html#44">&#160;Table&#160;10)</a>.&#160;You must&#160;use&#160;<br/>Option Compatible&#160;for the&#160;module&#160;rather than using&#160;CompatibilityMode(True) because&#160;the&#160;string constant&#160;is<br/>recognized at&#160;compile&#160;time&#160;rather than run time.<br/>
<i><b>Table&#160;10.</b>&#160;Visual&#160;Basic-compatible&#160;string constants.</i><br/>
<i><b>Constant</b></i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
vbCr<br/>
CHR$(13)<br/>
Carriage&#160;return<br/>
vbCrLf<br/>
CHR$(13)&#160;&amp;&#160;<br/>
Carriage&#160;return/linefeed combination<br/>
CHR$(10)<br/>
vbFormFeed<br/>
CHR$(12)<br/>
Form&#160;feed<br/>
vbLf<br/>
CHR$(10)<br/>
Line&#160;feed<br/>
vbNewLine<br/>
CHR$(13)&#160;&amp;&#160;<br/>
Platform-specific&#160;newline&#160;character&#160;—&#160;whatever&#160;is&#160;<br/>
CHR$(10)&#160;or&#160;<br/>
appropriate<br/>
CHR$(10)<br/>
vbNullChar<br/>
CHR$(0)<br/>
Character&#160;with&#160;ASCII&#160;value&#160;0<br/>
vbNullString<br/>
&#34;&#34;<br/>
Empty&#160;string.&#160;This&#160;is a&#160;string&#160;with&#160;a&#160;terminating&#160;null.<br/>
vbTab<br/>
CHR$(9)<br/>
Horizontal&#160;tab<br/>
vbVerticalTab<br/>
CHR$(11)<br/>
Vertical&#160;tab<br/>
The&#160;string constants&#160;i<a href="libremacros.html#44">n&#160;Table&#160;10&#160;a</a>llow&#160;you&#160;to&#160;define&#160;constant&#160;strings&#160;with&#160;special&#160;characters. Previously,&#160;you&#160;<br/>had to define&#160;the&#160;string by&#160;using&#160;code&#160;that&#160;called&#160;the&#160;CHR$() function.<br/>
Option Compatible<br/>Const&#160;sGreeting&#160;As&#160;String&#160;=&#160;&#34;Hello&#34;&#160;&amp;&#160;vbCr&#160;&amp;&#160;&#34;Johnny&#34;&#160;&#160;' This contains a CR.<br/>
<b>&#160;3.3.7.&#160;Date&#160;variables<br/></b>Date&#160;variables&#160;contain date&#160;and time&#160;values. OOo Basic&#160;stores&#160;dates&#160;internally&#160;as&#160;a&#160;Double.&#160;Dates, like&#160;all&#160;<br/>numerical&#160;types, are&#160;initialized&#160;to zero,&#160;which corresponds&#160;to December 30, 1899 at&#160;00:00:00.&#160;Adding&#160;or&#160;<br/>subtracting&#160;1 to/from&#160;a&#160;date&#160;corresponds&#160;to adding or subtracting a&#160;day.&#160;One&#160;hour,&#160;one&#160;minute, and one&#160;<br/>
41<br/>
<hr/>
<a name=45></a>second correspond to the&#160;numbers&#160;1/24, 1/(24 * 60), and 1/(24 * 60 * 60), respectively.&#160;The&#160;date&#160;functions&#160;<br/>supported&#160;by&#160;OOo Basic&#160;are&#160;introduced i<a href="libremacros.html#45">n&#160;Table&#160;11<b>&#160;</b></a>and fully&#160;discussed later.&#160;<br/>
<i><b>Listing&#160;15.</b>&#160;Demonstrate&#160;date&#160;variables.<br/></i>Sub&#160;ExampleDateType<br/>&#160;&#160;Dim&#160;tNow&#160;As&#160;Date,&#160;tToday&#160;As&#160;Date<br/>&#160;&#160;Dim&#160;tBirthDay&#160;As&#160;Date<br/>&#160;&#160;tNow&#160;=&#160;Now()<br/>&#160;&#160;tToday&#160;=&#160;Date()<br/>&#160;&#160;tBirthDay&#160;=&#160;DateSerial(1776,&#160;7,&#160;4)&#160;<br/>&#160;&#160;Print&#160;&#34;Today = &#34;&#160;&amp;&#160;tToday&#160;<br/>&#160;&#160;Print&#160;&#34;Now = &#34;&#160;&amp;&#160;tNow<br/>&#160;&#160;Print&#160;&#34;A total of &#34;&#160;&amp;&#160;(tToday&#160;-&#160;tBirthDay)&#160;&amp;_<br/>&#160; &#160;&#160;&#34; days have passed since &#34;&#160;&amp;&#160;tBirthDay<br/>End&#160;Sub<br/>
Negative&#160;numbers&#160;are&#160;valid&#160;and correspond to&#160;dates&#160;before&#160;December 30, 1899. January&#160;1, 0001,&#160;<br/>corresponds&#160;to&#160;the&#160;floating-point&#160;number -693,595. Continuing backward produces&#160;dates&#160;that&#160;are&#160;B.C.&#160;<br/>(Before&#160;Christ, sometimes&#160;also referred to&#160;as&#160;B.C.E., meaning Before&#160;the&#160;Christian Era, or Before&#160;the&#160;<br/>Common Era) rather than&#160;A.D. (Anno Domini).&#160;A&#160;thorough discussion of date&#160;handling is&#160;presented&#160;later.<br/>
<i><b>Table&#160;11.</b>&#160;Functions&#160;and subroutines&#160;related&#160;to dates&#160;and times.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Type</b></i><br/>
<i><b>Description</b></i><br/>
CDate(expression)<br/>
Date<br/>
Convert&#160;a&#160;number&#160;or&#160;string&#160;to a&#160;date.<br/>
CDateFromIso(string)<br/>
Date<br/>
Convert&#160;to&#160;a&#160;date&#160;from&#160;an ISO&#160;8601&#160;date&#160;representation.<br/>
CDateToIso(date)<br/>
String<br/>
Convert&#160;a&#160;date&#160;to an ISO&#160;8601&#160;date&#160;representation.<br/>
Date()<br/>
String<br/>
Return the&#160;current&#160;date&#160;as&#160;a&#160;String.<br/>
DateSerial(yr,&#160;mnth, day)<br/>
Date<br/>
Create&#160;a&#160;date&#160;from&#160;component&#160;pieces:&#160;Year,&#160;Month,&#160;Day.<br/>
DateValue(date)<br/>
Date<br/>
Extract&#160;the&#160;date&#160;from&#160;a&#160;date/time&#160;value&#160;by&#160;truncating&#160;the&#160;decimal&#160;portion.<br/>
Day(date)<br/>
Integer<br/>
Return the&#160;day&#160;of&#160;the&#160;month as an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
GetSystemTicks()<br/>
Long<br/>
Return the&#160;number&#160;of&#160;system&#160;ticks as a&#160;Long.<br/>
Hour(date)<br/>
Integer<br/>
Return the&#160;hour&#160;as an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
IsDate(value)<br/>
Boolean<br/>
Is&#160;this a&#160;date?<br/>
Minute(date)<br/>
Integer<br/>
Return the&#160;minute&#160;as an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
Month(date)<br/>
Integer<br/>
Return the&#160;month&#160;as&#160;an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
Now()<br/>
Date<br/>
Return the&#160;current&#160;date&#160;and&#160;time&#160;as a&#160;Date&#160;object.<br/>
Second(date)<br/>
Integer<br/>
Return the&#160;seconds as an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
Time()<br/>
String<br/>
Return the&#160;time&#160;as a&#160;String.<br/>
Timer()<br/>
Date<br/>
Return the&#160;number&#160;of&#160;seconds since&#160;midnight&#160;as&#160;a&#160;Date.&#160;Convert&#160;to a&#160;Long.<br/>
TimeSerial(hour,&#160;min, sec)<br/>
Date<br/>
Create&#160;a&#160;date&#160;from&#160;component&#160;pieces:&#160;Hours, Minutes, Seconds.<br/>
WeekDay(date)<br/>
Integer<br/>
Return the&#160;integer&#160;1 through 7,&#160;corresponding&#160;to Sunday&#160;through Saturday.<br/>
Year(date)<br/>
Integer<br/>
Return the&#160;year&#160;as an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
<b>&#160;3.3.8.&#160;Create&#160;your&#160;own&#160;data&#160;types<br/></b>In&#160;most&#160;implementations&#160;of the&#160;BASIC programming language, you&#160;can create&#160;your&#160;own data&#160;types. OOo&#160;<br/>Basic&#160;allows&#160;you to define&#160;and use&#160;your&#160;own data&#160;types.&#160;<br/>
42<br/>
<hr/>
<a name=46></a><i><b>Listing&#160;16.</b>&#160;Demonstrate&#160;user&#160;defined types.<br/></i>Type&#160;PersonType<br/>&#160;&#160;FirstName&#160;As&#160;String<br/>&#160;&#160;LastName&#160;As&#160;String<br/>End&#160;Type<br/>
Sub&#160;ExampleCreateNewType<br/>&#160;&#160;Dim&#160;Person&#160;As&#160;PersonType<br/>&#160;&#160;Person.FirstName&#160;=&#160;&#34;Andrew&#34;<br/>&#160;&#160;Person.LastName&#160;&#160;=&#160;&#34;Pitonyak&#34;<br/>&#160;&#160;PrintPerson(Person)<br/>End&#160;Sub<br/>
Sub&#160;PrintPerson(x)<br/>&#160;&#160;Print&#160;&#34;Person = &#34;&#160;&amp;&#160;x.FirstName&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;x.LastName<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
Although user-defined&#160;types cannot&#160;directly&#160;contain an array,&#160;you&#160;can manage&#160;them&#160;in&#160;a&#160;variant&#160;type.<br/>
In&#160;OOo version&#160;3.2, there&#160;are&#160;three&#160;ways&#160;that&#160;you&#160;can instantiate&#160;an instance&#160;of a&#160;user defined&#160;type. In&#160;the&#160;<br/>following&#160;example, the&#160;colon&#160;(:) is&#160;used to place&#160;two statements&#160;on the&#160;same&#160;line.<br/>
Dim&#160;x&#160;As New&#160;PersonType &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' The original way to do it.<br/>Dim&#160;y&#160;As&#160;PersonType &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' New is no longer required.<br/>Dim&#160;z&#160;:&#160;z&#160;=&#160;CreateObject(&#34;PersonType&#34;) &#160;' Create the object when desired.<br/>
When&#160;you&#160;create&#160;your&#160;own type, you&#160;create&#160;a&#160;structure&#160;(frequently&#160;called&#160;a&#160;struct). OOo has&#160;many&#160;predefined<br/>internal&#160;structures.&#160;A&#160;commonly&#160;used structure&#160;is&#160;“com.sun.star.beans.PropertyValue”.&#160;The&#160;internal&#160;OOo&#160;<br/>structures&#160;can be&#160;created in&#160;the&#160;same&#160;way&#160;as&#160;user defined types, and also using CreateUnoStruct&#160;(se<a href="libremacros.html#231">e<br/>10Universal&#160;Network Objects&#160;on pa</a>ge<a href="libremacros.html#231">&#160;228)</a>.<br/>
&#160;&#160;Dim&#160;a&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;Dim&#160;b&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;Dim&#160;c&#160;:&#160;c&#160;=&#160;CreateObject(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>&#160;&#160;Dim&#160;d&#160;:&#160;d&#160;=&#160;CreateUnoStruct(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>
Although the&#160;structure's&#160;type&#160;is&#160;“com.sun.star.beans.PropertyValue”, it&#160;is&#160;common&#160;to abbreviate&#160;the&#160;type&#160;<br/>name&#160;as&#160;the&#160;last&#160;portion&#160;of the&#160;name&#160;—&#160;in this&#160;case, “PropertyValue”. Many&#160;of the&#160;objects&#160;in&#160;OOo have&#160;<br/>similar,&#160;long, cumbersome&#160;names, which&#160;are&#160;similarly&#160;abbreviated&#160;in this&#160;book.&#160;<br/>
Most&#160;variables&#160;copy&#160;by&#160;value.&#160;This&#160;means&#160;that&#160;when I&#160;assign one&#160;variable&#160;to&#160;another,&#160;the&#160;value&#160;from&#160;one&#160;is&#160;<br/>placed into&#160;the&#160;other.&#160;They&#160;do not&#160;reference&#160;the&#160;same&#160;data;&#160;they&#160;contain their own copy&#160;of the&#160;data.&#160;This&#160;is&#160;<br/>also true&#160;of user-defined&#160;types&#160;and internal&#160;OOo structures.&#160;Variables&#160;that&#160;can be&#160;defined in&#160;this&#160;way&#160;are&#160;<br/>copied by&#160;value.&#160;Other types&#160;used internally&#160;by&#160;OOo, called Universal&#160;Network Objects, are&#160;copied&#160;by&#160;<br/>reference.&#160;Although these&#160;are&#160;discussed later,&#160;it&#160;is&#160;important&#160;to start&#160;thinking about&#160;what&#160;happens&#160;when one&#160;<br/>variable&#160;is&#160;assigned to&#160;another.&#160;If&#160;I&#160;assign one&#160;variable&#160;to&#160;another and it&#160;is&#160;copied by&#160;reference, then&#160;both&#160;<br/>variables&#160;refer to&#160;the&#160;same&#160;data. If&#160;two variables&#160;refer to the&#160;same&#160;data,&#160;and if I&#160;change&#160;one&#160;variable, then&#160;I&#160;<br/>change&#160;both.<br/>
<b>&#160;3.3.9.&#160;Declare&#160;variables&#160;with&#160;special&#160;types<br/></b>You can use&#160;the&#160;keywords&#160;“As&#160;New”&#160;to&#160;define&#160;a&#160;variable&#160;as&#160;a&#160;known UNO&#160;struct.&#160;The&#160;word “struct”&#160;is&#160;an&#160;<br/>abbreviated&#160;form&#160;of the&#160;word “structure”&#160;that&#160;is&#160;frequently&#160;used by&#160;computer programmers.&#160;A&#160;struct&#160;has&#160;one&#160;<br/>
43<br/>
<hr/>
<a name=47></a>or more&#160;data&#160;members, each of which&#160;may&#160;have&#160;different&#160;types. Structs&#160;are&#160;used to&#160;group associated data&#160;<br/>together.<br/>
Option Compatible&#160;provides&#160;a&#160;new&#160;syntax to&#160;define&#160;variables&#160;of known and unknown types.&#160;A&#160;simple&#160;<br/>example&#160;is&#160;declaring a&#160;variable&#160;of a&#160;specific&#160;type&#160;even if the&#160;type&#160;is&#160;not&#160;known to OOo Basic.<br/>
Option&#160;Compatible&#160; &#160; &#160; &#160; &#160;&#160;'Supported in OOo 2.0<br/>Sub&#160;Main<br/>&#160;&#160;Dim&#160;oVar1&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;oVar2&#160;As&#160;MyType<br/>&#160;&#160;Set&#160;oVar1&#160;=&#160;New&#160;MyType&#160; &#160;'Supported in OOo 2.0<br/>&#160;&#160;Set&#160;oVar2&#160;=&#160;New&#160;MyType&#160; &#160;'Supported in OOo 2.0<br/>&#160;&#160;Set&#160;oVar2&#160;=&#160;New&#160;YourType&#160;'Error, declared as MyType not YourType.<br/>
A&#160;new&#160;OLE&#160;object&#160;factory&#160;was&#160;introduced with OOo 2.0, which&#160;allows&#160;new&#160;types&#160;to be&#160;created.&#160;The&#160;new&#160;<br/>functionality&#160;allows&#160;OOo Basic&#160;to manipulate&#160;Microsoft&#160;Word documents&#160;on Microsoft&#160;Windows&#160;operating&#160;<br/>systems&#160;if Microsoft&#160;Office&#160;is&#160;also&#160;installed on the&#160;computer.<br/>
Sub&#160;Main<br/>&#160;&#160;Dim&#160;W&#160;As&#160;Word.Application<br/>&#160;&#160;Set&#160;W&#160;=&#160;New&#160;Word.Application<br/>&#160;&#160;REM Dim W As New Word.Application &#160; &#160; &#160; &#160;'This works in OOo 2.0<br/>&#160;&#160;REM W = CreateObject(&#34;Word.Application&#34;) 'This works in OOo 2.0<br/>&#160;&#160;W.Visible&#160;=&#160;True<br/>End&#160;Sub<br/>
The&#160;use&#160;of CreateObject() does&#160;not&#160;rely&#160;on “Option Compatible”&#160;because&#160;this&#160;functionality&#160;is&#160;provided&#160;by&#160;<br/>the&#160;new&#160;OLE&#160;object&#160;factory&#160;released with OOo 2.0.<br/>
<b>&#160;3.3.10.&#160;Object&#160;variables<br/></b>An Object&#160;is&#160;a&#160;complex&#160;data&#160;type&#160;that&#160;can contain&#160;more&#160;than a&#160;single&#160;piece&#160;of data.&#160;The&#160;code&#160;i<a href="libremacros.html#46">n&#160;Listing&#160;16<b>&#160;<br/></b></a>shows&#160;an example&#160;of a&#160;complex&#160;data&#160;type. In&#160;OpenOffice.org, Object&#160;variables&#160;are&#160;intended to hold&#160;complex<br/>data&#160;types&#160;created and defined&#160;by&#160;OOo Basic.&#160;When a&#160;variable&#160;of type&#160;Object&#160;is&#160;first&#160;declared, it&#160;contains&#160;the<br/>special&#160;value&#160;Null,&#160;which&#160;indicates&#160;that&#160;no valid&#160;value&#160;is&#160;present.&#160;<br/>
Use&#160;the&#160;Variant&#160;type, not&#160;Object,&#160;to refer to OpenOffice.org&#160;internals.&#160;This&#160;is&#160;discussed later.<br/>
<b>&#160;3.3.11.&#160;Variant&#160;variables<br/></b>Variant&#160;variables&#160;are&#160;able&#160;to hold&#160;any&#160;data&#160;type.&#160;They&#160;take&#160;on the&#160;type&#160;of whatever is&#160;assigned to&#160;them.&#160;When<br/>a&#160;variable&#160;of type&#160;Variant&#160;is&#160;first&#160;declared, it&#160;contains&#160;the&#160;special&#160;value&#160;Empty,&#160;which indicates&#160;that&#160;no value&#160;<br/>has&#160;been assigned to the&#160;variable.&#160;A&#160;Variant&#160;may&#160;be&#160;assigned an integer in&#160;one&#160;statement&#160;and then assigned&#160;<br/>text&#160;in&#160;the&#160;next.&#160;No typecasting occurs&#160;when assigning data&#160;to a&#160;Variant;&#160;it&#160;simply&#160;becomes&#160;the&#160;appropriate&#160;<br/>type.<br/>
The&#160;chameleon-like&#160;behavior&#160;of&#160;Variant&#160;variables&#160;allows&#160;them&#160;to&#160;be&#160;used as&#160;any&#160;other variable&#160;type.&#160;<br/>However,&#160;this&#160;flexibility&#160;comes&#160;with a&#160;cost:&#160;time. One&#160;final&#160;problem&#160;is&#160;that&#160;it&#160;isn’t&#160;always&#160;obvious&#160;what&#160;type<br/>a&#160;Variant&#160;will&#160;become&#160;after making some&#160;assignments.<br/>
<i><b>Listing&#160;17.</b>&#160;Demonstrate&#160;variant&#160;types.<br/></i>Sub&#160;ExampleTestVariants<br/>&#160;&#160;DIM&#160;s&#160;As&#160;String<br/>&#160;&#160;DIM&#160;v&#160;As&#160;Variant<br/>&#160;&#160;REM v starts Empty<br/>
44<br/>
<hr/>
<a name=48></a>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;1 &#160;: TypeName = &#34;&#160;&amp;&#160;TypeName(v)&#160;&amp;&#160;&#34; Value = &#34;&#160;&amp;&#160;v&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;v&#160;=&#160;&#34;ab217&#34;&#160;:&#160;REM v becomes a String<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;2 &#160;: TypeName = &#34;&#160;&amp;&#160;TypeName(v)&#160;&amp;&#160;&#34; Value = &#34;&#160;&amp;&#160;v&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;v&#160;=&#160;True&#160; &#160;&#160;:&#160;REM v becomes a Boolean<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;3 &#160;: TypeName = &#34;&#160;&amp;&#160;TypeName(v)&#160;&amp;&#160;&#34; Value = &#34;&#160;&amp;&#160;v&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;v&#160;=&#160;(5=5)&#160; &#160;:&#160;REM v becomes an Integer rather than a Boolean<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;4 &#160;: TypeName = &#34;&#160;&amp;&#160;TypeName(v)&#160;&amp;&#160;&#34; Value = &#34;&#160;&amp;&#160;v&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;v&#160;=&#160;123.456&#160;:&#160;REM Double<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;5 &#160;: TypeName = &#34;&#160;&amp;&#160;TypeName(v)&#160;&amp;&#160;&#34; Value = &#34;&#160;&amp;&#160;v&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;v&#160;=123&#160; &#160; &#160;&#160;:&#160;REM Integer<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;6 &#160;: TypeName = &#34;&#160;&amp;&#160;TypeName(v)&#160;&amp;&#160;&#34; Value = &#34;&#160;&amp;&#160;v&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;v&#160;=&#160;1217568942&#160;:&#160;REM This could be a Long but it turns into a Double<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;7 &#160;: TypeName = &#34;&#160;&amp;&#160;TypeName(v)&#160;&amp;&#160;&#34; Value = &#34;&#160;&amp;&#160;v&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;The Variant Takes Many Types&#34;<br/>End&#160;Sub<br/>
Visual&#160;Basic&#160;.NET&#160;does&#160;not&#160;support&#160;type&#160;Variant. Undeclared variables&#160;are&#160;of type&#160;Object.<br/>
<i><b>Figure&#160;21.</b>&#160;Variant&#160;takes&#160;the&#160;assigned type.</i><br/>
When&#160;data&#160;is&#160;assigned to a&#160;Variant, the&#160;data&#160;is&#160;not&#160;converted to&#160;an appropriate&#160;type, but&#160;rather the&#160;Variant&#160;<br/>becomes&#160;the&#160;type&#160;of the&#160;data. In&#160;line<a href="libremacros.html#48">&#160;6 of&#160;Figure&#160;21, t</a>he&#160;Variant&#160;is&#160;an Integer.&#160;In&#160;line&#160;7, the&#160;number is&#160;too&#160;<br/>large&#160;to&#160;be&#160;an Integer,&#160;but&#160;it&#160;is&#160;small&#160;enough to&#160;be&#160;a&#160;Long. OOo Basic&#160;chooses&#160;to&#160;convert&#160;whole&#160;numbers&#160;<br/>larger than an integer and all&#160;floating-point&#160;numbers&#160;into&#160;a&#160;Double, even if they&#160;can be&#160;expressed as&#160;a&#160;Single<br/>or a&#160;Long.<br/>
<b>&#160;3.3.12.&#160;Constants<br/></b>A&#160;constant&#160;is&#160;a&#160;variable&#160;with&#160;no type, and that&#160;cannot&#160;change&#160;value.&#160;The&#160;variable&#160;is&#160;defined&#160;to be&#160;a&#160;<br/>placeholder that&#160;is&#160;substituted by&#160;the&#160;expression that&#160;defines&#160;the&#160;constant.&#160;Constants&#160;are&#160;defined with&#160;the&#160;<br/>keyword Const.&#160;The&#160;constant&#160;name&#160;can be&#160;any&#160;valid&#160;variable&#160;name.<br/>
Const&#160;ConstName=Expression<br/>
Constants&#160;improve&#160;macros&#160;in&#160;many&#160;ways. Consider a&#160;Gravity&#160;constant&#160;frequently&#160;used in physics. Physics&#160;<br/>scholars&#160;will&#160;recognize&#160;this&#160;as&#160;the&#160;acceleration&#160;due&#160;to gravity&#160;in&#160;meters&#160;per second squared.<br/>
Const&#160;Gravity&#160;=&#160;9.81<br/>
Here&#160;are&#160;some&#160;specific&#160;benefits&#160;of using constants:<br/>
•<br/>
Constants&#160;improve&#160;the&#160;readability&#160;of a&#160;macro.&#160;The&#160;word Gravity&#160;is&#160;easier to recognize&#160;than the&#160;value&#160;<br/>9.81.<br/>
45<br/>
<hr/>
<a name=49></a>•<br/>
Constants&#160;are&#160;easy&#160;to manage. If&#160;I&#160;require&#160;greater precision&#160;or if&#160;the&#160;gravitational&#160;pull&#160;changes, I&#160;&#160;<br/>have&#160;to&#160;change&#160;the&#160;value&#160;in only&#160;one&#160;location.<br/>
•<br/>
Constants&#160;help prevent&#160;difficult-to-find errors&#160;by&#160;changing run-time&#160;errors&#160;into&#160;compile-time&#160;errors.&#160;<br/>Typing&#160;“Grevity”&#160;rather than “Gravity”&#160;is&#160;a&#160;compile-time&#160;error,&#160;while&#160;mistyping&#160;“9.81”&#160;as&#160;“9.18”&#160;is&#160;<br/>not.<br/>
•<br/>
While&#160;a&#160;value&#160;like&#160;9.81 may&#160;be&#160;obvious&#160;to you, it&#160;may&#160;not&#160;be&#160;as&#160;obvious&#160;to&#160;others&#160;reading your&#160;code&#160;<br/>later.&#160;It&#160;becomes&#160;what&#160;programmers&#160;call&#160;a&#160;“magic&#160;number,”&#160;and experienced programmers&#160;try&#160;to&#160;<br/>avoid magic&#160;numbers&#160;at&#160;all&#160;costs.&#160;Their unexplained&#160;meanings&#160;make&#160;for difficulties&#160;in maintaining&#160;<br/>code&#160;later,&#160;when the&#160;original&#160;programmer is&#160;not&#160;available&#160;to&#160;explain&#160;—&#160;or has&#160;forgotten&#160;the&#160;details&#160;<br/>entirely.<br/>
<b>TIP</b><br/>
OpenOffice.org&#160;defines the&#160;constant&#160;Pi.&#160;This is&#160;a&#160;mathematical&#160;constant&#160;with a&#160;value&#160;of&#160;approximately&#160;<br/>
3.1415926535897932385.<br/>
<i><b>&#160;3.4.&#160;The&#160;With&#160;statement<br/></b></i>The&#160;With&#160;statement&#160;is&#160;used to&#160;simplify&#160;accessing&#160;complex&#160;data&#160;types<a href="libremacros.html#46">.&#160;Listing&#160;16&#160;de</a>fines&#160;a&#160;data&#160;type&#160;that&#160;<br/>contains&#160;two different&#160;variables:&#160;FirstName&#160;and LastName.&#160;You can access&#160;these&#160;variables&#160;by&#160;placing a&#160;<br/>period&#160;between the&#160;variable&#160;name&#160;and the&#160;data&#160;item.<br/>
Sub&#160;ExampleCreateNewType<br/>&#160;&#160;Dim&#160;Person&#160;As&#160;PersonType<br/>&#160;&#160;Person.FirstName&#160;=&#160;&#34;Andrew&#34;<br/>&#160;&#160;Person.LastName&#160;&#160;=&#160;&#34;Pitonyak&#34;<br/>&#160;&#160;...<br/>End&#160;Sub<br/>
Or...&#160;the&#160;With&#160;statement&#160;provides&#160;a&#160;shortcut&#160;for accessing multiple&#160;data&#160;elements&#160;from&#160;the&#160;same&#160;variable.<br/>
Sub&#160;ExampleCreateNewType<br/>&#160;&#160;Dim&#160;Person&#160;As&#160;PersonType<br/>&#160;&#160;With&#160;Person<br/>&#160; &#160;&#160;.FirstName&#160;=&#160;&#34;Andrew&#34;<br/>&#160; &#160;&#160;.LastName&#160;&#160;=&#160;&#34;Pitonyak&#34;<br/>&#160;&#160;End&#160;With<br/>&#160;&#160;...<br/>End&#160;Sub<br/>
Similarly:<br/>
Dim&#160;oProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>oProp.Name&#160;&#160;=&#160;&#34;Person&#34;&#160; &#160; &#160;&#160;'Set Name Property<br/>oProp.Value&#160;=&#160;&#34;Boy Bill&#34;&#160; &#160;&#160;'Set Value Property<br/>
Using&#160;With:<br/>
Dim&#160;oProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>With&#160;oProp<br/>&#160;&#160;.Name&#160;&#160;=&#160;&#34;Person&#34;&#160; &#160; &#160;&#160;'Set Name Property<br/>&#160;&#160;.Value&#160;=&#160;&#34;Boy Bill&#34;&#160; &#160;&#160;'Set Value Property<br/>End&#160;With<br/>
46<br/>
<hr/>
<a name=50></a><i><b>&#160;3.5.&#160;Arrays<br/></b></i>An array&#160;is&#160;a&#160;data&#160;structure&#160;in which similar&#160;elements&#160;of data&#160;are&#160;arranged in&#160;an indexed&#160;structure&#160;—&#160;for&#160;<br/>example,&#160;a&#160;column of names&#160;or a&#160;table&#160;of numbers. See<a href="libremacros.html#50">&#160;Table&#160;12.&#160;</a>An array&#160;allows&#160;you&#160;to&#160;store&#160;many&#160;<br/>different&#160;values&#160;in&#160;a&#160;single&#160;variable, and uses&#160;parentheses&#160;to&#160;define&#160;and access&#160;array&#160;elements.&#160;OOo Basic&#160;<br/>does&#160;not&#160;support&#160;the&#160;use&#160;of square&#160;brackets&#160;as&#160;used by&#160;other languages&#160;such as&#160;C&#160;and Java.<br/>
Array&#160;variables&#160;are&#160;declared using&#160;the&#160;Dim&#160;statement.&#160;Think of a&#160;one-dimensional&#160;array&#160; as&#160;a&#160;column&#160;of&#160;<br/>values&#160;and a&#160;two-dimensional&#160;array&#160;as&#160;a&#160;table&#160;of values. Higher dimensions&#160;are&#160;supported but&#160;difficult&#160;to&#160;<br/>visualize.&#160;An array&#160;index&#160;may&#160;be&#160;any&#160;Integer value&#160;from&#160;-32,768 through 32,767.<br/>
<i><b>Table&#160;12.</b>&#160;Declaring an array&#160;is&#160;easy!</i><br/>
<i><b>Definition</b></i><br/>
<i><b>Elements</b></i><br/>
<i><b>Description</b></i><br/>
Dim&#160;a(5)&#160;As&#160;Integer<br/>
6<br/>
From&#160;0 through 5&#160;inclusive.<br/>
Dim&#160;b(5&#160;To&#160;10)&#160;As&#160;String<br/>
6<br/>
From&#160;5 through 10&#160;inclusive.<br/>
Dim&#160;c(-5&#160;To&#160;5)&#160;As&#160;String<br/>
11<br/>
From&#160;-5&#160;through 5&#160;inclusive.<br/>
Dim&#160;d(5,&#160;1&#160;To&#160;6)&#160;As&#160;Integer<br/>
36<br/>
Six rows with&#160;six columns from&#160;0&#160;through 5&#160;and&#160;1&#160;<br/>
through 6.<br/>
Dim&#160;e(5&#160;To&#160;10,&#160;20&#160;To&#160;25)&#160;As&#160;Long<br/>
36<br/>
Six rows with&#160;six columns from&#160;5&#160;through 10&#160;and 20&#160;<br/>
through 25.<br/>
<b>TIP</b><br/>
You must&#160;declare&#160;array&#160;variables before&#160;using&#160;them,&#160;even if&#160;you don’t&#160;use&#160;“Option&#160;Explicit.”<br/>
If&#160;the&#160;lower dimension&#160;of an array&#160;is&#160;not&#160;specified, the&#160;default&#160;lower bound of an array&#160;is&#160;zero.&#160;<br/>(Programmers&#160;call&#160;these&#160;arrays&#160;“zero-based.”)&#160;Thus, an array&#160;with five&#160;elements&#160;will&#160;have&#160;elements&#160;<br/>numbered a(0) through a(4). Use&#160;the&#160;keywords&#160;“Option Base&#160;1”&#160;to change&#160;the&#160;default&#160;lower bound of an&#160;<br/>array&#160;to&#160;start&#160;at&#160;1 rather than 0.&#160;This&#160;must&#160;be&#160;done&#160;before&#160;any&#160;other executable&#160;statement&#160;in&#160;the&#160;program.<br/>
Option&#160;Base&#160;{&#160;0&#160;|&#160;1&#160;}<br/>
<b>TIP</b><br/>
Specify&#160;the&#160;lower&#160;bound of&#160;an array&#160;rather&#160;than relying on&#160;the&#160;default&#160;behavior.&#160;This is more&#160;portable&#160;and&#160;it<br/>will&#160;not&#160;change&#160;when&#160;the&#160;Option Base&#160;statement&#160;is&#160;used.<br/>
Dim&#160;a(3) allows&#160;for four elements:&#160;a(0), a(1), a(2), and a(3). Option&#160;Base&#160;does&#160;not&#160;change&#160;the&#160;number of&#160;<br/>elements&#160;that&#160;an array&#160;can store;&#160;it&#160;changes&#160;only&#160; how&#160;they&#160;are&#160;indexed.&#160;Using&#160;Option&#160;Base&#160;1, the&#160;same&#160;<br/>statement&#160;still&#160;allows&#160;for four elements:&#160;a(1), a(2), a(3), and a(4). I&#160;consider this&#160;behavior unintuitive&#160;and&#160;<br/>recommend against&#160;using Option Base. If&#160;you&#160;want&#160;specific&#160;array&#160;bounds, the&#160;preferred option is&#160;to&#160;<br/>explicitly&#160;declare&#160;the&#160;array&#160;bounds. For&#160;example, Dim&#160;a(1&#160;To&#160;4). Option&#160;Base&#160;has&#160;risks&#160;in terms&#160;of&#160;<br/>communicating clear documentation and ensuring portability.<br/>
Visual&#160;Basic&#160;handles&#160;Option&#160;Base&#160;1 differently&#160;from&#160;OOo Basic;&#160;VB&#160;changes&#160;the&#160;lower bound to 1 but&#160;does&#160;<br/>not&#160;change&#160;the&#160;upper bound.&#160;Visual&#160;Basic&#160;.NET&#160;no longer supports&#160;Option&#160;Base.&#160;With “Option&#160;Compatible,”<br/>“Option Base&#160;1”&#160;does&#160;not&#160;increase&#160;the&#160;upper bound by&#160;1. In&#160;other words, OOo Basic&#160;acts&#160;like&#160;VB.<br/>
Accessing and changing&#160;the&#160;values&#160;in an array&#160;is&#160;easy.&#160;Initializing an array&#160;this&#160;way&#160;is&#160;tedious.<br/>
<i><b>Listing&#160;18.</b>&#160;Demonstrate&#160;simple&#160;array.<br/></i>Sub&#160;ExampleSimpleArray1<br/>&#160;&#160;Dim&#160;a(2)&#160;As&#160;Integer,&#160;b(-2&#160;To&#160;1)&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;m(1&#160;To&#160;2,&#160;3&#160;To&#160;4)<br/>
47<br/>
<hr/>
<a name=51></a>&#160;&#160;<br/>&#160;&#160;REM Did you know that multiple statements can be placed<br/>&#160;&#160;REM on a single line if separated by a colon?<br/>&#160;&#160;a(0)&#160;=&#160;0&#160; &#160;&#160;:&#160;a(1)&#160;=&#160;1&#160; &#160;:&#160;a(2)&#160;=&#160;2<br/>&#160;&#160;b(-2)&#160;=&#160;-2&#160;&#160;:&#160;b(-1)&#160;=&#160;-1&#160;:&#160;b(0)&#160;=&#160;0&#160;:&#160;b(1)&#160;=&#160;1<br/>&#160;&#160;m(1,&#160;3)&#160;=&#160;3&#160;:&#160;m(1,&#160;4)&#160;=&#160;4<br/>&#160;&#160;m(2,&#160;3)&#160;=&#160;6&#160;:&#160;m(2,&#160;4)&#160;=&#160;8<br/>&#160;&#160;Print&#160;&#34;m(2,3) = &#34;&#160;&amp;&#160;m(2,3)<br/>&#160;&#160;Print&#160;&#34;b(-2) = &#34;&#160;&amp;&#160;b(-2)<br/>End&#160;Sub<br/>
To&#160;quickly&#160;fill&#160;a&#160;Variant&#160;array,&#160;use&#160;the&#160;Array&#160;function (see<a href="libremacros.html#51">&#160;Listing&#160;19), w</a>hich&#160;returns&#160;a&#160;Variant&#160;array&#160;with&#160;the&#160;<br/>included&#160;data.&#160;The&#160;functions&#160;LBound and Ubound return&#160;the&#160;lower bound and upper bound of an array.&#160;<br/>Routines&#160;supported&#160;by&#160;OOo Basic&#160;are&#160;summarized in<a href="libremacros.html#52">&#160;Table&#160;13,</a><b>&#160;</b>and discussed thoroughly&#160;later.<br/>
<i><b>Listing&#160;19.</b>&#160;Use&#160;Array()&#160;to quickly&#160;fill&#160;an array.</i><br/>
Sub&#160;ExampleArrayFunction<br/>&#160;&#160;Dim&#160;a,&#160;i%,&#160;s$<br/>&#160;&#160;a&#160;=&#160;Array(&#34;Zero&#34;,&#160;1,&#160;Pi,&#160;Now)<br/>&#160;&#160;Rem String, Integer, Double, Date<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(a)&#160;To&#160;UBound(a)<br/>&#160; &#160;&#160;s$&#160;=&#160;s$&#160;&amp;&#160;i&#160;&amp;&#160;&#34; : &#34;&#160;&amp;&#160;TypeName(a(i))&#160;&amp;&#160;&#34; : &#34;&#160;&amp;&#160;a(i)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s$,&#160;0,&#160;&#34;Example of the Array Function&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;22.</b>&#160;Different&#160;variable&#160;types&#160;in&#160;the&#160;same&#160;array.</i><br/>
A&#160;variable&#160;defined as&#160;an array&#160;but&#160;not&#160;dimensioned, such as&#160;Dim&#160;a(), is&#160;called&#160;an empty&#160;array.&#160;Test&#160;for an&#160;<br/>empty&#160;array&#160;by&#160;comparing the&#160;upper bound of the&#160;array&#160;to&#160;the&#160;lower bound. If&#160;the&#160;upper bound is&#160;less&#160;than&#160;<br/>the&#160;lower bound, the&#160;array&#160;is&#160;empty&#160;and no dimensions&#160;have&#160;been set.&#160;An array&#160;that&#160;has&#160;been dimensioned,&#160;<br/>such as&#160;Dim&#160;a(5), is&#160;not&#160;empty.<br/>
The&#160;behavior&#160;for LBound and UBound has&#160;changed over time.&#160;Some&#160;releases&#160;of OOo produce&#160;an error for&#160;<br/>UBound(b) and some&#160;do not.&#160;All&#160;versions&#160;should&#160;work correctly&#160;with UBound(b()).&#160;At&#160;the&#160;time&#160;of this&#160;<br/>writing, the&#160;upper and lower array&#160;bounds&#160;for c&#160;(in<a href="libremacros.html#51">&#160;Listing 20)</a>&#160;fails&#160;because&#160;c&#160;is&#160;an empty&#160;object.<br/>
<i><b>Listing&#160;20.</b>&#160;Parentheses&#160;are&#160;not&#160;always&#160;required but&#160;are&#160;always&#160;allowed.</i><br/>
Sub&#160;ArrayDimensionError<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;ErrorHandler<br/>&#160;&#160;Dim&#160;a(),&#160;b(1&#160;To&#160;2),&#160;c<br/>&#160;&#160;Dim&#160;iLine&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;REM Valid constructs<br/>&#160;&#160;iLine&#160;=&#160;1&#160;:&#160;s&#160;=&#160;&#34;a = (&#34;&#160;&amp;&#160;LBound(a())&#160;&amp;&#160;&#34;, &#34;<br/>&#160;&#160;iLine&#160;=&#160;2&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;UBound(a)&#160;&amp;&#160;&#34;)&#34;d<br/>
48<br/>
<hr/>
<a name=52></a>&#160;&#160;iLine&#160;=&#160;3&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;b = (&#34;&#160;&amp;&#160;LBound(b())&#160;&amp;&#160;&#34;, &#34;<br/>&#160;&#160;iLine&#160;=&#160;4&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;UBound(b)&#160;&amp;&#160;&#34;)&#34;<br/>&#160;&#160;iLine&#160;=&#160;5&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;c = (&#34;&#160;&amp;&#160;LBound(c())&#160;&amp;&#160;&#34;, &#34;<br/>&#160;&#160;iLine&#160;=&#160;6&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;UBound(c)&#160;&amp;&#160;&#34;)&#34;<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;LBound and UBound&#34;<br/>&#160;&#160;Exit&#160;Sub<br/>&#160;&#160;ErrorHandler:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;Error &#34;&#160;&amp;&#160;Err&#160;&amp;&#160;&#34;: &#34;&#160;&amp;&#160;Error$&#160;&amp;&#160;&#34; (line : &#34;&#160;&amp;&#160;iLine&#160;&amp;&#160;&#34;)&#34;<br/>&#160;&#160;Resume&#160;Next<br/>End&#160;Sub<br/>
<i><b>Table&#160;13.</b>&#160;Summary&#160;of&#160;subroutines&#160;and functions&#160;related to&#160;arrays.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
Array(args)<br/>
Return a&#160;Variant&#160;array&#160;that&#160;contains the&#160;arguments.<br/>
DimArray(args)<br/>
Return an empty&#160;Variant&#160;array.&#160;The&#160;arguments specify&#160;the&#160;dimension.<br/>
IsArray(var)<br/>
Return&#160;True&#160;if&#160;this variable&#160;is an array,&#160;False&#160;otherwise.<br/>
Join(array)<br/>
Concatenate&#160;the&#160;array&#160;elements&#160;separated&#160;by&#160;the&#160;optional&#160;string&#160;delimiter&#160;and return&#160;<br/>
Join(array,&#160;delimiter)<br/>
as a&#160;String.&#160;The&#160;default&#160;delimiter&#160;is&#160;a&#160;single&#160;space.<br/>
LBound(array)<br/>
Return the&#160;lower&#160;bound of&#160;the&#160;array&#160;argument.&#160;The&#160;optional&#160;dimension specifies&#160;<br/>
LBound(array,&#160;dimension)<br/>
which dimension to check.&#160;The&#160;first&#160;dimension is 1.<br/>
ReDim&#160;var(args)&#160;As&#160;Type<br/>
Change&#160;the&#160;dimension of&#160;an&#160;array&#160;using&#160;the&#160;same&#160;syntax&#160;as the&#160;DIM&#160;statement.&#160;The&#160;<br/>
keyword&#160;Preserve&#160;keeps existing&#160;data&#160;intact&#160;—&#160;ReDim&#160;Preserve&#160;x(1&#160;To&#160;4)&#160;As&#160;Integer.<br/>
Split(str)<br/>
Split&#160;the&#160;string&#160;argument&#160;into&#160;an array&#160;of&#160;strings.&#160;The&#160;default&#160;delimiter&#160;is a&#160;space.&#160;The&#160;<br/>
Split(str,&#160;delimiter)<br/>
optional&#160;argument&#160;“n”&#160;limits the&#160;number&#160;of&#160;strings returned.<br/>
Split(str,&#160;delimiter,&#160;n)<br/>UBound(array)<br/>
Return the&#160;upper&#160;bound of&#160;the&#160;array&#160;argument.&#160;The&#160;optional&#160;dimension specifies&#160;<br/>
UBound(array,&#160;dimension)<br/>
which dimension to check.&#160;The&#160;first&#160;dimension is 1.<br/>
<b>&#160;3.5.1.&#160;Changing&#160;the&#160;dimension&#160;of&#160;an&#160;array<br/></b>The&#160;desired dimension&#160;of an array&#160;is&#160;not&#160;always&#160;known ahead of time. Sometimes, the&#160;dimension&#160;is&#160;known;&#160;<br/>but&#160;it&#160;changes&#160;periodically,&#160;and the&#160;code&#160;must&#160;be&#160;changed.&#160;An array&#160;variable&#160;can be&#160;declared with&#160;or without&#160;<br/>specifying&#160;the&#160;dimensions.&#160;OOo Basic&#160;provides&#160;a&#160;few&#160;different&#160;methods&#160;to&#160;set&#160;or change&#160;the&#160;dimensions&#160;of&#160;<br/>an array.&#160;<br/>
The&#160;Array&#160;function&#160;generates&#160;a&#160;Variant&#160;array&#160;that&#160;contains&#160;data.&#160;This&#160;is&#160;a&#160;quick&#160;way&#160;to&#160;initialize&#160;an array.&#160;You<br/>are&#160;not&#160;required to&#160;set&#160;the&#160;dimension&#160;of the&#160;array,&#160;but, if you do, it&#160;will&#160;change&#160;to&#160;become&#160;the&#160;array&#160;returned&#160;<br/>by&#160;the&#160;Array&#160;function.<br/>
Dim&#160;a()<br/>a&#160;=&#160;Array(3.141592654,&#160;&#34;PI&#34;,&#160;9.81,&#160;&#34;Gravity&#34;)<br/>
The&#160;arguments&#160;passed to the&#160;Array&#160;function&#160;become&#160;data&#160;in&#160;the&#160;returned&#160;Variant&#160;array.&#160;The&#160;DimArray&#160;<br/>function, on the&#160;other hand, interprets&#160;the&#160;arguments&#160;as&#160;the&#160;dimensions&#160;of an array&#160;to create&#160;(see<a href="libremacros.html#52">&#160;Listing 21)</a>.&#160;<br/>The&#160;arguments&#160;can be&#160;expressions, so a&#160;variable&#160;can be&#160;used to&#160;set&#160;the&#160;dimension.&#160;<br/>
<i><b>Listing&#160;21.</b>&#160;Redimension&#160;array.</i><br/>
Sub&#160;ExampleDimArray<br/>&#160;&#160;Dim&#160;a(),&#160;i%<br/>
49<br/>
<hr/>
<a name=53></a>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;a&#160;=&#160;Array(10,&#160;11,&#160;12)<br/>&#160;&#160;s&#160;=&#160;&#34;&#34;&#160;&amp;&#160;LBound(a())&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;UBound(a())&#160; &#160; &#160;&#160;Rem 0 2<br/>&#160;&#160;a()&#160;=&#160;DimArray(3)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;REM the same as Dim a(3)<br/>&#160;&#160;a()&#160;=&#160;DimArray(2,&#160;1)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM the same as Dim a(2,1)<br/>&#160;&#160;i&#160;=&#160;4<br/>&#160;&#160;a&#160;=&#160;DimArray(3,&#160;i)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;Rem the same as Dim a(3,4)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;LBound(a(),1)&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;UBound(a(),1)&#160;&#160;Rem 0, 3<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;LBound(a(),2)&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;UBound(a(),2)&#160;&#160;Rem 0, 4<br/>&#160;&#160;a()&#160;=&#160;DimArray()&#160; &#160; &#160;REM an empty array<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Example Dim Array&#34;<br/>End&#160;Sub<br/>
The&#160;Array&#160;and DimArray&#160;functions&#160;both&#160;return an array&#160;of&#160;Variants.&#160;The&#160;ReDim&#160;statement&#160;changes&#160;the&#160;<br/>dimension of an existing array.&#160;This&#160;can change&#160;both&#160;individual&#160;dimensions&#160;and the&#160;number of dimensions.&#160;<br/>The&#160;arguments&#160;can be&#160;expressions&#160;because&#160;the&#160;ReDim&#160;statement&#160;is&#160;evaluated&#160;at&#160;run time.<br/>
Dim&#160;e()&#160;As&#160;Integer,&#160;i&#160;As&#160;Integer<br/>i&#160;=&#160;4<br/>ReDim&#160;e(5)&#160;As&#160;Integer&#160; &#160; &#160; &#160;REM Dimension is 1, a size of 0 To 5 is valid.<br/>ReDim&#160;e(3&#160;To&#160;10)&#160;As&#160;Integer&#160;REM Dimension is 1, a size of 3 To 10 is valid.<br/>ReDim&#160;e(3,&#160;i)&#160;As&#160;Integer&#160; &#160;&#160;REM Dimension is 2, a size of (0 To 3, 0 To 4) is valid.<br/>
Some&#160;tips&#160;regarding&#160;arrays:<br/>
•<br/>
LBound and UBound work with&#160;empty&#160;arrays.<br/>
•<br/>
An empty&#160;array&#160;has&#160;one&#160;dimension.&#160;The&#160;lower bound is&#160;zero and the&#160;upper bound is&#160;-1.<br/>
•<br/>
Use&#160;ReDim&#160;to cause&#160;an existing array&#160;to become&#160;empty.<br/>
The&#160;ReDim&#160;statement&#160;supports&#160;the&#160;keyword Preserve.&#160;This&#160;attempts&#160;to&#160;save&#160;the&#160;data&#160;when the&#160;dimensions&#160;of<br/>an array&#160;are&#160;changed. Increasing the&#160;dimension of an array&#160;preserves&#160;all&#160;of the&#160;data, but&#160;decreasing the&#160;<br/>dimension causes&#160;data&#160;to&#160;be&#160;lost&#160;by&#160;truncation. Data&#160;can be&#160;truncated at&#160;either end. If&#160;an element&#160;in the&#160;new&#160;<br/>array&#160;existed&#160;in the&#160;old array,&#160;the&#160;value&#160;is&#160;unchanged. Unlike&#160;some&#160;variants&#160;of BASIC, OOo Basic&#160;allows&#160;all&#160;<br/>dimensions&#160;of an array&#160;to be&#160;changed while&#160;still&#160;preserving data.<br/>
Dim&#160;a()&#160;As&#160;Integer<br/>ReDim&#160;a(3,&#160;3,&#160;3)&#160;As&#160;Integer<br/>a(1,1,1)&#160;=&#160;1&#160;:&#160;a(1,&#160;1,&#160;2)&#160;=&#160;2&#160;:&#160;a(2,&#160;1,&#160;1)&#160;=&#160;3<br/>ReDim&#160;preserve&#160;a(-1&#160;To&#160;4,&#160;4,&#160;4)&#160;As&#160;Integer<br/>Print&#160;&#34;(&#34;&#160;&amp;&#160;a(1,1,1)&#160;&amp;&#160;&#34;, &#34;&#160;&amp;&#160;a(1,&#160;1,&#160;2)&#160;&amp;&#160;&#34;, &#34;&#160;&amp;&#160;a(2,&#160;1,&#160;1)&#160;&amp;&#160;&#34;)&#34;<br/>
ReDim&#160;specifies&#160;both&#160;the&#160;dimensions&#160;and an optional&#160;type. If&#160;the&#160;type&#160;is&#160;included,&#160;it&#160;must&#160;match&#160;the&#160;type&#160;<br/>specified&#160;when the&#160;variable&#160;is&#160;declared or OOo generates&#160;a&#160;compile-time&#160;error.&#160;<br/>
<a href="libremacros.html#53">Listing 22&#160;i</a>s&#160;a&#160;utility&#160;function&#160;that&#160;accepts&#160;a&#160;simple&#160;array&#160;and returns&#160;a&#160;string&#160;with&#160;all&#160;of the&#160;elements&#160;in&#160;the&#160;<br/>array.&#160;The&#160;ReDim&#160;example&#160;code, also i<a href="libremacros.html#53">n&#160;Listing&#160;22, us</a>es&#160;ArrayToString.<br/>
<i><b>Listing&#160;22.</b>&#160;Utility&#160;function&#160;array&#160;to&#160;string.</i><br/>
REM ArrayToString accepts a simple array and places the value<br/>REM of each element in the array into a string.<br/>Function&#160;ArrayToString(a()&#160;As&#160;Variant)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;i%,&#160;s$<br/>&#160;&#160;For&#160;i%&#160;=&#160;LBound(a())&#160;To&#160;UBound(a())<br/>&#160; &#160;&#160;s$&#160;=&#160;s$&#160;&amp;&#160;i%&#160;&amp;&#160;&#34; : &#34;&#160;&amp;&#160;a(i%)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>
50<br/>
<hr/>
<a name=54></a>&#160;&#160;ArrayToString&#160;=&#160;s$<br/>End&#160;Function<br/>
Sub&#160;ExampleReDimPreserve<br/>&#160;&#160;Dim&#160;a(5)&#160;As&#160;Integer,&#160;b(),&#160;c()&#160;As&#160;Integer<br/>&#160;&#160;a(0)&#160;=&#160;0&#160;:&#160;a(1)&#160;=&#160;1&#160;:&#160;a(2)&#160;=&#160;2&#160;:&#160;a(3)&#160;=&#160;3&#160;:&#160;a(4)&#160;=&#160;4&#160;:&#160;a(5)&#160;=&#160;5<br/>&#160;&#160;Rem a is dimensioned from 0 to 5 where a(i) = i<br/>&#160;&#160;MsgBox&#160;ArrayToString(a()),&#160;0&#160;,&#160;&#34;a() at start&#34;<br/>
&#160;&#160;Rem a is re-dimensioned from 1 to 3 where a(i) = i<br/>&#160;&#160;ReDim&#160;Preserve&#160;a(1&#160;To&#160;3)&#160;As&#160;Integer<br/>&#160;&#160;MsgBox&#160;ArrayToString(a()),&#160;0&#160;,&#160;&#34;a() after ReDim&#34;<br/>
&#160;&#160;Rem Array() returns a Variant type<br/>&#160;&#160;Rem b is dimensioned from 0 to 9 where b(i) = i+1<br/>&#160;&#160;b&#160;=&#160;Array(1,&#160;2,&#160;3,&#160;4,&#160;5,&#160;6,&#160;7,&#160;8,&#160;9,&#160;10)<br/>&#160;&#160;MsgBox&#160;ArrayToString(b()),&#160;0&#160;,&#160;&#34;b() at initial assignment&#34;<br/>
&#160;&#160;Rem b is dimensioned from 1 to 3 where b(i) = i+1<br/>&#160;&#160;ReDim&#160;Preserve&#160;b(1&#160;To&#160;3)<br/>&#160;&#160;MsgBox&#160;ArrayToString(b()),&#160;0&#160;,&#160;&#34;b() after ReDim&#34;<br/>
&#160;&#160;Rem The following is NOT valid because the array is already dimensioned<br/>&#160;&#160;Rem to a different size&#160;<br/>&#160;&#160;Rem a = Array(0, 1, 2, 3, 4, 5)<br/>&#160;&#160;<br/>&#160;&#160;Rem c is dimensioned from 0 to 5 where c(i) = i<br/>&#160;&#160;Rem If &#34;ReDim&#34; had been done on c, then this would NOT work<br/>&#160;&#160;c&#160;=&#160;Array(0,&#160;1,&#160;2,&#160;&#34;three&#34;,&#160;4,&#160;5)<br/>&#160;&#160;MsgBox&#160;ArrayToString(c()),&#160;0&#160;,&#160;&#34;Integer array c() Assigned to a Variant&#34;<br/>
&#160;&#160;Rem Ironically, this is allowed but c will contain no data!<br/>&#160;&#160;ReDim&#160;Preserve&#160;c(1&#160;To&#160;3)&#160;As&#160;Integer<br/>&#160;&#160;MsgBox&#160;ArrayToString(c()),&#160;0&#160;,&#160;&#34;ReDim Integer c() after assigned Variant&#34;<br/>End&#160;Sub<br/>
Visual&#160;Basic&#160;has&#160;different&#160;rules&#160;for changing the&#160;dimensions&#160;of an array,&#160;and these&#160;rules&#160;change&#160;between&#160;<br/>versions&#160;of&#160;Visual&#160;Basic.&#160;As&#160;a&#160;general&#160;rule, OOo Basic&#160;is&#160;more&#160;flexible.<br/>
<b>&#160;3.5.2.&#160;The&#160;unexpected&#160;behavior&#160;of&#160;arrays<br/></b>Assigning one&#160;Integer variable&#160;to&#160;another copies&#160;the&#160;value, and the&#160;variables&#160;are&#160;not&#160;related&#160;in any&#160;other way.<br/>In&#160;other words, if you&#160;change&#160;the&#160;first&#160;variable’s&#160;value,&#160;the&#160;second variable’s&#160;value&#160;does&#160;not&#160;change.&#160;This&#160;is&#160;<br/>not&#160;true&#160;for array&#160;variables.&#160;Assigning&#160;one&#160;array&#160;variable&#160;to another makes&#160;a&#160;reference&#160;to the&#160;first&#160;array&#160;rather<br/>than copying the&#160;data.&#160;All&#160;changes&#160;made&#160;to&#160;either are&#160;automatically&#160;seen by&#160;the&#160;other.&#160;It&#160;doesn’t&#160;matter which<br/>one&#160;is&#160;changed;&#160;they&#160;are&#160;both affected.&#160;This&#160;is&#160;the&#160;difference&#160;between “pass&#160;by&#160;<i>value</i>”&#160;(integers) and “pass&#160;by<br/><i>reference</i>”&#160;(arrays).<br/>
<i><b>Listing&#160;23.</b>&#160;Arrays&#160;copy&#160;as&#160;references.<br/></i>Sub&#160;ExampleArrayCopyIsRef<br/>&#160;&#160;Dim&#160;a(5)&#160;As&#160;Integer,&#160;c(4)&#160;As&#160;Integer,&#160;s$<br/>&#160;&#160;c(0)&#160;=&#160;4&#160;:&#160;c(1)&#160;=&#160;3&#160;:&#160;c(2)&#160;=&#160;2&#160;:&#160;c(3)&#160;=&#160;1&#160;:&#160;c(4)&#160;=&#160;0<br/>&#160;&#160;a()&#160;=&#160;c()<br/>
51<br/>
<hr/>
<a name=55></a>&#160;&#160;a(1)&#160;=&#160;7<br/>&#160;&#160;c(2)&#160;=&#160;10<br/>&#160;&#160;s$&#160;=&#160;&#34;**** a() *****&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;ArrayToString(a())&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;CHR$(10)&#160;&amp;&#160;&#34;**** c() *****&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;ArrayToString(c())<br/>&#160;&#160;MsgBox&#160;s$,&#160;0&#160;,&#160;&#34;Change One, Change Both&#34;<br/>End&#160;Sub<br/>
To&#160;illustrate&#160;that&#160;arrays&#160;are&#160;assigned by&#160;reference, create&#160;three&#160;arrays&#160;—&#160;a(), b(), and c()&#160;—&#160;as&#160;shown i<a href="libremacros.html#55">n<br/>Figure&#160;23. I</a>nternally,&#160;OOo Basic&#160;creates&#160;three&#160;arrays&#160;that&#160;are&#160;referenced by&#160;a(), b(), and c().<br/>
<i><b>Figure&#160;23.</b>&#160;Assigning&#160;an array&#160;assigns&#160;a reference.</i><br/>
Assign array&#160;a() to&#160;array&#160;b(), and both&#160;a() and b() reference&#160;the&#160;same&#160;data.&#160;The&#160;variable&#160;a() does&#160;not&#160;<br/>reference&#160;the&#160;variable&#160;b(), it&#160;references&#160;the&#160;same&#160;data&#160;referenced by&#160;b() (see<a href="libremacros.html#55">&#160;Figure&#160;24).&#160;</a>Therefore, changing&#160;<br/>a() also changes&#160;b().&#160;The&#160;original&#160;array&#160;referenced by&#160;a() is&#160;no longer referenced.&#160;<br/>
<i><b>Figure&#160;24.</b>&#160;Assigning&#160;an array&#160;assigns&#160;a reference.</i><br/>
Assign array&#160;b() to array&#160;c(), and both&#160;b() and c() reference&#160;the&#160;same&#160;data.&#160;The&#160;variable&#160;a() remains&#160;<br/>unchanged, as&#160;shown i<a href="libremacros.html#55">n&#160;Figure&#160;25.</a><br/>
<i><b>Figure&#160;25.</b>&#160;Assigning&#160;an array&#160;assigns&#160;a reference.</i><br/>
<b>TIP</b><br/>
Type&#160;checking&#160;is not&#160;performed&#160;when&#160;an array&#160;is&#160;assigned&#160;to another&#160;array.&#160;Do&#160;not&#160;assign&#160;arrays of&#160;<br/>different&#160;types&#160;to each other.<br/>
Because&#160;no type&#160;checking is&#160;performed when an array&#160;is&#160;assigned to&#160;another array,&#160;unexpected&#160;and obscure&#160;<br/>problems&#160;can occur.&#160;The&#160;Array&#160;function&#160;returns&#160;a&#160;Variant&#160;array,&#160;and is&#160;the&#160;quickest&#160;method&#160;to&#160;assign multiple<br/>values&#160;to an array&#160;variable.&#160;An obvious&#160;problem&#160;is&#160;that&#160;an Integer array&#160;may&#160;contain&#160;String&#160;values&#160;if&#160;it&#160;<br/>
52<br/>
<hr/>
<a name=56></a>references&#160;a&#160;Variant&#160;array.&#160;A&#160;less&#160;obvious&#160;problem&#160;is&#160;that&#160;the&#160;ReDim&#160;statement&#160;works&#160;based on the&#160;declared&#160;<br/>type.&#160;The&#160;statement&#160;“ReDim&#160;Preserve”&#160;on an Integer array&#160;assigned to&#160;a&#160;Variant&#160;array&#160;fails&#160;to&#160;preserve&#160;the&#160;<br/>data.<br/>
Dim&#160;a()&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM Declare a() as an Integer()<br/>a()&#160;=&#160;Array(0,&#160;1,&#160;2,&#160;3,&#160;4,&#160;5,&#160;6)&#160; &#160;&#160;REM Assign a Variant() to an Integer()<br/>ReDim&#160;Preserve&#160;a(1&#160;To&#160;3)&#160;As&#160;Integer&#160;REM This wipes the array<br/>
To&#160;safely&#160;assign arrays&#160;while&#160;maintaining the&#160;correct&#160;data&#160;type, another method is&#160;required. Copy&#160;each&#160;<br/>element&#160;in&#160;the&#160;array&#160;individually.&#160;This&#160;also&#160;prevents&#160;two array&#160;variables&#160;from&#160;referencing the&#160;same&#160;array.<br/>
<i><b>Listing&#160;24.</b>&#160;More&#160;complex&#160;array&#160;example.<br/></i>Sub&#160;ExampleSetIntArray<br/>&#160;&#160;Dim&#160;iA()&#160;As&#160;Integer<br/>&#160;&#160;SetIntArray(iA,&#160;Array(9,&#160;8,&#160;&#34;7&#34;,&#160;&#34;six&#34;))<br/>&#160;&#160;MsgBox&#160;ArrayToString(iA),&#160;0,&#160;&#34;Assign a Variant to an Integer&#34;<br/>End&#160;Sub<br/>
REM Dimension the first array to have the same dimensions as the second.<br/>REM Perform an element-by-element copy of the array.<br/>Sub&#160;SetIntArray(iArray()&#160;As&#160;Integer,&#160;v()&#160;As&#160;Variant)<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Long<br/>&#160;&#160;ReDim&#160;iArray(LBound(v())&#160;To&#160;UBound(v()))&#160;As&#160;Integer<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(v)&#160;To&#160;UBound(v)<br/>&#160; &#160;&#160;iArray(i)&#160;=&#160;v(i)<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
<i><b>&#160;3.6.&#160;Subroutines&#160;and&#160;functions<br/></b></i>Subroutines&#160;are&#160;used to&#160;group lines&#160;of code&#160;into meaningful&#160;pieces&#160;of work.&#160;A&#160;function is&#160;a&#160;subroutine&#160;that&#160;<br/>returns&#160;a&#160;value.&#160;The&#160;use&#160;of subroutines&#160;and functions&#160;facilitates&#160;testing, code&#160;reuse, and readability.&#160;This&#160;in&#160;<br/>turn reduces&#160;errors.&#160;<br/>
The&#160;keyword Sub defines&#160;the&#160;beginning of a&#160;subroutine,&#160;and End&#160;Sub defines&#160;the&#160;end of a&#160;subroutine.<br/>
Sub&#160;FirstSub<br/>&#160;&#160;Print&#160;&#34;Running FirstSub&#34;<br/>End&#160;Sub<br/>
To&#160;use&#160;a&#160;subroutine, place&#160;the&#160;name&#160;of the&#160;subroutine&#160;that&#160;you want&#160;to&#160;call&#160;on a&#160;line.&#160;The&#160;name&#160;can&#160;<br/>optionally&#160;be&#160;preceded by&#160;the&#160;keyword Call.<br/>
Sub&#160;Main<br/>&#160;&#160;Call&#160;FirstSub&#160;' Call Sub FirstSub<br/>&#160;&#160;FirstSub&#160; &#160; &#160;&#160;' Call Sub FirstSub again<br/>End&#160;Sub<br/>
Subroutine&#160;and function&#160;names&#160;must&#160;be&#160;unique&#160;in&#160;a&#160;module.&#160;They&#160;are&#160;subject&#160;to&#160;the&#160;same&#160;naming&#160;<br/>conventions&#160;as&#160;variables, including&#160;the&#160;use&#160;of spaces&#160;in&#160;their names.<br/>
Sub&#160;One<br/>&#160;&#160;[name&#160;with&#160;space]<br/>End&#160;Sub<br/>Sub&#160;[name&#160;with&#160;space]<br/>&#160;&#160;Print&#160;&#34;I am here&#34;<br/>
53<br/>
<hr/>
<a name=57></a>End&#160;Sub<br/>
Visual&#160;Basic&#160;allows&#160;a&#160;subroutine&#160;to&#160;be&#160;preceded by&#160;optional&#160;keywords&#160;such as&#160;Public&#160;or Private. Starting&#160;<br/>with OOo 2.0, you can define&#160;a&#160;routine&#160;as&#160;public&#160;or private, but&#160;the&#160;routine&#160;is&#160;always&#160;public&#160;unless&#160;<br/>CompatibilityMode(True) is&#160;used first.<br/>
Declare&#160;a&#160;subroutine&#160;as&#160;private&#160;by&#160;preceding Sub with the&#160;keyword Private.<br/>
Private&#160;Sub&#160;PrivSub<br/>&#160;&#160;Print&#160;&#34;In Private Sub&#34;<br/>&#160;&#160;bbxx&#160;=&#160;4<br/>End&#160;Sub<br/>
Using&#160;Option&#160;Compatibile&#160;is&#160;not&#160;sufficient&#160;to&#160;enable&#160;Private&#160;scope, CompatibilityMode(True) must&#160;be&#160;used.<br/>
Sub&#160;TestPrivateSub<br/>&#160;&#160;CompatibilityMode(False)&#160;'Required only if CompatibilityMode(True) already used.<br/>&#160;&#160;Call&#160;PrivSub()&#160; &#160; &#160; &#160; &#160; &#160;'This call works.<br/>&#160;&#160;CompatibilityMode(True)&#160;&#160;'This is required, even if Option Compatible is used<br/>&#160;&#160;Call&#160;PrivSub()&#160; &#160; &#160; &#160; &#160; &#160;'Runtime error (if PrivSub is in a different module).<br/>End&#160;Sub<br/>
The&#160;keyword Function&#160;is&#160;used to&#160;declare&#160;a&#160;function which, like&#160;a&#160;variable, can define&#160;the&#160;type&#160;it&#160;returns. If&#160;<br/>the&#160;type&#160;is&#160;not&#160;declared, the&#160;return type&#160;defaults&#160;to&#160;Variant.&#160;You can assign the&#160;return value&#160;at&#160;any&#160;point&#160;and&#160;<br/>as&#160;many&#160;times&#160;as&#160;you want&#160;before&#160;the&#160;function ends.&#160;The&#160;last&#160;value&#160;assigned is&#160;returned.<br/>
Sub&#160;test<br/>&#160;&#160;Print&#160;&#34;The function returns &#34;&#160;&amp;&#160;TestFunc<br/>End&#160;Sub<br/>Function&#160;TestFunc&#160;As&#160;String<br/>&#160;&#160;TestFunc&#160;=&#160;&#34;hello&#34;<br/>End&#160;Function<br/>
<b>&#160;3.6.1.&#160;Arguments<br/></b>A&#160;variable&#160;that&#160;is&#160;passed to a&#160;routine&#160;is&#160;called&#160;an argument.&#160;Arguments&#160;must&#160;be&#160;declared.&#160;The&#160;same&#160;rules&#160;for&#160;<br/>declaring variable&#160;types&#160;apply&#160;to&#160;declaring argument&#160;types.<br/>
A&#160;routine&#160;name&#160;can optionally&#160;be&#160;followed by&#160;parentheses, both&#160;when it&#160;is&#160;defined and when it&#160;is&#160;called.&#160;A&#160;<br/>routine&#160;that&#160;accepts&#160;arguments&#160;can optionally&#160;enclose&#160;the&#160;argument&#160;list&#160;in&#160;parentheses.&#160;The&#160;argument&#160;list&#160;<br/>follows&#160;the&#160;routine&#160;name&#160;on the&#160;same&#160;line. Blank space&#160;is&#160;allowed between the&#160;name&#160;of the&#160;routine&#160;and the&#160;<br/>argument&#160;list.<br/>
<i><b>Listing&#160;25.</b>&#160;Simple&#160;argument&#160;testing.</i><br/>
Sub&#160;ExampleParamTest1()<br/>&#160;&#160;Call&#160;ParamTest1(2,&#160;&#34;Two&#34;)<br/>&#160;&#160;Call&#160;ParamTest1&#160;1,&#160;&#34;One&#34;<br/>End&#160;Sub<br/>Sub&#160;ParamTest1(i&#160;As&#160;Integer,&#160;s$)<br/>&#160;&#160;Print&#160;&#34;Integer = &#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; String = &#34;&#160;&amp;&#160;s$<br/>End&#160;Sub<br/>
<i><b>Pass&#160;by&#160;reference&#160;or&#160;by&#160;value<br/></b></i>By&#160;default,&#160;arguments&#160;are&#160;passed by&#160;reference&#160;rather than&#160;by&#160;value. In&#160;other words, when the&#160;called&#160;<br/>subroutine&#160;modifies&#160;an argument,&#160;the&#160;caller sees&#160;the&#160;change.&#160;You can override&#160;this&#160;behavior&#160;by&#160;using the&#160;<br/>
54<br/>
<hr/>
<a name=58></a>ByVal&#160;keyword.&#160;This&#160;causes&#160;a&#160;copy&#160;of the&#160;argument&#160;(rather than a&#160;reference&#160;to&#160;the&#160;argument) to&#160;be&#160;sent&#160;(se<a href="libremacros.html#58">e<br/>Listing 26&#160;and&#160;Figure&#160;26)</a>.<br/>
<b>TIP</b><br/>
Constants passed&#160;as arguments by&#160;reference&#160;cause&#160;unexpected&#160;behavior&#160;if&#160;their&#160;value&#160;is modified&#160;in the&#160;<br/>
called&#160;routine.&#160;The&#160;value&#160;may&#160;arbitrarily&#160;change&#160;back inside&#160;the&#160;called&#160;routine.&#160;For&#160;example,&#160;I&#160;had&#160;a&#160;<br/>subroutine&#160;that&#160;was&#160;supposed&#160;to decrement&#160;an Integer&#160;argument&#160;in a&#160;loop&#160;until&#160;it&#160;was&#160;zero;&#160;the&#160;argument&#160;<br/>
never&#160;became&#160;zero.<br/>
<i><b>Listing&#160;26.</b>&#160;Arguments&#160;by&#160;reference&#160;and by&#160;value.</i><br/>
Sub&#160;ExampleArgumentValAndRef()<br/>&#160;&#160;Dim&#160;i1%,&#160;i2%<br/>&#160;&#160;i1&#160;=&#160;1&#160;:&#160;i2&#160;=&#160;1<br/>&#160;&#160;ArgumentValAndRef(i1,&#160;i2)<br/>&#160;&#160;MsgBox&#160;&#34;Argument passed by reference was 1 and is now &#34;&#160;&amp;&#160;i1&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#34;Argument passed by value was 1 and is still &#34;&#160;&amp;&#160;i2&#160;&amp;&#160;CHR$(10)<br/>End&#160;Sub<br/>Sub&#160;ArgumentValAndRef(iRef%,&#160;ByVal&#160;iVal)<br/>&#160;&#160;iRef&#160;=&#160;iRef&#160;+&#160;1&#160;&#160;' This will affect the caller<br/>&#160;&#160;iVal&#160;=&#160;iVal&#160;-&#160;1&#160;&#160;' This will not affect the caller<br/>End&#160;Sub<br/>
<i><b>Figure&#160;26.</b>&#160;Pass&#160;by&#160;reference&#160;allows&#160;changes&#160;to&#160;be&#160;passed back&#160;to the&#160;caller.</i><br/>
Visual&#160;Basic&#160;supports&#160;the&#160;optional&#160;keyword ByRef.&#160;This&#160;keyword was&#160;introduced into OOo Basic&#160;starting&#160;<br/>with OOo 2.0. Note&#160;that&#160;pass&#160;by&#160;reference&#160;is&#160;the&#160;default&#160;behavior.<br/>
A&#160;variable&#160;cannot&#160;be&#160;passed by&#160;value&#160;if the&#160;type&#160;does&#160;not&#160;match.&#160;The&#160;macros&#160;i<a href="libremacros.html#58">n&#160;Listing&#160;27&#160;and&#160;Listing&#160;28&#160;<br/></a>differ in the&#160;type&#160;used to&#160;declare&#160;the&#160;argument.&#160;<br/>
<i><b>Listing&#160;27.</b>&#160;Simple&#160;swap with&#160;a string&#160;argument.<br/></i>Sub&#160;sSwap(&#160;sDatum&#160;As&#160;String&#160;)<br/>&#160;&#160;Dim&#160;asDatum(1&#160;to&#160;3)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;sDummy&#160;As&#160;String<br/>
&#160;&#160;asDatum=Split(sDatum,&#160;&#34;.&#34;)<br/>&#160;&#160;sDummy=asDatum(0)<br/>&#160;&#160;asDatum(0)=asDatum(2)<br/>&#160;&#160;asDatum(2)=sDummy<br/>&#160;&#160;sDatum=Join(asDatum,&#34;-&#34;)<br/>End&#160;Sub&#160;<br/>
<i><b>Listing&#160;28.</b>&#160;Simple&#160;swap with&#160;a variant&#160;argument.</i><br/>
Sub&#160;vSwap(&#160;vDatum&#160;As&#160;Variant&#160;)<br/>&#160;&#160;Dim&#160;asDatum(1&#160;to&#160;3)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;sDummy&#160;As&#160;String<br/>
&#160;&#160;asDatum=Split(vDatum,&#160;&#34;.&#34;)<br/>
55<br/>
<hr/>
<a name=59></a>&#160;&#160;sDummy=asDatum(0)<br/>&#160;&#160;asDatum(0)=asDatum(2)<br/>&#160;&#160;asDatum(2)=sDummy<br/>&#160;&#160;vDatum=Join(asDatum,&#34;-&#34;)<br/>End&#160;Sub&#160;<br/>
The&#160;following&#160;macro uses&#160;a&#160;variant&#160;and a&#160;string to call&#160;a&#160;macro that&#160;accepts&#160;a&#160;variant,&#160;and the&#160;macro that&#160;<br/>accepts&#160;the&#160;string. Passing a&#160;variant&#160;to&#160;a&#160;method&#160;that&#160;accepts&#160;a&#160;string argument&#160;basses&#160;the&#160;value&#160;by&#160;reference.<br/>The&#160;unexpected&#160;thing is&#160;that&#160;passing a&#160;string to&#160;the&#160;method that&#160;accepts&#160;a&#160;variant,&#160;passes&#160;the&#160;value&#160;by&#160;<br/>reference.<br/>
<i><b>Listing&#160;29.</b>&#160;Test&#160;reference&#160;by&#160;argument&#160;type.<br/></i>Sub&#160;passByReferenceTester<br/>&#160;&#160;Dim&#160;vVar&#160;As&#160;Variant<br/>&#160;&#160;Dim&#160;sVar&#160;As&#160;string<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>
&#160;&#160;vVar=&#34;01.02.2011&#34;<br/>&#160;&#160;sVar=&#34;01.02.2011&#34;<br/>
&#160;&#160;s&#160;=&#160;vVar&#160;&amp;&#160;&#34; sSwap( variant var string param ) ==&gt; &#34;<br/>&#160;&#160;sSwap(vVar)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vVar&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sVar&#160;&amp;&#160;&#34; sSwap( string var string param ) ==&gt; &#34;<br/>&#160;&#160;sSwap(sVar)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sVar&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;vVar=&#34;01.02.2011&#34;<br/>&#160;&#160;sVar=&#34;01.02.2011&#34;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vVar&#160;&amp;&#160;&#34; vSwap( variant var variant param ) ==&gt; &#34;<br/>&#160;&#160;vSwap(vVar)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vVar&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sVar&#160;&amp;&#160;&#34; vSwap( string var variant param ) ==&gt; &#34;<br/>&#160;&#160;vSwap(sVar)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sVar&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;MsgBox(s)<br/>End&#160;Sub<br/>
It&#160;is&#160;important&#160;that&#160;you&#160;understand&#160;when a&#160;variable&#160;is&#160;passed to a&#160;method&#160;as&#160;a&#160;reference&#160;or a&#160;value.&#160;It&#160;is&#160;<br/>equally&#160;important&#160;to understand when the&#160;value&#160;contained in&#160;a&#160;variable&#160;is&#160;copied&#160;by&#160;value&#160;or copied by&#160;<br/>reference.&#160;<br/>
•<br/>
Variables&#160;with simple&#160;types&#160;copy&#160;by&#160;value;&#160;for example,&#160;assigning one&#160;integer variable&#160;to&#160;another.<br/>
•<br/>
Arrays&#160;always&#160;copy&#160;by&#160;reference. If&#160;you assign one&#160;array&#160;to another,&#160;both&#160;variables&#160;reference&#160;and&#160;<br/>modify&#160;the&#160;same&#160;array.<br/>
•<br/>
UNO&#160;Services&#160;copy&#160;by&#160;reference.&#160;This&#160;means&#160;that&#160;you can do things&#160;such as&#160;oDoc&#160;=&#160;<br/>ThisComponent,&#160;and both variables&#160;reference&#160;the&#160;same&#160;object.<br/>
•<br/>
Structs&#160;copy&#160;by&#160;value.&#160;This&#160;frustrates&#160;many&#160;people&#160;when they&#160;first&#160;encounter the&#160;behavior,&#160;but&#160;there&#160;<br/>is&#160;a&#160;very&#160;good reason for it.&#160;First,&#160;the&#160;problem;&#160;&#160;oBorder.TopLine.OuterLineWidth&#160;=&#160;2&#160;<br/>
56<br/>
<hr/>
<a name=60></a>fails&#160;because&#160;TopLine&#160;is&#160;a&#160;struct&#160;and the&#160;value&#160;is&#160;returned as&#160;a&#160;copy&#160;rather than&#160;a&#160;reference.&#160;The&#160;code&#160;<br/>as&#160;shown changes&#160;the&#160;outer line&#160;width&#160;on a&#160;copy&#160;of the&#160;struct&#160;rather than&#160;the&#160;struct&#160;associated&#160;with&#160;<br/>the&#160;border object.&#160;The&#160;correct&#160;way&#160;to&#160;change&#160;the&#160;border is&#160;(v&#160;=&#160;&#160;oBorder.TopLine&#160;:&#160;&#160;<br/>v.OuterLineWidth&#160;=&#160;2&#160;:&#160;oBorder.TopLine&#160;=&#160;v).<br/>
A&#160;lead developer claimed that&#160;one&#160;or two services&#160;and strutcs&#160;do not&#160;assign /&#160;copy&#160;as&#160;expected, but&#160;he&#160;could&#160;<br/>not&#160;remember which. I&#160;have&#160;not&#160;encountered the&#160;objects&#160;that&#160;violate&#160;the&#160;guidelines,&#160;but, I&#160;try&#160;to&#160;remember&#160;<br/>the&#160;problem&#160;so that&#160;I&#160;am&#160;not&#160;taken unaware.<br/>
<i><b>Optional&#160;arguments<br/></b></i>You can declare&#160;arguments&#160;as&#160;optional&#160;by&#160;preceding them&#160;with the&#160;keyword Optional.&#160;All&#160;of the&#160;arguments&#160;<br/>following&#160;an optional&#160;argument&#160;must&#160;also be&#160;optional. Use&#160;the&#160;IsMissing function&#160;to determine&#160;if an optional<br/>argument&#160;is&#160;missing.<br/>
<i><b>Listing&#160;30.</b>&#160;Optional&#160;arguments.<br/></i>REM Make test calls with optional arguments.<br/>REM Calls with Integer and Variant arguments should yield the same result.<br/>REM Unfortunately, they do not.<br/>Sub&#160;ExampleArgOptional()<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;s&#160;=&#160;&#34;Variant Arguments () =&gt; &#34;&#160; &#160; &#160;&amp;&#160;TestOpt()&#160; &#160; &#160;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Integer Arguments () =&gt; &#34;&#160; &#160; &#160;&amp;&#160;TestOptI()&#160; &#160; &#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;---------------------------------------------&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Variant Arguments (,,) =&gt; &#34;&#160; &#160;&amp;&#160;TestOpt(,,)&#160; &#160;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Integer Arguments (,,) =&gt; &#34;&#160; &#160;&amp;&#160;TestOptI(,,)&#160; &#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;---------------------------------------------&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Variant Arguments (1) =&gt; &#34;&#160; &#160;&#160;&amp;&#160;TestOpt(1)&#160; &#160; &#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Integer Arguments (1) =&gt; &#34;&#160; &#160;&#160;&amp;&#160;TestOptI(1)&#160; &#160;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;---------------------------------------------&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Variant Arguments (,2) =&gt; &#34;&#160; &#160;&amp;&#160;TestOpt(,2)&#160; &#160;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Integer Arguments (,2) =&gt; &#34;&#160; &#160;&amp;&#160;TestOptI(,2)&#160; &#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;---------------------------------------------&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Variant Arguments (1,2) =&gt; &#34;&#160;&#160;&amp;&#160;TestOpt(1,2)&#160; &#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Integer Arguments (1,2) =&gt; &#34;&#160;&#160;&amp;&#160;TestOptI(1,2)&#160;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;---------------------------------------------&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Variant Arguments (1,,3) =&gt; &#34;&#160;&amp;&#160;TestOpt(1,,3)&#160;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Integer Arguments (1,,3) =&gt; &#34;&#160;&amp;&#160;TestOptI(1,,3)&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160; &#160;<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Optional Arguments of Type Variant or Integer&#34;<br/>End&#160;Sub<br/>
REM Return a string that contains each argument. If the argument<br/>REM is missing, then an M is used in its place.<br/>Function&#160;TestOpt(Optional&#160;v1,&#160;Optional&#160;v2,&#160;Optional&#160;v3)&#160;As&#160;String<br/>&#160;&#160;TestOpt&#160;=&#160;&#34;&#34;&#160;&amp;&#160;IIF(IsMissing(v1),&#160;&#34;M&#34;,&#160;Str(v1))&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;IIF(IsMissing(v2),&#160;&#34;M&#34;,&#160;Str(v2))&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;IIF(IsMissing(v3),&#160;&#34;M&#34;,&#160;Str(v3))<br/>End&#160;Function<br/>
REM Return a string that contains each argument. If the argument<br/>REM is missing, then an M is used in its place.<br/>Function&#160;TestOptI(Optional&#160;i1%,&#160;Optional&#160;i2%,&#160;Optional&#160;i3%)&#160;As&#160;String<br/>&#160;&#160;TestOptI&#160;=&#160;&#34;&#34;&#160;&amp;&#160;IIF(IsMissing(i1),&#160;&#34;M&#34;,&#160;Str(i1))&#160;&amp;_<br/>
57<br/>
<hr/>
<a name=61></a>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;IIF(IsMissing(i2),&#160;&#34;M&#34;,&#160;Str(i2))&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;IIF(IsMissing(i3),&#160;&#34;M&#34;,&#160;Str(i3))<br/>End&#160;Function<br/>
You can omit&#160;any&#160;optional&#160;arguments<a href="libremacros.html#60">.&#160;Listing 30&#160;de</a>monstrates&#160;two functions&#160;that&#160;accept&#160;optional&#160;arguments.<br/>The&#160;functions&#160;are&#160;the&#160;same&#160;except&#160;for the&#160;argument&#160;types. Each function returns&#160;a&#160;string containing the&#160;<br/>argument&#160;values&#160;concatenated&#160;together.&#160;Missing arguments&#160;are&#160;represented&#160;by&#160;the&#160;letter “M”&#160;in&#160;the&#160;string.&#160;<br/>Although the&#160;return values&#160;from&#160;TestOpt&#160;and&#160;TestOpt1&#160;should&#160;be&#160;the&#160;same&#160;for the&#160;same&#160;argument&#160;lists, they&#160;<br/>are&#160;not&#160;(see<a href="libremacros.html#61">&#160;Figure&#160;27)</a>.&#160;This&#160;is&#160;a&#160;bug.<br/>
<b>TIP</b><br/>
The&#160;IsMissing&#160;function&#160;returns incorrect&#160;results&#160;for&#160;variables that&#160;are&#160;not&#160;of&#160;type&#160;Variant&#160;when&#160;the&#160;missing&#160;<br/>
argument&#160;is followed&#160;by&#160;a&#160;comma.<br/>
<i><b>Figure&#160;27.</b>&#160;In rare&#160;cases, non-Variant&#160;optional&#160;arguments&#160;fail.</i><br/>
<i><b>Default&#160;argument&#160;values<br/></b></i>OOo version 2.0 introduced default&#160;values&#160;for missing arguments.&#160;This&#160;allows&#160;a&#160;default&#160;value&#160;to&#160;be&#160;specified<br/>if an optional&#160;argument&#160;is&#160;missing.&#160;You must&#160;use&#160;the&#160;keywords&#160;“Option&#160;Compatible”&#160;for default&#160;values&#160;to&#160;<br/>work.<br/>
Option&#160;Compatible<br/>Sub&#160;DefaultExample(Optional&#160;n&#160;as&#160;Integer=100)<br/>&#160;&#160;REM If IsMissing(n) Then n = 100 'I will not have to do this anymore!<br/>&#160;&#160;Print&#160;n<br/>End&#160;Sub<br/>
<b>&#160;3.6.2.&#160;Recursive&#160;routines<br/></b>A&#160;recursive&#160;routine&#160;calls&#160;itself. Consider calculating the&#160;mathematical&#160;function Factorial&#160;for positive&#160;<br/>integers.&#160;The&#160;usual&#160;definition is&#160;recursive.&#160;<br/>
<i><b>Listing&#160;31.</b>&#160;Recursively&#160;generate&#160;factorial.<br/></i>Sub&#160;DoFactorial<br/>&#160;&#160;Print&#160;&#34;Recursive Factorial = &#34;&#160;&amp;&#160;RecursiveFactorial(4)<br/>
58<br/>
<hr/>
<a name=62></a>&#160;&#160;Print&#160;&#34;Iterative Factorial = &#34;&#160;&amp;&#160;IterativeFactorial(4)<br/>End&#160;Sub<br/>
Function&#160;IterativeFactorial(ByVal&#160;n&#160;As&#160;Long)&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;answer&#160;As&#160;Long<br/>&#160;&#160;answer&#160;=&#160;1<br/>&#160;&#160;Do&#160;While&#160;n&#160;&gt;&#160;1<br/>&#160; &#160;&#160;answer&#160;=&#160;answer&#160;*&#160;n<br/>&#160; &#160;&#160;n&#160;=&#160;n&#160;-&#160;1<br/>&#160;&#160;Loop<br/>&#160;&#160;IterativeFactorial&#160;=&#160;answer<br/>End&#160;Function<br/>
' This finally works in version 1.1<br/>Function&#160;RecursiveFactorial(ByVal&#160;n&#160;As&#160;Long)&#160;As&#160;Long<br/>&#160;&#160;RecursiveFactorial&#160;=&#160;1<br/>&#160;&#160;If&#160;n&#160;&gt;&#160;1&#160;Then&#160;RecursiveFactorial&#160;=&#160;n&#160;*&#160;RecursiveFactorial(n-1)<br/>End&#160;Function<br/>
Computers&#160;use&#160;a&#160;data&#160;structure&#160;called&#160;a&#160;stack.&#160;At&#160;home,&#160;I&#160;have&#160;a&#160;stack of books&#160;that&#160;I&#160;want&#160;to read.&#160;When&#160;I&#160;<br/>receive&#160;a&#160;new&#160;book, I&#160;place&#160;it&#160;on top of the&#160;stack.&#160;When&#160;I&#160;have&#160;time&#160;to&#160;read, I&#160;take&#160;the&#160;top book from&#160;the&#160;<br/>stack.&#160;This&#160;is&#160;similar to&#160;the&#160;data&#160;structure&#160;that&#160;a&#160;computer uses:&#160;a&#160;section&#160;of memory&#160;in&#160;a&#160;computer for&#160;<br/>temporary&#160;storage&#160;in which the&#160;last&#160;item&#160;stored is&#160;the&#160;first&#160;retrieved. Stacks&#160;are&#160;usually&#160;used when a&#160;<br/>computer calls&#160;a&#160;routine&#160;and passes&#160;arguments.&#160;A&#160;typical&#160;procedure&#160;follows:<br/>
1.&#160;Push the&#160;current&#160;run location&#160;onto the&#160;stack.<br/>
2.&#160;Push each argument&#160;onto&#160;the&#160;stack.<br/>
3.&#160;Call&#160;the&#160;desired function&#160;or subroutine.<br/>
4.&#160;The&#160;called routine&#160;uses&#160;the&#160;arguments&#160;from&#160;the&#160;stack.<br/>
5.&#160;The&#160;called routine&#160;frequently&#160;uses&#160;the&#160;stack to&#160;store&#160;its&#160;own variables.<br/>
6.&#160;The&#160;called routine&#160;removes&#160;the&#160;arguments&#160;from&#160;the&#160;stack.<br/>
7.&#160;The&#160;called routine&#160;removes&#160;and saves&#160;the&#160;caller’s&#160;location&#160;from&#160;the&#160;stack.<br/>
8.&#160;If&#160;the&#160;called&#160;routine&#160;is&#160;a&#160;function,&#160;the&#160;return value&#160;is&#160;placed on the&#160;stack.<br/>
9.&#160;The&#160;called routine&#160;returns&#160;to&#160;the&#160;caller from&#160;the&#160;saved location&#160;on the&#160;stack.<br/>
10.&#160;If&#160;the&#160;called&#160;routine&#160;is&#160;a&#160;function,&#160;the&#160;return value&#160;is&#160;taken from&#160;the&#160;stack.<br/>
Although various&#160;optimizations&#160;are&#160;used, there&#160;is&#160;always&#160;some&#160;overhead associated with&#160;calling subroutines&#160;<br/>and functions.&#160;There&#160;is&#160;overhead in&#160;running time&#160;and in&#160;the&#160;memory&#160;required.&#160;The&#160;recursive&#160;version of&#160;<br/>Factorial&#160;continually&#160;calls&#160;itself.&#160;While&#160;calculating the&#160;factorial&#160;of four,&#160;there&#160;is&#160;one&#160;point&#160;at&#160;which&#160;the&#160;stack&#160;<br/>contains&#160;information&#160;for calls&#160;for 4, 3, 2, and 1. For&#160;some&#160;functions&#160;—&#160;the&#160;Fibonacci&#160;series, for example&#160;—&#160;<br/>this&#160;call&#160;behavior may&#160;be&#160;prohibitive,&#160;and a&#160;non-recursive&#160;algorithm&#160;should&#160;be&#160;used instead.<br/>
<i><b>&#160;3.7.&#160;Scope&#160;of&#160;variables,&#160;subroutines,&#160;and&#160;functions<br/></b></i>The&#160;idea&#160;of scope&#160;deals&#160;with&#160;the&#160;lifetime&#160;and visibility&#160;of a&#160;variable, subroutine,&#160;or function&#160;in&#160;OOo Basic.&#160;<br/>The&#160;scope&#160;depends&#160;on the&#160;location of the&#160;declaration,&#160;and the&#160;keywords&#160;Public, Private, Static,&#160;and Global.&#160;<br/>Dim&#160;is&#160;equivalent&#160;to&#160;Private, but&#160;variables&#160;are&#160;Private&#160;only&#160;if CompatibilityMode(True) is&#160;used.<br/>
59<br/>
<hr/>
<a name=63></a><b>&#160;3.7.1.&#160;Local&#160;variables&#160;defined&#160;in&#160;a&#160;subroutine&#160;or&#160;function&#160;<br/></b>Variables&#160;declared inside&#160;a&#160;subroutine&#160;or function are&#160;called local&#160;variables. It&#160;is&#160;also commonly&#160;said&#160;that&#160;a&#160;<br/>variable&#160;is&#160;local&#160;to&#160;a&#160;routine&#160;if the&#160;variable&#160;is&#160;declared inside&#160;that&#160;routine.<br/>
You can declare&#160;a&#160;variable&#160;inside&#160;a&#160;subroutine&#160;or function by&#160;using the&#160;Dim&#160;keyword.&#160;Variables&#160;defined&#160;<br/>inside&#160;a&#160;routine&#160;are&#160;visible&#160;only&#160;inside&#160;that&#160;routine. It&#160;is&#160;not&#160;possible&#160;to&#160;directly&#160;access&#160;a&#160;variable&#160;defined&#160;<br/>inside&#160;a&#160;routine&#160;from&#160;outside&#160;the&#160;routine.&#160;However,&#160;it&#160;is&#160;possible&#160;to&#160;access&#160;a&#160;variable&#160;defined outside&#160;any&#160;<br/>routine&#160;—&#160;for example, in&#160;a&#160;module&#160;header&#160;—&#160;from&#160;inside&#160;a&#160;routine.&#160;When a&#160;variable&#160;or routine&#160;name&#160;is&#160;<br/>encountered inside&#160;a&#160;routine, OOo Basic&#160;starts&#160;looking for the&#160;variable&#160;or routine&#160;in the&#160;following order:&#160;<br/>current&#160;routine,&#160;module,&#160;library,&#160;and other open libraries. In&#160;other words, it&#160;starts&#160;inside&#160;and works&#160;its&#160;way&#160;<br/>out.<br/>
Variables&#160;defined&#160;in a&#160;routine&#160;are&#160;created and initialized each time&#160;the&#160;routine&#160;is&#160;entered.&#160;The&#160;variables&#160;are&#160;<br/>destroyed every&#160;time&#160;the&#160;routine&#160;is&#160;exited because&#160;the&#160;routine&#160;is&#160;finished. Leaving the&#160;routine&#160;to&#160;call&#160;another&#160;<br/>routine&#160;does&#160;not&#160;cause&#160;the&#160;variables&#160;to&#160;be&#160;reinitialized.&#160;<br/>
Use&#160;the&#160;keyword Static&#160;to&#160;change&#160;a&#160;variable’s&#160;creation and destruction&#160;times&#160;to&#160;the&#160;calling&#160;macro’s&#160;start&#160;and&#160;<br/>finish times,&#160;respectively.&#160;Although the&#160;variable&#160;is&#160;visible&#160;only&#160;in&#160;the&#160;routine&#160;containing the&#160;variable, the&#160;<br/>variable&#160;is&#160;initialized&#160;once&#160;when the&#160;macro starts&#160;running, and the&#160;variable's&#160;values&#160;are&#160;retained&#160;through&#160;<br/>multiple&#160;calls&#160;to&#160;the&#160;same&#160;routine.&#160;In&#160;other words, you&#160;start&#160;with no macro running.&#160;The&#160;first&#160;time&#160;that&#160;a&#160;<br/>subroutine&#160;or function that&#160;contains&#160;a&#160;static&#160;variable&#160;is&#160;called, the&#160;static&#160;variables&#160;contain&#160;initial&#160;values&#160;based<br/>on their types.&#160;The&#160;static&#160;variables&#160;retain their values&#160;between calls&#160;as&#160;long as&#160;the&#160;macro as&#160;a&#160;whole&#160;did not&#160;<br/>stop running.&#160;The&#160;keyword Static&#160;uses&#160;the&#160;same&#160;syntax&#160;as&#160;the&#160;keyword Dim,&#160;and is&#160;valid only&#160;inside&#160;a&#160;<br/>subroutine&#160;or functi<a href="libremacros.html#63">on.&#160;Listing&#160;32&#160;c</a>alls&#160;a&#160;routine&#160;that&#160;uses&#160;a&#160;static&#160;variable.<br/>
<i><b>Listing&#160;32.</b>&#160;Static&#160;example.<br/></i>Sub&#160;ExampleStatic<br/>&#160;&#160;ExampleStaticWorker()<br/>&#160;&#160;ExampleStaticWorker()<br/>End&#160;Sub<br/>
Sub&#160;ExampleStaticWorker<br/>&#160;&#160;Static&#160;iStatic1&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;iNonStatic&#160;As&#160;Integer<br/>&#160;&#160;<br/>&#160;&#160;iNonStatic&#160;=&#160;iNonStatic&#160;+&#160;1<br/>&#160;&#160;iStatic1&#160;=&#160;iStatic1&#160;+&#160;1<br/>&#160;&#160;Msgbox&#160;&#34;iNonStatic = &#34;&#160;&amp;&#160;iNonStatic&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#34;iStatic1 = &#34;&#160;&amp;&#160;iStatic1<br/>End&#160;Sub<br/>
<b>&#160;3.7.2.&#160;Variables&#160;defined&#160;in&#160;a&#160;module<br/></b>The&#160;Dim, Global,&#160;Public, or Private&#160;statements&#160;are&#160;used to&#160;declare&#160;variables&#160;in&#160;a&#160;module&#160;header.&#160;Global,&#160;<br/>Public, and Private&#160;use&#160;the&#160;same&#160;syntax&#160;as&#160;the&#160;Dim&#160;statement, but&#160;they&#160;can’t&#160;declare&#160;variables&#160;inside&#160;a&#160;<br/>subroutine&#160;or function. Each variable&#160;type&#160;has&#160;a&#160;different&#160;life&#160;cycle, as&#160;summarized in<a href="libremacros.html#64">&#160;Table&#160;14.</a><br/>
The&#160;keywords&#160;Static, Public,&#160;Private, and Global&#160;are&#160;not&#160;used as&#160;modifiers&#160;to&#160;the&#160;keyword Dim;&#160;they&#160;are&#160;<br/>used instead of the&#160;keyword Dim.<br/>
Although it&#160;is&#160;sometimes&#160;necessary&#160;to&#160;define&#160;a&#160;variable&#160;in a&#160;module&#160;header,&#160;you should&#160;avoid it&#160;if possible.&#160;<br/>Variables&#160;defined&#160;in the&#160;header can be&#160;seen in&#160;other modules&#160;that&#160;don’t&#160;expect&#160;them.&#160;It’s&#160;difficult&#160;to&#160;<br/>
60<br/>
<hr/>
<a name=64></a>determine&#160;why&#160;the&#160;compiler claims&#160;that&#160;a&#160;variable&#160;is&#160;already&#160;defined if it&#160;is&#160;defined&#160;in another library&#160;or&#160;<br/>module.&#160;Even worse, two working libraries&#160;may&#160;stop working because&#160;of naming conflicts.<br/>
<i><b>Table&#160;14.</b>&#160;Life&#160;cycle&#160;of&#160;a variable&#160;defined in&#160;a module&#160;header.</i><br/>
<i><b>Keyword</b></i><br/>
<i><b>Initialized</b></i><br/>
<i><b>Dies</b></i><br/>
<i><b>Scope</b></i><br/>
Global<br/>
Compile&#160;time<br/>
Compile&#160;time<br/>
All&#160;modules and libraries.<br/>
Public<br/>
Macro&#160;start<br/>
Macro&#160;finish<br/>
Declaring&#160;library&#160;container.<br/>
Dim<br/>
Macro&#160;start<br/>
Macro&#160;finish<br/>
Declaring&#160;library&#160;container.<br/>
Private<br/>
Macro&#160;start<br/>
Macro&#160;finish<br/>
Declaring&#160;module.<br/>
<i><b>Global<br/></b></i>Use&#160;Global&#160;to&#160;declare&#160;a&#160;variable&#160;that&#160;is&#160;available&#160;to every&#160;module&#160;in every&#160;library.&#160;The&#160;library&#160;containing the&#160;<br/>Global&#160;variable&#160;must&#160;be&#160;loaded for the&#160;variable&#160;to&#160;be&#160;visible.&#160;<br/>
When&#160;a&#160;library&#160;is&#160;loaded,&#160;it&#160;is&#160;automatically&#160;compiled&#160;and made&#160;ready&#160;for use;&#160;this&#160;is&#160;when a&#160;Global&#160;variable<br/>is&#160;initialized. Changes&#160;made&#160;to&#160;a&#160;Global&#160;variable&#160;are&#160;seen by&#160;every&#160;module&#160;and are&#160;persisted&#160;even after the&#160;<br/>macro is&#160;finished. Global&#160;variables&#160;are&#160;reset&#160;when the&#160;containing&#160;library&#160;is&#160;compiled.&#160;Exiting and restarting&#160;<br/>OpenOffice.org&#160;causes&#160;all&#160;libraries&#160;to be&#160;compiled&#160;and all&#160;Global&#160;variables&#160;to be&#160;initialized. Modifying&#160;the&#160;<br/>module&#160;containing the&#160;Global&#160;definition&#160;also forces&#160;the&#160;module&#160;to be&#160;recompiled.<br/>
Global&#160;iNumberOfTimesRun<br/>
Variables&#160;declared Global&#160;are&#160;similar to&#160;variables&#160;declared Static, but&#160;Static&#160;works&#160;only&#160;for local&#160;variables,&#160;<br/>and Global&#160;works&#160;only&#160;for variables&#160;declared in&#160;the&#160;header.<br/>
<i><b>Public<br/></b></i>Use&#160;Public&#160;to&#160;declare&#160;a&#160;variable&#160;that&#160;is&#160;visible&#160;to all&#160;modules&#160;in&#160;the&#160;declaring library&#160;container.&#160;Outside&#160;the&#160;<br/>declaring library&#160;container,&#160;the&#160;public&#160;variables&#160;aren’t&#160;visible.&#160;Public&#160;variables&#160;are&#160;initialized every&#160;time&#160;a&#160;<br/>macro runs.<br/>
An application&#160;library&#160;is&#160;a&#160;library&#160;that&#160;is&#160;declared in&#160;the&#160;“OpenOffice.org”&#160;library&#160;container.&#160;This&#160;is&#160;available&#160;<br/>when OOo is&#160;running, is&#160;stored in&#160;its&#160;own directory,&#160;and every&#160;document&#160;can view&#160;it. Document-level&#160;<br/>libraries&#160;are&#160;stored in&#160;OOo documents.&#160;The&#160;libraries&#160;are&#160;saved as&#160;part&#160;of the&#160;document&#160;and are&#160;not&#160;visible&#160;<br/>outside&#160;the&#160;document.<br/>
Public&#160;variables&#160;declared in&#160;an application&#160;library&#160;are&#160;visible&#160;in every&#160;OOo document-level&#160;library.&#160;Public&#160;<br/>variables&#160;declared in&#160;a&#160;library&#160;contained&#160;in an OOo document&#160;are&#160;not&#160;visible&#160;in&#160;application-level&#160;libraries.&#160;<br/>Declaring a&#160;Public&#160;variable&#160;in&#160;a&#160;document&#160;library&#160;effectively&#160;hides&#160;a&#160;Public&#160;variable&#160;declared in&#160;an&#160;<br/>application&#160;library.&#160;Simply&#160;stated (see<a href="libremacros.html#64">&#160;Table&#160;15)</a>, if&#160;you&#160;declare&#160;a&#160;Public&#160;variable&#160;in a&#160;document,&#160;it&#160;is&#160;visible&#160;<br/>only&#160;in the&#160;document&#160;and it&#160;will&#160;hide&#160;a&#160;Public&#160;variable&#160;with&#160;the&#160;same&#160;name&#160;declared outside&#160;the&#160;document.&#160;A<br/>Public&#160;variable&#160;declared in the&#160;application is&#160;visible&#160;everywhere&#160;—&#160;unless&#160;a&#160;variable&#160;declaration&#160;with more&#160;<br/>local&#160;scope&#160;takes&#160;priority&#160;over the&#160;declaration&#160;with more&#160;global&#160;scope.<br/>
Public&#160;oDialog&#160;As&#160;Object<br/>
<i><b>Table&#160;15.</b>&#160;The&#160;scope&#160;of&#160;a Public&#160;variable&#160;depends&#160;on where&#160;it&#160;is&#160;declared.</i><br/>
<i><b>Declaration&#160;Location</b></i><br/>
<i><b>Scope</b></i><br/>
Application<br/>
Visible&#160;everywhere.<br/>
Document<br/>
Visible&#160;only&#160;in the&#160;declaring&#160;document.<br/>
Application and&#160;Document<br/>
Macros in the&#160;document&#160;are&#160;unable&#160;to see&#160;the&#160;application-level&#160;variable.<br/>
61<br/>
<hr/>
<a name=65></a><i><b>Private&#160;or&#160;Dim<br/></b></i>Use&#160;Private&#160;or Dim&#160;to declare&#160;a&#160;variable&#160;in a&#160;module&#160;that&#160;should not&#160;be&#160;visible&#160;in&#160;another module.&#160;Private&#160;<br/>variables, like&#160;Public&#160;variables, are&#160;initialized every&#160;time&#160;a&#160;macro runs.&#160;A&#160;single&#160;variable&#160;name&#160;may&#160;be&#160;used&#160;<br/>by&#160;two different&#160;modules&#160;as&#160;their own variable&#160;if the&#160;variable&#160;is&#160;declared Private.<br/>
Private&#160;oDialog&#160;As&#160;Variant<br/>
•<br/>
Declaring a&#160;variable&#160;using&#160;Dim&#160;is&#160;equivalent&#160;to declaring a&#160;variable&#160;as&#160;Private.&#160;<br/>
•<br/>
Private&#160;variables&#160;are&#160;only&#160;private, however,&#160;only&#160;with CompatibilityMode(True).&#160;<br/>
•<br/>
Option Compatible&#160;has&#160;no affect&#160;on private&#160;variables.<br/>
A&#160;Private&#160;variable&#160;is&#160;visible&#160;outside&#160;the&#160;declaring module&#160;unless&#160;CompatibilityMode(True) is&#160;used.&#160;To&#160;see&#160;<br/>for yourself, create&#160;two modules&#160;—&#160;Module1 and Module2&#160;—&#160;in the&#160;same&#160;library.&#160;In&#160;Module1,&#160;add the&#160;<br/>declaration “Private&#160;priv_var&#160;As&#160;Integer”. Macros&#160;in Module2&#160;can use&#160;the&#160;variable&#160;“priv_var”. Even if&#160;<br/>Module2 is&#160;located in&#160;a&#160;different&#160;library&#160;in&#160;the&#160;same&#160;document,&#160;the&#160;variable&#160;“priv_var”&#160;is&#160;visible&#160;and usable.&#160;<br/>If&#160;CompatibilityMode(True) is&#160;used, however,&#160;then the&#160;private&#160;variable&#160;is&#160;no longer visible&#160;outside&#160;of the&#160;<br/>declaring module.<br/>
In&#160;Module1, declare&#160;a&#160;variable&#160;“Private&#160;priv_var&#160;As&#160;Double”.&#160;A&#160;variable&#160;of the&#160;same&#160;name&#160;is&#160;declared in&#160;<br/>Module2, but&#160;it&#160;is&#160;an Integer variable. Each module&#160;sees&#160;its&#160;own Private&#160;variable. Changing these&#160;two&#160;<br/>variables&#160;to have&#160;Public&#160;scope&#160;rather than Private&#160;introduces&#160;an ugly&#160;situation;&#160;only&#160;one&#160;of these&#160;is&#160;visible&#160;<br/>and usable,&#160;but&#160;you don’t&#160;know&#160;which&#160;one&#160;it&#160;is&#160;without&#160;performing a&#160;test.&#160;Assign the&#160;value&#160;4.7 to&#160;the&#160;<br/>variable, and see&#160;if it&#160;is&#160;an Integer or a&#160;Double.<br/>
<i><b>&#160;3.8.&#160;Operators<br/></b></i>An operator&#160;is&#160;a&#160;symbol&#160;that&#160;denotes&#160;or performs&#160;a&#160;mathematical&#160;or logical&#160;operation.&#160;An operator,&#160;like&#160;a&#160;<br/>function, returns&#160;a&#160;result.&#160;For example, the&#160;+&#160;operator adds&#160;two numbers.&#160;The&#160;arguments&#160;to&#160;the&#160;operator are&#160;<br/>called operands. Operators&#160;are&#160;assigned a&#160;precedence.&#160;An operator&#160;with a&#160;precedence&#160;of 1 is&#160;said&#160;to have&#160;a&#160;<br/>high precedence&#160;level;&#160;it&#160;is,&#160;after all,&#160;number 1!<br/>
<b>TIP</b><br/>
While&#160;typesetting&#160;mathematical&#160;equations, the&#160;minus sign (−)&#160;is&#160;represented using&#160;the&#160;Unicode&#160;character&#160;<br/>
U+2212.&#160;With&#160;OOo Basic,&#160;however,&#160;ASCII&#160;code&#160;45&#160;(-)&#160;must&#160;be&#160;used instead.<br/>
In&#160;OOo Basic&#160;(see<a href="libremacros.html#65">&#160;Table&#160;16)</a>, operators&#160;are&#160;evaluated from&#160;left&#160;to right&#160;with the&#160;restriction&#160;that&#160;an operator&#160;<br/>with a&#160;higher precedence&#160;is&#160;used before&#160;an operator with&#160;a&#160;lower precedence. For&#160;example, 1 +&#160;2 * 3&#160;<br/>evaluates&#160;to&#160;7 because&#160;multiplication&#160;has&#160;higher precedence&#160;than addition.&#160;Parentheses&#160;may&#160;be&#160;used to&#160;<br/>modify&#160;the&#160;order of evaluation. For example,&#160;(1+2) * 3 evaluates&#160;to&#160;9 because&#160;the&#160;expression&#160;inside&#160;the&#160;<br/>parentheses&#160;is&#160;evaluated&#160;first.&#160;<br/>
<i><b>Table&#160;16.</b>&#160;Operators&#160;supported by&#160;OpenOffice.org&#160;Basic.</i><br/>
<i><b>Precedence</b></i><br/>
<i><b>Operator</b></i><br/>
<i><b>Type</b></i><br/>
<i><b>Description</b></i><br/>
1<br/>
NOT<br/>
Unary<br/>
Logical&#160;or&#160;bit-wise&#160;NOT<br/>
1<br/>
-<br/>
Unary<br/>
Leading&#160;minus&#160;sign, negation<br/>
1<br/>
+<br/>
Unary<br/>
Leading&#160;plus sign<br/>
^<br/>
Binary<br/>
Numerical&#160;exponentiation.&#160;Standard&#160;mathematical&#160;precedence&#160;<br/>
2<br/>
would have&#160;exponentiation higher&#160;than negation.&#160;<br/>
62<br/>
<hr/>
<a name=66></a><i><b>Precedence</b></i><br/>
<i><b>Operator</b></i><br/>
<i><b>Type</b></i><br/>
<i><b>Description</b></i><br/>
3<br/>
*<br/>
Binary<br/>
Numerical&#160;multiplication<br/>
3<br/>
/<br/>
Binary<br/>
Numerical&#160;division<br/>
4<br/>
MOD<br/>
Binary<br/>
Numerical&#160;remainder&#160;after&#160;division<br/>
5<br/>
\<br/>
Binary<br/>
Integer&#160;division<br/>
6<br/>
-<br/>
Binary<br/>
Numerical&#160;subtraction<br/>
6<br/>
+<br/>
Binary<br/>
Numerical&#160;addition&#160;and&#160;string&#160;concatenation<br/>
7<br/>
&amp;<br/>
Binary<br/>
String&#160;concatenation<br/>
8<br/>
IS<br/>
Binary<br/>
Do both operands&#160;reference&#160;the&#160;same&#160;object?<br/>
8<br/>
=<br/>
Binary<br/>
Equals<br/>
8<br/>
&lt;<br/>
Binary<br/>
Less than<br/>
8<br/>
&gt;<br/>
Binary<br/>
Greater&#160;than<br/>
8<br/>
&lt;=<br/>
Binary<br/>
Less than or&#160;equal&#160;to<br/>
8<br/>
&gt;=<br/>
Binary<br/>
Greater&#160;than&#160;or&#160;equal&#160;to<br/>
8<br/>
&lt;&gt;<br/>
Binary<br/>
Not&#160;equal<br/>
9<br/>
AND<br/>
Binary<br/>
Bit-wise&#160;for&#160;numerics and logical&#160;for&#160;Boolean<br/>
9<br/>
OR<br/>
Binary<br/>
Bit-wise&#160;for&#160;numerics and logical&#160;for&#160;Boolean<br/>
9<br/>
XOR<br/>
Binary<br/>
Exclusive&#160;OR,&#160;bit-wise&#160;for&#160;numerics and logical&#160;for&#160;Boolean<br/>
9<br/>
EQV<br/>
Binary<br/>
Equivalence,&#160;bit-wise&#160;for&#160;numerics&#160;and&#160;logical&#160;for&#160;Boolean<br/>
9<br/>
IMP<br/>
Binary<br/>
Implication bit-wise&#160;for&#160;numerics and&#160;logical&#160;for&#160;Boolean.<br/>
<b>TIP</b><br/>
OOo Precedence&#160;does not&#160;follow&#160;standard&#160;mathematical&#160;rules;&#160;for&#160;example,&#160;negation should have&#160;a&#160;lower&#160;<br/>
precedence&#160;than&#160;exponentiation so -1^2&#160;should be&#160;-1,&#160;not&#160;1.<br/>
Visual&#160;Basic&#160;uses&#160;a&#160;different&#160;precedence&#160;for operators&#160;— for example, numerical&#160;exponentiation and&#160;<br/>negation are&#160;switched,&#160;as&#160;are&#160;integer division and remainder after division.<br/>
The&#160;word “binary”&#160;means&#160;something made&#160;of or based on two things. “Unary”&#160;means&#160;something made&#160;of or&#160;<br/>based on one&#160;thing.&#160;A&#160;binary&#160;operator,&#160;not&#160;to be&#160;confused with&#160;a&#160;binary&#160;number,&#160;is&#160;placed between two&#160;<br/>operands. For&#160;example, the&#160;addition operator&#160;uses&#160;two operands&#160;with&#160;1+2. In&#160;OOo Basic, binary&#160;operators&#160;<br/>are&#160;always&#160;evaluated from&#160;left&#160;to right&#160;based on operator&#160;precedence.&#160;A&#160;unary&#160;operator requires&#160;one&#160;operand&#160;<br/>that&#160;is&#160;placed directly&#160;to the&#160;right&#160;of the&#160;operator.&#160;For example,&#160;-&#160;(1 +&#160;3). By&#160;necessity, a&#160;series&#160;of unary&#160;<br/>operators&#160;are&#160;evaluated&#160;right&#160;to&#160;left. For example,&#160;+&#160;- (1+3) must&#160;evaluate&#160;the&#160;rightmost&#160;negation&#160;operator&#160;<br/>first.<br/>
<b>&#160;3.8.1.&#160;Mathematical&#160;and&#160;string&#160;operators<br/></b>Mathematical&#160;operators&#160;can be&#160;used with all&#160;numerical&#160;data&#160;types.&#160;When operands&#160;of different&#160;types&#160;are&#160;<br/>mixed,&#160;a&#160;conversion is&#160;made&#160;to&#160;minimize&#160;the&#160;loss&#160;of precision.&#160;For&#160;example, 1 +&#160;3.443 causes&#160;a&#160;conversion&#160;<br/>to a&#160;floating-point&#160;number rather than&#160;a&#160;conversion to&#160;an Integer.&#160;If&#160;the&#160;first&#160;operand is&#160;a&#160;number and the&#160;<br/>second operand is&#160;a&#160;string, the&#160;string is&#160;converted&#160;to a&#160;number.&#160;If&#160;the&#160;string does&#160;not&#160;contain&#160;a&#160;valid&#160;<br/>numerical&#160;value,&#160;a&#160;zero is&#160;returned and no error is&#160;generated.&#160;Assigning&#160;a&#160;string directly&#160;to&#160;a&#160;numeric&#160;<br/>variable, however,&#160;always&#160;assigns&#160;the&#160;value&#160;zero and no errors&#160;are&#160;generated.<br/>
63<br/>
<hr/>
<a name=67></a><i><b>Listing&#160;33.</b>&#160;Strings&#160;are&#160;automatically&#160;converted to numbers&#160;when required.<br/></i>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;i&#160;=&#160;&#34;abc&#34;&#160; &#160; &#160; &#160;&#160;'Assigning a string with no numbers yields zero not an error<br/>&#160;&#160;Print&#160;i&#160; &#160; &#160; &#160; &#160;&#160;'0<br/>&#160;&#160;i&#160;=&#160;&#34;3abc&#34;&#160; &#160; &#160; &#160;'Assigns 3, automatically converts as it can.<br/>&#160;&#160;Print&#160;i&#160; &#160; &#160; &#160; &#160;&#160;'3<br/>&#160;&#160;Print&#160;4&#160;+&#160;&#34;abc&#34;&#160;&#160;'4<br/>
OOo Basic&#160;tries&#160;to&#160;automatically&#160;convert&#160;types. No errors&#160;are&#160;generated&#160;when a&#160;string is&#160;used where&#160;a&#160;<br/>number is&#160;required.&#160;This&#160;is&#160;discussed in depth&#160;later.<br/>
<i><b>Unary&#160;plus&#160;(+)&#160;and&#160;minus&#160;(-)<br/></b></i>OOo Basic&#160;allows&#160;unary&#160;operators&#160;to&#160;have&#160;spaces&#160;between the&#160;operator and the&#160;operand (see<a href="libremacros.html#41">&#160;Table&#160;9)</a>. Unary<br/>operators&#160;also have&#160;the&#160;highest&#160;precedence&#160;and are&#160;evaluated&#160;from&#160;right&#160;to&#160;left.&#160;A&#160;leading plus&#160;sign is&#160;<br/>arguably&#160;useless&#160;—&#160;it&#160;emphasizes&#160;that&#160;a&#160;constant&#160;is&#160;not&#160;negative&#160;but&#160;is&#160;otherwise&#160;effectively&#160;ignored.&#160;A&#160;<br/>leading&#160;minus&#160;sign indicates&#160;numeric&#160;negation.&#160;<br/>
<i><b>Exponentiation&#160;(^)<br/></b></i>Numerical&#160;exponentiation&#160;supports&#160;integer and floating-point&#160;exponents.&#160;The&#160;exponentiation operator can&#160;<br/>operate&#160;on a&#160;negative&#160;number only&#160;if the&#160;exponent&#160;is&#160;an integer.<br/>
result&#160;=&#160;number^exponent<br/>
A&#160;positive&#160;integer exponent&#160;has&#160;a&#160;conceptually&#160;simple&#160;representation.&#160;The&#160;number is&#160;multiplied&#160;by&#160;itself&#160;<br/>exponent&#160;times.&#160;For&#160;example, 2^4 =&#160;2 * 2 * 2 * 2.<br/>
1.&#160;OOo does&#160;not&#160;follow&#160;standard mathematical&#160;rules&#160;for exponentiation:<br/>
2.&#160;Exponentiation has&#160;a&#160;lower precedence&#160;than&#160;negation, so -1^2 incorrectly&#160;evaluates&#160;to&#160;1.<br/>
OOo Basic&#160;evaluates&#160;multiple&#160;exponents&#160;(2^3^4) left&#160;to right&#160;((2^3)^4), while&#160;standard mathematical<br/>precedence&#160;evaluates&#160;right&#160;to&#160;left. (2^(3^4)).<br/>
<i><b>Listing&#160;34.</b>&#160;Demonstrate&#160;exponentiation.</i><br/>
Sub&#160;ExampleExponent<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;s&#160;=&#160;&#34;2^3 = &#34;&#160;&amp;&#160;2^3&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM 2*2*2 = 8<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;3^2 = &#34;&#160;&amp;&#160;3^2&#160; &#160; &#160; &#160;REM 3 *3 = 9<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;-3^2 = &#34;&#160;&amp;&#160;-3^2&#160; &#160; &#160;REM (-3) * (-3) = 9<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;2^3^2 = &#34;&#160;&amp;&#160;2^3^2&#160; &#160;REM 2^3^2 = 8^2 = 64<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;4^0.5 = &#34;&#160;&amp;&#160;4^.5&#160; &#160;&#160;REM 2<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;4^-0.5 = &#34;&#160;&amp;&#160;4^-.5&#160;&#160;REM .5<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;-1^2 = &#34;&#160;&amp;&#160;-1^2&#160; &#160; &#160;REM 1<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;-(1^2) = &#34;&#160;&amp;&#160;-(1^2)&#160;REM -1<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
64<br/>
<hr/>
<a name=68></a><i><b>Figure&#160;28.</b>&#160;Using the&#160;exponentiation operator.</i><br/>
<i><b>Multiplication&#160;(*)&#160;and&#160;Division&#160;(/)<br/></b></i>Multiplication and division&#160;have&#160;the&#160;same&#160;precedence.<br/>
<i><b>Listing&#160;35.</b>&#160;Demonstrate&#160;multiplication and division.<br/></i>Sub&#160;ExampleMultDiv<br/>&#160;&#160;Print&#160;&#34;2*3 = &#34;&#160;&amp;&#160;2*3&#160; &#160; &#160; &#160;REM 6<br/>&#160;&#160;Print&#160;&#34;4/2.0 = &#34;&#160;&amp;&#160;4/2.0&#160; &#160;REM 2<br/>&#160;&#160;Print&#160;&#34;-3/2 = &#34;&#160;&amp;&#160;-3/2&#160; &#160; &#160;REM -1.5<br/>&#160;&#160;Print&#160;&#34;4*3/2 = &#34;&#160;&amp;&#160;4*3/2&#160; &#160;REM 6<br/>End&#160;Sub<br/>
<i><b>Remainder&#160;after&#160;division&#160;(MOD)<br/></b></i>The&#160;MOD&#160;operator is&#160;also called “remainder after division.”&#160;For example,&#160;5 MOD&#160;2 is&#160;1 because&#160;5 divided&#160;<br/>by&#160;2 is&#160;2 with a&#160;remainder of 1.&#160;All&#160;operands&#160;are&#160;rounded to&#160;Integer values&#160;before&#160;the&#160;operation is&#160;performed.<br/>
<i><b>Listing&#160;36.</b>&#160;Definition of&#160;the&#160;MOD&#160;operator&#160;for&#160;integer&#160;operands&#160;x&#160;and y.</i><br/>
x&#160;MOD&#160;y&#160;=&#160;x&#160;-&#160;(y&#160;*&#160;(x\y))<br/>
<i><b>Listing&#160;37.</b>&#160;Demonstrate&#160;mod operator.</i><br/>
REM x MOD y can also be written as<br/>REM CInt(x) - (CInt(y) * (CInt(x)\CInt(y)))<br/>REM CInt is used because the numbers must be rounded<br/>REM before the operations are performed.<br/>Sub&#160;ExampleMOD<br/>&#160;&#160;Dim&#160;x(),&#160;y(),&#160;s$,&#160;i%<br/>&#160;&#160;x()&#160;=&#160;Array&#160;(4,&#160;15,&#160;6,&#160;6.4,&#160;6.5,&#160;-15,&#160;15,&#160;-15)<br/>&#160;&#160;y()&#160;=&#160;Array&#160;(15,&#160;6,&#160;3,&#160;3,&#160; &#160;3,&#160; &#160; &#160;8,&#160;-8,&#160;&#160;-8)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(x())&#160;To&#160;UBound(x())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;x(i)&#160;&amp;&#160;&#34; MOD &#34;&#160;&amp;&#160;y(i)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;(x(i)&#160;MOD&#160;y(i))&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;MOD operator&#34;<br/>End&#160;Sub<br/>
65<br/>
<hr/>
<a name=69></a><i><b>Figure&#160;29.</b>&#160;Using the&#160;MOD&#160;operator.</i><br/>
<b>TIP</b><br/>
The&#160;operands for&#160;MOD&#160;are&#160;rounded to&#160;Integer&#160;values before&#160;the&#160;division is done.<br/>
<i><b>Integer&#160;division&#160;(\)<br/></b></i>Regular division expects&#160;to&#160;divide&#160;a&#160;Double&#160;by&#160;a&#160;Double,&#160;and it&#160;returns&#160;a&#160;Double&#160;as&#160;an answer.&#160;For example,<br/>7.0 /&#160;4.0 is&#160;1.75. Integer division, on the&#160;other hand, expects&#160;to&#160;divide&#160;two Integers, and it&#160;returns&#160;an Integer&#160;<br/>as&#160;an answer.&#160;For example,&#160;7.2 \&#160;4.3 converts&#160;the&#160;operands&#160;to&#160;7 \&#160;4 and then returns&#160;1.&#160;The&#160;numeric&#160;constant&#160;<br/>operands&#160;used with&#160;the&#160;Integer division&#160;operator are&#160;truncated&#160;to Integer values, and then Integer division&#160;is&#160;<br/>performed.&#160;The&#160;result&#160;is&#160;a&#160;truncated result,&#160;not&#160;a&#160;rounded result.<a href="libremacros.html#69">&#160;Listing 38&#160;c</a>ompares&#160;the&#160;difference&#160;between&#160;<br/>Integer division and regular division.<br/>
<i><b>Listing&#160;38.</b>&#160;Demonstrate&#160;integer&#160;division.</i><br/>
Sub&#160;ExampleIntDiv<br/>&#160;&#160;Dim&#160;f&#160;As&#160;Double<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;f&#160;=&#160;5.9&#160;&#160;<br/>&#160;&#160;s&#160;=&#160;&#34;5/2 = &#34;&#160;&amp;&#160;5/2&#160; &#160; &#160; &#160;REM 2.5<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;5\2 = &#34;&#160;&amp;&#160;5\2&#160; &#160; &#160; &#160;REM 2<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;5/3 = &#34;&#160;&amp;&#160;5/3&#160; &#160; &#160; &#160;REM 1.666666667<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;5\3 = &#34;&#160;&amp;&#160;5\3&#160; &#160; &#160; &#160;REM 1<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;5/4 = &#34;&#160;&amp;&#160;5/4&#160; &#160; &#160; &#160;REM 1.25<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;5\4 = &#34;&#160;&amp;&#160;5\4&#160; &#160; &#160; &#160;REM 1<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;-5/2 = &#34;&#160;&amp;&#160;-5/2&#160; &#160; &#160;REM -2.5<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;-5\2 = &#34;&#160;&amp;&#160;-5\2&#160; &#160; &#160;REM -2<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;-5/3 = &#34;&#160;&amp;&#160;-5/3&#160; &#160; &#160;REM -1.666666667<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;-5\3 = &#34;&#160;&amp;&#160;-5\3&#160; &#160; &#160;REM -1<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;-5/4 = &#34;&#160;&amp;&#160;-5/4&#160; &#160; &#160;REM -1.25<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;-5\4 = &#34;&#160;&amp;&#160;-5\4&#160; &#160; &#160;REM -1<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;17/6 = &#34;&#160; &#160;&amp;&#160;17/6&#160; &#160;REM 2.83333333333333<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;17\6 = &#34;&#160; &#160;&amp;&#160;17\6&#160; &#160;REM 2<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;17/5.9 = &#34;&#160;&amp;&#160;17/5.9&#160;REM 2.88135593220339<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;17\5 = &#34;&#160;&amp;&#160;17\5&#160; &#160; &#160;REM 3<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;17\5.9 = &#34;&#160;&amp;&#160;17\5.9&#160;REM 3 because 5.9 was truncated to 5.<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;17\f = &#34;&#160;&amp;&#160;17\f&#160; &#160; &#160;REM 2 because f was rounded up to 6.<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;17\(11.9/2) = &#34;&#160;&amp;&#160;17\(11.9/2)&#160;REM 3 because 11.9/2 truncated to 5.<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
66<br/>
<hr/>
<a name=70></a><i><b>Figure&#160;30.</b>&#160;Integer&#160;division.</i><br/>
With integer division,&#160;constant&#160;numeric&#160;operands&#160;are&#160;truncated to&#160;Integer values&#160;before&#160;the&#160;division&#160;is&#160;done.&#160;<br/>When&#160;variables&#160;are&#160;part&#160;of an operand, the&#160;operand's&#160;result&#160;is&#160;rounded, otherwise&#160;truncated.<br/>
<i><b>Addition&#160;(+), subtraction&#160;(-), and&#160;string&#160;concatenation&#160;(&amp;&#160;and&#160;+)<br/></b></i>Addition&#160;and subtraction&#160;have&#160;the&#160;same&#160;precedence, which&#160;is&#160;higher than the&#160;string concatenation&#160;operator.&#160;<br/>Care&#160;must&#160;be&#160;taken while&#160;adding numerical&#160;values&#160;because&#160;the&#160;plus&#160;operator can also signify&#160;string&#160;<br/>concatenation.&#160;When the&#160;first&#160;operand for the&#160;plus&#160;operator is&#160;a&#160;number,&#160;and the&#160;second is&#160;a&#160;string;&#160;the&#160;string<br/>is&#160;converted&#160;to a&#160;number.&#160;When the&#160;first&#160;operand for the&#160;plus&#160;operator&#160;is&#160;a&#160;string, and the&#160;second is&#160;a&#160;<br/>number;&#160;the&#160;number is&#160;converted&#160;to a&#160;string.<br/>
Print&#160;123&#160;+&#160;&#34;3&#34;&#160; &#160; &#160;&#160;REM 126 &#160;(Numeric)<br/>Print&#160;&#34;123&#34;&#160;+&#160;3&#160; &#160; &#160;&#160;REM 1233 (String)<br/>
The&#160;string operator&#160;tries&#160;to&#160;convert&#160;the&#160;operands&#160;to strings&#160;if at&#160;least&#160;one&#160;operand is&#160;a&#160;string.<br/>
Print&#160;123&#160;&amp;&#160;&#34;3&#34;&#160; &#160; &#160;REM 1233 (String)<br/>Print&#160;&#34;123&#34;&#160;&amp;&#160;3&#160; &#160; &#160;REM 1233 (String)<br/>Print&#160;123&#160;&amp;&#160;3&#160; &#160; &#160; &#160;REM Use at least one string or it will not work!<br/>
Mixing string manipulations&#160;and numerical&#160;manipulations&#160;may&#160;lead&#160;to confusing results, especially&#160;because&#160;<br/>string concatenation&#160;with&#160;the&#160;&amp;&#160;operator has&#160;lower precedence&#160;than&#160;the&#160;+&#160;operator.<br/>
Print&#160;123&#160;+&#160;&#34;3&#34;&#160;&amp;&#160;4&#160;&#160;'1264 &#160;Do addition then convert to String<br/>Print&#160;123&#160;&amp;&#160;&#34;3&#34;&#160;+&#160;4&#160;&#160;'12334 Do addition first but first operand is String<br/>Print&#160;123&#160;&amp;&#160;3&#160;+&#160;&#34;4&#34;&#160;&#160;'1237 &#160;Do addition first but first operand is Integer<br/>
<b>&#160;3.8.2.&#160;Logical&#160;and&#160;bit-wise&#160;operators<br/></b>Each logical&#160;operator asks&#160;a&#160;simple&#160;question&#160;and provides&#160;a&#160;True&#160;or False&#160;answer.&#160;For example,&#160;is&#160;it&#160;true&#160;that<br/>(you have&#160;money)&#160;AND&#160;(you want&#160;to purchase&#160;my&#160;book)?&#160;These&#160;types&#160;of operations&#160;are&#160;simple&#160;and are&#160;<br/>frequently&#160;used in OOo Basic. Less&#160;frequently&#160;used, and provided for completeness&#160;to&#160;keep the&#160;computing&#160;<br/>
67<br/>
<hr/>
<a name=71></a>professionals&#160;happy,&#160;are&#160;the&#160;bit-wise&#160;operators. Bit-wise&#160;operators&#160;are&#160;not&#160;difficult,&#160;but&#160;if you&#160;don’t&#160;<br/>understand them, it&#160;isn’t&#160;likely&#160;to affect&#160;your&#160;usage&#160;of OOo Basic.<br/>
A&#160;logical&#160;operator&#160;is&#160;usually&#160;thought&#160;to&#160;operate&#160;on&#160;True&#160;and False&#160;values.&#160;In&#160;OOo Basic, logical&#160;operators&#160;<br/>also perform&#160;bit-wise&#160;operations&#160;on Integer values.&#160;This&#160;means&#160;that&#160;each bit&#160;of the&#160;first&#160;operand is&#160;compared&#160;<br/>to the&#160;corresponding bit&#160;in&#160;the&#160;second operand to form&#160;the&#160;corresponding&#160;bit&#160;in the&#160;result.&#160;For example, the&#160;<br/>binary&#160;operands&#160;01 and 10 use&#160;the&#160;0 from&#160;01 and the&#160;1 from&#160;10 to produce&#160;the&#160;first&#160;bit&#160;of the&#160;result.<br/>
The&#160;unusual&#160;thing about&#160;logical&#160;and bit-wise&#160;binary&#160;operators&#160;in&#160;OOo Basic&#160;is&#160;that&#160;their precedence&#160;is&#160;the&#160;<br/>same.&#160;In&#160;other languages,&#160;AND&#160;typically&#160;has&#160;greater precedence&#160;than&#160;OR.<br/>
<a href="libremacros.html#71">Table&#160;17&#160;i</a>llustrates&#160;the&#160;logical&#160;and bit-wise&#160;operators&#160;supported by&#160;OOo.&#160;True&#160;and False&#160;represent&#160;logical&#160;<br/>values, and 0 and 1 represent&#160;bit&#160;values.<br/>
<i><b>Table&#160;17.</b>&#160;Truth&#160;table&#160;for&#160;logical&#160;and bit-wise&#160;operators.</i><br/>
<i><b>x</b></i><br/>
<i><b>y</b></i><br/>
<i><b>x&#160;AND&#160;y</b></i><br/>
<i><b>x&#160;OR&#160;y</b></i><br/>
<i><b>x&#160;XOR&#160;y</b></i><br/>
<i><b>x&#160;EQV&#160;y</b></i><br/>
<i><b>x&#160;IMP&#160;y</b></i><br/>
True<br/>
True<br/>
True<br/>
True<br/>
False<br/>
True<br/>
True<br/>
True<br/>
False<br/>
False<br/>
True<br/>
True<br/>
False<br/>
False<br/>
False<br/>
True<br/>
False<br/>
True<br/>
True<br/>
False<br/>
True<br/>
False<br/>
False<br/>
False<br/>
False<br/>
False<br/>
True<br/>
True<br/>
1100<br/>
1010<br/>
1000<br/>
1110<br/>
0110<br/>
1001<br/>
1011<br/>
Internally,&#160;the&#160;logical&#160;operators&#160;cast&#160;their&#160;operands&#160;to type&#160;Long.&#160;An unexpected&#160;side&#160;effect&#160;is&#160;that&#160;a&#160;floating-<br/>point&#160;operand is&#160;converted to&#160;a&#160;Long, which might&#160;cause&#160;numerical&#160;overflow.&#160;The&#160;conversion&#160;from&#160;a&#160;<br/>floating-point&#160;number to a&#160;long&#160;integer number is&#160;done&#160;by&#160;rounding the&#160;value,&#160;not&#160;by&#160;truncating.&#160;The&#160;values&#160;<br/>chosen for&#160;True&#160;(-1) and False&#160;(0) allow&#160;this&#160;to&#160;work, but&#160;the&#160;return type&#160;with&#160;two Boolean operands&#160;is&#160;still&#160;<br/>sometimes&#160;of type&#160;Long.<br/>
<i><b>Listing&#160;39.</b>&#160;Logical&#160;operands&#160;are&#160;of&#160;type&#160;long&#160;integer.<br/></i>Sub&#160;LogicalOperandsAreLongs<br/>&#160;&#160;Dim&#160;v,&#160;b1&#160;As&#160;Boolean,&#160;b2&#160;As&#160;Boolean<br/>&#160;&#160;b1&#160;=&#160;True&#160;:&#160;b2&#160;=&#160;False<br/>&#160;&#160;v&#160;=&#160;(b1&#160;OR&#160;b2)<br/>&#160;&#160;Print&#160;TypeName(v)&#160; &#160;REM Long because operands are converted to Long.<br/>&#160;&#160;Print&#160;v&#160; &#160; &#160; &#160; &#160; &#160; &#160;REM -1 &#160; because the return type is Long.<br/>&#160;&#160;Print&#160;(b2&#160;OR&#160;&#34;-1&#34;)&#160;&#160;REM -1 &#160; because &#34;-1&#34; is converted to a Long.<br/>End&#160;Sub<br/>
For&#160;some&#160;logical&#160;expressions, not&#160;all&#160;operands&#160;need to&#160;be&#160;evaluated. For example,&#160;the&#160;expression&#160;(False&#160;<br/>AND&#160;True) is&#160;known to be&#160;False&#160;by&#160;looking at&#160;the&#160;first&#160;operand and the&#160;operator&#160;AND.&#160;This&#160;is&#160;known as&#160;<br/>“short-circuit&#160;evaluation.”&#160;Sadly,&#160;this&#160;isn’t&#160;available&#160;in&#160;OOo Basic;&#160;instead, all&#160;operands&#160;are&#160;evaluated.&#160;<br/>
<b>TIP</b><br/>
OOo Basic&#160;does not&#160;support&#160;short-circuit&#160;evaluation,&#160;so&#160;(x&#160;&lt;&gt;&#160;0&#160;AND&#160;y/x&#160;&gt;&#160;3)&#160;causes a&#160;division-by-zero&#160;<br/>error&#160;when x&#160;is zero.<br/>
The&#160;bit-wise&#160;operators&#160;are&#160;all&#160;illustrated&#160;the&#160;same&#160;way.&#160;Two arrays&#160;are&#160;filled with&#160;Boolean values&#160;and two&#160;<br/>integers&#160;are&#160;given an Integer value.<br/>
xi%&#160;=&#160;12&#160;:&#160;yi%&#160;=&#160;10<br/>x()&#160;=&#160;Array(True,&#160;True,&#160;False,&#160;False)<br/>y()&#160;=&#160;Array(True,&#160;False,&#160;True,&#160;False)<br/>
68<br/>
<hr/>
<a name=72></a>The&#160;decimal&#160;number 12 is&#160;represented in&#160;base&#160;2 as&#160;1100, which&#160;corresponds&#160;to&#160;the&#160;values&#160;in&#160;x().&#160;The&#160;<br/>decimal&#160;number 10 is&#160;represented in&#160;base&#160;2 as&#160;1010, which&#160;corresponds&#160;to&#160;the&#160;value&#160;in&#160;y().&#160;The&#160;operator is&#160;<br/>then applied to&#160;“x(0) op y(0)”, “x(1) op y(1)”, “x(2) op y(2)”, “x(3) op y(3)”, and “xi&#160;op yi”.&#160;The&#160;result&#160;is&#160;<br/>displayed in a&#160;message&#160;box.&#160;The&#160;integers&#160;are&#160;displayed as&#160;base&#160;2 to emphasize&#160;that&#160;a&#160;bit-wise&#160;operation is&#160;<br/>performed.<a href="libremacros.html#72">&#160;Listing 40<b>&#160;</b></a>demonstrates&#160;how&#160;an integer is&#160;converted&#160;to a&#160;stream&#160;of bits.&#160;This&#160;uses&#160;many&#160;<br/>techniques&#160;that&#160;are&#160;discussed later in&#160;this&#160;chapter.<br/>
<i><b>Listing&#160;40.</b>&#160;Convert&#160;an integer&#160;to binary.<br/></i>Sub&#160;TestIntoToBinary<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Dim&#160;n%<br/>&#160;&#160;Dim&#160;x%<br/>&#160;&#160;x&#160;=&#160;InputBox(&#34;Enter an integer&#34;)<br/>&#160;&#160;If&#160;x&#160;&lt;&gt;&#160;0&#160;Then<br/>&#160; &#160;&#160;n&#160;=&#160;Log(Abs(x))&#160;/&#160;Log(2)&#160;+&#160;1<br/>&#160; &#160;&#160;If&#160;(x&#160;&lt;&#160;0)&#160;Then<br/>&#160; &#160; &#160;&#160;n&#160;=&#160;n&#160;+&#160;4<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Else&#160;<br/>&#160; &#160;&#160;n&#160;=&#160;1<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;print&#160;&#34;s = &#34;&#160;&amp;&#160;IntToBinaryString(x,&#160;n)<br/>End&#160;Sub<br/>
REM Convert an Integer value to a string of bits<br/>REM x is the integer to convert<br/>REM n is the number of bits to convert<br/>REM This would be easier if I could shift out the lowest while<br/>REM retaining the sign bit of the number, but I cannot.<br/>REM I emulate this by dividing by two, but this fails for negative<br/>REM numbers. To avoid this problem, if the number is negative<br/>REM I flip all of the bits, which makes it a positive number and<br/>REM then I build an inverted answer<br/>Function&#160;IntToBinaryString(ByVal&#160;x%,&#160;ByVal&#160;n%)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;b0$&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Bit 0 (the right most bit) for positive numbers.<br/>&#160;&#160;Dim&#160;b1$&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Bit 1 for positive numbers.<br/>&#160;&#160;If&#160;(x&#160;&gt;=&#160;0)&#160;Then&#160; &#160; &#160; &#160;&#160;'Not negative so the algorithm will work.<br/>&#160; &#160;&#160;b1&#160;=&#160;&#34;1&#34;&#160;:&#160;b0&#160;=&#160;&#34;0&#34;&#160; &#160;'Use the standard bit values.<br/>&#160;&#160;Else&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'A negative number so<br/>&#160; &#160;&#160;x&#160;=&#160;NOT&#160;x&#160; &#160; &#160; &#160; &#160; &#160; &#160;'flip all of the bits.<br/>&#160; &#160;&#160;b1&#160;=&#160;&#34;0&#34;&#160;:&#160;b0&#160;=&#160;&#34;1&#34;&#160; &#160;'Invert bit 0 and invert bit 1.<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Accumulate bits as a string in s$.<br/>&#160;&#160;Do&#160;While&#160;n&#160;&gt;&#160;0&#160; &#160; &#160; &#160; &#160;&#160;'n is the number of bits to return.<br/>&#160; &#160;&#160;If&#160;(x&#160;AND&#160;1)&#160;=&#160;1&#160;Then&#160;'AND with 1 to find bit 0 (the right most bit).<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;b1$&#160;&amp;&#160;s&#160; &#160; &#160; &#160; &#160;'Bit 1 set so add a 1 &#160; (if x was negative add 0).<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;b0$&#160;&amp;&#160;s&#160; &#160; &#160; &#160; &#160;'Bit 1 clear so add a 0 (if x was negative add 1).<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;x&#160;=&#160;x\2&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Integer division by 2.<br/>&#160; &#160;&#160;n&#160;=&#160;n&#160;-&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Decrement n by 1, just finished a bit.<br/>&#160;&#160;Loop&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Back to the top of the While.<br/>&#160;&#160;IntToBinaryString&#160;=&#160;s&#160; &#160;'Assign the return value to the Function.<br/>
69<br/>
<hr/>
<a name=73></a>End&#160;Function<br/>
<i><b>AND<br/></b></i>Perform&#160;a&#160;logical&#160;AND&#160;operation&#160;on Boolean values, and a&#160;bit-wise&#160;AND&#160;on numerical&#160;values. Consider the&#160;<br/>phrase, “You can go&#160;to&#160;the&#160;movie&#160;if&#160;you&#160;have&#160;money&#160;AND&#160;if&#160;you&#160;have&#160;transportation.”&#160;Both conditions&#160;must<br/>be&#160;true&#160;before&#160;you are&#160;able&#160;to&#160;go to the&#160;movie.&#160;If&#160;both&#160;operands&#160;are&#160;True, then the&#160;result&#160;is&#160;True;&#160;otherwise&#160;<br/>the&#160;result&#160;is&#160;False.<br/>
<i><b>Listing&#160;41.</b>&#160;Operator&#160;AND.<br/></i>Sub&#160;ExampleOpAND<br/>&#160;&#160;Dim&#160;s$,&#160;x(),&#160;y(),&#160;i%,&#160;xi%,&#160;yi%<br/>&#160;&#160;xi%&#160;=&#160;12&#160;:&#160;yi%&#160;=&#160;10<br/>&#160;&#160;x()&#160;=&#160;Array(True,&#160;True,&#160;False,&#160;False)<br/>&#160;&#160;y()&#160;=&#160;Array(True,&#160;False,&#160;True,&#160;False)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(x())&#160;To&#160;UBound(x())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;x(i)&#160;&amp;&#160;&#34; AND &#34;&#160;&amp;&#160;y(i)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;CBool(x(i)&#160;AND&#160;y(i))&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;IntToBinaryString(xi,&#160;4)&#160;&amp;&#160;&#34; AND &#34;&#160;&amp;&#160;IntToBinaryString(yi,&#160;4)&#160;&amp;_<br/>&#160; &#160; &#160;&#34; = &#34;&#160;&amp;&#160;IntToBinaryString(xi&#160;AND&#160;yi,&#160;4)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Operator AND example&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;31.</b>&#160;Using&#160;the&#160;AND&#160;operator.</i><br/>
<i><b>OR<br/></b></i>Perform&#160;a&#160;logical&#160;OR operation on Boolean values, and a&#160;bit-wise&#160;OR on numerical&#160;values. Consider the&#160;<br/>phrase, “You can purchase&#160;that&#160;if&#160;you&#160;have&#160;cash OR your friend has&#160;cash.”&#160;It&#160;does&#160;not&#160;matter who has&#160;cash.&#160;<br/>If&#160;either operand is&#160;True, then the&#160;result&#160;is&#160;True;&#160;otherwise&#160;the&#160;result&#160;is&#160;False.<br/>
<i><b>Listing&#160;42.</b>&#160;Operator&#160;OR.</i><br/>
Sub&#160;ExampleOpOR<br/>&#160;&#160;Dim&#160;s$,&#160;x(),&#160;y(),&#160;i%,&#160;xi%,&#160;yi%<br/>&#160;&#160;xi%&#160;=&#160;12&#160;:&#160;yi%&#160;=&#160;10<br/>&#160;&#160;x()&#160;=&#160;Array(True,&#160;True,&#160;False,&#160;False)<br/>&#160;&#160;y()&#160;=&#160;Array(True,&#160;False,&#160;True,&#160;False)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(x())&#160;To&#160;UBound(x())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;x(i)&#160;&amp;&#160;&#34; OR &#34;&#160;&amp;&#160;y(i)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;CBool(x(i)&#160;OR&#160;y(i))&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;IntToBinaryString(xi,&#160;4)&#160;&amp;&#160;&#34; OR &#34;&#160;&amp;&#160;IntToBinaryString(yi,&#160;4)&#160;&amp;_<br/>&#160; &#160; &#160;&#34; = &#34;&#160;&amp;&#160;IntToBinaryString(xi&#160;OR&#160;yi,&#160;4)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Operator OR example&#34;<br/>End&#160;Sub<br/>
70<br/>
<hr/>
<a name=74></a><i><b>Figure&#160;32.</b>&#160;Using&#160;the&#160;OR&#160;operator.</i><br/>
<i><b>XOR<br/></b></i>The&#160;XOR operator is&#160;called “exclusive&#160;or”;&#160;this&#160;is&#160;a&#160;question&#160;of non-equivalence.&#160;The&#160;result&#160;is&#160;True&#160;if the&#160;<br/>operands&#160;have&#160;different&#160;values.&#160;The&#160;result&#160;is&#160;False&#160;if both&#160;operands&#160;have&#160;the&#160;same&#160;value.&#160;A&#160;logical&#160;XOR&#160;<br/>operation is&#160;performed&#160;on Boolean values, and a&#160;bit-wise&#160;XOR is&#160;performed&#160;on numerical&#160;values.<br/>
<i><b>Listing&#160;43.</b>&#160;Operator&#160;XOR.</i><br/>
Sub&#160;ExampleOpXOR<br/>&#160;&#160;Dim&#160;s$,&#160;x(),&#160;y(),&#160;i%,&#160;xi%,&#160;yi%<br/>&#160;&#160;xi%&#160;=&#160;12&#160;:&#160;yi%&#160;=&#160;10<br/>&#160;&#160;x()&#160;=&#160;Array(True,&#160;True,&#160;False,&#160;False)<br/>&#160;&#160;y()&#160;=&#160;Array(True,&#160;False,&#160;True,&#160;False)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(x())&#160;To&#160;UBound(x())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;x(i)&#160;&amp;&#160;&#34; XOR &#34;&#160;&amp;&#160;y(i)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;CBool(x(i)&#160;XOR&#160;y(i))&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;IntToBinaryString(xi,&#160;4)&#160;&amp;&#160;&#34; XOR &#34;&#160;&amp;&#160;IntToBinaryString(yi,&#160;4)&#160;&amp;_<br/>&#160; &#160; &#160;&#34; = &#34;&#160;&amp;&#160;IntToBinaryString(xi&#160;XOR&#160;yi,&#160;4)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Operator XOR example&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;33.</b>&#160;Using the&#160;XOR&#160;operator.</i><br/>
<i><b>EQV<br/></b></i>The&#160;EQV&#160;operator is&#160;a&#160;question&#160;of equivalence:&#160;Are&#160;the&#160;two operands&#160;the&#160;same?&#160;A&#160;logical&#160;EQV&#160;operation&#160;is&#160;<br/>performed&#160;for Boolean values, and a&#160;bit-wise&#160;EQV&#160;on numbers. If&#160;both operands&#160;have&#160;the&#160;same&#160;value, the&#160;<br/>result&#160;is&#160;True. If&#160;the&#160;operands&#160;don’t&#160;have&#160;the&#160;same&#160;value, the&#160;result&#160;is&#160;False.&#160;<br/>
<i><b>Listing&#160;44.</b>&#160;Operator&#160;EQV.</i><br/>
Sub&#160;ExampleOpEQV<br/>&#160;&#160;Dim&#160;s$,&#160;x(),&#160;y(),&#160;i%,&#160;xi%,&#160;yi%<br/>&#160;&#160;xi%&#160;=&#160;12&#160;:&#160;yi%&#160;=&#160;10<br/>&#160;&#160;x()&#160;=&#160;Array(True,&#160;True,&#160;False,&#160;False)<br/>&#160;&#160;y()&#160;=&#160;Array(True,&#160;False,&#160;True,&#160;False)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(x())&#160;To&#160;UBound(x())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;x(i)&#160;&amp;&#160;&#34; EQV &#34;&#160;&amp;&#160;y(i)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;CBool(x(i)&#160;EQV&#160;y(i))&#160;&amp;&#160;CHR$(10)<br/>
71<br/>
<hr/>
<a name=75></a>&#160;&#160;Next<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;IntToBinaryString(xi,&#160;4)&#160;&amp;&#160;&#34; EQV &#34;&#160;&amp;&#160;IntToBinaryString(yi,&#160;4)&#160;&amp;_<br/>&#160; &#160; &#160;&#34; = &#34;&#160;&amp;&#160;IntToBinaryString(xi&#160;EQV&#160;yi,&#160;4)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Operator EQV example&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;34.</b>&#160;Using the&#160;EQV&#160;operator.</i><br/>
<i><b>IMP<br/></b></i>The&#160;IMP&#160;operator&#160;performs&#160;a&#160;logical&#160;implication.&#160;A&#160;logical&#160;IMP&#160;operation&#160;is&#160;performed on Boolean&#160;values,&#160;<br/>and a&#160;bit-wise&#160;IMP&#160;on numbers.&#160;As&#160;the&#160;name&#160;implies,&#160;“x&#160;IMP&#160;y”&#160;asks&#160;if the&#160;statement&#160;that&#160;“x&#160;implies&#160;y”&#160;is&#160;a&#160;<br/>true&#160;statement.&#160;To&#160;help&#160;understand&#160;logical&#160;implication,&#160;define&#160;x&#160;and y&#160;as&#160;follows:<br/>
x = The sky is cloudy<br/>y = The sun is not visible<br/>If x Then y<br/>
If&#160;both x&#160;and y&#160;are&#160;true&#160;—&#160;the&#160;sky&#160;is&#160;cloudy&#160;and the&#160;sun is&#160;not&#160;visible&#160;—&#160;the&#160;statement&#160;can be&#160;considered&#160;<br/>true.&#160;This&#160;statement&#160;makes&#160;no claim&#160;about&#160;y&#160;if x&#160;is&#160;not&#160;true. In&#160;other words, if the&#160;sky&#160;is&#160;not&#160;cloudy,&#160;this&#160;<br/>statement&#160;does&#160;not&#160;imply&#160;that&#160;the&#160;sun is, or is&#160;not,&#160;visible. For example,&#160;it&#160;might&#160;be&#160;a&#160;clear night,&#160;or (like&#160;a&#160;<br/>good computer geek) you&#160;might&#160;be&#160;inside&#160;a&#160;room&#160;without&#160;any&#160;windows.&#160;This&#160;explains&#160;why&#160;the&#160;entire&#160;<br/>statement&#160;is&#160;always&#160;considered valid&#160;when x&#160;is&#160;false. Finally,&#160;if x&#160;is&#160;true&#160;and y&#160;is&#160;not, the&#160;entire&#160;statement&#160;is&#160;<br/>considered false. If&#160;the&#160;sky&#160;is&#160;cloudy,&#160;and the&#160;sun is&#160;visible, the&#160;statement&#160;cannot&#160;possibly&#160;be&#160;correct;&#160;a&#160;<br/>cloudy&#160;day&#160;could not&#160;imply&#160;that&#160;the&#160;sun is&#160;visible.<br/>
<i><b>Listing&#160;45.</b>&#160;Operator&#160;IMP.<br/></i>Sub&#160;ExampleOpIMP<br/>&#160;&#160;Dim&#160;s$,&#160;x(),&#160;y(),&#160;i%,&#160;xi%,&#160;yi%<br/>&#160;&#160;xi%&#160;=&#160;12&#160;:&#160;yi%&#160;=&#160;10<br/>&#160;&#160;x()&#160;=&#160;Array(True,&#160;True,&#160;False,&#160;False)<br/>&#160;&#160;y()&#160;=&#160;Array(True,&#160;False,&#160;True,&#160;False)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(x())&#160;To&#160;UBound(x())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;x(i)&#160;&amp;&#160;&#34; IMP &#34;&#160;&amp;&#160;y(i)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;CBool(x(i)&#160;IMP&#160;y(i))&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;IntToBinaryString(xi,&#160;4)&#160;&amp;&#160;&#34; IMP &#34;&#160;&amp;&#160;IntToBinaryString(yi,&#160;4)&#160;&amp;_<br/>&#160; &#160; &#160;&#34; = &#34;&#160;&amp;&#160;IntToBinaryString(xi&#160;IMP&#160;yi,&#160;4)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Operator IMP example&#34;<br/>End&#160;Sub<br/>
72<br/>
<hr/>
<a name=76></a><i><b>Figure&#160;35.</b>&#160;Using the&#160;IMP&#160;operator.</i><br/>
<i><b>NOT<br/></b></i>The&#160;NOT&#160;operator performs&#160;a&#160;logical&#160;NOT&#160;operation&#160;on Boolean values, and a&#160;bit-wise&#160;NOT&#160;on numerical&#160;<br/>values.&#160;This&#160;means&#160;that&#160;“Not&#160;True”&#160;is&#160;False&#160;and “Not&#160;False”&#160;is&#160;True. For&#160;bit-wise&#160;operations,&#160;a&#160;1 becomes&#160;a&#160;<br/>0 and a&#160;0 becomes&#160;a&#160;1.<br/>
Print&#160;NOT&#160;True&#160; &#160;REM 0, which is False<br/>Print&#160;NOT&#160;False&#160;&#160;REM -1, which is True<br/>Print&#160;NOT&#160;2&#160; &#160; &#160;&#160;REM -3, which took the bits 0010 to 1101<br/>
<b>&#160;3.8.3.&#160;Comparison&#160;operators<br/></b>The&#160;comparison operators&#160;work with&#160;numerical,&#160;Date, Boolean,&#160;and String data&#160;types.<br/>
Print&#160;2&#160;&#160;=&#160;8/4&#160;AND&#160;0&#160;&lt;&#160;&#160;1/3&#160;AND&#160;2&#160;&#160;&gt;&#160;1&#160; &#160;'-1=True<br/>Print&#160;4&#160;&lt;=&#160;4.0&#160;AND&#160;1&#160;&gt;=&#160; &#160;0&#160;AND&#160;1&#160;&lt;&gt;&#160;0&#160; &#160;'-1=True<br/>
String comparisons&#160;are&#160;based on their internal&#160;representations&#160;as&#160;numbers&#160;and are&#160;case&#160;sensitive.&#160;The&#160;letter&#160;<br/>“A”&#160;is&#160;less&#160;than&#160;the&#160;letter “B”.&#160;The&#160;uppercase&#160;characters&#160;are&#160;less&#160;than the&#160;lowercase&#160;letters.<br/>
Dim&#160;a$,&#160;b$,&#160;c$<br/>a$&#160;=&#160;&#34;A&#34;&#160;:&#160;b$&#160;=&#160;&#34;B&#34;&#160;:&#160;c$&#160;=&#160;&#34;B&#34;<br/>Print&#160;a$&#160;&#160;&lt;&#160;b$&#160; &#160;'True<br/>Print&#160;b$&#160;&#160;=&#160;c$&#160; &#160;'True<br/>Print&#160;c$&#160;&lt;=&#160;a$&#160; &#160;'False<br/>
Strange&#160;problems&#160;occur when all&#160;of the&#160;operands&#160;are&#160;string constants. If&#160;at&#160;least&#160;one&#160;operand is&#160;a&#160;variable,&#160;<br/>the&#160;expected results&#160;are&#160;achieved.&#160;This&#160;is&#160;likely&#160;related to&#160;how&#160;the&#160;operands&#160;are&#160;recognized and converted&#160;for<br/>use.<br/>
Print&#160;&#34;A&#34;&#160;&lt;&#160;&#34;B&#34;&#160; &#160; &#160;'0=False, this is not correct<br/>Print&#160;&#34;B&#34;&#160;&lt;&#160;&#34;A&#34;&#160; &#160; &#160;'-1=True, this is not correct<br/>Print&#160;&#160;3&#160;&#160;=&#160;&#34;3&#34;&#160; &#160; &#160;'False, but this changes if a variable is used<br/>
When&#160;variables&#160;are&#160;used rather than string constants, the&#160;numerical&#160;values&#160;are&#160;converted to&#160;string types&#160;for&#160;<br/>the&#160;comparison.<br/>
Dim&#160;a$,&#160;i%,&#160;t$<br/>a$&#160;=&#160;&#34;A&#34;&#160;:&#160;t$&#160;=&#160;&#34;3&#34;&#160;:&#160;i%&#160;=&#160;3<br/>Print&#160;&#160;a$&#160;&lt;&#160;&#34;B&#34;&#160; &#160; &#160;'True, &#160;String compare<br/>Print&#160;&#34;B&#34;&#160;&lt;&#160;&#160;a$&#160; &#160; &#160;'False, String compare<br/>Print&#160;&#160;i%&#160;=&#160;&#34;3&#34;&#160; &#160; &#160;'True, &#160;String compare<br/>Print&#160;&#160;i%&#160;=&#160;&#34;+3&#34;&#160; &#160;&#160;'False, String compare<br/>Print&#160;&#160;3&#160;&#160;=&#160;&#160;t$&#160; &#160; &#160;'True, &#160;String compare<br/>Print&#160;&#160;i%&#160;&lt;&#160;&#34;2&#34;&#160; &#160; &#160;'False, String compare<br/>Print&#160;&#160;i%&#160;&gt;&#160;&#34;22&#34;&#160; &#160;&#160;'True, &#160;String compare<br/>
73<br/>
<hr/>
<a name=77></a><b>TIP</b><br/>
When&#160;comparing&#160;operands of&#160;different&#160;types, especially&#160;when mixing&#160;numeric&#160;and&#160;string&#160;types, it&#160;is&#160;safer&#160;<br/>
to explicitly&#160;perform&#160;a&#160;type&#160;conversion.&#160;Either&#160;convert&#160;the&#160;string&#160;to a&#160;number,&#160;or&#160;the&#160;number&#160;to a&#160;string.&#160;<br/>The&#160;functions&#160;to do&#160;this are&#160;discussed&#160;later.<br/>
OOo recognizes&#160;the&#160;Visual&#160;Basic&#160;statement&#160;Option Compare&#160;{&#160;Binary&#160;|&#160;Text},&#160;but&#160;as&#160;of OOo version&#160;3.20,&#160;<br/>the&#160;statement&#160;still&#160;does&#160;nothing.&#160;The&#160;current&#160;behavior is&#160;a&#160;binary&#160;comparison of strings.&#160;<br/>
<i><b>&#160;3.9.&#160;Flow&#160;control<br/></b></i>Flow&#160;control&#160;is&#160;about&#160;deciding which&#160;line&#160;of code&#160;runs&#160;next.&#160;Calling a&#160;subroutine&#160;or function&#160;is&#160;a&#160;simple&#160;<br/>form&#160;of unconditional&#160;flow&#160;control. More&#160;complicated flow&#160;control&#160;involves&#160;branching and looping. Flow&#160;<br/>control&#160;allows&#160;macros&#160;to&#160;have&#160;complicated behavior that&#160;changes&#160;based on the&#160;current&#160;data.<br/>
Branching statements&#160;cause&#160;the&#160;program&#160;flow&#160;to change. Calling a&#160;subroutine&#160;or function&#160;is&#160;an unconditional<br/>branch. OOo Basic&#160;supports&#160;conditional&#160;branching&#160;statements&#160;such as&#160;“if x,&#160;then&#160;do y”.&#160;Looping statements&#160;<br/>cause&#160;the&#160;program&#160;to repeat&#160;sections&#160;of code. Looping statements&#160;allow&#160;for a&#160;section to&#160;be&#160;repeated a&#160;<br/>specific&#160;number of times&#160;or until&#160;a&#160;specific&#160;“exit”&#160;condition has&#160;been achieved.<br/>
<b>&#160;3.9.1.&#160;Define&#160;a&#160;label&#160;as&#160;a&#160;jump&#160;target<br/></b>Some&#160;flow&#160;control&#160;statements, such as&#160;GoSub, GoTo, and On Error,&#160;require&#160;a&#160;label&#160;to&#160;mark a&#160;point&#160;in the&#160;<br/>code. Label&#160;names&#160;are&#160;subject&#160;to&#160;the&#160;same&#160;rules&#160;as&#160;variable&#160;names. Label&#160;names&#160;are&#160;immediately&#160;followed&#160;<br/>by&#160;a&#160;colon. Remember that&#160;a&#160;colon is&#160;also used as&#160;a&#160;statement&#160;separator that&#160;allows&#160;multiple&#160;statements&#160;to&#160;<br/>occupy&#160;the&#160;same&#160;line. Space&#160;between the&#160;label&#160;name&#160;and the&#160;colon causes&#160;the&#160;colon&#160;to&#160;be&#160;used as&#160;a&#160;statement<br/>separator,&#160;which&#160;means&#160;the&#160;label&#160;won’t&#160;be&#160;defined.&#160;The&#160;following lines&#160;all&#160;represent&#160;valid&#160;OOo Basic&#160;code.<br/>
&#160;&#160;&lt;statements&gt;<br/>&#160;&#160;i%&#160;=&#160;5&#160;:&#160;z&#160;=&#160;q&#160;+&#160;4.77<br/>
MyCoolLabel:<br/>&#160;&#160;&lt;more&#160;statements&gt;<br/>
JumpTarget:&#160;&lt;more&#160;statements&gt;&#160;REM no space between label and colon<br/>
<b>TIP</b><br/>
Inserting&#160;a&#160;space&#160;between a&#160;label&#160;and the&#160;colon causes the&#160;colon to be&#160;used&#160;as&#160;a&#160;statement&#160;separator,&#160;and&#160;<br/>
the&#160;label&#160;is not&#160;defined.<br/>
<b>&#160;3.9.2.&#160;GoSub<br/></b>The&#160;GoSub statement&#160;causes&#160;execution&#160;to jump&#160;to a&#160;defined&#160;label&#160;in the&#160;current&#160;routine.&#160;It&#160;isn’t&#160;possible&#160;to&#160;<br/>jump&#160;outside&#160;of the&#160;current&#160;routine.&#160;When the&#160;Return statement&#160;is&#160;reached, execution&#160;continues&#160;from&#160;the&#160;<br/>point&#160;of the&#160;original&#160;call.&#160;A&#160;Return statement&#160;with no previous&#160;GoSub produces&#160;a&#160;run-time&#160;error.&#160;In&#160;other&#160;<br/>words, Return is&#160;not&#160;a&#160;substitute&#160;for Exit&#160;Sub&#160;or Exit&#160;Function.&#160;It&#160;is&#160;generally&#160;assumed that&#160;functions&#160;and&#160;<br/>subroutines&#160;produce&#160;more&#160;understandable&#160;code&#160;than GoSub&#160;and GoTo.<br/>
<b>TIP</b><br/>
GoSub is&#160;a&#160;persistent&#160;remnant&#160;from&#160;old&#160;BASIC&#160;dialects, retained&#160;for&#160;compatibility.&#160;GoSub&#160;<br/>is strongly&#160;discouraged&#160;because&#160;it&#160;tends to produce&#160;unreadable&#160;code.&#160;Use&#160;a&#160;subroutine&#160;or&#160;<br/>function instead. In&#160;fact,&#160;Visual&#160;Basic&#160;.NET&#160;no longer&#160;supports the&#160;GoSub keyword.<br/>
74<br/>
<hr/>
<a name=78></a><i><b>Listing&#160;46.</b>&#160;Example&#160;GoSub.<br/></i>Sub&#160;ExampleGoSub<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;GoSub&#160;Line2&#160; &#160; &#160;&#160;REM Jump to line 2 then return, i is 1<br/>&#160;&#160;GoSub&#160;[Line&#160;1]&#160; &#160;REM Jump to line 1 then return, i is 2<br/>&#160;&#160;MsgBox&#160;&#34;i = &#34;&#160;+&#160;i,&#160;0,&#160;&#34;GoSub Example&#34;&#160;&#160;REM i is now 2<br/>&#160;&#160;Exit&#160;Sub&#160; &#160; &#160; &#160; &#160;REM Leave the current subroutine.<br/>[Line&#160;1]:&#160; &#160; &#160; &#160; &#160;&#160;REM this label has a space in it<br/>&#160;&#160;i&#160;=&#160;i&#160;+&#160;1&#160; &#160; &#160; &#160;&#160;REM Add one to i<br/>&#160;&#160;Return&#160; &#160; &#160; &#160; &#160; &#160;REM return to the calling location<br/>Line2:&#160; &#160; &#160; &#160; &#160; &#160; &#160;REM this label is more typical, no spaces<br/>&#160;&#160;i&#160;=&#160;1&#160; &#160; &#160; &#160; &#160; &#160;&#160;REM Set i to 1<br/>&#160;&#160;Return&#160; &#160; &#160; &#160; &#160; &#160;REM return to the calling location<br/>End&#160;Sub<br/>
<b>&#160;3.9.3.&#160;GoTo<br/></b>The&#160;GoTo&#160;statement&#160;causes&#160;execution to&#160;jump&#160;to&#160;a&#160;defined label&#160;in&#160;the&#160;current&#160;routine. It&#160;isn’t&#160;possible&#160;to&#160;<br/>jump&#160;outside&#160;of the&#160;current&#160;routine.&#160;Unlike&#160;the&#160;GoSub statement,&#160;the&#160;GoTo&#160;statement&#160;doesn’t&#160;know&#160;from&#160;<br/>where&#160;it&#160;came.&#160;GoTo&#160;is&#160;a&#160;persistent&#160;remnant&#160;from&#160;old BASIC dialects,&#160;retained&#160;for compatibility.&#160;GoTo&#160;is&#160;<br/>strongly&#160;discouraged because&#160;it&#160;tends&#160;to&#160;produce&#160;unreadable&#160;code. Use&#160;a&#160;subroutine&#160;or function instead.<br/>
<i><b>Listing&#160;47.</b>&#160;Example&#160;GoTo.<br/></i>Sub&#160;ExampleGoTo<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;GoTo&#160;Line2&#160; &#160; &#160; &#160;&#160;REM Okay, this looks easy enough<br/>Line1:&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM but I am becoming confused<br/>&#160;&#160;i&#160;=&#160;i&#160;+&#160;1&#160; &#160; &#160; &#160; &#160;REM I wish that GoTo was not used<br/>&#160;&#160;GoTo&#160;TheEnd&#160; &#160; &#160; &#160;REM This is crazy, makes me think of spaghetti,<br/>Line2:&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM Tangled strands going in and out; spaghetti code.<br/>&#160;&#160;i&#160;=&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160;REM If you have to do it, you probably<br/>&#160;&#160;GoTo&#160;Line1&#160; &#160; &#160; &#160;&#160;REM did something poorly.<br/>TheEnd:&#160; &#160; &#160; &#160; &#160; &#160; &#160;REM Do not use GoTo.<br/>&#160;&#160;MsgBox&#160;&#34;i = &#34;&#160;+&#160;i,&#160;0,&#160;&#34;GoTo Example&#34;<br/>End&#160;Sub<br/>
<b>&#160;3.9.4.&#160;On&#160;GoTo&#160;and&#160;On&#160;GoSub<br/></b>These&#160;statements&#160;cause&#160;the&#160;execution to&#160;branch to&#160;a&#160;label&#160;based on a&#160;numeric&#160;expression N. If&#160;N&#160;is&#160;zero, no&#160;<br/>branching&#160;occurs.&#160;The&#160;numeric&#160;expression&#160;N&#160;must&#160;be&#160;in&#160;the&#160;range&#160;of 0 through 255.&#160;This&#160;is&#160;sometimes&#160;called<br/>a&#160;“computed goto,”&#160;because&#160;a&#160;computation is&#160;used to&#160;direct&#160;the&#160;program&#160;flow.&#160;It&#160;isn’t&#160;possible&#160;to&#160;jump&#160;<br/>outside&#160;of the&#160;current&#160;subroutine.<br/>
<i><b>Syntax:</b></i>&#160;&#160;On&#160;N&#160;GoSub&#160;Label1[,&#160;Label2[,&#160;Label3[,...]]]<br/><i><b>Syntax:</b></i>&#160;&#160;On&#160;N&#160;GoTo&#160;&#160;Label1[,&#160;Label2[,&#160;Label3[,...]]]<br/>
To&#160;reiterate&#160;how&#160;this&#160;works, if N&#160;=&#160;1 then branch to&#160;Label&#160;1, if N&#160;=&#160;2 then branch to&#160;Label&#160;2... If&#160;N&#160;is&#160;less&#160;<br/>than 1 or if N&#160;is&#160;greater than the&#160;number of labels,&#160;then the&#160;branch is&#160;not&#160;taken;&#160;it&#160;is&#160;simply&#160;ignored.<br/>
<i><b>Listing&#160;48.</b>&#160;Example&#160;On GoTo.<br/></i>Sub&#160;ExampleOnGoTo<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;i&#160;=&#160;1<br/>&#160;&#160;On&#160;i+1&#160;GoSub&#160;Sub1,&#160;Sub2<br/>
75<br/>
<hr/>
<a name=79></a>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;Chr(13)<br/>&#160;&#160;On&#160;i&#160;GoTo&#160;Line1,&#160;Line2<br/>&#160;&#160;REM The exit causes us to exit if we do not continue execution<br/>&#160;&#160;Exit&#160;Sub<br/>Sub1:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;In Sub 1&#34;&#160;:&#160;Return<br/>Sub2:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;In Sub 2&#34;&#160;:&#160;Return<br/>Line1:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;At Label 1&#34;&#160;:&#160;GoTo&#160;TheEnd<br/>Line2:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;At Label 2&#34;<br/>TheEnd:<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;On GoTo Example&#34;<br/>End&#160;Sub<br/>
<b>&#160;3.9.5.&#160;If&#160;Then&#160;Else<br/></b>The&#160;If&#160;construct&#160;is&#160;used to execute&#160;a&#160;block&#160;of code&#160;based on an expression.&#160;Although you&#160;can use&#160;GoTo&#160;or&#160;<br/>GoSub to&#160;jump out&#160;of an If&#160;block, you cannot&#160;jump into an If&#160;block.&#160;The&#160;simplest&#160;If&#160;statement&#160;has&#160;the&#160;<br/>following&#160;form:<br/>
If&#160;Condition&#160;Then&#160;Statement<br/>
The&#160;condition can be&#160;any&#160;expression&#160;that&#160;either evaluates&#160;to&#160;—&#160;or is&#160;convertible&#160;to&#160;—&#160;True&#160;or False. Use&#160;a&#160;<br/>slightly&#160;more&#160;complicated&#160;version&#160;to control&#160;more&#160;than a&#160;single&#160;statement.<br/>
If&#160;Condition&#160;Then&#160;<br/>&#160;&#160;Statementblock&#160;<br/>[ElseIf&#160;Condition&#160;Then]&#160;<br/>&#160;&#160;Statementblock&#160;<br/>[Else]&#160;<br/>&#160;&#160;Statementblock&#160;<br/>End&#160;If<br/>
If&#160;the&#160;first&#160;condition&#160;evaluates&#160;to&#160;True, the&#160;first&#160;block runs.&#160;The&#160;ElseIf&#160;statement&#160;allows&#160;multiple&#160;If&#160;<br/>statements&#160;to&#160;be&#160;tested in&#160;sequence.&#160;The&#160;statement&#160;block for the&#160;first&#160;true&#160;condition&#160;runs.&#160;The&#160;Else&#160;statement&#160;<br/>block runs&#160;if no other condition evaluates&#160;to&#160;True.<br/>
<i><b>Listing&#160;49.</b>&#160;Example&#160;If.<br/></i>Sub&#160;ExampleIf<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;i%&#160;=&#160;4<br/>&#160;&#160;If&#160;i&#160;=&#160;4&#160;Then&#160;Print&#160;&#34;i is four&#34;<br/>&#160;&#160;If&#160;i&#160;&lt;&gt;&#160;3&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;i is not three&#34;<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;i&#160;&lt;&#160;1&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;i is less than 1&#34;<br/>&#160;&#160;elseif&#160;i&#160;=&#160;1&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;i is 1&#34;<br/>&#160;&#160;elseif&#160;i&#160;=&#160;2&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;i is 2&#34;<br/>&#160;&#160;else<br/>&#160; &#160;&#160;Print&#160;&#34;i is greater than 2&#34;<br/>
76<br/>
<hr/>
<a name=80></a>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
If&#160;statements&#160;can be&#160;nested.<br/>
If&#160;i&#160;&lt;&gt;&#160;3&#160;THEN<br/>&#160;&#160;If&#160;k&#160;=&#160;4&#160;Then&#160;Print&#160;&#34;k is four&#34;<br/>&#160;&#160;If&#160;j&#160;=&#160;7&#160;Then<br/>&#160; &#160; &#160;Print&#160;&#34;j is seven&#34;<br/>&#160;&#160;End&#160;If<br/>End&#160;If<br/>
<b>&#160;3.9.6.&#160;IIf<br/></b>The&#160;IIf&#160;(“Immediate&#160;If”)&#160;function&#160;returns&#160;one&#160;of two values&#160;based on a&#160;conditional&#160;expression.<br/>
<i><b>Syntax:</b></i>&#160;&#160;object&#160;=&#160;IIf&#160;(Condition,&#160;TrueExpression,&#160;FalseExpression)<br/>
This&#160;is&#160;very&#160;similar to&#160;the&#160;following code:<br/>
If&#160;Condition&#160;Then<br/>&#160;&#160;object&#160;=&#160;TrueExpression<br/>Else<br/>&#160;&#160;object&#160;=&#160;FalseExpression<br/>End&#160;If<br/>
This&#160;works&#160;as&#160;a&#160;great&#160;single-line&#160;If-Then-Else&#160;statement.<br/>
max_age&#160;=&#160;IIf(johns_age&#160;&gt;&#160;bills_age,&#160;johns_age,&#160;bills_age)<br/>
<b>&#160;3.9.7.&#160;Choose<br/></b>The&#160;Choose&#160;statement&#160;selects&#160;from&#160;a&#160;list&#160;of values&#160;based on an index.<br/>
<i><b>Syntax:</b></i>&#160;obj&#160;=&#160;Choose&#160;(expression,&#160;Select_1[,&#160;Select_2,&#160;...&#160;[,Select_n]])&#160;<br/>
The&#160;Choose&#160;statement&#160;returns&#160;a&#160;null&#160;if the&#160;expression&#160;is&#160;less&#160;than&#160;1 or greater than&#160;the&#160;number of selection&#160;<br/>arguments. Choose&#160;returns&#160;“select_1”&#160;if the&#160;expression&#160;evaluates&#160;to&#160;1, and “select_2”&#160;if the&#160;expression&#160;<br/>evaluates&#160;to&#160;2.&#160;The&#160;result&#160;is&#160;similar&#160;to storing the&#160;selections&#160;in an array&#160;with&#160;a&#160;lower bound of 1 and then&#160;<br/>indexing into&#160;the&#160;array.<br/>
<i><b>Listing&#160;50.</b>&#160;A&#160;division-by-zero&#160;error&#160;occurs&#160;even though&#160;1/(i-2)&#160;should&#160;be&#160;returned.<br/></i>i%&#160;=&#160;3<br/>Print&#160;Choose&#160;(i%,&#160;1/(i+1),&#160;1/(i-1),&#160;1/(i-2),&#160;1/(i-3))<br/>
Selections&#160;can be&#160;expressions&#160;and they&#160;can contain&#160;function calls. Every&#160;function&#160;is&#160;called&#160;and every&#160;<br/>expression is&#160;evaluated in&#160;the&#160;argument&#160;list&#160;for the&#160;call&#160;to&#160;the&#160;Choose&#160;statement.&#160;The&#160;code&#160;i<a href="libremacros.html#80">n&#160;Listing&#160;50&#160;<br/></a>causes&#160;a&#160;division-by-zero error because&#160;every&#160;argument&#160;is&#160;evaluated, not&#160;just&#160;the&#160;argument&#160;that&#160;will&#160;be&#160;<br/>returne<a href="libremacros.html#80">d.&#160;Listing&#160;51&#160;c</a>alls&#160;the&#160;functions&#160;Choose1, Choose2, and Choose3.<br/>
<i><b>Listing&#160;51.</b>&#160;Example&#160;Choose&#160;statement.</i><br/>
Sub&#160;ExampleChoose<br/>&#160;&#160;Print&#160;Choose(2,&#160;&#34;One&#34;,&#160;&#34;Two&#34;,&#160;&#34;Three&#34;)&#160; &#160; &#160; &#160; &#160; &#160;'Two<br/>&#160;&#160;Print&#160;Choose(2,&#160;Choose1(),&#160;Choose2(),&#160;Choose3())&#160;'Two<br/>End&#160;Sub<br/>Function&#160;Choose1$()<br/>&#160;&#160;Print&#160;&#34;I am in Choose1&#34;<br/>&#160;&#160;Choose1&#160;=&#160;&#34;One&#34;<br/>
77<br/>
<hr/>
<a name=81></a>End&#160;Function<br/>Function&#160;Choose2$()<br/>&#160;&#160;Print&#160;&#34;I am in Choose2&#34;<br/>&#160;&#160;Choose2&#160;=&#160;&#34;Two&#34;<br/>End&#160;Function<br/>Function&#160;Choose3$()<br/>&#160;&#160;Print&#160;&#34;I am in Choose3&#34;<br/>&#160;&#160;Choose3&#160;=&#160;&#34;Three&#34;<br/>End&#160;Function<br/>
<b>TIP</b><br/>
All&#160;arguments&#160;in&#160;a&#160;Choose&#160;statement&#160;are&#160;evaluated.&#160;If&#160;functions are&#160;used&#160;in the&#160;arguments for&#160;Choose,&#160;they&#160;<br/>
are&#160;all&#160;called.<br/>
<b>&#160;3.9.8.&#160;Select&#160;Case<br/></b>The&#160;Select&#160;Case&#160;statement&#160;is&#160;similar to&#160;an If&#160;statement&#160;with multiple&#160;Else&#160;If&#160;blocks.&#160;A&#160;single-condition&#160;<br/>expression is&#160;specified&#160;and this&#160;is&#160;compared against&#160;multiple&#160;values&#160;for a&#160;match&#160;as&#160;follows:<br/>
Select&#160;Case&#160;condition_expression&#160;<br/>&#160;&#160;Case&#160;case_expression1&#160;<br/>&#160; &#160;&#160;StatementBlock1<br/>&#160;&#160;Case&#160;case_expression2&#160;<br/>&#160; &#160;&#160;StatementBlock2<br/>&#160;&#160;Case&#160;Else<br/>&#160; &#160;&#160;StatementBlock3<br/>End&#160;Select&#160;<br/>
The&#160;condition_expression&#160;is&#160;compared in&#160;each Case&#160;statement.&#160;The&#160;first&#160;statement&#160;block to&#160;match&#160;is&#160;<br/>executed.&#160;The&#160;optional&#160;Case&#160;Else&#160;block&#160;runs&#160;if no condition&#160;matches. It&#160;is&#160;not&#160;an error if&#160;nothing matches&#160;<br/>and no Case&#160;Else&#160;block is&#160;present.<br/>
<i><b>Case&#160;expressions<br/></b></i>The&#160;conditional&#160;expression is&#160;evaluated once&#160;and then it&#160;is&#160;compared to&#160;each case&#160;expression&#160;until&#160;a&#160;match is<br/>found.&#160;A&#160;case&#160;expression is&#160;usually&#160;a&#160;constant, such as&#160;“Case&#160;4”&#160;or “Case&#160;&#34;hello&#34;”.&#160;<br/>
Select&#160;Case&#160;2<br/>&#160;&#160;Case&#160;1<br/>&#160; &#160;&#160;Print&#160;&#34;One&#34;<br/>&#160;&#160;Case&#160;3&#160;<br/>&#160; &#160;&#160;Print&#160;&#34;Three&#34;<br/>End&#160;Select<br/>
You can specify&#160;multiple&#160;values&#160;by&#160;separating them&#160;with commas:&#160;“Case&#160;3,&#160;5,&#160;7”.&#160;The&#160;keyword&#160;To&#160;<br/>checks&#160;a&#160;range&#160;of values&#160;—&#160;for example, “Case&#160;5&#160;To&#160;10”. Open-ended ranges&#160;are&#160;checked as&#160;“Case&#160;&lt;&#160;<br/>10”&#160;or as&#160;“Case&#160;IS&#160;&lt;&#160;10”.<br/>
<b>TIP</b><br/>
The&#160;Case&#160;IS&#160;statement&#160;is different&#160;than the&#160;IS&#160;operator&#160;that&#160;decides if&#160;two objects&#160;are&#160;the&#160;same.<br/>
Every&#160;Case&#160;statement&#160;written&#160;“Case&#160;op expression”&#160;is&#160;shorthand for writing “Case&#160;IS&#160;op expression”.&#160;The&#160;<br/>form&#160;“Case&#160;expression”&#160;is&#160;shorthand&#160;for “Case&#160;IS&#160;=&#160;expression”. For&#160;example, “Case&#160;&gt;=&#160;5”&#160;is&#160;<br/>equivalent&#160;to&#160;“Case&#160;IS&#160;&gt;=&#160;5”, and “Case&#160;1+3”&#160;is&#160;equivalent&#160;to&#160;“Case&#160;IS&#160;=&#160;1+3”.<br/>
Select&#160;Case&#160;i<br/>
78<br/>
<hr/>
<a name=82></a>&#160;&#160;Case&#160;1,&#160;3,&#160;5<br/>&#160; &#160;&#160;Print&#160;&#34;i is one, three, or five&#34;<br/>&#160;&#160;Case&#160;6&#160;To&#160;10<br/>&#160; &#160;&#160;Print&#160;&#34;i is a value from 6 through 10&#34;<br/>&#160;&#160;Case&#160;&lt;&#160;-10<br/>&#160; &#160;&#160;Print&#160;&#34;i is less than -10&#34;<br/>&#160;&#160;Case&#160;IS&#160;&gt;&#160;10<br/>&#160; &#160;&#160;Print&#160;&#34;i is greater than 10&#34;<br/>&#160;&#160;Case&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;No idea what i is&#34;<br/>End&#160;Select<br/>
A&#160;Case&#160;statement&#160;can contain&#160;a&#160;list&#160;of expressions&#160;separated by&#160;commas. Each expression&#160;can include&#160;an&#160;<br/>open-ended range. Each expression can use&#160;the&#160;statement&#160;Case&#160;IS&#160;(see<a href="libremacros.html#82">&#160;Listing 52)</a>.<br/>
<i><b>Listing&#160;52.</b>&#160;The&#160;keyword&#160;IS is&#160;optional.<br/></i>Select&#160;Case&#160;i%<br/>&#160;&#160;Case&#160;6,&#160;Is&#160;=&#160;7,&#160;Is&#160;=&#160;8,&#160;Is&#160;&gt;&#160;15,&#160;Is&#160;&lt;&#160;0<br/>&#160; &#160;&#160;Print&#160;&#34;&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; matched&#34;<br/>&#160;&#160;Case&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; is out of range&#34;<br/>End&#160;Select<br/>
<i><b>If&#160;Case&#160;statements&#160;are&#160;easy,&#160;why&#160;are&#160;they&#160;frequently&#160;incorrect?<br/></b></i>I&#160;frequently&#160;see&#160;incorrect&#160;examples&#160;of Case&#160;statements. It’s&#160;instructive&#160;to&#160;see&#160;what&#160;is&#160;repeatedly&#160;done&#160;<br/>incorrectly.&#160;Consider the&#160;simple&#160;examples&#160;in<a href="libremacros.html#82">&#160;Table&#160;18.&#160;</a>The&#160;last&#160;examples&#160;are&#160;written&#160;correctly&#160;i<a href="libremacros.html#84">n&#160;Table&#160;20.</a><br/>
<i><b>Table&#160;18.</b>&#160;Case&#160;statements&#160;are&#160;frequently&#160;written incorrectly.</i><br/>
<i><b>Example</b></i><br/>
<i><b>Valid</b></i><br/>
<i><b>Description</b></i><br/>
Select&#160;Case&#160;i<br/>
Correct<br/>
The&#160;Case&#160;expression&#160;2 is&#160;evaluated&#160;as two.&#160;Two is&#160;compared&#160;to i.<br/>
&#160;&#160;Case&#160;2<br/>
Select&#160;Case&#160;i<br/>
Correct<br/>
The&#160;Case&#160;expression&#160;2 is&#160;evaluated&#160;as two.&#160;Two is&#160;compared&#160;to i.<br/>
&#160;&#160;Case&#160;Is&#160;=&#160;2<br/>
Select&#160;Case&#160;i<br/>
Correct<br/>
The&#160;expression 7&#160;is evaluated&#160;as seven. Seven is&#160;compared to&#160;i.<br/>
&#160;&#160;Case&#160;Is&#160;&gt;&#160;7<br/>
Select&#160;Case&#160;i<br/>
Correct<br/>
The&#160;conditional&#160;expression i&#160;is compared&#160;individually&#160;to 4,&#160;7,&#160;and&#160;9.<br/>
&#160;&#160;Case&#160;4,&#160;7,&#160;9<br/>
Select&#160;Case&#160;x<br/>
Correct<br/>
You can specify&#160;a&#160;range&#160;and&#160;use&#160;floating-point&#160;numbers.<br/>
&#160;&#160;Case&#160;1.3&#160;TO&#160;5.7<br/>
Select&#160;Case&#160;i<br/>
Incorrect<br/>
The&#160;Case&#160;expression&#160;(i=2)&#160;is&#160;evaluated as&#160;True&#160;or&#160;False.&#160;True&#160;or&#160;False&#160;is&#160;<br/>
&#160;&#160;Case&#160;i&#160;=&#160;2<br/>
compared&#160;to i.&#160;This is&#160;reduced to&#160;“IS&#160;=&#160;(i=2)”.<br/>
Select&#160;Case&#160;i<br/>
Incorrect<br/>
The&#160;Case&#160;expression&#160;(i&lt;2&#160;OR&#160;9&lt;i)&#160;is&#160;evaluated&#160;as&#160;True&#160;or&#160;False.&#160;True&#160;or&#160;<br/>
&#160;&#160;Case&#160;i&lt;2&#160;OR&#160;i&gt;9<br/>
False&#160;is compared&#160;to i.&#160;This&#160;is reduced&#160;to “IS&#160;=&#160;(i&lt;2&#160;OR&#160;9&lt;i)”.<br/>
Select&#160;Case&#160;i%<br/>
Incorrect<br/>
The&#160;Case&#160;expression&#160;(i&gt;2&#160;AND&#160;i&#160;&lt;&#160;10)&#160;is evaluated&#160;as&#160;True&#160;or&#160;False.&#160;True&#160;<br/>
&#160;&#160;Case&#160;i%&gt;2&#160;AND&#160;i%&lt;10<br/>
or&#160;False&#160;is&#160;compared&#160;to i.&#160;This is reduced&#160;to “IS&#160;=&#160;(i&gt;2&#160;AND&#160;i&lt;10)”.<br/>
Select&#160;Case&#160;i%<br/>
Incorrect<br/>
Again,&#160;True&#160;and False&#160;are&#160;compared&#160;to i.&#160;This&#160;is reduced&#160;to “IS&#160;&gt;&#160;(8&#160;AND&#160;<br/>
&#160;&#160;Case&#160;IS&gt;8&#160;And&#160;i&lt;11<br/>
i&lt;11)”.&#160;The&#160;precedence&#160;rules&#160;cause&#160;this&#160;to be&#160;reduced&#160;to “IS&#160;&gt;&#160;(8&#160;AND&#160;<br/>(i&lt;11))”.&#160;This is usually&#160;not&#160;what’s&#160;intended.&#160;<br/>
Select&#160;Case&#160;i%<br/>
Incorrect<br/>
Compile&#160;error.&#160;The&#160;keyword IS&#160;must&#160;immediately&#160;follow&#160;Case.<br/>
&#160;&#160;Case&#160;IS&gt;8&#160;And&#160;IS&lt;11<br/>
79<br/>
<hr/>
<a name=83></a>I&#160;have&#160;seen OOo examples&#160;with&#160;incorrect&#160;examples&#160;such as&#160;“Case&#160;i&#160;&gt;&#160;2&#160;AND&#160;i&#160;&lt;&#160;10”.&#160;This&#160;fails.&#160;Don’t&#160;<br/>believe&#160;it&#160;even though you&#160;see&#160;it&#160;in print.&#160;Understand why&#160;this&#160;fails&#160;and you&#160;have&#160;mastered Case&#160;statements.<br/>
The&#160;next&#160;to&#160;the&#160;last&#160;incorrect&#160;example&#160;i<a href="libremacros.html#82">n&#160;Table&#160;18&#160;de</a>monstrates&#160;the&#160;most&#160;common error that&#160;I&#160;see&#160;with&#160;Case&#160;<br/>expressions<a href="libremacros.html#83">.&#160;Listing&#160;53&#160;c</a>onsiders&#160;the&#160;case&#160;when i&#160;is&#160;less&#160;than 11, and the&#160;case&#160;when i&#160;is&#160;greater than or equal&#160;<br/>to 11.&#160;To&#160;put&#160;it&#160;simply,&#160;IS&gt;8&#160;AND&#160;i&lt;11&#160;has&#160;the&#160;Case&#160;statement&#160;comparing the&#160;value&#160;of i&#160;to the&#160;result&#160;of a&#160;<br/>Boolean expression,&#160;which&#160;can be&#160;only&#160;0 or -1.&#160;The&#160;big difficulty&#160;with Case&#160;statements&#160;is&#160;that&#160;they&#160;look like&#160;<br/>If&#160;statements, which&#160;are&#160;looking for a&#160;True&#160;or False, but&#160;Case&#160;statements&#160;are&#160;looking for a&#160;particular value&#160;<br/>against&#160;which to&#160;match the&#160;conditional,&#160;and 0 or -1 is&#160;not&#160;helpful.&#160;<br/>
Consider the&#160;second case&#160;in<a href="libremacros.html#83">&#160;Listing 53,&#160;</a>i&#160;&gt;=&#160;11.&#160;The&#160;operator &lt;&#160;has&#160;higher precedence&#160;than the&#160;operator&#160;<br/>AND, so it&#160;is&#160;evaluated&#160;first.&#160;The&#160;expression&#160;i&lt;11&#160;evaluates&#160;to&#160;False&#160;(because&#160;I&#160;assumed that&#160;i&gt;=11). False<br/>is&#160;internally&#160;represented as&#160;0. Zero has&#160;no bits&#160;set,&#160;so&#160;8&#160;AND&#160;0&#160;evaluates&#160;to&#160;zero. For values&#160;of i&#160;greater than&#160;<br/>or equal&#160;to 11, the&#160;entire&#160;expression&#160;is&#160;equivalent&#160;to&#160;“IS&#160;&gt;&#160;0”. In&#160;other words, for&#160;i&#160;=&#160;45, this&#160;Case&#160;<br/>statement&#160;is&#160;incorrectly&#160;accepted.<br/>
A&#160;similar&#160;argument&#160;for values&#160;of i&#160;less&#160;than 11, left&#160;as&#160;an exercise&#160;for the&#160;reader,&#160;demonstrates&#160;that&#160;the&#160;Case&#160;<br/>statement&#160;is&#160;equivalent&#160;to&#160;“Case&#160;IS&#160;&gt;&#160;8”.&#160;Therefore, values&#160;of i&#160;less&#160;than&#160;11&#160;are&#160;correctly&#160;evaluated,&#160;but&#160;<br/>values&#160;of i&#160;greater than or equal&#160;to&#160;11&#160;are&#160;not.<br/>
<i><b>Listing&#160;53.</b>&#160;“Case&#160;IS &gt;&#160;8&#160;AND&#160;i&#160;&lt; 11”&#160;reduces&#160;incorrectly.<br/></i>IS&#160;&gt;&#160;(8&#160;AND&#160;i&#160;&lt;&#160;11)&#160;=&gt;&#160;IS&#160;&gt;&#160;(8&#160;AND&#160;-1)&#160;=&gt;&#160;IS&#160;&gt;&#160;8&#160;'Assume i &lt; &#160;11 is correct.<br/>IS&#160;&gt;&#160;(8&#160;AND&#160;i&#160;&lt;&#160;11)&#160;=&gt;&#160;IS&#160;&gt;&#160;(8&#160;AND&#160;&#160;0)&#160;=&gt;&#160;IS&#160;&gt;&#160;0&#160;'Assume i &gt;= 11 is unwanted.<br/>
<i><b>Writing&#160;correct&#160;Case&#160;expressions<br/></b></i>After you&#160;learn a&#160;few&#160;simple&#160;examples,&#160;it’s&#160;easy&#160;to write&#160;correct&#160;Case&#160;expressions.<a href="libremacros.html#83">&#160;Table&#160;19&#160;a</a>bstractly&#160;<br/>enumerates&#160;the&#160;varieties,&#160;and<a href="libremacros.html#84">&#160;Listing&#160;57&#160;c</a>oncretely&#160;demonstrates&#160;the&#160;varieties.<br/>
<i><b>Table&#160;19.</b>&#160;Simple&#160;Case&#160;varieties.&#160;</i><br/>
<i><b>Example</b></i><br/>
<i><b>Description</b></i><br/>
Case&#160;IS&#160;operator&#160;expression<br/>
This&#160;is both&#160;the&#160;simplest&#160;case&#160;and the&#160;most&#160;difficult&#160;case.&#160;If&#160;the&#160;expression&#160;is<br/>a&#160;constant, it&#160;is&#160;easy&#160;to understand. If&#160;the&#160;expression is&#160;more&#160;complicated,&#160;<br/>
the&#160;only&#160;difficult&#160;part&#160;is building&#160;the&#160;expression.<br/>
Case&#160;expression<br/>
This&#160;is a&#160;reduction of&#160;“Case&#160;IS&#160;operator&#160;expression”&#160;when the&#160;operator&#160;<br/>
checks for&#160;equality.<br/>
Case&#160;expression&#160;TO&#160;expression<br/>
Check an inclusive&#160;range.&#160;This is&#160;usually&#160;done&#160;correctly.<br/>
Case&#160;expression,&#160;expression,&#160;<br/>
Each expression is&#160;compared.&#160;This is usually&#160;done&#160;correctly.<br/>
For&#160;the&#160;difficult&#160;cases, it&#160;suffices&#160;to produce&#160;an expression&#160;that&#160;evaluates&#160;to&#160;the&#160;Case&#160;condition expression&#160;if&#160;<br/>it&#160;is&#160;correct,&#160;and anything else&#160;if it&#160;is&#160;not.&#160;In&#160;other words, for Select&#160;Case&#160;4, the&#160;expression&#160;must&#160;evaluate&#160;to&#160;4<br/>for the&#160;statement&#160;block to&#160;run.<br/>
<i><b>Listing&#160;54.</b>&#160;If&#160;x&#160;is&#160;a String value, this&#160;will&#160;work&#160;for&#160;any&#160;Boolean expression.</i><br/>
Select&#160;Case&#160;x<br/>&#160;&#160;Case&#160;IIF(Boolean&#160;expression,&#160;x,&#160;x&amp;&#34;1&#34;)&#160;' Assumes that x is a string<br/>
In<a href="libremacros.html#83">&#160;Listing 54, x</a>&#160;is&#160;returned if the&#160;Boolean expression is&#160;True.&#160;The&#160;expression x=x&#160;is&#160;True, so the&#160;Case&#160;<br/>statement&#160;passes. If&#160;the&#160;Boolean expression&#160;is&#160;False, x&amp;&#34;1&#34; is&#160;returned.&#160;This&#160;is&#160;not&#160;the&#160;same&#160;string&#160;as&#160;x,&#160;so&#160;<br/>the&#160;Case&#160;statement&#160;will&#160;not&#160;pass.&#160;A&#160;similar method is&#160;used for numerical&#160;values.<br/>
80<br/>
<hr/>
<a name=84></a><i><b>Listing&#160;55.</b>&#160;If&#160;x&#160;is&#160;a numerical&#160;value, this&#160;will&#160;work&#160;for&#160;any&#160;Boolean expression.<br/></i>Select&#160;Case&#160;x<br/>&#160;&#160;Case&#160;IIF(Boolean&#160;expression,&#160;x,&#160;x+1)&#160;' Assumes that x is numeric<br/>
In<a href="libremacros.html#84">&#160;Listing 55, x</a>&#160;is&#160;returned if the&#160;Boolean expression is&#160;True.&#160;The&#160;expression x=x&#160;is&#160;True, so the&#160;Case&#160;<br/>statement&#160;passes. If&#160;the&#160;Boolean expression&#160;is&#160;False, x+1 is&#160;returned. For numerical&#160;values,&#160;x=x+1 is&#160;not&#160;<br/>True, so the&#160;Case&#160;statement&#160;will&#160;not&#160;pass.&#160;There&#160;is&#160;a&#160;possibility&#160;of numerical&#160;overflow,&#160;but&#160;in&#160;general&#160;this&#160;<br/>works.&#160;A&#160;brilliant&#160;and more&#160;elegant&#160;solution&#160;for numerical&#160;values&#160;is&#160;provided by&#160;Bernard Marcelly,&#160;a&#160;<br/>member of the&#160;OOo French translation&#160;project.<br/>
Case&#160;x&#160;XOR&#160;NOT&#160;(Boolean&#160;Expression)<br/>
This&#160;assumes&#160;that&#160;the&#160;Boolean expression returns&#160;True&#160;(-1) if it&#160;should&#160;pass&#160;and False&#160;(0) if it&#160;should&#160;not.<br/>
<i><b>Listing&#160;56.</b>&#160;This&#160;code&#160;uses&#160;XOR&#160;and NOT&#160;in a Case&#160;statement.</i><br/>
x&#160;XOR&#160;NOT(True)&#160;&#160;=&#160;x&#160;XOR&#160;NOT(-1)&#160;=&#160;x&#160;XOR&#160;&#160;0&#160;=&#160;&#160;x<br/>x&#160;XOR&#160;NOT(False)&#160;=&#160;x&#160;XOR&#160;NOT(&#160;0)&#160;=&#160;x&#160;XOR&#160;-1&#160;&lt;&gt;&#160;x<br/>
After my&#160;initial&#160;confusion, I&#160;realized&#160;how&#160;brilliant&#160;this&#160;really&#160;is.&#160;There&#160;are&#160;no problems&#160;with&#160;overflow&#160;and it&#160;<br/>works&#160;for all&#160;Integer values&#160;of x. Do not&#160;simplify&#160;this&#160;to the&#160;incorrect&#160;reduction&#160;“x&#160;AND&#160;(Boolean&#160;<br/>expression)”&#160;because&#160;it&#160;fails&#160;if&#160;x&#160;is&#160;0.<br/>
<i><b>Listing&#160;57.</b>&#160;Select&#160;Case&#160;example.<br/></i>Sub&#160;ExampleSelectCase<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;i&#160;=&#160;Int((20&#160;*&#160;Rnd)&#160;-2)&#160;'Rnd generates a random number between zero and one<br/>&#160;&#160;Select&#160;Case&#160;i%<br/>&#160; &#160;&#160;Case&#160;0<br/>&#160; &#160; &#160;&#160;Print&#160;&#34;&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; is Zero&#34;<br/>&#160; &#160;&#160;Case&#160;1&#160;To&#160;5<br/>&#160; &#160; &#160;&#160;Print&#160;&#34;&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; is a number from 1 through 5&#34;<br/>&#160; &#160;&#160;Case&#160;6,&#160;7,&#160;8<br/>&#160; &#160; &#160;&#160;Print&#160;&#34;&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; is the number 6, 7, or 8&#34;<br/>&#160; &#160;&#160;Case&#160;IIf(i&#160;&gt;&#160;8&#160;And&#160;i&#160;&lt;&#160;11,&#160;i,&#160;i+1)<br/>&#160; &#160; &#160;&#160;Print&#160;&#34;&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; is greater than 8 and less than 11&#34;<br/>&#160; &#160;&#160;Case&#160;i%&#160;XOR&#160;NOT(i%&#160;&gt;&#160;10&#160;AND&#160;i%&#160;&lt;&#160;16)<br/>&#160; &#160; &#160;&#160;Print&#160;&#34;&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; is greater than 10 and less than 16&#34;<br/>&#160; &#160;&#160;Case&#160;Else<br/>&#160; &#160; &#160;&#160;Print&#160;&#34;&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; is out of range 0 to 15&#34;<br/>&#160;&#160;End&#160;Select<br/>End&#160;Sub<br/>
ExampleSelectCase&#160;i<a href="libremacros.html#84">n&#160;Listing&#160;57&#160;g</a>enerates&#160;a&#160;random&#160;integer from&#160;-2 through 18 each time&#160;it&#160;runs. Run&#160;this&#160;<br/>repeatedly&#160;to&#160;see&#160;each Case&#160;statement&#160;used. Each of the&#160;cases&#160;could&#160;have&#160;used the&#160;IIF&#160;construct.&#160;<br/>
Now&#160;that&#160;I’ve&#160;explained the&#160;different&#160;methods&#160;to&#160;deal&#160;with&#160;ranges, it’s&#160;time&#160;to reevaluate&#160;the&#160;incorrect&#160;cases&#160;<br/>i<a href="libremacros.html#82">n&#160;Table&#160;18.&#160;</a>The&#160;solutions&#160;in<a href="libremacros.html#84">&#160;Table&#160;20&#160;a</a>re&#160;not&#160;the&#160;only&#160;possible&#160;solutions, but&#160;they&#160;use&#160;some&#160;of the&#160;solutions&#160;<br/>presented.<br/>
<i><b>Table&#160;20.&#160;</b>Incorrect&#160;examples&#160;from<a href="libremacros.html#82">&#160;Table&#160;18&#160;—</a></i><i>&#160;now&#160;corrected.</i><br/>
<i><b>Incorrect</b></i><br/>
<i><b>Correct</b></i><br/>
<i><b>Description</b></i><br/>
Select&#160;Case&#160;i<br/>
Select&#160;Case&#160;i<br/>
The&#160;variable&#160;i&#160;is compared&#160;to 2.<br/>
&#160;&#160;Case&#160;i&#160;=&#160;2<br/>
&#160;&#160;Case&#160;2<br/>
Select&#160;Case&#160;i<br/>
Select&#160;Case&#160;i<br/>
The&#160;variable&#160;i&#160;is compared&#160;to 2.<br/>
&#160;&#160;Case&#160;i&#160;=&#160;2<br/>
&#160;&#160;Case&#160;IS&#160;=&#160;2<br/>
81<br/>
<hr/>
<a name=85></a><i><b>Incorrect</b></i><br/>
<i><b>Correct</b></i><br/>
<i><b>Description</b></i><br/>
Select&#160;Case&#160;i<br/>
Select&#160;Case&#160;i<br/>
This&#160;works even if&#160;i&#160;is&#160;not&#160;an integer.<br/>
&#160;&#160;Case&#160;i&lt;2&#160;OR&#160;i&gt;9<br/>
&#160;&#160;Case&#160;IIf(i&lt;2&#160;OR&#160;i&gt;9,&#160;i,&#160;i+1)<br/>
Select&#160;Case&#160;i%<br/>
Select&#160;Case&#160;i%<br/>
i%&#160;is&#160;an integer&#160;so&#160;the&#160;range&#160;is from&#160;3&#160;<br/>
&#160;&#160;Case&#160;i%&gt;2&#160;AND&#160;i%&lt;10<br/>
&#160;&#160;Case&#160;3&#160;TO&#160;9<br/>
through 9.<br/>
Select&#160;Case&#160;i%<br/>
Select&#160;Case&#160;i%<br/>
This&#160;works because&#160;i%&#160;is&#160;an integer.<br/>
&#160;&#160;Case&#160;IS&gt;8&#160;And&#160;i&lt;11<br/>
&#160;&#160;Case&#160;i&#160;XOR&#160;NOT(i&gt;8&#160;AND&#160;i&lt;&#160;11)<br/>
<b>&#160;3.9.9.&#160;While&#160;...&#160;Wend<br/></b>Use&#160;the&#160;While&#160;...Wend&#160;statement&#160;to repeat&#160;a&#160;block of statements&#160;while&#160;a&#160;condition&#160;is&#160;true.&#160;This&#160;construct&#160;has&#160;<br/>limitations&#160;that&#160;do not&#160;exist&#160;with&#160;the&#160;Do&#160;While&#160;... Loop construct&#160;and offers&#160;no particular benefits.&#160;The&#160;<br/>While&#160;...&#160;Wend&#160;statement&#160;does&#160;not&#160;support&#160;an Exit&#160;statement.&#160;You cannot&#160;use&#160;GoTo&#160;to exit&#160;a&#160;While&#160;...&#160;Wend&#160;<br/>statement.<br/>
While&#160;Condition<br/>&#160;&#160;StatementBlock<br/>Wend<br/>
Visual&#160;Basic&#160;.NET&#160;does&#160;not&#160;support&#160;the&#160;keyword&#160;Wend.&#160;This&#160;is&#160;another reason to&#160;use&#160;the&#160;Do&#160;While&#160;... Loop&#160;<br/>instead.<br/>
<b>&#160;3.9.10.&#160;Do&#160;...&#160;Loop<br/></b>The&#160;Loop construct&#160;has&#160;different&#160;forms&#160;and is&#160;used to&#160;continue&#160;executing a&#160;block of code&#160;while,&#160;or until, a&#160;<br/>condition is&#160;true.&#160;The&#160;most&#160;common form&#160;checks&#160;the&#160;condition before&#160;the&#160;loop starts, and repeatedly&#160;<br/>executes&#160;a&#160;block&#160;of code&#160;as&#160;long as&#160;the&#160;condition&#160;is&#160;true. If&#160;the&#160;initial&#160;condition&#160;is&#160;false,&#160;the&#160;loop&#160;is&#160;never&#160;<br/>executed.<br/>
Do&#160;While&#160;condition<br/>&#160;&#160;Block<br/>&#160;&#160;[Exit&#160;Do]<br/>&#160;&#160;Block<br/>Loop<br/>
A&#160;similar,&#160;but&#160;much&#160;less&#160;common&#160;form,&#160;repeatedly&#160;executes&#160;the&#160;code&#160;as&#160;long as&#160;the&#160;condition is&#160;false. In&#160;<br/>other words, the&#160;code&#160;is&#160;executed until&#160;the&#160;condition&#160;becomes&#160;true. If&#160;the&#160;condition evaluates&#160;to true&#160;<br/>immediately,&#160;the&#160;loop&#160;never runs.<br/>
Do&#160;Until&#160;condition<br/>&#160;&#160;Block<br/>&#160;&#160;[Exit&#160;Do]<br/>&#160;&#160;Block<br/>Loop<br/>
You can place&#160;the&#160;check at&#160;the&#160;end of the&#160;loop,&#160;in which case&#160;the&#160;block of code&#160;is&#160;executed&#160;at&#160;least&#160;once.&#160;<br/>With the&#160;following construct, the&#160;loop runs&#160;at&#160;least&#160;once&#160;and then&#160;repeatedly&#160;runs&#160;as&#160;long&#160;as&#160;the&#160;condition&#160;is&#160;<br/>true:<br/>
Do<br/>&#160;&#160;Block<br/>&#160;&#160;[Exit&#160;Do]<br/>&#160;&#160;Block<br/>Loop&#160;While&#160;condition&#160;<br/>
82<br/>
<hr/>
<a name=86></a>To&#160;execute&#160;the&#160;loop at&#160;least&#160;once&#160;and then continue&#160;as&#160;long as&#160;the&#160;condition&#160;is&#160;false,&#160;use&#160;the&#160;following&#160;<br/>construct:<br/>
Do<br/>&#160;&#160;Block<br/>&#160;&#160;[Exit&#160;Do]<br/>&#160;&#160;Block<br/>Loop&#160;Until&#160;condition<br/>
<i><b>Exit&#160;the&#160;Do&#160;Loop<br/></b></i>The&#160;Exit&#160;Do statement&#160;causes&#160;an immediate&#160;exit&#160;from&#160;the&#160;loop.&#160;The&#160;Exit&#160;Do statement&#160;is&#160;valid only&#160;within a&#160;<br/>Do ... Loop. Program&#160;execution continues&#160;with&#160;the&#160;statement&#160;that&#160;follows&#160;the&#160;innermost&#160;Loop statement.&#160;The<br/>subroutine&#160;ExampleDo i<a href="libremacros.html#86">n&#160;Listing&#160;58&#160;de</a>monstrates&#160;a&#160;Do&#160;While&#160;Loop by&#160;searching an array&#160;for a&#160;number.<br/>
<i><b>Listing&#160;58.</b>&#160;Do Loop example.<br/></i>Sub&#160;ExampleDo<br/>&#160;&#160;Dim&#160;a(),&#160;i%,&#160;x%<br/>&#160;&#160;a()&#160;=&#160;Array(2,&#160;4,&#160;6,&#160;8,&#160;10,&#160;12,&#160;14,&#160;16,&#160;18,&#160;20,&#160;22,&#160;24,&#160;26,&#160;28,&#160;30)<br/>&#160;&#160;x&#160;=&#160;Int(32&#160;*&#160;Rnd)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM random integer between 0 and 32<br/>&#160;&#160;i&#160;=&#160;LBound(a())&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM i is the lower bound of the array.<br/>&#160;&#160;Do&#160;While&#160;a(i)&#160;&lt;&gt;&#160;x&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;REM while a(i) is not equal to x<br/>&#160; &#160;i&#160;=&#160;i&#160;+&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;REM Increment i<br/>&#160; &#160;If&#160;i&#160;&gt;&#160;UBound(a())&#160;Then&#160;Exit&#160;Do&#160; &#160;REM If i is too large, then exit<br/>&#160;&#160;Loop&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;REM Loop back to the Do While<br/>&#160;&#160;If&#160;i&#160;&lt;=&#160;UBound(a())&#160;Then&#160; &#160; &#160; &#160; &#160; &#160;REM If i is not too large then found x<br/>&#160; &#160;&#160;MsgBox&#160;&#34;Found &#34;&#160;&amp;&#160;x&#160;&amp;&#160;&#34; at location &#34;&#160;&amp;&#160;i,&#160;0,&#160;&#34;Example Do&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;MsgBox&#160;&#34;Could not find &#34;&#160;&amp;&#160;x&#160;&amp;&#160;&#34; in the array&#34;,&#160;0,&#160;&#34;Example Do&#34;<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
<i><b>Which&#160;Do&#160;Loop&#160;should&#160;I&#160;use?<br/></b></i>OOo Basic&#160;supports&#160;four variants&#160;of the&#160;Do Loop construct. Each variant&#160;has&#160;a&#160;particular purpose&#160;and time&#160;<br/>for use.&#160;The&#160;most&#160;common problem&#160;is&#160;that&#160;the&#160;loop runs&#160;one&#160;time&#160;too&#160;few&#160;or one&#160;time&#160;too&#160;many&#160;because&#160;the&#160;<br/>conditional&#160;expression was&#160;incorrectly&#160;placed at&#160;the&#160;wrong location.<br/>
When&#160;deciding where&#160;to place&#160;the&#160;conditional&#160;expression of a&#160;Do Loop, ask yourself this&#160;question:&#160;“Must&#160;<br/>the&#160;loop&#160;always&#160;run at&#160;least&#160;once?”&#160;If&#160;the&#160;answer is&#160;no, the&#160;conditional&#160;expression&#160;must&#160;be&#160;at&#160;the&#160;top.&#160;This&#160;<br/>will&#160;prevent&#160;the&#160;code&#160;in the&#160;loop from&#160;running if the&#160;conditional&#160;expression fails.&#160;Consider,&#160;for example,&#160;<br/>printing all&#160;of the&#160;elements&#160;in&#160;an array&#160;of unknown size.&#160;The&#160;array&#160;might&#160;contain&#160;no elements&#160;at&#160;all, in&#160;which<br/>case&#160;the&#160;code&#160;in&#160;the&#160;loop&#160;shouldn’t&#160;run (see<a href="libremacros.html#86">&#160;Table&#160;21).</a><br/>
<i><b>Table&#160;21.</b>&#160;While&#160;and Until&#160;loops&#160;are&#160;very&#160;similar.</i><br/>
<b>Do While</b><br/>
<b>Do Until</b><br/>
i%&#160;=&#160;LBound(a())<br/>
i%&#160;=&#160;LBound(a())<br/>
Do&#160;While&#160;i%&#160;&lt;=&#160;UBound(a())<br/>
Do&#160;Until&#160;i%&#160;&gt;&#160;UBound(a())<br/>
&#160;&#160;Print&#160;a(i%)<br/>
&#160;&#160;Print&#160;a(i%)<br/>
&#160;&#160;i%&#160;=&#160;i%&#160;+&#160;1<br/>
&#160;&#160;i%&#160;=&#160;i%&#160;+&#160;1<br/>
Loop<br/>
Loop<br/>
83<br/>
<hr/>
<a name=87></a>In&#160;each case&#160;i<a href="libremacros.html#86">n&#160;Table&#160;21, i</a>f the&#160;array&#160;is&#160;empty,&#160;the&#160;loop&#160;never runs. Before&#160;the&#160;condition is&#160;evaluated, i% is&#160;<br/>set&#160;to&#160;the&#160;lower bound of the&#160;array.&#160;In&#160;each case, the&#160;loop continues&#160;to run while&#160;i%&#160;is&#160;not&#160;larger than&#160;the&#160;<br/>upper bound.&#160;<br/>
Consider the&#160;difference&#160;between a&#160;While&#160;loop&#160;and an Until&#160;loop with&#160;a&#160;simple&#160;example.&#160;While&#160;the&#160;car has&#160;<br/>gas, you may&#160;drive&#160;it.&#160;Until&#160;the&#160;car does&#160;not&#160;have&#160;gas, you&#160;may&#160;drive&#160;it.&#160;The&#160;primary&#160;difference&#160;between the&#160;<br/>While&#160;and the&#160;Until&#160;is&#160;the&#160;word NOT.&#160;Tending more&#160;toward OOo Basic, I&#160;can write&#160;“Until&#160;NOT&#160;(the&#160;car has&#160;<br/>gas).”&#160;The&#160;choice&#160;between&#160;While&#160;and Until&#160;is&#160;usually&#160;based on which one&#160;you&#160;can write&#160;without&#160;the&#160;NOT.<br/>
If&#160;the&#160;loop&#160;should&#160;run at&#160;least&#160;once, move&#160;the&#160;conditional&#160;expression&#160;to the&#160;end of the&#160;Do Loop. Consider&#160;<br/>requesting user input&#160;until&#160;a&#160;valid&#160;value&#160;has&#160;been entered.&#160;The&#160;most&#160;natural&#160;choice&#160;is&#160;to&#160;place&#160;the&#160;conditional<br/>expression at&#160;the&#160;end.<br/>
Dim&#160;s$,&#160;x&#160;As&#160;Double<br/>Do<br/>&#160;&#160;s$&#160;=&#160;InputBox(&#34;Enter a number from 1 through 5&#34;)<br/>&#160;&#160;x&#160;=&#160;CDbl(s$)&#160; &#160; &#160;'Convert the string to a Double<br/>Loop&#160;Until&#160;x&#160;&gt;=&#160;1&#160;AND&#160;x&#160;&lt;=&#160;5<br/>
The&#160;loop must&#160;run at&#160;least&#160;once&#160;so that&#160;at&#160;least&#160;one&#160;number is&#160;entered.&#160;The&#160;loop repeats&#160;until&#160;a&#160;valid value&#160;is&#160;<br/>entered.&#160;As&#160;an exercise,&#160;consider how&#160;to write&#160;this&#160;as&#160;a&#160;While&#160;loop.<br/>
<b>&#160;3.9.11.&#160;For&#160;...&#160;Next<br/></b>The&#160;For&#160;... Next&#160;statement&#160;repeats&#160;a&#160;block&#160;of statements&#160;a&#160;specified number of times.<br/>
For&#160;counter=start&#160;To&#160;end&#160;[Step&#160;stepValue]<br/>&#160;&#160;statement&#160;block1<br/>&#160;&#160;[Exit&#160;For]<br/>&#160;&#160;statement&#160;block2<br/>Next&#160;[counter]<br/>
The&#160;numeric&#160;“counter”&#160;is&#160;initially&#160;assigned the&#160;“start”&#160;value.&#160;When the&#160;program&#160;reaches&#160;the&#160;Next&#160;statement,&#160;<br/>the&#160;counter is&#160;incremented by&#160;the&#160;“step”&#160;value,&#160;or incremented by&#160;one&#160;if a&#160;“step”&#160;value&#160;is&#160;not&#160;specified. If&#160;the<br/>“counter”&#160;is&#160;still&#160;less&#160;than or equal&#160;to&#160;the&#160;“end”&#160;value,&#160;the&#160;statement&#160;blocks&#160;run.&#160;An equivalent&#160;Do&#160;While&#160;<br/>Loop follows:<br/>
counter&#160;=&#160;start<br/>Do&#160;While&#160;counter&#160;&lt;=&#160;end<br/>&#160;&#160;statement&#160;block1<br/>&#160;&#160;[Exit&#160;Do]<br/>&#160;&#160;statement&#160;block2<br/>&#160;&#160;counter&#160;=&#160;counter&#160;+&#160;step<br/>Loop<br/>
The&#160;“counter”&#160;is&#160;optional&#160;on the&#160;“Next”&#160;statement,&#160;and it&#160;automatically&#160;refers&#160;to&#160;the&#160;most&#160;recent&#160;“For”&#160;<br/>statement.<br/>
For&#160;i&#160;=&#160;1&#160;To&#160;4&#160;Step&#160;2<br/>&#160;&#160;Print&#160;i&#160;' Prints 1 then 3<br/>Next&#160;i&#160; &#160;&#160;' The i in this statement is optional.<br/>
The&#160;Exit&#160;For statement&#160;leaves&#160;the&#160;For&#160;statement&#160;immediately.&#160;The&#160;most&#160;recent&#160;For statement&#160;is&#160;exite<a href="libremacros.html#88">d.<br/>Listing 59&#160;de</a>monstrates&#160;this&#160;with&#160;a&#160;sorting routine.&#160;An array&#160;is&#160;filled&#160;with random&#160;integers, and then sorted&#160;<br/>using two nested loops.&#160;This&#160;technique&#160;is&#160;called a&#160;“modified bubble&#160;sort.”<br/>
84<br/>
<hr/>
<a name=88></a>First, iOuter is&#160;set&#160;to&#160;the&#160;last&#160;number in the&#160;array.&#160;The&#160;inner loop,&#160;using iInner,&#160;compares&#160;every&#160;number to the<br/>one&#160;after it. If&#160;the&#160;first&#160;number is&#160;larger than the&#160;second number,&#160;the&#160;two numbers&#160;are&#160;swapped.&#160;The&#160;second&#160;<br/>number is&#160;then&#160;compared to&#160;the&#160;third number.&#160;After the&#160;inner loop&#160;is&#160;finished, the&#160;largest&#160;number is&#160;<br/>guaranteed to&#160;be&#160;at&#160;the&#160;last&#160;position&#160;in the&#160;array.<br/>
Next,&#160;iOuter is&#160;decremented by&#160;1.&#160;The&#160;inner loop&#160;this&#160;time&#160;ignores&#160;the&#160;last&#160;number in&#160;the&#160;array,&#160;and&#160;<br/>compares&#160;every&#160;number to the&#160;one&#160;after it.&#160;At&#160;the&#160;end of the&#160;inner loop,&#160;the&#160;second-highest&#160;number is&#160;second<br/>from&#160;the&#160;end.<br/>
With each iteration, one&#160;more&#160;number is&#160;moved&#160;into&#160;position.&#160;If&#160;no numbers&#160;are&#160;exchanged, the&#160;list&#160;is&#160;sorted.<br/>
<i><b>Listing&#160;59.</b>&#160;Modified&#160;bubble&#160;sort.<br/></i>Sub&#160;ExampleForNextSort<br/>&#160;&#160;Dim&#160;iEntry(10)&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;iOuter&#160;As&#160;Integer,&#160;iInner&#160;As&#160;Integer,&#160;iTemp&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;bSomethingChanged&#160;As&#160;Boolean<br/>
&#160;&#160;' Fill the array with integers between -10 and 10<br/>&#160;&#160;For&#160;iOuter&#160;=&#160;LBound(iEntry())&#160;To&#160;Ubound(iEntry())<br/>&#160; &#160;&#160;iEntry(iOuter)&#160;=&#160;Int((20&#160;*&#160;Rnd)&#160;-10)<br/>&#160;&#160;Next&#160;iOuter<br/>
&#160;&#160;' iOuter runs from the highest item to the lowest<br/>&#160;&#160;For&#160;iOuter&#160;=&#160;UBound(iEntry())&#160;To&#160;LBound(iEntry())&#160;Step&#160;-1<br/>
&#160; &#160;&#160;'Assume that the array is already sorted and see if this is incorrect<br/>&#160; &#160;&#160;bSomethingChanged&#160;&#160;=&#160;False<br/>&#160; &#160;&#160;For&#160;iInner&#160;=&#160;LBound(iEntry())&#160;To&#160;iOuter-1<br/>&#160; &#160; &#160;&#160;If&#160;iEntry(iInner)&#160;&gt;&#160;iEntry(iInner+1)&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;iTemp&#160;=&#160;iEntry(iInner)<br/>&#160; &#160; &#160; &#160;&#160;iEntry(iInner)&#160;=&#160;iEntry(iInner+1)<br/>&#160; &#160; &#160; &#160;&#160;iEntry(iInner+1)&#160;=&#160;iTemp<br/>&#160; &#160; &#160; &#160;&#160;bSomethingChanged&#160;&#160;=&#160;True<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Next&#160;iInner<br/>&#160; &#160;&#160;'If the array is already sorted then stop looping!<br/>&#160; &#160;&#160;If&#160;Not&#160;bSomethingChanged&#160;Then&#160;Exit&#160;For<br/>&#160;&#160;Next&#160;iOuter<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;For&#160;iOuter&#160;=&#160;LBound(iEntry())&#160;To&#160;Ubound(iEntry())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;iOuter&#160;&amp;&#160;&#34; : &#34;&#160;&amp;&#160;iEntry(iOuter)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next&#160;iOuter<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Sorted Array&#34;<br/>End&#160;Sub<br/>
<b>&#160;3.9.12.&#160;Exit&#160;Sub&#160;and&#160;Exit&#160;Function<br/></b>The&#160;Exit&#160;Sub&#160;statement&#160;exits&#160;a&#160;subroutine, and the&#160;Exit&#160;Function statement&#160;exits&#160;a&#160;function.&#160;The&#160;routine&#160;is&#160;<br/>exited&#160;immediately.&#160;The&#160;macro continues&#160;running at&#160;the&#160;statement&#160;following the&#160;statement&#160;that&#160;called&#160;the&#160;<br/>current&#160;routine.&#160;These&#160;statements&#160;work only&#160;to&#160;exit&#160;the&#160;currently&#160;running routine,&#160;and they&#160;are&#160;valid only&#160;in&#160;<br/>their respective&#160;types. For&#160;example, you can’t&#160;use&#160;Exit&#160;Sub in&#160;a&#160;function.<br/>
85<br/>
<hr/>
<a name=89></a><i><b>&#160;3.10.&#160;Error&#160;handling&#160;using&#160;On&#160;Error<br/></b></i>Errors&#160;are&#160;usually&#160;placed into three&#160;“categories”&#160;—&#160;compile&#160;time, run time, and logic. Compile-time&#160;errors&#160;<br/>are&#160;typically&#160;syntax&#160;errors&#160;such as&#160;missing&#160;double&#160;quotation marks&#160;that&#160;prevent&#160;your macro from&#160;compiling.&#160;<br/>Compile-time&#160;errors&#160;are&#160;the&#160;easiest&#160;to&#160;deal&#160;with&#160;because&#160;they&#160;are&#160;found immediately&#160;and the&#160;IDE&#160;shows&#160;you&#160;<br/>which&#160;line&#160;caused the&#160;problem.&#160;Run-time&#160;errors&#160;compile&#160;properly&#160;but&#160;cause&#160;an error when the&#160;macro runs.&#160;<br/>For&#160;example, dividing by&#160;a&#160;variable&#160;that&#160;at&#160;some&#160;point&#160;evaluates&#160;to&#160;zero will&#160;cause&#160;a&#160;run-time&#160;error.&#160;The&#160;<br/>third&#160;type, logic&#160;errors, are&#160;mistakes&#160;in the&#160;business&#160;logic&#160;of the&#160;program:&#160;They&#160;compile&#160;and run okay,&#160;but&#160;<br/>generate&#160;the&#160;wrong&#160;answers.&#160;They’re&#160;the&#160;worst&#160;kind&#160;because&#160;you&#160;have&#160;to find&#160;them&#160;yourself&#160;—&#160;the&#160;computer<br/>won’t&#160;help you at&#160;all.&#160;This&#160;section&#160;is&#160;about&#160;run-time&#160;errors:&#160;how&#160;to&#160;deal&#160;with them&#160;and how&#160;to correct&#160;them.<br/>
An error handler is&#160;a&#160;piece&#160;of code&#160;that&#160;runs&#160;when an error occurs.&#160;The&#160;default&#160;error handler displays&#160;an error<br/>message&#160;and stops&#160;the&#160;macro. OOo Basic&#160;provides&#160;a&#160;mechanism&#160;to&#160;modify&#160;this&#160;behavior&#160;(see<a href="libremacros.html#89">&#160;Table&#160;22)</a>.&#160;The&#160;<br/>first&#160;form,&#160;On Error Resume&#160;Next,&#160;tells&#160;OOo to ignore&#160;all&#160;errors:&#160;No matter what&#160;happens, keep running&#160;and&#160;<br/>pretend&#160;everything is&#160;fine.&#160;The&#160;second form, On Error GoTo&#160;0, tells&#160;OOo to&#160;stop using the&#160;current&#160;error&#160;<br/>handler.&#160;Ignoring&#160;error handler scope&#160;issues, as&#160;explained later,&#160;think of On Error GoTo&#160;0 as&#160;restoring the&#160;<br/>default&#160;method of handling errors:&#160;Stop running&#160;and display&#160;an error message.&#160;The&#160;final&#160;form, On Error&#160;<br/>GoTo&#160;LabelName, allows&#160;you&#160;to&#160;define&#160;code&#160;to&#160;handle&#160;errors&#160;the&#160;way&#160;that&#160;you want.&#160;This&#160;is&#160;called&#160;“setting&#160;<br/>up an error handler.”&#160;<br/>
<i><b>Table&#160;22.</b>&#160;Supported On Error&#160;forms.</i><br/>
<i><b>Form</b></i><br/>
<i><b>Usage</b></i><br/>
On&#160;Error&#160;Resume&#160;Next<br/>
Ignore&#160;errors and continue&#160;running&#160;at&#160;the&#160;next&#160;line&#160;in the&#160;<br/>
macro.<br/>
On&#160;Error&#160;GoTo&#160;0<br/>
Cancel&#160;the&#160;current&#160;error&#160;handler.<br/>
On&#160;Error&#160;GoTo&#160;LabelName<br/>
Transfer&#160;control&#160;to&#160;the&#160;specified label.<br/>
When&#160;an error occurs, the&#160;code&#160;that&#160;was&#160;running stops&#160;running, and control&#160;is&#160;transferred to&#160;the&#160;current&#160;error<br/>handler.&#160;The&#160;error handlers&#160;use&#160;the&#160;functions&#160;i<a href="libremacros.html#89">n&#160;Table&#160;23&#160;t</a>o&#160;determine&#160;the&#160;cause&#160;and location of the&#160;error.&#160;<br/>Visual&#160;Basic&#160;uses&#160;an Error object&#160;and does&#160;not&#160;support&#160;the&#160;functions&#160;i<a href="libremacros.html#89">n&#160;Table&#160;23.</a><br/>
<i><b>Table&#160;23.</b>&#160;Error-related variables&#160;and functions.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Use</b></i><br/>
CVErr<br/>
Convert&#160;an&#160;expression to an error&#160;object.&#160;<br/>
Erl<br/>
Integer&#160;line&#160;number&#160;of&#160;the&#160;last&#160;error.<br/>
Err<br/>
Integer&#160;error&#160;number&#160;of&#160;the&#160;last&#160;error.<br/>
Error<br/>
Error&#160;message&#160;of&#160;the&#160;last&#160;error.<br/>
All&#160;error handlers&#160;must&#160;be&#160;declared in a&#160;routine&#160;and are&#160;local&#160;to the&#160;containing subroutine&#160;or function.&#160;When&#160;<br/>an error occurs, OOo Basic&#160;starts&#160;working backward through the&#160;call&#160;stack until&#160;it&#160;finds&#160;an error handler.&#160;If&#160;it<br/>doesn’t&#160;find an error handler,&#160;it&#160;uses&#160;the&#160;default&#160;handler.&#160;The&#160;default&#160;handler prints&#160;an error message&#160;and&#160;<br/>halts&#160;the&#160;program.&#160;The&#160;error information,&#160;such as&#160;Erl,&#160;indicates&#160;the&#160;line&#160;number in&#160;the&#160;current&#160;routine&#160;that&#160;<br/>caused the&#160;error.&#160;For&#160;example, if the&#160;current&#160;routine&#160;calls&#160;the&#160;function b() at&#160;line&#160;34 and an error occurs&#160;in&#160;<br/>b(), the&#160;error is&#160;reported&#160;as&#160;occurring at&#160;line<a href="libremacros.html#89">&#160;34.&#160;Listing 60&#160;c</a>ontains&#160;an example&#160;of this,&#160;a<a href="libremacros.html#90">nd&#160;Figure&#160;36&#160;s</a>hows&#160;<br/>the&#160;call&#160;stack.&#160;Another example&#160;is&#160;shown i<a href="libremacros.html#92">n&#160;Listing&#160;64.</a><br/>
<i><b>Listing&#160;60.</b>&#160;Use&#160;Erl&#160;to&#160;get&#160;the&#160;line&#160;number.<br/></i>&#160;&#160;x&#160;=&#160;x&#160;+&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Assume that this is line 33<br/>
86<br/>
<hr/>
<a name=90></a>&#160;&#160;Call&#160;b()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Error in b() or something b() calls (line 34)<br/>&#160;&#160;Exit&#160;Sub&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Leave the subroutine<br/>ErrorHandler:&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'No other handlers between here and the error<br/>&#160;&#160;Print&#160;&#34;error at &#34;&#160;&amp;&#160;Erl&#160;&#160;'Prints line 34<br/>
<i><b>Figure&#160;36.</b>&#160;Walk&#160;the&#160;call&#160;stack&#160;to&#160;find a handler.</i><br/>
You cannot&#160;catch errors&#160;that&#160;occur in&#160;a&#160;DLL.&#160;Check the&#160;return code&#160;from&#160;the&#160;called&#160;DLL&#160;instead.<br/>
<b>&#160;3.10.1.&#160;CVErr<br/></b>Use&#160;CVErr (as&#160;mentioned&#160;i<a href="libremacros.html#89">n&#160;Table&#160;23) t</a>o create&#160;an OOo specific&#160;internal&#160;data&#160;type&#160;that&#160;represents&#160;an error.&#160;I&#160;<br/>have&#160;never seen this&#160;done, but&#160;it&#160;can be&#160;useful&#160;for a&#160;very&#160;robust&#160;function.&#160;<br/>
CVErr returns&#160;an internal&#160;OOo type&#160;that&#160;should be&#160;assigned to a&#160;variant&#160;variable.&#160;Why?<br/>
1.&#160;Use&#160;VarType&#160;to check the&#160;type&#160;of the&#160;returned value.&#160;A&#160;VarType&#160;of 10 means&#160;that&#160;an error object&#160;was&#160;<br/>
returned (see<a href="libremacros.html#225">&#160;Table&#160;85).</a><br/>
2.&#160;CVErr accepts&#160;an integer,&#160;which&#160;represents&#160;the&#160;internal&#160;error code&#160;that&#160;occurred.&#160;The&#160;internal&#160;error&#160;<br/>
object&#160;casts&#160;to&#160;an integer and returns&#160;that&#160;internal&#160;error code.<br/>
The&#160;following&#160;example&#160;demonstrates&#160;CVErr.<br/>
<i><b>Listing&#160;61.</b>&#160;Using&#160;CVErr<br/></i>Sub&#160;CallNotZero<br/>&#160;&#160;Dim&#160;xVar&#160;As&#160;Variant<br/>&#160;&#160;Dim&#160;xInt&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;For&#160;i&#160;=&#160;-1&#160;To&#160;1&#160;<br/>&#160; &#160;&#160;xInt&#160;=&#160;NotZero(i)<br/>&#160; &#160;&#160;xVar&#160;=&#160;NotZero(i)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;NotZero(&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34;) = [&#34;&#160;&amp;&#160;xInt&#160;&amp;&#160;&#34;] when assigned to an Integer&#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;NotZero(&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34;) = [&#34;&#160;&amp;&#160;xVar&#160;&amp;&#160;&#34;] VarType=&#34;&#160;&amp;&#160;VarType(xVar)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
Function&#160;NotZero(x&#160;As&#160;Integer)<br/>
87<br/>
<hr/>
<a name=91></a>&#160;&#160;If&#160;x&#160;&lt;&gt;&#160;0&#160;Then<br/>&#160; &#160;&#160;NotZero&#160;=&#160;x<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;' 7 is an arbitrary number meaning nothing.<br/>&#160; &#160;&#160;NotZero&#160;=&#160;CVErr(7)<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
<i><b>Figure&#160;37.</b>&#160;Return&#160;values&#160;using CVErr.</i><br/>
<b>&#160;3.10.2.&#160;Ignore&#160;errors&#160;with&#160;On&#160;Error&#160;Resume&#160;Next<br/></b>Error handling, in some&#160;cases, means&#160;ignoring errors.&#160;The&#160;On Error Resume&#160;statement&#160;tells&#160;OOo Basic&#160;that&#160;<br/>if a&#160;standard error occurs, it&#160;should&#160;ignore&#160;the&#160;error and resume&#160;running the&#160;code&#160;at&#160;the&#160;next&#160;line&#160;in&#160;the&#160;<br/>macro (see<a href="libremacros.html#91">&#160;Listing 62)</a>.&#160;The&#160;error information&#160;is&#160;cleared, so it&#160;isn’t&#160;possible&#160;to check if an error occurred&#160;<br/>following&#160;the&#160;statement.<br/>
<i><b>Listing&#160;62.</b>&#160;The&#160;error&#160;is&#160;cleared by&#160;the&#160;Resume&#160;Next&#160;statement.</i><br/>
Private&#160;zero%<br/>sub&#160;ExampleErrorResumeNext<br/>&#160;&#160;On&#160;Error&#160;Resume&#160;Next<br/>&#160;&#160;Print&#160;1/Zero%<br/>&#160;&#160;If&#160;Err&#160;&lt;&gt;&#160;0&#160;Then&#160;Print&#160;Error$&#160;&amp;&#160;&#34; at line &#34;&#160;&amp;&#160;Erl&#160;'Err was cleared<br/>End&#160;Sub<br/>
<b>&#160;3.10.3.&#160;Clear&#160;an&#160;error&#160;handler&#160;with&#160;On&#160;Error&#160;GoTo&#160;0<br/></b>Use&#160;the&#160;statement&#160;On Error GoTo&#160;0 to&#160;clear an installed error handler.&#160;This&#160;is&#160;usually&#160;done&#160;inside&#160;an error&#160;<br/>handler or after the&#160;code&#160;that&#160;used one. If&#160;an error occurs&#160;inside&#160;an error handler,&#160;it&#160;isn’t&#160;handled and the&#160;<br/>macro stops.<br/>
<i><b>Listing&#160;63.</b>&#160;The&#160;error&#160;handler&#160;is&#160;cleared with the&#160;statement&#160;On Error&#160;GoTo&#160;0.<br/></i>Private&#160;zero%<br/>sub&#160;ExampleErrorResumeNext<br/>&#160;&#160;On&#160;Error&#160;Resume&#160;Next<br/>&#160;&#160;Print&#160;1/Zero%<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;0<br/>&#160;&#160;...<br/>End&#160;Sub<br/>
Some&#160;versions&#160;of&#160;Visual&#160;Basic&#160;also&#160;support&#160;On Error GoTo&#160;-1, which is&#160;equivalent&#160;to&#160;On Error GoTo&#160;0.<br/>
88<br/>
<hr/>
<a name=92></a><b>&#160;3.10.4.&#160;Specify&#160;your&#160;own&#160;error&#160;handler&#160;with&#160;On&#160;Error&#160;GoTo&#160;Label<br/></b>To&#160;specify&#160;your&#160;own error handler,&#160;use&#160;On Error GoTo&#160;Label.&#160;To&#160;define&#160;a&#160;label&#160;in&#160;OOo Basic,&#160;type&#160;some&#160;text<br/>on a&#160;line&#160;by&#160;itself and follow&#160;it&#160;with&#160;a&#160;colon.&#160;Line&#160;labels&#160;are&#160;no longer required to&#160;be&#160;unique;&#160;they&#160;must&#160;be&#160;<br/>unique&#160;only&#160;within each routine.&#160;This&#160;allows&#160;for consistency&#160;in naming error-handling routines&#160;rather than&#160;<br/>creating a&#160;unique&#160;name&#160;for every&#160;error handler (see<a href="libremacros.html#92">&#160;Listing&#160;64&#160;and&#160;Figure&#160;38).&#160;</a>When an error occurs,&#160;<br/>execution&#160;is&#160;transferred to&#160;the&#160;label.<br/>
<i><b>Listing&#160;64.</b>&#160;Error&#160;Handling.<br/></i>Private&#160;zero%<br/>Private&#160;error_s$<br/>Sub&#160;ExampleJumpErrorHandler<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;ExErrorHandler<br/>&#160;&#160;JumpError1<br/>&#160;&#160;JumpError2<br/>&#160;&#160;Print&#160;1/Zero%<br/>&#160;&#160;MsgBox&#160;error_s,&#160;0,&#160;&#34;Jump Error Handler&#34;<br/>&#160;&#160;Exit&#160;Sub<br/>ExErrorHandler:<br/>&#160;&#160;error_s&#160;=&#160;error_s&#160;&amp;&#160;&#34;Error in MainJumpErrorHandler at line &#34;&#160;&amp;&#160;Erl()&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34; : &#34;&#160;&amp;&#160;Error()&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Resume&#160;Next<br/>End&#160;Sub<br/>Sub&#160;JumpError1<br/>&#160;&#160;REM Causes a jump to the handler in ExampleJumpErrorHandler.<br/>&#160;&#160;REM The main error handler indicates that the error location is<br/>&#160;&#160;REM at the call to JumpError1 and not in JumpError1.<br/>&#160;&#160;Print&#160;1/zero%<br/>&#160;&#160;error_s&#160;=&#160;error_s&#160;&amp;&#160;&#34;Hey, I am in JumpError1&#34;&#160;&amp;&#160;CHR$(10)<br/>End&#160;Sub<br/>
Sub&#160;JumpError2<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;ExErrorHandler<br/>&#160;&#160;Print&#160;1/zero%<br/>&#160;&#160;Exit&#160;Sub<br/>ExErrorHandler:<br/>&#160;&#160;error_s&#160;=&#160;error_s&#160;&amp;&#160;&#34;Error in JumpError2 at line &#34;&#160;&amp;&#160;Erl()&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34; : &#34;&#160;&amp;&#160;Error()&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Resume&#160;Next<br/>End&#160;Sub<br/>
<i><b>Figure&#160;38.</b>&#160;The&#160;last&#160;error&#160;handler&#160;declared is&#160;used.</i><br/>
A&#160;routine&#160;can contain&#160;several&#160;On Error statements. Each On Error statement&#160;can treat&#160;errors&#160;differently.&#160;The&#160;<br/>error handlers&#160;in<a href="libremacros.html#92">&#160;Listing 64&#160;a</a>ll&#160;used Resume&#160;Next&#160;to ignore&#160;the&#160;error and continue&#160;execution&#160;at&#160;the&#160;line&#160;<br/>following&#160;the&#160;error.&#160;Using multiple&#160;error handlers, it&#160;is&#160;possible&#160;to&#160;skip&#160;sections&#160;of code&#160;when an error&#160;<br/>occurs&#160;(see<a href="libremacros.html#93">&#160;Listing 65)</a>.<br/>
89<br/>
<hr/>
<a name=93></a><b>TIP</b><br/>
The&#160;OOo&#160;version&#160;3.20&#160;help&#160;still&#160;incorrectly&#160;states that&#160;error&#160;handling&#160;must&#160;occur&#160;at&#160;the&#160;start&#160;of&#160;a&#160;routine.&#160;<br/>
<i><b>Listing&#160;65.</b>&#160;Skip sections&#160;of&#160;code&#160;when an error&#160;occurs.<br/></i>&#160;&#160;On&#160;Error&#160;GoTo&#160;PropertiesDone&#160; &#160; &#160;'Ignore any errors in this section.<br/>&#160;&#160;a()&#160;=&#160;getProperties()&#160; &#160; &#160; &#160; &#160; &#160;&#160;'If unable to get properties then<br/>&#160;&#160;DisplayStuff(a(),&#160;&#34;Properties&#34;)&#160;&#160;'an error will prevent getting here.<br/>PropertiesDone:<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;MethodsDone&#160; &#160; &#160; &#160;&#160;'Ignore any errors in this section.<br/>&#160;&#160;a()&#160;=&#160;getMethods()<br/>&#160;&#160;DisplayStuff(a(),&#160;&#34;Methods&#34;)<br/>MethodsDone:<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Turn off current error handlers.<br/>
When&#160;you&#160;write&#160;an error handler,&#160;you must&#160;decide&#160;how&#160;to&#160;handle&#160;errors.&#160;The&#160;functions&#160;in<a href="libremacros.html#89">&#160;Table&#160;23&#160;a</a>re&#160;used&#160;<br/>to diagnose&#160;errors&#160;and to&#160;display&#160;or log error messages.&#160;There&#160;is&#160;also&#160;the&#160;question&#160;of flow&#160;control.&#160;Here&#160;are&#160;<br/>some&#160;error-handling guidelines:<br/>
Exit the subroutine or function using Exit Sub or Exit Function.<br/>Let the macro continue to run and ignore the error (see<a href="libremacros.html#93"> Listing 65).<br/></a>Use Resume Next to continue running the macro at the line following the error (see<a href="libremacros.html#93"> Listing 66 </a>a<a href="libremacros.html#94">nd Figure </a><br/>
<a href="libremacros.html#94">39)</a>.<br/>Use Resume to run the same statement again. If the problem is not fixed, the error will occur again. <br/>
This will cause an infinite loop.<br/>Use Resume LabelName to continue running at some specified location.<br/>
<i><b>Listing&#160;66.</b>&#160;Resume&#160;next&#160;error&#160;handler.</i><br/>
Sub&#160;ExampleResumeHandler<br/>&#160;&#160;Dim&#160;s$,&#160;z%<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;Handler1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Add a message, then resume to Spot1<br/>&#160;&#160;s&#160;=&#160;&#34;(0) 1/z = &#34;&#160;&amp;&#160;1/z&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160;'Divide by zero, so jump to Handler1<br/>Spot1:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Got here from Handler1<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;Handler2&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Handler2 uses resume<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;(1) 1/z = &#34;&amp;1/z&#160;&amp;&#160;CHR$(10)&#160; &#160;'Fail the first time, work the second<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;Handler3&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Handler3 resumes the next line<br/>&#160;&#160;z&#160;=&#160;0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Allow for division by zero again<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;(2) 1/z = &#34;&amp;1/z&#160;&amp;&#160;CHR$(10)&#160; &#160;'Fail and call Handler3<br/>&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Resume Handler&#34;<br/>&#160;Exit&#160;Sub&#160;&#160;<br/>Handler1:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Handler1 called from line &#34;&#160;&amp;&#160;Erl()&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Resume&#160;Spot1<br/>Handler2:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Handler2 called from line &#34;&#160;&amp;&#160;Erl()&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;z&#160;=&#160;1&#160; &#160;'Fix the error then do the line again<br/>&#160;&#160;Resume<br/>Handler3:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Handler3 called from line &#34;&#160;&amp;&#160;Erl()&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Resume&#160;Next<br/>End&#160;Sub<br/>
90<br/>
<hr/>
<a name=94></a><i><b>Figure&#160;39.</b>&#160;The&#160;last&#160;error&#160;handler&#160;declared is&#160;used.</i><br/>
<b>TIP</b><br/>
Errors that&#160;occur&#160;in an error&#160;handler&#160;are&#160;not&#160;handled;&#160;the&#160;macro&#160;just&#160;stops&#160;running.<br/>
<b>&#160;3.10.5.&#160;Error&#160;handlers</b>&#160;—&#160;<b>why&#160;use&#160;them?<br/></b>When&#160;I&#160;run a&#160;macro and it&#160;crashes, I&#160;usually&#160;understand&#160;the&#160;sometimes&#160;cryptic&#160;error messages&#160;and recognize&#160;<br/>how&#160;to&#160;deal&#160;with&#160;them.&#160;When others&#160;run my&#160;macros&#160;and an error occurs, I&#160;usually&#160;hear about&#160;it&#160;because&#160;they&#160;<br/>don’t&#160;know&#160;how&#160;to&#160;handle&#160;it.&#160;This&#160;is&#160;a&#160;good indicator&#160;that&#160;I&#160;have&#160;not&#160;used proper error handling.&#160;<br/>
You do not&#160;have&#160;to&#160;write&#160;an error handler for each routine. If&#160;the&#160;current&#160;routine&#160;doesn’t&#160;have&#160;an error&#160;<br/>handler,&#160;but&#160;the&#160;routine&#160;that&#160;called it&#160;does, the&#160;caller’s&#160;error handler is&#160;called.&#160;For&#160;example, imagine&#160;that&#160;<br/>sub1 has&#160;an error handler and it&#160;calls&#160;sub2 that&#160;does&#160;not.&#160;If&#160;an error occurs&#160;in&#160;sub2, the&#160;error handler in&#160;sub1&#160;<br/>is&#160;called.<br/>
When&#160;you&#160;use&#160;an error handler,&#160;you&#160;control&#160;how&#160;and when a&#160;user is&#160;notified of an error.&#160;Error handlers&#160;have&#160;<br/>uses&#160;other than&#160;controlling when a&#160;user is&#160;informed of an error.&#160;A&#160;properly&#160;used error handler can reduce&#160;the&#160;<br/>size&#160;of your macro. Consider,&#160;for example,&#160;the&#160;mathematical&#160;operations. It&#160;is&#160;cumbersome&#160;to&#160;check every&#160;<br/>mathematical&#160;operation&#160;before&#160;it&#160;is&#160;used.&#160;<br/>
If&#160;x&#160;&lt;&gt;&#160;0&#160;Then&#160;y&#160;=&#160;z&#160;/&#160;x<br/>If&#160;x&#160;&gt;&#160;0&#160;Then&#160;y&#160;=&#160;Log(x)<br/>If&#160;i%&#160;&lt;&#160;32767&#160;Then&#160;i%&#160;=&#160;i%&#160;+&#160;1<br/>
Even with my&#160;paranoid code&#160;checking the&#160;arguments,&#160;I&#160;might&#160;still&#160;have&#160;a&#160;numeric&#160;overflow.&#160;Even worse,&#160;<br/>nothing is&#160;done&#160;if an error occurs, and processing continues&#160;as&#160;normal. Sometimes&#160;you can’t&#160;check anything&#160;<br/>to avoid&#160;the&#160;error.&#160;For&#160;example, prior to OOo version&#160;2.0, the&#160;DimArray&#160;function returned an invalid empty&#160;<br/>array.&#160;The&#160;LBound and UBound functions&#160;generate&#160;exceptions&#160;with&#160;these&#160;invalid empty&#160;arrays. Error&#160;<br/>handling was&#160;used to&#160;safely&#160;generate&#160;the&#160;LBound and UBound even if&#160;an error occured. Consider the&#160;<br/>following&#160;cases:<br/>
•<br/>
The argument is not an array.<br/>
•<br/>
In an empty array, UBound &lt; LBound; ­1 and 0, for example.<br/>
•<br/>
There are no problems if the array is not an invalid empty array.<br/>
•<br/>
Should the optional dimension be considered?<br/>
The&#160;code&#160;in<a href="libremacros.html#95">&#160;Listing 67&#160;de</a>monstrates&#160;a&#160;simple&#160;error handler that&#160;is&#160;able&#160;to&#160;simply&#160;ignore&#160;errors.&#160;The&#160;function&#160;<br/>returns&#160;True&#160;if the&#160;lower bound is&#160;less&#160;than or equal&#160;to&#160;the&#160;upper bound&#160;—&#160;in other words, if the&#160;array&#160;<br/>contains&#160;data.&#160;If&#160;an error occurs, either because&#160;the&#160;argument&#160;is&#160;not&#160;an array&#160;or because&#160;this&#160;is&#160;an invalid&#160;<br/>empty&#160;array,&#160;the&#160;line&#160;does&#160;not&#160;finish running&#160;so the&#160;assignment&#160;never takes&#160;place. If&#160;the&#160;assignment&#160;never&#160;<br/>takes&#160;place, the&#160;original&#160;default&#160;Boolean value&#160;of False&#160;is&#160;used.&#160;This&#160;is&#160;the&#160;correct&#160;answer.&#160;Writing a&#160;safe&#160;<br/>
91<br/>
<hr/>
<a name=95></a>upper-bound or lower-bound routine&#160;is&#160;left&#160;as&#160;an exercise&#160;for the&#160;reader&#160;— the&#160;safe&#160;versions&#160;are&#160;not&#160;required&#160;<br/>with the&#160;fixed&#160;UBound and LBound functions&#160;released with&#160;OOo 2.0.<br/>
<i><b>Listing&#160;67.</b>&#160;Determine&#160;if&#160;an array&#160;has&#160;stuff.<br/></i>Sub&#160;ExampleArrayHasStuff<br/>&#160;&#160;Dim&#160;a(),&#160;b(3),&#160;v<br/>&#160;&#160;Print&#160;ArrayHasStuff(a())&#160; &#160; &#160; &#160;&#160;'False, because empty<br/>&#160;&#160;Print&#160;ArrayHasStuff(v)&#160; &#160; &#160; &#160; &#160;&#160;'False, not an array, so use error handler<br/>&#160;&#160;Print&#160;ArrayHasStuff(DimArray())&#160;'False, bad array, so error handler called<br/>&#160;&#160;Print&#160;ArrayHasStuff(DimArray(3))'True, &#160;this is not empty<br/>&#160;&#160;Print&#160;ArrayHasStuff(b())&#160; &#160; &#160; &#160;&#160;'True, &#160;this is not empty &#160;<br/>End&#160;Sub<br/>
Function&#160;ArrayHasStuff(v)&#160;As&#160;Boolean<br/>&#160;&#160;REM default value for a Boolean is False, so the default answer is False<br/>&#160;&#160;REM If an error occurs, then the statement never completes!<br/>&#160;&#160;REM This is a good time to use On Error Resume Next<br/>&#160;&#160;On&#160;Error&#160;Resume&#160;Next<br/>&#160;&#160;ArrayHasStuff&#160;=&#160;CBool(LBound(v)&#160;&lt;=&#160;UBound(v))<br/>End&#160;Function<br/>
An error handler can even be&#160;interactive.&#160;The&#160;code&#160;in<a href="libremacros.html#95">&#160;Listing 68&#160;a</a>ttempts&#160;to copy&#160;a&#160;file&#160;that&#160;doesn’t&#160;exist&#160;to&#160;a<br/>location that&#160;doesn’t&#160;exist.&#160;Needless&#160;to say,&#160;an error is&#160;generated.&#160;An error message&#160;is&#160;displayed and the&#160;user&#160;<br/>is&#160;asked if the&#160;copy&#160;should&#160;be&#160;tried again.&#160;The&#160;user is&#160;given an opportunity&#160;to&#160;correct&#160;any&#160;errors&#160;and&#160;<br/>continue.<br/>
<i><b>Listing&#160;68.</b>&#160;Copy&#160;a file.</i><br/>
Sub&#160;ExampleCopyAFile()<br/>&#160;&#160;CopyAFile(&#34;/I/do/not/exist.txt&#34;,&#160;&#34;/neither/do/I.txt&#34;)<br/>End&#160;Sub<br/>
Sub&#160;CopyAFile(Src$,&#160;Dest$)<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;BadCopy:&#160; &#160; &#160;'Set up the error handler<br/>TryAgain:&#160;&#160;<br/>&#160;&#160;FileCopy(Src$,&#160;Dest$)&#160; &#160; &#160;&#160;'Generate the error<br/>&#160;&#160;<br/>AllDone:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'If no error, then continue here<br/>&#160;&#160;Exit&#160;Sub&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Resume to the AllDone label from the handler<br/>&#160;&#160;<br/>BadCopy:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Display an error dialog<br/>&#160;&#160;Dim&#160;rc%&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Ask if should try again<br/>&#160;&#160;rc%&#160;=&#160;MsgBox(&#34;Failed to copy from &#34;&#160;&amp;&#160;Src$&#160;&amp;&#160;&#34; to &#34;&#160;&amp;&#160;Dest$&#160;&amp;&#160;&#34; because: &#34;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;CHR$(10)&#160;&amp;&#160;Error()&#160;&amp;&#160;&#34; at line &#34;&#160;&amp;&#160;Erl&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#34;Try again?&#34;,&#160;(4&#160;OR&#160;32),&#160;&#34;Error Copying&#34;)<br/>&#160;&#160;If&#160;rc%&#160;=&#160;6&#160;Then&#160; &#160;&#160;'Yes, try the command again<br/>&#160; &#160;&#160;Resume<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;rc%&#160;=&#160;7&#160;Then&#160; &#160;&#160;'No<br/>&#160; &#160;&#160;Resume&#160;AllDone&#160; &#160;'Go to the AllDone label<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
92<br/>
<hr/>
<a name=96></a><i><b>&#160;3.11.&#160;Conclusion<br/></b></i>Building any&#160;significant&#160;OOo macro requires&#160;understanding the&#160;syntax&#160;of OOo Basic.&#160;This&#160;chapter covered&#160;<br/>the&#160;key&#160;elements:<br/>
•<br/>
The syntax of a macro determines valid and invalid constructs. <br/>
•<br/>
The logic of a macro determines what the macro does. <br/>
•<br/>
Flow control directs the macro as it runs. <br/>
•<br/>
Error handling directs the macro when it does something unexpected.<br/>
A&#160;complete, well-constructed macro that&#160;accomplishes&#160;any&#160;significant&#160;function&#160;will&#160;most&#160;likely&#160;use&#160;all&#160;of&#160;<br/>these&#160;characteristics&#160;of OOo programming.&#160;The&#160;specific&#160;elements&#160;within OOo that&#160;one&#160;uses&#160;to&#160;build a&#160;<br/>specific&#160;program&#160;depend on the&#160;application,&#160;the&#160;desired logical&#160;behavior of the&#160;program, and the&#160;best&#160;<br/>judgment&#160;of the&#160;programmer.&#160;One&#160;major part&#160;of successful&#160;programming is&#160;developing the&#160;experience&#160;to&#160;<br/>apply&#160;the&#160;ideas&#160;of this&#160;chapter in&#160;the&#160;most&#160;effective&#160;way.<br/>
93<br/>
<hr/>
<a name=97></a><b>&#160;4.&#160;Numerical&#160;Routines<br/></b>This&#160;chapter introduces&#160;the&#160;subroutines&#160;and functions&#160;supported&#160;by&#160;OpenOffice.org&#160;Basic&#160;that&#160;are&#160;related to&#160;<br/>numbers&#160;— including mathematical&#160;functions, conversion&#160;routines, formatting numbers&#160;as&#160;a&#160;string, and&#160;<br/>random&#160;numbers.&#160;This&#160;chapter also&#160;discusses&#160;alternate&#160;number bases.<br/>
Numerical&#160;subroutines&#160;and functions&#160;are&#160;routines&#160;that&#160;perform&#160;mathematical&#160;operations. If&#160;you&#160;use&#160;<br/>spreadsheets,&#160;you&#160;may&#160;already&#160;be&#160;familiar with mathematical&#160;functions&#160;such as&#160;Sum, which adds&#160;groups&#160;of&#160;<br/>numbers&#160;together,&#160;or even IRR, which calculates&#160;the&#160;internal&#160;rate&#160;of return of an investment.&#160;The&#160;numerical&#160;<br/>routines&#160;supported by&#160;OOo Basic&#160;(see<a href="libremacros.html#97">&#160;Table&#160;24) a</a>re&#160;simpler in&#160;nature, typically&#160;operating&#160;on only&#160;one&#160;or two<br/>arguments&#160;rather than an entire&#160;group of numbers.<br/>
<i><b>Table&#160;24.</b>&#160;Subroutines&#160;and functions&#160;related to&#160;numbers&#160;and numerical&#160;operations.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
ABS(number)<br/>
The&#160;absolute&#160;value&#160;of&#160;a&#160;specified&#160;number.<br/>
ATN(number)<br/>
The&#160;angle,&#160;in&#160;radians, whose&#160;tangent&#160;is&#160;the&#160;specified&#160;number&#160;in&#160;the&#160;range&#160;of&#160;-Pi/2 through&#160;<br/>
Pi/2.<br/>
CByte(expression)<br/>
Round&#160;the&#160;String&#160;or&#160;numeric&#160;expression to a&#160;Byte.<br/>
CCur(expression)<br/>
Convert&#160;the&#160;expression to&#160;a&#160;Currency&#160;type.<br/>
CDbl(expression)<br/>
Convert&#160;a&#160;String&#160;or&#160;numeric&#160;expression&#160;to a&#160;Double.<br/>
CDec(expression)<br/>
Generate&#160;a&#160;Decimal&#160;type;&#160;implemented&#160;only&#160;on&#160;Windows.<br/>
CInt(expression)<br/>
Round&#160;the&#160;String&#160;or&#160;numeric&#160;expression to the&#160;nearest&#160;Integer.<br/>
CLng(expression)<br/>
Round&#160;the&#160;String&#160;or&#160;numeric&#160;expression to the&#160;nearest&#160;Long.<br/>
COS(number)<br/>
The&#160;cosine&#160;of&#160;the&#160;specified&#160;angle.<br/>
CSng(expression)<br/>
Convert&#160;a&#160;String&#160;or&#160;numeric&#160;expression&#160;to a&#160;Single.<br/>
Exp(number)<br/>
The&#160;base&#160;of&#160;natural&#160;logarithms&#160;raised to a&#160;power.<br/>
Fix(number)<br/>
Chop off&#160;the&#160;decimal&#160;portion.<br/>
Format(obj,&#160;format)<br/>
Fancy&#160;formatting,&#160;discussed in&#160;Chapter&#160;6,&#160;“String&#160;Routines.”<br/>
Hex(n)<br/>
Return the&#160;hexadecimal&#160;representation of&#160;a&#160;number&#160;as a&#160;String.<br/>
Int(number)<br/>
Round&#160;the&#160;number&#160;toward&#160;negative&#160;infinity.<br/>
Log(number)<br/>
The&#160;logarithm&#160;of&#160;a&#160;number.&#160;In&#160;Visual&#160;Basic&#160;.NET&#160;this method&#160;can be&#160;overloaded to return&#160;<br/>either&#160;the&#160;natural&#160;(base&#160;e)&#160;logarithm&#160;or&#160;the&#160;logarithm&#160;of&#160;a&#160;specified&#160;base.<br/>
Oct(number)<br/>
Return the&#160;octal&#160;representation of&#160;a&#160;number&#160;as a&#160;String.<br/>
Randomize(num)<br/>
Initialize&#160;the&#160;random&#160;number&#160;generator.&#160;If&#160;num&#160;is ommitted, uses the&#160;system&#160;timer.<br/>
Rnd<br/>
Return a&#160;random&#160;number&#160;as a&#160;Double&#160;from&#160;0&#160;through&#160;1.<br/>
Sgn(number)<br/>
Integer&#160;value&#160;indicating&#160;the&#160;sign of&#160;a&#160;number.<br/>
SIN(number)<br/>
The&#160;sine&#160;of&#160;an angle.<br/>
Sqr(number)<br/>
The&#160;square&#160;root&#160;of&#160;a&#160;number.<br/>
Str(number)<br/>
Convert&#160;a&#160;number&#160;to a&#160;String&#160;with&#160;no localization.<br/>
TAN(number)<br/>
The&#160;tangent&#160;of&#160;an angle.<br/>
Val(str)<br/>
Convert&#160;a&#160;String&#160;to a&#160;Double.&#160;This&#160;is very&#160;tolerant&#160;to non-numeric&#160;text.<br/>
94<br/>
<hr/>
<a name=98></a>The&#160;mathematical&#160;functions&#160;presented in&#160;this&#160;chapter are&#160;well-known and understood&#160;by&#160;mathematicians,&#160;<br/>engineers, and others&#160;who look&#160;for excuses&#160;to&#160;use&#160;calculus&#160;in everyday&#160;life.&#160;If&#160;that&#160;is&#160;not&#160;you&#160;—&#160;if, perhaps,&#160;<br/>you&#160;do&#160;<i>not</i>&#160;consider the&#160;slide&#160;rule&#160;to be&#160;the&#160;coolest&#160;thing since&#160;sliced&#160;bread&#160;—&#160;don’t&#160;panic&#160;when the&#160;coverage<br/>starts&#160;to&#160;become&#160;mathematical&#160;in&#160;nature. I&#160;have&#160;tried to&#160;make&#160;the&#160;information&#160;accessible&#160;while&#160;still&#160;providing<br/>the&#160;in-depth&#160;information for those&#160;who require&#160;it.&#160;The&#160;routines&#160;are&#160;topically&#160;grouped into&#160;sections&#160;so you&#160;can<br/>skip sections&#160;that&#160;you&#160;know&#160;that&#160;you won’t&#160;use.<br/>
The&#160;numerical&#160;routines&#160;perform&#160;operations&#160;on numerical&#160;data. OOo Basic&#160;tries&#160;to convert&#160;arguments&#160;to an&#160;<br/>appropriate&#160;type&#160;before&#160;performing an operation.&#160;It&#160;is&#160;safer to explicitly&#160;convert&#160;data&#160;types&#160;using&#160;conversion&#160;<br/>functions, as&#160;presented in&#160;this&#160;chapter,&#160;than to&#160;rely&#160;on the&#160;default&#160;behavior.&#160;When&#160;an Integer argument&#160;is&#160;<br/>required and a&#160;floating-point&#160;number is&#160;provided, the&#160;default&#160;behavior&#160;is&#160;to&#160;round the&#160;number.&#160;For example,&#160;<br/>“16.8 MOD&#160;7”&#160;rounds&#160;16.8 to&#160;17 before&#160;performing&#160;the&#160;operation.&#160;The&#160;Integer division operator,&#160;however,&#160;<br/>truncates&#160;the&#160;operands. For example,&#160;<br/>“Print&#160;4 \&#160;0.999”&#160;truncates&#160;0.999 to 0, causing a&#160;division-by-zero error.<br/>
<b>TIP</b><br/>
<a href="libremacros.html#97">Table&#160;24&#160;c</a>ontains&#160;subroutines and functions, not&#160;operators such as MOD, +,&#160;and \.&#160;<br/>
Operators were&#160;covered&#160;in Chapter<a href="libremacros.html#34">&#160;3,&#160;Language&#160;Constructs.</a><br/>
<i><b>&#160;4.1.&#160;Trigonometric&#160;functions<br/></b></i>Trigonometry&#160;is&#160;the&#160;study&#160;of the&#160;properties&#160;of triangles&#160;and trigonometric&#160;functions&#160;and of their&#160;applications.<br/>Discussions&#160;of trigonometric&#160;functions&#160;usually&#160;refer to right&#160;triangles, which have&#160;one&#160;angle&#160;of 90 degrees&#160;<br/>(see<a href="libremacros.html#99">&#160;Figure&#160;40)</a>.&#160;There&#160;is&#160;a&#160;set&#160;of defined relationships&#160;among the&#160;trigonometric&#160;functions, the&#160;lengths&#160;of the&#160;<br/>sides&#160;of a&#160;right&#160;triangle, and the&#160;corresponding angles&#160;in the&#160;triangle.&#160;When&#160;you&#160;know&#160;these&#160;relationships,&#160;<br/>you&#160;can use&#160;the&#160;trigonometric&#160;functions&#160;to solve&#160;trigonometric&#160;problems.<br/>
A&#160;practical&#160;problem&#160;that&#160;uses&#160;trigonometry&#160;is&#160;to estimate&#160;one’s&#160;distance&#160;from&#160;a&#160;pole&#160;or tower of known&#160;<br/>height.&#160;By&#160;measuring the&#160;observed angle&#160;from&#160;the&#160;ground to&#160;the&#160;top&#160;of the&#160;pole, and knowing the&#160;height&#160;of&#160;<br/>the&#160;pole,&#160;your distance&#160;from&#160;that&#160;pole&#160;is&#160;the&#160;height&#160;of the&#160;pole&#160;divided by&#160;the&#160;tangent&#160;of the&#160;measured angle.&#160;<br/>This&#160;principle&#160;can be&#160;applied&#160;to golf, sailing, or hiking, to&#160;estimate&#160;distance&#160;from&#160;a&#160;fixed point&#160;of interest&#160;<br/>(the&#160;golf flag, for example,&#160;or a&#160;radio&#160;transmission tower).<br/>
The&#160;principal&#160;trigonometric&#160;functions&#160;are&#160;sine, cosine, and tangent.&#160;Each is&#160;defined&#160;as&#160;the&#160;ratio between two&#160;<br/>sides&#160;of a&#160;right&#160;triangle.&#160;The&#160;values&#160;of these&#160;functions&#160;for any&#160;value&#160;of the&#160;angle, x,&#160;correspond to the&#160;ratios&#160;<br/>of the&#160;lengths&#160;of the&#160;sides&#160;of the&#160;right&#160;triangle&#160;containing that&#160;angle, x.&#160;For a&#160;given angle, the&#160;trigonometric&#160;<br/>functions&#160;fix&#160;the&#160;lengths&#160;of the&#160;sides&#160;of the&#160;right&#160;triangle. Likewise, knowing the&#160;lengths&#160;of any&#160;two sides&#160;of&#160;<br/>the&#160;right&#160;triangle&#160;allows&#160;one&#160;to compute&#160;the&#160;value&#160;of the&#160;angle&#160;using one&#160;of the&#160;inverse&#160;trigonometric&#160;<br/>functions.<br/>
OOo Basic&#160;uses&#160;radians&#160;as&#160;the&#160;unit&#160;of measure&#160;for angles;&#160;however,&#160;most&#160;non-scientists&#160;think&#160;in degrees.&#160;An&#160;<br/>angle&#160;that&#160;is&#160;90 degrees, such as&#160;the&#160;corner of a&#160;square, is&#160;Pi/2 radians.&#160;<br/>
<b>TIP</b><br/>
The&#160;built-in constant&#160;Pi&#160;is&#160;approximately&#160;3.1415926535897932385.&#160;Pi&#160;is&#160;a&#160;fundamental&#160;constant&#160;widely&#160;<br/>
used in&#160;scientific&#160;calculations,&#160;and&#160;is defined&#160;as the&#160;ratio of&#160;the&#160;circumference&#160;of&#160;a&#160;circle&#160;to&#160;its&#160;diameter.&#160;<br/>The&#160;sum&#160;of&#160;the&#160;angles in any&#160;triangle&#160;—&#160;including&#160;a&#160;right&#160;triangle&#160;— is 180 degrees,&#160;or&#160;Pi&#160;radians.&#160;A&#160;<br/>
tremendous amount&#160;of&#160;elegant&#160;and&#160;practical&#160;mathematical&#160;methods result&#160;from&#160;this connection between a&#160;<br/>triangle&#160;and&#160;a&#160;circle.&#160;All&#160;descriptions of&#160;periodic&#160;motion build&#160;on&#160;this&#160;foundation,&#160;making&#160;trigonometry&#160;a&#160;<br/>
fundamental&#160;and&#160;very&#160;useful&#160;set&#160;of&#160;mathematical&#160;tools.<br/>
Using&#160;the&#160;relationship between degrees&#160;and radians,&#160;it&#160;is&#160;easy&#160;to&#160;convert&#160;between radians&#160;and degree&#160;<br/>measurements&#160;of angles.<br/>
95<br/>
<hr/>
<a name=99></a>degrees&#160;=&#160;(radians&#160;*&#160;180)&#160;/&#160;Pi<br/>radians&#160;=&#160;(degrees&#160;*&#160;Pi)&#160;/&#160;180<br/>
To&#160;calculate&#160;the&#160;sine&#160;of a&#160;45-degree&#160;angle, you&#160;must&#160;first&#160;convert&#160;the&#160;angle&#160;from&#160;degrees&#160;to radians. Here’s&#160;<br/>the&#160;conversion:<br/>
radians = (45° * Pi) / 180 = Pi / 4 = 3.141592654 / 4 = 0.785398163398<br/>
You can use&#160;this&#160;value&#160;directly&#160;in&#160;the&#160;trigonometric&#160;function SIN.<br/>
Print&#160;SIN(0.785398163398)&#160; &#160;' .707106781188<br/>
To&#160;determine&#160;the&#160;angle&#160;whose&#160;tangent&#160;is&#160;0.577350269189, use&#160;the&#160;arctangent&#160;function.&#160;The&#160;returned value&#160;is&#160;<br/>in radians, so this&#160;value&#160;must&#160;be&#160;converted back to&#160;degrees.<br/>
Print&#160;ATN(0.577350269189)&#160;*&#160;180&#160;/&#160;Pi&#160;&#160;'29.9999999999731<br/>
<b>TIP</b><br/>
Rounding&#160;errors,&#160;as&#160;discussed later,&#160;affect&#160;these&#160;examples.&#160;With infinite&#160;precision,&#160;the&#160;previous example&#160;<br/>would result&#160;in an answer&#160;of&#160;30&#160;degrees rather&#160;than 29.9999999999731.<br/>
The&#160;answer is&#160;roughly&#160;30 degrees.&#160;The&#160;triangle&#160;in<a href="libremacros.html#99">&#160;Figure&#160;40&#160;i</a>s&#160;used to help&#160;explain&#160;the&#160;trigonometric&#160;<br/>functions.&#160;<br/>
<i><b>Figure&#160;40.</b>&#160;A&#160;right&#160;triangle&#160;has&#160;one&#160;angle&#160;at&#160;90 degrees.</i><br/>
<i><b>Table&#160;25.</b>&#160;Trigonometric&#160;functions&#160;supported by&#160;OOo Basic.</i><br/>
<i><b>OOo&#160;Basic</b></i><br/>
<i><b>VB</b></i><br/>
<i><b>VB&#160;.NET</b></i><br/>
<i><b>Return&#160;Value</b></i><br/>
ATN<br/>
ATN<br/>
Math.Atan<br/>
The&#160;angle,&#160;in&#160;radians, whose&#160;tangent&#160;is&#160;the&#160;specified&#160;<br/>number&#160;in the&#160;range&#160;of&#160;-Pi/2&#160;through Pi/2.<br/>
COS<br/>
COS<br/>
Math.Cos<br/>
The&#160;cosine&#160;of&#160;the&#160;specified&#160;angle.<br/>
SIN<br/>
SIN<br/>
Math.Sin<br/>
The&#160;sine&#160;of&#160;an angle.<br/>
TAN<br/>
TAN<br/>
Math.Tan<br/>
The&#160;tangent&#160;of&#160;an angle.<br/>
The&#160;trigonometric&#160;functions&#160;supported&#160;by&#160;OOo Basic&#160;are&#160;shown in<a href="libremacros.html#99">&#160;Table&#160;25&#160;a</a>nd illustrated&#160;using the&#160;right&#160;<br/>triangle&#160;i<a href="libremacros.html#99">n&#160;Figure&#160;40.&#160;</a>The&#160;single&#160;argument&#160;expression&#160;is&#160;converted to a&#160;double-precision number before&#160;the&#160;<br/>function is&#160;performed.<br/>
COS(x) = Adjacent Leg / Hypotenuse<br/>
96<br/>
<hr/>
<a name=100></a>SIN(x) = Opposite Leg / Hypotenuse<br/>TAN(x) = Opposite Leg / Adjacent Leg = SIN(x) / COS(x)<br/>ATN(Opposite Leg / Adjacent Leg) = x<br/>
The&#160;code&#160;in<a href="libremacros.html#100">&#160;Listing 69<b>&#160;</b></a>solves&#160;a&#160;series&#160;of geometry&#160;problems&#160;using the&#160;trigonometric&#160;functions.&#160;The&#160;code&#160;<br/>assumes&#160;a&#160;right&#160;triangle, as&#160;shown in<a href="libremacros.html#99">&#160;Figure&#160;40, w</a>ith an opposite&#160;leg of length&#160;3, and an adjacent&#160;leg of&#160;<br/>length&#160;4.&#160;The&#160;tangent&#160;is&#160;easily&#160;calculated as&#160;3/4 and the&#160;ATN&#160;function is&#160;used to&#160;determine&#160;the&#160;angle.&#160;A&#160;few&#160;<br/>other calculations&#160;are&#160;performed, such as&#160;determining the&#160;length of the&#160;hypotenuse&#160;using both the&#160;SIN&#160;and&#160;<br/>the&#160;COS&#160;functions.&#160;Also see<a href="libremacros.html#100">&#160;Figure&#160;41.</a><br/>
<i><b>Listing&#160;69.</b>&#160;ExampleTrigonometric<br/></i>Sub&#160;ExampleTrigonometric<br/>&#160;&#160;Dim&#160;OppositeLeg&#160;As&#160;Double<br/>&#160;&#160;Dim&#160;AdjacentLeg&#160;As&#160;Double<br/>&#160;&#160;Dim&#160;Hypotenuse&#160;As&#160;Double<br/>&#160;&#160;Dim&#160;AngleInRadians&#160;As&#160;Double<br/>&#160;&#160;Dim&#160;AngleInDegrees&#160;As&#160;Double<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;OppositeLeg&#160;=&#160;3<br/>&#160;&#160;AdjacentLeg&#160;=&#160;4<br/>&#160;&#160;AngleInRadians&#160;=&#160;ATN(3/4)<br/>&#160;&#160;AngleInDegrees&#160;=&#160;AngleInRadians&#160;*&#160;180&#160;/&#160;Pi<br/>&#160;&#160;s&#160;=&#160;&#34;Opposite Leg = &#34;&#160;&amp;&#160;OppositeLeg&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Adjacent Leg = &#34;&#160;&amp;&#160;AdjacentLeg&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Angle in degrees from ATN = &#34;&#160;&amp;&#160;AngleInDegrees&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Hypotenuse from COS = &#34;&#160;&amp;&#160;AdjacentLeg/COS(AngleInRadians)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Hypotenuse from SIN = &#34;&#160;&amp;&#160;OppositeLeg/SIN(AngleInRadians)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Opposite Leg from TAN = &#34;&#160;&amp;&#160;AdjacentLeg&#160;*&#160;TAN(AngleInRadians)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Trigonometric Functions&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;41.</b>&#160;Use&#160;the&#160;trigonometric&#160;functions&#160;to&#160;solve&#160;problems&#160;with&#160;triangles.</i><br/>
<i><b>&#160;4.2.&#160;Rounding&#160;errors&#160;and&#160;precision<br/></b></i>Numerical&#160;calculations&#160;performed on either a&#160;computer or calculator are&#160;performed with&#160;only&#160;a&#160;finite&#160;<br/>number of digits;&#160;this&#160;introduces&#160;rounding errors.&#160;This&#160;isn’t&#160;a&#160;problem&#160;with integer numbers.&#160;The&#160;number&#160;<br/>1/3 is&#160;represented&#160;in decimal&#160;form&#160;as&#160;0.33333333, but&#160;there&#160;needs&#160;to be&#160;an infinite&#160;number of threes&#160;<br/>following&#160;the&#160;decimal&#160;point.&#160;With four digits&#160;of precision,&#160;this&#160;is&#160;written&#160;as&#160;0.3333.&#160;This&#160;introduces&#160;<br/>inaccuracies&#160;in&#160;the&#160;representation and the&#160;resulting calculations.<br/>
1/3 + 1/3 + 1/3 = 3/3 = 1 &#160; &#160; &#160; &#160; &#160;'The exact answer is 1<br/>0.3333 + 0.3333 + 0.3333 = 0.9999 &#160;'The finite precision answer, off a bit<br/>
97<br/>
<hr/>
<a name=101></a>The&#160;simple&#160;macro in<a href="libremacros.html#101">&#160;Listing 70<b>&#160;</b></a>demonstrates&#160;this&#160;problem.&#160;The&#160;value&#160;0.2 is&#160;repeatedly&#160;added to&#160;the&#160;variable&#160;<br/><i>num</i>&#160;until&#160;the&#160;value&#160;is&#160;equal&#160;to&#160;5. If&#160;infinite&#160;precision&#160;were&#160;used, or if&#160;the&#160;number 0.2 were&#160;exactly&#160;<br/>represented&#160;inside&#160;the&#160;computer,&#160;the&#160;loop would stop&#160;with the&#160;variable&#160;<i>num</i>&#160;containing&#160;the&#160;value&#160;5.&#160;The&#160;<br/>variable&#160;never precisely&#160;equals&#160;the&#160;value&#160;5, however,&#160;so the&#160;loop&#160;never stops.&#160;The&#160;value&#160;5 is&#160;printed, but&#160;this&#160;<br/>is&#160;only&#160;because&#160;the&#160;Print&#160;statement&#160;rounds&#160;4.9999999 to the&#160;value&#160;5 when it&#160;prints&#160;the&#160;number.<br/>
<i><b>Listing&#160;70.</b>&#160;Rounding&#160;errors&#160;and finite&#160;precision&#160;prevent&#160;this&#160;from&#160;stopping.<br/></i>Dim&#160;num&#160;As&#160;Single<br/>Do<br/>&#160;&#160;num&#160;=&#160;num&#160;+&#160;0.2<br/>&#160;&#160;If&#160;num&#160;&gt;&#160;4.5&#160;Then&#160;Print&#160;num&#160;&#160;'prints 4.6, 4.8, 5, 5.199999...<br/>Loop&#160;Until&#160;num&#160;=&#160;5.0<br/>Print&#160;num<br/>
Computers&#160;use&#160;complex&#160;rounding algorithms&#160;in an attempt&#160;to&#160;reduce&#160;the&#160;impact&#160;of finite&#160;precision&#160;—&#160;finite&#160;<br/>precision&#160;means&#160;that&#160;a&#160;finite&#160;number of digits&#160;and storage&#160;are&#160;used to&#160;represent&#160;a&#160;number.&#160;Although this&#160;<br/>helps<a href="libremacros.html#101">,&#160;Listing 70&#160;c</a>learly&#160;demonstrates&#160;that&#160;the&#160;internal&#160;complex&#160;rounding algorithms&#160;do not&#160;solve&#160;the&#160;<br/>problem.&#160;When&#160;you&#160;compare&#160;two floating-point&#160;numbers&#160;to&#160;see&#160;if&#160;they&#160;are&#160;equal,&#160;it&#160;is&#160;safer to&#160;compare&#160;them&#160;<br/>to a&#160;range&#160;of values.&#160;The&#160;code&#160;in<a href="libremacros.html#101">&#160;Listing 71<b>&#160;</b></a>stops&#160;when the&#160;variable&#160;is&#160;greater than&#160;or equal&#160;to&#160;5.<br/>
<i><b>Listing&#160;71.</b>&#160;Avoid&#160;rounding errors&#160;by&#160;using&#160;&gt;= (greater&#160;than&#160;or&#160;equal&#160;to).</i><br/>
Dim&#160;num&#160;As&#160;Single<br/>Do<br/>&#160;&#160;num&#160;=&#160;num&#160;+&#160;0.2<br/>Loop&#160;Until&#160;num&#160;&gt;=&#160;5.0<br/>Print&#160;num&#160;&#160;'5.199999<br/>
The&#160;code&#160;in<a href="libremacros.html#101">&#160;Listing 71&#160;w</a>orks&#160;to some&#160;extent, but&#160;you&#160;probably&#160;want&#160;the&#160;loop&#160;to exit&#160;when the&#160;variable&#160;<i>num</i>&#160;<br/>is&#160;4.9999999 rather than when it&#160;is&#160;5.199999.&#160;You can do this&#160;by&#160;checking to&#160;see&#160;if two numbers&#160;are&#160;close&#160;<br/>rather than&#160;equal.&#160;The&#160;big question&#160;is, How&#160;close&#160;must&#160;two numbers&#160;be&#160;before&#160;they&#160;are&#160;considered equal?&#160;<br/>You can usually&#160;make&#160;a&#160;simple&#160;guess&#160;based on what&#160;you&#160;know&#160;about&#160;the&#160;problem.&#160;Single-precision&#160;variables<br/>can represent&#160;about&#160;eight&#160;digits&#160;of precision.&#160;Double-precision variables&#160;can represent&#160;about&#160;16 digits&#160;of&#160;<br/>precision.&#160;Don’t&#160;try&#160;to demand&#160;more&#160;precision&#160;from&#160;the&#160;variables&#160;than they&#160;support.&#160;The&#160;code&#160;in<a href="libremacros.html#101">&#160;Listing 71&#160;<br/></a>uses&#160;single-precision&#160;variables&#160;so you can expect&#160;roughly&#160;seven digits&#160;of precision.&#160;The&#160;code&#160;i<a href="libremacros.html#101">n&#160;Listing&#160;72&#160;<br/></a>prints&#160;the&#160;difference&#160;between 5 and&#160;<i>num&#160;—&#160;</i>notice&#160;that&#160;about&#160;six&#160;digits&#160;are&#160;correct.<br/>
<i><b>Listing&#160;72.</b>&#160;Compare&#160;the&#160;variable&#160;to&#160;a range.</i><br/>
Dim&#160;num&#160;As&#160;Single<br/>Do<br/>&#160;&#160;num&#160;=&#160;num&#160;+&#160;0.2<br/>Loop&#160;Until&#160;4.99999&#160;&lt;&#160;num&#160;AND&#160;num&#160;&lt;&#160;5.00001<br/>Print&#160;5&#160;-&#160;num&#160;&#160;'4.76837158203125E-07 &#160;= 0.000000476837158203125<br/>
The&#160;ABS&#160;function&#160;returns&#160;the&#160;absolute&#160;value&#160;of a&#160;number.&#160;You can use&#160;it&#160;to simplify&#160;the&#160;process&#160;of checking&#160;<br/>to see&#160;how&#160;close&#160;one&#160;number is&#160;to&#160;another.<br/>
If&#160;ABS(num&#160;-&#160;5)&#160;&lt;&#160;0.00001&#160;Then<br/>
Using&#160;ABS&#160;and subtraction&#160;indicates&#160;how&#160;close&#160;two numbers&#160;are&#160;to&#160;each other,&#160;but&#160;it&#160;may&#160;not&#160;be&#160;sufficient.&#160;<br/>For&#160;example, light&#160;travels&#160;at&#160;about&#160;299,792,458 meters&#160;each second.&#160;This&#160;number contains&#160;nine&#160;digits.&#160;A&#160;<br/>single-precision number is&#160; accurate&#160;to about&#160;seven digits.&#160;See<a href="libremacros.html#101">&#160;Listing&#160;73.&#160;</a><br/>
<i><b>Listing&#160;73.</b>&#160;Single-precision&#160;variables&#160;have&#160;only&#160;seven or&#160;eight&#160;digits&#160;of&#160;accuracy.</i><br/>
Dim&#160;c1&#160;As&#160;Single&#160;&#160;'Scientists usually use the letter c to represent<br/>Dim&#160;c2&#160;As&#160;Single&#160;&#160;'the speed of light.<br/>
98<br/>
<hr/>
<a name=102></a>c1&#160;=&#160;299792458&#160; &#160;&#160;'Speed of light in meters per second to nine digits<br/>c2&#160;=&#160;c1&#160;+&#160;16&#160; &#160; &#160;&#160;'Add 16 to the speed of light<br/>If&#160;c1&#160;=&#160;c2&#160;Then&#160; &#160;'These are equal because only the first seven<br/>&#160;&#160;Print&#160;&#34;Equal&#34;&#160; &#160;'or eight digits are significant<br/>End&#160;If<br/>
The&#160;code&#160;in<a href="libremacros.html#101">&#160;Listing 73&#160;a</a>dds&#160;16 to&#160;the&#160;speed of light,&#160;but&#160;this&#160;does&#160;not&#160;change&#160;the&#160;value.&#160;This&#160;is&#160;because&#160;only&#160;<br/>the&#160;first&#160;seven or eight&#160;digits&#160;are&#160;significant.&#160;The&#160;code&#160;in<a href="libremacros.html#102">&#160;Listing 74&#160;us</a>es&#160;a&#160;number that&#160;is&#160;smaller in&#160;<br/>magnitude&#160;but&#160;uses&#160;the&#160;same&#160;number of digits.&#160;Adding 1 to&#160;the&#160;number would&#160;change&#160;a&#160;significant&#160;digit,&#160;but&#160;<br/>adding a&#160;smaller number still&#160;leaves&#160;the&#160;numbers&#160;equal.&#160;<br/>
<i><b>Listing&#160;74.</b>&#160;Single-precision&#160;variables&#160;have&#160;only&#160;seven or&#160;eight&#160;digits&#160;of&#160;accuracy.<br/></i>Dim&#160;c1&#160;As&#160;Single&#160; &#160;'Scientists usually use the letter c to represent<br/>Dim&#160;c2&#160;As&#160;Single&#160; &#160;'the speed of light.<br/>c1&#160;=&#160;299.792458&#160; &#160;&#160;'This is nine digits but it is not the speed of light<br/>c2&#160;=&#160;c1&#160;+&#160;.0000016&#160;'Must add a smaller number for them to still be equal<br/>If&#160;c1&#160;=&#160;c2&#160;Then&#160; &#160;&#160;'These are equal because only the first seven<br/>&#160;&#160;Print&#160;&#34;Equal&#34;&#160; &#160;&#160;'or eight digits are significant<br/>End&#160;If<br/>
Floating-point&#160;numbers&#160;can have&#160;different&#160;magnitudes&#160;—&#160;magnitude&#160;refers&#160;to the&#160;size&#160;of the&#160;number&#160;—&#160;and&#160;<br/>it&#160;doesn’t&#160;significantly&#160;affect&#160;the&#160;number of digits&#160;that&#160;are&#160;relevant.&#160;To&#160;check if two numbers&#160;are&#160;about&#160;the&#160;<br/>same&#160;value, large&#160;numbers&#160;can differ by&#160;a&#160;greater amount&#160;than small&#160;numbers.&#160;The&#160;greatest&#160;allowed&#160;<br/>difference&#160;is&#160;dependent&#160;upon the&#160;magnitude&#160;(size) of the&#160;numbers;&#160;a&#160;mathematician calls&#160;this&#160;the&#160;“relative&#160;<br/>error.”&#160;See<a href="libremacros.html#102">&#160;Listing 75.</a><br/>
<i><b>Listing&#160;75.</b>&#160;Compare&#160;two numbers.<br/></i>REM This uses n1 as the primary number of interest<br/>REM n2 is compared to n1 in a relative way<br/>REM rel_diff is the desired relative difference<br/>REM rel_diff is assumed non-negative<br/>Function&#160;AreSameNumber(n1,&#160;n2,&#160;rel_diff)&#160;As&#160;Boolean<br/>&#160;&#160;AreSameNumber&#160;=&#160;False&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Assume that they are different<br/>&#160;&#160;If&#160;n1&#160;&lt;&gt;&#160;0&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Cannot divide by n1 if it is zero<br/>&#160; &#160;&#160;If&#160;ABS((n1-n2)/n1)&#160;&lt;=&#160;rel_diff&#160;Then&#160;'Divide difference by n1 for relative<br/>&#160; &#160; &#160;&#160;AreSameNumber&#160;=&#160;True&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'comparison.<br/>&#160; &#160;&#160;End&#160;If&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'If n1, the number of interest, is<br/>&#160;&#160;ElseIf&#160;ABS(n2)&#160;&lt;=&#160;rel_diff&#160;Then&#160; &#160; &#160; &#160;'zero, then compare n2 for size.<br/>&#160; &#160;&#160;AreSameNumber&#160;=&#160;True<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
The&#160;code&#160;in<a href="libremacros.html#102">&#160;Listing 75&#160;di</a>vides&#160;the&#160;difference&#160;of two numbers&#160;by&#160;one&#160;of the&#160;numbers.&#160;The&#160;code&#160;i<a href="libremacros.html#102">n&#160;Listing&#160;76&#160;<br/></a>checks&#160;numbers&#160;of different&#160;sizes&#160;to see&#160;if they&#160;are&#160;the&#160;same&#160;number.<br/>
<i><b>Listing&#160;76.</b>&#160;Test&#160;if&#160;same&#160;number.</i><br/>
Sub&#160;CheckSameNumber<br/>&#160;&#160;Dim&#160;s1&#160;As&#160;Single<br/>&#160;&#160;Dim&#160;s2&#160;As&#160;Single<br/>&#160;&#160;Print&#160;AreSameNumber(299792458,&#160;299790000,&#160;1e-5)&#160;&#160;'True: five digits same<br/>&#160;&#160;Print&#160;AreSameNumber(299792458,&#160;299700000,&#160;1e-5)&#160;&#160;'False: four digits same<br/>&#160;&#160;s1&#160;=&#160;299792458&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'s1 assigned different value<br/>&#160;&#160;s2&#160;=&#160;299792448&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'than s2 but same number.<br/>&#160;&#160;Print&#160;AreSameNumber(s1,&#160;s2,&#160;0.0)&#160; &#160; &#160;'True: Same number in single precision.<br/>&#160;&#160;Print&#160;AreSameNumber(299.792458,&#160;299.790000,&#160;1e-5)'True: five digits same<br/>
99<br/>
<hr/>
<a name=103></a>&#160;&#160;Print&#160;AreSameNumber(2.99792458,&#160;2.99700000,&#160;1e-5)'False: four digits same<br/>End&#160;Sub<br/>
A&#160;large&#160;quantity&#160;of literature&#160;and research is&#160;available&#160;on the&#160;negative&#160;issues&#160;associated&#160;with floating-point&#160;<br/>numbers.&#160;A&#160;complete&#160;discussion is&#160;therefore&#160;well&#160;beyond the&#160;scope&#160;of this&#160;book. In&#160;general&#160;usage, the&#160;<br/>problems&#160;typically&#160;aren’t&#160;that&#160;troublesome,&#160;but, when they&#160;arise, they&#160;can be&#160;most&#160;perplexing if you&#160;aren’t&#160;<br/>aware&#160;of the&#160;issues.<br/>
<i><b>&#160;4.3.&#160;Mathematical&#160;functions<br/></b></i>The&#160;mathematical&#160;functions&#160;in OOo Basic&#160;take&#160;a&#160;numeric&#160;argument.&#160;All&#160;of the&#160;standard types&#160;are&#160;converted&#160;<br/>to a&#160;Double&#160;before&#160;they&#160;are&#160;used. Strings&#160;may&#160;include&#160;hexadecimal&#160;and octal&#160;numbers.&#160;The&#160;functions&#160;are&#160;the&#160;<br/>same&#160;as&#160;those&#160;available&#160;in&#160;Visual&#160;Basic&#160;(see<a href="libremacros.html#103">&#160;Table&#160;26)</a>.<br/>
<i><b>Table&#160;26.</b>&#160;Mathematical&#160;functions&#160;supported&#160;by&#160;OOo Basic.</i><br/>
<i><b>OOo&#160;Basic</b></i><br/>
<i><b>VB</b></i><br/>
<i><b>VB&#160;.NET</b></i><br/>
<i><b>Return&#160;Value</b></i><br/>
ABS<br/>
ABS<br/>
Math.Abs<br/>
The&#160;absolute&#160;value&#160;of&#160;a&#160;specified&#160;number.<br/>
Exp<br/>
Exp<br/>
Math.Exp<br/>
The&#160;base&#160;of&#160;natural&#160;logarithms&#160;raised to a&#160;power.<br/>
Log<br/>
Log<br/>
Math.Log<br/>
The&#160;logarithm&#160;of&#160;a&#160;number.&#160;In&#160;VB&#160;.NET&#160;you can&#160;overload this&#160;method&#160;<br/>
to return either&#160;the&#160;natural&#160;(base&#160;e)&#160;logarithm&#160;or&#160;that&#160;of&#160;a&#160;specified&#160;base.<br/>
Sgn<br/>
Sgn<br/>
Math.Sign<br/>
Integer&#160;value&#160;indicating&#160;the&#160;sign of&#160;a&#160;number.<br/>
Sqr<br/>
Sqr<br/>
Math.Sqrt<br/>
The&#160;square&#160;root&#160;of&#160;a&#160;number.<br/>
Use&#160;the&#160;ABS&#160;function to&#160;determine&#160;the&#160;absolute&#160;value&#160;of a&#160;number,&#160;which you can think&#160;of as&#160;simply&#160;<br/>throwing away&#160;the&#160;leading +&#160;or - sign from&#160;the&#160;front&#160;of the&#160;number.&#160;The&#160;geometrical&#160;definition&#160;of&#160;ABS(x)&#160;is&#160;<br/>the&#160;distance&#160;from&#160;x&#160;to 0 along&#160;a&#160;straight&#160;line.<br/>
ABS(23.33)&#160;=&#160;23.33<br/>ABS(-3)&#160; &#160;&#160;=&#160;3<br/>ABS(&#34;-1&#34;)&#160;&#160;=&#160;1&#160;&#160;'Notice that the string value &#34;-1&#34; is converted to a Double<br/>
Use&#160;the&#160;Sgn function&#160;to determine&#160;the&#160;sign of a&#160;number.&#160;An integer with&#160;the&#160;value&#160;-1, 0, or 1 is&#160;returned if&#160;<br/>the&#160;number is&#160;negative, zero, or&#160;positive.<br/>
Sgn(-37.4)&#160;=&#160;-1<br/>Sgn(0)&#160; &#160; &#160;=&#160;&#160;0<br/>Sgn(&#34;4&#34;)&#160; &#160;=&#160;&#160;1<br/>
The&#160;square&#160;root&#160;of 9 is&#160;3, because&#160;3 multiplied by&#160;3 is&#160;9. Use&#160;the&#160;Sqr function&#160;to&#160;get&#160;the&#160;square&#160;root&#160;of a&#160;<br/>number.&#160;The&#160;Sqr function&#160;can’t&#160;calculate&#160;the&#160;square&#160;root&#160;of a&#160;negative&#160;number&#160;—&#160;attempting to do so causes&#160;<br/>a&#160;run-time&#160;error.<br/>
Sqr(100)&#160;=&#160;10<br/>Sqr(16)&#160;&#160;=&#160;4<br/>Sqr(2)&#160; &#160;=&#160;1.414213562371<br/>
Logarithms&#160;were&#160;devised by&#160;John Napier,&#160;who lived from&#160;1550 through 1617. Napier devised logarithms&#160;to&#160;<br/>simplify&#160;arithmetic&#160;calculations, by&#160;substituting addition&#160;and subtraction for multiplication&#160;and division.&#160;<br/>Logarithms&#160;have&#160;the&#160;following properties:<br/>
Log(x*y)&#160;=&#160;Log(x)&#160;+&#160;Log(y)<br/>Log(x/y)&#160;=&#160;Log(x)&#160;-&#160;Log(y)<br/>Log(x^y)&#160;=&#160;y&#160;*&#160;Log(x)<br/>
100<br/>
<hr/>
<a name=104></a>The&#160;Exp function&#160;is&#160;the&#160;inverse&#160;of the&#160;Log&#160;function. For example,&#160;Exp(Log(4)) =&#160;4 and Log(Exp(2)) =&#160;2. By&#160;<br/>design, logarithms&#160;turn multiplication&#160;problems&#160;into addition&#160;problems.&#160;This&#160;allows&#160;the&#160;use&#160;of logarithms&#160;as&#160;<br/>they&#160;were&#160;originally&#160;designed.<br/>
&#160;&#160;Print&#160;Exp(Log(12)&#160;+&#160;Log(3))&#160;'36 = 12 * 3<br/>&#160;&#160;Print&#160;Exp(Log(12)&#160;-&#160;Log(3))&#160;' 4 = 12 / 3<br/>
Logarithms&#160;are&#160;defined by&#160;the&#160;equation&#160;y=b^x. It&#160;is&#160;then&#160;said&#160;that&#160;the&#160;logarithm,&#160;base&#160;b, of y&#160;is&#160;x.&#160;For&#160;<br/>example,&#160;the&#160;logarithm&#160;base&#160;10, 10^2 =&#160;100 so the&#160;logarithm, base&#160;10, of 100 is&#160;2.&#160;The&#160;natural&#160;logarithm,&#160;<br/>with a&#160;base&#160;approximated&#160;by&#160;e=2.71828182845904523536, is&#160;frequently&#160;used because&#160;it&#160;has&#160;some&#160;nice&#160;<br/>mathematical&#160;properties.&#160;This&#160;is&#160;called the&#160;“natural&#160;logarithm”&#160;and is&#160;used in&#160;OOo Basic.&#160;Visual&#160;Basic&#160;.NET&#160;<br/>allows&#160;you&#160;to&#160;calculate&#160;logarithms&#160;of other bases.&#160;This&#160;is&#160;easily&#160;done&#160;using the&#160;formula&#160;that&#160;the&#160;logarithm&#160;<br/>base&#160;b is&#160;given by&#160;Log(x)/Log(b), regardless&#160;of the&#160;base&#160;of the&#160;logarithm&#160;that&#160;is&#160;used.<br/>
Logarithms&#160;are&#160;not&#160;as&#160;useful&#160;as&#160;a&#160;general&#160;shortcut&#160;for calculations&#160;today,&#160;when lots&#160;of computing power is&#160;<br/>available.&#160;However,&#160;the&#160;logarithmic&#160;relationship&#160;describes&#160;the&#160;behavior of many&#160;natural&#160;phenomena. For&#160;<br/>example,&#160;the&#160;growth of populations&#160;is&#160;often&#160;described using&#160;logarithms,&#160;because&#160;geometric&#160;growth&#160;<br/>expressed on a&#160;logarithmic&#160;graph displays&#160;as&#160;a&#160;straight&#160;line.&#160;Exponentials&#160;and logarithms&#160;are&#160;also used&#160;<br/>extensively&#160;in&#160;engineering computations&#160;that&#160;describe&#160;the&#160;dynamic&#160;behavior of electrical,&#160;mechanical,&#160;and&#160;<br/>chemical&#160;systems.<br/>
The&#160;macro i<a href="libremacros.html#104">n&#160;Listing&#160;77&#160;c</a>alculates&#160;the&#160;logarithm&#160;of the&#160;number x&#160;(first&#160;argument) to&#160;the&#160;specified base&#160;b&#160;<br/>(second argument). For example,&#160;use&#160;LogBase(8, 2) to calculate&#160;the&#160;log, base&#160;2, of 8 (the&#160;answer is&#160;3).<br/>
<i><b>Listing&#160;77.</b>&#160;LogBase.</i><br/>
Function&#160;LogBase(x,&#160;b)&#160;As&#160;Double<br/>&#160;&#160;LogBase&#160;=&#160;Log(x)&#160;/&#160;Log(b)<br/>End&#160;Function<br/>
<i><b>&#160;4.4.&#160;Numeric&#160;conversions<br/></b></i>OOo Basic&#160;tries&#160;to&#160;convert&#160;arguments&#160;to&#160;an appropriate&#160;type&#160;before&#160;performing an operation.&#160;However,&#160;it&#160;is&#160;<br/>safer to&#160;explicitly&#160;convert&#160;data&#160;types&#160;using conversion&#160;functions, as&#160;presented in&#160;this&#160;chapter,&#160;than&#160;to rely&#160;on&#160;<br/>the&#160;default&#160;behavior,&#160;which may&#160;not&#160;be&#160;what&#160;you want.&#160;When an Integer argument&#160;is&#160;required and a&#160;floating-<br/>point&#160;number is&#160;provided, the&#160;default&#160;behavior is&#160;to&#160;round the&#160;number.&#160;For&#160;example, 16.8 MOD&#160;7 rounds&#160;<br/>16.8 to 17 before&#160;performing the&#160;operation.&#160;The&#160;Integer division&#160;operator,&#160;however,&#160;truncates&#160;the&#160;operands.&#160;<br/>For&#160;example, “Print&#160;4 \&#160;0.999”&#160;truncates&#160;0.999 to&#160;0, causing&#160;a&#160;division-by-zero error.<br/>
There&#160;are&#160;many&#160;different&#160;methods&#160;and functions&#160;to&#160;convert&#160;to numeric&#160;types.&#160;The&#160;primary&#160;conversion&#160;<br/>functions&#160;convert&#160;numbers&#160;represented&#160;as&#160;strings&#160;based on the&#160;computer’s&#160;locale.&#160;The&#160;conversion functions&#160;<br/>i<a href="libremacros.html#104">n&#160;Table&#160;27&#160;c</a>onvert&#160;any&#160;string or numeric&#160;expression to&#160;a&#160;number.&#160;String expressions&#160;containing&#160;<br/>hexadecimal&#160;or octal&#160;numbers&#160;must&#160;represent&#160;them&#160;using the&#160;standard OOo Basic&#160;notation.&#160;For&#160;example, the<br/>hexadecimal&#160;number 2A&#160;must&#160;be&#160;represented&#160;as&#160;“&amp;H2A”.<br/>
<i><b>Table&#160;27.</b>&#160;Convert&#160;to a numerical&#160;type.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Type</b></i><br/>
<i><b>Description</b></i><br/>
CByte(expression)<br/>
Byte<br/>
Round&#160;the&#160;String&#160;or&#160;numeric&#160;expression to a&#160;Byte.<br/>
CCur(expression)<br/>
Currency<br/>
Convert&#160;the&#160;String&#160;or&#160;numeric&#160;expression to&#160;a&#160;Currency.&#160;The&#160;locale&#160;settings are&#160;<br/>used&#160;for&#160;decimal&#160;separators and&#160;currency&#160;symbols.<br/>
CDec(expression)<br/>
Decimal<br/>
Generate&#160;a&#160;Decimal&#160;type;&#160;implemented&#160;only&#160;on&#160;Windows.<br/>
CInt(expression)<br/>
Integer<br/>
Round&#160;the&#160;String&#160;or&#160;numeric&#160;expression to the&#160;nearest&#160;Integer.<br/>
CLng(expression)<br/>
Long<br/>
Round&#160;the&#160;String&#160;or&#160;numeric&#160;expression to the&#160;nearest&#160;Long.<br/>
101<br/>
<hr/>
<a name=105></a><i><b>Function</b></i><br/>
<i><b>Type</b></i><br/>
<i><b>Description</b></i><br/>
CDbl(expression)<br/>
Double<br/>
Convert&#160;a&#160;String&#160;or&#160;numeric&#160;expression&#160;to a&#160;Double.<br/>
CSng(expression)<br/>
Single<br/>
Convert&#160;a&#160;String&#160;or&#160;numeric&#160;expression&#160;to a&#160;Single.<br/>
The&#160;functions&#160;that&#160;return a&#160;whole&#160;number all&#160;have&#160;similar&#160;behavior.&#160;Numeric&#160;expressions&#160;are&#160;rounded rather&#160;<br/>than truncated.&#160;A&#160;string expression that&#160;does&#160;not&#160;contain a&#160;number evaluates&#160;to&#160;zero. Only&#160;the&#160;portion&#160;of the&#160;<br/>string that&#160;contains&#160;a&#160;number is&#160;evaluated, as&#160;shown in<a href="libremacros.html#105">&#160;Listing 78.</a><br/>
<i><b>Listing&#160;78.</b>&#160;CInt&#160;and CLng&#160;ignore&#160;non-numeric&#160;values.</i><br/>
Print&#160;CInt(12.2)&#160; &#160; &#160;&#160;' 12<br/>Print&#160;CLng(&#34;12.5&#34;)&#160; &#160;&#160;' 13<br/>Print&#160;CInt(&#34;xxyy&#34;)&#160; &#160;&#160;' &#160;0<br/>Print&#160;CLng(&#34;12.1xx&#34;)&#160;&#160;' 12<br/>Print&#160;CInt(-12.2)&#160; &#160; &#160;'-12<br/>Print&#160;CInt(&#34;-12.5&#34;)&#160; &#160;'-13<br/>Print&#160;CLng(&#34;-12.5xx&#34;)&#160;'-13<br/>
CLng and CInt&#160;have&#160;similar,&#160;but&#160;not&#160;identical, behavior for different&#160;types&#160;of overflow&#160;conditions. Decimal&#160;<br/>numbers&#160;in strings&#160;that&#160;are&#160;too large&#160;cause&#160;a&#160;run-time&#160;error.&#160;For&#160;example, CInt(&#34;40000&#34;)&#160;and&#160;<br/>CLng(&#34;999999999999&#34;) cause&#160;a&#160;run-time&#160;error,&#160;but&#160;CLng(&#34;40000&#34;)&#160;does&#160;not.&#160;CLng never causes&#160;an&#160;<br/>overflow&#160;if a&#160;hexadecimal&#160;or octal&#160;number is&#160;too large;&#160;it&#160;silently&#160;returns&#160;zero without&#160;complaint.&#160;CInt,&#160;<br/>however,&#160;interprets&#160;hexadecimal&#160;and octal&#160;numbers&#160;as&#160;a&#160;Long&#160;and then&#160;converts&#160;them&#160;to&#160;an Integer.&#160;The&#160;<br/>result&#160;is&#160;that&#160;a&#160;valid Long&#160;generates&#160;a&#160;run-time&#160;error when it&#160;is&#160;converted&#160;to an Integer.&#160;A&#160;hexadecimal&#160;value&#160;<br/>that&#160;is&#160;too&#160;large&#160;to&#160;be&#160;valid returns&#160;zero with&#160;no complaints&#160;and then&#160;is&#160;cast&#160;to&#160;an Integer (see<a href="libremacros.html#105">&#160;Listing&#160;79).</a><br/>
<i><b>Listing&#160;79.</b>&#160;CInt&#160;interprets&#160;the&#160;number&#160;as&#160;a Long, then converts&#160;to an Integer.</i><br/>
Print&#160;CLng(&#34;&amp;HFFFFFFFFFFE&#34;)&#160;&#160;'0 &#160;Overflow on a Long<br/>Print&#160;CInt(&#34;&amp;HFFFFFFFFFFE&#34;)&#160;&#160;'0 &#160;Overflow on a Long then convert to Integer<br/>Print&#160;CLng(&#34;&amp;HFFFFE&#34;)&#160; &#160; &#160; &#160;&#160;'1048574<br/>Print&#160;CInt(&#34;&amp;HFFFFE&#34;)&#160; &#160; &#160; &#160;&#160;'Run-time error, convert to Long then overflow<br/>
The&#160;code&#160;in<a href="libremacros.html#105">&#160;Listing 80&#160;c</a>onverts&#160;numerous&#160;hexadecimal&#160;numbers&#160;to&#160;a&#160;Long&#160;using CLng. See<a href="libremacros.html#106">&#160;Table&#160;28&#160;f</a>or an&#160;<br/>explanation of the&#160;output&#160;in<a href="libremacros.html#105">&#160;Listing 80.</a><br/>
<i><b>Listing&#160;80.</b>&#160;ExampleCLngWithHex.<br/></i>Sub&#160;ExampleCLngWithHex<br/>&#160;&#160;On&#160;Error&#160;Resume&#160;Next<br/>&#160;&#160;Dim&#160;s$,&#160;i%<br/>&#160;&#160;Dim&#160;v()<br/>&#160;&#160;v()&#160;=&#160;Array(&#34;&amp;HF&#34;,&#160; &#160; &#160;&#34;&amp;HFF&#34;,&#160; &#160; &#160;&#34;&amp;HFFF&#34;,&#160; &#160; &#160;&#34;&amp;HFFFF&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;HFFFFF&#34;,&#160;&#34;&amp;HFFFFFF&#34;,&#160;&#34;&amp;HFFFFFFF&#34;,&#160;&#34;&amp;HFFFFFFFF&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;HFFFFFFFFF&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;HE&#34;,&#160; &#160; &#160;&#160;&#34;&amp;HFE&#34;,&#160; &#160; &#160;&#34;&amp;HFFE&#34;,&#160; &#160; &#160;&#34;&amp;HFFFE&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;HFFFFE&#34;,&#160;&#160;&#34;&amp;HFFFFFE&#34;,&#160;&#34;&amp;HFFFFFFE&#34;,&#160;&#34;&amp;HFFFFFFFE&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;HFFFFFFFFE&#34;)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(v())&#160;To&#160;UBound(v())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;i&#160;&amp;&#160;&#34; CLng(&#34;&#160;&amp;&#160;v(i)&#160;&amp;&#160;&#34;) = &#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CLng(v(i))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
102<br/>
<hr/>
<a name=106></a><i><b>Table&#160;28.</b>&#160;Output&#160;from<a href="libremacros.html#105">&#160;Listing&#160;80&#160;wi</a></i><i>th explanatory&#160;text.</i><br/>
<i><b>Input</b></i><br/>
<i><b>CLng</b></i><br/>
<i><b>Explanation</b></i><br/>
F<br/>
15<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FF<br/>
255<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFF<br/>
4095<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFFF<br/>
65535<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFFFF<br/>
1048575<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFFFFF<br/>
16777215<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFFFFFF<br/>
268435455<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFFFFFFF<br/>
??<br/>
Should return -1,&#160;but&#160;may&#160;cause&#160;a&#160;run time&#160;error&#160;on 64-bit&#160;versions.<br/>
FFFFFFFFF<br/>
0<br/>
Overflow&#160;returns zero;&#160;this is nine&#160;hexadecimal&#160;digits.<br/>
E<br/>
14<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FE<br/>
254<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFE<br/>
4094<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFFE<br/>
65534<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFFFE<br/>
1048574<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFFFFE<br/>
16777214<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFFFFFE<br/>
268435454<br/>
Correct&#160;hexadecimal&#160;value.<br/>
FFFFFFFE<br/>
ERROR<br/>
Run&#160;time&#160;error,&#160;used&#160;to return&#160;-2.<br/>
FFFFFFFFE<br/>
0<br/>
Overflow&#160;returns zero;&#160;this is nine&#160;hexadecimal&#160;digits.<br/>
When&#160;writing numbers, you&#160;don’t&#160;need to include&#160;leading zeros. For example, 3 and 003 are&#160;the&#160;same&#160;<br/>number.&#160;A&#160;Long&#160;Integer can contain eight&#160;hexadecimal&#160;digits.&#160;If&#160;only&#160;four digits&#160;are&#160;written,&#160;you&#160;can assume&#160;<br/>there&#160;are&#160;leading&#160;zeros.&#160;When the&#160;hexadecimal&#160;number is&#160;too large&#160;for a&#160;Long, a&#160;zero is&#160;returned.&#160;The&#160;<br/>negative&#160;numbers&#160;are&#160;just&#160;as&#160;easily&#160;explained.&#160;The&#160;computer’s&#160;internal&#160;binary&#160;representation&#160;of a&#160;negative&#160;<br/>number has&#160;the&#160;first&#160;bit&#160;set.&#160;The&#160;hexadecimal&#160;digits&#160;8, 9,&#160;A, B, C, D, E, and F&#160;all&#160;have&#160;the&#160;high bit&#160;set&#160;when&#160;<br/>represented&#160;as&#160;a&#160;binary&#160;number.&#160;If&#160;the&#160;first&#160;hexadecimal&#160;digit&#160;has&#160;the&#160;high bit&#160;set,&#160;the&#160;returned Long&#160;is&#160;<br/>negative.&#160;A&#160;hexadecimal&#160;number is&#160;positive&#160;if it&#160;contains&#160;fewer than&#160;eight&#160;hexadecimal&#160;digits,&#160;and it&#160;is&#160;<br/>negative&#160;if it&#160;contains&#160;eight&#160;hexadecimal&#160;digits&#160;and the&#160;first&#160;digit&#160;is&#160;8, 9,&#160;A, B, C,&#160;D, E, or F.&#160;Well, this&#160;used&#160;<br/>to be&#160;true.&#160;<br/>
<b>TIP</b><br/>
In&#160;64-bit&#160;versions of&#160;OOo,&#160;CLng&#160;generate&#160;an error&#160;for&#160;negative&#160;numbers represented as Hexadecimal!&#160;<br/>Hopefully&#160;this will&#160;be&#160;fixed.&#160;Here&#160;are&#160;two tests&#160;that&#160;I&#160;expect&#160;to print&#160;-1.&#160;Note:&#160;I&#160;last&#160;tested&#160;with&#160;OOo&#160;<br/>
version 3.3.0&#160;and&#160;LO&#160;4.0.1.2.<br/>
print&#160;&amp;HFFFFFFFF<br/>print&#160;CLng(&#34;&amp;HFFFFFFFF&#34;) &#160;' Generates an error<br/>
The&#160;CByte&#160;function&#160;has&#160;the&#160;same&#160;behavior&#160;as&#160;CInt&#160;and CLng, albeit&#160;with a&#160;few&#160;caveats.&#160;The&#160;return&#160;type,&#160;<br/>Byte, is&#160;interpreted&#160;as&#160;a&#160;character unless&#160;it&#160;is&#160;explicitly&#160;converted to&#160;a&#160;number.&#160;A&#160;Byte&#160;is&#160;a&#160;Short&#160;Integer that&#160;<br/>uses&#160;only&#160;eight&#160;bits&#160;rather than&#160;the&#160;16 used by&#160;an Integer.<br/>
Print&#160;CByte(&#34;65&#34;)&#160; &#160; &#160; &#160; &#160;'A has ASCII value 65<br/>Print&#160;CInt(CByte(&#34;65xx&#34;))&#160;'65 directly converted to a number.<br/>
103<br/>
<hr/>
<a name=107></a><b>TIP</b><br/>
An&#160;integer&#160;in&#160;VB&#160;.NET&#160;is equivalent&#160;to an OOo&#160;Basic&#160;Long.<br/>VB&#160;uses different&#160;rounding&#160;rules. Numbers are&#160;rounded to&#160;the&#160;nearest&#160;even&#160;number&#160;when the&#160;decimal&#160;point<br/>is exactly&#160;0.5;&#160;this&#160;is called&#160;IEEE&#160;rounding.<br/>
The&#160;functions&#160;that&#160;return a&#160;floating-point&#160;number all&#160;have&#160;similar&#160;behavior.&#160;Numeric&#160;expressions&#160;are&#160;<br/>converted to&#160;the&#160;closest&#160;representable&#160;value. Strings&#160;that&#160;contain&#160;non-numeric&#160;components&#160;generate&#160;a&#160;run-<br/>time&#160;error.&#160;For&#160;example, CDbl(“13.4e2xx”)&#160;causes&#160;a&#160;run-time&#160;error.&#160;CDbl&#160;and CSng both&#160;generate&#160;a&#160;run-<br/>time&#160;error for hexadecimal&#160;and octal&#160;numbers&#160;that&#160;are&#160;too large.<br/>
<i><b>Listing&#160;81.</b>&#160;CSng and CDbl&#160;handle&#160;string&#160;input.<br/></i>Print&#160;CDbl(12.2)&#160; &#160; &#160;&#160;' 12.2<br/>Print&#160;CSng(&#34;12.55e1&#34;)&#160;' 125.5<br/>Print&#160;CDbl(&#34;-12.2e-1&#34;)'-1.22<br/>Print&#160;CSng(&#34;-12.5&#34;)&#160; &#160;'-12.5<br/>Print&#160;CDbl(&#34;xxyy&#34;)&#160; &#160;&#160;' run-time error<br/>Print&#160;CSng(&#34;12.1xx&#34;)&#160;&#160;' run-time error<br/>
The&#160;functions&#160;CDbl&#160;and CSng both fail&#160;for string input&#160;that&#160;contains&#160;non-numeric&#160;data;&#160;the&#160;Val&#160;function does<br/>not. Use&#160;the&#160;Val&#160;function to&#160;convert&#160;a&#160;string to&#160;a&#160;Double&#160;that&#160;may&#160;contain&#160;other characters.&#160;The&#160;Val&#160;function&#160;<br/>looks&#160;at&#160;each character in the&#160;string, ignoring spaces, tabs, and new&#160;lines,&#160;stopping&#160;at&#160;the&#160;first&#160;character that&#160;<br/>isn’t&#160;part&#160;of a&#160;number.&#160;Symbols&#160;and characters&#160;often considered to be&#160;parts&#160;of numeric&#160;values, such as&#160;dollar&#160;<br/>signs&#160;and commas, are&#160;not&#160;recognized.&#160;The&#160;function&#160;does, however,&#160;recognize&#160;octal&#160;and hexadecimal&#160;<br/>numbers&#160;prefixed by&#160;&amp;O&#160;(for octal)&#160;and &amp;H&#160;(for hexadecimal).<br/>
The&#160;Val&#160;function treats&#160;spaces&#160;differently&#160;than other functions&#160;treat&#160;spaces;&#160;for example,&#160;Val(“&#160; 12 &#160; &#160;34”)&#160;<br/>returns&#160;the&#160;number 1234;&#160;CDbl&#160;and CSng generate&#160;a&#160;run-time&#160;error,&#160;and CInt&#160;returns&#160;12 for the&#160;same&#160;input.<br/>
<i><b>Listing&#160;82.</b>&#160;Treatment&#160;of&#160;spaces&#160;is&#160;different.</i><br/>
Sub&#160;NumsAreDifferent<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;ErrorHandler:<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;s&#160;=&#160;&#34;Val(&#34;&#34; &#160;12 &#160;34&#34;&#34;) = &#34;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;Val(&#34; &#160;12 &#160; &#160;34&#34;)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;CInt(&#34;&#34; &#160;12 &#160;34&#34;&#34;) = &#34;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CInt(&#34; &#160;12 &#160; &#160;34&#34;)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;CLng(&#34;&#34; &#160;12 &#160;34&#34;&#34;) = &#34;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CLng(&#34; &#160;12 &#160; &#160;34&#34;)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;CSng(&#34;&#34; &#160;12 &#160;34&#34;&#34;) = &#34;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CSng(&#34; &#160;12 &#160; &#160;34&#34;)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;CDbl(&#34;&#34; &#160;12 &#160;34&#34;&#34;) = &#34;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CDbl(&#34; &#160;12 &#160; &#160;34&#34;)<br/>&#160;&#160;MsgBox&#160;s<br/>&#160;&#160;Exit&#160;Sub<br/>&#160;&#160;ErrorHandler:<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Error: &#34;&#160;&amp;&#160;Error<br/>&#160; &#160;&#160;Resume&#160;Next<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
The&#160;Val&#160;function does not&#160;use&#160;localization while&#160;converting&#160;a&#160;number&#160;so the&#160;only&#160;recognized&#160;decimal&#160;<br/>separator&#160;is&#160;the&#160;period;&#160;the&#160;comma&#160;can&#160;be&#160;used as a&#160;group&#160;separator&#160;but&#160;is not&#160;valid&#160;to the&#160;right&#160;of&#160;the&#160;<br/>
decimal.&#160;Use&#160;CDbl&#160;or&#160;CLng&#160;to convert&#160;numbers based&#160;on the&#160;current&#160;locale.&#160;In&#160;case&#160;you forgot,&#160;the&#160;locale&#160;<br/>is another&#160;way&#160;to refer&#160;to the&#160;settings that&#160;affect&#160;formatting&#160;based&#160;on a&#160;specific&#160;country.&#160;See<a href="libremacros.html#108">&#160;Listing&#160;83.</a><br/>
104<br/>
<hr/>
<a name=108></a><i><b>Listing&#160;83.</b>&#160;The&#160;Val&#160;function&#160;is&#160;the&#160;inverse&#160;of&#160;the&#160;Str&#160;function.<br/></i>Sub&#160;ExampleVal<br/>&#160;&#160;Print&#160;Val(&#34; 12 34&#34;)&#160;&#160;'1234<br/>&#160;&#160;Print&#160;Val(&#34;12 + 34&#34;)&#160;'12<br/>&#160;&#160;Print&#160;Val(&#34;-1.23e4&#34;)&#160;'-12300<br/>&#160;&#160;Print&#160;Val(&#34; &amp;FF&#34;)&#160; &#160;&#160;'0<br/>&#160;&#160;Print&#160;Val(&#34; &amp;HFF&#34;)&#160; &#160;'255<br/>&#160;&#160;Print&#160;Val(&#34;&amp;HFFFF&#34;)&#160;&#160;'-1<br/>&#160;&#160;Print&#160;Val(&#34;&amp;HFFFE&#34;)&#160;&#160;'-2<br/>&#160;&#160;Print&#160;Val(&#34;&amp;H3FFFE&#34;)&#160;'-2, yes, it really converts this to -2<br/>&#160;&#160;Print&#160;Val(&#34;&amp;HFFFFFFFFFFFFF&#34;)&#160;'-1<br/>End&#160;Sub<br/>
As&#160;of version 1.1.1, the&#160;behavior&#160;of the&#160;Val&#160;function while&#160;recognizing hexadecimal&#160;or octal&#160;numbers&#160;is&#160;<br/>strange&#160;enough that&#160;I&#160;call&#160;it&#160;a&#160;bug. Internally,&#160;hexadecimal&#160;and octal&#160;numbers&#160;are&#160;converted to&#160;a&#160;32-bit&#160;Long&#160;<br/>Integer and then&#160;the&#160;least&#160;significant&#160;16 bits&#160;are&#160;converted&#160;to an Integer.&#160;This&#160;explains&#160;why&#160;i<a href="libremacros.html#108">n&#160;Listing&#160;83&#160;t</a>he&#160;<br/>number H3FFFE&#160;is&#160;converted to&#160;-2, because&#160;only&#160;the&#160;least&#160;significant&#160;16 bits&#160;are&#160;recognized&#160;—&#160;in&#160;case&#160;you&#160;<br/>forgot,&#160;this&#160;means&#160;the&#160;rightmost&#160;four hexadecimal&#160;digits.&#160;This&#160;strange&#160;behavior is&#160;demonstrated in<a href="libremacros.html#108">&#160;Listing&#160;<br/>84.&#160;</a>The&#160;output&#160;is&#160;explained&#160;i<a href="libremacros.html#108">n&#160;Table&#160;29.</a><br/>
<i><b>Listing&#160;84.</b>&#160;ExampleValWithHex.<br/></i>Sub&#160;ExampleValWithHex<br/>&#160;&#160;Dim&#160;s$,&#160;i%<br/>&#160;&#160;Dim&#160;l&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;v()<br/>&#160; &#160;v()&#160;=&#160;Array(&#34;&amp;HF&#34;,&#160; &#160; &#160;&#34;&amp;HFF&#34;,&#160; &#160; &#160;&#34;&amp;HFFF&#34;,&#160; &#160; &#160;&#34;&amp;HFFFF&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;HFFFFF&#34;,&#160;&#34;&amp;HFFFFFF&#34;,&#160;&#34;&amp;HFFFFFFF&#34;,&#160;&#34;&amp;HFFFFFFFF&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;HFFFFFFFFF&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;HE&#34;,&#160; &#160; &#160;&#160;&#34;&amp;HFE&#34;,&#160; &#160; &#160;&#34;&amp;HFFE&#34;,&#160; &#160; &#160;&#34;&amp;HFFFE&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;HFFFFE&#34;,&#160;&#160;&#34;&amp;HFFFFFE&#34;,&#160;&#34;&amp;HFFFFFFE&#34;,&#160;&#34;&amp;HFFFFFFFE&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;HFFFFFFFFE&#34;,&#160;&#34;&amp;H111111111&#34;,&#160;&#34;&amp;H1111&#34;)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(v())&#160;To&#160;UBound(v())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Val(&#34;&#160;&amp;&#160;v(i)&#160;&amp;&#160;&#34;) = &#34;&#160;&amp;&#160;Val(v(i))&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;'This worked in OOo 2.x, but, it&#160;<br/>&#160;&#160;' fails in OOo 3.2.1<br/>&#160;&#160;'l = &#34;&amp;H&#34; &amp; Hex(-2)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;Hex(-1) = &#34;&#160;&amp;&#160;Hex(-1)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Hex(-2) = &#34;&#160;&amp;&#160;Hex(-2)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;'s = s &amp; &#34;l = &amp;H&#34; &amp; Hex(-2) &amp; &#34; ==&gt; &#34; &amp; l &amp; CHR$(10) &#160;<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<i><b>Table&#160;29.</b>&#160;Output&#160;from<a href="libremacros.html#108">&#160;Listing&#160;84&#160;wi</a></i><i>th explanatory&#160;text.</i><br/>
<i><b>Input</b></i><br/>
<i><b>Output</b></i><br/>
<i><b>Explanation</b></i><br/>
F<br/>
15<br/>
Hexadecimal&#160;F&#160;is 15.<br/>
FF<br/>
255<br/>
Hexadecimal&#160;FF&#160;is 255.<br/>
FFF<br/>
4095<br/>
Hexadecimal&#160;FFF&#160;is&#160;4095.<br/>
FFFF<br/>
-1<br/>
Hexadecimal&#160;FFFF&#160;is&#160;-1&#160;for&#160;a&#160;16-bit&#160;(two-byte)&#160;integer.<br/>
FFFFF<br/>
-1<br/>
Only&#160;the&#160;rightmost&#160;two&#160;bytes (four&#160;characters)&#160;are&#160;recognized.<br/>
E<br/>
14<br/>
Hexadecimal&#160;E&#160;is 14.<br/>
105<br/>
<hr/>
<a name=109></a><i><b>Input</b></i><br/>
<i><b>Output</b></i><br/>
<i><b>Explanation</b></i><br/>
FE<br/>
254<br/>
Hexadecimal&#160;FE&#160;is 254.<br/>
FFE<br/>
4094<br/>
Hexadecimal&#160;FFE&#160;is&#160;4094.<br/>
FFFE<br/>
-2<br/>
Hexadecimal&#160;FFFE is&#160;-2&#160;for&#160;a&#160;16-bit&#160;(two-byte)&#160;integer.<br/>
FFFFE<br/>
-2<br/>
Only&#160;the&#160;rightmost&#160;two&#160;bytes are&#160;recognized.<br/>
FFFFFE<br/>
-2<br/>
Only&#160;the&#160;rightmost&#160;two&#160;bytes are&#160;recognized.<br/>
FFFFFFE<br/>
-2<br/>
Only&#160;the&#160;rightmost&#160;two&#160;bytes are&#160;recognized.<br/>
FFFFFFFE<br/>
-2<br/>
Only&#160;the&#160;rightmost&#160;two&#160;bytes are&#160;recognized.<br/>
HFFFFFFFFE<br/>
-2<br/>
Only&#160;the&#160;rightmost&#160;two&#160;bytes are&#160;recognized.<br/>
111111111<br/>
4639<br/>
Correct&#160;value, right&#160;most&#160;two&#160;bytes&#160;only.<br/>
1111<br/>
4639<br/>
Correct&#160;value<br/>
Val&#160;converts&#160;hexadecimal&#160;numbers, but, it&#160;only&#160;uses&#160;the&#160;rightmost&#160;two bytes.<br/>
Use&#160;the&#160;functions&#160;CByte, CInt, CLng, CSng, and CDbl&#160;to convert&#160;a&#160;number,&#160;string, or expression&#160;to a&#160;<br/>specific&#160;numeric&#160;type. Use&#160;the&#160;functions&#160;Int&#160;and Fix&#160;to&#160;remove&#160;the&#160;decimal&#160;portion&#160;and return a&#160;Double.&#160;A&#160;<br/>string expression&#160;that&#160;does&#160;not&#160;contain&#160;a&#160;number evaluates&#160;to zero. Only&#160;the&#160;portion of the&#160;string that&#160;<br/>contains&#160;a&#160;number is&#160;evaluated. See<a href="libremacros.html#109">&#160;Table&#160;30.</a><br/>
<i><b>Table&#160;30.</b>&#160;Remove&#160;the&#160;decimal&#160;portion&#160;of&#160;a floating-point&#160;number.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Type</b></i><br/>
<i><b>Description</b></i><br/>
Int<br/>
Double<br/>
Round&#160;the&#160;number&#160;toward&#160;negative&#160;infinity.<br/>
Fix<br/>
Double<br/>
Chop off&#160;the&#160;decimal&#160;portion.<br/>
The&#160;functions&#160;Int&#160;and Fix&#160;differ only&#160;in&#160;their&#160;treatment&#160;of negative&#160;numbers. Fix&#160;always&#160;discards&#160;the&#160;<br/>decimal,&#160;which&#160;is&#160;equivalent&#160;to&#160;rounding toward zero. Int, on the&#160;other hand, rounds&#160;toward negative&#160;<br/>infinity.&#160;In&#160;other words, “Int(12.3)”&#160;is&#160;12 and “Int(-12.3)”&#160;is&#160;-13.<br/>
Print&#160;Int(12.2)&#160; &#160; &#160;' 12<br/>Print&#160;Fix(12.2)&#160; &#160; &#160;' 12<br/>Print&#160;Int(&#34;12.5&#34;)&#160; &#160;' 12<br/>Print&#160;Fix(&#34;12.5&#34;)&#160; &#160;' 12<br/>Print&#160;Int(&#34;xxyy&#34;)&#160; &#160;' &#160;0<br/>Print&#160;Fix(&#34;xxyy&#34;)&#160; &#160;' &#160;0<br/>Print&#160;Int(-12.4)&#160; &#160;&#160;'-13<br/>Print&#160;Fix(-12.4)&#160; &#160;&#160;'-12<br/>Print&#160;Fix(&#34;-12.1xx&#34;)'-12<br/>Print&#160;Int(&#34;-12.1xx&#34;)'-13<br/>
The&#160;CCur function&#160;converts&#160;a&#160;numerical&#160;expression&#160;to a&#160;currency&#160;object.&#160;Visual&#160;Basic&#160;.NET&#160;removed&#160;<br/>support&#160;for the&#160;CCur function as&#160;well&#160;as&#160;the&#160;Currency&#160;data&#160;type. OOo Basic&#160;still&#160;supports&#160;the&#160;Currency&#160;data&#160;<br/>type.<br/>
106<br/>
<hr/>
<a name=110></a><i><b>&#160;4.5.&#160;Number&#160;to&#160;string&#160;conversions<br/></b></i>String conversion functions,&#160;shown i<a href="libremacros.html#110">n&#160;Table&#160;31, c</a>hange&#160;non-string&#160;data&#160;into&#160;strings. In&#160;OOo, text&#160;is&#160;stored as<br/>Unicode&#160;version 2.0 values, providing good support&#160;for multiple&#160;languages. Each String variable&#160;can hold&#160;<br/>up to 65,535 characters.&#160;<br/>
<i><b>Table&#160;31.</b>&#160;String conversion&#160;functions.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
Str<br/>
Convert&#160;from&#160;a&#160;number&#160;to a&#160;String&#160;with&#160;no localization.<br/>
CStr<br/>
Convert&#160;anything&#160;to a&#160;String.&#160;Numbers and&#160;dates are&#160;formatted&#160;based on locale.<br/>
Hex<br/>
Return the&#160;hexadecimal&#160;representation&#160;of&#160;a&#160;number&#160;as a&#160;String.<br/>
Oct<br/>
Return the&#160;octal&#160;representation of&#160;a&#160;number&#160;as&#160;a&#160;String.<br/>
<i><b>&#160;4.6.&#160;Simple&#160;formatting<br/></b></i>Use&#160;the&#160;CStr function&#160;to generally&#160;convert&#160;any&#160;type&#160;to&#160;a&#160;String.&#160;The&#160;returned value&#160;is&#160;dependent&#160;upon the&#160;<br/>input&#160;data&#160;type. Boolean values&#160;convert&#160;to&#160;the&#160;text&#160;“True”&#160;or “False.”&#160;Dates&#160;convert&#160;to&#160;the&#160;short&#160;date&#160;format&#160;<br/>used by&#160;the&#160;system. Numbers&#160;are&#160;converted to&#160;a&#160;string representation&#160;of the&#160;number.&#160;See<a href="libremacros.html#110">&#160;Listing 85.</a><br/>
<i><b>Listing&#160;85.</b>&#160;Output&#160;from&#160;CStr&#160;is&#160;locale&#160;specific; this&#160;is&#160;English&#160;(USA).</i><br/>
Dim&#160;n&#160;As&#160;Long,&#160;d&#160;As&#160;Double,&#160;b&#160;As&#160;Boolean<br/>n&#160;=&#160;999999999&#160;:&#160;d&#160;=&#160;EXP(1.0)&#160;:&#160;b&#160;=&#160;False<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;CStr(b)&#160;&#160;'XFalse<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;CStr(n)&#160;&#160;'X999999999<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;CStr(d)&#160;&#160;'X2.71828182845904<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;CStr(Now)'X06/09/2010 20:24:24 (almost exactly 7 years after 1st&#160;edition)<br/>
The&#160;CStr&#160;function performs&#160;simple&#160;number formatting with knowledge&#160;of the&#160;current&#160;locale.&#160;Simple&#160;<br/>conversion of a&#160;number to a&#160;string is&#160;done&#160;with Str.&#160;Although the&#160;Str&#160;function is&#160;designed to&#160;deal&#160;specifically<br/>with numeric&#160;values, the&#160;output&#160;is&#160;very&#160;similar to&#160;CStr.&#160;When&#160;the&#160;Str&#160;function converts&#160;a&#160;number to a&#160;string,&#160;<br/>a&#160;leading space&#160;is&#160;always&#160;included for the&#160;sign of the&#160;number.&#160;A&#160;negative&#160;number includes&#160;the&#160;minus&#160;sign,&#160;<br/>and no leading empty&#160;space&#160;is&#160;present.&#160;A&#160;non-negative&#160;number,&#160;on the&#160;other hand, includes&#160;a&#160;leading empty&#160;<br/>space.&#160;The&#160;output&#160;of Str is&#160;not&#160;locale&#160;specific;&#160;a&#160;period&#160;is&#160;always&#160;used as&#160;the&#160;decimal&#160;separator.&#160;See<a href="libremacros.html#110">&#160;Listing&#160;<br/>86.</a><br/>
<i><b>Listing&#160;86.</b>&#160;Output&#160;from&#160;Str&#160;is&#160;not&#160;dependent&#160;upon locale.<br/></i>Dim&#160;n&#160;As&#160;Long,&#160;d&#160;As&#160;Double,&#160;b&#160;As&#160;Boolean<br/>n&#160;=&#160;999999999&#160;:&#160;d&#160;=&#160;EXP(1.0)&#160;:&#160;b&#160;=&#160;False<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;Str(b)&#160;&#160;'XFalse<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;Str(n)&#160;&#160;'X 999999999<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;Str(d)&#160;&#160;'X 2.71828182845904<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;Str(Now)'X06/09/2010 20:28:48 (almost exactly 7 years after 1st&#160;edition)<br/>
The&#160;output&#160;from&#160;the&#160;code&#160;i<a href="libremacros.html#110">n&#160;Listing&#160;85&#160;and&#160;Listing&#160;86&#160;i</a>s&#160;the&#160;same&#160;except&#160;for a&#160;leading space&#160;in&#160;front&#160;of the&#160;<br/>non-negative&#160;numbers. If&#160;you run the&#160;code&#160;using a&#160;different&#160;locale, such as&#160;Germany,&#160;the&#160;output&#160;changes<a href="libremacros.html#110">&#160;for<br/>Listing 85&#160;but</a>&#160;not<a href="libremacros.html#110">&#160;Listing 86.</a><br/>
<b>TIP</b><br/>
There&#160;is little&#160;reason to&#160;use&#160;Str&#160;rather&#160;than CStr.&#160;Str&#160;may&#160;run&#160;a&#160;bit&#160;faster,&#160;but&#160;CStr&#160;knows&#160;about&#160;your&#160;current&#160;<br/>locale.<br/>
107<br/>
<hr/>
<a name=111></a>To&#160;demonstrate&#160;that&#160;CStr is&#160;locale&#160;specific,&#160;I&#160;changed my&#160;locale&#160;to German&#160;(Germany)&#160;and then&#160;ran the&#160;code<br/>i<a href="libremacros.html#110">n&#160;Listing&#160;85&#160;a</a>gai<a href="libremacros.html#111">n.&#160;Listing&#160;87&#160;s</a>hows&#160;that&#160;the&#160;decimal&#160;is&#160;now&#160;expressed as&#160;a&#160;comma&#160;and that&#160;the&#160;date&#160;is&#160;now&#160;<br/>expressed as&#160;MM.DD.YYYY.<br/>
<i><b>Listing&#160;87.</b>&#160;Output&#160;from&#160;CStr&#160;is&#160;locale&#160;specific; this&#160;is&#160;German (Germany).<br/></i>Dim&#160;n&#160;As&#160;Long,&#160;d&#160;As&#160;Double,&#160;b&#160;As&#160;Boolean<br/>n&#160;=&#160;999999999&#160;:&#160;d&#160;=&#160;EXP(1.0)&#160;:&#160;b&#160;=&#160;False<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;CStr(b)&#160;&#160;'XFalse<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;CStr(n)&#160;&#160;'X999999999<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;CStr(d)&#160;&#160;'X2,71828182845904<br/>Print&#160;&#34;X&#34;&#160;&amp;&#160;CStr(Now)'X14.08.2010 20:39:49<br/>
<i><b>&#160;4.7.&#160;Other&#160;number&#160;bases,&#160;hexadecimal,&#160;octal,&#160;and&#160;binary<br/></b></i>OOo Basic&#160;provides&#160;the&#160;functions&#160;Hex&#160;and Oct&#160;to&#160;convert&#160;a&#160;number to hexadecimal&#160;and octal.&#160;No native&#160;<br/>support&#160;is&#160;provided for a&#160;conversion&#160;to and from&#160;binary.&#160;You can’t&#160;directly&#160;use&#160;the&#160;output&#160;from&#160;Hex&#160;and Oct&#160;<br/>to convert&#160;the&#160;string back to a&#160;number because&#160;it&#160;is&#160;missing the&#160;leading “&amp;H”&#160;and “&amp;O”.<br/>
Print&#160;Hex(447)&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'1BF<br/>Print&#160;CInt(&#34;&amp;H&#34;&#160;&amp;&#160;Hex(747))&#160;'747<br/>Print&#160;Oct(877)&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'1555<br/>Print&#160;CInt(&#34;&amp;O&#34;&#160;&amp;&#160;Oct(213))&#160;'213<br/>
The&#160;source&#160;code&#160;for Chapter 2 contains&#160;the&#160;function IntToBinaryString, which converts&#160;an integer to a&#160;binary<br/>number in the&#160;Operators&#160;module&#160;in&#160;the&#160;source&#160;code&#160;file&#160;SC02.sxw.&#160;The&#160;function&#160;is&#160;very&#160;flexible&#160;but&#160;it&#160;isn’t&#160;<br/>particularly&#160;fast.&#160;A&#160;faster routine&#160;using the&#160;Hex&#160;function is&#160;shown in<a href="libremacros.html#111">&#160;Listing 88.</a><br/>
<i><b>Listing&#160;88.</b>&#160;IntToBinaryString.<br/></i>Function&#160;IntToBinaryString(ByVal&#160;x&#160;As&#160;Long)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;sHex&#160;As&#160;String<br/>&#160;&#160;Dim&#160;sBin&#160;As&#160;String<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;&#160;<br/>&#160;&#160;sHex&#160;=&#160;Hex(x)<br/>&#160;&#160;For&#160;i=1&#160;To&#160;Len(sHex)<br/>&#160; &#160;&#160;Select&#160;Case&#160;Mid(sHex,&#160;i,&#160;1)<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;0&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;0000&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;1&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;0001&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;2&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;0010&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;3&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;0011&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;4&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;0100&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;5&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;0101&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;6&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;0110&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;7&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;0111&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;8&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;1000&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;9&#34;<br/>
108<br/>
<hr/>
<a name=112></a>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;1001&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;A&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;1010&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;B&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;1011&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;C&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;1100&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;D&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;1101&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;E&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;1110&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;F&#34;<br/>&#160; &#160; &#160; &#160;&#160;sBin&#160;=&#160;sBin&#160;&amp;&#160;&#34;1111&#34;<br/>&#160; &#160;&#160;End&#160;Select<br/>&#160;&#160;Next<br/>&#160;&#160;IntToBinaryString&#160;=&#160;sBin<br/>End&#160;Function<br/>
The&#160;code&#160;in<a href="libremacros.html#111">&#160;Listing 88&#160;m</a>ay&#160;be&#160;long, but&#160;it’s&#160;very&#160;simple.&#160;There&#160;is&#160;a&#160;correlation&#160;between hexadecimal&#160;digits&#160;<br/>and binary&#160;digits;&#160;each hexadecimal&#160;digit&#160;is&#160;composed of four binary&#160;digits.&#160;This&#160;relationship&#160;does&#160;not&#160;exist&#160;<br/>for base&#160;10 numbers.&#160;The&#160;number is&#160;converted&#160;to a&#160;hexadecimal&#160;number using&#160;the&#160;Hex function.&#160;Each&#160;<br/>hexadecimal&#160;digit&#160;is&#160;converted to&#160;the&#160;corresponding&#160;binary&#160;digits.&#160;To&#160;convert&#160;a&#160;binary&#160;number in&#160;String form<br/>back to&#160;an Integer,&#160;use&#160;the&#160;code&#160;in<a href="libremacros.html#112">&#160;Listing 89.</a><br/>
<b>TIP</b><br/>
This&#160;routine&#160;fails with&#160;negative&#160;numbers because&#160;CLng()&#160;OOo&#160;3.3.0&#160;fails with&#160;Hex numbers representing&#160;<br/>
negative&#160;long&#160;values.<br/>
<i><b>Listing&#160;89.</b>&#160;BinaryStringToLong.</i><br/>
Function&#160;BinaryStringToLong(s$)&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;sHex&#160;As&#160;String<br/>&#160;&#160;Dim&#160;sBin&#160;As&#160;String<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;nLeftOver&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Integer<br/>&#160;&#160;<br/>&#160;&#160;n&#160;=&#160;Len(s$)<br/>&#160;&#160;nLeftOver&#160;=&#160;n&#160;MOD&#160;4<br/>&#160;&#160;If&#160;nLeftOver&#160;&gt;&#160;0&#160;Then<br/>&#160; &#160;&#160;sHex&#160;=&#160;SmallBinToHex(Left(s$,&#160;nLeftOver))<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;For&#160;i=nLeftOver&#160;+&#160;1&#160;To&#160;n&#160;Step&#160;4<br/>&#160; &#160;&#160;sHex&#160;=&#160;sHex&#160;&amp;&#160;SmallBinToHex(Mid(s$,&#160;i,&#160;4))<br/>&#160;&#160;Next<br/>&#160;&#160;BinaryStringToLong&#160;=&#160;CLng(&#34;&amp;H&#34;&#160;&amp;&#160;sHex)<br/>End&#160;Function<br/>
Function&#160;SmallBinToHex(s$)&#160;As&#160;String<br/>&#160; &#160;&#160;If&#160;Len(s$)&#160;&lt;&#160;4&#160;Then&#160;s$&#160;=&#160;String(4-Len(s$),&#160;&#34;0&#34;)&#160;&amp;&#160;s$<br/>&#160; &#160;&#160;Select&#160;Case&#160;s$<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;0000&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;0&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;0001&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;1&#34;<br/>
109<br/>
<hr/>
<a name=113></a>&#160; &#160; &#160;&#160;Case&#160;&#34;0010&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;2&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;0011&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;3&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;0100&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;4&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;0101&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;5&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;0110&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;6&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;0111&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;7&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;1000&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;8&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;1001&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;9&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;1010&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;A&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;1011&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;B&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;1100&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;C&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;1101&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;D&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;1110&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;E&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;&#34;1111&#34;<br/>&#160; &#160; &#160; &#160;&#160;SmallBinToHex&#160;=&#160;&#34;F&#34;<br/>&#160; &#160;&#160;End&#160;Select<br/>End&#160;Function<br/>
To&#160;convert&#160;a&#160;binary&#160;string to an Integer,&#160;the&#160;number is&#160;first&#160;converted&#160;to a&#160;hexadecimal&#160;number.&#160;A&#160;set&#160;of four&#160;<br/>binary&#160;digits&#160;correspond to&#160;a&#160;single&#160;hexadecimal&#160;digit.&#160;The&#160;number is&#160;padded on the&#160;left&#160;with&#160;zeros&#160;so that&#160;<br/>the&#160;string can be&#160;broken up into&#160;blocks&#160;of four binary&#160;digits. Each block&#160;of four binary&#160;digits&#160;is&#160;converted to&#160;<br/>a&#160;single&#160;hexadecimal&#160;digit.&#160;The&#160;CLng&#160;function&#160;is&#160;then&#160;used to&#160;convert&#160;the&#160;hexadecimal&#160;number to&#160;decimal&#160;<br/>form.&#160;The&#160;routine&#160;i<a href="libremacros.html#113">n&#160;Listing&#160;90&#160;de</a>monstrates&#160;the&#160;use&#160;of these&#160;functions;&#160;also see<a href="libremacros.html#114">&#160;Figure&#160;42.</a><br/>
<i><b>Listing&#160;90.</b>&#160;ExampleWholeNumberConversions.</i><br/>
Sub&#160;ExampleWholeNumberConversions<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;nAsHex$,&#160;nAsOct$,&#160;nAsBin$<br/>&#160;&#160;s&#160;=&#160;InputBox(&#34;Number to convert:&#34;,&#160;&#34;Long To Other&#34;,&#160;&#34;1389&#34;)<br/>&#160;&#160;If&#160;IsNull(s)&#160;Then&#160;Exit&#160;Sub<br/>&#160;&#160;If&#160;Len(Trim(s))&#160;=&#160;0&#160;Then&#160;Exit&#160;Sub<br/>&#160;&#160;n&#160;=&#160;CLng(Trim(s))&#160;&#160;'Trim removes leading and trailing spaces<br/>&#160;&#160;nAsHex&#160;=&#160;Hex(n)<br/>&#160;&#160;nAsOct&#160;=&#160;Oct(n)<br/>&#160;&#160;nAsBin&#160;=&#160;IntToBinaryString(n)<br/>&#160;&#160;s&#160;=&#160;&#34;Original number = &#34;&#160;&amp;&#160;CStr(n)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Hex(&#34;&#160;&amp;&#160;CStr(n)&#160;&amp;&#160;&#34;) = &#34;&#160;&amp;&#160;nAsHex&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Oct(&#34;&#160;&amp;&#160;CStr(n)&#160;&amp;&#160;&#34;) = &#34;&#160;&amp;&#160;nAsOct&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Binary(&#34;&#160;&amp;&#160;CStr(n)&#160;&amp;&#160;&#34;) = &#34;&#160;&amp;&#160;nAsBin&#160;&amp;_<br/>
110<br/>
<hr/>
<a name=114></a>&#160; &#160; &#160;&#160;&#34; ==&gt; &#34;&#160;&amp;&#160;BinaryStringToLong(nAsBin)<br/>&#160;&#160;MsgBox(s,&#160;0,&#160;&#34;Whole Number Conversions&#34;)<br/>End&#160;Sub<br/>
<i><b>Figure&#160;42.</b>&#160;Convert&#160;a whole&#160;number&#160;to hexadecimal,&#160;octal,&#160;and binary.</i><br/>
<i><b>&#160;4.8.&#160;Random&#160;numbers&#160;<br/></b></i>OOo Basic&#160;generates&#160;floating-point&#160;random&#160;numbers&#160;ranging from&#160;0 through 1. Random&#160;numbers&#160;generated&#160;<br/>by&#160;computers&#160;aren’t, in&#160;general, random.&#160;An algorithm&#160;is&#160;used that&#160;generates&#160;“random&#160;numbers”&#160;based on a&#160;<br/>previous&#160;random&#160;number.&#160;The&#160;first&#160;number on which all&#160;other random&#160;numbers&#160;are&#160;based is&#160;called the&#160;<br/>“seed.”&#160;You use&#160;the&#160;Randomize&#160;function to&#160;specify&#160;the&#160;seed value.&#160;If&#160;a&#160;value&#160;is&#160;omitted, the&#160;Randomize&#160;<br/>function uses&#160;a&#160;value&#160;obtained&#160;from&#160;the&#160;system&#160;timer.&#160;Specifying the&#160;starting seed allows&#160;you to test&#160;<br/>programs&#160;and generate&#160;the&#160;same&#160;sequence&#160;of random&#160;numbers&#160;each time.&#160;<br/>
The&#160;Rnd function&#160;is&#160;used to generate&#160;the&#160;random&#160;numbers&#160;between 0 and 1.&#160;The&#160;OOo help&#160;claims&#160;that&#160;the&#160;<br/>Rnd function&#160;accepts&#160;an argument;&#160;I&#160;checked the&#160;source&#160;code&#160;for the&#160;Rnd function,&#160;which has&#160;not&#160;changed&#160;<br/>from&#160;version 1.x&#160;through 3.2.1, and the&#160;argument&#160;is&#160;ignored.&#160;<br/>
<b>TIP</b><br/>
The&#160;included help files incorrectly&#160;claim&#160;that&#160;the&#160;Rnd&#160;function accepts an argument&#160;that&#160;affects the&#160;<br/>
behavior.&#160;The&#160;argument&#160;is, and&#160;always has been, ignored.<br/>
Print&#160;Rnd()&#160; &#160;'Some number from 0 through 1<br/>Print&#160;Rnd()&#160; &#160;'Another number from 0 through 1<br/>
The&#160;random&#160;number generated is&#160;some&#160;number from&#160;0 through 1.&#160;To&#160;obtain&#160;a&#160;different&#160;range, perform&#160;a&#160;few&#160;<br/>mathematical&#160;operations.&#160;For&#160;example, multiplying a&#160;number between 0 and 1 by&#160;10 yields&#160;a&#160;number&#160;<br/>between 0 and 10.&#160;To&#160;use&#160;a&#160;range&#160;that&#160;does&#160;not&#160;start&#160;at&#160;0, add an appropriate&#160;offset.&#160;See<a href="libremacros.html#114">&#160;Listing 91.</a><br/>
<i><b>Listing&#160;91.</b>&#160;Return a random&#160;number&#160;in&#160;a range.<br/></i>Function&#160;RndRange(lowerBound&#160;As&#160;Double,&#160;upperBound&#160;As&#160;Double)&#160;As&#160;Double<br/>&#160;&#160;RndRange&#160;=&#160;lowerBound&#160;+&#160;Rnd()&#160;*&#160;(upperBound&#160;-&#160;lowerBound)<br/>End&#160;Function<br/>
Use&#160;an appropriate&#160;function,&#160;such as&#160;CInt&#160;or CLng, if you want&#160;a&#160;whole&#160;number rather than&#160;a&#160;floating-point&#160;<br/>number.<br/>
CLng(lowerBound&#160;+&#160;Rnd()&#160;*&#160;(upperBound&#160;-&#160;lowerBound))<br/>
I&#160;had two functions&#160;that&#160;solved the&#160;same&#160;problem&#160;—&#160;determining the&#160;GCD&#160;(Greatest&#160;Common&#160;Divisor) of&#160;<br/>two integers&#160;—&#160;and I&#160;wanted to&#160;know&#160;which was&#160;faster.&#160;I&#160;generated&#160;random&#160;integers&#160;and called each routine&#160;<br/>a&#160;few&#160;thousand&#160;times.&#160;While&#160;performing timing&#160;tests, it’s&#160;important&#160;to&#160;use&#160;the&#160;same&#160;data&#160;for each trial.&#160;I&#160;was&#160;<br/>able&#160;to&#160;use&#160;random&#160;numbers&#160;because&#160;the&#160;Randomize&#160;statement&#160;allows&#160;me&#160;to generate&#160;the&#160;same&#160;random&#160;<br/>numbers&#160;every&#160;time.<br/>
Randomize(2)&#160; &#160;&#160;'reset the random number generator to a known state<br/>t1&#160;=&#160;getSystemTicks()<br/>
111<br/>
<hr/>
<a name=115></a>For&#160;i&#160;=&#160;0&#160;To&#160;30000<br/>&#160;&#160;n1&#160;=&#160;CLng(10000&#160;*&#160;Rnd())<br/>&#160;&#160;n2&#160;=&#160;CLng(10000&#160;*&#160;Rnd())<br/>&#160;&#160;call&#160;gcd1(n1,&#160;n2)<br/>Next<br/>total_time_1&#160;=&#160;getSystemTicks()&#160;-&#160;t1<br/>
Randomize(2)&#160; &#160;&#160;'reset the random number generator to a known state<br/>t1&#160;=&#160;getSystemTicks()<br/>For&#160;i&#160;=&#160;0&#160;To&#160;30000<br/>&#160;&#160;n1&#160;=&#160;CLng(10000&#160;*&#160;Rnd())<br/>&#160;&#160;n2&#160;=&#160;CLng(10000&#160;*&#160;Rnd())<br/>&#160;&#160;call&#160;gcd2(n1,&#160;n2)<br/>Next<br/>total_time_2&#160;=&#160;getSystemTicks()&#160;-&#160;t1<br/>
<i><b>&#160;4.9.&#160;Conclusion<br/></b></i>The&#160;standard mathematical&#160;functions&#160;in&#160;OpenOffice.org&#160;Basic&#160;contain&#160;few&#160;surprises.&#160;The&#160;conversion&#160;<br/>functions&#160;work well,&#160;with some&#160;idiosyncrasies&#160;while&#160;converting strings&#160;to numbers. Be&#160;certain to&#160;choose&#160;a&#160;<br/>function that&#160;can handle&#160;the&#160;format&#160;and the&#160;ranges&#160;used. Rounding is&#160;another issue&#160;that&#160;requires&#160;special&#160;<br/>attention.&#160;Although the&#160;rounding&#160;behavior is&#160;documented and consistent,&#160;different&#160;functions&#160;and operators&#160;<br/>cause&#160;rounding to&#160;occur differently.<br/>
112<br/>
<hr/>
<a name=116></a><b>&#160;5.&#160;Array&#160;Routines<br/></b>This&#160;chapter introduces&#160;the&#160;subroutines&#160;and functions&#160;supported&#160;by&#160;OOo Basic&#160;that&#160;are&#160;used to&#160;manipulate&#160;<br/>arrays. It&#160;covers&#160;methods&#160;for manipulating arrays, creating arrays&#160;with&#160;data,&#160;creating arrays&#160;with no data,&#160;and<br/>changing the&#160;dimension of arrays.&#160;This&#160;chapter also presents&#160;methods&#160;to&#160;inspect&#160;array&#160;variables.<br/>
An array&#160;is&#160;a&#160;data&#160;structure&#160;in which similar&#160;elements&#160;of data&#160;are&#160;arranged in&#160;an indexed&#160;structure&#160;— for&#160;<br/>example,&#160;a&#160;column of names&#160;or a&#160;table&#160;of numbers. OOo Basic&#160;has&#160;subroutines&#160;and functions&#160;that&#160;change&#160;<br/>array&#160;dimensions, inspect&#160;existing arrays, and convert&#160;between arrays&#160;and scalar (non-array)&#160;data&#160;types.<br/>
The&#160;majority&#160;of the&#160;routines&#160;listed&#160;i<a href="libremacros.html#116">n&#160;Table&#160;32&#160;re</a>quire&#160;an array&#160;variable&#160;as&#160;the&#160;first&#160;argument.&#160;Array&#160;variables<br/>used as&#160;arguments&#160;to routines&#160;can be&#160;written&#160;with trailing parentheses. Parentheses&#160;after the&#160;variable&#160;are&#160;<br/>optional, but&#160;they&#160;used to&#160;be&#160;required (see<a href="libremacros.html#116">&#160;Listing&#160;92).&#160;</a><br/>
<b>TIP</b><br/>
There&#160;is no way&#160;to determine&#160;if&#160;a()&#160;refers to an array&#160;or&#160;a&#160;function while&#160;reading&#160;code;&#160;you&#160;must&#160;find&#160;where<br/>
the&#160;item&#160;in&#160;question is declared.<br/>
<i><b>Listing&#160;92.</b>&#160;Parentheses&#160;are&#160;not&#160;always&#160;required but&#160;are&#160;always&#160;allowed.</i><br/>
Sub&#160;AreArrayParensRequired<br/>&#160;&#160;Dim&#160;a(1&#160;To&#160;2)&#160; &#160; &#160;&#160;'a() is declared with specified dimensions<br/>&#160;&#160;Dim&#160;b()&#160; &#160; &#160; &#160; &#160; &#160;&#160;'b() is declared as an array without specified dimensions<br/>&#160;&#160;Dim&#160;c&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'c is a variant and may reference an array.<br/>&#160;&#160;c&#160;=&#160;Array(1,&#160;2)&#160; &#160;&#160;'c references a Variant array<br/>&#160;&#160;Print&#160;IsArray(a())&#160;'True<br/>&#160;&#160;Print&#160;IsArray(b())&#160;'True<br/>&#160;&#160;Print&#160;IsArray(c())&#160;'True<br/>&#160;&#160;Print&#160;IsArray(a)&#160; &#160;'True<br/>&#160;&#160;Print&#160;IsArray(b)&#160; &#160;'True<br/>&#160;&#160;Print&#160;IsArray(c)&#160; &#160;'True<br/>End&#160;Sub<br/>
<i><b>Table&#160;32.</b>&#160;Summary&#160;of&#160;subroutines&#160;and functions&#160;related to&#160;arrays.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
Array(args)<br/>
Return a&#160;Variant&#160;array&#160;that&#160;contains&#160;the&#160;arguments.<br/>
DimArray(args)<br/>
Return an empty&#160;Variant&#160;array.&#160;The&#160;arguments&#160;specify&#160;the&#160;dimension(s).<br/>
IsArray(var)<br/>
Return&#160;True&#160;if&#160;this&#160;variable&#160;is&#160;an array,&#160;False&#160;otherwise.<br/>
Join(array)<br/>
Concatenate&#160;the&#160;array&#160;elements separated&#160;by&#160;the&#160;optional&#160;string&#160;delimiter&#160;and&#160;<br/>
Join(array,&#160;delimiter)<br/>
return as a&#160;String.&#160;The&#160;default&#160;delimiter&#160;is&#160;a&#160;single&#160;space.<br/>
LBound(array)<br/>
Return the&#160;lower&#160;bound of&#160;the&#160;array&#160;argument.&#160;The&#160;optional&#160;dimension specifies&#160;<br/>
LBound(array,&#160;dimension)<br/>
which&#160;dimension&#160;to&#160;check.&#160;The&#160;first&#160;dimension is&#160;1.<br/>
ReDim&#160;[Preserve]&#160;var(args)&#160;[As&#160;Type]<br/>
Change&#160;the&#160;dimension of&#160;an array&#160;using&#160;the&#160;same&#160;syntax as the&#160;DIM&#160;statement.&#160;<br/>
The&#160;keyword Preserve&#160;keeps existing&#160;data&#160;intact. “As&#160;Type”&#160;is&#160;optional.<br/>
Split(str)<br/>
Split&#160;the&#160;string&#160;argument&#160;into an array&#160;of&#160;strings.&#160;The&#160;default&#160;delimiter&#160;is&#160;a&#160;space.&#160;<br/>
Split(str,&#160;delimiter)<br/>
The&#160;optional&#160;argument&#160;n&#160;limits&#160;the&#160;number&#160;of&#160;strings returned.<br/>
Split(str,&#160;delimiter,&#160;n)<br/>
UBound(array)<br/>
Return the&#160;upper&#160;bound of&#160;the&#160;array&#160;argument.&#160;The&#160;optional&#160;dimension specifies&#160;<br/>
UBound(array,&#160;dimension)<br/>
which&#160;dimension&#160;to&#160;check.&#160;The&#160;first&#160;dimension is&#160;1.<br/>
113<br/>
<hr/>
<a name=117></a>The&#160;word “dimension”&#160;is&#160;used to refer to arrays&#160;similarly&#160;to&#160;the&#160;way&#160;that&#160;“dimensions”&#160;is&#160;used to&#160;refer to&#160;<br/>spatial&#160;dimensions. For example,&#160;an array&#160;with one&#160;dimension is&#160;like&#160;a&#160;line;&#160;you can set&#160;boxes&#160;along&#160;the&#160;line&#160;<br/>that&#160;represent&#160;data.&#160;An array&#160;with&#160;two dimensions&#160;is&#160;like&#160;a&#160;grid with&#160;rows&#160;and columns&#160;of data.<br/>
Dim&#160;a(3)&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160;&#160;'One-dimensional array<br/>Dim&#160;b(3&#160;To&#160;5)&#160;As&#160;String&#160; &#160; &#160;&#160;'One-dimensional array<br/>Dim&#160;c(5,&#160;4)&#160;As&#160;Integer&#160; &#160; &#160; &#160;'Two-dimensional array<br/>Dim&#160;d(1&#160;To&#160;5,&#160;4)&#160;As&#160;Integer&#160;&#160;'Two-dimensional array<br/>
<i><b>&#160;5.1.&#160;Array()&#160;quickly&#160;builds&#160;a&#160;one-dimensional&#160;array&#160;with&#160;data<br/></b></i>Use&#160;the&#160;Array&#160;function to&#160;quickly&#160;build&#160;a&#160;Variant&#160;array&#160;with data.&#160;The&#160;Array&#160;function returns&#160;a&#160;Variant&#160;array&#160;<br/>that&#160;contains&#160;the&#160;arguments&#160;to&#160;the&#160;function.&#160;See<a href="libremacros.html#117">&#160;Listing 93.&#160;</a>This&#160;is&#160;an efficient&#160;method to&#160;create&#160;a&#160;Variant&#160;<br/>array&#160;containing a&#160;predefined set&#160;of values. One&#160;entry&#160;in the&#160;array&#160;is&#160;created&#160;for each argument.<br/>
Use&#160;the&#160;Array&#160;function to&#160;quickly&#160;generate&#160;an array&#160;that&#160;already&#160;has&#160;data.&#160;The&#160;following code&#160;creates&#160;an&#160;<br/>array&#160;with&#160;five&#160;elements,&#160;zero through four,&#160;and then&#160;individually&#160;initializes&#160;each element.<br/>
Dim&#160;v(4)<br/>v(0)&#160;=&#160;2&#160;:&#160;v(1)&#160;=&#160;&#34;help&#34;:&#160;v(2)&#160;=&#160;Now&#160;:&#160;v(3)&#160;=&#160;True&#160;:&#160;v(4)&#160;=&#160;3.5<br/>
This&#160;can be&#160;done&#160;in a&#160;much simpler manner.&#160;Constants&#160;can be&#160;used as&#160;arguments&#160;to&#160;functions.&#160;You aren’t&#160;<br/>always&#160;forced to&#160;assign a&#160;value&#160;to a&#160;variable&#160;so that&#160;you can call&#160;a&#160;function.<br/>
&#160;&#160;Dim&#160;v()<br/>&#160;&#160;Dim&#160;FirstName$&#160;:&#160;FirstName&#160;=&#160;&#34;Bob&#34;<br/>&#160;&#160;v()&#160;=&#160;Array(0,&#160;&#34;help&#34;,&#160;Now,&#160;True,&#160;3.5)<br/>&#160;&#160;Print&#160;Join(Array(&#34;help&#34;,&#160;3,&#160;&#34;Joe&#34;,&#160;Firstname))<br/>
The&#160;argument&#160;list&#160;is&#160;a&#160;comma-separated list&#160;of expressions,&#160;which can be&#160;of any&#160;type&#160;because&#160;each element&#160;<br/>in the&#160;returned array&#160;is&#160;a&#160;variant.&#160;<br/>
<i><b>Listing&#160;93.</b>&#160;The&#160;Array&#160;function&#160;returns&#160;a Variant&#160;array.</i><br/>
Dim&#160;vFirstNames&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'A Variant can reference an array<br/>Dim&#160;vAges()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'A Variant array can reference an array<br/>vFirstNames&#160;=&#160;Array(&#34;Tom&#34;,&#160;&#34;Rob&#34;)&#160;&#160;'Array contains strings<br/>vAges&#160;=&#160;Array(18,&#160;&#34;Ten&#34;)&#160; &#160; &#160; &#160; &#160; &#160;'Array contains a number and a string<br/>Print&#160;vAges(0)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'First element has the value 18<br/>
Variant&#160;variables&#160;can contain&#160;any&#160;type, including an array.&#160;I&#160;frequently&#160;use&#160;variant&#160;variables&#160;when I&#160;retrieve&#160;<br/>values&#160;from&#160;methods&#160;when I’m&#160;not&#160;certain&#160;of the&#160;return type. I&#160;then&#160;inspect&#160;the&#160;type&#160;and use&#160;it&#160;appropriately.&#160;<br/>This&#160;is&#160;a&#160;convenient&#160;use&#160;of the&#160;Variant&#160;variable&#160;type. Because&#160;a&#160;Variant&#160;variable&#160;can contain any&#160;type&#160;—&#160;<br/>including an array&#160;—&#160;each element&#160;in a&#160;Variant&#160;array&#160;can also contain an array.&#160;The&#160;code&#160;in<a href="libremacros.html#118">&#160;Table&#160;33&#160;<br/></a>demonstrates&#160;placing an array&#160;inside&#160;another array.&#160;The&#160;code&#160;in each column&#160;is&#160;roughly&#160;equivalent.<br/>
<b>TIP</b><br/>
Although user&#160;defined&#160;structures&#160;cannot&#160;contain arrays,&#160;they&#160;can contain a&#160;variant, which&#160;can contain an&#160;<br/>array.<br/>
One&#160;advantage&#160;of&#160;Variant&#160;arrays&#160;is&#160;that&#160;it’s&#160;possible&#160;to easily&#160;build collections&#160;of information&#160;of different&#160;<br/>types. For example,&#160;the&#160;item&#160;description&#160;(String), stock-tracking ID&#160;(Integer), and invoice&#160;amount&#160;(Double&#160;<br/>or Currency)&#160;can readily&#160;be&#160;stored as&#160;rows&#160;in&#160;an array,&#160;with&#160;each type&#160;of data&#160;stored in a&#160;single&#160;row&#160;for each&#160;<br/>customer.&#160;This&#160;allows&#160;array&#160;rows&#160;to&#160;behave&#160;more&#160;like&#160;rows&#160;in&#160;a&#160;database. Older programming languages&#160;<br/>required use&#160;of separately&#160;declared arrays&#160;for each data&#160;type, with added programming overhead of&#160;<br/>managing&#160;the&#160;use&#160;of multiple,&#160;related&#160;arrays&#160;of data.<br/>
114<br/>
<hr/>
<a name=118></a><i><b>Table&#160;33.</b>&#160;A&#160;Variant&#160;can contain an array,&#160;so these&#160;accomplish the&#160;same&#160;thing.</i><br/>
Dim&#160;v(1)<br/>
Dim&#160;v()<br/>
v(0)&#160;=&#160;Array(1,&#160;2,&#160;3)<br/>
v&#160;=&#160;Array(Array(1,&#160;2,&#160;3),_<br/>
v(1)&#160;=&#160;Array(&#34;one&#34;,&#160;&#34;two&#34;,&#160;&#34;three&#34;)<br/>
&#160; &#160; &#160;Array(&#34;one&#34;,&#160;&#34;two&#34;,&#160;&#34;three&#34;))<br/>
In&#160;OOo version&#160;1.x,&#160;to address&#160;an array&#160;containing&#160;an array,&#160;you had to&#160;first&#160;extract&#160;the&#160;contained&#160;array,&#160;and&#160;<br/>then subscript&#160;the&#160;contained array.&#160;Much of my&#160;existing code&#160;was&#160;written based on this.<br/>
<i><b>Listing&#160;94.</b>&#160;Cumbersome&#160;method to&#160;subscript&#160;an array&#160;in&#160;an array.<br/></i>&#160;&#160;v&#160;=&#160;Array(Array(1,&#160;2,&#160;3),&#160;Array(&#34;one&#34;,&#160;&#34;two&#34;,&#160;&#34;three&#34;))<br/>&#160;&#160;x&#160;=&#160;v(0)&#160; &#160; &#160; &#160; &#160;'This is very cumbersome.<br/>&#160;&#160;Print&#160;x(1)&#160; &#160; &#160; &#160;'Prints 2<br/>
Somewhere&#160;between version 2.x and 3.x, the&#160;obvious&#160;solution&#160;was&#160;introduced;&#160;you&#160;can directly&#160;access&#160;the&#160;<br/>contained array.&#160;This&#160;is&#160;particularly&#160;useful&#160;while&#160;using data&#160;arrays&#160;returned by&#160;Calc&#160;containing cell&#160;data.&#160;<br/>
<i><b>Listing&#160;95.</b>&#160;In OOo 3.x, you no longer&#160;need to extract&#160;the&#160;contained&#160;array&#160;to&#160;use&#160;it.<br/></i>Sub&#160;ArrayInArray<br/>&#160; Dim&#160;v() :&#160;v&#160;= Array(Array(1,&#160;2,&#160;3), Array(&#34;one&#34;,&#160;&#34;two&#34;,&#160;&#34;three&#34;))<br/>&#160; Print&#160;v(0)(1)<br/>End Sub<br/>
Although it’s&#160;easy&#160;to&#160;create&#160;an array&#160;inside&#160;of an array,&#160;it’s&#160;typically&#160;easier to&#160;use&#160;an array&#160;with&#160;multiple&#160;<br/>dimensions, as&#160;shown i<a href="libremacros.html#118">n&#160;Listing&#160;96.&#160;</a>The&#160;“array&#160;of arrays”&#160;construction is&#160;sometimes&#160;useful,&#160;if there&#160;is&#160;an&#160;<br/>obvious&#160;relationship&#160;with the&#160;natural&#160;organization of the&#160;data.&#160;Generally,&#160;it&#160;is&#160;best&#160;to&#160;select&#160;a&#160;way&#160;to organize<br/>the&#160;data&#160;that&#160;has&#160;the&#160;most&#160;direct,&#160;natural, and memorable&#160;relationship to&#160;how&#160;it&#160;is&#160;produced, used, and&#160;<br/>manipulated.<br/>
<i><b>Listing&#160;96.</b>&#160;It&#160;is&#160;easier&#160;to&#160;use&#160;multi-dimensioned arrays&#160;than&#160;arrays&#160;inside&#160;of&#160;arrays.</i><br/>
Dim&#160;v(0&#160;To&#160;1,&#160;0&#160;To&#160;2)<br/>v(0,&#160;0)&#160;=&#160;1&#160; &#160; &#160;:&#160;v(0,&#160;1)&#160;=&#160;2&#160; &#160; &#160;:&#160;v(0,&#160;2)&#160;=&#160;3<br/>v(1,&#160;0)&#160;=&#160;&#34;one&#34;&#160;:&#160;v(1,&#160;1)&#160;=&#160;&#34;two&#34;&#160;:&#160;v(1,&#160;2)&#160;=&#160;&#34;three&#34;<br/>Print&#160;v(0,&#160;1)&#160; &#160;'prints 2<br/>
A&#160;Variant&#160;array&#160;can be&#160;assigned to&#160;any&#160;other array,&#160;regardless&#160;of its&#160;declared type.&#160;Assigning one&#160;array&#160;to&#160;<br/>another causes&#160;one&#160;array&#160;to reference&#160;the&#160;other;&#160;they&#160;become&#160;the&#160;same&#160;array.&#160;As&#160;mentioned&#160;earlier,&#160;this&#160;is&#160;a&#160;<br/>bad idea.&#160;This&#160;is&#160;considered a&#160;bug&#160;and it&#160;may&#160;not&#160;be&#160;allowed in later versions&#160;of OOo Basic. Use&#160;the&#160;Array&#160;<br/>function and enjoy&#160;the&#160;flexibility,&#160;but&#160;assign the&#160;returned&#160;Variant&#160;array&#160;to&#160;either a&#160;Variant&#160;or a&#160;Variant&#160;array.<br/>
<i><b>Listing&#160;97.</b>&#160;Assign&#160;an string&#160;array&#160;to&#160;an integer&#160;array.<br/></i>Sub&#160;BadArrayTypes<br/>&#160;&#160;Dim&#160;a(0&#160;To&#160;1)&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;b(0&#160;To&#160;1)&#160;As&#160;String<br/>&#160;&#160;b(0)&#160;=&#160;&#34;zero&#34;:&#160;b(1)&#160;=&#160;&#34;one&#34;<br/>&#160;&#160;a()&#160;=&#160;b()<br/>&#160;&#160;Print&#160;a(0)<br/>End&#160;Sub<br/>
115<br/>
<hr/>
<a name=119></a><b>TIP</b><br/>
Assigning&#160;a&#160;Variant&#160;array&#160;to variables&#160;declared as a&#160;non-Variant&#160;array&#160;is&#160;ill-advised.&#160;For&#160;example,&#160;after&#160;an&#160;<br/>
Integer&#160;array&#160;has been assigned&#160;to reference&#160;a&#160;Variant&#160;array,&#160;it’s&#160;possible&#160;to assign non-integer&#160;values to&#160;<br/>elements&#160;in&#160;the&#160;array.&#160;References to the&#160;array&#160;won’t&#160;return&#160;the&#160;expected values due&#160;to the&#160;mismatch&#160;<br/>
between Integer&#160;and&#160;Variant&#160;data&#160;types.<br/>
&#160;&#160;Dim&#160;a(0&#160;To&#160;4)&#160;As&#160;Integer&#160;&#160;' Create an array of Integers.<br/>&#160;&#160;a(2)&#160;=&#160;&#34;Tom&#34; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' Assign a string to an Integer variable.<br/>&#160;&#160;Print&#160;a(2)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' 0, because the string is converted to zero.<br/>&#160;&#160;a()&#160;=&#160;Array(4,&#160;&#34;Bob&#34;,&#160;7)&#160;&#160;' Array always returns a variant array.<br/>&#160;&#160;a(2)&#160;=&#160;&#34;Tom&#34; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' a() is now a variant.<br/>&#160;&#160;Print&#160;a(2)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' Tom<br/>
<i><b>&#160;5.2.&#160;DimArray&#160;creates&#160;empty&#160;multi-dimensional&#160;arrays<br/></b></i>The&#160;DimArray&#160;function&#160;creates&#160;and returns&#160;a&#160;dimensioned&#160;Variant&#160;array.&#160;This&#160;allows&#160;the&#160;dimensions&#160;of the&#160;<br/>array&#160;to&#160;be&#160;determined at&#160;run time.&#160;The&#160;arguments&#160;specify&#160;the&#160;dimensions&#160;of the&#160;array;&#160;each argument&#160;<br/>specifies&#160;one&#160;dimension.&#160;If&#160;no arguments&#160;are&#160;present,&#160;an empty&#160;array&#160;is&#160;created.<br/>
The&#160;primary&#160;use&#160;of the&#160;DimArray&#160;statement&#160;is&#160;to&#160;create&#160;an empty,&#160;dimensioned&#160;Variant&#160;array.&#160;If&#160;you know&#160;<br/>the&#160;size&#160;of the&#160;array&#160;that&#160;you&#160;will&#160;need, you&#160;can declare&#160;it&#160;when you&#160;declare&#160;the&#160;variable. If&#160;you&#160;don’t&#160;know&#160;<br/>the&#160;size, and if a&#160;Variant&#160;array&#160;is&#160;acceptable,&#160;then you can create&#160;the&#160;empty,&#160;dimensioned array&#160;at&#160;run time.<br/>
<i><b>Listing&#160;98.</b>&#160;DimArray&#160;returns&#160;a dimensioned&#160;Variant&#160;array&#160;that&#160;contains&#160;no data.</i><br/>
i%&#160;=&#160;7<br/>v&#160;=&#160;DimArray(3*i%)&#160; &#160;'Same as Dim v(0 To 21)<br/>v&#160;=&#160;DimArray(i%,&#160;4)&#160;&#160;'Same as Dim v(0 To 7, 0 To 4)<br/>
The&#160;code&#160;in<a href="libremacros.html#119">&#160;Listing 98&#160;doe</a>s&#160;not&#160;show&#160;how&#160;the&#160;variable&#160;v is&#160;declared.&#160;This&#160;works&#160;equally&#160;well&#160;if v is&#160;declared<br/>as&#160;a&#160;Variant, or a&#160;Variant&#160;array.&#160;The&#160;argument&#160;list&#160;is&#160;a&#160;comma-separated list&#160;of expressions. Each expression&#160;<br/>is&#160;rounded to an integer and used to set&#160;the&#160;range&#160;of one&#160;dimension&#160;of the&#160;returned array.<br/>
Dim&#160;a&#160;As&#160;Variant<br/>Dim&#160;v()<br/>Dim&#160;i&#160;As&#160;Integer<br/>i&#160;=&#160;2<br/>a&#160;=&#160;DimArray(3)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Same as Dim a(0 To 3)<br/>a&#160;=&#160;DimArray(1+i,&#160;2*i)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Same as Dim a(0 To 3, 0 To 4)<br/>
v()&#160;&#160;=&#160;DimArray(1)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Same as Dim v(0 To 1)<br/>v(0)&#160;=&#160;Array(1,&#160;2,&#160;3)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Oh no, not this again!<br/>v(1)&#160;=&#160;Array(&#34;one&#34;,&#160;&#34;two&#34;,&#160;&#34;three&#34;)&#160; &#160; &#160;&#160;'You can do it, but yuck!<br/>
v&#160;=&#160;DimArray(1,&#160;2)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Now that makes more sense!<br/>v(0,&#160;0)&#160;=&#160;1&#160; &#160; &#160;:&#160;v(0,&#160;1)&#160;=&#160;2&#160; &#160; &#160;:&#160;v(0,&#160;2)&#160;=&#160;3<br/>v(1,&#160;0)&#160;=&#160;&#34;one&#34;&#160;:&#160;v(1,&#160;1)&#160;=&#160;&#34;two&#34;&#160;:&#160;v(1,&#160;2)&#160;=&#160;&#34;three&#34;<br/>Print&#160;v(0,&#160;1)&#160; &#160;'prints 2<br/>
<b>TIP</b><br/>
Option Base&#160;1 has&#160;no effect&#160;on&#160;the&#160;dimensions&#160;of&#160;the&#160;array&#160;returned&#160;by&#160;the&#160;DimArray&#160;function.&#160;For&#160;each&#160;<br/>dimension, the&#160;lower&#160;bound of&#160;the&#160;range&#160;is&#160;always zero&#160;and the&#160;upper&#160;bound&#160;is the&#160;rounded&#160;integer&#160;value&#160;of<br/>
the&#160;relevant&#160;expression.<br/>
116<br/>
<hr/>
<a name=120></a><i><b>&#160;5.3.&#160;Change&#160;the&#160;dimension&#160;of&#160;an&#160;array<br/></b></i>Use&#160;ReDim&#160;to change&#160;the&#160;dimensions&#160;of an existing array&#160;by&#160;using the&#160;same&#160;syntax&#160;as&#160;the&#160;DIM&#160;statement.&#160;<br/>Increasing the&#160;dimension&#160;of an array&#160;while&#160;using the&#160;keyword Preserve&#160;preserves&#160;all&#160;of the&#160;data,&#160;but&#160;<br/>decreasing the&#160;dimension&#160;causes&#160;data&#160;to be&#160;lost&#160;by&#160;truncation.&#160;Unlike&#160;some&#160;variants&#160;of BASIC, OOo Basic&#160;<br/>allows&#160;all&#160;dimensions&#160;of an array&#160;to be&#160;changed while&#160;also preserving data.<br/>
The&#160;primary&#160;use&#160;of the&#160;ReDim&#160;statement&#160;is&#160;to change&#160;the&#160;dimension of an existing array.&#160;If&#160;you&#160;know&#160;the&#160;<br/>size&#160;of the&#160;array&#160;that&#160;you will&#160;need, you can declare&#160;it&#160;when you declare&#160;the&#160;variable.&#160;If&#160;you don’t&#160;know&#160;the&#160;<br/>size&#160;ahead of time,&#160;you&#160;can declare&#160;the&#160;array&#160;with any&#160;size,&#160;including as&#160;an empty&#160;array,&#160;and then change&#160;the&#160;<br/>dimension when you know&#160;it.<br/>
Dim&#160;v()&#160;As&#160;Integer<br/>Dim&#160;x(4)&#160;As&#160;Integer<br/>i%&#160;=&#160;7<br/>ReDim&#160;v(3*i%)&#160;As&#160;Integer&#160; &#160; &#160; &#160;'Same as Dim v(0 To 21) As Integer.<br/>ReDim&#160;x(i%,&#160;1&#160;To&#160;4)&#160;As&#160;Integer&#160;'Same as Dim x(0 To 7, 1 To 4).<br/>
The&#160;ReDim&#160;statement&#160;changes&#160;the&#160;dimension&#160;of an existing array,&#160;even an empty&#160;one. ReDim&#160;specifies&#160;both&#160;<br/>the&#160;dimensions&#160;and the&#160;type.&#160;The&#160;type&#160;specified&#160;with the&#160;ReDim&#160;statement&#160;must&#160;match the&#160;type&#160;specified&#160;<br/>when the&#160;variable&#160;is&#160;declared. If&#160;the&#160;types&#160;differ,&#160;you’ll&#160;see&#160;the&#160;compile-time&#160;error “Variable&#160;already&#160;<br/>defined.”<br/>
Dim&#160;a()&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Empty Integer Array.<br/>Dim&#160;v(8)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Variant array with nine entries.<br/>ReDim&#160;v()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'v() is a valid empty array.<br/>ReDim&#160;a(2&#160;To&#160;4,&#160;5)&#160;As&#160;Integer&#160;'a() is a two-dimensional array.<br/>
The&#160;DimArray&#160;function&#160;creates&#160;and returns&#160;a&#160;dimensioned&#160;Variant&#160;array&#160;that&#160;contains&#160;no data.&#160;This&#160;is&#160;not&#160;<br/>useful&#160;if you&#160;require&#160;an array&#160;of a&#160;specific&#160;type, or if&#160;you&#160;simply&#160;need to change&#160;the&#160;dimensions&#160;of an&#160;<br/>existing array&#160;while&#160;preserving data.&#160;The&#160;ReDim&#160;statement&#160;changes&#160;the&#160;dimensions&#160;of an existing&#160;array&#160;with&#160;<br/>the&#160;option of preserving existing&#160;data.&#160;You can use&#160;the&#160;ReDim&#160;statement&#160;to&#160;change&#160;a&#160;dimensioned array&#160;to&#160;an<br/>empty&#160;array.<br/>
The&#160;subroutine&#160;in<a href="libremacros.html#120">&#160;Listing 99&#160;c</a>ontains&#160;many&#160;examples&#160;of the&#160;ReDim&#160;statement&#160;using&#160;the&#160;keyword Preserve<a href="libremacros.html#121">.<br/>Figure&#160;43&#160;s</a>hows&#160;the&#160;results&#160;of these&#160;commands.<br/>
<i><b>Listing&#160;99.</b>&#160;Use&#160;ReDim&#160;with&#160;Preserve&#160;to change&#160;dimension and preserve&#160;data.</i><br/>
Sub&#160;ExampleReDimPreserve<br/>&#160;&#160;Dim&#160;a(5)&#160;As&#160;Integer&#160; &#160; &#160;'A dimensioned array, 0 To 5<br/>&#160;&#160;Dim&#160;b()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'An empty array of type Variant<br/>&#160;&#160;Dim&#160;c()&#160;As&#160;Integer&#160; &#160; &#160;&#160;'An empty array of type Integer<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'The string that accumulates the output text<br/>
&#160;&#160;REM a is dimensioned from 0 to 5 where a(i) = i<br/>&#160;&#160;a(0)&#160;=&#160;0&#160;:&#160;a(1)&#160;=&#160;1&#160;:&#160;a(2)&#160;=&#160;2&#160;:&#160;a(3)&#160;=&#160;3&#160;:&#160;a(4)&#160;=&#160;4&#160;:&#160;a(5)&#160;=&#160;5<br/>&#160;&#160;s$&#160;=&#160;&#34;a() at start = &#34;&#160;&amp;&#160;Join(a())&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;REM a is dimensioned from 1 to 3 where a(i) = i<br/>&#160;&#160;ReDim&#160;Preserve&#160;a(1&#160;To&#160;3)&#160;As&#160;Integer<br/>&#160;&#160;s$&#160;=&#160;s$&#160;&amp;&#160;&#34;ReDim Preserve a(1 To 3) = &#34;&#160;&amp;&#160;&#160;Join(a())&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160;&#160;ReDim&#160;a()&#160;As&#160;Integer<br/>&#160;&#160;s$&#160;=&#160;s$&#160;&amp;&#160;&#34;ReDim a() has LBound = &#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160;LBound(a())&#160;&amp;&#160;&#34; UBound = &#34;&#160;&amp;&#160;UBound(a())&#160;&amp;&#160;CHR$(10)<br/>
117<br/>
<hr/>
<a name=121></a>&#160;&#160;REM Array() returns a Variant type<br/>&#160;&#160;Rem b is dimensioned from 0 to 9 where b(i) = i+1<br/>&#160;&#160;b&#160;=&#160;Array(1,&#160;2,&#160;3,&#160;4,&#160;5,&#160;6,&#160;7,&#160;8,&#160;9,&#160;10)<br/>&#160;&#160;s$&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;b() at start = &#34;&#160;&amp;&#160;Join(b())&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;REM b is dimensioned from 1 to 3 where b(i) = i+1<br/>&#160;&#160;Dim&#160;il%,&#160;iu%<br/>&#160;&#160;il&#160;=&#160;1&#160;:&#160;iu&#160;=&#160;3<br/>&#160;&#160;ReDim&#160;Preserve&#160;b(il&#160;To&#160;iu)<br/>&#160;&#160;s$&#160;=&#160;s$&#160;&amp;&#160;&#34;ReDim Preserve b(1 To 3) = &#34;&#160;&amp;&#160;&#160;Join(b())&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160;&#160;ReDim&#160;b(-5&#160;To&#160;5)<br/>&#160;&#160;s$&#160;=&#160;s$&#160;&amp;&#160;&#34;ReDim b(-5 To 5) = &#34;&#160;&amp;&#160;&#160;Join(b())&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s$&#160;=&#160;s$&#160;&amp;&#160;&#34;ReDim b(-5 To 5) has LBound = &#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160;LBound(b())&#160;&amp;&#160;&#34; UBound = &#34;&#160;&amp;&#160;UBound(b())&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160;&#160;ReDim&#160;b(-5&#160;To&#160;5,&#160;2&#160;To&#160;4)<br/>&#160;&#160;s$&#160;=&#160;s$&#160;&amp;&#160;&#34;ReDim b(-5 To 5, 2 To 4) has dimension 1 LBound = &#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160;LBound(b())&#160;&amp;&#160;&#34; UBound = &#34;&#160;&amp;&#160;UBound(b())&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s$&#160;=&#160;s$&#160;&amp;&#160;&#34;ReDim b(-5 To 5, 2 To 4) has dimension 2 LBound = &#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160;LBound(b(),&#160;2)&#160;&amp;&#160;&#34; UBound = &#34;&#160;&amp;&#160;UBound(b(),&#160;2)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160;&#160;MsgBox&#160;s$,&#160;0,&#160;&#34;ReDim Examples&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;43.</b>&#160;Use&#160;ReDim&#160;to change&#160;the&#160;dimensions&#160;of&#160;an array.</i><br/>
<i><b>&#160;5.4.&#160;Array&#160;to&#160;String&#160;and&#160;back&#160;again<br/></b></i>Just&#160;as&#160;it’s&#160;common to&#160;convert&#160;an array&#160;of values&#160;into a&#160;single&#160;string for display,&#160;it&#160;is&#160;also common to&#160;split&#160;a&#160;<br/>string into multiple&#160;pieces. OOo Basic&#160;provides&#160;these&#160;abilities&#160;with&#160;the&#160;functions&#160;Join and Split.<br/>
The&#160;first&#160;argument&#160;to the&#160;Join function&#160;is&#160;a&#160;one-dimensional&#160;array.&#160;Any&#160;other dimension causes&#160;a&#160;run-time&#160;<br/>error.&#160;The&#160;elements&#160;in the&#160;array&#160;are&#160;concatenated with&#160;an optional&#160;delimiter string between each element.&#160;<br/>The&#160;default&#160;delimiter is&#160;a&#160;single&#160;space.<br/>
Join(Array(1,&#160;2,&#160;3))&#160; &#160; &#160; &#160;'1 2 3 &#160;using the default delimiter<br/>Join(Array(1,&#160;2,&#160;3),&#160;&#34;X&#34;)&#160;&#160;'1X2X3 &#160;specifying a delimiter<br/>Join(Array(1,&#160;2,&#160;3),&#160;&#34;&#34;)&#160; &#160;'123 &#160; &#160;specifying an empty delimiter<br/>
118<br/>
<hr/>
<a name=122></a>The&#160;Split&#160;function returns&#160;a&#160;Variant&#160;array&#160;of strings, created by&#160;breaking a&#160;string into multiple&#160;strings&#160;based&#160;<br/>on a&#160;delimiter.&#160;In&#160;other words, it&#160;parses&#160;a&#160;string into&#160;pieces&#160;with one&#160;command.&#160;The&#160;delimiter separates&#160;<br/>portions&#160;of the&#160;string. For&#160;example, the&#160;delimiter “XY”&#160;splits&#160;“12XY11XY22”&#160;into the&#160;strings&#160;(“12”, “11”,&#160;<br/>“22”).&#160;The&#160;delimiter defaults&#160;to&#160;a&#160;space&#160;but&#160;can be&#160;any&#160;string expression&#160;with length greater than&#160;zero.<br/>
Split(&#34;1 2 3&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160;'return Array(&#34;1&#34;, &#34;2&#34;, &#34;3&#34;) split on &#34; &#34;<br/>Split(&#34;1, 2, 3&#34;,&#160;&#34;, &#34;)&#160; &#160; &#160;'return Array(&#34;1&#34;, &#34;2&#34;, &#34;3&#34;) split on &#34;, &#34;<br/>
The&#160;optional&#160;third argument&#160;is&#160;used to&#160;limit&#160;the&#160;size&#160;of the&#160;returned array.&#160;This&#160;is&#160;used only&#160;to limit&#160;the&#160;<br/>returned size&#160;and has&#160;no effect&#160;if the&#160;returned size&#160;is&#160;less&#160;than&#160;the&#160;limit.&#160;For example, the&#160;4 in&#160;<br/>Split(“1X2X3”, “X”, 4) has&#160;no effect&#160;because&#160;the&#160;returned array&#160;has&#160;only&#160;three&#160;elements. If&#160;the&#160;size&#160;is&#160;<br/>limited,&#160;however,&#160;the&#160;last&#160;element&#160;in the&#160;array&#160;contains&#160;the&#160;remainder of the&#160;unparsed string.<br/>
Split(&#34;1, 2, 3&#34;,&#160;&#34;, &#34;,&#160;2)&#160;&#160;'return Array(&#34;1&#34;, &#34;2, 3&#34;) split on &#34;, &#34;<br/>
<b>TIP</b><br/>
The&#160;second argument&#160;to&#160;Split&#160;is&#160;a&#160;string, so, OOo&#160;automatically&#160;converts it&#160;to a&#160;string.&#160;The&#160;statement&#160;<br/>Split(“0&#160;1 2&#160;3”,&#160;2)&#160;converts&#160;the&#160;2&#160;to a&#160;string&#160;and uses it&#160;as the&#160;delimiter.&#160;The&#160;returned&#160;array&#160;contains two&#160;<br/>
elements, “0&#160;1 ”&#160;and&#160;“&#160;3”.&#160;You must&#160;specify&#160;the&#160;delimiter&#160;if&#160;you want&#160;to specify&#160;the&#160;number&#160;of&#160;strings&#160;<br/>returned.&#160;The&#160;correct&#160;format&#160;is&#160;Split(“0 1&#160;2 3”,&#160;“&#160;”,&#160;2).<br/>
The&#160;Split&#160;function assumes&#160;that&#160;a&#160;string comes&#160;before&#160;and after each delimiter,&#160;even if the&#160;string has&#160;length&#160;<br/>zero.<br/>
Split(&#34;X1XX2X&#34;,&#160;&#34;X&#34;)&#160;=&#160;(&#34;&#34;,&#160;&#34;1&#34;,&#160;&#34;&#34;,&#160;&#34;2&#34;,&#160;&#34;&#34;)<br/>
The&#160;first&#160;returned string is&#160;empty&#160;because&#160;the&#160;first&#160;argument&#160;contains&#160;a&#160;leading delimiter.&#160;Two consecutive&#160;<br/>delimiters&#160;produce&#160;an empty&#160;string between the&#160;“1”&#160;and the&#160;the&#160;“2”. Finally,&#160;the&#160;trailing string&#160;is&#160;empty&#160;<br/>because&#160;there&#160;is&#160;a&#160;trailing&#160;delimiter.<br/>
The&#160;Split&#160;function is&#160;almost&#160;the&#160;inverse&#160;of the&#160;Join&#160;function.&#160;The&#160;Join&#160;function can use&#160;a&#160;zero-length string&#160;<br/>as&#160;the&#160;delimiter,&#160;but&#160;the&#160;Split&#160;function&#160;cannot.&#160;If&#160;the&#160;joined string contains&#160;the&#160;delimiter,&#160;splitting the&#160;string&#160;<br/>will&#160;produce&#160;a&#160;different&#160;set&#160;of strings. For example,&#160;joining “a&#160;b”&#160;and “c”&#160;with a&#160;space&#160;produces&#160;“a&#160;b c”.&#160;<br/>Splitting this&#160;with a&#160;space&#160;produces&#160;(“a”, “b”, “c”), which&#160;is&#160;not&#160;the&#160;original&#160;set&#160;of strings.<br/>
I&#160;spent&#160;a&#160;lot&#160;of time&#160;writing and debugging a&#160;macro to&#160;parse&#160;through a&#160;string to&#160;remove&#160;all&#160;occurrences&#160;of the<br/>text&#160;“Sbx”.&#160;Using Split&#160;and Join&#160;is&#160;significantly&#160;smaller and faster:<br/>
Join(Split(s,&#160;&#34;Sbx&#34;),&#160;&#34;&#34;)<br/>
<i><b>&#160;5.5.&#160;Array&#160;inspection&#160;functions<br/></b></i>The&#160;most&#160;fundamental&#160;thing to ask about&#160;an array&#160;is&#160;whether or not&#160;it&#160;really&#160;is&#160;an array.&#160;The&#160;IsArray&#160;function<br/>returns&#160;True&#160;if the&#160;argument&#160;is&#160;an array,&#160;and False&#160;otherwise.&#160;Use&#160;the&#160;LBound and UBound functions&#160;to&#160;<br/>determine&#160;the&#160;lower and upper bounds&#160;of an array.&#160;An array&#160;is&#160;empty&#160;if the&#160;upper bound is&#160;less&#160;than&#160;the&#160;<br/>lower bound.&#160;<br/>
The&#160;first&#160;argument&#160;to LBound and UBound is&#160;the&#160;array&#160;to check.&#160;The&#160;second optional&#160;argument&#160;is&#160;an integer&#160;<br/>expression specifying which&#160;dimension&#160;is&#160;returned.&#160;The&#160;default&#160;value&#160;is&#160;1, which returns&#160;the&#160;lower bound of&#160;<br/>the&#160;first&#160;dimension.<br/>
Dim&#160;a()<br/>Dim&#160;b(2&#160;to&#160;3,&#160;-5&#160;To&#160;5)<br/>Print&#160;LBound(a())&#160; &#160;' 0<br/>Print&#160;UBound(a())&#160; &#160;'-1 because the array is empty<br/>Print&#160;LBound(b())&#160; &#160;' 2 no optional second argument so defaults to 1<br/>Print&#160;LBound(b(),1)&#160;' 2 optional second argument specifies first dimension<br/>
119<br/>
<hr/>
<a name=123></a>Print&#160;UBound(b(),2)&#160;' 5<br/>
If&#160;the&#160;value&#160;of the&#160;second argument&#160;doesn’t&#160;contain&#160;a&#160;valid value,&#160;if it’s&#160;greater than&#160;the&#160;number of&#160;<br/>dimensions, or if it’s&#160;less&#160;than&#160;1, a&#160;run-time&#160;error occurs.&#160;<br/>
<i><b>Listing&#160;100.</b>&#160;SafeUBound will&#160;not&#160;generate&#160;an error.<br/></i>Function&#160;SafeUBound(v,&#160;Optional&#160;n)&#160;As&#160;Integer<br/>&#160;&#160;SafeUBound&#160;=&#160;-1&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'If an error occurs, this is already set<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;BadArrayFound&#160;&#160;'On error skip to the end<br/>&#160;&#160;If&#160;IsMissing(n)&#160;Then&#160; &#160; &#160; &#160; &#160;'Was the optional argument used?<br/>&#160; &#160;&#160;SafeUBound&#160;=&#160;UBound(v)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;SafeUBound&#160;=&#160;UBound(v,&#160;n)&#160;&#160;'Optional argument is present<br/>&#160;&#160;End&#160;If<br/>BadArrayFound:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Jump here on error<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;0&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Turn off this error handler<br/>End&#160;Function<br/>
The&#160;macro i<a href="libremacros.html#123">n&#160;Listing&#160;100&#160;prope</a>rly&#160;returns&#160;-1 if an error occurs.&#160;The&#160;proper value&#160;is&#160;returned for invalid&#160;<br/>empty&#160;arrays, but&#160;it&#160;also returns&#160;-1 if the&#160;first&#160;argument&#160;isn’t&#160;an array&#160;or if the&#160;second argument&#160;is&#160;simply&#160;too&#160;<br/>large.&#160;The&#160;ArrayInfo function&#160;i<a href="libremacros.html#123">n&#160;Listing&#160;101&#160;us</a>es&#160;a&#160;similar technique&#160;to return array&#160;information about&#160;a&#160;<br/>variable.&#160;Also&#160;see<a href="libremacros.html#125">&#160;Figure&#160;44.</a><br/>
<i><b>Listing&#160;101.</b>&#160;Print&#160;information&#160;about&#160;an array.<br/></i>REM If the first argument is an array, the dimensions are determined.<br/>REM Special care is given to an empty array that was created using DimArray<br/>REM or Array.<br/>REM a &#160; &#160; : Variable to check<br/>REM sName : Name of the variable for a better looking string<br/>Function&#160;arrayInfo(a,&#160;sName$)&#160;As&#160;String<br/>
&#160;&#160;REM First, verify that:<br/>&#160;&#160;REM the variable is not NULL, an empty Object<br/>&#160;&#160;REM the variable is not EMPTY, an uninitialized Variant<br/>&#160;&#160;REM the variable is an array.<br/>&#160;&#160;If&#160;IsNull(a)&#160;Then&#160;<br/>&#160; &#160;&#160;arrayInfo&#160;=&#160;&#34;Variable &#34;&#160;&amp;&#160;sName&#160;&amp;&#160;&#34; is Null&#34;<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;IsEmpty(a)&#160;Then&#160;<br/>&#160; &#160;&#160;arrayInfo&#160;=&#160;&#34;Variable &#34;&#160;&amp;&#160;sName&#160;&amp;&#160;&#34; is Empty&#34;<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;Not&#160;IsArray(a)&#160;Then<br/>&#160; &#160;&#160;arrayInfo&#160;=&#160;&#34;Variable &#34;&#160;&amp;&#160;sName&#160;&amp;&#160;&#34; is not an array&#34;<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM The variable is an array, so get ready to work<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Build the return value in s<br/>&#160;&#160;Dim&#160;iCurDim&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160;'Current dimension<br/>&#160;&#160;Dim&#160;i%,&#160;j%&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Hold the LBound and UBound values<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;BadDimension&#160; &#160; &#160; &#160;'Set up the error handler<br/>&#160;&#160;iCurDim&#160;=&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Ready to check the first dimension<br/>
120<br/>
<hr/>
<a name=124></a>&#160;&#160;REM Initial pretty return string<br/>&#160;&#160;s&#160;=&#160;&#34;Array dimensioned as &#34;&#160;&amp;&#160;sName$&#160;&amp;&#160;&#34;(&#34;<br/>&#160;&#160;<br/>&#160;&#160;Do&#160;While&#160;True&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Loop forever<br/>&#160;&#160;<br/>&#160; &#160;&#160;i&#160;=&#160;LBound(a(),&#160;iCurDim)&#160; &#160; &#160; &#160; &#160;'Error if dimension is too large or<br/>&#160; &#160;&#160;j&#160;=&#160;UBound(a(),&#160;iCurDim)&#160; &#160; &#160; &#160; &#160;'if invalid empty array<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;If&#160;i&#160;&gt;&#160;j&#160;Then&#160;Exit&#160;Do&#160; &#160; &#160; &#160; &#160; &#160;&#160;'If empty array then get out<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;If&#160;iCurDim&#160;&gt;&#160;1&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;, &#34;&#160;'Separate dimensions with a comma<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;i&#160;&amp;&#160;&#34; To &#34;&#160;&amp;&#160;j&#160; &#160; &#160; &#160; &#160; &#160;'Add in the current dimensions<br/>&#160; &#160;&#160;iCurDim&#160;=&#160;iCurDim&#160;+&#160;1&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Check the next dimension<br/>&#160;&#160;Loop<br/>&#160;&#160;<br/>&#160;&#160;REM Only arrive here if the array is a valid empty array.<br/>&#160;&#160;REM Otherwise, an error occurs when the dimension is too<br/>&#160;&#160;REM large and a jump is made to the error handler<br/>&#160;&#160;REM Include the type as returned from the TypeName function.<br/>&#160;&#160;REM The type name includes a trailing &#34;()&#34; so remove this<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;) As &#34;&#160;&amp;&#160;Left(TypeName(a),&#160;LEN(TypeName(a))-2)<br/>&#160;&#160;arrayInfo&#160;=&#160;s<br/>&#160;&#160;Exit&#160;Function&#160;&#160;<br/>&#160; &#160;<br/>BadDimension:<br/>&#160;&#160;REM Turn off the error handler<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;0&#160;<br/>&#160;&#160;<br/>&#160;&#160;REM Include the type as returned from the TypeName function.<br/>&#160;&#160;REM The type name includes a trailing &#34;()&#34; so remove this<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;) As &#34;&#160;&amp;&#160;Left(TypeName(a),&#160;LEN(TypeName(a))-2)<br/>&#160;&#160;<br/>&#160;&#160;REM If errored out on the first dimension then this must<br/>&#160;&#160;REM be an invalid empty array.<br/>&#160;&#160;If&#160;iCurDim&#160;=&#160;1&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; *** INVALID Empty Array&#34;<br/>&#160;&#160;arrayInfo&#160;=&#160;s<br/>End&#160;Function<br/>
Sub&#160;UseArrayInfo<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer,&#160;v<br/>&#160;&#160;Dim&#160;ia(1&#160;To&#160;3)&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;sa()&#160;As&#160;Single<br/>&#160;&#160;Dim&#160;m(3,&#160;4,&#160;-4&#160;To&#160;-1)<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;arrayInfo(i,&#160;&#34;i&#34;)&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160; &#160; &#160; &#160;'Not an array<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;arrayInfo(v,&#160;&#34;v&#34;)&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160; &#160; &#160; &#160;'Empty variant<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;arrayInfo(sa(),&#160;&#34;sa&#34;)&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160; &#160;'Empty array<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;arrayInfo(Array(),&#160;&#34;Array&#34;)&#160;&amp;&#160;CHR$(10)&#160;'BAD empty array<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;arrayInfo(ia(),&#160;&#34;ia&#34;)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;arrayInfo(m(),&#160;&#34;m&#34;)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Array Info&#34;<br/>
121<br/>
<hr/>
<a name=125></a>End&#160;Sub<br/>
<i><b>Figure&#160;44.</b>&#160;Use&#160;proper&#160;error&#160;handling&#160;to&#160;determine&#160;the&#160;dimension&#160;of&#160;the&#160;array.</i><br/>
An array&#160;with&#160;one&#160;dimension may&#160;have&#160;an upper bound that&#160;is&#160;less&#160;than&#160;the&#160;lower bound.&#160;This&#160;indicates&#160;that&#160;<br/>the&#160;array&#160;has&#160;no allocated spots&#160;for data.&#160;This&#160;is&#160;different&#160;than&#160;an array&#160;that&#160;has&#160;data&#160;locations&#160;allocated&#160;but&#160;<br/>no data&#160;has&#160;been saved in them. For most&#160;data&#160;types, such as&#160;Integer,&#160;if space&#160;is&#160;allocated&#160;for an integer,&#160;then<br/>it&#160;has&#160;a&#160;value.&#160;<br/>
Dim&#160;a(3)&#160;As&#160;Integer&#160;'This array has four integer values, they are all zero<br/>Dim&#160;b(3)&#160; &#160; &#160; &#160; &#160; &#160;&#160;'This array has four Variants, they are all Empty<br/>Dim&#160;c()&#160; &#160; &#160; &#160; &#160; &#160; &#160;'This array has one dimension and no space Ubound &lt; Lbound<br/>v&#160;=&#160;Array()&#160; &#160; &#160; &#160; &#160;'This array has zero dimensions.<br/>
<i><b>&#160;5.6.&#160;Conclusion<br/></b></i>Array&#160;handling&#160;in&#160;OOo Basic&#160;is&#160;very&#160;flexible.&#160;You have&#160;the&#160;ability&#160;to inspect&#160;arrays&#160;and to change&#160;their&#160;<br/>dimensions. Using the&#160;Variant&#160;type&#160;in OOo Basic&#160;provides&#160;a&#160;great&#160;deal&#160;of flexibility&#160;for creating collections&#160;<br/>of related&#160;data&#160;of different&#160;types. Strings&#160;and arrays&#160;are&#160;related;&#160;string arrays&#160;can be&#160;processed with&#160;Join and&#160;<br/>Split&#160;functions, permitting&#160;the&#160;creation&#160;of compact&#160;code&#160;that&#160;is&#160;very&#160;powerful&#160;for processing&#160;string&#160;<br/>information.<br/>
122<br/>
<hr/>
<a name=126></a><b>&#160;6.&#160;Date&#160;Routines<br/></b>This&#160;chapter introduces&#160;the&#160;subroutines&#160;and functions&#160;supported&#160;by&#160;OpenOffice.org&#160;Basic&#160;that&#160;are&#160;related to&#160;<br/>dates&#160;—&#160;including functions&#160;to retrieve&#160;the&#160;current&#160;date&#160;and time, manipulate&#160;dates&#160;and times, and perform&#160;<br/>timing functions. It&#160;also discusses&#160;some&#160;potentially&#160;unexpected behavior around October 4, 1582, and again&#160;<br/>around December 30, 1899.<br/>
Date&#160;variables&#160;contain both&#160;a&#160;date&#160;and a&#160;time&#160;value. OOo Basic&#160;stores&#160;dates&#160;internally&#160;as&#160;a&#160;floating-point&#160;<br/>Double.&#160;The&#160;portion&#160;of the&#160;number to&#160;the&#160;left&#160;of the&#160;decimal&#160;contains&#160;the&#160;date, and the&#160;fractional&#160;portion to&#160;<br/>the&#160;right&#160;of the&#160;decimal&#160;contains&#160;the&#160;time.&#160;For&#160;example, adding 1 to&#160;a&#160;date&#160;value&#160;adds&#160;one&#160;day&#160;to the&#160;date.&#160;<br/>Adding 1/24 to&#160;a&#160;date&#160;value&#160;adds&#160;one&#160;hour to&#160;a&#160;date&#160;value;&#160;remember that&#160;there&#160;are&#160;24 hours&#160;in a&#160;day.&#160;The&#160;<br/>date&#160;and time&#160;functions&#160;supported&#160;by&#160;OpenOffice.org&#160;are&#160;listed in<a href="libremacros.html#126">&#160;Table&#160;34.</a><br/>
<i><b>Table&#160;34.</b>&#160;Functions&#160;and subroutines&#160;related&#160;to dates&#160;and times.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Type</b></i><br/>
<i><b>Description</b></i><br/>
CDate(expression)<br/>
Date<br/>
Convert&#160;a&#160;number&#160;or&#160;string&#160;to a&#160;date.<br/>
CDateFromIso(string)<br/>
Date<br/>
Convert&#160;to&#160;a&#160;date&#160;from&#160;an ISO&#160;8601&#160;date&#160;representation.<br/>
CDateToIso(date)<br/>
String<br/>
Convert&#160;a&#160;date&#160;to an ISO&#160;8601&#160;date&#160;representation.<br/>
Date()<br/>
String<br/>
Return the&#160;current&#160;date&#160;as&#160;a&#160;string.<br/>
DateAdd<br/>
Date<br/>
Add&#160;an interval&#160;to a&#160;date.<br/>
DateDiff<br/>
Integer<br/>
Returns the&#160;number&#160;of&#160;intervals&#160;between two&#160;dates.&#160;<br/>
DatePart<br/>
Variant<br/>
Obtain a&#160;specific&#160;part&#160;of&#160;a&#160;date&#160;value.<br/>
DateSerial(yr,&#160;mnth, day)<br/>
Date<br/>
Create&#160;a&#160;date&#160;from&#160;component&#160;pieces:&#160;Year,&#160;Month,&#160;Day.<br/>
DateValue(date)<br/>
Date<br/>
Extract&#160;the&#160;date&#160;from&#160;a&#160;date/time&#160;value&#160;by&#160;truncating&#160;the&#160;decimal&#160;portion.<br/>
Day(date)<br/>
Integer<br/>
Return the&#160;day&#160;of&#160;the&#160;month as an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
FormatDateTime<br/>
String<br/>
Format&#160;the&#160;date&#160;and time&#160;as a&#160;string. Requires&#160;OptionCompatible.<br/>
GetSystemTicks()<br/>
Long<br/>
Return the&#160;number&#160;of&#160;system&#160;ticks as a&#160;Long.<br/>
Hour(date)<br/>
Integer<br/>
Return the&#160;hour&#160;as an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
IsDate(value)<br/>
Boolean<br/>
Is&#160;this (value,&#160;converted&#160;to a&#160;string)&#160;a&#160;date?<br/>
Minute(date)<br/>
Integer<br/>
Return the&#160;minute&#160;as an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
Month(date)<br/>
Integer<br/>
Return the&#160;month&#160;as&#160;an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
MonthName<br/>
String<br/>
Return the&#160;name&#160;of&#160;the&#160;month based&#160;on an&#160;integer&#160;argument&#160;(1-12).<br/>
Now()<br/>
Date<br/>
Return the&#160;current&#160;date&#160;and&#160;time&#160;as a&#160;Date&#160;object.<br/>
Second(date)<br/>
Integer<br/>
Return the&#160;seconds as an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
Time()<br/>
Date<br/>
Return the&#160;time&#160;as a&#160;String&#160;in the&#160;format&#160;HH:MM:SS.<br/>
Timer()<br/>
Date<br/>
Return the&#160;number&#160;of&#160;seconds since&#160;midnight&#160;as&#160;a&#160;Date.&#160;Cast&#160;this&#160;to a&#160;<br/>
Long.<br/>
TimeSerial(hour,&#160;min, sec)<br/>
Date<br/>
Create&#160;a&#160;date&#160;from&#160;component&#160;pieces:&#160;Hours, Minutes, Seconds.<br/>
TimeValue(“HH:MM:SS”)&#160;<br/>
Date<br/>
Extract&#160;the&#160;time&#160;value&#160;from&#160;a&#160;date;&#160;a&#160;pure&#160;time&#160;value&#160;between 0&#160;and&#160;1.<br/>
WeekDay(date)<br/>
Integer<br/>
Return the&#160;integer&#160;1 through 7 corresponding&#160;to Sunday&#160;through&#160;<br/>
Saturday.<br/>
WeekdayName<br/>
String<br/>
Return the&#160;day&#160;of&#160;the&#160;week&#160;based&#160;on&#160;an integer&#160;argument&#160;(1-7).<br/>
Year(date)<br/>
Integer<br/>
Return the&#160;year&#160;as an Integer&#160;from&#160;a&#160;Date&#160;value.<br/>
123<br/>
<hr/>
<a name=127></a><i><b>&#160;6.1.&#160;Compatibility&#160;issues<br/></b></i>When&#160;OOo added a&#160;number and a&#160;date,&#160;the&#160;result&#160;was&#160;always&#160;a&#160;date. LibreOffice&#160;changed this&#160;behavior to&#160;<br/>always&#160;return a&#160;number.&#160;After breaking existing macros, LibreOffice&#160;changed the&#160;code&#160;so that&#160;some&#160;<br/>combinations&#160;involving a&#160;date&#160;and a&#160;number return a&#160;date. If&#160;existing code&#160;fails,&#160;explicitly&#160;cast&#160;the&#160;result&#160;to a<br/>date:&#160;<br/>
CDate(2&#160;+&#160;Now)<br/>
<i><b>&#160;6.2.&#160;Retrieve&#160;the&#160;current&#160;date&#160;and&#160;time<br/></b></i>OOo Basic&#160;has&#160;functions&#160;to determine&#160;the&#160;current&#160;date&#160;and time:&#160;Date,&#160;Time,&#160;and Now&#160;(described in<a href="libremacros.html#127">&#160;Table&#160;<br/>35)</a>.&#160;The&#160;Date&#160;and&#160;Time&#160;functions&#160;return a&#160;string with the&#160;current&#160;date&#160;and time,&#160;respectively.&#160;The&#160;strings&#160;are&#160;<br/>formatted based on the&#160;current&#160;locale&#160;(<b>Tools&#160;|&#160;Options&#160;|&#160;Language&#160;Settings&#160;|&#160;Languages</b>;&#160;and then&#160;set&#160;the&#160;<br/>locale).&#160;The&#160;Now&#160;command returns&#160;a&#160;Date&#160;object&#160;that&#160;contains&#160;both&#160;the&#160;current&#160;date&#160;and the&#160;current&#160;time.&#160;<br/>
<b>TIP</b><br/>
Now&#160;returns a&#160;Date&#160;object,&#160;which internally&#160;is&#160;stored&#160;as&#160;a&#160;Double.&#160;The&#160;functions Date&#160;and&#160;Time&#160;both return<br/>
a&#160;String.<br/>
<i><b>Table&#160;35.&#160;</b>Date&#160;and time&#160;functions&#160;in OOo Basic.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
Date<br/>
Return the&#160;current&#160;date&#160;as&#160;a&#160;String.<br/>
Now<br/>
Return the&#160;current&#160;date&#160;and&#160;time&#160;as a&#160;Date&#160;object.<br/>
Time<br/>
Return the&#160;current&#160;time&#160;as a&#160;String.<br/>
Printing the&#160;date&#160;and time&#160;is&#160;easy.<br/>
Print&#160;Date<br/>Print&#160;Time<br/>Print&#160;Now<br/>
<i><b>&#160;6.3.&#160;Dates,&#160;numbers,&#160;and&#160;strings<br/></b></i>OOo Basic&#160;recognizes&#160;dates&#160;in&#160;two different&#160;string formats.&#160;The&#160;obvious&#160;format&#160;is&#160;set&#160;by&#160;the&#160;locale.&#160;A&#160;less&#160;<br/>obvious&#160;format&#160;is&#160;the&#160;ISO&#160;8601 date&#160;format. String formats&#160;are&#160;always&#160;assumed to&#160;be&#160;in&#160;a&#160;locale-specific&#160;<br/>format&#160;except&#160;for routines&#160;specific&#160;to the&#160;ISO&#160;8601 format.&#160;Arguments&#160;passed to&#160;the&#160;date&#160;and time&#160;functions&#160;<br/>are&#160;converted&#160;to an appropriate&#160;type&#160;if possible.&#160;As&#160;a&#160;result,&#160;most&#160;of the&#160;functions&#160;in<a href="libremacros.html#127">&#160;Table&#160;36&#160;a</a>ccept&#160;string,&#160;<br/>numeric, and date&#160;arguments.<br/>
<i><b>Table&#160;36.</b>&#160;Date&#160;and string&#160;conversion functions</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
CDate<br/>
Convert&#160;a&#160;number&#160;or&#160;string&#160;to a&#160;date.<br/>
DateValue<br/>
Convert&#160;a&#160;formatted&#160;string&#160;from&#160;December&#160;1, 1582&#160;through&#160;December&#160;31, 9999&#160;to a&#160;Date&#160;<br/>
value&#160;that&#160;contains&#160;no time.<br/>
CDateFromIso<br/>
Convert&#160;to a&#160;date&#160;from&#160;an&#160;ISO&#160;8601 date&#160;representation.<br/>
CDateToIso<br/>
Convert&#160;a&#160;date&#160;to&#160;an ISO&#160;8601 date&#160;representation.<br/>
IsDate<br/>
Is&#160;this&#160;string&#160;a&#160;properly&#160;formatted&#160;date?<br/>
124<br/>
<hr/>
<a name=128></a>Use&#160;the&#160;IsDate&#160;function to&#160;test&#160;if a&#160;string contains&#160;a&#160;valid&#160;date.&#160;The&#160;argument&#160;is&#160;always&#160;converted to&#160;a&#160;string&#160;<br/>before&#160;it&#160;is&#160;used, so a&#160;numeric&#160;argument&#160;will&#160;return False.&#160;The&#160;IsDate&#160;function tests&#160;more&#160;than just&#160;syntax&#160;—<br/>it&#160;checks&#160;to&#160;see&#160;if the&#160;string contains&#160;a&#160;valid&#160;date.&#160;For&#160;example, “02/29/2003”&#160;fails&#160;because&#160;February&#160;2003&#160;<br/>contains&#160;only&#160;28 days.&#160;The&#160;same&#160;validity&#160;check is&#160;not&#160;performed on the&#160;time&#160;component&#160;of the&#160;string (se<a href="libremacros.html#128">e<br/>Listing 102&#160;and&#160;Listing 103)</a>.<br/>
<i><b>Listing&#160;102.</b>&#160;IsDate&#160;verifies&#160;that&#160;a string&#160;contains&#160;a valid&#160;date.<br/></i>Print&#160;IsDate(&#34;December 1, 1582 2:13:42&#34;)&#160;'True<br/>Print&#160;IsDate(&#34;2:13:42&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>Print&#160;IsDate(&#34;12/1/1582&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>Print&#160;IsDate(Now)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>Print&#160;IsDate(&#34;26:61:112&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'True: 112 seconds and 61 minutes!!!<br/>Print&#160;IsDate(True)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'False: Converts to string first<br/>Print&#160;IsDate(32686.22332)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'False: Converts to string first<br/>Print&#160;IsDate(&#34;02/29/2003&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'False: Only 28 days in February 03<br/>
The&#160;apparent&#160;inconsistency&#160;with the&#160;IsDate&#160;function&#160;is&#160;that&#160;“02/29/2003”&#160;is&#160;an invalid&#160;date&#160;but&#160;“26:61:112”&#160;<br/>is&#160;valid.&#160;With time&#160;values, if a&#160;section of the&#160;time&#160;is&#160;too&#160;large, it&#160;is&#160;simply&#160;added to&#160;the&#160;next&#160;section.&#160;For&#160;<br/>example,&#160;61 minutes&#160;is&#160;one&#160;hour and one&#160;minute.&#160;Again, 112 seconds&#160;adds&#160;one&#160;minute&#160;and 52 seconds&#160;to the<br/>final&#160;computed time&#160;value.&#160;This&#160;is&#160;demonstrated in<a href="libremacros.html#128">&#160;Listing 103&#160;a</a>nd shown i<a href="libremacros.html#128">n&#160;Figure&#160;45. N</a>otice&#160;that, in line&#160;<br/>two, 30 hours&#160;becomes&#160;six&#160;hours&#160;and the&#160;day&#160;is&#160;incremented by&#160;one.&#160;<br/>
<i><b>Listing&#160;103.</b>&#160;Converting&#160;time&#160;is&#160;strange.</i><br/>
Sub&#160;ExampleTimeConversions<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;Oops:<br/>&#160;&#160;Dim&#160;Dates()<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dates()&#160;=&#160;Array(&#34;1/1/1 00:00:00 &#34;,&#160;&#34;1/1/1 22:40:00 &#160;&#34;,&#160;&#34;1/1/1 30:40:00 &#160;&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;1/1/1 30:100:00 &#34;,&#160;&#34;1/1/1 30:100:100&#34;)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(Dates())&#160;To&#160;UBound(Dates())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(i)&#160;&amp;&#160;&#34; &#160; &#34;&#160;&amp;&#160;Dates(i)&#160;&amp;&#160;&#34; =&gt; &#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CDate(Dates(i))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Strange Time Values&#34;<br/>&#160;&#160;Exit&#160;Sub<br/>&#160;&#160;Oops:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Error&#34;<br/>&#160;&#160;Resume&#160;Next<br/>End&#160;Sub<br/>
<i><b>Figure&#160;45.</b>&#160;What&#160;appear&#160;to&#160;be&#160;invalid times&#160;are&#160;valid.</i><br/>
125<br/>
<hr/>
<a name=129></a>Apart&#160;from&#160;the&#160;strange&#160;behavior&#160;with respect&#160;to time,&#160;dates&#160;and times&#160;are&#160;converted&#160;with no problems&#160;except<br/>for invalid&#160;dates&#160;during the&#160;skip from&#160;the&#160;Julian&#160;to the&#160;Gregorian calendar.<br/>
<i><b>&#160;6.4.&#160;Locale&#160;formatted&#160;dates<br/></b></i>Use&#160;the&#160;CDate&#160;function&#160;to convert&#160;a&#160;string&#160;or number to&#160;a&#160;date.&#160;The&#160;CDate&#160;function&#160;performs&#160;a&#160;locale-<br/>specific&#160;conversion including the&#160;time&#160;component.&#160;The&#160;DateValue&#160;function&#160;removes&#160;the&#160;time&#160;portion&#160;by&#160;<br/>removing the&#160;fractional&#160;portion&#160;of the&#160;underlying Double.&#160;This&#160;causes&#160;unexpected&#160;results&#160;with some&#160;date&#160;<br/>values. See<a href="libremacros.html#129">&#160;Listing 104.</a><br/>
<i><b>Listing&#160;104.</b>&#160;CDate&#160;returns&#160;a date&#160;and a time; DateValue&#160;removes&#160;the&#160;time.<br/></i>Print&#160;Now&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'for example, 08/16/2003 16:05:53<br/>Print&#160;DateValue(Now)&#160; &#160; &#160; &#160;&#160;'for example, 08/16/2003<br/>
The&#160;default&#160;language&#160;on the&#160;computers&#160;that&#160;I&#160;use&#160;is&#160;“English USA.”&#160;To&#160;use&#160;a&#160;different&#160;locale,&#160;select&#160;<b>Tools&#160;|&#160;<br/>Options&#160;|&#160;Language&#160;Settings&#160;|&#160;Languages</b>&#160;to open the&#160;Languages&#160;tab&#160;on the&#160;Options&#160;dialog.&#160;Then choose&#160;a&#160;<br/>locale.&#160;<br/>
To&#160;test&#160;different&#160;locales, use&#160;the&#160;code&#160;in<a href="libremacros.html#129">&#160;Listing 105.</a><br/>
<i><b>Listing&#160;105.</b>&#160;Print&#160;date-related&#160;information dependent&#160;on current&#160;locale.</i><br/>
Dim&#160;d&#160;As&#160;Date<br/>d&#160;=&#160;CDate(&#34;1/2/3&#34;)&#160; &#160;'You can use 1.2.3 or 1/2/3 regardless of locale<br/>Print&#160;d&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Prints locale specific<br/>Print&#160;Year(d)<br/>Print&#160;Month(d)<br/>Print&#160;Day(d)<br/>
I&#160;ran the&#160;code&#160;in<a href="libremacros.html#129">&#160;Listing 105&#160;us</a>ing four different&#160;locales:&#160;English USA, English UK, French France, and&#160;<br/>German Germany.&#160;The&#160;results&#160;are&#160;shown i<a href="libremacros.html#129">n&#160;Table&#160;37.&#160;</a>The&#160;format&#160;used to print&#160;a&#160;date&#160;is&#160;locale-specific,&#160;as&#160;<br/>you&#160;can see&#160;in&#160;the&#160;Germany&#160;column.&#160;The&#160;CDate&#160;function&#160;accepts&#160;dates&#160;formatted using&#160;the&#160;period&#160;as&#160;a&#160;<br/>separator,&#160;even for the&#160;USA&#160;locale.&#160;Initializing d using CDate(&#34;1.2.3&#34;)&#160;rather than CDate(&#34;1/2/3&#34;) does&#160;not&#160;<br/>change&#160;the&#160;output&#160;i<a href="libremacros.html#129">n&#160;Table&#160;37.</a><br/>
<i><b>Table&#160;37.</b>&#160;Locale&#160;affects&#160;the&#160;date.&#160;</i><br/>
<i><b>Code</b></i><br/>
<i><b>USA</b></i><br/>
<i><b>UK</b></i><br/>
<i><b>France</b></i><br/>
<i><b>Germany</b></i><br/>
Print&#160;d<br/>
“01/02/2003”<br/>
“01/02/2003”<br/>
“01/02/2003”<br/>
“01.02.2003”<br/>
Print&#160;Year(d)<br/>
2003<br/>
2003<br/>
2003<br/>
2003<br/>
Print&#160;Month(d)<br/>
1<br/>
2<br/>
2<br/>
2<br/>
Print&#160;Day(d)<br/>
2<br/>
1<br/>
1<br/>
1<br/>
<i><b>&#160;6.5.&#160;ISO&#160;8601&#160;dates<br/></b></i>The&#160;International&#160;Standard ISO&#160;8601 specifies&#160;the&#160;numeric&#160;representations&#160;of date&#160;and time.&#160;This&#160;standard&#160;<br/>notation helps&#160;to avoid&#160;confusion in&#160;international&#160;communication caused by&#160;numerous&#160;different&#160;notations,&#160;<br/>and increases&#160;the&#160;portability&#160;of computer user interfaces. In&#160;addition, these&#160;formats&#160;have&#160;several&#160;important&#160;<br/>advantages&#160;for computer usage&#160;compared to other traditional&#160;date&#160;and time&#160;notations.&#160;<br/>
The&#160;international&#160;standard date&#160;notation is&#160;YYYY-MM-DD, which is&#160;a&#160;four-digit&#160;year&#160;followed by&#160;a&#160;two-<br/>digit&#160;month&#160;and a&#160;two-digit&#160;day.&#160;The&#160;year is&#160;based on the&#160;usual&#160;Gregorian&#160;calendar.&#160;For&#160;example, March 8,&#160;<br/>2003 is&#160;written&#160;as&#160;2003-03-08.&#160;The&#160;separators&#160;are&#160;optional,&#160;so you&#160;could also&#160;express&#160;the&#160;date&#160;as&#160;20030308;&#160;<br/>
126<br/>
<hr/>
<a name=130></a>this&#160;is&#160;the&#160;format&#160;returned by&#160;CDateToISO. See<a href="libremacros.html#145">&#160;Listing 121. O</a>ther components&#160;of the&#160;date&#160;format&#160;are&#160;<br/>beyond the&#160;scope&#160;of this&#160;book.&#160;The&#160;ISO&#160;format&#160;has&#160;several&#160;advantages:<br/>
•<br/>
ISO 8601 is easily comparable and sortable with a string comparison. This is why I prefer this format <br/>
when appending dates to file names.<br/>
•<br/>
ISO 8601 is easily readable and writable by software because no translation to and from month <br/>
names is required.<br/>
•<br/>
ISO 8601 is language and locale independent.<br/>
There is no ambiguity compared to other date formats. For example, in other formats, there’s often a <br/>
question as to whether the month or the day is listed first. The convention in Europe, for example, would <br/>
express the fifth day of June in 2003 as 5/6/03, while in the United States — and North and South America, <br/>
generally — the same date would commonly be expressed as 6/5/03. The opportunity for confusion is great, <br/>
especially around the time bills are due near the beginning of each month! This is illustrated by the Month <br/>
and Day row entries shown i<a href="libremacros.html#129">n Table 37</a><a href="libremacros.html#130">. Listing 106 Conve</a>rts the same data to the appropriate ISO 8601 <br/>
string . <br/><i><b>Listing&#160;106.</b>&#160;Convert&#160;to&#160;ISO&#160;8601.</i><br/>
Sub&#160;ExampleCDateToISO<br/>&#160;&#160;Print&#160;CDateToISO(&#34;12/30/1899&#34;)&#160; &#160; &#160; &#160; &#160; &#160;'18991230<br/>&#160;&#160;Print&#160;CDateToISO(Now)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'20100816<br/>&#160;&#160;Print&#160;CDateFromISO(&#34;20030313&#34;)&#160; &#160; &#160; &#160; &#160; &#160;'03/13/2003<br/>End&#160;Sub<br/>
<i><b>&#160;6.6.&#160;Problems&#160;with&#160;dates<br/></b></i>Date&#160;and time&#160;information usually&#160;requires&#160;little&#160;thought. Just&#160;use&#160;the&#160;date&#160;and time&#160;functions&#160;and the&#160;correct<br/>expected&#160;results&#160;are&#160;produced. Unfortunately,&#160;this&#160;falls&#160;apart&#160;as&#160;your&#160;dates&#160;start&#160;moving back in&#160;time.&#160;Three&#160;<br/>specific&#160;dates&#160;and times&#160;are&#160;of interest&#160;for each function:<br/>
•<br/>
December 30, 1899 at&#160;00:00:00, when the&#160;internal&#160;Date&#160;representation is&#160;a&#160;numerical&#160;zero.&#160;Any&#160;pure&#160;<br/>time&#160;value&#160;(without&#160;a&#160;date&#160;component) appears&#160;to occur on December 30, 1899.&#160;<br/>
•<br/>
October 4, 1582, when the&#160;Julian&#160;calendar was&#160;dropped.<br/>
•<br/>
October 15,1582, when the&#160;Gregorian calendar begins.<br/>
Various&#160;calendar systems&#160;have&#160;been used at&#160;different&#160;times&#160;and places&#160;around the&#160;world.&#160;The&#160;Gregorian&#160;<br/>calendar,&#160;on which OOo Basic&#160;is&#160;based, is&#160;used almost&#160;universally.&#160;The&#160;predecessor to&#160;the&#160;Gregorian&#160;<br/>calendar is&#160;the&#160;Julian&#160;calendar.&#160;The&#160;two calendars&#160;are&#160;almost&#160;identical, differing only&#160;in how&#160;they&#160;handle&#160;<br/>leap years.&#160;The&#160;Julian&#160;calendar has&#160;a&#160;leap year every&#160;fourth&#160;year,&#160;while&#160;the&#160;Gregorian calendar has&#160;a&#160;leap&#160;<br/>year&#160;every&#160;fourth&#160;year&#160;except&#160;century&#160;years&#160;that&#160;aren’t&#160;exactly&#160;divisible&#160;by&#160;400.<br/>
The&#160;change&#160;from&#160;the&#160;Julian calendar to the&#160;Gregorian calendar occurred in&#160;October of 1582, based on a&#160;<br/>scheme&#160;instituted by&#160;Pope&#160;Gregory&#160;XIII.&#160;The&#160;Julian&#160;calendar was&#160;used through October 4, 1582, at&#160;which&#160;<br/>point&#160;10 days&#160;were&#160;skipped&#160;and it&#160;became&#160;October 15, 1582.&#160;Typically,&#160;for dates&#160;on or before&#160;4 October&#160;<br/>1582, the&#160;Julian calendar is&#160;used;&#160;for dates&#160;on or after 15 October 1582, the&#160;Gregorian&#160;calendar is&#160;used.&#160;<br/>Thus, there&#160;is&#160;a&#160;10-day&#160;gap in&#160;calendar dates, but&#160;no discontinuity&#160;in Julian dates&#160;or days&#160;of the&#160;week.&#160;<br/>Astronomers, however,&#160;typically&#160;use&#160;Julian dates&#160;because&#160;they&#160;don’t&#160;have&#160;a&#160;10-day&#160;gap;&#160;discontinuous&#160;dates&#160;<br/>do not&#160;typically&#160;work well&#160;in numerical&#160;calculations.&#160;As&#160;seen i<a href="libremacros.html#140">n&#160;Listing&#160;116, D</a>ates&#160;are&#160;printed based on the&#160;<br/>Gregorian calendar,&#160;but&#160;when the&#160;component&#160;parts&#160;are&#160;extracted, they&#160;are&#160;based on the&#160;Julian&#160;date.<br/>
127<br/>
<hr/>
<a name=131></a>The&#160;ISO&#160;8601 standard, introduced to standardize&#160;the&#160;exchange&#160;of date&#160;and time-related&#160;data, introduces&#160;a&#160;<br/>complication.&#160;The&#160;standard states&#160;that&#160;every&#160;date&#160;must&#160;be&#160;consecutive,&#160;so changing&#160;to&#160;the&#160;Julian calendar&#160;<br/>violates&#160;the&#160;standard (because&#160;at&#160;the&#160;switchover date, the&#160;dates&#160;would&#160;not&#160;be&#160;consecutive).&#160;<br/>
The&#160;following&#160;examples&#160;demonstrate&#160;converting a&#160;date&#160;/&#160;time&#160;with&#160;CDate,&#160;DateValue, and CDateToISO.&#160;The<br/>DateValue&#160;operates&#160;on the&#160;value&#160;returned from&#160;CDate.&#160;The&#160;standard values&#160;work as&#160;expected&#160;(see<a href="libremacros.html#131">&#160;Table&#160;38)</a>.&#160;<br/>January&#160;1, 2001 is&#160;36892 days&#160;after December 30, 1899, and January&#160;1, 1900 is&#160;2 days&#160;after &#160;December 30,&#160;<br/>1899.<br/>
<i><b>Table&#160;38.</b>&#160;Dates&#160;after&#160;January&#160;1, 1900 work&#160;fine.</i><br/>
<i><b>Date&#160;/&#160;Time</b></i><br/>
<i><b>DateValue</b></i><br/>
<i><b>CDate</b></i><br/>
<i><b>CDateToISO</b></i><br/>
01/01/1900 12:00&#160;AM<br/>
2<br/>
2<br/>
19000101<br/>
01/01/1900 06:00&#160;AM<br/>
2<br/>
2.25<br/>
19000101<br/>
01/02/1900 12:00&#160;AM<br/>
3<br/>
3<br/>
19000102<br/>
01/02/1900 06:00&#160;AM<br/>
3<br/>
3.25<br/>
19000102<br/>
01/01/2001 12:00&#160;AM<br/>
36892<br/>
36892<br/>
20010101<br/>
01/01/2001 06:00&#160;AM<br/>
36892<br/>
36892.25<br/>
20010101<br/>
01/01/2001 12:00&#160;PM<br/>
36892<br/>
36892.5<br/>
20010101<br/>
Values&#160;near &#160;December 30, 1899 reveals&#160;some&#160;bugs.<br/>
1)&#160;DateValue&#160;generates&#160;an error on December 30, 1899.&#160;This&#160;may&#160;be&#160;intentional&#160;so that&#160;DateValue&#160;<br/>
generates&#160;an error on a&#160;pure&#160;time&#160;value,&#160;which cannot&#160;be&#160;distinguished from&#160;a&#160;date/time&#160;on&#160;<br/>December 30, 1899.<br/>
2)&#160;DateValue&#160;returns&#160;an incorrect&#160;answer for all&#160;dates&#160;before&#160;December 30, 1899 for all&#160;time&#160;values&#160;<br/>
other than&#160;midnight.<br/>
3)&#160;CDateToISO&#160;returns&#160;an incorrect&#160;answer for all&#160;dates&#160;before&#160;January&#160;1, 1900 for all&#160;time&#160;values&#160;other<br/>
than&#160;midnight.&#160;<br/>
4)&#160;CDateToISO&#160;has&#160;an exceptional&#160;failure&#160;on on December 31, 1899 for times&#160;after midnight.&#160;<br/>
<i><b>Table&#160;39.</b>&#160;Dates&#160;near&#160;December&#160;30, 1899 &#160;are&#160;a problem.</i><br/>
<i><b>Date&#160;/&#160;Time</b></i><br/>
<i><b>DateValue</b></i><br/>
<i><b>CDate</b></i><br/>
<i><b>CDateToISO</b></i><br/>
12/28/1899 12:00&#160;AM<br/>
-2<br/>
-2<br/>
18991228<br/>
12/28/1899 06:00&#160;AM<br/>
-1<br/>
-1.75<br/>
18991229<br/>
12/29/1899 12:00&#160;AM<br/>
-1<br/>
-1<br/>
18991229<br/>
12/29/1899 06:00&#160;AM<br/>
Error<br/>
-0.75<br/>
18991230<br/>
12/30/1899 12:00&#160;AM<br/>
Error<br/>
0<br/>
18991230<br/>
12/30/1899 06:00&#160;AM<br/>
Error<br/>
0.25<br/>
18991231<br/>
12/31/1899 12:00&#160;AM<br/>
1<br/>
1<br/>
18991231<br/>
12/31/1899 06:00&#160;AM<br/>
1<br/>
1.25<br/>
18991201<br/>
Purely&#160;invalid&#160;dates&#160;generate&#160;an error as&#160;they&#160;should;&#160;for example, dates&#160;between the&#160;end of the&#160;Julian&#160;<br/>calendar and the&#160;start&#160;of the&#160;Gregorian calendar.&#160;Issues&#160;with&#160;DateValue&#160;and CdateToISO&#160;continue&#160;when the&#160;<br/>time&#160;is&#160;not&#160;midnight.<br/>
128<br/>
<hr/>
<a name=132></a><i><b>Table&#160;40.</b>&#160;Nothing&#160;special&#160;about&#160;dates&#160;near&#160;the&#160;Julian /&#160;Gregorian calendar&#160;change.</i><br/>
<i><b>Date&#160;/&#160;Time</b></i><br/>
<i><b>DateValue</b></i><br/>
<i><b>CDate</b></i><br/>
<i><b>CDateToISO</b></i><br/>
10/04/1582 12:00&#160;AM<br/>
-115859<br/>
-115859<br/>
15821014<br/>
10/04/1582 06:00&#160;AM<br/>
-115858<br/>
-115858.75<br/>
15821015<br/>
10/05/1582 00:00:00<br/>
Error<br/>
Error<br/>
Error<br/>
10/05/1582 06:00:00<br/>
Error<br/>
Error<br/>
Error<br/>
10/15/1582 12:00&#160;AM<br/>
-115858<br/>
-115858<br/>
15821015<br/>
10/15/1582 06:00&#160;AM<br/>
-115857<br/>
-115857.75<br/>
15821016<br/>
<a href="libremacros.html#132">Listing 107&#160;D</a>emonstrates&#160;the&#160;issues&#160;converting to&#160;date&#160;/&#160;time&#160;values.<br/>
<i><b>Listing&#160;107.</b>&#160;Demonstrate&#160;odd date&#160;behavior.</i><br/>
Sub&#160;OddDateTimeBehavior<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;Oops:<br/>&#160;&#160;Dim&#160;Dates()<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dates()&#160;=&#160;Array(&#34;10/04/1582 00:00:00&#34;,&#160;&#34;10/04/1582 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;10/05/1582 00:00:00&#34;,&#160;&#34;10/05/1582 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;10/15/1582 00:00:00&#34;,&#160;&#34;10/15/1582 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;12/28/1899 00:00:00&#34;,&#160;&#34;12/28/1899 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;12/29/1899 00:00:00&#34;,&#160;&#34;12/29/1899 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;12/30/1899 00:00:00&#34;,&#160;&#34;12/30/1899 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;12/31/1899 00:00:00&#34;,&#160;&#34;12/31/1899 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;01/01/1900 00:00:00&#34;,&#160;&#34;01/01/1900 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;01/02/1900 00:00:00&#34;,&#160;&#34;01/02/1900 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;1/1/1 00:00:00&#34;,&#160;&#34;1/1/1 06:00:00&#34;,&#160;&#34;1/1/1 12:00:00&#34;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(Dates())&#160;To&#160;UBound(Dates())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(i)&#160;&amp;&#160;&#34; &#160; &#34;&#160;&amp;&#160;Dates(i)&#160;&amp;&#160;&#34; =&gt; &#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CDbl(DateValue(CDate(Dates(i))))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; =&gt; &#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CDbl(CDate(Dates(i)))&#160;&amp;&#160;&#34; =&gt; &#34;&#160;&amp;&#160;CDateToISO(Dates(i))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Strange Time Values&#34;<br/>&#160;&#160;Exit&#160;Sub<br/>&#160;&#160;Oops:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Error&#34;<br/>&#160;&#160;Resume&#160;Next<br/>End&#160;Sub<br/>
129<br/>
<hr/>
<a name=133></a><i><b>Figure&#160;46.</b>&#160;Some&#160;Date&#160;values&#160;convert&#160;poorly.</i><br/>
<b>TIP</b><br/>
DateValue&#160;fails&#160;with a&#160;run-time&#160;error&#160;for&#160;dates with a&#160;zero&#160;day&#160;component,&#160;such as&#160;<br/>
DateValue(CDate(&#34;12/30/1899&#160;06:00:00&#34;)).&#160;Dates before&#160;this return an&#160;incorrect&#160;value. I&#160;might&#160;also argue&#160;<br/>that&#160;dates and times that&#160;use&#160;the&#160;same&#160;data&#160;type&#160;is&#160;a&#160;bug, because&#160;it&#160;isn’t&#160;possible&#160;to&#160;distinguish between a&#160;<br/>
time&#160;and a&#160;date&#160;value&#160;for&#160;the&#160;day&#160;12/30/1899.<br/>
DateValue&#160;truncates&#160;the&#160;decimal&#160;portion&#160;of the&#160;number to&#160;determine&#160;the&#160;date.&#160;The&#160;Int&#160;function,&#160;however,&#160;<br/>always&#160;rounds&#160;toward negative&#160;infinity,&#160;which&#160;produces&#160;the&#160;correct&#160;result.&#160;See<a href="libremacros.html#133">&#160;Listing 108. Re</a>member that&#160;<br/>the&#160;Int&#160;function&#160;rounds&#160;towards&#160;negative&#160;infinity&#160;and returns&#160;a&#160;double.<br/>
<i><b>Listing&#160;108.</b>&#160;Round toward&#160;negative&#160;infinity&#160;and convert&#160;it&#160;to&#160;a Date.</i><br/>
Function&#160;SafeDateValue(v)&#160;Date<br/>&#160;&#160;SafeDateValue&#160;=&#160;CDate(Int(CDate(v)))<br/>End&#160;Function<br/>
SafeDateValue&#160;in<a href="libremacros.html#133">&#160;Listing 108&#160;c</a>orrects&#160;the&#160;wrong behavior.<a href="libremacros.html#133">&#160;Listing 109&#160;r</a>epeats<a href="libremacros.html#132">&#160;Listing&#160;107&#160;us</a>ing&#160;<br/>SafeDateValue, so now&#160;the&#160;correct&#160;values&#160;are&#160;obtained.<br/>
<i><b>Listing&#160;109.</b>&#160;Round toward&#160;negative&#160;infinity&#160;and convert&#160;it&#160;to&#160;a Date.</i><br/>
Sub&#160;SafeDateTimeBehavior<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;Oops:<br/>&#160;&#160;Dim&#160;Dates()<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dates()&#160;=&#160;Array(&#34;10/04/1582 00:00:00&#34;,&#160;&#34;10/04/1582 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;10/05/1582 00:00:00&#34;,&#160;&#34;10/05/1582 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;10/15/1582 00:00:00&#34;,&#160;&#34;10/15/1582 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;12/28/1899 00:00:00&#34;,&#160;&#34;12/28/1899 06:00:00&#34;,&#160;_<br/>
130<br/>
<hr/>
<a name=134></a>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;12/29/1899 00:00:00&#34;,&#160;&#34;12/29/1899 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;12/30/1899 00:00:00&#34;,&#160;&#34;12/30/1899 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;12/31/1899 00:00:00&#34;,&#160;&#34;12/31/1899 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;01/01/1900 00:00:00&#34;,&#160;&#34;01/01/1900 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;01/02/1900 00:00:00&#34;,&#160;&#34;01/02/1900 06:00:00&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;1/1/1 00:00:00&#34;,&#160;&#34;1/1/1 06:00:00&#34;,&#160;&#34;1/1/1 12:00:00&#34;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(Dates())&#160;To&#160;UBound(Dates())<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(i)&#160;&amp;&#160;&#34; &#160; &#34;&#160;&amp;&#160;Dates(i)&#160;&amp;&#160;&#34; =&gt; &#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CDbl(SafeDateValue(CDate(Dates(i))))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; =&gt; &#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CDbl(CDate(Dates(i)))&#160;&amp;&#160;&#34; =&gt; &#34;&#160;&amp;&#160;CDateToISO(SafeDateValue(Dates(i)))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Strange Time Values&#34;<br/>&#160;&#160;Exit&#160;Sub<br/>&#160;&#160;Oops:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Error&#34;<br/>&#160;&#160;Resume&#160;Next<br/>End&#160;Sub<br/>
<i><b>&#160;6.7.&#160;Extract&#160;each&#160;part&#160;of&#160;a&#160;date<br/></b></i>Date&#160;objects&#160;are&#160;based on floating-point&#160;Double&#160;numbers&#160;so mathematical&#160;operations&#160;and comparisons&#160;can&#160;<br/>be&#160;used with&#160;Date&#160;objects.&#160;The&#160;Date&#160;and&#160;Time&#160;functions, however,&#160;return strings, so they&#160;can’t&#160;be&#160;used in&#160;<br/>this&#160;capacity.&#160;OOo Basic&#160;provides&#160;functions&#160;to retrieve&#160;the&#160;individual&#160;pieces&#160;of a&#160;date&#160;(see<a href="libremacros.html#134">&#160;Table&#160;41)</a>.<br/>
<i><b>Table&#160;41.</b>&#160;Date&#160;component&#160;extraction&#160;functions&#160;in&#160;OOo Basic.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
Year(date)<br/>
Return the&#160;year&#160;portion of&#160;a&#160;Date&#160;value&#160;as an Integer.<br/>
Month(date)<br/>
Return the&#160;month portion of&#160;a&#160;Date&#160;value&#160;as&#160;an Integer.<br/>
Day(date)<br/>
Return the&#160;day&#160;portion of&#160;a&#160;Date&#160;value&#160;as an Integer.<br/>
Hour(date)<br/>
Return the&#160;hour&#160;portion of&#160;a&#160;Date&#160;value&#160;as an Integer.<br/>
Minute(date)<br/>
Return the&#160;minutes portion of&#160;a&#160;Date&#160;value&#160;as&#160;an Integer.<br/>
Second(date)<br/>
Return the&#160;seconds&#160;portion of&#160;a&#160;Date&#160;value&#160;as an Integer.<br/>
WeekDay(date)<br/>
Return an integer&#160;value&#160;from&#160;1 through 7,&#160;corresponding&#160;to the&#160;day&#160;of&#160;the&#160;week,&#160;<br/>Sunday&#160;through Saturday.<br/>
The&#160;functions&#160;in<a href="libremacros.html#134">&#160;Table&#160;41<b>&#160;</b></a>all&#160;expect&#160;a&#160;Date&#160;object, which is&#160;internally&#160;based on a&#160;Double. OOo Basic&#160;<br/>automatically&#160;converts&#160;the&#160;argument&#160;to the&#160;appropriate&#160;type&#160;if&#160;possible.&#160;The&#160;Date&#160;function&#160;returns&#160;a&#160;string&#160;<br/>with no time&#160;information (everything to the&#160;right&#160;of the&#160;decimal&#160;is&#160;zero) so there&#160;is&#160;no time&#160;information&#160;for&#160;<br/>the&#160;Hour,&#160;Minute, and Second functions&#160;to&#160;return. Similarly,&#160;the&#160;Time&#160;function returns&#160;a&#160;string with no date&#160;<br/>information (everything&#160;to&#160;the&#160;left&#160;of the&#160;decimal&#160;is&#160;zero), which corresponds&#160;to December 30, 1899.&#160;<br/>
Print&#160;&#34;Year = &#34;&#160;&amp;&#160;Year(0.223)&#160; &#160; &#160;&#160;'1899, 0 for date means December 30, 1899<br/>Print&#160;&#34;Year = &#34;&#160;&amp;&#160;Year(Time)&#160; &#160; &#160; &#160;'1899, No date information from Time()<br/>Print&#160;&#34;Month = &#34;&#160;&amp;&#160;Month(Date)&#160; &#160; &#160;'Current month<br/>Print&#160;&#34;Day = &#34;&#160;&amp;&#160;Day(Now)&#160; &#160; &#160; &#160; &#160;&#160;'Now contains date and time information &#160;&#160;<br/>Print&#160;&#34;Hour = &#34;&#160;&amp;&#160;Hour(Date)&#160; &#160; &#160; &#160;'0, No time information from Date()<br/>Print&#160;&#34;Minutes = &#34;&#160;&amp;&#160;Minute(Now)&#160; &#160;'Current minutes<br/>
131<br/>
<hr/>
<a name=135></a>Print&#160;&#34;Seconds = &#34;&#160;&amp;&#160;Second(Time)&#160;&#160;'Current seconds<br/>
Use&#160;the&#160;WeekDay&#160;function&#160;to&#160;determine&#160;the&#160;day&#160;of the&#160;week. Some&#160;calendars&#160;start&#160;on Monday&#160;and some&#160;<br/>start&#160;on Sunday;&#160;OOo Basic&#160;assumes&#160;that&#160;Sunday&#160;is&#160;the&#160;first&#160;day&#160;of the&#160;week. See<a href="libremacros.html#135">&#160;Listing&#160;110.</a><br/>
<i><b>Listing&#160;110.</b>&#160;Determine&#160;the&#160;day&#160;of&#160;the&#160;week.<br/></i>Sub&#160;ExampleWeekDayText<br/>&#160;&#160;Print&#160;&#34;Today is &#34;&#160;&amp;&#160;WeekDayText(Date)<br/>End&#160;Sub<br/>Function&#160;WeekDayText(d)&#160;As&#160;String<br/>&#160;&#160;Select&#160;Case&#160;WeekDay(d)<br/>&#160; &#160;&#160;case&#160;1<br/>&#160; &#160; &#160;&#160;WeekDayText=&#34;Sunday&#34;<br/>&#160; &#160;&#160;case&#160;2<br/>&#160; &#160; &#160;&#160;WeekDayText=&#34;Monday&#34;<br/>&#160; &#160;&#160;case&#160;3<br/>&#160; &#160; &#160;&#160;WeekDayText=&#34;Tuesday&#34;<br/>&#160; &#160;&#160;case&#160;4<br/>&#160; &#160; &#160;&#160;WeekDayText=&#34;Wednesday&#34;<br/>&#160; &#160;&#160;case&#160;5<br/>&#160; &#160; &#160;&#160;WeekDayText=&#34;Thursday&#34;<br/>&#160; &#160;&#160;case&#160;6<br/>&#160; &#160; &#160;&#160;WeekDayText=&#34;Friday&#34;<br/>&#160; &#160;&#160;case&#160;7<br/>&#160; &#160; &#160;&#160;WeekDayText=&#34;Saturday&#34;<br/>&#160;&#160;End&#160;Select<br/>End&#160;Function<br/>
The&#160;DatePart&#160;function allows&#160;you to pass&#160;a&#160;string expression&#160;that&#160;determines&#160;the&#160;part&#160;of the&#160;date&#160;of interest;&#160;<br/>as&#160;expressed as&#160;a&#160;string as&#160;the&#160;first&#160;argument.&#160;Running DatePart&#160;with September 15, 2010 at&#160;19:13:20 yields&#160;<br/>the&#160;results&#160;shown i<a href="libremacros.html#135">n&#160;Table&#160;42.</a><br/>
<i><b>Table&#160;42.</b>&#160;DatePart&#160;string specifier.</i><br/>
<i><b>Format</b></i><br/>
<i><b>Description</b></i><br/>
<i><b>Result</b></i><br/>
yyyy<br/>
Four-digit&#160;year<br/>
2010<br/>
q<br/>
Quarter<br/>
3<br/>
m<br/>
Month<br/>
9<br/>
y<br/>
Day&#160;of&#160;year<br/>
258<br/>
w<br/>
Weekday<br/>
4<br/>
ww<br/>
Week of&#160;year<br/>
38<br/>
d<br/>
Day&#160;of&#160;Month<br/>
15<br/>
h<br/>
Hour<br/>
19<br/>
n<br/>
Minute<br/>
13<br/>
s<br/>
Second<br/>
20<br/>
<i><b>Listing&#160;111.</b>&#160;Use&#160;DatePart&#160;to extract&#160;components&#160;of&#160;a date.</i><br/>
Sub&#160;ExampleDatePart<br/>&#160;&#160;Dim&#160;TheDate&#160;As&#160;Date<br/>&#160;&#160;Dim&#160;f<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>
132<br/>
<hr/>
<a name=136></a>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;TheDate&#160;=&#160;Now<br/>&#160;&#160;f&#160;=&#160;Array(&#34;yyyy&#34;,&#160;&#34;q&#34;,&#160;&#34;m&#34;,&#160;&#34;y&#34;,&#160;&#34;w&#34;,&#160;&#34;ww&#34;,&#160;&#34;d&#34;,&#160;&#34;h&#34;,&#160;&#34;n&#34;,&#160;&#34;s&#34;)<br/>&#160; &#160;s&#160;=&#160;&#34;Now = &#34;&#160;&amp;&#160;TheDate&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(f)&#160;To&#160;UBound(f)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;DatePart(&#34;&#160;&amp;&#160;f(i)&#160;&amp;&#160;&#34;, &#34;&#160;&amp;&#160;TheDate&#160;&amp;&#160;&#34;) = &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;DatePart(f(i),&#160;TheDate)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub&#160;<br/>
<b>TIP</b><br/>
A&#160;German user&#160;claimed that&#160;DatePart&#160;failed&#160;if&#160;it&#160;were&#160;not&#160;run with&#160;CompatibilityMode(True).<br/>
DatePart&#160;supports&#160;an optional&#160;third&#160;argument&#160;that&#160;specifies&#160;when a&#160;week is&#160;assumed to&#160;start&#160;(see<a href="libremacros.html#136">&#160;Table&#160;43).&#160;<br/></a>The&#160;optional&#160;fourth argument,&#160;specifies&#160;when the&#160;year is&#160;assumed to&#160;start.&#160;The&#160;third&#160;and fourth arguments&#160;<br/>affect&#160;things&#160;such as&#160;the&#160;week of the&#160;year,&#160;but&#160;will&#160;not&#160;affect&#160;other values&#160;such as&#160;the&#160;day&#160;of the&#160;year.<br/>
<i><b>Table&#160;43.</b>&#160;DatePart&#160;week&#160;start&#160;and year&#160;start&#160;values.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Week&#160;Start&#160;Description</b></i><br/>
<i><b>Year&#160;Start&#160;Description</b></i><br/>
0<br/>
Use&#160;system&#160;default&#160;value.<br/>
Use&#160;system&#160;default&#160;value.<br/>
1<br/>
Sunday&#160;(default)<br/>
Week&#160;1 is&#160;the&#160;week&#160;with January&#160;first&#160;(default).<br/>
2<br/>
Monday<br/>
Week&#160;1 is&#160;the&#160;first&#160;week&#160;containing&#160;four&#160;or&#160;more&#160;days&#160;of&#160;that&#160;year.<br/>
3<br/>
Tuesday<br/>
Week&#160;1 is&#160;the&#160;first&#160;week&#160;containing&#160;only&#160;days of&#160;the&#160;new&#160;year.<br/>
4<br/>
Wednesday<br/>
5<br/>
Thursday<br/>
6<br/>
Friday<br/>
7<br/>
Saturday<br/>
After extracting portions&#160;of the&#160;date, it&#160;is&#160;useful&#160;to print&#160;the&#160;values&#160;in an easy&#160;to read format.&#160;Use&#160;<br/>MonthName&#160;to convert&#160;the&#160;month&#160;number to the&#160;month&#160;name. Setting the&#160;optional&#160;second argument&#160;to&#160;True&#160;<br/>causes&#160;the&#160;name&#160;to&#160;be&#160;abbreviated.<br/>
<i><b>Listing&#160;112.</b>&#160;Print&#160;the&#160;Month&#160;as&#160;a string.<br/></i>Sub&#160;ExampleMonthName<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;For&#160;i&#160;=&#160;1&#160;To&#160;12<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;i&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;MonthName(i,&#160;True)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;MonthName(i)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;MonthName&#34;<br/>End&#160;Sub<br/>
133<br/>
<hr/>
<a name=137></a><i>        </i><br/>
<i><b>Figure&#160;47.</b>&#160;Use&#160;MonthName&#160;and WeekDayName&#160;to&#160;convert&#160;an integer&#160;into the&#160;name.</i><br/>
WeekDayName, similar&#160;to Monthname,&#160;returns&#160;the&#160;day&#160;of the&#160;week as&#160;a&#160;string. Oddly,&#160;WeekDayName&#160;only&#160;<br/>works&#160;if compatibility&#160;mode&#160;is&#160;on.&#160;WeekDayName&#160;also supports&#160;a&#160;third argument,&#160;which&#160;specifies&#160;the&#160;day&#160;<br/>that&#160;the&#160;week begins&#160;(see<a href="libremacros.html#137">&#160;Table&#160;44).</a><br/>
<i><b>Listing&#160;113.</b>&#160;Print&#160;the&#160;day&#160;of&#160;the&#160;week&#160;as&#160;a string.<br/></i>Sub&#160;ExampleWeekDayName<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;CompatibilityMode(True)<br/>&#160;&#160;For&#160;i&#160;=&#160;1&#160;To&#160;7<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;i&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;WeekDayName(i,&#160;True)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;WeekDayName(i)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;WeekDayName&#34;<br/>End&#160;Sub&#160;<br/>
<i><b>Table&#160;44.</b>&#160;Third&#160;argument&#160;for&#160;WeekDayName&#160;to specify&#160;the&#160;first&#160;day&#160;of&#160;the&#160;week.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
Use&#160;National&#160;Language&#160;Support&#160;API&#160;setting.<br/>
1<br/>
Sunday&#160;(default)<br/>
2<br/>
Monday<br/>
3<br/>
Tuesday<br/>
4<br/>
Wednesday<br/>
5<br/>
Thursday<br/>
6<br/>
Friday<br/>
7<br/>
Saturday<br/>
Use&#160;the&#160;WeekDay&#160;function&#160;to&#160;extract&#160;the&#160;day&#160;of the&#160;week based on a&#160;date.&#160;The&#160;optional&#160;second argument&#160;<br/>specifies&#160;the&#160;day&#160;on which the&#160;week starts;&#160;the&#160;values&#160;are&#160;the&#160;same&#160;as&#160;for&#160;WeekDayName&#160;(see<a href="libremacros.html#137">&#160;Table&#160;44)</a>&#160;<br/>except&#160;that&#160;0 corresponds&#160;to&#160;the&#160;system&#160;default&#160;setting.&#160;<br/>
Print&#160;WeekDay(Now)<br/>
134<br/>
<hr/>
<a name=138></a>Use&#160;FormatDateTime&#160;to&#160;display&#160;the&#160;date&#160;and time&#160;in&#160;a&#160;common&#160;format.&#160;The&#160;first&#160;argument&#160;is&#160;the&#160;date.&#160;The&#160;<br/>second argument&#160;is&#160;optional&#160;and specifies&#160;how&#160;the&#160;date&#160;should&#160;be&#160;formatted (see<a href="libremacros.html#138">&#160;Table&#160;45).</a><br/>
<i><b>Listing&#160;114.</b>&#160;Format&#160;a date/time&#160;string.<br/></i>Sub&#160;ExampleFormatDateTime<br/>&#160;&#160;Dim&#160;s$,&#160;i%<br/>&#160;&#160;Dim&#160;d&#160;As&#160;Date<br/>&#160;&#160;d&#160;=&#160;Now<br/>&#160;&#160;CompatibilityMode(True)<br/>&#160;&#160;s&#160;=&#160;&#34;FormatDateTime(d) = &#34;&#160;&amp;&#160;FormatDateTime(d)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;For&#160;i=0&#160;To&#160;4<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;FormatDateTime(d, &#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34;) = &#34;&#160;&amp;&#160;FormatDateTime(d,&#160;i)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;FormatDateTime&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;48.</b>&#160;Format&#160;a date&#160;and time&#160;with FormatDateTime.</i><br/>
<i><b>Table&#160;45.</b>&#160;Second argument&#160;to FormatDateTime&#160;specify&#160;format.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
Default&#160;format&#160;with a&#160;short&#160;date&#160;and and a&#160;long&#160;time.<br/>
1<br/>
Long date&#160;format&#160;with no time.<br/>
2<br/>
Short&#160;date&#160;format.<br/>
3<br/>
Time&#160;in the&#160;computer's&#160;regional&#160;settings.<br/>
4<br/>
24&#160;hour&#160;hours and&#160;minutes as hh:mm.<br/>
<i><b>&#160;6.8.&#160;Date&#160;arithmetic<br/></b></i>Internally,&#160;a&#160;date&#160;is&#160;represented as&#160;a&#160;floating point&#160;number.&#160;The&#160;decimal&#160;portion represents&#160;the&#160;time, and the&#160;<br/>integer portion&#160;represents&#160;the&#160;date.&#160;The&#160;representation&#160;allows&#160;mathematical&#160;manipulation, but,&#160;it&#160;requires&#160;a&#160;<br/>bit&#160;of thought;&#160;for example, add:<br/>
•<br/>
1<br/>
Add one&#160;day<br/>
Now&#160;+&#160;1<br/>
•<br/>
1/24<br/>
Add one&#160;hour<br/>
Now&#160;+&#160;1/24<br/>
•<br/>
365<br/>
Add one&#160;year,&#160;but&#160;leap years&#160;are&#160;a&#160;problem.<br/>
Use&#160;DateAdd to simplify&#160;the&#160;process.&#160;The&#160;third argument&#160;is&#160;the&#160;date.&#160;The&#160;first&#160;argument&#160;(see<a href="libremacros.html#135">&#160;Table&#160;42)</a>&#160;<br/>determines&#160;how&#160;the&#160;value&#160;in&#160;the&#160;second argument&#160;is&#160;interpreted. I&#160;can repeat&#160;the&#160;list&#160;above&#160;as:<br/>
Print&#160;DateAdd(&#34;d&#34;,&#160;1,&#160;Now) &#160; &#160;'Add one day.<br/>
135<br/>
<hr/>
<a name=139></a>Print&#160;DateAdd(&#34;h&#34;,&#160;1,&#160;Now) &#160; &#160;'Add one hour.<br/>Print&#160;DateAdd(&#34;yyy&#34;,&#160;1,&#160;Now) &#160;'Add one year.<br/>
Use&#160;DateDiff&#160;to&#160;determine&#160;the&#160;number of “intervals”&#160;between two dates;&#160;for example, the&#160;number weeks&#160;<br/>between two dates.&#160;The&#160;first&#160;argument&#160;specifies&#160;the&#160;interval&#160;to&#160;use&#160;(see<a href="libremacros.html#135">&#160;Table&#160;42).&#160;</a>The&#160;second argument&#160;is&#160;<br/>the&#160;first&#160;date,&#160;and the&#160;third&#160;argument&#160;is&#160;the&#160;second date.&#160;The&#160;optional&#160;fourth&#160;and fifth&#160;arguments&#160;specify&#160;the&#160;<br/>first&#160;day&#160;of the&#160;week and the&#160;first&#160;week of the&#160;year&#160;(see<a href="libremacros.html#136">&#160;Table&#160;43).</a><br/>
Print&#160;DateDiff(&#34;yyyy&#34;,&#160;&#34;03/13/1965&#34;,&#160;Date(Now))&#160;&#160;'Years from March 13, 1965 to now<br/>Print&#160;DateDiff(&#34;d&#34;,&#160; &#160;&#160;&#34;03/13/1965&#34;,&#160;Date(Now))&#160;&#160;'Days from March 13, 1965 to now<br/>
<i><b>&#160;6.9.&#160;Assembling&#160;dates&#160;from&#160;components<br/></b></i>The&#160;functions&#160;Hour,&#160;Minute, Second,&#160;Year,&#160;Month, and Day&#160;are&#160;used to break a&#160;date&#160;into&#160;parts.&#160;The&#160;functions<br/>DateSerial&#160;and&#160;TimeSerial&#160;are&#160;used to&#160;put&#160;the&#160;dates&#160;back together again.&#160;The&#160;function&#160;DateSerial&#160;creates&#160;a&#160;<br/>Date&#160;object&#160;from&#160;the&#160;year,&#160;month, and day.&#160;The&#160;function&#160;TimeSerial&#160;creates&#160;a&#160;Date&#160;object&#160;from&#160;the&#160;hours,&#160;<br/>minutes, and seconds.<br/>
Print&#160;DateSerial(2003,&#160;10,&#160;1)&#160;'10/01/2003<br/>Print&#160;TimeSerial(13,&#160;4,&#160;45)&#160; &#160;'13:04:45<br/>
The&#160;first&#160;argument&#160;to the&#160;DateSerial&#160;function&#160;is&#160;the&#160;year,&#160;the&#160;second argument&#160;is&#160;the&#160;month,&#160;and the&#160;final&#160;<br/>argument&#160;is&#160;the&#160;day.&#160;If&#160;the&#160;month&#160;or day&#160;aren’t&#160;valid&#160;values,&#160;a&#160;run-time&#160;error occurs.&#160;Year values&#160;greater than&#160;<br/>100 are&#160;used directly.&#160;Year values&#160;less&#160;than 100, however,&#160;have&#160;1900 added to&#160;them.&#160;Two-digit&#160;years&#160;are&#160;&#160;<br/>mapped to&#160;the&#160;years&#160;1900 and later (see<a href="libremacros.html#139">&#160;Listing 115).</a><br/>
<i><b>Listing&#160;115.</b>&#160;DateSerial&#160;adds&#160;1900 to&#160;years&#160;earlier&#160;than&#160;100.</i><br/>
Sub&#160;ExampleDateSerial<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;OOPS<br/>&#160;&#160;Dim&#160;x<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;s$<br/>
&#160;&#160;x&#160;=&#160;Array(2003,&#160;10,&#160;&#160;1,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;1899,&#160;12,&#160;31,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;1899,&#160;12,&#160;30,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;1899,&#160;12,&#160;29,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;1899,&#160;12,&#160;28,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;99,&#160;10,&#160;&#160;1,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;3,&#160;10,&#160;&#160;1,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;0,&#160;&#160;1,&#160;&#160;1,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;-3,&#160;10,&#160;&#160;1,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;-99,&#160;10,&#160;&#160;1,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;-100,&#160;10,&#160;&#160;1,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;-1800,&#160;10,&#160;&#160;1,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;-1801,&#160;10,&#160;&#160;1)<br/>&#160;&#160;i&#160;=&#160;LBound(x)<br/>&#160;&#160;Do&#160;While&#160;i&#160;&lt;&#160;UBound(x)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;DateSerial(x(i),&#160;x(i+1),&#160;x(i+2))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; &lt;= (&#34;&#160;&amp;&#160;ToStrWithLen(x(i),&#160;4)&#160;&amp;&#160;&#34;,&#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;ToStrWithLen(x(i+1),&#160;3)&#160;&amp;&#160;&#34;,&#34;&#160;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;ToStrWithLen(x(i+2),&#160;3)&#160;&amp;&#160;&#34;)&#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;i&#160;=&#160;i&#160;+&#160;3<br/>&#160;&#160;Loop<br/>
136<br/>
<hr/>
<a name=140></a>&#160;&#160;MsgBox&#160;s<br/>&#160;&#160;Exit&#160;Sub<br/>&#160;&#160;OOPS:<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;ERROR<br/>&#160; &#160;&#160;Resume&#160;Next<br/>End&#160;Sub<br/>
<i><b>Figure&#160;49.</b>&#160;DateSerial&#160;creates&#160;a date&#160;from&#160;a year,&#160;month, and day&#160;value.</i><br/>
<b>TIP</b><br/>
DateSerial&#160;adds 1900&#160;to years&#160;earlier&#160;than 100,&#160;including&#160;negative&#160;years.&#160;An&#160;error&#160;is generated&#160;if&#160;the&#160;<br/>resulting&#160;year&#160;is&#160;still&#160;lower&#160;than 100.&#160;This allows&#160;years from&#160;-1800&#160;through -1, which&#160;should probably&#160;be&#160;<br/>
an&#160;error.&#160;The&#160;Date&#160;type&#160;is&#160;able&#160;to handle&#160;dates&#160;prior&#160;to&#160;1/1/00,&#160;but&#160;obviously,&#160;DateSerial&#160;cannot.<br/>
Dates&#160;are&#160;printed based on the&#160;Gregorian calendar,&#160;but&#160;when the&#160;component&#160;parts&#160;are&#160;extracted, they&#160;are&#160;<br/>based on the&#160;Julian&#160;date.<br/>
<i><b>Listing&#160;116.</b>&#160;DateSerial&#160;accepts&#160;Gregorian&#160;dates&#160;before&#160;10/15/1582.</i><br/>
Print&#160;DateSerial(1582,&#160;10,&#160;15)&#160; &#160; &#160;&#160;'10/15/1582<br/>Print&#160;DateSerial(1582,&#160;10,&#160;14)&#160; &#160; &#160;&#160;'10/04/1582<br/>Print&#160;Day(DateSerial(1582,&#160;10,&#160;14))&#160;'14<br/>
<i><b>&#160;6.10.&#160;Measuring&#160;elapsed&#160;time&#160;over&#160;short&#160;intervals<br/></b></i>You can obtain&#160;simple&#160;elapsed time&#160;by&#160;subtracting two date&#160;values. For&#160;example, CLng(Now&#160;-&#160;<br/>CDate(&#34;1/1/2000&#34;)) determines&#160;the&#160;number of days&#160;elapsed since&#160;January&#160;1, 2000. OOo Basic&#160;supports&#160;<br/>returning elapsed time&#160;as&#160;the&#160;number of seconds&#160;(Timer) and as&#160;the&#160;number of system&#160;ticks&#160;<br/>(GetSystemTicks). See<a href="libremacros.html#141">&#160;Table&#160;46. I</a>nternally,&#160;computers&#160;have&#160;a&#160;system&#160;timer that&#160;advances&#160;at&#160;a&#160;certain rate;&#160;<br/>the&#160;rate&#160;is&#160;hardware&#160;dependent. On Intel-based computers&#160;this&#160;value&#160;is&#160;1/17th&#160;of a&#160;second. Each time&#160;that&#160;the&#160;<br/>timer advances&#160;by&#160;1, it’s&#160;called a&#160;“system&#160;tick.”&#160;The&#160;number returned by&#160;GetSystemTicks&#160;is&#160;always&#160;based on&#160;<br/>milliseconds, even if it&#160;relies&#160;on a&#160;less&#160;accurate&#160;clock.<br/>
137<br/>
<hr/>
<a name=141></a><i><b>Table&#160;46.</b>&#160;Elapsed time&#160;functions&#160;in OOo Basic.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
GetSystemTicks<br/>
Return the&#160;number&#160;of&#160;system&#160;ticks&#160;as a&#160;Long.&#160;The&#160;reported&#160;time&#160;is&#160;always in&#160;<br/>
milliseconds, even&#160;if&#160;the&#160;underlying&#160;timer&#160;is less accurate.<br/>
Timer<br/>
Return the&#160;number&#160;of&#160;seconds since&#160;midnight&#160;as a&#160;Date. Cast&#160;this to a&#160;Long.<br/>
Use&#160;GetSystemTicks&#160;to get&#160;the&#160;system-dependent&#160;number of system&#160;timer ticks.&#160;This&#160;value&#160;is&#160;typically&#160;used&#160;<br/>to time&#160;internal&#160;operations&#160;because&#160;it&#160;has&#160;higher precision&#160;than the&#160;internal&#160;time&#160;and date&#160;functions&#160;(se<a href="libremacros.html#141">e<br/>Listing 117&#160;and&#160;Figure&#160;50).&#160;</a>The&#160;return value&#160;is&#160;a&#160;Long.<br/>
<i><b>Listing&#160;117.</b>&#160;Measuring elapsed time.<br/></i>Sub&#160;ExampleElapsedTime<br/>&#160;&#160;Dim&#160;StartTicks&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;EndTicks&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;StartTime&#160;As&#160;Date<br/>&#160;&#160;Dim&#160;EndTime&#160;As&#160;Date<br/>&#160;&#160;StartTicks&#160;=&#160;GetSystemTicks()<br/>&#160;&#160;StartTime&#160;=&#160;Timer<br/>&#160;&#160;Wait(200)&#160;'Pause execution for 0.2 seconds<br/>&#160;&#160;EndTicks&#160;=&#160;GetSystemTicks()<br/>&#160;&#160;EndTime&#160;=&#160;Timer<br/>&#160;&#160;MsgBox&#160;&#34;After waiting 200 ms (0.2 seconds), &#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#34;System ticks = &#34;&#160;&amp;&#160;CStr(EndTicks&#160;-&#160;StartTicks)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#34;Time elapsed = &#34;&#160;&amp;&#160;CStr((EndTime&#160;-&#160;StartTime))&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#34; seconds&#34;&#160;&amp;&#160;CHR$(10),&#160;0,&#160;&#34;Elapsed Time&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;50.</b>&#160;GetSystemTicks&#160;has&#160;better&#160;resolution than&#160;Now.</i><br/>
Run the&#160;macro in<a href="libremacros.html#141">&#160;Listing 117&#160;a</a>&#160;few&#160;times. Sometimes&#160;it&#160;shows&#160;0 seconds, and sometimes&#160;it&#160;shows&#160;1 second.&#160;<br/>The&#160;resolution&#160;is&#160;too&#160;large&#160;for short&#160;duration&#160;items.&#160;<br/>
The&#160;Timer function&#160;returns&#160;the&#160;number of seconds&#160;since&#160;midnight&#160;as&#160;a&#160;Date&#160;object.&#160;The&#160;problem&#160;with this&#160;is&#160;<br/>that&#160;at&#160;10 seconds&#160;past&#160;midnight,&#160;the&#160;return value&#160;is&#160;10.&#160;The&#160;Date&#160;object, however,&#160;interprets&#160;10 to mean “10&#160;<br/>days”. Cast&#160;the&#160;returned type&#160;directly&#160;to&#160;a&#160;numerical&#160;type&#160;using&#160;CLng&#160;or CDbl&#160;to&#160;obtain&#160;the&#160;number of&#160;<br/>elapsed seconds.<br/>
Dim&#160;nSeconds&#160;As&#160;Long<br/>nSeconds&#160;=&#160;Timer<br/>Print&#160;&#34;Number of seconds = &#34;&#160;&amp;&#160;nSeconds<br/>Print&#160;&#34;Number of seconds = &#34;&#160;&amp;&#160;Clng(Timer)<br/>
<b>TIP</b><br/>
The&#160;Timer&#160;function returns the&#160;number&#160;of&#160;seconds since&#160;midnight. Using&#160;Timer&#160;to&#160;determine&#160;elapsed&#160;time&#160;<br/>
for&#160;spans that&#160;start&#160;before&#160;midnight&#160;and&#160;end&#160;after&#160;midnight&#160;produces&#160;useless&#160;results.<br/>
138<br/>
<hr/>
<a name=142></a><i><b>&#160;6.11.&#160;How&#160;fast&#160;does&#160;this&#160;run?&#160;A&#160;real-world&#160;example!<br/></b></i>The&#160;greatest&#160;common&#160;divisor (GCD) of two integers&#160;is&#160;the&#160;largest&#160;integer that&#160;divides&#160;both integers&#160;with&#160;no&#160;<br/>remainder.&#160;For example,&#160;the&#160;GCD&#160;of 6 and 9 is&#160;3.&#160;The&#160;numbers&#160;1 and 3 both&#160;divide&#160;the&#160;numbers&#160;6 and 9 (see<br/><a href="libremacros.html#142">Table&#160;47)</a>.&#160;The&#160;greatest&#160;of these&#160;is&#160;3.<br/>
<i><b>Table&#160;47.</b>&#160;Dividing 6 and 9 by&#160;integers.</i><br/>
<i><b>Number</b></i><br/>
<i><b>6&#160;Divided&#160;By&#160;#</b></i><br/>
<i><b>9&#160;Divided&#160;By&#160;#</b></i><br/>
<i><b>Both&#160;Divide</b></i><br/>
1<br/>
6<br/>
9<br/>
Yes<br/>
2<br/>
3<br/>
4&#160;remainder&#160;1<br/>
No<br/>
3<br/>
2<br/>
3<br/>
Yes<br/>
4<br/>
1&#160;remainder&#160;2<br/>
2&#160;remainder&#160;1<br/>
No<br/>
5<br/>
1&#160;remainder&#160;1<br/>
1&#160;remainder&#160;4<br/>
No<br/>
6<br/>
1<br/>
1&#160;remainder&#160;3<br/>
No<br/>
7<br/>
0&#160;remainder&#160;6<br/>
1&#160;remainder&#160;2<br/>
No<br/>
8<br/>
0&#160;remainder&#160;6<br/>
1&#160;remainder&#160;1<br/>
No<br/>
9<br/>
0&#160;remainder&#160;6<br/>
1<br/>
No<br/>
This&#160;example&#160;begins&#160;around the&#160;year 300 B.C. with&#160;a&#160;guy&#160;living&#160;in&#160;ancient&#160;Greece&#160;named Euclid. Euclid was<br/>a&#160;pretty&#160;smart&#160;guy&#160;who wrote&#160;numerous&#160;books, including&#160;<i>Data</i>, concerning the&#160;solution of problems&#160;through<br/>geometric&#160;analysis,&#160;<i>On Divisions&#160;(of&#160;Figures)</i>, the&#160;<i>Optics</i>, the&#160;<i>Phenomena</i>, a&#160;paper on spherical&#160;geometry&#160;for<br/>astronomers, the&#160;<i>Elements</i>, a&#160;13-volume&#160;textbook on geometry,&#160;and several&#160;lost&#160;works&#160;on higher geometry.&#160;<br/>His&#160;impact&#160;on society&#160;was&#160;huge. One&#160;of his&#160;most&#160;well-known contributions&#160;is&#160;an extremely&#160;efficient&#160;<br/>algorithm&#160;to&#160;solve&#160;the&#160;GCD&#160;problem. Now&#160;jump ahead a&#160;few&#160;thousand&#160;years&#160;to&#160;Olivier Bietzer,&#160;who noticed&#160;<br/>that&#160;I&#160;had an impractically&#160;slow&#160;algorithm&#160;for solving the&#160;GCD&#160;problem.&#160;Olivier,&#160;who certainly&#160;knows&#160;a&#160;lot&#160;<br/>about&#160;these&#160;things, wrote&#160;the&#160;macro i<a href="libremacros.html#142">n&#160;Listing&#160;118&#160;t</a>hat&#160;solves&#160;the&#160;GCD&#160;problem&#160;using Euclid’s&#160;algorithm,&#160;<br/>and sent&#160;it&#160;to&#160;me.<br/>
<i><b>Listing&#160;118.</b>&#160;Calculate&#160;the&#160;GCD.<br/></i>'Author: Olivier Bietzer<br/><a href="mailto:olivier.bietzer@laposte.net">'e-mail:&#160;olivier.bietzer@laposte.net&#160;<br/></a>'This uses Euclid's algorithm and it is very fast!<br/>Function&#160;GCD_1(ByVal&#160;x&#160;As&#160;Long,&#160;ByVal&#160;y&#160;As&#160;Long)&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;pgcd&#160;As&#160;Long,&#160;test&#160;As&#160;Long<br/>
&#160;&#160;' We must have x &gt;= y and positive values<br/>&#160;&#160;x=abs(x)&#160;:&#160;y=abs(y)<br/>&#160;&#160;If&#160;(x&#160;&lt;&#160;y)&#160;Then<br/>&#160; &#160;test&#160;=&#160;x&#160;:&#160;x&#160;=&#160;y&#160;:&#160;y&#160;=&#160;test<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;y&#160;=&#160;0&#160;Then&#160;Exit&#160;Function<br/>
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' Euclid says ....<br/>&#160;&#160;pgcd&#160;=&#160;y&#160; &#160; &#160; &#160;&#160;' by definition, PGCD is the smallest<br/>&#160;&#160;test&#160;=&#160;x&#160;MOD&#160;y&#160;&#160;' remainder after division<br/>&#160;&#160;Do&#160;While&#160;(test)&#160;' While not 0<br/>&#160; &#160;pgcd&#160;=&#160;test&#160; &#160;&#160;' pgcd is the remainder<br/>&#160; &#160;x&#160;=&#160;y&#160; &#160; &#160; &#160; &#160;&#160;' x,y and current pgcd permutation<br/>&#160; &#160;y&#160;=&#160;pgcd<br/>
139<br/>
<hr/>
<a name=143></a>&#160; &#160;test&#160;=&#160;x&#160;MOD&#160;y&#160;' test again<br/>&#160;&#160;Loop<br/>&#160;&#160;GCD_1&#160;=&#160;pgcd&#160; &#160;&#160;' pgcd is the last non 0 rest &#160;! Magic ...<br/>End&#160;Function<br/>
In&#160;general, the&#160;best&#160;way&#160;to speed up a&#160;solution&#160;to&#160;a&#160;computational&#160;problem&#160;is&#160;by&#160;using&#160;a&#160;better algorithm.&#160;<br/>The&#160;algorithm&#160;in<a href="libremacros.html#142">&#160;Listing 118&#160;runs</a>&#160;roughly&#160;1000 times&#160;faster than the&#160;routine&#160;that&#160;I&#160;had. If&#160;a&#160;faster algorithm&#160;<br/>is&#160;not&#160;available,&#160;you&#160;can look for other ways&#160;to&#160;improve&#160;performance. (Sometimes&#160;it’s&#160;possible&#160;to&#160;invent&#160;a&#160;<br/>wholly&#160;new&#160;and improved algorithm;&#160;but&#160;that&#160;is&#160;quite&#160;a&#160;trick! If&#160;you succeed in developing a&#160;new,&#160;faster&#160;<br/>algorithm&#160;for a&#160;widely&#160;known problem, you may&#160;have&#160;great&#160;career potential&#160;as&#160;a&#160;professional&#160;mathematics&#160;or<br/>computer science&#160;professor.)&#160;The&#160;code&#160;i<a href="libremacros.html#142">n&#160;Listing&#160;118&#160;i</a>s&#160;already&#160;pretty&#160;lean.&#160;There&#160;isn’t&#160;a&#160;whole&#160;lot&#160;to&#160;<br/>remove,&#160;but&#160;I&#160;thought&#160;that&#160;I&#160;could&#160;reduce&#160;the&#160;number of assignments&#160;(see<a href="libremacros.html#143">&#160;Listing 119).</a><br/>
<i><b>Listing&#160;119.</b>&#160;Calculate&#160;the&#160;GCD&#160;(another&#160;way).</i><br/>
Function&#160;GCD_2(ByVal&#160;x&#160;As&#160;Long,&#160;ByVal&#160;y&#160;As&#160;Long)&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;pgcd&#160;As&#160;Long,&#160;test&#160;As&#160;Long<br/>
&#160;&#160;' We must have x &gt;= y and positive values<br/>&#160;&#160;x=abs(x)&#160;:&#160;y=abs(y)<br/>&#160;&#160;If&#160;(x&#160;&lt;&#160;y)&#160;Then<br/>&#160; &#160;test&#160;=&#160;x&#160;:&#160;x&#160;=&#160;y&#160;:&#160;y&#160;=&#160;test<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;y&#160;=&#160;0&#160;Then&#160;Exit&#160;Function<br/>
&#160;&#160;Do&#160;While&#160;(y)&#160; &#160; &#160;' While not 0<br/>&#160; &#160;pgcd&#160;=&#160;y&#160; &#160; &#160; &#160;&#160;' pgcd is the remainder<br/>&#160; &#160;y&#160;=&#160;x&#160;MOD&#160;pgcd&#160;&#160;' test again<br/>&#160; &#160;x&#160;=&#160;pgcd&#160; &#160; &#160; &#160;&#160;' x,y and current pgcd permutation<br/>&#160;&#160;Loop<br/>&#160;&#160;GCD_2&#160;=&#160;pgcd&#160; &#160; &#160;&#160;' pgcd is the last non 0 remainder &#160;! Magic ...<br/>End&#160;Function<br/>
Now&#160;the&#160;question&#160;is, which function&#160;is&#160;faster?&#160;If&#160;you use&#160;a&#160;stopwatch to&#160;see&#160;how&#160;quickly&#160;I&#160;can blink,&#160;the&#160;<br/>results&#160;aren’t&#160;likely&#160;to&#160;be&#160;very&#160;accurate&#160;because&#160;of measurement&#160;errors. It’s&#160;much easier to tell&#160;me&#160;to&#160;blink&#160;as<br/>many&#160;times&#160;as&#160;I&#160;can in&#160;four seconds&#160;or to&#160;time&#160;how&#160;quickly&#160;I&#160;can blink&#160;50 times.&#160;The&#160;code&#160;i<a href="libremacros.html#143">n&#160;Listing&#160;120&#160;<br/></a>does&#160;something similar.&#160;It&#160;sits&#160;in a&#160;tight&#160;loop and calls&#160;each GCD&#160;implementation&#160;5000 times. I&#160;want&#160;to&#160;<br/>know&#160;how&#160;long it&#160;takes&#160;to&#160;call&#160;the&#160;GCD&#160;function&#160;5000 times, but&#160;I’m&#160;actually&#160;timing how&#160;long it&#160;takes&#160;to&#160;<br/>loop 5000 times,&#160;generate&#160;10,000 random&#160;numbers, and call&#160;the&#160;GCD&#160;function&#160;5000 times.&#160;To&#160;compensate&#160;<br/>for this, the&#160;amount&#160;of time&#160;required to&#160;loop 5000 times&#160;and generate&#160;10,000 random&#160;numbers&#160;is&#160;measured.<br/>
<b>TIP</b><br/>
The&#160;test&#160;program&#160;takes a&#160;few&#160;seconds to run, so,&#160;be&#160;patient.<br/>
<i><b>Listing&#160;120.</b>&#160;Time&#160;the&#160;two&#160;different&#160;GCD&#160;methods.</i><br/>
Sub&#160;testGCD<br/>&#160;&#160;Dim&#160;nStartTicks&#160;As&#160;Long&#160; &#160; &#160; &#160;&#160;'When I started timing<br/>&#160;&#160;Dim&#160;nEndTicks&#160;As&#160;Long&#160; &#160; &#160; &#160; &#160;&#160;'When I stopped timing<br/>&#160;&#160;Dim&#160;nLoopTicks&#160;As&#160;Long&#160; &#160; &#160; &#160; &#160;'Ticks to do only the loop<br/>&#160;&#160;Dim&#160;nGCD_1_Ticks&#160;As&#160;Long&#160; &#160; &#160; &#160;'Ticks for GCD_1<br/>&#160;&#160;Dim&#160;nGCD_2_Ticks&#160;As&#160;Long&#160; &#160; &#160; &#160;'Ticks for GCD_2<br/>&#160;&#160;Dim&#160;nMinIts&#160;As&#160;Long&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Number of iterations<br/>&#160;&#160;Dim&#160;x&amp;,&#160;y&amp;,&#160;i&amp;,&#160;n&amp;&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Temporary long numbers<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Hold the output string<br/>
140<br/>
<hr/>
<a name=144></a>&#160;&#160;nMinIts&#160;=&#160;5000&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Set the number of iterations<br/>&#160;&#160;Randomize(2)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Set to a known state<br/>&#160;&#160;nStartTicks&#160;=&#160;GetSystemTicks()&#160;'Start ticks<br/>&#160;&#160;For&#160;i&amp;&#160;=&#160;1&#160;To&#160;nMinIts&#160; &#160; &#160; &#160; &#160;&#160;'Control the number of iterations<br/>&#160; &#160;&#160;x&#160;=&#160;10000&#160;*&#160;Rnd()&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Generate the random data<br/>&#160; &#160;&#160;y&#160;=&#160;10000&#160;*&#160;Rnd()&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Generate the random data<br/>&#160;&#160;Next<br/>&#160;&#160;nEndTicks&#160;=&#160;GetSystemTicks()<br/>&#160;&#160;nLoopTicks&#160;=&#160;nEndTicks&#160;-&#160;nStartTicks<br/>
&#160;&#160;Randomize(2)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Set to a known state<br/>&#160;&#160;nStartTicks&#160;=&#160;GetSystemTicks()&#160;'Start ticks<br/>&#160;&#160;For&#160;i&amp;&#160;=&#160;1&#160;To&#160;nMinIts&#160; &#160; &#160; &#160; &#160;&#160;'Control the number of iterations<br/>&#160; &#160;&#160;x&#160;=&#160;10000&#160;*&#160;Rnd()&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Generate the random data<br/>&#160; &#160;&#160;y&#160;=&#160;10000&#160;*&#160;Rnd()&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Generate the random data<br/>&#160; &#160;&#160;GCD_1(x,&#160;y)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Do the work we really care about<br/>&#160;&#160;Next<br/>&#160;&#160;nEndTicks&#160;=&#160;GetSystemTicks()<br/>&#160;&#160;nGCD_1_Ticks&#160;=&#160;nEndTicks&#160;-&#160;nStartTicks&#160;-&#160;nLoopTicks<br/>
&#160;&#160;Randomize(2)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Set to a known state<br/>&#160;&#160;nStartTicks&#160;=&#160;GetSystemTicks()&#160;'Start ticks<br/>&#160;&#160;For&#160;i&amp;&#160;=&#160;1&#160;To&#160;nMinIts&#160; &#160; &#160; &#160; &#160;&#160;'Control the number of iterations<br/>&#160; &#160;&#160;x&#160;=&#160;10000&#160;*&#160;Rnd()&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Generate the random data<br/>&#160; &#160;&#160;y&#160;=&#160;10000&#160;*&#160;Rnd()&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Generate the random data<br/>&#160; &#160;&#160;GCD_2(x,&#160;y)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Do the work we really care about<br/>&#160;&#160;Next<br/>&#160;&#160;nEndTicks&#160;=&#160;GetSystemTicks()<br/>&#160;&#160;nGCD_2_Ticks&#160;=&#160;nEndTicks&#160;-&#160;nStartTicks&#160;-&#160;nLoopTicks<br/>&#160;&#160;<br/>&#160;&#160;s&#160;=&#160;&#34;Looping &#34;&#160;&amp;&#160;nMinIts&#160;&amp;&#160;&#34; iterations takes &#34;&#160;&amp;&#160;nLoopTicks&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; ticks&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Calling GCD_1 takes &#34;&#160;&amp;&#160;nGCD_1_Ticks&#160;&amp;&#160;&#34; ticks or &#34;&#160;&amp;_<br/>&#160; &#160; &#160;&#160;Format(nMinIts&#160;*&#160;100&#160;/nGCD_1_Ticks,&#160;&#34;#####00.00&#34;)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; Iterations per second&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Calling GCD_2 takes &#34;&#160;&amp;&#160;nGCD_2_Ticks&#160;&amp;&#160;&#34; ticks or &#34;&#160;&amp;_<br/>&#160; &#160; &#160;&#160;Format(nMinIts&#160;*&#160;100&#160;/nGCD_2_Ticks,&#160;&#34;#####00.00&#34;)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; Iterations per second&#34;<br/>
&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Compare GCD&#34;<br/>End&#160;Sub<br/>
One&#160;problem&#160;in writing timing routines&#160;is&#160;determining how&#160;many&#160;iterations&#160;to do. I&#160;frequently&#160;use&#160;computers<br/>of different&#160;speeds.&#160;The&#160;results&#160;i<a href="libremacros.html#145">n&#160;Figure&#160;51&#160;a</a>re&#160;based on my&#160;home&#160;computer running the&#160;macro i<a href="libremacros.html#143">n&#160;Listing&#160;<br/>120.&#160;</a>The&#160;macro in<a href="libremacros.html#143">&#160;Listing 120&#160;m</a>akes&#160;a&#160;specific&#160;number of iterations.&#160;Sometimes&#160;I&#160;use&#160;a&#160;solution&#160;that&#160;limits&#160;<br/>the&#160;iterations&#160;based on time&#160;rather than number of iterations.&#160;This&#160;complicates&#160;the&#160;measurement&#160;of overhead&#160;<br/>and is&#160;left&#160;as&#160;an interesting, but&#160;not&#160;overly&#160;difficult,&#160;problem&#160;for the&#160;reader.<br/>
141<br/>
<hr/>
<a name=145></a><i> </i><br/>
<i><b>Figure&#160;51.</b>&#160;The&#160;improvement&#160;is&#160;about&#160;10 percent.</i><br/>
<i><b>&#160;6.12.&#160;Long&#160;time&#160;intervals&#160;and&#160;special&#160;dates<br/></b></i>It’s&#160;easy&#160;to obtain elapsed time&#160;over long&#160;intervals&#160;by&#160;subtracting date&#160;values.&#160;To&#160;determine&#160;precise&#160;dates&#160;and<br/>intervals,&#160;you&#160;can creatively&#160;use&#160;the&#160;component&#160;pieces. For example,&#160;given the&#160;date, what&#160;is&#160;the&#160;first&#160;day&#160;of&#160;<br/>the&#160;month?&#160;This&#160;is&#160;easy&#160;because&#160;the&#160;first&#160;day&#160;of every&#160;month is&#160;day&#160;1. Use&#160;the&#160;functions&#160;Year and Month&#160;to&#160;<br/>extract&#160;the&#160;year&#160;and month, and then reassemble&#160;the&#160;date&#160;using DateSerial&#160;and set&#160;the&#160;day&#160;to 1.&#160;The&#160;sample&#160;<br/>macro also calls&#160;WeekDayText&#160;shown in<a href="libremacros.html#135">&#160;Listing 110.</a><br/>
<i><b>Listing&#160;121.</b>&#160;First&#160;day&#160;of&#160;the&#160;month.</i><br/>
Function&#160;FirstDayOfMonth(d&#160;As&#160;Date)&#160;As&#160;Date<br/>&#160;&#160;FirstDayOfMonth()&#160;=&#160;DateSerial(Year(d),&#160;Month(d),&#160;1)<br/>End&#160;Function<br/>
Sub&#160;FirstDayOfThisMonth()<br/>&#160;&#160;Dim&#160;d&#160;As&#160;Date<br/>&#160;&#160;d&#160;=&#160;FirstDayOfMonth(Now())<br/>&#160;&#160;MsgBox&#160;&#34;First day of this month (&#34;&#160;&amp;&#160;d&#160;&amp;&#160;&#34;) is a &#34;&#160;&amp;&#160;WeekDayText(d)<br/>End&#160;Sub<br/>
To&#160;find&#160;the&#160;last&#160;day&#160;of a&#160;month,&#160;find the&#160;first&#160;day&#160;of the&#160;next&#160;month and then&#160;subtract&#160;1 from&#160;the&#160;number.&#160;If&#160;<br/>the&#160;current&#160;month&#160;is&#160;December,&#160;set&#160;the&#160;month&#160;to&#160;January&#160;and increment&#160;the&#160;year by&#160;1.<br/>
<i><b>Listing&#160;122.</b>&#160;Last&#160;day&#160;of&#160;the&#160;month.</i><br/>
Function&#160;LastDayOfMonth(d&#160;As&#160;Date)&#160;As&#160;Date<br/>&#160; Dim&#160;nYear&#160;As Integer<br/>&#160; Dim&#160;nMonth&#160;As Integer<br/>&#160;&#160;nYear&#160;= Year(d) &#160; &#160; &#160; &#160;'Current year<br/>&#160;&#160;nMonth&#160;= Month(d) +&#160;1&#160;&#160;'Next month, unless it was December.<br/>&#160; If&#160;nMonth&#160;&gt;&#160;12&#160;Then &#160; &#160;'If it is December then nMonth is now 13<br/>&#160; &#160;&#160;nMonth&#160;=&#160;1&#160; &#160; &#160; &#160; &#160; &#160;'Roll the month back to 1<br/>&#160; &#160;&#160;nYear&#160;=&#160;nYear&#160;+&#160;1&#160; &#160;&#160;'but increment the year<br/>&#160; End If<br/>&#160;&#160;LastDayOfMonth&#160;= CDate(DateSerial(nYear,&#160;nMonth,&#160;1)-1)<br/>End Function<br/>
Sub&#160;LastDayOfThisMonth()<br/>&#160; Dim&#160;d&#160;As Date<br/>&#160;&#160;d&#160;=&#160;LastDayOfMonth(Now())<br/>&#160; MsgBox&#160;&#34;Last day of this month (&#34;&#160;&amp;&#160;d&#160;&amp;&#160;&#34;) is a &#34;&#160;&amp;&#160;WeekDayText(d)<br/>End Sub<br/>
It’s&#160;easy&#160;to find the&#160;first&#160;day&#160;of the&#160;year for any&#160;given date;&#160;it’s&#160;always&#160;January&#160;1 of that&#160;year.&#160;Use&#160;the&#160;Year&#160;<br/>function to&#160;obtain&#160;the&#160;current&#160;year&#160;and then&#160;set&#160;the&#160;day&#160;and month each equal&#160;to&#160;1. Finding the&#160;last&#160;day&#160;of the<br/>year&#160;for any&#160;given date&#160;is&#160;only&#160;marginally&#160;more&#160;difficult.&#160;First,&#160;find the&#160;first&#160;day&#160;of the&#160;next&#160;year by&#160;<br/>
142<br/>
<hr/>
<a name=146></a>incrementing the&#160;year by&#160;1 and setting&#160;the&#160;month&#160;and day&#160;equal&#160;to&#160;1. Subtracting 1 from&#160;the&#160;first&#160;day&#160;of next&#160;<br/>year&#160;provides&#160;the&#160;last&#160;day&#160;of this&#160;year.<br/>
d&#160;=&#160;Now<br/>Print&#160;DateSerial(Year(d),&#160;1,&#160;1)&#160; &#160; &#160; &#160; &#160; &#160; &#160;'01/01/2003<br/>Print&#160;CDate(DateSerial(Year(d)+1,&#160;1,&#160;1)-1)&#160;&#160;'12/31/2003<br/>
Use&#160;the&#160;WeekDay&#160;function&#160;to&#160;find the&#160;first&#160;and last&#160;days&#160;of a&#160;week. Subtract&#160;the&#160;day&#160;of the&#160;week and add 1 to<br/>take&#160;the&#160;date&#160;to Sunday&#160;at&#160;the&#160;beginning of the&#160;current&#160;week.<br/>
d&#160;=&#160;Date<br/>Print&#160;CDate(CDbl(d)&#160;-&#160;WeekDay(d)&#160;+&#160;1)&#160;&#160;'8/10/2003 is a Sunday<br/>Print&#160;CDate(CDbl(d)&#160;-&#160;WeekDay(d)&#160;+&#160;7)&#160;&#160;'8/16/2003 is a Saturday<br/>
You can use&#160;similar date&#160;manipulations&#160;to solve&#160;other date-related problems,&#160;such as&#160;determining&#160;the&#160;work&#160;<br/>week, how&#160;many&#160;days&#160;until&#160;your anniversary,&#160;or the&#160;age&#160;of a&#160;person in&#160;years, months, and days.&#160;<br/>
<i><b>&#160;6.13.&#160;Conclusion<br/></b></i>Although dates&#160;in&#160;OpenOffice.org&#160;Basic&#160;are&#160;straightforward and easy&#160;to&#160;use, you must&#160;take&#160;care&#160;with&#160;dates&#160;<br/>prior&#160;to October 15, 1582.&#160;The&#160;jump from&#160;the&#160;Gregorian and Julian&#160;calendar also may&#160;potentially&#160;cause&#160;<br/>unexpected&#160;problems.&#160;Also take&#160;care&#160;when the&#160;underlying&#160;implementation,&#160;a&#160;Double,&#160;becomes&#160;a&#160;negative&#160;<br/>number;&#160;this&#160;happens&#160;around December 30, 1899.&#160;This&#160;chapter also discussed methods&#160;of timing routines&#160;<br/>and determining specific&#160;dates.<br/>
143<br/>
<hr/>
<a name=147></a><b>&#160;7.&#160;String&#160;Routines<br/></b>This&#160;chapter introduces&#160;the&#160;subroutines&#160;and functions&#160;supported&#160;by&#160;OpenOffice.org&#160;Basic&#160;that&#160;are&#160;related to&#160;<br/>strings.&#160;This&#160;includes&#160;functions&#160;to&#160;manipulate&#160;strings, convert&#160;other data&#160;types&#160;to&#160;strings, and to&#160;perform&#160;<br/>special&#160;formatting.<br/>
Text&#160;data&#160;is&#160;stored in&#160;strings&#160;as&#160;a&#160;sequence&#160;of 16-bit&#160;unsigned integer Unicode&#160;version&#160;2.0 values.&#160;The&#160;<br/>Unicode&#160;Worldwide&#160;Character Standard is&#160;a&#160;set&#160;of binary&#160;codes&#160;representing textual&#160;or script&#160;characters&#160;<br/>designed because&#160;ASCII,&#160;the&#160;original&#160;standard, can handle&#160;only&#160;256 distinct&#160;characters.&#160;The&#160;first&#160;128&#160;<br/>characters&#160;(numbered 0 through 127) correspond to&#160;the&#160;letters&#160;and symbols&#160;on a&#160;standard U.S. keyboard.&#160;The<br/>next&#160;128 characters&#160;(numbered 128 through 255) consist&#160;of special&#160;characters&#160;such as&#160;accent&#160;marks, Latin-<br/>based characters, and a&#160;few&#160;symbols.&#160;The&#160;remaining 65,280 values&#160;—&#160;of which only&#160;about&#160;34,000 are&#160;<br/>currently&#160;used&#160;—&#160;are&#160;used for a&#160;wide&#160;variety&#160;of worldwide&#160;text&#160;characters, mathematical&#160;symbols,&#160;accent&#160;<br/>marks&#160;(diacritics), and technical&#160;symbols.<br/>
OpenOffice.org&#160;has&#160;a&#160;large&#160;number of functions&#160;that&#160;allow&#160;you to manipulate&#160;strings.&#160;These&#160;string-<br/>manipulation operations&#160;range&#160;from&#160;converting uppercase&#160;to&#160;lowercase&#160;(or&#160;vice&#160;versa)&#160;to&#160;selecting substrings<br/>out&#160;of a&#160;longer string.&#160;The&#160;functions&#160;listed in<a href="libremacros.html#147">&#160;Table&#160;48&#160;a</a>re&#160;the&#160;string functions&#160;covered in&#160;this&#160;chapter.&#160;The&#160;<br/>functions&#160;listed&#160;i<a href="libremacros.html#148">n&#160;Table&#160;49&#160;a</a>re&#160;related&#160;to strings&#160;as&#160;well&#160;as&#160;either numerical&#160;or array&#160;manipulations;&#160;these&#160;are<br/>covered in other chapters.<br/>
<i><b>Table&#160;48.</b>&#160;These&#160;string-related functions&#160;are&#160;covered in this&#160;section.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
ASC(str)<br/>
Return the&#160;integer&#160;ASCII&#160;value&#160;of&#160;the&#160;first&#160;character&#160;in the&#160;string.&#160;This supports&#160;16-bit&#160;Unicode<br/>values as well.<br/>
CHR(n)<br/>
Convert&#160;an&#160;ASCII&#160;number&#160;to a&#160;character.<br/>
CStr(obj)<br/>
Convert&#160;standard&#160;types to a&#160;string.<br/>
Format(obj,&#160;format)<br/>
Fancy&#160;formatting;&#160;works only&#160;for&#160;strings.<br/>
Hex(n)<br/>
Return the&#160;hexadecimal&#160;representation&#160;of&#160;a&#160;number&#160;as a&#160;string.<br/>
InStr(str,&#160;str)<br/>
Attempt&#160;to find string&#160;2 in&#160;string&#160;1.&#160;Returns&#160;0 if&#160;not&#160;found&#160;and&#160;starting&#160;location if&#160;it&#160;is found.&#160;<br/>
InStr(start, str,&#160;str)<br/>
The&#160;optional&#160;start&#160;argument&#160;indicates where&#160;to start&#160;looking.&#160;The&#160;default&#160;value&#160;for&#160;mode&#160;is 1&#160;<br/>
(case-insensitive&#160;comparison).&#160;Setting&#160;mode&#160;to 0 performs&#160;a&#160;case-sensitive&#160;comparison.<br/>
InStr(start, str,&#160;str,&#160;<br/>mode)<br/>
InStrRev(str,&#160;find,&#160;start,<br/>
Return the&#160;position of&#160;the&#160;first&#160;occurrence&#160;of&#160;one&#160;string&#160;within&#160;another,&#160;starting&#160;from&#160;the&#160;right&#160;<br/>
mode)<br/>
side&#160;of&#160;the&#160;string. Only&#160;available&#160;with&#160;“Option&#160;VBASupport&#160;1”.&#160;Start&#160;and&#160;mode&#160;are&#160;optional.<br/>
Join(s())<br/>
Concatenate&#160;the&#160;array&#160;elements,&#160;separated&#160;by&#160;the&#160;optional&#160;string&#160;delimiter,&#160;and&#160;return the&#160;value<br/>
Join(s(),&#160;str)<br/>
as a&#160;string.&#160;The&#160;default&#160;delimiter&#160;is&#160;a&#160;single&#160;space.&#160;Inverse&#160;of&#160;the&#160;Split&#160;function.<br/>
LCase(str)<br/>
Return a&#160;lowercase&#160;copy&#160;of&#160;the&#160;string.<br/>
Left(str,&#160;n)<br/>
Return the&#160;leftmost&#160;n&#160;characters&#160;from&#160;the&#160;string.<br/>
Len(str)<br/>
Return the&#160;length of&#160;the&#160;string.<br/>
LSet&#160;str1&#160;=&#160;str2<br/>
Left-justify&#160;a&#160;string&#160;into the&#160;space&#160;taken by&#160;another&#160;string.<br/>
LTrim(str)<br/>
Return a&#160;copy&#160;of&#160;the&#160;string&#160;with&#160;all&#160;leading&#160;spaces removed.<br/>
Mid(str,&#160;start)<br/>
Return the&#160;substring, starting&#160;at&#160;start. If&#160;the&#160;length is&#160;omitted,&#160;the&#160;entire&#160;end of&#160;the&#160;string&#160;is&#160;<br/>
Mid(str,&#160;start,&#160;len)<br/>
returned.&#160;If&#160;the&#160;final&#160;string&#160;argument&#160;is&#160;included,&#160;this replaces the&#160;specified&#160;portion of&#160;the&#160;first&#160;<br/>string&#160;with the&#160;last&#160;string.<br/>
Mid(str,&#160;start,&#160;len, str)<br/>
Oct(n)<br/>
Return the&#160;octal&#160;representation of&#160;a&#160;number&#160;as&#160;a&#160;string.<br/>
144<br/>
<hr/>
<a name=148></a><i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
Replace(str,&#160;find,&#160;rpl,&#160;<br/>
Search str&#160;for&#160;find and&#160;replace&#160;it&#160;with&#160;rpl.&#160;Optionally,&#160;specify&#160;the&#160;start,&#160;count, and mode.&#160;<br/>
start, count, mode)<br/>
Right(str,&#160;n)<br/>
Return the&#160;rightmost&#160;n&#160;characters.<br/>
RSet&#160;str1&#160;=&#160;str2<br/>
Right-justify&#160;a&#160;string&#160;into the&#160;space&#160;taken by&#160;another&#160;string.<br/>
RTrim(str)<br/>
Return a&#160;copy&#160;of&#160;the&#160;string&#160;with&#160;all&#160;trailing&#160;spaces removed.<br/>
Space(n)<br/>
Return a&#160;string&#160;with&#160;the&#160;number&#160;of&#160;specified&#160;spaces.<br/>
Split(str)<br/>
Split&#160;a&#160;string&#160;into an&#160;array&#160;based&#160;on an&#160;optional&#160;delimiter.&#160;Inverse&#160;of&#160;the&#160;Join function.<br/>
Split(str,&#160;str)<br/>
Str(n)<br/>
Convert&#160;a&#160;number&#160;to a&#160;string&#160;with&#160;no localization.<br/>
StrComp(s1,&#160;s2)<br/>
Compare&#160;two&#160;strings returning&#160;-1,&#160;0,&#160;or&#160;1 if&#160;the&#160;first&#160;string&#160;is less than,&#160;equal&#160;to, or&#160;greater&#160;than<br/>
StrComp(s1,&#160;s2, mode)<br/>
the&#160;second&#160;in&#160;alphabetical&#160;order.&#160;Set&#160;the&#160;optional&#160;third&#160;argument&#160;to zero&#160;for&#160;a&#160;case-insensitive&#160;<br/>comparison.&#160;The&#160;default&#160;is 1 for&#160;a&#160;case-sensitive&#160;comparison.<br/>
StrConv(str,&#160;mode[,&#160;<br/>
Converts a&#160;string&#160;based on the&#160;mode:&#160;1=upper,&#160;2=lower,&#160;4=wide,&#160;8=narrow,&#160;16=Katakana,&#160;<br/>
local])<br/>
32=Hiragana,&#160;64=to&#160;unicode,&#160;128=from&#160;unicode.<br/>
String(n,&#160;char)<br/>
Return a&#160;string&#160;with&#160;a&#160;single&#160;character&#160;repeated&#160;multiple&#160;times.&#160;The&#160;first&#160;argument&#160;is the&#160;<br/>
String(n,&#160;ascii)<br/>
number&#160;of&#160;times to repeat;&#160;the&#160;second&#160;argument&#160;is the&#160;character&#160;or&#160;ASCII&#160;value.<br/>
StrReverse<br/>
Reverse&#160;a&#160;string. Must&#160;use&#160;“Option&#160;VBASupport&#160;1”,&#160;or&#160;precede&#160;it&#160;with&#160;<br/>CompatibiltyMode(True).<br/>
Trim(str)<br/>
Return a&#160;copy&#160;of&#160;the&#160;string&#160;with&#160;all&#160;leading&#160;and trailing&#160;spaces removed.<br/>
UCase(str)<br/>
Return an uppercase&#160;copy&#160;of&#160;the&#160;string.<br/>
Val(str)<br/>
Convert&#160;a&#160;string&#160;to a&#160;double.&#160;This is very&#160;tolerant&#160;to&#160;non-numeric&#160;text.<br/>
The&#160;subroutines&#160;and functions&#160;related to&#160;string&#160;handling in&#160;OOo Basic&#160;are&#160;listed in<a href="libremacros.html#147">&#160;Table&#160;48. S</a>ome&#160;of these&#160;<br/>functions&#160;(see<a href="libremacros.html#148">&#160;Table&#160;49) ha</a>ve&#160;in-depth coverage&#160;in other chapters, because&#160;they&#160;are&#160;directly&#160;related to&#160;the&#160;<br/>content&#160;in those&#160;chapters.&#160;They&#160;are&#160;covered briefly&#160;near the&#160;end of this&#160;chapter,&#160;in&#160;the&#160;section&#160;titled&#160;<br/>“Converting&#160;data&#160;to a&#160;string.”<br/>
<i><b>Table&#160;49.</b>&#160;These&#160;string-related functions&#160;are&#160;covered in other&#160;chapters.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Covered&#160;In</b></i><br/>
<i><b>Description</b></i><br/>
Join(s())<br/>
<a href="libremacros.html#116">5Array&#160;Routines</a><br/>
Concatenate&#160;the&#160;array&#160;elements, separated by&#160;the&#160;optional&#160;string&#160;delimiter,<br/>
Join(s(),&#160;str)<br/>
and return the&#160;value&#160;as&#160;a&#160;string.<br/>
Split(str)<br/>
<a href="libremacros.html#116">5Array&#160;Routines</a><br/>
Split&#160;a&#160;string&#160;into an array&#160;based on an optional&#160;delimiter.<br/>
Split(str,&#160;str)<br/>
CStr(obj)<br/>
<a href="libremacros.html#97">4Numerical&#160;Routines</a><br/>
Convert&#160;standard types to&#160;a&#160;string.<br/>
Str(n)<br/>
<a href="libremacros.html#97">4Numerical&#160;Routines</a><br/>
Convert&#160;a&#160;number&#160;to a&#160;string&#160;with no&#160;localization.<br/>
Hex(n)<br/>
<a href="libremacros.html#97">4Numerical&#160;Routines</a><br/>
Return the&#160;hexadecimal&#160;representation of&#160;a&#160;number&#160;as a&#160;string.<br/>
Oct(n)<br/>
<a href="libremacros.html#97">4Numerical&#160;Routines</a><br/>
Return the&#160;octal&#160;representation of&#160;a&#160;number&#160;as a&#160;string.<br/>
Val(str)<br/>
<a href="libremacros.html#97">4Numerical&#160;Routines</a><br/>
Convert&#160;a&#160;string&#160;to a&#160;double.&#160;This is&#160;very&#160;tolerant&#160;to non-numeric&#160;text.<br/>
145<br/>
<hr/>
<a name=149></a><i><b>&#160;7.1.&#160;ASCII&#160;and&#160;Unicode&#160;values<br/></b></i>In&#160;the&#160;early&#160;days&#160;of computers&#160;there&#160;were&#160;different&#160;types&#160;of data-processing equipment,&#160;and there&#160;was&#160;no&#160;<br/>common&#160;method&#160;of representing text.&#160;To&#160;alleviate&#160;this&#160;problem, the&#160;American National&#160;Standards&#160;Institute&#160;<br/>(ANSI)&#160;proposed the&#160;American Standard Code&#160;for Information&#160;Interchange&#160;(ASCII)&#160;in 1963.&#160;The&#160;standard&#160;<br/>was&#160;finalized&#160;in 1968 as&#160;a&#160;mapping of 128 characters, numbers, punctuation,&#160;and control&#160;codes&#160;to the&#160;<br/>numbers&#160;from&#160;0 to&#160;127 (see<a href="libremacros.html#149">&#160;Table&#160;50)</a>.&#160;The&#160;computer-minded&#160;reader may&#160;notice&#160;that&#160;this&#160;requires&#160;7 bits&#160;and&#160;<br/>does&#160;not&#160;use&#160;an entire&#160;byte.<br/>
<i><b>Table&#160;50.</b>&#160;The&#160;original&#160;128&#160;ASCII characters.</i><br/>
<b>0</b><br/>
<b>1</b><br/>
<b>2</b><br/>
<b>3</b><br/>
<b>4</b><br/>
<b>5</b><br/>
<b>6</b><br/>
<b>7</b><br/>
<b>8</b><br/>
<b>9</b><br/>
<b>A</b><br/>
<b>B</b><br/>
<b>C</b><br/>
<b>D</b><br/>
<b>E</b><br/>
<b>F</b><br/>
<b>0</b><br/>
NUL<br/>
SOH<br/>
STX<br/>
ETX<br/>
EOT<br/>
ENQ&#160;ACK<br/>
BEL<br/>
BS<br/>
HT<br/>
LF<br/>
VT<br/>
FF<br/>
CR<br/>
SO<br/>
SI<br/>
<b>1</b><br/>
DLE<br/>
DC1<br/>
DC2<br/>
DC3<br/>
DC4<br/>
NAK<br/>
SYN<br/>
ETB<br/>
CAN<br/>
EM<br/>
SUB<br/>
ESC<br/>
FS<br/>
GS<br/>
RS<br/>
US<br/>
<b>2</b><br/>
SP<br/>
!<br/>
“<br/>
#<br/>
$<br/>
%<br/>
&amp;<br/>
'<br/>
(<br/>
)<br/>
*<br/>
+<br/>
,<br/>
-<br/>
.<br/>
/<br/>
<b>3</b><br/>
0<br/>
1<br/>
2<br/>
3<br/>
4<br/>
5<br/>
6<br/>
7<br/>
8<br/>
9<br/>
:<br/>
;<br/>
&lt;<br/>
=<br/>
&gt;<br/>
?<br/>
<b>4</b><br/>
@<br/>
A<br/>
B<br/>
C<br/>
D<br/>
E<br/>
F<br/>
G<br/>
H<br/>
I<br/>
J<br/>
K<br/>
L<br/>
M<br/>
N<br/>
O<br/>
<b>5</b><br/>
P<br/>
Q<br/>
R<br/>
S<br/>
T<br/>
U<br/>
V<br/>
W<br/>
X<br/>
Y<br/>
z<br/>
[<br/>
\<br/>
]<br/>
^<br/>
_<br/>
<b>6</b><br/>
`<br/>
a<br/>
b<br/>
c<br/>
d<br/>
e<br/>
f<br/>
g<br/>
h<br/>
i<br/>
j<br/>
k<br/>
l<br/>
m<br/>
n<br/>
o<br/>
<b>7</b><br/>
p<br/>
q<br/>
r<br/>
s<br/>
t<br/>
u<br/>
v<br/>
w<br/>
x<br/>
y<br/>
z<br/>
{<br/>
|<br/>
}<br/>
~<br/>
DEL<br/>
<a href="libremacros.html#149">Table&#160;50&#160;l</a>ists&#160;the&#160;original&#160;127&#160;ASCII&#160;characters.&#160;The&#160;top&#160;row&#160;and the&#160;left&#160;column are&#160;used to&#160;identify&#160;the&#160;<br/>hexadecimal&#160;ASCII&#160;value. For example,&#160;the&#160;capital&#160;letter&#160;A&#160;has&#160;an&#160;ASCII&#160;value&#160;of 41 in hexadecimal&#160;format,<br/>and z&#160;has&#160;an&#160;ASCII&#160;value&#160;of 5A. If&#160;more&#160;than&#160;one&#160;letter occupies&#160;a&#160;box, that&#160;value&#160;represents&#160;a&#160;special&#160;<br/>command&#160;character (see<a href="libremacros.html#149">&#160;Table&#160;51). S</a>ome&#160;of these&#160;special&#160;commands&#160;are&#160;designed for communications,&#160;<br/>some&#160;for file&#160;formats,&#160;and some&#160;are&#160;even available&#160;on the&#160;keyboard.<br/>
<i><b>Table&#160;51.</b>&#160;Non-printable&#160;ASCII characters.</i><br/>
<i><b>Hex</b></i><br/>
<i><b>DEC</b></i><br/>
<i><b>Symbol</b></i><br/>
<i><b>Description</b></i><br/>
00<br/>
0<br/>
NUL<br/>
Null, usually&#160;signifying&#160;nothing<br/>
01<br/>
1<br/>
SOH<br/>
Start&#160;of&#160;heading<br/>
02<br/>
2<br/>
STX<br/>
Start&#160;of&#160;text<br/>
03<br/>
3<br/>
ETX<br/>
End of&#160;text<br/>
04<br/>
4<br/>
EOT<br/>
End of&#160;transmission&#160;—&#160;not&#160;the&#160;same&#160;as&#160;ETB<br/>
05<br/>
5<br/>
ENQ<br/>
Enquiry<br/>
06<br/>
6<br/>
ACK<br/>
Acknowledge&#160;—&#160;I&#160;am&#160;here&#160;or&#160;data&#160;successfully&#160;received<br/>
07<br/>
7<br/>
BEL<br/>
Bell&#160;—&#160;Causes teletype&#160;machines and many&#160;terminals to&#160;ring&#160;a&#160;bell<br/>
08<br/>
8<br/>
BS&#160;<br/>
Backspace&#160;—&#160;Moves&#160;the&#160;cursor&#160;or&#160;print&#160;head backward&#160;(left)&#160;one&#160;space<br/>
09<br/>
9<br/>
TAB<br/>
Horizontal&#160;tab&#160;—&#160;Moves&#160;the&#160;cursor&#160;(or&#160;print&#160;head)&#160;right&#160;to the&#160;next&#160;tab&#160;<br/>
stop<br/>
0A<br/>
10<br/>
LF&#160;<br/>
Line&#160;feed or&#160;new&#160;line&#160;—&#160;Moves the&#160;cursor&#160;(or&#160;print&#160;head)&#160;to a&#160;new&#160;line<br/>
0B<br/>
11<br/>
VT&#160;<br/>
Vertical&#160;tab<br/>
0C<br/>
12<br/>
FF&#160;<br/>
Form&#160;feed&#160;—&#160;Advances paper&#160;to the&#160;top&#160;of&#160;the&#160;next&#160;page<br/>
0D<br/>
13<br/>
CR&#160;<br/>
Carriage&#160;return&#160;—&#160;Moves&#160;the&#160;cursor&#160;(or&#160;print&#160;head)&#160;to&#160;the&#160;left&#160;margin<br/>
0E<br/>
14<br/>
SO&#160;<br/>
Shift&#160;out&#160;—&#160;Switches the&#160;output&#160;device&#160;to an alternate&#160;character&#160;set<br/>
146<br/>
<hr/>
<a name=150></a><i><b>Hex</b></i><br/>
<i><b>DEC</b></i><br/>
<i><b>Symbol</b></i><br/>
<i><b>Description</b></i><br/>
0F<br/>
15<br/>
SI&#160;<br/>
Shift&#160;in&#160;—&#160;Switches the&#160;output&#160;device&#160;back to the&#160;default&#160;character&#160;set<br/>
10<br/>
16<br/>
DLE<br/>
Data&#160;link&#160;escape<br/>
11<br/>
17<br/>
DC1<br/>
Device&#160;control&#160;1<br/>
12<br/>
18<br/>
DC2<br/>
Device&#160;control&#160;2<br/>
13<br/>
19<br/>
DC3<br/>
Device&#160;control&#160;3<br/>
14<br/>
20<br/>
DC4<br/>
Device&#160;control&#160;4<br/>
15<br/>
21<br/>
NAK<br/>
Negative&#160;acknowledge<br/>
16<br/>
22<br/>
SYN<br/>
Synchronous&#160;idle<br/>
17<br/>
23<br/>
ETB<br/>
End of&#160;transmission block&#160;—&#160;not&#160;the&#160;same&#160;as&#160;EOT&#160;&#160;<br/>
18<br/>
24<br/>
CAN<br/>
Cancel&#160;&#160;&#160; &#160;&#160;<br/>
19<br/>
25<br/>
EM&#160;<br/>
End of&#160;medium<br/>
1A<br/>
26<br/>
SUB<br/>
Substitute<br/>
1B<br/>
27<br/>
ESC<br/>
Escape&#160;—&#160;This is&#160;the&#160;Esc&#160;key&#160;on your&#160;keyboard<br/>
1C<br/>
28<br/>
FS&#160;<br/>
File&#160;separator<br/>
1D<br/>
29<br/>
GS&#160;<br/>
Group&#160;separator<br/>
1E<br/>
30<br/>
RS&#160;<br/>
Record&#160;separator<br/>
1F<br/>
31<br/>
US&#160;<br/>
Unit&#160;separator<br/>
7F<br/>
127<br/>
DEL<br/>
Delete&#160;—&#160;This&#160;is the&#160;Del&#160;key&#160;on your&#160;keyboard<br/>
For&#160;most&#160;computers, the&#160;smallest&#160;easily&#160;stored and retrieved piece&#160;of data&#160;is&#160;a&#160;byte, which&#160;is&#160;composed of 8&#160;<br/>bits.&#160;The&#160;characters&#160;in<a href="libremacros.html#149">&#160;Table&#160;50&#160;r</a>equire&#160;only&#160;7 bits.&#160;To&#160;avoid&#160;wasting space, the&#160;Extended&#160;ASCII&#160;characters&#160;<br/>were&#160;introduced;&#160;these&#160;used the&#160;numbers&#160;128 through 255.&#160;Although these&#160;characters&#160;introduce&#160;special,&#160;<br/>mathematical, graphic, and foreign characters, it&#160;just&#160;wasn’t&#160;enough to&#160;satisfy&#160;international&#160;use.&#160;Around&#160;<br/>1986, Xerox&#160;started working&#160;to&#160;extend the&#160;character set&#160;to work with&#160;Asian characters.&#160;This&#160;work eventually&#160;<br/>led to&#160;the&#160;current&#160;Unicode&#160;set, which uses&#160;16-bit&#160;integers&#160;and allows&#160;for 65,536 unique&#160;characters.<br/>
OOo stores&#160;characters&#160;as&#160;16-bit&#160;unsigned integer Unicode&#160;values.&#160;The&#160;ASC and CHR functions&#160;convert&#160;<br/>between the&#160;integer value&#160;and the&#160;character value, for example, between 65 and&#160;A. Use&#160;the&#160;ASC&#160;function to&#160;<br/>determine&#160;the&#160;numerical&#160;ASCII&#160;value&#160;of the&#160;first&#160;character in&#160;a&#160;string.&#160;The&#160;return value&#160;is&#160;a&#160;16-bit&#160;integer&#160;<br/>allowing for Unicode&#160;values. Only&#160;the&#160;first&#160;character in&#160;the&#160;string is&#160;used;&#160;the&#160;rest&#160;of the&#160;characters&#160;are&#160;<br/>ignored.&#160;A&#160;run-time&#160;error occurs&#160;if the&#160;string has&#160;zero length.&#160;This&#160;is&#160;essentially&#160;the&#160;inverse&#160;of the&#160;CHR$&#160;<br/>function, which converts&#160;the&#160;number back into&#160;a&#160;character.&#160;<br/>
<b>TIP</b><br/>
The&#160;CHR&#160;function is&#160;frequently&#160;written as CHR$. In&#160;Visual&#160;Basic,&#160;CHR$ returns a&#160;string&#160;and&#160;can’t&#160;handle&#160;<br/>null&#160;input&#160;values, and&#160;CHR&#160;returns a&#160;variant&#160;that’s&#160;able&#160;to&#160;accept&#160;and&#160;propagate&#160;null&#160;values. In&#160;OOo&#160;Basic,&#160;<br/>
they&#160;are&#160;the&#160;same;&#160;they&#160;both return strings and they&#160;both generate&#160;a&#160;run-time&#160;error&#160;with a&#160;null&#160;input&#160;value.<br/>
Use&#160;the&#160;CHR function&#160;to&#160;convert&#160;a&#160;16-bit&#160;ASCII&#160;value&#160;to&#160;the&#160;character that&#160;it&#160;represents.&#160;This&#160;is&#160;useful&#160;when&#160;<br/>you&#160;want&#160;to&#160;insert&#160;special&#160;characters&#160;into a&#160;string. For example,&#160;CHR(10) is&#160;the&#160;new-line&#160;character.&#160;The&#160;<br/>CHR function&#160;is&#160;the&#160;inverse&#160;of the&#160;ASC&#160;function.&#160;Although the&#160;ASC&#160;function returns&#160;the&#160;Unicode&#160;numbers,&#160;<br/>these&#160;numbers&#160;are&#160;frequently&#160;generically&#160;referred to as&#160;“the&#160;ASCII&#160;value.”&#160;Strictly&#160;speaking, this&#160;is&#160;incorrect,<br/>but&#160;it’s&#160;a&#160;widely&#160;used slang expression.&#160;The&#160;numbers&#160;correspond directly&#160;to&#160;the&#160;ASCII&#160;values&#160;for the&#160;<br/>
147<br/>
<hr/>
<a name=151></a>numbers&#160;0 through 255, and having used the&#160;terminology&#160;for years, programmers&#160;aren’t&#160;likely&#160;to&#160;stop. So,&#160;<br/>when you&#160;see&#160;the&#160;term&#160;“ASCII&#160;value”&#160;in&#160;this&#160;book, think&#160;“Unicode&#160;value.”<br/>
<i><b>Listing&#160;123.</b>&#160;Demonstrate&#160;new line.<br/></i>Sub&#160;ShowChrAsc<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Print&#160;CHR$(65)&#160; &#160; &#160; &#160; &#160; &#160; &#160;'A<br/>&#160;&#160;Print&#160;ASC(&#34;Andrew&#34;)&#160; &#160; &#160; &#160;&#160;'65<br/>&#160;&#160;s&#160;=&#160;&#34;1&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;2&#34;&#160; &#160;'New line between 1 and 2<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
Use&#160;the&#160;MsgBox&#160;statement&#160;to print&#160;strings that&#160;contain CHR$(10)&#160;or&#160;CHR$(13)&#160;— they&#160;both cause&#160;OOo&#160;<br/>
Basic&#160;to print&#160;a&#160;new&#160;line.&#160;The&#160;Print&#160;statement&#160;displays a&#160;new&#160;dialog for&#160;each new&#160;line.&#160;MsgBox, however,&#160;<br/>properly&#160;displays&#160;new&#160;lines&#160;in&#160;a&#160;single&#160;dialog.<br/>
While&#160;attempting to&#160;decipher the&#160;internal&#160;functions&#160;of OpenOffice.org, I&#160;frequently&#160;find strings&#160;that&#160;contain&#160;<br/>characters&#160;that&#160;aren’t&#160;immediately&#160;visible, such as&#160;trailing spaces, new&#160;lines, and carriage&#160;returns.&#160;<br/>Converting the&#160;string&#160;to&#160;a&#160;sequence&#160;of&#160;ASCII&#160;characters&#160;simplifies&#160;the&#160;process&#160;of recognizing the&#160;true&#160;<br/>contents&#160;of the&#160;string. See<a href="libremacros.html#151">&#160;Listing 124&#160;and&#160;Figure&#160;52.</a><br/>
<i><b>Listing&#160;124.</b>&#160;Convert&#160;a string&#160;to&#160;ASCII.<br/></i>Sub&#160;ExampleStringToASCII<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;s&#160;=&#160;&#34;AB&#34;&#34;&#34;&#34; &#34;&#34;&#34;&#34;BA&#34;<br/>&#160;&#160;MsgBox&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;StringToASCII(s),&#160;0,&#160;&#34;String To ASCII&#34;<br/>End&#160;Sub<br/>
Function&#160;StringToASCII(sInput$)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;For&#160;i&#160;=&#160;1&#160;To&#160;Len(sInput$)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(ASC(Mid(sInput$,&#160;i,&#160;1)))&#160;&amp;&#160;&#34; &#34;<br/>&#160;&#160;Next<br/>&#160;&#160;StringToASCII&#160;=&#160;s<br/>End&#160;Function<br/>
<i><b>Figure&#160;52.</b>&#160;A&#160;string&#160;followed by&#160;its&#160;corresponding&#160;ASCII values:&#160;A=65, B=66, &#34;=34, and so on ...</i><br/>
On more&#160;than&#160;one&#160;occasion, I&#160;needed to know&#160;exactly&#160;how&#160;OOo stored data&#160;in&#160;a&#160;text&#160;document.&#160;One&#160;<br/>common&#160;example&#160;is&#160;trying to&#160;manipulate&#160;new&#160;lines&#160;and new&#160;paragraphs&#160;in a&#160;manner not&#160;easily&#160;supported by&#160;<br/>regular expressions.&#160;The&#160;subroutine&#160;in<a href="libremacros.html#152">&#160;Listing 125&#160;di</a>splays&#160;the&#160;currently&#160;selected&#160;text&#160;as&#160;a&#160;string of&#160;ASCII&#160;<br/>values.&#160;The&#160;important&#160;thing to&#160;learn in this&#160;chapter is&#160;how&#160;to view&#160;the&#160;ASCII&#160;values&#160;associated&#160;with the&#160;text.&#160;<br/>This&#160;will&#160;show&#160;the&#160;characters&#160;used between paragraphs, for example.&#160;The&#160;methods&#160;to&#160;properly&#160;retrieve&#160;and&#160;<br/>manipulate&#160;selected&#160;text&#160;are&#160;covered later.&#160;To&#160;test&#160;this&#160;macro, select&#160;run the&#160;macro.<br/>
148<br/>
<hr/>
<a name=152></a><i><b>Listing&#160;125.</b>&#160;Display&#160;the&#160;selected&#160;text&#160;as&#160;ASCII characters.<br/></i>Sub&#160;SelectedTextAsASCII()<br/>&#160; &#160;&#160;Dim&#160;vSelections&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Multiple disjointed selections<br/>&#160;&#160;Dim&#160;vSel&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'A single selection<br/>&#160;&#160;Dim&#160;vCursor&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'OOo document cursor<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Temporary utility string variable<br/>&#160;&#160;Dim&#160;bIsSelected&#160;As&#160;Boolean&#160;&#160;'Is any text selected?<br/>&#160;&#160;bIsSelected&#160;=&#160;True&#160; &#160; &#160; &#160; &#160;&#160;'Assume that text is selected<br/>&#160;&#160;<br/>&#160;&#160;'The current selection in the current controller.&#160;<br/>&#160;&#160;'If there is no current controller, it returns NULL.<br/>&#160;&#160;'Thiscomponent refers to the current document<br/>&#160;&#160;vSelections&#160;=&#160;ThisComponent.getCurrentSelection()<br/>&#160;&#160;If&#160;IsNull(vSelections)&#160;OR&#160;IsEmpty(vSelections)&#160;Then&#160;<br/>&#160; &#160;&#160;bIsSelected&#160;=&#160;False<br/>&#160;&#160;ElseIf&#160;vSelections.getCount()&#160;=&#160;0&#160;&#160;Then&#160;<br/>&#160; &#160;&#160;bIsSelected&#160;=&#160;False<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;If&#160;NOT&#160;bIsSelected&#160;Then&#160; &#160; &#160; &#160;'If nothing is selected then say so&#160;<br/>&#160; &#160;&#160;Print&#160;&#34;Nothing is selected&#34;&#160;'and then exit the subroutine&#160;<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;'The selections are numbered from zero<br/>&#160;&#160;'Print the ASCII values of each<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;vSelections.getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;vSel&#160;=&#160;vSelections.getByIndex(i)<br/>&#160; &#160;&#160;vCursor&#160;=&#160;ThisComponent.Text.CreateTextCursorByRange(vSel)<br/>&#160; &#160;&#160;s&#160;=&#160;vCursor.getString()<br/>&#160; &#160;&#160;If&#160;Len(s)&#160;&gt;&#160;0&#160;Then<br/>&#160; &#160; &#160;&#160;MsgBox&#160;StringToASCII(vCursor.getString()),&#160;0,&#160;&#34;ASCII of Selection &#34;&#160;&amp;&#160;i<br/>&#160; &#160;&#160;ElseIf&#160;vSelections.getCount()&#160;=&#160;1&#160;Then<br/>&#160; &#160; &#160;&#160;Print&#160;&#34;Nothing is selected&#34;<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
<i><b>&#160;7.2.&#160;Standard&#160;string&#160;functions<br/></b></i>The&#160;comparison operators&#160;(=, &lt;, &lt;=, &gt;, &gt;=, and &lt;&gt;) work with&#160;strings&#160;and numbers&#160;performing a&#160;case-<br/>sensitive&#160;comparisons.&#160;This&#160;means&#160;that&#160;the&#160;strings&#160;“a”&#160;and “A”&#160;are&#160;not&#160;equal.&#160;The&#160;built-in StrComp&#160;function&#160;<br/>can compare&#160;strings&#160;with&#160;and without&#160;case&#160;sensitivity.&#160;The&#160;StrComp&#160;function, which defaults&#160;to&#160;a&#160;case-<br/>sensitive&#160;comparison, returns&#160;-1, 0, or 1 if the&#160;first&#160;string argument&#160;is&#160;less&#160;than, equal&#160;to, or greater than the&#160;<br/>second string argument. Set&#160;the&#160;optional&#160;third argument&#160;to zero&#160;for a&#160;case-insensitive&#160;comparison.<br/>
<b>TIP</b><br/>
Use&#160;StrComp(string1,&#160;string2,&#160;0)&#160;to alphabetize&#160;strings&#160;using&#160;a&#160;locale&#160;based&#160;case-sensitive&#160;compare.<br/>
The&#160;following&#160;pseudo code&#160;shows&#160;a&#160;simplified&#160;version of how&#160;StrComp&#160;could work for a&#160;case-sensitive&#160;<br/>comparison.&#160;A&#160;case-insensitive&#160;comparison&#160;would&#160;convert&#160;both&#160;strings&#160;to&#160;all&#160;uppercase&#160;before&#160;performing&#160;<br/>the&#160;comparison;&#160;I&#160;have&#160;no idea&#160;if StrComp&#160;is&#160;locale&#160;specific.<br/>
149<br/>
<hr/>
<a name=153></a>Let&#160;s1&#160;=&#160;string1<br/>Let&#160;s2&#160;=&#160;string2<br/>Let&#160;min_len&#160;=&#160;minimum(Len(s1),&#160;Len(s2))<br/>For&#160;i&#160;=&#160;1&#160;To&#160;min_len<br/>&#160;&#160;If&#160;ASC(Mid(s1,&#160;i,&#160;1))&#160;&lt;&#160;ASC(Mid(s2,&#160;i,&#160;1))&#160;Then<br/>&#160; &#160;&#160;set&#160;return&#160;value&#160;to&#160;-1<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;ASC(Mid(s1,&#160;i,&#160;1))&#160;&gt;&#160;ASC(Mid(s2,&#160;i,&#160;1))&#160;Then<br/>&#160; &#160;&#160;set&#160;return&#160;value&#160;to&#160;1<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>Next<br/>If&#160;Len(s1)&#160;&lt;&#160;Len(s2)&#160;Then<br/>&#160;&#160;set&#160;return&#160;value&#160;to&#160;-1<br/>&#160;&#160;Exit&#160;Function<br/>End&#160;If<br/>If&#160;Len(s1)&#160;&gt;&#160;Len(s2)&#160;Then<br/>&#160;&#160;set&#160;return&#160;value&#160;to&#160;1<br/>&#160;&#160;Exit&#160;Function<br/>End&#160;If<br/>set&#160;return&#160;value&#160;to&#160;0<br/>Exit&#160;Function<br/>
The&#160;numerical&#160;Unicode&#160;value&#160;of the&#160;first&#160;character in&#160;the&#160;first&#160;string is&#160;compared to&#160;the&#160;numerical&#160;Unicode&#160;<br/>value&#160;of the&#160;first&#160;character in&#160;the&#160;second string. If&#160;the&#160;first&#160;character is&#160;numerically&#160;less&#160;than&#160;the&#160;second&#160;<br/>character,&#160;-1 is&#160;returned. If&#160;the&#160;first&#160;character is&#160;numerically&#160;greater than the&#160;second character,&#160;1 is&#160;returned.&#160;<br/>If&#160;the&#160;first&#160;character in&#160;each string&#160;is&#160;the&#160;same, the&#160;second character in each string is&#160;compared. If&#160;the&#160;<br/>corresponding numerical&#160;Unicode&#160;value&#160;of each character is&#160;the&#160;same&#160;and the&#160;strings&#160;are&#160;the&#160;same&#160;length,&#160;0&#160;<br/>is&#160;returned. If&#160;corresponding&#160;characters&#160;all&#160;match,&#160;but&#160;the&#160;strings&#160;are&#160;of different&#160;lengths,&#160;the&#160;shorter string is&#160;<br/>considered less&#160;than&#160;the&#160;longer string.<br/>
<i><b>Listing&#160;126.</b>&#160;Demonstrate&#160;StrComp.<br/></i>Print&#160;StrComp(&#160;&#34;A&#34;,&#160;&#34;AA&#34;)&#160;&#160;'-1 because &#160;&#34;A&#34; &lt; &#34;AA&#34;<br/>Print&#160;StrComp(&#34;AA&#34;,&#160;&#34;AA&#34;)&#160;&#160;' 0 because &#34;AA&#34; = &#34;AA&#34;<br/>Print&#160;StrComp(&#34;AA&#34;,&#160;&#34;A&#34;)&#160; &#160;' 1 because &#34;AA&#34; &gt; &#160;&#34;A&#34;<br/>
Print&#160;StrComp(&#160;&#34;a&#34;,&#160;&#34;A&#34;)&#160; &#160;' 1 because &#160;&#34;a&#34; &gt; &#34;A&#34;<br/>Print&#160;StrComp(&#160;&#34;a&#34;,&#160;&#34;A&#34;,&#160;1)' 1 because &#160;&#34;a&#34; &gt; &#34;A&#34;<br/>Print&#160;StrComp(&#160;&#34;a&#34;,&#160;&#34;A&#34;,&#160;0)' 0 because &#160;&#34;a&#34; = &#34;A&#34; if case is ignored<br/>
Use&#160;the&#160;UCase&#160;and LCase&#160;functions&#160;to&#160;return a&#160;copy&#160;of the&#160;string with all&#160;characters&#160;in&#160;uppercase&#160;or&#160;<br/>lowercase.&#160;<br/>
<i><b>Listing&#160;127.</b>&#160;Demonstrate&#160;UCase&#160;and LCase.<br/></i>S$&#160;=&#160;&#34;Las Vegas&#34;<br/>Print&#160;LCase(s)&#160;REM Returns &#34;las vegas&#34;<br/>Print&#160;UCase(s)&#160;REM Returns &#34;LAS VEGAS&#34;<br/>
If&#160;numerous&#160;comparisons&#160;will&#160;be&#160;made,&#160;using LCase&#160;or UCase&#160;is&#160;sometimes&#160;faster than&#160;performing&#160;a&#160;case-<br/>insensitive&#160;comparison&#160;each time.&#160;And sometimes, it&#160;is&#160;simply&#160;easier to&#160;use.<br/>
If&#160;LCase(Right(sFileName,&#160;3))&#160;=&#160;&#34;odt&#34;&#160;Then<br/>
150<br/>
<hr/>
<a name=154></a>Use&#160;StrConv(string, mode, locale_id) to convert&#160;a&#160;string&#160;with&#160;more&#160;flexibility&#160;than the&#160;individual&#160;methods&#160;<br/>UCase&#160;and LCase.&#160;The&#160;supported&#160;modes&#160;(shown i<a href="libremacros.html#154">n&#160;Table&#160;52) a</a>re&#160;bit&#160;values&#160;that&#160;can be&#160;used together;&#160;for&#160;<br/>example,&#160;1+64=65 causes&#160;all&#160;characters&#160;to be&#160;converted&#160;to uppercase&#160;and to Unicode.&#160;The&#160;final&#160;argument,&#160;<br/>locale_id,&#160;is&#160;an optional&#160;integer locale&#160;identifier that&#160;is&#160;not&#160;currently&#160;supported (as&#160;of OOo version 3.2.1)<br/>
<i><b>Table&#160;52.</b>&#160;Modes&#160;supported by&#160;the&#160;StrConv&#160;statement.</i><br/>
<i><b>Mode</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
No change.<br/>
1<br/>
Convert&#160;all&#160;characters to uppercase.<br/>
2<br/>
Convert&#160;all&#160;characters to lowercase.<br/>
4<br/>
Convert&#160;narrow&#160;(half-width)&#160;characters in the&#160;string&#160;to wide&#160;(full-width)&#160;characters.<br/>
8<br/>
Convert&#160;wide&#160;(full-width)&#160;characters in the&#160;string&#160;to&#160;narrow&#160;(half-width)&#160;characters.<br/>
16<br/>
Convert&#160;Hiragana&#160;characters in the&#160;string&#160;to Katakana&#160;characters.<br/>
32<br/>
Convert&#160;Katakana&#160;characters in the&#160;string&#160;to Hiragana&#160;characters.<br/>
64<br/>
Converst&#160;all&#160;characters to Unicode.<br/>
128<br/>
Convert&#160;all&#160;characters from&#160;Unicode.<br/>
Use&#160;the&#160;LTrim, RTrim,&#160;and&#160;Trim&#160;functions&#160;to return copies&#160;of a&#160;string with leading, trailing, or both&#160;leading&#160;<br/>and trailing spaces&#160;removed. I&#160;usually&#160;do this&#160;with&#160;data&#160;retrieved from&#160;files&#160;and databases, and directly&#160;from&#160;<br/>users.&#160;The&#160;original&#160;string is&#160;unchanged, as&#160;are&#160;all&#160;internal&#160;spaces. Some&#160;trim&#160;routines&#160;in other programming&#160;<br/>languages&#160;trim&#160;all&#160;sorts&#160;of invisible&#160;characters, such as&#160;carriage&#160;returns, new-line&#160;characters, and tabs. In&#160;<br/>OOo Basic, only&#160;the&#160;space&#160;character with&#160;an&#160;ASCII&#160;value&#160;of 32 is&#160;trimmed.<br/>
<i><b>Listing&#160;128.</b>&#160;Demonstrate&#160;LTrim&#160;and RTrim.<br/></i>s&#160;=&#160;&#34; &#160;hello &#160;world &#160; &#34;<br/>Print&#160;&#34;(&#34;&#160;&amp;&#160;LTrim(s)&#160;&amp;&#160;&#34;)&#34;&#160;&#160;'(hello &#160;world &#160; )<br/>Print&#160;&#34;(&#34;&#160;&amp;&#160;RTrim(s)&#160;&amp;&#160;&#34;)&#34;&#160;&#160;'( &#160;hello &#160;world)<br/>Print&#160;&#34;(&#34;&#160;&amp;&#160;Trim(s)&#160;&amp;&#160;&#34;)&#34;&#160; &#160;'(hello &#160;world)<br/>
Use&#160;the&#160;Len function to&#160;return&#160;the&#160;number of characters&#160;in&#160;the&#160;string. If&#160;the&#160;argument&#160;is&#160;not&#160;a&#160;string, it&#160;is&#160;<br/>converted to&#160;a&#160;string first. It’s&#160;probably&#160;safer to&#160;use&#160;CStr to&#160;convert&#160;nonstring arguments&#160;to strings, rather&#160;<br/>than to&#160;rely&#160;on the&#160;automatic&#160;behavior.&#160;For example, types&#160;such as&#160;Byte&#160;will&#160;not&#160;convert&#160;automatically&#160;as&#160;<br/>expected.&#160;The&#160;value&#160;held&#160;in&#160;the&#160;Byte&#160;data&#160;type&#160;is&#160;treated&#160;as&#160;an&#160;ASCII&#160;value&#160;and converted&#160;to a&#160;single&#160;<br/>character.&#160;The&#160;CStr function avoids&#160;this&#160;problem.&#160;<br/>
<i><b>Listing&#160;129.</b>&#160;Demonstrate&#160;Len.</i><br/>
Print&#160;Len(&#34;&#34;)&#160; &#160;&#160;'0<br/>Print&#160;Len(&#34;1&#34;)&#160; &#160;'1<br/>Print&#160;Len(&#34;123&#34;)&#160;'3<br/>Print&#160;Len(12)&#160; &#160;&#160;'2 the number is converted to a string<br/>
To&#160;create&#160;a&#160;string with&#160;a&#160;single&#160;character repeated multiple&#160;times, use&#160;the&#160;String function.&#160;The&#160;first&#160;argument&#160;<br/>is&#160;an integer indicating how&#160;many&#160;times&#160;the&#160;character is&#160;repeated.&#160;Zero is&#160;a&#160;valid value&#160;for the&#160;first&#160;argument,<br/>returning an empty&#160;string.&#160;The&#160;second argument&#160;is&#160;the&#160;character to repeat.&#160;Just&#160;like&#160;the&#160;ASC&#160;function, the&#160;<br/>String function uses&#160;the&#160;first&#160;character from&#160;the&#160;string and ignores&#160;the&#160;rest. If&#160;the&#160;second argument&#160;is&#160;a&#160;<br/>number,&#160;it’s&#160;treated&#160;as&#160;an&#160;ASCII&#160;value&#160;and the&#160;character is&#160;created from&#160;the&#160;number.<br/>
<i><b>Listing&#160;130.</b>&#160;Demonstrate&#160;String.<br/></i>Print&#160;String(2,&#160;65)&#160; &#160;&#160;'AA &#160;65 is ASCII for A<br/>Print&#160;String(2,&#160;&#34;AB&#34;)&#160;&#160;'AA &#160;Only the first character is used<br/>
151<br/>
<hr/>
<a name=155></a>Print&#160;ASC(String(2))&#160; &#160;'0 &#160; Bug: Created string with two ASCII 0 characters<br/>Print&#160;Len(Space(4))&#160; &#160;&#160;'4 &#160; Four spaces<br/>
Use&#160;the&#160;function&#160;InStr to&#160;find where&#160;(and if) one&#160;string is&#160;contained inside&#160;another.&#160;The&#160;InStr function can&#160;<br/>take&#160;four arguments.&#160;The&#160;first&#160;argument&#160;is&#160;an optional&#160;integer that&#160;indicates&#160;the&#160;first&#160;character to check.&#160;This&#160;<br/>defaults&#160;to&#160;1, the&#160;first&#160;character,&#160;if it&#160;is&#160;not&#160;included. InStr then searches&#160;the&#160;second argument&#160;to&#160;see&#160;if&#160;it&#160;<br/>contains&#160;the&#160;third&#160;argument.&#160;The&#160;fourth&#160;optional&#160;argument&#160;determines&#160;if the&#160;comparison&#160;is&#160;case&#160;sensitive&#160;(0)&#160;<br/>or case&#160;insensitive&#160;(1).&#160;The&#160;default&#160;search is&#160;case&#160;insensitive.&#160;You can’t&#160;use&#160;the&#160;fourth argument&#160;unless&#160;you&#160;<br/>also use&#160;the&#160;first&#160;argument.<br/>
<b>TIP</b><br/>
The&#160;StrComp function uses a&#160;0&#160;to indicate&#160;a&#160;case-insensitive&#160;comparison and a&#160;1 — the&#160;default&#160;—&#160;to&#160;<br/>indicate&#160;a&#160;case-sensitive&#160;comparison.&#160;The&#160;InStr&#160;function,&#160;however,&#160;uses&#160;a&#160;0&#160;to indicate&#160;a&#160;case-sensitive&#160;<br/>
comparison and&#160;a&#160;1&#160;—&#160;the&#160;default&#160;— to indicate&#160;a&#160;case-insensitive&#160;comparison.&#160;The&#160;only&#160;similarity&#160;is that&#160;<br/>the&#160;value&#160;1&#160;is the&#160;default.<br/>
<i><b>Listing&#160;131.</b>&#160;Demonstrate&#160;InStr.<br/></i>Print&#160;InStr(&#34;CBAABC&#34;,&#160;&#34;abc&#34;)&#160; &#160; &#160; &#160;'4 default to case insensitive<br/>Print&#160;InStr(1,&#160;&#34;CBAABC&#34;,&#160;&#34;b&#34;)&#160; &#160; &#160;&#160;'2 first argument is 1 by default<br/>Print&#160;InStr(2,&#160;&#34;CBAABC&#34;,&#160;&#34;b&#34;)&#160; &#160; &#160;&#160;'2 start with second character<br/>Print&#160;InStr(3,&#160;&#34;CBAABC&#34;,&#160;&#34;b&#34;)&#160; &#160; &#160;&#160;'5 start with third character<br/>Print&#160;InStr(1,&#160;&#34;CBAABC&#34;,&#160;&#34;b&#34;,&#160;0)&#160; &#160;'0 case-sensitive comparison<br/>Print&#160;InStr(1,&#160;&#34;CBAABC&#34;,&#160;&#34;b&#34;,&#160;1)&#160; &#160;'2 case-insensitive comparison<br/>Print&#160;InStr(1,&#160;&#34;CBAABC&#34;,&#160;&#34;B&#34;,&#160;0)&#160; &#160;'2 case-sensitive comparison<br/>
InStrRev&#160;is&#160;only&#160;available&#160;while&#160;VB compatibility&#160;mode&#160;is&#160;true.&#160;The&#160;start&#160;location&#160;is&#160;argument&#160;3, as&#160;opposed&#160;<br/>to the&#160;first&#160;argument&#160;in InStr.&#160;A&#160;start&#160;location&#160;of -1 means&#160;start&#160;at&#160;the&#160;right&#160;most&#160;character;&#160;I&#160;wish that&#160;-2 was&#160;<br/>the&#160;second character from&#160;the&#160;right, but&#160;it&#160;causes&#160;a&#160;run-time&#160;exception.<br/>
<i><b>Listing&#160;132.</b>&#160;Demonstrate&#160;InStrRev.<br/></i>Sub&#160;ExampleInStrRev<br/>&#160;&#160;CompatibilityMode(True)<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;ABC&#34;)&#160; &#160; &#160; &#160;&#160;'4 default to case sensitive<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;abc&#34;)&#160; &#160; &#160; &#160;&#160;'0 default to case sensitive<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;abc&#34;,&#160;-1,&#160;1)&#160;'4 force case insensitive<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;B&#34;,&#160;1)&#160; &#160; &#160; &#160;'0 start with first character<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;B&#34;,&#160;2)&#160; &#160; &#160; &#160;'2 start with second character<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;B&#34;,&#160;-1)&#160; &#160; &#160;&#160;'5 start with last character<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;B&#34;,&#160;5)&#160; &#160; &#160; &#160;'5 start with fifth character<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;B&#34;,&#160;4)&#160; &#160; &#160; &#160;'2 start with fourth character<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;b&#34;,&#160;-1,&#160;0)&#160; &#160;'0 case-sensitive comparison<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;b&#34;,&#160;-1,&#160;1)&#160; &#160;'5 case-insensitive comparison<br/>&#160;&#160;Print&#160;InStrRev(&#34;CBAABC&#34;,&#160;&#34;B&#34;,&#160;-1,&#160;0)&#160; &#160;'5 case-sensitive comparison<br/>End&#160;Sub<br/>
Prior to OOo 2.0, the&#160;return value&#160;from&#160;InStr is&#160;an integer,&#160;which is&#160;limited to&#160;values&#160;from&#160;-32,768 through&#160;<br/>32,767.&#160;A&#160;string can be&#160;up to 65,535 characters&#160;in length, which causes&#160;problems&#160;when InStr searches&#160;large&#160;<br/>strings. Starting with&#160;OOo 2.0, however,&#160;the&#160;return type&#160;is&#160;a&#160;long.<br/>
<i><b>Listing&#160;133.</b>&#160;Demonstrate&#160;InStr&#160;and a long&#160;string.</i><br/>
Dim&#160;s1&#160;As&#160;String<br/>s1&#160;=&#160;String(44000,&#160;&#34;*&#34;)&#160;&amp;&#160;&#34;XX&#34;&#160; &#160;'This string has 44002 characters.<br/>Print&#160;InStr(s1,&#160;&#34;XX&#34;)&#160; &#160; &#160; &#160; &#160; &#160;&#160;'44001 in OOo 2.0 and -21535 in OOo 1.1.1.<br/>
152<br/>
<hr/>
<a name=156></a><i><b>&#160;7.3.&#160;Locale&#160;and&#160;strings<br/></b></i>Use&#160;<b>Tools&#160;|&#160;Options&#160;|&#160;Language&#160;Settings&#160;|&#160;Languages</b>&#160;to view&#160;the&#160;Locale&#160;used by&#160;OO. My&#160;Locale&#160;setting&#160;is<br/>“Default&#160;– English (USA)”.&#160;After changing the&#160;Locale, you must&#160;exit&#160;and restart&#160;for the&#160;changes&#160;to&#160;be&#160;used.&#160;<br/>The&#160;following&#160;macro returns&#160;different&#160;results&#160;based on the&#160;configured locale.&#160;Notice&#160;the&#160;difference&#160;when run<br/>as&#160;English – US&#160;and&#160;Turkish&#160;locales.<br/>
<i><b>Listing&#160;134.</b>&#160;Some&#160;string&#160;functions&#160;use&#160;Locale.<br/></i>Sub&#160;LocaleStringTests<br/>&#160;&#160;Dim&#160;s$<br/>&#160; ' compare Turkish dotless i with upper case i<br/>&#160; ' Turkish Locale returns 0, English returns -1<br/>&#160;&#160;s&#160;=&#160;&#34;Compare dotless i with upper case i : &#34;&#160;&amp;&#160;StrComp(&#34;ı&#34;,&#160;&#34;I&#34;,&#160;0)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160; ' compare lower case i to upper case i<br/>&#160; ' English Locale returns 0, Turkish Locale returns 1.<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Compare i with upper case i : &#34;&#160;&amp;&#160;StrComp(&#34;i&#34;,&#160;&#34;I&#34;,&#160;0)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Lower Case I = &#34;&#160;&amp;&#160;LCase(&#34;I&#34;)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Upper Case i = &#34;&#160;&amp;&#160;UCase(&#34;i&#34;)<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub&#160;<br/>
<i><b>Figure&#160;53.</b>&#160;English – US Locale&#160;on the&#160;Left,&#160;Turkish Locale&#160;on the&#160;Right.</i><br/>
I&#160;did&#160;not&#160;explore&#160;other areas&#160;that&#160;may&#160;also rely&#160;on Locale&#160;specific&#160;settings.<br/>
<i><b>&#160;7.4.&#160;Substrings<br/></b></i>Use&#160;the&#160;Left&#160;function&#160;to retrieve&#160;a&#160;portion&#160;of the&#160;string from&#160;the&#160;start.&#160;The&#160;first&#160;argument&#160;is&#160;the&#160;string&#160;from&#160;<br/>which&#160;to extract&#160;the&#160;characters, and the&#160;second argument&#160;indicates&#160;how&#160;many&#160;characters&#160;to return.&#160;<br/>Analogously, the&#160;Right&#160;function&#160;returns&#160;strings&#160;from&#160;the&#160;end of a&#160;string. If&#160;the&#160;requested&#160;length is&#160;zero, an&#160;<br/>empty&#160;string is&#160;returned. If&#160;the&#160;requested length&#160;is&#160;too&#160;large, the&#160;entire&#160;string is&#160;returned.<br/>
Print&#160;&#160;Left(&#34;12345&#34;,&#160;2)&#160;&#160;'12<br/>Print&#160;&#160;Left(&#34;12345&#34;,&#160;8)&#160;&#160;'12345<br/>Print&#160;Right(&#34;12345&#34;,&#160;2)&#160;&#160;'45<br/>
The&#160;length&#160;argument&#160;for the&#160;Left&#160;and Right&#160;functions&#160;is&#160;a&#160;long, correctly&#160;handling strings, which can contain&#160;<br/>up to 65,535 characters&#160;(see<a href="libremacros.html#156">&#160;Listing 135)</a>.<br/>
<i><b>Listing&#160;135.</b>&#160;Strings&#160;can contain up to&#160;65,535 characters.</i><br/>
Dim&#160;s1&#160;As&#160;String<br/>s1&#160;=&#160;String(44002,&#160;&#34;*&#34;)&#160; &#160; &#160;'This string has 44002 characters<br/>
153<br/>
<hr/>
<a name=157></a>Print&#160;Len(s1)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'44002<br/>Print&#160;Len(Left(s1,&#160;44000))&#160;&#160;'44000 (fixed in OOo 2.0)<br/>Print&#160;Len(Right(s1,&#160;44000))&#160;'44000<br/>
Use&#160;the&#160;Mid&#160;function to&#160;extract&#160;arbitrary&#160;substrings&#160;and to&#160;replace&#160;substrings&#160;in&#160;an existing string. In&#160;general,<br/>the&#160;string functions&#160;return&#160;a&#160;new&#160;string rather than&#160;modifying&#160;the&#160;existing string. For&#160;example, the&#160;Trim&#160;<br/>function returns&#160;a&#160;new&#160;string with&#160;leading&#160;and trailing spaces&#160;removed,&#160;rather than removing leading&#160;and&#160;<br/>trailing&#160;spaces&#160;from&#160;the&#160;existing string.&#160;The&#160;Mid function,&#160;however,&#160;can be&#160;used to modify&#160;the&#160;string&#160;rather&#160;<br/>than simply&#160;returning a&#160;new&#160;one. In&#160;its&#160;simplest&#160;form, the&#160;Mid&#160;function has&#160;functionality&#160;to the&#160;Right&#160;<br/>function.&#160;The&#160;first&#160;argument&#160;is&#160;a&#160;string, and the&#160;second argument&#160;is&#160;a&#160;starting position.&#160;The&#160;optional&#160;third&#160;<br/>argument&#160;indicates&#160;the&#160;length&#160;of the&#160;string to&#160;return.<br/>
<i><b>Listing&#160;136.</b>&#160;Demonstrate&#160;Mid.<br/></i>Print&#160;Mid(&#34;123456&#34;,&#160;3)&#160; &#160; &#160; &#160; &#160;'3456<br/>Print&#160;Mid(&#34;123456&#34;,&#160;3,&#160;2)&#160; &#160; &#160;&#160;'34<br/>s1&#160;=&#160;String(44000,&#160;&#34;*&#34;)&amp;&#34;XX&#34;<br/>Print&#160;Mid(s1,&#160;44000)&#160; &#160; &#160; &#160; &#160; &#160;'*XX &#160; &#160;No problem with large arguments<br/>Print&#160;Len(Mid(s1,&#160;2,&#160;40000))&#160; &#160;'40000 &#160;No problem with large arguments<br/>
The&#160;Mid function&#160;can provide&#160;the&#160;same&#160;functionality&#160;as&#160;the&#160;Left&#160;function.<br/>
Left(s,&#160;n)&#160;=&#160;Mid(s,&#160;1,&#160;n)<br/>
The&#160;Mid function&#160;takes&#160;an optional&#160;fourth&#160;argument,&#160;a&#160;string, that&#160;replaces&#160;the&#160;specified&#160;substring in the&#160;first<br/>argument.&#160;In&#160;other words, if four arguments&#160;are&#160;present, the&#160;first&#160;three&#160;arguments&#160;specify&#160;a&#160;substring&#160;in&#160;the&#160;<br/>string and the&#160;fourth argument&#160;replaces&#160;the&#160;substring.&#160;This&#160;may&#160;shorten&#160;the&#160;length&#160;of a&#160;string, but&#160;in&#160;OOo&#160;<br/>Basic&#160;this&#160;will&#160;never cause&#160;the&#160;string&#160;to&#160;become&#160;longer.&#160;If&#160;the&#160;final&#160;argument&#160;is&#160;longer than&#160;the&#160;specified&#160;<br/>substring, only&#160;the&#160;first&#160;characters&#160;are&#160;used from&#160;the&#160;final&#160;argument&#160;to replace&#160;the&#160;substring.<br/>
<i><b>Listing&#160;137.</b>&#160;Demonstrate&#160;Mid to&#160;replace&#160;strings.<br/></i>s&#160;=&#160;&#34;123456789&#34;<br/>Mid(s,&#160;3,&#160;5,&#160;&#34;&#34;)&#160; &#160; &#160; &#160;&#160;'Replace five characters with nothing<br/>Print&#160;s&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'1289<br/>
s&#160;=&#160;&#34;123456789&#34;<br/>Mid(s,&#160;3,&#160;5,&#160;&#34;XX&#34;)&#160; &#160; &#160;&#160;'Replace five characters with two<br/>Print&#160;s&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'12XX89<br/>
s&#160;=&#160;&#34;123456789&#34;<br/>Mid(s,&#160;3,&#160;5,&#160;&#34;ABCDEFG&#34;)&#160;'Cannot add more than you replace from the middle<br/>Print&#160;s&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'12ABCDE89<br/>
s&#160;=&#160;&#34;123456789&#34;<br/>Mid(s,&#160;7,&#160;12,&#160;&#34;ABCDEFG&#34;)'You can add more than you remove from the end<br/>Print&#160;s&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'123456ABCDEFG<br/>
<i><b>&#160;7.5.&#160;Replace<br/></b></i>The&#160;ReplaceInString function&#160;(see<a href="libremacros.html#157">&#160;Listing 138)</a>&#160;emulates&#160;the&#160;Mid function,&#160;with two exceptions:&#160;It&#160;puts&#160;the&#160;<br/>entire&#160;new&#160;string in place, even if it’s&#160;longer than&#160;the&#160;substring&#160;that&#160;it&#160;replaces, and it&#160;doesn’t&#160;modify&#160;the&#160;<br/>original&#160;string.<br/>
<i><b>Listing&#160;138.</b>&#160;A&#160;general&#160;replace&#160;string&#160;method.<br/></i>REM This function is similar to Mid with four arguments.<br/>REM This function does not modify the original string.<br/>
154<br/>
<hr/>
<a name=158></a>REM This function handles replacement text larger than n.<br/>Function&#160;ReplaceInString(s$,&#160;i&amp;,&#160;n&amp;,&#160;sNew$)&#160;As&#160;String<br/>&#160;&#160;If&#160;i&#160;&lt;=&#160;1&#160;Then<br/>&#160; &#160;&#160;'Place the string in front.&#160;<br/>&#160; &#160;&#160;'The only question is how much string must be removed.<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;If&#160;n&#160;&lt;&#160;1&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Remove nothing<br/>&#160; &#160; &#160;&#160;ReplaceInString&#160;=&#160;sNew&#160;&amp;&#160;s<br/>&#160; &#160;&#160;ElseIf&#160;n&#160;&gt;=&#160;Len(s)&#160;Then&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Remove everything<br/>&#160; &#160; &#160;&#160;ReplaceInString&#160;=&#160;sNew<br/>&#160; &#160;&#160;Else&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Remove a portion from the left<br/>&#160; &#160; &#160;&#160;ReplaceInString&#160;=&#160;sNew&#160;&amp;&#160;Right(s,&#160;Len(s)&#160;-&#160;n)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;<br/>&#160;&#160;ElseIf&#160;i&#160;+&#160;n&#160;&gt;&#160;Len(s)&#160;Then<br/>&#160; &#160;&#160;'Replacing past the end, then extract the leftmost parts<br/>&#160; &#160;&#160;'Mid works to find if the length argument is larger than the<br/>&#160; &#160;&#160;'string, so this is fine! Append the new text to the end.<br/>&#160;&#160;<br/>&#160; &#160;&#160;ReplaceInString&#160;=&#160;Mid(s,&#160;1,&#160;i&#160;-&#160;1)&#160;&amp;&#160;sNew<br/>&#160; &#160;&#160;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;'Replace somewhere in the middle of the string.<br/>&#160; &#160;&#160;'First, obtain the leftmost text.&#160;<br/>&#160; &#160;&#160;'Second, insert the new text, if any.<br/>&#160; &#160;&#160;'Finally, obtain the rightmost text.<br/>&#160;&#160;<br/>&#160; &#160;&#160;ReplaceInString&#160;&#160;=&#160;Mid(s,&#160;1,&#160;i&#160;-&#160;1)&#160;&amp;&#160;sNew&#160;&amp;&#160;Right(s,&#160;Len(s)&#160;-&#160;i&#160;-&#160;n&#160;+&#160;1)<br/>&#160;&#160;End&#160;If<br/>End&#160;Function&#160;<br/>
But&#160;wait,&#160;there&#160;is&#160;an undocumented&#160;statement&#160;Replace(strng, find, rpl, start,&#160;Count,&#160;mode), which finds&#160;all&#160;<br/>occurrences&#160;of find&#160;and replaces&#160;them&#160;with rpl.&#160;The&#160;last&#160;three&#160;arguments&#160;are&#160;optional.&#160;<br/>
The&#160;start&#160;value&#160;indicates&#160;what&#160;part&#160;of the&#160;string to return, not&#160;where&#160;to&#160;start&#160;replace.&#160;A&#160;value&#160;of one&#160;for the&#160;<br/>start&#160;value&#160;returns&#160;all&#160;of the&#160;characters.&#160;A&#160;start&#160;value&#160;of three&#160;ignores&#160;the&#160;first&#160;two characters&#160;in&#160;the&#160;return&#160;<br/>string.<br/>
The&#160;count&#160;indicates&#160;the&#160;maximum&#160;number of times&#160;to&#160;replace&#160;the&#160;found text.&#160;A&#160;value&#160;of -1 replaces&#160;all&#160;<br/>values.<br/>
A&#160;mode&#160;value&#160;of 1, the&#160;default,&#160;indicates&#160;a&#160;case-insensitive&#160;compare&#160;is&#160;used to find&#160;matching text.&#160;A&#160;mode&#160;<br/>value&#160;of 0 causes&#160;a&#160;case-sensitive&#160;compare.<br/>
<i><b>&#160;7.6.&#160;Aligning&#160;strings&#160;with&#160;LSet&#160;and&#160;RSet<br/></b></i>Use&#160;the&#160;LSet&#160;and RSet&#160;statements&#160;to left-justify&#160;and right-justify&#160;strings&#160;into the&#160;space&#160;taken by&#160;another&#160;<br/>string.&#160;This&#160;is&#160;useful,&#160;for example,&#160;to create&#160;column&#160;headings&#160;that&#160;are&#160;left&#160;or right&#160;justified with&#160;leading or&#160;<br/>trailing&#160;spaces.&#160;The&#160;RSet&#160;and LSet&#160;functions&#160;use&#160;the&#160;same&#160;syntax.<br/>
LSet&#160;string_1&#160;=&#160;expression<br/>RSet&#160;string_1&#160;=&#160;expression<br/>
155<br/>
<hr/>
<a name=159></a>The&#160;string on the&#160;left-hand side&#160;can contain any&#160;data&#160;as&#160;long as&#160;it&#160;is&#160;the&#160;length that&#160;you&#160;want.&#160;The&#160;right-hand&#160;<br/>side&#160;must&#160;evaluate&#160;to&#160;a&#160;string;&#160;that&#160;string will&#160;be&#160;displayed in&#160;the&#160;space&#160;defined by&#160;the&#160;length&#160;of the&#160;left-hand&#160;<br/>string. Unlike&#160;the&#160;behavior for many&#160;functions&#160;in&#160;OOo Basic, the&#160;expression&#160;is&#160;not&#160;automatically&#160;converted&#160;<br/>to a&#160;string.<br/>
<i><b>Listing&#160;139.</b>&#160;RSet.<br/></i>Dim&#160;s&#160;As&#160;String&#160; &#160; &#160;'String variable to contain the result<br/>s&#160;=&#160;String(10,&#160;&#34;*&#34;)&#160;'The result is 10 characters wide<br/>RSet&#160;s&#160;=&#160;CStr(1.23)&#160;'The number is not automatically converted to a string<br/>Print&#160;&#34;$&#34;&#160;&amp;&#160;s&#160; &#160; &#160; &#160;'$ &#160; &#160; &#160;1.23<br/>
The&#160;important&#160;thing about&#160;the&#160;string on the&#160;left&#160;is&#160;its&#160;length&#160;—&#160;the&#160;width&#160;of the&#160;field in&#160;which&#160;the&#160;value&#160;of&#160;<br/>interest&#160;will&#160;be&#160;displayed.&#160;The&#160;easiest&#160;way&#160;to&#160;get&#160;a&#160;string of a&#160;specified length is&#160;to use&#160;the&#160;String function.&#160;<br/>The&#160;character that&#160;you&#160;use&#160;is&#160;not&#160;important&#160;because&#160;all&#160;of the&#160;extra&#160;characters&#160;in&#160;the&#160;final&#160;result&#160;are&#160;replaced&#160;<br/>with spaces.<br/>
<i><b>Listing&#160;140.</b>&#160;LSet.</i><br/>
Dim&#160;s&#160;As&#160;String&#160; &#160; &#160;'String variable to contain the result<br/>s&#160;=&#160;String(10,&#160;&#34;X&#34;)&#160;'The result is 10 characters wide<br/>LSet&#160;s&#160;=&#160;CStr(1.23)&#160;'The number is not automatically converted to a string<br/>Print&#160;s&#160;&amp;&#160;&#34;%&#34;&#160; &#160; &#160; &#160;'1.23 &#160; &#160; &#160;%<br/>
If&#160;the&#160;string&#160;on the&#160;left&#160;is&#160;shorter than&#160;the&#160;string&#160;expression&#160;on the&#160;right,&#160;the&#160;expression&#160;is&#160;truncated&#160;to fit.&#160;<br/>Both&#160;LSet&#160;and RSet&#160;chop characters&#160;from&#160;the&#160;end of the&#160;expression&#160;to make&#160;it&#160;fit&#160;within&#160;the&#160;defined string&#160;<br/>length.<br/>
<i><b>Listing&#160;141.</b>&#160;LSet&#160;and RSet&#160;truncate.<br/></i>Dim&#160;s&#160;As&#160;String&#160; &#160; &#160;'String variable to contain the result<br/>s&#160;=&#160;String(4,&#160;&#34;X&#34;)&#160;&#160;'The result will be four characters wide<br/>LSet&#160;s&#160;=&#160;CStr(21.23)'Truncated on the right<br/>Print&#160;&#34;$&#34;&#160;&amp;&#160;s&#160;&amp;&#160;&#34;%&#34;&#160;'$21.2%<br/>RSet&#160;s&#160;=&#160;CStr(21.23)'Truncated on the right<br/>Print&#160;&#34;$&#34;&#160;&amp;&#160;s&#160;&amp;&#160;&#34;%&#34;&#160;'$21.2%<br/>
The&#160;code&#160;in<a href="libremacros.html#159">&#160;Listing 142<b>&#160;</b></a>demonstrates&#160;the&#160;behavior of the&#160;LSet&#160;and RSet&#160;commands.&#160;The&#160;results&#160;are&#160;<br/>displayed i<a href="libremacros.html#160">n&#160;Figure&#160;54.</a><br/>
<i><b>Listing&#160;142.</b>&#160;Complete&#160;LSet&#160;and RSet&#160;example.</i><br/>
Sub&#160;ExampleLSetAndRSet<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dim&#160;sVar&#160;As&#160;String<br/>&#160;&#160;Dim&#160;sTmp&#160;As&#160;String<br/>&#160;&#160;<br/>&#160;&#160;sTmp&#160;=&#160;&#34;12345&#34;<br/>&#160;&#160;sVar&#160;=&#160;String(10,&#34;*&#34;)<br/>&#160;&#160;LSet&#160;sVar&#160;=&#160;sTmp<br/>&#160;&#160;s&#160;=&#160;&#34;LSet &#34;&#160;&amp;&#160;String(10,&#160;&#34;*&#34;)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;STmp&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; == &gt;&#34;&#160;&amp;&#160;sVar&#160;&amp;&#160;&#34;&lt;&#34;&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;sVar&#160;=&#160;String(10,&#34;*&#34;)<br/>&#160;&#160;RSet&#160;sVar&#160;=&#160;sTmp<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;RSet &#34;&#160;&amp;&#160;String(10,&#160;&#34;*&#34;)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;STmp&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#160;&#34; == &gt;&#34;&#160;&amp;&#160;sVar&#160;&amp;&#160;&#34;&lt;&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;sVar&#160;=&#160;String(2,&#34;*&#34;)<br/>
156<br/>
<hr/>
<a name=160></a>&#160;&#160;LSet&#160;sVar&#160;=&#160;sTmp<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;LSet &#34;&#160;&amp;&#160;String(2,&#160;&#34;*&#34;)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;STmp&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#160;&#34; == &gt;&#34;&#160;&amp;&#160;sVar&#160;&amp;&#160;&#34;&lt;&#34;&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;sVar&#160;=&#160;String(2,&#34;*&#34;)<br/>&#160;&#160;RSet&#160;sVar&#160;=&#160;sTmp<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;RSet &#34;&#160;&amp;&#160;String(2,&#160;&#34;*&#34;)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;STmp&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#160;&#34; == &gt;&#34;&#160;&amp;&#160;sVar&#160;&amp;&#160;&#34;&lt;&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;RSet and LSet&#34;<br/>End&#160;Sub<br/>
<i>Figure 54. RSet and LSet justify strings.</i><br/>
<b>TIP</b><br/>
In&#160;Visual&#160;Basic,&#160;LSet&#160;allows you&#160;to overlay&#160;data&#160;from&#160;one&#160;user-defined&#160;type&#160;with&#160;data&#160;from&#160;another,&#160;<br/>overlaying&#160;all&#160;the&#160;bytes from&#160;one&#160;data&#160;structure&#160;on top&#160;of&#160;the&#160;other;&#160;ignoring&#160;the&#160;underlying&#160;structure.&#160;In&#160;<br/>
OOo Basic,&#160;LSet&#160;only&#160;manipulates&#160;strings.<br/>
<i><b>&#160;7.7.&#160;Fancy&#160;formatting&#160;with&#160;Format<br/></b></i>You can convert&#160;a&#160;number to&#160;a&#160;string formatted&#160;according to&#160;the&#160;optional&#160;format&#160;string.&#160;And you&#160;can include&#160;<br/>multiple&#160;formats&#160;in a&#160;single&#160;format&#160;string. See<a href="libremacros.html#160">&#160;Table&#160;53.&#160;</a>The&#160;current&#160;locale&#160;influences&#160;the&#160;returned formatted<br/>string. Set&#160;the&#160;locale&#160;using&#160;<b>Tools&#160;|&#160;Options&#160;|&#160;Language&#160;Settings&#160;|&#160;Languages</b>. If&#160;the&#160;format&#160;string is&#160;<br/>omitted,&#160;Format&#160;produces&#160;output&#160;similar to&#160;the&#160;CStr function.<br/>
<i><b>Listing&#160;143.</b>&#160;Simple&#160;Format&#160;statement.<br/></i>&#160;&#160;Print&#160;Format(1223,&#160;&#34;00.00&#34;)&#160; &#160; &#160; &#160; &#160; &#160;'1223.00<br/>&#160;&#160;Print&#160;Format(1234.56789,&#160;&#34;###00.00&#34;)&#160;&#160;'1234.57<br/>
Each individual&#160;format&#160;is&#160;separated&#160;by&#160;a&#160;semicolon&#160;(;).&#160;The&#160;first&#160;format&#160;is&#160;used for positive&#160;numbers, the&#160;<br/>second for negative&#160;numbers, and the&#160;third&#160;for zero. If&#160;only&#160;one&#160;format&#160;code&#160;is&#160;present,&#160;it&#160;applies&#160;to&#160;all&#160;<br/>numbers.<br/>
<i><b>Listing&#160;144.</b>&#160;Format&#160;string&#160;may&#160;specify&#160;formatting&#160;for&#160;positive&#160;, negative, and zero&#160;numbers.</i><br/>
&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;s&#160;=&#160;&#34;P 00000.000;N ####.00;Z 0.0&#34;<br/>&#160;&#160;Print&#160;Format(-12.3,&#160;s)&#160;&#160;'N 12.30<br/>&#160;&#160;Print&#160;Format(0,&#160;s)&#160; &#160; &#160;&#160;'Z 0.0<br/>&#160;&#160;Print&#160;Format(12.3,&#160;s)&#160; &#160;'P 000012.300&#160;<br/>
<i><b>Table&#160;53.</b>&#160;Numeric&#160;Format&#160;specifiers.</i><br/>
<i><b>Code</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
If&#160;the&#160;number&#160;has a&#160;digit&#160;at&#160;the&#160;position of&#160;the&#160;0&#160;in the&#160;format&#160;code, the&#160;digit&#160;is&#160;displayed;&#160;<br/>
otherwise&#160;a&#160;zero&#160;appears.&#160;This&#160;means that&#160;leading&#160;and&#160;trailing&#160;zeros are&#160;displayed,&#160;leading&#160;digits&#160;<br/>
157<br/>
<hr/>
<a name=161></a><i><b>Code</b></i><br/>
<i><b>Description</b></i><br/>
are&#160;not&#160;truncated,&#160;and trailing&#160;decimals are&#160;rounded.<br/>
#<br/>
This&#160;works like&#160;the&#160;0,&#160;but&#160;leading&#160;and&#160;trailing&#160;zeros are&#160;not&#160;displayed.<br/>
The&#160;decimal&#160;placeholder&#160;determines the&#160;number&#160;of&#160;decimal&#160;places to the&#160;left&#160;and&#160;right&#160;of&#160;the&#160;<br/>
.<br/>
decimal&#160;separator.&#160;Although the&#160;period is&#160;used in the&#160;format&#160;string&#160;regardless of&#160;locale, the&#160;output&#160;<br/>
correctly&#160;uses&#160;the&#160;locale-specific&#160;decimal&#160;separator.<br/>
%<br/>
Multiply&#160;the&#160;number&#160;by&#160;100&#160;and&#160;insert&#160;the&#160;percent&#160;sign (%)&#160;where&#160;it&#160;appears in&#160;the&#160;format&#160;code.<br/>
If&#160;the&#160;format&#160;code&#160;contains at&#160;least&#160;one&#160;numerical&#160;digit&#160;placeholder&#160;(0&#160;or&#160;#)&#160;to the&#160;right&#160;of&#160;the&#160;<br/>
E-<br/>
symbol,&#160;the&#160;number&#160;is formatted in&#160;the&#160;scientific&#160;notation.&#160;The&#160;letter&#160;E or&#160;e&#160;is inserted&#160;between the&#160;<br/>
E+<br/>
number&#160;and&#160;the&#160;exponent.&#160;The&#160;number&#160;of&#160;placeholders for&#160;digits&#160;to the&#160;right&#160;of&#160;the&#160;symbol&#160;<br/>
e-<br/>
determines&#160;the&#160;number&#160;of&#160;digits&#160;in&#160;the&#160;exponent. If&#160;the&#160;exponent&#160;is negative, a&#160;minus sign (-)&#160;is&#160;<br/>
e+<br/>
displayed&#160;directly&#160;before&#160;an exponent. If&#160;the&#160;exponent&#160;is positive,&#160;a&#160;plus&#160;sign (+)&#160;is only&#160;displayed&#160;<br/>before&#160;exponents with E+&#160;or&#160;e+.&#160;<br/>
The&#160;comma&#160;is a&#160;placeholder&#160;for&#160;the&#160;thousands separator.&#160;It&#160;separates thousands from&#160;hundreds in&#160;a<br/>
,<br/>
number&#160;with&#160;at&#160;least&#160;four&#160;digits.&#160;The&#160;thousands&#160;delimiter&#160;is displayed&#160;if&#160;the&#160;format&#160;code&#160;contains&#160;<br/>
the&#160;placeholder&#160;surrounded&#160;by&#160;digit&#160;placeholders (0&#160;or&#160;#).<br/>
-&#160;+&#160;$&#160;(&#160;)&#160;&#160;space&#160;<br/>
Plus&#160;signs&#160;(+),&#160;minus signs (-),&#160;dollar&#160;signs ($),&#160;spaces,&#160;or&#160;brackets&#160;entered&#160;directly&#160;in&#160;the&#160;format&#160;<br/>
code&#160;are&#160;displayed&#160;as the&#160;literal&#160;character.<br/>
The&#160;backslash&#160;displays&#160;the&#160;next&#160;character&#160;in the&#160;format&#160;code.&#160;In&#160;other&#160;words, it&#160;prevents the&#160;next&#160;<br/>
character&#160;from&#160;being&#160;seen as a&#160;special&#160;character.&#160;The&#160;backslash is&#160;not&#160;displayed&#160;unless you enter&#160;a&#160;<br/>double&#160;backslash (\\)&#160;in the&#160;format&#160;code.&#160;Characters that&#160;must&#160;be&#160;preceded&#160;by&#160;a&#160;backslash in&#160;the&#160;<br/>
\<br/>
format&#160;code&#160;in order&#160;to&#160;be&#160;displayed&#160;as literal&#160;characters are&#160;the&#160;date-&#160;and&#160;time-formatting&#160;<br/>characters (a,&#160;c,&#160;d, h, m,&#160;n,&#160;p, q,&#160;s, t, w,&#160;y,&#160;/, :),&#160;numeric-formatting&#160;characters (#,&#160;0,&#160;%, E, e,&#160;<br/>
comma,&#160;period), and&#160;string-formatting&#160;characters (&lt;, &gt;).&#160;You may&#160;also enclose&#160;characters in&#160;<br/>double&#160;quotation marks.<br/>
General&#160;Number<br/>
Numbers&#160;are&#160;displayed&#160;as entered.<br/>
Currency<br/>
A&#160;currency&#160;symbol&#160;is&#160;placed&#160;in front&#160;of&#160;the&#160;number,&#160;and negative&#160;numbers are&#160;in brackets.<br/>
Fixed<br/>
At&#160;least&#160;one&#160;digit&#160;is displayed&#160;in front&#160;of&#160;the&#160;decimal&#160;separator.&#160;Two&#160;decimals&#160;are&#160;displayed.<br/>
Percent<br/>
Multiply&#160;the&#160;number&#160;by&#160;100&#160;and&#160;append a&#160;percent&#160;sign (%).<br/>
Standard<br/>
Displays&#160;numbers with a&#160;locale-specific&#160;thousands separator.&#160;Two decimals are&#160;displayed.<br/>
Scientific<br/>
Displays&#160;numbers in scientific&#160;notation.&#160;Two decimals are&#160;displayed.<br/>
The&#160;format&#160;function&#160;has&#160;been dramatically&#160;improved over the&#160;years&#160;and most&#160;of the&#160;bugs&#160;have&#160;been fixed.&#160;<br/>Format&#160;specifiers&#160;related to&#160;numbers&#160;are&#160;shown i<a href="libremacros.html#160">n&#160;Table&#160;53.</a><br/>
<i><b>Listing&#160;145.</b>&#160;Demonstrate&#160;numeric&#160;format&#160;specifiers.</i><br/>
Sub&#160;ExampleFormat<br/>&#160;&#160;MsgBox&#160;Format(6328.2,&#160;&#34;##,##0.00&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160;REM 6,328.20<br/>&#160;&#160;MsgBox&#160;Format(123456789.5555,&#160;&#34;##,##0.00&#34;)&#160; &#160; &#160;REM 123,456,789.56<br/>&#160;&#160;MsgBox&#160;Format(0.555,&#160;&#34;.##&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM .56<br/>&#160;&#160;MsgBox&#160;Format(123.555,&#160;&#34;#.##&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;REM 123.56<br/>&#160;&#160;MsgBox&#160;Format(123.555,&#160;&#34;.##&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM 123.56<br/>&#160;&#160;MsgBox&#160;Format(0.555,&#160;&#34;0.##&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;REM 0.56<br/>&#160;&#160;MsgBox&#160;Format(0.1255555,&#160;&#34;%#.##&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM %12.56<br/>&#160;&#160;MsgBox&#160;Format(123.45678,&#160;&#34;##E-####&#34;)&#160; &#160; &#160; &#160; &#160; &#160;REM 12E1<br/>&#160;&#160;MsgBox&#160;Format(.0012345678,&#160;&#34;0.0E-####&#34;)&#160; &#160; &#160; &#160;&#160;REM 1.2E-003<br/>&#160;&#160;MsgBox&#160;Format(123.45678,&#160;&#34;#.e-###&#34;)&#160; &#160; &#160; &#160; &#160; &#160;&#160;REM 1.e002<br/>&#160;&#160;MsgBox&#160;Format(.0012345678,&#160;&#34;#.e-###&#34;)&#160; &#160; &#160; &#160; &#160;&#160;REM 1.e-003<br/>
158<br/>
<hr/>
<a name=162></a>&#160;&#160;MsgBox&#160;Format(123.456789,&#160;&#34;#.## is ###&#34;)&#160; &#160; &#160; &#160;REM 123.46<br/>&#160;&#160;MsgBox&#160;Format(8123.456789,&#160;&#34;General Number&#34;)&#160; &#160;REM 8123.456789<br/>&#160;&#160;MsgBox&#160;Format(8123.456789,&#160;&#34;Fixed&#34;)&#160; &#160; &#160; &#160; &#160; &#160;&#160;REM 8123.46<br/>&#160;&#160;MsgBox&#160;Format(8123.456789,&#160;&#34;Currency&#34;)&#160; &#160; &#160; &#160; &#160;REM 8,123.46 $ (broken)<br/>&#160;&#160;MsgBox&#160;Format(8123.456789,&#160;&#34;Standard&#34;)&#160; &#160; &#160; &#160; &#160;REM 8,123.46<br/>&#160;&#160;MsgBox&#160;Format(8123.456789,&#160;&#34;Scientific&#34;)&#160; &#160; &#160; &#160;REM 8.12E+03<br/>&#160;&#160;MsgBox&#160;Format(0.00123456789,&#160;&#34;Scientific&#34;)&#160; &#160; &#160;REM 1.23E-03<br/>&#160;&#160;MsgBox&#160;Format(0.00123456789,&#160;&#34;Percent&#34;)&#160; &#160; &#160; &#160;&#160;REM 0.12%<br/>End&#160;Sub<br/>
Format&#160;specifiers&#160;related to&#160;date&#160;and time&#160;formatting&#160;are&#160;shown i<a href="libremacros.html#162">n&#160;Table&#160;54. F</a>or reasons&#160;that&#160;I&#160;do not&#160;<br/>understand, they&#160;are&#160;not&#160;included&#160;with the&#160;standard documentation.<br/>
<i><b>Table&#160;54.</b>&#160;Date&#160;and time&#160;format&#160;specifiers.&#160;</i><br/>
<i><b>Code</b></i><br/>
<i><b>Description</b></i><br/>
q<br/>
The&#160;quarter&#160;of&#160;the&#160;year&#160;(1&#160;through&#160;4).<br/>
qq<br/>
The&#160;quarter&#160;of&#160;the&#160;year&#160;as 1st&#160;quarter&#160;through 4th quarter<br/>
y<br/>
The&#160;day&#160;in&#160;the&#160;year&#160;(1&#160;through 365).<br/>
yy<br/>
Two-digit&#160;year.<br/>
yyyy<br/>
Complete&#160;four-digit&#160;year.<br/>
m<br/>
Month&#160;number&#160;with&#160;no leading&#160;zero.<br/>
mm<br/>
Two-digit&#160;month&#160;number;&#160;leading&#160;zeros are&#160;added&#160;as required.<br/>
mmm<br/>
Month&#160;name&#160;abbreviated to&#160;three&#160;letters.<br/>
mmmm<br/>
Full&#160;month&#160;name&#160;as text.<br/>
mmmmm<br/>
First&#160;letter&#160;of&#160;month&#160;name.<br/>
d<br/>
Day&#160;of&#160;the&#160;month&#160;with&#160;no leading&#160;zero.<br/>
dd<br/>
Day&#160;of&#160;the&#160;month;&#160;leading&#160;zeros are&#160;added as required.<br/>
ddd<br/>
Day&#160;as text&#160;abbreviated&#160;to three&#160;letters (Sun, Mon,&#160;Tue,&#160;Wed,&#160;Thu, Fri,&#160;Sat).<br/>
dddd<br/>
Day&#160;as text&#160;(Sunday&#160;through&#160;Saturday).<br/>
ddddd<br/>
Full&#160;date&#160;in a&#160;short&#160;date&#160;format.<br/>
dddddd<br/>
Full&#160;date&#160;in a&#160;long&#160;format.<br/>
w<br/>
Day&#160;of&#160;the&#160;week as returned&#160;by&#160;WeekDay&#160;(1&#160;through&#160;7).<br/>
ww<br/>
Week&#160;in&#160;the&#160;year&#160;(1&#160;though 52).<br/>
h<br/>
Hour&#160;with no&#160;leading&#160;zero.<br/>
hh<br/>
Two-digit&#160;hour;&#160;leading&#160;zeros are&#160;added&#160;as required.<br/>
n<br/>
Minute&#160;with&#160;no leading&#160;zero.<br/>
nn<br/>
Two-digit&#160;minute;&#160;leading&#160;zeros are&#160;added&#160;as required.<br/>
s<br/>
Second with&#160;no leading&#160;zero.<br/>
ss<br/>
Two-digit&#160;second;&#160;leading&#160;zeros are&#160;added&#160;as&#160;required.<br/>
ttttt<br/>
Display&#160;complete&#160;time&#160;in&#160;a&#160;long&#160;time&#160;format.<br/>
c<br/>
Display&#160;a&#160;complete&#160;date&#160;and&#160;time.<br/>
/<br/>
Date&#160;separator.&#160;A&#160;locale-specific&#160;value&#160;is&#160;used.<br/>
:<br/>
Time&#160;separator.&#160;A&#160;locale-specific&#160;value&#160;is used.<br/>
159<br/>
<hr/>
<a name=163></a>The&#160;date&#160;and time&#160;format&#160;specifiers&#160;are&#160;now&#160;implemented. I&#160;am&#160;aware&#160;of at&#160;least&#160;one&#160;bug&#160;that&#160;is&#160;<br/>demonstrated in<a href="libremacros.html#163">&#160;Listing 146&#160;w</a>ith the&#160;format&#160;string&#160;“d/mmmm/yyyy&#160;h:nn:ss”;<a href="libremacros.html#164">&#160;Figure&#160;55&#160;s</a>hows&#160;that&#160;“nn”&#160;<br/>does&#160;not&#160;expand&#160;properly&#160;on the&#160;last&#160;line.<br/>
<i><b>Listing&#160;146.</b>&#160;Demonstrate&#160;date&#160;and time&#160;format&#160;specifiers.<br/></i>Sub&#160;FormatDateTimeStrings<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;d&#160;As&#160;Date<br/>&#160;&#160;d&#160;=&#160;now()<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Dim&#160;formats<br/>&#160;&#160;formats&#160;=&#160;Array(&#34;q&#34;,&#160;&#34;qq&#34;,&#160;&#34;y&#34;,&#160;&#34;yy&#34;,&#160;&#34;yyyy&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;m&#34;,&#160;&#34;mm&#34;,&#160;&#34;mmm&#34;,&#160;&#34;mmmm&#34;,&#160;&#34;mmmmm&#34;, _<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;d&#34;,&#160;&#34;dd&#34;,&#160;&#34;ddd&#34;,&#160;&#34;dddd&#34;,&#160;&#34;ddddd&#34;,&#160;&#34;dddddd&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;w&#34;,&#160;&#34;ww&#34;,&#160;&#34;h&#34;,&#160;&#34;hh&#34;,&#160;&#34;n&#34;,&#160;&#34;nn&#34;,&#160;&#34;nnn&#34;,&#160;&#34;s&#34;,&#160;&#34;ss&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;ttttt&#34;,&#160;&#34;c&#34;,&#160;&#34;d/mmmm/yyyy h:nn:ss&#34;)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(formats)&#160;To&#160;UBound(formats)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;formats(i)&#160;&amp;&#160;&#34; =&gt; &#34;&#160;&amp;&#160;Format(d,&#160;formats(i))&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub&#160;<br/>
160<br/>
<hr/>
<a name=164></a><i><b>Figure&#160;55</b>. Date&#160;and time&#160;format&#160;specifiers.</i><br/>
Format&#160;specifiers&#160;related to&#160;strings&#160;are&#160;shown in<a href="libremacros.html#164">&#160;Table&#160;55.</a><br/>
<i><b>Table&#160;55.</b>&#160;String format&#160;specifiers.&#160;</i><br/>
<i><b>Code</b></i><br/>
<i><b>Description</b></i><br/>
&lt;<br/>
String&#160;in lowercase.<br/>
&gt;<br/>
String&#160;in uppercase.<br/>
Other string format&#160;specifiers&#160;used to be&#160;documented,&#160;but&#160;have&#160;never been implemented (see<a href="libremacros.html#165">&#160;Table&#160;56). I</a>&#160;<br/>include&#160;them&#160;because&#160;the&#160;specifiers&#160;in<a href="libremacros.html#162">&#160;Table&#160;54&#160;a</a><a href="libremacros.html#164">nd&#160;Table&#160;55&#160;us</a>ed to&#160;be&#160;documented but&#160;not&#160;implemented;&#160;<br/>now&#160;they&#160;are&#160;implemented&#160;but&#160;not&#160;documented.<br/>
161<br/>
<hr/>
<a name=165></a><i><b>Table&#160;56.</b>&#160;String format&#160;specifiers.&#160;</i><br/>
<i><b>Code</b></i><br/>
<i><b>Description</b></i><br/>
@<br/>
Character&#160;placeholder.&#160;If&#160;the&#160;input&#160;character&#160;is&#160;empty,&#160;place&#160;a&#160;space&#160;in&#160;the&#160;output&#160;<br/>string. For&#160;example,&#160;“(@@@)”&#160;formats to “(&#160;&#160;&#160;)”&#160;with&#160;an empty&#160;string.<br/>
&amp;<br/>
Character&#160;placeholder.&#160;If&#160;the&#160;input&#160;character&#160;is&#160;empty,&#160;place&#160;nothing&#160;in&#160;the&#160;output&#160;<br/>string. For&#160;example,&#160;“(&amp;&amp;&amp;)”&#160;formats to “()”&#160;with&#160;an empty&#160;string.<br/>
!<br/>
Normally,&#160;character&#160;placeholders are&#160;filled&#160;right&#160;to&#160;left;&#160;the&#160;!&#160;forces the&#160;placeholders to<br/>be&#160;filled left&#160;to right.<br/>
As&#160;of this&#160;writing with&#160;OOo version 3.2.1, only&#160;the&#160;upper /&#160;lower case&#160;string format&#160;specifiers&#160;are&#160;<br/>implemented.<br/>
<i><b>Listing&#160;147.</b>&#160;String&#160;format&#160;specifiers.</i><br/>
Sub&#160;FormatStrings<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Dim&#160;formats<br/>&#160;&#160;formats&#160;=&#160;Array(&#34;&lt;&#34;,&#160;&#34;&gt;&#34;,&#160;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;@@&#34;,&#160;&#34;(@@@)&#34;,&#160;&#34;[@@@@]&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;&amp;&amp;&#34;,&#160;&#34;(&amp;&amp;&amp;)&#34;,&#160;&#34;[&amp;&amp;&amp;&amp;]&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(formats)&#160;To&#160;UBound(formats)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;formats(i)&#160;&amp;&#160;&#34; =&gt; (&#34;&#160;&amp;&#160;Format(&#34;On&#34;,&#160;formats(i))&#160;&amp;&#160;&#34;)&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub&#160;<br/>
<i><b>&#160;7.8.&#160;Converting&#160;data&#160;to&#160;a&#160;string<br/></b></i>OOo Basic&#160;contains&#160;functions&#160;that&#160;convert&#160;other data&#160;types&#160;to&#160;a&#160;string.&#160;Although the&#160;Format&#160;function&#160;is&#160;the&#160;<br/>most&#160;versatile&#160;method of converting a&#160;number to&#160;a&#160;string, that&#160;level&#160;of control&#160;is&#160;typically&#160;not&#160;required.&#160;The&#160;<br/>Str function&#160;converts&#160;a&#160;number to&#160;a&#160;string with&#160;no localization,&#160;and the&#160;Val&#160;function&#160;converts&#160;it&#160;back to&#160;a&#160;<br/>number.<br/>
The&#160;Hex and Oct&#160;functions&#160;convert&#160;a&#160;Long&#160;to&#160;its&#160;corresponding hexadecimal&#160;or octal&#160;notation.&#160;The&#160;leading&#160;<br/>“&amp;H”&#160;and “&amp;O”&#160;are&#160;not&#160;included.&#160;To&#160;convert&#160;back to a&#160;number,&#160;these&#160;strings&#160;must&#160;be&#160;manually&#160;prepended to<br/>the&#160;string.<br/>
The&#160;CStr&#160;function is&#160;able&#160;to intelligently&#160;convert&#160;almost&#160;any&#160;data&#160;type&#160;to a&#160;string in a&#160;locale-specific&#160;way&#160;<br/>(see<a href="libremacros.html#165">&#160;Table&#160;57)</a>.&#160;The&#160;Str function&#160;is&#160;limited to&#160;numbers&#160;and does&#160;not&#160;perform&#160;a&#160;locale-specific&#160;conversion.<br/>
<i><b>Table&#160;57.</b>&#160;Converting data&#160;types&#160;with CStr.</i><br/>
<i><b>Type</b></i><br/>
<i><b>Converted&#160;to&#160;String</b></i><br/>
Boolean<br/>
True&#160;or&#160;False<br/>
Date<br/>
Formatted&#160;date&#160;string&#160;such as 06/08/2010<br/>
Null, uninitialized&#160;object<br/>
Run-time&#160;error<br/>
Empty,&#160;uninitialized variant<br/>
Zero-length&#160;string<br/>
any&#160;numeric&#160;value<br/>
Number&#160;as&#160;a&#160;string<br/>
162<br/>
<hr/>
<a name=166></a><i><b>Listing&#160;148.</b>&#160;CStr&#160;with a few&#160;data&#160;types.<br/></i>Sub&#160;ExampleCStr<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;Handler<br/>&#160;&#160;Dim&#160;b&#160;As&#160;Boolean<br/>&#160;&#160;Dim&#160;o&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;v&#160;As&#160;Variant&#160;&#160;' This is empty<br/>&#160;&#160;Dim&#160;d&#160;As&#160;Double&#160; &#160;:&#160;d&#160;=&#160;PI()<br/>&#160; &#160;&#160;<br/>&#160;&#160;Print&#160;&#34;Boolean (&#34;&#160;&amp;&#160;CStr(b)&#160;&amp;&#160;&#34;)&#34;<br/>&#160;&#160;Print&#160;&#34;Date (&#34;&#160;&amp;&#160;CStr(Now)&#160;&amp;&#160;&#34;)&#34;<br/>&#160;&#160;Print&#160;&#34;Empty Variant (&#34;&#160;&amp;&#160;CStr(v)&#160;&amp;&#160;&#34;)&#34;<br/>&#160;&#160;Print&#160;&#34;Double (&#34;&#160;&amp;&#160;CStr(d)&#160;&amp;&#160;&#34;)&#34;<br/>&#160;&#160;Print&#160;&#34;Null object (&#34;&#160;&amp;&#160;CStr(o)&#160;&amp;&#160;&#34;)&#34;<br/>&#160;&#160;Exit&#160;Sub<br/>Handler:<br/>&#160;&#160;Print&#160;&#34;Encountered error: &#34;&#160;&amp;&#160;Error<br/>&#160;&#160;Resume&#160;Next<br/>End&#160;Sub<br/>
The&#160;CStr&#160;function is&#160;useful&#160;when you&#160;need to explicitly&#160;convert&#160;a&#160;value&#160;to&#160;a&#160;string to&#160;avoid&#160;incorrect&#160;default&#160;<br/>conversions&#160;to&#160;other types. For example,&#160;the&#160;first&#160;operand to the&#160;addition operator&#160;determines&#160;if the&#160;result&#160;is&#160;<br/>a&#160;string or a&#160;number.&#160;This&#160;is&#160;also an argument&#160;against&#160;the&#160;use&#160;of the&#160;addition&#160;operator (+)&#160;for string&#160;<br/>concatenation&#160;rather than the&#160;operator specifically&#160;designed for string concatenation&#160;(&amp;).<br/>
Print&#160;3&#160;+&#160;&#34;4&#34;&#160; &#160; &#160; &#160;&#160;'7<br/>Print&#160;CStr(3)&#160;+&#160;&#34;4&#34;&#160;&#160;'34<br/>
The&#160;Join function&#160;concatenates&#160;all&#160;of the&#160;elements&#160;in a&#160;one-dimensional&#160;array&#160;into&#160;a&#160;single&#160;string. If&#160;no&#160;<br/>delimiter is&#160;specified, a&#160;space&#160;separates&#160;each element.<br/>
Print&#160;Join(Array(3,&#160;4,&#160;5))&#160; &#160; &#160;&#160;'3 4 5<br/>Print&#160;Join(Array(3,&#160;4,&#160;5),&#160;&#34;X&#34;)&#160;'3X4X5<br/>
The&#160;Split&#160;function is&#160;used to&#160;split&#160;a&#160;string into&#160;pieces&#160;based on an optional&#160;delimiter.&#160;This&#160;is&#160;essentially&#160;the&#160;<br/>opposite&#160;of the&#160;Join function&#160;and is&#160;the&#160;fastest&#160;method to&#160;parse&#160;a&#160;string into a&#160;series&#160;of substrings&#160;based on a&#160;<br/>delimiter.<br/>
Split(&#34;3 4 5&#34;)&#160; &#160; &#160;&#160;'returns the array (3, 4, 5)<br/>Split(&#34;3X4X5&#34;,&#160;&#34;X&#34;)&#160;'returns the array (3, 4, 5)<br/>
<i><b>&#160;7.9.&#160;Advanced&#160;searching<br/></b></i>The&#160;usual&#160;search methods&#160;are&#160;StrCom<a href="libremacros.html#153">p (Listing 126)</a>, InSt<a href="libremacros.html#155">r (Listing 131)</a>, and InStrRe<a href="libremacros.html#155">v (Listing 132)</a>.&#160;<br/>Advanced searching can be&#160;done&#160;using the&#160;TextSearch service. Searching can be&#160;done&#160;using&#160;ABSOLUTE,&#160;<br/>REGEXP,&#160;or&#160;APPROXIMATE&#160;mode. I&#160;will&#160;not&#160;take&#160;the&#160;time&#160;to pursue&#160;the&#160;TextSearch service&#160;in&#160;depth;&#160;for&#160;<br/>example,&#160;to investigate&#160;replacing text.<br/>
<i><b>Listing&#160;149.</b>&#160;using the&#160;TextSearch service.</i><br/>
Sub&#160;StringTextSearch<br/>&#160;&#160;Dim&#160;oTextSearch&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' TextSearch service.<br/>&#160;&#160;Dim&#160;sStrToSearch&#160;As&#160;String&#160; &#160;&#160;' String to search.<br/>&#160;&#160;Dim&#160;sMatchString&#160;As&#160;String&#160; &#160;&#160;' String that was found.<br/>&#160;&#160;Dim&#160;aSearchResult&#160; &#160; &#160; &#160; &#160; &#160; &#160;' com.sun.star.util.SearchResult<br/>&#160;&#160;Dim&#160;rank&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;iMatchStartPos&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;iMatchLen&#160;As&#160;Long<br/>
163<br/>
<hr/>
<a name=167></a>&#160;&#160;Dim&#160;aSrcOpt&#160;As&#160;New&#160;com.sun.star.util.SearchOptions<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Dim&#160;enLocale&#160;As&#160;New&#160;com.sun.star.lang.Locale<br/>&#160;&#160;<br/>&#160;&#160;enLocale.Language&#160;=&#160;&#34;en&#34;<br/>&#160;&#160;enLocale.Country&#160;=&#160;&#34;US&#34;<br/>&#160;&#160;<br/>&#160;&#160;oTextSearch&#160;=&#160;CreateUnoService(&#34;com.sun.star.util.TextSearch&#34;)<br/>&#160;&#160;s&#160;=&#160;&#34;&#34;<br/>
&#160;&#160;With&#160;aSrcOpt<br/>&#160; &#160;&#160;'http://api.openoffice.org/docs/common/ref/com/sun/star/util/SearchFlags.html<br/>&#160; &#160;&#160;.searchFlag&#160;=&#160;com.sun.star.util.SearchFlags.REG_EXTENDED<br/>&#160; &#160;&#160;.Locale&#160;=&#160;enLocale<br/>&#160; &#160;&#160;'Supports ABSOLUTE, REGEXP, and APPROXIMATE<br/>&#160; &#160;&#160;.algorithmType&#160;=&#160;com.sun.star.util.SearchAlgorithms.REGEXP<br/>&#160; &#160;&#160;.searchString&#160;=&#160;&#34;a+&#34;<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;'This does not work.<br/>&#160; &#160;&#160;'.transliterateFlags = com.sun.star.i18n.TransliterationModulesNew.IGNORE_CASE<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;'This works<br/>&#160; &#160;&#160;.transliterateFlags&#160;=&#160;com.sun.star.i18n.TransliterationModulesNew.UPPERCASE_LOWERCASE<br/>&#160;&#160;End&#160;With<br/>
&#160;&#160;oTextSearch.setOptions(aSrcOpt)<br/>
&#160;&#160;sStrToSearch&#160;=&#160;&#34;aaa hello AAA&#34;&#160;<br/>&#160;&#160;aSearchResult&#160;=&#160;oTextSearch.searchForward(sStrToSearch,&#160;0,Len(sStrToSearch)-1&#160;)<br/>&#160;&#160;'Print aSearchResult.subRegExpressions<br/>
&#160;&#160;REM subRegExpressions has value zero if no match...<br/>&#160;&#160;Do&#160;While&#160;aSearchResult.subRegExpressions&#160;&gt;&#160;0<br/>&#160; &#160;&#160;'Print &#34;&#34; + LBound(aSearchResult.startOffset) + &#34;:&#34; + UBound(aSearchResult.startOffset)<br/>&#160; &#160;&#160;rank&#160;=&#160;aSearchResult.subRegExpressions&#160;-&#160;1<br/>&#160; &#160;&#160;iMatchStartPos&#160;=&#160;aSearchResult.startOffset(rank)&#160;+&#160;1<br/>&#160; &#160;&#160;iMatchLen&#160;=&#160;aSearchResult.endOffset(rank)&#160;-&#160;aSearchResult.startOffset(rank)<br/>&#160; &#160;&#160;sMatchString&#160;=&#160;Mid(sStrToSearch,&#160;iMatchStartPos,&#160;iMatchLen)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;(&#34;&#160;+&#160;LBound(aSearchResult.startOffset)&#160;&amp;&#160;&#34;:&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;UBound(aSearchResult.startOffset)&amp;&#160;&#34;) =&gt; &#34;&#160;&amp;&#160;sMatchString&#160;&amp;&#160;CHR$(10)<br/>
&#160; &#160;&#160;aSearchResult&#160;=&#160;oTextSearch.searchForward(sStrToSearch,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;aSearchResult.endOffset(rank)+1,Len(sStrToSearch)-1&#160;)<br/>&#160;&#160;Loop<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<i><b>&#160;7.10.&#160;Conclusion<br/></b></i>It&#160;pays&#160;to know&#160;the&#160;different&#160;functions&#160;supported by&#160;OOo Basic. Before&#160;I&#160;was&#160;aware&#160;of the&#160;Split&#160;function,&#160;I&#160;<br/>spent&#160;a&#160;lot&#160;of time&#160;writing a&#160;macro that&#160;parsed a&#160;string into&#160;pieces. I&#160;rewrote&#160;my&#160;code&#160;using&#160;the&#160;Split&#160;function<br/>
164<br/>
<hr/>
<a name=168></a>and the&#160;macro was&#160;significantly&#160;faster.&#160;It’s&#160;also important&#160;to&#160;know&#160;the&#160;limitations&#160;of strings. I&#160;saw&#160;a&#160;macro&#160;<br/>that&#160;counted words&#160;in a&#160;document&#160;by&#160;first&#160;converting the&#160;entire&#160;document&#160;into&#160;a&#160;single&#160;string.&#160;This&#160;technique<br/>worked well,&#160;and it&#160;was&#160;very&#160;fast,&#160;but&#160;it&#160;failed&#160;when the&#160;number of characters&#160;in the&#160;document&#160;exceeded&#160;<br/>65,535. &#160;<br/>
There&#160;are&#160;a&#160;lot&#160;of very&#160;powerful&#160;capabilities&#160;for formatting text&#160;in&#160;OOo Basic.&#160;Among other things, the&#160;use&#160;<br/>of the&#160;Unicode&#160;character set&#160;allows&#160;processing of nearly&#160;any&#160;language&#160;in&#160;the&#160;world.&#160;There&#160;are&#160;also a&#160;number&#160;<br/>of good functions&#160;for joining, splitting, and formatting text&#160;strings.<br/>
165<br/>
<hr/>
<a name=169></a><b>&#160;8.&#160;File&#160;Routines<br/></b>This&#160;chapter introduces&#160;the&#160;subroutines&#160;and functions&#160;supported&#160;by&#160;OpenOffice.org&#160;Basic&#160;that&#160;are&#160;related to&#160;<br/>files&#160;and directories.&#160;After reading this&#160;chapter you’ll&#160;be&#160;able&#160;to&#160;create, delete, rename,&#160;and move&#160;files&#160;and&#160;<br/>directories.&#160;You’ll&#160;learn methods&#160;that&#160;inspect&#160;files, both&#160;open and closed, and directories.&#160;This&#160;chapter also&#160;<br/>explains&#160;the&#160;idiosyncrasies&#160;and bugs&#160;related to reading and writing&#160;files, along with&#160;differences&#160;between&#160;<br/>operating systems.<br/>
OOo Basic&#160;includes&#160;functions&#160;that&#160;allow&#160;you to interact&#160;with&#160;the&#160;file&#160;system&#160;(see<a href="libremacros.html#169">&#160;Table&#160;58)</a>.&#160;You can perform<br/>simple&#160;and complex&#160;tasks&#160;such as&#160;creating and deleting directories, or even opening and parsing files.&#160;In&#160;this<br/>chapter I’ll&#160;spend a&#160;fair amount&#160;of time&#160;on directories, file&#160;attributes, and the&#160;different&#160;file&#160;types. I&#160;will&#160;<br/>examine&#160;how&#160;files&#160;are&#160;organized&#160;and manipulated, how&#160;the&#160;different&#160;file&#160;types&#160;are&#160;structured, and which&#160;<br/>functions&#160;read and write&#160;data&#160;for those&#160;different&#160;file&#160;types. I&#160;was&#160;happy&#160;with how&#160;easily&#160;I&#160;was&#160;able&#160;to&#160;write&#160;<br/>macros&#160;to&#160;move&#160;and rename&#160;files. On the&#160;other hand, the&#160;functions&#160;to manipulate&#160;binary&#160;and random&#160;files&#160;<br/>feel&#160;rough around the&#160;edges.<br/>
<i><b>Table&#160;58.</b>&#160;File&#160;functions&#160;in OOo Basic.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
ChDir(path)<br/>
Change&#160;the&#160;currently&#160;logged directory&#160;or&#160;drive. Deprecated;&#160;do not&#160;use.<br/>
ChDrive(path)<br/>
Change&#160;the&#160;currently&#160;logged drive.&#160;Deprecated;&#160;do&#160;not&#160;use.<br/>
Close&#160;#n<br/>
Close&#160;a&#160;previously&#160;opened file&#160;or&#160;files. Separate&#160;file&#160;numbers with&#160;a&#160;comma.<br/>
ConvertFromURL(str)<br/>
Convert&#160;a&#160;path expressed&#160;as a&#160;URL&#160;to a&#160;system-specific&#160;path.<br/>
ConvertToURL(str)<br/>
Convert&#160;a&#160;system-specific&#160;path to a&#160;URL.<br/>
CurDir<br/>
Return the&#160;current&#160;directory&#160;as a&#160;system-specific&#160;path. If&#160;the&#160;optional&#160;drive&#160;is&#160;specified,&#160;the&#160;<br/>
CurDir(drive)<br/>
current&#160;directory&#160;for&#160;the&#160;specified&#160;drive&#160;is&#160;returned.<br/>
Dir(path)<br/>
Return a&#160;listing&#160;of&#160;files based on an included path.&#160;The&#160;path may&#160;contain a&#160;file&#160;specification&#160;<br/>
Dir(path,&#160;attr)<br/>
—&#160;for&#160;example, “/home/andy/*.txt”. Optional&#160;attributes&#160;determine&#160;if&#160;a&#160;listing&#160;of&#160;files or&#160;<br/>
directories is returned.<br/>
EOF(number)<br/>
Return&#160;True&#160;if&#160;the&#160;file&#160;denoted&#160;by&#160;“number”&#160;is at&#160;the&#160;end&#160;of&#160;the&#160;file.<br/>
FileAttr(number,&#160;1)<br/>
Return the&#160;mode&#160;used to&#160;open the&#160;file&#160;given&#160;by&#160;“number”.&#160;The&#160;second&#160;argument&#160;specifies if&#160;<br/>the&#160;file-access&#160;or&#160;the&#160;operating-system&#160;mode&#160;is&#160;desired,&#160;but&#160;only&#160;the&#160;file&#160;mode&#160;is&#160;currently&#160;<br/>
supported.<br/>
FileCopy(src,&#160;dest)<br/>
Copy&#160;a&#160;file&#160;from&#160;source&#160;to destination.<br/>
FileDateTime(path)<br/>
Return the&#160;date&#160;and&#160;time&#160;of&#160;the&#160;specified&#160;file&#160;as a&#160;string.<br/>
FileExists(path)<br/>
Return&#160;True&#160;if&#160;the&#160;specified&#160;file&#160;or&#160;directory&#160;exists.<br/>
FileLen(path)<br/>
Return the&#160;length of&#160;the&#160;specified&#160;file&#160;as a&#160;long.<br/>
FreeFile()<br/>
Return the&#160;next&#160;available&#160;file&#160;number&#160;for&#160;use.<br/>
Get&#160;#number,&#160;variable<br/>
Read&#160;a&#160;record from&#160;a&#160;relative&#160;file, or&#160;a&#160;sequence&#160;of&#160;bytes from&#160;a&#160;binary&#160;file,&#160;into a&#160;variable.&#160;<br/>
Get&#160;#number,&#160;pos, variable<br/>
If&#160;the&#160;position&#160;argument&#160;is omitted,&#160;data&#160;is read&#160;from&#160;the&#160;current&#160;position&#160;in&#160;the&#160;file. For&#160;files<br/>
opened&#160;in&#160;binary&#160;mode, the&#160;position is&#160;the&#160;byte&#160;position in&#160;the&#160;file.<br/>
GetAttr(path)<br/>
Return a&#160;bit&#160;pattern identifying&#160;the&#160;file&#160;type.&#160;<br/>
GetPathSeparator()<br/>
Return the&#160;system-specific&#160;path separator.<br/>
Input&#160;#number,&#160;var<br/>
Sequentially&#160;read&#160;numeric&#160;or&#160;string&#160;records&#160;from&#160;an&#160;open file&#160;and&#160;assign the&#160;data&#160;to&#160;one&#160;or&#160;<br/>
more&#160;variables.&#160;The&#160;carriage&#160;return (ASC=13),&#160;line&#160;feed&#160;(ASC=10),&#160;and&#160;comma&#160;act&#160;as&#160;<br/>delimiters.&#160;Input&#160;cannot&#160;read commas&#160;or&#160;quotation&#160;marks (&#34;)&#160;because&#160;they&#160;delimit&#160;the&#160;text.&#160;<br/>
Use&#160;the&#160;Line&#160;Input&#160;statement&#160;if&#160;you&#160;must&#160;do&#160;this.<br/>
Kill(path)<br/>
Delete&#160;a&#160;file&#160;from&#160;disk.<br/>
Line&#160;Input&#160;#number,&#160;var<br/>
Sequentially&#160;read&#160;strings to a&#160;variable&#160;line-by-line&#160;up&#160;to the&#160;first&#160;carriage&#160;return&#160;(ASC=13)&#160;<br/>
166<br/>
<hr/>
<a name=170></a><i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
or&#160;line&#160;feed (ASC=10).&#160;Line&#160;end&#160;marks are&#160;not&#160;returned.<br/>
Loc(number)<br/>
Return the&#160;current&#160;position in an&#160;open file.<br/>
LOF(number)<br/>
Return the&#160;size&#160;of&#160;an&#160;open file,&#160;in&#160;bytes.<br/>
MkDir(path)<br/>
Create&#160;the&#160;directory.<br/>
Name&#160;src&#160;As&#160;dest<br/>
Rename&#160;a&#160;file&#160;or&#160;directory.<br/>
Open path For&#160;Mode&#160;As&#160;#n<br/>
Open a&#160;data&#160;channel&#160;(file)&#160;for&#160;Mode&#160;(Input&#160;=&#160;read, Output&#160;=&#160;write)<br/>
Put&#160;#n, var<br/>
Write&#160;a&#160;record to a&#160;relative&#160;file&#160;or&#160;a&#160;sequence&#160;of&#160;bytes to a&#160;binary&#160;file.<br/>
Put&#160;#n, pos,&#160;var<br/>Reset<br/>
Close&#160;all&#160;open&#160;files and flush&#160;all&#160;files to disk.<br/>
RmDir(path)<br/>
Remove&#160;a&#160;directory.<br/>
Seek #n, pos<br/>
Set&#160;the&#160;position for&#160;the&#160;next&#160;writing&#160;or&#160;reading&#160;in&#160;a&#160;file.<br/>
SetAttr(path, attr)<br/>
Set&#160;file&#160;attributes.<br/>
Write&#160;#n, string<br/>
Write&#160;data&#160;to a&#160;file.<br/>
<i><b>&#160;8.1.&#160;Using&#160;URL&#160;notation&#160;to&#160;specify&#160;a&#160;file<br/></b></i>Many&#160;of the&#160;functions&#160;in<a href="libremacros.html#169">&#160;Table&#160;58&#160;s</a>pecify&#160;a&#160;file&#160;or path.&#160;These&#160;functions&#160;accept&#160;both system-specific&#160;names&#160;<br/>and Uniform&#160;Resource&#160;Locator&#160;(URL)&#160;notation.&#160;This&#160;is&#160;the&#160;same&#160;notation used by&#160;your&#160;Web browser.<a href="libremacros.html#170">&#160;Table&#160;<br/>59&#160;s</a>hows&#160;examples.<br/>
<i><b>Table&#160;59.</b>&#160;URL&#160;examples.</i><br/>
<i><b>System</b></i><br/>
<i><b>System&#160;Path</b></i><br/>
<i><b>URL&#160;Path</b></i><br/>
Windows<br/>
c:\Temp\help.txt<br/>
file:///c:/Temp/help.txt<br/>
Windows<br/>
c:\My&#160;Documents<br/>
file:///c:/My%20Documents<br/>
Unix<br/>
/home/andy/Temp/help.txt<br/>
file:///home/andy/Temp/help.txt<br/>
Unix<br/>
/home/andy/My&#160;Documents<br/>
file:///home/andy/My%20Documents<br/>
<b>TIP</b><br/>
The&#160;statement&#160;“Shell(&#34;C:\Prog Files\calc.exe&#34;,2)”&#160;failed because&#160;there&#160;is a&#160;space&#160;in&#160;the&#160;path.&#160;The&#160;Shell&#160;<br/>statement&#160;passes the&#160;string&#160;to the&#160;command shell, which&#160;interprets&#160;the&#160;portion of&#160;the&#160;path&#160;before&#160;the&#160;space&#160;<br/>
as the&#160;program&#160;to run. URL&#160;notation avoids this problem.<br/>
One&#160;advantage&#160;of URL&#160;notation&#160;is&#160;that&#160;special&#160;characters&#160;are&#160;encoded.&#160;Arguments&#160;that&#160;are&#160;passed to&#160;a&#160;shell,&#160;<br/>for example,&#160;frequently&#160;have&#160;problems&#160;with&#160;paths&#160;that&#160;contain&#160;a&#160;space. In&#160;URL&#160;notation, spaces&#160;are&#160;encoded&#160;<br/>as&#160;“%20”&#160;(see<a href="libremacros.html#170">&#160;Table&#160;59)</a>. Use&#160;the&#160;functions&#160;ConvertToURL&#160;to&#160;convert&#160;a&#160;system-specific&#160;path to&#160;URL&#160;<br/>notation and ConvertFromURL&#160;to convert&#160;to&#160;a&#160;system-specific&#160;path.<br/>
<i><b>Listing&#160;150.</b>&#160;Converting&#160;to and from&#160;a URL.</i><br/>
Sub&#160;ToFromURL<br/>&#160;&#160;Print&#160;ConvertToURL(&#34;/home/andy/logo.miff&#34;)<br/>&#160;&#160;Print&#160;ConvertFromURL(&#34;file:///home/andy/logo.miff&#34;)&#160;'This requires UNIX<br/>&#160;&#160;Print&#160;ConvertToURL(&#34;c:\My Documents&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'This requires Windows<br/>&#160;&#160;Print&#160;ConvertFromURL(&#34;file:///c:/My%20Documents&#34;)&#160; &#160;'This requires windows<br/>End&#160;Sub<br/>
167<br/>
<hr/>
<a name=171></a>Special&#160;characters, such as&#160;the&#160;space, are&#160;encoded with a&#160;percent&#160;sign (%) followed by&#160;the&#160;ASCII&#160;value&#160;of&#160;<br/>the&#160;character encoded as&#160;a&#160;two-digit&#160;hexadecimal&#160;number.&#160;The&#160;space&#160;character has&#160;an&#160;ASCII&#160;value&#160;of 32,&#160;<br/>which&#160;is&#160;20 in&#160;hexadecimal&#160;format.&#160;This&#160;is&#160;why&#160;a&#160;space&#160;is&#160;encoded as&#160;%20.<br/>
<i><b>Listing&#160;151.</b>&#160;Special&#160;URL&#160;characters.<br/></i>Sub&#160;URLSpecialEncoding<br/>&#160;&#160;Print&#160;ConvertFromURL(&#34;file:///%41%42%43/%61%62%63&#34;)&#160;&#160;'/ABC/abc &#160;(UNIX)<br/>&#160;&#160;Print&#160;ConvertFromURL(&#34;file://c:/%41%42%43/%61%62%63&#34;)'/ABC/abc &#160;(Windows)<br/>End&#160;Sub<br/>
URL&#160;notation is&#160;system&#160;independent, so URL&#160;paths&#160;work as&#160;well&#160;on an&#160;Apple&#160;computer as&#160;they&#160;do on a&#160;<br/>Windows&#160;computer.&#160;To&#160;create&#160;a&#160;system-specific&#160;path, use&#160;the&#160;function&#160;GetPathSeparator to obtain the&#160;<br/>system-specific&#160;path&#160;separator.<a href="libremacros.html#171">&#160;Listing 152&#160;de</a>monstrates&#160;how&#160;to use&#160;GetPathSeparator&#160;to build a&#160;complete&#160;<br/>path.&#160;Windows-based computers&#160;use&#160;“\”&#160;as&#160;the&#160;path&#160;separator,&#160;and Unix-based computers&#160;use&#160;“/”&#160;as&#160;the&#160;path&#160;<br/>separator.&#160;URL&#160;notation&#160;uses&#160;“/”&#160;as&#160;the&#160;separator&#160;regardless&#160;of the&#160;operating&#160;system.<br/>
<i><b>Listing&#160;152.</b>&#160;Use&#160;GetPathSeparator()&#160;rather&#160;than&#160;“\”&#160;or&#160;“/”.</i><br/>
sPathToFile&#160;=&#160;&#34;C:\temp&#34;<br/>sBookName&#160; &#160;=&#160;&#34;OOME.odt&#34;<br/>sPathToBook&#160;=&#160;sPathToFile&#160;&amp;&#160;GetPathSeparator()&#160;&amp;&#160;sBookName<br/>
<b>TIP</b><br/>
Visual&#160;Basic&#160;for&#160;Applications&#160;(VBA)&#160;does not&#160;support&#160;the&#160;function GetPathSeparator,&#160;but&#160;it&#160;does have&#160;the&#160;<br/>property&#160;Application.PathSeparator,&#160;which always returns a&#160;backslash, even on&#160;a&#160;Macintosh computer.&#160;<br/>
VBA&#160;also&#160;does&#160;not&#160;support&#160;ConvertToURL&#160;or&#160;ConvertFromURL.<br/>
<i><b>&#160;8.2.&#160;Directory&#160;manipulation&#160;functions<br/></b></i>Some&#160;functions&#160;apply&#160;equally&#160;well&#160;to&#160;directories&#160;as&#160;well&#160;as&#160;files.&#160;This&#160;section&#160;is&#160;concerned with&#160;those&#160;that&#160;<br/>apply&#160;only&#160;to directories.<br/>
The&#160;function CurDir,&#160;with&#160;a&#160;drive&#160;specifier as&#160;the&#160;argument,&#160;returns&#160;the&#160;current&#160;directory&#160;for the&#160;specified&#160;<br/>drive.&#160;See<a href="libremacros.html#171">&#160;Listing 153&#160;and&#160;Figure&#160;56. I</a>f&#160;the&#160;argument&#160;is&#160;omitted, the&#160;current&#160;directory&#160;for the&#160;current&#160;drive&#160;is&#160;<br/>returned.&#160;The&#160;drive&#160;specifier is&#160;ignored on Unix&#160;systems.&#160;The&#160;initial&#160;value&#160;of the&#160;current&#160;directory&#160;is&#160;system&#160;<br/>dependent&#160;and may&#160;change&#160;depending upon how&#160;OOo is&#160;started. If&#160;you start&#160;OOo from&#160;a&#160;command-line&#160;<br/>prompt,&#160;you’ll&#160;likely&#160;have&#160;a&#160;different&#160;current&#160;directory&#160;than&#160;if you&#160;start&#160;OOo from&#160;a&#160;menu or another&#160;<br/>application.&#160;For&#160;some&#160;operating systems, using File&#160;|&#160;Open to&#160;open an existing document&#160;sets&#160;the&#160;current&#160;<br/>directory&#160;to&#160;the&#160;directory&#160;containing the&#160;opened document&#160;(I&#160;have&#160;seen this&#160;in&#160;Windows). In&#160;some&#160;operating&#160;<br/>systems,&#160;such as&#160;Linux, this&#160;does&#160;not&#160;affect&#160;the&#160;current&#160;directory.&#160;Do not&#160;rely&#160;on this&#160;behavior!<br/>
<i><b>Listing&#160;153.</b>&#160;Print&#160;the&#160;current&#160;directory.<br/></i>Sub&#160;ExampleCurDir<br/>&#160;&#160;MsgBox&#160;&#34;Current directory on this computer is &#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;CurDir,&#160;0,&#160;&#34;Current Directory Example&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;56.</b>&#160;CurDir&#160;returns&#160;the&#160;current&#160;directory.</i><br/>
The&#160;functions&#160;ChDir and ChDrive,&#160;although present&#160;in&#160;OOo Basic, do nothing and will&#160;likely&#160;be&#160;removed&#160;<br/>from&#160;the&#160;language.&#160;Their original&#160;purpose&#160;was&#160;to change&#160;the&#160;current&#160;drive&#160;and directory,&#160;but&#160;this&#160;was&#160;a&#160;<br/>
168<br/>
<hr/>
<a name=172></a>system&#160;wide&#160;change, which&#160;is&#160;dangerous&#160;in multitasking&#160;environments&#160;like&#160;we&#160;use&#160;today.&#160;The&#160;initial&#160;current&#160;<br/>directory&#160;is&#160;dependent&#160;upon the&#160;operating system&#160;and how&#160;OOo was&#160;opened.&#160;The&#160;initial&#160;values, therefore,&#160;<br/>cannot&#160;be&#160;assumed.&#160;<br/>
Use&#160;the&#160;MkDir&#160;function to&#160;create&#160;a&#160;directory,&#160;and RmDir&#160;to remove&#160;a&#160;directory.&#160;In<a href="libremacros.html#172">&#160;Listing&#160;154, a</a>&#160;directory&#160;<br/>path is&#160;created from&#160;the&#160;argument&#160;to&#160;MkDir.&#160;If&#160;an absolute&#160;path is&#160;not&#160;provided, the&#160;created directory&#160;is&#160;<br/>relative&#160;to the&#160;current&#160;directory&#160;as&#160;obtained&#160;with the&#160;function CurDir.&#160;The&#160;function&#160;RmDir&#160;removes&#160;the&#160;<br/>directory,&#160;all&#160;directories&#160;below&#160;it, and all&#160;files&#160;contained in&#160;the&#160;directories.&#160;This&#160;macro calls&#160;OOMEWorkDir&#160;<br/>i<a href="libremacros.html#190">n&#160;Listing&#160;165.</a><br/>
<i><b>Listing&#160;154.</b>&#160;Create&#160;and then&#160;remove&#160;directories&#160;in&#160;the&#160;OOME&#160;Work&#160;Directory.<br/></i>Sub&#160;ExampleCreateRmDirs<br/>&#160;&#160;If&#160;NOT&#160;CreateOOMEWorkDir()&#160;Then<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;Dim&#160;sWorkDir$<br/>&#160;&#160;Dim&#160;sPath$<br/>&#160;&#160;sWorkDir&#160;=&#160;OOMEWorkDir()<br/>&#160;&#160;sPath&#160;=&#160;sWorkDir&#160;&amp;&#160;&#34;a&#34;&#160;&amp;&#160;GetPathSeparator()&#160;&amp;&#160;&#34;b&#34;<br/>&#160;&#160;MkDir&#160;sPath<br/>&#160;&#160;Print&#160;&#34;Created &#34;&#160;&amp;&#160;sPath<br/>&#160;&#160;RmOOMEWorkDir()<br/>&#160;&#160;Print&#160;&#34;Removed &#34;&#160;&amp;&#160;sWorkDir<br/>End&#160;Sub<br/>
The&#160;code&#160;in<a href="libremacros.html#172">&#160;Listing 154&#160;us</a>es&#160;absolute&#160;paths. It’s&#160;possible&#160;to use&#160;relative&#160;paths,&#160;but&#160;I&#160;strongly&#160;discourage&#160;it.&#160;<br/>The&#160;behavior&#160;of the&#160;current&#160;directory&#160;is&#160;operating-system&#160;dependent.<br/>
File-related&#160;functions&#160;that&#160;also work with&#160;directories&#160;include&#160;Dir,&#160;FileDateTime,&#160;FileExists,&#160;FileLen,&#160;<br/>GetAttr,&#160;and Name.&#160;These&#160;are&#160;discussed later.<br/>
<i><b>&#160;8.3.&#160;File&#160;manipulation&#160;functions<br/></b></i>This&#160;section&#160;explores&#160;functions&#160;that&#160;deal&#160;with&#160;inspecting and manipulating entire&#160;files, rather than&#160;the&#160;<br/>contents&#160;of those&#160;files.&#160;Some&#160;of these&#160;functions&#160;have&#160;a&#160;dual&#160;purpose, acting on both files&#160;and directories. In&#160;<br/>each case, the&#160;function accepts&#160;at&#160;least&#160;one&#160;argument&#160;that&#160;identifies&#160;a&#160;file&#160;or directory.&#160;The&#160;following&#160;things&#160;<br/>are&#160;true&#160;about&#160;arguments&#160;that&#160;identify&#160;files&#160;or directories:<br/>
If the path is not present, the current directory — as returned by CurDir — is used.<br/>The system representation and the URL notation are both allowed. For example, “C:\tmp\foo.txt” and <br/>
“file:///c:/tmp/foo.txt” refer to the same file.<br/>Unless it is explicitly stated, a single file or directory must be uniquely identified. The only function that <br/>
accepts a file specification is Dir, which returns a listing of files matching the file specification.<br/>
Each file&#160;and directory&#160;has&#160;attributes&#160;(see<a href="libremacros.html#173">&#160;Table&#160;60). E</a>ach attribute&#160;represents&#160;a&#160;single&#160;bit&#160;in a&#160;number,&#160;<br/>allowing each item&#160;in a&#160;path to&#160;have&#160;multiple&#160;attributes&#160;set&#160;at&#160;the&#160;same&#160;time. Some&#160;attributes&#160;have&#160;been&#160;<br/>deprecated to&#160;be&#160;more&#160;system&#160;dependent. Not&#160;all&#160;systems&#160;support&#160;hidden&#160;or system&#160;files,&#160;for example.&#160;Use&#160;<br/>GetAttr to return the&#160;attributes.<br/>
169<br/>
<hr/>
<a name=173></a><i><b>Table&#160;60.</b>&#160;File&#160;and directory&#160;attributes.</i><br/>
<i><b>Deprecated</b></i><br/>
<i><b>Attribute</b></i><br/>
<i><b>Description</b></i><br/>
No<br/>
0<br/>
Normal;&#160;no bits set<br/>
No<br/>
1<br/>
Read-Only<br/>
Yes<br/>
2<br/>
Hidden<br/>
Yes<br/>
4<br/>
System<br/>
No<br/>
8<br/>
Volume<br/>
No<br/>
16<br/>
Directory<br/>
No<br/>
32<br/>
Archive&#160;bit&#160;(file&#160;changed&#160;since&#160;last&#160;backed&#160;up)<br/>
The&#160;function in<a href="libremacros.html#173">&#160;Listing 155&#160;a</a>ccepts&#160;an attribute&#160;from&#160;the&#160;GetAttr function&#160;and returns&#160;an easy-to-understand&#160;<br/>string. If&#160;no bits&#160;are&#160;set, the&#160;attributes&#160;indicate&#160;a&#160;normal&#160;file.<br/>
<i><b>Listing&#160;155.</b>&#160;Print&#160;attributes&#160;as&#160;a string.<br/></i>REM uses bitwise comparison to read the attributes<br/>Function&#160;FileAttributeString(x&#160;As&#160;Integer)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;If&#160;(x&#160;=&#160;0)&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;Normal&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;If&#160;(x&#160;AND&#160;16)&#160;&lt;&gt;&#160;0&#160;Then&#160;s&#160;=&#160;&#34;Directory&#34;&#160; &#160; &#160;&#160;'Directory bit 00010000 set<br/>&#160; &#160;&#160;If&#160;(x&#160;AND&#160;1)&#160;&#160;&lt;&gt;&#160;0&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Read-Only&#34;&#160;'read-only bit 00000001 set<br/>&#160; &#160;&#160;If&#160;(x&#160;AND&#160;2)&#160;&#160;&lt;&gt;&#160;0&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Hidden&#34;&#160; &#160;&#160;'Deprecated<br/>&#160; &#160;&#160;If&#160;(x&#160;AND&#160;4)&#160;&#160;&lt;&gt;&#160;0&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; System&#34;&#160; &#160;&#160;'Deprecated<br/>&#160; &#160;&#160;If&#160;(x&#160;AND&#160;8)&#160;&#160;&lt;&gt;&#160;0&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Volume&#34;&#160; &#160;&#160;'Volume bit &#160;00001000 set<br/>&#160; &#160;&#160;If&#160;(x&#160;AND&#160;32)&#160;&lt;&gt;&#160;0&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Archive&#34;&#160; &#160;'Archive bit 00100000 set<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;FileAttributeString&#160;=&#160;s<br/>End&#160;Function<br/>
<b>TIP</b><br/>
<a href="libremacros.html#173">Listing&#160;155&#160;pe</a>rforms bit&#160;operations (explained&#160;later)&#160;to determine&#160;which attributes are&#160;set.<br/>
Use&#160;the&#160;GetAttr function&#160;to get&#160;the&#160;attributes&#160;of a&#160;file, and use&#160;SetAttr&#160;to set&#160;the&#160;attributes.&#160;The&#160;first&#160;<br/>argument&#160;to the&#160;function SetAttr is&#160;the&#160;name&#160;of the&#160;file&#160;—&#160;relative&#160;or absolute&#160;—&#160;and the&#160;second argument&#160;is<br/>a&#160;number representing the&#160;attributes&#160;to set&#160;or clear.&#160;In&#160;other words, after calling SetAttr(name,&#160;n), the&#160;<br/>function GetAttr(name) should return the&#160;integer n. For example,&#160;calling SetAttr with the&#160;attribute&#160;set&#160;to 32&#160;<br/>sets&#160;the&#160;archive&#160;bit&#160;and clears&#160;all&#160;the&#160;others&#160;so GetAttr returns&#160;32.&#160;To&#160;set&#160;more&#160;than one&#160;bit&#160;at&#160;the&#160;same&#160;time,&#160;<br/>use&#160;the&#160;OR operator to&#160;combine&#160;attributes. Use&#160;SetAttr(fileName, 1 OR 32) to set&#160;both the&#160;archive&#160;bit&#160;and&#160;<br/>the&#160;read-only&#160;bit. SetAttr works&#160;on directories&#160;as&#160;well&#160;as&#160;files.<br/>
<b>TIP</b><br/>
Attributes favor&#160;the&#160;Windows&#160;environment. On&#160;Unix-based&#160;operating&#160;systems&#160;such&#160;as&#160;Linux and Sun,&#160;<br/>
setting&#160;attributes affects the&#160;user,&#160;group,&#160;and&#160;world&#160;settings. Setting&#160;the&#160;attribute&#160;to&#160;0 (not&#160;read-only)&#160;<br/>corresponds&#160;to “rwxrwxrwx”. Setting&#160;the&#160;attribute&#160;to 1&#160;(read-only)&#160;corresponds to&#160;“r&#160;&#160;r&#160;&#160;r”.<br/>
Use&#160;the&#160;FileLen function to&#160;determine&#160;the&#160;length of a&#160;file.&#160;The&#160;return value&#160;is&#160;a&#160;long.&#160;The&#160;function in<a href="libremacros.html#174">&#160;Listing&#160;<br/>156&#160;obt</a>ains&#160;the&#160;file&#160;length and then&#160;creates&#160;a&#160;pretty&#160;string to&#160;display&#160;the&#160;length.&#160;The&#160;file&#160;length is&#160;returned in&#160;<br/>bytes&#160;— K, MB, G, or&#160;T&#160;— depending on the&#160;length.&#160;This&#160;produces&#160;a&#160;more&#160;easily&#160;understood result&#160;than a&#160;<br/>simple&#160;number.<br/>
170<br/>
<hr/>
<a name=174></a><i><b>Listing&#160;156.</b>&#160;Display&#160;a number&#160;in&#160;a nice&#160;readable&#160;form&#160;such as&#160;2K&#160;rather&#160;than 2048.<br/></i>Function&#160;PrettyFileLen(path$)&#160;As&#160;String<br/>&#160;&#160;PrettyFileLen&#160;=&#160;nPrettyFileLen(FileLen(path))<br/>End&#160;Function<br/>
Function&#160;nPrettyFileLen(ByVal&#160;n&#160;As&#160;Double)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160;&#160;'Count number of iterations<br/>&#160;&#160;Dim&#160;v()&#160;As&#160;Variant&#160;&#160;'Holds abbreviations for Kilobytes, Megabytes, ...<br/>&#160;&#160;v()&#160;=&#160;Array(&#34;bytes&#34;,&#160;&#34;K&#34;,&#160;&#34;MB&#34;,&#160;&#34;G&#34;,&#160;&#34;T&#34;)&#160;'Abbreviations<br/>&#160;&#160;<br/>&#160;&#160;REM Every time that the number is reduced by 1 kilobyte,<br/>&#160;&#160;REM the counter is increased by 1.<br/>&#160;&#160;REM Do not decrease the size to less than 1 kilobyte.<br/>&#160;&#160;REM Do not increase the counter by more than the size of the array.<br/>&#160;&#160;Do&#160;While&#160;n&#160;&gt;&#160;1024&#160;AND&#160;i+1&#160;&lt;&#160;UBound(v())<br/>&#160; &#160;&#160;n&#160;=&#160;Fix(n&#160;/&#160;1024)&#160;'Truncate after the division<br/>&#160; &#160;&#160;i&#160;=&#160;i&#160;+&#160;1&#160; &#160; &#160; &#160; &#160;'Started at i=0 (bytes) increment to next abbreviation<br/>&#160;&#160;Loop<br/>&#160;&#160;nPrettyFileLen&#160;=&#160;CStr(n)&#160;&amp;&#160;v(i)<br/>End&#160;Function<br/>
Use&#160;the&#160;FileExists&#160;function&#160;to&#160;determine&#160;if&#160;a&#160;file&#160;or directory&#160;exists.&#160;Use&#160;FileDateTime&#160;to return a&#160;string with<br/>the&#160;date&#160;and time&#160;that&#160;a&#160;file&#160;was&#160;created&#160;or last&#160;modified.&#160;The&#160;returned string is&#160;in&#160;a&#160;system-dependent&#160;<br/>format.&#160;On my&#160;computer,&#160;the&#160;format&#160;is&#160;“MM/DD/YYYY&#160;HH:MM:SS”.&#160;The&#160;returned string&#160;can be&#160;passed&#160;<br/>directly&#160;to&#160;the&#160;function&#160;CDate.&#160;The&#160;GetFileInfo macro i<a href="libremacros.html#174">n&#160;Listing&#160;157&#160;us</a>es&#160;all&#160;of the&#160;file&#160;and directory&#160;<br/>inspection&#160;functions&#160;to&#160;return&#160;information&#160;in&#160;an easy-to-read format.&#160;Also see<a href="libremacros.html#175">&#160;Figure&#160;57.</a><br/>
<i><b>Listing&#160;157.</b>&#160;Get&#160;information about&#160;a file.<br/></i>Function&#160;GetFileInfo(path)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dim&#160;iAttr&#160;As&#160;Integer<br/>&#160;&#160;s&#160;=&#160;&#34;The path &#34;&#34;&#34;&#160;&amp;&#160;path&#160;&amp;&#160;&#34;&#34;&#34;&#34;&#160;<br/>&#160;&#160;If&#160;Not&#160;FileExists(path)&#160;Then<br/>&#160; &#160;&#160;GetFileInfo&#160;=&#160;s&#160;&amp;&#160;&#34; does not exist&#34;<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; exists&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Date and Time = &#34;&#160;&amp;&#160;FileDateTime(path)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;iAttr&#160;=&#160;GetAttr(path)<br/>&#160;&#160;REM The length of a directory is always zero<br/>&#160;&#160;If&#160;(iAttr&#160;AND&#160;16)&#160;=&#160;0&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;File length = &#34;&#160;&amp;&#160;PrettyFileLen(path)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Attributes = &#34;&#160;&amp;&#160;FileAttributeString(iAttr)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;GetFileInfo&#160;=&#160;s<br/>End&#160;Function<br/>
171<br/>
<hr/>
<a name=175></a><i><b>Figure&#160;57.</b>&#160;You&#160;can learn&#160;a lot&#160;about&#160;a file&#160;by&#160;using the&#160;file-inspection functions.</i><br/>
Use&#160;the&#160;Kill&#160;statement&#160;to&#160;delete&#160;a&#160;file&#160;from&#160;the&#160;disk.&#160;A&#160;run-time&#160;error occurs&#160;if the&#160;file&#160;does&#160;not&#160;exist.<br/>
Kill(&#34;C:\temp\BadFile.txt&#34;)<br/>
Use&#160;the&#160;FileCopy&#160;function&#160;to copy&#160;files.&#160;The&#160;first&#160;argument&#160;is&#160;the&#160;file&#160;to copy&#160;and the&#160;second argument&#160;is&#160;the<br/>destination&#160;file. See<a href="libremacros.html#175">&#160;Table&#160;61.&#160;</a>The&#160;FileCopy&#160;function&#160;is&#160;able&#160;to&#160;recursively&#160;copy&#160;entire&#160;directories, but&#160;it&#160;<br/>can’t&#160;handle&#160;file&#160;specifications.&#160;Surprisingly, if the&#160;first&#160;argument&#160;is&#160;a&#160;file, the&#160;second argument&#160;must&#160;also be&#160;<br/>a&#160;file&#160;—&#160;I&#160;expected that&#160;I&#160;could copy&#160;a&#160;file&#160;to a&#160;directory&#160;with FileCopy(&#34;C:\auto.bat&#34;, &#34;C:\bak\&#34;).<br/>
<i><b>Table&#160;61.</b>&#160;Arguments&#160;to FileCopy.</i><br/>
<i><b>Valid</b></i><br/>
<i><b>Source</b></i><br/>
<i><b>Destination</b></i><br/>
<i><b>Comment</b></i><br/>
Yes<br/>
File<br/>
File<br/>
Copy&#160;the&#160;file.&#160;The&#160;names&#160;do&#160;not&#160;have&#160;to&#160;be&#160;the&#160;same.<br/>
Yes<br/>
Directory<br/>
Directory<br/>
Recursively&#160;copy&#160;all&#160;files&#160;and&#160;directories contained&#160;in one&#160;directory<br/>
to another&#160;directory.<br/>
No<br/>
file&#160;spec<br/>
File&#160;specifications (wildcards,&#160;for&#160;example,&#160;*.*)&#160;are&#160;not&#160;allowed.<br/>
No<br/>
File<br/>
Directory<br/>
If&#160;the&#160;source&#160;is a&#160;file, the&#160;destination&#160;must&#160;also&#160;be&#160;a&#160;file.<br/>
FileCopy(&#34;C:\auto.bat&#34;,&#160;&#34;C:\auto.bak&#34;)&#160; &#160; &#160; &#160;'Copy file<br/>FileCopy(&#34;C:\auto.bat&#34;,&#160;&#34;C:\tmp\auto.bat&#34;)&#160; &#160;'Copy file<br/>FileCopy(&#34;C:\logs&#34;,&#160;&#34;C:\bak&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Copy directory<br/>
<b>TIP</b><br/>
Do not&#160;recursively&#160;copy&#160;a&#160;directory&#160;into&#160;itself&#160;—&#160;this&#160;creates an infinite&#160;loop.&#160;For&#160;example,&#160;<br/>FileCopy(&#34;C:\logs&#34;,&#160;&#34;C:\logs\bak&#34;)&#160;will&#160;never&#160;finish because&#160;the&#160;“bak”&#160;subdirectory&#160;immediately&#160;becomes&#160;<br/>
part&#160;of&#160;the&#160;contents of&#160;“logs”, which&#160;then has to&#160;be&#160;copied as well. Bad&#160;idea.<br/>
Use&#160;the&#160;Name&#160;statement&#160;to&#160;rename&#160;a&#160;file&#160;or directory.&#160;This&#160;statement&#160;has&#160;an unusual&#160;syntax:&#160;It&#160;places&#160;the&#160;<br/>keyword&#160;As&#160;between the&#160;source&#160;and destination names.<br/>
Name&#160;&#34;C:\Joe.txt&#34;&#160;As&#160;&#34;C:\bill.txt&#34;&#160; &#160;&#160;'Rename a file<br/>Name&#160;&#34;C:\logs&#34;&#160;As&#160;&#34;C:\oldlogs&#34;&#160; &#160; &#160; &#160;&#160;'Rename a directory<br/>Name&#160;&#34;C:\Joe.txt&#34;&#160;As&#160;&#34;C:\tmp\joe.txt&#34;&#160;'Move the file to the tmp directory<br/>Name&#160;&#34;C:\logs&#34;&#160;As&#160;&#34;C:\bak\logs&#34;&#160; &#160; &#160; &#160;'Move the logs directory<br/>
<b>TIP</b><br/>
A&#160;common&#160;power-user&#160;trick is&#160;to&#160;use&#160;the&#160;Name&#160;command to move&#160;a&#160;file&#160;or&#160;directory&#160;from&#160;one&#160;location to&#160;<br/>
another.<br/>
<i><b>&#160;8.4.&#160;File&#160;attributes,&#160;bitmasks,&#160;and&#160;binary&#160;numbers<br/></b></i>It&#160;isn’t&#160;necessary&#160;to understand&#160;binary&#160;numbers&#160;and bitmasks&#160;to&#160;use&#160;either file&#160;attributes&#160;or bitmasks&#160;in&#160;OOo&#160;<br/>Basic, so don’t&#160;panic;&#160;simply&#160;skip&#160;the&#160;parts&#160;that&#160;make&#160;your&#160;head spin. Understanding this&#160;material,&#160;however,&#160;<br/>makes&#160;it&#160;simpler to&#160;understand what&#160;is&#160;happening&#160;with&#160;file&#160;attributes&#160;and how&#160;to&#160;use&#160;them.<br/>
172<br/>
<hr/>
<a name=176></a>The&#160;file&#160;and directory&#160;attributes&#160;in<a href="libremacros.html#173">&#160;Table&#160;60&#160;w</a>ere&#160;strategically&#160;chosen to have&#160;a&#160;nice&#160;property&#160;when written&#160;<br/>in base&#160;2 (see<a href="libremacros.html#176">&#160;Table&#160;62)</a>&#160;—&#160;each attribute&#160;has&#160;only&#160;one&#160;bit&#160;set. Zero is&#160;a&#160;special&#160;case&#160;—&#160;it&#160;has&#160;no bits&#160;set.<br/>
<i><b>Table&#160;62.</b>&#160;File&#160;and directory&#160;attributes.</i><br/>
<i><b>Decimal&#160;</b></i><br/>
<i><b>Binary&#160;</b></i><br/>
<i><b>Description</b></i><br/>
<i><b>Comment</b></i><br/>
<i><b>Attribute</b></i><br/>
<i><b>Attribute</b></i><br/>
00<br/>
0000&#160;0000<br/>
Normal<br/>
No bits&#160;set<br/>
01<br/>
0000&#160;0001<br/>
Read-Only<br/>
Bit&#160;1&#160;set<br/>
02<br/>
0000&#160;0010<br/>
Hidden<br/>
Bit&#160;2&#160;set<br/>
04<br/>
0000&#160;0100<br/>
System<br/>
Bit&#160;3&#160;set<br/>
08<br/>
0000&#160;1000<br/>
Volume<br/>
Bit&#160;4&#160;set<br/>
16<br/>
0001&#160;0000<br/>
Directory<br/>
Bit&#160;5&#160;set<br/>
32<br/>
0010&#160;0000<br/>
Archive<br/>
Bit&#160;6&#160;set<br/>
Use&#160;GetAttr to obtain the&#160;attributes&#160;of a&#160;file&#160;or path. If&#160;the&#160;file&#160;or path&#160;is&#160;a&#160;directory,&#160;then&#160;bit&#160;5 is&#160;set.&#160;If&#160;the&#160;<br/>file&#160;or path is&#160;read-only,&#160;then&#160;bit&#160;1 is&#160;set.&#160;A&#160;returned attribute&#160;of 0 means&#160;that&#160;no bits&#160;are&#160;set&#160;and that&#160;this&#160;is&#160;a&#160;<br/>normal&#160;file. Consider an attribute&#160;value&#160;of 33, which in&#160;binary&#160;is&#160;0010 0001. Bit&#160;1 is&#160;set,&#160;so this&#160;is&#160;read-only.&#160;<br/>Bit&#160;6 is&#160;set,&#160;so this&#160;file&#160;has&#160; changed since&#160;it&#160;was&#160;last&#160;archived.&#160;You can see&#160;that&#160;you don’t&#160;need to&#160;know&#160;how&#160;<br/>to convert&#160;a&#160;decimal&#160;number into a&#160;binary&#160;number.&#160;However,&#160;you&#160;do need to know&#160;how&#160;to&#160;write&#160;a&#160;macro to&#160;<br/>determine&#160;which bits&#160;are&#160;set&#160;and which bits&#160;are&#160;not&#160;set. Use&#160;the&#160;AND&#160;operator to&#160;determine&#160;which bits&#160;are&#160;<br/>set.&#160;With&#160;AND, two things&#160;must&#160;both be&#160;true&#160;for the&#160;answer to&#160;be&#160;true. For&#160;example, my&#160;flashlight&#160;works&#160;if it<br/>has&#160;a&#160;light&#160;bulb&#160;AND&#160;it&#160;has&#160;batteries.&#160;<br/>
The&#160;AND&#160;operator works&#160;with&#160;numbers&#160;by&#160;performing&#160;this&#160;logical&#160;operation&#160;on each of the&#160;bits. For&#160;<br/>example,&#160;“3&#160;AND&#160;5”&#160;represented as&#160;base&#160;2 is&#160;“0011&#160;AND&#160;0101 =&#160;0001”. Bit&#160;1&#160;—&#160;the&#160;bit&#160;in&#160;the&#160;rightmost&#160;<br/>position&#160;—&#160;in&#160;each number is&#160;equal&#160;to 1, so bit&#160;1 in the&#160;result&#160;is&#160;also 1.&#160;All&#160;of the&#160;other bits&#160;do not&#160;have&#160;<br/>corresponding 1s&#160;in the&#160;same&#160;position, so all&#160;of the&#160;other bits&#160;in&#160;the&#160;result&#160;equal&#160;zero.&#160;<br/>
Now&#160;I’ll&#160;apply&#160;this&#160;idea&#160;to the&#160;problem&#160;at&#160;hand. If&#160;the&#160;numeric&#160;value&#160;of an attribute&#160;is&#160;not&#160;zero,&#160;then at&#160;least&#160;<br/>one&#160;property&#160;is&#160;set. Given this, you&#160;can then check each attribute&#160;as&#160;illustrated by&#160;the&#160;example&#160;in<a href="libremacros.html#176">&#160;Table&#160;63.</a><br/>
<i><b>Table&#160;63.</b>&#160;Check&#160;attribute&#160;value&#160;33 (100001)&#160;for&#160;each file&#160;property.</i><br/>
<b>Read-Only</b><br/>
<b>Hidden</b><br/>
<b>System</b><br/>
<b>Volume</b><br/>
<b>Directory</b><br/>
<b>Archive</b><br/>
&#160; &#160; 10 0001&#160;<br/>
&#160; &#160; 10 0001&#160;<br/>
&#160; &#160; 10 0001&#160;<br/>
&#160; &#160; 10 0001&#160;<br/>
&#160; &#160; 10 0001<br/>
&#160; &#160; 10 0001&#160;<br/>
AND 00 0001<br/>
AND 00 0010<br/>
AND 00 0100<br/>
AND 00 1000<br/>
AND 01 0000<br/>
AND 10 0000<br/>
(1) 00 0001<br/>
(0) 00 0000<br/>
(0) 00 0000<br/>
(0) 00 0000<br/>
(0) 00 0000<br/>
(32)10 0000<br/>
To&#160;do this&#160;in&#160;OOo Basic, use&#160;code&#160;similar to the&#160;following:<br/>
If&#160;TheAttribute&#160;=&#160;0&#160;Then<br/>&#160;&#160;REM No attributes set<br/>Else<br/>&#160;&#160;If&#160;(TheAttribute&#160;AND&#160;1)&#160;=&#160;1&#160;Then&#160;...&#160; &#160;'Read-Only file: bit 1 is set<br/>&#160;&#160;If&#160;(TheAttribute&#160;AND&#160;16)&#160;=&#160;16&#160;Then&#160;...&#160;'Directory: bit 5 is set.<br/>&#160;&#160;If&#160;(TheAttribute&#160;AND&#160;4)&#160;&lt;&gt;&#160;0&#160;Then&#160;...&#160;&#160;'Another way to code the same logic.&#160;<br/>End&#160;If<br/>
Each file&#160;and directory&#160;has&#160;an attribute&#160;defined as&#160;these&#160;bit&#160;patterns. If&#160;a&#160;bit&#160;in&#160;the&#160;attribute&#160;that&#160;corresponds&#160;<br/>to a&#160;particular property&#160;is&#160;set, then&#160;the&#160;file&#160;has&#160;that&#160;property.&#160;Performing the&#160;AND&#160;operator&#160;with the&#160;<br/>
173<br/>
<hr/>
<a name=177></a>individual&#160;bit&#160;positions&#160;determines&#160;if the&#160;file&#160;has&#160;that&#160;property.&#160;The&#160;function&#160;FileAttributeString in<a href="libremacros.html#173">&#160;Listing&#160;<br/>155&#160;us</a>es&#160;this&#160;method.<br/>
To&#160;set&#160;the&#160;archive&#160;bit&#160;and read-only&#160;bit&#160;on a&#160;file, combine&#160;the&#160;bits&#160;and call&#160;the&#160;function&#160;once. Use&#160;the&#160;OR&#160;<br/>operator to&#160;combine&#160;bit&#160;patterns.&#160;With&#160;the&#160;OR operator,&#160;if either bit&#160;is&#160;set, the&#160;resulting&#160;bit&#160;is&#160;a&#160;1.&#160;To&#160;set&#160;the&#160;<br/>read-only&#160;and the&#160;archive&#160;bits, use&#160;“1 OR 32”. If&#160;you set&#160;the&#160;attributes&#160;to 1, then&#160;all&#160;of the&#160;other attributes&#160;<br/>will&#160;be&#160;cleared and only&#160;the&#160;read-only&#160;bit&#160;will&#160;be&#160;set.<br/>
<i><b>&#160;8.5.&#160;Obtaining&#160;a&#160;directory&#160;listing<br/></b></i>Use&#160;the&#160;Dir function to&#160;obtain&#160;a&#160;directory&#160;listing.&#160;The&#160;first&#160;argument&#160;is&#160;a&#160;file&#160;specification.&#160;Although a&#160;file&#160;or&#160;<br/>directory&#160;may&#160;be&#160;uniquely&#160;identified,&#160;file&#160;specs&#160;(also called wildcards) are&#160;allowed. For&#160;example, the&#160;<br/>command&#160;Dir(&#34;C:\temp\*.txt&#34;) returns&#160;a&#160;list&#160;of all&#160;files&#160;that&#160;have&#160;the&#160;extension&#160;TXT.&#160;The&#160;second argument&#160;<br/>specifies&#160;attributes, for which there&#160;are&#160;two valid&#160;values:&#160;0 (the&#160;default)&#160;returns&#160;files;&#160;set&#160;the&#160;second&#160;<br/>argument&#160;to 16 to&#160;retrieve&#160;a&#160;list&#160;of directories.<br/>
<b>TIP</b><br/>
Most&#160;operating&#160;systems&#160;contain two special&#160;directory&#160;names, represented&#160;by&#160;a&#160;single&#160;period&#160;(.)&#160;and&#160;a&#160;<br/>
double&#160;period (..).&#160;A&#160;single&#160;period&#160;references the&#160;current&#160;directory,&#160;and two periods reference&#160;the&#160;parent&#160;<br/>directory.&#160;These&#160;special&#160;directories&#160;are&#160;included&#160;in&#160;the&#160;directory&#160;list&#160;as&#160;returned&#160;by&#160;the&#160;Dir&#160;function. If&#160;you&#160;<br/>
write&#160;a&#160;macro&#160;that&#160;looks at&#160;each directory&#160;recursively&#160;but&#160;you don’t&#160;take&#160;these&#160;two&#160;into&#160;consideration,&#160;your&#160;<br/>macro will&#160;erroneously&#160;run&#160;forever.<br/>
The&#160;first&#160;call&#160;to Dir starts&#160;reading a&#160;directory&#160;and returns&#160;the&#160;first&#160;file&#160;that&#160;matches. Each additional&#160;call,&#160;<br/>which&#160;takes&#160;no arguments, returns&#160;the&#160;next&#160;file&#160;that&#160;matches.&#160;<br/>
sFileName&#160;=&#160;Dir(path,&#160;attribute)&#160; &#160; &#160;'Get the first one<br/>Do&#160;While&#160;(sFileName&#160;&lt;&gt;&#160;&#34;&#34;)&#160; &#160; &#160; &#160; &#160; &#160;'While something found<br/>&#160;&#160;sFileName&#160;=&#160;Dir()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Get the next one<br/>Loop<br/>
If&#160;the&#160;path uniquely&#160;identifies&#160;a&#160;file&#160;or directory,&#160;only&#160;one&#160;entry&#160;is&#160;returned. For example,&#160;the&#160;command&#160;<br/>Dir(&#34;C:\tmp\autoexec.bat&#34;) returns&#160;the&#160;single&#160;file&#160;“autoexec.bat”.&#160;Less&#160;obviously,&#160;the&#160;command&#160;<br/>Dir(&#34;C:\tmp&#34;) returns&#160;the&#160;single&#160;directory&#160;“tmp”.&#160;To&#160;determine&#160;what&#160;a&#160;directory&#160;contains, the&#160;path&#160;must&#160;<br/>either contain&#160;a&#160;file&#160;specifier (C:\tmp\*.*) or the&#160;path must&#160;contain&#160;a&#160;trailing&#160;path&#160;separator (C:\tmp\).&#160;The&#160;<br/>code&#160;in<a href="libremacros.html#177">&#160;Listing 158<b>&#160;</b></a>performs&#160;a&#160;simple&#160;listing of the&#160;current&#160;directory;&#160;it&#160;uses&#160;the&#160;function&#160;GetPathSeparator&#160;<br/>to obtain the&#160;path separator in&#160;an operating-system-independent&#160;way.<br/>
<i><b>Listing&#160;158.</b>&#160;List&#160;the&#160;files&#160;in the&#160;current&#160;directory.</i><br/>
Sub&#160;ExampleDir<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Temporary string<br/>&#160;&#160;Dim&#160;sFileName&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Last name returned from DIR<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Count number of dirs and files<br/>&#160;&#160;Dim&#160;sPath&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Current path with path separator at end<br/>&#160;&#160;sPath&#160;=&#160;CurDir&#160;&amp;&#160;GetPathSeparator()&#160;'With no separator, DIR returns the<br/>&#160;&#160;sFileName&#160;=&#160;Dir(sPath,&#160;16)&#160; &#160; &#160; &#160; &#160;&#160;'directory rather than what it contains<br/>&#160;&#160;i&#160;=&#160;0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Initialize the variable<br/>&#160;&#160;Do&#160;While&#160;(sFileName&#160;&lt;&gt;&#160;&#34;&#34;)&#160; &#160; &#160; &#160; &#160;&#160;'While something returned<br/>&#160; &#160;&#160;i&#160;=&#160;i&#160;+&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Count the directories<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Dir &#34;&#160;&amp;&#160;CStr(i)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34; = &#34;&#160;&amp;&#160;sFileName&#160;&amp;&#160;CHR$(10)&#160;&#160;'Store in string for later printing<br/>&#160; &#160;&#160;sFileName&#160;=&#160;Dir()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Get the next directory name<br/>&#160;&#160;Loop<br/>&#160;&#160;i&#160;=&#160;0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Start counting over for files<br/>
174<br/>
<hr/>
<a name=178></a>&#160;&#160;sFileName&#160;=&#160;Dir(sPath,&#160;0)&#160; &#160; &#160; &#160; &#160; &#160;'Get files this time!<br/>&#160;&#160;Do&#160;While&#160;(sFileName&#160;&lt;&gt;&#160;&#34;&#34;)<br/>&#160; &#160;&#160;i&#160;=&#160;i&#160;+&#160;1<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;File &#34;&#160;&amp;&#160;CStr(i)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;sFileName&#160;&amp;&#160;&#34; &#160;&#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;PrettyFileLen(sPath&#160;&amp;&#160;sFileName)&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;sFileName&#160;=&#160;Dir()<br/>&#160;&#160;Loop<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;ConvertToURL(sPath)<br/>End&#160;Sub<br/>
Sample&#160;output&#160;from<a href="libremacros.html#177">&#160;Listing 158&#160;i</a>s&#160;shown in<a href="libremacros.html#178">&#160;Figure&#160;58. F</a>irst, the&#160;directories&#160;are&#160;listed.&#160;The&#160;first&#160;two&#160;<br/>directories, “.”&#160;and “..”, represent&#160;the&#160;following:<br/>
file:///home/andy/My%20Documents/OpenOffice/<br/>file:///home/andy/My%20Documents/<br/>
The&#160;inclusion of “.”&#160;and “..”&#160;is&#160;a&#160;common&#160;source&#160;of problems.&#160;A&#160;listing of directories&#160;contains&#160;these&#160;two&#160;<br/>directories, which&#160;should usually&#160;be&#160;ignored.<br/>
<i><b>Figure&#160;58.</b>&#160;Directory&#160;listing of&#160;the&#160;current&#160;directory.</i><br/>
<i><b>&#160;8.6.&#160;Open&#160;a&#160;file<br/></b></i>OpenOffice.org&#160;uses&#160;low-level, system-specific&#160;methods&#160;to manipulate&#160;files.&#160;The&#160;operating system&#160;maintains<br/>a&#160;list&#160;of the&#160;open files&#160;and identifies&#160;them&#160;with a&#160;number,&#160;which is&#160;called a&#160;“file&#160;handle.”&#160;In&#160;the&#160;world of&#160;<br/>Basic, this&#160;is&#160;usually&#160;called the&#160;“file&#160;number”&#160;or “data&#160;channel.”<br/>
To&#160;open a&#160;file,&#160;you&#160;must&#160;tell&#160;it&#160;what&#160;file&#160;number (file&#160;handle) to&#160;use. Use&#160;the&#160;FreeFile&#160;function&#160;to obtain an&#160;<br/>unused file&#160;number,&#160;which will&#160;be&#160;used when opening a&#160;file, referencing the&#160;open file,&#160;and when closing the&#160;<br/>file.&#160;The&#160;Open statement&#160;is&#160;used to open a&#160;file&#160;before&#160;it&#160;is&#160;usable&#160;for reading or writing.&#160;The&#160;Open statement&#160;<br/>requires&#160;a&#160;file&#160;number,&#160;which should&#160;always&#160;be&#160;obtained from&#160;the&#160;FreeFile&#160;function. Use&#160;the&#160;Close&#160;statement<br/>when you&#160;are&#160;finished with&#160;the&#160;file.&#160;You can close&#160;multiple&#160;files&#160;in&#160;a&#160;single&#160;statement&#160;by&#160;providing a&#160;comma-<br/>separated list&#160;of numbers&#160;after the&#160;Close&#160;statement.&#160;Use&#160;the&#160;Reset&#160;function to&#160;close&#160;all&#160;of the&#160;open files&#160;at&#160;<br/>one&#160;time&#160;without&#160;having to explicitly&#160;list&#160;the&#160;file&#160;numbers.&#160;All&#160;open file&#160;numbers&#160;are&#160;closed and their data&#160;is&#160;<br/>flushed to disk.<br/>
n&#160;=&#160;FreeFile()<br/>
175<br/>
<hr/>
<a name=179></a>Open&#160;FileName&#160;For&#160;Mode&#160;[Access&#160;ioMode]&#160;[Lock&#160;Mode]&#160;As&#160;#n&#160;[Len=Datalen]<br/>Close&#160;#n<br/>
“FileName”&#160;is&#160;the&#160;name&#160;of the&#160;file&#160;that&#160;you&#160;want&#160;to open. If&#160;the&#160;file&#160;name&#160;does&#160;not&#160;include&#160;the&#160;path,&#160;the&#160;<br/>current&#160;directory&#160;is&#160;assumed.&#160;“For Mode”&#160;specifies&#160;the&#160;state&#160;of the&#160;file&#160;when it&#160;is&#160;opened and how&#160;you&#160;intend<br/>to use&#160;the&#160;file&#160;(see<a href="libremacros.html#179">&#160;Table&#160;64)</a>.<br/>
<i><b>Table&#160;64.</b>&#160;Valid “For&#160;Mode”&#160;values&#160;and the&#160;resulting&#160;configuration&#160;if&#160;Access&#160;is&#160;not&#160;used.</i><br/>
<b>For Mode</b><br/>
<b>File&#160;Pointer&#160;File&#160;Exists&#160;No File</b><br/>
<b>Read</b><br/>
<b>Write</b><br/>
<b>Comment</b><br/>
For&#160;Append<br/>
end<br/>
Open<br/>
Create<br/>
Yes<br/>
Yes<br/>
Sequential&#160;access<br/>
For&#160;Input<br/>
start<br/>
Open<br/>
error<br/>
Yes<br/>
No<br/>
Sequential&#160;access<br/>
For&#160;Output<br/>
start<br/>
Delete<br/>
Create<br/>
Yes<br/>
Yes<br/>
Sequential&#160;access<br/>
For&#160;Binary<br/>
start<br/>
Delete<br/>
Create<br/>
Yes<br/>
Yes<br/>
Random&#160;access<br/>
For&#160;Random<br/>
start<br/>
Delete<br/>
Create<br/>
Yes<br/>
Yes<br/>
Random&#160;access<br/>
Each mode&#160;has&#160;its&#160;own set&#160;of behaviors&#160;as&#160;shown in<a href="libremacros.html#179">&#160;Table&#160;64. Cons</a>ider the&#160;row&#160;For Input,&#160;this&#160;can be&#160;read&#160;<br/>to say:&#160;When a&#160;file&#160;is&#160;opened “For Input”:<br/>
1.&#160;The&#160;file&#160;pointer is&#160;positioned&#160;at&#160;the&#160;start&#160;of the&#160;file.<br/>
2.&#160;If&#160;the&#160;file&#160;exists, it&#160;is&#160;opened (and not&#160;deleted).&#160;<br/>
3.&#160;If&#160;the&#160;file&#160;does&#160;not&#160;exist,&#160;an error is&#160;generated.<br/>
4.&#160;The&#160;file&#160;is&#160;opened with&#160;read access, but&#160;not&#160;write&#160;access&#160;(assuming that&#160;Access&#160;is&#160;not&#160;explicitly&#160;<br/>
provided).<br/>
5.&#160;Sequential&#160;access&#160;is&#160;used for reading the&#160;file.<br/>
Unfortunately,&#160;the&#160;precise&#160;implementation is&#160;dependent&#160;on the&#160;operating&#160;system&#160;and even the&#160;compiler used&#160;<br/>to create&#160;your version&#160;of OOo;&#160;for example,&#160;on some&#160;systems,&#160;you&#160;can write&#160;to a&#160;file&#160;opened for Input.<br/>
When&#160;a&#160;file&#160;is&#160;open, a&#160;pointer into&#160;the&#160;file&#160;is&#160;maintained.&#160;This&#160;pointer&#160;identifies&#160;where&#160;the&#160;next&#160;read or write&#160;<br/>operation will&#160;occur.&#160;For example,&#160;if the&#160;file&#160;pointer is&#160;at&#160;the&#160;start&#160;of the&#160;file,&#160;the&#160;next&#160;“read”&#160;command will&#160;<br/>read the&#160;first&#160;thing in the&#160;file. If&#160;the&#160;file&#160;pointer is&#160;at&#160;the&#160;end of the&#160;file, the&#160;next&#160;“write”&#160;command&#160;will&#160;<br/>append data&#160;to the&#160;end of the&#160;file.&#160;You have&#160;some&#160;control&#160;over the&#160;initial&#160;position of the&#160;file&#160;pointer when the<br/>file&#160;is&#160;opened, and you can move&#160;this&#160;file&#160;pointer around when the&#160;file&#160;is&#160;open.&#160;All&#160;of the&#160;“For”&#160;modes,&#160;<br/>except&#160;“For&#160;Append,”&#160;position&#160;the&#160;file&#160;pointer at&#160;the&#160;start&#160;of the&#160;file.<br/>
You can access&#160;a&#160;file&#160;sequentially&#160;or randomly.&#160;A&#160;sequential&#160;file&#160;is&#160;similar to a&#160;video&#160;tape.&#160;Although you&#160;can&#160;<br/>fast&#160;forward and rewind&#160;the&#160;tape&#160;to&#160;a&#160;specific&#160;location on the&#160;tape, the&#160;entire&#160;tape&#160;moves&#160;past&#160;the&#160;read/write&#160;<br/>head.&#160;You then press&#160;Play&#160;or Record and the&#160;data&#160;is&#160;either sequentially&#160;read from&#160;or written to&#160;the&#160;tape.&#160;A&#160;<br/>random&#160;file&#160;is&#160;similar to&#160;a&#160;music&#160;CD.&#160;Although you&#160;can play&#160;the&#160;CD&#160;sequentially,&#160;it&#160;isn’t&#160;required;&#160;you&#160;can&#160;<br/>quickly&#160;jump to&#160;any&#160;song and play&#160;it.&#160;To&#160;make&#160;the&#160;analogy&#160;more&#160;accurate, however,&#160;each song on the&#160;CD&#160;<br/>must&#160;be&#160;the&#160;same&#160;size.&#160;This&#160;is&#160;the&#160;disadvantage&#160;to&#160;the&#160;“For Random”&#160;mode.<br/>
Consider storing&#160;names&#160;of different&#160;lengths&#160;in a&#160;file&#160;on the&#160;disk.&#160;Storing&#160;one&#160;name&#160;per line&#160;in the&#160;file&#160;is&#160;<br/>efficient&#160;with respect&#160;to space.&#160;You can use&#160;a&#160;new-line&#160;character between each name.&#160;To&#160;find a&#160;specific&#160;name<br/>in the&#160;file, you start&#160;at&#160;the&#160;beginning and read until&#160;you find the&#160;person’s&#160;name. On the&#160;other hand, if you&#160;<br/>know&#160;that&#160;the&#160;longest&#160;name&#160;is&#160;100 characters, you can store&#160;each name&#160;on the&#160;disk,&#160;and store&#160;enough spaces&#160;<br/>after the&#160;name&#160;to use&#160;a&#160;total&#160;of 100 characters&#160;for each name.&#160;This&#160;wastes&#160;space, but&#160;it&#160;allows&#160;you&#160;to&#160;quickly&#160;<br/>move&#160;between names&#160;on the&#160;disk, because&#160;of the&#160;regular file&#160;structure.&#160;To&#160;read or write&#160;the&#160;1000th&#160;name&#160;in&#160;<br/>the&#160;file,&#160;you&#160;simply&#160;move&#160;directly&#160;to&#160;that&#160;record.&#160;You have&#160;wasted space&#160;in&#160;this&#160;design, but&#160;you have&#160;gained&#160;<br/>speed performance.&#160;All&#160;of the&#160;“For”&#160;modes,”&#160;except&#160;“For Binary”&#160;and “For Random,”&#160;specify&#160;sequential&#160;file&#160;<br/>
176<br/>
<hr/>
<a name=180></a>access. Random&#160;files&#160;use&#160;this&#160;ability&#160;to&#160;fix&#160;the&#160;record length to&#160;the&#160;maximum&#160;size&#160;of interest&#160;in&#160;order to&#160;<br/>permit&#160;very&#160;rapid&#160;file&#160;access&#160;and retrieval.<br/>
The&#160;access&#160;modes&#160;i<a href="libremacros.html#180">n&#160;Table&#160;65&#160;a</a>ffect&#160;the&#160;default&#160;treatment&#160;of a&#160;file&#160;when it&#160;is&#160;opened.&#160;When an access&#160;mode&#160;<br/>is&#160;specified, it&#160;also&#160;verifies&#160;that&#160;you have&#160;access&#160;to&#160;either read or write&#160;the&#160;file. If&#160;you&#160;do not&#160;have&#160;write&#160;<br/>access&#160;to a&#160;file&#160;opened with&#160;“Access&#160;Write,”&#160;a&#160;run-time&#160;error occurs.&#160;The&#160;access&#160;mode&#160;affects&#160;every&#160;open&#160;<br/>“For”&#160;mode&#160;except&#160;“For&#160;Append”&#160;—&#160;which&#160;never deletes&#160;an existing&#160;file&#160;when it&#160;is&#160;opened.&#160;<br/>
<i><b>Table&#160;65.</b>&#160;Valid&#160;Access&#160;ioModes.</i><br/>
<i><b>Access&#160;ioMode</b></i><br/>
<i><b>Description</b></i><br/>
Access Read<br/>
Do&#160;not&#160;delete&#160;an existing&#160;file.&#160;Verify&#160;that&#160;you&#160;have&#160;read&#160;access.<br/>
Access&#160;Write<br/>
Delete&#160;an&#160;existing&#160;file.&#160;Verify&#160;that&#160;you have&#160;write&#160;access.<br/>
Access Read&#160;Write<br/>
Delete&#160;an&#160;existing&#160;file.&#160;Verify&#160;that&#160;you have&#160;read&#160;and&#160;write&#160;access.<br/>
Using&#160;“Access&#160;Write”&#160;while&#160;opening&#160;a&#160;file&#160;“For Input”&#160;allows&#160;you&#160;to&#160;write&#160;to&#160;the&#160;file&#160;after it&#160;is&#160;opened;&#160;first&#160;<br/>the&#160;file&#160;is&#160;erased and then a&#160;new&#160;file&#160;is&#160;created.&#160;After the&#160;file&#160;is&#160;open, different&#160;operating systems&#160;enforce&#160;the&#160;<br/>access&#160;rights&#160;differently.&#160;As&#160;of OOo version 1.1.1, opening&#160;a&#160;binary&#160;or random&#160;file&#160;with “Access&#160;Read”&#160;<br/>allows&#160;you&#160;to&#160;write&#160;to&#160;the&#160;file&#160;when using&#160;Windows, but&#160;not&#160;on Linux. It&#160;is&#160;always&#160;safe&#160;to&#160;open a&#160;file&#160;“For&#160;<br/>Append”&#160;and then move&#160;the&#160;file&#160;pointer to&#160;the&#160;start&#160;of the&#160;file&#160;manually.<br/>
<b>TIP</b><br/>
The&#160;only&#160;safe&#160;way&#160;to&#160;open a&#160;file&#160;for&#160;both reading&#160;and&#160;writing&#160;without&#160;erasing&#160;the&#160;contents of&#160;the&#160;file&#160;is to&#160;<br/>
open the&#160;file&#160;“For&#160;Append,”&#160;and&#160;then&#160;move&#160;the&#160;file&#160;pointer&#160;to&#160;the&#160;start&#160;of&#160;the&#160;file.<br/>
To&#160;limit&#160;access&#160;to&#160;a&#160;file&#160;while&#160;it’s&#160;open, use&#160;the&#160;“Lock”&#160;modes&#160;(see<a href="libremacros.html#180">&#160;Table&#160;66).&#160;</a>This&#160;prevents&#160;others&#160;from&#160;<br/>reading&#160;and/or writing to&#160;the&#160;file&#160;while&#160;you&#160;have&#160;it&#160;open.&#160;This&#160;is&#160;primarily&#160;used in&#160;multi-user environments&#160;<br/>because&#160;you&#160;can’t&#160;control&#160;what&#160;others&#160;might&#160;try&#160;to&#160;do while&#160;you&#160;are&#160;using the&#160;file.<br/>
<i><b>Table&#160;66.</b>&#160;Valid protected keywords.</i><br/>
<i><b>Lock&#160;Mode</b></i><br/>
<i><b>Description</b></i><br/>
Lock Read<br/>
Others&#160;cannot&#160;read&#160;the&#160;file&#160;while&#160;it’s&#160;open, but&#160;they&#160;can write&#160;to it.<br/>
Lock&#160;Write<br/>
Others&#160;cannot&#160;write&#160;the&#160;file&#160;while&#160;it’s&#160;open, but&#160;they&#160;can read&#160;from&#160;it.<br/>
Lock Read&#160;Write<br/>
Others&#160;cannot&#160;read&#160;or&#160;write&#160;the&#160;file&#160;while&#160;it&#160;is open.<br/>
Use&#160;the&#160;Len keywords&#160;to specify&#160;the&#160;size&#160;of each record when the&#160;file&#160;is&#160;opened “For Random”&#160;(discussed&#160;<br/>later).<br/>
<i><b>&#160;8.7.&#160;Information&#160;about&#160;open&#160;files<br/></b></i>OOo Basic&#160;has&#160;functions&#160;that&#160;return file&#160;information by&#160;using the&#160;file&#160;name&#160;(see<a href="libremacros.html#174">&#160;Listing&#160;157). &#160;I</a>t&#160;is&#160;also&#160;<br/>possible&#160;to&#160;obtain&#160;information about&#160;open files&#160;from&#160;the&#160;file&#160;number.&#160;The&#160;FileAttr function&#160;returns&#160;how&#160;the&#160;<br/>file&#160;associated with&#160;the&#160;given file&#160;number was&#160;opene<a href="libremacros.html#180">d.&#160;Table&#160;67&#160;l</a>ists&#160;the&#160;return values&#160;and their&#160;meanings.<br/>
FileAttr(n, 1) &#160;'How the file was opened in BASIC using Open For ...<br/>
<i><b>Table&#160;67.</b>&#160;Description&#160;of&#160;FileAttr()&#160;return values.</i><br/>
<i><b>Return&#160;Value</b></i><br/>
<i><b>Description</b></i><br/>
1<br/>
Open For&#160;Input<br/>
2<br/>
Open For&#160;Output<br/>
4<br/>
Open For&#160;Random<br/>
177<br/>
<hr/>
<a name=181></a><i><b>Return&#160;Value</b></i><br/>
<i><b>Description</b></i><br/>
8<br/>
Open for&#160;Append<br/>
16<br/>
Open For&#160;Binary<br/>
32<br/>
Documentation incorrectly&#160;states that&#160;this&#160;is&#160;for&#160;open for&#160;binary.<br/>
<b>TIP</b><br/>
FileAttr&#160;is&#160;incorrectly&#160;documented.&#160;FileAttr(n,&#160;2)&#160;does&#160;not&#160;return a&#160;system&#160;file&#160;handle,&#160;if&#160;the&#160;second&#160;<br/>
argument&#160;is not&#160;1,&#160;the&#160;return value&#160;is&#160;always 0.&#160;Another&#160;problem&#160;is that&#160;the&#160;included&#160;help&#160;incorrectly&#160;states&#160;<br/>that&#160;Binary&#160;has a&#160;return&#160;value&#160;of&#160;32.<br/>
Use&#160;the&#160;EOF&#160;function to&#160;determine&#160;if the&#160;end of the&#160;file&#160;has&#160;been reached.&#160;A&#160;typical&#160;use&#160;is&#160;to read all&#160;of the&#160;<br/>data&#160;until&#160;“End Of File.”<br/>
n&#160;=&#160;FreeFile&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Always find the next free file number<br/>Open&#160;FileName&#160;For&#160;Input&#160;As&#160;#n&#160;&#160;'Open the file for input<br/>Do&#160;While&#160;NOT&#160;EOF(n)&#160; &#160; &#160; &#160; &#160; &#160;&#160;'While NOT End Of File<br/>&#160;&#160;Input&#160;#n,&#160;s&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Read some data!<br/>&#160;&#160;REM Process the input here!<br/>Loop<br/>
Use&#160;the&#160;LOF&#160;function&#160;to&#160;determine&#160;the&#160;length&#160;of an open file.&#160;This&#160;number is&#160;always&#160;in bytes.<br/>
LOF(n)<br/>
Use&#160;the&#160;Loc&#160;function to&#160;obtain&#160;the&#160;current&#160;location of the&#160;file&#160;pointer.&#160;This&#160;number is&#160;not&#160;always&#160;accurate&#160;<br/>and the&#160;return&#160;value&#160;has&#160;a&#160;different&#160;meaning depending on how&#160;the&#160;file&#160;was&#160;opened. Loc&#160;returns&#160;the&#160;actual&#160;<br/>byte&#160;position for files&#160;opened in&#160;Binary&#160;mode. For Random&#160;files, &#160;Loc&#160;returns&#160;the&#160;record number of the&#160;last&#160;<br/>record read or written. For sequential&#160;files&#160;opened with Input,&#160;Output,&#160;or&#160;Append, however,&#160;the&#160;number&#160;<br/>returned by&#160;Loc&#160;is&#160;the&#160;current&#160;byte&#160;position&#160;divided&#160;by&#160;128.&#160;This&#160;is&#160;done&#160;to maintain compatibility&#160;with&#160;other<br/>versions&#160;of BASIC.&#160;<br/>
Loc(n)<br/>
<b>TIP</b><br/>
If&#160;a&#160;file&#160;is opened in&#160;a&#160;mode&#160;other&#160;than Random, and&#160;OOo Basic&#160;considers the&#160;file&#160;a&#160;text&#160;file, Loc&#160;returns&#160;<br/>the&#160;line&#160;number&#160;that&#160;will&#160;be&#160;read next. I&#160;cannot&#160;decide&#160;if&#160;this&#160;is&#160;a&#160;bug&#160;or&#160;just&#160;incomplete&#160;documentation.&#160;<br/>
Sometimes the&#160;return values from&#160;Loc&#160;are&#160;just&#160;wrong. For&#160;example,&#160;if&#160;you open&#160;a&#160;file&#160;for&#160;output&#160;and&#160;then&#160;<br/>write&#160;some&#160;text, Loc&#160;returns 0.<br/>
The&#160;Seek function, when used with&#160;only&#160;one&#160;argument, returns&#160;the&#160;next&#160;position that&#160;will&#160;be&#160;read or written.&#160;<br/>This&#160;is&#160;similar to&#160;the&#160;Loc&#160;function&#160;except&#160;that&#160;for sequential&#160;files, the&#160;absolute&#160;byte&#160;position&#160;is&#160;always&#160;<br/>returned. If&#160;you&#160;want&#160;to&#160;save&#160;the&#160;position in&#160;a&#160;file&#160;and return&#160;to it&#160;later,&#160;use&#160;the&#160;Seek function to&#160;obtain&#160;the&#160;<br/>current&#160;file&#160;pointer;&#160;then you can use&#160;the&#160;Seek function&#160;to return the&#160;file&#160;pointer to the&#160;original&#160;location.<br/>
position&#160;=&#160;Seek(n)&#160; &#160;&#160;'Obtain and save the current position.<br/>statements&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Do arbitrary stuff.<br/>Seek(n,&#160;position)&#160; &#160; &#160;'Move the file pointer back to the original position.<br/>
The&#160;argument&#160;for setting the&#160;file&#160;pointer using the&#160;Seek function&#160;is&#160;the&#160;same&#160;as&#160;the&#160;value&#160;returned by&#160;the&#160;<br/>Seek function. For Random&#160;files, the&#160;position&#160;is&#160;the&#160;number of the&#160;object&#160;to read, not&#160;the&#160;byte&#160;position.&#160;For&#160;<br/>sequential&#160;files, the&#160;position is&#160;the&#160;byte&#160;position in&#160;the&#160;file.&#160;The&#160;macro in<a href="libremacros.html#182">&#160;Listing 159&#160;r</a>eturns&#160;information&#160;<br/>about&#160;an open file&#160;from&#160;the&#160;file&#160;number,&#160;including the&#160;open mode, file&#160;length,&#160;and file&#160;pointer locati<a href="libremacros.html#182">on.<br/>Listing 160&#160;us</a>es<a href="libremacros.html#182">&#160;Listing&#160;159, a</a>nd the&#160;result&#160;is&#160;shown i<a href="libremacros.html#183">n&#160;Figure&#160;59.</a><br/>
178<br/>
<hr/>
<a name=182></a><i><b>Listing&#160;159.</b>&#160;Return information&#160;about&#160;an open file&#160;as&#160;a string.<br/></i>Function&#160;GetOpenFileInfo(n&#160;As&#160;Integer)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dim&#160;iAttr&#160;As&#160;Integer<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;BadFileNumber<br/>&#160;&#160;iAttr&#160;=&#160;FileAttr(n,&#160;1)<br/>&#160;&#160;If&#160;iAttr&#160;=&#160;0&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;File handle &#34;&#160;&amp;&#160;CStr(n)&#160;&amp;&#160;&#34; is not currently open&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;File handle &#34;&#160;&amp;&#160;CStr(n)&#160;&amp;&#160;&#34; was opened in mode:&#34;<br/>&#160; &#160;&#160;If&#160;(iAttr&#160;AND&#160;1)&#160;&#160;=&#160;&#160;1&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Input&#34;<br/>&#160; &#160;&#160;If&#160;(iAttr&#160;AND&#160;2)&#160;&#160;=&#160;&#160;2&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Output&#34;<br/>&#160; &#160;&#160;If&#160;(iAttr&#160;AND&#160;4)&#160;&#160;=&#160;&#160;4&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Random&#34;<br/>&#160; &#160;&#160;If&#160;(iAttr&#160;AND&#160;8)&#160;&#160;=&#160;&#160;8&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Append&#34;<br/>&#160; &#160;&#160;If&#160;(iAttr&#160;AND&#160;16)&#160;=&#160;16&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; Binary&#34;<br/>&#160; &#160;&#160;iAttr&#160;=&#160;iAttr&#160;AND&#160;NOT&#160;(1&#160;OR&#160;2&#160;OR&#160;4&#160;OR&#160;8&#160;OR&#160;16)<br/>&#160; &#160;&#160;If&#160;iAttr&#160;AND&#160;NOT&#160;(1&#160;OR&#160;2&#160;OR&#160;4&#160;OR&#160;8&#160;OR&#160;16)&#160;&lt;&gt;&#160;0&#160;Then&#160;<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; unsupported attribute &#34;&#160;&amp;&#160;CStr(iAttr)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;File length = &#34;&#160;&amp;&#160;nPrettyFileLen(LOF(n))&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;File location = &#34;&#160;&amp;&#160;CStr(LOC(n))&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Seek = &#34;&#160;&amp;&#160;CStr(Seek(n))&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;End Of File = &#34;&#160;&amp;&#160;CStr(EOF(n))&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;End&#160;If<br/>AllDone:<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;0<br/>&#160;&#160;GetOpenFileInfo&#160;=&#160;s<br/>&#160;&#160;Exit&#160;Function<br/>BadFileNumber:<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Error with file handle &#34;&#160;&amp;&#160;CStr(n)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#160;&#34;The file is probably not open&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;Error()<br/>&#160;&#160;Resume&#160;AllDone<br/>End&#160;Function<br/>
<b>TIP</b><br/>
The&#160;position argument&#160;passed to&#160;the&#160;Seek function&#160;is one-based,&#160;not&#160;zero-based.&#160;This means that&#160;the&#160;first&#160;<br/>
byte&#160;or&#160;record&#160;is 1,&#160;not&#160;0.&#160;For&#160;example,&#160;Seek(n, 1)&#160;positions the&#160;file&#160;pointer&#160;to&#160;the&#160;first&#160;byte&#160;or&#160;record&#160;in&#160;the&#160;<br/>file.<br/>
The&#160;macro i<a href="libremacros.html#182">n&#160;Listing&#160;160&#160;ope</a>ns&#160;a&#160;file&#160;for output.&#160;A&#160;large&#160;amount&#160;of data&#160;is&#160;written&#160;to the&#160;file&#160;to&#160;give&#160;it&#160;some&#160;<br/>size.&#160;At&#160;this&#160;point,&#160;the&#160;Loc&#160;function&#160;returns&#160;0 and EOF&#160;returns&#160;True.&#160;The&#160;Seek function is&#160;used to&#160;move&#160;the&#160;<br/>file&#160;pointer to&#160;a&#160;position&#160;in&#160;the&#160;file&#160;that&#160;allows&#160;some&#160;data&#160;to&#160;be&#160;read.&#160;The&#160;Loc&#160;function&#160;still&#160;returns&#160;0. One&#160;<br/>hundred pieces&#160;of data&#160;are&#160;read from&#160;the&#160;file&#160;in&#160;order to advance&#160;the&#160;value&#160;returned by&#160;the&#160;Loc&#160;function.&#160;<br/>Finally,&#160;the&#160;file&#160;is&#160;deleted&#160;from&#160;the&#160;dis<a href="libremacros.html#183">k.&#160;Figure&#160;59&#160;s</a>hows&#160;information&#160;based on a&#160;file&#160;number.<br/>
<i><b>Listing&#160;160.</b>&#160;Create&#160;delme.txt&#160;in&#160;the&#160;current&#160;directory&#160;and print&#160;file&#160;information.<br/></i>Sub&#160;WriteExampleGetOpenFileInfo<br/>&#160;&#160;Dim&#160;FileName&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Holds the file name<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Holds the file number<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Temporary string for input<br/>&#160;&#160;FileName&#160;=&#160;ConvertToURL(CurDir)&#160;&amp;&#160;&#34;/delme.txt&#34;<br/>&#160;&#160;n&#160;=&#160;FreeFile()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Next free file number<br/>
179<br/>
<hr/>
<a name=183></a>&#160;&#160;Open&#160;FileName&#160;For&#160;Output&#160;Access&#160;Read&#160;Write&#160;As&#160;#n&#160; &#160;&#160;'Open for read/write<br/>&#160;&#160;For&#160;i&#160;=&#160;1&#160;To&#160;15032&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Write a lot of data<br/>&#160; &#160;&#160;Write&#160;#n,&#160;&#34;This is line &#34;,CStr(i),&#34;or&#34;,i&#160; &#160; &#160; &#160; &#160;&#160;'Write some text &#160; &#160;<br/>&#160;&#160;Next<br/>&#160;&#160;Seek&#160;#n,&#160;1022&#160; &#160; &#160; &#160;'Move the file pointer to location 1022<br/>&#160;&#160;For&#160;i&#160;=&#160;1&#160;To&#160;100&#160; &#160;&#160;'Read 100 pieces of data; this will set Loc<br/>&#160; &#160;&#160;Input&#160;#n,&#160;s&#160; &#160; &#160; &#160;'Read one piece of data into the variable s<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;GetOpenFileInfo(n),&#160;0,&#160;FileName<br/>&#160;&#160;Close&#160;#n<br/>&#160;&#160;Kill(FileName)&#160; &#160; &#160;&#160;'Delete this file, I do not want it<br/>End&#160;Sub<br/>
<i><b>Figure&#160;59.</b>&#160;Information based on a file&#160;number.</i><br/>
<i><b>&#160;8.8.&#160;Reading&#160;and&#160;writing&#160;data<br/></b></i>Files&#160;opened for Random&#160;and Binary&#160;data&#160;use&#160;the&#160;statements&#160;Put&#160;and Get&#160;for writing&#160;and reading data. Files&#160;<br/>opened in&#160;any&#160;other mode&#160;use&#160;the&#160;Line&#160;Input,&#160;Input, Print, and&#160;Write&#160;statements&#160;for reading and writing. If&#160;<br/>no expressions&#160;are&#160;entered, a&#160;blank line&#160;is&#160;written to&#160;the&#160;file.&#160;The&#160;Write&#160;statement&#160;accepts&#160;multiple&#160;<br/>arguments&#160;to&#160;print&#160;to the&#160;file&#160;and it&#160;automatically&#160;adds&#160;delimiters&#160;as&#160;it&#160;writes. In&#160;the&#160;created&#160;file, each&#160;<br/>expression is&#160;separated by&#160;a&#160;comma. Strings&#160;are&#160;enclosed&#160;in double&#160;quotation marks, numbers&#160;are&#160;not&#160;<br/>enclosed&#160;in anything, and dates&#160;and Boolean values&#160;are&#160;enclosed between octothorpe&#160;(#) characters.<br/>
Write&#160;#n,&#160;expression1,&#160;expression2,&#160;expression3,&#160;...<br/>Print&#160;#n,&#160;expression1,&#160;expression2,&#160;expression3,&#160;...<br/>
<b>TIP</b><br/>
The&#160;character&#160;“#”&#160;has&#160;many&#160;names, including&#160;number&#160;sign, pound sign, hash,&#160;sharp,&#160;crunch, hex,&#160;grid,&#160;<br/>
pigpen, tic-tac-toe,&#160;splat,&#160;crosshatch, and octothorpe,&#160;to name&#160;a&#160;few.<br/>
The&#160;Print&#160;statement&#160;does&#160;not&#160;write&#160;any&#160;useful&#160;delimiters. Instead, it&#160;writes&#160;spaces&#160;between each expression.&#160;<br/>Numbers&#160;typically&#160;use&#160;13 spaces.<br/>
&#160;&#160;Write&#160;#n,&#160;i,&#160;&#34;the time # is&#34;,&#160;Now,&#160;CDbl(1.221),&#160;CBool(0)<br/>&#160;&#160;Print&#160;#n,&#160;i,&#160;&#34;the time # is&#34;,&#160;Now,&#160;CDbl(1.221),&#160;Cbool(0)<br/>
The&#160;code&#160;above&#160;produces&#160;the&#160;text&#160;below.<br/>
0,&#34;the time # is&#34;,#07/01/2010 21:05:49#,1.221,#False#&#160;<br/>&#160;0 &#160; &#160; &#160; &#160; &#160; &#160;the time # is 07/01/2010 21:05:49 1.221 &#160; &#160; &#160; &#160;False&#160;<br/>
<a href="libremacros.html#183">Listing 161&#160;de</a>monstrates&#160;the&#160;difference&#160;between&#160;Write&#160;and Print.<br/>
<i><b>Listing&#160;161.</b>&#160;Demonstrate&#160;Write&#160;versus&#160;Print.<br/></i>Sub&#160;ExampleWriteOrPrint<br/>&#160;&#160;Dim&#160;FileName&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Holds the file name<br/>
180<br/>
<hr/>
<a name=184></a>&#160;&#160;Dim&#160;n&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Holds the file number<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Temporary string for input<br/>&#160;&#160;Dim&#160;sTemp$<br/>&#160;&#160;FileName&#160;=&#160;ConvertToURL(CurDir)&#160;&amp;&#160;&#34;/delme.txt&#34;<br/>&#160;&#160;n&#160;=&#160;FreeFile()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Next free file number<br/>&#160;&#160;Open&#160;FileName&#160;For&#160;Output&#160;Access&#160;Read&#160;Write&#160;As&#160;#n&#160; &#160;&#160;'Open for read/write<br/>
&#160;&#160;Write&#160;#n,&#160;i,&#160;&#34;the time # is&#34;,&#160;Now,&#160;CDbl(1.221),&#160;CBool(0)<br/>&#160;&#160;Print&#160;#n,&#160;i,&#160;&#34;the time # is&#34;,&#160;Now,&#160;CDbl(1.221),&#160;CBool(0)<br/>&#160;&#160;<br/>&#160;&#160;Seek&#160;#n,&#160;1&#160; &#160; &#160; &#160; &#160;&#160;'Move the file pointer to location 1<br/>&#160;&#160;Line&#160;Input&#160;#n,&#160;s<br/>&#160;&#160;Line&#160;Input&#160;#n,&#160;sTemp<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;sTemp<br/>&#160;&#160;MsgBox&#160;s<br/>&#160;&#160;Close&#160;#n<br/>&#160;&#160;Kill(FileName)&#160; &#160; &#160;&#160;'Delete this file, I do not want it<br/>End&#160;Sub<br/>
As&#160;its&#160;name&#160;implies, the&#160;Line&#160;Input&#160;statement&#160;reads&#160;an entire&#160;line&#160;of text&#160;(see<a href="libremacros.html#183">&#160;Listing&#160;161), but</a>&#160;it&#160;does&#160;not&#160;<br/>return the&#160;delimiter.&#160;Each line&#160;is&#160;delimited&#160;by&#160;either a&#160;carriage&#160;return&#160;(ASCII&#160;value&#160;13) or a&#160;line-feed&#160;<br/>character (ASCII&#160;value&#160;10).&#160;These&#160;two delimiters&#160;work to read lines&#160;on every&#160;operating system&#160;supported&#160;by&#160;<br/>OpenOffice.org.<br/>
Line&#160;Input&#160;#n,&#160;stringVar&#160; &#160; &#160;'Read an entire line but not the delimiter.<br/>
The&#160;Input&#160;statement&#160;reads&#160;text&#160;based on the&#160;following delimiters:&#160;comma, carriage&#160;return,&#160;or line-feed&#160;<br/>characters.&#160;The&#160;Input&#160;statement&#160;can read multiple&#160;variables&#160;of differing types&#160;in&#160;a&#160;single&#160;command.&#160;<br/>Changing&#160;Line&#160;Input&#160;to&#160;Input&#160;i<a href="libremacros.html#183">n&#160;Listing&#160;161&#160;c</a>auses&#160;only&#160;the&#160;first&#160;two items&#160;to&#160;be&#160;read rather than&#160;two lines.<br/>
Input&#160;#n,&#160;var1,&#160;var2,&#160;var3,&#160;...<br/>
The&#160;Write&#160;command adds&#160;appropriate&#160;delimiters&#160;automatically&#160;so that&#160;you can read string and numeric&#160;data&#160;<br/>into&#160;the&#160;appropriate&#160;variable&#160;types.&#160;The&#160;Input&#160;command automatically&#160;removes&#160;commas&#160;and double&#160;<br/>quotation marks&#160;from&#160;the&#160;input&#160;when these&#160;characters&#160;are&#160;used as&#160;the&#160;delimiters. See<a href="libremacros.html#184">&#160;Listing 162&#160;a</a><a href="libremacros.html#185">nd&#160;Figure&#160;<br/>60&#160;f</a>or input&#160;examples.<br/>
<i><b>Listing&#160;162.</b>&#160;Use&#160;Input&#160;to&#160;read text&#160;written&#160;with&#160;Write.<br/></i>Sub&#160;ExampleInput<br/>&#160;&#160;Dim&#160;sFileName&#160;As&#160;String<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;t&#160;As&#160;String,&#160;d&#160;As&#160;Double,&#160;s&#160;As&#160;String<br/>&#160;&#160;sFileName&#160;=&#160;ConvertToURL(CurDir)&#160;&amp;&#160;&#34;/delme.txt&#34;<br/>&#160;&#160;n&#160;=&#160;FreeFile()<br/>&#160;&#160;Open&#160;sFileName&#160;For&#160;Output&#160;Access&#160;Read&#160;Write&#160;As&#160;#n<br/>&#160;&#160;Write&#160;#n,&#160;1.33,&#160;Now,&#160;&#34;I am a string&#34;<br/>&#160;&#160;Seek(n,&#160;1)<br/>&#160;&#160;Input&#160;#n,&#160;d,&#160;t,&#160;s<br/>&#160;&#160;close&#160;#n<br/>&#160;&#160;Kill(sFileName)<br/>&#160;&#160;s&#160;=&#160;&#34;string (&#34;&#160;&amp;&#160;s&#160;&amp;&#160;&#34;)&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;number (&#34;&#160;&amp;&#160;d&#160;&amp;&#160;&#34;)&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;time &#160; (&#34;&#160;&amp;&#160;t&#160;&amp;&#160;&#34;) &lt;== read as a string&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Example Input&#34;<br/>
181<br/>
<hr/>
<a name=185></a>End&#160;Sub<br/>
<i><b>Figure&#160;60.</b>&#160;Input&#160;cannot&#160;read time&#160;delimited with&#160;“#”.</i><br/>
<b>TIP</b><br/>
A&#160;friend in&#160;Germany&#160;had&#160;different&#160;results, because&#160;the&#160;number&#160;1.33&#160;is written as 1,33.&#160;While&#160;reading&#160;the&#160;<br/>
values, the&#160;comma&#160;is&#160;seen as a&#160;delimiter&#160;rather&#160;than as part&#160;of&#160;the&#160;number.&#160;<br/>
Unfortunately,&#160;the&#160;delimiters&#160;produced by&#160;the&#160;Write&#160;statement&#160;are&#160;not&#160;supported by&#160;the&#160;Input&#160;statement.&#160;<br/>Numbers&#160;and simple&#160;strings&#160;read with no problems.&#160;Date&#160;and Boolean values&#160;delimited&#160;with&#160;the&#160;# character,&#160;<br/>however,&#160;fail.&#160;These&#160;values&#160;must&#160;be&#160;read into&#160;string variables&#160;and then parsed.&#160;<br/>
Do not&#160;use&#160;the&#160;Input&#160;statement&#160;if you do not&#160;have&#160;a&#160;lot&#160;of control&#160;over the&#160;input&#160;text&#160;file. Double-quotation&#160;<br/>marks&#160;and commas&#160;in&#160;text&#160;strings&#160;are&#160;assumed to&#160;be&#160;text&#160;delimiters.&#160;The&#160;end result&#160;is&#160;that&#160;the&#160;text&#160;is&#160;not&#160;<br/>properly&#160;parsed when it&#160;is&#160;read. If&#160;your input&#160;data&#160;may&#160;contain&#160;these&#160;characters, use&#160;the&#160;Line&#160;Input&#160;command<br/>and then manually&#160;parse&#160;the&#160;text. If&#160;you must&#160;read the&#160;carriage&#160;return&#160;or line-feed characters, the&#160;file&#160;should&#160;<br/>be&#160;read as&#160;a&#160;binary&#160;file.<br/>
A&#160;binary&#160;file&#160;is&#160;a&#160;random&#160;file&#160;with a&#160;block&#160;length of zero. Use&#160;the&#160;Put&#160;statement&#160;to&#160;write&#160;random&#160;and binary&#160;<br/>files.&#160;The&#160;simplest&#160;case&#160;involves&#160;putting a&#160;simple&#160;variable&#160;directly&#160;to&#160;the&#160;file.&#160;<br/>
int_var&#160;=&#160;4&#160;:&#160;long_var&#160;=&#160;2<br/>Put&#160;#n,,int_var&#160; &#160;&#160;'04 00 &#160; &#160; &#160; (two bytes written)<br/>Put&#160;#n,,long_var&#160; &#160;'02 00 00 00 (four bytes written)<br/>
The&#160;first&#160;argument&#160;is&#160;the&#160;file&#160;number and the&#160;third argument&#160;is&#160;the&#160;variable&#160;or data&#160;to write.&#160;The&#160;second&#160;<br/>argument&#160;is&#160;the&#160;position&#160;in&#160;the&#160;file&#160;where&#160;the&#160;date&#160;should be&#160;written.&#160;If&#160;you omit&#160;the&#160;position,&#160;as&#160;shown in&#160;<br/>the&#160;example, you&#160;must&#160;still&#160;include&#160;the&#160;comma.<br/>
Put&#160;#n,,variable&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Write to the next record or byte position<br/>Put&#160;#n,&#160;position,&#160;variable&#160; &#160;'Specify the next record or byte position<br/>
Random&#160;files&#160;assume&#160;that&#160;the&#160;position&#160;identifies&#160;a&#160;record number.&#160;Binary&#160;files&#160;assume&#160;that&#160;the&#160;position&#160;<br/>identifies&#160;an absolute&#160;byte&#160;position.&#160;If&#160;the&#160;position&#160;is&#160;not&#160;specified,&#160;the&#160;data&#160;is&#160;written at&#160;the&#160;current&#160;file&#160;<br/>pointer,&#160;which is&#160;advanced with&#160;the&#160;data&#160;that&#160;is&#160;written.<br/>
If&#160;the&#160;data&#160;variable&#160;is&#160;a&#160;Variant,&#160;an integer identifying the&#160;data&#160;type&#160;precedes&#160;the&#160;data.&#160;This&#160;integer is&#160;the&#160;<br/>same&#160;integer returned by&#160;the&#160;VarType&#160;function,&#160;to be&#160;detailed later.<br/>
v&#160;=&#160;4&#160; &#160; &#160; &#160; &#160; &#160;'A Variant variable<br/>Put&#160;#n,,v&#160; &#160; &#160; &#160;'02 00 04 00 &#160;(first two bytes says type is 2)<br/>Put&#160;#n,,4&#160; &#160; &#160; &#160;'02 00 04 00 &#160;(first two bytes says type is 2)<br/>Put&#160;#n,,CInt(4)&#160;'02 00 04 00 &#160;(first two bytes says type is 2)<br/>
A&#160;string&#160;stored as&#160;a&#160;Variant&#160;includes&#160;the&#160;VarType&#160;if&#160;it&#160;is&#160;“Put”&#160;to a&#160;file&#160;that&#160;was&#160;opened as&#160;any&#160;type&#160;other than<br/>Binary.&#160;When&#160;an array&#160;is&#160;Put&#160;to a&#160;file,&#160;each element&#160;of the&#160;array&#160;is&#160;written.&#160;If&#160;the&#160;array&#160;contains&#160;a&#160;String&#160;<br/>Variant, it&#160;includes&#160;the&#160;VarType&#160;even if the&#160;file&#160;type&#160;is&#160;Binary.&#160;When Put&#160;places&#160;a&#160;string as&#160;a&#160;Variant, it&#160;<br/>actually&#160;writes&#160;the&#160;VarType, the&#160;string length, and then the&#160;string.&#160;<br/>
182<br/>
<hr/>
<a name=186></a>v()&#160;=&#160;Array(&#34;ABCD&#34;)&#160;'ASCII in hexadecimal is 41 42 43 44<br/>Put&#160;#n,,v()&#160; &#160; &#160; &#160; &#160;'08 00 04 00 41 42 43 44 (08 00 = type)(04 00 = length)<br/>
When&#160;data&#160;is&#160;Put&#160;to&#160;a&#160;file, the&#160;current&#160;file&#160;pointer is&#160;saved and then all&#160;of the&#160;data&#160;is&#160;written. If&#160;a&#160;non-zero&#160;<br/>block length is&#160;used, the&#160;file&#160;pointer is&#160;positioned one&#160;block&#160;length past&#160;the&#160;saved file&#160;position&#160;regardless&#160;of&#160;<br/>how&#160;much&#160;data&#160;was&#160;written. For example,&#160;if the&#160;block&#160;length&#160;is&#160;32 and the&#160;current&#160;file&#160;position&#160;is&#160;64, the&#160;file&#160;<br/>pointer is&#160;positioned to&#160;byte&#160;96 after the&#160;data&#160;is&#160;written.&#160;If&#160;more&#160;than&#160;32 bytes&#160;are&#160;written, part&#160;of the&#160;next&#160;<br/>record is&#160;overwritten.&#160;If&#160;fewer than 32 bytes&#160;are&#160;written,&#160;then the&#160;previous&#160;data&#160;is&#160;left&#160;unchanged. Because&#160;of<br/>this,&#160;some&#160;people&#160;initialize&#160;every&#160;record that&#160;will&#160;be&#160;written when the&#160;file&#160;is&#160;created. Numeric&#160;values&#160;are&#160;<br/>usually&#160;initialized to&#160;zero, and string&#160;values&#160;are&#160;usually&#160;initialized&#160;to&#160;spaces.<br/>
On the&#160;other hand, even though I&#160;don’t&#160;recommend&#160;it,&#160;you&#160;can use&#160;the&#160;Put&#160;statement&#160;with&#160;a&#160;file&#160;opened in a&#160;<br/>sequential&#160;mode. Likewise, you&#160;can use&#160;the&#160;Write, Line&#160;Input, and Input&#160;statements&#160;for files&#160;opened in&#160;<br/>Binary&#160;or Random&#160;mode.&#160;The&#160;actual&#160;bytes&#160;written&#160;for writing&#160;methods&#160;used for files&#160;of the&#160;“wrong”&#160;file&#160;<br/>structure&#160;are&#160;not&#160;documented, and I&#160;had difficulty&#160;understanding the&#160;output.&#160;I&#160;finally&#160;read the&#160;source&#160;code&#160;to&#160;<br/>determine&#160;what&#160;is&#160;written in&#160;each case, but&#160;undocumented&#160;behavior&#160;determined in&#160;this&#160;way&#160;should&#160;not&#160;be&#160;<br/>assumed&#160;to be&#160;stable,&#160;reliable&#160;behavior for OOo Basic. If&#160;you want&#160;to&#160;use&#160;these&#160;methods&#160;for other file&#160;<br/>structures&#160;than&#160;those&#160;documented,&#160;I&#160;recommend that&#160;you&#160;test&#160;the&#160;output&#160;for your specific&#160;data.&#160;When&#160;a&#160;piece&#160;<br/>of data&#160;is&#160;written&#160;to a&#160;file,&#160;the&#160;specific&#160;context&#160;is&#160;used to&#160;determine&#160;what&#160;to&#160;write.&#160;See<a href="libremacros.html#186">&#160;Table&#160;68.</a><br/>
<i><b>Table&#160;68.</b>&#160;Summary&#160;of&#160;what&#160;the&#160;Put&#160;statement&#160;writes.</i><br/>
<i><b>Type</b></i><br/>
<i><b>Bytes</b></i><br/>
<i><b>Comment</b></i><br/>
Boolean<br/>
1<br/>
OOo Basic&#160;stores&#160;a&#160;Boolean in an integer.&#160;The&#160;True&#160;value&#160;has all&#160;of&#160;the&#160;bits set, which&#160;<br/>incorrectly&#160;cast&#160;down&#160;to one&#160;byte,&#160;causing&#160;a&#160;run-time&#160;error.&#160;False&#160;writes with&#160;no problem.<br/>
Byte<br/>
3<br/>
Although the&#160;byte&#160;variable&#160;uses&#160;only&#160;one&#160;byte&#160;when&#160;writing&#160;the&#160;data,&#160;byte&#160;variables are&#160;<br/>supported&#160;only&#160;when stored&#160;in a&#160;Variant, so the&#160;data&#160;is preceded&#160;by&#160;two bytes of&#160;type&#160;<br/>
information.<br/>
Currency<br/>
8<br/>
Internally&#160;stored&#160;as a&#160;Double.<br/>
Date<br/>
8<br/>
Internally&#160;stored&#160;as a&#160;Double.<br/>
Double<br/>
8<br/>
Integer<br/>
2<br/>
Long<br/>
4<br/>
Object<br/>
Error<br/>
Run-time&#160;error:&#160;Only&#160;the&#160;basic&#160;types are&#160;supported.<br/>
Single<br/>
4<br/>
String<br/>
Len(s)<br/>
Each character&#160;is&#160;one&#160;byte.&#160;Characters with an&#160;ASCII&#160;value&#160;larger&#160;than 255&#160;are&#160;written with&#160;<br/>incomplete&#160;data.&#160;In&#160;Binary&#160;mode,&#160;the&#160;Put&#160;statement&#160;will&#160;not&#160;write&#160;characters with an&#160;ASCII&#160;<br/>
value&#160;of&#160;zero.&#160;This is&#160;written fine&#160;in Random&#160;mode&#160;and&#160;the&#160;string&#160;is preceded&#160;by&#160;the&#160;string&#160;<br/>length.<br/>
Variant<br/>
Varies<br/>
Two bytes of&#160;type&#160;information are&#160;written,&#160;followed&#160;by&#160;the&#160;data.&#160;A&#160;string&#160;also includes the&#160;<br/>length of&#160;the&#160;string&#160;in&#160;two bytes.<br/>
Empty<br/>
4<br/>
An&#160;empty&#160;Variant&#160;variable&#160;writes two bytes of&#160;type&#160;information indicating&#160;an integer&#160;value,&#160;<br/>and&#160;then&#160;it&#160;writes two bytes with&#160;zeros.<br/>
Null<br/>
Error<br/>
Only&#160;an&#160;object&#160;can contain the&#160;value&#160;Null, and the&#160;Put&#160;statement&#160;does not&#160;work with objects.<br/>
<b>TIP</b><br/>
OOo Basic&#160;only&#160;supports&#160;using&#160;Get&#160;and&#160;Put&#160;with&#160;the&#160;standard data&#160;types.<br/>
183<br/>
<hr/>
<a name=187></a><b>TIP</b><br/>
Numbers&#160;written to&#160;binary&#160;files&#160;are&#160;written in reverse&#160;byte&#160;order.<br/>
<b>TIP</b><br/>
The&#160;Put&#160;statement&#160;cannot&#160;write&#160;a&#160;Boolean&#160;with a&#160;True&#160;value, and&#160;it&#160;doesn’t&#160;properly&#160;write&#160;strings with&#160;<br/>
Unicode&#160;values greater&#160;than 255;&#160;writing&#160;then trying&#160;to&#160;read&#160;the&#160;value&#160;causes OOo&#160;to crash.<br/>
<b>TIP</b><br/>
The&#160;Get&#160;statement&#160;fails for&#160;binary&#160;files if&#160;the&#160;position is&#160;not&#160;provided.<br/>
Use&#160;Get&#160;to read Binary&#160;data&#160;and Random&#160;files.&#160;The&#160;syntax&#160;for the&#160;Get&#160;statement&#160;is&#160;similar&#160;to the&#160;Put&#160;<br/>statement.<br/>
Get&#160;#n,,variable&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Read from next record or byte position<br/>Get&#160;#n,&#160;position,&#160;variable&#160; &#160; &#160;'Specify the next record or byte position<br/>
If&#160;the&#160;argument&#160;to the&#160;Get&#160;statement&#160;is&#160;a&#160;Variant, the&#160;type&#160;information&#160;is&#160;always&#160;read, regardless&#160;of the&#160;<br/>context.&#160;When a&#160;string&#160;is&#160;read, it&#160;is&#160;assumed to&#160;be&#160;preceded by&#160;an integer that&#160;contains&#160;the&#160;length&#160;of the&#160;<br/>string.&#160;This&#160;required string length is&#160;not&#160;written&#160;automatically&#160;to binary&#160;files&#160;but&#160;it&#160;is&#160;to&#160;random&#160;files<a href="libremacros.html#187">.&#160;Listing&#160;<br/>163&#160;s</a>hows&#160;an example&#160;of reading and writing a&#160;binary&#160;file.&#160;Also see<a href="libremacros.html#188">&#160;Figure&#160;61.</a><br/>
<i><b>Listing&#160;163.</b>&#160;Create&#160;and then&#160;read a binary&#160;file.<br/></i>Sub&#160;ExampleReadWriteBinaryFile<br/>&#160;&#160;Dim&#160;sFileName&#160;As&#160;String&#160;'File name from which to read and write<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Integer&#160; &#160; &#160; &#160;&#160;'File number to use<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160;&#160;'Scrap Integer variable<br/>&#160;&#160;Dim&#160;l&#160;As&#160;Long&#160; &#160; &#160; &#160; &#160; &#160;'Scrap Long variable<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160;'Scrap String variable<br/>&#160;&#160;Dim&#160;s2&#160;As&#160;String&#160; &#160; &#160; &#160;&#160;'Another scrap String variable<br/>&#160;&#160;Dim&#160;v&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Scrap Variant variable<br/>&#160;&#160;sFileName&#160;=&#160;ConvertToURL(CurDir)&#160;&amp;&#160;&#34;/delme.txt&#34;<br/>&#160;&#160;If&#160;FileExists&#160;(sFileName)&#160;Then<br/>&#160; &#160;&#160;Kill(sFileName)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;n&#160;=&#160;FreeFile()<br/>&#160;&#160;Open&#160;sFileName&#160;For&#160;Binary&#160;As&#160;#n<br/>&#160;&#160;i&#160;=&#160;10&#160;&#160;:&#160;Put&#160;#n,,i&#160; &#160; &#160;&#160;'0A 00<br/>&#160;&#160;i&#160;=&#160;255&#160;:&#160;Put&#160;#n,,i&#160; &#160; &#160;&#160;'FF 00<br/>&#160;&#160;i&#160;=&#160;-2&#160;&#160;:&#160;Put&#160;#n,,i&#160; &#160; &#160;&#160;'FE FF<br/>&#160;&#160;l&#160;=&#160;10&#160;&#160;:&#160;Put&#160;#n,,l&#160; &#160; &#160;&#160;'0A 00 00 00<br/>&#160;&#160;l&#160;=&#160;255&#160;:&#160;Put&#160;#n,,l&#160; &#160; &#160;&#160;'FF 00 00 00<br/>&#160;&#160;l&#160;=&#160;-2&#160;&#160;:&#160;Put&#160;#n,,l&#160; &#160; &#160;&#160;'FE FF FF FF<br/>&#160;&#160;<br/>&#160;&#160;REM Put string data, precede it with a length<br/>&#160;&#160;i&#160;=&#160;8&#160; &#160;:&#160;Put&#160;#n,,i&#160; &#160; &#160;&#160;'08 00 (about to put eight characters to the file)<br/>&#160;&#160;s&#160;=&#160;&#34;ABCD&#34;<br/>&#160;&#160;Put&#160;#n,,s&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'41 42 43 44 (ASCII for ABCD)<br/>&#160;&#160;Put&#160;#n,,s&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'41 42 43 44 (ASCII for ABCD)<br/>&#160;&#160;<br/>&#160;&#160;REM Put data contained in a Variant&#160;<br/>&#160;&#160;Put&#160;#n,,CInt(10)&#160; &#160; &#160; &#160; &#160;'02 00 0A 00<br/>&#160;&#160;i&#160;=&#160;-2&#160;:&#160;Put&#160;#n,,CInt(i)&#160;'02 00 FE FF &#160; &#160; &#160; (Functions return a Variant)<br/>&#160;&#160;Put&#160;#n,,CLng(255)&#160; &#160; &#160; &#160;&#160;'03 00 FF 00 00 00 (Functions return a Variant)<br/>&#160;&#160;v&#160;=&#160;255&#160;&#160;:&#160;Put&#160;#n,,v&#160; &#160; &#160;'02 00 FF 00 &#160; &#160; &#160; (This IS a Variant)<br/>
184<br/>
<hr/>
<a name=188></a>&#160;&#160;v&#160;=&#160;&#34;ABCD&#34;&#160;:&#160;Put&#160;#n,,v&#160; &#160;'41 42 43 44 &#160; &#160; &#160; (Not in an array)<br/>&#160;&#160;v&#160;=&#160;Array(255,&#160;&#34;ABCDE&#34;)&#160;&#160;'The string contains type information and length<br/>&#160;&#160;Put&#160;#n,,v()&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'02 00 FF 00 08 00 05 00 41 42 43 44 45<br/>&#160;&#160;close&#160;#n<br/>&#160;&#160;<br/>&#160;&#160;REM now, read the file.<br/>&#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160;&#160;n&#160;=&#160;FreeFile()<br/>&#160;&#160;Open&#160;sFileName&#160;For&#160;Binary&#160;Access&#160;Read&#160;As&#160;#n<br/>&#160;&#160;Get&#160;#n,&#160;&#160;1,&#160;i&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Integer &#34;&#160;&amp;&#160;i&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;&#160;3,&#160;i&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Integer &#34;&#160;&amp;&#160;i&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;&#160;5,&#160;i&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Integer &#34;&#160;&amp;&#160;i&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;&#160;7,&#160;l&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Long &#34;&#160;&amp;&#160;l&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;11,&#160;l&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Long &#34;&#160;&amp;&#160;l&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;15,&#160;l&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Long &#34;&#160;&amp;&#160;l&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;19,&#160;s2&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read String &#34;&#160;&amp;&#160;s2&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;close&#160;#n<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Read Write Binary File&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;61.</b>&#160; Use&#160;Get&#160;and Put&#160;to read and write&#160;binary&#160;files.</i><br/>
Random&#160;files&#160;are&#160;usually&#160;used to&#160;store&#160;a&#160;user-defined data&#160;type, but&#160;this&#160;is&#160;not&#160;supported&#160;in OOo Basic;&#160;use&#160;<br/>“Open FileName&#160;For Random”&#160;to open a&#160;file&#160;for random&#160;access.&#160;The&#160;code&#160;i<a href="libremacros.html#188">n&#160;Listing&#160;164&#160;w</a>rites&#160;numerous&#160;<br/>types&#160;and sizes&#160;of data&#160;to&#160;the&#160;file&#160;with a&#160;block length of 8. If&#160;the&#160;Put&#160;statement&#160;had no bugs, then after&#160;<br/>writing&#160;the&#160;first&#160;block, the&#160;file&#160;pointer would&#160;be&#160;positioned to&#160;the&#160;second block for writing. It&#160;is&#160;instead&#160;<br/>positioned to&#160;the&#160;end of the&#160;file.&#160;To&#160;avoid this&#160;bug, explicitly&#160;include&#160;the&#160;position&#160;to&#160;write&#160;in the&#160;statement. If<br/>the&#160;position&#160;points&#160;to a&#160;position&#160;beyond the&#160;end of the&#160;file,&#160;the&#160;file&#160;pointer is&#160;moved to&#160;the&#160;end of the&#160;file.&#160;<br/>This&#160;is&#160;the&#160;primary&#160;reason why&#160;the&#160;code&#160;i<a href="libremacros.html#188">n&#160;Listing&#160;164&#160;i</a>nitializes&#160;the&#160;file&#160;to&#160;all&#160;zeros&#160;before&#160;starting;&#160;the&#160;file&#160;<br/>is&#160;initialized with&#160;locations&#160;for the&#160;subsequent&#160;operations.&#160;Notice&#160;that&#160;the&#160;string includes&#160;the&#160;string length&#160;<br/>before&#160;the&#160;text&#160;when it&#160;is&#160;Put&#160;to the&#160;file.&#160;The&#160;output&#160;is&#160;essentially&#160;the&#160;same&#160;as<a href="libremacros.html#187">&#160;Listing&#160;163&#160;s</a>hown i<a href="libremacros.html#188">n&#160;Figure&#160;<br/>61.</a><br/>
<i><b>Listing&#160;164.</b>&#160;Write&#160;and then read a random&#160;access&#160;file.<br/></i>Sub&#160;ExampleReadWriteRandomFile<br/>&#160;&#160;Dim&#160;sFileName&#160;As&#160;String&#160;'File name from which to read and write<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Integer&#160; &#160; &#160; &#160;&#160;'File number to use<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160;&#160;'Scrap Integer variable<br/>&#160;&#160;Dim&#160;l&#160;As&#160;Long&#160; &#160; &#160; &#160; &#160; &#160;'Scrap Long variable<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160;'Scrap String variable<br/>&#160;&#160;Dim&#160;s2&#160;As&#160;String&#160; &#160; &#160; &#160;&#160;'Another scrap String variable<br/>&#160;&#160;sFileName&#160;=&#160;ConvertToURL(CurDir)&#160;&amp;&#160;&#34;/delme.txt&#34;<br/>
185<br/>
<hr/>
<a name=189></a>&#160;&#160;<br/>&#160;&#160;REM Now the file is initialized so it can be used!<br/>&#160;&#160;REM Must use Access Read so that the file is not created new<br/>&#160;&#160;REM I cannot write this as a binary file because then ASCII<br/>&#160;&#160;REM zeros are not written.<br/>&#160;&#160;n&#160;=&#160;FreeFile()<br/>&#160;&#160;Open&#160;sFileName&#160;For&#160;Random&#160;As&#160;#n&#160;Len&#160;=&#160;8<br/>&#160;&#160;REM First, create a file with all zeros with enough room<br/>&#160;&#160;REM for 20 8-byte records.<br/>&#160;&#160;s&#160;=&#160;String(8&#160;*&#160;20-2,&#160;0)&#160;&#160;'String has 158 characters with ASCII value 0<br/>&#160;&#160;Put&#160;#n,1,s&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Written as Random so Len(s) is written first<br/>&#160;&#160;i&#160;=&#160;0&#160;:&#160;Put&#160;#n,1,i&#160; &#160; &#160; &#160;'Write over the length with zeros.<br/>&#160;&#160;<br/>&#160;&#160;REM Now write the data<br/>&#160;&#160;i&#160;=&#160;10&#160;&#160;:&#160;Put&#160;#n,1,i&#160; &#160; &#160;&#160;'0A 00<br/>&#160;&#160;i&#160;=&#160;255&#160;:&#160;Put&#160;#n,2,i&#160; &#160; &#160;&#160;'FF 00<br/>&#160;&#160;i&#160;=&#160;-2&#160;&#160;:&#160;Put&#160;#n,3,i&#160; &#160; &#160;&#160;'FE FF<br/>&#160;&#160;l&#160;=&#160;10&#160;&#160;:&#160;Put&#160;#n,4,l&#160; &#160; &#160;&#160;'0A 00 00 00<br/>&#160;&#160;l&#160;=&#160;255&#160;:&#160;Put&#160;#n,5,l&#160; &#160; &#160;&#160;'FF 00 00 00<br/>&#160;&#160;l&#160;=&#160;-2&#160;&#160;:&#160;Put&#160;#n,6,l&#160; &#160; &#160;&#160;'FE FF FF FF<br/>&#160;&#160;<br/>&#160;&#160;REM Put string data, precede it with a length (integer value) automatically<br/>&#160;&#160;s&#160;=&#160;&#34;ABCD&#34;&#160;:&#160;Put&#160;#n,7,s&#160;&#160;'04 00 41 42 43 44 (Length, then ASCII for ABCD)<br/>&#160;&#160;close&#160;#n<br/>&#160;&#160;<br/>&#160;&#160;REM Now read the file.<br/>&#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160;&#160;n&#160;=&#160;FreeFile()<br/>&#160;&#160;Open&#160;sFileName&#160;For&#160;Random&#160;Access&#160;Read&#160;As&#160;#n&#160;Len=8<br/>&#160;&#160;Get&#160;#n,&#160;1,&#160;i&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Integer &#34;&#160;&amp;&#160;i&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;2,&#160;i&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Integer &#34;&#160;&amp;&#160;i&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;3,&#160;i&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Integer &#34;&#160;&amp;&#160;i&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;4,&#160;l&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Long &#34;&#160;&amp;&#160;l&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;5,&#160;l&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Long &#34;&#160;&amp;&#160;l&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;6,&#160;l&#160;&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read Long &#34;&#160;&amp;&#160;l&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Get&#160;#n,&#160;7,&#160;s2&#160;:&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Read String &#34;&#160;&amp;&#160;s2&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;close&#160;#n<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Read Write Random File&#34;<br/>End&#160;Sub<br/>
<i><b>&#160;8.9.&#160;File&#160;and&#160;directory&#160;related&#160;services<br/></b></i>Some&#160;of the&#160;OO&#160;methods&#160;for file&#160;manipulation are&#160;buggy&#160;and unreliable.&#160;You may&#160;want&#160;to&#160;consider some&#160;of&#160;<br/>the&#160;built-in OO&#160;services;&#160;services&#160;are&#160;discussed later.<br/>
<b>&#160;8.9.1.&#160;Path&#160;Settings<br/></b>Most&#160;of the&#160;macros&#160;in this&#160;chapter use&#160;the&#160;CurDir function&#160;to&#160;choose&#160;a&#160;place&#160;to store&#160;files.&#160;The&#160;PathSettings&#160;<br/>service&#160;provides&#160;read/write&#160;access&#160;(and the&#160;ability&#160;to&#160;register a&#160;listener) for the&#160;paths&#160;properties&#160;used by&#160;<br/>OOo.&#160;Although the&#160;documentation&#160;is&#160;not&#160;clear on this,&#160;my&#160;examples&#160;indicate&#160;that&#160;the&#160;path is&#160;returned as&#160;a&#160;<br/>URL.&#160;On the&#160;other hand, the&#160;PathSettings&#160;service&#160;uses&#160;the&#160;PathSubstitution service,&#160;which specifically&#160;states<br/>that&#160;it&#160;returns&#160;URLS. OOMEWorkDir&#160;i<a href="libremacros.html#190">n&#160;Listing&#160;165&#160;de</a>monstrates&#160;obtaining the&#160;Work directory.<br/>
186<br/>
<hr/>
<a name=190></a><i><b>Listing&#160;165.</b>&#160;Determine&#160;the&#160;work&#160;directory&#160;to use.<br/></i>Function&#160;OOMEWorkDir()&#160;As&#160;String<br/>&#160;&#160;Dim&#160;s$<br/>&#160; Dim &#160;oPathSettings<br/>&#160;&#160;oPathSettings&#160;= CreateUnoService(&#34;com.sun.star.util.PathSettings&#34;)<br/>&#160;&#160;s$ =&#160;oPathSettings.Work<br/>&#160; If&#160;s&#160;=&#160;&#34;&#34;&#160;Then<br/>&#160; &#160;&#160;s&#160;= GetPathSeparator()<br/>&#160; ElseIf Right(s,1) &lt;&gt;&#160;&#34;/&#34;&#160;AND Right(s,1) &lt;&gt;&#160;&#34;\\&#34;&#160;Then<br/>&#160; &#160; If Left(s,&#160;5) =&#160;&#34;file:&#34;&#160;Then<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;/&#34;<br/>&#160; &#160; Else<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp; GetPathSeparator()<br/>&#160; &#160; End If<br/>&#160; End If<br/>&#160; OOMEWorkDir()&#160;=&#160;s&#160;&amp;&#160;&#34;OOMEWork&#34;&#160;&amp;&#160;GetPathSeparator()<br/>End&#160;Function<br/>
A&#160;macro that&#160;creates&#160;temporary&#160;files&#160;or directories&#160;for example&#160;purposes&#160;will&#160;use<a href="libremacros.html#190">&#160;Listing&#160;166&#160;t</a>o&#160;create&#160;and&#160;<br/>remove&#160;the&#160;working&#160;directory.<br/>
<i><b>Listing&#160;166.</b>&#160;Create&#160;and remove&#160;the&#160;OOME&#160;work&#160;directory.</i><br/>
Function&#160;CreateOOMEWorkDir()&#160;As&#160;Boolean<br/>&#160;&#160;CreateOOMEWorkDir()&#160;=&#160;False<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;s&#160;=&#160;OOMEWorkDir()<br/>&#160;&#160;If&#160;NOT&#160;FileExists(s)&#160;Then<br/>&#160; &#160;&#160;MkDir&#160;s<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;CreateOOMEWorkDir()&#160;=&#160;FileExists(s)<br/>End&#160;Function<br/>
Function&#160;RmOOMEWorkDir()&#160;As&#160;Boolean<br/>&#160;&#160;RmOOMEWorkDir()&#160;=&#160;False<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;s&#160;=&#160;OOMEWorkDir()<br/>&#160;&#160;If&#160;FileExists(s)&#160;Then<br/>&#160; &#160;&#160;RmDir&#160;s<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;RmOOMEWorkDir()&#160;=&#160;NOT&#160;FileExists(s)<br/>End&#160;Function&#160;<br/>
The&#160;documentation&#160;lists&#160;properties&#160;that&#160;are&#160;supported.&#160;By&#160;inspecting&#160;the&#160;object,&#160;I&#160;found more&#160;properties&#160;than<br/>those&#160;that&#160;are&#160;documented.&#160;<br/>
<i><b>Table&#160;69.</b>&#160;Documented PathSettings&#160;properties.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Number</b></i><br/>
<i><b>Which&#160;Directory</b></i><br/>
Addin&#160;<br/>
Single<br/>
Contains spreadsheet&#160;add-ins that&#160;use&#160;the&#160;old add-in&#160;API.<br/>
AutoCorrect&#160;<br/>
Multiple<br/>
Contains the&#160;settings for&#160;the&#160;AutoCorrect&#160;dialog.<br/>
AutoText&#160;<br/>
Multiple<br/>
Contains the&#160;AutoText&#160;modules.<br/>
Backup&#160;<br/>
Single<br/>
Where&#160;automatic&#160;document&#160;backups are&#160;stored.<br/>
Basic&#160;<br/>
Multiple<br/>
Contains Basic&#160;files used&#160;by&#160;the&#160;AutoPilots.<br/>
187<br/>
<hr/>
<a name=191></a><i><b>Property</b></i><br/>
<i><b>Number</b></i><br/>
<i><b>Which&#160;Directory</b></i><br/>
Bitmap&#160;<br/>
Single<br/>
Contains the&#160;external&#160;icons for&#160;the&#160;toolbars.<br/>
Config&#160;<br/>
Single<br/>
Contains configuration&#160;files.&#160;This property&#160;is&#160;not&#160;visible&#160;in&#160;the&#160;path&#160;options dialog&#160;<br/>and cannot&#160;be&#160;modified.<br/>
Dictionary&#160;<br/>
Single<br/>
Contains the&#160;OpenOffice.org&#160;dictionaries.<br/>
Favorite&#160;<br/>
Single<br/>
Contains the&#160;saved&#160;folder&#160;bookmarks.<br/>
Filter&#160;<br/>
Single<br/>
Where&#160;the&#160;filters are&#160;stored.<br/>
Gallery&#160;<br/>
Multiple<br/>
Contains the&#160;Gallery&#160;database&#160;and multimedia&#160;files.<br/>
Graphic&#160;<br/>
Single<br/>
Displayed&#160;when&#160;the&#160;dialog&#160;for&#160;opening&#160;a&#160;graphic&#160;or&#160;saving&#160;a&#160;new&#160;graphic&#160;is used.<br/>
Help&#160;<br/>
Single<br/>
Contains the&#160;OOo help&#160;files.<br/>
Linguistic&#160;<br/>
Single<br/>
Contains the&#160;OOo spellcheck files.<br/>
Module&#160;<br/>
Single<br/>
Contains the&#160;OOo modules.<br/>
Palette&#160;<br/>
Single<br/>
Contains the&#160;palette&#160;files that&#160;contain user-defined colors and&#160;patterns (*.SOB&#160;and&#160;<br/>*.SOF).<br/>
Plugin&#160;<br/>
Multiple<br/>
Contains the&#160;Plugins.<br/>
Storage&#160;<br/>
Single<br/>
Where&#160;information about&#160;mail, news, and&#160;FTP&#160;servers&#160;is stored.<br/>
Temp&#160;<br/>
Single<br/>
Contains the&#160;OOo temp-files.<br/>
Template&#160;<br/>
Multiple<br/>
Contains the&#160;OOo document&#160;templates.<br/>
UIConfig&#160;<br/>
Multiple<br/>
Global&#160;directories for&#160;user&#160;interface&#160;configuration files.&#160;The&#160;user&#160;interface&#160;<br/>configuration&#160;is merged with&#160;the&#160;user&#160;settings stored in&#160;the&#160;directory&#160;specified&#160;by&#160;<br/>
UserConfig.<br/>
UserConfig&#160;<br/>
Single<br/>
Contains the&#160;user&#160;settings, including&#160;the&#160;user&#160;interface&#160;configuration&#160;files for&#160;menus,&#160;<br/>
toolbars, accelerators and status bars.<br/>
UserDictionary&#160;<br/>
Single<br/>
Contains the&#160;custom&#160;dictionaries.<br/>
Work&#160;<br/>
Single<br/>
The&#160;work&#160;folder.&#160;This path&#160;can be&#160;modified&#160;according&#160;to the&#160;user's needs and can&#160;be&#160;<br/>seen in the&#160;Open or&#160;Save&#160;dialog.&#160;<br/>
To&#160;see&#160;the&#160;path&#160;settings&#160;on your computer,&#160;run the&#160;macro in<a href="libremacros.html#191">&#160;Listing 167. O</a>n my&#160;computer,&#160;I&#160;find numerous&#160;<br/>extra&#160;paths&#160;such as&#160;Work_internal,&#160;Work_user,&#160;Work_writable.&#160;DisplayPathSettings&#160;demonstrates&#160;numerous&#160;<br/>advanced techniques&#160;that&#160;are&#160;not&#160;explained in&#160;this&#160;chapter.&#160;<br/>
•<br/>
Creating&#160;and using&#160;an OOo service.<br/>
•<br/>
Creating&#160;a&#160;new&#160;document.<br/>
•<br/>
Inserting text&#160;into&#160;a&#160;document.<br/>
•<br/>
Setting&#160;paragraph style.<br/>
•<br/>
Inserting paragraph breaks&#160;into&#160;a&#160;text&#160;object.<br/>
The&#160;following&#160;macro was&#160;originally&#160;written&#160;by&#160;Danny&#160;Brewer,&#160;who did much&#160;to advance&#160;the&#160;knowledge&#160;of&#160;<br/>OOo macros&#160;before&#160;he&#160;went&#160;on to other things. I&#160;modified the&#160;macro so that&#160;it&#160;declares&#160;all&#160;variables&#160;and&#160;<br/>handles&#160;property&#160;types&#160;returned as&#160;array&#160;values.&#160;<br/>
<i><b>Listing&#160;167.</b>&#160;Display&#160;the&#160;PathSettings&#160;in a new text&#160;document.<br/></i>Sub&#160;DisplayPathSettings<br/>&#160;&#160;&#160;Dim&#160;oPathSettings&#160; &#160; ' PathSettings service.<br/>
188<br/>
<hr/>
<a name=192></a>&#160;&#160;Dim&#160;oPropertySetInfo&#160;' Access the service properties.<br/>&#160;&#160;Dim&#160;aProperties&#160; &#160; &#160; ' Contains all of the service properties.<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160; &#160; &#160;' Reference a newly created document.<br/>&#160;&#160;Dim&#160;oText&#160; &#160; &#160; &#160; &#160; &#160; ' Document's text object.<br/>&#160;&#160;Dim&#160;oCursor&#160; &#160; &#160; &#160; &#160; ' Cursor in the text object.<br/>&#160;&#160;Dim&#160;oProperty&#160; &#160; &#160; &#160; ' A property of the service.<br/>&#160;&#160;Dim&#160;cPropertyName$&#160; &#160;' Property name.<br/>&#160;&#160;Dim&#160;cPropertyValue&#160; &#160;' Property value may be an array or multiple strings.<br/>&#160;&#160;Dim&#160;aPaths&#160; &#160; &#160; &#160; &#160; &#160;' The paths as an array.<br/>&#160;&#160;Dim&#160;cPath$&#160; &#160; &#160; &#160; &#160; &#160;' A single path from the array.<br/>&#160;&#160;Dim&#160;j&#160;As&#160;Integer&#160; &#160; &#160;' Index variable.<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160;' Index variable.<br/>&#160;&#160;<br/>&#160;&#160;oPathSettings&#160;=&#160;CreateUnoService(&#160;&#34;com.sun.star.util.PathSettings&#34;&#160;)<br/>
&#160;&#160;' Example of how to get a single property you are after.<br/>&#160;&#160;'oPathSettings.Work<br/>
&#160;&#160;' Get information about the properties of the path settings.<br/>&#160;&#160;oPropertySetInfo&#160;=&#160;oPathSettings.getPropertySetInfo()<br/>&#160; &#160; &#160;&#160;<br/>&#160;&#160;' Get an array of the properties.<br/>&#160;&#160;aProperties&#160;=&#160;oPropertySetInfo.getProperties()<br/>&#160; &#160;<br/>&#160;&#160;' Create an output document.<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#160;&#34;private:factory/swriter&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;_blank&#34;,&#160;0,&#160;Array()&#160;)<br/>&#160;&#160;oText&#160;=&#160;oDoc.getText()<br/>&#160;&#160;oCursor&#160;=&#160;oText.createTextCursor()<br/>&#160; &#160;<br/>&#160;&#160;oText.insertString(&#160;oCursor,&#160;&#34;Path Settings&#34;,&#160;False&#160;)<br/>&#160;&#160;oCursor.ParaStyleName&#160;=&#160;&#34;Heading 1&#34;<br/>&#160;&#160;oText.insertControlCharacter(&#160;oCursor,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK,&#160;False&#160;)<br/>
&#160;&#160;' Iterate over the array of properties,<br/>&#160;&#160;' &#160;and write information about each property to the output.<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(&#160;aProperties&#160;)&#160;To&#160;UBound(&#160;aProperties&#160;)<br/>&#160; &#160;&#160;oProperty&#160;=&#160;aProperties(&#160;i&#160;)<br/>&#160; &#160;&#160;cPropertyName&#160;=&#160;oProperty.Name<br/>&#160; &#160;&#160;cPropertyValue&#160;=&#160;oPathSettings.getPropertyValue(&#160;cPropertyName&#160;)<br/>&#160; &#160; &#160;&#160;<br/>&#160; &#160;&#160;oText.insertString(&#160;oCursor,&#160;cPropertyName,&#160;False&#160;)<br/>&#160; &#160;&#160;oCursor.ParaStyleName&#160;=&#160;&#34;Heading 3&#34;<br/>&#160; &#160;&#160;oText.insertControlCharacter(&#160;oCursor,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK,&#160;False&#160;)<br/>&#160; &#160;&#160;If&#160;IsArray(cPropertyValue)&#160;Then<br/>&#160; &#160; &#160;&#160;' Multiple URLs are somtimes returned as an array.<br/>&#160; &#160; &#160;&#160;aPaths&#160;=&#160;cPropertyValue<br/>&#160; &#160;&#160;ElseIf&#160;Len(&#160;cPropertyValue&#160;)&#160;&gt;&#160;0&#160;Then<br/>&#160; &#160; &#160;&#160;' Multiple URLs are somtimes separated by a semicolon.<br/>&#160; &#160; &#160;&#160;' Split them up into an array of strings.<br/>&#160; &#160; &#160;&#160;aPaths&#160;=&#160;Split(&#160;cPropertyValue,&#160;&#34;;&#34;&#160;)<br/>
189<br/>
<hr/>
<a name=193></a>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;aPaths&#160;=&#160;Array()<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;For&#160;j&#160;=&#160;LBound(&#160;aPaths&#160;)&#160;To&#160;UBound(&#160;aPaths&#160;)<br/>&#160; &#160; &#160;&#160;cPath&#160;=&#160;aPaths(&#160;j&#160;)<br/>&#160; &#160; &#160;&#160;oText.insertString(&#160;oCursor,&#160;cPath,&#160;False&#160;)<br/>&#160; &#160; &#160;&#160;oText.insertControlCharacter(&#160;oCursor,&#160;_<br/>&#160; &#160; &#160; &#160; &#160;com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK,&#160;False&#160;)<br/>&#160; &#160;&#160;Next<br/>&#160; &#160; &#160;&#160;<br/>&#160; &#160;&#160;oText.insertControlCharacter(&#160;oCursor,&#160;_<br/>&#160; &#160; &#160; &#160;&#160;com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK,&#160;False&#160;)<br/>&#160; &#160;Next&#160;i<br/>End&#160;Sub&#160;&#160;<br/>
Setting&#160;a&#160;path&#160;value&#160;is&#160;trivially&#160;done&#160;using either direct&#160;assignment,&#160;or by&#160;using the&#160;property&#160;set&#160;information&#160;<br/>object.&#160;OOo requires&#160;these&#160;values&#160;to be&#160;correct, so, if you write&#160;bad values, it&#160;will&#160;negatively&#160;affect&#160;OOo.<br/>
oPathSettings.Work&#160;=&#160;ConvertToUrl(&#34;C:\MyWorkDir&#34;)<br/>oPathSettings.setPropertyValue(&#34;Work&#34;,&#160;&#34;C:\MyWorkDir&#34;)&#160;<br/>
The&#160;properties&#160;supported by&#160;the&#160;PathSetting&#160;service&#160;are&#160;stored, at&#160;least&#160;on my&#160;computer,&#160;in&#160;the&#160;file:&#160;<br/>openoffice.org/basis3.2/share/registry/schema/org/openoffice/Office/Common.xcs.&#160;The&#160;documentation still&#160;<br/>references&#160;the&#160;old filename&#160;Common.xml, which caused me&#160;some&#160;level&#160;of consternation.&#160;<br/>
<b>&#160;8.9.2.&#160;Path&#160;Substitution<br/></b>My&#160;file&#160;Common.xcs&#160;contains&#160;entries&#160;such as&#160;$(userpath)/store&#160;and $(work), which are&#160;very&#160;different&#160;from&#160;<br/>what&#160;is&#160;returned by&#160;the&#160;PathSettings&#160;service.&#160;This&#160;is&#160;because&#160;the&#160;path&#160;setting service&#160;changes&#160;shortcuts&#160;such&#160;<br/>as&#160;$(userpath) to&#160;the&#160;real&#160;value&#160;before&#160;returning a&#160;string.&#160;Analogously,&#160;it&#160;substitutes&#160;the&#160;shortcuts&#160;back into&#160;<br/>the&#160;string before&#160;storing the&#160;value.&#160;You can call&#160;the&#160;PathSubstitution service&#160;directly&#160;to&#160;make&#160;your own&#160;<br/>substitutions.<br/>
<i><b>Table&#160;70.</b>&#160;Path substitution&#160;variables.</i><br/>
<i><b>Name</b></i><br/>
<i><b>Description</b></i><br/>
$(inst)<br/>
Installation&#160;path of&#160;the&#160;OOo Basis&#160;layer.&#160;<br/>
$(prog)<br/>
Program&#160;path of&#160;the&#160;OOo&#160;Basis layer.&#160;<br/>
$(brandbaseurl)<br/>
Installation&#160;path of&#160;the&#160;the&#160;OOo&#160;Brand&#160;layer.&#160;<br/>
$(user)<br/>
The&#160;user&#160;installation&#160;directory.&#160;<br/>
$(work)<br/>
The&#160;work directory&#160;of&#160;the&#160;user;&#34;MyDocuments&#34;&#160;for&#160;Windows, the&#160;user's home-directory&#160;for&#160;<br/>
Linux.<br/>
$(home)<br/>
The&#160;user's home&#160;directory;&#160;Documents and Settings&#160;for&#160;Windows, the&#160;user's home-directory&#160;for&#160;<br/>
Linux.<br/>
$(temp)<br/>
The&#160;current&#160;temporary&#160;directory.&#160;<br/>
$(path)<br/>
The&#160;value&#160;of&#160;PATH&#160;environment&#160;variable.&#160;<br/>
$(lang)<br/>
The&#160;country&#160;code&#160;used&#160;by&#160;OOo;&#160;01=english.<br/>
$(langid)<br/>
The&#160;language&#160;code&#160;used by&#160;OOo;&#160;1033=english us.&#160;<br/>
$(vlang)<br/>
The&#160;language&#160;used by&#160;OOo&#160;as&#160;a&#160;string. Like&#160;&#34;en-US&#34;&#160;for&#160;a&#160;US&#160;English OOo.<br/>
190<br/>
<hr/>
<a name=194></a>Use&#160;getSubstituteVariableValue&#160;to convert&#160;one&#160;name&#160;at&#160;a&#160;time.&#160;If&#160;the&#160;name&#160;is&#160;not&#160;known, a&#160;run-time&#160;error&#160;<br/>occurs.<br/>
<i><b>Listing&#160;168.</b>&#160;Substitute&#160;one&#160;variable&#160;with&#160;PathSubstitution.<br/></i>Sub&#160;UsePathSubstitution()<br/>&#160;&#160;Dim&#160;oPathSub&#160; &#160; &#160;&#160;' PathSubstitution service.<br/>&#160;&#160;Dim&#160;names&#160; &#160; &#160; &#160; &#160;' List of names to substitute.<br/>&#160;&#160;Dim&#160;subName$&#160; &#160; &#160;&#160;' Single name to check.<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;&#160;' Index variable.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160;&#160;' Accumulate the value to print.<br/>&#160;&#160;<br/>&#160;&#160;names&#160;=&#160;Array(&#34;inst&#34;,&#160; &#160;&#34;prog&#34;,&#160; &#160;&#34;brandbaseurl&#34;,&#160;&#34;user&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;work&#34;,&#160; &#160;&#34;home&#34;,&#160; &#160;&#34;temp&#34;,&#160; &#160; &#160; &#160; &#160;&#34;path&#34;,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;lang&#34;,&#160; &#160;&#34;langid&#34;,&#160;&#34;vlang&#34;)<br/>&#160;&#160;<br/>&#160;&#160;oPathSub&#160;=&#160;CreateUnoService(&#160;&#34;com.sun.star.util.PathSubstitution&#34;&#160;)<br/>&#160;&#160;<br/>&#160;&#160;' Use getSubstituteVariableValue with a single variable.&#160;<br/>&#160;&#160;' Runtime error if the name is not know.<br/>&#160;&#160;<br/>&#160;&#160;'Print oPathSub.getSubstituteVariableValue(&#34;$(inst)&#34;)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(names)&#160;To&#160;UBound(names)<br/>&#160; &#160;&#160;subName&#160;=&#160;&#34;$(&#34;&#160;&amp;&#160;names(i)&#160;&amp;&#160;&#34;)&#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;names(i)&#160;&amp;&#160;&#34; = &#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oPathSub.getSubstituteVariableValue(subName)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Supported Names&#34;<br/>End&#160;Sub<br/>
Use&#160;substituteVariables&#160;to substitute&#160;multiple&#160;values&#160;at&#160;the&#160;same&#160;time. Use&#160;reSubstituteVariables&#160;to place&#160;the&#160;<br/>variable&#160;names&#160;back into&#160;a&#160;regular string.<br/>
<i><b>Listing&#160;169.</b>&#160;ReSubstitute&#160;variables.</i><br/>
Sub&#160;UsePathReSubstitution()<br/>&#160;&#160;Dim&#160;oPathSub&#160; &#160; &#160;&#160;' PathSubstitution service.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160;&#160;' Accumulate the value to print.<br/>&#160;&#160;Dim&#160;sTemp$<br/>&#160;&#160;<br/>&#160;&#160;oPathSub&#160;=&#160;CreateUnoService(&#160;&#34;com.sun.star.util.PathSubstitution&#34;&#160;)<br/>
&#160;&#160;' There are two variables to substitute.&#160;<br/>&#160;&#160;' False means do not generate an error<br/>&#160;&#160;' if an unknown variable is used.<br/>&#160;&#160;s&#160;=&#160;&#34;$(temp)/OOME/ or $(work)&#34;<br/>&#160;&#160;sTemp&#160;=&#160;oPathSub.substituteVariables(s,&#160;False)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;sTemp&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160;&#160;' This direction encodes the entire thing as though it were a single<br/>&#160;&#160;' path. This means that spaces are encoded in URL notation.<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sTemp&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;oPathSub.reSubstituteVariables(sTemp)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
191<br/>
<hr/>
<a name=195></a><i><b>Figure&#160;62.</b>&#160; PathSubstitution service.</i><br/>
<b>&#160;8.9.3.&#160;Simple&#160;File&#160;Access<br/></b>OOo uses&#160;the&#160;SimpleFileAccess&#160;service, rather than&#160;the&#160;file&#160;methods&#160;used by&#160;Basic, for file&#160;operations.&#160;The&#160;<br/>methods&#160;supported by&#160;the&#160;SimpleFileAccess&#160;service&#160;are&#160;shown in&#160;the&#160;following table.&#160;<br/>
<i><b>Table&#160;71.</b>&#160;Methods&#160;supported by&#160;SimpleFileAccess.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
copy(fromURL,&#160;toURL)<br/>
Copy&#160;a&#160;file.<br/>
move(fromURL, toURL)<br/>
Move&#160;a&#160;file.<br/>
kill(url)<br/>
Delete&#160;a&#160;file&#160;or&#160;directory,&#160;even if&#160;the&#160;folder&#160;is not&#160;empty.<br/>
isFolder(url)<br/>
Return true&#160;if&#160;the&#160;URL&#160;represents&#160;a&#160;folder.<br/>
isReadOnly(url)<br/>
Return true&#160;if&#160;the&#160;file&#160;is read-only.<br/>
setReadOnly(url,&#160;bool)<br/>
Set&#160;file&#160;as read-only&#160;if&#160;the&#160;boolean&#160;argument&#160;is true,&#160;otherwise,&#160;clear&#160;the&#160;read-only&#160;flag.<br/>
createFolder(url)<br/>
Creates a&#160;new&#160;Folder.<br/>
getSize(url)<br/>
Returns the&#160;size&#160;of&#160;a&#160;file&#160;as&#160;a&#160;long&#160;integer.<br/>
getContentType(url)<br/>
Return the&#160;content&#160;type&#160;of&#160;a&#160;file&#160;as a&#160;string. On my&#160;computer,&#160;an&#160;odt&#160;file&#160;has&#160;type&#160;<br/>application/vnd.sun.staroffice.fsys-file.<br/>
getDateTimeModified(url)<br/>
Return the&#160;last&#160;modified&#160;date&#160;for&#160;the&#160;file&#160;as a&#160;com.sun.star.util.DateTime&#160;structure, which&#160;<br/>supports the&#160;properties:&#160;HundredthSeconds, Seconds, Minutes,&#160;Hours,&#160;Day,&#160;Month, and&#160;<br/>
Year.<br/>
getFolderContents(url,&#160;bool)<br/>
Returns the&#160;contents of&#160;a&#160;folder&#160;as an&#160;array&#160;of&#160;strings. Each&#160;string&#160;is&#160;the&#160;full&#160;path as a&#160;URL.<br/>
If&#160;the&#160;bool&#160;is&#160;True,&#160;then files and&#160;directories&#160;are&#160;listed.&#160;If&#160;the&#160;bool&#160;is&#160;False,&#160;then only&#160;files&#160;<br/>are&#160;returned.<br/>
exists(url)<br/>
Return true&#160;if&#160;a&#160;file&#160;or&#160;directory&#160;exists.<br/>
openFileRead(url)<br/>
Open file&#160;to read,&#160;return an input&#160;stream.<br/>
openFileWrite(url)<br/>
Open file&#160;to write,&#160;return an output&#160;stream.<br/>
openFileReadWrite(url)<br/>
Open file&#160;to read and&#160;write,&#160;return&#160;a&#160;stream.<br/>
setInteractionHandler(handler)<br/>
Set&#160;an interaction handler&#160;to be&#160;used&#160;for&#160;further&#160;operations.&#160;This is a&#160;more&#160;advanced&#160;topic&#160;<br/>and&#160;I&#160;will&#160;not&#160;discuss this here.<br/>
writeFile(toUrl,&#160;inputStream)<br/>
Overwrite&#160;the&#160;file&#160;content&#160;with the&#160;given data.<br/>
<b>&#160;8.9.4.&#160;Streams<br/></b>A&#160;stream&#160;supports&#160;reading and writing data&#160;from&#160;some&#160;input&#160;source&#160;to&#160;some&#160;output&#160;source&#160;that&#160;may&#160;go&#160;<br/>beyond a&#160;file&#160;system.&#160;As&#160;an example, I&#160;use&#160;streams&#160;to transfer entire&#160;files&#160;between the&#160;regular file&#160;system&#160;and<br/>a&#160;field in&#160;a&#160;database. In&#160;other words, streams&#160;are&#160;powerful&#160;and worth&#160;knowing and understanding.&#160;This&#160;<br/>
192<br/>
<hr/>
<a name=196></a>section does&#160;not&#160;cover all&#160;of the&#160;stream&#160;capabilities&#160;and does&#160;not&#160;even touch on Markable&#160;streams&#160;and&#160;<br/>Object&#160;streams. Streams&#160;support&#160;all&#160;sorts&#160;of fancy&#160;things&#160;such as&#160;listeners&#160;that&#160;are&#160;automatically&#160;called when&#160;<br/>specific&#160;events&#160;occur.&#160;A&#160;motivated&#160;reader will&#160;read the&#160;streams&#160;document:<br/>
•<br/>
<a href="http://www.openoffice.org/udk/common/man/concept/streams.html">http://www.openoffice.org/udk/common/man/concept/streams.html&#160;</a><br/>
•<br/>
<a href="http://www.openoffice.org/api/docs/common/ref/com/sun/star/io/module-ix.html">http://www.openoffice.org/api/docs/common/ref/com/sun/star/io/module-ix.html&#160;</a><br/>
•<br/>
<a href="http://api.libreoffice.org/docs/common/ref/com/sun/star/io/module-ix.html">http://api.libreoffice.org/docs/common/ref/com/sun/star/io/module-ix.html&#160;</a><br/>
<b>TIP</b><br/>
The&#160;readLine()&#160;method does not&#160;remove&#160;the&#160;end&#160;of&#160;line&#160;character&#160;if&#160;the&#160;end&#160;of&#160;file&#160;is reached.<br/>
<i><b>Table&#160;72.</b>&#160;Stream&#160;methods.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Stream</b></i><br/>
<i><b>Description</b></i><br/>
available()<br/>
InputStream<br/>
Returns the&#160;number&#160;of&#160;available&#160;bytes&#160;as&#160;a&#160;long.<br/>
closeInput()<br/>
InputStream<br/>
Close&#160;the&#160;input&#160;stream.<br/>
closeOutput()<br/>
OutputStream<br/>
Close&#160;the&#160;stream.<br/>
flush()<br/>
OutputStream<br/>
Flush&#160;buffers.<br/>
getLength()<br/>
XSeekable<br/>
Get&#160;length of&#160;the&#160;stream.<br/>
getPosition()<br/>
XSeekable<br/>
Return the&#160;stream&#160;offset&#160;as a&#160;64-bit&#160;integer.<br/>
isEOF()<br/>
TextInputStream<br/>
Returns true&#160;if&#160;the&#160;end of&#160;file&#160;has&#160;been reached.<br/>
readBoolean()<br/>
DataInputStream<br/>
Read&#160;an 8&#160;bit&#160;value&#160;and&#160;return a&#160;byte.&#160;0 means&#160;FALSE;&#160;all&#160;other<br/>values mean&#160;TRUE.&#160;&#160;<br/>
readByte()<br/>
DataInputStream<br/>
Read&#160;and return an 8&#160;bit&#160;value&#160;and&#160;return a&#160;byte.<br/>
readBytes(byteArray,&#160;long)<br/>
InputStream<br/>
Read&#160;the&#160;specified&#160;number&#160;of&#160;bytes and&#160;return the&#160;number&#160;of&#160;<br/>
bytes read.&#160;If&#160;the&#160;number&#160;of&#160;bytes requested&#160;was not&#160;read, then&#160;<br/>the&#160;end of&#160;file&#160;has been reached.<br/>
readChar()<br/>
DataInputStream<br/>
Read&#160;and return a&#160;16-bit&#160;Unicode&#160;character.&#160;&#160;<br/>
readDouble()<br/>
DataInputStream<br/>
Read&#160;and return a&#160;64-bit&#160;IEEE&#160;double.<br/>
readFloat()<br/>
DataInputStream<br/>
Read&#160;and return a&#160;32-bit&#160;IEEE&#160;float.<br/>
readHyper()<br/>
DataInputStream<br/>
Read&#160;and return a&#160;64-bit&#160;big&#160;endian&#160;integer.<br/>
readLine()<br/>
TextInputStream<br/>
Read&#160;text&#160;until&#160;a&#160;line&#160;break (CR, LF,&#160;or&#160;CR/LF)&#160;or&#160;EOF&#160;is&#160;<br/>
found&#160;and&#160;returns it&#160;as string&#160;(without&#160;CR,&#160;LF).&#160;&#160;<br/>
readLong()<br/>
DataInputStream<br/>
Read&#160;and return a&#160;32-bit&#160;big&#160;endian&#160;integer.<br/>
readShort()<br/>
DataInputStream<br/>
Read&#160;and return a&#160;16-bit&#160;big&#160;endian&#160;integer.<br/>
readSomeBytes(byteArray,&#160;long)<br/>
InputStream<br/>
Read&#160;up to the&#160;specified&#160;number&#160;of&#160;bytes and&#160;return the&#160;number<br/>of&#160;bytes read.&#160;If&#160;the&#160;number&#160;of&#160;bytes read&#160;is&#160;zero,&#160;then the&#160;end&#160;<br/>
of&#160;file&#160;has been reached.<br/>
readString(charArray,&#160;boolean)<br/>
TextInputStream<br/>
Read&#160;text&#160;until&#160;one&#160;of&#160;the&#160;given delimiter&#160;characters&#160;or&#160;EOF&#160;is&#160;<br/>found&#160;and&#160;returns it&#160;as string.&#160;The&#160;boolean argument&#160;determines<br/>
if&#160;the&#160;delimiter&#160;is&#160;returned&#160;(false)&#160;or&#160;removed&#160;(true).<br/>
readUTF()<br/>
DataInputStream<br/>
Read&#160;and return a&#160;string&#160;of&#160;UTF&#160;encoded&#160;characters. &#160;<br/>
seek (&#160;INT64&#160;)<br/>
XSeekable<br/>
Change&#160;the&#160;stream&#160;pointer&#160;to&#160;the&#160;specified&#160;location.<br/>
setEncoding(string)<br/>
TextInputStream<br/>
Set&#160;the&#160;character&#160;encoding&#160;(see&#160;&#160;<br/><a href="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets)</a>.&#160;<br/>
193<br/>
<hr/>
<a name=197></a><i><b>Method</b></i><br/>
<i><b>Stream</b></i><br/>
<i><b>Description</b></i><br/>
skipBytes(long)<br/>
InputStream<br/>
Skips the&#160;specified number&#160;of&#160;bytes.<br/>
truncate()<br/>
XTruncate<br/>
Set&#160;the&#160;size&#160;of&#160;the&#160;file&#160;to zero.<br/>
writeBoolean(boolean)<br/>
DataOutputStream<br/>
Write&#160;a&#160;boolean as an&#160;8 bit&#160;value. 0&#160;means FALSE;&#160;all&#160;other&#160;<br/>
values mean&#160;TRUE.&#160;&#160;<br/>
writeByte(byte)<br/>
DataOutputStream<br/>
Write&#160;an 8&#160;bit&#160;value&#160;and&#160;return a&#160;byte.<br/>
writeBytes(byteArray())<br/>
OutputStream<br/>
Write&#160;all&#160;bytes to the&#160;stream.<br/>
writeChar(char)<br/>
DataOutputStream<br/>
Write&#160;a&#160;16-bit&#160;Unicode&#160;character.&#160;&#160;<br/>
writeDouble(double)<br/>
DataOutputStream<br/>
Write&#160;a&#160;64-bit&#160;IEEE&#160;double.<br/>
writeFloat(float)<br/>
DataOutputStream<br/>
Write&#160;a&#160;32-bit&#160;IEEE&#160;float.<br/>
writeHyper(INT64)<br/>
DataOutputStream<br/>
Write&#160;a&#160;64-bit&#160;big&#160;endian&#160;integer.<br/>
writeLong(long)<br/>
DataOutputStream<br/>
Write&#160;a&#160;32-bit&#160;big&#160;endian&#160;integer.<br/>
writeShort(short)<br/>
DataOutputStream<br/>
Write&#160;a&#160;16-bit&#160;big&#160;endian&#160;integer.<br/>
There&#160;are&#160;many&#160;different&#160;types&#160;of stream&#160;services&#160;and interfaces&#160;(see<a href="libremacros.html#196">&#160;Table&#160;72).&#160;</a>A&#160;simple&#160;stream&#160;returned by&#160;<br/>SimpleFileAccess&#160;only&#160;supports&#160;reading&#160;and writing raw&#160;bytes&#160;and you&#160;must&#160;convert&#160;the&#160;data&#160;to an array&#160;of&#160;<br/>bytes. It&#160;is&#160;more&#160;common&#160;to manually&#160;create&#160;an appropriate&#160;stream&#160;(such as&#160;DataOutputStream&#160;or&#160;<br/>TextInputStream) and use&#160;that&#160;to&#160;wrap the&#160;simple&#160;stream&#160;returned by&#160;SimpleFileAccess.&#160;<br/>
<i><b>Listing&#160;170.</b>&#160;Using&#160;SimpleFileAccess&#160;to&#160;read and write&#160;text&#160;files.</i><br/>
Sub&#160;ExampleSimpleFileAccess<br/>&#160;&#160;Dim&#160;oSFA&#160; &#160; &#160; &#160;&#160;' SimpleFileAccess service.<br/>&#160;&#160;Dim&#160;sFileName$&#160;&#160;' Name of file to open.<br/>&#160;&#160;Dim&#160;oStream&#160; &#160; &#160;' Stream returned from SimpleFileAccess.<br/>&#160;&#160;Dim&#160;oTextStream&#160;' TextStream service.<br/>&#160;&#160;Dim&#160;sStrings&#160; &#160;&#160;' Strings to test write / read.<br/>&#160;&#160;Dim&#160;sInput$&#160; &#160; &#160;' The string that is read.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160;&#160;' Accumulate result to print.<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160;&#160;' Index variable.<br/>&#160;&#160;<br/>&#160;&#160;sStrings&#160;=&#160;Array(&#34;One&#34;,&#160;&#34;UTF:Āā&#34;,&#160;&#34;1@3&#34;)<br/>
&#160;&#160;' File to use.<br/>&#160;&#160;sFileName&#160;=&#160;CurDir()&#160;&amp;&#160;&#34;/delme.out&#34;<br/>
&#160;&#160;' Create the SimpleFileAccess service.<br/>&#160;&#160;oSFA&#160;=&#160;CreateUnoService(&#34;com.sun.star.ucb.SimpleFileAccess&#34;)<br/>&#160;&#160;<br/>&#160;&#160;'Create the Specialized stream.<br/>&#160;&#160;oTextStream&#160;=&#160;CreateUnoService(&#34;com.sun.star.io.TextOutputStream&#34;)<br/>&#160;&#160;<br/>&#160;&#160;'If the file already exists, delete it.<br/>&#160;&#160;If&#160;oSFA.exists(sFileName)&#160;Then<br/>&#160; &#160;&#160;oSFA.kill(sFileName)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;' Open the file for writing.<br/>
194<br/>
<hr/>
<a name=198></a>&#160;&#160;oStream&#160;=&#160;oSFA.openFileWrite(sFileName)<br/>&#160;&#160;<br/>&#160;&#160;' Attach the simple stream to the text stream.<br/>&#160;&#160;' The text stream will use the simple stream.<br/>&#160;&#160;oTextStream.setOutputStream(oStream)<br/>&#160;&#160;<br/>&#160;&#160;' Write the strings.<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(sStrings)&#160;To&#160;UBound(sStrings)<br/>&#160; &#160;&#160;oTextStream.writeString(sStrings(i)&#160;&amp;&#160;CHR$(10))<br/>&#160;&#160;Next<br/>&#160;&#160;<br/>&#160;&#160;' Close the stream.<br/>&#160;&#160;oTextStream.closeOutput()<br/>
&#160;&#160;oTextStream&#160;=&#160;CreateUnoService(&#34;com.sun.star.io.TextInputStream&#34;)<br/>&#160;&#160;oStream&#160;=&#160;oSFA.openFileRead(sFileName)<br/>&#160;&#160;oTextStream.setInputStream(oStream)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(sStrings)&#160;To&#160;UBound(sStrings)<br/>&#160; &#160;&#160;sInput&#160;=&#160;oTextStream.readLine()<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(i)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;' If the EOF is reached then the new line delimiters are<br/>&#160; &#160;&#160;' not removed. I consider this a bug.<br/>&#160; &#160;&#160;If&#160;oTextStream.isEOF()&#160;Then<br/>&#160; &#160; &#160;&#160;If&#160;Right(sInput,&#160;1)&#160;=&#160;CHR$(10)&#160;Then&#160;<br/>&#160; &#160; &#160; &#160;&#160;sInput&#160;=&#160;Left(sInput,&#160;Len(sInput)&#160;-&#160;1)<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;' Verify that the read string is the same as the written string.<br/>&#160; &#160;&#160;If&#160;sInput&#160;&lt;&gt;&#160;sStrings(i)&#160;Then<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; : BAD &#34;<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; : OK &#34;<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;(&#34;&#160;&amp;&#160;sStrings(i)&#160;&amp;&#160;&#34;)&#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;(&#34;&#160;&amp;&#160;sInput&#160;&amp;&#160;&#34;)&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;oTextStream.closeInput()<br/>&#160;&#160;MsgBox&#160;s&#160;&#160;<br/>End&#160;Sub&#160;<br/>
<i><b>Figure&#160;63.</b>&#160; Text&#160;files&#160;with&#160;SimpleFileAccess.</i><br/>
195<br/>
<hr/>
<a name=199></a><b>&#160;8.9.5.&#160;Pipes<br/></b>A&#160;pipe&#160;is&#160;an output&#160;stream&#160;and an input&#160;stream.&#160;Data&#160;written to&#160;the&#160;outputstream&#160;is&#160;buffered until&#160;it&#160;is&#160;read&#160;<br/>from&#160;the&#160;input&#160;stream.&#160;The&#160;Pipe&#160;service&#160;allows&#160;an outputstream&#160;to&#160;be&#160;converted into&#160;an input&#160;stream&#160;at&#160;the&#160;<br/>cost&#160;of an additional&#160;buffer.&#160;It&#160;is&#160;simple&#160;to&#160;create&#160;and close&#160;a&#160;pipe.&#160;Although CreatePipe&#160;i<a href="libremacros.html#199">n&#160;Listing&#160;171&#160;<br/></a>creates&#160;data&#160;streams, a&#160;very&#160;simple&#160;change&#160;would use&#160;a&#160;text&#160;stream&#160;instead.<br/>
<i><b>Listing&#160;171.</b>&#160;Create&#160;and close&#160;a pipe.<br/></i>Function&#160;CreatePipe()&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;oPipe&#160; &#160;&#160;' Pipe Service.<br/>&#160;&#160;Dim&#160;oDataInp&#160;' DataInputStream Service.<br/>&#160;&#160;Dim&#160;oDataOut&#160;' DataOutputStream Service.<br/>
&#160;&#160;oPipe&#160; &#160;&#160;=&#160;createUNOService&#160;(&#34;com.sun.star.io.Pipe&#34;)<br/>&#160;&#160;oDataInp&#160;=&#160;createUNOService&#160;(&#34;com.sun.star.io.DataInputStream&#34;)<br/>&#160;&#160;oDataOut&#160;=&#160;createUNOService&#160;(&#34;com.sun.star.io.DataOutputStream&#34;)<br/>&#160;&#160;oDataInp.setInputStream(oPipe)<br/>&#160;&#160;oDataOut.setOutputStream(oPipe)<br/>&#160;&#160;CreatePipe&#160;=&#160;oPipe<br/>End&#160;Function<br/>
Sub&#160;ClosePipe(oPipe)<br/>&#160;&#160;oPipe.Successor.closeInput<br/>&#160;&#160;oPipe.Predecessor.closeOutput<br/>&#160;&#160;oPipe.closeInput<br/>&#160;&#160;oPipe.closeOutput<br/>End&#160;Sub<br/>
TestPipes&#160;in<a href="libremacros.html#199">&#160;Listing 172&#160;us</a>es&#160;a&#160;pipe&#160;to&#160;convert&#160;a&#160;byte&#160;array&#160;to a&#160;double&#160;and a&#160;double&#160;to&#160;a&#160;byte&#160;array.&#160;<br/>
<i><b>Listing&#160;172.</b>&#160;Convert&#160;a byte&#160;array&#160;to a double&#160;and a double&#160;to&#160;a binary&#160;array.<br/></i>Sub&#160;TestPipes<br/>&#160;&#160;Dim&#160;oPipe&#160; &#160; &#160; &#160;&#160;' Pipe service.<br/>&#160;&#160;Dim&#160;d&#160;As&#160;Double<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;s$<br/>
&#160;&#160;oPipe&#160;=&#160;CreatePipe()<br/>&#160;&#160;<br/>&#160;&#160;' First, write a series of bytes that represents 3.1415<br/>&#160;&#160;oPipe.Predecessor.writeBytes(Array(64,&#160;9,&#160;33,&#160;-7,&#160;-16,&#160;27,&#160;-122,&#160;110))<br/>&#160;&#160;d&#160;=&#160;2.6&#160; &#160;&#160;'4004CCCCCCCCCCCD<br/>&#160;&#160;oPipe.Predecessor.writeDouble(d)<br/>&#160;&#160;<br/>&#160;&#160;' Now, read the pipe.<br/>&#160;&#160;d&#160;=&#160;oPipe.Successor.readDouble()<br/>&#160;&#160;s&#160;=&#160;&#34;Read the array of bytes as: &#34;&#160;&amp;&#160;CStr(d)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;' Now read the double that was written as a series of bytes.<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;2.6 = &#34;<br/>&#160;&#160;Do&#160;While&#160;oPipe.Successor.available()&#160;&gt;&#160;0<br/>&#160; &#160;&#160;i&#160;=&#160;oPipe.Successor.readByte()<br/>&#160; &#160;&#160;REM In case the byte was negative<br/>&#160; &#160;&#160;i&#160;=&#160;i&#160;AND&#160;255<br/>
196<br/>
<hr/>
<a name=200></a>&#160; &#160;&#160;If&#160;i&#160;&lt;&#160;16&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;0&#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;Hex(i)&#160;&amp;&#160;&#34; &#34;<br/>&#160;&#160;Loop<br/>&#160;&#160;ClosePipe(oPipe)<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub&#160;<br/>
<i><b>&#160;8.10.&#160;Conclusion<br/></b></i>The&#160;file&#160;and directory&#160;functions&#160;in&#160;OOo Basic&#160;are&#160;able&#160;to&#160;manipulate&#160;directories&#160;and files.&#160;With&#160;the&#160;<br/>exception&#160;of reading and writing binary&#160;and random&#160;files, the&#160;directory&#160;and file&#160;manipulation&#160;functions&#160;work<br/>with few&#160;surprises. On the&#160;other hand, some&#160;of the&#160;functions&#160;are&#160;broken and have&#160;been broken for years;&#160;you<br/>may&#160;need to&#160;use&#160;more&#160;advanced methods, such as&#160;Streams&#160;and SimpleFileAccess&#160;for anything&#160;other than&#160;<br/>simple&#160;file&#160;reading&#160;and writing.<br/>
197<br/>
<hr/>
<a name=201></a><b>&#160;9.&#160;Miscellaneous&#160;Routines<br/></b>This&#160;chapter introduces&#160;the&#160;subroutines&#160;and functions&#160;supported&#160;by&#160;OpenOffice.org&#160;Basic&#160;that&#160;do not&#160;easily&#160;<br/>fit&#160;into&#160;another larger category&#160;—&#160;for example, routines&#160;related to flow&#160;control,&#160;user input, user output, error&#160;<br/>handling, inspecting variables,&#160;color,&#160;and display<b>&#160;—&#160;as&#160;well&#160;as</b>&#160;a&#160;few&#160;routines&#160;that&#160;you&#160;should&#160;not&#160;use.<br/>
I&#160;was&#160;tempted to&#160;call&#160;this&#160;chapter “Leftovers”&#160;because&#160;it&#160;contains&#160;the&#160;routines&#160;that&#160;were&#160;left&#160;over after I&#160;<br/>grouped the&#160;others&#160;into chapters.&#160;Although the&#160;word “leftovers”&#160;frequently&#160;has&#160;a&#160;negative&#160;connotation, this&#160;is<br/>certainly&#160;not&#160;the&#160;case&#160;for the&#160;routines&#160;discussed in this&#160;chapter.&#160;The&#160;eclectic&#160;mix&#160;of routines&#160;includes&#160;some&#160;of<br/>the&#160;more&#160;interesting&#160;and useful&#160;routines&#160;that&#160;are&#160;varied enough to&#160;prevent&#160;boredom&#160;from&#160;lulling&#160;you off&#160;to&#160;<br/>sleep.<br/>
<i><b>&#160;9.1.&#160;Display&#160;and&#160;color&#160;<br/></b></i>The&#160;OOo Basic&#160;functions&#160;related to&#160;color manipulations&#160;and determining screen metrics&#160;are&#160;shown i<a href="libremacros.html#201">n&#160;Table&#160;<br/>73.&#160;</a>The&#160;screen metrics&#160;provide&#160;the&#160;size&#160;of each pixel&#160;so that&#160;you&#160;can write&#160;macros&#160;to&#160;create&#160;objects&#160;at&#160;a&#160;<br/>given size&#160;and position&#160;objects&#160;more&#160;precisely.<br/>
<i><b>Table&#160;73.</b>&#160;Display- and color-related functions&#160;in OOo Basic.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
Blue(color)<br/>
Get&#160;the&#160;blue&#160;component<br/>
GetGuiType<br/>
Get&#160;the&#160;GUI&#160;type:&#160;Mac,&#160;Windows, Unix<br/>
Green(color)<br/>
Get&#160;the&#160;green component<br/>
QBColor(dos_color)<br/>
Return RGB&#160;for&#160;standard&#160;color<br/>
Red(color)<br/>
Get&#160;the&#160;red&#160;component<br/>
RGB(red, green,&#160;blue)<br/>
RGB&#160;to colorNumber<br/>
TwipsPerPixelX<br/>
Width of&#160;each pixel&#160;in twips<br/>
TwipsPerPixelY<br/>
Height&#160;of&#160;each&#160;pixel&#160;in twips<br/>
<b>&#160;9.1.1.&#160;Determine&#160;the&#160;GUI&#160;type<br/></b>The&#160;GetGuiType&#160;function&#160;returns&#160;an integer corresponding&#160;to&#160;the&#160;graphical&#160;user interface&#160;(GUI).&#160;In&#160;other&#160;<br/>words, you&#160;can find out&#160;what&#160;type&#160;of computer is&#160;running&#160;the&#160;macro ... well,&#160;sort&#160;of.&#160;This&#160;function only&#160;<br/>mentions&#160;the&#160;GUI&#160;type, not&#160;the&#160;operating system&#160;—&#160;for example,&#160;just&#160;Windows, not&#160;Windows&#160;98 or&#160;<br/>Windows&#160;XP.&#160;The&#160;function GetGuiType&#160;is&#160;only&#160;included for backward compatibility&#160;with previous&#160;versions&#160;<br/>of OOo Basic.<br/>
One&#160;of my&#160;associates&#160;runs&#160;OpenOffice.org&#160;as&#160;a&#160;server on his&#160;computer at&#160;home. He&#160;then&#160; connects&#160;to&#160;his&#160;<br/>home&#160;computer from&#160;work as&#160;a&#160;client.&#160;The&#160;value&#160;returned by&#160;GetGuiType&#160;is&#160;not&#160;defined while&#160;OOo is&#160;<br/>running in a&#160;client/server environment.&#160;<br/>
<a href="libremacros.html#202">Table&#160;74&#160;s</a>hows&#160;the&#160;return values, as&#160;documented by&#160;the&#160;OOo help&#160;and seen in&#160;the&#160;source&#160;code&#160;as&#160;of version&#160;<br/>3.2.1.<br/>
198<br/>
<hr/>
<a name=202></a><i><b>Table&#160;74.</b>&#160;Return&#160;values&#160;from&#160;GetGuiType.</i><br/>
<i><b>#</b></i><br/>
<i><b>OOo&#160;Help</b></i><br/>
<i><b>Source&#160;Code</b></i><br/>
1<br/>
Windows<br/>
Windows&#160;(sometimes OS/2, which&#160;runs&#160;Windows)<br/>
2<br/>
Not&#160;mentioned<br/>
OS/2<br/>
3<br/>
Not&#160;mentioned<br/>
Used&#160;to be&#160;Mac, not&#160;returned.<br/>
4<br/>
Unix<br/>
Unix<br/>
-1<br/>
Mentioned as an undefined&#160;value<br/>
Unsupported&#160;OS<br/>
The&#160;macro i<a href="libremacros.html#202">n&#160;Listing&#160;173&#160;de</a>monstrates&#160;the&#160;GetGuiType&#160;function.<br/>
<i><b>Listing&#160;173.</b>&#160;Display&#160;the&#160;GUI type&#160;as&#160;a string.<br/></i>Sub&#160;DisplayGUIType()<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Select&#160;Case&#160;GetGUIType()<br/>&#160; &#160;&#160;Case&#160;1<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;&#34;Windows&#34;<br/>&#160; &#160;&#160;Case&#160;2<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;&#34;OS/2&#34;&#160; &#160; &#160;' Set in the source code, but no longer documented.<br/>&#160; &#160;&#160;Case&#160;3<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;&#34;Mac OS&#34;&#160; &#160;' Used to be documented, never supported, I expect Mac to return 4.<br/>&#160; &#160;&#160;Case&#160;4<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;&#34;UNIX&#34;<br/>&#160; &#160;&#160;Case&#160;Else<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;&#34;Unknown value &#34;&#160;&amp;&#160;CStr(GetGUIType())&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#160;&#34;Probably running in Client/Server mode&#34;<br/>&#160;&#160;End&#160;Select<br/>&#160;&#160;MsgBox&#160;&#34;GUI type is &#34;&#160;&amp;&#160;s,&#160;0,&#160;&#34;GetGUIType()&#34;<br/>End&#160;Sub<br/>
The&#160;value&#160;-1 is&#160;returned if&#160;the&#160;type&#160;is&#160;not&#160;known, but&#160;that&#160;is&#160;not&#160;specifically&#160;documented.&#160;This&#160;probably&#160;<br/>means&#160;that&#160;you&#160;are&#160;running&#160;in&#160;a&#160;client&#160;/&#160;server mode,&#160;but, I&#160;have&#160;not&#160;checked that.<br/>
<b>&#160;9.1.2.&#160;Determine&#160;pixel&#160;size&#160;(in&#160;twips)<br/></b>OOo Basic&#160;has&#160;two functions&#160;to determine&#160;the&#160;size&#160;of each display&#160;pixel&#160;(dot) in&#160;twips:&#160;TwipsPerPixelX&#160;and&#160;<br/>TwipsPerPixelY.&#160;The&#160;word “twip”&#160;is&#160;short&#160;for “twentieth of a&#160;PostScript&#160;point.”&#160;There&#160;are&#160;72 PostScript&#160;<br/>points&#160;in an inch,&#160;thus&#160;1440 twips&#160;in&#160;an inch.<br/>
In&#160;1886, the&#160;American&#160;Typefounders&#160;Association proposed a&#160;unit&#160;of measure&#160;for typesetting called the&#160;<br/>“American Printer’s&#160;Point.”&#160;There&#160;are&#160;approximately&#160;72.27000072 Printer’s&#160;Points&#160;in an inch.&#160;Years&#160;later&#160;<br/>while&#160;developing the&#160;PostScript&#160;page&#160;description&#160;language&#160;for&#160;Adobe&#160;Systems,&#160;Jim&#160;Warnock and Charles&#160;<br/>Geschke&#160;defined the&#160;PostScript&#160;point&#160;as&#160;exactly&#160;72 points&#160;to&#160;an inch.&#160;When dot-matrix&#160;printers&#160;were&#160;<br/>released, they&#160;could print&#160;at&#160;either 10 or 12 characters&#160;per inch.&#160;Twips&#160;were&#160;created&#160;as&#160;a&#160;unit&#160;of measure&#160;that&#160;<br/>worked well&#160;for both&#160;dot-matrix&#160;printers&#160;and PostScript&#160;points.<br/>
<b>TIP</b><br/>
There&#160;are&#160;1440 twips in an inch.&#160;This number&#160;is important&#160;because&#160;OOo&#160;uses&#160;twips for&#160;many&#160;<br/>
measurements.<br/>
Twips&#160;are&#160;the&#160;standard on which all&#160;Microsoft&#160;Windows&#160;graphics&#160;routines&#160;are&#160;based.&#160;Twips&#160;are&#160;used in the&#160;<br/>Rich&#160;Text&#160;Format,&#160;printer drivers, screen drivers, and many&#160;other products&#160;and platforms&#160;—&#160;including&#160;<br/>
199<br/>
<hr/>
<a name=203></a>OpenOffice.org.&#160;The&#160;macro i<a href="libremacros.html#203">n&#160;Listing&#160;174&#160;obt</a>ains&#160;the&#160;number of twips&#160;per pixel&#160;in&#160;both the&#160;X&#160;and&#160;Y&#160;<br/>direction&#160;(horizontal&#160;and vertical) and displays&#160;the&#160;number of pixels&#160;per inch.<br/>
<i><b>Listing&#160;174.</b>&#160;Determine&#160;how many&#160;pixels&#160;per&#160;inch.<br/></i>Sub&#160;DisplayPixelSize<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;TwipsPerPixelX()&#160;&amp;&#160;&#34; Twips per X-Pixel or &#34;&#160;&amp;_<br/>&#160; &#160; &#160;&#160;CStr(1440&#160;\&#160;TwipsPerPixelX())&#160;&amp;&#160;&#34; X-Pixels per Inch&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;TwipsPerPixelY()&#160;&amp;&#160;&#34; Twips per Y-Pixel or &#34;&#160;&amp;_<br/>&#160; &#160; &#160;&#160;CStr(1440&#160;\&#160;TwipsPerPixelY())&#160;&amp;&#160;&#34; Y-Pixels per Inch&#34;<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Pixel Size&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;64.</b>&#160;Number&#160;of&#160;pixels&#160;per&#160;inch on my&#160;computer.&#160;</i><br/>
Unfortunately,&#160;it&#160;is&#160;not&#160;clear to me&#160;what&#160;is&#160;returned when there&#160;are&#160;multiple&#160;monitors&#160;with different&#160;values.&#160;<br/>The&#160;source&#160;code&#160;returns&#160;values&#160;from&#160;the&#160;“Default&#160;Device”.<br/>
<b>&#160;9.1.3.&#160;Use&#160;color&#160;functions<br/></b>Colors&#160;on computer monitors, digital&#160;cameras, scanners&#160;—&#160;and those&#160;seen by&#160;the&#160;human eye&#160;—&#160;are&#160;produced<br/>by&#160;adding&#160;the&#160;three&#160;primary&#160;colors&#160;of light:&#160;red, green, and blue&#160;(RGB).&#160;When printing or painting, color is&#160;<br/>produced by&#160;absorbing some&#160;colors&#160;and reflecting others. Color printing uses&#160;a&#160;different&#160;set&#160;of colors, called&#160;<br/>primary&#160;pigments:&#160;cyan, magenta,&#160;yellow,&#160;and black (CMYK).&#160;These&#160;two different&#160;systems&#160;are&#160;based on real<br/>physical&#160;models.&#160;The&#160;RGB model&#160;is&#160;based on how&#160;light&#160;combines&#160;to form&#160;colors.&#160;The&#160;CMYK&#160;model&#160;is&#160;<br/>based on what&#160;happens&#160;when you&#160;mix&#160;paint&#160;of different&#160;colors.&#160;<br/>
OOo Basic&#160;uses&#160;the&#160;RGB model,&#160;allowing&#160;for 256 different&#160;shades&#160;of each of the&#160;primary&#160;colors.&#160;This&#160;<br/>number is&#160;stored as&#160;a&#160;Long&#160;Integer.&#160;Use&#160;the&#160;functions&#160;Red,&#160;Green, and Blue&#160;to extract&#160;the&#160;red, green, and&#160;<br/>blue&#160;components&#160;from&#160;a&#160;color in&#160;OOo. Use&#160;the&#160;RGB function&#160;to combine&#160;the&#160;individual&#160;color components&#160;<br/>and obtain&#160;the&#160;long&#160;integer used by&#160;OOo.&#160;The&#160;RGB function&#160;accepts&#160;three&#160;arguments,&#160;each representing&#160;one&#160;<br/>of the&#160;primary&#160;colors. Each of the&#160;color components&#160;must&#160;be&#160;a&#160;value&#160;from&#160;0 through 255.&#160;The&#160;RGB function&#160;<br/>performs&#160;no validity&#160;checking, so consider the&#160;results&#160;undefined if you break the&#160;rules. In&#160;summary,&#160;OOo&#160;<br/>Basic&#160;represents&#160;RGB colors&#160;as&#160;a&#160;single&#160;integer;&#160;the&#160;functions&#160;Red, Green, and Blue&#160;extract&#160;the&#160;red, green&#160;<br/>and blue&#160;components;&#160;and the&#160;function&#160;RGB accepts&#160;the&#160;red, green, and blue&#160;components&#160;and returns&#160;the&#160;<br/>OOo Basic&#160;representation&#160;of the&#160;RGB color.&#160;<br/>
Dim&#160;nRed&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160;'Can only be 0 through 255<br/>Dim&#160;nGreen&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160;'Can only be 0 through 255<br/>Dim&#160;nBlue&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160;&#160;'Can only be 0 through 255<br/>Dim&#160;nOOoColor&#160;As&#160;Long&#160; &#160; &#160; &#160; &#160;'Can only be 0 through 16,581,375<br/>nOOoColor&#160;=&#160;RGB(128,&#160;3,&#160;101)&#160;&#160;'8,389,477<br/>nRed&#160; &#160;=&#160;Red(nOOoColor)&#160; &#160; &#160; &#160;'128<br/>nGreen&#160;=&#160;Green(nOOoColor)&#160; &#160; &#160;'3<br/>nBlue&#160;&#160;=&#160;Blue(nOOoColor)&#160; &#160; &#160;&#160;'101<br/>
In&#160;the&#160;old&#160;days&#160;of DOS, BASIC supported&#160;16 colors. In<a href="libremacros.html#205">&#160;Table&#160;75, w</a>hich&#160;shows&#160;the&#160;color name&#160;and the&#160;DOS&#160;<br/>the&#160;number used by&#160;DOS&#160;to&#160;represent&#160;the&#160;color.&#160;The&#160;OOo Color&#160;column contains&#160;the&#160;corresponding number&#160;<br/>
200<br/>
<hr/>
<a name=204></a>as&#160;represented by&#160;OOo.&#160;The&#160;Red, Green, and Blue&#160;columns&#160;contain the&#160;values&#160;returned by&#160;the&#160;corresponding<br/>OOo Basic&#160;functions.&#160;The&#160;QBColor function&#160;is&#160;designed to accept&#160;the&#160;DOS&#160;Color as&#160;an argument&#160;and return&#160;<br/>the&#160;corresponding OOo Color.<br/>
<i><b>Listing&#160;175.</b>&#160;Demonstrate&#160;QBColor&#160;values.<br/></i>Sub&#160;DisplayQBColor<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;15&#160;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;i&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;QBColor(i)&#160;&amp;&#160;&#34; = (&#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;Red(QBColor(i))&#160;&amp;&#160;&#34;, &#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;Green(QBColor(i))&#160;&amp;&#160;&#34;, &#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;Blue(QBColor(i))&#160;&amp;&#160;&#34;)&#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<i><b>Figure&#160;65.</b>&#160;Results&#160;from&#160;QGColor.&#160;</i><br/>
201<br/>
<hr/>
<a name=205></a><i><b>Table&#160;75.</b>&#160;Color&#160;representation in&#160;OpenOffice.org.</i><br/>
<i><b>DOS&#160;Color</b></i><br/>
<i><b>OOo&#160;Color</b></i><br/>
<i><b>Red</b></i><br/>
<i><b>Green</b></i><br/>
<i><b>Blue</b></i><br/>
0<br/>
0<br/>
0<br/>
0<br/>
0<br/>
4<br/>
128<br/>
0<br/>
0<br/>
128<br/>
2<br/>
32768<br/>
0<br/>
128<br/>
0<br/>
6<br/>
32896<br/>
0<br/>
128<br/>
128<br/>
1<br/>
8388608<br/>
128<br/>
0<br/>
0<br/>
5<br/>
8388736<br/>
128<br/>
0<br/>
128<br/>
3<br/>
8421376<br/>
128<br/>
128<br/>
0<br/>
8<br/>
8421504<br/>
128<br/>
128<br/>
128<br/>
7<br/>
12632256<br/>
192<br/>
192<br/>
192<br/>
12<br/>
255<br/>
0<br/>
0<br/>
255<br/>
10<br/>
65280<br/>
0<br/>
255<br/>
0<br/>
14<br/>
65535<br/>
0<br/>
255<br/>
255<br/>
9<br/>
16711680<br/>
255<br/>
0<br/>
0<br/>
13<br/>
16711935<br/>
255<br/>
0<br/>
255<br/>
11<br/>
16776960<br/>
255<br/>
255<br/>
0<br/>
15<br/>
16777215<br/>
255<br/>
255<br/>
255<br/>
<i><b>&#160;9.2.&#160;Flow&#160;control<br/></b></i>The&#160;flow-control&#160;functions&#160;listed in<a href="libremacros.html#205">&#160;Table&#160;76&#160;e</a>ither direct&#160;flow&#160;or provide&#160;functionality&#160;similar to&#160;flow&#160;<br/>control. For example,&#160;the&#160;IIF&#160;(immediate&#160;if) function&#160;provides&#160;functionality&#160;that&#160;would otherwise&#160;require&#160;an&#160;<br/>If-Then-Else&#160;statement.<br/>
<i><b>Table&#160;76.</b>&#160;OOo Basic&#160;functions&#160;related&#160;to flow&#160;control.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
Choose(number,&#160;argument_list)<br/>
Flow&#160;control<br/>
IIF(condition,&#160;TrueExpression,&#160;FalseExpression)<br/>
Flow&#160;control<br/>
Stop<br/>
Stop&#160;execution&#160;now<br/>
Wait(milliseconds)<br/>
Pause&#160;the&#160;macro for&#160;a&#160;short&#160;time<br/>
WaitUntil(aTime)<br/>
Wait&#160;until&#160;a&#160;time&#160;has been reached.<br/>
Declare<br/>
Declare&#160;a&#160;DLL&#160;that&#160;you want&#160;to call<br/>
DDEExecute(nDDEChannel,&#160;command)<br/>
Execute&#160;a&#160;DDE&#160;command<br/>
DDEInitiate(Server,&#160;Topic)<br/>
Open a&#160;DDE channel<br/>
DDEPoke(nDDEChannel,&#160;item, data)<br/>
Set&#160;data&#160;on the&#160;DDE server&#160;through&#160;the&#160;channel<br/>
DDERequest(nDDEChannel,&#160;item)<br/>
Post&#160;a&#160;DDE request&#160;over&#160;an open&#160;channel<br/>
DDETerminateAll()<br/>
Close&#160;all&#160;DDE connections<br/>
FreeLibrary<br/>
Free&#160;a&#160;DLL&#160;library<br/>
Shell<br/>
Run a&#160;command&#160;through the&#160;command shell<br/>
202<br/>
<hr/>
<a name=206></a><b>&#160;9.2.1.&#160;Return&#160;an&#160;argument<br/></b>The&#160;IIF&#160;function&#160;(Immediate&#160;If)&#160;and the&#160;Choose&#160;function&#160;both return an argument&#160;based on the&#160;value&#160;of the&#160;<br/>first&#160;argument.&#160;The&#160;IIF&#160;function returns&#160;one&#160;of two values&#160;based on a&#160;conditional&#160;expression.&#160;This&#160;works&#160;as&#160;a<br/>great&#160;one-line&#160;If-Then-Else&#160;statement.<br/>
max_age&#160;=&#160;IIF(johns_age&#160;&gt;&#160;bills_age,&#160;johns_age,&#160;bills_age)<br/>
The&#160;IIF&#160;function&#160;takes&#160;three&#160;arguments.&#160;The&#160;first&#160;argument&#160;is&#160;a&#160;Boolean value,&#160;which determines&#160;what&#160;<br/>argument&#160;to return;&#160;one&#160;of the&#160;next&#160;two arguments&#160;is&#160;returne<a href="libremacros.html#206">d.&#160;Listing&#160;176&#160;s</a>hows&#160;how&#160;you&#160;can write&#160;the&#160;IIF&#160;<br/>function yourself.<br/>
<i><b>Listing&#160;176.</b>&#160;The&#160;IIF&#160;function,&#160;if&#160;you wrote&#160;it&#160;yourself.<br/></i>Function&#160;myIIF(conditional,&#160;true_arg,&#160;false_arg)&#160;As&#160;Variant<br/>&#160;&#160;If&#160;CBool(conditional)&#160;Then<br/>&#160; &#160;&#160;myIIF&#160;=&#160;true_arg<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;myIIF&#160;=&#160;false_arg<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
All&#160;arguments&#160;to&#160;a&#160;routine&#160;are&#160;evaluated&#160;before&#160;the&#160;routine&#160;is&#160;called. Because&#160;IIF&#160;is&#160;a&#160;function,&#160;all&#160;arguments&#160;<br/>are&#160;evaluated when the&#160;function&#160;runs.&#160;With&#160;an If&#160;statement, the&#160;conditional&#160;code&#160;runs&#160;only&#160;if necessary.&#160;Se<a href="libremacros.html#206">e<br/>Listing 177.</a><br/>
<i><b>Listing&#160;177.</b>&#160;If&#160;the&#160;denominator&#160;is&#160;zero, the&#160;division does&#160;not&#160;occur.<br/></i>If&#160;denominator&#160;&lt;&gt;&#160;0&#160;Then<br/>&#160;&#160;result&#160;=&#160;numerator&#160;/&#160;denominator<br/>else<br/>&#160;&#160;result&#160;=&#160;0<br/>End&#160;If<br/>
In<a href="libremacros.html#206">&#160;Listing 177,</a>&#160;if the&#160;denominator is&#160;zero, the&#160;division is&#160;not&#160;done&#160;and zero is&#160;returned instead.&#160;In&#160;case&#160;your&#160;<br/>mathematical&#160;skills&#160;are&#160;a&#160;little&#160;rusty,&#160;it&#160;is&#160;not&#160;valid&#160;to&#160;divide&#160;a&#160;number by&#160;zero;&#160;a&#160;run-time&#160;error occurs. On&#160;<br/>the&#160;other hand, if your&#160;mathematical&#160;skills&#160;are&#160;not&#160;rusty,&#160;you know&#160;that&#160;returning zero when the&#160;denominator<br/>is&#160;zero&#160;isn’t&#160;really&#160;correct,&#160;either.&#160;The&#160;macro in<a href="libremacros.html#206">&#160;Listing 178&#160;de</a>monstrates&#160;that&#160;the&#160;functions&#160;f1 and f2 are&#160;<br/>both called, even though only&#160;the&#160;value&#160;from&#160;f2 is&#160;returned. In&#160;other words, IIF(x &lt;&gt;&#160;0, 1/x, 0) causes&#160;a&#160;<br/>division-by-zero error if x&#160;is&#160;zero.<br/>
<i><b>Listing&#160;178.</b>&#160;All&#160;IIF&#160;arguments&#160;are&#160;called.<br/></i>Sub&#160;ExampleIIF<br/>&#160;&#160;REM This demonstrates that ALL expressions are evaluated<br/>&#160;&#160;REM This prints<br/>&#160;&#160;REM &#34;I am in function f1&#34;<br/>&#160;&#160;REM &#34;I am in function f2&#34;<br/>&#160;&#160;REM &#34;f2&#34;<br/>&#160;&#160;Print&#160;IIF(1&gt;2,&#160;f1(),&#160;f2())<br/>End&#160;Sub<br/>Function&#160;f1$<br/>&#160;&#160;Print&#160;&#34;I am in function f1&#34;<br/>&#160;&#160;f1&#160;=&#160;&#34;f1&#34;<br/>End&#160;Function<br/>Function&#160;f2$<br/>&#160;&#160;Print&#160;&#34;I am in function f2&#34;<br/>&#160;&#160;f2&#160;=&#160;&#34;f2&#34;<br/>
203<br/>
<hr/>
<a name=207></a>End&#160;Function<br/>
The&#160;Choose&#160;function is&#160;similar to&#160;the&#160;IIF&#160;function in&#160;that&#160;it&#160;returns&#160;an argument&#160;based on the&#160;value&#160;in&#160;the&#160;<br/>first&#160;argument.&#160;However,&#160;it&#160;differs&#160;because&#160;it&#160;can have&#160;more&#160;than&#160;two possible&#160;return values, and the&#160;first&#160;<br/>argument&#160;is&#160;an integer,&#160;rather than a&#160;Boolean, that&#160;indicates&#160;which of those&#160;possibly&#160;many&#160;arguments&#160;to&#160;<br/>return.&#160;<br/>
Choose&#160;(expression,&#160;Select_1[,&#160;Select_2,&#160;...&#160;[,Select_n]])&#160;<br/>
The&#160;Choose&#160;statement&#160;returns&#160;a&#160;null&#160;if the&#160;expression&#160;is&#160;less&#160;than&#160;1 or greater than&#160;the&#160;number of selection&#160;<br/>arguments. Choose&#160;returns&#160;Select_1&#160;if the&#160;expression&#160;evaluates&#160;to&#160;1 and Select_2 if the&#160;expression evaluates&#160;<br/>to 2.&#160;The&#160;result&#160;is&#160;similar to&#160;storing&#160;the&#160;selections&#160;in an array&#160;with&#160;a&#160;lower bound of 1 and then&#160;indexing into&#160;<br/>the&#160;array.&#160;Each argument&#160;is&#160;evaluated&#160;regardless&#160;of which&#160;one&#160;is&#160;returned. See<a href="libremacros.html#207">&#160;Listing 179.</a><br/>
<i><b>Listing&#160;179.</b>&#160;Demonstrate&#160;the&#160;Choose&#160;statement.<br/></i>Sub&#160;ExampleChoose<br/>&#160;&#160;Dim&#160;i%,&#160;v<br/>&#160;&#160;i%&#160;=&#160;CStr(InputBox(&#34;Enter an integer 1–4 (negative number is an error)&#34;))<br/>&#160;&#160;v&#160;=&#160;Choose(i,&#160;&#34;one&#34;,&#160;&#34;two&#34;,&#160;&#34;three&#34;,&#160;&#34;four&#34;)<br/>&#160;&#160;If&#160;IsNull(v)&#160;Then&#160;<br/>&#160; &#160;&#160;Print&#160;&#34;V is null&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;Print&#160;CStr(v)<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
<b>&#160;9.2.2.&#160;Pause&#160;or&#160;end&#160;the&#160;macro<br/></b>The&#160;Stop&#160;command causes&#160;the&#160;macro to stop&#160;running.&#160;That’s&#160;it, it&#160;is&#160;done, finished!&#160;You must&#160;start&#160;again.&#160;<br/>The&#160;Wait&#160;statement, on the&#160;other hand, only&#160;pauses&#160;macro execution (see<a href="libremacros.html#207">&#160;Listing&#160;180).&#160;</a>After the&#160;specified&#160;<br/>number of milliseconds, the&#160;macro starts&#160;running again.&#160;A&#160;run-time&#160;error occurs&#160;if&#160;the&#160;number of&#160;<br/>milliseconds&#160;to&#160;wait&#160;is&#160;negative.<br/>
<i><b>Listing&#160;180.</b>&#160;Demonstrate&#160;the&#160;wait&#160;function.</i><br/>
Sub&#160;ExampleWait<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;BadInput<br/>&#160;&#160;Dim&#160;nMillis&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;nStart&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;nEnd&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;nElapsed&#160;As&#160;Long<br/>&#160;&#160;nMillis&#160;=&#160;CLng(InputBox(&#34;How many milliseconds to wait?&#34;))<br/>&#160;&#160;nStart&#160;=&#160;GetSystemTicks()<br/>&#160;&#160;Wait(nMillis)<br/>&#160;&#160;nEnd&#160;=&#160;GetSystemTicks()<br/>&#160;&#160;nElapsed&#160;=&#160;nEnd&#160;-&#160;nStart<br/>&#160;&#160;MsgBox&#160;&#34;You requested to wait for &#34;&#160;&amp;&#160;nMillis&#160;&amp;&#160;&#34; milliseconds&#34;&#160;&amp;_<br/>&#160; &#160; &#160;CHR$(10)&#160;&amp;&#160;&#34;Waited for &#34;&#160;&amp;&#160;nElapsed&#160;&amp;&#160;&#34; milliseconds&#34;,&#160;0,&#160;&#34;Example Wait&#34;<br/>BadInput:<br/>&#160;&#160;If&#160;Err&#160;&lt;&gt;&#160;0&#160;Then<br/>&#160; &#160;&#160;Print&#160;Error()&#160;&amp;&#160;&#34; at line &#34;&#160;&amp;&#160;Erl<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;0<br/>End&#160;Sub<br/>
204<br/>
<hr/>
<a name=208></a>In&#160;all&#160;of my&#160;experiments, the&#160;Wait&#160;statement&#160;has&#160;been accurate.&#160;The&#160;macro waits&#160;and then&#160;starts&#160;when it&#160;<br/>should. In&#160;previous&#160;versions&#160;of OOo, the&#160;Wait&#160;statement&#160;was&#160;inefficient&#160;and it&#160;used a&#160;lot&#160;of CPU&#160;time&#160;while&#160;<br/>running.&#160;This&#160;problem&#160;has&#160;been fixed&#160;in&#160;the&#160;current&#160;versions&#160;of OOo.<br/>
WaitUntil&#160;is&#160;new&#160;and provides&#160;more&#160;compatibility&#160;with&#160;VB.&#160;The&#160;following code&#160;waits&#160;two seconds.<br/>
WaitUntil&#160;Now&#160;+&#160;TimeValue(&#34;00:00:02&#34;)&#160;<br/>
<b>&#160;9.2.3.&#160;Dynamic&#160;Link&#160;Libraries<br/></b>While&#160;a&#160;macro runs, it&#160;may&#160;directly&#160;call&#160;numerous&#160;subroutines&#160;and functions.&#160;A&#160;macro can also call&#160;routines&#160;<br/>and applications&#160;that&#160;are&#160;not&#160;related to&#160;OpenOffice.org.&#160;A&#160;Dynamic&#160;Link Library&#160;(DLL)&#160;is&#160;a&#160;collection of&#160;<br/>routines, or programs, that&#160;can be&#160;called when required. Each DLL&#160;is&#160;packaged into a&#160;single&#160;file&#160;with&#160;the&#160;<br/>extension&#160;DLL&#160;—&#160;the&#160;file&#160;does&#160;not&#160;always&#160;have&#160;the&#160;suffix&#160;“.dll”, but&#160;it&#160;usually&#160;does.&#160;There&#160;are&#160;two very&#160;nice&#160;<br/>things&#160;about&#160;DLL&#160;files:&#160;Many&#160;programs&#160;can share&#160;a&#160;single&#160;DLL,&#160;and they&#160;are&#160;not&#160;usually&#160;loaded into&#160;<br/>memory&#160;until&#160;they&#160;are&#160;needed.&#160;The&#160;usage&#160;of DLLs&#160;promotes&#160;code&#160;reuse&#160;and does&#160;not&#160;waste&#160;memory.&#160;To&#160;tell&#160;<br/>OOo Basic&#160;about&#160;a&#160;routine&#160;in a&#160;DLL, use&#160;the&#160;Declare&#160;statement.<br/>
<b>TIP</b><br/>
DLLs are&#160;not&#160;supported on Linux.<br/>
Declare&#160;Sub&#160;Name&#160;Lib&#160;&#34;LibName&#34;&#160;(arguments)<br/>Declare&#160;Function&#160;Name&#160;Lib&#160;&#34;LibName&#34;&#160;(arguments)&#160;As&#160;Type<br/>
LibName&#160;is&#160;the&#160;name&#160;of the&#160;DLL&#160;that&#160;contains&#160;the&#160;routine&#160;named&#160;Name. It&#160;is&#160;common&#160;to use&#160;a&#160;DLL&#160;that&#160;you<br/>did not&#160;write, so you&#160;often have&#160;no control&#160;over the&#160;name&#160;of the&#160;routine&#160;that&#160;you&#160;call. Naming&#160;can be&#160;a&#160;<br/>problem&#160;if&#160;your macro already&#160;contains&#160;a&#160;routine&#160;with&#160;the&#160;same&#160;name&#160;or if you call&#160;another routine&#160;by&#160;the&#160;<br/>same&#160;name&#160;in&#160;another DLL.&#160;As&#160;a&#160;result,&#160;the&#160;Declare&#160;statement&#160;supports&#160;the&#160;Alias&#160;keyword, which&#160;you&#160;can&#160;<br/>use&#160;to&#160;overcome&#160;this&#160;hurdle.&#160;In&#160;this&#160;case, the&#160;RealName&#160;is&#160;the&#160;name&#160;used by&#160;the&#160;DLL, and myName&#160;is&#160;the&#160;<br/>name&#160;used by&#160;your macro.<br/>
Declare&#160;Sub&#160;myName&#160;Lib&#160;&#34;LibName&#34;&#160;Alias&#160;&#34;RealName&#34;&#160;(arguments)<br/>Declare&#160;Function&#160;myName&#160;Lib&#160;&#34;Libname&#34;&#160;Alias&#160;&#34;RealName&#34;&#160;(arguments)&#160;As&#160;Type<br/>
For&#160;functions,&#160;the&#160;type&#160;declaration&#160;should&#160;use&#160;the&#160;standard types.&#160;You must,&#160;of course, know&#160;the&#160;type&#160;so that&#160;<br/>you&#160;can declare&#160;it.&#160;The&#160;argument&#160;list&#160;contains&#160;the&#160;arguments&#160;that&#160;are&#160;passed to&#160;the&#160;external&#160;routine.&#160;You must<br/>use&#160;the&#160;keyword ByVal&#160;if an argument&#160;is&#160;passed by&#160;value&#160;rather than&#160;by&#160;reference<a href="libremacros.html#208">.&#160;Listing 181&#160;c</a>alls&#160;a&#160;DLL.<br/>
<b>TIP</b><br/>
By&#160;default&#160;OOo&#160;Basic&#160;passes arguments by&#160;reference.&#160;This means&#160;that&#160;if&#160;the&#160;called&#160;subroutine&#160;changes the&#160;<br/>
argument, it&#160;is&#160;also&#160;changed&#160;in the&#160;calling&#160;program.&#160;The&#160;ByVal&#160;keyword&#160;causes&#160;an argument&#160;to&#160;be&#160;passed&#160;<br/>by&#160;value&#160;rather&#160;than by&#160;reference.<br/>
<i><b>Listing&#160;181.</b>&#160;Call&#160;a DLL. This&#160;will&#160;only&#160;work&#160;on windows&#160;(and if&#160;the&#160;DLL&#160;is&#160;present).<br/></i>Declare&#160;Sub&#160;MyMessageBeep&#160;Lib&#160;&#34;user32.dll&#34;&#160;Alias&#160;&#34;MessageBeep&#34;&#160;(&#160;Long&#160;)<br/>Declare&#160;Function&#160;CharUpper&#160;Lib&#160;&#34;user32.dll&#34;&#160;Alias&#160;&#34;CharUpperA&#34;_<br/>&#160; &#160;(ByVal&#160;lpsz&#160;As&#160;String)&#160;As&#160;String<br/>
Sub&#160;ExampleCallDLL<br/>&#160;&#160;REM Convert a string to uppercase<br/>&#160;&#160;Dim&#160;strIn&#160;As&#160;String<br/>&#160;&#160;Dim&#160;strOut&#160;As&#160;String<br/>&#160;&#160;strIn&#160;&#160;=&#160;&#34;i Have Upper and Lower&#34;<br/>&#160;&#160;strOut&#160;=&#160;CharUpper(strIn)<br/>&#160;&#160;MsgBox&#160;&#34;Converted:&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;strIn&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>
205<br/>
<hr/>
<a name=209></a>&#160; &#160; &#160; &#160; &#160;&#34;To:&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;strOut,&#160;0,&#160;&#34;Call a DLL Function&#34;<br/>&#160;&#160;REM On my computer, this plays a system sound<br/>&#160;&#160;Dim&#160;nBeepLen&#160;As&#160;Long<br/>&#160;&#160;nBeepLen&#160;=&#160;5000<br/>&#160;&#160;MyMessageBeep(nBeepLen)<br/>&#160;&#160;FreeLibrary(&#34;user32.dll&#34;&#160;)<br/>End&#160;Sub<br/>
A&#160;DLL&#160;is&#160;not&#160;loaded until&#160;a&#160;routine&#160;in the&#160;DLL&#160;is&#160;called.&#160;To&#160;remove&#160;the&#160;DLL&#160;from&#160;memory,&#160;use&#160;the&#160;<br/>FreeLibrary&#160;statement.&#160;The&#160;FreeLibrary&#160;statement&#160;accepts&#160;one&#160;argument:&#160;the&#160;name&#160;of the&#160;DLL&#160;to&#160;unload.<br/>
<b>&#160;9.2.4.&#160;Calling&#160;external&#160;applications<br/></b>Use&#160;the&#160;Shell&#160;statement&#160;to&#160;run an external&#160;application.&#160;The&#160;Shell&#160;command&#160;is&#160;disabled&#160;for users&#160;connecting&#160;<br/>by&#160;a&#160;virtual&#160;portal&#160;unless&#160;they&#160;happen to&#160;be&#160;the&#160;same&#160;user that&#160;started OOo in&#160;the&#160;first&#160;place.&#160;This&#160;statement&#160;<br/>does&#160;not&#160;obtain&#160;any&#160;information&#160;from&#160;an application;&#160;it&#160;simply&#160;runs&#160;another application&#160;or command.<br/>
Shell(Pathname,&#160;Windowstyle,&#160;Param,&#160;bSync)<br/>
<b>TIP</b><br/>
The&#160;Shell&#160;command is&#160;a&#160;potential&#160;security&#160;hole.<br/>
The&#160;only&#160;required argument&#160;is&#160;the&#160;first;&#160;the&#160;rest&#160;are&#160;optional.&#160;The&#160;first&#160;argument&#160;is&#160;the&#160;full&#160;path name&#160;of the&#160;<br/>external&#160;application.&#160;The&#160;application path&#160;may&#160;be&#160;in&#160;URL&#160;notation, but&#160;need not&#160;be.&#160;The&#160;Shell&#160;statement&#160;has&#160;<br/>problems&#160;if the&#160;path or application&#160;name&#160;contains&#160;a&#160;space.&#160;You can solve&#160;this&#160;problem&#160;the&#160;same&#160;way&#160;that&#160;<br/>your&#160;Web&#160;browser solves&#160;it:&#160;Substitute&#160;“%20”&#160;for each space.&#160;The&#160;ASCII&#160;value&#160;of a&#160;space&#160;is&#160;32, which&#160;is&#160;20&#160;<br/>in hexadecimal.&#160;This&#160;technique&#160;can also be&#160;used to&#160;substitute&#160;other characters&#160;if&#160;they&#160;cause&#160;you&#160;problems.<br/>
Shell(&#34;file:///C|/Andy/My%20Documents/oo/tmp/h.bat&#34;,2)&#160;'URL notation uses /<br/>Shell(&#34;C:\Andy\My%20Documents\oo\tmp\h.bat&#34;,2)&#160;&#160;'Windows notation uses \<br/>
The&#160;second argument&#160;(optional) indicates&#160;the&#160;window&#160;style&#160;of the&#160;started application.<a href="libremacros.html#209">&#160;Table&#160;77&#160;l</a>ists&#160;valid&#160;<br/>values&#160;for the&#160;Shell&#160;window&#160;style&#160;argument.<br/>
<i><b>Table&#160;77.</b>&#160;Window styles&#160;for&#160;the&#160;Shell&#160;statement.</i><br/>
<i><b>Style</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
Focus is&#160;on the&#160;hidden program&#160;window.<br/>
1<br/>
Focus is&#160;on the&#160;program&#160;window&#160;in standard size.<br/>
2<br/>
Focus is&#160;on the&#160;minimized&#160;program&#160;window.<br/>
3<br/>
Focus is&#160;on the&#160;maximized&#160;program&#160;window.<br/>
4<br/>
Standard&#160;size&#160;program&#160;window,&#160;without&#160;focus.<br/>
6<br/>
Minimized&#160;program&#160;window,&#160;but&#160;focus remains on the&#160;active&#160;window.<br/>
10<br/>
Full-screen display.<br/>
The&#160;third&#160;argument&#160;(optional) is&#160;a&#160;string that&#160;is&#160;passed to&#160;the&#160;application. Each space&#160;in&#160;the&#160;argument&#160;string&#160;<br/>is&#160;read by&#160;the&#160;called&#160;application&#160;as&#160;delimiting&#160;a&#160;separate&#160;argument.&#160;To&#160;pass&#160;an argument&#160;with&#160;an embedded&#160;<br/>space, place&#160;an extra&#160;set&#160;of double&#160;quotation&#160;marks&#160;around the&#160;arguments.<br/>
Shell(&#34;/home/andy/foo.ksh&#34;,&#160;10,&#160;&#34;&#34;&#34;one argument&#34;&#34; another&#34;)&#160;&#160;' two arguments<br/>
<b>TIP</b><br/>
The&#160;string&#160;&#34;&#34;&#34;one&#160;argument&#34;&#34;&#160;another&#34;&#160;is correct&#160;and&#160;as intended;&#160;think about&#160;it!<br/>
206<br/>
<hr/>
<a name=210></a>The&#160;final&#160;optional&#160;argument&#160;determines&#160;if&#160;the&#160;Shell&#160;command returns&#160;immediately&#160;while&#160;the&#160;application is&#160;<br/>running (the&#160;default&#160;behavior) or if it&#160;waits&#160;until&#160;the&#160;application&#160;is&#160;finished.&#160;Setting the&#160;final&#160;argument&#160;to&#160;<br/>True&#160;causes&#160;the&#160;Shell&#160;statement&#160;to wait.<br/>
Sub&#160;ExampleShell<br/>&#160;&#160;Dim&#160;rc&#160;As&#160;Long<br/>&#160;&#160;rc&#160;=&#160;Shell(&#34;C:\andy\TSEProWin\g32.exe&#34;,&#160;2,&#160;&#34;c:\Macro.txt&#34;)<br/>&#160;&#160;Print&#160;&#34;I just returned and the returned code is &#34;&#160;&amp;&#160;rc&#160;&#160;' rc = 0<br/>&#160;&#160;Rem These two have spaces in their names<br/>&#160;&#160;Shell(&#34;file:///C|/Andy/My%20Documents/oo/tmp/h.bat&#34;,2)<br/>&#160;&#160;Shell(&#34;C:\Andy\My%20Documents\oo\tmp\h.bat&#34;,2)<br/>End&#160;Sub<br/>
The&#160;Shell&#160;function&#160;returns&#160;a&#160;long with&#160;the&#160;value&#160;zero. If&#160;the&#160;program&#160;does&#160;not&#160;exist,&#160;a&#160;run-time&#160;error occurs&#160;<br/>and nothing is&#160;returned.&#160;When&#160;some&#160;applications&#160;run, they&#160;return&#160;a&#160;value&#160;that&#160;can be&#160;used to indicate&#160;an&#160;<br/>error.&#160;This&#160;value&#160;is&#160;not&#160;available&#160;from&#160;the&#160;Shell&#160;command.&#160;Intuitively,&#160;it&#160;isn’t&#160;possible&#160;to&#160;obtain&#160;the&#160;final&#160;<br/>return value&#160;from&#160;an application&#160;when the&#160;Shell&#160;function returns&#160;before&#160;the&#160;application&#160;is&#160;finished&#160;running.<br/>
<b>TIP</b><br/>
In&#160;Visual&#160;Basic,&#160;the&#160;arguments for&#160;the&#160;Shell&#160;function are&#160;different:&#160;Shell(path, window_style,&#160;bsync,&#160;<br/>Timeout).&#160;The&#160;Timeout&#160;value&#160;indicates&#160;how&#160;long&#160;to wait&#160;for&#160;the&#160;external&#160;application to finish.&#160;Arguments&#160;<br/>
follow&#160;the&#160;application&#160;name&#160;as part&#160;of&#160;the&#160;same&#160;string, delimited&#160;by&#160;spaces.<br/>
VB&#160;does&#160;not&#160;use&#160;a&#160;separate&#160;argument&#160;to&#160;specify&#160;the&#160;arguments&#160;to send to the&#160;application&#160;launched by&#160;the&#160;<br/>Shell&#160;command.&#160;Instead, the&#160;arguments&#160;follow&#160;the&#160;name&#160;of the&#160;application,&#160;separated&#160;by&#160;spaces, inside&#160;the&#160;<br/>same&#160;quotation marks&#160;that&#160;contain&#160;the&#160;function&#160;path and name.&#160;This&#160;method&#160;also works&#160;with OOo Basic, as&#160;<br/>an alternative&#160;way&#160;to&#160;specify&#160;the&#160;Shell&#160;command arguments. If&#160;only&#160;function, arguments, and window&#160;style&#160;<br/>are&#160;required, this&#160;alternative&#160;way&#160;to&#160;write&#160;the&#160;Shell&#160;command allows&#160;you to have&#160;identical&#160;statements&#160;for&#160;VB<br/>or OOo routines.&#160;If&#160;you want&#160;to specify&#160;bsync&#160;or&#160;Timeout&#160;arguments, the&#160;VB and OOo environments&#160;are&#160;not&#160;<br/>compatible.<br/>
Shell(&#34;/home/andy/foo.ksh hello you&#34;)&#160;&#160;' two arguments, &#34;hello&#34; and &#34;you&#34;<br/>
<b>&#160;9.2.5.&#160;Dynamic&#160;Data&#160;Exchange<br/></b>Dynamic&#160;Data&#160;Exchange&#160;(DDE) is&#160;a&#160;mechanism&#160;that&#160;allows&#160;information&#160;to be&#160;shared between programs.&#160;<br/>Data&#160;may&#160;be&#160;updated in&#160;real&#160;time&#160;or it&#160;may&#160;work as&#160;a&#160;request&#160;response.&#160;<br/>
Although the&#160;DDE&#160;commands&#160;accepted&#160;by&#160;a&#160;DDE&#160;server are&#160;specific&#160;to the&#160;individual&#160;server,&#160;the&#160;general&#160;<br/>syntax&#160;is&#160;the&#160;same. Most&#160;DDE&#160;commands&#160;require&#160;a&#160;Server,&#160;Topic, and Item.&#160;The&#160;Server is&#160;the&#160;DDE&#160;name&#160;for<br/>the&#160;application&#160;that&#160;contains&#160;the&#160;data.&#160;The&#160;Topic, usually&#160;a&#160;file&#160;name, contains&#160;the&#160;location&#160;of the&#160;referenced&#160;<br/>Item.&#160;The&#160;example&#160;in<a href="libremacros.html#210">&#160;Listing 182&#160;us</a>es&#160;the&#160;DDE&#160;function in&#160;a&#160;Calc&#160;spreadsheet&#160;to&#160;extract&#160;data&#160;in&#160;cell&#160;A1&#160;<br/>from&#160;an Excel&#160;spreadsheet.&#160;<br/>
<i><b>Listing&#160;182.</b>&#160;Use&#160;DDE&#160;as&#160;a Calc&#160;function&#160;to&#160;extract&#160;cell&#160;A1 from&#160;a document.</i><br/>
=DDE(&#34;soffice&#34;;&#34;/home/andy/tstdoc.xls&#34;;&#34;a1&#34;) 'DDE in Calc to obtain a cell<br/>='file:///home/andy/TST.sxc'#$sheet1.A1 &#160; &#160; &#160;'Direct reference to a cell<br/>
The&#160;second line&#160;shows&#160;how&#160;a&#160;cell&#160;can be&#160;directly&#160;referenced in another Calc&#160;spreadsheet&#160;without&#160;using DDE.<br/>OOo Basic&#160;supports&#160;DDE&#160;commands&#160;directly&#160;(see<a href="libremacros.html#211">&#160;Table&#160;78)</a>.<br/>
207<br/>
<hr/>
<a name=211></a><i><b>Table&#160;78.</b>&#160;DDE&#160;commands&#160;supported&#160;by&#160;OOo Basic.</i><br/>
<i><b>Command</b></i><br/>
<i><b>Description</b></i><br/>
DDEExecute(nDDEChannel,&#160;command)<br/>
Execute&#160;a&#160;DDE&#160;command.<br/>
DDEInitiate(Server,&#160;Topic)<br/>
Open a&#160;DDE channel&#160;and return the&#160;channel&#160;number.<br/>
DDEPoke(nDDEChannel,&#160;item, data)<br/>
Set&#160;data&#160;on the&#160;DDE server.<br/>
DDERequest(nDDEChannel,&#160;item)<br/>
Post&#160;a&#160;DDE request&#160;over&#160;an open&#160;channel.<br/>
DDETerminateAll()<br/>
Close&#160;all&#160;DDE connections.<br/>
First, the&#160;DDEInitiate&#160;function&#160;makes&#160;a&#160;connection&#160;to&#160;the&#160;DDE&#160;server.&#160;The&#160;first&#160;argument&#160;is&#160;the&#160;name&#160;of the&#160;<br/>server&#160;—&#160;for example, “soffice”&#160;or “excel”.&#160;The&#160;second argument&#160;specifies&#160;the&#160;channel&#160;to&#160;use.&#160;A&#160;common&#160;<br/>value&#160;for a&#160;channel&#160;is&#160;a&#160;file&#160;name.&#160;The&#160;opened channel&#160;is&#160;identified by&#160;an integer,&#160;which&#160;is&#160;returned by&#160;the&#160;<br/>DDEInitiate&#160;command.&#160;A&#160;channel&#160;number of 0 indicates&#160;that&#160;the&#160;channel&#160;was&#160;not&#160;opened.&#160;Attempting to&#160;<br/>establish&#160;a&#160;DDE&#160;connection to&#160;OOo for a&#160;file&#160;that&#160;is&#160;not&#160;currently&#160;open returns&#160;0 for the&#160;channel. See<a href="libremacros.html#211">&#160;Listing&#160;<br/>183.</a><br/>
<i><b>Listing&#160;183.</b>&#160;Use&#160;DDE&#160;to access&#160;a Calc&#160;document.<br/></i>Sub&#160;ExampleDDE<br/>&#160;&#160;Dim&#160;nDDEChannel&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;REM OOo must have the file open or the channel will not be opened<br/>&#160;&#160;nDDEChannel&#160;=&#160;DDEInitiate(&#34;soffice&#34;,&#160;&#34;c:\TST.sxc&#34;)<br/>&#160;&#160;If&#160;nDDEChannel&#160;=&#160;0&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;Sorry, failed to open a DDE channel&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;Using channel &#34;&#160;&amp;&#160;nDDEChannel&#160;&amp;&#160;&#34; to request cell A1&#34;<br/>&#160; &#160;&#160;s&#160;=&#160;DDERequest(nDDEChannel,&#160;&#34;A1&#34;)<br/>&#160; &#160;&#160;Print&#160;&#34;Returned &#34;&#160;&amp;&#160;s<br/>&#160; &#160;&#160;DDETerminate(nDDEChannel)<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
&#160;The&#160;usable&#160;commands&#160;and syntax&#160;for each server are&#160;server dependent,&#160;so a&#160;complete&#160;coverage&#160;of DDE&#160;is&#160;<br/>beyond the&#160;scope&#160;of this&#160;book.<br/>
<b>TIP</b><br/>
<a href="libremacros.html#211">Listing&#160;183&#160;r</a>uns&#160;and&#160;returns a&#160;value,&#160;but&#160;it&#160;crashes&#160;OOo when I&#160;run it.<br/>
<i><b>&#160;9.3.&#160;User&#160;input&#160;and&#160;output<br/></b></i>OOo Basic&#160;provides&#160;a&#160;very&#160;simple&#160;mechanism&#160;for presenting information to&#160;the&#160;user and obtaining&#160;<br/>information from&#160;the&#160;user at&#160;run time&#160;(see<a href="libremacros.html#211">&#160;Table&#160;79).&#160;</a>These&#160;routines&#160;aren’t&#160;used to&#160;access&#160;files;&#160;they’re&#160;used&#160;<br/>strictly&#160;for user input&#160;from&#160;the&#160;keyboard and output&#160;to&#160;the&#160;screen.<br/>
<i><b>Table&#160;79.</b>&#160;User&#160;input&#160;and output&#160;functions.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
InputBox(Msg,&#160;Title,&#160;Default, x_pos, y_pos)<br/>
Request&#160;user&#160;input&#160;as a&#160;String.<br/>
MsgBox&#160;(Message,&#160;Type,&#160;Title)<br/>
Display&#160;a&#160;message&#160;in&#160;a&#160;nice&#160;dialog.<br/>
Print&#160;expression1;&#160;expression2, expression3;...<br/>
Print&#160;expressions.<br/>
208<br/>
<hr/>
<a name=212></a><b>&#160;9.3.1.&#160;Simple&#160;output<br/></b>Use&#160;the&#160;Print&#160;statement&#160;for simple, single-line&#160;output.&#160;A&#160;list&#160;of expressions&#160;follows&#160;the&#160;Print&#160;statement. If&#160;<br/>two expressions&#160;are&#160;separated&#160;by&#160;a&#160;semicolon,&#160;the&#160;expressions&#160;are&#160;printed&#160;adjacent&#160;to&#160;each other.&#160;If&#160;two&#160;<br/>expressions&#160;are&#160;separated&#160;by&#160;a&#160;comma,&#160;the&#160;expressions&#160;are&#160;printed with&#160;a&#160;tab between them;&#160;you&#160;cannot&#160;<br/>change&#160;the&#160;size&#160;of the&#160;tabs.<br/>
Print&#160;expression1,&#160;expression2,&#160;...&#160;&#160;' Print with tabs between expressions<br/>Print&#160;expression1;&#160;expression2;&#160;...&#160;&#160;' Print with nothing between expressions<br/>Print&#160;1,Now;&#34;hello&#34;,&#34;again&#34;;34.3&#160; &#160; &#160;' Mixing semicolons and commas is fine<br/>
Arguments&#160;are&#160;converted&#160;to a&#160;locale-specific&#160;string representation&#160;before&#160;they&#160;are&#160;printed. In&#160;other words,&#160;<br/>dates&#160;and numbers&#160;appear as&#160;you&#160;expect&#160;based on the&#160;locale&#160;set&#160;in&#160;your configuration (Tools&#160;|&#160;Options&#160;|&#160;<br/>Language&#160;Settings&#160;|&#160;Languages). Boolean values, however,&#160;always&#160;print&#160;the&#160;text&#160;True&#160;or False.<br/>
The&#160;help included with&#160;OOo lists&#160;two special&#160;expressions&#160;that&#160;work with the&#160;Print&#160;statement:&#160;Spc&#160;and&#160;Tab.&#160;<br/>In&#160;OOo Basic, the&#160;Spc&#160;function&#160;works&#160;the&#160;same&#160;as&#160;the&#160;Space&#160;function. It&#160;accepts&#160;one&#160;numeric&#160;argument&#160;and&#160;<br/>returns&#160;a&#160;string&#160;composed completely&#160;of spaces.&#160;The&#160;Tab function, although documented,&#160;does&#160;not&#160;exist.&#160;Se<a href="libremacros.html#212">e<br/>Listing 184&#160;f</a>or a&#160;Print&#160;example.<br/>
<b>TIP</b><br/>
Although the&#160;Tab&#160;function&#160;has been documented&#160;since&#160;OOo version 1,&#160;as of&#160;version 3.2,&#160;the&#160;Tab&#160;function&#160;<br/>
still&#160;does&#160;not&#160;exist&#160;and&#160;it&#160;is still&#160;documented.<br/>
<i><b>Listing&#160;184.</b>&#160;Demonstrate&#160;the&#160;Spc()&#160;function.</i><br/>
Sub&#160;ExamplePrint<br/>&#160;&#160;Print&#160;&#34;It is now&#34;;Spc(12);Now()<br/>End&#160;Sub<br/>
The&#160;Print&#160;statement&#160;is&#160;usually&#160;used for simple, single-line&#160;output&#160;while&#160;debugging, because&#160;it&#160;allows&#160;you to&#160;<br/>stop a&#160;macro from&#160;running by&#160;clicking the&#160;Cancel&#160;button (see<a href="libremacros.html#212">&#160;Figure&#160;66).&#160;</a>This&#160;is&#160;a&#160;great&#160;tool&#160;for debugging.&#160;<br/>Place&#160;a&#160;Print&#160;statement&#160;before&#160;or after lines&#160;that&#160;may&#160;cause&#160;a&#160;problem. If&#160;the&#160;values&#160;don’t&#160;appear to&#160;be&#160;<br/>correct,&#160;you&#160;can click&#160;the&#160;Cancel&#160;button&#160;to stop&#160;the&#160;macro.&#160;<br/>
<b>TIP</b><br/>
The&#160;print&#160;statement&#160;is nice&#160;because&#160;you&#160;can cause&#160;a&#160;macro&#160;to stop running&#160;by&#160;clicking&#160;Cancel.&#160;An&#160;<br/>advantage, and&#160;a&#160;disadvantage,&#160;however,&#160;is that&#160;it&#160;leaves the&#160;user&#160;in the&#160;IDE&#160;at&#160;the&#160;print&#160;statement.<br/>
<i><b>Figure&#160;66.</b>&#160;The&#160;Spc&#160;function returns&#160;a string&#160;with&#160;spaces.</i><br/>
When&#160;using many&#160;Print&#160;statements&#160;for debugging purposes, print&#160;explanatory&#160;information&#160;with&#160;the&#160;data&#160;to&#160;<br/>remind yourself what&#160;it&#160;is.<br/>
Print&#160;&#34;Before the loop, x= &#34;;x<br/>For&#160;i=0&#160;To&#160;10<br/>&#160;&#160;Print&#160;&#34;In the loop, i = &#34;;i;&#34; and x = &#34;;x<br/>
When&#160;you&#160;print&#160;a&#160;string that&#160;contains&#160;a&#160;new-line&#160;character (ASCII&#160;10 or 13), a&#160;new&#160;dialog is&#160;displayed&#160;for&#160;<br/>each new&#160;line.&#160;The&#160;code&#160;i<a href="libremacros.html#213">n&#160;Listing&#160;185&#160;di</a>splays&#160;three&#160;consecutive&#160;dialogs&#160;with text&#160;that&#160;reads&#160;“one”, “two”,&#160;<br/>and “three”.&#160;The&#160;Print&#160;dialog&#160;is&#160;able&#160;to&#160;print&#160;using more&#160;than one&#160;line.&#160;If&#160;a&#160;single&#160;line&#160;of text&#160;becomes&#160;too&#160;<br/>
209<br/>
<hr/>
<a name=213></a>long, the&#160;line&#160;wraps&#160;and appears&#160;on more&#160;than one&#160;line. In&#160;other words, although Print&#160;will&#160;wrap by&#160;itself,&#160;<br/>the&#160;user has&#160;no way&#160;to force&#160;a&#160;new&#160;line&#160;in&#160;the&#160;dialog.<br/>
<i><b>Listing&#160;185.</b>&#160;New lines&#160;print&#160;in&#160;their&#160;own dialog.<br/></i>Print&#160;&#34;one&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;two&#34;&#160;&amp;&#160;CHR$(13)&#160;&amp;&#160;&#34;three&#34;&#160;&#160;' Displays three dialogs<br/>
The&#160;Print&#160;statement&#160;uses&#160;a&#160;simple, defined&#160;protocol&#160;for numeric&#160;formatting. Positive&#160;numeric&#160;expressions&#160;<br/>contain&#160;a&#160;leading space. Negative&#160;numeric&#160;expressions&#160;contain&#160;a&#160;leading minus&#160;sign. Numbers&#160;with&#160;a&#160;<br/>decimal&#160;are&#160;printed&#160;in exponential&#160;notation if&#160;they&#160;become&#160;too&#160;large.<br/>
The&#160;Print&#160;statement&#160;displays&#160;a&#160;print&#160;dialog each time,&#160;unless&#160;the&#160;statement&#160;ends&#160;with&#160;either a&#160;semicolon or a&#160;<br/>comma.&#160;In&#160;this&#160;case&#160;it&#160;stores&#160;the&#160;text&#160;from&#160;each Print&#160;statement&#160;and adds&#160;to it&#160;until&#160;it&#160;encounters&#160;a&#160;Print&#160;<br/>statement&#160;that&#160;doesn’t&#160;end with a&#160;semicolon or a&#160;comma.<br/>
Print&#160;&#34;one&#34;,&#160;&#160;'Do not print yet, ends with a comma<br/>Print&#160;&#34;two&#34;&#160; &#160;'Print &#34;one &#160; &#160;two&#34;<br/>Print&#160;&#34;three&#34;,'Do not print yet, ends with a comma<br/>Print&#160;&#34;four&#34;;&#160;'Do not print yet, ends with a semicolon<br/>Print&#160; &#160; &#160; &#160; &#160;'Print &#34;three &#160; &#160;four&#34;<br/>
<b>&#160;9.3.2.&#160;Multi-line&#160;output<br/></b>The&#160;MsgBox&#160;statement&#160;provides&#160;more&#160;control&#160;over the&#160;dialog that&#160;is&#160;displayed than does&#160;the&#160;Print&#160;statement,<br/>but&#160;can print&#160;only&#160;one&#160;string expression&#160;at&#160;a&#160;time. String expressions&#160;that&#160;contain a&#160;new-line&#160;character&#160;<br/>(ASCII&#160;10 or 13) are&#160;printed&#160;in the&#160;same&#160;dialog. Each new-line&#160;character starts&#160;a&#160;new&#160;line&#160;in&#160;the&#160;dialog.<br/>
<i><b>Listing&#160;186.</b>&#160;Display&#160;a simple&#160;message&#160;box&#160;with a new line.<br/></i>Sub&#160;ExampleMsgBoxWithReturn<br/>&#160;&#160;MsgBox&#160;&#34;one&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;two&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;67.</b>&#160;This&#160;simple&#160;MsgBox&#160;dialog&#160;contains&#160;only&#160;an OK button.</i><br/>
The&#160;dialog i<a href="libremacros.html#213">n&#160;Figure&#160;67&#160;i</a>s&#160;very&#160;simple.&#160;The&#160;MsgBox function&#160;accepts&#160;two new&#160;arguments, as&#160;shown i<a href="libremacros.html#213">n<br/>Listing 187.&#160;</a>The&#160;DialogTitle&#160;is&#160;displayed as&#160;the&#160;title&#160;line&#160;of the&#160;dialog.&#160;Valid&#160;values&#160;for DialogType&#160;are&#160;<br/>shown in<a href="libremacros.html#214">&#160;Table&#160;80.&#160;</a>The&#160;DialogType&#160;determines&#160;which&#160;buttons&#160;are&#160;displayed in&#160;the&#160;dialog, which&#160;button&#160;is&#160;<br/>the&#160;default&#160;button,&#160;and which icon&#160;is&#160;displayed on the&#160;dialog.<br/>
<i><b>Listing&#160;187.</b>&#160;The&#160;MsgBox&#160;function&#160;can accept&#160;a type&#160;and a dialog&#160;title.<br/></i>MsgBox(Message)<br/>MsgBox(Message,&#160;DialogType)<br/>MsgBox(Message,&#160;DialogType,&#160;DialogTitle)<br/>
210<br/>
<hr/>
<a name=214></a><i><b>Table&#160;80.</b>&#160;Valid values&#160;for&#160;DialogType.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
Display&#160;OK&#160;button only.<br/>
1<br/>
Display&#160;OK&#160;and&#160;Cancel&#160;buttons.<br/>
2<br/>
Display&#160;Abort, Retry&#160;and Ignore&#160;buttons.<br/>
3<br/>
Display&#160;Yes, No,&#160;and Cancel&#160;buttons.<br/>
4<br/>
Display&#160;Yes and No&#160;buttons.<br/>
5<br/>
Display&#160;Retry&#160;and Cancel&#160;buttons.<br/>
16<br/>
Add&#160;the&#160;Stop&#160;icon&#160;to the&#160;dialog.<br/>
32<br/>
Add&#160;the&#160;Question icon to the&#160;dialog.<br/>
48<br/>
Add&#160;the&#160;Exclamation Point&#160;icon to the&#160;dialog.<br/>
64<br/>
Add&#160;the&#160;Information icon to the&#160;dialog.<br/>
128<br/>
First&#160;button in the&#160;dialog is&#160;the&#160;default&#160;button.&#160;This is&#160;the&#160;default&#160;behavior.<br/>
256<br/>
Second&#160;button&#160;in&#160;the&#160;dialog is the&#160;default&#160;button.<br/>
512<br/>
Third&#160;button in the&#160;dialog is the&#160;default&#160;button.<br/>
<i><b>Listing&#160;188.</b>&#160;Demonstrate&#160;the&#160;MsgBox&#160;type&#160;behavior.<br/></i>Sub&#160;MsgBoxExamples()<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;values<br/>&#160;&#160;values&#160;=&#160;Array(0,&#160;1,&#160;2,&#160;3,&#160;4,&#160;5)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(values)&#160;To&#160;UBound(values)<br/>&#160; &#160;&#160;MsgBox&#160;(&#34;Dialog Type: &#34;&#160;+&#160;values(i),&#160;values(i))<br/>&#160;&#160;Next<br/>&#160;&#160;values&#160;=&#160;Array(16,&#160;32,&#160;48,&#160;64,&#160;128,&#160;256,&#160;512)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(values)&#160;To&#160;UBound(values)<br/>&#160; &#160;&#160;MsgBox&#160;(&#34;Yes, No, Cancel, with Type: &#34;&#160;+&#160;values(i),&#160;values(i)&#160;+&#160;3)<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
You can use&#160;more&#160;than&#160;one&#160;DialogType&#160;at&#160;the&#160;same&#160;time&#160;to&#160;achieve&#160;your&#160;desired buttons, icon, and default&#160;<br/>behavior.&#160;The&#160;display&#160;choices&#160;are&#160;encoded in the&#160;first&#160;four bits&#160;(values&#160;0-15 are&#160;binary&#160;0000-1111);&#160;the&#160;icons&#160;<br/>and default&#160;behavior are&#160;encoded in&#160;higher bits&#160;(for example, 64 is&#160;01000000 in binary).&#160;To&#160;combine&#160;<br/>attributes, use&#160;OR or add the&#160;values&#160;together.&#160;(This&#160;is&#160;similar&#160;to the&#160;behavior described&#160;for file&#160;attributes.)&#160;<br/>
Although you can display&#160;a&#160;dialog with&#160;a&#160;Cancel&#160;button,&#160;this&#160;won’t&#160;cause&#160;the&#160;macro to stop&#160;running, as&#160;<br/>happens&#160;with&#160;the&#160;Print&#160;statement.&#160;Instead, the&#160;MsgBox&#160;function&#160;returns&#160;an integer that&#160;identifies&#160;the&#160;selected<br/>button&#160;(see<a href="libremacros.html#214">&#160;Table&#160;81)</a>. Clicking the&#160;Cancel&#160;button returns&#160;the&#160;value&#160;2, and the&#160;Abort&#160;button&#160;returns&#160;a&#160;3, which<br/>can then&#160;be&#160;tested by&#160;your code;&#160;then you (in your code) can decide&#160;whether or not&#160;you&#160;really&#160;want&#160;to&#160;cancel&#160;<br/>the&#160;macro.&#160;<br/>
<i><b>Table&#160;81.</b>&#160;Return&#160;values&#160;from&#160;MsgBox.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
1<br/>
OK<br/>
2<br/>
Cancel<br/>
3<br/>
Abort<br/>
211<br/>
<hr/>
<a name=215></a><i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
4<br/>
Retry<br/>
5<br/>
Ignore<br/>
6<br/>
Yes<br/>
7<br/>
No<br/>
In&#160;other words, if you&#160;want&#160;the&#160;macro to&#160;stop when a&#160;user clicks&#160;the&#160;Cancel&#160;button, you must&#160;check the&#160;<br/>return value,&#160;as&#160;demonstrated&#160;i<a href="libremacros.html#215">n&#160;Listing&#160;189.&#160;</a>The&#160;message&#160;contains&#160;a&#160;new-line&#160;character so the&#160;message&#160;<br/>contains&#160;two lines&#160;of text.&#160;The&#160;dialog&#160;type&#160;requests&#160;three&#160;buttons&#160;and an icon, and sets&#160;the&#160;second button to&#160;<br/>be&#160;default&#160;(see<a href="libremacros.html#215">&#160;Figure&#160;68)</a>.&#160;The&#160;macro does&#160;different&#160;things&#160;based on the&#160;selected button.<br/>
<i><b>Listing&#160;189.</b>&#160;Demonstrate&#160;how MsgBox&#160;works.</i><br/>
Sub&#160;ExampleMsgBox<br/>&#160;&#160;Dim&#160;nReturnCode&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;nDialogType&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;sMessage&#160;As&#160;String<br/>&#160;&#160;sMessage&#160;=&#160;&#34;An error occurred!&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;Do the important work anyway?&#34;<br/>&#160;&#160;REM &#160; 3 means Yes, No, Cancel<br/>&#160;&#160;REM &#160;48 displays an Exclamation Point icon<br/>&#160;&#160;REM 256 second button is default.<br/>&#160;&#160;nDialogType&#160;=&#160;3&#160;OR&#160;48&#160;OR&#160;256<br/>&#160;&#160;nReturnCode&#160;=&#160;MsgBox(sMessage,&#160;nDialogType,&#160;&#34;My Title&#34;)<br/>&#160;&#160;If&#160;nReturnCode&#160;=&#160;2&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;Stopping the macro now!&#34;<br/>&#160; &#160;&#160;Stop<br/>&#160;&#160;ElseIf&#160;nReturnCode&#160;=&#160;6&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;You chose Yes&#34;<br/>&#160;&#160;ElseIf&#160;nReturnCode&#160;=&#160;7&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;You chose No&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;I will never get here!&#34;,nReturnCode<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;Print&#160;&#34;Ready to exit the subroutine&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;68.</b>&#160;Fancy&#160;MsgBox&#160;with an icon and multiple&#160;buttons.</i><br/>
<b>&#160;9.3.3.&#160;Prompting&#160;for&#160;input<br/></b>Use&#160;the&#160;InputBox function&#160;to&#160;prompt&#160;users&#160;for input.&#160;You can specify&#160;the&#160;dialog title. If&#160;a&#160;Default&#160;value&#160;is&#160;<br/>provided,&#160;it’s&#160;displayed in&#160;the&#160;input&#160;box.&#160;The&#160;displayed dialog contains&#160;a&#160;text-input&#160;box,&#160;an OK&#160;button, and a<br/>Cancel&#160;button.&#160;The&#160;InputBox&#160;function&#160;returns&#160;a&#160;string&#160;to&#160;the&#160;calling statement. Clicking Cancel&#160;returns&#160;a&#160;<br/>zero-length&#160;string.<br/>
InputBox(Message)<br/>
212<br/>
<hr/>
<a name=216></a>InputBox(Message,&#160;Title)<br/>InputBox(Message,&#160;Title,&#160;Default)<br/>InputBox(Message,&#160;Title,&#160;Default,&#160;x_pos,&#160;y_pos)<br/>
The&#160;position arguments&#160;are&#160;in&#160;twips&#160;and are&#160;relative&#160;to&#160;the&#160;upper-left&#160;corner of the&#160;current&#160;window;&#160;one&#160;inch&#160;<br/>is&#160;1440 twips.&#160;If&#160;the&#160;position is&#160;not&#160;specified, the&#160;dialog is&#160;centered both&#160;horizontally&#160;and vertically&#160;over the&#160;<br/>current&#160;window.&#160;The&#160;example&#160;i<a href="libremacros.html#216">n&#160;Listing&#160;190&#160;di</a>splays&#160;the&#160;input&#160;box&#160;two inches&#160;from&#160;the&#160;left&#160;edge&#160;of the&#160;<br/>window&#160;and four inches&#160;from&#160;the&#160;top.&#160;The&#160;size&#160;of the&#160;InputBox&#160;is&#160;defined automatically&#160;from&#160;the&#160;Message&#160;<br/>and buttons;&#160;OOo configures&#160;the&#160;layout&#160;of this&#160;box,&#160;as&#160;it&#160;does&#160;for the&#160;other basic&#160;input&#160;and output&#160;dialogs.<br/>
<i><b>Listing&#160;190.</b>&#160;Demonstrate&#160;InputBox.<br/></i>Sub&#160;ExampleInputBox<br/>&#160;&#160;Dim&#160;sReturn&#160;As&#160;String&#160; &#160; &#160;'Return value<br/>&#160;&#160;Dim&#160;sMsg&#160;As&#160;String&#160; &#160; &#160; &#160;&#160;'Holds the prompt<br/>&#160;&#160;Dim&#160;sTitle&#160;As&#160;String&#160; &#160; &#160;&#160;'Window title<br/>&#160;&#160;Dim&#160;sDefault&#160;As&#160;String&#160; &#160;&#160;'Default value<br/>&#160;&#160;Dim&#160;nXPos&#160;As&#160;Integer&#160; &#160; &#160;&#160;'Twips from left edge<br/>&#160;&#160;Dim&#160;nYPos&#160;As&#160;Integer&#160; &#160; &#160;&#160;'Twips from top edge<br/>&#160;&#160;nXPos&#160;=&#160;1440&#160;*&#160;2&#160; &#160; &#160; &#160; &#160;&#160;'Two inches from left edge of the window<br/>&#160;&#160;nYPos&#160;=&#160;1440&#160;*&#160;4&#160; &#160; &#160; &#160; &#160;&#160;'Four inches from top of the window<br/>&#160;&#160;sMsg&#160;&#160;=&#160;&#34;Please enter some meaningful text&#34;<br/>&#160;&#160;sTitle&#160;=&#160;&#34;Meaningful Title&#34;<br/>&#160;&#160;sDefault&#160;=&#160;&#34;Hello&#34;<br/>&#160;&#160;sReturn&#160;=&#160;InputBox(sMsg,&#160;sTitle,&#160;sDefault,&#160;nXPos,&#160;nYPos)<br/>&#160;&#160;If&#160;sReturn&#160;&lt;&gt;&#160;&#34;&#34;&#160;Then<br/>&#160; &#160;&#160;REM Print the entered string surrounded by double quotes<br/>&#160; &#160;&#160;Print&#160;&#34;You entered &#34;&#34;&#34;;sReturn;&#34;&#34;&#34;&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;You either entered an empty string or chose Cancel&#34;<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
<a href="libremacros.html#216">Figure&#160;69&#160;s</a>hows&#160;the&#160;dialog when it&#160;is&#160;first&#160;displayed. Pressing any&#160;key&#160;replaces&#160;the&#160;default&#160;text, because&#160;this&#160;<br/>text&#160;is&#160;highlighted when the&#160;dialog first&#160;opens.&#160;The&#160;macro i<a href="libremacros.html#216">n&#160;Listing&#160;190&#160;i</a>nspects&#160;the&#160;return value&#160;and&#160;<br/>checks&#160;for a&#160;zero-length&#160;string.&#160;A&#160;zero-length string&#160;could&#160;mean that&#160;the&#160;Cancel&#160;button&#160;was&#160;used to close&#160;the&#160;<br/>dialog, or it&#160;could&#160;mean that&#160;the&#160;user entered a&#160;zero-length&#160;string and then used the&#160;OK&#160;button to&#160;close&#160;the&#160;<br/>dialog.&#160;These&#160;two cases&#160;are&#160;not&#160;distinguishable&#160;from&#160;each other.<br/>
<i><b>Figure&#160;69.</b>&#160;InputBox&#160;with&#160;default&#160;text&#160;selected.</i><br/>
213<br/>
<hr/>
<a name=217></a><i><b>&#160;9.4.&#160;Error-related&#160;routines<br/></b></i>The&#160;error-related&#160;routines&#160;(see<a href="libremacros.html#217">&#160;Table&#160;82) i</a>n OOo Basic&#160;return information related&#160;to the&#160;last&#160;error.&#160;These&#160;<br/>routines&#160;are&#160;used to&#160;determine&#160;what&#160;happened and where.&#160;The&#160;error information&#160;is&#160;reset&#160;when the&#160;error&#160;<br/>handler is&#160;cleared, so save&#160;the&#160;error information&#160;if your&#160;macro program&#160;will&#160;require&#160;it&#160;later.<br/>
<i><b>Table&#160;82.</b>&#160;Error&#160;functions&#160;in OOo Basic.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
CVErr<br/>
Convert&#160;an expression to&#160;an error&#160;object.&#160;<br/>
Erl<br/>
Line&#160;number&#160;of&#160;last&#160;error.<br/>
Err<br/>
Error&#160;number&#160;of&#160;last&#160;error.<br/>
Error<br/>
Get&#160;error&#160;message&#160;either&#160;for&#160;the&#160;last&#160;error&#160;or&#160;for&#160;the&#160;specified&#160;error&#160;<br/>
Error(error_number)<br/>
message.<br/>
The&#160;macro i<a href="libremacros.html#217">n&#160;Listing&#160;191&#160;c</a>hecks&#160;for an error before&#160;the&#160;error handler is&#160;reset.&#160;Error information is&#160;then&#160;<br/>saved.&#160;Although the&#160;macro i<a href="libremacros.html#217">n&#160;Listing&#160;191&#160;doe</a>s&#160;not&#160;save&#160;the&#160;error message, the&#160;Error function accepts&#160;an&#160;<br/>error number as&#160;an optional&#160;argument&#160;for which the&#160;error message&#160;is&#160;returned.&#160;Also see<a href="libremacros.html#218">&#160;Figure&#160;70.</a><br/>
<i><b>Listing&#160;191.</b>&#160;Demonstrate&#160;error&#160;related statements.<br/></i>Sub&#160;ExampleError<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;BadError&#160; &#160; &#160; &#160;&#160;'Set up the error handler<br/>&#160;&#160;Print&#160;1/&#160;CInt(0.2)&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Do a division by zero<br/>BadError:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Error handler starts here<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Accumulate the message<br/>&#160;&#160;Dim&#160;oldError&#160;As&#160;Integer&#160; &#160; &#160; &#160;'Save the error number<br/>&#160;&#160;Dim&#160;lineNum&#160;As&#160;Integer&#160; &#160; &#160; &#160;&#160;'Save the line number<br/>&#160;&#160;If&#160;Err&#160;&lt;&gt;&#160;0&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'If an error occurred<br/>&#160; &#160;&#160;oldError&#160;=&#160;Err&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Save the error number<br/>&#160; &#160;&#160;lineNum&#160;=&#160;Erl&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Save the error line number<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;Before clearing the error handler&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34;Error number &#34;&#160;&amp;&#160;Err&#160;&amp;&#160;&#34; Occurred at line number &#34;&#160;&amp;&#160;Erl&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34;Err message: &#34;&#160;&amp;&#160;Error()&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Reset the error handler<br/>&#160;&#160;<br/>&#160;&#160;REM There is now no information to print<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;After clearing handler:&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Error number &#34;&#160;&amp;&#160;Err&#160;&amp;&#160;&#34; Occurred at line number &#34;&#160;&amp;&#160;Erl&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160;&#160;<br/>&#160;&#160;REM Use the saved information<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;Error info was saved so:&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;Error number &#34;&#160;&amp;&#160;oldError&#160;&amp;&#160;&#34; Occurred at line number &#34;&#160;&amp;_<br/>&#160; &#160; &#160;&#160;lineNum&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;Err message: &#34;&#160;&amp;&#160;Error(oldError)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Error Handling&#34;<br/>End&#160;Sub<br/>
214<br/>
<hr/>
<a name=218></a><i><b>Figure&#160;70.</b>&#160;Error&#160;information must&#160;be&#160;saved if&#160;it&#160;is&#160;used after&#160;resetting&#160;the&#160;error&#160;handler.</i><br/>
<i><b>&#160;9.5.&#160;Miscellaneous&#160;routines<br/></b></i>The&#160;miscellaneous&#160;routines&#160;described&#160;in this&#160;section&#160;are&#160;general-purpose&#160;routines&#160;that&#160;aren’t&#160;necessarily&#160;<br/>related to&#160;each other (see<a href="libremacros.html#218">&#160;Table&#160;83)</a>.&#160;<br/>
<i><b>Table&#160;83.</b>&#160;Miscellaneous&#160;functions&#160;in&#160;OOo Basic.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
Beep<br/>
Make&#160;a&#160;system-dependent&#160;beep.<br/>
CBool(expression)<br/>
Convert&#160;an&#160;integer&#160;or&#160;string&#160;to Boolean.<br/>
Environ(string)<br/>
Return an environment&#160;variable.<br/>
GetSolarVersion<br/>
Internal&#160;running&#160;version.<br/>
CreateObject(obj_type)<br/>
Dynamic&#160;version&#160;of&#160;“Dim&#160;As&#160;New”.<br/>
Erase(obj)<br/>
Free&#160;an objects memory.<br/>
The&#160;Beep statement&#160;generates&#160;a&#160;system-dependent&#160;beep.&#160;You can’t&#160;change&#160;the&#160;pitch&#160;or the&#160;length&#160;of the&#160;<br/>generated beep. On some&#160;systems, this&#160;plays&#160;a&#160;configurable&#160;sound file&#160;through the&#160;built-in&#160;speaker,&#160;and on&#160;<br/>others&#160;it&#160;generates&#160;a&#160;system&#160;event&#160;that&#160;plays&#160;a&#160;system-defined&#160;sound through low-level&#160;internal&#160;hardware.<br/>
Beep&#160; &#160; &#160; &#160; &#160;'Generate a noise<br/>Wait(500)&#160; &#160;&#160;'Wait 1/2 second<br/>Beep&#160; &#160; &#160; &#160; &#160;'Generate a noise&#160;<br/>
Use&#160;the&#160;CBool&#160;function&#160;to&#160;convert&#160;a&#160;string or a&#160;number to&#160;a&#160;Boolean value.&#160;Any&#160;numeric&#160;expression&#160;that&#160;<br/>evaluates&#160;to&#160;0 returns&#160;False. Numeric&#160;expressions&#160;that&#160;are&#160;not&#160;0 return&#160;True. String expressions&#160;that&#160;evaluate&#160;<br/>to “True”&#160;or “False”&#160;return&#160;True&#160;or False&#160;respectively;&#160;case&#160;does&#160;not&#160;matter.&#160;A&#160;string that&#160;does&#160;not&#160;evaluate&#160;<br/>exactly&#160;to&#160;True&#160;or False&#160;is&#160;evaluated as&#160;a&#160;number.&#160;If&#160;the&#160;string doesn’t&#160;contain a&#160;number or the&#160;text&#160;“true”&#160;or&#160;<br/>“false”, a&#160;run-time&#160;error occurs.<br/>
Print&#160;CBool(False)&#160; &#160; &#160;'False<br/>Print&#160;CBool(13)&#160; &#160; &#160; &#160;&#160;'True<br/>Print&#160;CBool(&#34;13&#34;)&#160; &#160; &#160;&#160;'True<br/>Print&#160;CBool(&#34;trUe&#34;)&#160; &#160;&#160;'True<br/>Print&#160;CBool(&#34;&amp;h1&#34;)&#160; &#160; &#160;'True<br/>Print&#160;CBool(&#34;13xx&#34;)&#160; &#160;&#160;'run-time error<br/>Print&#160;Cbool(&#34;Truee&#34;)&#160; &#160;'run-time error<br/>
215<br/>
<hr/>
<a name=219></a>Use&#160;the&#160;Environ&#160;function to&#160;retrieve&#160;environment&#160;variables.&#160;If&#160;the&#160;environment&#160;variable&#160;does&#160;not&#160;exist, an&#160;<br/>empty&#160;string is&#160;returned. No method&#160;is&#160;provided to&#160;set&#160;or change&#160;environment&#160;variables.<br/>
Print&#160;Environ(&#34;PATH&#34;)<br/>Print&#160;Environ(&#34;TEMP&#34;)<br/>
Use&#160;getSolarVersion&#160;to&#160;obtain&#160;the&#160;integer internal&#160;build number of OOo.&#160;You can write&#160;your macro to work&#160;<br/>around known issues, based on release&#160;documentation&#160;or discovered bugs&#160;for different&#160;versions&#160;of OOo.<br/>
Print&#160;GetSolarVersion<br/>
The&#160;CreateObject&#160;function&#160;allows&#160;objects&#160;to&#160;be&#160;created dynamically.&#160;If&#160;an object&#160;can be&#160;created&#160;using “Dim&#160;<br/>v&#160;As&#160;New”,&#160;it&#160;can be&#160;created with&#160;the&#160;CreateObject&#160;function. In&#160;other words, if an object&#160;can be&#160;created&#160;as&#160;a&#160;<br/>user-defined type, CreateObject&#160;can create&#160;one.&#160;The&#160;OOo underlying special&#160;data&#160;objects, which are&#160;covered&#160;<br/>in depth&#160;later,&#160;are&#160;called Universal&#160;Network Objects&#160;(UNO).&#160;These&#160;objects&#160;cannot&#160;be&#160;created using&#160;<br/>CreateObject.&#160;OOo does&#160;define&#160;structures&#160;that&#160;are&#160;not&#160;UNO&#160;objects&#160;that&#160;can be&#160;created using&#160;Dim&#160;As&#160;New&#160;<br/>and CreateObject&#160;(see<a href="libremacros.html#219">&#160;Listing 192)</a>.<br/>
<i><b>Listing&#160;192.</b>&#160;Create&#160;an object&#160;using&#160;CreateObject&#160;or&#160;Dim&#160;As&#160;New.</i><br/>
Dim&#160;oProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>Dim&#160;o&#160;As&#160;Object<br/>o&#160;=&#160;CreateObject(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>
<a href="libremacros.html#219">Listing 192&#160;de</a>monstrates&#160;creating a&#160;variable&#160;type&#160;defined&#160;by&#160;OOo that&#160;is&#160;like&#160;a&#160;user-defined type.&#160;The&#160;actual&#160;<br/>type&#160;name&#160;of the&#160;object&#160;is&#160;“com.sun.star.beans.PropertyValue”. Many&#160;of the&#160;objects&#160;in OOo have&#160;similarly&#160;<br/>long and cumbersome&#160;names.&#160;While&#160;writing about&#160;or discussing&#160;variable&#160;types&#160;such as&#160;this, it’s&#160;common&#160;to&#160;<br/>abbreviate&#160;the&#160;type&#160;name&#160;as&#160;the&#160;last&#160;portion&#160;of the&#160;name. For example, set&#160;the&#160;Name&#160;property&#160;of the&#160;<br/>PropertyValue&#160;variable&#160;(see<a href="libremacros.html#219">&#160;Listing&#160;193). O</a>bjects&#160;of type&#160;PropertyValue&#160;have&#160;two properties:&#160;Name&#160;as&#160;a&#160;<br/>String and&#160;Value&#160;as&#160;a&#160;Variant.<br/>
<i><b>Listing&#160;193.</b>&#160;Dim&#160;a PropertyValue&#160;and use&#160;CreateObject&#160;to&#160;create&#160;a new&#160;one.</i><br/>
Dim&#160;aProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>aProp.Name&#160;=&#160;&#34;FirstName&#34;&#160; &#160; &#160; &#160;'Set the Name property<br/>aProp.Value&#160;=&#160;&#34;Paterton&#34;&#160; &#160; &#160; &#160;'Set the Value property<br/>Erase&#160;aProp<br/>Print&#160;IsNull(aProp)&#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>
REM Create a new one!<br/>Dim&#160;aPropr<br/>aPropr&#160;=&#160;CreateObject(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>Erase&#160;aProp<br/>Print&#160;IsNull(aProp)&#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>Print&#160;IsEmpty(aProp)&#160; &#160; &#160; &#160; &#160; &#160;'False<br/>
Dim&#160;a<br/>a&#160;=&#160;array(&#34;hello&#34;,&#160;2)<br/>Erase&#160;a<br/>Print&#160;IsNull(a)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'False<br/>Print&#160;IsEmpty(a)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'True<br/>
Dim&#160;b()&#160;As&#160;String<br/>ReDim&#160;b(0&#160;To&#160;1)&#160;As&#160;String<br/>b(0)&#160;=&#160;&#34;Hello&#34;&#160;:&#160;b(1)&#160;=&#160;&#34;You&#34;<br/>'b() = &#34;hello&#34; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'Runtime error, variable not set (Expected)<br/>'Print b() &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'Runtime error, variable not set (Expected)<br/>
216<br/>
<hr/>
<a name=220></a>'Erase b() &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'Syntax Error, not too surprised<br/>Erase&#160;b&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'I did not expect this to work.<br/>Print&#160;IsNull(b())&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'False<br/>Print&#160;IsEmpty(b())&#160; &#160; &#160; &#160; &#160; &#160; &#160;'False<br/>Print&#160;IsArray(b())&#160; &#160; &#160; &#160; &#160; &#160; &#160;'False, This is probably bad.<br/>'Print LBound(b()) &#160; &#160; &#160; &#160; &#160; &#160; 'Error, variable not set.&#160;<br/>b()&#160;=&#160;&#34;hello&#34;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Odd, now I can treat b() as a string variable<br/>Print&#160;b()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'hello<br/>
<a href="libremacros.html#219">Listing 193&#160;de</a>monstrates&#160;the&#160;Erase&#160;statement, introduced with OOo version&#160;2.0. Use&#160;the&#160;Erase&#160;statement&#160;to&#160;<br/>free&#160;memory&#160;that&#160;will&#160;no longer be&#160;used. Do not&#160;use&#160;Erase&#160;unless&#160;you&#160;are&#160;finished &#160;with the&#160;variable.<br/>
Use&#160;the&#160;CreateObject&#160;function&#160;to&#160;create&#160;an object&#160;dynamically&#160;— in&#160;other words, when you&#160;don’t&#160;want&#160;to&#160;<br/>create&#160;the&#160;object&#160;when it’s&#160;declared.&#160;You can use&#160;CreateObject&#160;to&#160;create&#160;only&#160;one&#160;object&#160;at&#160;a&#160;time.&#160;Use&#160;the&#160;<br/>Dim&#160;As&#160;New&#160;construction&#160;to create&#160;an array&#160;of a&#160;particular type&#160;(see<a href="libremacros.html#220">&#160;Listing&#160;194).&#160;</a>You can even change&#160;the&#160;<br/>dimension of the&#160;array&#160;and preserve&#160;the&#160;data. It&#160;is&#160;more&#160;cumbersome&#160;to&#160;declare&#160;an array&#160;and then&#160;fill&#160;it&#160;with&#160;<br/>the&#160;appropriate&#160;values&#160;individually&#160;(see<a href="libremacros.html#220">&#160;Listing&#160;195).</a><br/>
<i><b>Listing&#160;194.</b>&#160;Demonstrate&#160;ReDim&#160;with&#160;Preserve</i><br/>
Sub&#160;ExampleReDimPreserveProp<br/>&#160;&#160;REM this is easy to create this way<br/>&#160;&#160;Dim&#160;oProps(2)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;oProps(0).Name&#160;=&#160;&#34;FirstName&#34;&#160;:&#160;oProps(0).Value&#160;=&#160;&#34;Joe&#34;<br/>&#160;&#160;oProps(1).Name&#160;=&#160;&#34;LastName&#34;&#160;&#160;:&#160;oProps(1).Value&#160;=&#160;&#34;Blather&#34;<br/>&#160;&#160;oProps(2).Name&#160;=&#160;&#34;Age&#34;&#160; &#160; &#160; &#160;:&#160;oProps(1).Value&#160;=&#160;53<br/>&#160;&#160;ReDim&#160;Preserve&#160;oProps(3)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;oProps(3).Name&#160;=&#160;&#34;Weight&#34;&#160; &#160;&#160;:&#160;oProps(3).value&#160;=&#160;97<br/>&#160;&#160;Print&#160;oProps(2).Name&#160; &#160;'Age<br/>End&#160;Sub<br/><i><b>Listing&#160;195.</b>&#160;You can add PropertyValue&#160;variables&#160;to a declared array.</i><br/>
REM This is more cumbersome, but you can still do it...<br/>Dim&#160;oProps(2)<br/>oProps(0)&#160;=&#160;CreateObject(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>oProps(1)&#160;=&#160;CreateObject(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>oProps(2)&#160;=&#160;CreateObject(&#34;com.sun.star.beans.PropertyValue&#34;)&#160;&#160;<br/>oProps(0).Name&#160;=&#160;&#34;FirstName&#34;&#160;:&#160;oProps(0).Value&#160;=&#160;&#34;Joe&#34;<br/>oProps(1).Name&#160;=&#160;&#34;LastName&#34;&#160;&#160;:&#160;oProps(1).Value&#160;=&#160;&#34;Blather&#34;<br/>oProps(2).Name&#160;=&#160;&#34;Age&#34;&#160; &#160; &#160; &#160;:&#160;oProps(1).Value&#160;=&#160;53<br/>
Assigning one&#160;array&#160;to another assigns&#160;a&#160;reference&#160;so that&#160;both&#160;arrays&#160;reference&#160;the&#160;same&#160;array&#160;object.&#160;With&#160;<br/>variable&#160;types&#160;such as&#160;Integer and PropertyValue, assignment&#160;makes&#160;a&#160;copy.&#160;Failure&#160;to understand which&#160;<br/>types&#160;copy&#160;by&#160;value&#160;and which&#160;types&#160;copy&#160;by&#160;reference&#160;is&#160;a&#160;common&#160;source&#160;of errors. Structures&#160;and integral<br/>types&#160;(such as&#160;Integer and String) copy&#160;as&#160;a&#160;value, but&#160;arrays&#160;and UNO&#160;variables,&#160;as&#160;will&#160;be&#160;discussed later,&#160;<br/>copy&#160;as&#160;a&#160;reference. Copying&#160;by&#160;value&#160;is&#160;demonstrated in&#160;an obvious&#160;way&#160;in<a href="libremacros.html#220">&#160;Listing 196.</a><br/>
<i><b>Listing&#160;196.</b>&#160;Properties&#160;copy&#160;by&#160;value.<br/></i>Sub&#160;ExampleCopyAsValue<br/>&#160;&#160;Dim&#160;aProp1<br/>&#160;&#160;Dim&#160;aProp2<br/>&#160;&#160;aProp1&#160;=&#160;CreateObject(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>&#160;&#160;aProp1.Name&#160;=&#160;&#34;Age&#34;&#160; &#160;'Set Name Property on one<br/>&#160;&#160;aProp1.Value&#160;=&#160;27&#160; &#160; &#160;'Set Value Property on one<br/>&#160;&#160;aProp2&#160;=&#160;aProp1&#160; &#160; &#160; &#160;'Make a copy<br/>&#160;&#160;aProp2.Name&#160;=&#160;&#34;Weight&#34;'Set Name Property on two<br/>
217<br/>
<hr/>
<a name=221></a>&#160;&#160;aProp2.Value&#160;=&#160;97&#160; &#160; &#160;'Set Value Property on two<br/>&#160;&#160;Print&#160;aProp1.Name,&#160;aProp2.Name&#160;'Age &#160;Weight<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
Standard&#160;object&#160;variables&#160;copy&#160;by&#160;value,&#160;and&#160;UNO&#160;variables copy&#160;by&#160;reference.<br/>
When&#160;one&#160;integer variable&#160;is&#160;assigned to another,&#160;it&#160;is&#160;understood&#160;that&#160;the&#160;value&#160;was&#160;copied&#160;and nothing&#160;<br/>more.&#160;The&#160;two variables&#160;are&#160;still&#160;independent&#160;of each other.&#160;This&#160;is&#160;also true&#160;for structures.&#160;Text&#160;cursors,&#160;<br/>discussed later,&#160;contain&#160;a&#160;property&#160;called CharLocale,&#160;which&#160;specifies&#160;the&#160;country&#160;and language&#160;for the&#160;text&#160;<br/>selected by&#160;the&#160;text&#160;cursor.&#160;The&#160;common, incorrect&#160;method&#160;to&#160;set&#160;the&#160;locale&#160;is&#160;to&#160;access&#160;the&#160;variable&#160;directly.&#160;<br/>This&#160;sets&#160;the&#160;language&#160;and country&#160;on a&#160;copy&#160;of the&#160;CharLocale&#160;property&#160;rather than on the&#160;copy&#160;used by&#160;the&#160;<br/>text&#160;cursor.&#160;I&#160;see&#160;this&#160;type&#160;of error often.<br/>
oCursor.CharLocale.Language&#160;=&#160;&#34;fr&#34;&#160;&#160;'set language to French on a copy<br/>oCursor.CharLocale.Country&#160;=&#160;&#160;&#34;CH&#34;&#160;&#160;'set country to Switzerland on a copy<br/>
One&#160;correct&#160;method to&#160;set&#160;the&#160;locale&#160;is&#160;to&#160;create&#160;a&#160;new&#160;Locale&#160;structure, modify&#160;the&#160;new&#160;structure, and copy&#160;<br/>the&#160;new&#160;structure&#160;to&#160;the&#160;text&#160;cursor.<br/>
Dim&#160;aLocale&#160;As&#160;New&#160;com.sun.star.lang.Locale<br/>aLocale.Language&#160;=&#160;&#34;fr&#34;&#160; &#160; &#160; &#160;&#160;'Set Locale to use the French language<br/>aLocale.Country&#160;&#160;=&#160;&#34;CH&#34;&#160; &#160; &#160; &#160;&#160;'Set Locale to use Switzerland as the country<br/>oCursor.CharLocale&#160;=&#160;aLocale&#160; &#160;'Assign the value back<br/>
You can also obtain&#160;a&#160;copy&#160;of the&#160;structure, modify&#160;the&#160;copied&#160;structure, and copy&#160;the&#160;modified structure&#160;to&#160;<br/>the&#160;text&#160;cursor.<br/>
Dim&#160;aLocale<br/>aLocale&#160;=&#160;oCursor.CharLocale&#160; &#160;'Or use a copy<br/>aLocale.Language&#160;=&#160;&#34;fr&#34;&#160; &#160; &#160; &#160;&#160;'Set Locale to use the French language<br/>aLocale.Country&#160;&#160;=&#160;&#34;CH&#34;&#160; &#160; &#160; &#160;&#160;'Set Locale to use Switzerland as the country<br/>oCursor.CharLocale&#160;=&#160;aLocale&#160; &#160;'Assign the value back<br/>
<i><b>&#160;9.6.&#160;Partition<br/></b></i>Partition&#160;is&#160;not&#160;documented and was&#160;likely&#160;added for&#160;VB&#160;compatibility.&#160;Partition return a&#160;Variant&#160;(String)&#160;<br/>indicating where&#160;a&#160;number occurs&#160;in&#160;a&#160;calculated series&#160;of ranges.&#160;<br/>
Partition(number,&#160;start_value,&#160;stop_value,&#160;interval)<br/>
Consider the&#160;following values:<br/>
start_value = 0<br/>stop_value = 17<br/>interval = 5<br/>
The&#160;following&#160;“partitions”&#160;are&#160;assumed:<br/>
1)&#160;“&#160; :-1”<br/>
Everything before&#160;0<br/>
2)&#160;“0:4”<br/>
Five&#160;numbers&#160;from&#160;0 to 4.<br/>
3)&#160;“5:9”<br/>
Five&#160;numbers&#160;from&#160;5 to 9.<br/>
4)&#160;“10:14”<br/>
Five&#160;numbers&#160;from&#160;10 to 14.<br/>
5)&#160;“15:17”<br/>
Three&#160;numbers&#160;from&#160;15 to 17.<br/>
218<br/>
<hr/>
<a name=222></a>6)&#160;“18:&#160; ”<br/>
Everything after 17.<br/>
The&#160;example&#160;i<a href="libremacros.html#222">n&#160;Listing&#160;197&#160;t</a>ests&#160;numbers&#160;before&#160;and after the&#160;interval.&#160;As&#160;expected, values&#160;before&#160;the&#160;first&#160;<br/>interval&#160;run from&#160;“&#160; :-1”.&#160;Values&#160;that&#160;fall&#160;into an interval&#160;are&#160;nicely&#160;identified.&#160;The&#160;only&#160;tricky&#160;part&#160;is&#160;that&#160;the&#160;<br/>final&#160;interval&#160;claims&#160;to include&#160;values&#160;from&#160;“15:19”&#160;even though 18 and 19 are&#160;not&#160;in the&#160;interval.<br/>
<i><b>Listing&#160;197.</b>&#160;Run partition through a series&#160;of&#160;values.<br/></i>Sub&#160;ExamplePartition<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;For&#160;i&#160;=&#160;-2&#160;To&#160;20<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Partition(&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34;, 0, 17, 5) = &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160;&#160;Partition(i,&#160;0,&#160;17,&#160;5)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<i><b>Figure&#160;71.</b>&#160;Partition&#160;shows&#160;the&#160;interval&#160;containing&#160;a number.</i><br/>
219<br/>
<hr/>
<a name=223></a>The&#160;values&#160;returned by&#160;Partition&#160;are&#160;carefully&#160;formatted.&#160;The&#160;lower value&#160;and upper value&#160;have&#160;the&#160;same&#160;<br/>number of characters, which&#160;means&#160;that&#160;they&#160;will&#160;sort&#160;properly&#160;if you&#160;choose&#160;to do so.&#160;This&#160;also&#160;helps&#160;if you&#160;<br/>want&#160;to parse&#160;the&#160;returned values.<br/>
<i><b>&#160;9.7.&#160;Inspection&#160;and&#160;identification&#160;of&#160;variables<br/></b></i>OOo Basic&#160;contains&#160;numerous&#160;functions&#160;to inspect&#160;and identify&#160;variables&#160;(see<a href="libremacros.html#223">&#160;Table&#160;84).&#160;</a>These&#160;routines&#160;are&#160;<br/>frequently&#160;used when you&#160;call&#160;a&#160;function&#160;and aren’t&#160;certain&#160;of the&#160;return type.&#160;These&#160;routines&#160;are&#160;also useful&#160;<br/>for debugging. For&#160;example, you could&#160;use&#160;these&#160;functions&#160;to&#160;verify&#160;that&#160;a&#160;return type&#160;is&#160;valid.<br/>
<i><b>Table&#160;84.</b>&#160;Variable&#160;inspection functions&#160;in OOo Basic.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
IsArray<br/>
Is&#160;the&#160;variable&#160;an array?<br/>
IsDate<br/>
Does the&#160;string&#160;contain a&#160;valid date?<br/>
IsEmpty<br/>
Is&#160;the&#160;variable&#160;an empty&#160;Variant&#160;variable?<br/>
IsMissing<br/>
Is&#160;the&#160;variable&#160;a&#160;missing&#160;argument?<br/>
IsNull<br/>
Is&#160;the&#160;variable&#160;an unassigned&#160;object?<br/>
IsNumeric<br/>
Does the&#160;string&#160;contain a&#160;valid number?<br/>
IsObject<br/>
Is&#160;the&#160;variable&#160;an object?<br/>
IsUnoStruct<br/>
Is&#160;the&#160;variable&#160;a&#160;UNO&#160;structure?<br/>
TypeLen<br/>
Space&#160;used by&#160;the&#160;variable&#160;type.<br/>
TypeName<br/>
Return the&#160;type&#160;name&#160;of&#160;the&#160;object&#160;as a&#160;String.<br/>
VarType<br/>
Return the&#160;variable&#160;type&#160;as an&#160;Integer.<br/>
Use&#160;IsArray&#160;to see&#160;if a&#160;variable&#160;is&#160;an array&#160;(see<a href="libremacros.html#223">&#160;Listing&#160;198). I</a>f&#160;IsArray&#160;returns&#160;True, it&#160;does&#160;not&#160;imply&#160;that&#160;<br/>the&#160;variable&#160;has&#160;data&#160;or even that&#160;it&#160;is&#160;dimensioned&#160;—&#160;merely&#160;that&#160;it&#160;exists&#160;and is&#160;defined as&#160;an array.&#160;The&#160;<br/>UBound and LBound functions,&#160;as&#160;already&#160;discussed, return the&#160;upper and lower bounds&#160;of the&#160;array.<br/>
<i><b>Listing&#160;198.</b>&#160;Use&#160;IsArray&#160;to see&#160;if&#160;a variable&#160;is&#160;an array.<br/></i>Dim&#160;n&#160;As&#160;Long&#160; &#160; &#160;&#160;'This is NOT an array<br/>Dim&#160;a()&#160;As&#160;String&#160;&#160;'This is an array<br/>Dim&#160;b(5)&#160; &#160; &#160; &#160; &#160; &#160;'This is an array<br/>Dim&#160;v&#160;As&#160;Variant&#160; &#160;'This is not an array yet<br/>Print&#160;IsArray(v)&#160; &#160;'False<br/>Print&#160;IsArray(n)&#160; &#160;'False<br/>Print&#160;IsArray(a)&#160; &#160;'True<br/>Print&#160;IsArray(b())&#160;'True<br/>ReDim&#160;v(3)&#160; &#160; &#160; &#160; &#160;'It is an array now!<br/>Print&#160;IsArray(v())&#160;'True<br/>
Use&#160;the&#160;IsDate&#160;function to&#160;test&#160;if a&#160;string contains&#160;a&#160;valid&#160;date&#160;(see<a href="libremacros.html#223">&#160;Listing 199)</a>.&#160;The&#160;arguments&#160;are&#160;<br/>converted to&#160;a&#160;string before&#160;they&#160;are&#160;used, so numeric&#160;arguments&#160;return False.&#160;The&#160;IsDate&#160;function&#160;tests&#160;more<br/>than just&#160;syntax;&#160;it&#160;checks&#160;to&#160;see&#160;if the&#160;string contains&#160;a&#160;valid date.&#160;The&#160;same&#160;check is&#160;not&#160;made&#160;on the&#160;time&#160;<br/>component&#160;of the&#160;string.<br/>
<i><b>Listing&#160;199.</b>&#160;IsDate&#160;verifies&#160;that&#160;a string&#160;contains&#160;a valid&#160;date.</i><br/>
Print&#160;IsDate(&#34;December 1, 1582 2:13:42&#34;)&#160;'True<br/>Print&#160;IsDate(&#34;2:13:42&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>Print&#160;IsDate(&#34;12/1/1582&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>
220<br/>
<hr/>
<a name=224></a>Print&#160;IsDate(Now)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>Print&#160;IsDate(&#34;26:61:112&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>Print&#160;IsDate(True)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'False converts to string first<br/>Print&#160;IsDate(32686.22332)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'False converts to string first<br/>Print&#160;IsDate(&#34;02/29/2003&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'False, only 28 days in February 2003<br/>
Like&#160;the&#160;IsDate&#160;function,&#160;the&#160;IsNumeric&#160;function looks&#160;at&#160;strings&#160;(see<a href="libremacros.html#224">&#160;Listing&#160;200). I</a>f&#160;the&#160;argument&#160;is&#160;not&#160;<br/>entirely&#160;a&#160;solitary&#160;valid number,&#160;except&#160;for leading or trailing spaces&#160;and enclosing quotation&#160;marks, it&#160;<br/>returns&#160;False.<br/>
<i><b>Listing&#160;200.</b>&#160;IsNumeric&#160;is&#160;very&#160;picky&#160;about&#160;what&#160;it&#160;accepts.<br/></i>Print&#160;IsNumeric(&#34; 123&#34;)&#160; &#160;'True<br/>Print&#160;IsNumeric(&#34; 12 3&#34;)&#160;&#160;'False<br/>Print&#160;IsNumeric(1.23)&#160; &#160; &#160;'True<br/>Print&#160;IsNumeric(1,23)&#160; &#160; &#160;'True<br/>Print&#160;IsNumeric(&#34;123abc&#34;)&#160;'False<br/>Print&#160;IsNumeric(True)&#160; &#160; &#160;'False<br/>Print&#160;IsNumeric(Now)&#160; &#160; &#160;&#160;'False<br/>
Variant&#160;variables&#160;start&#160;with no value&#160;at&#160;all;&#160;they&#160;are&#160;initially&#160;empty.&#160;Object&#160;variables&#160;are&#160;initialized&#160;with&#160;the&#160;<br/>value&#160;null. Use&#160;the&#160;functions&#160;IsEmpty&#160;and IsNull&#160;to&#160;test&#160;these&#160;conditions. Use&#160;the&#160;IsObject&#160;function to&#160;<br/>determine&#160;if a&#160;variable&#160;is&#160;an object.<br/>
Dim&#160;v&#160;As&#160;Variant&#160;&#160;'Starts as not initialized, Empty<br/>Dim&#160;o&#160;As&#160;Object&#160; &#160;'Initialized to null<br/>
Print&#160;IsObject(v)&#160;'False &#160;No, a Variant is not an Object<br/>Print&#160;IsObject(o)&#160;'True &#160; Yes, this is an Object<br/>
Print&#160;IsEmpty(v)&#160;&#160;'True &#160; Variants start as Empty, not initialized<br/>Print&#160;IsNull(v)&#160; &#160;'False &#160;To be null, a Variant must contain something<br/>
Print&#160;IsEmpty(o)&#160;&#160;'False &#160;Variants start as Empty, not Objects<br/>Print&#160;IsNull(o)&#160; &#160;'True &#160; Objects start as null<br/>
v&#160;=&#160;o<br/>Print&#160;IsObject(v)&#160;'True &#160; The variant just became an Object.<br/>Print&#160;IsEmpty(v)&#160;&#160;'False &#160;Variant now contains a value (an Object)<br/>Print&#160;IsNull(v)&#160; &#160;'True &#160; Variant contains a null Object<br/>
Use&#160;the&#160;IsMissing function to&#160;determine&#160;if an optional&#160;argument&#160;is&#160;missing. Usually,&#160;some&#160;default&#160;value&#160;is&#160;<br/>used if&#160;an argument&#160;is&#160;missing.&#160;<br/>
Sub&#160;TestOptional<br/>&#160;&#160;Print&#160;&#34;Arg is &#34;;ExampleOptional()&#160; &#160; &#160; &#160; &#160;'Arg is missing<br/>&#160;&#160;Print&#160;&#34;Arg is &#34;;ExampleOptional(&#34;hello&#34;)&#160;&#160;'Arg is hello<br/>End&#160;Sub<br/>
Function&#160;ExampleOptional(Optional&#160;x)&#160;As&#160;String<br/>&#160;&#160;ExampleOptional&#160;=&#160;IIF(IsMissing(x),&#160;&#34;Missing&#34;,&#160;CStr(x))<br/>End&#160;Function<br/>
Use&#160;the&#160;function&#160;IsUnoStruct&#160;to&#160;determine&#160;if&#160;a&#160;variable&#160;contains&#160;a&#160;structure&#160;defined&#160;by&#160;OpenOffice.org.<br/>
&#160;&#160;Dim&#160;v<br/>&#160;&#160;Print&#160;IsUnoStruct(v)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'False<br/>
221<br/>
<hr/>
<a name=225></a>&#160;&#160;v&#160;=&#160;CreateUnoStruct(&#34;com.sun.star.beans.Property&#34;)&#160;'Create a UNO<br/>&#160;&#160;Print&#160;IsUnoStruct(v)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'True<br/>
Use&#160;the&#160;TypeName&#160;function&#160;for a&#160;string representation of the&#160;variable’s&#160;type.&#160;The&#160;VarType&#160;function returns&#160;<br/>an integer corresponding to the&#160;variable&#160;type<a href="libremacros.html#225">.&#160;Table&#160;85&#160;c</a>ontains&#160;a&#160;list&#160;of the&#160;possible&#160;types.&#160;The&#160;first&#160;column,<br/>labeled BASIC, indicates&#160;if the&#160;type&#160;is&#160;common&#160;to BASIC and therefore&#160;likely&#160;to&#160;be&#160;seen.&#160;The&#160;other values&#160;<br/>represent&#160;types&#160;that&#160;are&#160;internal&#160;to OOo. OOo Basic&#160;typically&#160;maps&#160;internal&#160;types&#160;to standard OOo Basic&#160;<br/>types, so you aren’t&#160;likely&#160;to see&#160;these&#160;other types.&#160;They&#160;are, however,&#160;contained&#160;in the&#160;source&#160;code&#160;and they&#160;<br/>are&#160;included&#160;for completeness.<br/>
<i><b>Table&#160;85.</b>&#160;Variable&#160;types&#160;and names.</i><br/>
<i><b>BASIC</b></i><br/>
<i><b>VarType</b></i><br/>
<i><b>TypeName</b></i><br/>
<i><b>Len</b></i><br/>
<i><b>Description</b></i><br/>
yes<br/>
0<br/>
Empty<br/>
0<br/>
Variant&#160;variable&#160;is not&#160;initialized<br/>
yes<br/>
1<br/>
Null<br/>
0<br/>
No valid&#160;data&#160;in an&#160;Object&#160;variable<br/>
yes<br/>
2<br/>
Integer<br/>
2<br/>
Integer&#160;variable<br/>
yes<br/>
3<br/>
Long<br/>
4<br/>
Long Integer&#160;variable<br/>
yes<br/>
4<br/>
Single<br/>
4<br/>
Single&#160;floating-point&#160;variable<br/>
yes<br/>
5<br/>
Double<br/>
8<br/>
Double&#160;floating-point&#160;variable<br/>
yes<br/>
6<br/>
Currency<br/>
8<br/>
Currency&#160;variable<br/>
yes<br/>
7<br/>
Date<br/>
8<br/>
Date&#160;variable<br/>
yes<br/>
8<br/>
String<br/>
strlen<br/>
String&#160;variable<br/>
yes<br/>
9<br/>
Object<br/>
0<br/>
Object&#160;variable<br/>
no<br/>
10<br/>
Error<br/>
2<br/>
Internal&#160;OOo type<br/>
yes<br/>
11<br/>
Boolean<br/>
1<br/>
Boolean&#160;variable<br/>
yes<br/>
12<br/>
Variant<br/>
0<br/>
Variant&#160;variables act&#160;like&#160;any&#160;type<br/>
no<br/>
13<br/>
DataObject<br/>
0<br/>
Internal&#160;OOo type<br/>
no<br/>
14<br/>
Unknown&#160;Type<br/>
0<br/>
Internal&#160;OOo type<br/>
no<br/>
15<br/>
Unknown&#160;Type<br/>
0<br/>
Internal&#160;OOo type<br/>
no<br/>
16<br/>
Char<br/>
1<br/>
Internal&#160;OOo type,&#160;a&#160;single&#160;text&#160;character<br/>
yes<br/>
17<br/>
Byte<br/>
1<br/>
Internal&#160;OOo type,&#160;but&#160;you can use&#160;CByte&#160;to create&#160;one<br/>
no<br/>
18<br/>
UShort<br/>
2<br/>
Internal&#160;OOo type,&#160;unsigned&#160;short&#160;integer&#160;(16&#160;bits)<br/>
no<br/>
19<br/>
ULong<br/>
4<br/>
Internal&#160;OOo type,&#160;unsigned&#160;long&#160;(32&#160;bits)<br/>
no<br/>
20<br/>
Long64<br/>
8<br/>
Internal&#160;OOo type,&#160;long&#160;(64&#160;bits)<br/>
no<br/>
21<br/>
ULong64<br/>
8<br/>
Internal&#160;OOo type,&#160;unsigned&#160;long&#160;(64&#160;bits)<br/>
no<br/>
22<br/>
Int<br/>
2<br/>
Internal&#160;OOo type,&#160;integer&#160;(16&#160;bits)<br/>
no<br/>
23<br/>
UInt<br/>
2<br/>
Internal&#160;OOo type,&#160;unsigned&#160;integer&#160;(16&#160;bits)<br/>
no<br/>
24<br/>
Void<br/>
0<br/>
Internal&#160;OOo type,&#160;no value<br/>
no<br/>
25<br/>
HResult<br/>
0<br/>
Internal&#160;OOo type<br/>
no<br/>
26<br/>
Pointer<br/>
0<br/>
Internal&#160;OOo type,&#160;pointer&#160;to&#160;something<br/>
no<br/>
27<br/>
DimArray<br/>
0<br/>
Internal&#160;OOo type<br/>
no<br/>
28<br/>
CArray<br/>
0<br/>
Internal&#160;OOo type<br/>
no<br/>
29<br/>
Userdef<br/>
0<br/>
Internal&#160;OOo type,&#160;user-defined&#160;<br/>
222<br/>
<hr/>
<a name=226></a><i><b>BASIC</b></i><br/>
<i><b>VarType</b></i><br/>
<i><b>TypeName</b></i><br/>
<i><b>Len</b></i><br/>
<i><b>Description</b></i><br/>
no<br/>
30<br/>
Lpstr<br/>
strlen<br/>
Internal&#160;OOo type,&#160;long&#160;pointer&#160;to a&#160;string<br/>
no<br/>
31<br/>
Lpwstr<br/>
strlen<br/>
Internal&#160;OOo type,&#160;long&#160;pointer&#160;to a&#160;“Wide”&#160;Unicode&#160;<br/>string<br/>
no<br/>
32<br/>
Unknown&#160;Type<br/>
0<br/>
Internal&#160;core&#160;string&#160;type<br/>
no<br/>
33<br/>
WString<br/>
strlen<br/>
Internal&#160;OOo type,&#160;“Wide”&#160;Unicode&#160;string<br/>
no<br/>
34<br/>
WChar<br/>
2<br/>
Internal&#160;OOo type,&#160;“Wide”&#160;Unicode&#160;character<br/>
no<br/>
35<br/>
Int64<br/>
8<br/>
Internal&#160;OOo type,&#160;integer&#160;(64&#160;bits)<br/>
no<br/>
36<br/>
UInt64<br/>
8<br/>
Internal&#160;OOo type,&#160;unsigned&#160;integer&#160;(64&#160;bits)<br/>
no<br/>
37<br/>
Decimal<br/>
OLE&#160;Automation type&#160;available&#160;in&#160;VB.<br/>
Use&#160;the&#160;TypeLen function&#160;to determine&#160;how&#160;many&#160;bytes&#160;a&#160;variable&#160;uses.&#160;The&#160;returned value&#160;is&#160;hard coded for<br/>every&#160;value&#160;except&#160;for the&#160;strings, which return the&#160;length of the&#160;string.&#160;Array&#160;variables&#160;always&#160;return&#160;a&#160;<br/>length&#160;of zero.&#160;The&#160;macro in<a href="libremacros.html#226">&#160;Listing 201&#160;g</a>enerates&#160;all&#160;of the&#160;standard BASIC types, places&#160;them&#160;into an&#160;<br/>array,&#160;and builds&#160;a&#160;string containing the&#160;type, length, and type&#160;name,&#160;as&#160;shown i<a href="libremacros.html#227">n&#160;Figure&#160;72.</a><br/>
<i><b>Listing&#160;201.</b>&#160;Show type&#160;information&#160;for&#160;standard&#160;types.<br/></i>Sub&#160;ExampleTypes<br/>&#160;&#160;Dim&#160;b&#160;As&#160;Boolean<br/>&#160;&#160;Dim&#160;c&#160;As&#160;Currency<br/>&#160;&#160;Dim&#160;t&#160;As&#160;Date<br/>&#160;&#160;Dim&#160;d&#160;As&#160;Double<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;l&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;o&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;f&#160;As&#160;Single<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160;<br/>&#160;&#160;Dim&#160;v&#160;As&#160;Variant<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Variant<br/>&#160;&#160;Dim&#160;ta()<br/>&#160;&#160;Dim&#160;ss$<br/>&#160;&#160;n&#160;=&#160;null<br/>&#160;&#160;ta()&#160;=&#160;Array(v,&#160;n,&#160;i,&#160;l,&#160;f,&#160;d,&#160;c,&#160;t,&#160;s,&#160;o,&#160;b,&#160;CByte(3)&#160;_<br/>&#160; &#160;&#160;CreateUnoValue(&#34;unsigned long&#34;,&#160;10)))<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(ta())&#160;To&#160;UBound(ta())<br/>&#160; &#160;&#160;ss&#160;=&#160;ss&#160;&amp;&#160;ADPTypeString(ta(i))<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;ss,&#160;0,&#160;&#34;Type, Length, and Name&#34;&#160;&#160;<br/>End&#160;Sub<br/>
Function&#160;ADPTypeString(v)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Hold the return string<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Dummy integer value<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Type = &#34;&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Leading type string<br/>&#160;&#160;i&#160;=&#160;VarType(v)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Get the type<br/>&#160;&#160;If&#160;i&#160;&lt;&#160;10&#160;Then&#160;s&#160;=&#160;S&#160;&amp;&#160;&#34;0&#34;&#160; &#160;'Leading zero if required<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(i)&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Add the type number<br/>&#160;&#160;If&#160;IsArray(v)&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; (&#34;<br/>
223<br/>
<hr/>
<a name=227></a>&#160; &#160;&#160;i&#160;=&#160;i&#160;AND&#160;NOT&#160;8192<br/>&#160; &#160;&#160;If&#160;i&#160;&lt;&#160;10&#160;Then&#160;s&#160;=&#160;S&#160;&amp;&#160;&#34;0&#34;&#160;'Leading zero if required<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(i)&#160;&amp;&#160;&#34;)&#34;&#160; &#160; &#160;&#160;'Add the type number<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; &#160; Len = &#34;&#160; &#160; &#160; &#160; &#160;&#160;'Leading length string<br/>&#160; &#160;&#160;i&#160;=&#160;TypeLen(v)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'What is the length<br/>&#160; &#160;&#160;If&#160;i&#160;&lt;&#160;10&#160;Then&#160;s&#160;=&#160;S&#160;&amp;&#160;&#34;0&#34;&#160; &#160;'Leading zero if required<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(i)&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Add in the length<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; &#160;Name = &#34;&#160; &#160; &#160; &#160; &#160;&#160;'Leading Name string<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;TypeName(v)&amp;&#160;CHR$(10)'Add in the name and a new-line character<br/>&#160;&#160;ADPTypeString&#160;=&#160;s&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Return value for the function<br/>End&#160;Function<br/>
<i><b>Figure&#160;72.</b>&#160;Variable&#160;types, lengths, and names.</i><br/>
The&#160;function&#160;ADPTypeString does&#160;the&#160;work of generating the&#160;display&#160;string. It&#160;gives&#160;special&#160;handling to&#160;<br/>arrays, because&#160;the&#160;returned type&#160;numbers&#160;for arrays&#160;are&#160;completely&#160;different&#160;than the&#160;type&#160;numbers&#160;for the&#160;<br/>standard variables.&#160;At&#160;least&#160;they&#160;seem&#160;that&#160;way&#160;until&#160;you&#160;start&#160;looking very&#160;closely&#160;at&#160;the&#160;numbers. If&#160;the&#160;<br/>thought&#160;of twiddling bits&#160;makes&#160;you&#160;tremble, skip&#160;the&#160;rest&#160;of this&#160;paragraph.&#160;The&#160;value&#160;returned by&#160;VarType&#160;<br/>for an array&#160;always&#160;has&#160;bit&#160;14 set&#160;—&#160;a&#160;1 followed by&#160;13 zeros&#160;in&#160;binary.&#160;This&#160;is&#160;8192 in decimal&#160;and 2000 in&#160;<br/>hexadecimal.&#160;The&#160;IsArray&#160;function&#160;is&#160;implemented&#160;by&#160;checking bit&#160;14 of the&#160;VarType. If&#160;you&#160;clear bit&#160;14, the<br/>number that&#160;remains&#160;tells&#160;you what&#160;numeric&#160;type&#160;is&#160;used for the&#160;array.&#160;The&#160;NOT&#160;operator clears&#160;every&#160;bit&#160;<br/>that&#160;is&#160;set&#160;and sets&#160;every&#160;bit&#160;that&#160;is&#160;clear,&#160;so NOT&#160;8192 provides&#160;the&#160;number with every&#160;bit&#160;set&#160;except&#160;for bit&#160;<br/>14. If&#160;you&#160;AND&#160;this&#160;with&#160;the&#160;type, it&#160;clears&#160;bit&#160;14, leaving the&#160;rest&#160;of the&#160;bits&#160;intact.<br/>
i = i AND NOT 8192<br/>
The&#160;length&#160;of an array&#160;is&#160;always&#160;returned as&#160;zero, so I&#160;didn’t&#160;include&#160;this&#160;by&#160;VarType&#160;in<a href="libremacros.html#226">&#160;Listing 201.&#160;</a>The&#160;<br/>code&#160;in<a href="libremacros.html#227">&#160;Listing 202&#160;i</a>s&#160;similar t<a href="libremacros.html#226">o&#160;Listing&#160;201&#160;but</a>&#160;the&#160;types&#160;are&#160;arrays. Notice&#160;that&#160;the&#160;type&#160;name&#160;for array&#160;<br/>types&#160;contains&#160;parentheses&#160;“()”&#160;following&#160;the&#160;name&#160;(see<a href="libremacros.html#228">&#160;Figure&#160;73)</a>.<br/>
<i><b>Listing&#160;202.</b>&#160;Show type&#160;information&#160;for&#160;arrays.<br/></i>Sub&#160;ExampleTypesArray<br/>&#160;&#160;Dim&#160;b()&#160;As&#160;Boolean<br/>&#160;&#160;Dim&#160;c()&#160;As&#160;Currency<br/>&#160;&#160;Dim&#160;t()&#160;As&#160;Date<br/>&#160;&#160;Dim&#160;d()&#160;As&#160;Double<br/>
224<br/>
<hr/>
<a name=228></a>&#160;&#160;Dim&#160;i()&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;l()&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;o()&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;f()&#160;As&#160;Single<br/>&#160;&#160;Dim&#160;s()&#160;As&#160;String&#160;<br/>&#160;&#160;Dim&#160;v()&#160;As&#160;Variant<br/>&#160;&#160;Dim&#160;ta(),&#160;j%<br/>&#160;&#160;Dim&#160;ss$<br/>&#160;&#160;ta()&#160;=&#160;Array(i,&#160;l,&#160;f,&#160;d,&#160;c,&#160;t,&#160;s,&#160;o,&#160;b,&#160;v)<br/>&#160;&#160;For&#160;j%&#160;=&#160;LBound(ta())&#160;To&#160;UBound(ta())<br/>&#160; &#160;&#160;ss&#160;=&#160;ss&#160;&amp;&#160;ADPTypeString(ta(j%))<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;ss,&#160;0,&#160;&#34;Type, Length, and Name&#34;&#160;&#160;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;73.</b>&#160;Types, lengths,&#160;and names&#160;for&#160;array&#160;variables.</i><br/>
<i><b>&#160;9.8.&#160;Routines&#160;you&#160;should&#160;not&#160;use&#160;and&#160;other&#160;curiosities<br/></b></i>I&#160;first&#160;heard my&#160;good friend Manfred say&#160;that&#160;“the&#160;book that&#160;is&#160;forbidden&#160;to read turns&#160;one&#160;reader into&#160;three.”<br/>Do not&#160;apply&#160;this&#160;logic&#160;to&#160;the&#160;routines&#160;outlined in&#160;this&#160;section.&#160;These&#160;routines&#160;are&#160;not&#160;officially&#160;documented;&#160;<br/>even if&#160;they&#160;work now,&#160;they&#160;may&#160;stop&#160;working in&#160;the&#160;near future. Deprecated routines&#160;may&#160;still&#160;exist&#160;and&#160;<br/>they&#160;may&#160;work.&#160;They&#160;may&#160;also be&#160;removed at&#160;any&#160;time. Empty&#160;stubs&#160;exist, compile,&#160;and run, but&#160;do nothing.&#160;<br/>You may&#160;find older code&#160;that&#160;uses&#160;these&#160;legacy&#160;functions&#160;(see<a href="libremacros.html#229">&#160;Table&#160;86)</a>. I&#160;include&#160;CDec&#160;in the&#160;list&#160;because&#160;it&#160;<br/>is&#160;only&#160;listed&#160;on the&#160;Windows&#160;platform, which is&#160;just&#160;plain&#160;silly.<br/>
225<br/>
<hr/>
<a name=229></a><i><b>Table&#160;86.</b>&#160;Deprecated and questionable&#160;routines.</i><br/>
<i><b>Routine</b></i><br/>
<i><b>Comment</b></i><br/>
AboutStarBasic<br/>
Deprecated&#160;empty&#160;stub that&#160;used&#160;to be&#160;an&#160;information dialog.<br/>
SendKeys<br/>
Deprecated,&#160;generates an error.<br/>
DumpAllObjects(path,&#160;bool)<br/>
Internal&#160;debugging&#160;routine;&#160;no typical&#160;use&#160;known.<br/>
Load(Object)<br/>
Deprecated.<br/>
Unload(Object)<br/>
Deprecated.<br/>
LoadPicture(path)<br/>
Deprecated.&#160;Loads an image&#160;file.<br/>
SavePicture(obj,&#160;path)<br/>
Deprecated.&#160;Fails&#160;to save&#160;an image&#160;file.<br/>
CreatePropertySet(object)<br/>
Deprecated.&#160;Early&#160;UNO&#160;support&#160;function.<br/>
CDec(expression)<br/>
Generate&#160;a&#160;Decimal&#160;type;&#160;only&#160;implemented&#160;on&#160;Windows.<br/>
GetGUIVersion()<br/>
Deprecated,&#160;returns -1.<br/>
DumpAllObjects&#160;is&#160;an internal&#160;debugging&#160;routine&#160;that&#160;accepts&#160;two arguments.&#160;The&#160;first&#160;argument&#160;is&#160;a&#160;file&#160;<br/>name&#160;that&#160;will&#160;contain&#160;the&#160;text&#160;output.&#160;The&#160;second argument&#160;is&#160;a&#160;Boolean value&#160;that&#160;determines&#160;if each&#160;<br/>object&#160;should&#160;be&#160;fully&#160;loaded before&#160;it&#160;is&#160;dumped. For performance&#160;reasons, some&#160;properties&#160;are&#160;not&#160;created&#160;<br/>until&#160;they&#160;are&#160;accessed for the&#160;first&#160;time.&#160;This&#160;is&#160;true, even for BASIC&#160;objects&#160;that&#160;wrap UNO&#160;objects.<br/>
DumpAllObjects(&#34;C:\foo.txt&#34;,&#160;true)&#160;&#160;'Fully load all objects before dumping<br/>
The&#160;LoadPicture&#160;and SavePicture&#160;routines&#160;refer to&#160;the&#160;old&#160;BASIC dialogs&#160;that&#160;are&#160;not&#160;implemented&#160;using&#160;<br/>UNO.&#160;The&#160;object&#160;returned by&#160;LoadPicture&#160;was&#160;used to&#160;set&#160;a&#160;picture&#160;on an image&#160;control.&#160;There&#160;is&#160;now&#160;an&#160;<br/>image&#160;control&#160;that&#160;uses&#160;the&#160;UNO&#160;API&#160;to set&#160;the&#160;picture.<br/>
Dim&#160;v<br/>v&#160;=&#160;LoadPicture(&#34;C:\test1.jpg&#34;)&#160;'This seems to load the picture<br/>SavePicture(v,&#160;&#34;C:\test2.jpg&#34;)&#160;&#160;'This writes a zero length file<br/>
The&#160;CreatePropertySet&#160;function accepts&#160;an object&#160;as&#160;an argument&#160;and returns&#160;a&#160;property&#160;set.&#160;The&#160;property&#160;set<br/>is&#160;empty&#160;and not&#160;very&#160;useful.&#160;This&#160;function was&#160;created&#160;when the&#160;UNO&#160;functionality&#160;was&#160;first&#160;introduced,&#160;<br/>and will&#160;be&#160;removed from&#160;the&#160;source&#160;code&#160;in&#160;the&#160;future. If&#160;you&#160;find code&#160;that&#160;uses&#160;this&#160;function,&#160;I&#160;<br/>recommend that&#160;you&#160;change&#160;it.<br/>
v&#160;=&#160;CreatePropertySet(ThisComponent.Text)<br/>
<i><b>&#160;9.9.&#160;Routines&#160;I&#160;do&#160;not&#160;understand<br/></b></i>I&#160;find functions&#160;by&#160;reading the&#160;source&#160;code, some&#160;I&#160;understand&#160;and some&#160;I&#160;do not.&#160;This&#160;section contains&#160;the&#160;<br/>functions&#160;that&#160;I&#160;have&#160;not&#160;been able&#160;to&#160;satisfactorily&#160;document.&#160;<br/>
<i><b>Table&#160;87.</b>&#160;Functions&#160;I do not&#160;fully&#160;understand.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
EnableReschedule(bool)<br/>Me<br/>RTL<br/>
&#160;<br/>
GetDialogZoomFactorX()<br/>
The&#160;factor&#160;by&#160;which a&#160;dialog is&#160;scaled&#160;in the&#160;X&#160;direction. Used&#160;while&#160;determining&#160;how&#160;to&#160;<br/>
scale&#160;an image&#160;for&#160;preview.<br/>
GetDialogZoomFactorY()<br/>
The&#160;factor&#160;by&#160;which a&#160;dialog is&#160;scaled&#160;in the&#160;Y&#160;direction.<br/>
226<br/>
<hr/>
<a name=230></a>EnableReschedule&#160;accepts&#160;a&#160;boolean argument.&#160;I&#160;have&#160;found neither usage&#160;nor documentation&#160;for this&#160;<br/>method,&#160;so, I&#160;have&#160;only&#160;speculation as&#160;to&#160;its&#160;purpose. I&#160;speculate&#160;that&#160;OOo sometimes&#160;reschedules&#160;things,&#160;<br/>perhaps&#160;events,&#160;and that&#160;sometimes&#160;rescheduling should not&#160;be&#160;allowed;&#160;say&#160;during a&#160;callback. Use&#160;<br/>EnableReschedule&#160;to&#160;enable,&#160;or disable, the&#160;internal&#160;reschedule&#160;flag. It&#160;is&#160;problematic&#160;that&#160;there&#160;is&#160;no method<br/>to determine&#160;the&#160;current&#160;state,&#160;so you cannot&#160;set&#160;it&#160;and then&#160;restore&#160;it.&#160;It&#160;appears, however,&#160;that&#160;the&#160;default&#160;<br/>state&#160;is&#160;enabled.<br/>
Me&#160;is&#160;available&#160;in the&#160;.Net&#160;world to&#160;reference&#160;the&#160;class&#160;or structure&#160;in&#160;which&#160;the&#160;code&#160;is&#160;executing. It&#160;is&#160;not&#160;<br/>clear to&#160;me&#160;how&#160;to generate&#160;a&#160;valid call&#160;using&#160;Me&#160;at&#160;this&#160;point.&#160;If&#160;Me&#160;is&#160;not&#160;used in the&#160;correct&#160;context,&#160;an&#160;<br/>error occurs.<br/>
RTL&#160;appears&#160;to&#160;return a&#160;reference&#160;of the&#160;run time&#160;library,&#160;but,&#160;I&#160;am&#160;not&#160;clear on this&#160;point.&#160;My&#160;guess&#160;is&#160;that&#160;if&#160;<br/>I&#160;could use&#160;this, then I&#160;might&#160;be&#160;able&#160;to&#160;do things&#160;such as&#160;access&#160;methods&#160;of the&#160;RTL&#160;and call&#160;them;&#160;but&#160;that&#160;<br/>is&#160;a&#160;wild&#160;guess.<br/>
GetDialogZoomFactorX&#160;and GetDialogZoomFactorY&#160;appear to&#160;be&#160;used to&#160;determine&#160;the&#160;scale&#160;factor to&#160;use&#160;<br/>so that&#160;a&#160;preview&#160;image&#160;will&#160;be&#160;properly&#160;displayed. In&#160;the&#160;very&#160;few&#160;examples&#160;that&#160;I&#160;have&#160;found, I&#160;always&#160;see&#160;<br/>code&#160;similar to&#160;the&#160;following:<br/>
widthToUse&#160;&#160;=&#160;GetDialogZoomFactorX(imageWidth)&#160;&#160;*&#160;imageWidth<br/>heightToUse&#160;=&#160;GetDialogZoomFactorY(imageHeight)&#160;*&#160;&#160;imageHeight<br/>
Brush up on your&#160;German&#160;and then&#160;read this:<a href="http://www.herger.net/staroffice/sbinteam/os/preview2.htm">&#160;http://www.herger.net/staroffice/sbinteam/os/preview2.htm. I</a>t&#160;<br/>is&#160;my&#160;opinion that&#160;you probably&#160;do not&#160;require&#160;these&#160;methods, but,&#160;I&#160;could be&#160;wrong.<br/>
<i><b>&#160;9.10.&#160;Conclusion<br/></b></i>This&#160;chapter contains&#160;a&#160;lot&#160;of subtle&#160;information. If&#160;you are&#160;using OOo Basic&#160;for the&#160;first&#160;time, consider&#160;<br/>reading&#160;the&#160;chapter again after you&#160;have&#160;more&#160;experience.&#160;The&#160;routines&#160;for inspecting&#160;variables&#160;are&#160;useful&#160;<br/>while&#160;evaluating returned objects. Knowledge&#160;of twips&#160;is&#160;required while&#160;trying&#160;to&#160;determine&#160;spacing&#160;and&#160;<br/>image&#160;sizes. Be&#160;certain&#160;to watch for deprecated routines&#160;so that&#160;can avoid using them.<br/>
227<br/>
<hr/>
<a name=231></a><b>&#160;10.&#160;Universal&#160;Network&#160;Objects<br/></b>The&#160;internals&#160;of OpenOffice.org&#160;are&#160;based on Universal&#160;Network Objects&#160;(UNO).&#160;This&#160;chapter introduces&#160;<br/>the&#160;subroutines&#160;and functions&#160;supported by&#160;OpenOffice.org&#160;Basic&#160;that&#160;are&#160;related to&#160;UNO.&#160;This&#160;chapter&#160;<br/>covers&#160;methods&#160;that&#160;create&#160;and inspect&#160;objects&#160;that&#160;are&#160;vital&#160;to the&#160;internals&#160;of OpenOffice.org.<br/>
Up to&#160;this&#160;point,&#160;I&#160;have&#160;mostly&#160;dealt&#160;with simple&#160;single&#160;value&#160;things&#160;such as&#160;string and integer.&#160;An object,&#160;&#160;<br/>however,&#160;usually&#160;contains&#160;many&#160;values&#160;and it&#160;also has&#160;methods;&#160;for example, you can access&#160;a&#160;document&#160;as&#160;<br/>a&#160;variable&#160;and access&#160;information&#160;about&#160;the&#160;document&#160;(data&#160;or properties), and call&#160;methods&#160;that&#160;manipulate&#160;<br/>the&#160;document.<br/>
In&#160;this&#160;chapter,&#160;I&#160;begin to&#160;discuss&#160;things&#160;related&#160;to the&#160;actual&#160;implementation&#160;of OOo&#160;—&#160;things&#160;that&#160;allow&#160;<br/>you&#160;to&#160;exploit&#160;the&#160;internal&#160;capabilities&#160;of OOo.&#160;You’ll&#160;also begin to&#160;see&#160;more&#160;details&#160;about&#160;how&#160;OOo is&#160;<br/>implemented&#160;—&#160;which you&#160;need to&#160;build&#160;the&#160;really&#160;cool&#160;stuff.<br/>
Are&#160;you&#160;a&#160;programmer or a&#160;highly&#160;technical&#160;person?&#160;If&#160;not,&#160;skip this&#160;paragraph and go&#160;directly&#160;to the&#160;tip.&#160;<br/>Still&#160;reading?&#160;Great, so UNO&#160;is:<br/>
•<br/>
The&#160;interface&#160;based component&#160;model&#160;for OOo.&#160;<br/>
•<br/>
Enables&#160;interoperability&#160;between programming&#160;languages, object&#160;models&#160;and hardware&#160;architectures,<br/>either in&#160;process&#160;or over process&#160;boundaries, as&#160;well&#160;as&#160;in the&#160;intranet&#160;or the&#160;Internet.<br/>
•<br/>
New&#160;languages&#160;are&#160;supported&#160;by&#160;adding&#160;a&#160;language&#160;binding.&#160;This&#160;is&#160;also&#160;stated as&#160;adding a&#160;“bridge”&#160;<br/>or “adapter”.&#160;This&#160;paradigm&#160;makes&#160;it&#160;easier to support&#160;multiple&#160;languages.<br/>
•<br/>
UNO&#160;components&#160;may&#160;be&#160;implemented&#160;in, and accessed from, any&#160;programming language&#160;with a&#160;<br/>complete&#160;language&#160;binding.<br/>
<b>TIP</b><br/>
You can write&#160;powerful&#160;macros without&#160;fully&#160;understand Universal&#160;Network Objects. Just&#160;think&#160;of&#160;a&#160;UNO&#160;<br/>
as any&#160;object&#160;that&#160;is used&#160;internally&#160;by&#160;OOo.<br/>
Stated&#160;more&#160;simply:&#160;The&#160;internal&#160;parts&#160;of OOo are&#160;used as&#160;Universal&#160;Network Objects. By&#160;using UNOs, it&#160;is&#160;<br/>possible&#160;to&#160;access&#160;an instance&#160;of OOo running&#160;on a&#160;different&#160;computer and operating system.&#160;A&#160;vague&#160;<br/>understanding of Universal&#160;Network Objects&#160;is&#160;important&#160;because&#160;most&#160;of the&#160;internals&#160;of OpenOffice.org&#160;<br/>are&#160;implemented using UNO.&#160;<br/>
<a href="libremacros.html#232">Table&#160;88&#160;l</a>ists&#160;the&#160;OOo Basic&#160;functions&#160;used to deal&#160;with&#160;UNO.<br/>
228<br/>
<hr/>
<a name=232></a><i><b>Table&#160;88.</b>&#160;Functions&#160;related to&#160;Universal&#160;Network&#160;Objects&#160;in&#160;OOo Basic.</i><br/>
<i><b>Function</b></i><br/>
<i><b>Description</b></i><br/>
BasicLibraries<br/>
Access Basic&#160;libraries stored&#160;in a&#160;document.<br/>
CreateObject(obj_type)<br/>
Able&#160;to create&#160;any&#160;standard&#160;type,&#160;more&#160;flexible&#160;than&#160;<br/>CreateUnoStruct&#160;and&#160;CreateUnoService.<br/>
CreateUnoDialog()<br/>
Create&#160;an existing&#160;dialog.<br/>
CreateUnoListener()<br/>
Create&#160;a&#160;listener.<br/>
CreateUnoService()&#160;<br/>
Create&#160;a&#160;Universal&#160;Network&#160;Object&#160;Service.<br/>
CreateUnoStruct()<br/>
Create&#160;a&#160;Universal&#160;Network&#160;Object&#160;Structure.<br/>
CreateUnoValue()<br/>
Create&#160;a&#160;Universal&#160;Network&#160;Object&#160;value.<br/>
DialogLibraries<br/>
Access dialog&#160;libraries stored in&#160;a&#160;document.<br/>
EqualUNOObjects()<br/>
Determine&#160;if&#160;two UNO&#160;objects&#160;reference&#160;the&#160;same&#160;<br/>instance.<br/>
<i>FindObject()</i><br/>
<i>Find&#160;a named&#160;object;&#160;do&#160;not&#160;use.</i><br/>
<i>FindPropertyObject()</i><br/>
<i>Find&#160;object&#160;property&#160;based&#160;on&#160;name;&#160;do&#160;not&#160;use.</i><br/>
GetDefaultContext()<br/>
Get&#160;a&#160;copy&#160;of&#160;the&#160;default&#160;context.<br/>
GetProcessServiceManager()<br/>
Get&#160;service&#160;manager.<br/>
GlobalScope<br/>
Application-level&#160;libraries.<br/>
HasUnoInterfaces()<br/>
Does an object&#160;support&#160;specified&#160;interfaces?<br/>
IsUnoStruct()<br/>
Is&#160;this variable&#160;a&#160;Universal&#160;Network Object?<br/>
StarDesktop<br/>
Special&#160;variable&#160;representing&#160;the&#160;desktop object.<br/>
ThisComponent<br/>
Special&#160;variable&#160;representing&#160;the&#160;current&#160;document.<br/>
<i><b>&#160;10.1.&#160;Base&#160;types&#160;and&#160;structures<br/></b></i>Most&#160;of the&#160;internal&#160;data&#160;used by&#160;OOo is&#160;based on standard types&#160;such as&#160;strings&#160;and numbers.&#160;These&#160;types&#160;<br/>are&#160;combined&#160;into&#160;structures&#160;(called&#160;structs), which act&#160;like&#160;user-defined&#160;data&#160;types.&#160;The&#160;structures&#160;are&#160;<br/>combined&#160;to form&#160;more&#160;complex&#160;UNO&#160;objects.&#160;A&#160;struct&#160;supports&#160;properties&#160;but&#160;not&#160;methods.&#160;<br/>
A&#160;structure&#160;provides&#160;a&#160;method of placing more&#160;than one&#160;value&#160;into a&#160;single&#160;variable.&#160;You access&#160;the&#160;values&#160;in<br/>a&#160;structure&#160;based on a&#160;name&#160;that&#160;is&#160;decided when the&#160;struct&#160;type&#160;is&#160;designed by&#160;a&#160;programmer.&#160;A&#160;commonly&#160;<br/>used struct&#160;is&#160;the&#160;PropertyValue, whose&#160;primary&#160;purpose&#160;is&#160;to&#160;hold a&#160;string name&#160;and a&#160;variant&#160;value.&#160;The&#160;<br/>following&#160;listing&#160;demonstrates&#160;creating a&#160;PropertyValue&#160;structure&#160;and then setting the&#160;name&#160;and the&#160;value.&#160;<br/>The&#160;contained properties&#160;are&#160;accessed by&#160;placing a&#160;period&#160;between the&#160;variable&#160;and the&#160;property&#160;name.&#160;<br/>
<i><b>Listing&#160;203.</b>&#160;Use&#160;Dim&#160;As&#160;New to&#160;create&#160;a UNO&#160;structure.</i><br/>
Dim&#160;aProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>aProp.Name&#160;=&#160;&#34;FirstName&#34;&#160; &#160; &#160; &#160;'Set the Name property<br/>aProp.Value&#160;=&#160;&#34;Paterton&#34;&#160; &#160; &#160; &#160;'Set the Value property<br/>
<b>TIP</b><br/>
OOo objects have&#160;long&#160;names such&#160;as&#160;com.sun.star.beans.PropertyValue;&#160;in the&#160;text&#160;I&#160;usually&#160;abbreviate&#160;the<br/>name&#160;and&#160;simply&#160;write&#160;PropertyValue,&#160;but&#160;your&#160;macros must&#160;use&#160;the&#160;full&#160;name.<br/>
229<br/>
<hr/>
<a name=233></a>You must&#160;create&#160;(or obtain) a&#160;UNO&#160;structure&#160;before&#160;you&#160;can use&#160;it.&#160;The&#160;most&#160;common method to&#160;create&#160;a&#160;<br/>UNO&#160;structure&#160;is&#160;to&#160;use&#160;Dim&#160;As&#160;New&#160;(see<a href="libremacros.html#232">&#160;Listing 203)</a>.&#160;You can also use&#160;Dim&#160;to&#160;create&#160;an array&#160;of&#160;<br/>structures.<br/>
<i><b>Listing&#160;204.</b>&#160;Use&#160;Dim&#160;As&#160;New to&#160;create&#160;an array&#160;of&#160;UNO&#160;structures.<br/></i>Dim&#160;aProp(4)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>aProp(0).Name&#160;&#160;=&#160;&#34;FirstName&#34;&#160; &#160;'Set the Name property<br/>aProp(0).Value&#160;=&#160;&#34;Clyde&#34;&#160; &#160; &#160; &#160;'Set the Value property<br/>
Use&#160;the&#160;CreateUnoStruct&#160;function&#160;to&#160;create&#160;a&#160;UNO&#160;structure&#160;when it&#160;is&#160;needed rather than&#160;declare&#160;it&#160;ahead of<br/>time. Dynamically&#160;creating&#160;a&#160;UNO&#160;structure&#160;allows&#160;the&#160;name&#160;of the&#160;structure&#160;to be&#160;provided at&#160;run time&#160;<br/>rather than&#160;compile&#160;time.&#160;Providing&#160;a&#160;name&#160;at&#160;run time&#160;is&#160;shown i<a href="libremacros.html#233">n&#160;Listing&#160;205&#160;a</a><a href="libremacros.html#234">nd&#160;Listing&#160;208. P</a>roviding a&#160;<br/>name&#160;at&#160;compile&#160;time&#160;is&#160;shown in<a href="libremacros.html#232">&#160;Listing 203.</a><br/>
<i><b>Listing&#160;205.</b>&#160;Use&#160;CreateUnoStruct&#160;to create&#160;a UNO&#160;structure.<br/></i>Dim&#160;aProp<br/>aProp&#160;=&#160;CreateUnoStruct(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>aProp.Name&#160;=&#160;&#34;FirstName&#34;&#160; &#160; &#160; &#160;'Set the Name property<br/>aProp.Value&#160;=&#160;&#34;Andrew&#34; &#160;&#160; &#160; &#160; &#160;'Set the Value property<br/>
The&#160;With&#160;statement&#160;simplifies&#160;the&#160;process&#160;of setting&#160;the&#160;properties&#160;of a&#160;structure.<br/>
<i><b>Listing&#160;206.</b>&#160;Use&#160;With to&#160;simplify&#160;setting properties&#160;on structures.</i><br/>
Dim&#160;aProp(4)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>With&#160;aProp(0)<br/>&#160;&#160;.Name&#160;=&#160;&#34;FirstName&#34;&#160; &#160; &#160; &#160;'Set the Name property<br/>&#160;&#160;.Value&#160;=&#160;&#34;Paterton&#34;&#160; &#160; &#160; &#160;'Set the Value property<br/>End&#160;With<br/>
The&#160;function CreateUnoStruct&#160;used to&#160;be&#160;the&#160;only&#160;method&#160;to&#160;create&#160;a&#160;UNO&#160;structure. It&#160;is&#160;used less&#160;since&#160;the&#160;<br/>introduction&#160;of the&#160;“Dim&#160;As&#160;New”&#160;syntax.&#160;The&#160;CreateObject&#160;function&#160;is&#160;a&#160;more&#160;general&#160;function&#160;than&#160;<br/>CreateUnoStruct.&#160;It&#160;is&#160;able&#160;to&#160;create&#160;instances&#160;of all&#160;types&#160;supported&#160;by&#160;the&#160;Basic&#160;internal&#160;factory&#160;<br/>mechanism.&#160;This&#160;includes&#160;user-defined&#160;types.<br/>
<i><b>Listing&#160;207.</b>&#160;Create&#160;a user-defined&#160;type&#160;with&#160;CreateObject&#160;or&#160;Dim&#160;As.</i><br/>
Type&#160;PersonType<br/>&#160;&#160;FirstName&#160;As&#160;String<br/>&#160;&#160;LastName&#160;As&#160;String<br/>End&#160;Type<br/>
Sub&#160;ExampleCreateNewType<br/>&#160;&#160;Dim&#160;Person&#160;As&#160;PersonType<br/>&#160;&#160;Person.FirstName&#160;=&#160;&#34;Andrew&#34;<br/>&#160;&#160;Person.LastName&#160;&#160;=&#160;&#34;Pitonyak&#34;<br/>&#160;&#160;PrintPerson(Person)<br/>&#160;&#160;Dim&#160;Me&#160;As&#160;Object<br/>&#160;&#160;Me&#160;=&#160;CreateObject(&#34;PersonType&#34;)<br/>&#160;&#160;Me.FirstName&#160;=&#160;&#34;Andy&#34;<br/>&#160;&#160;Me.LastName&#160;&#160;=&#160;&#34;Pitonyak&#34;<br/>&#160;&#160;PrintPerson(Me)<br/>End&#160;Sub<br/>
Sub&#160;PrintPerson(x)<br/>&#160;&#160;Print&#160;&#34;Person = &#34;&#160;&amp;&#160;x.FirstName&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;x.LastName<br/>End&#160;Sub<br/>
230<br/>
<hr/>
<a name=234></a><b>TIP</b><br/>
For&#160;a&#160;user-defined type,&#160;“Dim&#160;As&#160;New”&#160;and&#160;“Dim&#160;As”&#160;both work. For&#160;a&#160;UNO&#160;struct, however,&#160;you&#160;must&#160;<br/>
use&#160;“Dim&#160;As&#160;New”.<br/>
The&#160;CreateObject&#160;function&#160;accepts&#160;the&#160;same&#160;arguments&#160;as&#160;CreateUnoStruct,&#160;but&#160;it&#160;works&#160;for all&#160;supported&#160;<br/>types, whereas&#160;CreateUnoStruct&#160;works&#160;only&#160;for UNO&#160;structures.&#160;Therefore, there&#160;is&#160;no reason to use&#160;<br/>CreateUnoStruct&#160;rather than&#160;CreateObject.<br/>
<i><b>Listing&#160;208.</b>&#160;Use&#160;CreateObject&#160;to create&#160;a UNO&#160;structure.</i><br/>
Dim&#160;aProp<br/>aProp&#160;=&#160;CreateObject(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>aProp.Name&#160;=&#160;&#34;FirstName&#34;&#160; &#160; &#160; &#160;'Set the Name property<br/>aProp.Value&#160;=&#160;&#34;Paterton&#34;&#160; &#160; &#160; &#160;'Set the Value property<br/>
<b>TIP</b><br/>
CreateObject&#160;offers more&#160;flexibility&#160;than CreateUnoStruct&#160;to dynamically&#160;create&#160;objects based&#160;on a&#160;name.<br/>
I&#160;wrote&#160;a&#160;small&#160;test&#160;program&#160;that&#160;created 20000 structs. CreateUnoStruct&#160;and CreateObject&#160;took about&#160;the&#160;<br/>same&#160;amount&#160;of time.&#160;Using Dim&#160;As&#160;New,&#160;however,&#160;used 500 clock ticks&#160;less, which&#160;is&#160;useful&#160;if you want&#160;to<br/>make&#160;a&#160;macro run as&#160;fast&#160;as&#160;possible.<br/>
The&#160;TypeName&#160;function indicates&#160;that&#160;a&#160;UNO&#160;structure&#160;is&#160;an object. Use&#160;the&#160;IsUnoStruct&#160;function to&#160;<br/>determine&#160;if a&#160;variable&#160;is&#160;a&#160;UNO&#160;structure.<br/>
<i><b>Listing&#160;209.</b>&#160;Use&#160;IsUnoStruct&#160;to&#160;check&#160;if&#160;an object&#160;is&#160;an UNO&#160;Struct.<br/></i>Dim&#160;aProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>Print&#160;TypeName(aProp)&#160; &#160; &#160;'Object<br/>Print&#160;IsUnoStruct(aProp)&#160;&#160;'True<br/>
<i><b>&#160;10.2.&#160;UNO&#160;interface<br/></b></i>An interface&#160;defines&#160;how&#160;something interacts&#160;with its&#160;environment.&#160;A&#160;UNO&#160;interface&#160;resembles&#160;a&#160;group of&#160;<br/>subroutine&#160;and function&#160;declarations;&#160;arguments&#160;and return&#160;types&#160;are&#160;specified along with functionality.&#160;<br/>
You can use&#160;the&#160;interface&#160;to&#160;retrieve&#160;data&#160;from&#160;an object, set&#160;data&#160;in an object,&#160;or tell&#160;an object&#160;to do&#160;<br/>something.&#160;The&#160;interface&#160;indicates&#160;how&#160;an object&#160;can be&#160;used, but&#160;it&#160;says&#160;nothing about&#160;the&#160;implementation.&#160;<br/>For&#160;example, if an interface&#160;contains&#160;the&#160;method&#160;GetHeight&#160;that&#160;returns&#160;an integer,&#160;it’s&#160;natural&#160;to&#160;assume&#160;that<br/>the&#160;object&#160;contains&#160;an integer property&#160;named&#160;Height.&#160;It’s&#160;possible,&#160;however,&#160;that&#160;the&#160;height&#160;is&#160;derived&#160;or&#160;<br/>calculated&#160;from&#160;other properties.&#160;The&#160;interface&#160;does&#160;not&#160;specify&#160;how&#160;the&#160;height&#160;is&#160;obtained, just&#160;that&#160;it&#160;is&#160;<br/>available.&#160;A&#160;UNO&#160;structure, however,&#160;contains&#160;properties&#160;that&#160;are&#160;accessed directly;&#160;the&#160;internal&#160;<br/>representation&#160;is&#160;not&#160;hidden.<br/>
<b>TIP</b><br/>
UNO&#160;interface&#160;names start&#160;with&#160;the&#160;capital&#160;letter&#160;X.<br/>When&#160;you want&#160;to&#160;know&#160;what&#160;methods are&#160;supported&#160;by&#160;an object,&#160;check&#160;the&#160;interfaces.<br/>
UNO&#160;interface&#160;names&#160;start&#160;with&#160;the&#160;capital&#160;letter X, which makes&#160;it&#160;easy&#160;to&#160;recognize&#160;an interface;&#160;for&#160;<br/>example,&#160;the&#160;interface&#160;com.sun.star.text.XTextRange&#160;specifies&#160;a&#160;section of text&#160;with&#160;both a&#160;start&#160;and end&#160;<br/>position. Objects&#160;that&#160;support&#160;the&#160;XTextRange&#160;interface&#160;are&#160;also used to identify&#160;an object’s&#160;position in&#160;text&#160;<br/>document.&#160;The&#160;start&#160;and end positions&#160;may&#160;be&#160;the&#160;same.&#160;The&#160;XTextRange&#160;interface&#160;defines&#160;the&#160;methods&#160;i<a href="libremacros.html#235">n<br/>Table&#160;89.</a><br/>
231<br/>
<hr/>
<a name=235></a><i><b>Table&#160;89.</b>&#160;Methods&#160;defined by&#160;the&#160;com.sun.star.text.XTextRange&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getText()<br/>
Return the&#160;com.sun.star.text.XText&#160;interface&#160;that&#160;contains&#160;this&#160;XTextRange.<br/>
getStart()<br/>
Return a&#160;com.sun.star.text.XTextRange&#160;that&#160;references only&#160;the&#160;start&#160;position.<br/>
getEnd()<br/>
Return a&#160;com.sun.star.text.XTextRange&#160;that&#160;references only&#160;the&#160;end&#160;position.<br/>
getString()<br/>
Return a&#160;string&#160;that&#160;includes the&#160;text&#160;inside&#160;this&#160;text&#160;range.<br/>
setString(str)<br/>
Set&#160;the&#160;string&#160;for&#160;this&#160;text&#160;range,&#160;replacing&#160;existing&#160;text&#160;and clearing&#160;all&#160;styles.<br/>
<b>TIP</b><br/>
A&#160;UNO&#160;interface&#160;may&#160;be&#160;derived from&#160;another.&#160;Every&#160;UNO&#160;interface&#160;is required&#160;to be&#160;derived&#160;from&#160;<br/>
com.sun.star.uno.XInterface.<br/>
A&#160;new&#160;UNO&#160;interface&#160;may&#160;be&#160;derived from&#160;another.&#160;This&#160;is&#160;not&#160;something that&#160;you do, but&#160;rather it’s&#160;<br/>something that&#160;is&#160;done&#160;by&#160;the&#160;designer of the&#160;interface.&#160;The&#160;derived interface&#160;supports&#160;all&#160;of the&#160;methods&#160;<br/>defined&#160;in the&#160;interface&#160;from&#160;which&#160;it&#160;is&#160;derived. For example,&#160;the&#160;com.sun.star.text.XTextCursor extends&#160;<br/>the&#160;XTextRange&#160;interface&#160;to&#160;allow&#160;it&#160;to&#160;change&#160;the&#160;range, which makes&#160;sense&#160;if you&#160;think about&#160;what&#160;you&#160;do&#160;<br/>with a&#160;cursor.&#160;Any&#160;object&#160;that&#160;implements&#160;the&#160;XTextCursor interface, supports&#160;the&#160;methods&#160;i<a href="libremacros.html#235">n&#160;Table&#160;89&#160;a</a>nd&#160;<br/>the&#160;new&#160;methods&#160;introduced by&#160;the&#160;XTextCursor interface.&#160;<br/>
The&#160;main&#160;points&#160;regarding interfaces&#160;(so far) are:<br/>
1)&#160;An interface&#160;defines&#160;methods.&#160;In&#160;other words, an interface&#160;defines&#160;what&#160;an object&#160;can do;&#160;including&#160;<br/>
getting&#160;and setting&#160;internal&#160;properties.<br/>
2)&#160;An interface&#160;may&#160;be&#160;derived&#160;from&#160;another interface.<br/>
3)&#160;The&#160;last&#160;portion&#160;of an interface&#160;name&#160;begins&#160;with&#160;an X.<br/>
In&#160;UNO, objects&#160;are&#160;accessed by&#160;their&#160;interface. Many&#160;of the&#160;programming languages, such as&#160;Java&#160;and C++,<br/>force&#160;you&#160;to&#160;perform&#160;a&#160;little&#160;UNO&#160;magic&#160;and extract&#160;the&#160;correct&#160;interface&#160;before&#160;you can call&#160;the&#160;methods&#160;<br/>defined&#160;in the&#160;interface. OOo Basic&#160;hides&#160;these&#160;details&#160;for you&#160;so that&#160;you&#160;can directly&#160;call&#160;methods&#160;and&#160;<br/>access&#160;properties&#160;directly.<br/>
<b>TIP</b><br/>
OOo Basic&#160;hides many&#160;of&#160;the&#160;complicated&#160;details,&#160;so, for&#160;most&#160;things, it&#160;is easier&#160;to write&#160;an OOo&#160;Basic&#160;<br/>program&#160;than to write&#160;a&#160;Java&#160;script.<br/>
<i><b>&#160;10.3.&#160;UNO&#160;service<br/></b></i>A&#160;service&#160;abstractly&#160;defines&#160;an object&#160;by&#160;combining&#160;interfaces&#160;and properties&#160;to&#160;encapsulate&#160;some&#160;useful&#160;<br/>functionality.&#160;A&#160;UNO&#160;interface&#160;defines&#160;how&#160;an object&#160;interacts&#160;with&#160;the&#160;outside&#160;world;&#160;a&#160;UNO&#160;structure&#160;<br/>defines&#160;a&#160;collection&#160;of data;&#160;and a&#160;UNO&#160;service&#160;combines&#160;them&#160;together.&#160;Like&#160;a&#160;UNO&#160;interface, a&#160;UNO&#160;<br/>service&#160;does&#160;not&#160;specify&#160;the&#160;implementation. It&#160;only&#160;specifies&#160;how&#160;to&#160;interact&#160;with the&#160;object.&#160;<br/>
Almost&#160;every&#160;UNO&#160;object&#160;is&#160;defined&#160;by&#160;a&#160;service, so UNO&#160;objects&#160;are&#160;called&#160;services. Strictly&#160;speaking,&#160;<br/>however,&#160;“a&#160;service”&#160;is&#160;the&#160;object&#160;definition.&#160;The&#160;UNO&#160;object&#160;is&#160;the&#160;actual&#160;object&#160;created as&#160;defined by&#160;the&#160;<br/>service.&#160;A&#160;service&#160;may&#160;include&#160;multiple&#160;services&#160;and interfaces.&#160;An interface&#160;usually&#160;defines&#160;a&#160;single&#160;aspect&#160;<br/>of a&#160;service&#160;and therefore&#160;is&#160;usually&#160;smaller in scope.<br/>
Many&#160;services&#160;have&#160;a&#160;name&#160;similar to&#160;an interface&#160;name;&#160;for example, one&#160;of the&#160;interfaces&#160;exported by&#160;the&#160;<br/>TextCursor service&#160;is&#160;the&#160;XTextCursor interface.&#160;An interface&#160;or property&#160;may&#160;be&#160;declared as&#160;optional&#160;for a&#160;<br/>service.&#160;The&#160;XWordCursor interface&#160;is&#160;marked as&#160;optional&#160;for the&#160;TextCursor service.&#160;The&#160;implication&#160;is&#160;that<br/>
232<br/>
<hr/>
<a name=236></a>not&#160;all&#160;text&#160;cursors&#160;support&#160;the&#160;word cursor interface. In&#160;practice, you learn which text&#160;cursors&#160;support&#160;which<br/>interfaces&#160;and then simply&#160;use&#160;them.<br/>
There&#160;are&#160;two typical&#160;methods&#160;for obtaining a&#160;service.&#160;<br/>
•<br/>
Get&#160;a&#160;reference&#160;to&#160;an existing object;&#160;for example, retrieving the&#160;first&#160;text&#160;table&#160;in&#160;the&#160;current&#160;<br/>document.<br/>
•<br/>
Ask a&#160;service&#160;factory&#160;to&#160;create&#160;an instance&#160;of an object;&#160;for example, if I&#160;want&#160;to&#160;insert&#160;a&#160;new&#160;text&#160;<br/>table&#160;into&#160;a&#160;document, I&#160;ask the&#160;document&#160;to&#160;give&#160;me&#160;a&#160;new&#160;empty&#160;table,&#160;which&#160;I&#160;then configure&#160;and&#160;<br/>insert&#160;into the&#160;document.<br/>
A&#160;service&#160;factory&#160;returns&#160;objects&#160;based on the&#160;name.&#160;The&#160;process&#160;service&#160;manager is&#160;the&#160;main object&#160;factory&#160;<br/>for OpenOffice.org.&#160;The&#160;factory&#160;is&#160;given the&#160;service&#160;name,&#160;and the&#160;factory&#160;decides&#160;what&#160;to&#160;return.&#160;A&#160;factory&#160;<br/>may&#160;return a&#160;brand new&#160;instance&#160;of an object, or,&#160;it&#160;may&#160;return&#160;an existing instance. Use&#160;<br/>GetProcessServiceManager() to&#160;obtain&#160;a&#160;reference&#160;to&#160;the&#160;process&#160;service&#160;manager.&#160;Use&#160;CreateInstance&#160;to&#160;<br/>create&#160;a&#160;service&#160;from&#160;the&#160;process&#160;service&#160;manager as&#160;shown in<a href="libremacros.html#236">&#160;Listing 210.&#160;</a><br/>
<i><b>Listing&#160;210.</b>&#160;Use&#160;process&#160;service&#160;manager&#160;to&#160;create&#160;a service.<br/></i>Sub&#160;ManagerCreatesAService<br/>&#160;&#160;Dim&#160;vFileAccess<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dim&#160;vManager<br/>&#160;&#160;vManager&#160;=&#160;GetProcessServiceManager()<br/>&#160;&#160;vFileAccess&#160;=&#160;vManager.CreateInstance(&#34;com.sun.star.ucb.SimpleFileAccess&#34;)<br/>&#160;&#160;s&#160;=&#160;vFileAccess.getContentType(&#34;http://www.pitonyak.org/AndrewMacro.odt&#34;)<br/>&#160;&#160;Print&#160;s<br/>End&#160;Sub<br/>
The&#160;code&#160;in<a href="libremacros.html#236">&#160;Listing 210&#160;obt</a>ains&#160;the&#160;process&#160;service&#160;manager,&#160;creates&#160;an instance&#160;of the&#160;SimpleFileAccess&#160;<br/>service, and then uses&#160;the&#160;created&#160;service.&#160;The&#160;CreateUnoService&#160;function is&#160;a&#160;shortcut&#160;for creating a&#160;UNO&#160;<br/>service&#160;(see<a href="libremacros.html#236">&#160;Listing&#160;211)</a>.&#160;The&#160;purpose<a href="libremacros.html#236">&#160;of&#160;Listing 211&#160;i</a>s&#160;to demonstrate&#160;the&#160;CreateUnoService&#160;function,&#160;<br/>showing&#160;that&#160;it’s&#160;simpler than creating a&#160;service&#160;manager.<a href="libremacros.html#236">&#160;Listing 211&#160;a</a>lso demonstrates&#160;some&#160;useful&#160;<br/>functionality,&#160;using&#160;a&#160;dialog to&#160;choose&#160;a&#160;file.<br/>
<i><b>Listing&#160;211.</b>&#160; Select&#160;a file&#160;on disk.<br/></i>Function&#160;ChooseAFileName()&#160;As&#160;String<br/>&#160;&#160;Dim&#160;vFileDialog&#160; &#160; &#160; &#160; &#160;'FilePicker service instance<br/>&#160;&#160;Dim&#160;vFileAccess&#160; &#160; &#160; &#160; &#160;'SimpleFileAccess service instance<br/>&#160;&#160;Dim&#160;iAccept&#160;as&#160;Integer&#160;&#160;'Response to the FilePicker<br/>&#160;&#160;Dim&#160;sInitPath&#160;as&#160;String&#160;'Hold the initial path<br/>&#160;&#160;'Note: The following services MUST be called in the following order<br/>&#160;&#160;'or Basic will not remove the FileDialog Service<br/>&#160;&#160;vFileDialog&#160;=&#160;CreateUnoService(&#34;com.sun.star.ui.dialogs.FilePicker&#34;)<br/>&#160;&#160;vFileAccess&#160;=&#160;CreateUnoService(&#34;com.sun.star.ucb.SimpleFileAccess&#34;)<br/>&#160;&#160;'Set the initial path here!<br/>&#160;&#160;sInitPath&#160;=&#160;ConvertToUrl(CurDir)<br/>&#160;&#160;If&#160;vFileAccess.Exists(sInitPath)&#160;Then<br/>&#160; &#160;&#160;vFileDialog.SetDisplayDirectory(sInitPath)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;iAccept&#160;=&#160;vFileDialog.Execute()&#160; &#160; &#160; &#160;'Run the file chooser dialog<br/>&#160;&#160;If&#160;iAccept&#160;=&#160;1&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'What was the return value?<br/>&#160; &#160;&#160;ChooseAFileName&#160;=&#160;vFileDialog.Files(0)&#160;'Set file name if it was not canceled<br/>
233<br/>
<hr/>
<a name=237></a>&#160;&#160;End&#160;If<br/>&#160;&#160;vFileDialog.Dispose()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Dispose of the dialog<br/>End&#160;Function<br/>
A&#160;directory&#160;can be&#160;chosen similarly.<br/>
<i><b>Listing&#160;212.</b>&#160; Select&#160;a directory.<br/></i>REM sInPath specifies the initial directory. If the initial directory<br/>REM is not specified, then the user's default work directory is used.<br/>REM The selected directory is returned as a URL.<br/>Function&#160;ChooseADirectory(Optional&#160;sInPath$)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;oDialog&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;oSFA&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dim&#160;&#160;oPathSettings<br/>
&#160;&#160;oDialog&#160;=&#160;CreateUnoService(&#34;com.sun.star.ui.dialogs.FolderPicker&#34;)<br/>&#160;&#160;'oDialog = CreateUnoService(&#34;com.sun.star.ui.dialogs.OfficeFolderPicker&#34;)<br/>&#160;&#160;oSFA&#160;=&#160;createUnoService(&#34;com.sun.star.ucb.SimpleFileAccess&#34;)<br/>&#160;<br/>&#160;&#160;If&#160;IsMissing(sInPath)&#160;Then<br/>&#160;&#160;oPathSettings&#160;=&#160;CreateUnoService(&#34;com.sun.star.util.PathSettings&#34;)<br/>&#160; &#160;&#160;oDialog.setDisplayDirectory(oPathSettings.Work)<br/>&#160;&#160;ElseIf&#160;oSFA.Exists(sInPath)&#160;Then<br/>&#160; &#160;&#160;oDialog.setDisplayDirectory(sInPath)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;Directory '&#34;&#160;&amp;&#160;sInPath&#160;&amp;&#160;&#34;' Does not exist&#34;<br/>&#160; &#160;&#160;If&#160;MsgBox(s,&#160;33,&#160;&#34;Error&#34;)&#160;=&#160;2&#160;Then&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>&#160;<br/>&#160;&#160;If&#160;oDialog.Execute()&#160;=&#160;1&#160;Then<br/>&#160; &#160;&#160;ChooseADirectory()&#160;=&#160;oDialog.getDirectory()<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
<b>TIP</b><br/>
The&#160;file&#160;picker&#160;and folder&#160;picker&#160;dialogs can use&#160;either&#160;the&#160;operating&#160;system&#160;supplied&#160;default&#160;dialogs,&#160;or&#160;<br/>
OOo specific&#160;dialogs.&#160;The&#160;operating&#160;system&#160;specific&#160;dialogs provide&#160;less functionality;&#160;for&#160;example,&#160;you&#160;<br/>cannot&#160;set&#160;the&#160;initial&#160;displayed&#160;directory.&#160;Use&#160;<b>Tools &gt; Options &gt; OpenOffice.org&#160;&gt;&#160;General</b>&#160;and place&#160;a&#160;<br/>
check&#160;next&#160;to &#34;Use&#160;OpenOffice.org&#160;dialogs&#34;.<br/>
The&#160;code&#160;in<a href="libremacros.html#236">&#160;Listing 211&#160;c</a>reates&#160;two UNO&#160;services&#160;by&#160;using&#160;the&#160;function CreateUnoService.&#160;There&#160;are&#160;times,<br/>however,&#160;when the&#160;service&#160;manager is&#160;required. For&#160;example, the&#160;service&#160;manager has&#160;methods&#160;to create&#160;a&#160;<br/>service&#160;with&#160;arguments, CreateInstanceWithArguments, and to obtain a&#160;list&#160;of all&#160;supported services,&#160;<br/>getAvailableServiceNames().&#160;The&#160;code&#160;i<a href="libremacros.html#237">n&#160;Listing&#160;213&#160;obt</a>ains&#160;a&#160;list&#160;of the&#160;supported service&#160;names;&#160;there&#160;are<br/>1003 services&#160;on my&#160;computer using OOo version 3.2.1;&#160;up from&#160;562 with OOo version&#160;1.<br/>
<i><b>Listing&#160;213.</b>&#160;Service&#160;manager&#160;supports&#160;services.</i><br/>
Sub&#160;HowManyServicesSupported<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;&#160;' Document created to hold the service names.<br/>&#160;&#160;Dim&#160;oText&#160; &#160; &#160; &#160; &#160;' Document text object.<br/>&#160;&#160;Dim&#160;oSD&#160; &#160; &#160; &#160; &#160; &#160;' SortDescriptor created for the document.<br/>&#160;&#160;Dim&#160;oCursor&#160; &#160; &#160; &#160;' Text cursor used for sorting.<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160; &#160;&#160;' Index Variable.<br/>&#160;&#160;Dim&#160;sServices<br/>
234<br/>
<hr/>
<a name=238></a>&#160;&#160;sServices&#160;=&#160;GetProcessServiceManager().getAvailableServiceNames()<br/>&#160;&#160;Print&#160;&#34;Service manager supports &#34;;UBound(sServices);&#34; services&#34;<br/>&#160;&#160;' Create a Writer document.<br/>
&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#160;&#34;private:factory/swriter&#34;,&#160;&#34;_blank&#34;,&#160;0,&#160;Array()&#160;)<br/>&#160;&#160;oText&#160;=&#160;oDoc.getText()<br/>&#160; &#160;<br/>&#160;&#160;' Print the service names into a Writer document.<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(&#160;sServices&#160;)&#160;To&#160;UBound(&#160;sServices&#160;)<br/>&#160; &#160;&#160;oText.insertString(&#160;oText.getEnd(),&#160;sServices(i),&#160;False&#160;)<br/>&#160; &#160;&#160;' Do not insert a blank line at the end.<br/>&#160; &#160;&#160;oText.insertControlCharacter(&#160;oText.getEnd(),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK,&#160;False&#160;)<br/>&#160;&#160;Next<br/>&#160;&#160;<br/>&#160;&#160;oCursor&#160;=&#160;oDoc.Text.CreateTextCursorByRange(oDoc.Text)<br/>&#160;&#160;oSD&#160;=&#160;oCursor.createSortDescriptor()<br/>&#160;&#160;oCursor.sort(oSD)<br/>&#160;&#160;<br/>&#160;&#160;oText.insertString(&#160;oText.getStart(),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#34;Service manager supports &#34;&amp;UBound(sServices)&amp;&#34; services&#34;,&#160;False&#160;)<br/>End&#160;Sub<br/>
It&#160;is&#160;useful&#160;to look&#160;at&#160;the&#160;list&#160;of supported&#160;services.&#160;This&#160;provides&#160;insight&#160;into&#160;available&#160;functionality&#160;that&#160;you<br/>can explore.&#160;A&#160;great&#160;example&#160;of this&#160;is&#160;show<a href="libremacros.html#238">n&#160;Listing 214.&#160;</a>An object&#160;inserted into a&#160;document&#160;must&#160;be&#160;<br/>created by&#160;that&#160;document. Using the&#160;methods<a href="libremacros.html#237">&#160;of&#160;Listing 213, y</a>ou&#160;can check to&#160;see&#160;what&#160;types&#160;of objects&#160;the&#160;<br/>document&#160;can create.&#160;<br/>
<i><b>Listing&#160;214.</b>&#160;What&#160;objects&#160;can a document&#160;create.<br/></i>REM Print the object / service types that a document can create.<br/>REM If the document (oDoc) is missing, the current document is used.<br/>REM If nameFilter is included, then service names that contain<br/>REM the string are printed; based on a case insensitive compare.<br/>REM The service names are stored in a newly created Write document.<br/>Sub&#160;TypesDocCanCreate(Optional&#160;oDoc, Optional&#160;nameFilter$)<br/>&#160; Dim&#160;allNames&#160; &#160;' List of all the names.<br/>&#160; Dim&#160;oWriteDoc&#160;&#160;' Newly created Write document to contain the names.<br/>&#160; Dim&#160;oText&#160; &#160; &#160;&#160;' Document text object.<br/>&#160; Dim&#160;s&#160;:&#160;s&#160;=&#160;&#34;private:factory/swriter&#34;<br/>
&#160;&#160;' Find out what this document can create. &#160;<br/>&#160; If IsMissing(oDoc) Then<br/>&#160; &#160;&#160;allNames&#160;= ThisComponent.getAvailableServiceNames()<br/>&#160; Else<br/>&#160; &#160;&#160;allNames&#160;=&#160;oDoc.getAvailableServiceNames()<br/>&#160; End If<br/>
&#160;&#160;' Create a new Write document to contain the list.<br/>&#160;&#160;oWriteDoc&#160;= StarDesktop.loadComponentFromURL(s,&#160;&#34;_blank&#34;,&#160;0, Array())<br/>&#160;&#160;oText&#160;=&#160;oWriteDoc.getText()<br/>&#160; If IsMissing(nameFilter) Then<br/>&#160; &#160;&#160;oText.insertString&#160;(&#160;oText.End, Join(allNames, CHR$(13)),&#160;False&#160;)<br/>
235<br/>
<hr/>
<a name=239></a>&#160; Else<br/>&#160; &#160; Dim&#160;i%<br/>&#160; &#160; For&#160;i&#160;= LBound(allNames) To UBound(allNames)<br/>&#160; &#160; &#160; If (InStr(allNames(i),&#160;nameFilter) &gt;&#160;0) Then<br/>&#160; &#160; &#160; &#160;&#160;' Insert the text.<br/>&#160; &#160; &#160; &#160;&#160;oText.insertString&#160;(&#160;oText.End,&#160;allNames(i),&#160;False&#160;)<br/>&#160; &#160; &#160; &#160;&#160;<br/>&#160; &#160; &#160; &#160;&#160;' Insert a new paragraph.<br/>&#160; &#160; &#160; &#160;&#160;oText.InsertControlCharacter(oText.getEnd(),_<br/>&#160; &#160; &#160; &#160; &#160; &#160;com.sun.star.text.ControlCharacter.APPEND_PARAGRAPH,&#160;False)<br/>&#160; &#160; &#160; End If<br/>&#160; &#160; Next<br/>&#160; End If<br/>End Sub&#160;<br/>
<b>&#160;10.3.1.&#160;Setting&#160;a&#160;Read-Only&#160;Value<br/></b>Some&#160;values&#160;can be&#160;set&#160;only&#160;once, so changing&#160;the&#160;value&#160;requires&#160;creating a&#160;new&#160;object.&#160;As&#160;an example,&#160;<br/>consdier:<br/>
•<br/>
A&#160;Calc&#160;sheet&#160;with combox&#160;controls&#160;(com.sun.star.awt.UnoControlComboBoxModel).<br/>
•<br/>
The&#160;controls&#160;are&#160;anchored to&#160;cells.<br/>
•<br/>
Each control&#160;bound to&#160;a&#160;cell.<br/>
•<br/>
Write&#160;a&#160;macro that&#160;finds&#160;each combobox&#160;and bind&#160;it&#160;to the&#160;cell&#160;in which it&#160;is&#160;anchored.<br/>
The&#160;obvious&#160;way&#160;to change&#160;the&#160;bound cell&#160;is&#160;to&#160;access&#160;and change&#160;the&#160;bound cell&#160;doing something&#160;like&#160;the&#160;<br/>following&#160;code&#160;that&#160;fails&#160;because&#160;ValueBinding&#160;is&#160;read-only:<br/>
' BoundCell is a struct, so copy the value out, change it and write it back.<br/>oBoundCell&#160;=&#160;oControlDataModel.ValueBinding.BoundCell<br/>oBoundCell.Column&#160;=&#160;6<br/>oBoundCell.Row&#160;=&#160;6<br/>oBoundCell.Sheet&#160;=&#160;0<br/>oControlDataModel.ValueBinding.BoundCell&#160;=&#160;oBoundCell<br/>
If&#160;you&#160;create&#160;a&#160;new&#160;value&#160;binding object&#160;and try&#160;to set&#160;the&#160;BoundCell&#160;property,&#160;this&#160;still&#160;fails.&#160;The&#160;value&#160;<br/>binding object&#160;must&#160;be&#160;initialized&#160;with the&#160;bound cell&#160;value,&#160;and it&#160;cannot&#160;be&#160;changed again:<br/>
Dim&#160;arg(0)&#160;as&#160;new&#160;com.sun.star.beans.NamedValue&#160;'not a PropertyValue, a Named Value.<br/>Dim&#160;oCellAddress&#160;As&#160;new&#160;com.sun.star.table.CellAddress<br/>oCellAddress.Column&#160;=&#160;6<br/>oCellAddress.Row=13<br/>oCellAddress.Sheet=0<br/>arg(0).Name&#160;=&#160;&#34;BoundCell&#34;<br/>arg(0).Value&#160;=&#160;oCellAddress<br/>oService&#160;=&#160;oDoc.createInstanceWithArguments(&#34;com.sun.star.table.CellValueBinding&#34;,&#160;arg)<br/>oControlDataModel.ValueBinding&#160;=&#160;oService<br/>
Using&#160;CreateInstanceWithArguments&#160;allows&#160;the&#160;service&#160;to&#160;be&#160;created&#160;and values&#160;be&#160;set&#160;when the&#160;object&#160;is&#160;<br/>initialized.&#160;You can accomplish the&#160;same&#160;thing in two steps&#160;(instead of one) by&#160;creating the&#160;instance&#160;without&#160;<br/>arguments&#160;and calling&#160;the&#160;initialize&#160;method&#160;after creating&#160;the&#160;object.<br/>
236<br/>
<hr/>
<a name=240></a><i><b>&#160;10.4.&#160;Context<br/></b></i>OpenOffice&#160;has&#160;“things”&#160;that&#160;are&#160;available&#160;by&#160;name. For example,&#160;the&#160;type&#160;description&#160;manager and the&#160;<br/>service&#160;manager.&#160;A&#160;context&#160;is&#160;a&#160;collection of name-value&#160;pairs&#160;that&#160;you&#160;can use&#160;to&#160;get&#160;these&#160;“things”&#160;by&#160;<br/>name. OOo maintains&#160;a&#160;default&#160;context&#160;that&#160;is&#160;available&#160;with&#160;the&#160;function&#160;GetDefaultContext.&#160;Although a&#160;<br/>context&#160;is&#160;required when a&#160;service&#160;is&#160;created,&#160;OOo Basic&#160;automatically&#160;uses&#160;the&#160;default&#160;context&#160;when calling&#160;<br/>CreateUnoService;&#160;yet&#160;another reason why&#160;OOo Basic&#160;is&#160;easier to use&#160;than other languages.&#160;<br/>
<i><b>Listing&#160;215.</b>&#160;View context&#160;element&#160;names.<br/></i>MsgBox&#160;Join(GetDefaultContext().getElementNames(),&#160;CHR$(10))&#160;<br/>
<i><b>&#160;10.5.&#160;Inspecting&#160;Universal&#160;Network&#160;Objects<br/></b></i>While&#160;writing&#160;an OOo Basic&#160;macro, I&#160;don’t&#160;always&#160;understand the&#160;values&#160;returned from&#160;internal&#160;OOo&#160;<br/>functions&#160;—&#160;for example, inspecting the&#160;value&#160;returned by&#160;GetDefaultContext.&#160;I&#160;write&#160;test&#160;code&#160;to examine&#160;<br/>the&#160;return values&#160;so that&#160;I&#160;can make&#160;appropriate&#160;decisions.&#160;I&#160;then frequently&#160;add more&#160;test&#160;code&#160;to&#160;further&#160;<br/>inspect&#160;the&#160;returned object.&#160;The&#160;initial&#160;inspection&#160;uses&#160;routines&#160;that&#160;you probably&#160;know&#160;(see<a href="libremacros.html#240">&#160;Table&#160;90)</a>.<br/>
<i><b>Table&#160;90.</b>&#160;Initial&#160;inspection routines.</i><br/>
<i><b>Routine</b></i><br/>
<i><b>Comment</b></i><br/>
IsMissing(obj)<br/>
Use&#160;this&#160;for&#160;optional&#160;arguments to see&#160;if&#160;they&#160;are&#160;missing.<br/>
IsNull(obj)<br/>
You cannot&#160;inspect&#160;a&#160;null&#160;object,&#160;but&#160;you know&#160;that&#160;it&#160;is&#160;null.<br/>
IsEmpty(obj)<br/>
You cannot&#160;inspect&#160;an empty&#160;object, but&#160;you&#160;know&#160;that&#160;it&#160;is empty.<br/>
IsArray(obj)<br/>
Use&#160;array-inspection methods to learn more&#160;about&#160;the&#160;array.<br/>
TypeName(obj)<br/>
Determine&#160;if&#160;this&#160;is&#160;a&#160;simple&#160;type&#160;such&#160;as a&#160;String&#160;or&#160;an&#160;Integer.&#160;If&#160;this is&#160;an&#160;<br/>
Object, it&#160;is probably&#160;a&#160;UNO&#160;structure&#160;or&#160;a&#160;UNO&#160;service.<br/>
IsUnoStruct(obj)<br/>
Determine&#160;if&#160;this&#160;is&#160;a&#160;UNO&#160;structure.<br/>
The&#160;code&#160;in<a href="libremacros.html#240">&#160;Listing 216&#160;de</a>monstrates&#160;an initial&#160;use&#160;of the&#160;functions&#160;i<a href="libremacros.html#240">n&#160;Table&#160;90.&#160;</a><br/>
<i><b>Listing&#160;216.</b>&#160;Inspect&#160;the&#160;TextTables&#160;object&#160;on the&#160;current&#160;document.<br/></i>Dim&#160;v<br/>v&#160;=&#160;Thiscomponent.getTextTables()<br/>Print&#160;IsObject(v)&#160; &#160; &#160;&#160;'True<br/>Print&#160;IsNull(v)&#160; &#160; &#160; &#160;&#160;'False<br/>Print&#160;IsEmpty(v)&#160; &#160; &#160; &#160;'False<br/>Print&#160;IsArray(v)&#160; &#160; &#160; &#160;'False<br/>Print&#160;IsUnoStruct(v)&#160; &#160;'False<br/>Print&#160;TypeName(v)&#160; &#160; &#160;&#160;'Object<br/>MsgBox&#160;v.dbg_methods&#160; &#160;'This property is discussed later<br/>
If&#160;the&#160;returned object&#160;has&#160;a&#160;type&#160;name&#160;of Object&#160;and it&#160;isn’t&#160;a&#160;UNO&#160;structure, it&#160;is&#160;probably&#160;a&#160;UNO&#160;service.&#160;<br/>Use&#160;the&#160;HasUnoInterfaces&#160;function to&#160;determine&#160;if a&#160;UNO&#160;object&#160;supports&#160;a&#160;set&#160;of interfaces.&#160;The&#160;first&#160;<br/>argument&#160;is&#160;the&#160;object&#160;to&#160;test.&#160;The&#160;arguments&#160;following&#160;the&#160;first&#160;are&#160;a&#160;list&#160;of interface&#160;names. If&#160;all&#160;of the&#160;<br/>listed interfaces&#160;are&#160;supported,&#160;the&#160;function&#160;returns&#160;True, otherwise&#160;it&#160;returns&#160;False. More&#160;than one&#160;interface&#160;<br/>may&#160;be&#160;checked at&#160;the&#160;same&#160;time.<br/>
HasUnoInterfaces(obj,&#160;interface1)<br/>HasUnoInterfaces(obj,&#160;interface1[,&#160;interface2[,&#160;interface3[,&#160;...]]])<br/>
To&#160;distinguish between a&#160;UNO&#160;structure, an arbitrary&#160;object,&#160;and a&#160;UNO&#160;service, first&#160;check to see&#160;if the&#160;<br/>variable&#160;is&#160;an object.&#160;This&#160;is&#160;easily&#160;done&#160;using the&#160;TypeName&#160;function.&#160;If&#160;the&#160;TypeName&#160;contains&#160;the&#160;word&#160;<br/>
237<br/>
<hr/>
<a name=241></a>Object,&#160;then you know&#160;it’s&#160;an object&#160;of some&#160;sort.&#160;The&#160;next&#160;step is&#160;to see&#160;if the&#160;object&#160;is&#160;a&#160;UNO&#160;structure, by&#160;<br/>using the&#160;function&#160;IsUnoStruct. Finally,&#160;if the&#160;object&#160;supports&#160;an interface&#160;(any&#160;interface&#160;will&#160;do), you&#160;know&#160;<br/>it’s&#160;a&#160;UNO&#160;service.&#160;Every&#160;interface&#160;is&#160;derived from&#160;com.sun.star.uno.XInterface, so it&#160;suffices&#160;to&#160;see&#160;if the&#160;<br/>object&#160;supports&#160;the&#160;XInterface&#160;interface.&#160;The&#160;code&#160;in<a href="libremacros.html#241">&#160;Listing 217&#160;us</a>es&#160;the&#160;OOo Basic&#160;variable&#160;<br/>ThisComponent,&#160;which&#160;represents&#160;the&#160;current&#160;document.<br/>
<i><b>Listing&#160;217.</b>&#160;Use&#160;HasUnoInterfaces&#160;and IsUnoStruct&#160;to determine&#160;the&#160;UNO&#160;type.<br/></i>Dim&#160;aProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>Print&#160;IsUnoStruct(aProp)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>Print&#160;HasUnoInterfaces(aProp,&#160;&#34;com.sun.star.uno.XInterface&#34;)&#160; &#160; &#160; &#160; &#160;&#160;'False<br/>Print&#160;IsUnoStruct(ThisComponent)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'False<br/>Print&#160;HasUnoInterfaces(ThisComponent,&#160;&#34;com.sun.star.uno.XInterface&#34;)&#160;&#160;'True<br/>
<b>TIP</b><br/>
If&#160;the&#160;first&#160;argument&#160;to the&#160;function HasUnoInterfaces is not&#160;an object,&#160;a&#160;run-time&#160;error&#160;occurs.&#160;The&#160;object&#160;<br/>
may&#160;be&#160;null, but&#160;it&#160;must&#160;be&#160;an&#160;object.&#160;If&#160;the&#160;argument&#160;is a&#160;variant,&#160;it&#160;must&#160;contain an object;&#160;it&#160;cannot&#160;be&#160;<br/>empty.<br/>
Most&#160;UNO&#160;services&#160;also&#160;support&#160;the&#160;com.sun.star.lang.XServiceInfo interface, which allows&#160;you&#160;to&#160;ask the&#160;<br/>object&#160;what&#160;services&#160;it&#160;supports&#160;(see<a href="libremacros.html#241">&#160;Table&#160;91)</a>.<br/>
<i><b>Table&#160;91.</b>&#160;XServiceInfo methods.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getImplementationName()<br/>
Returns a&#160;string&#160;that&#160;uniquely&#160;identifies the&#160;implementation of&#160;the&#160;service.&#160;For&#160;<br/>
example,&#160;SwXTextDocument&#160;is the&#160;name&#160;of&#160;a&#160;Writer&#160;text&#160;document.<br/>
getSupportedServiceNames()<br/>
Return a&#160;string&#160;array&#160;of&#160;services&#160;that&#160;the&#160;object&#160;supports.<br/>
supportsService(serviceName)<br/>
Return&#160;True&#160;if&#160;the&#160;object&#160;supports&#160;the&#160;service&#160;name.<br/>
OOo supports&#160;different&#160;types&#160;of documents, such as&#160;Writer&#160;(word processing) and Calc&#160;(spreadsheet).&#160;Each&#160;<br/>document&#160;type&#160;supports&#160;at&#160;least&#160;one&#160;service&#160;that&#160;is&#160;supported&#160;only&#160;by&#160;that&#160;document&#160;type&#160;(see<a href="libremacros.html#241">&#160;Table&#160;92)</a>.&#160;You&#160;<br/>can determine&#160;the&#160;document&#160;type&#160;by&#160;checking&#160;if&#160;it&#160;supports&#160;one&#160;of these&#160;services.&#160;You can also&#160;use&#160;the&#160;<br/>method&#160;getImplementationName(), as&#160;shown i<a href="libremacros.html#241">n&#160;Table&#160;91.</a><br/>
The&#160;code&#160;in<a href="libremacros.html#242">&#160;Listing 218&#160;de</a>monstrates&#160;how&#160;to verify&#160;that&#160;a&#160;variable&#160;references&#160;a&#160;Writer&#160;document. If&#160;the&#160;<br/>argument&#160;vDoc&#160;does&#160;not&#160;support&#160;the&#160;XServiceInfo interface, however,&#160;a&#160;run-time&#160;error occurs&#160;because&#160;the&#160;<br/>SupportsService&#160;method&#160;is&#160;not&#160;implemented. Use&#160;appropriate&#160;error handling&#160;if&#160;this&#160;is&#160;required, as&#160;shown i<a href="libremacros.html#242">n<br/>Listing 219;</a>&#160;this&#160;is&#160;used in<a href="libremacros.html#251">&#160;Listing 227. I</a>f&#160;the&#160;argument&#160;is&#160;missing, the&#160;current&#160;document&#160;is&#160;used. If&#160;an error&#160;<br/>occurs&#160;or a&#160;recognized&#160;service&#160;is&#160;not&#160;supported,&#160;the&#160;text&#160;“unknown”&#160;is&#160;returned.<br/>
<i><b>Table&#160;92.</b>&#160;Unique&#160;service&#160;names&#160;based on document&#160;type.</i><br/>
<i><b>Document&#160;Type</b></i><br/>
<i><b>Service</b></i><br/>
Drawing<br/>
com.sun.star.drawing.DrawDocument<br/>
Writer<br/>
com.sun.star.text.TextDocument<br/>
Writer&#160;HTML<br/>
com.sun.star.text.WebDocument<br/>
Calc<br/>
com.sun.star.sheet.SpreadsheetDocument<br/>
Math<br/>
com.sun.star.formula.FormulaProperties<br/>
Presentation<br/>
com.sun.star.presentation.PresentationDocument<br/>
Base<br/>
com.sun.star.sdb.OfficeDatabaseDocument<br/>
Base&#160;Table<br/>
com.sun.star.sdb.DataSourceBrowser<br/>
238<br/>
<hr/>
<a name=242></a><i><b>Document&#160;Type</b></i><br/>
<i><b>Service</b></i><br/>
Basic&#160;IDE<br/>
com.sun.star.script.BasicIDE<br/>
<i><b>Listing&#160;218.</b>&#160;Verify&#160;that&#160;the&#160;document&#160;is&#160;a Writer&#160;document.<br/></i>Sub&#160;DoSomethingToWriteDocument(vDoc)<br/>&#160;&#160;If&#160;NOT&#160;vDoc.supportsService(&#34;com.sun.star.text.TextDocument&#34;)&#160;Then<br/>&#160; &#160;&#160;MsgBox&#160;&#34;A Writer document is required&#34;,&#160;48,&#160;&#34;Error&#34;<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;REM rest of the subroutine starts here<br/>End&#160;Sub<br/>
<i><b>Listing&#160;219.</b>&#160;Determine&#160;a document's&#160;type.<br/></i>Function&#160;getDocType(Optional&#160;vDoc)&#160;As&#160;String<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;Oops<br/>&#160;&#160;If&#160;IsMissing(vDoc)&#160;Then&#160;vDoc&#160;=&#160;ThisComponent<br/>&#160;&#160;If&#160;vDoc.SupportsService(&#34;com.sun.star.sheet.SpreadsheetDocument&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;calc&#34;<br/>&#160;&#160;ElseIf&#160;vDoc.SupportsService(&#34;com.sun.star.text.TextDocument&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;writer&#34;<br/>&#160;&#160;ElseIf&#160;vDoc.SupportsService(&#34;com.sun.star.drawing.DrawingDocument&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;draw&#34;<br/>&#160;&#160;ElseIf&#160;vDoc.SupportsService(_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#34;com.sun.star.presentation.PresentationDocuments&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;presentation&#34;<br/>&#160;&#160;ElseIf&#160;vDoc.SupportsService(&#34;com.sun.star.formula.FormulaProperties&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;math&#34;<br/>&#160;&#160;ElseIf&#160;vDoc.SupportsService(&#34;com.sun.star.sdb.OfficeDatabaseDocument&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;base&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;unknown&#34;<br/>&#160;&#160;End&#160;If<br/>Oops:<br/>&#160;&#160;If&#160;Err&#160;&lt;&gt;&#160;0&#160;Then&#160;getDocType&#160;=&#160;&#34;unknown&#34;<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;0&#160; &#160;'Turn off error handling AFTER checking for an error<br/>End&#160;Function<br/>
Some&#160;document&#160;types&#160;cannot&#160;be&#160;easily&#160;distinguished;&#160;for example, an XForms&#160;document&#160;and a&#160;Master&#160;<br/>document&#160;both support&#160;the&#160;same&#160;services&#160;as&#160;a&#160;regular text&#160;document.&#160;All&#160;of the&#160;Write&#160;based documents&#160;<br/>support&#160;the&#160;service&#160;com.sun.star.text.GenericTextDocument,&#160;and all&#160;of the&#160;office&#160;type&#160;documents&#160;support&#160;the<br/>service&#160;com.sun.star.document.OfficeDocument.<br/>
When&#160;I&#160;want&#160;to know&#160;about&#160;an interface&#160;or service, the&#160;first&#160;place&#160;that&#160;I&#160;look&#160;is&#160;online&#160;for the&#160;official&#160;<br/>documentation.&#160;Unfortunately,&#160;only&#160;a&#160;partial&#160;picture&#160;is&#160;easily&#160;produced (for the&#160;TextCursor service, see&#160;<br/><a href="http://api.openoffice.org/docs/common/ref/com/sun/star/text/TextCursor.html">http://api.openoffice.org/docs/common/ref/com/sun/star/text/TextCursor.html)</a>.&#160;There&#160;are&#160;some&#160;issues:<br/>
1)&#160;The&#160;documentation does&#160;not&#160;present&#160;a&#160;unified picture, you&#160;must&#160;follow&#160;many&#160;links&#160;to&#160;determine&#160;what<br/>
the&#160;object&#160;can do.&#160;All&#160;supported and optional&#160;interfaces&#160;are&#160;listed,&#160;but&#160;you must&#160;inspect&#160;each&#160;<br/>interface&#160;to know&#160;what&#160;each one&#160;does.&#160;<br/>
2)&#160;Each interface&#160;has&#160;its&#160;own page. If&#160;an interface&#160;is&#160;derived from&#160;another,&#160;you must&#160;look at&#160;another&#160;<br/>
page&#160;to see&#160;the&#160;definition&#160;of the&#160;parent&#160;interface.<br/>
239<br/>
<hr/>
<a name=243></a>3)&#160;You don’t&#160;know&#160;if the&#160;optional&#160;items&#160;are&#160;supported for a&#160;specific&#160;object&#160;instance&#160;without&#160;inspecting&#160;<br/>
the&#160;object.&#160;<br/>
<b>TIP</b><br/>
Use&#160;Google&#160;to search for&#160;“site:api.openoffice.org&#160;TextCursor”&#160;to&#160;quickly&#160;find the&#160;documentation for&#160;the&#160;<br/>
TextCursor&#160;service.<br/>
<b>TIP</b><br/>
<a href="http://api.openoffice.org/docs/common/ref/com/sun/star/text/module-ix.html">http://api.openoffice.org/docs/common/ref/com/sun/star/text/module-ix.html&#160;l</a>ists all&#160;of&#160;the&#160;services&#160;and&#160;<br/>interfaces at&#160;the&#160;com.sun.star.text&#160;level.<br/>
Most&#160;UNO&#160;services&#160;contain the&#160;properties&#160;dbg_properties, dbg_methods,&#160;and dbg_supportedInterfaces. Each<br/>of these&#160;properties&#160;is&#160;a&#160;string that&#160;contains&#160;a&#160;list&#160;of the&#160;supported&#160;properties, methods, or supported&#160;<br/>interfaces. Each string&#160;starts&#160;with text&#160;similar to&#160;“Properties&#160;of Object&#160;&#34;ThisComponent&#34;:”.&#160;The&#160;individual&#160;<br/>items&#160;are&#160;separated&#160;by&#160;the&#160;delimiter&#160;as&#160;shown in<a href="libremacros.html#243">&#160;Table&#160;93. S</a>ometimes&#160;there&#160;are&#160;extra&#160;spaces&#160;following&#160;the&#160;<br/>delimiter and sometimes&#160;there&#160;are&#160;extra&#160;new-line&#160;characters&#160;—&#160;CHR$(10).<br/>
<i><b>Table&#160;93.</b>&#160;UNO&#160;“dbg_”&#160;properties.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Delimiter</b></i><br/>
<i><b>Description</b></i><br/>
dbg_properties<br/>
“;”<br/>
All&#160;properties supported&#160;by&#160;the&#160;object.<br/>
dbg_methods<br/>
“;”<br/>
All&#160;methods supported&#160;by&#160;the&#160;object.<br/>
dbg_supportedInterfaces<br/>
Chr$(10)<br/>
All&#160;interfaces&#160;supported&#160;by&#160;the&#160;object.<br/>
The&#160;code&#160;in<a href="libremacros.html#243">&#160;Listing 220&#160;p</a>rovides&#160;an easy&#160;method to&#160;see&#160;what&#160;an object&#160;supports. Sometimes, however,&#160;too&#160;<br/>many&#160;items&#160;are&#160;displayed and portions&#160;of the&#160;dialog&#160;do not&#160;fit&#160;on the&#160;screen.&#160;To&#160;avoid&#160;this&#160;problem, the&#160;code&#160;<br/>i<a href="libremacros.html#243">n&#160;Listing&#160;221&#160;s</a>plits&#160;the&#160;list&#160;into&#160;smaller,&#160;easily&#160;managed chunks<a href="libremacros.html#245">.&#160;Figure&#160;74&#160;i</a>s&#160;only&#160;one&#160;of the&#160;many&#160;dialogs&#160;<br/>that&#160;are&#160;displayed by&#160;the&#160;macro i<a href="libremacros.html#243">n&#160;Listing&#160;221. Be</a>&#160;warned, the&#160;dialogs&#160;will&#160;not&#160;fit&#160;on the&#160;screen, so, just&#160;<br/>press&#160;enter to close&#160;each dialog.<br/>
<i><b>Listing&#160;220.</b>&#160;The&#160;“dbg_”&#160;properties&#160;return useful&#160;information.<br/></i>MsgBox&#160;vObj.dbg_properties<br/>MsgBox&#160;vObj.dbg_methods<br/>MsgBox&#160;vObj.dbg_supportedInterfaces<br/>
<i><b>Listing&#160;221.</b>&#160;Display&#160;information&#160;from&#160;one&#160;of&#160;the&#160;debug properties.<br/></i>Sub&#160;ExampleDisplayDbgInfoStr()<br/>&#160;&#160;Dim&#160;vObj<br/>&#160;&#160;vObj&#160;=&#160;ThisComponent<br/>&#160;&#160;DisplayDbgInfoStr(vObj.dbg_properties,&#160;&#34;;&#34;,&#160;40,&#160;&#34;Properties&#34;)<br/>&#160;&#160;DisplayDbgInfoStr(vObj.dbg_methods,&#160;&#34;;&#34;,&#160;40,&#160;&#34;Methods&#34;)<br/>&#160;&#160;DisplayDbgInfoStr(vObj.dbg_supportedInterfaces,&#160;CHR$(10),&#160;40,&#160;&#34;Interfaces&#34;)<br/>End&#160;Sub<br/>
Sub&#160;DisplayDbgInfoStr(sInfo$,&#160;sSep$,&#160;nChunks,&#160;sHeading$)<br/>&#160;&#160;Dim&#160;aInfo()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Array to hold each string<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;j&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Junk integer variable for temporary values<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'holds the portion that is not completed<br/>&#160;&#160;s&#160;=&#160;sInfo$<br/>&#160;&#160;j&#160;=&#160;InStr(s,&#160;&#34;:&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Initial colon<br/>&#160;&#160;If&#160;j&#160;&gt;&#160;0&#160;Then&#160;Mid(s,&#160;1,&#160;j,&#160;&#34;&#34;)&#160;&#160;'Remove portion up to the initial colon<br/>&#160;&#160;Do<br/>
240<br/>
<hr/>
<a name=244></a>&#160; &#160;&#160;aInfo()&#160;=&#160;Split(s,&#160;sSep$,&#160;nChunks)&#160; &#160; &#160; &#160;&#160;'Split string based on delimiter.<br/>&#160; &#160;&#160;s&#160;=&#160;aInfo(UBound(aInfo()))&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Grab the last piece. Contains<br/>&#160; &#160;&#160;If&#160;InStr(s,&#160;sSep$)&#160;&lt;&#160;1&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'the rest if there were too many.<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'If there were not, then clear s.<br/>&#160; &#160;&#160;Else&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'If there was a delimiter then<br/>&#160; &#160; &#160;&#160;ReDim&#160;Preserve&#160;aInfo(nChunks&#160;-&#160;2)&#160; &#160; &#160; &#160;'change array dimension to<br/>&#160; &#160;&#160;End&#160;If&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'remove the extra last piece.<br/>&#160; &#160;&#160;For&#160;i&#160;=&#160;LBound(aInfo())&#160;To&#160;UBound(aInfo())'Look at each piece to remove<br/>&#160; &#160; &#160;&#160;aInfo(i)&#160;=&#160;Trim(aInfo(i))&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'leading and trailing spaces.<br/>&#160; &#160; &#160;&#160;j&#160;=&#160;InStr(aInfo(i),&#160;CHR$(10))&#160; &#160; &#160; &#160; &#160; &#160;'Some have an extra<br/>&#160; &#160; &#160;&#160;If&#160;j&#160;&gt;&#160;0&#160;&#160;Then&#160;Mid(aInfo(i),&#160;j,&#160;1,&#160;&#34;&#34;)&#160;&#160;'new line that should be removed.<br/>&#160; &#160;&#160;Next<br/>&#160; &#160;&#160;MsgBox&#160;Join(aInfo(),&#160;CHR$(10)),&#160;0,&#160;sHeading$<br/>&#160;&#160;Loop&#160;Until&#160;Len(s)&#160;=&#160;0<br/>End&#160;Sub<br/>
When&#160;a&#160;type&#160;is&#160;included in&#160;one&#160;of the&#160;“dbg_”&#160;properties, it&#160;is&#160;preceded by&#160;the&#160;text&#160;“Sbx”, as&#160;shown in<a href="libremacros.html#245">&#160;Figure<br/>74.&#160;</a>These&#160;names&#160;starting with Sbx&#160;correspond to&#160;the&#160;internal&#160;names&#160;used by&#160;OOo Basic.<br/>
<b>TIP</b><br/>
A&#160;complete&#160;object&#160;browser&#160;is&#160;presented&#160;later&#160;that&#160;demonstrates all&#160;of&#160;these&#160;concepts (see&#160;sectio<a href="libremacros.html#647">n&#160;18.5&#160;The&#160;</a><br/>
<a href="libremacros.html#647">object&#160;inspector&#160;example)</a>.<br/>
<b>TIP</b><br/>
A&#160;popular&#160;object&#160;browser,&#160;called&#160;Xray&#160;described at&#160;the&#160;following&#160;link:&#160;<br/><a href="http://wiki.openoffice.org/wiki/Extensions_development_basic">http://wiki.openoffice.org/wiki/Extensions_development_basic&#160;</a><br/>
241<br/>
<hr/>
<a name=245></a><i><b>Figure&#160;74.</b>&#160;A&#160;few&#160;properties&#160;in&#160;a Writer&#160;document; one&#160;dialog&#160;of&#160;many&#160;displayed.</i><br/>
<i><b>&#160;10.6.&#160;Using&#160;the&#160;type&#160;description&#160;manager&#160;<br/></b></i>The&#160;TypeDescriptionManager manages&#160;type&#160;descriptions&#160;and acts&#160;as&#160;a&#160;central&#160;access&#160;point&#160;for every&#160;type&#160;<br/>description.&#160;This&#160;object&#160;is&#160;available&#160;from&#160;the&#160;default&#160;context&#160;as&#160;a&#160;singleton. Creating the&#160;object&#160;directly&#160;does&#160;<br/>not&#160;provide&#160;a&#160;usable&#160;object&#160;<br/>
CreateUnoService(&#34;com.sun.star.reflection.TypeDescriptionManager&#34;)<br/>
I&#160;created a&#160;usable&#160;object&#160;using the&#160;accepted method (shown shortly), and even when using&#160;that&#160;type&#160;directly,&#160;<br/>it&#160;too&#160;failed.<br/>
CreateUnoService(&#34;com.sun.star.comp.stoc.TypeDescriptionManager&#34;)<br/>
Get&#160;the&#160;type&#160;description&#160;manager from&#160;the&#160;default&#160;context;&#160;see&#160;secti<a href="libremacros.html#240">on&#160;10.4&#160;Context, w</a>hich&#160;also shows&#160;how&#160;<br/>to enumerate&#160;all&#160;of the&#160;singleton&#160;objects&#160;available.<br/>
Function&#160;GetTypeDescriptionManager()<br/>&#160;&#160;Dim&#160;sTDMName$&#160;&#160;' Name of the type description manager.<br/>&#160;&#160;sTDMName&#160;=&#160;&#34;/singletons/com.sun.star.reflection.theTypeDescriptionManager&#34;<br/>&#160;&#160;GetTypeDescriptionManager()&#160;=&#160;GetDefaultContext().getValueByName(sTDMName)&#160;<br/>End&#160;Function<br/>
The&#160;following&#160;method enumerates&#160;all&#160;“things”&#160;in the&#160;com.sun.star.awt&#160;module.<br/>
242<br/>
<hr/>
<a name=246></a><i><b>Listing&#160;222.</b>&#160;Enumerate&#160;types&#160;in&#160;a module.<br/></i>Sub&#160;EnumerateTypesTest<br/>&#160;&#160;Dim&#160;oTDM&#160; &#160; &#160;&#160;' Type Description Manager.<br/>&#160;&#160;Dim&#160;oTDE&#160; &#160; &#160;&#160;' Type Description Enumerations.<br/>&#160;&#160;Dim&#160;oTD&#160; &#160; &#160; &#160;' One Type Description.<br/>&#160;&#160;Dim&#160;typeArray&#160;' Types for which descriptions are returned.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160;&#160;' Utility string variable.<br/>&#160;&#160;<br/>&#160;&#160;REM All supported types.<br/>&#160;&#160;typeArray&#160;=&#160;Array(com.sun.star.uno.TypeClass.VOID,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.CHAR,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.BOOLEAN,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.BYTE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.SHORT,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.UNSIGNED_SHORT,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.LONG,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.UNSIGNED_LONG,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.HYPER,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.UNSIGNED_HYPER,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.FLOAT,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.DOUBLE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.STRING,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.TYPE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.ANY,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.ENUM,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.TYPEDEF,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.STRUCT,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.UNION,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.EXCEPTION,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.SEQUENCE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.ARRAY,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.INTERFACE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.SERVICE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.MODULE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.INTERFACE_METHOD,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.INTERFACE_ATTRIBUTE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.UNKNOWN,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.PROPERTY,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.CONSTANT,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.CONSTANTS,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.SINGLETON)<br/>
&#160;&#160;oTDM&#160;=&#160;GetTypeDescriptionManager()<br/>
&#160;&#160;Dim&#160;sBaseName$&#160;:&#160;sBaseName&#160;=&#160;&#34;com.sun.star.awt&#34;<br/>&#160;&#160;<br/>&#160;&#160;' Change com.sun.star.reflection.TypeDescriptionSearchDepth.ONE<br/>&#160;&#160;' to com.sun.star.reflection.TypeDescriptionSearchDepth.INFINITE<br/>&#160;&#160;' to traverse more than a single level.<br/>&#160;&#160;oTDE&#160;=&#160;oTDM.createTypeDescriptionEnumeration(sBaseName,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;typeArray,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;com.sun.star.reflection.TypeDescriptionSearchDepth.ONE)<br/>&#160;&#160;<br/>
243<br/>
<hr/>
<a name=247></a>&#160;&#160;While&#160;oTDE.hasMoreElements()<br/>&#160; &#160;&#160;oTD&#160;=&#160;oTDE.nextTypeDescription()<br/>&#160; &#160;&#160;s$&#160;=&#160;s&#160;&amp;&#160;oTD.Name&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Wend<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
To&#160;get&#160;the&#160;information on a&#160;specific&#160;fully&#160;qualified type, use&#160;the&#160;following macro (adapted from&#160;an example&#160;<br/>by&#160;Bernard Marcelly):<br/>
<i><b>Listing&#160;223.</b>&#160;Get&#160;object&#160;description from&#160;a fully&#160;qualified name.</i><br/>
Function&#160;GetOOoConst(constString)<br/>&#160;&#160;Dim&#160;sTDMName$<br/>&#160;&#160;Dim&#160;oTDM<br/>&#160;&#160;<br/>&#160;&#160;sTDMName&#160;=&#160;&#34;/singletons/com.sun.star.reflection.theTypeDescriptionManager&#34;<br/>&#160;&#160;oTDM&#160;=&#160;GetDefaultContext().getValueByName(sTDMName)&#160;<br/>&#160;&#160;<br/>&#160;&#160;If&#160;oTDM.hasByHierarchicalName(constString)&#160;Then&#160;<br/>&#160; &#160;&#160;GetOOoConst&#160;=&#160;oTDM.getByHierarchicalName(constString)&#160;<br/>&#160;&#160;Else&#160;<br/>&#160; &#160;&#160;MsgBox&#160;&#34;Unrecognized name : &#34;&#160;&amp;&#160;constString,&#160;16,&#160;&#34;OOo API constant or enum&#34;&#160;<br/>&#160;&#160;End&#160;If&#160;<br/>End&#160;Function<br/>
The&#160;method&#160;is&#160;usable&#160;to&#160;obtain&#160;constant&#160;and enumeration&#160;values&#160;from&#160;a&#160;text&#160;string<br/>
Print&#160;GetOOoConst(&#34;com.sun.star.awt.FontSlant.ITALIC&#34;)<br/>
This&#160;can also return an object&#160;that&#160;describes&#160;the&#160;type.&#160;This&#160;can be&#160;used to&#160;enumerate&#160;the&#160;values&#160;and the&#160;<br/>strings.<br/>
<i><b>Listing&#160;224.</b>&#160;Inspect&#160;enumerations.</i><br/>
Sub&#160;EnumerateEnumerations(sName$)<br/>&#160; Dim&#160;oTD&#160; &#160; &#160; &#160;' One Type Description.<br/>&#160; Dim&#160;oTDE&#160; &#160; &#160;&#160;' Element enumeration<br/>&#160; Dim&#160;s$ &#160; &#160; &#160; &#160;' Utility string variable.<br/>&#160; Dim&#160;sNames<br/>&#160; Dim&#160;lValues<br/>&#160; Dim&#160;i&#160;As Long<br/>&#160; Dim&#160;iCount&#160;As Integer<br/>&#160;&#160;<br/>
&#160;&#160;oTD&#160;=&#160;GetOOoConst(sName)<br/>&#160; If IsNull(oTD) OR&#160;IsEmpty(oTD) Then<br/>&#160; &#160; Exit Sub<br/>&#160; End If<br/>&#160;&#160;<br/>&#160;&#160;<br/>&#160; If HasUnoInterfaces(oTD,&#160;&#34;com.sun.star.reflection.XEnumTypeDescription&#34;) Then<br/>&#160;&#160;<br/>&#160; &#160;&#160;'MsgBox Join( oTD.getEnumNames(), CHR$(10))<br/>&#160; &#160;&#160;sNames&#160;=&#160;oTD.getEnumNames()<br/>&#160; &#160;&#160;lValues&#160;=&#160;otd.getEnumValues()<br/>&#160; &#160; For&#160;i&#160;= LBound(sNames) To UBound(sNames)<br/>
244<br/>
<hr/>
<a name=248></a>&#160; &#160; &#160;&#160;iCount&#160;=&#160;iCount&#160;+&#160;1<br/>&#160; &#160; &#160; If (iCount&#160;&gt;&#160;40) Then<br/>&#160; &#160; &#160; &#160; MsgBox(s)<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160; &#160; End If<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;lValues(i) &amp; CHR$(9) &amp;&#160;sNames(i) &amp; CHR$(10)<br/>&#160; &#160; Next<br/>&#160; ElseIf HasUnoInterfaces(oTD,&#160;&#34;com.sun.star.reflection.XConstantsTypeDescription&#34;) Then<br/>&#160; &#160;&#160;lValues&#160;=&#160;oTD.getConstants()<br/>&#160; &#160; For&#160;i&#160;= LBound(lValues) To UBound(lValues)<br/>&#160; &#160; &#160;&#160;iCount&#160;=&#160;iCount&#160;+&#160;1<br/>&#160; &#160; &#160; If (iCount&#160;&gt;&#160;40) Then<br/>&#160; &#160; &#160; &#160; MsgBox(s)<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160; &#160; End If<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;lValues(i).getConstantValue() &amp; CHR$(9) &amp;&#160;lValues(i).getName() &amp; CHR$(10)<br/>&#160; &#160; Next<br/>&#160; Else<br/>&#160; &#160;&#160;'Inspect oTD<br/>&#160; &#160; MsgBox&#160;&#34;Unsupported type &#34;&#160;&amp;&#160;sName<br/>&#160; &#160; Exit Sub<br/>&#160; End If<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
This&#160;can be&#160;used to&#160;see&#160;enumerations.<br/>
EnumerateEnumerations(&#34;com.sun.star.awt.FontSlant&#34;) &#160;<br/>
This&#160;can be&#160;used to&#160;see&#160;constant&#160;groups.<br/>
EnumerateEnumerations(&#34;com.sun.star.awt.FontWeight&#34;) &#160;<br/>
<i><b>&#160;10.7.&#160;Use&#160;Object&#160;or&#160;Variant<br/></b></i>It&#160;is&#160;almost&#160;always&#160;safe&#160;to&#160;use&#160;Object&#160;variables&#160;to hold&#160;UNO&#160;services. It&#160;is&#160;so safe, apparently,&#160;that&#160;even the&#160;<br/>macro recorder uses&#160;Object&#160;variables&#160;to&#160;hold&#160;UNO&#160;services. Unfortunately,&#160;it&#160;is&#160;not&#160;always&#160;safe.&#160;The&#160;OOo&#160;<br/>Developer’s&#160;Guide&#160;specifically&#160;states&#160;that&#160;Variant&#160;variables&#160;should&#160;be&#160;used instead of Object&#160;variables.&#160;<br/>Always&#160;use&#160;the&#160;type&#160;Variant&#160;to&#160;declare&#160;variables&#160;for UNO&#160;services, not&#160;the&#160;type&#160;Object.&#160;The&#160;OOo Basic&#160;type&#160;<br/>Object&#160;is&#160;tailored for pure&#160;OOo Basic&#160;objects&#160;—&#160;in other words, objects&#160;that&#160;can be&#160;created&#160;with the&#160;Dim&#160;As&#160;<br/>New&#160;syntax.&#160;The&#160;Variant&#160;variables&#160;are&#160;best&#160;for UNO&#160;services&#160;to avoid&#160;problems&#160;that&#160;can result&#160;from&#160;the&#160;OOo<br/>Basic&#160;specific&#160;behavior of the&#160;type&#160;Object.&#160;I&#160;asked&#160;Andreas&#160;Bregas&#160;(one&#160;of the&#160;primary&#160;developers&#160;for the&#160;<br/>OOo Basic&#160;infrastructure) about&#160;this, and he&#160;said&#160;that&#160;in&#160;most&#160;cases, both work.&#160;The&#160;OOo Developer’s&#160;Guide<br/>prefers&#160;Variant&#160;because&#160;there&#160;are&#160;some&#160;odd situations&#160;in&#160;which the&#160;usage&#160;of type&#160;Object&#160;leads&#160;to an error due&#160;<br/>to the&#160;old Basic&#160;Object&#160;type&#160;semantics. But&#160;if a&#160;Basic&#160;program&#160;uses&#160;type&#160;Object, it&#160;will&#160;almost&#160;always&#160;run&#160;<br/>correctly&#160;and there&#160;should&#160;be&#160;no problems. It&#160;is&#160;sufficiently&#160;rare, however,&#160;that&#160;he&#160;could not&#160;remember an&#160;<br/>example&#160;where&#160;it&#160;was&#160;a&#160;problem.&#160;On the&#160;other hand, with&#160;OOo version&#160;1, I&#160;experienced a&#160;problem&#160;that&#160;<br/>corrected&#160;itself, when I&#160;changed the&#160;variable&#160;type&#160;from&#160;Variant&#160;to Object.<br/>
245<br/>
<hr/>
<a name=249></a><i><b>&#160;10.8.&#160;Comparing&#160;UNO&#160;variables<br/></b></i>Use&#160;the&#160;EqualUnoObjects&#160;function&#160;to determine&#160;if two UNO&#160;objects&#160;are&#160;the&#160;same&#160;object.&#160;UNO&#160;structures&#160;are<br/>copied by&#160;value&#160;but&#160;UNO&#160;services&#160;are&#160;copied by&#160;reference.&#160;This&#160;means&#160;that&#160;EqualUnoObjects&#160;should&#160;always<br/>return False&#160;for two variables&#160;that&#160;contain a&#160;structure, and it&#160;might&#160;return&#160;True&#160;for UNO&#160;services.<br/>
&#160;&#160;Dim&#160;vObj<br/>&#160;&#160;vObj&#160;=&#160;ThisComponent<br/>&#160;&#160;Print&#160;EqualUnoObjects(vObj,&#160;ThisComponent)&#160; &#160; &#160; &#160; &#160;'True<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;aProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;vObj&#160;=&#160;aProp<br/>&#160;&#160;Print&#160;EqualUnoObjects(vObj,&#160;aProp)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'False<br/>
After using OOo for many&#160;years, I&#160;finally&#160;found a&#160;use&#160;for EqualUnoObjects. Be&#160;warned that&#160;this&#160;is&#160;an&#160;<br/>advance&#160;topic&#160;and makes&#160;use&#160;of constructs&#160;not&#160;widely&#160;known.&#160;The&#160;problem&#160;as&#160;posed is:&#160;“When&#160;a&#160;button&#160;is&#160;<br/>pressed in a&#160;Calc&#160;document, I&#160;want&#160;to&#160;know&#160;which cell&#160;contains&#160;the&#160;button.”&#160;Here&#160;are&#160;some&#160;bits&#160;of&#160;<br/>information to&#160;help understand&#160;the&#160;problem:<br/>
•<br/>
Each document&#160;has&#160;at&#160;least&#160;one&#160;“draw&#160;page”&#160;that&#160;contains&#160;graphical&#160;things&#160;such as&#160;images&#160;imbedded&#160;<br/>in the&#160;document.<br/>
•<br/>
You can embed controls&#160;such as&#160;a&#160;button&#160;in a&#160;document.&#160;When the&#160;button&#160;is&#160;pressed, and a&#160;macro is&#160;<br/>called, it&#160;is&#160;trivial&#160;to get&#160;a&#160;reference&#160;to&#160;the&#160;control&#160;“data&#160;model”.<br/>
•<br/>
Each control&#160;has&#160;a&#160;shape&#160;embedded in&#160;the&#160;draw&#160;page.<br/>
•<br/>
Each control&#160;also has&#160;a&#160;“data&#160;model”&#160;that&#160;contains&#160;properties&#160;and other similar things.<br/>
•<br/>
From&#160;a&#160;control&#160;data&#160;model&#160;I&#160;cannot&#160;easily&#160;obtain&#160;the&#160;shape&#160;or the&#160;cell&#160;containing the&#160;control.<br/>
•<br/>
From&#160;a&#160;shape&#160;in&#160;a&#160;Calc&#160;document,&#160;I&#160;can easily&#160;find the&#160;cell&#160;– if the&#160;control&#160;is&#160;anchored to a&#160;cell.<br/>
My&#160;solution&#160;was&#160;to find the&#160;shape&#160;associated with&#160;a&#160;control. It&#160;is&#160;easy&#160;to&#160;find the&#160;control&#160;name, but,&#160;a&#160;control<br/>name&#160;need not&#160;be&#160;unique. I&#160;opted to&#160;look at&#160;every&#160;shape&#160;on the&#160;draw&#160;page&#160;and then check to see&#160;if the&#160;<br/>control&#160;associated with&#160;that&#160;shape&#160;is&#160;the&#160;same&#160;object&#160;as&#160;the&#160;control&#160;in question.<br/>
<i><b>Listing&#160;225.</b>&#160;Find&#160;the&#160;control&#160;shape&#160;for&#160;a specific&#160;control.<br/></i>Function&#160;FindCellWithControl(oDrawPage,&#160;oControl)<br/>&#160; Dim&#160;oShape<br/>&#160; Dim&#160;oAnchor<br/>&#160;&#160;oShape&#160;=&#160;FindShapeForControl(oDrawPage,&#160;oControl)<br/>&#160; If Not&#160;IsEmpty(oShape) Then<br/>&#160; &#160; If&#160;oShape.getAnchor().supportsService(&#34;com.sun.star.sheet.SheetCell&#34;) Then<br/>&#160; &#160; &#160;&#160;FindCellWithControl&#160;=&#160;oShape.getAnchor()<br/>&#160; &#160; End If<br/>&#160; End If<br/>End Function<br/>
Function&#160;FindShapeForControl(oDrawPage,&#160;oControl)<br/>&#160;&#160;Dim&#160;i<br/>&#160;&#160;Dim&#160;oShape<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oDrawPage.getCount()<br/>&#160; &#160;&#160;oShape&#160;=&#160;oDrawPage.getByIndex(i)<br/>&#160; &#160;&#160;If&#160;oShape.supportsService(&#34;com.sun.star.drawing.ControlShape&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;If&#160;EqualUNOObjects(oControl,&#160;oShape.Control)&#160;Then<br/>
246<br/>
<hr/>
<a name=250></a>&#160; &#160; &#160; &#160;&#160;FindShapeForControl&#160;=&#160;oShape<br/>&#160; &#160; &#160; &#160;&#160;Exit&#160;Function<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>End&#160;Function<br/>
What&#160;does&#160;the&#160;event&#160;handler called&#160;by&#160;the&#160;button&#160;look like?<br/>
Sub&#160;ButtonHandler(oEvent)<br/>&#160;&#160;Dim&#160;oControlModel<br/>&#160;&#160;Dim&#160;oParent<br/>&#160;&#160;Dim&#160;oCell<br/>&#160;&#160;<br/>&#160;&#160;'Print oEvent.Source.Model.getName()<br/>&#160;&#160;oControlModel&#160;=&#160;oEvent.Source.Model<br/>&#160;&#160;<br/>&#160;&#160;oParent&#160;=&#160;oControlModel.getParent()<br/>&#160;&#160;Do&#160;While&#160;NOT&#160;oParent.supportsService(&#34;com.sun.star.sheet.SpreadsheetDocument&#34;)&#160;<br/>&#160; &#160;&#160;oParent&#160;=&#160;oParent.getParent()<br/>&#160;&#160;Loop&#160;<br/>&#160;&#160;<br/>&#160;&#160;oCell&#160;=&#160;FindCellWithControl(oParent.getCurrentController().getActiveSheet().getDrawPage(),&#160;<br/>oControlModel)<br/>&#160;&#160;If&#160;NOT&#160;IsEmpty(oCell)&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;Control is in cell &#34;&#160;&amp;&#160;oCell.AbsoluteName<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;Unable to find cell with control&#34;<br/>&#160;&#160;ENd&#160;If<br/>End&#160;Sub&#160;<br/>
<i><b>&#160;10.9.&#160;Built-in&#160;global&#160;UNO&#160;variables<br/></b></i>OOo Basic&#160;contains&#160;built-in global&#160;variables&#160;that&#160;provide&#160;quick&#160;access&#160;to&#160;frequently&#160;used components&#160;in&#160;<br/>OOo.&#160;The&#160;most&#160;commonly&#160;used variable&#160;is&#160;ThisComponent,&#160;which&#160;refers&#160;to&#160;the&#160;currently&#160;active&#160;document.&#160;<br/>To&#160;demonstrate&#160;using the&#160;variable&#160;ThisComponent, the&#160;macro i<a href="libremacros.html#250">n&#160;Listing&#160;226&#160;di</a>splays&#160;all&#160;of the&#160;styles&#160;in&#160;the&#160;<br/>current&#160;document.<a href="libremacros.html#251">&#160;Figure&#160;75&#160;i</a>s&#160;only&#160;one&#160;of the&#160;many&#160;dialogs&#160;that&#160;are&#160;displayed while&#160;the&#160;macro runs.&#160;The&#160;<br/>fact&#160;that&#160;a&#160;style&#160;exists&#160;in&#160;a&#160;document&#160;does&#160;not&#160;imply&#160;that&#160;the&#160;style&#160;is&#160;actually&#160;used in&#160;the&#160;document.<br/>
<i><b>Listing&#160;226.</b>&#160;Display&#160;all&#160;styles&#160;known&#160;by&#160;this&#160;document.<br/></i>Sub&#160;DisplayAllStyles<br/>&#160;&#160;Dim&#160;vFamilies&#160;As&#160;Variant&#160;'All the style types<br/>&#160;&#160;Dim&#160;vFamNames&#160;As&#160;Variant&#160;'Array with names of the style types<br/>&#160;&#160;Dim&#160;vStyles&#160;As&#160;Variant&#160; &#160;'One style type such as Number or Page Styles<br/>&#160;&#160;Dim&#160;vStlNames&#160;As&#160;Variant&#160;'Array with names of specific styles<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160;&#160;'Message to display<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160;'Iterate through the style types<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160;'Iterate through the styles<br/>&#160;&#160;<br/>&#160;&#160;vFamilies&#160;=&#160;ThisComponent.StyleFamilies&#160; &#160; &#160; &#160; &#160; &#160;'Get the styles<br/>&#160;&#160;vFamNames&#160;=&#160;vFamilies.getElementNames()&#160; &#160; &#160; &#160; &#160; &#160;'What type of styles?<br/>&#160;&#160;For&#160;n&#160;=&#160;LBound(vFamNames)&#160;To&#160;UBound(vFamNames)&#160; &#160;&#160;'Look at all style types<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160;&#160;vStyles&#160;=&#160;vFamilies.getByName(vFamNames(n))&#160; &#160; &#160;'Get styles of a type<br/>
247<br/>
<hr/>
<a name=251></a>&#160; &#160;&#160;vStlNames&#160;=&#160;vStyles.getElementNames()&#160; &#160; &#160; &#160; &#160; &#160;'names of styles for type<br/>&#160; &#160;&#160;For&#160;i&#160;=&#160;LBound(vStlNames)&#160;To&#160;UBound&#160;(vStlNames)&#160;'for all styles of a type<br/>&#160; &#160; &#160;&#160;s=s&#160;&amp;&#160;i&#160;&amp;&#160;&#34; : &#34;&#160;&amp;&#160;vStlNames(i)&#160;&amp;&#160;Chr$(13)&#160; &#160; &#160;'Build a display string<br/>&#160; &#160; &#160;&#160;If&#160;((i&#160;+&#160;1)&#160;Mod&#160;35&#160;=&#160;0)&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Display 35 at a time<br/>&#160; &#160; &#160; &#160;&#160;MsgBox&#160;s,0,vFamNames(n)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Display them<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Clear string, start over<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Next&#160;i&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Next style<br/>&#160; &#160;&#160;If&#160;Len(s)&#160;&gt;&#160;0&#160;Then&#160;MsgBox&#160;s,0,vFamNames(n)&#160; &#160; &#160;&#160;'Leftover styles for type<br/>&#160;&#160;Next&#160;n&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Next style type<br/>End&#160;Sub<br/>
<i><b>Figure&#160;75.</b>&#160;Frame&#160;styles&#160;known by&#160;the&#160;current&#160;document.</i><br/>
OpenOffice&#160;is&#160;based on the&#160;same&#160;code&#160;as&#160;StarOffice, which had a&#160;desktop.&#160;All&#160;of the&#160;individual&#160;windows&#160;<br/>were&#160;contained in&#160;this&#160;desktop.&#160;The&#160;desktop&#160;paradigm&#160;is&#160;now&#160;gone, but&#160;for legacy&#160;reasons&#160;a&#160;desktop&#160;object&#160;<br/>still&#160;acts&#160;as&#160;the&#160;global&#160;application&#160;that&#160;ties&#160;all&#160;of the&#160;documents&#160;together.&#160;Although I&#160;frequently&#160;see&#160;code&#160;that&#160;<br/>creates&#160;a&#160;desktop&#160;service&#160; by&#160;using the&#160;function&#160;CreateUnoService, this&#160;is&#160;not&#160;required in OOo Basic. OOo&#160;<br/>Basic&#160;provides&#160;the&#160;variable&#160;StarDesktop, which accesses&#160;the&#160;primary&#160;desktop&#160;service&#160;in&#160;OOo.&#160;The&#160;macro i<a href="libremacros.html#251">n<br/>Listing 227&#160;de</a>monstrates&#160;the&#160;use&#160;of the&#160;StarDesktop&#160;by&#160;traversing all&#160;of the&#160;currently&#160;open documents.&#160;The&#160;<br/>getDocType&#160;method&#160;is&#160;defined in<a href="libremacros.html#242">&#160;Listing 219.</a><br/>
<i><b>Listing&#160;227.</b>&#160;Inspect&#160;each open component.<br/></i>Sub&#160;IterateThroughAllDocs<br/>&#160;&#160;On&#160;Error&#160;Resume&#160;Next&#160; &#160; &#160;&#160;'Ignore the non-document components<br/>&#160;&#160;Dim&#160;vComponents&#160;As&#160;Object&#160;'All of the components<br/>&#160;&#160;Dim&#160;vDocs&#160;As&#160;Object&#160; &#160; &#160; &#160;'Enumeration of the documents<br/>&#160;&#160;Dim&#160;vDoc&#160;As&#160;Object&#160; &#160; &#160; &#160;&#160;'A single document<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;GlobalScope.BasicLibraries.LoadLibrary(&#34;Tools&#34;)'Contains FileNameOutOfPath<br/>&#160;&#160;vComponents&#160;=&#160;StarDesktop.getComponents()&#160; &#160; &#160;&#160;'Get all the components<br/>&#160;&#160;vDocs&#160;=&#160;vComponents.createEnumeration()&#160; &#160; &#160; &#160;&#160;'Enumerate them<br/>&#160;&#160;Do&#160;While&#160;vDocs.hasMoreElements()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'While there are more<br/>&#160; &#160;&#160;vDoc&#160;=&#160;vDocs.nextElement()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Get the next component<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;getDocType(vDoc)&#160;&amp;&#160;&#34; &#160; &#34;&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Add the document type<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;FileNameOutOfPath(vDoc.getURL())&#160; &#160; &#160;'Add the file name<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Add a new line<br/>&#160;&#160;Loop<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Currently Open Components&#34;<br/>
248<br/>
<hr/>
<a name=252></a>End&#160;Sub<br/>
<b>TIP</b><br/>
The&#160;primary&#160;visible&#160;windows&#160;in OOo&#160;are&#160;called “components.”&#160;Every&#160;open&#160;document&#160;is a&#160;component,&#160;as is<br/>
the&#160;Basic&#160;IDE&#160;and&#160;the&#160;Help&#160;window.&#160;In&#160;OOo, the&#160;word&#160;“component”&#160;almost&#160;always means&#160;an open&#160;<br/>document.<br/>
While&#160;iterating through the&#160;open documents&#160;(components), you&#160;may&#160;find some&#160;unexpected documents.&#160;<br/>These&#160;are&#160;component&#160;windows&#160;such as&#160;the&#160;Basic&#160;IDE&#160;and the&#160;Help window.&#160;The&#160;macro i<a href="libremacros.html#251">n&#160;Listing&#160;227&#160;us</a>es&#160;<br/>the&#160;function&#160;FileNameOutOfPath.&#160;This&#160;is&#160;another macro and is&#160;not&#160;a&#160;function that&#160;is&#160;built&#160;into&#160;OOo Basic.&#160;<br/>This&#160;function&#160;is&#160;stored in&#160;the&#160;Strings&#160;module&#160;of the&#160;application-level&#160;Tools&#160;library.&#160;If&#160;a&#160;library&#160;is&#160;not&#160;<br/>currently&#160;loaded, you cannot&#160;call&#160;the&#160;methods&#160;that&#160;it&#160;contains.&#160;<br/>
The&#160;GlobalScope&#160;variable&#160;references&#160;the&#160;application-level&#160;libraries&#160;and is&#160;used to load&#160;the&#160;Tools&#160;library.&#160;<br/>Loading a&#160;library&#160;loads&#160;all&#160;of the&#160;modules&#160;in&#160;the&#160;specified library.&#160;OOo contains&#160;libraries&#160;and modules&#160;that&#160;<br/>are&#160;not&#160;built&#160;into&#160;OOo Basic.&#160;Use&#160;the&#160;LoadLibrary&#160;method before&#160;you use&#160;the&#160;routines&#160;in&#160;the&#160;libraries.<br/>
GlobalScope.BasicLibraries.LoadLibrary(&#34;Tools&#34;)<br/>
To&#160;access&#160;the&#160;Basic&#160;libraries&#160;in&#160;the&#160;current&#160;document, either use&#160;the&#160;BasicLibraries&#160;global&#160;variable&#160;or access&#160;<br/>the&#160;BasicLibraries&#160;property&#160;in&#160;the&#160;current&#160;document.<br/>
Print&#160;EqualUnoObjects(vObj.BasicLibraries,&#160;BasicLibraries)&#160;&#160;'True<br/>
Use&#160;the&#160;DialogLibraries&#160;variable&#160;to&#160;access&#160;the&#160;dialog libraries&#160;in&#160;the&#160;current&#160;document. Unlike&#160;<br/>BasicLibraries,&#160;an individual&#160;document&#160;does&#160;not&#160;contain a&#160;property&#160;called&#160;DialogLibaries&#160;to&#160;directly&#160;obtain&#160;<br/>the&#160;dialog libraries&#160;for a&#160;specific&#160;document.&#160;You can easily&#160;obtain the&#160;dialog and Basic&#160;libraries&#160;for a&#160;specific<br/>document&#160;through a&#160;less&#160;direct&#160;route.&#160;Each document&#160;has&#160;a&#160;LibraryContainer property.&#160;<br/>
ThisComponent.LibraryContainer.getByName(&#34;OOME_30&#34;).getModuleContainer()<br/>ThisComponent.LibraryContainer.getByName(&#34;OOME_30&#34;).getDialogContainer()<br/>
The&#160;getByName() method on the&#160;LibraryContainer returns&#160;the&#160;named library.&#160;The&#160;getModuleContainer()&#160;<br/>method&#160;returns&#160;the&#160;Basic&#160;container for the&#160;specified&#160;library,&#160;and the&#160;getDialogContainer() method&#160;returns&#160;the<br/>Dialog container for the&#160;specified&#160;library.&#160;The&#160;code&#160;in<a href="libremacros.html#252">&#160;Listing 228, ho</a>wever,&#160;uses&#160;the&#160;variables&#160;<br/>DialogLibraries&#160;and BasicLibraries&#160;to&#160;list&#160;the&#160;number of dialogs&#160;and modules&#160;in each library&#160;in&#160;the&#160;current&#160;<br/>document.<a href="libremacros.html#253">&#160;Figure&#160;76&#160;s</a>hows&#160;the&#160;results.<br/>
<i><b>Listing&#160;228.</b>&#160;View the&#160;libraries&#160;and dialogs&#160;stored in the&#160;current&#160;document.</i><br/>
Sub&#160;ExamineDocumentLibraries<br/>&#160;&#160;Dim&#160;vLibs&#160; &#160; &#160; &#160; &#160; &#160;'Hold the library names<br/>&#160;&#160;Dim&#160;vMod&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Hold the modules/dialogs object<br/>&#160;&#160;Dim&#160;nNumMods%&#160; &#160; &#160; &#160;'Number of modules or dialogs in a library<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Scrap index variable<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Scrap string variable<br/>&#160;&#160;s&#160;=&#160;&#34;*** Dialog Libs In Document&#34;&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160; &#160; &#160;'Initialize s<br/>&#160;&#160;vLibs&#160;=&#160;DialogLibraries.getElementNames()&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Library names<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(vLibs)&#160;To&#160;UBound(vLibs)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Look at each name<br/>&#160; &#160;&#160;vMod&#160;=&#160;DialogLibraries.getByName(vLibs(i))&#160; &#160; &#160; &#160; &#160;'Get the dialog library<br/>&#160; &#160;&#160;nNumMods&#160;=&#160;UBound(vMod.getElementNames())&#160;+&#160;1&#160; &#160; &#160;&#160;'How many dialogs<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vLibs(i)&#160;&amp;&#160;&#34; has &#34;&#160;&amp;&#160;nNumMods&#160;&amp;&#160;&#34; dialogs&#34;&#160;'Build string<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next&#160;i<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;*** Basic Libs In Document&#34;&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160;&#160;'Ready for code libs<br/>&#160;&#160;vLibs&#160;=&#160;BasicLibraries.getElementNames()&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Library names<br/>
249<br/>
<hr/>
<a name=253></a>&#160;&#160;For&#160;i&#160;=&#160;LBound(vLibs)&#160;To&#160;UBound(vLibs)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Look at each name<br/>&#160; &#160;&#160;vMod&#160;=&#160;BasicLibraries.getByName(vLibs(i))&#160; &#160; &#160; &#160; &#160;&#160;'Get the code library<br/>&#160; &#160;&#160;nNumMods&#160;=&#160;UBound(vMod.getElementNames())&#160;+&#160;1&#160; &#160; &#160;&#160;'Number of modules<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vLibs(i)&#160;&amp;&#160;&#34; has &#34;&#160;&amp;&#160;nNumMods&#160;&amp;&#160;&#34; modules&#34;&#160;'Build the string<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next&#160;i<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Libraries&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;76.</b>&#160;Dialog&#160;and Basic&#160;libraries&#160;in&#160;the&#160;current&#160;document.</i><br/>
To&#160;view&#160;the&#160;libraries&#160;in&#160;the&#160;application-level&#160;library&#160;container,&#160;modify&#160;the&#160;code&#160;in<a href="libremacros.html#252">&#160;Listing 228.&#160;</a>Add&#160;<br/>GlobalScope&#160;before&#160;each occurrence&#160;of BasicLibraries&#160;and DialogLibraries.&#160;<br/>
<i><b>&#160;10.10.&#160;Creating&#160;UNO&#160;values&#160;for&#160;OOo&#160;internals<br/></b></i>OOo Basic&#160;does&#160;an excellent&#160;job&#160;of converting between the&#160;native&#160;Basic&#160;types&#160;and the&#160;types&#160;required&#160;<br/>internally&#160;by&#160;OOo. However,&#160;if you call&#160;a&#160;method on a&#160;Universal&#160;Network Object&#160;and OOo Basic&#160;doesn’t&#160;<br/>know&#160;what&#160;the&#160;type&#160;should&#160;be, it&#160;may&#160;not&#160;properly&#160;convert&#160;the&#160;type. For example, the&#160;setPropertyValue&#160;<br/>method&#160;in the&#160;XPropertySet&#160;interface&#160;accepts&#160;two arguments&#160;—&#160;a&#160;string name&#160;of the&#160;property&#160;to&#160;set&#160;and the&#160;<br/>value&#160;to&#160;set.&#160;The&#160;type&#160;of the&#160;value&#160;to&#160;set&#160;depends&#160;on which property&#160;is&#160;set.&#160;Use&#160;the&#160;function&#160;CreateUnoValue&#160;<br/>(shown i<a href="libremacros.html#253">n&#160;Listing&#160;229) t</a>o create&#160;a&#160;reference&#160;to a&#160;Universal&#160;Network Object&#160;that&#160;contains&#160;the&#160;appropriate&#160;type<br/>if there&#160;is&#160;a&#160;problem&#160;creating the&#160;correct&#160;type. I&#160;have&#160;never seen this&#160;happen, so don’t&#160;fret&#160;that&#160;much&#160;about&#160;<br/>your arguments;&#160;you&#160;can almost&#160;always&#160;trust&#160;OOo Basic&#160;to do the&#160;correct&#160;thing.<br/>
<i><b>Listing&#160;229.</b>&#160;Use&#160;CreateUnoValue&#160;to&#160;create&#160;a reference&#160;to&#160;an internal&#160;UNO&#160;value.</i><br/>
Dim&#160;v<br/>v&#160;=&#160;CreateUnoValue(&#34;unsigned long&#34;,&#160;10)<br/>v&#160;=&#160;CreateUnoValue(&#34;string&#34;,&#160;&#34;hello&#34;)<br/>v&#160;=&#160;CreateUnoValue(&#34;byte&#34;,&#160;10)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'A byte is from 0 through 255<br/>v&#160;=&#160;CreateUnoValue(&#34;[]byte&#34;,&#160;Array(3,&#160;2,&#160;1))&#160;'You can even create arrays<br/>'v = CreateUnoValue(&#34;Byte&#34;, 10) &#160; &#160; &#160; &#160; &#160; &#160; &#160;'No such element exception<br/>'v = CreateUnoValue(&#34;byte&#34;, 1000) &#160; &#160; &#160; &#160; &#160; &#160;'Out of range exception<br/>'v = CreateUnoValue(&#34;uint64&#34;, 10) &#160; &#160; &#160; &#160; &#160; &#160;'No such element exception<br/>
The&#160;first&#160;argument&#160;to CreateUnoValue&#160;is&#160;the&#160;data&#160;type&#160;that&#160;should be&#160;created.&#160;The&#160;supported&#160;data&#160;types&#160;are&#160;<br/>void, char,&#160;boolean, byte, short,&#160;unsigned short,&#160;long, unsigned long, hyper,&#160;unsigned hyper,&#160;float, double,&#160;<br/>string, type, and any.&#160;The&#160;names&#160;are&#160;case&#160;sensitive&#160;and may&#160;be&#160;preceded by&#160;square&#160;brackets&#160;to indicate&#160;an&#160;<br/>array.&#160;The&#160;value&#160;returned by&#160;CreateUNOValue&#160;is&#160;not&#160;usable&#160;by&#160;OOo Basic;&#160;it&#160;is&#160;only&#160;useful&#160;to&#160;the&#160;internals&#160;<br/>of OOo. In&#160;other words, do not&#160;create&#160;a&#160;“byte”&#160;type&#160;and then expect&#160;to use&#160;it&#160;as&#160;a&#160;number.<br/>
250<br/>
<hr/>
<a name=254></a><i><b>Listing&#160;230.</b>&#160;Test&#160;types&#160;supported by&#160;CreateUnoValue.<br/></i>Sub&#160;TestCreateUnoValues<br/>&#160;&#160;Dim&#160;typeNames<br/>&#160;&#160;Dim&#160;v<br/>&#160;&#160;Dim&#160;i%<br/>
&#160;&#160;typeNames&#160;=&#160;Array(&#34;void&#34;,&#160;&#34;boolean&#34;,&#160;&#34;char&#34;,&#160;&#34;byte&#34;,&#160;&#34;string&#34;,&#160;_<br/>&#160; &#160; &#160;&#160;&#34;short&#34;,&#160;&#34;unsigned short&#34;,&#160;&#34;long&#34;,&#160;&#34;unsigned long&#34;,&#160;_<br/>&#160; &#160; &#160;&#160;&#34;hyper&#34;,&#160;&#34;unsigned hyper&#34;,&#160;&#34;float&#34;,&#160;&#34;double&#34;,&#160;&#34;any&#34;)<br/>&#160; &#160; &#160;&#160;<br/>&#160;&#160;' I took the list of names from<br/>&#160;&#160;' cppu/source/typelib/typelib.cxx<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(typeNames)&#160;To&#160;UBound(typeNames)<br/>&#160; &#160;&#160;v&#160;=&#160;CreateUnoValue(typeNames(i),&#160;65)<br/>&#160; &#160;&#160;' You cannot directly use the value because it is an UNO type,<br/>&#160; &#160;&#160;' which is only good for passing back into UNO.<br/>&#160; &#160;&#160;' Things like &#34;Print v&#34; or &#34;CStr(v)&#34; will fail.<br/>&#160;&#160;Next<br/>End&#160;Sub&#160;<br/>
<i><b>&#160;10.11.&#160;Finding&#160;objects&#160;and&#160;properties<br/></b></i>OOo Basic&#160;has&#160;functions&#160;to find&#160;variables&#160;and their properties&#160;based on their names.&#160;This&#160;functionality&#160;was&#160;<br/>initially&#160;described to&#160;me&#160;as&#160;poorly&#160;documented,&#160;possibly&#160;deprecated, and buggy&#160;—&#160;and I&#160;cannot&#160;disagree.&#160;<br/>Use&#160;FindObject&#160;to obtain a&#160;reference&#160;to a&#160;variable&#160;with&#160;a&#160;given name, and FindPropertyObject&#160;to&#160;obtain&#160;a&#160;<br/>reference&#160;to a&#160;named property&#160;of an object.&#160;The&#160;macro i<a href="libremacros.html#254">n&#160;Listing&#160;231&#160;de</a>monstrates&#160;some&#160;of the&#160;<br/>idiosyncrasies&#160;of the&#160;FindObject&#160;and FindPropertyObject&#160;functions.<br/>
<b>TIP</b><br/>
Do not&#160;use&#160;the&#160;functions FindObject&#160;and FindPropertyObject&#160;— they&#160;are&#160;poorly&#160;documented,&#160;buggy,&#160;and&#160;<br/>likely&#160;to&#160;be&#160;deprecated. I&#160;only&#160;mention the&#160;methods to&#160;be&#160;complete.<br/>
<i><b>Listing&#160;231.</b>&#160;Test&#160;the&#160;FindObject&#160;method.<br/></i>Sub&#160;TestFindObject<br/>&#160;&#160;Dim&#160;oTst<br/>&#160;&#160;Dim&#160;oDoc &#160;'Initial value is EMPTY, whis ic not null.<br/>&#160;&#160;Dim&#160;oLib &#160;'Gimmicks library.<br/>&#160;&#160;Dim&#160;oMod &#160;'UserFields module in the Gimmicks library.<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;<br/>&#160; oTst&#160;=&#160;FindObject(&#34;oDoc&#34;)<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;&#34;oTst = FindObject(&#34;&#34;oDoc&#34;&#34;), &#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;IsNull(oTst) = &#34;&#160;&amp;&#160;IsNull(oTst)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34; and (oTst IS oDoc) = &#34;&#160;&amp;&#160;(oTst&#160;IS&#160;oDoc)<br/>&#160; &#160; &#160;&#160;<br/>&#160;&#160;Rem Test against the current document<br/>&#160; oDoc&#160;=&#160;ThisComponent<br/>&#160; oTst&#160;=&#160;FindObject(&#34;oDoc&#34;)<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oDoc = ThisComponent&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oTst = FindObject(&#34;&#34;oDoc&#34;&#34;)&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>
251<br/>
<hr/>
<a name=255></a>&#160; &#160; &#160;&#160;&#34;oDoc IS ThisComponent = &#34;&#160;&amp;&#160;(oDoc&#160;IS&#160;ThisComponent)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oTst IS oDoc = &#34;&#160;&amp;&#160;(oTst&#160;IS&#160;oDoc)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oTst IS ThisComponent = &#34;&#160;&amp;&#160;(oTst&#160;IS&#160;ThisComponent)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oTst = FindObject(&#34;&#34;ThisComponent&#34;&#34;)&#34;&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;REM Do it again, but do search for ThisComponent<br/>&#160; oTst&#160;=&#160;FindObject(&#34;ThisComponent&#34;)<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;s&#160;&amp;&#160;&#34;oTst IS oDoc&#34;&#160;&amp;&#160;(oTst&#160;IS&#160;oDoc)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oTst IS ThisComponent = &#34;&#160;&amp;&#160;(oTst&#160;IS&#160;ThisComponent)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oDoc IS ThisComponent = &#34;&#160;&amp;&#160;(&#160;oDoc&#160;IS&#160;ThisComponent)&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;REM ThisComponent has a DocumentInfo property<br/>&#160; oTst&#160;=&#160;FindPropertyObject(ThisComponent,&#160;&#34;DocumentInfo&#34;)<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;s&#160;&amp;&#160;&#34;IsNull(FindPropertyObject(ThisComponent, &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;&#34;&#34;DocumentInfo&#34;&#34;))&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;returns &#34;&#160;&amp;&#160;IsNull(oTst)<br/>&#160; &#160; &#160;&#160;<br/>&#160;&#160;MsgBox&#160;s<br/>&#160;&#160;<br/>&#160;&#160;<br/>&#160;&#160;REM Load the Gimmicks library<br/>&#160;&#160;GlobalScope.BasicLibraries.LoadLibrary(&#34;Gimmicks&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Find the library even though it is not a variable<br/>&#160; oLib&#160;=&#160;FindObject(&#34;Gimmicks&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM userfields is a module in the Gimmicks library<br/>&#160; oMod&#160;=&#160;FindPropertyObject(oLib,&#160;&#34;Userfields&#34;)<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;&#34;And now for something different.&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;Find the loaded Gimmicks library&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oMod Is Gimmicks.Userfields = &#34;&#160;&amp;&#160;(oMod&#160;Is&#160;Gimmicks.Userfields)<br/>&#160; &#160; &#160;&#160;<br/>&#160; &#160;MsgBox&#160;s<br/>&#160;&#160;<br/>&#160;&#160;'The StartChangesUserfields function is in the module Userfields<br/>&#160;&#160;'Call the routine<br/>&#160;&#160;Print&#160;&#34;Call 'StartChangesUserfields' directly&#34;<br/>&#160; oLib.Userfields.StartChangesUserfields<br/>&#160;&#160;Print&#160;&#34;Call 'StartChangesUserfields' using oMod&#34;<br/>&#160; oMod.StartChangesUserfields<br/>End&#160;Sub<br/>
If&#160;these&#160;functions&#160;serve&#160;your purposes, use&#160;them.&#160;I&#160;tried to&#160;use&#160;these&#160;to write&#160;an object&#160;inspector,&#160;but&#160;the&#160;<br/>FindPropertyObject&#160;function did&#160;not&#160;work as&#160;I&#160;expected.<br/>
<i><b>&#160;10.12.&#160;UNO&#160;listeners<br/></b></i>OOo uses&#160;listeners&#160;to inform&#160;other objects&#160;what&#160;it&#160;is&#160;doing. Consider a&#160;hospital&#160;worker as&#160;an analogy:&#160;Before<br/>I&#160;(the&#160;hospital&#160;worker) do anything interesting to treat&#160;patient&#160;Paolo,&#160;I&#160;am&#160;required first&#160;to&#160;call&#160;his&#160;parents.&#160;<br/>
252<br/>
<hr/>
<a name=256></a>For&#160;some&#160;things&#160;the&#160;parents&#160;may&#160;say&#160;“no, you&#160;cannot&#160;do that”, and for others&#160;the&#160;parents&#160;are&#160;only&#160;informed&#160;<br/>(status&#160;updates).&#160;This&#160;is&#160;very&#160;similar&#160;to UNO&#160;listeners.&#160;The&#160;code&#160;that&#160;you write&#160;is&#160;called&#160;the&#160;listener,&#160;and the&#160;<br/>thing to which you listen is&#160;called the&#160;broadcaster.&#160;In&#160;the&#160;previous&#160;example, the&#160;hospital&#160;worker is&#160;the&#160;<br/>broadcaster and Paolo’s&#160;parents&#160;are&#160;the&#160;listeners.<br/>
You can listen to&#160;the&#160;OOo objects&#160;that&#160;act&#160;as&#160;a&#160;broadcaster.&#160;The&#160;routines&#160;required to&#160;listen to&#160;a&#160;specific&#160;OOo&#160;<br/>interface&#160;are&#160;specific&#160;to that&#160;interface. In&#160;other words, the&#160;set&#160;of subroutines&#160;and functions&#160;that&#160;can act&#160;as&#160;a&#160;<br/>listener to printing&#160;events&#160;is&#160;different&#160;than the&#160;set&#160;of subroutines&#160;and functions&#160;that&#160;can listen to&#160;keystroke&#160;<br/>events.<br/>
<b>TIP</b><br/>
If&#160;you&#160;do&#160;not&#160;implement&#160;a&#160;required&#160;method&#160;specified&#160;for&#160;the&#160;listener&#160;interface,&#160;the&#160;listener&#160;may&#160;crash OOo.<br/>
<b>&#160;10.12.1.&#160;Your&#160;first&#160;listener<br/></b>This&#160;listener is&#160;presented with&#160;details&#160;that&#160;are&#160;explained&#160;in the&#160;next&#160;section,&#160;so, follow&#160;the&#160;easy&#160;process&#160;and&#160;<br/>then find out&#160;why.&#160;A&#160;print&#160;listener is&#160;demonstrated in&#160;secti<a href="libremacros.html#347">on&#160;13.15.3&#160;A&#160;Calc&#160;example&#160;with a&#160;Print&#160;listener.</a><br/>
All&#160;listeners&#160;must&#160;implement&#160;the&#160;methods&#160;in the&#160;com.sun.star.lang.XEventListener interface, which defines&#160;a<br/>one&#160;subroutine;&#160;disposing(EventObject).&#160;The&#160;disposing&#160;method is&#160;called when the&#160;broadcaster is&#160;about&#160;to&#160;<br/>become&#160;unavailable.&#160;In&#160;other words, the&#160;broadcaster will&#160;no longer exist&#160;and you&#160;should&#160;not&#160;use&#160;it.&#160;For&#160;<br/>example,&#160;a&#160;print&#160;job&#160;is&#160;finished&#160;so it&#160;is&#160;no longer required or a&#160;document&#160;is&#160;closing<a href="libremacros.html#256">.&#160;Listing&#160;232&#160;de</a>monstrates<br/>the&#160;most&#160;basic&#160;listener possible,&#160;XEventListener;&#160; Notice&#160;the&#160;string prefix&#160;“first_listen_”&#160;before&#160;the&#160;required&#160;<br/>name&#160;“disposing”;&#160;I&#160;chose&#160;“first_listen_”&#160;because&#160;it&#160;is&#160;descriptive.<br/>
<i><b>Listing&#160;232.</b>&#160;Simple&#160;listener&#160;that&#160;does&#160;nothing.</i><br/>
Sub&#160;first_listen_disposing(&#160;vArgument&#160;)<br/>&#160; &#160;&#160;MsgBox&#160;&#34;Disposing In First Listener&#34;<br/>End&#160;Sub<br/>
<a href="libremacros.html#256">Listing 232&#160;i</a>s&#160;all&#160;that&#160;is&#160;required for this&#160;simple&#160;listener.&#160;Use&#160;the&#160;CreateUNOListener to create&#160;a&#160;UNO&#160;<br/>listener that&#160;is&#160;associated with&#160;the&#160;macro i<a href="libremacros.html#256">n&#160;Listing&#160;232.&#160;</a>The&#160;first&#160;argument&#160;is&#160;the&#160;string prefix&#160;and the&#160;<br/>second argument&#160;is&#160;the&#160;name&#160;of the&#160;service&#160;to&#160;create.<br/>
The&#160;routine&#160;in<a href="libremacros.html#256">&#160;Listing 233&#160;c</a>reates&#160;the&#160;UNO&#160;listener and associates&#160;it&#160;with&#160;the&#160;routine&#160;i<a href="libremacros.html#256">n&#160;Listing&#160;232.&#160;</a>When&#160;<br/>the&#160;disposing method&#160;is&#160;called&#160;on vListener,&#160;it&#160;calls&#160;the&#160;routine&#160;i<a href="libremacros.html#256">n&#160;Listing&#160;232.</a><br/>
<b>TIP</b><br/>
The&#160;code&#160;i<a href="libremacros.html#256">n&#160;Listing&#160;233&#160;c</a>reates a&#160;listener&#160;and then calls the&#160;objects disposing&#160;method.&#160;The&#160;listener&#160;is&#160;<br/>implemented&#160;i<a href="libremacros.html#256">n&#160;Listing&#160;232,&#160;</a>so,&#160;this ultimately&#160;calls first_listen_disposing&#160;in<a href="libremacros.html#256">&#160;Listing&#160;232.</a><br/>
<i><b>Listing&#160;233.</b>&#160;Create&#160;a listener&#160;and then&#160;call&#160;the&#160;disposing&#160;method.<br/></i>Sub&#160;MyFirstListener<br/>&#160;&#160;Dim&#160;vListener<br/>&#160;&#160;Dim&#160;vEventObj&#160;As&#160;New&#160;com.sun.star.lang.EventObject<br/>&#160;&#160;Dim&#160;sPrefix$<br/>&#160;&#160;Dim&#160;sService$<br/>&#160;&#160;sPrefix&#160;=&#160;&#34;first_listen_&#34;<br/>&#160;&#160;sService&#160;=&#160;&#34;com.sun.star.lang.XEventListener&#34;<br/>&#160;&#160;vListener&#160;=&#160;CreateUnoListener(sPrefix,&#160;sService)<br/>&#160;&#160;vListener.disposing(vEventObj)<br/>End&#160;Sub<br/>
253<br/>
<hr/>
<a name=257></a><b>&#160;10.12.2.&#160;A&#160;complete&#160;listener:&#160;selection&#160;change&#160;listener<br/></b>The&#160;two most&#160;difficult&#160;parts&#160;of creating a&#160;listener are&#160;determining&#160;which broadcaster and which&#160;listener&#160;<br/>interface&#160;to&#160;use.&#160;The&#160;rest&#160;of the&#160;steps&#160;are&#160;easier.<br/>
1)&#160;Determine&#160;the&#160;broadcaster to use.<br/>
2)&#160;Determine&#160;the&#160;listener interface&#160;to&#160;implement.<br/>
3)&#160;Create&#160;global&#160;variables&#160;for the&#160;listener and maybe&#160;the&#160;broadcaster.&#160;Test&#160;your&#160;understanding and ask&#160;<br/>
yourself why&#160;the&#160;variable&#160;must&#160;be&#160;global&#160;before&#160;reading&#160;the&#160;tip below.<br/>
4)&#160;Determine&#160;the&#160;prefix&#160;that&#160;you&#160;will&#160;use;&#160;make&#160;it&#160;descriptive.<br/>
5)&#160;Write&#160;all&#160;of the&#160;subroutines&#160;and functions&#160;that&#160;implement&#160;the&#160;listener.<br/>
6)&#160;Create&#160;the&#160;UNO&#160;listener and save&#160;it&#160;in&#160;the&#160;global&#160;variable.<br/>
7)&#160;Register the&#160;listener with the&#160;broadcaster.<br/>
8)&#160;When finished, remove&#160;the&#160;listener from&#160;the&#160;broadcaster.<br/>
<b>TIP</b><br/>
Why&#160;store&#160;the&#160;listener&#160;in a&#160;global&#160;variable?&#160;There&#160;is usually&#160;a&#160;subroutine&#160;to create&#160;and&#160;register&#160;the&#160;listener&#160;<br/>
with the&#160;broadcaster&#160;and&#160;then the&#160;macro ends.&#160;The&#160;listener&#160;must&#160;exist&#160;when the&#160;macro&#160;stops running.&#160;The&#160;<br/>only&#160;way&#160;to&#160;do&#160;this&#160;in&#160;Basic&#160;is to use&#160;a&#160;Global&#160;variable.&#160;Another&#160;macro,&#160;run later,&#160;removes the&#160;listener&#160;from<br/>
the&#160;broadcaster.&#160;The&#160;latter&#160;macro&#160;must&#160;be&#160;able&#160;to access the&#160;listener.<br/>
Knowing which&#160;broadcaster to use&#160;is&#160;not&#160;always&#160;an easy&#160;task. It&#160;requires&#160;understanding&#160;how&#160;OOo is&#160;<br/>designed;&#160;this&#160;comes&#160;with&#160;experience.&#160;There&#160;is&#160;usually&#160;an obvious&#160;place&#160;to&#160;start&#160;looking&#160;—&#160;the&#160;current&#160;<br/>document,&#160;available&#160;from&#160;the&#160;variable&#160;ThisComponent,&#160;contains&#160;the&#160;document&#160;data.&#160;For&#160;example, the&#160;<br/>document&#160;accepts&#160;an XPrintJobListener to&#160;monitor how&#160;printing is&#160;progressing. Most&#160;tasks&#160;related&#160;to user&#160;<br/>interactions&#160;—&#160;such as&#160;selecting text,&#160;moving the&#160;mouse,&#160;and entering keystrokes&#160;—&#160;all&#160;go&#160;through the&#160;<br/>document’s&#160;controller.<br/>
After selecting the&#160;broadcaster check the&#160;broadcaster for methods&#160;with&#160;names&#160;like&#160;“add listener”. I&#160;was&#160;<br/>asked how&#160;to prevent&#160;a&#160;dialog from&#160;closing when the&#160;user clicks&#160;on the&#160;little&#160;X&#160;icon in&#160;the&#160;upper-right&#160;corner<br/>of a&#160;dialog. I&#160;reasoned that&#160;the&#160;dialog is&#160;probably&#160;the&#160;correct&#160;broadcaster to&#160;use, so I&#160;created a&#160;dialog and&#160;<br/>inspected the&#160;“dbg_methods”&#160;property&#160;to see&#160;which&#160;listeners&#160;it&#160;supports&#160;(each supported listener has&#160;“set”&#160;<br/>and “remove”&#160;methods).&#160;Another option&#160;is&#160;to&#160;determine&#160;the&#160;event&#160;type&#160;that&#160;is&#160;produced and then&#160;search for&#160;<br/>broadcasters&#160;supporting this&#160;event&#160;type. I&#160;usually&#160;do this&#160;by&#160;searching the&#160;OOo Developer’s&#160;Guide&#160;and the&#160;<br/>Internet;&#160;I&#160;discuss&#160;effective&#160;methods&#160;for finding information in&#160;Chapte<a href="libremacros.html#668">r&#160;19,&#160;Sources&#160;of Information.</a><br/>
To&#160;listen&#160;for a&#160;selection&#160;change&#160;event, implement&#160;an XSelectionChangeListener and register it&#160;with the&#160;<br/>current&#160;controller.&#160;The&#160;XSelectionChangeListener interface&#160;defines&#160;only&#160;one&#160;subroutine&#160;that&#160;must&#160;be&#160;<br/>implemented&#160;—&#160;selectionChanged(ObjectEvent).&#160;All&#160;listeners&#160;are&#160;derived from&#160;the&#160;XEventListener so the&#160;<br/>disposing(ObjectEvent) method must&#160;also&#160;be&#160;implemented.&#160;The&#160;fastest&#160;way&#160;to&#160;determine&#160;which subroutines&#160;<br/>and functions&#160;must&#160;be&#160;implemented is&#160;to create&#160;an instance&#160;of the&#160;listener by&#160;using the&#160;function&#160;<br/>CreateUNOListener and then inspect&#160;the&#160;dbg_methods&#160;property&#160;(see<a href="libremacros.html#257">&#160;Listing 234&#160;a</a><a href="libremacros.html#258">nd&#160;Figure&#160;77)</a>.<br/>
<i><b>Listing&#160;234.</b>&#160;See&#160;the&#160;methods&#160;supported by&#160;a specific&#160;listener.</i><br/>
Sub&#160;InspectListenerMethods<br/>&#160;&#160;Dim&#160;sPrefix$<br/>&#160;&#160;Dim&#160;sService$<br/>&#160;&#160;Dim&#160;vService<br/>&#160;&#160;sPrefix&#160;=&#160;&#34;sel_change_&#34;<br/>
254<br/>
<hr/>
<a name=258></a>&#160;&#160;sService&#160;=&#160;&#34;com.sun.star.view.XSelectionChangeListener&#34;<br/>&#160;&#160;vService&#160;=&#160;CreateUnoListener(sPrefix,&#160;sService)<br/>&#160;&#160;DisplayDbgInfoStr(vService.dbg_methods,&#160;&#34;;&#34;,&#160;35,&#160;&#34;Methods&#34;)<br/>End&#160;Sub<br/>
<i><b>Figure&#160;77.</b>&#160;Ignore&#160;the&#160;queryInterface&#160;method.</i><br/>
The&#160;queryInterface&#160;method&#160;is&#160;from&#160;the&#160;interface&#160;com.sun.star.uno.XInterface, which is&#160;inherited&#160;from&#160;the&#160;<br/>XEventListener.&#160;You can ignore&#160;this&#160;method.&#160;However,&#160;you&#160;must&#160;implement&#160;the&#160;rest&#160;of the&#160;routines. Choose&#160;<br/>a&#160;descriptive&#160;prefix&#160;so that&#160;the&#160;code&#160;can contain more&#160;than&#160;one&#160;listener.&#160;See<a href="libremacros.html#258">&#160;Listing 235.</a><br/>
<i><b>Listing&#160;235.</b>&#160;Disposing&#160;and selection&#160;changed.</i><br/>
'All listeners must support this event<br/>Sub&#160;sel_change_disposing(vEvent)<br/>&#160;&#160;msgbox&#160;&#34;disposing the selection change listener&#34;<br/>End&#160;Sub<br/>
Sub&#160;sel_change_selectionChanged(vEvent)<br/>&#160;&#160;Dim&#160;vCurrentSelection&#160;As&#160;Object<br/>&#160; &#160;vCurrentSelection&#160;=&#160;&#160;vEvent.source<br/>&#160; &#160;Print&#160;&#34;Number of selected areas = &#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#160;vCurrentSelection.getSelection().getCount()<br/>End&#160;Sub<br/>
The&#160;routine&#160;in<a href="libremacros.html#258">&#160;Listing 236&#160;c</a>reates&#160;a&#160;listener by&#160;calling the&#160;function CreateUnoListener.&#160;When&#160;I&#160;tested&#160;this&#160;<br/>listener,&#160;I&#160;ran the&#160;macro and then&#160;the&#160;macro stopped running.&#160;The&#160;listener is&#160;still&#160;active&#160;and called by&#160;the&#160;<br/>broadcaster even though the&#160;macro is&#160;no longer running. In&#160;other words, the&#160;routine&#160;in<a href="libremacros.html#258">&#160;Listing 236&#160;r</a>egisters&#160;<br/>a&#160;listener,&#160;and then&#160;it&#160;is&#160;finished.&#160;The&#160;broadcaster calls&#160;the&#160;listener when things&#160;occur.&#160;The&#160;listener must&#160;be&#160;<br/>stored in a&#160;global&#160;variable&#160;so that&#160;it’s&#160;available&#160;later&#160;—&#160;for example,&#160;when it’s&#160;time&#160;to&#160;remove&#160;the&#160;listener&#160;<br/>from&#160;the&#160;object&#160;or when one&#160;of the&#160;methods&#160;is&#160;called.<br/>
<i><b>Listing&#160;236.</b>&#160;Start&#160;listening&#160;for&#160;selection change&#160;events.</i><br/>
Global&#160;vSelChangeListener&#160; &#160;'Must be global<br/>Global&#160;vSelChangeBroadCast<br/>
'Run this macro to start event intercepting<br/>Sub&#160;StartListeningToSelChangeEvents<br/>&#160;&#160;Dim&#160;sPrefix$<br/>&#160;&#160;Dim&#160;sService$<br/>&#160;&#160;sPrefix&#160;=&#160;&#34;sel_change_&#34;<br/>&#160;&#160;sService&#160;=&#160;&#34;com.sun.star.view.XSelectionChangeListener&#34;<br/>&#160;&#160;<br/>&#160;&#160;REM to register for a selection change, you must register with the<br/>&#160;&#160;REM current controller<br/>&#160;&#160;vSelChangeBroadCast&#160;=&#160;ThisComponent.getCurrentController<br/>&#160; &#160;&#160;<br/>&#160;&#160;'Create a listener to intercept the selection change events<br/>
255<br/>
<hr/>
<a name=259></a>&#160;&#160;vSelChangeListener&#160;=&#160;CreateUnoListener(sPrefix,&#160;sService)<br/>&#160; &#160;&#160;<br/>&#160;&#160;'Register the listener to the document controller<br/>&#160;&#160;vSelChangeBroadCast.addSelectionChangeListener(vSelChangeListener)<br/>End&#160;Sub<br/>
The&#160;behavior&#160;of the&#160;code&#160;in<a href="libremacros.html#258">&#160;Listing 235&#160;i</a>s&#160;annoying. Every&#160;time&#160;a&#160;new&#160;selection is&#160;made, the&#160;code&#160;is&#160;called&#160;<br/>and it&#160;opens&#160;a&#160;dialog on the&#160;screen.&#160;This&#160;interferes&#160;with selecting text.&#160;To&#160;remove&#160;the&#160;listener,&#160;use&#160;the&#160;code&#160;in<br/><a href="libremacros.html#259">Listing 237.</a><br/>
<i><b>Listing&#160;237.</b>&#160;Stop listening for&#160;selection&#160;change&#160;events.<br/></i>Sub&#160;StopListeningToSelChangeEvents<br/>&#160;&#160;' removes the listener<br/>&#160;&#160;vSelChangeBroadCast.removeSelectionChangeListener(vSelChangeListener)<br/>End&#160;Sub<br/>
To&#160;test&#160;the&#160;listener:<br/>
1)&#160;Start&#160;listening.<br/>
2)&#160;Make&#160;very&#160;simple&#160;selection&#160;changes&#160;such as:&#160;Click someplace. Shift+Click&#160;to select&#160;more.&#160;<br/>
Ctrl+Click to&#160;make&#160;a&#160;second selection.<br/>
3)&#160;Stop listening.<br/>
Save&#160;all&#160;open documents&#160;while&#160;testing listeners, a&#160;simple&#160;error is&#160;likely&#160;to&#160;cause&#160;OOo to&#160;crash.<br/>
<i><b>&#160;10.13.&#160;Creating&#160;a&#160;UNO&#160;dialog<br/></b></i>Use&#160;CreateUnoDialog&#160;to&#160;create&#160;an existing dialog.&#160;This&#160;section introduces&#160;the&#160;function CreateUnoDialog, it&#160;<br/>does&#160;not&#160;discuss&#160;how&#160;to&#160;create&#160;dialogs. CreateUnoDialog&#160;accepts&#160;a&#160;single&#160;argument, the&#160;full&#160;path&#160;to the&#160;<br/>dialog definition.&#160;<br/>
CreateUnoDialog(GlobalScope.BasicLibraries.LibName.DialogName)<br/>
The&#160;variable&#160;GlobalScope&#160;provides&#160;access&#160;to the&#160;application-level&#160;libraries.&#160;The&#160;Tools&#160;library&#160;contains&#160;the&#160;<br/>dialog named&#160;DlgOverwriteAll;&#160;you must&#160;load the&#160;library&#160;containing&#160;the&#160;dialog before&#160;you can use&#160;the&#160;<br/>dialog.&#160;You can manually&#160;load the&#160;library,&#160;or do it&#160;directly&#160;from&#160;the&#160;macro. Use&#160;<b>Tools&#160;&gt;&#160;Macros&#160;&gt;&#160;Organize<br/>Dialogs</b>&#160;to&#160;open the&#160;Basic&#160;Macros&#160;Organizer dialog, which can be&#160;used&#160;To&#160;manually&#160;load libraries. Use&#160;the&#160;<br/>LoadLibrary&#160;command to&#160;load a&#160;library&#160;using a&#160;macro.<br/>
GlobalScope.BasicLibraries.LoadLibrary(&#34;Tools&#34;)<br/>CreateUnoDialog(GlobalScope.BasicLibraries.Tools.DlgOverwriteAll)<br/>
If&#160;the&#160;dialog is&#160;defined inside&#160;a&#160;document, use&#160;the&#160;BasicLibraries&#160;variable.<br/>
CreateUnoDialog(BasicLibraries.LibName.DialogName)<br/>
<b>TIP</b><br/>
An&#160;event&#160;means that&#160;something&#160;happened.&#160;When&#160;certain things happen,&#160;an&#160;event&#160;object&#160;is created that&#160;<br/>
describes something&#160;about&#160;what&#160;happened.&#160;The&#160;event&#160;object&#160;is&#160;sent&#160;to a&#160;listener,&#160;or&#160;what&#160;ever&#160;routine&#160;is&#160;<br/>configured&#160;to be&#160;called&#160;when&#160;the&#160;event&#160;occurs.&#160;You can write&#160;an “event”&#160;routine&#160;that&#160;is called&#160;when&#160;<br/>
something&#160;happens;&#160;for&#160;example,&#160;when&#160;a&#160;button&#160;is pressed.<br/>
When&#160;you&#160;create&#160;a&#160;dialog, you&#160;usually&#160;write&#160;event&#160;handlers&#160;as&#160;subroutines&#160;in&#160;Basic;&#160;for example,&#160;a&#160;button&#160;in&#160;<br/>a&#160;dialog&#160;does&#160;nothing unless&#160;events&#160;are&#160;mapped to&#160;subroutines&#160;or functions&#160;that&#160;you write.&#160;You can add a&#160;<br/>close&#160;button&#160;to&#160;a&#160;dialog and map the&#160;button's&#160;“Execute&#160;action”&#160;event&#160;to&#160;a&#160;macro that&#160;closes&#160;the&#160;dialog. If&#160;a&#160;<br/>macro called from&#160;an event&#160;handler accesses&#160;a&#160;running dialog, then the&#160;dialog&#160;must&#160;be&#160;stored in&#160;a&#160;variable&#160;<br/>
256<br/>
<hr/>
<a name=260></a>that&#160;the&#160;macro can access. I&#160;generally&#160;choose&#160;to&#160;create&#160;a&#160;private&#160;variable&#160;that&#160;holds&#160;this&#160;type&#160;of data.&#160;Se<a href="libremacros.html#260">e<br/>Listing 238.</a><br/>
<i><b>Listing&#160;238.</b>&#160;Display&#160;information&#160;about&#160;an object&#160;using a dialog.<br/></i>Private&#160;MySampleDialog<br/>Sub&#160;DisplayObjectInformation(Optional&#160;vOptionalObj)<br/>&#160;&#160;Dim&#160;vControl&#160;&#160;'Access the text control in the dialog.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160;&#160;'Temporary string variable.<br/>&#160;&#160;Dim&#160;vObj&#160; &#160; &#160;&#160;'Object about which to display information.<br/>&#160;&#160;<br/>&#160;&#160;REM If vOptionalObj object is not provided, use the current document.<br/>&#160;&#160;If&#160;IsMissing(vOptionalObj)&#160;Then&#160;<br/>&#160; &#160;&#160;vObj&#160;=&#160;ThisComponent<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;vObj&#160;=&#160;vOptionalObj<br/>&#160;&#160;End&#160;If<br/>&#160; &#160;&#160;<br/>&#160;&#160;REM Create the dialog and set the title<br/>&#160;&#160;MySampleDialog&#160;=&#160;CreateUnoDialog(DialogLibraries.OOME_30.MyFirstDialog)<br/>&#160;&#160;MySampleDialog.setTitle(&#34;Variable Type &#34;&#160;&amp;&#160;TypeName(vObj))<br/>&#160;&#160;<br/>&#160;&#160;REM Get the text field from the dialog&#160;<br/>&#160;&#160;REM I added this text manually<br/>&#160;&#160;vControl&#160;=&#160;MySampleDialog.getControl(&#34;TextField1&#34;)<br/>&#160;&#160;<br/>&#160;&#160;If&#160;InStr(TypeName(vObj),&#160;&#34;Object&#34;)&#160;&lt;&#160;1&#160;Then<br/>&#160; &#160;&#160;REM If this is NOT an object, simply display simple information<br/>&#160; &#160;&#160;vControl.setText(Dlg_GetObjTypeInfo(vObj))<br/>&#160; &#160;&#160;<br/>&#160;&#160;ElseIf&#160;NOT&#160;HasUnoInterfaces(vObj,&#160;&#34;com.sun.star.uno.XInterface&#34;)&#160;Then<br/>&#160; &#160;&#160;REM It is an object but it is not a UNO object.<br/>&#160; &#160;&#160;REM Cannot call HasUnoInterfaces if it is not an UNO object.<br/>&#160; &#160;&#160;vControl.setText(Dlg_GetObjTypeInfo(vObj))<br/>&#160; &#160;&#160;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;REM This is a UNO object so attempt to access the &#34;dbg_&#34; properties<br/>&#160; &#160;&#160;MySampleDialog.setTitle(&#34;Variable Type &#34;&#160;&amp;&#160;vObj.getImplementationName())<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;*************** Methods **************&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;Dlg_DisplayDbgInfoStr(vObj.dbg_methods,&#160;&#34;;&#34;)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34;*************** Properties **************&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;Dlg_DisplayDbgInfoStr(vObj.dbg_properties,&#160;&#34;;&#34;)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34;*************** Services **************&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;Dlg_DisplayDbgInfoStr(vObj.dbg_supportedInterfaces,&#160;CHR$(10))<br/>&#160; &#160;&#160;vControl.setText(s)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;REM tell the dialog to start itself<br/>&#160;&#160;MySampleDialog.execute()<br/>End&#160;Sub&#160;<br/>
257<br/>
<hr/>
<a name=261></a><b>TIP</b><br/>
Store&#160;the&#160;dialog&#160;in&#160;a&#160;private&#160;variable&#160;declared&#160;as type&#160;Object.&#160;Use&#160;a&#160;private&#160;variable&#160;so that&#160;it&#160;doesn’t&#160;<br/>
needlessly&#160;affect&#160;other&#160;modules. On at&#160;least&#160;one&#160;occasion, a&#160;dialog&#160;that&#160;I&#160;created&#160;worked when it&#160;was held&#160;<br/>in a&#160;variable&#160;declared&#160;as an Object,&#160;but&#160;failed&#160;when held&#160;in&#160;a&#160;variable&#160;declared&#160;as a&#160;Variant;&#160;so much&#160;for&#160;my<br/>
recommendation to usually&#160;a&#160;variant&#160;rather&#160;than an Object.<br/>
The&#160;macro i<a href="libremacros.html#260">n&#160;Listing&#160;238&#160;di</a>splays&#160;a&#160;dialog that&#160;displays&#160;information about&#160;the&#160;object&#160;that&#160;was&#160;passed in&#160;as&#160;<br/>an argument. I&#160;use&#160;the&#160;HasUnoInterfaces&#160;function&#160;to see&#160;if this&#160;is&#160;a&#160;UNO&#160;service.&#160;I&#160;first&#160;check to&#160;see&#160;if&#160;the&#160;<br/>object’s&#160;TypeName&#160;contains&#160;the&#160;text&#160;“Object”;&#160;this&#160;tells&#160;me&#160;if the&#160;object&#160;is&#160;really&#160;an object.<br/>
If&#160;InStr(TypeName(vObj),&#160;&#34;Object&#34;)&#160;&lt;&#160;1&#160;Then<br/>
If&#160;the&#160;object&#160;is&#160;not&#160;an object&#160;that&#160;supports&#160;a&#160;UNO&#160;interface, the&#160;object&#160;is&#160;inspected&#160;and information&#160;about&#160;it&#160;<br/>displaye<a href="libremacros.html#261">d.&#160;Listing 239&#160;s</a>hows&#160;the&#160;text&#160;string to do this<a href="libremacros.html#261">.&#160;Figure&#160;78&#160;s</a>hows&#160;the&#160;results.<br/>
<i><b>Listing&#160;239.</b>&#160;Return type&#160;information&#160;as&#160;a string.</i><br/>
Function&#160;Dlg_GetObjTypeInfo(vObj)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;s&#160;=&#160;&#34;TypeName = &#34;&#160;&amp;&#160;TypeName(vObj)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160;&#160;&#34;VarType = &#34;&#160;&amp;&#160;VarType(vObj)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;If&#160;IsNull(vObj)&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsNull = True&#34;<br/>&#160;&#160;ElseIf&#160;IsEmpty(vObj)&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsEmpty = True&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;If&#160;IsObject(vObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsObject = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsUnoStruct(vObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsUnoStruct = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsDate(vObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsDate = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsNumeric(vObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsNumeric = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsArray(vObj)&#160;Then<br/>&#160; &#160; &#160;&#160;On&#160;Local&#160;Error&#160;Goto&#160;DebugBoundsError:<br/>&#160; &#160; &#160;&#160;Dim&#160;i%,&#160;sTemp$<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsArray = True&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;range = (&#34;<br/>&#160; &#160; &#160;&#160;Do&#160;While&#160;(i%&#160;&gt;=&#160;0)<br/>&#160; &#160; &#160; &#160;&#160;i%&#160;=&#160;i%&#160;+&#160;1<br/>&#160; &#160; &#160; &#160;&#160;sTemp$&#160;=&#160;LBound(vObj,&#160;i%)&#160;&amp;&#160;&#34; To &#34;&#160;&amp;&#160;UBound(vObj,&#160;i%)<br/>&#160; &#160; &#160; &#160;&#160;If&#160;i%&#160;&gt;&#160;1&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;, &#34;<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sTemp$<br/>&#160; &#160; &#160;&#160;Loop<br/>&#160; &#160; &#160;&#160;DebugBoundsError:<br/>&#160; &#160; &#160;&#160;On&#160;Local&#160;Error&#160;Goto&#160;0<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;)&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;Dlg_GetObjTypeInfo&#160;=&#160;s<br/>End&#160;Function<br/>
<i><b>Figure&#160;78.</b>&#160;The&#160;variable&#160;is&#160;an array&#160;of&#160;strings</i><br/>
258<br/>
<hr/>
<a name=262></a>If&#160;the&#160;first&#160;argument&#160;supports&#160;a&#160;UNO&#160;interface, the&#160;“dbg_”&#160;properties&#160;are&#160;used to display&#160;all&#160;of the&#160;methods,&#160;<br/>properties,&#160;and services&#160;supported by&#160;this&#160;object&#160;(see<a href="libremacros.html#262">&#160;Listing 240&#160;and&#160;Figure&#160;79)</a>. &#160;This&#160;is&#160;very&#160;similar to&#160;the&#160;<br/>code&#160;in<a href="libremacros.html#243">&#160;Listing 221, e</a>xcept&#160;that&#160;it&#160;returns&#160;a&#160;string rather than&#160;displaying&#160;a&#160;series&#160;of simple&#160;dialogs.&#160;This&#160;is&#160;an&#160;<br/>excellent&#160;way&#160;to quickly&#160;see&#160;what&#160;methods,&#160;properties, and interfaces&#160;an object&#160;supports. Notice&#160;also that&#160;the<br/>variable&#160;type&#160;is&#160;displayed in&#160;the&#160;upper-left&#160;corner of the&#160;dialog.<br/>
<i><b>Listing&#160;240.</b>&#160;Convert&#160;the&#160;debug string into one&#160;string&#160;with&#160;new&#160;line&#160;characters.<br/></i>Function&#160;Dlg_DisplayDbgInfoStr(sInfo$,&#160;sSep$)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;aInfo()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Array to hold each string<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;j&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Junk integer variable for temporary values<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'holds the portion that is not completed<br/>&#160;&#160;s&#160;=&#160;sInfo$<br/>&#160;&#160;j&#160;=&#160;InStr(s,&#160;&#34;:&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Initial colon<br/>&#160;&#160;If&#160;j&#160;&gt;&#160;0&#160;Then&#160;Mid(s,&#160;1,&#160;j,&#160;&#34;&#34;)&#160;&#160;'Remove portion up to the initial colon<br/>&#160;&#160;aInfo()&#160;=&#160;Split(s,&#160;sSep$)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Split string based on delimiter<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(aInfo())&#160;To&#160;Ubound(aInfo())&#160;&#160;'Look at each piece to remove<br/>&#160; &#160;&#160;aInfo(i)&#160;=&#160;Trim(aInfo(i))&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'leading and trailing spaces<br/>&#160; &#160;&#160;j&#160;=&#160;InStr(aInfo(i),&#160;CHR$(10))&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Some have an extra&#160;<br/>&#160; &#160;&#160;If&#160;j&#160;&gt;&#160;0&#160;&#160;Then&#160;Mid(aInfo(i),&#160;j,&#160;1,&#160;&#34;&#34;)&#160; &#160;&#160;'new line that should be removed<br/>&#160;&#160;Next<br/>&#160;&#160;Dlg_DisplayDbgInfoStr&#160;=&#160;Join(aInfo(),&#160;CHR$(10))<br/>End&#160;Function&#160;<br/>
<i><b>Figure&#160;79.</b>&#160;The&#160;variable&#160;is&#160;a Writer&#160;document.</i><br/>
259<br/>
<hr/>
<a name=263></a><i><b>&#160;10.14.&#160;Conclusion<br/></b></i>The&#160;subroutines&#160;and functions&#160;supplied with&#160;OOo Basic&#160;support&#160;a&#160;wide&#160;range&#160;of operations&#160;that&#160;are&#160;required&#160;<br/>to access&#160;the&#160;internals&#160;of OOo. Use&#160;the&#160;methods&#160;presented in&#160;this&#160;chapter to inspect&#160;and use&#160;the&#160;UNO&#160;<br/>services.&#160;This&#160;chapter examined&#160;the&#160;fundamentals&#160;for creating UNO&#160;listeners. UNO&#160;listeners&#160;provide&#160;basic&#160;<br/>system&#160;functionality,&#160;and new&#160;UNO&#160;listeners&#160;extend this&#160;functionality&#160;to&#160;give&#160;the&#160;programmer a&#160;great&#160;deal&#160;of<br/>control&#160;over system&#160;applications&#160;and behavior.&#160;Any&#160;UNO&#160;listener listens&#160;to one&#160;or more&#160;broadcasters,&#160;<br/>providing&#160;the&#160;capability&#160;to&#160;respond to system&#160;events&#160;that&#160;are&#160;communicated across&#160;applications.<br/>
260<br/>
<hr/>
<a name=264></a><b>&#160;11.&#160;The&#160;Dispatcher<br/></b>This&#160;chapter builds&#160;on previous&#160;coverage&#160;of the&#160;OpenOffice.org&#160;paradigm&#160;and then introduces&#160;the&#160;<br/>dispatcher.&#160;The&#160;dispatcher provides&#160;a&#160;simple&#160;mechanism&#160;for invoking&#160;internal&#160;functionality&#160;with&#160;limited&#160;<br/>knowledge&#160;of how&#160;the&#160;internals&#160;work, but&#160;it&#160;is&#160;considered the&#160;least-favored way&#160;of controlling&#160;<br/>OpenOffice.org.<br/>
<i><b>&#160;11.1.&#160;The&#160;environment<br/></b></i>OpenOffice.org&#160;separates&#160;a&#160;component’s&#160;(document's) functionality&#160;into the&#160;model,&#160;the&#160;controller,&#160;and the&#160;<br/>frame.&#160;<br/>
FRAME<br/>
Combines&#160;the&#160;pieces;&#160;it&#160;contains&#160;a&#160;model’s&#160;controller and knows&#160;all&#160;about&#160;the&#160;display&#160;window.&#160;The&#160;<br/>frame&#160;does&#160;not,&#160;however,&#160;have&#160;any&#160;display&#160;window&#160;functionality;&#160;the&#160;frame&#160;just&#160;knows&#160;that&#160;display&#160;<br/>windows&#160;exist.<br/>
Send a&#160;dispatch&#160;to the&#160;frame, because&#160;it&#160;controls&#160;things&#160;and knows&#160;how&#160;to route&#160;a&#160;dispatch.<br/>
Model<br/>
Controller<br/>
Consists&#160;of the&#160;document&#160;data&#160;and the&#160;methods&#160;to<br/>
Aware&#160;of the&#160;current&#160;view&#160;and the&#160;data;&#160;it&#160;<br/>
change&#160;the&#160;data.<br/>
manipulates&#160;the&#160;document&#160;while&#160;receiving&#160;<br/>input&#160;from&#160;the&#160;user interface.<br/>
You can update data directly using the model.<br/>
The&#160;controller knows&#160;things&#160;like&#160;what&#160;is&#160;<br/>selected and is&#160;able&#160;to&#160;select&#160;things.&#160;<br/>
<b>TIP</b><br/>
Component&#160;almost&#160;always means an open&#160;document, but&#160;other&#160;windows&#160;are&#160;also&#160;components;&#160;for&#160;example,<br/>
the&#160;Basic&#160;IDE&#160;and&#160;the&#160;help&#160;window.<br/>
<b>&#160;11.1.1.&#160;Two&#160;different&#160;methods&#160;to&#160;control&#160;OOo<br/></b>The&#160;most&#160;versatile&#160;method to&#160;manipulate&#160;an OOo document&#160;is&#160;to get&#160;the&#160;internal&#160;UNO&#160;objects&#160;and &#160;<br/>manipulate&#160;them.&#160;Using&#160;the&#160;model&#160;provides&#160;significant&#160;control, but&#160;you&#160;must&#160;understand&#160;much about&#160;the&#160;<br/>different&#160;services&#160;and interfaces.&#160;<br/>
Another method, which requires&#160;very&#160;little&#160;understanding of the&#160;OOo internals, is&#160;to use&#160;a&#160;UNO&#160;dispatcher.&#160;<br/>The&#160;dispatcher accepts&#160;a&#160;command such as&#160;“.uno:Undo”&#160;and takes&#160;care&#160;of the&#160;rest&#160;of the&#160;details.&#160;The&#160;frame&#160;<br/>provides&#160;the&#160;required dispatchers&#160;to&#160;perform&#160;the&#160;work. For simplicity,&#160;think&#160;of issuing a&#160;dispatch as&#160;very&#160;<br/>similar to&#160;selecting an action from&#160;the&#160;menu.<br/>
Although direct&#160;control&#160;using&#160;UNO&#160;services&#160;provides&#160;the&#160;most&#160;control&#160;and versatility,&#160;some&#160;operations&#160;are&#160;<br/>much easier to perform&#160;using the&#160;dispatcher;&#160;sometimes&#160;a&#160;dispatcher is&#160;the&#160;only&#160;way&#160;to&#160;accomplish&#160;a&#160;task.&#160;<br/>For&#160;example, the&#160;dispatcher is&#160;the&#160;best&#160;solution for handling the&#160;clipboard. Even the&#160;macro recorder&#160;<br/>performs&#160;almost&#160;all&#160;tasks&#160;using&#160;a&#160;dispatcher.<br/>
261<br/>
<hr/>
<a name=265></a>Three&#160;things&#160;are&#160;required to accomplish tasks&#160;using&#160;a&#160;dispatcher:&#160;(1) the&#160;command to&#160;dispatch, (2)&#160;<br/>arguments&#160;that&#160;control&#160;the&#160;dispatch, and (3) an object&#160;capable&#160;of performing the&#160;dispatch (a&#160;dispatch&#160;<br/>provider,&#160;which is&#160;usually&#160;a&#160;frame). Each document&#160;has&#160;a&#160;controller that, loosely&#160;speaking, acts&#160;as&#160;the&#160;<br/>interface&#160;between the&#160;outside&#160;world&#160;and the&#160;document.&#160;For&#160;example, use&#160;the&#160;current&#160;controller to&#160;select&#160;text,&#160;<br/>find the&#160;current&#160;cursor location,&#160;or determine&#160;which sheet&#160;is&#160;active&#160;in&#160;a&#160;spreadsheet.&#160;The&#160;current&#160;controller&#160;<br/>can also&#160;return the&#160;frame&#160;of the&#160;document,&#160;which&#160;supports&#160;the&#160;dispatch command.&#160;<br/>
<i><b>Listing&#160;241.</b>&#160;The&#160;DispatchHelper&#160;service&#160;greatly&#160;simplifies&#160;executing&#160;dispatches.<br/></i>oDispHelper&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>
The&#160;dispatch helper implements&#160;the&#160;function&#160;executeDispatch,&#160;which implements&#160;most&#160;of the&#160;functionality&#160;<br/>required to&#160;perform&#160;a&#160;dispatc<a href="libremacros.html#265">h.&#160;Table&#160;94&#160;c</a>ontains&#160;a&#160;list&#160;of the&#160;arguments&#160;supported&#160;by&#160;the&#160;executeDispatch&#160;<br/>method.<br/>
While&#160;executing&#160;a&#160;dispatch,&#160;as&#160;discussed here, you cannot&#160;dispatch a&#160;command to&#160;a&#160;frame&#160;based on its&#160;name&#160;<br/>—&#160;either leave&#160;the&#160;target&#160;frame&#160;empty&#160;or enter “_self”. It&#160;is&#160;also, therefore, not&#160;important&#160;to use&#160;anything&#160;<br/>other than zero,&#160;or omit&#160;the&#160;argument&#160;completely,&#160;for the&#160;search flag.&#160;Attempting to&#160;specify&#160;another frame&#160;<br/>results&#160;in&#160;a&#160;run-time&#160;error (it&#160;seems&#160;silly&#160;to&#160;me&#160;that&#160;the&#160;arguments&#160;exist&#160;if&#160;they&#160;are&#160;not&#160;usabl<a href="libremacros.html#265">e1).</a><br/>
<i><b>Table&#160;94.</b>&#160;Arguments&#160;to executeDispatch.</i><br/>
<i><b>Argument</b></i><br/>
<i><b>Description</b></i><br/>
XDispatchProvider<br/>
Dispatch provider&#160;that&#160;performs&#160;the&#160;dispatch.<br/>
URL&#160;String<br/>
The&#160;command&#160;to dispatch,&#160;as&#160;a&#160;string.<br/>
Target&#160;Frame&#160;String<br/>
Identifies the&#160;frame&#160;that&#160;will&#160;receive&#160;the&#160;dispatch. Use&#160;an empty&#160;string&#160;or&#160;“_self”&#160;<br/>
to specify&#160;<br/>the&#160;current&#160;frame&#160;(any&#160;other&#160;value&#160;is&#160;invalid).<br/>
long<br/>
Optional&#160;search flags that&#160;indicate&#160;how&#160;to find&#160;the&#160;target&#160;frame. Use&#160;zero or&#160;blank<br/>(see<a href="libremacros.html#265">&#160;Listing&#160;242)</a>, because&#160;it&#160;is&#160;not&#160;supported.<br/>
PropertyValue()<br/>
Optional&#160;arguments that&#160;are&#160;dependent&#160;on the&#160;implementation.<br/>
<i><b>Listing&#160;242.</b>&#160;Execute&#160;the&#160;“undo”&#160;dispatch.</i><br/>
Sub&#160;NewUndo<br/>&#160;&#160;Dim&#160;oDispHelper&#160;as&#160;object<br/>&#160;&#160;Dim&#160;oProvider&#160;As&#160;Object<br/>&#160;&#160;oProvider&#160;=&#160;ThisComponent.CurrentController.Frame<br/>&#160;&#160;oDispHelper&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>&#160;&#160;oDispHelper.executeDispatch(oProvider,&#34;.uno:Undo&#34;,&#160;&#34;&#34;,&#160;,&#160;Array())<br/>End&#160;Sub<br/>
The&#160;dispatch commands&#160;have&#160;both a&#160;name&#160;and a&#160;number,&#160;called&#160;a&#160;“slot.”&#160;Although a&#160;dispatch&#160;can be&#160;made&#160;<br/>based on either,&#160;the&#160;developers&#160;told&#160;me&#160;that&#160;the&#160;slot&#160;number may&#160;change&#160;in the&#160;future&#160;so it&#160;is&#160;safer to&#160;use&#160;the&#160;<br/>name. If&#160;you&#160;must&#160;use&#160;a&#160;slot,&#160;the&#160;Tools&#160;library&#160;contains&#160;a&#160;subroutine&#160;called&#160;DispatchSlot,&#160;which&#160;performs&#160;a&#160;<br/>dispatch based on a&#160;slot&#160;number alone.&#160;<br/>
<i><b>Listing&#160;243.</b>&#160;Dispatch to&#160;a numeric&#160;slot.</i><br/>
'Include this library to use the DispatchSlot command.<br/>GlobalScope.BasicLibraries.LoadLibrary(&#34;Tools&#34;)<br/>DispatchSlot(5301)&#160;&#160;'Load the About dialog, same as &#34;.uno:About&#34;<br/>
1&#160;I have not verified that a named frame does not work in OOo 3.3, but it did fail when I tested around version 2.0.<br/>
262<br/>
<hr/>
<a name=266></a><b>TIP</b><br/>
You cannot&#160;call&#160;a&#160;routine&#160;in&#160;a&#160;library&#160;unless the&#160;library&#160;is loaded.&#160;You can load a&#160;library&#160;manually&#160;from&#160;the&#160;<br/>
Macro&#160;dialog&#160;and&#160;you can&#160;load&#160;it&#160;using&#160;the&#160;LoadLibrary&#160;command as shown&#160;in<a href="libremacros.html#265">&#160;Listing&#160;243.&#160;</a>The&#160;Tools&#160;<br/>library&#160;included&#160;with OOo contains the&#160;DispatchSlot&#160;subroutine.<br/>
Some&#160;dispatch commands&#160;require&#160;arguments.&#160;The&#160;example&#160;in<a href="libremacros.html#266">&#160;Listing 244&#160;pe</a>rform&#160;a&#160;dispatch with&#160;<br/>arguments.&#160;The&#160;GoToCell&#160;command needs&#160;to know&#160;which cell&#160;to&#160;go to.&#160;This&#160;macro moves&#160;the&#160;current&#160;cursor<br/>to the&#160;cell&#160;B3 in a&#160;spreadsheet&#160;document.<br/>
<i><b>Listing&#160;244.</b>&#160;Dispatch commands&#160;can use&#160;arguments.<br/></i>Dim&#160;args2(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue&#160;<br/>args2(0).Name&#160;=&#160;&#34;ToPoint&#34;&#160;<br/>args2(0).Value&#160;=&#160;&#34;$B$3&#34;&#160; &#160; &#160;' position to B3&#160;<br/>Dim&#160;oDispHelper&#160;as&#160;object<br/>Dim&#160;oProvider&#160;As&#160;Object<br/>oProvider&#160;=&#160;ThisComponent.CurrentController.Frame<br/>oDispHelper&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>oDispHelper.executeDispatch(oProvider,&#160;&#34;.uno:GoToCell&#34;,&#160;&#34;&#34;,&#160;0,&#160;args2())<br/>
<b>&#160;11.1.2.&#160;Finding&#160;dispatch&#160;commands<br/></b>A&#160;complete&#160;list&#160;of dispatch commands&#160;is&#160;tricky&#160;to&#160;find. Previously,&#160;I&#160;assembled a&#160;complete&#160;list&#160;of all&#160;<br/>supported&#160;dispatch commands, but, the&#160;list&#160;changes&#160;and it&#160;is&#160;not&#160;clear to&#160;me&#160;that&#160;it&#160;is&#160;of much&#160;user.&#160;As&#160;such, I<br/>decided&#160;to tell&#160;you&#160;how&#160;to find&#160;the&#160;list&#160;on your own. If&#160;there&#160;is&#160;a&#160;demand for it, I&#160;may&#160;be&#160;convinced to&#160;<br/>compile&#160;a&#160;new&#160;list.&#160;Thanks&#160;to&#160;Ariel&#160;Constenla&#160;Haile&#160;for this&#160;information.<br/>
<i><b>Use&#160;the&#160;WIKI<br/></b></i><a href="http://wiki.services.openoffice.org/wiki/Framework/Article/OpenOffice.org_3.x_Commands">http://wiki.services.openoffice.org/wiki/Framework/Article/OpenOffice.org_3.x_Commands&#160;c</a>ontains&#160;a&#160;list&#160;<br/>of commands&#160;and slots.&#160;Clearly&#160;some&#160;commands&#160;are&#160;missing, such as&#160;“.uno:ObjectTitleDescription”,&#160;but&#160;the<br/>list&#160;is&#160;fairly&#160;complete.&#160;<br/>
<i><b>Probe&#160;the&#160;interface<br/></b></i>The&#160;following&#160;macro uses&#160;the&#160;UICommandDescription service&#160;to enumerate&#160;the&#160;supported modules.&#160;A&#160;new&#160;<br/>Calc&#160;document&#160;is&#160;created and a&#160;sheet&#160;is&#160;created for each module.&#160;The&#160;commands&#160;supported by&#160;the&#160;module&#160;<br/>are&#160;placed on the&#160;sheet. &#160;Note&#160;that&#160;the&#160;macro takes&#160;a&#160;while&#160;to run because&#160;there&#160;is&#160;a&#160;lot&#160;of data&#160;to process.<br/>
<i><b>Listing&#160;245.</b>&#160;Get&#160;commands&#160;from&#160;the&#160;ModuleManager.</i><br/>
Sub&#160;Print_All_Commands<br/>&#160;&#160;' Create a new Calc document to hold the dispatch commands<br/>&#160; Dim&#160;oDoc&#160;As Object<br/>&#160;&#160;oDoc&#160;= StarDesktop.loadComponentFromURL(&#34;private:factory/scalc&#34;,&#160;&#34;_default&#34;,&#160;0, Array())<br/>
&#160; Dim&#160;oSheets&#160;As Object :&#160;oSheets&#160;=&#160;oDoc.getSheets()<br/>
&#160;&#160;'The UICommandDescription service provides access to the user interface commands that are&#160;<br/>&#160;&#160;'part of OpenOffice.org modules, like Writer or Calc.&#160;<br/>&#160; Dim&#160;oUICommandDescription&#160;As Object<br/>&#160;&#160;oUICommandDescription&#160;= CreateUnoService(&#34;com.sun.star.frame.UICommandDescription&#34;)<br/>
&#160;&#160;'Identify office modules and provide read access to the configuration of office modules.<br/>&#160; Dim&#160;oModuleIdentifier&#160;As Object<br/>
263<br/>
<hr/>
<a name=267></a>&#160;&#160;oModuleIdentifier&#160;= CreateUnoService(&#34;com.sun.star.frame.ModuleManager&#34;)<br/>
&#160; Dim&#160;oModuleUICommandDescription&#160;As Object,&#160;aModules$(),aCommand<br/>&#160; Dim&#160;aCommands$()<br/>&#160; Dim&#160;n&amp;,&#160;i&amp;<br/>
&#160;&#160;' Get a list of module names such as &#34;com.sun.star.presentation.PresentationDocument&#34;<br/>&#160;&#160;' Create a sheet for each module.<br/>&#160;&#160;aModules&#160;=&#160;oModuleIdentifier.getElementNames()<br/>&#160; For&#160;n&#160;=&#160;0&#160;To UBound(aModules)<br/>&#160; &#160;&#160;oModuleUICommandDescription&#160;=&#160;oUICommandDescription.getByName(aModules(n))<br/>
&#160; &#160;&#160;' Get the commands supported by this module.<br/>&#160; &#160; ReDim&#160;aCommands$()<br/>&#160; &#160;&#160;aCommands&#160;=&#160;oModuleUICommandDescription.getElementNames()<br/>
&#160; &#160; If&#160;n&#160;&lt;= UBound(oSheets.getElementNames()) Then<br/>&#160; &#160; &#160;&#160;oSheets.getByIndex(n).setName(aModules(n))<br/>&#160; &#160; Else<br/>&#160; &#160; &#160;&#160;oSheets.insertNewByName(aModules(n),n)<br/>&#160; &#160; End If<br/>
&#160; &#160;&#160;oSheets.getCellByPosition(0,&#160;0,&#160;n).getText().setString(&#34;Command&#34;)<br/>&#160; &#160;&#160;oSheets.getCellByPosition(1,&#160;0,&#160;n).getText().setString(&#34;Label&#34;)<br/>&#160; &#160;&#160;oSheets.getCellByPosition(2,&#160;0,&#160;n).getText().setString(&#34;Name&#34;)<br/>&#160; &#160;&#160;oSheets.getCellByPosition(3,&#160;0,&#160;n).getText().setString(&#34;Popup&#34;)<br/>&#160; &#160;&#160;oSheets.getCellByPosition(4,&#160;0,&#160;n).getText().setString(&#34;Property&#34;)<br/>
&#160; &#160; For&#160;i&#160;=&#160;0&#160;To UBound(aCommands)<br/>&#160; &#160; &#160;&#160;aCommand&#160;=&#160;oModuleUICommandDescription.getByName(aCommands(i))<br/>
&#160; &#160; &#160; Dim&#160;sLabel$,&#160;sName$,&#160;bPopup&#160;as Boolean,&#160;nProperty&amp;,&#160;k%<br/>&#160; &#160; &#160; For&#160;k&#160;=&#160;0&#160;To UBound(aCommand)<br/>&#160; &#160; &#160; &#160; If&#160;aCommand(k).Name =&#160;&#34;Label&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;sLabel&#160;=&#160;aCommand(k).Value<br/>&#160; &#160; &#160; &#160; ElseIf&#160;aCommand(k).Name =&#160;&#34;Name&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;sName&#160;=&#160;aCommand(k).Value<br/>&#160; &#160; &#160; &#160; ElseIf&#160;aCommand(k).Name =&#160;&#34;Popup&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;bPopup&#160;=&#160;aCommand(k).Value<br/>&#160; &#160; &#160; &#160; ElseIf&#160;aCommand(k).Name =&#160;&#34;Property&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;nProperty&#160;=&#160;aCommand(k).Value<br/>&#160; &#160; &#160; &#160; End If<br/>&#160; &#160; &#160; Next<br/>
&#160; &#160; &#160;&#160;oSheets.getCellByPosition(0,&#160;i+1,&#160;n).getText().setString(aCommands(i))<br/>&#160; &#160; &#160;&#160;oSheets.getCellByPosition(1,&#160;i+1,&#160;n).getText().setString(sLabel)<br/>&#160; &#160; &#160;&#160;oSheets.getCellByPosition(2,&#160;i+1,&#160;n).getText().setString(sName)<br/>&#160; &#160; &#160; If&#160;bPopup&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;oSheets.getCellByPosition(3,&#160;i+1,&#160;n).getText().setString(&#34;True&#34;)<br/>&#160; &#160; &#160; Else<br/>&#160; &#160; &#160; &#160;&#160;oSheets.getCellByPosition(3,&#160;i+1,&#160;n).getText().setString(&#34;False&#34;)<br/>&#160; &#160; &#160; End If<br/>&#160; &#160; &#160;&#160;oSheets.getCellByPosition(4,&#160;i+1,&#160;n).getText().setString(CStr(nProperty))<br/>
264<br/>
<hr/>
<a name=268></a>&#160; &#160; Next<br/>
&#160; &#160; Dim&#160;oColumns&#160;as Object<br/>&#160; &#160;&#160;oColumns&#160;=&#160;oSheets.getByIndex(n).getColumns()<br/>&#160; &#160; Dim&#160;j%<br/>&#160; &#160; For&#160;j&#160;=&#160;0&#160;To&#160;4<br/>&#160; &#160; &#160;&#160;oColumns.getByIndex(j).setPropertyValue(&#34;OptimalWidth&#34;,&#160;True)<br/>&#160; &#160; Next<br/>&#160; Next<br/>End&#160;Sub<br/>
XDispatchInformationProvider constructs&#160;a&#160;list&#160;of dispatch&#160;commands&#160;as&#160;returned by&#160;the&#160;current&#160;controller&#160;<br/>and displays&#160;the&#160;list&#160;in a&#160;Calc&#160;document.&#160;<br/>
<i><b>Listing&#160;246.</b>&#160;Get&#160; commands&#160;from&#160;the&#160;current&#160;controller.</i><br/>
Sub&#160;XDispatchInformationProvider<br/>&#160;&#160;Dim&#160;oDoc&#160;As&#160;Object<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#34;private:factory/scalc&#34;,&#160;&#34;_default&#34;,&#160;0,&#160;Array())<br/>
&#160;&#160;Dim&#160;oSheet&#160;As&#160;Object&#160;:&#160;oSheet&#160;=&#160;oDoc.getSheets().getByIndex(0)<br/>&#160;&#160;oSheet.getCellByPosition(0,&#160;0).getText().setString(&#34;Group&#34;)<br/>&#160;&#160;oSheet.getCellByPosition(1,&#160;0).getText().setString(&#34;Command&#34;)<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;oController&#160;:&#160; &#160;oController&#160;=&#160;ThisComponent.getCurrentController()<br/>&#160;&#160;If&#160;IsNull(oController)&#160;Or&#160;_<br/>&#160; &#160;&#160;NOT&#160;HasUnoInterfaces(&#160;oController,&#160;&#34;com.sun.star.frame.XDispatchInformationProvider&#34;)&#160;Then<br/>&#160; &#160;&#160;'TODO: some warning<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;Dim&#160;iSupportedCmdGroups%()<br/>&#160;&#160;iSupportedCmdGroups&#160;=&#160;oController.getSupportedCommandGroups()<br/>
&#160;&#160;Dim&#160;i%,&#160;j%<br/>&#160;&#160;Dim&#160;k%<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;UBound(iSupportedCmdGroups)<br/>&#160; &#160;&#160;Dim&#160;aDispatchInfo()<br/>&#160; &#160;&#160;aDispatchInfo&#160;=&#160;oController.getConfigurableDispatchInformation(iSupportedCmdGroups(i))<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;For&#160;j&#160;=&#160;0&#160;To&#160;UBound(aDispatchInfo)<br/>&#160; &#160; &#160;&#160;Dim&#160;aDispatchInformation<br/>&#160; &#160; &#160;&#160;aDispatchInformation&#160;=&#160;aDispatchInfo(j)<br/>&#160; &#160; &#160;&#160;k&#160;=&#160;k&#160;+&#160;1<br/>&#160; &#160; &#160;&#160;oSheet.getCellByPosition(0,&#160;k).getText().setString(iSupportedCmdGroups(i))<br/>&#160; &#160; &#160;&#160;oSheet.getCellByPosition(1,&#160;k).getText().setString(aDispatchInformation.Command)<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
I&#160;exchanged email&#160;with a&#160;developer who expressed doubts&#160;as&#160;to the&#160;completeness&#160;and accuracy&#160;of the&#160;<br/>returned list;&#160;because&#160;the&#160;Bibliographic&#160;commands&#160;provided by&#160;the&#160;UICommandDescription&#160;included&#160;<br/>commands&#160;such as&#160;“.uno:ArrowShapes”, which is&#160;nonsensical&#160;in this&#160;context.<br/>
265<br/>
<hr/>
<a name=269></a><i><b>Read&#160;source&#160;code<br/></b></i>SFX2 based components&#160;share&#160;a&#160;common base&#160;class&#160;for their Controller object&#160;implementation,&#160;<br/>SfxBaseController.&#160;For modules&#160;based on SFX2, it&#160;is&#160;possible&#160;to&#160;obtain&#160;the&#160;dispatches&#160;as&#160;well&#160;as&#160;the&#160;<br/>arguments&#160;by&#160;parsing&#160;the&#160;SDI&#160;files&#160;inside&#160;every&#160;sfx2&#160;based module&#160;(look&#160;at&#160;the&#160;folder &lt;module&gt;/sdi/);&#160;or&#160;<br/>even parse&#160;the&#160;header files&#160;generated in&#160;the&#160;build&#160;environment.&#160;Consider files&#160;with&#160;names&#160;such as&#160;<br/>sfxslots.hxx,&#160;svxslots.hxx,&#160;scslots.hxx,&#160;sdslots.hxx,&#160;swslots.hxx,&#160;basslots.hxx,&#160;and smslots.hxx.<br/>
For&#160;new&#160;modules&#160;it&#160;may&#160;be&#160;easier to just&#160;browse&#160;the&#160;source&#160;code;&#160;for example, in&#160;chart2:<br/>
•<br/>
chart2/source/controller/main/ChartController.cxx<br/>
•<br/>
chart2/source/controller/main/DrawCommandDispatch.cxx<br/>
•<br/>
chart2/source/controller/main/ShapeController.cxx<br/>
<b>TIP</b><br/>
Dispatch command names are&#160;case&#160;sensitive.<br/>
<i><b>&#160;11.2.&#160;Writing&#160;a&#160;macro&#160;using&#160;the&#160;dispatcher<br/></b></i>When&#160;you&#160;can’t&#160;find&#160;a&#160;method to&#160;accomplish&#160;a&#160;task using the&#160;UNO&#160;API,&#160;the&#160;next&#160;choice&#160;is&#160;usually&#160;to&#160;use&#160;the&#160;<br/>dispatcher.&#160;Macros&#160;created&#160;by&#160;the&#160;macro recorder using dispatches;&#160;use&#160;<b>Tools&#160;|&#160;Macros&#160;|&#160;Record&#160;Macro</b>&#160;to&#160;<br/>start&#160;the&#160;macro recorder.<br/>
<b>TIP</b><br/>
Some&#160;component&#160;types do not&#160;support&#160;the&#160;macro&#160;recorder;&#160;for&#160;example,&#160;Draw.<br/>
The&#160;macro recorder has&#160;many&#160;limitations;&#160;for example,&#160;the&#160;macro recorder usually&#160;does&#160;not&#160;track what&#160;<br/>happens&#160;when a&#160;dialog is&#160;opened. I&#160;discovered this&#160;limitation&#160;when I&#160;used the&#160;macro recorder to&#160;create&#160;a&#160;<br/>macro to import&#160;text&#160;files.&#160;The&#160;“Text&#160;(encoded)”&#160;import&#160;filter opens&#160;a&#160;dialog and asks&#160;questions&#160;about&#160;the&#160;<br/>imported file.&#160;The&#160;values&#160;entered in the&#160;dialog are&#160;not&#160;captured by&#160;the&#160;macro recorder.<br/>
If&#160;you&#160;desire&#160;to write&#160;a&#160;macro using the&#160;API, start&#160;by&#160;reading&#160;through the&#160;supported&#160;commands&#160;as&#160;generated&#160;<br/>by&#160;one&#160;of the&#160;macros&#160;shown above.<br/>
The&#160;“SendOutLineToStarImpress”&#160;command creates&#160;an Impress&#160;presentation with&#160;an outline&#160;created&#160;from&#160;<br/>the&#160;headings&#160;in&#160;the&#160;current&#160;document. No arguments&#160;are&#160;required.<br/>
<i><b>Listing&#160;247.</b>&#160;Create&#160;an Impress&#160;document&#160;with&#160;an outline&#160;from&#160;this&#160;document.</i><br/>
Sub&#160;CreateOutlineInImpress<br/>&#160;&#160;Dim&#160;oDispHelper&#160;as&#160;object<br/>&#160;&#160;Dim&#160;oProvider&#160;As&#160;Object<br/>&#160;&#160;oProvider&#160;=&#160;ThisComponent.CurrentController.Frame<br/>&#160;&#160;oDispHelper&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>&#160;&#160;oDispHelper.executeDispatch(oProvider,&#34;.uno:SendOutlineToStarImpress&#34;,_<br/>&#160; &#160;&#160;&#34;&#34;,&#160;,&#160;Array())<br/>End&#160;Sub<br/>
<i><b>&#160;11.3.&#160;Dispatch&#160;failure&#160;–&#160;an&#160;advanced&#160;clipboard&#160;example<br/></b></i>The&#160;request&#160;was&#160;easy,&#160;copy&#160;an entire&#160;Writer document&#160;to&#160;the&#160;clipboard.&#160;The&#160;macro recorder very&#160;quickly&#160;<br/>provided&#160;a&#160;solution. Unfortunately,&#160;the&#160;macro fails&#160;in&#160;LO&#160;when called&#160;from&#160;a&#160;button added to&#160;the&#160;document;&#160;<br/>but&#160;it&#160;works&#160;from&#160;the&#160;IDE&#160;and from&#160;AOO&#160;when called&#160;from&#160;a&#160;button.&#160;The&#160;solution&#160;is&#160;to&#160;set&#160;the&#160;focus&#160;on the&#160;<br/>document,&#160;before&#160;executing the&#160;dispatches.<br/>
266<br/>
<hr/>
<a name=270></a><i><b>Listing&#160;248.</b>&#160;Select&#160;all&#160;and copy&#160;using&#160;dispatches.<br/></i>Sub&#160;CopyToClipboard_Dispatch<br/>&#160;&#160;dim&#160;document&#160; &#160;as&#160;object<br/>&#160;&#160;dim&#160;dispatcher&#160;as&#160;object<br/>&#160;&#160;document&#160; &#160;=&#160;ThisComponent.CurrentController.Frame<br/>
&#160;&#160;' This next line was NOT added by the macro recorder.<br/>&#160; ' Without the next line, this fails in LO when called from a button.<br/>&#160;&#160;document.ContainerWindow.setFocus<br/>
&#160;&#160;dispatcher&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>&#160;&#160;dispatcher.executeDispatch(document,&#160;&#34;.uno:SelectAll&#34;,&#160;&#34;&#34;,&#160;0,&#160;Array())<br/>&#160;&#160;dispatcher.executeDispatch(document,&#160;&#34;.uno:Copy&#34;,&#160;&#34;&#34;,&#160;0,&#160;Array())<br/>End&#160;Sub<br/>
The&#160;API&#160;is&#160;more&#160;stable&#160;than&#160;the&#160;dispatches&#160;and works&#160;where&#160;a&#160;dispatch may&#160;fail.&#160;Another example&#160;where&#160;the<br/>API&#160;may&#160;be&#160;required is&#160;when the&#160;macro is&#160;invoked from&#160;OpenOffice&#160;started&#160;in headless&#160;mode;&#160;a&#160;topic&#160;not&#160;<br/>otherwise&#160;discussed in&#160;this&#160;document.&#160;<br/>
<i><b>Listing&#160;249.</b>&#160;Select&#160;all&#160;and copy&#160;using&#160;the&#160;API.<br/></i>Sub&#160;CopyToClipboard_API()<br/>&#160;&#160;Dim&#160;o &#160; &#160; &#160; &#160; ' Transferable content.<br/>&#160;&#160;Dim&#160;oClip &#160; &#160; ' Clipboard service.<br/>&#160;&#160;Dim&#160;oContents<br/>&#160;&#160;Dim&#160;sClipName&#160;As&#160;String&#160;<br/>
&#160;&#160;ThisComponent.CurrentController.Select(ThisComponent.Text)<br/>&#160;&#160;o&#160;=&#160;ThisComponent.CurrentController.getTransferable()&#160;<br/>
&#160;&#160;sClipName&#160;=&#160;&#34;com.sun.star.datatransfer.clipboard.SystemClipboard&#34;<br/>&#160;&#160;oClip&#160;=&#160;createUnoService(sClipName)<br/>&#160;&#160;oContents&#160;=&#160;oClip.setContents(o,&#160;null)<br/>End&#160;Sub&#160;<br/>
<i><b>&#160;11.4.&#160;Conclusion<br/></b></i>The&#160;dispatch commands&#160;are&#160;powerful&#160;and require&#160;little&#160;knowledge&#160;of the&#160;internal&#160;workings&#160;of OOo.&#160;<br/>Although some&#160;functionality,&#160;such as&#160;the&#160;Undo command,&#160;can only&#160;be&#160;used in the&#160;dispatcher,&#160;macros&#160;that&#160;<br/>will&#160;be&#160;used for a&#160;long time&#160;are&#160;better off&#160;using the&#160;internal&#160;objects&#160;directly.<br/>
267<br/>
<hr/>
<a name=271></a><b>&#160;12.&#160;StarDesktop<br/></b>The&#160;desktop&#160;acts&#160;as&#160;the&#160;main&#160;application&#160;that&#160;controls&#160;OpenOffice.org.&#160;This&#160;chapter introduces&#160;general&#160;<br/>techniques&#160;—&#160;such as&#160;accessing indexed objects,&#160;enumerating open documents,&#160;and loading new&#160;documents&#160;<br/>—&#160;while&#160;discussing&#160;and demonstrating&#160;the&#160;base&#160;functionality&#160;of the&#160;Desktop object.&#160;This&#160;chapter also covers<br/>the&#160;Desktop&#160;object&#160;and&#160;ThisComponent.<br/>
The&#160;Desktop object&#160;is&#160;a&#160;com.sun.star.frame.Desktop service,&#160;which supplies&#160;four primary&#160;functions:<br/>
1.&#160;StarDesktop&#160;acts&#160;as&#160;a&#160;frame.&#160;The&#160;desktop is&#160;the&#160;parent&#160;frame&#160;and controls&#160;the&#160;frames&#160;for all&#160;of the&#160;<br/>
documents.<br/>
2.&#160;StarDesktop&#160;acts&#160;as&#160;a&#160;desktop.&#160;The&#160;desktop&#160;is&#160;the&#160;main&#160;application&#160;with the&#160;ability&#160;to&#160;close&#160;the&#160;<br/>
documents&#160;—&#160;when the&#160;application&#160;is&#160;shut&#160;down, for example.<br/>
3.&#160;StarDesktop&#160;acts&#160;as&#160;a&#160;document&#160;loader.&#160;The&#160;role&#160;of the&#160;main&#160;application&#160;also allows&#160;the&#160;desktop&#160;to&#160;<br/>
load existing documents&#160;and create&#160;new&#160;documents.<br/>
4.&#160;StarDesktop&#160;acts&#160;as&#160;an event&#160;broadcaster.&#160;The&#160;desktop&#160;notifies&#160;existing documents&#160;(or any&#160;other&#160;<br/>
listener) of things&#160;that&#160;are&#160;happening&#160;—&#160;when the&#160;application is&#160;about&#160;to&#160;shut&#160;down, for example.<br/>
The&#160;Desktop, acting as&#160;the&#160;primary&#160;application object, is&#160;created when OOo is&#160;started.&#160;Use&#160;the&#160;globally&#160;<br/>available&#160;variable&#160;StarDesktop&#160;to access&#160;the&#160;OOo Desktop&#160;object.<br/>
<i><b>&#160;12.1.&#160;The&#160;Frame&#160;service<br/></b></i>The&#160;desktop&#160;is&#160;a&#160;com.sun.star.frame.Frame&#160;service&#160;(remember that&#160;an object&#160;can, and usually&#160;does,&#160;<br/>implement&#160;more&#160;than&#160;one&#160;service&#160;at&#160;a&#160;time). For a&#160;document,&#160;the&#160;primary&#160;purpose&#160;of a&#160;frame&#160;is&#160;to&#160;act&#160;as&#160;a&#160;<br/>liaison between the&#160;document&#160;and the&#160;visible&#160;window.&#160;For&#160;the&#160;desktop,&#160;however,&#160;the&#160;primary&#160;purpose&#160;is&#160;to&#160;<br/>act&#160;as&#160;the&#160;root&#160;frame,&#160;which contains&#160;all&#160;other frames.&#160;A&#160;frame&#160;can hold&#160;a&#160;component&#160;and zero&#160;or more&#160;<br/>subframes&#160;—&#160;for simplicity,&#160;consider a&#160;component&#160;to be&#160;a&#160;document.&#160;In&#160;the&#160;case&#160;of the&#160;desktop,&#160;all&#160;the&#160;other&#160;<br/>frames&#160;are&#160;subframes&#160;of the&#160;root&#160;frame,&#160;and the&#160;component&#160;(document) is&#160;a&#160;set&#160;of data. Simply&#160;stated, each&#160;<br/>document&#160;contains&#160;a&#160;frame&#160;that&#160;it&#160;uses&#160;to&#160;interact&#160;with&#160;the&#160;visible&#160;window,&#160;but&#160;the&#160;desktop is&#160;a&#160;frame&#160;so that&#160;<br/>it&#160;can contain, control,&#160;and access&#160;all&#160;of the&#160;document’s&#160;frames.<br/>
The&#160;service&#160;com.sun.star.frame.Frame&#160;— Frame&#160;for short&#160;—&#160;provides&#160;numerous&#160;interesting capabilities&#160;that&#160;<br/>are&#160;not&#160;generally&#160;useful&#160;as&#160;part&#160;of the&#160;Desktop&#160;object.&#160;For&#160;example, the&#160;Title&#160;and the&#160;StatusIndicator defined&#160;<br/>as&#160;part&#160;of the&#160;Frame&#160;service&#160;are&#160;of no use&#160;for the&#160;Desktop object&#160;because&#160;the&#160;Desktop&#160;object&#160;does&#160;not&#160;have&#160;a&#160;<br/>displayed window.&#160;These&#160;properties&#160;are&#160;meaningful&#160;only&#160;in&#160;a&#160;frame&#160;that&#160;contains&#160;a&#160;display&#160;window.&#160;The&#160;<br/>desktop&#160;is&#160;a&#160;frame&#160;so that&#160;it&#160;can act&#160;as&#160;the&#160;root&#160;frame&#160;for all&#160;the&#160;other frames.<br/>
<b>TIP</b><br/>
Although it&#160;is possible&#160;to use&#160;the&#160;desktop as a&#160;Frame&#160;service&#160;to enumerate&#160;the&#160;contained&#160;frames, the&#160;<br/>
XDesktop interface&#160;is generally&#160;more&#160;useful&#160;to enumerate&#160;the&#160;documents&#160;rather&#160;than the&#160;frames.&#160;I&#160;usually&#160;<br/>access frames to&#160;obtain window&#160;titles.<br/>
Use&#160;the&#160;getActiveFrame() method&#160;of the&#160;desktop&#160;to obtain the&#160;active&#160;frame&#160;(see<a href="libremacros.html#271">&#160;Listing 250)</a>.&#160;The&#160;active&#160;<br/>frame&#160;is&#160;the&#160;frame&#160;that&#160;contains&#160;the&#160;current&#160;focus. If&#160;the&#160;currently&#160;focused window&#160;is&#160;not&#160;an OOo window,&#160;<br/>getActiveFrame&#160;returns&#160;the&#160;last&#160;OOo frame&#160;that&#160;had the&#160;focus.<br/>
<i><b>Listing&#160;250.</b>&#160;Print&#160;the&#160;title&#160;of&#160;the&#160;current&#160;frame.<br/></i>Print&#160;StarDesktop.getActiveFrame().Title<br/>
268<br/>
<hr/>
<a name=272></a>Use&#160;the&#160;getFrames() method to&#160;enumerate&#160;or search all&#160;of the&#160;frames&#160;contained in&#160;the&#160;desktop.&#160;The&#160;<br/>getFrames() method&#160;returns&#160;an object&#160;that&#160;implements&#160;the&#160;com.sun.star.frame.XFrames&#160;interface.&#160;A&#160;frame&#160;<br/>can contain other frames;&#160;the&#160;XFrames&#160;interface&#160;provides&#160;access&#160;to the&#160;contained frames.<br/>
<b>TIP</b><br/>
Use&#160;the&#160;full&#160;interface&#160;name&#160;to find the&#160;Web&#160;address for&#160;the&#160;API&#160;information on&#160;the&#160;XFrames interface.&#160;It&#160;is&#160;<br/>
important&#160;that&#160;you learn&#160;to find&#160;the&#160;Web&#160;pages on the&#160;API&#160;site&#160;from&#160;the&#160;full&#160;service&#160;or&#160;interface&#160;name.<br/>
<b>&#160;12.1.1.&#160;The&#160;XIndexAccess&#160;interface<br/></b>The&#160;XFrames&#160;interface&#160;is&#160;derived&#160;from&#160;the&#160;com.sun.star.container.XIndexAccess&#160;interface.&#160;As&#160;its&#160;name&#160;<br/>implies,&#160;this&#160;interface&#160;allows&#160;access&#160;to&#160;the&#160;contained frames&#160;using&#160;a&#160;numeric&#160;index. Numerous&#160;other&#160;<br/>interfaces&#160;also derive&#160;from&#160;the&#160;XIndexAccess&#160;interface, allowing a&#160;simple&#160;numeric&#160;index&#160;to&#160;access&#160;the&#160;<br/>contained elements. See<a href="libremacros.html#272">&#160;Listing&#160;251&#160;and&#160;Figure&#160;80.&#160;</a>The&#160;sheets&#160;object&#160;in a&#160;Calc&#160;document&#160;allows&#160;you to&#160;<br/>access&#160;each sheet&#160;based on the&#160;index, or the&#160;name.<br/>
<b>TIP</b><br/>
Learn&#160;how&#160;to use&#160;the&#160;XIndexAccess&#160;interface&#160;because&#160;OOo uses this service&#160;in numerous other&#160;places.<br/>
<i><b>Listing&#160;251.</b>&#160;Display&#160;frame&#160;titles&#160;of&#160;open components.<br/></i>Sub&#160;DisplayFrameTitles<br/>&#160;&#160;Dim&#160;vFrames&#160;As&#160;Variant&#160; &#160; &#160; &#160; &#160; &#160;&#160;'All of the frames<br/>&#160;&#160;Dim&#160;vFrame&#160;As&#160;Variant&#160; &#160; &#160; &#160; &#160; &#160; &#160;'A single frame<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Index to enumerate the frames<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Contains the string to print<br/>&#160;&#160;<br/>&#160;&#160;vFrames&#160;=&#160;StarDesktop.getFrames()&#160;'Get all of the frames<br/>&#160;&#160;<br/>&#160;&#160;REM getCount() returns the number of contained frames<br/>&#160;&#160;REM If there are four frames, then i has the values 1, 2, 3, and 4<br/>&#160;&#160;REM the getByIndex(i) method, however, is zero based. This means<br/>&#160;&#160;REM that it requires the values 0, 1, 2, and 3<br/>&#160;&#160;For&#160;i&#160;=&#160;1&#160;To&#160;vFrames.getCount()<br/>&#160; &#160;&#160;vFrame&#160;=&#160;vFrames.getByIndex(i-1)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(i-1)&#160;&amp;&#160;&#34; : &#34;&#160;&amp;&#160;vFrame.Title&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Frame Titles&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;80.</b>&#160;Titles&#160;of&#160;top-level&#160;frames.</i><br/>
<b>&#160;12.1.2.&#160;Find&#160;frames&#160;with&#160;FrameSearchFlag&#160;constants<br/></b>Use&#160;the&#160;com.sun.star.frame.FrameSearchFlag constants&#160;to&#160;search the&#160;OOo frames&#160;(see<a href="libremacros.html#273">&#160;Table&#160;95)</a>.&#160;<br/>FrameSearchFlag constants&#160;are&#160;used to&#160;create&#160;an enumerated list&#160;of frames&#160;from&#160;the&#160;queryFrames() method&#160;<br/>
269<br/>
<hr/>
<a name=273></a>defined&#160;in the&#160;XFrames&#160;interface.&#160;The&#160;FrameSearchFlag constants&#160;are&#160;also used to&#160;find a&#160;frame&#160;when&#160;<br/>loading a&#160;document&#160;and specifying&#160;which frames&#160;will&#160;receive&#160;a&#160;dispatch. In&#160;other words, you will&#160;see&#160;the&#160;<br/>FrameSearchFlag constants&#160;again.<br/>
<i><b>Table&#160;95.</b>&#160;com.sun.star.frame.FrameSearchFlag constants.&#160;</i><br/>
<i><b>#</b></i><br/>
<i><b>Name</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
AUTO<br/>
Deprecated.&#160;Use&#160;6&#160;=&#160;SELF+CHILDREN.<br/>
1<br/>
PARENT<br/>
Include&#160;the&#160;parent&#160;frame.<br/>
2<br/>
SELF<br/>
Include&#160;this frame.<br/>
4<br/>
CHILDREN<br/>
Include&#160;the&#160;child&#160;frames&#160;of&#160;this&#160;frame.<br/>
8<br/>
CREATE<br/>
Create&#160;a&#160;frame&#160;if&#160;the&#160;requested&#160;frame&#160;is not&#160;found.<br/>
16<br/>
SIBLINGS&#160;<br/>
Include&#160;the&#160;child&#160;frames&#160;of&#160;the&#160;parent&#160;of&#160;this frame.<br/>
32<br/>
TASKS<br/>
Include&#160;all&#160;frames&#160;in&#160;all&#160;tasks&#160;in&#160;the&#160;current&#160;frames hierarchy.<br/>
23<br/>
ALL<br/>
Include&#160;all&#160;frames&#160;except&#160;TASKS&#160;frames. 23 =&#160;1+2+4+16 =&#160;PARENT&#160;+&#160;SELF&#160;+&#160;CHILDREN&#160;<br/>+&#160;SIBLINGS.&#160;<br/>
55<br/>
GLOBAL<br/>
Include&#160;every&#160;frame. 55 =&#160;1+2+4+16+32&#160;=&#160;PARENT&#160;+&#160;SELF&#160;+&#160;CHILDREN&#160;+&#160;SIBLINGS&#160;+&#160;<br/>TASKS.<br/>
The&#160;values&#160;i<a href="libremacros.html#273">n&#160;Table&#160;95&#160;a</a>re&#160;enumerated constants. OOo has&#160;enumerated values&#160;for many&#160;different&#160;purposes.&#160;<br/>You can access&#160;all&#160;enumerated&#160;values&#160;in OOo Basic&#160;in&#160;a&#160;similar fashion.&#160;Each constant&#160;has&#160;an assigned&#160;<br/>name, as&#160;seen in&#160;the&#160;Name&#160;column&#160;i<a href="libremacros.html#273">n&#160;Table&#160;95.&#160;</a>You can use&#160;this&#160;name&#160;by&#160;preceding it&#160;with&#160;<br/>com.sun.star.frame.FrameSearchFlag. For example,&#160;use&#160;com.sun.star.frame.FrameSearchFlag.TASKS&#160;to&#160;use&#160;<br/>the&#160;TASKS&#160;constant&#160;(see<a href="libremacros.html#273">&#160;Listing&#160;252).&#160;</a>The&#160;name&#160;of a&#160;constant&#160;provides&#160;meaningful&#160;information&#160;while&#160;<br/>reading&#160;the&#160;Basic&#160;code. Using&#160;the&#160;constant&#160;values&#160;directly,&#160;although allowed, obfuscates&#160;your code&#160;—&#160;in&#160;<br/>other words, causes&#160;it&#160;to be&#160;less&#160;readable.<br/>
<b>TIP</b><br/>
Constant&#160;names are&#160;case&#160;sensitive&#160;the&#160;first&#160;time&#160;that&#160;they&#160;are&#160;used.&#160;If&#160;the&#160;two lines&#160;in<a href="libremacros.html#273">&#160;Listing&#160;252&#160;a</a>re&#160;<br/>
switched,&#160;then a&#160;run-time&#160;error&#160;occurs because&#160;the&#160;version with&#160;the&#160;wrong&#160;case&#160;is found first.<br/>
<i><b>Listing&#160;252.</b>&#160; Constant&#160;names&#160;are&#160;not&#160;case&#160;sensitive&#160;the&#160;second time&#160;they&#160;are&#160;used.</i><br/>
Print&#160;com.sun.star.frame.FrameSearchFlag.TASKS&#160;&#160;'32<br/>Print&#160;COM.SUN.STAR.frame.FrameSearchFLAG.tasKS&#160;&#160;'32 – Works because it is already known.<br/>
The&#160;values&#160;i<a href="libremacros.html#273">n&#160;Table&#160;95&#160;a</a>re&#160;flags&#160;that&#160;may&#160;be&#160;combined. For example,&#160;the&#160;values&#160;for&#160;ALL&#160;and GLOBAL&#160;exist<br/>only&#160;as&#160;a&#160;convenience;&#160;they&#160;are&#160;a&#160;combination of the&#160;other flags&#160;as&#160;shown i<a href="libremacros.html#273">n&#160;Table&#160;95.&#160;</a>You can create&#160;your&#160;<br/>own values&#160;if a&#160;suitable&#160;combination is&#160;not&#160;provided. For example,&#160;to search&#160;ALL&#160;and to create&#160;a&#160;frame&#160;if it&#160;<br/>is&#160;not&#160;found, use&#160;the&#160;value&#160;31 =&#160;23 +&#160;8 =&#160;ALL&#160;+&#160;CREATE.<br/>
<b>TIP</b><br/>
Frame&#160;search flags are&#160;bit-flags that&#160;can be&#160;combined&#160;by&#160;using&#160;the&#160;OR&#160;operator.&#160;If&#160;you&#160;do&#160;not&#160;know&#160;what&#160;a&#160;<br/>
bit-flag&#160;is, just&#160;smile&#160;and nod.<br/>
The&#160;code&#160;in<a href="libremacros.html#274">&#160;Listing 253&#160;us</a>es&#160;the&#160;FrameSearchFlag constants&#160;to&#160;search the&#160;frames&#160;that&#160;are&#160;children of the&#160;<br/>Desktop object.&#160;The&#160;output&#160;from<a href="libremacros.html#274">&#160;Listing 253&#160;dupl</a>icates&#160;the&#160;output&#160;from<a href="libremacros.html#272">&#160;Listing&#160;251&#160;b</a>y&#160;obtaining a&#160;list&#160;of all&#160;<br/>child&#160;frames&#160;from&#160;the&#160;Desktop&#160;object.&#160;Note&#160;that&#160;the&#160;return type&#160;from&#160;the&#160;queryFrames() method&#160;is&#160;an array.&#160;I&#160;<br/>know&#160;this&#160;because&#160;I&#160;looked&#160;at&#160;the&#160;API&#160;Web&#160;site.&#160;Although you&#160;can inspect&#160;the&#160;returned object&#160;to&#160;see&#160;what&#160;it&#160;<br/>
270<br/>
<hr/>
<a name=274></a>is, it&#160;isn’t&#160;possible&#160;to&#160;determine&#160;the&#160;values&#160;of the&#160;arguments&#160;to the&#160;queryFrames() method by&#160;inspection&#160;<br/>alone.<br/>
<i><b>Listing&#160;253.</b>&#160;Query&#160;frames&#160;to&#160;get&#160;frame&#160;titles.<br/></i>Sub&#160;QueryFrames<br/>&#160;&#160;Dim&#160;vFrames&#160;As&#160;Variant&#160; &#160; &#160; &#160; &#160; &#160;&#160;'All of the frames<br/>&#160;&#160;Dim&#160;vFrame&#160;As&#160;Variant&#160; &#160; &#160; &#160; &#160; &#160; &#160;'A single frame<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Index to enumerate the frames<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Contains the string to print<br/>&#160;&#160;REM Call the queryFrames() method on the XFrames interface.<br/>&#160;&#160;REM This takes one argument, a FrameSearchFlag.<br/>&#160;&#160;REM This searches the children of the desktop.<br/>&#160;&#160;vFrames&#160;=&#160;StarDesktop.getFrames().queryFrames(_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;com.sun.star.frame.FrameSearchFlag.CHILDREN)<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(vFrames)&#160;To&#160;UBound(vFrames)&#160;' The return value is an array.<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vFrames(i).Title&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160;&#160;' Append the title and a new line.<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Frame Titles&#34;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' Display the titles.<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
In&#160;OOo 3.3.0, I&#160;noticed that&#160;the&#160;frame&#160;title&#160;differs for&#160;the&#160;help window&#160;when enumerated&#160;using&#160;a&#160;query.&#160;I&#160;<br/>have&#160;not&#160;pursued exactly&#160;why.<br/>
<i><b>&#160;12.2.&#160;The&#160;XEventBroadcaster&#160;interface<br/></b></i>When&#160;certain&#160;important&#160;events&#160;occur in OOo, the&#160;event&#160;is&#160;broadcast&#160;to all&#160;the&#160;objects&#160;that&#160;register as&#160;<br/>listeners&#160;for a&#160;specific&#160;event&#160;—&#160;for example,&#160;to be&#160;notified before&#160;a&#160;document&#160;is&#160;closed.&#160;The&#160;<br/>com.sun.star.document.XEventBroadcaster interface&#160;allows&#160;the&#160;desktop&#160;to act&#160;as&#160;a&#160;broadcaster.<br/>
The&#160;XEventBroadcaster interface&#160;defines&#160;the&#160;methods&#160;addEventListener() and removeEventListener() to&#160;add<br/>and remove&#160;event&#160;listeners.&#160;These&#160;two methods&#160;are&#160;not&#160;usually&#160;used directly&#160;because&#160;methods&#160;that&#160;are&#160;<br/>specific&#160;to the&#160;listener are&#160;typically&#160;used. For example,&#160;the&#160;Controller object&#160;contains&#160;the&#160;methods&#160;<br/>addKeyHandler() and removeKeyHandler() to&#160;add and remove&#160;listeners&#160;for key-press&#160;events.<br/>
<i><b>&#160;12.3.&#160;The&#160;XDesktop&#160;interface<br/></b></i>The&#160;com.sun.star.frame.XDesktop&#160;interface&#160;defines&#160;the&#160;primary&#160;functionality&#160;of the&#160;Desktop service.&#160;The&#160;<br/>desktop&#160;contains&#160;the&#160;top-level&#160;components&#160;that&#160;can be&#160;viewed in a&#160;frame. In&#160;other words, it&#160;contains&#160;and&#160;<br/>controls&#160;the&#160;life&#160;cycle&#160;of the&#160;OpenOffice.org&#160;documents,&#160;help window,&#160;Basic&#160;IDE, and the&#160;other component&#160;<br/>types.<br/>
The&#160;desktop&#160;is&#160;a&#160;Frame&#160;service&#160;so that&#160;it&#160;can act&#160;as&#160;the&#160;root&#160;frame&#160;containing all&#160;the&#160;other frames.&#160;The&#160;<br/>desktop,&#160;therefore, has&#160;access&#160;to&#160;and controls&#160;all&#160;the&#160;other frames.&#160;This&#160;control&#160;includes&#160;the&#160;ability&#160;to&#160;load&#160;<br/>documents&#160;and the&#160;ability&#160;to&#160;close&#160;all&#160;frames&#160;and exit&#160;OOo.<br/>
<b>&#160;12.3.1.&#160;Closing&#160;the&#160;desktop&#160;and&#160;contained&#160;components<br/></b>To&#160;close&#160;the&#160;desktop&#160;and all&#160;the&#160;contained&#160;frames, call&#160;the&#160;terminate() method.&#160;This&#160;method&#160;is&#160;not&#160;<br/>guaranteed to&#160;close&#160;the&#160;desktop;&#160;it&#160;is&#160;merely&#160;a&#160;suggestion (or request)&#160;that&#160;you&#160;would&#160;like&#160;OOo to close.&#160;<br/>Before&#160;closing, the&#160;desktop&#160;asks&#160;every&#160;object&#160;that&#160;asked to&#160;be&#160;notified&#160;before&#160;closing if it&#160;is&#160;OK&#160;to close. If&#160;<br/>any&#160;listener says&#160;no, then OOo will&#160;not&#160;terminate. Every&#160;open document&#160;registers&#160;as&#160;a&#160;terminate&#160;listener and&#160;<br/>asks&#160;you if you&#160;want&#160;to&#160;save&#160;a&#160;document&#160;if it&#160;has&#160;not&#160;yet&#160;been saved;&#160;in case&#160;you wondered how&#160;that&#160;works.<br/>
271<br/>
<hr/>
<a name=275></a>All&#160;the&#160;OOo document&#160;types&#160;support&#160;the&#160;com.sun.star.util.XCloseable&#160;interface.&#160;The&#160;XCloseable&#160;interface&#160;<br/>defines&#160;the&#160;method&#160;“close(bForce&#160;As&#160;Boolean)”. If&#160;bForce&#160;is&#160;False, the&#160;object&#160;may&#160;refuse&#160;to&#160;close. If&#160;bForce&#160;<br/>is&#160;True, the&#160;object&#160;is&#160;not&#160;able&#160;to&#160;refuse.<br/>
According to Mathias&#160;Bauer,&#160;one&#160;of the&#160;lead developers, the&#160;Desktop&#160;object&#160;does&#160;not&#160;support&#160;the&#160;XCloseable<br/>interface&#160;for legacy&#160;reasons.&#160;The&#160;terminate() method&#160;was&#160;used before&#160;it&#160;was&#160;determined to&#160;be&#160;inadequate&#160;for&#160;<br/>closing&#160;documents&#160;or windows. If&#160;the&#160;terminate() method&#160;was&#160;not&#160;already&#160;implemented,&#160;then the&#160;desktop&#160;<br/>would&#160;also support&#160;the&#160;XCloseable&#160;interface.&#160;<br/>
The&#160;code&#160;in<a href="libremacros.html#275">&#160;Listing 254&#160;de</a>monstrates&#160;the&#160;safe&#160;way&#160;to&#160;close&#160;a&#160;document&#160;using any&#160;version&#160;of OOo. If&#160;you&#160;<br/>know&#160;that&#160;your&#160;code&#160;will&#160;run on OOo 1.1 or later,&#160;you&#160;can simply&#160;use&#160;the&#160;close() method.<br/>
<i><b>Listing&#160;254.</b>&#160;The&#160;safe&#160;way&#160;to&#160;close&#160;a document&#160;using&#160;any&#160;version of&#160;OOo.<br/></i>If&#160;HasUnoInterfaces(oDoc,&#160;&#34;com.sun.star.util.XCloseable&#34;)&#160;Then<br/>&#160;&#160;oDoc.close(true)<br/>Else<br/>&#160;&#160;oDoc.dispose()<br/>End&#160;If<br/>
The&#160;code&#160;in<a href="libremacros.html#275">&#160;Listing 254&#160;a</a>ssumes&#160;that&#160;the&#160;variable&#160;oDoc&#160;references&#160;an OOo document. Some&#160;component&#160;<br/>types&#160;do not&#160;support&#160;the&#160;XCloseable&#160;interface. One&#160;example&#160;is&#160;the&#160;Basic&#160;IDE.&#160;The&#160;desktop&#160;contains&#160;methods<br/>to enumerate&#160;the&#160;currently&#160;open components&#160;and to&#160;access&#160;the&#160;current&#160;component.&#160;These&#160;methods&#160;are&#160;<br/>discussed shortly.<br/>
The&#160;dispose() method&#160;automatically&#160;discards&#160;a&#160;document&#160;even if it&#160;is&#160;modified,&#160;while&#160;the&#160;close() method&#160;<br/>does&#160;not.&#160;Use&#160;setModified(False) to mark a&#160;modified document&#160;as&#160;not&#160;modified,&#160;thereby&#160;preventing the&#160;<br/>close() method&#160;from&#160;complaining that&#160;you&#160;are&#160;closing a&#160;modified&#160;document.<br/>
<b>&#160;12.3.2.&#160;Enumerating&#160;components&#160;using&#160;XEnumerationAccess<br/></b>Usually,&#160;a&#160;component&#160;refers&#160;to&#160;an OOo document,&#160;but&#160;it&#160;may&#160;refer to&#160;other things, such as&#160;the&#160;Basic&#160;IDE&#160;or&#160;<br/>the&#160;included help pages. Use&#160;the&#160;getComponents() method&#160;defined in&#160;the&#160;XDesktop interface&#160;to&#160;return an&#160;<br/>enumeration&#160;of &#160;the&#160;components&#160;controlled by&#160;the&#160;desktop.&#160;The&#160;returned object&#160;supports&#160;the&#160;interface&#160;<br/>com.sun.star.container.XEnumerationAccess.<br/>
<b>TIP</b><br/>
OOo has&#160;many&#160;interfaces&#160;for&#160;returning&#160;a&#160;list&#160;of&#160;objects&#160;—&#160;some&#160;methods&#160;return an array&#160;of&#160;objects. In&#160;the&#160;<br/>
desktop,&#160;XIndexAccess is used&#160;to enumerate&#160;frames and&#160;the&#160;XEnumerationAccess interface&#160;is used&#160;to&#160;<br/>enumerate&#160;components.<br/>
A&#160;component&#160;that&#160;is&#160;also an OOo document&#160;supports&#160;the&#160;XModel&#160;interface.&#160;The&#160;model&#160;represents&#160;the&#160;<br/>underlying document&#160;data,&#160;so if&#160;a&#160;component&#160;doesn’t&#160;support&#160;the&#160;XModel&#160;interface, it&#160;isn’t&#160;an OOo&#160;<br/>document.&#160;In&#160;other words, supporting the&#160;XModel&#160;interface&#160;implies&#160;that&#160;a&#160;component&#160;has&#160;data;&#160;if it&#160;doesn’t&#160;<br/>have&#160;data,&#160;then it&#160;isn’t&#160;a&#160;document.&#160;Use&#160;the&#160;HasUnoInterfaces&#160;function to&#160;check each component&#160;to see&#160;if it&#160;<br/>is&#160;an OOo document.&#160;To&#160;find a&#160;specific&#160;document,&#160;search all&#160;of the&#160;components&#160;and check the&#160;URL&#160;or some&#160;<br/>other distinguishing characteristic.&#160;<br/>
It&#160;is&#160;possible&#160;that&#160;a&#160;document&#160;does&#160;not&#160;have&#160;a&#160;URL,&#160;in&#160;this&#160;case, the&#160;returned URL&#160;is&#160;an empty&#160;string.&#160;The&#160;<br/>subroutine&#160;FileNameOutOfPath fails&#160;with an empty&#160;string;&#160;so EnumerateComponentNames&#160;checks&#160;for this&#160;<br/>case.<br/>
<i><b>Listing&#160;255.</b>&#160;Demonstrate&#160;how to&#160;enumerate&#160;components.<br/></i>Sub&#160;EnumerateComponentNames<br/>&#160;&#160;Dim&#160;vComps&#160; &#160; &#160; &#160; &#160;&#160;'Enumeration access object<br/>&#160;&#160;Dim&#160;vEnumerate&#160; &#160; &#160;&#160;'Enumeration object<br/>
272<br/>
<hr/>
<a name=276></a>&#160;&#160;Dim&#160;vComp&#160; &#160; &#160; &#160; &#160; &#160;'Single component<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160;'Display string<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160;&#160;'Document URL<br/>&#160;&#160;<br/>&#160;&#160;REM Load the Tools library because Strings module contains<br/>&#160;&#160;REM the function FileNameOutOfPath()<br/>&#160;&#160;GlobalScope.BasicLibraries.LoadLibrary(&#34;Tools&#34;)<br/>&#160;&#160;<br/>&#160;&#160;vComps=StarDesktop.getComponents()'com.sun.star.container.XEnumerationAccess<br/>&#160;&#160;If&#160;NOT&#160;vComps.hasElements()&#160;Then&#160; &#160; &#160; &#160;&#160;'I do not have to do this, but<br/>&#160; &#160;&#160;Print&#160;&#34;There are no components&#34;&#160; &#160; &#160; &#160;'this demonstrates that I can<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;vEnumerate&#160;=&#160;vComps.createEnumeration()&#160;'com.sun.star.container.XEnumeration<br/>&#160;&#160;Do&#160;While&#160;vEnumerate.hasMoreElements()&#160; &#160;'Are there any elements to retrieve?<br/>&#160; &#160;&#160;vComp&#160;=&#160;vEnumerate.nextElement()&#160; &#160; &#160;&#160;'Get next element<br/>
&#160; &#160;&#160;REM Only try to get the URL from document components<br/>&#160; &#160;&#160;REM This will skip the IDE, for example<br/>&#160; &#160;&#160;If&#160;HasUnoInterfaces(vComp,&#160;&#34;com.sun.star.frame.XModel&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;sURL&#160;=&#160;vComp.getURL()<br/>&#160; &#160; &#160;&#160;If&#160;sURL&#160;=&#160;&#34;&#34;&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;&lt;Component With No URL&gt;&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;FileNameOutOfPath(sURL)&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Loop&#160;&#160;<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Document Names&#34;<br/>End&#160;Sub<br/>
<a href="libremacros.html#276">Figure&#160;81,&#160;</a>produced by&#160;Listing 6,&#160;lists&#160;the&#160;file&#160;names&#160;of all&#160;currently&#160;open documents.<br/>
<i><b>Figure&#160;81.</b>&#160;File&#160;names&#160;of&#160;currently&#160;open documents.</i><br/>
<b>&#160;12.3.3.&#160;Current&#160;component<br/></b>Use&#160;getCurrentComponent() to return the&#160;currently&#160;focused component, which is&#160;not&#160;necessarily&#160;an OOo&#160;<br/>document.&#160;To&#160;obtain&#160;the&#160;most&#160;current&#160;document, use&#160;the&#160;globally&#160;defined variable&#160;ThisComponent.<br/>
<i><b>Listing&#160;256.</b>&#160;ThisComponent&#160;references&#160;the&#160;current&#160;OOo document.</i><br/>
Print&#160;ThisComponent.getURL()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Works from Basic IDE<br/>Print&#160;StarDesktop.getCurrentComponent().getURL()&#160; &#160;'Fails from Basic IDE<br/>
273<br/>
<hr/>
<a name=277></a><b>TIP</b><br/>
StarDesktop.getCurrentComponent()&#160;returns the&#160;currently&#160;focused&#160;component.&#160;If&#160;the&#160;Basic&#160;IDE&#160;is open,&#160;<br/>
the&#160;Basic&#160;IDE&#160;component&#160;is&#160;returned.&#160;Use&#160;the&#160;globally&#160;defined&#160;variable&#160;ThisComponent&#160;to&#160;return the&#160;most&#160;<br/>current&#160;document.<br/>
Most&#160;of the&#160;macros&#160;that&#160;I&#160;write&#160;are&#160;intended to modify&#160;the&#160;current&#160;document. Because&#160;of this, I&#160;frequently&#160;<br/>use&#160;ThisComponent.<br/>
<b>&#160;12.3.4.&#160;Current&#160;component&#160;(again)<br/></b>Although StarDesktop.getCurrentComponent() can be&#160;used in many&#160;situations, it&#160;is&#160;not&#160;a&#160;reliable&#160;method&#160;to&#160;<br/>obtain&#160;the&#160;document&#160;that&#160;most&#160;recently&#160;had focus.&#160;The&#160;method getCurrentComponent() returns&#160;either the&#160;<br/>component&#160;that&#160;currently&#160;has&#160;focus, or the&#160;component&#160;that&#160;had the&#160;focus&#160;before&#160;control&#160;was&#160;switched to&#160;a&#160;<br/>different&#160;application.&#160;This&#160;behavior causes&#160;problems&#160;when attempting to debug Basic&#160;programs, because&#160;the&#160;<br/>Basic&#160;IDE&#160;is&#160;the&#160;current&#160;component.&#160;It&#160;is&#160;therefore&#160;preferable&#160;to&#160;use&#160;ThisComponent&#160;rather than&#160;<br/>StarDesktop.CurrentComponent.&#160;Forcing a&#160;new&#160;document’s&#160;window&#160;to&#160;become&#160;focused does&#160;not&#160;change&#160;the<br/>value&#160;of&#160;ThisComponent.&#160;The&#160;value&#160;of&#160;ThisComponent&#160;is&#160;set&#160;when the&#160;macro begins&#160;running and then it&#160;is&#160;<br/>not&#160;changed.<br/>
<i><b>Listing&#160;257.</b>&#160;Use&#160;one&#160;of&#160;these&#160;two methods&#160;to cause&#160;oDoc2 to&#160;become&#160;the&#160;focused document.<br/></i>oDoc2.CurrentController.Frame.ContainerWindow.toFront()<br/>oDoc2.CurrentController.Frame.Activate()<br/>
<b>TIP</b><br/>
When&#160;a&#160;macro&#160;is called&#160;because&#160;an&#160;event&#160;occurred,&#160;ThisComponent&#160;refers to the&#160;document&#160;that&#160;produced&#160;<br/>the&#160;event&#160;unless&#160;the&#160;macro&#160;is contained&#160;in&#160;another&#160;document.&#160;Therefore,&#160;it’s&#160;better&#160;to place&#160;global&#160;macros&#160;<br/>
that&#160;will&#160;be&#160;called from&#160;other&#160;documents inside&#160;a&#160;global&#160;library&#160;rather&#160;than inside&#160;a&#160;document.<br/>
Macros&#160;may&#160;be&#160;called&#160;when certain events&#160;occur (perhaps&#160;as&#160;a&#160;registered event&#160;handler).&#160;When&#160;a&#160;macro is&#160;<br/>called because&#160;an event&#160;occurred,&#160;ThisComponent&#160;refers&#160;to the&#160;document&#160;that&#160;produced the&#160;event&#160;even if it&#160;<br/>isn’t&#160;the&#160;currently&#160;focused document.&#160;The&#160;variable&#160;ThisComponent&#160;is&#160;available&#160;only&#160;from&#160;BASIC.<br/>
<b>TIP</b><br/>
It&#160;is&#160;possible&#160;to run&#160;a&#160;macro&#160;when&#160;no document&#160;is open;&#160;for&#160;obvious reasons,&#160;the&#160;macro&#160;must&#160;reside&#160;in&#160;the&#160;<br/>application library&#160;rather&#160;than in a&#160;document.<br/>
<b>&#160;12.3.5.&#160;Current&#160;frame<br/></b>Although the&#160;Frame&#160;service&#160;allows&#160;the&#160;desktop&#160;to enumerate&#160;the&#160;contained frames, it&#160;is&#160;the&#160;XDesktop&#160;<br/>interface&#160;that&#160;defines&#160;the&#160;method getCurrentFrame().&#160;The&#160;getCurrentFrame() method returns&#160;the&#160;frame&#160;of the<br/>currently&#160;focused component.&#160;<br/>
<b>TIP</b><br/>
The&#160;component&#160;contained&#160;in&#160;the&#160;current&#160;frame&#160;may,&#160;or&#160;may&#160;not, be&#160;an OOo document.<br/>
The&#160;code&#160;in<a href="libremacros.html#277">&#160;Listing 258&#160;s</a>hows&#160;one&#160;of many&#160;things&#160;you&#160;can do with the&#160;current&#160;frame.&#160;The&#160;macro obtains&#160;the<br/>current&#160;frame,&#160;the&#160;frame&#160;returns&#160;the&#160;current&#160;window,&#160;and then the&#160;macro reduces&#160;the&#160;size&#160;of the&#160;current&#160;<br/>window.&#160;<br/>
<i><b>Listing&#160;258.</b>&#160;Shrink&#160;the&#160;size&#160;of&#160;the&#160;current&#160;window&#160;by&#160;25%</i><br/>
REM Shrink the current window to 75% of its current size.<br/>Sub&#160;ShrinkWindowBy75<br/>&#160;&#160;Dim&#160;vFrame&#160; &#160; &#160;'Current frame<br/>&#160;&#160;Dim&#160;vWindow&#160; &#160;&#160;'container window<br/>&#160;&#160;<br/>
274<br/>
<hr/>
<a name=278></a>&#160;&#160;REM And this is a struct that holds a rectangle object<br/>&#160;&#160;REM I could have also used a Variant or an Object to<br/>&#160;&#160;REM hold the return type, but I know what it is, so I&#160;<br/>&#160;&#160;REM defined the correct type to hold it.<br/>&#160;&#160;Dim&#160;vRect&#160;As&#160;New&#160;com.sun.star.awt.Rectangle<br/>&#160;&#160;<br/>&#160;&#160;vFrame&#160;=&#160;StarDesktop.getCurrentFrame()<br/>&#160;&#160;vWindow&#160;=&#160;vFrame.getContainerWindow()<br/>&#160;&#160;<br/>&#160;&#160;REM As a struct, the object is copied by value, not by reference.<br/>&#160;&#160;REM This means that I can modify vRect and it will not affect<br/>&#160;&#160;REM the position and size of the window.<br/>&#160;&#160;REM In my tests, vRect.X and vRect.Y are zero, which is wrong.&#160;<br/>&#160;&#160;REM vRect.Width and vRect.Height are indeed correct.<br/>&#160;&#160;vRect&#160;=&#160;vWindow.getPosSize()<br/>&#160;&#160;<br/>&#160;&#160;REM When setting the position and size, the last argument specifies<br/>&#160;&#160;REM which of the arguments to use.&#160;<br/>&#160;&#160;'com.sun.star.awt.PosSize.X &#160; &#160; &#160; &#160;Set only the X-position<br/>&#160;&#160;'com.sun.star.awt.PosSize.Y &#160; &#160; &#160; &#160;Set only the Y-position<br/>&#160;&#160;'com.sun.star.awt.PosSize.WIDTH &#160; &#160;Set only the Width<br/>&#160;&#160;'com.sun.star.awt.PosSize.HEIGHT &#160; Set only the Height<br/>&#160;&#160;'com.sun.star.awt.PosSize.POS &#160; &#160; &#160;Set only the Position<br/>&#160;&#160;'com.sun.star.awt.PosSize.SIZE &#160; &#160; Set only the Size<br/>&#160;&#160;'com.sun.star.awt.PosSize.POSSIZE &#160;Set both the Position and Size<br/>&#160;&#160;vWindow.setPosSize(&#160;vRect.X,&#160;vRect.Y,&#160;3*vRect.Width/4,&#160;3*vRect.Height/4,_<br/>&#160; &#160; &#160; &#160;&#160;com.sun.star.awt.PosSize.SIZE&#160;)<br/>End&#160;Sub<br/>
<i><b>&#160;12.4.&#160;Load&#160;a&#160;document<br/></b></i>The&#160;desktop&#160;implements&#160;the&#160;com.sun.star.frame.XComponentLoader interface.&#160;This&#160;is&#160;a&#160;simple&#160;interface&#160;to&#160;<br/>load components&#160;from&#160;a&#160;URL. Use&#160;the&#160;method LoadComponentFromUrl() defined in&#160;the&#160;<br/>XComponentLoader interface&#160;to&#160;load an existing&#160;document&#160;or create&#160;a&#160;new&#160;one.<br/>
com.sun.star.lang.XComponent&#160;loadComponentFromUrl(<br/>&#160;&#160;String&#160;aURL,<br/>&#160;&#160;String&#160;aTargetFrameName,&#160;<br/>&#160;&#160;Long&#160;nSearchFlags,&#160;<br/>&#160;&#160;sequence&lt;&#160;com::sun::star::beans::PropertyValue&#160;&gt;&#160;aArgs)<br/>
The&#160;first&#160;argument&#160;to the&#160;method&#160;LoadComponentFromUrl() specifies&#160;the&#160;URL&#160;of the&#160;document&#160;to load.&#160;To&#160;<br/>load an existing&#160;document, provide&#160;the&#160;URL&#160;of the&#160;document. Use&#160;the&#160;function ConvertToURL&#160;to&#160;convert&#160;a&#160;<br/>file&#160;name&#160;expressed in&#160;an operating-system-specific&#160;format&#160;to&#160;a&#160;URL.<br/>
Print&#160;ConvertToURL(&#34;c:\temp\file.txt&#34;)&#160;'file:///c:/temp/file.txt<br/>
The&#160;URL&#160;may&#160;indicate&#160;a&#160;local&#160;file,&#160;or even a&#160;file&#160;on the&#160;Internet&#160;(see<a href="libremacros.html#278">&#160;Listing&#160;259). I</a>&#160;recommend obtaining a&#160;<br/>high-speed Internet&#160;connection before&#160;running this&#160;macro because&#160;it&#160;loads&#160;a&#160;500-page&#160;document.&#160;Also,&#160;do&#160;<br/>not&#160;run this&#160;macro unless&#160;you&#160;have&#160;OOo 3.4 or later,&#160;because&#160;when you&#160;close&#160;AndrewMacro, it&#160;will&#160;cause&#160;<br/>OOo to crash.<br/>
<i><b>Listing&#160;259.</b>&#160;Load document&#160;over&#160;HTTP.</i><br/>
Sub&#160;LoadMacroDocFromHttp<br/>&#160;&#160;Dim&#160;noArgs()&#160; &#160; &#160; &#160; &#160;&#160;'An empty array for the arguments.<br/>
275<br/>
<hr/>
<a name=279></a>&#160;&#160;Dim&#160;vComp&#160; &#160; &#160; &#160; &#160; &#160; &#160;'The loaded component<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160; &#160;&#160;'URL of the document to load<br/>&#160;&#160;sURL&#160;=&#160;&#34;http://www.pitonyak.org/AndrewMacro.odt&#34;<br/>&#160;&#160;vComp&#160;=&#160;StarDesktop.LoadComponentFromUrl(sURL,&#160;&#34;_blank&#34;,&#160;0,&#160;noArgs())<br/>End&#160;Sub<br/>
OOo uses&#160;special&#160;URLs&#160;to indicate&#160;that&#160;a&#160;new&#160;document, rather than an existing&#160;document, should&#160;be&#160;<br/>created.<br/>
<i><b>Table&#160;96.</b>&#160;URLs&#160;for&#160;creating new documents.</i><br/>
<i><b>URL</b></i><br/>
<i><b>Document&#160;Type</b></i><br/>
&#34;private:factory/scalc&#34;<br/>
Calc&#160;document<br/>
&#34;private:factory/swriter&#34;<br/>
Writer&#160;document<br/>
&#34;private:factory/swriter/web&#34;<br/>
Writer&#160;HTML&#160;Web&#160;document<br/>
&#34;private:factory/swriter/GlobalDocument&#34;<br/>
Master&#160;document<br/>
&#34;private:factory/sdraw&#34;<br/>
Draw&#160;document<br/>
&#34;private:factory/smath&#34;<br/>
Math formula&#160;document<br/>
&#34;private:factory/simpress&#34;<br/>
Impress presentation document<br/>
&#34;private:factory/schart&#34;<br/>
Chart<br/>
&#34;.component:Bibliography/View1&#34;<br/>
Bibliography&#160;—&#160;Edit&#160;the&#160;bibliography&#160;entries<br/>
&#34;.component:DB/QueryDesign&#34;<br/>
Database&#160;components<br/>
&#34;.component:DB/TableDesign&#34;<br/>&#34;.component:DB/RelationDesign&#34;<br/>&#34;.component:DB/DataSourceBrowser&#34;<br/>&#34;.component:DB/FormGridView&#34;<br/>
The&#160;macro i<a href="libremacros.html#279">n&#160;Listing&#160;260&#160;ope</a>ns&#160;five&#160;new&#160;documents&#160;—&#160;each in&#160;a&#160;new&#160;window.&#160;When I&#160;last&#160;ran this&#160;in OOo&#160;<br/>3.3, OOo seemed a&#160;bit&#160;confused as&#160;to&#160;which document&#160;should&#160;have&#160;focus.<br/>
<i><b>Listing&#160;260.</b>&#160;Create&#160;new&#160;documents.</i><br/>
Sub&#160;LoadEmptyDocuments<br/>&#160;&#160;Dim&#160;noArgs()&#160; &#160; &#160; &#160; &#160;&#160;'An empty array for the arguments<br/>&#160;&#160;Dim&#160;vComp&#160; &#160; &#160; &#160; &#160; &#160; &#160;'The loaded component<br/>&#160;&#160;Dim&#160;sURLs()&#160; &#160; &#160; &#160; &#160; &#160;'URLs of the new document types to load<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160; &#160;&#160;'URL of the document to load<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;sURLs&#160;=&#160;Array(&#34;scalc&#34;,&#160;&#34;swriter&#34;,&#160;&#34;sdraw&#34;,&#160;&#34;smath&#34;,&#160;&#34;simpress&#34;)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(sURLs)&#160;To&#160;UBound(sURLs)<br/>&#160; &#160;&#160;sURL&#160;=&#160;&#34;private:factory/&#34;&#160;&amp;&#160;sURLs(i)<br/>&#160; &#160;&#160;vComp&#160;=&#160;StarDesktop.LoadComponentFromUrl(sURL,&#160;&#34;_blank&#34;,&#160;0,&#160;noArgs())<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
You can also load&#160;a&#160;document&#160;from&#160;a&#160;frame.<br/>
When&#160;a&#160;component&#160;(document) is&#160;loaded, it&#160;is&#160;placed into&#160;a&#160;frame;&#160;the&#160;second argument&#160;to&#160;<br/>LoadComponentFromUrl() specifies&#160;the&#160;name&#160;of the&#160;frame.&#160;If&#160;a&#160;frame&#160;with the&#160;specified&#160;name&#160;already&#160;<br/>exists,&#160;the&#160;newly&#160;loaded document&#160;uses&#160;the&#160;existing&#160;frame.&#160;The&#160;code&#160;in<a href="libremacros.html#279">&#160;Listing 260&#160;de</a>monstrates&#160;the&#160;special&#160;<br/>
276<br/>
<hr/>
<a name=280></a>frame&#160;name&#160;“_blank”&#160;—&#160;the&#160;special&#160;frame&#160;names&#160;are&#160;discussed shortly.&#160;Frame&#160;names&#160;that&#160;are&#160;not&#160;“special,”&#160;<br/>specify&#160;the&#160;name&#160;of an existing frame&#160;or a&#160;new&#160;frame.&#160;If&#160;you specify&#160;a&#160;frame&#160;name, you must&#160;tell&#160;OOo how&#160;<br/>to find&#160;the&#160;frame.&#160;The&#160;values&#160;in<a href="libremacros.html#273">&#160;Table&#160;95&#160;e</a>numerate&#160;valid&#160;values&#160;for the&#160;frame&#160;search flags. It&#160;used to be&#160;<br/>possible&#160;to&#160;specify&#160;the&#160;name&#160;of the&#160;frame&#160;that&#160;will&#160;contain&#160;a&#160;document&#160;(but&#160;this&#160;has&#160;not&#160;worked since&#160;OOo&#160;<br/>1.1.0). Here&#160;are&#160;a&#160;few&#160;items&#160;to&#160;note:<br/>
1.&#160;When&#160;a&#160;document&#160;is&#160;loaded, the&#160;frame&#160;name&#160;becomes&#160;something like&#160;“Untitled 1 – OpenOffice.org&#160;<br/>
Writer”&#160;rather than&#160;the&#160;specified name.&#160;<br/>
2.&#160;If&#160;you&#160;specify&#160;the&#160;frame&#160;name, the&#160;document&#160;will&#160;fail&#160;to&#160;load if a&#160;frame&#160;with&#160;that&#160;name&#160;does&#160;not&#160;<br/>
exist.&#160;If&#160;the&#160;frame&#160;does&#160;exist,&#160;it&#160;will&#160;load&#160;it&#160;into a&#160;new&#160;frame.<br/>
If&#160;you&#160;experiment&#160;with&#160;this,&#160;be&#160;certain&#160;to save&#160;your documents&#160;before&#160;running the&#160;macro, at&#160;least&#160;one&#160;<br/>experiment&#160;caused the&#160;new&#160;document&#160;to&#160;load into&#160;the&#160;current&#160;frame.<br/>
<i><b>Listing&#160;261.</b>&#160;Open a document&#160;into&#160;an existing&#160;frame.<br/></i>Sub&#160;UseAnExistingFrame<br/>&#160;&#160;Dim&#160;noArgs()&#160; &#160; &#160; &#160; &#160;'An empty array for the arguments<br/>&#160;&#160;Dim&#160;vDoc&#160; &#160; &#160; &#160; &#160; &#160; &#160;'The loaded component<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160; &#160;'URL of the document to load<br/>&#160;&#160;Dim&#160;nSearch&#160;As&#160;Long&#160;&#160;'Search flags<br/>&#160;&#160;Dim&#160;sFName&#160;As&#160;String&#160;'Frame Name<br/>&#160;&#160;Dim&#160;vFrame&#160; &#160; &#160; &#160; &#160; &#160;'Document Frame<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160;&#160;'Display string<br/>&#160; &#160;&#160;<br/>&#160;&#160;REM Search globally for this<br/>&#160;&#160;nSearch&#160;=&#160;com.sun.star.frame.FrameSearchFlag.GLOBAL&#160;+&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;com.sun.star.frame.FrameSearchFlag.CREATE<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;<br/>&#160;&#160;REM I can even open a real file for this, but I don't know what files<br/>&#160;&#160;REM you have on your computer so I create a new Writer document instead<br/>&#160;&#160;sURL&#160;=&#160;&#34;file:///andrew0/home/andy/doc1.odt&#34;<br/>&#160;&#160;sURL&#160;=&#160;&#34;private:factory/swriter&#34;<br/>&#160;&#160;<br/>&#160;&#160;REM Create a frame with the name MyFrame rather than _default<br/>&#160;&#160;sFName&#160;=&#160;&#34;MyFrame&#34;<br/>&#160;&#160;vFrame&#160;=&#160;ThisComponent.CurrentController.Frame<br/>&#160;&#160;vDoc&#160;=&#160;vFrame.LoadComponentFromUrl(sURL,&#160;sFName,&#160;nSearch,&#160;noArgs())<br/>&#160;&#160;If&#160;IsNull(vDoc)&#160;Then&#160;<br/>&#160; &#160;&#160;Print&#160;&#34;Failed to create a document&#34;<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;REM The name of the frame is MyFrame. Note that the name has nothing<br/>&#160;&#160;REM to do with the title!<br/>&#160;&#160;sFName&#160;=&#160;vDoc.CurrentController.Frame.Name<br/>&#160;&#160;s&#160;=&#160;&#34;Created document to frame &#34;&#160;&amp;&#160;sFName&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s<br/>&#160;&#160;<br/>&#160;&#160;REM This time, do not allow creation; only allow an existing frame<br/>&#160;&#160;nSearch&#160;=&#160;com.sun.star.frame.FrameSearchFlag.Global<br/>&#160;&#160;sURL&#160;=&#160;&#34;file:///andrew0/home/andy/doc2.odt&#34;<br/>&#160;&#160;sURL&#160;=&#160;&#34;private:factory/scalc&#34;<br/>&#160;&#160;'sFName = &#34;doc1 – OpenOffice.org Writer&#34;<br/>
277<br/>
<hr/>
<a name=281></a>&#160;&#160;vDoc&#160;=&#160;vFrame.LoadComponentFromUrl(sURL,&#160;sFName,&#160;nSearch,&#160;noArgs())<br/>&#160;&#160;If&#160;IsNull(vDoc)&#160;Then&#160;<br/>&#160; &#160;&#160;Print&#160;&#34;Failed to create a document&#34;<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Created document to frame &#34;&#160;&amp;&#160;sFName<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
OOo uses&#160;special&#160;frame&#160;names&#160;to specify&#160;special&#160;behavior&#160;(see<a href="libremacros.html#281">&#160;Table&#160;97)</a>. Use&#160;these&#160;special&#160;frame&#160;names&#160;to&#160;<br/>cause&#160;the&#160;specified behavior.<br/>
<i><b>Table&#160;97.</b>&#160;Special&#160;frame&#160;names.</i><br/>
<i><b>Frame&#160;Name</b></i><br/>
<i><b>Description</b></i><br/>
&#34;_blank&#34;&#160;<br/>
Creates a&#160;new&#160;frame.<br/>
&#34;_default&#34;&#160;<br/>
Detects an already&#160;loaded&#160;document&#160;or&#160;creates a&#160;new&#160;frame&#160;if&#160;it&#160;is&#160;not&#160;found.<br/>
&#34;_self&#34;<br/>
Use&#160;or&#160;return this&#160;frame.<br/>
&#34;&#34;<br/>
Use&#160;or&#160;return this&#160;frame.<br/>
&#34;_parent&#34;&#160;<br/>
Use&#160;or&#160;return the&#160;direct&#160;parent&#160;of&#160;this&#160;frame.<br/>
&#34;_top&#34;&#160;<br/>
Use&#160;or&#160;return the&#160;highest&#160;level&#160;parent&#160;frame.<br/>
&#34;_beamer&#34;&#160;<br/>
Use&#160;or&#160;return a&#160;special&#160;subframe.<br/>
Although you cannot&#160;currently&#160;cause&#160;OOo to&#160;find a&#160;frame&#160;and use&#160;it,&#160;you&#160;can search for the&#160;frame&#160;with the&#160;<br/>desired name&#160;and then&#160;use&#160;that&#160;frame&#160;to load&#160;a&#160;document&#160;into&#160;that&#160;frame;&#160;by&#160;using the&#160;frame&#160;name&#160;“_self”.<br/>
<i><b>Listing&#160;262.</b>&#160;ReuseAFrame&#160;</i><br/>
Sub&#160;UseFrameSelf<br/>&#160;&#160;Dim&#160;noArgs()&#160; &#160; &#160; &#160; &#160;'An empty array for the arguments<br/>&#160;&#160;Dim&#160;vDoc&#160; &#160; &#160; &#160; &#160; &#160; &#160;'The loaded component<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160; &#160;'URL of the document to load<br/>&#160;&#160;Dim&#160;nSearch&#160;As&#160;Long&#160;&#160;'Search flags<br/>&#160;&#160;Dim&#160;sFName&#160;As&#160;String&#160;'Frame Name<br/>&#160;&#160;Dim&#160;vFrame&#160; &#160; &#160; &#160; &#160; &#160;'Document Frame<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160;&#160;'Display string<br/>&#160; &#160;&#160;<br/>&#160;&#160;REM Search globally for this<br/>&#160;&#160;nSearch&#160;=&#160;com.sun.star.frame.FrameSearchFlag.GLOBAL&#160;+&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;com.sun.star.frame.FrameSearchFlag.CREATE<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;<br/>&#160;&#160;REM I can even open a real file for this, but I don't know what files<br/>&#160;&#160;REM you have on your computer so I create a new Writer document instead<br/>&#160;&#160;sURL&#160;=&#160;&#34;file:///andrew0/home/andy/doc1.odt&#34;<br/>&#160;&#160;sURL&#160;=&#160;&#34;private:factory/swriter&#34;<br/>&#160;&#160;<br/>&#160;&#160;REM Create a frame with the name MyFrame rather than _default<br/>&#160;&#160;sFName&#160;=&#160;&#34;MyFrame&#34;<br/>&#160;&#160;vFrame&#160;=&#160;ThisComponent.CurrentController.Frame<br/>&#160;&#160;vDoc&#160;=&#160;vFrame.LoadComponentFromUrl(sURL,&#160;sFName,&#160;nSearch,&#160;noArgs())<br/>&#160;&#160;If&#160;IsNull(vDoc)&#160;Then&#160;<br/>&#160; &#160;&#160;Print&#160;&#34;Failed to create a document&#34;<br/>
278<br/>
<hr/>
<a name=282></a>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;REM The name of the frame is MyFrame. Note that the name has nothing<br/>&#160;&#160;REM to do with the title!<br/>&#160;&#160;sFName&#160;=&#160;vDoc.CurrentController.Frame.Name<br/>&#160;&#160;s&#160;=&#160;&#34;Created document to frame &#34;&#160;&amp;&#160;sFName&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s<br/>&#160;&#160;<br/>&#160;&#160;REM This time, do not allow creation; only allow an existing frame<br/>&#160;&#160;sURL&#160;=&#160;&#34;file:///andrew0/home/andy/doc2.odt&#34;<br/>&#160;&#160;sURL&#160;=&#160;&#34;private:factory/scalc&#34;<br/>&#160;&#160;sFName&#160;=&#160;&#34;_self&#34;<br/>&#160;&#160;' Get a document's frame from the document's current controller.<br/>&#160;&#160;vDoc&#160;=&#160;vDoc.CurrentController.Frame.LoadComponentFromUrl(sURL,&#160;sFName,&#160;nSearch,&#160;noArgs())<br/>&#160;&#160;If&#160;IsNull(vDoc)&#160;Then&#160;<br/>&#160; &#160;&#160;Print&#160;&#34;Failed to create a document&#34;<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Created document to frame &#34;&#160;&amp;&#160;sFName<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<b>&#160;12.4.1.&#160;Named&#160;arguments<br/></b>The&#160;final&#160;argument&#160;to&#160;the&#160;LoadComponentFromUrl() method is&#160;an array&#160;of structures&#160;of type&#160;<br/>com.sun.star.beans.PropertyValue. Each property&#160;value&#160;consists&#160;of a&#160;name&#160;and a&#160;value.&#160;The&#160;properties&#160;are&#160;<br/>used to&#160;pass&#160;named&#160;arguments&#160;that&#160;direct&#160;OOo when it&#160;loads&#160;the&#160;document<a href="libremacros.html#282">.&#160;Table&#160;98<b>&#160;</b></a>contains&#160;a&#160;brief&#160;<br/>description&#160;of the&#160;supported named&#160;arguments.<br/>
<b>TIP</b><br/>
<a href="libremacros.html#282">Table&#160;98&#160;c</a>ontains&#160;only&#160;named&#160;arguments&#160;that&#160;are&#160;not&#160;deprecated.&#160;The&#160;API&#160;Web&#160;site&#160;on the&#160;<br/>com.sun.star.document.MediaDescriptor&#160;service&#160;contains&#160;a&#160;complete&#160;list&#160;of&#160;named&#160;arguments, deprecated&#160;<br/>
and&#160;otherwise.&#160;Some&#160;properties are&#160;not&#160;shown,&#160;such as&#160;Aborted,&#160;because&#160;they&#160;are&#160;set&#160;while&#160;loading;&#160;for&#160;<br/>example,&#160;Aborted,&#160;which is&#160;set&#160;if&#160;an incorrect&#160;password&#160;is&#160;used.<br/>
<i><b>Table&#160;98.&#160;</b>Valid named arguments&#160;for&#160;loading&#160;and storing documents.</i><br/>
<i><b>Argument</b></i><br/>
<i><b>Description</b></i><br/>
AsTemplate&#160;<br/>
A&#160;value&#160;of&#160;True&#160;creates a&#160;new&#160;untitled&#160;document,&#160;even if&#160;the&#160;document&#160;is&#160;not&#160;a&#160;<br/>
template.&#160;<br/>The&#160;default&#160;loads the&#160;template&#160;document&#160;for&#160;editing.<br/>
Author&#160;<br/>
Sets the&#160;current&#160;author&#160;if&#160;the&#160;component&#160;can track the&#160;author&#160;of&#160;the&#160;current&#160;<br/>version when the&#160;document&#160;is saved.<br/>
CharacterSet&#160;<br/>
Identifies the&#160;character&#160;set&#160;for&#160;single-byte&#160;characters.<br/>
Comment&#160;<br/>
Similar&#160;to the&#160;Author&#160;argument,&#160;but&#160;sets the&#160;document&#160;description for&#160;version&#160;<br/>
control.<br/>
ComponentData&#160;<br/>
Allows component-specific&#160;properties.<br/>
DocumentTitle&#160;<br/>
Sets the&#160;Document&#160;title.<br/>
FilterData&#160;<br/>
Additional&#160;properties for&#160;a&#160;filter&#160;if&#160;it&#160;is required.<br/>
FilterName&#160;<br/>
Name&#160;of&#160;the&#160;filter&#160;for&#160;loading&#160;or&#160;storing&#160;the&#160;component&#160;when&#160;not&#160;using&#160;OOo&#160;<br/>types.<br/>
279<br/>
<hr/>
<a name=283></a><i><b>Argument</b></i><br/>
<i><b>Description</b></i><br/>
FilterOptions&#160;<br/>
Additional&#160;properties for&#160;a&#160;filter&#160;if&#160;it&#160;is required.&#160;These&#160;values must&#160;be&#160;strings and<br/>
must&#160;be&#160;supported by&#160;the&#160;filter.&#160;Use&#160;FilterData&#160;for&#160;non-string&#160;options.<br/>
Frame<br/>
Specify&#160;the&#160;frame&#160;containing&#160;the&#160;document.<br/>
Hidden&#160;<br/>
A&#160;value&#160;of&#160;False&#160;loads&#160;the&#160;document&#160;so that&#160;it&#160;is hidden.&#160;Do not&#160;do&#160;this&#160;if&#160;you&#160;<br/>intend to&#160;<br/>
make&#160;the&#160;document&#160;visible&#160;after&#160;it&#160;is&#160;loaded.<br/>
HierarchicalDocument<br/>
The&#160;hierarchical&#160;path to the&#160;embedded&#160;document&#160;from&#160;topmost&#160;container;&#160;for&#160;<br/>
Name<br/>
example,&#160;Base&#160;forms are&#160;stored in&#160;the&#160;Base&#160;document.<br/>
InputStream&#160;<br/>
You can&#160;specify&#160;an existing&#160;input&#160;stream&#160;for&#160;loading&#160;a&#160;document&#160;—&#160;for&#160;example,&#160;<br/>
if&#160;you have&#160;the&#160;document&#160;in&#160;memory&#160;and don’t&#160;want&#160;to write&#160;it&#160;to disk first.&#160;<br/>
InteractionHandler&#160;<br/>
Passes an&#160;interaction handler&#160;to handle&#160;errors&#160;and&#160;obtains a&#160;password if&#160;required.<br/>
JumpMark&#160;<br/>
Jumps&#160;to a&#160;marked position after&#160;loading&#160;the&#160;component.&#160;A&#160;similar&#160;thing&#160;can be&#160;<br/>accomplished&#160;by&#160;appending&#160;a&#160;'#'&#160;and&#160;the&#160;jump mark name&#160;in the&#160;URL&#160;used to&#160;<br/>
open the&#160;document;&#160;the&#160;syntax&#160;with a&#160;'#'&#160;is not&#160;specified in&#160;most&#160;URL&#160;schemas.&#160;<br/>
MacroExecutionMode&#160;<br/>
The&#160;numeric&#160;value&#160;specifies if&#160;macros are&#160;executed&#160;when&#160;the&#160;document&#160;is&#160;loaded&#160;<br/>
(see<a href="libremacros.html#285">&#160;Table&#160;99)</a>.<br/>
MediaType&#160;<br/>
Specifies the&#160;MIME type&#160;of&#160;the&#160;data&#160;that&#160;will&#160;be&#160;loaded.&#160;<br/>
OpenNewView&#160;<br/>
A&#160;value&#160;of&#160;True&#160;forces&#160;the&#160;component&#160;to create&#160;a&#160;new&#160;window&#160;even if&#160;the&#160;<br/>document&#160;is already&#160;loaded.&#160;Some&#160;components support&#160;multiple&#160;views&#160;for&#160;the&#160;<br/>
same&#160;data. If&#160;the&#160;opened component&#160;does not&#160;support&#160;multiple&#160;views, a&#160;new&#160;<br/>window&#160;is&#160;opened.&#160;It&#160;is&#160;not&#160;a&#160;view,&#160;but&#160;merely&#160;the&#160;document&#160;loaded one&#160;more&#160;<br/>
time.<br/>
OutputStream&#160;<br/>
If&#160;used&#160;when&#160;storing&#160;a&#160;document&#160;(not&#160;for&#160;reading), the&#160;stream&#160;must&#160;be&#160;used to&#160;<br/>
write&#160;the&#160;data.&#160;If&#160;a&#160;stream&#160;is not&#160;provided, the&#160;loader&#160;will&#160;create&#160;a&#160;stream&#160;by&#160;itself<br/>using&#160;the&#160;other&#160;properties.<br/>
Overwrite&#160;<br/>
A&#160;value&#160;of&#160;True&#160;overwrites any&#160;existing&#160;file&#160;with&#160;the&#160;same&#160;name&#160;while&#160;saving.<br/>
Password&#160;<br/>
Password&#160;for&#160;loading&#160;or&#160;storing&#160;a&#160;document. If&#160;a&#160;document&#160;that&#160;requires a&#160;<br/>
password&#160;is&#160;loaded&#160;and no password&#160;is specified, the&#160;document&#160;is&#160;not&#160;loaded.<br/>
PostData&#160;<br/>
Posts&#160;data&#160;to an&#160;HTTP&#160;address and&#160;then loads&#160;the&#160;response&#160;as a&#160;document.&#160;<br/>
PostData&#160;is usually&#160;used&#160;to obtain a&#160;result&#160;from&#160;a&#160;Web form&#160;on a&#160;Web&#160;site.<br/>
Preview&#160;<br/>
A&#160;value&#160;of&#160;True&#160;specifies that&#160;the&#160;document&#160;is loaded&#160;for&#160;preview.&#160;OOo may&#160;<br/>
make&#160;some&#160;optimizations when it&#160;opens a&#160;document&#160;in&#160;preview&#160;mode.<br/>
ReadOnly&#160;<br/>
Opens the&#160;document&#160;as&#160;read-only.&#160;Read-only&#160;documents are&#160;not&#160;modifiable&#160;from&#160;<br/>
the&#160;user&#160;interface,&#160;but&#160;you can modify&#160;them&#160;by&#160;using&#160;the&#160;OOo&#160;API&#160;(in&#160;other&#160;<br/>words, from&#160;a&#160;macro).<br/>
Referer&#160;<br/>
A&#160;URL&#160;indicating&#160;the&#160;referrer&#160;who opened this&#160;document.&#160;Without&#160;a&#160;referrer,&#160;a&#160;<br/>document&#160;that&#160;requires security&#160;checks is&#160;denied.&#160;(Yes, the&#160;argument&#160;name&#160;is&#160;<br/>
“Referer,”&#160;not&#160;“Referrer.”)<br/>
RepairPackage&#160;<br/>
OOo&#160;documents&#160;are&#160;stored in&#160;a&#160;compressed zipped format.&#160;A&#160;value&#160;of&#160;True&#160;<br/>
attempts to&#160;recover&#160;information from&#160;a&#160;damaged&#160;ZIP&#160;file.<br/>
StartPresentation&#160;<br/>
If&#160;the&#160;document&#160;contains&#160;a&#160;presentation,&#160;it&#160;is&#160;started&#160;immediately.<br/>
StatusIndicator&#160;<br/>
Value&#160;is&#160;an object&#160;to use&#160;as&#160;a&#160;progress indicator&#160;as the&#160;document&#160;is&#160;loaded&#160;or&#160;<br/>saved.<br/>
SuggestedSaveAsDir<br/>
Specify&#160;the&#160;URL&#160;that&#160;is used next&#160;time&#160;SaveAs dialog is opened.<br/>
SuggestedSaveAsName<br/>
Specify&#160;the&#160;suggested&#160;file&#160;name&#160;that&#160;is used next&#160;time&#160;SaveAs dialog is opened.<br/>
TemplateName&#160;<br/>
Name&#160;of&#160;the&#160;template&#160;instead&#160;of&#160;the&#160;URL. Must&#160;also&#160;use&#160;the&#160;<br/>
280<br/>
<hr/>
<a name=284></a><i><b>Argument</b></i><br/>
<i><b>Description</b></i><br/>
TemplateRegionName.<br/>
TemplateRegionName&#160;<br/>
Path to the&#160;template&#160;instead&#160;of&#160;the&#160;URL.&#160;Must&#160;also use&#160;the&#160;TemplateName.&#160;<br/>
Unpacked&#160;<br/>
OOo&#160;stores documents&#160;in&#160;a&#160;zipped&#160;format.&#160;A&#160;value&#160;of&#160;True&#160;stores the&#160;file&#160;in&#160;a&#160;<br/>
folder&#160;if&#160;it&#160;is supported&#160;for&#160;the&#160;component&#160;type.<br/>
UpdateDocMode&#160;<br/>
The&#160;numeric&#160;value&#160;specifies how&#160;the&#160;document&#160;is&#160;updated. See&#160;the&#160;API&#160;site&#160;for&#160;<br/>
the&#160;constant&#160;com.sun.star.document.UpdateDocMode.<br/>
URL&#160;<br/>
Fully&#160;qualified URL&#160;of&#160;the&#160;document&#160;to&#160;load,&#160;including&#160;the&#160;JumpDescriptor&#160;if&#160;<br/>
required.<br/>
Version&#160;<br/>
If&#160;versioning&#160;is&#160;supported&#160;for&#160;the&#160;component,&#160;this&#160;argument&#160;indicates the&#160;version&#160;<br/>
to load or&#160;save.&#160;The&#160;main&#160;document&#160;is loaded&#160;or&#160;saved&#160;if&#160;no version is specified.<br/>
ViewControllerName<br/>
While&#160;loading&#160;a&#160;document&#160;into a&#160;frame, this&#160;specifies&#160;the&#160;name&#160;of&#160;the&#160;view&#160;<br/>
controller&#160;to create.&#160;That&#160;is, the&#160;property&#160;is&#160;passed to the&#160;document's&#160;<br/>createViewController&#160;method.&#160;If&#160;the&#160;loaded document&#160;does&#160;not&#160;support&#160;the&#160;<br/>
XModel2 interface,&#160;the&#160;property&#160;is ignored.<br/>
ViewData&#160;<br/>
The&#160;value&#160;for&#160;this argument&#160;is&#160;component&#160;specific&#160;and&#160;usually&#160;supplied by&#160;the&#160;<br/>
frame&#160;controller.<br/>
ViewId&#160;<br/>
Some&#160;components support&#160;different&#160;views&#160;of&#160;the&#160;same&#160;data.&#160;The&#160;value&#160;specifies&#160;<br/>
the&#160;view&#160;to use&#160;after&#160;loading.&#160;The&#160;default&#160;is zero&#160;and is&#160;treated&#160;as the&#160;default&#160;<br/>view.<br/>
<b>&#160;12.4.2.&#160;Loading&#160;a&#160;template<br/></b>While&#160;loading a&#160;document&#160;using&#160;LoadComponentFromUrl(), the&#160;OOo&#160;API&#160;treats&#160;all&#160;documents&#160;the&#160;same.&#160;<br/>You can open an OOo template&#160;for editing (changing a&#160;template&#160;and then&#160;saving it&#160;as&#160;a&#160;new&#160;template) or you<br/>can use&#160;a&#160;template&#160;as&#160;the&#160;starting&#160;point&#160;for a&#160;new&#160;document.&#160;The&#160;named argument&#160;AsTemplate&#160;directs&#160;OOo&#160;<br/>to open the&#160;specified&#160;document&#160;as&#160;a&#160;template&#160;rather than opening a&#160;document&#160;for editing.&#160;The&#160;macro i<a href="libremacros.html#284">n<br/>Listing 263<b>&#160;</b></a>opens&#160;a&#160;document&#160;as&#160;a&#160;template.<br/>
<i><b>Listing&#160;263.</b>&#160;Load a document&#160;as&#160;a template.<br/></i>Sub&#160;UseTemplate<br/>&#160;&#160;REM This is an array from 0 To 0 of type PropertyValue<br/>&#160;&#160;Dim&#160;args(0)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160;&#160;'URL of the document to load<br/>
&#160;&#160;sURL&#160;=&#160;&#34;file:///home/andy/doc1.ott&#34;<br/>&#160;&#160;args(0).Name&#160;&#160;=&#160;&#34;AsTemplate&#34;<br/>&#160;&#160;args(0).Value&#160;=&#160;True<br/>&#160;&#160;StarDesktop.LoadComponentFromUrl(sURL,&#160;&#34;_blank&#34;,&#160;0,&#160;args())<br/>End&#160;Sub<br/>
The&#160;method&#160;LoadComponentFromUrl() assumes&#160;that&#160;a&#160;URL&#160;is&#160;used to&#160;specify&#160;the&#160;document&#160;location;&#160;this&#160;is<br/>not&#160;operating-system&#160;specific.&#160;Although I&#160;ran the&#160;macro in<a href="libremacros.html#284">&#160;Listing 263&#160;on m</a>y&#160;Linux computer,&#160;it&#160;will&#160;work&#160;<br/>on a&#160;Windows&#160;computer as&#160;well.&#160;On a&#160;Windows&#160;computer,&#160;the&#160;URL&#160;usually&#160;includes&#160;the&#160;drive&#160;letter.<br/>
sURL&#160;=&#160;&#34;file://c:/home/andy/doc1.ott&#34;&#160;<br/>
<b>TIP</b><br/>
Use&#160;the&#160;functions ConvertFromURL&#160;and&#160;ConvertToURL&#160;to convert&#160;between the&#160;operating-system-specific&#160;<br/>notation and&#160;URL&#160;notation.<br/>
281<br/>
<hr/>
<a name=285></a><b>&#160;12.4.3.&#160;Enabling&#160;macros&#160;while&#160;loading&#160;a&#160;document<br/></b>When&#160;a&#160;document&#160;that&#160;contains&#160;a&#160;macro is&#160;opened from&#160;the&#160;user interface&#160;(UI),&#160;a&#160;security&#160;dialog&#160;opens,&#160;<br/>asking if macros&#160;should&#160;be&#160;run.&#160;When&#160;a&#160;document&#160;is&#160;loaded from&#160;a&#160;macro using the&#160;OOo&#160;API,&#160;macros&#160;are&#160;<br/>disabled in&#160;the&#160;document. Some&#160;macros&#160;run based on events&#160;that&#160;occur in a&#160;document.&#160;If&#160;macros&#160;are&#160;<br/>disabled in&#160;the&#160;document, you can still&#160;manually&#160;run the&#160;contained&#160;macros, but&#160;the&#160;macros&#160;that&#160;are&#160;usually&#160;<br/>started from&#160;an event&#160;in the&#160;document&#160;will&#160;never run.<br/>
The&#160;named argument&#160;MacroExecutionMode&#160;directs&#160;OOo how&#160;to&#160;treat&#160;macros&#160;when a&#160;document&#160;is&#160;loade<a href="libremacros.html#285">d.<br/>Table&#160;99<b>&#160;</b></a>enumerates&#160;the&#160;valid&#160;values&#160;for the&#160;MacroExecutionMode&#160;argument.<br/>
<i><b>Table&#160;99.</b>&#160;com.sun.star.document.MacroExecutionMode&#160;constants.</i><br/>
<i><b>#</b></i><br/>
<i><b>Name</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
NEVER_EXECUTE&#160;<br/>
A&#160;macro&#160;should not&#160;be&#160;executed&#160;at&#160;all.&#160;&#160;<br/>
1<br/>
FROM_LIST&#160;<br/>
Execute&#160;macros from&#160;secure&#160;list&#160;quietly.&#160;&#160;<br/>
2<br/>
ALWAYS_EXECUTE&#160;<br/>
Execute&#160;any&#160;macro, macros signed&#160;with trusted certificates and&#160;<br/>
macros from&#160;secure&#160;list&#160;are&#160;executed quietly.&#160;&#160;<br/>
3<br/>
USE_CONFIG&#160;<br/>
Use&#160;configuration&#160;to retrieve&#160;macro settings. In&#160;case&#160;a&#160;user&#160;<br/>
confirmation is required&#160;a&#160;dialog&#160;is&#160;output. &#160;<br/>
4<br/>
ALWAYS_EXECUTE_NO_WARN&#160;<br/>
Macros are&#160;always&#160;executed&#160;without&#160;confirmation.<br/>
5<br/>
USE_CONFIG_REJECT_CONFIRMATION&#160;<br/>
Use&#160;configuration&#160;to retrieve&#160;macro settings.&#160;Treat&#160;cases when&#160;user<br/>confirmation required&#160;as&#160;rejected.&#160;&#160;<br/>
6<br/>
USE_CONFIG_APPROVE_CONFIRMATION&#160;<br/>
Use&#160;configuration&#160;to retrieve&#160;macro settings.&#160;Treat&#160;cases when&#160;user<br/>confirmation required&#160;as&#160;approved. &#160;<br/>
7<br/>
FROM_LIST_NO_WARN&#160;<br/>
Execute&#160;only&#160;macros from&#160;secure&#160;list.&#160;Macros that&#160;are&#160;not&#160;from&#160;the<br/>list&#160;are&#160;not&#160;executed.&#160;&#160;<br/>
8<br/>
FROM_LIST_AND_SIGNED_WARN&#160;<br/>
Execute&#160;only&#160;macros from&#160;secure&#160;list&#160;or&#160;macros&#160;that&#160;are&#160;signed&#160;by&#160;<br/>trusted&#160;certificates.&#160;&#160;<br/>
9<br/>
FROM_LIST_AND_SIGNED_NO_WARN&#160;<br/>
Execute&#160;only&#160;macros from&#160;secure&#160;list&#160;or&#160;macros&#160;that&#160;are&#160;signed&#160;by&#160;<br/>trusted&#160;certificates.&#160;No warning/conformation should&#160;be&#160;shown.<br/>
The&#160;macro i<a href="libremacros.html#285">n&#160;Listing&#160;264&#160;l</a>oads&#160;a&#160;document&#160;as&#160;a&#160;template&#160;and allows&#160;macros&#160;to run when the&#160;document&#160;is&#160;<br/>loaded.&#160;This&#160;macro also demonstrates&#160;that&#160;multiple&#160;named&#160;arguments&#160;can be&#160;used simultaneously.<br/>
<i><b>Listing&#160;264.</b>&#160;Load a document&#160;as&#160;a template&#160;and enable&#160;contained macros.<br/></i>Sub&#160;UseTemplateRunMacro<br/>&#160;&#160;REM This is an array from 0 To 1 of type PropertyValue<br/>&#160;&#160;Dim&#160;args(1)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160;&#160;'URL of the document to load<br/>
&#160; &#160;Print&#160;com.sun.star.document.MacroExecMode.USE_CONFIG<br/>&#160;&#160;sURL&#160;=&#160;&#34;file:///home/andy/doc1.odt&#34;<br/>&#160;&#160;args(0).Name&#160;&#160;=&#160;&#34;AsTemplate&#34;<br/>&#160;&#160;args(0).Value&#160;=&#160;True<br/>&#160;&#160;args(1).Name&#160;&#160;=&#160;&#34;MacroExecutionMode&#34;<br/>&#160;&#160;args(1).Value&#160;=&#160;com.sun.star.document.MacroExecMode.ALWAYS_EXECUTE_NO_WARN<br/>&#160;&#160;StarDesktop.LoadComponentFromUrl(sURL,&#160;&#34;_blank&#34;,&#160;0,&#160;args())<br/>End&#160;Sub<br/>
282<br/>
<hr/>
<a name=286></a><b>&#160;12.4.4.&#160;Importing&#160;and&#160;exporting<br/></b>OpenOffice.org&#160;has&#160;a&#160;type-detection mechanism&#160;to&#160;determine&#160;a&#160;document’s&#160;type&#160;when it&#160;is&#160;loaded.&#160;This&#160;<br/>mechanism&#160;has&#160;been reliable&#160;for the&#160;limited number of document&#160;types&#160;that&#160;I&#160;deal&#160;with daily.&#160;Sometimes,&#160;<br/>however,&#160;you&#160;must&#160;specify&#160;the&#160;filter name&#160;when importing&#160;a&#160;document.&#160;To&#160;export&#160;a&#160;document,&#160;you&#160;must&#160;<br/>always&#160;specify&#160;the&#160;export&#160;filter type.&#160;The&#160;code&#160;in<a href="libremacros.html#286">&#160;Listing 265&#160;ope</a>ns&#160;a&#160;Microsoft&#160;Word&#160;document. In&#160;my&#160;<br/>testing the&#160;documents&#160;opened correctly&#160;even when I&#160;did not&#160;specify&#160;the&#160;filter name.<br/>
<i><b>Listing&#160;265.</b>&#160;Specify&#160;the&#160;filter&#160;name&#160;while&#160;loading&#160;a document.<br/></i>Sub&#160;LoadDocFile<br/>&#160;&#160;Dim&#160;noArgs(0)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String<br/>&#160;&#160;noArgs(0).Name&#160;=&#160;&#34;FilterName&#34;<br/>&#160;&#160;noArgs(0).Value&#160;=&#160;&#34;Microsoft Word 97/2000/XP&#34;<br/>&#160;&#160;sURL&#160;=&#160;&#34;file:///home/andy/one.doc&#34;<br/>&#160;&#160;StarDesktop.LoadComponentFromUrl(sURL,&#160;&#34;_blank&#34;,&#160;0,&#160;noArgs())<br/>End&#160;Sub<br/>
<b>&#160;12.4.5.&#160;Filter&#160;names<br/></b>New&#160;filters&#160;are&#160;frequently&#160;added to&#160;OOo, so it&#160;seems&#160;silly&#160;to&#160;list&#160;the&#160;supported&#160;filters, when a&#160;macro can&#160;<br/>retrieve&#160;the&#160;latest&#160;list.&#160;The&#160;following macro creates&#160;a&#160;new&#160;Calc&#160;document&#160;and then&#160;displays&#160;the&#160;list&#160;of&#160;<br/>supported&#160;filters.&#160;A&#160;recorded macro is&#160;used to format&#160;the&#160;data.<br/>
The&#160;UIName&#160;is&#160;the&#160;general&#160;name;&#160;or localized&#160;name.&#160;The&#160;Name&#160;column contains&#160;the&#160;internal&#160;name&#160;to use&#160;<br/>when specifying&#160;a&#160;filter name&#160;for import&#160;or export.&#160;The&#160;Import&#160;and Export&#160;columns&#160;identify&#160;if the&#160;filter can&#160;<br/>be&#160;used for import&#160;or export.&#160;The&#160;Options&#160;column, indicates&#160;if options&#160;can be&#160;passed to the&#160;filter.&#160;These&#160;<br/>options&#160;direct&#160;the&#160;filter.&#160;<br/>
The&#160;filter names&#160;are&#160;also stored in the&#160;file&#160;TypeDetection.xcu stored in&#160;the&#160;OOo configuration folders.<br/>
<i><b>Listing&#160;266.</b>&#160;List&#160;supported filters&#160;in a Calc&#160;Sheet.</i><br/>
sub&#160;FiltersToCalc<br/>&#160;&#160;Dim&#160;oFF&#160; &#160; &#160; &#160; &#160; &#160;' FilterFactory service<br/>&#160;&#160;Dim&#160;oFilterNames&#160;&#160;' Array of filter names.<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;&#160;' Document created to hold the filter names.<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;' Sheet that will hold the filter information.<br/>&#160;&#160;Dim&#160;oCell&#160; &#160; &#160; &#160; &#160;' Cell to update<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160; &#160;&#160;' Index Variable.<br/>&#160;&#160;Dim&#160;fProps()&#160; &#160; &#160;&#160;' Properties for each filter.<br/>&#160;&#160;Dim&#160;fp%&#160; &#160; &#160; &#160; &#160; &#160;' Filter property index<br/>&#160;&#160;Dim&#160;fpCol%&#160; &#160; &#160; &#160;&#160;' Column for the specified filter data.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160;&#160;' Work string that holds some property values.<br/>&#160;&#160;Dim&#160;iUserData%&#160; &#160;&#160;' For enumerating array property values.<br/>&#160;&#160;Dim&#160;oProp&#160; &#160; &#160; &#160; &#160;' A single property.<br/>&#160;&#160;Dim&#160;oArrayData&#160; &#160;&#160;' Array of user properties.<br/>&#160;&#160;Dim&#160;sPropNames(7)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;flags&#160;As&#160;Long<br/>&#160;&#160;sPropNames(0)&#160;=&#160;&#34;Name&#34;<br/>&#160;&#160;sPropNames(1)&#160;=&#160;&#34;Import&#34;<br/>&#160;&#160;sPropNames(2)&#160;=&#160;&#34;Export&#34;<br/>&#160;&#160;sPropNames(3)&#160;=&#160;&#34;Options&#34;<br/>&#160;&#160;sPropNames(4)&#160;=&#160;&#34;Visible&#34;<br/>&#160;&#160;sPropNames(5)&#160;=&#160;&#34;Flags&#34;<br/>
283<br/>
<hr/>
<a name=287></a>&#160;&#160;sPropNames(6)&#160;=&#160;&#34;DocumentService&#34;<br/>&#160;&#160;sPropNames(7)&#160;=&#160;&#34;UIName&#34;<br/>
&#160;&#160;oFF&#160;=&#160;createUnoService(&#160;&#34;com.sun.star.document.FilterFactory&#34;&#160;)<br/>&#160;&#160;oFilterNames&#160;=&#160;oFF.getElementNames()<br/>&#160; &#160;<br/>&#160;&#160;' Create a Calc doc and save the filter names to it.<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#160;&#34;private:factory/scalc&#34;,&#160;&#34;_blank&#34;,&#160;0,&#160;Array()&#160;)<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.getSheets().getByIndex(0)<br/>&#160; &#160;<br/>&#160;&#160;' Print the filter names into a document.<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(&#160;oFilterNames&#160;)&#160;To&#160;UBound(&#160;oFilterNames&#160;)<br/>&#160; &#160;&#160;fProps()&#160;=&#160;oFF.getByName(oFilterNames(i))<br/>&#160; &#160;&#160;For&#160;fp&#160;=&#160;LBound(fProps)&#160;To&#160;UBound(fProps)<br/>&#160; &#160; &#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(fp,&#160;i+1)<br/>&#160; &#160; &#160;&#160;oProp&#160;=&#160;fProps(fp)<br/>&#160; &#160; &#160;&#160;fpCol&#160;=&#160;FindInArrayAdd(oProp.Name,&#160;sPropNames)<br/>&#160; &#160; &#160;&#160;If&#160;fpCol&#160;&gt;&#160;UBound(sPropNames)&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;ReDim&#160;Preserve&#160;sPropNames(fpCol)&#160;As&#160;String<br/>&#160; &#160; &#160; &#160;&#160;sPropNames(fpCol)&#160;=&#160;oProp.Name<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160;&#160;<br/>&#160; &#160; &#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(fpCol,&#160;i+1)<br/>&#160; &#160; &#160;&#160;If&#160;Not&#160;IsArray(oProp.Value)&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;oCell.setString(oProp.Value)<br/>&#160; &#160; &#160; &#160;&#160;If&#160;oProp.Name&#160;=&#160;&#34;Flags&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;flags&#160;=&#160;oProp.Value<br/>&#160; &#160; &#160; &#160; &#160;&#160;oCell.setString(CStr(flags)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;flags_int2str(flags)<br/>&#160; &#160; &#160; &#160; &#160;&#160;If&#160;flags&#160;and&#160;1&#160;Then<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;oCell&#160;=&#160;&#160;oSheet.getCellByPosition(FindInArrayAdd(&#34;Import&#34;,&#160;sPropNames),&#160;i+1)<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;oCell.setString(&#34;X&#34;)<br/>&#160; &#160; &#160; &#160; &#160;&#160;Endif<br/>&#160; &#160; &#160; &#160; &#160;&#160;If&#160;flags&#160;and&#160;2&#160;Then<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;oCell&#160;=&#160;&#160;oSheet.getCellByPosition(FindInArrayAdd(&#34;Export&#34;,&#160;sPropNames),&#160;i+1)<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;oCell.setString(&#34;X&#34;)<br/>&#160; &#160; &#160; &#160; &#160;&#160;Endif<br/>&#160; &#160; &#160; &#160; &#160;&#160;If&#160;flags&#160;and&#160;128&#160;Then<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;oCell&#160;=&#160;&#160;oSheet.getCellByPosition(FindInArrayAdd(&#34;Options&#34;,&#160;sPropNames),&#160;i+1)<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;oCell.setString(&#34;X&#34;)<br/>&#160; &#160; &#160; &#160; &#160;&#160;Endif<br/>&#160; &#160; &#160; &#160; &#160;&#160;If&#160;((flags&#160;and&#160;4096)&#160;or&#160;(flags&#160;and&#160;8192))&#160;Then<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;oCell&#160;=&#160;&#160;oSheet.getCellByPosition(FindInArrayAdd(&#34;Visible&#34;,&#160;sPropNames),&#160;i+1)<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;oCell.setString(&#34;X&#34;)<br/>&#160; &#160; &#160; &#160; &#160;&#160;Endif<br/>&#160; &#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160;&#160;ElseIf&#160;LBound(oProp.Value)&#160;&lt;=&#160;UBound(oProp.Value)&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160; &#160; &#160;&#160;oArrayData&#160;=&#160;oProp.Value<br/>&#160; &#160; &#160; &#160;&#160;For&#160;iUserData&#160;=&#160;LBound(oArrayData)&#160;To&#160;UBound(oArrayData)<br/>&#160; &#160; &#160; &#160; &#160;&#160;If&#160;VarType(oArrayData(iUserData))&#160;=&#160;8&#160;Then<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;(String:&#34;&#160;&amp;&#160;oArrayData(iUserData)&#160;&amp;&#160;&#34;)&#34;<br/>&#160; &#160; &#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;(&#34;&#160;&amp;&#160;oArrayData(iUserData).Name&#160;&amp;&#160;&#34;:&#34;&#160;&amp;&#160;oArrayData(iUserData).Value&#160;&amp;&#160;&#34;)&#34;<br/>
284<br/>
<hr/>
<a name=288></a>&#160; &#160; &#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160; &#160;&#160;Next<br/>&#160; &#160; &#160; &#160;&#160;oCell.setString(s)<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;Next<br/>&#160;&#160;For&#160;fp&#160;=&#160;LBound(sPropNames)&#160;To&#160;Ubound(sPropNames)<br/>&#160; &#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(fp,&#160;0)<br/>&#160; &#160;&#160;oCell.setString(sPropnames(fp))<br/>&#160;&#160;Next<br/>&#160;&#160;FinalFormat(oDoc)<br/>End&#160;Sub<br/>
function&#160;flags_int2str(flags&#160;as&#160;long)&#160;as&#160;string<br/>&#160; &#160;&#160;Dim&#160;cflags&#160;as&#160;long<br/>&#160; &#160;&#160;Dim&#160;strval&#160;as&#160;string<br/>&#160; &#160;&#160;Dim&#160;curFlag&#160;As&#160;Long<br/>
&#160; &#160;&#160;cflags&#160;=&#160;flags<br/>
strval&#160;=&#160;&#34;&#34;<br/>
&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000001&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Import&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-1<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000002&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Export&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-2<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000004&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Template&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-4<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000008&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Internal&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-8<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000010&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; TemplatePath&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-16<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000020&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Own&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-32<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000040&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Alien&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-64<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000080&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; UseOptions&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-128<br/>&#160; &#160;&#160;endif<br/>
285<br/>
<hr/>
<a name=289></a>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000100&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Default&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-256<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000200&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Executable&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-512<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000400&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; SupportSelection&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-1024<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00000800&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; MapToAppPlug&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-2048<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00001000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; NotInFileDialog&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-4096<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00002000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; NotInChooser&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-8192<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00004000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Acynchronas&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-16384<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00008000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Creator&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-32768<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00010000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Readonly&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-65536<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00020000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; NotInstalled&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-131072<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00040000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; ConsultService&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-262144<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00080000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; 3rdPartyFilter&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-524288<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00100000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Packed&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-1048576<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00200000&#160;then<br/>
286<br/>
<hr/>
<a name=290></a>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; SilentExport&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-2097152<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00400000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; BrowserPreferred&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-4194304<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H00800000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; [H00800000]&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-8388608<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H01000000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; [H01000000]&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-16777216<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H02000000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; [H02000000]&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-33554432<br/>&#160; &#160;&#160;endif<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;if&#160;cflags&#160;and&#160;&amp;H10000000&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; Preferred&#34;<br/>&#160; &#160; &#160; &#160;&#160;cflags&#160;=&#160;cflags-268435456<br/>&#160; &#160;&#160;endif<br/>
&#160; &#160;&#160;if&#160;cflags&#160;&lt;&gt;&#160;0&#160;then<br/>&#160; &#160; &#160; &#160;&#160;strval&#160;=&#160;strval&#160;+&#160;&#34; !!! ATTENTION: unsupported flag [&#34;+cflags+&#34;] detected !!!&#34;<br/>&#160; &#160;&#160;endif<br/>
&#160; &#160;&#160;flags_int2str&#160;=&#160;strval<br/>end&#160;function<br/>
Function&#160;FindInArrayAdd(sName$,&#160;nameArray)&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(nameArray())&#160;To&#160;UBound(nameArray())<br/>&#160; &#160;&#160;'Print nameArray(i) &amp; &#34; and &#34; &amp; sName<br/>&#160; &#160;&#160;If&#160;nameArray(i)&#160;=&#160;sName&#160;Then<br/>&#160; &#160; &#160;&#160;FindInArrayAdd&#160;=&#160;i<br/>&#160; &#160; &#160;&#160;Exit&#160;Function<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;i&#160;=&#160;UBound(nameArray())&#160;+&#160;1<br/>&#160;&#160;FindInArrayAdd&#160;=&#160;i<br/>End&#160;Function<br/>
sub&#160;FinalFormat(oDoc)<br/>rem ----------------------------------------------------------------------<br/>rem define variables<br/>Dim&#160;document&#160; &#160;as&#160;object<br/>Dim&#160;dispatcher&#160;as&#160;object<br/>rem ----------------------------------------------------------------------<br/>
287<br/>
<hr/>
<a name=291></a>rem get access to the document<br/>document&#160; &#160;=&#160;oDoc.CurrentController.Frame<br/>dispatcher&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>
rem ----------------------------------------------------------------------<br/>Dim&#160;args1(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args1(0).Name&#160;=&#160;&#34;ToPoint&#34;<br/>args1(0).Value&#160;=&#160;&#34;$A$1&#34;<br/>
dispatcher.executeDispatch(document,&#160;&#34;.uno:GoToCell&#34;,&#160;&#34;&#34;,&#160;0,&#160;args1())<br/>
rem ----------------------------------------------------------------------<br/>Dim&#160;args2(1)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args2(0).Name&#160;=&#160;&#34;By&#34;<br/>args2(0).Value&#160;=&#160;1<br/>args2(1).Name&#160;=&#160;&#34;Sel&#34;<br/>args2(1).Value&#160;=&#160;true<br/>
dispatcher.executeDispatch(document,&#160;&#34;.uno:GoRightToEndOfData&#34;,&#160;&#34;&#34;,&#160;0,&#160;args2())<br/>
rem ----------------------------------------------------------------------<br/>Dim&#160;args3(2)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args3(0).Name&#160;=&#160;&#34;FontHeight.Height&#34;<br/>args3(0).Value&#160;=&#160;12<br/>args3(1).Name&#160;=&#160;&#34;FontHeight.Prop&#34;<br/>args3(1).Value&#160;=&#160;100<br/>args3(2).Name&#160;=&#160;&#34;FontHeight.Diff&#34;<br/>args3(2).Value&#160;=&#160;0<br/>
dispatcher.executeDispatch(document,&#160;&#34;.uno:FontHeight&#34;,&#160;&#34;&#34;,&#160;0,&#160;args3())<br/>
rem ----------------------------------------------------------------------<br/>Dim&#160;args4(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args4(0).Name&#160;=&#160;&#34;Bold&#34;<br/>args4(0).Value&#160;=&#160;true<br/>
dispatcher.executeDispatch(document,&#160;&#34;.uno:Bold&#34;,&#160;&#34;&#34;,&#160;0,&#160;args4())<br/>
rem ----------------------------------------------------------------------<br/>Dim&#160;args5(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args5(0).Name&#160;=&#160;&#34;HorizontalAlignment&#34;<br/>args5(0).Value&#160;=&#160;com.sun.star.table.CellHoriJustify.CENTER<br/>
dispatcher.executeDispatch(document,&#160;&#34;.uno:HorizontalAlignment&#34;,&#160;&#34;&#34;,&#160;0,&#160;args5())<br/>
rem ----------------------------------------------------------------------<br/>Dim&#160;args6(1)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args6(0).Name&#160;=&#160;&#34;By&#34;<br/>args6(0).Value&#160;=&#160;1<br/>args6(1).Name&#160;=&#160;&#34;Sel&#34;<br/>args6(1).Value&#160;=&#160;true<br/>
dispatcher.executeDispatch(document,&#160;&#34;.uno:GoDownToEndOfData&#34;,&#160;&#34;&#34;,&#160;0,&#160;args6())<br/>
288<br/>
<hr/>
<a name=292></a>rem ----------------------------------------------------------------------<br/>Dim&#160;args7(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args7(0).Name&#160;=&#160;&#34;aExtraWidth&#34;<br/>args7(0).Value&#160;=&#160;254<br/>
dispatcher.executeDispatch(document,&#160;&#34;.uno:SetOptimalColumnWidth&#34;,&#160;&#34;&#34;,&#160;0,&#160;args7())<br/>
rem ----------------------------------------------------------------------<br/>Dim&#160;args8(8)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args8(0).Name&#160;=&#160;&#34;ByRows&#34;<br/>args8(0).Value&#160;=&#160;true<br/>args8(1).Name&#160;=&#160;&#34;HasHeader&#34;<br/>args8(1).Value&#160;=&#160;true<br/>args8(2).Name&#160;=&#160;&#34;CaseSensitive&#34;<br/>args8(2).Value&#160;=&#160;false<br/>args8(3).Name&#160;=&#160;&#34;IncludeAttribs&#34;<br/>args8(3).Value&#160;=&#160;true<br/>args8(4).Name&#160;=&#160;&#34;UserDefIndex&#34;<br/>args8(4).Value&#160;=&#160;0<br/>args8(5).Name&#160;=&#160;&#34;Col1&#34;<br/>args8(5).Value&#160;=&#160;7<br/>args8(6).Name&#160;=&#160;&#34;Ascending1&#34;<br/>args8(6).Value&#160;=&#160;true<br/>args8(7).Name&#160;=&#160;&#34;Col2&#34;<br/>args8(7).Value&#160;=&#160;1<br/>args8(8).Name&#160;=&#160;&#34;Ascending2&#34;<br/>args8(8).Value&#160;=&#160;true<br/>
dispatcher.executeDispatch(document,&#160;&#34;.uno:DataSort&#34;,&#160;&#34;&#34;,&#160;0,&#160;args8())<br/>dispatcher.executeDispatch(document,&#160;&#34;.uno:GoToCell&#34;,&#160;&#34;&#34;,&#160;0,&#160;args1())<br/>
end&#160;sub<br/>
<b>&#160;12.4.6.&#160;Loading&#160;and&#160;saving&#160;documents<br/></b>The&#160;desktop&#160;or a&#160;frame&#160;is&#160;used to load&#160;a&#160;document.&#160;To&#160;store&#160;a&#160;document,&#160;use&#160;the&#160;method&#160;storeToURL(),&#160;<br/>which&#160;is&#160;implemented by&#160;the&#160;Document&#160;object.&#160;The&#160;first&#160;argument&#160;to this&#160;method is&#160;the&#160;URL&#160;to&#160;which the&#160;<br/>document&#160;will&#160;be&#160;stored.&#160;The&#160;second argument&#160;is&#160;an array&#160;of named arguments&#160;(see<a href="libremacros.html#282">&#160;Table&#160;98)</a>.&#160;To&#160;export&#160;a&#160;<br/>document&#160;to a&#160;different&#160;type, the&#160;FilterName&#160;must&#160;specify&#160;the&#160;document&#160;export&#160;type.&#160;The&#160;code&#160;i<a href="libremacros.html#292">n&#160;Listing&#160;267<br/></a>exports&#160;a&#160;Writer&#160;document&#160;to&#160;a&#160;PDF&#160;file.<br/>
<i><b>Listing&#160;267.</b>&#160;Export&#160;the&#160;current&#160;document, assuming&#160;it&#160;is&#160;a Writer&#160;document,&#160;as&#160;PDF.<br/></i>Dim&#160;args(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args(0).Name&#160;=&#160;&#34;FilterName&#34;<br/>args(0).Value&#160;=&#160;&#34;writer_pdf_Export&#34;<br/>ThisComponent.storeToURL(&#34;file:///test.pdf&#34;,args())&#160;<br/>
<b>TIP</b><br/>
Filter&#160;names are&#160;case&#160;sensitive.<br/>
Some&#160;Calc&#160;import&#160;and export&#160;filters&#160;support&#160;options;&#160;for example,&#160;DIF,&#160;dBase, and Lotus&#160;filters&#160;all&#160;use&#160;the&#160;<br/>same&#160;filter option,&#160;a&#160;numeric&#160;index&#160;that&#160;identifies&#160;which&#160;character set&#160;to use&#160;for single-byte&#160;characters.<br/>
289<br/>
<hr/>
<a name=293></a><i><b>Listing&#160;268.</b>&#160;The&#160;DIF,&#160;dBase, and Lotus&#160;filters&#160;all&#160;use&#160;the&#160;same&#160;filter&#160;option.<br/></i>Dim&#160;args(1)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args(0).Name&#160;=&#160;&#34;FilterName&#34;<br/>args(0).Value&#160;=&#160;&#34;dBase&#34;<br/>args(1).Name&#160;=&#160;&#34;FilterOptions&#34;&#160;&#160;'Identify character set for single-byte chars<br/>args(1).Value&#160;=&#160;0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'System character set<br/>
More&#160;detailed information&#160;on CSV&#160;files&#160;is&#160;found in&#160;AndrewBase.odt.<br/>
The&#160;discussion of the&#160;CSV&#160;filter assumes&#160;familiarity&#160;with&#160;the&#160;CSV&#160;file&#160;format. If&#160;you aren’t&#160;familiar with&#160;<br/>this&#160;format,&#160;feel&#160;free&#160;to skip&#160;this&#160;section.&#160;The&#160;Text&#160;CSV&#160;filter,&#160;unlike&#160;the&#160;dBase&#160;filter,&#160;uses&#160;a&#160;complicated&#160;<br/>string containing&#160;five&#160;tokens.&#160;Each token&#160;can contain multiple&#160;values&#160;separated by&#160;a&#160;slash mark (/).&#160;The&#160;<br/>tokens&#160;are&#160;then&#160;separated&#160;by&#160;a&#160;comma&#160;(,).<br/>
<i><b>Listing&#160;269.</b>&#160;The&#160;CSV&#160;filter&#160;options&#160;are&#160;complicated.<br/></i>Dim&#160;args(1)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args(0).Name&#160;=&#160;&#34;FilterName&#34;<br/>args(0).Value&#160;=&#160;&#34;scalc: Text - txt - csv (StarCalc)&#34;<br/>args(1).Name&#160;=&#160;&#34;FilterOptions&#34;<br/>args(1).Value&#160;=&#160;&#34;44,34,0,1,1/5/2/1/3/1/4/1&#34;<br/>
The&#160;first&#160;token contains&#160;the&#160;field&#160;separators&#160;as&#160;ASCII&#160;values.&#160;For&#160;example, to&#160;specify&#160;a&#160;comma&#160;as&#160;the&#160;<br/>delimiter,&#160;use&#160;the&#160;ASCII&#160;value&#160;44 (see<a href="libremacros.html#293">&#160;Listing 269)</a>.&#160;To&#160;specify&#160;that&#160;some&#160;fields&#160;are&#160;separated&#160;by&#160;a&#160;a&#160;space&#160;<br/>(ASCII&#160;32) and some&#160;are&#160;separated&#160;by&#160;a&#160;tab (ASCII<a href="libremacros.html#293">&#160;9),&#160;Listing 269&#160;w</a>ould&#160;use&#160;“32/9,34,0,1,1/5/2/1/3/1/4/1”&#160;<br/>for the&#160;filter options.<br/>
In&#160;a&#160;CSV&#160;file, the&#160;text&#160;portions&#160;are&#160;usually&#160;surrounded by&#160;either double&#160;quotation marks&#160;(&#34;)&#160;or single&#160;<br/>quotation marks&#160;('<a href="libremacros.html#293">).&#160;Listing 269&#160;s</a>pecifies&#160;that&#160;text&#160;portions&#160;should&#160;be&#160;surrounded by&#160;double&#160;quotation&#160;marks,<br/>using an&#160;ASCII&#160;value&#160;of 34. If&#160;you&#160;want&#160;to use&#160;multiple&#160;text&#160;delimiters, separate&#160;them&#160;with&#160;a&#160;slash.<br/>
The&#160;third&#160;token identifies&#160;the&#160;character set&#160;to use;&#160;this&#160;is&#160;the&#160;same&#160;value&#160;used to&#160;identify&#160;the&#160;character set&#160;in&#160;<br/>the&#160;DIF,&#160;dBase, and Lotus&#160;filters.&#160;The&#160;code&#160;i<a href="libremacros.html#293">n&#160;Listing&#160;269&#160;s</a>pecifies&#160;a&#160;zero for the&#160;character set.<br/>
The&#160;fourth&#160;token identifies&#160;the&#160;first&#160;line&#160;to&#160;import&#160;—&#160;typically&#160;line&#160;one<a href="libremacros.html#293">.&#160;Listing&#160;269&#160;s</a>pecifies&#160;that&#160;the&#160;first&#160;<br/>line&#160;of text&#160;should&#160;be&#160;input.<br/>
The&#160;last&#160;token identifies&#160;the&#160;format&#160;of each column&#160;in&#160;the&#160;CSV&#160;file.&#160;The&#160;columns&#160;can be&#160;formatted&#160;as&#160;either&#160;<br/>delimited text&#160;(see<a href="libremacros.html#293">&#160;Listing 270)</a>&#160;or as&#160;fixed-width&#160;text&#160;(see<a href="libremacros.html#294">&#160;Listing&#160;271).</a><br/>
<i><b>Listing&#160;270.</b>&#160;Delimited-text-format&#160;string&#160;for&#160;the&#160;CSV&#160;filter.<br/></i>&lt;field_num&gt;/&lt;format&gt;/&lt;field_num&gt;/&lt;format&gt;/&lt;field_num&gt;/&lt;format&gt;/...<br/>
The&#160;&lt;field_num&gt;&#160;is&#160;an integer that&#160;identifies&#160;a&#160;field, where&#160;1 is&#160;the&#160;leftmost&#160;field. For example, given the&#160;<br/>fields&#160;“one”, “two”, and “three”, a&#160;field_num&#160;of 2 refers&#160;to&#160;“two”.&#160;The&#160;&lt;format&gt;&#160;is&#160;an integer that&#160;identifies&#160;<br/>the&#160;format&#160;of the&#160;field&#160;(see<a href="libremacros.html#293">&#160;Table&#160;100)</a>.&#160;The&#160;code&#160;i<a href="libremacros.html#293">n&#160;Listing&#160;269&#160;s</a>pecifies&#160;that&#160;fields&#160;one&#160;through four use&#160;a&#160;<br/>format&#160;of 1, which is&#160;the&#160;standard format.<br/>
<i><b>Table&#160;100.</b>&#160;CSV&#160;field format&#160;values.</i><br/>
<i><b>Format</b></i><br/>
<i><b>Description</b></i><br/>
1<br/>
Standard<br/>
2<br/>
Text<br/>
3<br/>
MM/DD/YY<br/>
4<br/>
DD/MM/YY<br/>
5<br/>
YY/MM/DD<br/>
290<br/>
<hr/>
<a name=294></a><i><b>Format</b></i><br/>
<i><b>Description</b></i><br/>
9<br/>
Do&#160;not&#160;import;&#160;ignore&#160;this field.<br/>
10<br/>
Import&#160;a&#160;number&#160;formatted in&#160;the&#160;US-English locale&#160;regardless&#160;of&#160;the&#160;current&#160;locale.<br/>
<i><b>Listing&#160;271.</b>&#160;Fixed-width-columns&#160;format&#160;string&#160;for&#160;the&#160;CSV&#160;filter.</i><br/>
FIX/&lt;start&gt;/&lt;format&gt;/&lt;start&gt;/&lt;format&gt;/&lt;start&gt;/&lt;format&gt;/...<br/>
Tell&#160;the&#160;filter that&#160;the&#160;file&#160;uses&#160;a&#160;fixed-width format&#160;by&#160;using the&#160;text&#160;“FIX”&#160;as&#160;the&#160;first&#160;portion&#160;of the&#160;last&#160;<br/>token. Fixed-width&#160;CSV&#160;files&#160;identify&#160;fields&#160;by&#160;specifying where&#160;each field starts&#160;(see<a href="libremacros.html#294">&#160;Listing 271)</a>.&#160;The&#160;<br/>&lt;start&gt;&#160;value&#160;specifies&#160;the&#160;first&#160;character in a&#160;field.&#160;A&#160;start&#160;of 0 refers&#160;to&#160;the&#160;leftmost&#160;character of the&#160;text.&#160;<br/>The&#160;&lt;format&gt;&#160;is&#160;an integer that&#160;identifies&#160;the&#160;format&#160;of the&#160;text&#160;(see<a href="libremacros.html#293">&#160;Table&#160;100)</a>.<br/>
<b>&#160;12.4.7.&#160;Error&#160;handling&#160;while&#160;loading&#160;a&#160;document<br/></b>Exceptions&#160;are&#160;not&#160;thrown while&#160;loading&#160;a&#160;document;&#160;instead, errors&#160;are&#160;thrown using an interaction&#160;handler&#160;<br/>that&#160;is&#160;passed as&#160;a&#160;named argument.&#160;Unfortunately,&#160;you&#160;cannot&#160;implement&#160;an OOo Basic&#160;interaction handler.&#160;<br/>The&#160;OOo Developer’s&#160;Guide, however,&#160;has&#160;examples&#160;of error handlers&#160;using&#160;other languages. In&#160;other&#160;<br/>words, in BASIC, you&#160;cannot&#160;trap errors&#160;while&#160;loading a&#160;document;&#160;the&#160;document&#160;simply&#160;fails&#160;to load&#160;and&#160;<br/>returns&#160;null.<br/>
The&#160;Graphical&#160;User Interface&#160;(GUI)&#160;provides&#160;an interaction handler that&#160;interacts&#160;with the&#160;user.&#160;The&#160;GUI’s&#160;<br/>interaction handler displays&#160;error messages&#160;when errors&#160;occur and prompts&#160;the&#160;user for a&#160;password if it&#160;is&#160;<br/>required. If&#160;no handler is&#160;included as&#160;a&#160;named&#160;argument, a&#160;default&#160;handler is&#160;used.&#160;The&#160;default&#160;handler&#160;<br/>simply&#160;ignores&#160;most&#160;errors, providing&#160;little&#160;feedback to&#160;the&#160;user.<br/>
<i><b>&#160;12.5.&#160;Conclusion<br/></b></i>The&#160;desktop&#160;acts&#160;as&#160;the&#160;main&#160;application&#160;that&#160;controls&#160;OpenOffice.org, so when you&#160;need to obtain&#160;<br/>something that&#160;is&#160;globally&#160;related to&#160;the&#160;documents&#160;or frames, look at&#160;the&#160;desktop.&#160;The&#160;globally&#160;available&#160;<br/>variables&#160;StarDesktop&#160;and&#160;ThisComponent&#160;provide&#160;easy&#160;access&#160;to the&#160;OOo Desktop&#160;object&#160;and the&#160;current&#160;<br/>document.&#160;This&#160;chapter introduced techniques&#160; for accessing containers&#160;with multiple&#160;objects.&#160;Familiarize&#160;<br/>yourself&#160;with the&#160;basic&#160;capabilities&#160;for opening documents,&#160;for importing and exporting file&#160;types, and the&#160;<br/>capabilities&#160;and limitations&#160;of OOo, in order to&#160;expand&#160;your ability&#160;to&#160;use&#160;and create&#160;a&#160;wide&#160;variety&#160;of file&#160;<br/>types&#160;within&#160;the&#160;OOo environment.<br/>
291<br/>
<hr/>
<a name=295></a><b>&#160;13.&#160;Generic&#160;Document&#160;Methods<br/></b>OpenOffice.org&#160;supports&#160;six&#160;primary&#160;document&#160;types:&#160;text,&#160;spreadsheet,&#160;drawing, math,&#160;database, and&#160;<br/>presentation.&#160;The&#160;different&#160;document&#160;types&#160;share&#160;significant&#160;functionality&#160;and interfaces, such as&#160;accessing&#160;<br/>the&#160;document&#160;model,&#160;printing, and saving.&#160;This&#160;chapter introduces&#160;common&#160;tasks&#160;across&#160;all&#160;of the&#160;document&#160;<br/>types.<br/>
Every&#160;document&#160;contains&#160;data&#160;that&#160;can be&#160;manipulated&#160;and printed. For example, the&#160;primary&#160;data&#160;in a&#160;<br/>Writer document&#160;is&#160;text,&#160;but&#160;it&#160;can also contain&#160;tables&#160;and graphics.&#160;The&#160;data&#160;model&#160;consists&#160;of this&#160;<br/>underlying data&#160;that&#160;can be&#160;manipulated independently&#160;of how&#160;it&#160;is&#160;displayed.&#160;To&#160;manipulate&#160;the&#160;data&#160;by&#160;<br/>means&#160;of a&#160;macro, you&#160;manipulate&#160;the&#160;data&#160;model&#160;directly.&#160;Although you can use&#160;the&#160;dispatcher to&#160;indirectly&#160;<br/>manipulate&#160;the&#160;data, the&#160;changes&#160;are&#160;still&#160;made&#160;directly&#160;to the&#160;model.&#160;A&#160;typical&#160;usage&#160;of the&#160;dispatcher is&#160;to&#160;<br/>paste&#160;the&#160;clipboard contents&#160;into the&#160;document&#160;(see&#160;Chapte<a href="libremacros.html#264">r&#160;11&#160;The&#160;Dispatcher).</a><br/>
The&#160;data&#160;model&#160;contains&#160;a&#160;Controller object, which manipulates&#160;the&#160;visual&#160;presentation&#160;of the&#160;data.&#160;The&#160;<br/>controller doesn’t&#160;change&#160;the&#160;data;&#160;it&#160;only&#160;controls&#160;how&#160;the&#160;document&#160;is&#160;presented.&#160;The&#160;controller interacts&#160;<br/>directly&#160;with&#160;the&#160;user interface&#160;to&#160;control&#160;the&#160;location&#160;of the&#160;displayed cursor,&#160;to&#160;control&#160;which page&#160;is&#160;<br/>displayed, and to select&#160;portions&#160;of the&#160;document.&#160;Use&#160;the&#160;controller to&#160;determine&#160;display-related&#160;<br/>information such as&#160;the&#160;current&#160;page&#160;or the&#160;currently&#160;selected text.<br/>
<b>TIP</b><br/>
OOo supports a&#160;mode&#160;called&#160;“headless,”&#160;which has no startup screen, no default&#160;document,&#160;<br/>
no&#160;user&#160;interface,&#160;and&#160;supports&#160;no user&#160;interaction.&#160;(Use&#160;“soffice&#160;-?”&#160;to see&#160;a&#160;list&#160;of&#160;supported modes.)&#160;If&#160;<br/>OOo is&#160;started&#160;in headless&#160;mode,&#160;there&#160;is&#160;no display&#160;component.&#160;Therefore,&#160;a&#160;controller&#160;is not&#160;required&#160;and&#160;<br/>
may&#160;not&#160;exist. If&#160;it’s&#160;possible&#160;for&#160;your&#160;macro&#160;to run on OOo in&#160;headless mode,&#160;you&#160;must&#160;check&#160;the&#160;<br/>controller&#160;to see&#160;if&#160;it&#160;is null&#160;before&#160;using&#160;it.<br/>
<i><b>&#160;13.1.&#160;Service&#160;Manager<br/></b></i>OpenOffice.org&#160;has&#160;a&#160;general&#160;global&#160;service&#160;manager,&#160;which&#160;is&#160;used to create&#160;and obtain&#160;instances&#160;of general<br/>UNO&#160;services.&#160;A&#160;service&#160;manager accepts&#160;a&#160;string that&#160;identifies&#160;a&#160;type&#160;of object, and it&#160;returns&#160;an instance&#160;<br/>of that&#160;object.&#160;The&#160;global&#160;service&#160;manager is&#160;made&#160;available&#160;in&#160;OOo Basic&#160;through the&#160;function&#160;<br/>createUnoService(String).&#160;The&#160;global&#160;service&#160;manager returns&#160;general&#160;objects&#160;such as&#160;a&#160;dispatch&#160;helper or an<br/>object&#160;for simple&#160;file&#160;access.<br/>
<i><b>Listing&#160;272.</b>&#160;Use&#160;the&#160;global&#160;service&#160;manager.</i><br/>
oDispatcher&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>oSimpleFileAccess&#160;=&#160;createUnoService(&#34;com.sun.star.ucb.SimpleFileAccess&#34;)<br/>
Documents&#160;are&#160;a&#160;service&#160;manager to create&#160;objects&#160;that&#160;they&#160;contain&#160;(or that&#160;are&#160;directly&#160;related&#160;to the&#160;<br/>document);&#160;for example,&#160;a&#160;Writer&#160;document&#160;is&#160;able&#160;to&#160;create&#160;a&#160;text&#160;table&#160;or text&#160;field that&#160;can be&#160;inserted&#160;into<br/>the&#160;document.&#160;In&#160;general,&#160;objects&#160;that&#160;were&#160;not&#160;created&#160;by&#160;a&#160;document&#160;cannot&#160;be&#160;inserted into the&#160;document.&#160;<br/>A&#160;Writer document&#160;is&#160;unable&#160;to&#160;return&#160;global&#160;objects, and the&#160;global&#160;service&#160;manager is&#160;unable&#160;to&#160;return&#160;<br/>objects&#160;that&#160;are&#160;then inserted into a&#160;document.<br/>
<i><b>Listing&#160;273.</b>&#160;Use&#160;a document&#160;as&#160;a service&#160;manager.<br/></i>REM Let the document create the text table.<br/>oTable&#160;=&#160;oDoc.createInstance(&#160;&#34;com.sun.star.text.TextTable&#34;&#160;)<br/>oTable.initialize(3,&#160;2)&#160;'Three rows, two columns<br/>REM Now insert the text table at the end of the document.<br/>oDoc.Text.insertTextContent(oDoc.Text.getEnd(),&#160;oTable,&#160;False)<br/>
292<br/>
<hr/>
<a name=296></a><i><b>&#160;13.2.&#160;Services&#160;and&#160;interfaces<br/></b></i>Think&#160;of an OOo component&#160;as&#160;a&#160;window&#160;owned by&#160;the&#160;desktop.&#160;Use&#160;the&#160;Desktop&#160;object&#160;to&#160;enumerate&#160;the&#160;<br/>components, including documents, the&#160;Basic&#160;IDE&#160;and the&#160;help window&#160;along with&#160;the&#160;actual&#160;documents. If&#160;a<br/>component&#160;supports&#160;the&#160;com.sun.star.frame.XModel&#160;interface, the&#160;component&#160;is&#160;a&#160;document&#160;(rather than&#160;the&#160;<br/>Basic&#160;IDE&#160;or the&#160;help window). Every&#160;document&#160;supports&#160;the&#160;XModel&#160;interface&#160;and each document&#160;type&#160;has<br/>a&#160;unique&#160;service&#160;that&#160;it&#160;supports&#160;(see<a href="libremacros.html#296">&#160;Table&#160;101). U</a>se&#160;HasUnoInterfaces&#160;to&#160;determine&#160;if an object&#160;supports&#160;<br/>the&#160;XModel&#160;interface;&#160;then use&#160;the&#160;object&#160;method supportsService&#160;to determine&#160;the&#160;document&#160;type.<br/>
<b>TIP</b><br/>
The&#160;method&#160;supportsService()&#160;is&#160;defined&#160;by&#160;the&#160;com.sun.star.lang.XServiceInfo interface.&#160;<br/>
This&#160;interface&#160;also&#160;defines the&#160;method&#160;getImplementationName(),&#160;which returns a&#160;unique&#160;<br/>string&#160;identifying&#160;the&#160;object&#160;type.<br/>
<i>Table&#160;101. Unique&#160;services&#160;that&#160;identify&#160;the&#160;document’s&#160;type.</i><br/>
<i><b>Service</b></i><br/>
<i><b>Document&#160;Type</b></i><br/>
com.sun.star.text.TextDocument<br/>
Writer&#160;text&#160;document.<br/>
com.sun.star.sheet.SpreadsheetDocument<br/>
Calc&#160;spreadsheet&#160;document.<br/>
com.sun.star.drawing.DrawingDocument<br/>
Draw&#160;drawing&#160;document.<br/>
com.sun.star.presentation.PresentationDocument<br/>
Impress presentation document.<br/>
com.sun.star.formula.FormulaProperties<br/>
Math formula&#160;document.<br/>
com.sun.star.comp.dba.ODatabaseDocument<br/>
Base&#160;Document<br/>
OOo contains&#160;numerous&#160;interfaces&#160;that&#160;are&#160;used by&#160;many&#160;(if not&#160;all) of the&#160;document&#160;types. Consider this&#160;<br/>partial&#160;list&#160;of common&#160;interfaces.<br/>
<i><b>Interface</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.beans.XPropertySet<br/>
Get&#160;and set&#160;object&#160;properties.<br/>
com.sun.star.container.XChild<br/>
For&#160;objects with a&#160;single&#160;parent, get&#160;and&#160;set&#160;that&#160;parent.<br/>
com.sun.star.datatransfer.XTransferable<br/>
Get&#160;data&#160;for&#160;data&#160;transfer;&#160;like&#160;copying&#160;to&#160;the&#160;clipboard.<br/>
com.sun.star.document.XDocumentPropertiesSupplier<br/>
Access a&#160;documents properties;&#160;for&#160;example,&#160;author&#160;and&#160;creation&#160;<br/>
date.<br/>
com.sun.star.document.XDocumentEventBroadcaster<br/>
Register&#160;to be&#160;notified&#160;when events occur.<br/>
com.sun.star.document.XEventsSupplier<br/>
Get&#160;a&#160;list&#160;of&#160;events supported by&#160;this object.<br/>
com.sun.star.document.XLinkTargetSupplier<br/>
Get&#160;the&#160;list&#160;of&#160;link&#160;targets&#160;in&#160;a&#160;document.<br/>
com.sun.star.document.XViewDataSupplier<br/>
Get&#160;properties describing&#160;a&#160;document's&#160;open views.<br/>
com.sun.star.drawing.XDrawPagesSupplier<br/>
Get&#160;draw&#160;pages for&#160;documents&#160;that&#160;support&#160;multiple&#160;draw&#160;pages;&#160;<br/>
for&#160;example,&#160;a&#160;drawing&#160;or&#160;a&#160;presentation.<br/>
com.sun.star.frame.XLoadable<br/>
Functionality&#160;to load&#160;documents.<br/>
com.sun.star.frame.XModel<br/>
Representation&#160;of&#160;a&#160;resource&#160;(document)&#160;in&#160;the&#160;sense&#160;that&#160;it&#160;was&#160;<br/>created/loaded from&#160;a&#160;resource;&#160;off&#160;hand,&#160;I&#160;am&#160;not&#160;aware&#160;of&#160;any&#160;<br/>
document&#160;that&#160;does not&#160;implement&#160;XModel.&#160;This interface&#160;also&#160;<br/>provides access to the&#160;model's components.<br/>
com.sun.star.frame.XStorable<br/>
Methods to store&#160;a&#160;document.<br/>
com.sun.star.lang.XComponent<br/>
Allows&#160;an object&#160;to&#160;own&#160;and dispose&#160;(free)&#160;an object;&#160;for&#160;<br/>
example,&#160;a&#160;text&#160;table.<br/>
293<br/>
<hr/>
<a name=297></a>com.sun.star.lang.XEventListener<br/>
Base&#160;interface&#160;for&#160;all&#160;listeners;&#160;provides&#160;a&#160;disposing&#160;method.<br/>
com.sun.star.lang.XMultiServiceFactory<br/>
Implemented&#160;by&#160;factories to create&#160;objects and determine&#160;what&#160;<br/>objects the&#160;factor&#160;can create.<br/>
com.sun.star.lang.XServiceInfo<br/>
Determine&#160;which services&#160;an object&#160;supports.<br/>
com.sun.star.lang.XTypeProvider<br/>
Determine&#160;the&#160;types (interfaces)&#160;an object&#160;supports.<br/>
com.sun.star.script.XStarBasicAccess<br/>
Deprecated,&#160;but&#160;provides access to libraries.<br/>
com.sun.star.style.XStyleFamiliesSupplier<br/>
Get&#160;style&#160;families supported by&#160;a&#160;document;&#160;for&#160;example,&#160;<br/>
paragraph&#160;styles.<br/>
com.sun.star.util.XCloseBroadcaster<br/>
Allows&#160;an object&#160;to&#160;veto a&#160;close&#160;request.<br/>
com.sun.star.util.XCloseable<br/>
Ask&#160;a&#160;document&#160;to&#160;close;&#160;this&#160;is preferred&#160;to dispose.<br/>
com.sun.star.util.XModifiable<br/>
Determine&#160;if&#160;a&#160;document&#160;has been modified.<br/>
com.sun.star.util.XModifyBroadcaster<br/>
Register&#160;and be&#160;notified&#160;when a&#160;document&#160;is modified.<br/>
com.sun.star.util.XNumberFormatsSupplier<br/>
Get&#160;the&#160;document's number&#160;formats.<br/>
com.sun.star.view.XPrintJobBroadcaster<br/>
Register&#160;and be&#160;notified&#160;about&#160;print&#160;progress.<br/>
com.sun.star.view.XPrintable<br/>
Document&#160;print&#160;functionality.<br/>
com.sun.star.view.XRenderable<br/>
Functionality&#160;to render&#160;a&#160;document.<br/>
Ironically,&#160;searching&#160;is&#160;not&#160;supported by&#160;all&#160;document&#160;types.&#160;This&#160;is&#160;because&#160;searching functionality&#160;is&#160;very&#160;<br/>specific&#160;to the&#160;document.&#160;For&#160;example, searching a&#160;text&#160;document&#160;is&#160;very&#160;different&#160;than&#160;searching a&#160;<br/>spreadsheet&#160;(in terms&#160;of desired options). In&#160;Calc, searching is&#160;provided&#160;by&#160;the&#160;each sheet&#160;rather than&#160;by&#160;the&#160;<br/>document.<br/>
A&#160;Calc&#160;document&#160;is&#160;composed of multiple&#160;spreadsheets.&#160;A&#160;significant&#160;portion&#160;of the&#160;functionality,&#160;therefore,&#160;<br/>exists&#160;in the&#160;spreadsheet&#160;objects&#160;rather than in&#160;the&#160;parent&#160;Calc&#160;document. For example,&#160;searching text&#160;or &#160;<br/>obtaining draw&#160;pages&#160;both&#160;exist&#160;in spreadsheet&#160;objects&#160;— draw&#160;pages&#160;are&#160;discussed in depth&#160;in Chapte<a href="libremacros.html#551">r&#160;16<br/>Draw&#160;and Impress&#160;Documents.</a><br/>
The&#160;OpenOffice.org&#160;API&#160;Web&#160;site&#160;contains&#160;extensive,&#160;detailed help on most&#160;of the&#160;services&#160;and interfaces.&#160;<br/>The&#160;page&#160;is&#160;built&#160;by&#160;starting with the&#160;Web address&#160;“http://api.openoffice.org/docs/common/ref/”&#160;and then&#160;<br/>using the&#160;interface&#160;name&#160;to&#160;build&#160;the&#160;rest&#160;of the&#160;address. For example, the&#160;com.sun.star.beans.XPropertySet&#160;<br/>interface&#160;has&#160;an Internet&#160;address&#160;as&#160;follows:<br/>
<a href="http://api.openoffice.org/docs/common/ref/com/sun/star/beans/XPropertySet.html">http://api.openoffice.org/docs/common/ref/com/sun/star/beans/XPropertySet.html&#160;</a><br/>
<i><b>&#160;13.3.&#160;Getting&#160;and&#160;setting&#160;properties<br/></b></i>The&#160;dbg_properties&#160;property&#160;is&#160;a&#160;string containing a&#160;list&#160;of properties&#160;supported&#160;the&#160;object&#160;containing the&#160;<br/>property;&#160;you should read that&#160;last&#160;sentence&#160;again.<br/>
OOo Basic&#160;automatically&#160;makes&#160;these&#160;properties&#160;available&#160;for direct&#160;access;&#160;other languages&#160;may&#160;not.&#160;The&#160;<br/>com.sun.star.beans.XPropertySet&#160;interface&#160;provides&#160;methods&#160;to&#160;get, set, and enumerate&#160;the&#160;object’s&#160;<br/>properties,&#160;as&#160;shown in<a href="libremacros.html#298">&#160;Table&#160;102.</a><br/>
294<br/>
<hr/>
<a name=298></a><i>Table&#160;102. Object&#160;methods&#160;defined by&#160;the&#160;interface&#160;XPropertySet.</i><br/>
<i><b>Object&#160;Method</b></i><br/>
<i><b>Description</b></i><br/>
getPropertySetInfo()<br/>
Return an object&#160;supporting&#160;the&#160;<br/>
com.sun.star.beans.XPropertySetInfo&#160;interface.&#160;This&#160;object&#160;describes<br/>the&#160;object’s&#160;properties but&#160;may&#160;be&#160;null.<br/>
setPropertyValue(name,&#160;value)<br/>
Set&#160;the&#160;value&#160;of&#160;the&#160;named property.&#160;A&#160;listener&#160;may&#160;veto&#160;this&#160;change.<br/>
getPropertyValue(name)<br/>
Return the&#160;value&#160;of&#160;the&#160;named&#160;property.<br/>
addPropertyChangeListener(name,&#160;listener)<br/>
Add&#160;an XPropertyChangeListener&#160;for&#160;the&#160;named&#160;property.&#160;An&#160;empty&#160;<br/>name&#160;listens for&#160;all&#160;properties.<br/>
removePropertyChangeListener(name, listener)<br/>
Remove&#160;an XPropertyChangeListener.<br/>
addVetoableChangeListener(name, listener)<br/>
Add&#160;an XVetoableChangeListener&#160;for&#160;the&#160;named&#160;property.&#160;An&#160;empty&#160;<br/>
name&#160;listens for&#160;all&#160;properties.<br/>
removeVetoableChangeListener(name,&#160;listener)<br/>
Removes an XVetoableChangeListener.<br/>
In&#160;OOo Basic, properties&#160;are&#160;usually&#160;accessed directly.<a href="libremacros.html#298">&#160;Listing 274&#160;de</a>monstrates&#160;two ways&#160;to obtain the&#160;<br/>CharFontName&#160;property&#160;from&#160;a&#160;Writer document&#160;— these&#160;methods&#160;return&#160;the&#160;name&#160;of the&#160;font&#160;style.<br/>
<i><b>Listing&#160;274.</b>&#160;Two&#160;methods&#160;to&#160;obtain the&#160;name&#160;of&#160;the&#160;font&#160;style.<br/></i>Print&#160;ThisComponent.CharFontName<br/>Print&#160;CStr(ThisComponent.getPropertyValue(&#34;CharFontName&#34;))<br/>
Accessing the&#160;property&#160;directly&#160;is&#160;the&#160;most&#160;expedient&#160;method&#160;while&#160;using OOo Basic,&#160;but&#160;there&#160;are&#160;<br/>advantages&#160;to&#160;using the&#160;methods&#160;defined by&#160;the&#160;XPropertySetInfo interface. Some&#160;properties&#160;are&#160;defined&#160;as&#160;<br/>optional, so not&#160;every&#160;document&#160;contains&#160;every&#160;property.&#160;The&#160;XPropertySetInfo interface&#160;defines&#160;the&#160;object&#160;<br/>method&#160;hasPropertyByName(), which&#160;can be&#160;used to test&#160;for the&#160;existence&#160;of a&#160;property&#160;before&#160;use;&#160;errors&#160;<br/>can still&#160;be&#160;avoided&#160;by&#160;using error-handling routines.&#160;Another use&#160;is&#160;to&#160;generically&#160;enumerate&#160;all&#160;of the&#160;<br/>contained properties&#160;and possibly&#160;their values&#160;as&#160;shown i<a href="libremacros.html#298">n&#160;Listing&#160;275</a><a href="libremacros.html#299">.&#160;Figure&#160;82&#160;s</a>hows&#160;some&#160;properties&#160;of a<br/>Writer document&#160;using the&#160;macro in<a href="libremacros.html#298">&#160;Listing 275.&#160;</a><br/>
<i><b>Listing&#160;275.</b>&#160;Display&#160;general&#160;document&#160;properties.</i><br/>
Sub&#160;getPropertyValues<br/>&#160;&#160;Dim&#160;vPropInfo&#160;&#160;'PropertySetInfo object<br/>&#160;&#160;Dim&#160;vProps&#160; &#160; &#160;'Array of properties<br/>&#160;&#160;Dim&#160;vProp&#160; &#160; &#160;&#160;'com.sun.star.beans.Property<br/>&#160;&#160;Dim&#160;v&#160; &#160; &#160; &#160; &#160;&#160;'Value of a single property<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160;'Index variable<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160;'General message string<br/>&#160;&#160;Dim&#160;nCount%<br/>&#160;&#160;<br/>&#160;&#160;REM Object implements interface com.sun.star.beans.XPropertySetInfo<br/>&#160;&#160;vPropInfo&#160;=&#160;ThisComponent.getPropertySetInfo()<br/>&#160;&#160;REM sequence&lt; Property &gt; vPropInfo.getProperties()<br/>&#160;&#160;REM Property vPropInfo.getPropertyByName(name)<br/>&#160;&#160;REM boolean vPropInfo.hasPropertyByName(name)<br/>&#160;&#160;vProps&#160;=&#160;vPropInfo.getProperties()<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;UBound(vProps)<br/>&#160; &#160;&#160;If&#160;nCount&#160;=&#160;30&#160;Then<br/>&#160; &#160; &#160;&#160;nCount&#160;=&#160;0<br/>&#160; &#160; &#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Properties&#34;<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>
295<br/>
<hr/>
<a name=299></a>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;nCount&#160;=&#160;nCount&#160;+&#160;1<br/>&#160; &#160;&#160;vProp&#160;=&#160;vProps(i)&#160;&#160;'com.sun.star.beans.Property<br/>&#160; &#160;&#160;s&#160;=&#160;S&#160;&amp;&#160;vProp.Name&#160;&amp;&#160;&#34; = &#34;<br/>&#160; &#160;&#160;v&#160;=&#160;ThisComponent.getPropertyValue(vProp.Name)<br/>&#160; &#160;&#160;If&#160;IsNull(v)&#160;Then<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;S&#160;&amp;&#160;&#34;Null&#34;<br/>&#160; &#160;&#160;ElseIf&#160;IsEmpty(v)&#160;Then<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;S&#160;&amp;&#160;&#34;Empty&#34;<br/>&#160; &#160;&#160;ElseIf&#160;VarType(v)&#160;&lt;&#160;9&#160;Then<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;S&#160;&amp;&#160;CStr(v)<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;S&#160;&amp;&#160;&#34;Object or Array&#34;<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;s&#160;=&#160;S&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Properties&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;82.</b>&#160;The&#160;first&#160;10 properties&#160;of&#160;ThisComponent.</i><br/>
<b>TIP</b><br/>
In&#160;case&#160;you missed the&#160;implications of&#160;the&#160;macro&#160;i<a href="libremacros.html#298">n&#160;Listing&#160;275, i</a>t&#160;allows you&#160;to generically&#160;inspect&#160;any&#160;<br/>
object&#160;that&#160;supports&#160;the&#160;XPropertySet&#160;interface.&#160;The&#160;ability&#160;to&#160;inspect&#160;an&#160;object&#160;is invaluable&#160;when you&#160;<br/>aren’t&#160;certain&#160;what&#160;you can&#160;do&#160;with an&#160;object.<br/>
After getting a&#160;property&#160;set&#160;information object,&#160;<br/>
•<br/>
Use&#160;getProperties() to&#160;get&#160;an array&#160;of Property&#160;objects.<br/>
•<br/>
Use&#160;hasProperty(name) to&#160;determine&#160;if&#160;a&#160;property&#160;exists.<br/>
•<br/>
Use&#160;getPropertyByName(name) to get&#160;a&#160;specific&#160;property.<br/>
<i><b>&#160;13.4.&#160;Document&#160;properties<br/></b></i>Document&#160;properties&#160;contain&#160;information&#160;related to&#160;the&#160;document&#160;such as&#160;the&#160;author&#160;and creation&#160;time;&#160;as&#160;<br/>opposed to&#160;the&#160;properties&#160;discussed in the&#160;previous&#160;section that&#160;are&#160;related&#160;to the&#160;document&#160;contents&#160;such as&#160;<br/>the&#160;current&#160;font.<br/>
296<br/>
<hr/>
<a name=300></a>Previous&#160;methods&#160;for obtaining document&#160;properties&#160;have&#160;been deprecated;&#160;for example,&#160;using&#160;<br/>getDocumentInfo to&#160;obtain&#160;and modify&#160;user fields. Use&#160;<b>File&#160;|&#160;Properties</b>&#160;to&#160;open the&#160;document&#160;properties&#160;<br/>dialog. Use&#160;getDocumentProperties&#160;to&#160;obtain&#160;the&#160;DocumentProperties&#160;object.&#160;<br/>
<i><b>Listing&#160;276.</b>&#160;Use&#160;the&#160;DocumentProperties&#160;object.<br/></i>&#160;&#160;' com.sun.star.document.DocumentProperties<br/>&#160; printDocProperties(ThisComponent.getDocumentProperties())<br/>End&#160;Sub<br/>
Sub&#160;printDocProperties(oDocProps)<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Dim&#160;oData<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;&#34;Author : &#34;&#160;&amp;&#160;oDocProps.Author&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;AutoloadSecs : &#34;&#160;&amp;&#160;oDocProps.AutoloadSecs&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;AutoloadURL : &#34;&#160;&amp;&#160;oDocProps.AutoloadURL&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;DefaultTarget : &#34;&#160;&amp;&#160;oDocProps.DefaultTarget&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;Description : &#34;&#160;&amp;&#160;oDocProps.Description&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;EditingCycles : &#34;&#160;&amp;&#160;oDocProps.EditingCycles&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;EditingDuration : &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;secondsAsPrettyTime(oDocProps.EditingDuration)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;Generator : &#34;&#160;&amp;&#160;oDocProps.Generator&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;ModifiedBy : &#34;&#160;&amp;&#160;oDocProps.ModifiedBy&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;Title : &#34;&#160;&amp;&#160;oDocProps.Title&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;Language : &#34;&#160;&amp;&#160;oDocProps.Language.Country&#160;&amp;&#160;&#34;:&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.Language.Language&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;ModificationDate : &#34;&#160;&amp;&#160;oDocProps.ModificationDate.Day&#160;&amp;&#160;&#34;/&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.ModificationDate.Month&#160;&amp;&#160;&#34;/&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.ModificationDate.Year&#160;&amp;&#160;&#160;&#34; &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.ModificationDate.Hours&#160;&amp;&#160;&#160;&#34;:&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.ModificationDate.Minutes&#160;&amp;&#160;&#160;&#34;:&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.ModificationDate.Seconds&#160;&amp;&#160;&#160;&#34;.&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.ModificationDate.HundredthSeconds&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;PrintDate : &#34;&#160;&amp;&#160;oDocProps.PrintDate.Month&#160;&amp;&#160;&#34;/&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.PrintDate.Day&#160;&amp;&#160;&#34;/&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.PrintDate.Year&#160;&amp;&#160;&#160;&#34; &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.PrintDate.Hours&#160;&amp;&#160;&#160;&#34;:&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.PrintDate.Minutes&#160;&amp;&#160;&#160;&#34;:&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.PrintDate.Seconds&#160;&amp;&#160;&#160;&#34;.&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.PrintDate.HundredthSeconds&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;PrintedBy : &#34;&#160;&amp;&#160;oDocProps.PrintedBy&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;Subject : &#34;&#160;&amp;&#160;oDocProps.Subject&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;TemplateDate : &#34;&#160;&amp;&#160;oDocProps.TemplateDate.Month&#160;&amp;&#160;&#34;/&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.TemplateDate.Day&#160;&amp;&#160;&#34;/&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.TemplateDate.Year&#160;&amp;&#160;&#160;&#34; &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.TemplateDate.Hours&#160;&amp;&#160;&#160;&#34;:&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.TemplateDate.Minutes&#160;&amp;&#160;&#160;&#34;:&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.TemplateDate.Seconds&#160;&amp;&#160;&#160;&#34;.&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; oDocProps.TemplateDate.HundredthSeconds&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;TemplateName : &#34;&#160;&amp;&#160;oDocProps.TemplateName&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;TemplateURL : &#34;&#160;&amp;&#160;oDocProps.TemplateURL&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;Title : &#34;&#160;&amp;&#160;oDocProps.Title&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Document Properties&#34;<br/>
297<br/>
<hr/>
<a name=301></a>&#160;&#160;Dim&#160;i%<br/>&#160; oData&#160;=&#160;oDocProps.DocumentStatistics<br/>&#160; s&#160;=&#160;&#34;&#34;<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(oData)&#160;To&#160;UBound(oData)<br/>&#160; &#160; s&#160;=&#160;s&#160;&amp;&#160;oData(i).Name&#160;&amp;&#160;&#34; : &#34;&#160;&amp;&#160;oData(i).Value&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Document Statistics&#34;<br/>
&#160; oData&#160;=&#160;oDocProps.Keywords<br/>&#160; s&#160;=&#160;&#34;&#34;<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(oData)&#160;To&#160;UBound(oData)<br/>&#160; &#160; s&#160;=&#160;s&#160;&amp;&#160;oData(i)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Keywords&#34;<br/>
&#160;&#160;'I have little experience with this object.&#160;<br/>&#160;&#160;'Seems that the user defined properties are available here.<br/>&#160;&#160;'com.sun.star.comp.comphelper.OPropertyBag<br/>&#160; oData&#160;=&#160;oDocProps.UserDefinedProperties<br/>End&#160;Sub<br/>
<b>&#160;13.4.1.&#160;Document&#160;properties&#160;from&#160;a&#160;closed&#160;document<br/></b>It&#160;is&#160;easy&#160;to access&#160;the&#160;document&#160;properties&#160;from&#160;a&#160;document&#160;that&#160;is&#160;not&#160;open.&#160;<br/>
<i><b>Listing&#160;277.</b>&#160;Read the&#160;document&#160;properties&#160;from&#160;a document&#160;that&#160;is&#160;not&#160;open.<br/></i>Sub&#160;loadExternalProperties<br/>&#160;&#160;Dim&#160;sPath$<br/>&#160;&#160;Dim&#160;sPathUrl<br/>&#160;&#160;Dim&#160;oDocProps<br/>&#160;&#160;sPath&#160;=&#160;ConvertToUrl(&#34;/andrew0/home/andy/MoveFigsFromFrames.odt&#34;)<br/>&#160;&#160;oDocProps&#160;=&#160;CreateUnoService(&#34;com.sun.star.document.DocumentProperties&#34;)<br/>&#160;&#160;oDocProps.loadFromMedium(sPath,&#160;Array())<br/>&#160;&#160;printDocProperties(oDocProps)<br/>End&#160;Sub<br/>
<b>&#160;13.4.2.&#160;Custom&#160;properties<br/></b>You can create&#160;and remove&#160;your own custom&#160;document&#160;properties.&#160;Use&#160;the&#160;PropertyAttribute&#160;constants&#160;<br/>shown in<a href="libremacros.html#302">&#160;Table&#160;103&#160;w</a>hile&#160;creating an attribute&#160;to control&#160;the&#160;behavior of created properties.<br/>
298<br/>
<hr/>
<a name=302></a><i>Table&#160;103. &#160;com.sun.star.beans.PropertyAttribute&#160;constants.</i><br/>
<i><b>Constant</b></i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
MAYBEVOID<br/>
1<br/>
The&#160;property&#160;value&#160;can be&#160;void.&#160;&#160;<br/>
BOUND<br/>
2<br/>
A&#160;PropertyChangeEvent&#160;will&#160;be&#160;fired to&#160;all&#160;registered&#160;property&#160;change&#160;<br/>listeners when the&#160;value&#160;of&#160;this property&#160;changes. &#160;<br/>
CONSTRAINED<br/>
4<br/>
A&#160;PropertyChangeEvent&#160;will&#160;be&#160;fired to&#160;all&#160;registered&#160;vetoable&#160;change&#160;<br/>listeners when the&#160;value&#160;of&#160;this property&#160;changes. &#160;<br/>
TRANSIENT<br/>
8<br/>
The&#160;property&#160;value&#160;is not&#160;saved&#160;with&#160;the&#160;document.<br/>
READONLY<br/>
16<br/>
The&#160;property&#160;value&#160;is read-only.<br/>
MAYBEAMBIGUOUS<br/>
32<br/>
The&#160;property&#160;value&#160;may&#160;be&#160;ambiguous.<br/>
MAYBEDEFAULT<br/>
64<br/>
The&#160;property&#160;can be&#160;set&#160;to&#160;default. &#160;<br/>
REMOVEABLE<br/>
128<br/>
The&#160;property&#160;can be&#160;removed.&#160;This&#160;used to be&#160;called REMOVABLE.<br/>
OPTIONAL<br/>
256<br/>
The&#160;property&#160;is optional.&#160;&#160;<br/>
Use&#160;addProperty(name,&#160;attributes, default_value) to&#160;create&#160;a&#160;new&#160;property&#160;and removeProperty(name) to&#160;<br/>remove&#160;a&#160;property&#160;from&#160;the&#160;document&#160;properties.&#160;When&#160;a&#160;property&#160;is&#160;created, that&#160;property&#160;is&#160;added to&#160;the&#160;<br/>document's&#160;properties,&#160;so you can use&#160;the&#160;property&#160;set&#160;information&#160;object&#160;<br/>
<i><b>Listing&#160;278.</b>&#160;Add a new&#160;document&#160;property.<br/></i>Sub&#160;AddNewDocumentProperty<br/>&#160;&#160;Dim&#160;oUDP<br/>&#160; oUDP&#160;=&#160;ThisComponent.getDocumentProperties().UserDefinedProperties<br/>&#160;&#160;If&#160;NOT&#160;oUDP.getPropertySetInfo().hasPropertyByName(&#34;AuthorLastName&#34;)&#160;Then<br/>&#160; &#160; oUDP.addProperty(&#34;AuthorLastName&#34;,&#160;_<br/>&#160; &#160; &#160; com.sun.star.beans.PropertyAttribute.MAYBEVOID&#160;+&#160;_<br/>&#160; &#160; &#160; com.sun.star.beans.PropertyAttribute.REMOVEABLE&#160;+&#160;_<br/>&#160; &#160; &#160; com.sun.star.beans.PropertyAttribute.MAYBEDEFAULT,&#160;_<br/>&#160; &#160; &#160;&#160;&#34;Default Last Name&#34;)<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub&#160;<br/>
<b>&#160;13.4.3.&#160;Deprecated&#160;document&#160;information&#160;object<br/></b>The&#160;deprecated method&#160;getDocumentInfo was&#160;the&#160;previous&#160;method for obtaining and modifying&#160;user data.&#160;<br/>The&#160;macro i<a href="libremacros.html#302">n&#160;Listing&#160;279&#160;s</a>ets&#160;the&#160;value&#160;of a&#160;user field and then displays&#160;its&#160;value.&#160;<br/>
<b>TIP</b><br/>
DocumentInfo and&#160;StandaloneDocumentInfo&#160;are&#160;deprecated&#160;and replaced&#160;by&#160;DocumentProperties.<br/>
<i><b>Listing&#160;279.</b>&#160;Deprecated method&#160;for&#160;getting&#160;and setting user&#160;information data.<br/></i>Sub&#160;GetUserInfoFields<br/>&#160;&#160;Dim&#160;vDocInfo&#160;&#160;'Document Information Object<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160;&#160;'General string to print<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;vDocInfo&#160;=&#160;ThisComponent.getDocumentInfo()<br/>&#160;&#160;vDocInfo.setUserFieldValue(1,&#160;&#34;My special user value&#34;)<br/>&#160;&#160;For&#160;i%&#160;=&#160;0&#160;To&#160;vDocInfo().getUserFieldCount()-1<br/>&#160; &#160;&#160;s$&#160;=&#160;s$&#160;&amp;&#160;vDocInfo.getUserFieldName(i)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;CStr(vDocInfo.getUserFieldValue(i))&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>
299<br/>
<hr/>
<a name=303></a>&#160;&#160;MsgBox&#160;s$,&#160;0,&#160;&#34;Info Fields&#34;<br/>End&#160;Sub<br/>
<i><b>&#160;13.5.&#160;List&#160;events<br/></b></i>As&#160;OOo operates, it&#160;generates&#160;events&#160;to&#160;inform&#160;listeners&#160;that&#160;something has&#160;occurred.&#160;The&#160;event&#160;<br/>listener/supplier framework allows&#160;a&#160;macro to be&#160;called&#160;or a&#160;listener to&#160;be&#160;notified&#160;when a&#160;specific&#160;event&#160;<br/>occurs&#160;— for example,&#160;when a&#160;document&#160;is&#160;loaded or modified, or when text&#160;selection&#160;changes. Each&#160;<br/>document&#160;type&#160;supports&#160;the&#160;two interfaces&#160;com.sun.star.document.XEventBroadcaster and&#160;<br/>com.sun.star.document.XEventsSupplier,&#160;allowing them&#160;to&#160;support&#160;event-related&#160;activities&#160;— for example,&#160;<br/>broadcasting events&#160;to listeners&#160;and providing a&#160;list&#160;of supported events.&#160;<br/>
The&#160;macro i<a href="libremacros.html#303">n&#160;Listing&#160;280&#160;l</a>ists&#160;the&#160;event&#160;listeners&#160;registered with&#160;the&#160;current&#160;document&#160;and for OOo.&#160;Another<br/>use&#160;for this&#160;macro is&#160;to list&#160;the&#160;events&#160;supported by&#160;the&#160;document.&#160;Although there&#160;are&#160;no registered listeners,&#160;<br/>this&#160;macro provides&#160;a&#160;nice&#160;list&#160;of the&#160;supported&#160;event&#160;types.&#160;<br/>
<i><b>Listing&#160;280.</b>&#160;List&#160;the&#160;document's&#160;events.</i><br/>
Sub&#160;DisplayAvailableEvents<br/>&#160; Dim&#160;oGEB&#160; &#160;' GlobalEventBroadcaster<br/>&#160; Dim&#160;oDoc<br/>&#160; Dim&#160;s$<br/>&#160; Dim&#160;oText<br/>&#160;<br/>&#160;&#160;oDoc&#160;= StarDesktop.LoadComponentFromUrl(&#34;private:factory/swriter&#34;,&#160;&#34;_blank&#34;,&#160;0, Array())<br/>&#160;&#160;oGEB&#160;= createUnoservice(&#34;com.sun.star.frame.GlobalEventBroadcaster&#34;)<br/>&#160;&#160;s&#160;= Join(oGEB.Events.getElementNames(), CHR$(10))<br/>&#160;&#160;oText&#160;=&#160;oDoc.Text<br/>&#160;&#160;oText.InsertString(oText.End,&#160;&#34;===Global Events&#34;&#160;&amp; CHR$(10),&#160;False)<br/>&#160;&#160;oText.InsertString(oText.End,&#160;s,&#160;False)<br/>
&#160;&#160;s&#160;= Join(oDoc.Events.getElementNames(), CHR$(10))<br/>&#160;&#160;oText.InsertString(oText.End, CHR$(10) &amp; CHR$(10) &amp;&#160;&#34;===Writer Events&#34;&#160;&amp; CHR$(10),&#160;False)<br/>&#160;&#160;oText.InsertString(oText.End,&#160;s,&#160;False)<br/>End Sub<br/>
Here&#160;is&#160;a&#160;list&#160;of events:<br/>
1.&#160;OnStartApp<br/>
2.&#160;OnCloseApp<br/>
3.&#160;OnCreate<br/>
4.&#160;OnNew<br/>
5.&#160;OnLoadFinished<br/>
6.&#160;OnLoad<br/>
7.&#160;OnPrepareUnload<br/>
8.&#160;OnUnload<br/>
9.&#160;OnSave<br/>
10.&#160;OnSaveDone<br/>
300<br/>
<hr/>
<a name=304></a>11.&#160;OnSaveFailed<br/>
12.&#160;OnSaveAs<br/>
13.&#160;OnSaveAsDone<br/>
14.&#160;OnSaveAsFailed<br/>
15.&#160;OnCopyTo<br/>
16.&#160;OnCopyToDone<br/>
17.&#160;OnCopyToFailed<br/>
18.&#160;OnFocus<br/>
19.&#160;OnUnfocus<br/>
20.&#160;OnPrint<br/>
21.&#160;OnViewCreated<br/>
22.&#160;OnPrepareViewClosing<br/>
23.&#160;OnViewClosed<br/>
24.&#160;OnModifyChanged<br/>
25.&#160;OnTitleChanged<br/>
26.&#160;OnVisAreaChanged<br/>
27.&#160;OnModeChanged<br/>
28.&#160;OnStorageChanged<br/>
29.&#160;OnPageCountChange<br/>
30.&#160;OnMailMerge<br/>
31.&#160;OnMailMergeFinished<br/>
32.&#160;OnFieldMerge<br/>
33.&#160;OnFieldMergeFinished<br/>
34.&#160;OnLayoutFinished<br/>
<b>TIP</b><br/>
Many&#160;objects besides documents support&#160;event&#160;listeners.&#160;For&#160;example,&#160;you can&#160;listen&#160;<br/>
to an individual&#160;cell&#160;in&#160;a&#160;Calc&#160;document.<br/>
<b>&#160;13.5.1.&#160;Registering&#160;your&#160;own&#160;listener<br/></b>The&#160;macro i<a href="libremacros.html#303">n&#160;Listing&#160;280&#160;us</a>es&#160;the&#160;GlobalEventBroadcaster to&#160;access&#160;event&#160;listeners&#160;at&#160;the&#160;OOo level.&#160;The&#160;<br/>macro i<a href="libremacros.html#304">n&#160;Listing&#160;281&#160;re</a>places&#160;the&#160;documents&#160;OnSave&#160;listener with a&#160;macro named MySave, in Module1,&#160;in&#160;<br/>the&#160;Standard library&#160;for My&#160;Macros.&#160;When the&#160;document&#160;is&#160;saved, MySave&#160;is&#160;automatically&#160;called.&#160;The&#160;<br/>association&#160;is&#160;maintained&#160;even after closing&#160;and opening&#160;the&#160;document.<br/>
<i><b>Listing&#160;281.</b>&#160;Register&#160;your&#160;own listener.<br/></i>Sub&#160;StealAnEvent<br/>&#160;&#160;Dim&#160;mEventProps(1)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>
301<br/>
<hr/>
<a name=305></a>&#160;&#160;mEventProps(0).Name&#160;=&#160;&#34;EventType&#34;<br/>&#160;&#160;mEventProps(0).Value&#160;=&#160;&#34;StarBasic&#34;<br/>&#160;&#160;mEventProps(1).Name&#160;=&#160;&#34;Script&#34;<br/>&#160;&#160;mEventProps(1).Value&#160;=&#160;&#34;macro:///Standard.Module1.MySave()&#34;<br/>&#160;<br/>
&#160;&#160;'oGlobalEventBroadcaster = createUnoservice(&#34;com.sun.star.frame.GlobalEventBroadcaster&#34;)<br/>&#160;&#160;'oGlobalEventBroadcaster.Events.ReplaceByName(&#34;OnStartApp&#34;, mEventProps())<br/>&#160;&#160;ThisComponent.Events.ReplaceByName(&#34;OnSave&#34;,&#160;mEventProps())<br/>End&#160;Sub<br/>
<b>Warn</b><br/>
Use&#160;the&#160;location “macro://hello/Standard.Module1.MySave()”&#160;to specify&#160;a&#160;macro&#160;in the&#160;document&#160;named&#160;<br/>“hello.odt”.&#160;Although this works fine, the&#160;association&#160;is not&#160;lost&#160;when the&#160;document&#160;is closed.<br/>
An event&#160;can just&#160;as&#160;easily&#160;be&#160;stored at&#160;the&#160;OOo level&#160;by&#160;using the&#160;GlobalEventBroadcaster.&#160;<br/>
Do not&#160;mistake&#160;the&#160;value&#160;location&#160;for the&#160;same&#160;URL&#160;type&#160;syntax&#160;used to associate&#160;a&#160;form&#160;control&#160;to&#160;a&#160;macro:<br/>
&#34;vnd.sun.star.script:Standard.Module1.LocalMySave?language=Basic&amp;location=document&#34;<br/>
<b>&#160;13.5.2.&#160;Intercepting&#160;dispatch&#160;commands<br/></b>Replacing a&#160;listener event&#160;is&#160;not&#160;the&#160;same&#160;as&#160;intercepting the&#160;<b>File&#160;&gt;&#160;Save</b>&#160;dispatch, this&#160;is&#160;merely&#160;a&#160;listener&#160;<br/>used after the&#160;command has&#160;been executed. Intercepting a&#160;dispatch will&#160;look more&#160;like&#160;this&#160;code&#160;provided&#160;by<br/>Paolo Montavoni. One&#160;of the&#160;problems&#160;with this&#160;is&#160;that&#160;a&#160;status&#160;listener is&#160;not&#160;used, so, if&#160;a&#160;command is&#160;<br/>disabled, the&#160;menu will&#160;not&#160;show&#160;the&#160;command as&#160;disabled.&#160;<br/>
<b>Warn</b><br/>
Be&#160;very&#160;careful&#160;while&#160;writing&#160;listeners and&#160;intercepting&#160;dispatches.&#160;Assume&#160;that&#160;something&#160;will&#160;change, or&#160;<br/>
that&#160;you&#160;did something&#160;wrong&#160;and that&#160;OOo&#160;will&#160;crash;&#160;you have&#160;been warned.&#160;<br/>
<i><b>Listing&#160;282.</b>&#160;Replace&#160;a few&#160;menu commands.</i><br/>
Global&#160;oDispatchInterceptor<br/>Global&#160;oSlaveDispatchProvider<br/>Global&#160;oMasterDispatchProvider<br/>Global&#160;oFrame<br/>Global&#160;bDebug&#160;As&#160;Boolean<br/>
Dim&#160;oCopyDispatch<br/>
Sub&#160;RegisterInterceptor<br/>&#160;&#160;oFrame&#160;=&#160;ThisComponent.currentController.Frame<br/>&#160;&#160;oDispatchInterceptor&#160;=&#160;CreateUnoListener(&#34;ThisFrame_&#34;,&#160;_<br/>&#160; &#160;&#160;&#34;com.sun.star.frame.XDispatchProviderInterceptor&#34;)<br/>&#160;&#160;oFrame.registerDispatchProviderInterceptor(oDispatchInterceptor)<br/>End&#160;Sub<br/>
Sub&#160;ReleaseInterceptor()<br/>On&#160;Error&#160;Resume&#160;Next<br/>&#160;&#160;oFrame.releaseDispatchProviderInterceptor(oDispatchInterceptor)<br/>End&#160;Sub<br/>
Function&#160;ThisFrame_queryDispatch&#160;(&#160;oUrl,&#160;_<br/>&#160;&#160;sTargetFrameName&#160;As&#160;String,&#160;lSearchFlags&#160;As&#160;Long&#160;)&#160;As&#160;Variant<br/>
302<br/>
<hr/>
<a name=306></a>&#160;&#160;<br/>Dim&#160;oDisp<br/>Dim&#160;sUrl&#160;As&#160;String<br/>
&#160;&#160;'slot protocol causes OOo crash...<br/>&#160;&#160;if&#160;oUrl.Protocol&#160;=&#160;&#34;slot:&#34;&#160;Then<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;If&#160;bDebug&#160;Then<br/>&#160; &#160;&#160;Print&#160;oUrl.complete<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;'do your dispatch management here:<br/>&#160;&#160;Select&#160;Case&#160;oUrl.complete<br/>&#160;&#160;<br/>&#160; &#160;&#160;Case&#160;&#34;.uno:Copy&#34;&#160;<br/>&#160; &#160; &#160;&#160;oDisp&#160;=&#160;GetCopyDispatch&#160;'replace the original dispatch<br/>&#160; &#160;&#160;Case&#160;&#34;.uno:Paste&#34;&#160;<br/>&#160; &#160; &#160;&#160;oDisp&#160;=&#160;GetCopyDispatch&#160;'replace the original dispatch<br/>&#160; &#160;&#160;Case&#160;&#34;.uno:Save&#34;&#160;<br/>&#160; &#160; &#160;&#160;oDisp&#160;=&#160;GetCopyDispatch&#160;'replace the original dispatch<br/>&#160; &#160;&#160;Case&#160;&#34;.uno:Undo&#34;<br/>&#160; &#160; &#160;&#160;oDisp&#160;=&#160;GetCopyDispatch&#160;'replace the original dispatch<br/>&#160; &#160;&#160;'Case &#34;.uno:blabla&#34;<br/>&#160; &#160; &#160;&#160;'do something<br/>&#160; &#160;&#160;Case&#160;Else<br/>&#160; &#160; &#160;&#160;oDisp&#160;=&#160;_<br/>&#160; &#160; &#160;&#160;oSlaveDispatchProvider.queryDispatch(&#160;oUrl,&#160;sTargetFrameName,&#160;lSearchFlags&#160;)<br/>&#160; &#160; &#160;&#160;<br/>&#160;&#160;End&#160;Select<br/>&#160;&#160;<br/>&#160;&#160;ThisFrame_queryDispatch&#160;=&#160;oDisp<br/>
End&#160;Function<br/>
Function&#160;ThisFrame_queryDispatches&#160;(&#160;mDispatches&#160;)&#160;As&#160;Variant<br/>&#160;&#160;'ThisFrame_queryDispatches = mDispatches()<br/>End&#160;Function<br/>
Function&#160;ThisFrame_getSlaveDispatchProvider&#160;(&#160;)&#160;As&#160;Variant<br/>&#160;&#160;ThisFrame_getSlaveDispatchProvider&#160;=&#160;oSlaveDispatchProvider<br/>End&#160;Function<br/>
Sub&#160;ThisFrame_setSlaveDispatchProvider&#160;(&#160;oSDP&#160;)<br/>&#160;&#160;oSlaveDispatchProvider&#160;=&#160;oSDP<br/>End&#160;Sub<br/>
Function&#160;ThisFrame_getMasterDispatchProvider&#160;(&#160;)&#160;&#160;As&#160;Variant<br/>&#160;&#160;ThisFrame_getMasterDispatchProvider&#160;=&#160;oMasterDispatchProvider<br/>End&#160;Function<br/>
Sub&#160;ThisFrame_setMasterDispatchProvider&#160;(&#160;oMDP&#160;)&#160;<br/>
303<br/>
<hr/>
<a name=307></a>&#160;&#160;oMasterDispatchProvider&#160;=&#160;oMDP<br/>End&#160;Sub<br/>
Sub&#160;toggleDebug<br/>&#160;&#160;bDebug&#160;=&#160;Not&#160;bDebug<br/>End&#160;Sub<br/>
Function&#160;GetCopyDispatch()<br/>&#160;&#160;If&#160;Not&#160;IsNull(oCopyDispatch)&#160;Then<br/>&#160; &#160;&#160;oCopyDispatch&#160;=&#160;_<br/>&#160; &#160; &#160;&#160;CreateUnoListener(&#34;MyCustom_&#34;,&#160;&#34;com.sun.star.frame.XDispatch&#34;)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;GetCopyDispatch&#160;=&#160;oCopyDispatch<br/>
End&#160;Function<br/>
Sub&#160;MyCustom_dispatch(URL,&#160;Arguments)<br/>&#160;&#160;Select&#160;Case&#160;URL.complete<br/>&#160; &#160;&#160;Case&#160;&#34;.uno:Copy&#34;&#160;<br/>&#160; &#160; &#160;&#160;MsgBox&#160;&#34;Sorry, the original &#34;&#160;&amp;&#160;URL.complete&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160;&#160;&#34; dispatch was stolen from Paolo M.&#34;,&#160;48<br/>&#160; &#160; &#160;&#160;<br/>&#160; &#160;&#160;Case&#160;&#34;.uno:Paste&#34;&#160;<br/>&#160; &#160; &#160;&#160;ThisComponent.CurrentSelection(0).String&#160;=&#160;_<br/>&#160; &#160; &#160; &#160;&#160;&#34;**** ARBITRARY CLIPBOARD CONTENT PROVIDED BY PAOLO M. ****&#34;<br/>&#160; &#160;&#160;Case&#160;&#34;.uno:Save&#34;&#160;<br/>&#160; &#160; &#160;&#160;MsgBox&#160;&#34;Sorry, the original &#34;&#160;&amp;&#160;URL.complete&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160;&#160;&#34; dispatch was stolen from Paolo M.&#34;,&#160;48<br/>&#160; &#160; &#160;&#160;<br/>&#160; &#160;&#160;Case&#160;&#34;.uno:Undo&#34;<br/>&#160; &#160; &#160;&#160;MsgBox&#160;&#34;Undo What????!!!???&#34;,&#160;16<br/>
&#160; &#160;&#160;Case&#160;Else<br/>
&#160;&#160;End&#160;Select<br/>End&#160;Sub<br/>
Sub&#160;MyCustom_addStatusListener(Control,&#160;URL)<br/>End&#160;Sub<br/>
Sub&#160;MyCustom_removeStatusListener&#160;(Control,&#160;URL)<br/>End&#160;Sub&#160;<br/>
A&#160;similar&#160;method&#160;has&#160;been used to&#160;intercept&#160;context&#160;menus&#160;using a&#160;XContextMenuInterceptor.<br/>
<i><b>&#160;13.6.&#160;Link&#160;targets<br/></b></i>Link targets, also called&#160;“jump&#160;marks,”&#160;can be&#160;used to&#160;jump&#160;directly&#160;to&#160;a&#160;specific&#160;location.&#160;The&#160;document&#160;<br/>navigator contains&#160;a&#160;list&#160;of link&#160;targets.&#160;The&#160;object&#160;method&#160;getLinks(), defined by&#160;the&#160;<br/>com.sun.star.document.XLinkTargetSupplier interface, provides&#160;access&#160;to&#160;the&#160;link targets.&#160;The&#160;getLinks()&#160;<br/>method&#160;returns&#160;an object&#160;that&#160;supports&#160;the&#160;XNameAccess&#160;interface. In&#160;other words, you&#160;can access&#160;the&#160;links&#160;<br/>using the&#160;methods&#160;getByName(), getElementNames(), hasByName(), and hasElements().<br/>
304<br/>
<hr/>
<a name=308></a>The&#160;object&#160;returned by&#160;the&#160;getLinks() method does&#160;not&#160;access&#160;the&#160;links&#160;directly,&#160;but&#160;rather it&#160;provides&#160;access&#160;<br/>to other objects&#160;that&#160;can.&#160;To&#160;access&#160;all&#160;of the&#160;individual&#160;links,&#160;first&#160;use&#160;the&#160;getLinks() method&#160;to access&#160;the&#160;<br/>master list&#160;of links. Use&#160;this&#160;returned object&#160;to&#160;access&#160;each “family”&#160;of links&#160;based on the&#160;family&#160;name.&#160;For&#160;<br/>example,&#160;to obtain an object&#160;that&#160;can access&#160;all&#160;of the&#160;table&#160;links, use:<br/>
oDoc.getLinks().getByName(&#34;Tables&#34;)<br/>
After obtaining a&#160;family&#160;of links, you can also obtain the&#160;individual&#160;links&#160;by&#160;name.&#160;At&#160;this&#160;final&#160;step, you&#160;<br/>have&#160;access&#160;to&#160;both the&#160;name&#160;of the&#160;link and the&#160;object&#160;that&#160;is&#160;linked.&#160;The&#160;macro in<a href="libremacros.html#308">&#160;Listing 283&#160;obt</a>ains&#160;all&#160;of<br/>the&#160;link families&#160;and the&#160;links&#160;that&#160;they&#160;contain,&#160;and then&#160;displays&#160;the&#160;link’s&#160;name&#160;in a&#160;newly&#160;created&#160;Write&#160;<br/>document.<br/>
<i><b>Listing&#160;283.</b>&#160;Get&#160;jump targets&#160;for&#160;the&#160;current&#160;document.<br/></i>Sub&#160;GetJumpTargets<br/>&#160;&#160;Dim&#160;sLinkNames&#160;&#160;'Tables, Text Frames, Headings, Bookmarks, etc...<br/>&#160;&#160;Dim&#160;vOneLink&#160; &#160;&#160;'One link type<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160;&#160;'General string<br/>&#160;&#160;Dim&#160;vtemp<br/>&#160;&#160;Dim&#160;oNewDoc<br/>&#160;&#160;Dim&#160;noArgs()&#160; &#160; &#160; &#160; &#160;&#160;'An empty array for the arguments<br/>&#160;&#160;Dim&#160;vComp&#160; &#160; &#160; &#160; &#160; &#160; &#160;'The loaded component<br/>&#160;&#160;Dim&#160;sURLs()&#160; &#160; &#160; &#160; &#160; &#160;'URLs of the new document types to load<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160; &#160;&#160;'URL of the document to load<br/>&#160;&#160;Dim&#160;oText<br/>&#160;&#160;<br/>&#160;&#160;sURL&#160;=&#160;&#34;private:factory/swriter&#34;<br/>&#160;&#160;vComp&#160;=&#160;StarDesktop.LoadComponentFromUrl(sURL,&#160;&#34;_blank&#34;,&#160;0,&#160;noArgs())<br/>&#160;&#160;oText&#160;=&#160;vComp.Text<br/>&#160;&#160;oText.insertString(oText.End,&#160;&#34;LINK TYPES&#34;&#160;&amp;&#160;CHR$(10),&#160;False)<br/>&#160;&#160;sLinkNames&#160;=&#160;ThisComponent.getLinks().getElementNames()<br/>&#160;&#160;oText.insertString(oText.End,&#160;Join(sLinkNames,&#160;Chr$(10)),&#160;False)<br/>&#160;&#160;oText.insertString(oText.End,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;CHR$(10)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;JUMP TARGETS&#34;&#160;&amp;&#160;CHR$(10),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;False)<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;UBound(sLinkNames)<br/>&#160; &#160;&#160;vOneLink&#160;=&#160;ThisComponent.getLinks().getByName(sLinkNames(i))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sLinkNames(i)&#160;&amp;&#160;&#34; = &#34;<br/>&#160; &#160;&#160;If&#160;IsEmpty(vOneLink)&#160;Then<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Empty&#34;<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sLinkNames(i)&#160;&amp;&#160;&#34; : &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160;&#160;Join(vOneLink.getElementNames(),&#160;CHR$(10)&#160;&amp;&#160;sLinkNames(i)&#160;&amp;&#160;&#34; : &#34;&#160;)<br/>&#160; &#160; &#160;&#160;REM To obtain the actual link object, such as a<br/>&#160; &#160; &#160;&#160;REM text table or a graphics object, use the following<br/>&#160; &#160; &#160;&#160;REM vtemp = vOneLink.getElementNames()<br/>&#160; &#160; &#160;&#160;REM vObj = vOneLink.getByName(vtemp(0))<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;'MsgBox s, 0, &#34;Jump Targets&#34;<br/>&#160;&#160;oText.insertString(oText.End,&#160;s,&#160;False)<br/>End&#160;Sub<br/>
305<br/>
<hr/>
<a name=309></a>You can use&#160;jump&#160;marks&#160;(link targets) to&#160;jump directly&#160;to a&#160;specific&#160;location when a&#160;document&#160;is&#160;loaded. Use<br/>jump&#160;marks&#160;to focus&#160;the&#160;cursor at&#160;a&#160;specific&#160;location when a&#160;document&#160;is&#160;opened, as&#160;shown in<a href="libremacros.html#309">&#160;Listing 284.&#160;<br/></a>The&#160;JumpMark attribute&#160;sets&#160;the&#160;name&#160;from&#160;the&#160;values&#160;shown in&#160;the&#160;created&#160;document&#160;(if you run the&#160;macro&#160;<br/>above);&#160;for example,&#160;“Table1|table”&#160;jumps&#160;to&#160;the&#160;specified table.<br/>
<i><b>Listing&#160;284.</b>&#160;Use&#160;the&#160;JumpMark&#160;property&#160;to jump to&#160;a link&#160;target.<br/></i>Dim&#160;Props(0)<br/>Props(0).Name&#160;=&#160;&#34;JumpMark&#34;<br/>Props(0).Value&#160;=&#160;&#34;Table1|table&#34;<br/>sUrl&#160;=&#160;&#34;file://c:/docs/Special_doc.odt&#34;<br/>vDoc&#160;=&#160;StarDesktop.LoadComponentFromUrl(sUrl,&#160;&#34;_blank&#34;,&#160;0,&#160;Props())<br/>
You can also use&#160;the&#160;jump mark as&#160;part&#160;of the&#160;URL&#160;(see<a href="libremacros.html#309">&#160;Listing 285)</a>&#160;by&#160;placing&#160;it&#160;at&#160;the&#160;end of the&#160;URL&#160;<br/>separated by&#160;an octothorpe&#160;character (#). If&#160;the&#160;jump&#160;mark contains&#160;any&#160;special&#160;characters, such as&#160;spaces,&#160;<br/>they&#160;must&#160;be&#160;encoded using standard URL&#160;notation.&#160;For example, a&#160;space&#160;is&#160;encoded as&#160;%20.<br/>
<i><b>Listing&#160;285.</b>&#160;Use&#160;the&#160;JumpMark&#160;property&#160;to jump to&#160;a link&#160;target.<br/></i>sUrl&#160;=&#160;&#34;file://c:/docs/Special_doc.odt#Table1|table&#34;<br/>vDoc&#160;=&#160;StarDesktop.LoadComponentFromUrl(sUrl,&#160;&#34;_blank&#34;,&#160;0,&#160;Props())<br/>
<b>TIP</b><br/>
The&#160;character&#160;“#”&#160;has&#160;many&#160;names, including:&#160;number&#160;sign, pound&#160;sign,&#160;hash, sharp,&#160;crunch, hex, grid,&#160;<br/>pigpen, tic-tac-toe,&#160;splat,&#160;crosshatch, and octothorpe,&#160;to name&#160;a&#160;few.&#160;<br/>
<i><b>&#160;13.7.&#160;Accessing&#160;view&#160;data:&#160;XViewDataSupplier<br/></b></i>Using&#160;OOo, open a&#160;document,&#160;edit&#160;it&#160;or change&#160;something (for example, move&#160;to another page&#160;or change&#160;the<br/>zoom&#160;factor), close&#160;the&#160;document,&#160;and open the&#160;document&#160;again.&#160;When&#160;you&#160;do this, the&#160;document&#160;opens&#160;at&#160;<br/>the&#160;same&#160;screen location, at&#160;the&#160;same&#160;size, with&#160;the&#160;same&#160;zoom&#160;factor as&#160;was&#160;active&#160;when it&#160;was&#160;last&#160;saved.&#160;<br/>This&#160;information&#160;is&#160;stored with&#160;the&#160;document&#160;and is&#160;available&#160;through the&#160;interface&#160;<br/>com.sun.star.document.XViewDataSupplier.&#160;This&#160;interface&#160;provides&#160;one&#160;object&#160;method, getViewData(<a href="libremacros.html#309">).<br/>Listing 286&#160;di</a>splays&#160;the&#160;view&#160;data&#160;for&#160;ThisComponent&#160;(see<a href="libremacros.html#310">&#160;Figure&#160;83)</a>.<br/>
<i><b>Listing&#160;286.</b>&#160;GetViewData&#160;is&#160;found&#160;in&#160;the</i><br/>
Sub&#160;GetViewData<br/>&#160;&#160;Dim&#160;vViewData&#160;'View data object<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;j%&#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160;&#160;'General string<br/>&#160;&#160;Dim&#160;vtemp&#160; &#160; &#160;'View data for one object<br/>&#160;&#160;vViewData&#160;=&#160;ThisComponent.getViewData()<br/>&#160;&#160;REM For each view of the data<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;vViewData.getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;vtemp&#160;=&#160;vViewData.getByIndex(i)<br/>&#160; &#160;&#160;For&#160;j&#160;=&#160;0&#160;To&#160;UBound(vtemp)<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vtemp(j).Name&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;CStr(vtemp(j).Value)&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;Next<br/>&#160; &#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;View Data&#34;<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
306<br/>
<hr/>
<a name=310></a><i><b>Figure&#160;83.</b>&#160;View data&#160;for&#160;a document.</i><br/>
<i><b>&#160;13.8.&#160;Close&#160;a&#160;document:&#160;XCloseable<br/></b></i>As&#160;of OOo 1.1.0, each document&#160;type&#160;supports&#160;the&#160;com.sun.star.util.XCloseable&#160;interface.&#160;To&#160;close&#160;these&#160;<br/>objects, call&#160;the&#160;object&#160;method close(bForce). If&#160;bForce&#160;is&#160;True, the&#160;object&#160;must&#160;close. In&#160;other words, it&#160;may&#160;<br/>not&#160;refuse&#160;to&#160;close. If,&#160;however,&#160;bForce&#160;is&#160;False, the&#160;object&#160;may&#160;refuse&#160;to&#160;close.<br/>
Before&#160;a&#160;document&#160;is&#160;closed, a&#160;message&#160;is&#160;sent&#160;to all&#160;registered listeners, giving them&#160;an opportunity&#160;to&#160;<br/>prevent&#160;the&#160;closure. If&#160;the&#160;close&#160;request&#160;is&#160;not&#160;vetoed&#160;by&#160;any&#160;listener,&#160;a&#160;message&#160;is&#160;sent&#160;to&#160;each registered&#160;<br/>listener,&#160;advising&#160;them&#160;that&#160;the&#160;document&#160;will&#160;close.&#160;The&#160;XCloseBroadcaster interface&#160;provides&#160;methods&#160;to&#160;<br/>add and remove&#160;a&#160;close&#160;listener (see<a href="libremacros.html#310">&#160;Table&#160;104)</a>.<br/>
<i>Table&#160;104. Object&#160;methods&#160;defined by&#160;the&#160;interface&#160;XCloseBroadcaster.</i><br/>
<i><b>Object&#160;Method</b></i><br/>
<i><b>Description</b></i><br/>
addCloseListener(XCloseListener)<br/>
Add listener&#160;to receive&#160;or&#160;have&#160;a&#160;veto for&#160;“close”&#160;events.<br/>
removeCloseListener(XCloseListener)<br/>
Remove&#160;an object&#160;registered as a&#160;close&#160;listener&#160;using&#160;addCloseListener().<br/>
The&#160;macro i<a href="libremacros.html#310">n&#160;Listing&#160;287&#160;de</a>monstrates&#160;the&#160;safe&#160;way&#160;to close&#160;a&#160;document&#160;using the&#160;object’s&#160;close() method.&#160;<br/>For&#160;versions&#160;of OOo prior to&#160;1.1.0, the&#160;close() method is&#160;not&#160;available, so you must&#160;use&#160;the&#160;dispose() method<br/>instead.&#160;The&#160;dispose() method is&#160;unconditional&#160;and is&#160;not&#160;the&#160;preferred method&#160;to close&#160;a&#160;document&#160;(by&#160;<br/>document&#160;I&#160;really&#160;mean any&#160;object&#160;that&#160;supports&#160;both close&#160;and dispose) because&#160;it&#160;doesn’t&#160;allow&#160;a&#160;registered<br/>user who might&#160;be&#160;using the&#160;document&#160;to&#160;veto the&#160;close&#160;and finish what&#160;he&#160;or she&#160;is&#160;doing.<br/>
<i><b>Listing&#160;287.</b>&#160;The&#160;safe&#160;way&#160;to&#160;close&#160;a document.</i><br/>
If&#160;HasUnoInterfaces(oDoc,&#160;&#34;com.sun.star.util.XCloseable&#34;)&#160;Then<br/>&#160;&#160;oDoc.close(true)<br/>Else<br/>&#160;&#160;oDoc.dispose()<br/>End&#160;If<br/>
<b>TIP</b><br/>
Do not&#160;use&#160;dispose&#160;to close&#160;a&#160;document, it&#160;is&#160;there&#160;for&#160;legacy&#160;purposes.&#160;Assume, for&#160;example, that&#160;you start&#160;<br/>printing&#160;a&#160;document&#160;and&#160;then immediately&#160;dispose()&#160;the&#160;document.&#160;The&#160;document&#160;that&#160;is&#160;being&#160;used&#160;for&#160;<br/>
printing&#160;is&#160;suddenly&#160;gone&#160;and&#160;OOo&#160;crashes.<br/>
307<br/>
<hr/>
<a name=311></a><i><b>&#160;13.9.&#160;Draw&#160;Pages:&#160;XDrawPagesSupplier&#160;</b></i><br/>
<b>&#160;13.9.1.&#160;Draw&#160;and&#160;Impress<br/></b>Draw&#160;and Impress&#160;are&#160;almost&#160;identical&#160;in&#160;the&#160;interfaces&#160;that&#160;they&#160;support. Draw&#160;is&#160;specifically&#160;designed to&#160;<br/>handle&#160;independent&#160;graphic&#160;objects,&#160;whereas&#160;Impress&#160;is&#160;designed for business&#160;effects&#160;and presentations.&#160;The&#160;<br/>drawing functionality&#160;of Draw&#160;and Impress&#160;is&#160;identical, however.&#160;The&#160;graphic&#160;objects&#160;are&#160;drawn and&#160;<br/>displayed on “draw&#160;pages.”&#160;By&#160;their&#160;design, both Draw&#160;and Impress&#160;support&#160;multiple&#160;draw&#160;pages.&#160;The&#160;<br/>functionality&#160;to&#160;retrieve&#160;a&#160;DrawPage&#160;object&#160;is&#160;defined by&#160;the&#160;com.sun.star.drawing.XDrawPagesSupplier&#160;<br/>interface.&#160;The&#160;interface&#160;com.sun.star.drawing.XDrawPages&#160;defines&#160;methods&#160;to&#160;retrieve, insert,&#160;and remove&#160;<br/>individual&#160;pages&#160;(see<a href="libremacros.html#311">&#160;Table&#160;105).</a><br/>
<i>Table&#160;105. Object&#160;methods&#160;defined by&#160;the&#160;interface&#160;XDrawPages.</i><br/>
<i><b>Object&#160;Method</b></i><br/>
<i><b>Description</b></i><br/>
InsertNewByIndex(index)&#160;<br/>
Create&#160;and&#160;insert&#160;a&#160;new&#160;draw&#160;page&#160;or&#160;master&#160;page.<br/>
remove(XDrawPage)&#160;<br/>
Remove&#160;a&#160;draw&#160;page&#160;or&#160;master&#160;page.<br/>
getCount()&#160;<br/>
Return the&#160;number&#160;of&#160;draw&#160;pages.<br/>
getByIndex(index)&#160;<br/>
Return a&#160;specific&#160;draw&#160;page.<br/>
hasElements()<br/>
Return&#160;True&#160;if&#160;there&#160;are&#160;documents.<br/>
The&#160;macro i<a href="libremacros.html#311">n&#160;Listing&#160;288&#160;de</a>monstrates&#160;how&#160;to&#160;iterate&#160;through each of the&#160;draw&#160;pages. Each draw&#160;page&#160;is&#160;<br/>exported&#160;to a&#160;JPG&#160;file.&#160;The&#160;export&#160;type&#160;is&#160;specified by&#160;the&#160;MediaType&#160;property.<br/>
<i><b>Listing&#160;288.</b>&#160;Export&#160;each graphics&#160;page&#160;to a JPG.<br/></i>oFilter=CreateUnoService(&#34;com.sun.star.drawing.GraphicExportFilter&#34;)<br/>Dim&#160;args(1)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>For&#160;i=0&#160;to&#160;oDoc.getDrawPages().getcount()-1<br/>&#160;&#160;oPage&#160;=&#160;oDoc.getDrawPages().getByIndex(i)<br/>&#160;&#160;name&#160;=&#160;oPage.name<br/>&#160;&#160;oFilter.setSourceDocument(opage)<br/>&#160;&#160;args(0).Name&#160;=&#160;&#34;URL&#34;<br/>&#160;&#160;args(0).Value&#160;=&#160;&#160;&#34;file:///c|/&#34;&amp;oPage.name&amp;&#34;.JPG&#34;<br/>&#160;&#160;args(1).Name&#160;=&#160;&#34;MediaType&#34;<br/>&#160;&#160;args(1).Value&#160;=&#160;&#34;image/jpeg&#34;<br/>&#160;&#160;oFilter.filter(args())<br/>Next<br/>
<b>TIP</b><br/>
The&#160;index&#160;used&#160;to access draw&#160;pages&#160;is zero&#160;based.&#160;This&#160;means that&#160;the&#160;first&#160;draw&#160;page&#160;is at&#160;location 0.&#160;If&#160;a&#160;<br/>document&#160;contains&#160;four&#160;draw&#160;pages,&#160;they&#160;are&#160;numbered&#160;0&#160;through 3.&#160;This&#160;is why&#160;the&#160;For&#160;loop&#160;in<a href="libremacros.html#311">&#160;Listing&#160;</a><br/>
<a href="libremacros.html#311">288&#160;i</a>s from&#160;0&#160;To&#160;oDoc.getDrawPages().getcount()-1.&#160;<br/>
The&#160;macro i<a href="libremacros.html#311">n&#160;Listing&#160;289&#160;c</a>reates&#160;a&#160;new&#160;Impress&#160;document&#160;and then adds&#160;a&#160;graphic&#160;image&#160;to the&#160;first&#160;draw&#160;<br/>page.&#160;The&#160;draw&#160;image&#160;is&#160;sized&#160;to retain&#160;the&#160;aspect&#160;ratio.<br/>
<i><b>Listing&#160;289.</b>&#160;Add a proportionally&#160;sized graphic&#160;to a draw&#160;page.</i><br/>
Sub&#160;AddProportionalGraphic<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160;'Newly created Impress document<br/>&#160;&#160;Dim&#160;oDrawPage&#160;&#160;'The draw page that will contain the graphic image<br/>&#160;&#160;Dim&#160;oGraph&#160; &#160; &#160;'The created graphic image<br/>&#160;&#160;<br/>
308<br/>
<hr/>
<a name=312></a>&#160;&#160;REM Create an Impress presentation document!<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#34;private:factory/simpress&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;_default&#34;,&#160;0,&#160;Array())<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;<br/>&#160;&#160;REM Insert a second draw page if desired,&#160;<br/>&#160;&#160;REM leaving the first draw page untouched!<br/>&#160;&#160;REM Could use the property DrawPages<br/>&#160;&#160;REM oDrawPage = oDoc.DrawPages.insertNewByIndex(1)<br/>&#160;&#160;REM oDrawPage = oDoc.getDrawPages().insertNewByIndex(1)<br/>&#160;&#160;REM In this case, simply use the first draw page!<br/>&#160;&#160;oDrawPage&#160;=&#160;oDoc.getDrawPages().getByIndex(0)<br/>&#160;&#160;<br/>&#160;&#160;REM Create a graphics object that can be inserted into the document<br/>&#160;&#160;oGraph&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.drawing.GraphicObjectShape&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Set the URL of the image so that it can be added to the document<br/>&#160;&#160;oGraph.GraphicURL&#160;=&#160;&#34;http://www.openoffice.org/images/AOO_logos/orb.jpg&#34;<br/>&#160;&#160;oDrawPage.add(oGraph)<br/>&#160;&#160;<br/>&#160;&#160;REM If I stop here, there will be a very small graphic image in the<br/>&#160;&#160;REM upper-left corner of the document. This is pretty much useless.<br/>&#160;&#160;REM Although I could simply size the graphic to the same size as the bitmap<br/>&#160;&#160;REM size, I choose instead to size this so that it is as large as possible&#160;<br/>&#160;&#160;REM without changing the aspect ratio.<br/>&#160;&#160;REM Determine the ratio of the height to the width for the image and<br/>&#160;&#160;REM also for the draw page.<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;oNewSize&#160;As&#160;New&#160;com.sun.star.awt.Size&#160; &#160;&#160;'New Image size<br/>&#160;&#160;Dim&#160;oBitmapSize&#160;As&#160;New&#160;com.sun.star.awt.Size&#160;'Bitmap size<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;dImageRatio&#160;As&#160;Double&#160; &#160; &#160;'Ratio of the height to width<br/>&#160;&#160;Dim&#160;dPageRatio&#160;As&#160;Double&#160; &#160; &#160;&#160;'Ratio of the height to width<br/>&#160;&#160;<br/>&#160;&#160;oBitmapSize&#160;=&#160;oGraph.GraphicObjectFillBitmap.GetSize<br/>&#160;&#160;dImageRatio&#160;=&#160;CDbl(oBitmapSize.Height)&#160;/&#160;CDbl(oBitmapSize.Width)<br/>&#160;&#160;dPageRatio&#160;=&#160;CDbl(oDrawPage.Height)&#160;/&#160;CDbl(oDrawPage.Width)<br/>&#160;&#160;<br/>&#160;&#160;REM Compare the ratios to see which is wider, relatively speaking<br/>&#160;&#160;If&#160;dPageRatio&#160;&gt;&#160;dImageRatio&#160;Then<br/>&#160; &#160;&#160;oNewSize.Width&#160;&#160;=&#160;oDrawPage.Width<br/>&#160; &#160;&#160;oNewSize.Height&#160;=&#160;CLng(CDbl(oDrawPage.Width)&#160;*&#160;dImageRatio)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oNewSize.Width&#160;&#160;=&#160;CLng(CDbl(oDrawPage.Height)&#160;/&#160;dImageRatio)<br/>&#160; &#160;&#160;oNewSize.Height&#160;=&#160;oDrawPage.Height<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM Center the image on the Impress page! &#160;<br/>&#160;&#160;Dim&#160;oPosition&#160;as&#160;new&#160;com.sun.star.awt.Point<br/>&#160;&#160;oPosition.X&#160;=&#160;(oDrawPage.Width&#160;-&#160;oNewSize.Width)/2<br/>&#160;&#160;oPosition.Y&#160;=&#160;(oDrawPage.Height&#160;-&#160;oNewSize.Height)/2<br/>&#160;&#160;<br/>&#160;&#160;oGraph.SetSize(oNewSize)<br/>&#160;&#160;oGraph.SetPosition(oPosition)<br/>
309<br/>
<hr/>
<a name=313></a>End&#160;Sub<br/>
As&#160;already&#160;stated,&#160;Impress&#160;and Draw&#160;documents&#160;are&#160;very&#160;similar&#160;in the&#160;API&#160;that&#160;they&#160;support.&#160;The&#160;macro i<a href="libremacros.html#313">n<br/>Listing 290&#160;d</a>raws&#160;lines&#160;in&#160;a&#160;Draw&#160;document&#160;(see<a href="libremacros.html#313">&#160;Figure&#160;84)</a>.<br/>
<i><b>Listing&#160;290.</b>&#160;Draw lines&#160;in&#160;a new graphic&#160;document.<br/></i>Sub&#160;DrawLinesInDrawDocument<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160;'Newly created Draw document<br/>&#160;&#160;Dim&#160;oDrawPage&#160;&#160;'The draw page that will contain the graphics image<br/>&#160;&#160;Dim&#160;oShape&#160; &#160; &#160;'Shape to insert<br/>
&#160;&#160;REM Create a new Draw document!<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#34;private:factory/sdraw&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;_default&#34;,&#160;0,&#160;Array())<br/>&#160;<br/>&#160;&#160;REM Use the first draw page<br/>&#160;&#160;oDrawPage&#160;=&#160;oDoc.getDrawPages().getByIndex(0)<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;oPos&#160;as&#160;new&#160;com.sun.star.awt.Point<br/>&#160;&#160;Dim&#160;oSize&#160;as&#160;new&#160;com.sun.star.awt.Size<br/>&#160;&#160;Dim&#160;dStepSize&#160;As&#160;Double<br/>&#160;&#160;dStepSize&#160;=&#160;CDbl(oDrawPage.Height)&#160;/&#160;10<br/>&#160;&#160;<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;10<br/>&#160; &#160;&#160;oShape&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.drawing.LineShape&#34;)<br/>&#160; &#160;&#160;oShape.LineColor&#160;=&#160;rgb(0,&#160;255&#160;-&#160;20&#160;*&#160;i,&#160;20&#160;*&#160;i)<br/>&#160; &#160;&#160;oShape.LineWidth&#160;=&#160;250<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;oPos.X&#160;=&#160;0<br/>&#160; &#160;&#160;oPos.Y&#160;=&#160;CLng(CDbl(i)&#160;*&#160;dStepSize)<br/>&#160; &#160;&#160;oShape.setPosition(oPos)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;oSize.width&#160;=&#160;oDrawPage.Width<br/>&#160; &#160;&#160;oSize.height=&#160;oDrawPage.Height&#160;-&#160;2&#160;*&#160;oPos.Y<br/>&#160; &#160;&#160;oShape.setSize(oSize)<br/>&#160; &#160;&#160;oDrawPage.add(oShape)&#160;&#160;<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
<i><b>Figure&#160;84.</b>&#160;These&#160;lines&#160;drawn in&#160;a Draw&#160;document&#160;overlap.</i><br/>
310<br/>
<hr/>
<a name=314></a><b>&#160;13.9.2.&#160;Draw&#160;lines&#160;with&#160;arrows&#160;in&#160;Calc<br/></b>Each Calc&#160;document&#160;contains&#160;a&#160;single&#160;draw&#160;page&#160;for each sheet&#160;In&#160;Calc,&#160;each sheet&#160;is&#160;like&#160;a&#160;transparent&#160;layer<br/>containing drawing data&#160;on top&#160;of the&#160;standard document&#160;data.&#160;The&#160;following macro demonstrates&#160;a&#160;couple&#160;<br/>of useful&#160;things:<br/>
•<br/>
Each cell&#160;has&#160;a&#160;position on the&#160;draw&#160;page.&#160;This&#160;macro draws&#160;a&#160;line&#160;between specific&#160;cells&#160;by&#160;using&#160;<br/>the&#160;Position&#160;attribute&#160;on a&#160;cell.&#160;The&#160;line&#160;is&#160;draw&#160;from&#160;the&#160;upper left&#160;corner of cell&#160;B2 to the&#160;upper left&#160;<br/>corner of cell&#160;D4.<br/>
•<br/>
A&#160;LineShape&#160;is&#160;created&#160;by&#160;the&#160;document.<br/>
•<br/>
After creation,&#160;attributes&#160;are&#160;set&#160;on the&#160;LineShape;&#160;for example,&#160;position, size,&#160;and color.<br/>
•<br/>
The&#160;LineShape&#160;is&#160;added to the&#160;draw&#160;page.<br/>
•<br/>
Arrows, and other line&#160;endings, are&#160;added&#160;<i>after</i>&#160;the&#160;LineShape&#160;has&#160;been added to the&#160;draw&#160;page&#160;– at&#160;<br/>least&#160;this&#160;is&#160;required in&#160;OOo version 3.3.0.<br/>
Arrow&#160;line&#160;endings&#160;are&#160;set&#160;by&#160;setting the&#160;LineEndName&#160;and LineStartName.&#160;I&#160;was&#160;not&#160;able&#160;to find a&#160;list&#160;of&#160;<br/>supported&#160;arrow&#160;names, so, I&#160;used the&#160;GUI&#160;to&#160;find the&#160;names&#160;mentioned&#160;in the&#160;GUI, and the&#160;few&#160;that&#160;I&#160;tried&#160;<br/>worked. Next,&#160;I&#160;searched the&#160;source&#160;code&#160;and I&#160;found filter/source/msfilter/escherex.cx&#160;and&#160;<br/>svx/source/dialog/sdstring.src, which&#160;contains&#160;the&#160;following names:<br/>
•<br/>
Arrow<br/>
•<br/>
Arrow&#160;concave<br/>
•<br/>
Circle<br/>
•<br/>
Dimension&#160;Lines<br/>
•<br/>
Double&#160;Arrow<br/>
•<br/>
Line&#160;Arrow<br/>
•<br/>
Rounded large&#160;Arrow<br/>
•<br/>
Rounded short&#160;Arrow<br/>
•<br/>
Small&#160;Arrow<br/>
•<br/>
Square<br/>
•<br/>
Square&#160;45<br/>
•<br/>
Symmetric&#160;Arrow<br/>
In&#160;testing, the&#160;en-US&#160;names&#160;worked in&#160;other locales. Locale&#160;specific&#160;names&#160;work, but&#160;the&#160;value&#160;that&#160;is&#160;stored<br/>is&#160;based on the&#160;en-US&#160;locale&#160;name.&#160;In&#160;other words, using &#34;Double&#160;flèche&#34;&#160;with&#160;a&#160;French locale&#160;sets&#160;the&#160;<br/>property&#160;to “Double&#160;Arrow”.<br/>
<i><b>Listing&#160;291.</b>&#160;Draw lines&#160;in&#160;a Calc&#160;document.<br/></i>Sub&#160;InsertLineInCalcDocument<br/>&#160;&#160;Dim&#160;oLine<br/>&#160;&#160;Dim&#160;oCell1<br/>&#160;&#160;Dim&#160;oCell2<br/>&#160;&#160;Dim&#160;oSheet<br/>
311<br/>
<hr/>
<a name=315></a>&#160;&#160;Dim&#160;oPos&#160;as&#160;new&#160;com.sun.star.awt.Point<br/>&#160;&#160;Dim&#160;oSize&#160;as&#160;new&#160;com.sun.star.awt.Size<br/>&#160;&#160;Dim&#160;oPage<br/>
&#160;&#160;oSheet&#160;=&#160;ThisComponent.Sheets(0)<br/>&#160;&#160;oCell1&#160;=&#160;oSheet.getCellByPosition(1,&#160;1)<br/>&#160;&#160;oCell2&#160;=&#160;oSheet.getCellByPosition(3,&#160;3)<br/>
&#160;&#160;oLine&#160;=&#160;ThisComponent.createInstance(&#34;com.sun.star.drawing.LineShape&#34;)<br/>&#160; &#160; &#160;<br/>&#160;&#160;oPos.x&#160;=&#160;oCell1.Position.X<br/>&#160;&#160;oPos.y&#160;=&#160;oCell1.Position.Y<br/>&#160;&#160;oLine.Position&#160;=&#160;oPos<br/>
&#160;&#160;oSize.Width&#160;=&#160;oCell2.Position.X&#160;-&#160;oCell1.Position.X<br/>&#160;&#160;oSize.Height&#160;=&#160;oCell2.Position.Y&#160;-&#160;oCell1.Position.Y<br/>&#160;&#160;oLine.Size&#160;=&#160;oSize<br/>&#160; &#160; &#160;<br/>&#160;&#160;oLine.LineWidth&#160;=&#160;4<br/>&#160;&#160;oLine.LineColor&#160;=&#160;RGB(128,&#160;0,&#160;0)<br/>&#160;&#160;oPage&#160;=&#160;oSheet.getDrawPage()<br/>
&#160;&#160;oPage.add(oLine)&#160;<br/>&#160;&#160;<br/>&#160;&#160;REM You must do this AFTER inserting the line into the page.<br/>&#160;&#160;oLine.LineEndName&#160;=&#160;&#34;Arrow&#34;<br/>&#160;&#160;oLine.LineStartName&#160;=&#160;&#34;Double Arrow&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;85.</b>&#160;Draw&#160;a line&#160;in a Calc&#160;document.</i><br/>
<b>&#160;13.9.3.&#160;Writer<br/></b>Each&#160;Writer&#160;document&#160;contains&#160;a&#160;single&#160;draw&#160;page&#160;for the&#160;entire&#160;document. In&#160;Writer,&#160;the&#160;page&#160;is&#160;like&#160;a&#160;<br/>transparent&#160;layer containing drawing data&#160;on top&#160;of the&#160;standard document&#160;data.&#160;<br/>
Writer documents&#160;do not&#160;support&#160;the&#160;XDrawPagesSupplier interface, because&#160;they&#160;only&#160;contain&#160;a&#160;single&#160;<br/>draw&#160;page.&#160;They&#160;do, however,&#160;support&#160;the&#160;XDrawPageSupplier interface, which&#160;defines&#160;the&#160;single&#160;object&#160;<br/>method&#160;getDrawPage().<br/>
The&#160;macro i<a href="libremacros.html#313">n&#160;Listing&#160;290&#160;us</a>es&#160;optional&#160;draw&#160;page&#160;properties&#160;— namely&#160;height&#160;and width.&#160;The&#160;draw&#160;page&#160;<br/>from&#160;a&#160;Writer document&#160;does&#160;not&#160;contain these&#160;properties.&#160;The&#160;draw&#160;page&#160;in a&#160;Writer document&#160;has&#160;other&#160;<br/>peculiarities, however.&#160;For&#160;example, adding&#160;lines&#160;to&#160;the&#160;draw&#160;page&#160;— as&#160;done&#160;i<a href="libremacros.html#313">n&#160;Listing&#160;290&#160;— a</a>dds&#160;them&#160;as<br/>characters&#160;at&#160;the&#160;cursor position&#160;rather than interpreting&#160;the&#160;positions&#160;as&#160;specific&#160;locations&#160;in&#160;the&#160;document.&#160;<br/>The&#160;macro i<a href="libremacros.html#315">n&#160;Listing&#160;292&#160;dra</a>ws&#160;lines&#160;to demonstrate&#160;this&#160;behavior (also see<a href="libremacros.html#316">&#160;Figure&#160;86)</a>.<br/>
<i><b>Listing&#160;292.</b>&#160;Draw lines&#160;in&#160;a Write&#160;document.<br/></i>Sub&#160;DrawLinesInWriteDocument<br/>
312<br/>
<hr/>
<a name=316></a>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160;'Newly created Writer document<br/>&#160;&#160;Dim&#160;oDrawPage&#160;&#160;'The draw page that will contain the graphics image<br/>&#160;&#160;Dim&#160;oShape&#160; &#160; &#160;'Shape to insert<br/>
&#160;&#160;REM Create a new Writer document!<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#34;private:factory/swriter&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;_default&#34;,&#160;0,&#160;Array())<br/>&#160;<br/>&#160;&#160;oDrawPage&#160;=&#160;oDoc.getDrawPage()<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;oSize&#160;as&#160;new&#160;com.sun.star.awt.Size<br/>&#160;&#160;Dim&#160;dStepSize&#160;As&#160;Double<br/>&#160;&#160;dStepSize&#160;=&#160;800<br/>&#160;&#160;<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;10<br/>&#160; &#160;&#160;oShape&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.drawing.LineShape&#34;)<br/>&#160; &#160;&#160;oShape.LineColor&#160;=&#160;rgb(255,&#160;255&#160;-&#160;20&#160;*&#160;i,&#160;20&#160;*&#160;i)<br/>&#160; &#160;&#160;oShape.LineWidth&#160;=&#160;50<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;oSize.width&#160;=&#160;dStepSize&#160;-&#160;CLng(CDbl(i)&#160;*&#160;dStepSize&#160;/&#160;10)/2<br/>&#160; &#160;&#160;oSize.width&#160;=&#160;CLng(dStepSize/5&#160;*&#160;i&#160;-&#160;dStepSize)<br/>&#160; &#160;&#160;oSize.height=&#160;dStepSize<br/>&#160; &#160;&#160;oShape.setSize(oSize)<br/>&#160; &#160;&#160;oDrawPage.add(oShape)&#160;&#160;<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
<i><b>Figure&#160;86.</b>&#160;These&#160;lines&#160;drawn&#160;in a Writer&#160;document&#160;are&#160;treated as&#160;characters.</i><br/>
<i><b>&#160;13.10.&#160;The&#160;model<br/></b></i>XModel&#160;is&#160;the&#160;primary&#160;interface&#160;that&#160;distinguishes&#160;a&#160;component&#160;as&#160;a&#160;document,&#160;as&#160;opposed to the&#160;OOo Basic<br/>IDE&#160;or the&#160;included help&#160;pages. Objects&#160;that&#160;implement&#160;the&#160;interface&#160;com.sun.star.frame.XModel&#160;represent&#160;a<br/>component&#160;created from&#160;a&#160;URL.&#160;OOo document&#160;objects&#160;may&#160;be&#160;controlled by&#160;a&#160;controller,&#160;which&#160;is&#160;also&#160;<br/>considered a&#160;view&#160;of the&#160;document.&#160;The&#160;XModel&#160;interface&#160;defines&#160;the&#160;object&#160;methods&#160;in<a href="libremacros.html#317">&#160;Table&#160;106.</a><br/>
313<br/>
<hr/>
<a name=317></a><i>Table&#160;106. Object&#160;methods&#160;defined by&#160;the&#160;interface&#160;com.sun.star.frame.XModel.</i><br/>
<i><b>Object&#160;Method</b></i><br/>
<i><b>Description</b></i><br/>
getURL()<br/>
URL&#160;of&#160;the&#160;document&#160;returned&#160;as a&#160;String.<br/>
getArgs()<br/>
Return a&#160;copy&#160;of&#160;the&#160;com.sun.star.document.MediaDescriptor&#160;for&#160;this&#160;model&#160;<br/>(document).<br/>
lockControllers()<br/>
Prevent&#160;some&#160;display&#160;updates — macros may&#160;run&#160;faster.&#160;Be&#160;sure&#160;to unlock the&#160;<br/>controllers&#160;when&#160;you are&#160;finished.<br/>
unlockControllers()<br/>
Call&#160;this once&#160;for&#160;each call&#160;to lockControllers().<br/>
hasControllersLocked()<br/>
Is&#160;there&#160;at&#160;least&#160;one&#160;lock&#160;remaining?<br/>
getCurrentController()<br/>
The&#160;controller&#160;that&#160;currently&#160;controls this model.<br/>
getCurrentSelection()<br/>
Current&#160;selection on the&#160;current&#160;controller.<br/>
<b>&#160;13.10.1.&#160;Document&#160;arguments<br/></b>Arguments&#160;passed to&#160;the&#160;document&#160;loader control&#160;how&#160;the&#160;document&#160;is&#160;loaded;&#160;for example, opening&#160;a&#160;<br/>document&#160;as&#160;read-only.&#160;Use&#160;getArgs() to&#160;obtain&#160;the&#160;documents&#160;media&#160;descriptor,&#160;which&#160;details&#160;how&#160;the&#160;<br/>document&#160;was&#160;loaded.&#160;The&#160;MediaDescriptor&#160;service&#160;can be&#160;accessed as&#160;a&#160;series&#160;of optional&#160;properties&#160;or as&#160;<br/>an array&#160;of properties&#160;(see<a href="libremacros.html#317">&#160;Listing&#160;293&#160;a</a><a href="libremacros.html#318">nd&#160;Figure&#160;87).</a><br/>
<i><b>Listing&#160;293.</b>&#160;Print&#160;the&#160;document&#160;media&#160;descriptor.<br/></i>Sub&#160;printDocumentArgs()<br/>&#160;&#160;REM This says to ignore any lines that cause an error.<br/>&#160;&#160;REM Obtaining a value may cause an error, but that is&#160;<br/>&#160;&#160;REM not a problem. It just prevents a value from being printed.<br/>&#160;&#160;On&#160;Error&#160;Resume&#160;Next<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;vArgs&#160;'Media descriptor as an array of com.sun.star.beans.PropertyValue<br/>&#160;&#160;Dim&#160;s$&#160; &#160;&#160;'Display string<br/>&#160;&#160;Dim&#160;i%&#160; &#160;&#160;'Index variable<br/>&#160;&#160;<br/>&#160;&#160;REM Obtain the media descriptor. It turns out that this<br/>&#160;&#160;REM can be represented as an array of PropertyValue services.<br/>&#160;&#160;vArgs&#160;=&#160;ThisComponent.getArgs()<br/>&#160;&#160;<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;UBound(vArgs)&#160; &#160; &#160; &#160;'For each property<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vArgs(i).Name&#160;&amp;&#160;&#34; = &#34;&#160;&#160;'Add the property name and an equals sign<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vArgs(i).Value&#160; &#160; &#160; &#160; &#160;'Obtaining the value may fail!<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Add a new-line character<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Args&#34;<br/>End&#160;Sub<br/>
314<br/>
<hr/>
<a name=318></a><i><b>Figure&#160;87.</b>&#160;Properties&#160;returned by&#160;the&#160;getArgs()&#160;object&#160;method.</i><br/>
A&#160;text&#160;file&#160;is&#160;not&#160;a&#160;standard OOo&#160;Writer file,&#160;but&#160;rather,&#160;a&#160;simple&#160;file&#160;that&#160;has&#160;typically&#160;been created by&#160;a&#160;<br/>simple&#160;editor such as&#160;Notepad.&#160;Text&#160;files&#160;contain&#160;no information&#160;that&#160;identify&#160;the&#160;character set&#160;that&#160;was&#160;used,<br/>or how&#160;lines&#160;are&#160;terminated.&#160;Text&#160;files&#160;usually&#160;use&#160;the&#160;file&#160;extension&#160;TXT.&#160;When a&#160;text&#160;file&#160;is&#160;opened, OOo&#160;<br/>displays&#160;a&#160;dialog&#160;and asks&#160;questions&#160;about&#160;the&#160;file&#160;so that&#160;it&#160;knows&#160;how&#160;the&#160;text&#160;file&#160;is&#160;encoded. I&#160;was&#160;asked&#160;<br/>how&#160;to&#160;load a&#160;text&#160;file&#160;using a&#160;macro, avoiding&#160;the&#160;dialog and explicitly&#160;specifying the&#160;import&#160;values.&#160;<br/>Although I&#160;was&#160;able&#160;to correctly&#160;determine&#160;the&#160;import&#160;filter name, I&#160;had no idea&#160;how&#160;to specify&#160;the&#160;required&#160;<br/>filter options.&#160;I&#160;had no idea, that&#160;is, until&#160;I&#160;found the&#160;getArgs() object&#160;method.<br/>
<b>TIP</b><br/>
If&#160;you&#160;know&#160;how&#160;to open&#160;a&#160;document&#160;using&#160;the&#160;GUI,&#160;but&#160;are&#160;uncertain&#160;how&#160;the&#160;arguments must&#160;be&#160;set&#160;to&#160;<br/>load&#160;the&#160;document&#160;using&#160;loadComponentFromURL,&#160;then first&#160;load&#160;the&#160;document&#160;using&#160;the&#160;GUI,&#160;then&#160;<br/>
inspect&#160;the&#160;document's media&#160;descriptor.&#160;Hint:&#160;look&#160;at&#160;FilterOptions.<br/>
<a href="libremacros.html#318">&#160;Figure&#160;87&#160;s</a>hows&#160;the&#160;arguments&#160;for an imported text&#160;file.&#160;The&#160;FilterName&#160;property&#160;indicates&#160;the&#160;name&#160;of the&#160;<br/>import&#160;filter,&#160;and the&#160;FilterOptions&#160;property&#160;indicates&#160;the&#160;filter options&#160;that&#160;were&#160;used to&#160;open the&#160;file.&#160;Using&#160;<br/>these&#160;properties&#160;with the&#160;desktop&#160;object&#160;method&#160;LoadComponentFromUrl(), the&#160;file&#160;is&#160;correctly&#160;imported&#160;<br/>and the&#160;dialog is&#160;not&#160;displaye<a href="libremacros.html#318">d.&#160;Table&#160;107&#160;c</a>ontains&#160;a&#160;list&#160;of the&#160;properties&#160;that&#160;may&#160;be&#160;returned from&#160;the&#160;<br/>getArgs() object&#160;method.&#160;The&#160;OOo&#160;API&#160;Web&#160;site&#160;contains&#160;a&#160;few&#160;more&#160;properties, but&#160;they&#160;are&#160;obscure&#160;or&#160;<br/>deprecated.<br/>
<i>Table&#160;107. Object&#160;properties&#160;defined&#160;by&#160;the&#160;service&#160;MediaDescriptor.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Aborted<br/>
May&#160;be&#160;set&#160;if&#160;document&#160;load&#160;is aborted while&#160;entering&#160;a&#160;password.<br/>
AsTemplate&#160;<br/>
Document&#160;was loaded&#160;as&#160;a&#160;template.<br/>
Author&#160;<br/>
Author&#160;of&#160;this&#160;document&#160;version;&#160;this&#160;is&#160;for&#160;versioning.<br/>
CharacterSet&#160;<br/>
Document&#160;character&#160;set&#160;for&#160;single-byte&#160;characters.<br/>
Comment&#160;<br/>
Comment&#160;on the&#160;current&#160;document&#160;version;&#160;this&#160;is for&#160;versioning.<br/>
DocumentTitle&#160;<br/>
If&#160;the&#160;document&#160;title&#160;is&#160;specified,&#160;it&#160;is&#160;included&#160;here.<br/>
FilterName&#160;<br/>
Filter&#160;used&#160;to import&#160;or&#160;save&#160;this&#160;document.<br/>
FilterOptions&#160;<br/>
Filter&#160;used&#160;to import&#160;this&#160;document.<br/>
FilterData&#160;<br/>
Additional&#160;import&#160;properties if&#160;the&#160;FilterOptions string&#160;is&#160;not&#160;sufficient.<br/>
315<br/>
<hr/>
<a name=319></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Hidden&#160;<br/>
If&#160;the&#160;Hidden argument&#160;is&#160;specified during&#160;load,&#160;it&#160;is&#160;included&#160;here.<br/>
HierarchicalDocumentName<br/>
The&#160;hierarchical&#160;path to the&#160;embedded&#160;document&#160;from&#160;topmost&#160;container.&#160;<br/>
InputStream&#160;<br/>
If&#160;the&#160;InputStream&#160;is specified during&#160;load,&#160;it&#160;is&#160;included&#160;here.&#160;<br/>
InteractionHandler&#160;<br/>
Exception handler&#160;if&#160;an error&#160;occurs during&#160;import.<br/>
JumpMark&#160;<br/>
Jump&#160;to this&#160;marked position after&#160;loading&#160;the&#160;document.<br/>
MediaType&#160;<br/>
MIME&#160;type&#160;of&#160;this&#160;document.<br/>
OpenNewView&#160;<br/>
Opens a&#160;new&#160;view&#160;for&#160;an already&#160;loaded&#160;document,&#160;rather&#160;than just&#160;opening&#160;the&#160;<br/>
document&#160;twice.&#160;In&#160;other&#160;words,&#160;request&#160;two views&#160;of&#160;the&#160;same&#160;data.<br/>
OutputStream<br/>
Stream&#160;to use&#160;while&#160;writing&#160;the&#160;document.<br/>
Overwrite&#160;<br/>
Overwrite&#160;any&#160;existing&#160;file&#160;on&#160;save.<br/>
Password&#160;<br/>
Password&#160;for&#160;loading&#160;or&#160;storing&#160;the&#160;document.<br/>
Preview&#160;<br/>
Document&#160;loaded&#160;in preview&#160;mode;&#160;optimizes&#160;for&#160;preview-only&#160;use.<br/>
ReadOnly&#160;<br/>
Document&#160;opened&#160;as&#160;read-only;&#160;controller&#160;will&#160;not&#160;change&#160;the&#160;document.<br/>
Referer&#160;<br/>
URL&#160;of&#160;document&#160;referrer&#160;— for&#160;example,&#160;if&#160;opened&#160;by&#160;clicking&#160;an HTTP&#160;link.<br/>
RepairPackage&#160;<br/>
Open the&#160;document&#160;in&#160;repair&#160;mode.<br/>
StartPresentation&#160;<br/>
Immediately&#160;after&#160;loading&#160;an Impress&#160;document, start&#160;the&#160;presentation.<br/>
StatusIndicator&#160;<br/>
If&#160;a&#160;status indicator&#160;was specified&#160;when&#160;the&#160;document&#160;was loaded,&#160;it&#160;is&#160;included&#160;here.<br/>
Unpacked&#160;<br/>
If&#160;True, an OOo&#160;document&#160;is&#160;stored as a&#160;folder&#160;rather&#160;than&#160;a&#160;ZIP&#160;file.<br/>
URL&#160;<br/>
URL&#160;of&#160;the&#160;document.<br/>
Version&#160;<br/>
Current&#160;document&#160;version,&#160;if&#160;versioning&#160;is supported.<br/>
ViewData&#160;<br/>
The&#160;view&#160;data&#160;to&#160;use.<br/>
ViewId&#160;<br/>
The&#160;ID&#160;of&#160;the&#160;initial&#160;view.<br/>
MacroExecutionMode&#160;<br/>
Specifies how&#160;macros&#160;are&#160;treated&#160;when&#160;the&#160;document&#160;is&#160;loaded.<br/>
<i><b>&#160;13.11.&#160;Saving&#160;a&#160;document<br/></b></i>The&#160;location where&#160;a&#160;document&#160;is&#160;saved is&#160;called its&#160;Uniform&#160;Resource&#160;Locator (URL) — in other words, its<br/>file&#160;name.&#160;A&#160;file&#160;URL&#160;usually&#160;contains&#160;the&#160;complete&#160;path&#160;to the&#160;file.&#160;When&#160;the&#160;file&#160;name&#160;is&#160;referred to&#160;as&#160;the&#160;<br/>URL,&#160;it&#160;has&#160;a&#160;form&#160;similar to&#160;“file:///c:/myfile.sxw”&#160;rather than “c:\myfile.sxw”.&#160;A&#160;URL&#160;is&#160;a&#160;general&#160;way&#160;of&#160;<br/>writing&#160;a&#160;storage&#160;location,&#160;one&#160;that&#160;can be&#160;extended conveniently&#160;to&#160;include&#160;a&#160;wide&#160;range&#160;of storage&#160;location&#160;<br/>types&#160;in&#160;a&#160;manufacturer-independent&#160;and computer-independent&#160;manner.&#160;OOo Basic&#160;supports&#160;the&#160;functions&#160;<br/>ConvertToURL&#160;and ConvertFromURL&#160;to convert&#160;between the&#160;two notations.&#160;The&#160;XStorable&#160;interface&#160;<br/>defines&#160;object&#160;methods&#160;to&#160;save&#160;a&#160;document&#160;to a&#160;URL&#160;(see<a href="libremacros.html#319">&#160;Table&#160;108)</a>.&#160;<br/>
<i>Table&#160;108. Object&#160;methods&#160;defined by&#160;the&#160;service&#160;com.sun.star.frame.XStorable.</i><br/>
<i><b>Object&#160;Method</b></i><br/>
<i><b>Description</b></i><br/>
hasLocation()<br/>
True&#160;if&#160;the&#160;document&#160;has a&#160;storage&#160;location and False&#160;if&#160;this&#160;is a&#160;new&#160;blank document.<br/>
getLocation()<br/>
Return the&#160;URL&#160;where&#160;the&#160;object&#160;was stored&#160;after&#160;calling&#160;storeAsURL().<br/>
isReadonly()<br/>
You cannot&#160;call&#160;store()&#160;if&#160;the&#160;file&#160;was&#160;called from&#160;a&#160;read-only&#160;location.<br/>
store()<br/>
Stores the&#160;data&#160;to&#160;the&#160;current&#160;URL.<br/>
storeAsURL(URL, args)<br/>
Stores the&#160;document&#160;to the&#160;specified&#160;URL,&#160;which becomes the&#160;current&#160;URL.<br/>
316<br/>
<hr/>
<a name=320></a><i><b>Object&#160;Method</b></i><br/>
<i><b>Description</b></i><br/>
storeToURL(URL,&#160;args)<br/>
Stores the&#160;document&#160;to the&#160;specified&#160;URL,&#160;but&#160;the&#160;current&#160;URL&#160;does not&#160;change.<br/>
Use&#160;the&#160;object&#160;method&#160;hasLocation() to&#160;determine&#160;if a&#160;document&#160;knows&#160;where&#160;to&#160;save&#160;itself, and use&#160;the&#160;<br/>method&#160;store() to save&#160;it&#160;to&#160;the&#160;current&#160;URL.&#160;The&#160;macro in<a href="libremacros.html#320">&#160;Listing 294&#160;us</a>es&#160;methods&#160;defined&#160;by&#160;both&#160;<br/>XStorable&#160;and XModifiable&#160;to save&#160;a&#160;document&#160;to&#160;disk.&#160;The&#160;document&#160;is&#160;stored only&#160;if it&#160;knows&#160;where&#160;to&#160;<br/>store&#160;itself,&#160;it&#160;has&#160;changed, and it&#160;is&#160;not&#160;read-only.<br/>
<i><b>Listing&#160;294.</b>&#160;Proper&#160;method to&#160;save&#160;a document.<br/></i>If&#160;(ThisComponent.isModified())&#160;Then<br/>&#160;&#160;If&#160;(ThisComponent.hasLocation()&#160;AND&#160;(Not&#160;ThisComponent.isReadOnly()))&#160;Then<br/>&#160; &#160;&#160;ThisComponent.store()<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;REM Either the document does not have a location or you cannot<br/>&#160; &#160;&#160;REM save the document because the location is read-only.<br/>&#160; &#160;&#160;setModified(False)<br/>&#160;&#160;End&#160;If<br/>End&#160;If<br/>
A&#160;document&#160;does&#160;not&#160;have&#160;a&#160;storage&#160;location immediately&#160;after it&#160;is&#160;created.&#160;A&#160;document&#160;loaded from&#160;disk,&#160;<br/>however,&#160;has&#160;a&#160;known location.&#160;Use&#160;the&#160;object&#160;method&#160;storeAsURL() or storeToURL() to save&#160;a&#160;document&#160;<br/>to a&#160;specified location.&#160;The&#160;difference&#160;between the&#160;methods&#160;is&#160;that&#160;storeAsURL()&#160;sets&#160;the&#160;current&#160;location&#160;<br/>(URL) and storeToURL() does&#160;not.&#160;The&#160;sequence&#160;of actions&#160;i<a href="libremacros.html#320">n&#160;Table&#160;109&#160;he</a>lps&#160;clarify&#160;the&#160;difference.<br/>
<i>Table&#160;109. Difference&#160;between storeToURL&#160;and storeAsURL.</i><br/>
<i><b>Step&#160;</b></i><br/>
<i><b>Action</b></i><br/>
<i><b>Comment</b></i><br/>
1<br/>
Create&#160;document<br/>
Cannot&#160;use&#160;the&#160;store()&#160;method because&#160;the&#160;document&#160;has no location.<br/>
2<br/>
Use&#160;storeToURL<br/>
Document&#160;saved, but&#160;cannot&#160;use&#160;the&#160;store()&#160;methodbecause&#160;it&#160;has&#160;no location.<br/>
3<br/>
Use&#160;storeAsURL<br/>
Can use&#160;the&#160;store()&#160;method because&#160;now&#160;the&#160;document&#160;has a&#160;location.<br/>
4<br/>
Use&#160;storeToURL<br/>
Document&#160;saved, but&#160;the&#160;location is&#160;the&#160;same&#160;as&#160;set&#160;in&#160;step 3.<br/>
<b>TIP</b><br/>
The&#160;method&#160;storeAsURL()&#160;is similar&#160;to the&#160;menu&#160;option File&#160;|&#160;Save&#160;As, which changes&#160;the&#160;current&#160;location.<br/>The&#160;method&#160;storeToURL()&#160;is&#160;usually&#160;used&#160;to export&#160;a&#160;document&#160;so&#160;that&#160;the&#160;file&#160;URL&#160;does not&#160;change&#160;and&#160;<br/>
contain a&#160;non-OOo document&#160;extension.<br/>
The&#160;two object&#160;methods&#160;for storing a&#160;document,&#160;storeAsURL()&#160;and storeToURL(), accept&#160;the&#160;same&#160;<br/>arguments;&#160;learn to use&#160;one&#160;and you’ll&#160;know&#160;how&#160;to use&#160;the&#160;other.&#160;<br/>
ThisComponent.storeAsURL(url,&#160;args())<br/>ThisComponent.storeToURL(url,&#160;args())<br/>
The&#160;second argument&#160;is&#160;an array&#160;of property&#160;values&#160;(see<a href="libremacros.html#318">&#160;Table&#160;107)</a>&#160;that&#160;direct&#160;how&#160;the&#160;document&#160;is&#160;saved&#160;<br/>(see<a href="libremacros.html#320">&#160;Listing 295)</a>.&#160;The&#160;files&#160;can just&#160;as&#160;easily&#160;be&#160;stored with&#160;no arguments&#160;(see<a href="libremacros.html#321">&#160;Listing&#160;296).</a><br/>
<i><b>Listing&#160;295.</b>&#160;Save&#160;a document&#160;to&#160;a new&#160;location.<br/></i>Dim&#160;args(0)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>Dim&#160;sUrl&#160;As&#160;String<br/>sUrl&#160;=&#160;&#34;file:///c:/My%20Documents/test_file.sxw&#34;<br/>args(0).Name&#160;=&#160;&#34;Overwrite&#34;&#160;&#160;<a href="libremacros.html#318">'This property is defined in&#160;Table 107<br/></a>args(0).Value&#160;=&#160;False&#160; &#160; &#160; &#160;'Do not overwrite an existing document.<br/>
317<br/>
<hr/>
<a name=321></a>ThisComponent.storeAsURL(sUrl,&#160;args())<br/>
<b>TIP</b><br/>
The&#160;com.sun.star.frame.XComponentLoader&#160;interface&#160;defines the&#160;object&#160;method&#160;<br/>
LoadComponentFromUrl(),&#160;which is used&#160;to load&#160;a&#160;file.&#160;The&#160;different&#160;document&#160;types do&#160;not&#160;implement&#160;<br/>this interface,&#160;but&#160;the&#160;document&#160;frame&#160;and the&#160;desktop&#160;both implement&#160;the&#160;interface.&#160;The&#160;method&#160;<br/>
LoadComponentFromUrl()&#160;also&#160;uses the&#160;values i<a href="libremacros.html#318">n&#160;Table&#160;107&#160;t</a>o&#160;direct&#160;how&#160;the&#160;file&#160;is loaded.<br/>
<i><b>Listing&#160;296.</b>&#160;Save&#160;the&#160;document&#160;with&#160;an inappropriate&#160;file&#160;extension.</i><br/>
ThisComponent.storeToURL(&#34;file:///c:/two.xls&#34;,&#160;Array())<br/>
<b>TIP</b><br/>
The&#160;macro&#160;in<a href="libremacros.html#321">&#160;Listing&#160;296&#160;u</a>ses&#160;the&#160;file&#160;extension “xls”, which is&#160;typically&#160;used&#160;by&#160;Microsoft&#160;Excel.&#160;This&#160;<br/>does&#160;not&#160;cause&#160;the&#160;file&#160;to be&#160;stored&#160;using&#160;the&#160;Microsoft&#160;Excel&#160;format.&#160;The&#160;file&#160;is&#160;saved using&#160;the&#160;standard&#160;<br/>
OOo file&#160;format&#160;if&#160;an export&#160;filter&#160;is not&#160;explicitly&#160;stated.<br/>
When&#160;you&#160;open a&#160;file, OOo checks&#160;to&#160;see&#160;if the&#160;file&#160;is&#160;in a&#160;standard OOo file&#160;format. If&#160;not,&#160;the&#160;file&#160;type&#160;is&#160;<br/>determined&#160;based on the&#160;file&#160;extension.&#160;I&#160;cannot&#160;even count&#160;the&#160;number of times&#160;that&#160;I&#160;have&#160;been asked why&#160;<br/>OOo is&#160;not&#160;able&#160;to open a&#160;comma-delimited&#160;text&#160;file.&#160;The&#160;usual&#160;answer is&#160;that&#160;a&#160;comma-delimited file&#160;must&#160;<br/>have&#160;the&#160;file&#160;extension CSV&#160;or OOo cannot&#160;recognize&#160;the&#160;file.&#160;Although the&#160;file&#160;extension&#160;is&#160;important&#160;while<br/>loading a&#160;file&#160;from&#160;the&#160;GUI,&#160;it&#160;is&#160;not&#160;important&#160;while&#160;saving. If&#160;you want&#160;to save&#160;a&#160;file&#160;in&#160;a&#160;non-<br/>OpenOffice.org&#160;native&#160;format, you must&#160;explicitly&#160;tell&#160;OOo to&#160;save&#160;in&#160;a&#160;different&#160;file&#160;format&#160;(see<a href="libremacros.html#321">&#160;Listing&#160;<br/>297)</a>.<br/>
<i><b>Listing&#160;297.</b>&#160;Export&#160;a document&#160;to the&#160;specified&#160;Microsoft&#160;Excel&#160;file&#160;format.</i><br/>
Dim&#160;args(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args(0).Name&#160;=&#160;&#34;FilterName&#34;&#160; &#160; &#160; &#160; &#160;'I am so excited, which filter will we use?<br/>args(0).Value&#160;=&#160;&#34;MS Excel 97&#34;&#160; &#160; &#160; &#160;'Oh, the Excel 97 format!<br/>ThisComponent.storeToURL(&#34;file:///c:/one.xls&#34;,args())<br/>
<b>TIP</b><br/>
Although the&#160;export&#160;filter&#160;names are&#160;the&#160;same&#160;as the&#160;import&#160;filter&#160;names,&#160;not&#160;every&#160;import&#160;filter&#160;can export&#160;<br/>
and&#160;not&#160;every&#160;export&#160;filter&#160;can&#160;import.<br/>
Impress&#160;and Draw,&#160;used to&#160;edit&#160;graphical&#160;content, support&#160;multiple&#160;draw&#160;pages.&#160;To&#160;export&#160;a&#160;draw&#160;page&#160;to a&#160;<br/>specific&#160;graphics&#160;format&#160;requires&#160;the&#160;use&#160;of a&#160;graphics&#160;export&#160;filter (see<a href="libremacros.html#321">&#160;Listing&#160;298).&#160;</a>The&#160;media&#160;type&#160;must&#160;<br/>be&#160;specified&#160;or the&#160;export&#160;will&#160;fail.<br/>
<i><b>Listing&#160;298.</b>&#160;Export&#160;the&#160;first&#160;draw page&#160;to&#160;a JPG&#160;file.</i><br/>
Dim&#160;oFilter<br/>Dim&#160;args(1)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>oFilter=CreateUnoService(&#34;com.sun.star.drawing.GraphicExportFilter&#34;)<br/>oFilter.setSourceDocument(ThisComponent.drawPages(0))<br/>args(0).Name&#160;=&#160;&#34;URL&#34;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Where the file will be saved<br/>args(0).Value&#160;=&#160;&#34;file:///c:/one.JPG&#34;&#160;'The destination URL<br/>args(1).Name&#160;=&#160;&#34;MediaType&#34;&#160; &#160; &#160; &#160; &#160; &#160;'What type of file<br/>args(1).Value&#160;=&#160;&#34;image/jpeg&#34;&#160; &#160; &#160; &#160; &#160;'The file type<br/>oFilter.filter(args())<br/>
318<br/>
<hr/>
<a name=322></a><i><b>&#160;13.12.&#160;Manipulating&#160;styles<br/></b></i>Styles&#160;provide&#160;a&#160;method&#160;of grouping&#160;formatting information.&#160;For example, a&#160;paragraph style&#160;defines&#160;the&#160;<br/>font,&#160;character size,&#160;margins, and many&#160;other formatting options.&#160;Changing a&#160;style&#160;changes&#160;every&#160;object&#160;<br/>using the&#160;style.&#160;The&#160;interface&#160;com.sun.star.style.XStyleFamiliesSupplier provides&#160;access&#160;to&#160;the&#160;styles&#160;used by<br/>a&#160;document.&#160;The&#160;macro i<a href="libremacros.html#322">n&#160;Listing&#160;299&#160;di</a>splays&#160;the&#160;names&#160;of all&#160;styles&#160;in&#160;the&#160;current&#160;document;<a href="libremacros.html#323">&#160;Figure&#160;88&#160;<br/></a>shows&#160;the&#160;results&#160;for one&#160;of my&#160;documents.<br/>
<i><b>Listing&#160;299.</b>&#160;Display&#160;styles&#160;used in&#160;a document.<br/></i>Sub&#160;DisplayAllStyles<br/>&#160;&#160;Dim&#160;oFamilies&#160; &#160; &#160;'Families is interface com.sun.star.container.XNameAccess<br/>&#160;&#160;Dim&#160;oFamilyNames&#160;&#160;'Names of family types. Array of string<br/>&#160;&#160;Dim&#160;oStyleNames&#160; &#160;'Names of styles. Array of string<br/>&#160;&#160;Dim&#160;oStyles&#160; &#160; &#160; &#160;'Styles is interface com.sun.star.container.XNameAccess<br/>&#160;&#160;Dim&#160;oStyle&#160; &#160; &#160; &#160;&#160;'An individual style<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160;'Utility string variable<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Integer&#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;&#160;'Index variable<br/>&#160;&#160;<br/>&#160;&#160;oFamilies&#160;=&#160;ThisComponent.StyleFamilies<br/>&#160;&#160;oFamilyNames&#160;=&#160;oFamilies.getElementNames()<br/>&#160;&#160;<br/>&#160;&#160;REM First, display the style types and the number<br/>&#160;&#160;REM of each style type.<br/>&#160;&#160;For&#160;n&#160;=&#160;LBound(oFamilyNames)&#160;To&#160;UBound(oFamilyNames)<br/>&#160; &#160;&#160;oStyles&#160;=&#160;oFamilies.getByName(oFamilyNames(n))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oStyles.getCount()&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;oFamilyNames(n)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Style Families&#34;<br/>
&#160;&#160;REM Now, display all of the different style names<br/>&#160;&#160;For&#160;n&#160;=&#160;LBound(oFamilyNames)&#160;To&#160;UBound(oFamilyNames)<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160;&#160;oStyles&#160;=&#160;oFamilies.getByName(oFamilyNames(n))<br/>&#160; &#160;&#160;oStyleNames&#160;=&#160;oStyles.getElementNames()<br/>&#160; &#160;&#160;For&#160;i&#160;=&#160;LBound(oStyleNames)&#160;To&#160;UBound&#160;(oStyleNames)<br/>&#160; &#160; &#160;&#160;s=s&#160;+&#160;i&#160;+&#160;&#34; : &#34;&#160;+&#160;oStyleNames(i)&#160;+&#160;CHR$(10)<br/>&#160; &#160; &#160;&#160;If&#160;((i&#160;+&#160;1)&#160;Mod&#160;30&#160;=&#160;0)&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;MsgBox&#160;s,0,oFamilyNames(n)<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Next&#160;i<br/>&#160; &#160;&#160;If&#160;Len(s)&#160;&lt;&gt;&#160;0&#160;Then&#160;MsgBox&#160;s,0,oFamilyNames(n)<br/>&#160;&#160;Next&#160;n<br/>End&#160;Sub<br/>
319<br/>
<hr/>
<a name=323></a><i><b>Figure&#160;88.</b>&#160;The&#160;style&#160;families&#160;in&#160;one&#160;of&#160;my&#160;Writer&#160;documents.</i><br/>
The&#160;different&#160;document&#160;types&#160;contain different&#160;types&#160;of styles<a href="libremacros.html#323">.&#160;Figure&#160;88&#160;s</a>hows&#160;the&#160;style&#160;families&#160;in a&#160;Writer&#160;<br/>document.&#160;Calc&#160;documents&#160;contain&#160;the&#160;style&#160;families&#160;CellStyles&#160;and PageStyles;&#160;Impress&#160;documents&#160;contain&#160;<br/>the&#160;style&#160;families&#160;Graphics&#160;and Default;&#160;Draw&#160;documents&#160;contain&#160;the&#160;style&#160;family&#160;Graphic.&#160;Although each&#160;<br/>style&#160;type&#160;is&#160;different, they&#160;do have&#160;similarities.&#160;For&#160;example, each style&#160;implements&#160;both&#160;the&#160;<br/>com.sun.star.style.Style&#160;service&#160;and the&#160;com.sun.star.style.XStyle&#160;interface.&#160;The&#160;common methods&#160;and&#160;<br/>properties&#160;provide&#160;very&#160;rudimentary&#160;functionality&#160;(see<a href="libremacros.html#323">&#160;Table&#160;110)</a>.<br/>
<i>Table&#160;110. Object&#160;methods&#160;defined in&#160;the&#160;com.sun.star.style.Style&#160;service.</i><br/>
<i><b>Method&#160;or&#160;</b></i><br/>
<i><b>Description</b></i><br/>
<i><b>Property</b></i><br/>
isUserDefined()<br/>
Is&#160;this&#160;style&#160;user-defined?&#160;If&#160;not,&#160;it&#160;is&#160;included&#160;with OOo.<br/>
isInUse()<br/>
Is&#160;this&#160;style&#160;used in&#160;the&#160;document?<br/>
getParentStyle()<br/>
What&#160;is&#160;the&#160;parent&#160;style?<br/>
setParentStyle(name)<br/>
Set&#160;the&#160;parent&#160;style.<br/>
IsPhysical<br/>
Is&#160;the&#160;style&#160;physically&#160;created?<br/>
FollowStyle<br/>
Style&#160;name&#160;applied to&#160;the&#160;next&#160;paragraph.&#160;For&#160;example, while&#160;using&#160;a&#160;heading&#160;<br/>
style&#160;I&#160;might&#160;want&#160;the&#160;next&#160;paragraph to&#160;be&#160;regular&#160;text.<br/>
DisplayName<br/>
Name&#160;of&#160;the&#160;style&#160;as displayed&#160;in&#160;the&#160;user&#160;interface.<br/>
IsAutoUpdate<br/>
If&#160;the&#160;properties of&#160;an&#160;object&#160;using&#160;this&#160;style&#160;are&#160;changed&#160;(for&#160;example, if&#160;I&#160;<br/>change&#160;the&#160;font), are&#160;these&#160;changes automatically&#160;updated to&#160;the&#160;style?&#160;<br/>
<a href="libremacros.html#323">Table&#160;110&#160;s</a>hows&#160;methods&#160;and properties&#160;that&#160;can be&#160;used to&#160;answer the&#160;common&#160;question, “How&#160;do I&#160;obtain<br/>a&#160;list&#160;of styles&#160;that&#160;are&#160;currently&#160;used by&#160;a&#160;document?”&#160;See<a href="libremacros.html#323">&#160;Listing 300&#160;a</a><a href="libremacros.html#324">nd&#160;Figure&#160;89.</a><br/>
<b>TIP</b><br/>
<a href="libremacros.html#322">Listing&#160;299&#160;a</a>ccesses styles by&#160;name;<a href="libremacros.html#323">&#160;Listing&#160;300&#160;a</a>ccesses styles by&#160;index. Notice&#160;that&#160;when getCount()&#160;<br/>
returns 10,&#160;there&#160;are&#160;10&#160;items present, indexed 0&#160;through 9.<br/>
<i><b>Listing&#160;300.</b>&#160;Display&#160;all&#160;used paragraph styles.</i><br/>
Sub&#160;DisplayAllUsedParagraphStyles<br/>&#160;&#160;Dim&#160;oStyles&#160; &#160; &#160; &#160;'Styles is interface com.sun.star.container.XNameAccess<br/>&#160;&#160;Dim&#160;oStyle&#160; &#160; &#160; &#160;&#160;'An individual style<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160;'Utility string variable<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;&#160;'Index variable<br/>&#160;&#160;<br/>&#160;&#160;oStyles&#160;=&#160;ThisComponent.StyleFamilies.getByName(&#34;ParagraphStyles&#34;)<br/>
320<br/>
<hr/>
<a name=324></a>&#160;&#160;REM If getCount() says that there are 10 styles, this means from 0 to 9<br/>&#160;&#160;For&#160;i&#160;=&#160;1&#160;To&#160;oStyles.getCount()<br/>&#160; &#160;&#160;oStyle&#160;=&#160;oStyles.getByIndex(i-1)<br/>&#160; &#160;&#160;If&#160;oStyle.isInUse()&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;oStyle.DisplayName&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,0,&#34;Paragraph Styles In Use&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;89.</b>&#160;Paragraph styles&#160;used in&#160;a Writer&#160;document.</i><br/>
Initially,&#160;I&#160;was&#160;confused by&#160;the&#160;results&#160;shown in<a href="libremacros.html#324">&#160;Figure&#160;89&#160;be</a>cause&#160;it&#160;included&#160;paragraph styles&#160;that&#160;I&#160;thought<br/>I&#160;wasn’t&#160;using. I&#160;assumed that&#160;I&#160;had made&#160;a&#160;mistake&#160;while&#160;writing my&#160;document,&#160;so I&#160;started looking for&#160;<br/>these&#160;accidentally&#160;used styles.&#160;To&#160;find&#160;the&#160;incorrectly&#160;styled text, I&#160;started&#160;with the&#160;Find &amp;&#160;Replace&#160;dialog&#160;<br/>(Edit&#160;|&#160;Find &amp;&#160;Replace). If&#160;you&#160;check the&#160;box labeled “Search for Styles,”&#160;all&#160;of the&#160;styles&#160;used in&#160;the&#160;<br/>document&#160;become&#160;available&#160;in the&#160;“Search for”&#160;drop-down box. I&#160;used this&#160;method to&#160;search for the&#160;style&#160;<br/>“Text&#160;body”&#160;(shown i<a href="libremacros.html#324">n&#160;Figure&#160;89), but</a>&#160;it&#160;was&#160;not&#160;found in the&#160;document.&#160;After some&#160;moments&#160;of confusion&#160;<br/>— in this&#160;case, roughly&#160;five&#160;minutes&#160;— I&#160;realized&#160;that&#160;I&#160;had not&#160;found a&#160;bug in OpenOffice.org, but&#160;rather I&#160;<br/>had uncovered an interesting behavior of which&#160;I&#160;had not&#160;been previously&#160;aware.&#160;When&#160;a&#160;style&#160;is&#160;used in a&#160;<br/>document,&#160;the&#160;parent&#160;style&#160;is&#160;listed&#160;as&#160;used even if it&#160;is&#160;not&#160;directly&#160;used. For example, in&#160;my&#160;document,&#160;the&#160;<br/>style&#160;“Table&#160;Contents”&#160;uses&#160;“Text&#160;body”&#160;as&#160;the&#160;parent&#160;style.<br/>
The&#160;different&#160;style&#160;types&#160;contain&#160;methods&#160;and properties&#160;appropriate&#160;for their&#160;type. See&#160;<br/>http://api.openoffice.org/docs/common/ref/com/sun/star/style/module-ix.html&#160;for the&#160;common services,&#160;<br/>interfaces, structs, and constants&#160;related&#160;to styles.&#160;The&#160;types&#160;shown in the&#160;style&#160;module&#160;are&#160;the&#160;base&#160;on which<br/>the&#160;other styles&#160;are&#160;built. For example,&#160;the&#160;two services&#160;com.sun.star.text.TextPageStyle&#160;and&#160;<br/>com.sun.star.sheet.TablePageStyle&#160;both have&#160;the&#160;service&#160;com.sun.star.style.PageStyle&#160;in common.&#160;To&#160;get&#160;a&#160;<br/>feel&#160;for a&#160;style&#160;it&#160;is&#160;frequently&#160;expedient&#160;to start&#160;by&#160;inspecting the&#160;object.<br/>
MsgBox&#160;&#160;vObj.dbg_methods<br/>MsgBox&#160;&#160;vObj.dbg_supportedInterfaces<br/>MsgBox&#160;&#160;vObj.dbg_properties<br/>
The&#160;style&#160;objects,&#160;like&#160;many&#160;other objects, implement&#160;the&#160;XPropertySet&#160;interface.&#160;The&#160;macro in<a href="libremacros.html#324">&#160;Listing 301&#160;<br/></a>uses&#160;this&#160;interface&#160;to display&#160;a&#160;list&#160;of properties&#160;contained in&#160;the&#160;“_body&#160;text”&#160;paragraph style<a href="libremacros.html#324">.&#160;Listing 301&#160;<br/></a>does&#160;not&#160;display&#160;the&#160;value&#160;of each property;&#160;it&#160;only&#160;displays&#160;the&#160;name&#160;of each property.&#160;It&#160;is&#160;an interesting&#160;<br/>exercise&#160;to&#160;modify<a href="libremacros.html#324">&#160;Listing 301&#160;t</a>o also&#160;display&#160;the&#160;value&#160;of each property&#160;that&#160;is&#160;a&#160;standard data&#160;type&#160;— a&#160;<br/>property&#160;may&#160;be&#160;a&#160;complex&#160;object.<br/>
<i><b>Listing&#160;301.</b>&#160;Display&#160;Properties&#160;for&#160;a paragraph style.<br/></i>Sub&#160;StyleProperties<br/>&#160;&#160;Dim&#160;oStyles&#160; &#160; &#160; &#160;'Styles is interface com.sun.star.container.XNameAccess<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160;'Utility string variable<br/>
321<br/>
<hr/>
<a name=325></a>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;Props&#160; &#160; &#160; &#160; &#160;'Array of properties<br/>&#160;&#160;<br/>&#160;&#160;REM Each style supports the com.sun.star.beans.XPropertySet interface<br/>&#160;&#160;REM This supports the method getPropertySetInfo(), which allows<br/>&#160;&#160;REM an enumeration of the contained properties.<br/>&#160;&#160;REM Get properties returns an array of com.sun.star.beans.Property<br/>&#160;&#160;oStyles&#160;=&#160;ThisComponent.StyleFamilies.getByName(&#34;ParagraphStyles&#34;)<br/>&#160;&#160;Props&#160;=&#160;oStyles.getByName(&#34;_body text&#34;).getPropertySetInfo().getProperties()<br/>
&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;UBound(Props)&#160; &#160; &#160; &#160; &#160;'For each property<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;Props(i).Name&#160;&amp;&#160;CHR$(10)&#160;'Include the property name and new line<br/>&#160; &#160;&#160;If&#160;(i+1)&#160;MOD&#160;30&#160;=&#160;0&#160;Then&#160; &#160; &#160; &#160; &#160;'If the string becomes too large<br/>&#160; &#160; &#160;&#160;MsgBox&#160;s,0,&#34;Style Properties&#34;&#160;&#160;'display the current string<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Reset the list&#160;<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;REM In case the entire list was not printed.<br/>&#160;&#160;If&#160;Len(s)&#160;&lt;&gt;&#160;0&#160;Then&#160;MsgBox&#160;s,0,&#34;Style Properties&#34;<br/>End&#160;Sub<br/>
In&#160;my&#160;experience, it’s&#160;rare&#160;to access&#160;and inspect&#160;styles. It’s&#160;even less&#160;common&#160;to&#160;modify&#160;a&#160;style&#160;from&#160;a&#160;<br/>macro.&#160;There&#160;are&#160;times, however,&#160;when this&#160;is&#160;done. For example,&#160;the&#160;page&#160;size&#160;is&#160;defined by&#160;the&#160;current&#160;<br/>page&#160;style. Use&#160;the&#160;current&#160;controller to determine&#160;the&#160;current&#160;page&#160;style, and then&#160;use&#160;that&#160;to&#160;determine&#160;the&#160;<br/>page&#160;dimensions<a href="libremacros.html#325">.&#160;Listing&#160;302&#160;di</a>splays&#160;the&#160;size&#160;of the&#160;page, the&#160;margins, and the&#160;current&#160;cursor position on&#160;<br/>the&#160;page<a href="libremacros.html#327">.&#160;Figure&#160;90&#160;s</a>hows&#160;the&#160;results.&#160;<br/>
<b>TIP</b><br/>
The&#160;most&#160;common reason&#160;that&#160;I&#160;have&#160;seen for&#160;modifying&#160;a&#160;page&#160;style&#160;is to add&#160;a&#160;header&#160;or&#160;footer&#160;to the&#160;<br/>current&#160;page&#160;style.<br/>
Portions&#160;of this&#160;code&#160;are&#160;speculative&#160;and have&#160;changed since&#160;I&#160;originally&#160;created the&#160;code.&#160;The&#160;current&#160;<br/>controller returns&#160;the&#160;current&#160;cursor position&#160;based on the&#160;leftmost&#160;corner of the&#160;first&#160;page&#160;in the&#160;document.&#160;<br/>On page&#160;200, therefore, the&#160;Y&#160;coordinate&#160;may&#160;be&#160;very&#160;large.&#160;The&#160;following code&#160;attempts&#160;to&#160;compensate&#160;for&#160;<br/>this,&#160;but, it&#160;does&#160;so poorly&#160;– where&#160;poorly&#160;means&#160;that&#160;I&#160;believe&#160;the&#160;answer is&#160;incorrect&#160;with respect&#160;to the&#160;top&#160;<br/>and the&#160;bottom&#160;of the&#160;page.<br/>
<i><b>Listing&#160;302.</b>&#160;PrintPageInformation&#160;<br/></i>Sub&#160;PrintPageInformation<br/>&#160;&#160;Dim&#160;oViewCursor&#160; &#160; &#160;'Current view cursor<br/>&#160;&#160;Dim&#160;oStyle&#160; &#160; &#160; &#160; &#160;&#160;'Current page style&#160;<br/>&#160;&#160;Dim&#160;lHeight&#160;As&#160;Long&#160;'Page height from Page Style in 1/100 mm<br/>&#160;&#160;Dim&#160;lWidth&#160;&#160;As&#160;Long&#160;'Page width &#160;from Page Style in 1/100 mm<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160;'Temporary string variable&#160;<br/>&#160;&#160;REM The current controller interfaces with the human — that's you!<br/>&#160;&#160;REM Well, we hope you are human anyway.<br/>&#160;&#160;REM Obtain the current view cursor from the controller. It is<br/>&#160;&#160;REM the thing that knows where the current cursor is, after all.<br/>&#160;&#160;oViewCursor&#160;=&#160;ThisComponent.CurrentController.getViewCursor()<br/>&#160;&#160;<br/>&#160;&#160;REM That view cursor knows a lot of things, including the&#160;<br/>&#160;&#160;REM current page style. Use the page style name to get<br/>&#160;&#160;REM a reference to the current page style.<br/>&#160;&#160;s&#160;=&#160;oViewCursor.PageStyleName<br/>
322<br/>
<hr/>
<a name=326></a>&#160;&#160;oStyle&#160;=&#160;ThisComponent.StyleFamilies.getByName(&#34;PageStyles&#34;).getByName(s)<br/>&#160;&#160;s&#160;=&#160;&#34;Page Style = &#34;&#160;&amp;&#160;s&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;lHeight&#160;=&#160;oStyle.Height&#160;&#160;'Page height in 1/100 mm<br/>&#160;&#160;lWidth&#160;&#160;=&#160;oStyle.Width&#160; &#160;'Page width &#160;in 1/100 mm<br/>&#160;&#160;<br/>&#160;&#160;REM Page dimensions in mm, inches, and picas.<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Page size is &#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; &#160; &#160; &#34;&#160;&amp;&#160;CStr(lWidth&#160;/&#160;100.0)&#160;&amp;&#160;&#34; mm By &#34;&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; &#160; &#160; &#34;&#160;&amp;&#160;CStr(lHeight&#160;/&#160;100.0)&#160;&amp;&#160;&#34; mm&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; &#160; &#160; &#34;&#160;&amp;&#160;CStr(lWidth&#160;/&#160;2540.0)&#160;&amp;&#160;&#34; inches By &#34;&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; &#160; &#160; &#34;&#160;&amp;&#160;CStr(lHeight&#160;/&#160;2540.0)&#160;&amp;&#160;&#34; inches&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; &#160; &#160; &#34;&#160;&amp;&#160;CStr(lWidth&#160;*72.0&#160;/&#160;2540.0)&#160;&amp;&#160;&#34; picas By &#34;&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; &#160; &#160; &#34;&#160;&amp;&#160;CStr(lHeight&#160;*72.0&#160;/&#160;2540.0)&#160;&amp;&#160;&#34; picas&#34;&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;Dim&#160;dCharHeight&#160;As&#160;Double&#160;'Character height in inches<br/>&#160;&#160;Dim&#160;iCurPage&#160;As&#160;Integer&#160; &#160;'Current page<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;dXCursor&#160;As&#160;Double&#160; &#160;&#160;'Distance from cursor to left in inches<br/>&#160;&#160;Dim&#160;dYCursor&#160;As&#160;Double&#160; &#160;&#160;'Distance from cursor to top in inches<br/>&#160;&#160;Dim&#160;dXRight&#160;&#160;As&#160;Double&#160; &#160;&#160;'Distance from cursor to right in inches<br/>&#160;&#160;Dim&#160;dYBottom&#160;As&#160;Double&#160; &#160;&#160;'Distance from cursor to bottom in inches<br/>&#160;&#160;Dim&#160;dBottom&#160;As&#160;Double&#160; &#160; &#160;'Bottom margin in inches<br/>&#160;&#160;Dim&#160;dLeft&#160; &#160;As&#160;Double&#160; &#160; &#160;'Left margin in inches<br/>&#160;&#160;Dim&#160;dRight&#160;&#160;As&#160;Double&#160; &#160; &#160;'Right margin in inches<br/>&#160;&#160;Dim&#160;dTop&#160; &#160;&#160;As&#160;Double&#160; &#160; &#160;'Top margin in inches<br/>&#160; &#160;<br/>&#160;&#160;dCharHeight&#160;=&#160;oViewCursor.CharHeight&#160;/&#160;72.0&#160;'Convert points to inches<br/>&#160;&#160;iCurPage&#160;=&#160;&#160;oViewCursor.getPage()&#160; &#160; &#160; &#160; &#160; &#160;'Page number<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Current page = &#34;&#160;&amp;&#160;iCurPage&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160;&#160;dBottom&#160;=&#160;oStyle.BottomMargin&#160;/&#160;2540.0&#160;:&#160;dLeft&#160;=&#160;oStyle.LeftMargin&#160;/&#160;2540.0<br/>&#160;&#160;dRight&#160;&#160;=&#160;oStyle.RightMargin&#160;&#160;/&#160;2540.0&#160;:&#160;dTop&#160;&#160;=&#160;oStyle.TopMargin&#160;&#160;/&#160;2540.0<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Margin (inches): Left= &#34;&#160;&amp;&#160;dLeft&#160;&amp;&#160;&#34; &#160;Right= &#34;&#160;&amp;&#160;dRight&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Margin (inches): Top= &#34;&#160;&amp;&#160;dTop&#160;&amp;&#160;&#34; &#160;Bottom= &#34;&#160;&amp;&#160;dBottom&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;v<br/>&#160;&#160;REM Cursor's coordinates relative to the top left position of the page<br/>&#160;&#160;REM Return type is com.sun.star.awt.Point<br/>&#160;&#160;REM Units are in twips. Convert them to inches.<br/>&#160;&#160;v&#160;=&#160;oViewCursor.getPosition()<br/>&#160;&#160;<br/>&#160;&#160;REM Page number from the view cursor includes &#34;phantom&#34; pages because<br/>&#160;&#160;REM two pages in a row must both be on say a right side.<br/>&#160;&#160;REM v.Y does not include this.<br/>&#160;&#160;Dim&#160;realPageNumber&#160;As&#160;Long<br/>&#160;&#160;realPageNumber&#160;=&#160;Fix(v.Y&#160;/&#160;lHeight)<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;realY&#160;:&#160;realY&#160;=&#160;v.Y&#160;-&#160;realPageNumber&#160;*&#160;lHeight<br/>&#160;&#160;<br/>&#160;&#160;REM Place the cursor as the distance to the margin and then add the margin.<br/>&#160;&#160;REM For the vertical height add half the character height. I should<br/>&#160;&#160;REM probably do this for the character width as well for horizontal.<br/>
323<br/>
<hr/>
<a name=327></a>&#160;&#160;dYCursor&#160;=&#160;realY/2540.0&#160;+&#160;dTop&#160;+&#160;dCharHeight&#160;/&#160;2<br/>&#160;&#160;dYBottom&#160;=&#160;(lHeight&#160;-&#160;realY)/2540.0&#160;-&#160;dTop&#160;-&#160;dCharHeight&#160;/&#160;2<br/>&#160;&#160;dXCursor&#160;=&#160;v.X/2540.0&#160;+&#160;dLeft<br/>&#160;&#160;dXRight&#160;&#160;=&#160;(lWidth&#160;-&#160;v.X)/2540.0&#160;-&#160;dLeft<br/>&#160;&#160;<br/>&#160;&#160;s=s&#160;&amp;&#34;Cursor is &#34;&amp;Format(dXCursor,&#160;&#34;0.##&#34;)&#160;&amp;&#160;&#34; inches from left &#34;&amp;CHR$(10)<br/>&#160;&#160;s=s&#160;&amp;&#34;Cursor is &#34;&amp;Format(dXRight,&#160;&#34;0.##&#34;)&#160;&amp;&#160;&#34; inches from right &#34;&amp;CHR$(10)<br/>&#160;&#160;s=s&#160;&amp;&#34;Cursor is &#34;&amp;Format(dYCursor,&#160;&#34;0.##&#34;)&#160;&amp;&#160;&#34; inches from top &#34;&amp;CHR$(10)<br/>&#160;&#160;s=s&#160;&amp;&#34;Cursor is &#34;&amp;Format(dYBottom,&#160;&#34;0.##&#34;)&#160;&amp;&#160;&#34; inches from bottom &#34;&amp;CHR$(10)<br/>&#160;&#160;s=s&#160;&amp;&#34;Char height = &#34;&#160;&amp;&#160;Format(dCharHeight,&#160;&#34;0.####&#34;)&#160;&amp;&#160;&#34; inches&#34;&amp;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Page information&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;90.</b>&#160;Information from&#160;the&#160;page&#160;style.</i><br/>
Calc&#160;documents&#160;are&#160;composed of spreadsheets.&#160;Each sheet&#160;can use&#160;a&#160;different&#160;page&#160;style.&#160;The&#160;macro i<a href="libremacros.html#325">n<br/>Listing 302&#160;obt</a>ains&#160;the&#160;current&#160;page&#160;style&#160;using the&#160;view&#160;cursor.&#160;To&#160;obtain the&#160;style&#160;from&#160;a&#160;Calc&#160;document,&#160;<br/>use&#160;the&#160;active&#160;sheet.<br/>
REM Use the currently active sheet to obtain the page style.<br/>REM In a Calc document, the current controller knows which sheet<br/>REM is active.&#160;<br/>Print&#160;&#34;Style = &#34;&#160;&amp;&#160;ThisComponent.CurrentController.getActiveSheet().PageStyle<br/>
<b>&#160;13.12.1.&#160;Style&#160;utilities<br/></b>Although modifying styles&#160;using macros&#160;is&#160;easy,&#160;small&#160;details&#160;can cause&#160;big&#160;problems;&#160;for example,&#160;<br/>specifying&#160;a&#160;paragraph style&#160;is&#160;not&#160;available&#160;on the&#160;current&#160;computer.&#160;<br/>
<i><b>Listing&#160;303.</b>&#160;Check&#160;a document&#160;for&#160;a paragraph style.</i><br/>
Function&#160;DocHasParStyle(oDoc,&#160;sName$)&#160;As&#160;Boolean<br/>&#160;&#160;Dim&#160;oStyles<br/>&#160;&#160;oStyles&#160;=&#160;oDoc.StyleFamilies.getByName(&#34;ParagraphStyles&#34;)<br/>&#160;&#160;DocHasParStyle()&#160;=&#160;oStyles.hasByName(sName)<br/>End&#160;Function<br/>
Checking for the&#160;character style&#160;is&#160;equally&#160;trivial.<br/>
<i><b>Listing&#160;304.</b>&#160;Check&#160;a document&#160;for&#160;a character&#160;style.</i><br/>
Function&#160;DocHasCharStyle(oDoc,&#160;sName$)&#160;As&#160;Boolean<br/>&#160;&#160;Dim&#160;oStyles<br/>&#160;&#160;oStyles&#160;=&#160;oDoc.StyleFamilies.getByName(&#34;CharacterStyles&#34;)<br/>
324<br/>
<hr/>
<a name=328></a>&#160;&#160;DocHasCharStyle()&#160;=&#160;oStyles.hasByName(sName)<br/>End&#160;Function<br/>
To&#160;determine&#160;if a&#160;document&#160;supports&#160;a&#160;specific&#160;font,&#160;check the&#160;font&#160;descriptors&#160;available&#160;from&#160;the&#160;container&#160;<br/>window.<br/>
<i><b>Listing&#160;305.</b>&#160;Check&#160;a document&#160;for&#160;a font.</i><br/>
Function&#160;DocHasFontName(oDoc,&#160;sName$)&#160;As&#160;Boolean<br/>&#160;&#160;Dim&#160;oWindow<br/>&#160;&#160;Dim&#160;oFonts()<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;<br/>&#160;&#160;oWindow&#160;&#160;=&#160;oDoc.getCurrentController().getFrame().getContainerWindow()<br/>&#160;&#160;oFonts()&#160;=&#160;oWindow.getFontDescriptors()<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(oFonts())&#160;To&#160;UBound(oFonts())<br/>&#160; &#160;&#160;If&#160;oFonts(i).Name&#160;=&#160;sName&#160;Then<br/>&#160; &#160; &#160;&#160;DocHasFontName()&#160;=&#160;True<br/>&#160; &#160; &#160;&#160;Exit&#160;Function<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;DocHasFontName()&#160;=&#160;False<br/>End&#160;Function<br/>
A&#160;property&#160;is&#160;a&#160;structure&#160;with&#160;a&#160;name&#160;and a&#160;value.&#160;The&#160;following macro accepts&#160;a&#160;name&#160;and a&#160;value&#160;and&#160;<br/>returns&#160;a&#160;property&#160;with&#160;the&#160;name&#160;and value.&#160;<br/>
<i><b>Listing&#160;306.</b>&#160;Create&#160;a property&#160;with&#160;the&#160;specified name&#160;and value.<br/></i>'****************************************************************<br/>'** Create and return a PropertyValue structure.<br/>'****************************************************************<br/>Function&#160;CreateProperty(&#160;Optional&#160;cName&#160;As&#160;String,&#160;Optional&#160;uValue&#160;)&#160;As&#160;<br/>com.sun.star.beans.PropertyValue<br/>&#160; &#160;Dim&#160;oPropertyValue&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160; &#160;If&#160;Not&#160;IsMissing(&#160;cName&#160;)&#160;Then<br/>&#160; &#160; &#160;&#160;oPropertyValue.Name&#160;=&#160;cName<br/>&#160; &#160;EndIf<br/>&#160; &#160;If&#160;Not&#160;IsMissing(&#160;uValue&#160;)&#160;Then<br/>&#160; &#160; &#160;&#160;oPropertyValue.Value&#160;=&#160;uValue<br/>&#160; &#160;EndIf<br/>&#160; &#160;CreateProperty()&#160;=&#160;oPropertyValue<br/>End&#160;Function&#160;<br/>
<a href="libremacros.html#328">Listing 306&#160;a</a>llows&#160;properties&#160;to be&#160;created&#160;directly&#160;in&#160;an array.<br/>
<i><b>Listing&#160;307.</b>&#160;Creating properties&#160;used to&#160;create&#160;a character&#160;style.<br/></i>&#160;&#160;REM Base style for all.&#160;<br/>&#160;&#160;REM computer code that is not color coded and used in regular text<br/>&#160;&#160;REM uses this style.<br/>&#160;&#160;oProps()&#160;=&#160;Array(CreateProperty(&#34;CharFontName&#34;,&#160;sFontName),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharColor&#34;,&#160;RGB(0,&#160;0,&#160;0)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharNoHyphenation&#34;,&#160;True)&#160;)<br/>
&#160;&#160;CreateCharacterStyle(&#34;OOoComputerCode&#34;,&#160;oProps())<br/>&#160; &#160;&#160;<br/>&#160;&#160;REM Base style for normal listings.<br/>&#160;&#160;oProps()&#160;=&#160;Array(CreateProperty(&#34;ParentStyle&#34;,&#160;&#34;OOoComputerCode&#34;))<br/>
325<br/>
<hr/>
<a name=329></a>&#160;&#160;<br/>&#160;&#160;CreateCharacterStyle(&#34;_OOoComputerBase&#34;,&#160;oProps())<br/>
The&#160;difficult&#160;part&#160;is&#160;determining what&#160;properties&#160;to&#160;set&#160;and what&#160;properties&#160;to&#160;not&#160;set.&#160;It&#160;is&#160;a&#160;useful&#160;exercise&#160;<br/>to inspect&#160;a&#160;manually&#160;created style&#160;containing&#160;the&#160;values&#160;of interest.&#160;A&#160;property&#160;that&#160;is&#160;not&#160;specifically&#160;set&#160;<br/>inherits&#160;its&#160;value&#160;from&#160;the&#160;parent&#160;style&#160;or existing format;&#160;for example, setting a&#160;character style&#160;to&#160;bold but&#160;<br/>not&#160;specifying the&#160;font&#160;or font&#160;size, produces&#160;a&#160;character style&#160;that&#160;will&#160;not&#160;affect&#160;font&#160;or font&#160;size&#160;and only&#160;<br/>set&#160;the&#160;font&#160;to be&#160;bold.<br/>
<i><b>Listing&#160;308.</b>&#160;Character&#160;styles&#160;used to&#160;format&#160;code&#160;examples.</i><br/>
'****************************************************************<br/>'** Create character styles for StarBasic using the same colors<br/>'** as the OOo IDE.<br/>'****************************************************************<br/>Function&#160;CreateStarBasicCharStyles()<br/>&#160;&#160;Dim&#160;oProps()<br/>
&#160;&#160;REM If you do not want something to have a language, which prevents<br/>&#160;&#160;REM a spell check, set CharLocale to noLocale.<br/>&#160;&#160;Dim&#160;noLocale&#160;As&#160;New&#160;com.sun.star.lang.Locale<br/>&#160;&#160;noLocale.Country&#160;=&#160;&#34;&#34;<br/>&#160;&#160;noLocale.Language&#160;=&#160;&#34;zxx&#34;<br/>
&#160;&#160;If&#160;NOT&#160;CreateBaseCharStyles()&#160;Then<br/>&#160; &#160;&#160;CreateStarBasicCharStyles()&#160;=&#160;False<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;oProps()&#160;=&#160;Array(CreateProperty(&#34;ParentStyle&#34;,&#160;&#34;_OOoComputerBase&#34;),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharColor&#34;,&#160;RGB(76,&#160;76,&#160;76)))<br/>&#160;&#160;CreateCharacterStyle(&#34;_OOoComputerComment&#34;,&#160;oProps())<br/>&#160;&#160;<br/>&#160;&#160;oProps()&#160;=&#160;Array(CreateProperty(&#34;ParentStyle&#34;,&#160;&#34;_OOoComputerBase&#34;),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharColor&#34;,&#160;RGB(255,&#160;0,&#160;0)))<br/>&#160;&#160;CreateCharacterStyle(&#34;_OOoComputerLiteral&#34;,&#160;oProps())<br/>&#160;&#160;<br/>&#160;&#160;oProps()&#160;=&#160;Array(CreateProperty(&#34;ParentStyle&#34;,&#160;&#34;_OOoComputerBase&#34;),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharLocale&#34;,&#160;noLocale),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharColor&#34;,&#160;RGB(0,&#160;0,&#160;128)))<br/>&#160;&#160;CreateCharacterStyle(&#34;_OOoComputerKeyWord&#34;,&#160;oProps())<br/>
&#160;&#160;oProps()&#160;=&#160;Array(CreateProperty(&#34;ParentStyle&#34;,&#160;&#34;_OOoComputerBase&#34;),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharColor&#34;,&#160;RGB(0,&#160;128,&#160;0)))<br/>&#160;&#160;CreateCharacterStyle(&#34;_OOoComputerIdent&#34;,&#160;oProps())<br/>&#160;&#160;CreateStarBasicCharStyles()&#160;=&#160;True<br/>End&#160;Function<br/>
The&#160;following&#160;macro creates&#160;a&#160;character style&#160;if it&#160;does&#160;not&#160;exist.&#160;A&#160;special&#160;check is&#160;performed to&#160;verify&#160;that&#160;<br/>the&#160;parent&#160;style&#160;exists;&#160;the&#160;parent&#160;style&#160;must&#160;be&#160;created before&#160;the&#160;child style.<br/>
<i><b>Listing&#160;309.</b>&#160;Create&#160;a character&#160;style&#160;if&#160;it&#160;does&#160;not&#160;exist.<br/></i>Sub&#160;CreateCharacterStyle(sStyleName$,&#160;oProps())<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;oFamilies<br/>
326<br/>
<hr/>
<a name=330></a>&#160;&#160;Dim&#160;oStyle<br/>&#160;&#160;Dim&#160;oStyles<br/>&#160;&#160;<br/>&#160;&#160;oFamilies&#160;=&#160;ThisComponent.StyleFamilies<br/>&#160;&#160;oStyles&#160;=&#160;oFamilies.getByName(&#34;CharacterStyles&#34;)<br/>&#160;&#160;If&#160;oStyles.HasByName(sStyleName)&#160;Then<br/>&#160; &#160;&#160;'PrintColor(oStyles.getByName(sStyleName).CharColor)<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;oStyle&#160;=&#160;ThisComponent.createInstance(&#34;com.sun.star.style.CharacterStyle&#34;)<br/>&#160;&#160;For&#160;i=LBound(oProps)&#160;To&#160;UBound(oProps)<br/>&#160; &#160;&#160;If&#160;oProps(i).Name&#160;=&#160;&#34;ParentStyle&#34;&#160;Then<br/>&#160; &#160;&#160;<br/>&#160; &#160; &#160;&#160;If&#160;oStyles.HasByName(oProps(i).Value)&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;oStyle.ParentStyle&#160;=&#160;oProps(i).Value<br/>&#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160;&#160;Print&#160;&#34;Parent character style (&#34;&#160;&amp;&#160;oProps(i).Value&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;) does not exist, ignoring parent.&#34;<br/>&#160; &#160; &#160;&#160;End&#160;If&#160; &#160;&#160;<br/>&#160; &#160; &#160;&#160;oStyle.ParentStyle&#160;=&#160;oProps(i).Value<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;oStyle.setPropertyValue(oProps(i).Name,&#160;oProps(i).Value)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;oStyles.insertByName(sStyleName,&#160;oStyle)<br/>End&#160;Sub<br/>
A&#160;paragraph style&#160;is&#160;a&#160;bit&#160;more&#160;complicated&#160;because&#160;a&#160;few&#160;elements&#160;require&#160;special&#160;consideration;&#160;for&#160;<br/>example,&#160;setting tab stops.<br/>
<i><b>Listing&#160;310.</b>&#160;Create&#160;a paragraph style&#160;if&#160;it&#160;does&#160;not&#160;exist.</i><br/>
Sub&#160;CreateParStyle(sStyleName$,&#160;oProps())<br/>&#160;&#160;Dim&#160;i%,&#160;j%<br/>&#160;&#160;Dim&#160;oFamilies<br/>&#160;&#160;Dim&#160;oStyle<br/>&#160;&#160;Dim&#160;oStyles<br/>&#160;&#160;Dim&#160;tabStops%<br/>&#160;&#160;<br/>&#160;&#160;oFamilies&#160;=&#160;ThisComponent.StyleFamilies<br/>&#160;&#160;oStyles&#160;=&#160;oFamilies.getByName(&#34;ParagraphStyles&#34;)<br/>&#160;&#160;If&#160;oStyles.HasByName(sStyleName)&#160;Then<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;oStyle&#160;=&#160;ThisComponent.createInstance(&#34;com.sun.star.style.ParagraphStyle&#34;)<br/>&#160;&#160;For&#160;i=LBound(oProps)&#160;To&#160;UBound(oProps)<br/>&#160; &#160;&#160;If&#160;oProps(i).Name&#160;=&#160;&#34;ParentStyle&#34;&#160;Then<br/>&#160; &#160; &#160;&#160;If&#160;oStyles.HasByName(oProps(i).Value)&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;oStyle.ParentStyle&#160;=&#160;oProps(i).Value<br/>&#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160;&#160;Print&#160;&#34;Parent paragraph style (&#34;&#160;&amp;&#160;oProps(i).Value&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;) does not exist, ignoring parent&#34;<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;ElseIf&#160;oProps(i).Name&#160;=&#160;&#34;ParaTabStops&#34;&#160;Then<br/>&#160; &#160; &#160;&#160;tabStops&#160;=&#160;oProps(i).Value<br/>
327<br/>
<hr/>
<a name=331></a>&#160; &#160; &#160;&#160;Dim&#160;tab(0&#160;To&#160;19)&#160;As&#160;New&#160;com.sun.star.style.TabStop<br/>&#160; &#160; &#160;&#160;For&#160;j&#160;=LBound(tab)&#160;To&#160;UBound(tab)<br/>&#160; &#160; &#160; &#160;&#160;tab(j).Alignment&#160;=&#160;com.sun.star.style.TabAlign.LEFT<br/>&#160; &#160; &#160; &#160;&#160;tab(j).DecimalChar&#160;=&#160;ASC(&#34;.&#34;)<br/>&#160; &#160; &#160; &#160;&#160;tab(j).FillChar&#160;=&#160;32<br/>&#160; &#160; &#160; &#160;&#160;tab(j).Position&#160;=&#160;(j+1)&#160;*&#160;tabStops<br/>&#160; &#160; &#160;&#160;Next<br/>&#160; &#160; &#160;&#160;oStyle.ParaTabStops&#160;=&#160;tab<br/>&#160; &#160;&#160;ElseIf&#160;oProps(i).Name&#160;=&#160;&#34;FollowStyle&#34;&#160;Then<br/>&#160; &#160; &#160;&#160;If&#160;oStyles.HasByName(oProps(i).Value)&#160;OR&#160;oProps(i).Value&#160;=&#160;sStyleName&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;oStyle.setPropertyValue(oProps(i).Name,&#160;oProps(i).Value)<br/>&#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160;&#160;Print&#160;&#34;Next paragraph style (&#34;&#160;&amp;&#160;oProps(i).Value&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;) does not exist, ignoring for style &#34;&#160;&amp;&#160;sStyleName<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;oStyle.setPropertyValue(oProps(i).Name,&#160;oProps(i).Value)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;oStyles.insertByName(sStyleName,&#160;oStyle)<br/>End&#160;Sub<br/>
This&#160;code&#160;creates&#160;the&#160;primary&#160;paragraph styles&#160;used to&#160;format&#160;code&#160;styles&#160;in this&#160;document.<br/>
<i><b>Listing&#160;311.</b>&#160;Properties&#160;to&#160;create&#160;a paragraph style.<br/></i>&#160;&#160;REM Tab stops are set in the paragraph style<br/>&#160;&#160;' 1/4 of an inch<br/>&#160;&#160;tabStopLoc%&#160;=&#160;2540&#160;/&#160;4<br/>
&#160;&#160;oProps()&#160;=&#160;Array(CreateProperty(&#34;ParaTopMargin&#34;,&#160;CLng(0)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaBottomMargin&#34;,&#160;CLng(2540&#160;*&#160;0.03)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaLeftMargin&#34;,&#160;CLng(2540&#160;*&#160;0.20)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaRightMargin&#34;,&#160;CLng(0)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaFirstLineIndent&#34;,&#160;CLng(0)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharFontName&#34;,sFontName),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaTabStops&#34;,&#160;tabStopLoc),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaLineNumberCount&#34;,&#160;False),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;WritingMode&#34;,&#160;com.sun.star.text.WritingMode.LR_TB),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharAutoKerning&#34;,&#160;False),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharHeight&#34;,&#160;fParNormalCharHeight)&#160;)<br/>&#160;&#160;CreateParStyle(&#34;_OOoComputerCode&#34;,&#160;oProps())<br/>
&#160;&#160;oProps()&#160;=&#160;Array(CreateProperty(&#34;ParentStyle&#34;,&#160;&#34;_OOoComputerCode&#34;),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaTopMargin&#34;,&#160;CLng(0)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaBottomMargin&#34;,&#160;CLng(2540&#160;*&#160;0.10)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaLeftMargin&#34;,&#160;CLng(2540&#160;*&#160;0.20)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaRightMargin&#34;,&#160;CLng(0)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaFirstLineIndent&#34;,&#160;CLng(0)),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharFontName&#34;,sFontName),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaTabStops&#34;,&#160;tabStopLoc),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;ParaLineNumberCount&#34;,&#160;False),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;WritingMode&#34;,&#160;com.sun.star.text.WritingMode.LR_TB),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharAutoKerning&#34;,&#160;False),&#160;_<br/>&#160; &#160;&#160;CreateProperty(&#34;CharHeight&#34;,&#160;fParNormalCharHeight),&#160;_<br/>
328<br/>
<hr/>
<a name=332></a>&#160; &#160;&#160;CreateProperty(&#34;FollowStyle&#34;,&#160;sNextStyle)&#160;)<br/>&#160;&#160;CreateParStyle(&#34;_OOoComputerCodeLastLine&#34;,&#160;oProps())&#160;<br/>
<i><b>&#160;13.13.&#160;Dealing&#160;with&#160;locale<br/></b></i>A&#160;locale&#160;represents&#160;a&#160;specific&#160;geographical,&#160;political, or cultural&#160;region. Numbers&#160;and dates&#160;are&#160;considered&#160;<br/>locale-sensitive, so number formats&#160;are&#160;associated with&#160;a&#160;locale. Use&#160;Tools&#160;|&#160;Options&#160;|&#160;Language&#160;Settings&#160;|&#160;<br/>Languages&#160;to&#160;see&#160;which locale&#160;is&#160;used for your computer.&#160;Creating a&#160;locale&#160;is&#160;very&#160;easy.<br/>
Dim&#160;aLocale&#160;As&#160;New&#160;com.sun.star.lang.Locale&#160;<br/>aLocale.Language&#160;=&#160;&#34;fr&#34;<br/>aLocale.Country&#160;=&#160;&#34;FR&#34;<br/>
<b>TIP</b><br/>
OOo may&#160;not&#160;support&#160;every&#160;possible&#160;locale,&#160;but&#160;it&#160;will&#160;attempt&#160;to use&#160;the&#160;best&#160;possible&#160;match.&#160;<br/>
The&#160;locale&#160;depends&#160;upon both the&#160;language&#160;and the&#160;country.&#160;Some&#160;countries&#160;use&#160;multiple&#160;languages&#160;and&#160;<br/>some&#160;languages&#160;are&#160;used in&#160;multiple&#160;countries<a href="libremacros.html#332">.&#160;Table&#160;111&#160;c</a>ontains&#160;the&#160;two-character code&#160;that&#160;identifies&#160;each<br/>language, a<a href="libremacros.html#334">nd&#160;Table&#160;112&#160;c</a>ontains&#160;the&#160;two-character code&#160;that&#160;identifies&#160;each country.<br/>
<b>TIP</b><br/>
Although the&#160;locale&#160;codes are&#160;not&#160;case&#160;sensitive,&#160;they&#160;are&#160;typically&#160;written in&#160;lowercase&#160;for&#160;the&#160;language&#160;<br/>and&#160;uppercase&#160;for&#160;the&#160;country.<br/>
<i>Table&#160;111. Locale&#160;language&#160;codes, alphabetized&#160;by&#160;code.</i><br/>
<i><b>Code</b></i><br/>
<i><b>Language</b></i><br/>
<i><b>Code</b></i><br/>
<i><b>Language</b></i><br/>
<i><b>Code</b></i><br/>
<i><b>Language</b></i><br/>
aa<br/>
Afar<br/>
ab<br/>
Abkhazian<br/>
af<br/>
Afrikaans<br/>
am<br/>
Amharic<br/>
ar<br/>
Arabic<br/>
as<br/>
Assamese<br/>
ay<br/>
Aymara<br/>
az<br/>
Azerbaijani<br/>
ba<br/>
Bashkir<br/>
be<br/>
Byelorussian<br/>
bg<br/>
Bulgarian<br/>
bh<br/>
Bihari<br/>
bi<br/>
Bislama<br/>
bn<br/>
Bengali;&#160;Bangla<br/>
bo<br/>
Tibetan<br/>
br<br/>
Breton<br/>
ca<br/>
Catalan<br/>
co<br/>
Corsican<br/>
cs<br/>
Czech<br/>
cy<br/>
Welsh<br/>
da<br/>
Danish<br/>
de<br/>
German<br/>
dz<br/>
Bhutani<br/>
el<br/>
Greek<br/>
en<br/>
English<br/>
eo<br/>
Esperanto<br/>
es<br/>
Spanish<br/>
et<br/>
Estonian<br/>
eu<br/>
Basque<br/>
fa<br/>
Persian<br/>
fi<br/>
Finnish<br/>
fj<br/>
Fiji<br/>
fo<br/>
Faroese<br/>
fr<br/>
French<br/>
fy<br/>
Frisian<br/>
ga<br/>
Irish<br/>
gd<br/>
Scots Gaelic<br/>
gl<br/>
Galician<br/>
gn<br/>
Guarani<br/>
gu<br/>
Gujarati<br/>
ha<br/>
Hausa<br/>
he<br/>
Hebrew&#160;(formerly&#160;iw)<br/>
hi<br/>
Hindi<br/>
hr<br/>
Croatian<br/>
hu<br/>
Hungarian<br/>
hy<br/>
Armenian<br/>
ia<br/>
Interlingua<br/>
id<br/>
Indonesian (formerly&#160;in)<br/>
ie<br/>
Interlingue<br/>
ik<br/>
Inupiak<br/>
is<br/>
Icelandic<br/>
it<br/>
Italian<br/>
iu<br/>
Inuktitut<br/>
ja<br/>
Japanese<br/>
jw<br/>
Javanese<br/>
ka<br/>
Georgian<br/>
kk<br/>
Kazakh<br/>
329<br/>
<hr/>
<a name=333></a><i><b>Code</b></i><br/>
<i><b>Language</b></i><br/>
<i><b>Code</b></i><br/>
<i><b>Language</b></i><br/>
<i><b>Code</b></i><br/>
<i><b>Language</b></i><br/>
kl<br/>
Greenlandic<br/>
km<br/>
Cambodian<br/>
kn<br/>
Kannada<br/>
ko<br/>
Korean<br/>
ks<br/>
Kashmiri<br/>
ku<br/>
Kurdish<br/>
ky<br/>
Kirghiz<br/>
la<br/>
Latin<br/>
ln<br/>
Lingala<br/>
lo<br/>
Laothian<br/>
lt<br/>
Lithuanian<br/>
lv<br/>
Latvian, Lettish<br/>
mg<br/>
Malagasy<br/>
mi<br/>
Maori<br/>
mk<br/>
Macedonian<br/>
ml<br/>
Malayalam<br/>
mn<br/>
Mongolian<br/>
mo<br/>
Moldavian<br/>
mr<br/>
Marathi<br/>
ms<br/>
Malay<br/>
mt<br/>
Maltese<br/>
my<br/>
Burmese<br/>
na<br/>
Nauru<br/>
ne<br/>
Nepali<br/>
nl<br/>
Dutch<br/>
no<br/>
Norwegian<br/>
oc<br/>
Occitan<br/>
om<br/>
(Afan)&#160;Oromo<br/>
or<br/>
Oriya<br/>
pa<br/>
Punjabi<br/>
pl<br/>
Polish<br/>
ps<br/>
Pashto,&#160;Pushto<br/>
pt<br/>
Portuguese<br/>
qu<br/>
Quechua<br/>
rm<br/>
Rhaeto-Romance<br/>
rn<br/>
Kirundi<br/>
ro<br/>
Romanian<br/>
ru<br/>
Russian<br/>
rw<br/>
Kinyarwanda<br/>
sa<br/>
Sanskrit<br/>
sd<br/>
Sindhi<br/>
sg<br/>
Sangho<br/>
sh<br/>
Serbo-Croatian<br/>
si<br/>
Sinhalese<br/>
sk<br/>
Slovak<br/>
sl<br/>
Slovenian<br/>
sm<br/>
Samoan<br/>
sn<br/>
Shona<br/>
so<br/>
Somali<br/>
sq<br/>
Albanian<br/>
su<br/>
Sundanese<br/>
ss<br/>
Siswati<br/>
st<br/>
Sesotho<br/>
sv<br/>
Swedish<br/>
sw<br/>
Swahili<br/>
ta<br/>
Tamil<br/>
te<br/>
Telugu<br/>
tg<br/>
Tajik<br/>
th<br/>
Thai<br/>
ti<br/>
Tigrinya<br/>
tk<br/>
Turkmen<br/>
tl<br/>
Tagalog<br/>
tn<br/>
Setswana<br/>
to<br/>
Tonga<br/>
tr<br/>
Turkish<br/>
ts<br/>
Tsonga<br/>
tt<br/>
Tatar<br/>
tw<br/>
Twi<br/>
ug<br/>
Uighur<br/>
uk<br/>
Ukrainian<br/>
ur<br/>
Urdu<br/>
uz<br/>
Uzbek<br/>
vi<br/>
Vietnamese<br/>
vo<br/>
Volapuk<br/>
wo<br/>
Wolof<br/>
xh<br/>
Xhosa<br/>
yi<br/>
Yiddish&#160;(formerly&#160;ji)<br/>
yo<br/>
Yoruba<br/>
za<br/>
Zhuang<br/>
zh<br/>
Chinese<br/>
zu<br/>
Zulu<br/>
330<br/>
<hr/>
<a name=334></a><i>Table&#160;112. Locale&#160;country&#160;codes, capitalized by&#160;country.</i><br/>
<i><b>Code</b></i><br/>
<i><b>Country</b></i><br/>
<i><b>Code</b></i><br/>
<i><b>Country</b></i><br/>
AF<br/>
Afghanistan&#160;<br/>
AL<br/>
Albania&#160;<br/>
DZ<br/>
Algeria&#160;<br/>
AS<br/>
American Samoa&#160;<br/>
AD<br/>
Andorra&#160;<br/>
AO<br/>
Angola&#160;<br/>
AI<br/>
Anguilla&#160;<br/>
AQ<br/>
Antarctica&#160;<br/>
AG<br/>
Antigua&#160;and Barbuda&#160;<br/>
AR<br/>
Argentina&#160;<br/>
AM<br/>
Armenia&#160;<br/>
AW<br/>
Aruba&#160;<br/>
AU<br/>
Australia&#160;<br/>
AT<br/>
Austria&#160;<br/>
AZ<br/>
Azerbaijan&#160;<br/>
BS<br/>
Bahamas&#160;<br/>
BH<br/>
Bahrain&#160;<br/>
BD<br/>
Bangladesh&#160;<br/>
BB<br/>
Barbados&#160;<br/>
BY<br/>
Belarus&#160;<br/>
BE<br/>
Belgium&#160;<br/>
BZ<br/>
Belize&#160;<br/>
BJ<br/>
Benin&#160;<br/>
BM<br/>
Bermuda&#160;<br/>
BT<br/>
Bhutan&#160;<br/>
BO<br/>
Bolivia&#160;<br/>
BA<br/>
Bosnia&#160;and Herzegowina&#160;<br/>
BW<br/>
Botswana&#160;<br/>
BV<br/>
Bouvet&#160;Island&#160;<br/>
BR<br/>
Brazil&#160;<br/>
IO<br/>
British Indian Ocean&#160;Territory&#160;<br/>
BN<br/>
Brunei&#160;Darussalam&#160;<br/>
BG<br/>
Bulgaria&#160;<br/>
BF<br/>
Burkina&#160;Faso&#160;<br/>
BI<br/>
Burundi&#160;<br/>
KH<br/>
Cambodia&#160;<br/>
CM<br/>
Cameroon&#160;<br/>
CA<br/>
Canada&#160;<br/>
CV<br/>
Cape&#160;Verde&#160;<br/>
KY<br/>
Cayman Islands&#160;<br/>
CF<br/>
Central&#160;African Republic&#160;<br/>
TD<br/>
Chad&#160;<br/>
CL<br/>
Chile&#160;<br/>
CN<br/>
China&#160;<br/>
CX<br/>
Christmas Island&#160;<br/>
CC<br/>
Cocos (Keeling)&#160;Islands&#160;<br/>
CO<br/>
Colombia&#160;<br/>
KM<br/>
Comoros&#160;<br/>
CD<br/>
Congo, Democratic&#160;Republic&#160;of&#160;(was&#160;<br/>
CG<br/>
Congo,&#160;People’s&#160;Republic&#160;of&#160;<br/>
Zaire)&#160;<br/>
CK<br/>
Cook Islands&#160;<br/>
CR<br/>
Costa&#160;Rica&#160;<br/>
CI<br/>
Cote&#160;D’Ivoire&#160;<br/>
HR<br/>
Croatia&#160;(local&#160;name:&#160;Hrvatska)&#160;<br/>
CU<br/>
Cuba&#160;<br/>
CY<br/>
Cyprus&#160;<br/>
CZ<br/>
Czech Republic&#160;<br/>
DK<br/>
Denmark&#160;<br/>
DJ<br/>
Djibouti&#160;<br/>
DM<br/>
Dominica&#160;<br/>
DO<br/>
Dominican Republic&#160;<br/>
TL<br/>
East&#160;Timor<br/>
EC<br/>
Ecuador<br/>
EG<br/>
Egypt<br/>
SV<br/>
El&#160;Salvador<br/>
GQ<br/>
Equatorial&#160;Guinea<br/>
ER<br/>
Eritrea<br/>
EE<br/>
Estonia<br/>
ET<br/>
Ethiopia<br/>
FK<br/>
Falkland Islands&#160;(Malvinas)<br/>
FO<br/>
Faroe&#160;Islands<br/>
FJ<br/>
Fiji<br/>
FI<br/>
Finland<br/>
FR<br/>
France<br/>
331<br/>
<hr/>
<a name=335></a><i><b>Code</b></i><br/>
<i><b>Country</b></i><br/>
<i><b>Code</b></i><br/>
<i><b>Country</b></i><br/>
FX<br/>
France, Metropolitan<br/>
GF<br/>
French Guiana<br/>
PF<br/>
French Polynesia<br/>
TF<br/>
French Southern&#160;Territories<br/>
GA<br/>
Gabon&#160;<br/>
GM<br/>
Gambia&#160;<br/>
GE<br/>
Georgia&#160;<br/>
DE<br/>
Germany&#160;<br/>
GH<br/>
Ghana&#160;<br/>
GI<br/>
Gibraltar&#160;<br/>
GR<br/>
Greece<br/>
GL<br/>
Greenland<br/>
GD<br/>
Grenada<br/>
GP<br/>
Guadeloupe<br/>
GU<br/>
Guam<br/>
GT<br/>
Guatemala<br/>
GN<br/>
Guinea<br/>
GW<br/>
Guinea-Bissau<br/>
GY<br/>
Guyana<br/>
HT<br/>
Haiti<br/>
HM<br/>
Heard&#160;and&#160;Mc&#160;Donald&#160;Islands<br/>
HN<br/>
Honduras<br/>
HK<br/>
Hong Kong<br/>
HU<br/>
Hungary<br/>
IS<br/>
Iceland<br/>
IN<br/>
India<br/>
ID<br/>
Indonesia<br/>
IR<br/>
Iran (Islamic&#160;Republic&#160;Of)<br/>
IQ<br/>
Iraq<br/>
IE<br/>
Ireland<br/>
IL<br/>
Israel<br/>
IT<br/>
Italy<br/>
JM<br/>
Jamaica<br/>
JP<br/>
Japan<br/>
JO<br/>
Jordan<br/>
KZ<br/>
Kazakhstan<br/>
KE<br/>
Kenya<br/>
KI<br/>
Kiribati<br/>
KP<br/>
Korea,&#160;Democratic&#160;People’s&#160;Republic&#160;Of<br/>
KR<br/>
Korea, Republic&#160;Of<br/>
KW<br/>
Kuwait<br/>
KG<br/>
Kyrgyzstan<br/>
LA<br/>
Lao&#160;People’s&#160;Democratic&#160;Republic<br/>
LV<br/>
Latvia<br/>
LB<br/>
Lebanon<br/>
LS<br/>
Lesotho<br/>
LR<br/>
Liberia<br/>
LY<br/>
Libyan&#160;Arab Jamahiriya<br/>
LI<br/>
Liechtenstein<br/>
LT<br/>
Lithuania<br/>
LU<br/>
Luxembourg&#160;<br/>
MK<br/>
Macedonia,&#160;The&#160;Former&#160;Yugoslav Republic&#160;Of<br/>
MG<br/>
Madagascar<br/>
MW<br/>
Malawi<br/>
MY<br/>
Malaysia<br/>
MV<br/>
Maldives<br/>
ML<br/>
Mali<br/>
MT<br/>
Malta<br/>
MH<br/>
Marshall&#160;Islands<br/>
MQ<br/>
Martinique<br/>
MR<br/>
Mauritania<br/>
MU<br/>
Mauritius<br/>
YT<br/>
Mayotte<br/>
MX<br/>
Mexico<br/>
FM<br/>
Micronesia,&#160;Federated&#160;States Of<br/>
MD<br/>
Moldova,&#160;Republic&#160;Of<br/>
MC<br/>
Monaco<br/>
MN<br/>
Mongolia<br/>
MS<br/>
Montserrat<br/>
MA<br/>
Morocco<br/>
MZ<br/>
Mozambique<br/>
MM<br/>
Myanmar<br/>
NA<br/>
Namibia<br/>
NR<br/>
Nauru<br/>
NP<br/>
Nepal<br/>
NL<br/>
Netherlands<br/>
332<br/>
<hr/>
<a name=336></a><i><b>Code</b></i><br/>
<i><b>Country</b></i><br/>
<i><b>Code</b></i><br/>
<i><b>Country</b></i><br/>
AN<br/>
Netherlands&#160;Antilles<br/>
NC<br/>
New&#160;Caledonia<br/>
NZ<br/>
New&#160;Zealand<br/>
NI<br/>
Nicaragua<br/>
NE<br/>
Niger<br/>
NG<br/>
Nigeria<br/>
NU<br/>
Niue<br/>
NF<br/>
Norfolk Island<br/>
MP<br/>
Northern Mariana&#160;Islands<br/>
NO<br/>
Norway<br/>
OM<br/>
Oman<br/>
PK<br/>
Pakistan<br/>
PW<br/>
Palau<br/>
PS<br/>
Palestinian&#160;Territory,&#160;Occupied<br/>
PA<br/>
Panama<br/>
PG<br/>
Papua&#160;New&#160;Guinea<br/>
PY<br/>
Paraguay<br/>
PE<br/>
Peru<br/>
PH<br/>
Philippines<br/>
PN<br/>
Pitcairn<br/>
PL<br/>
Poland<br/>
PT<br/>
Portugal<br/>
PR<br/>
Puerto&#160;Rico<br/>
QA<br/>
Qatar<br/>
RE<br/>
Reunion<br/>
RO<br/>
Romania<br/>
RU<br/>
Russian Federation<br/>
RW<br/>
Rwanda<br/>
KN<br/>
Saint&#160;Kitts&#160;And Nevis<br/>
LC<br/>
Saint&#160;Lucia<br/>
VC<br/>
Saint&#160;Vincent&#160;and&#160;The&#160;Grenadines<br/>
WS<br/>
Samoa<br/>
SM<br/>
San Marino<br/>
ST<br/>
Sao&#160;Tome&#160;and&#160;Principe<br/>
SA<br/>
Saudi&#160;Arabia<br/>
SN<br/>
Senegal<br/>
SC<br/>
Seychelles<br/>
SL<br/>
Sierra&#160;Leone<br/>
SG<br/>
Singapore<br/>
SK<br/>
Slovakia&#160;(Slovak Republic)<br/>
SI<br/>
Slovenia<br/>
SB<br/>
Solomon Islands<br/>
SO<br/>
Somalia<br/>
ZA<br/>
South&#160;Africa<br/>
GS<br/>
South&#160;Georgia&#160;and&#160;The&#160;South Sandwich&#160;<br/>
ES<br/>
Spain<br/>
Islands<br/>
LK<br/>
Sri&#160;Lanka<br/>
SH<br/>
St. Helena<br/>
PM<br/>
St. Pierre&#160;And&#160;Miquelon<br/>
SD<br/>
Sudan<br/>
SR<br/>
Suriname<br/>
SJ<br/>
Svalbard&#160;And Jan&#160;Mayen Islands<br/>
SZ<br/>
Swaziland<br/>
SE<br/>
Sweden<br/>
CH<br/>
Switzerland<br/>
SY<br/>
Syrian&#160;Arab&#160;Republic<br/>
TW<br/>
Taiwan<br/>
TJ<br/>
Tajikistan<br/>
TZ<br/>
Tanzania,&#160;United Republic&#160;Of<br/>
TH<br/>
Thailand<br/>
TG<br/>
Togo<br/>
TK<br/>
Tokelau<br/>
TO<br/>
Tonga<br/>
TT<br/>
Trinidad and tobago<br/>
TN<br/>
Tunisia<br/>
TR<br/>
Turkey<br/>
TM<br/>
Turkmenistan<br/>
TC<br/>
Turks&#160;And Caicos Islands<br/>
TV<br/>
Tuvalu<br/>
UG<br/>
Uganda<br/>
UA<br/>
Ukraine<br/>
AE<br/>
United&#160;Arab&#160;Emirates<br/>
GB<br/>
United&#160;Kingdom<br/>
US<br/>
United&#160;States<br/>
333<br/>
<hr/>
<a name=337></a><i><b>Code</b></i><br/>
<i><b>Country</b></i><br/>
<i><b>Code</b></i><br/>
<i><b>Country</b></i><br/>
UM<br/>
United&#160;States Minor&#160;Outlying&#160;Islands<br/>
UY<br/>
Uruguay<br/>
UZ<br/>
Uzbekistan<br/>
VU<br/>
Vanuatu<br/>
VA<br/>
Vatican&#160;City&#160;State&#160;(Holy&#160;See)<br/>
VE<br/>
Venezuela<br/>
VN<br/>
Viet&#160;Nam<br/>
VG<br/>
Virgin Islands (British)<br/>
VI<br/>
Virgin&#160;Islands (U.S.)<br/>
WF<br/>
Wallis and Futuna&#160;Islands<br/>
EH<br/>
Western Sahara<br/>
YE<br/>
Yemen<br/>
YU<br/>
Yugoslavia<br/>
ZM<br/>
Zambia<br/>
ZW<br/>
Zimbabwe<br/>
I&#160;make&#160;extensive&#160;use&#160;of styles&#160;in&#160;the&#160;OOo documents&#160;that&#160;I&#160;write.&#160;I&#160;use&#160;a&#160;specific&#160;paragraph style&#160;to format&#160;<br/>my&#160;code&#160;samples. Each paragraph style&#160;allows&#160;you to set&#160;the&#160;default&#160;character attributes&#160;to use&#160;in the&#160;<br/>paragraph. In&#160;OOo, characters&#160;specify&#160;the&#160;locale&#160;so I&#160;set&#160;the&#160;locale&#160;for this&#160;paragraph style&#160;to unknown;&#160;this&#160;<br/>prevents&#160;the&#160;spell-checker from&#160;checking my&#160;code&#160;samples.<br/>
To&#160;tell&#160;OOo that&#160;a&#160;word is&#160;French, and should be&#160;checked as&#160;French, set&#160;the&#160;locale&#160;of the&#160;characters&#160;to&#160;<br/>French.&#160;The&#160;code&#160;in<a href="libremacros.html#337">&#160;Listing 312&#160;t</a>raverses&#160;the&#160;paragraphs&#160;in&#160;a&#160;document&#160;and sets&#160;the&#160;locale&#160;on each one.<br/>
<i><b>Listing&#160;312.</b>&#160;Set&#160;a simple&#160;Writer&#160;document&#160;to use&#160;a French locale.</i><br/>
Sub&#160;SetDocumentLocale<br/>&#160;&#160;Dim&#160;aLocale&#160;As&#160;New&#160;com.sun.star.lang.Locale&#160;<br/>&#160;&#160;aLocale.Language&#160;=&#160;&#34;fr&#34;&#160; &#160;'Set the Locale to use the French language<br/>&#160;&#160;aLocale.Country&#160;=&#160;&#34;FR&#34;&#160; &#160;&#160;'Set the Locale to use France as the country<br/>&#160;&#160;Dim&#160;oCursor&#160;&#160;'Cursor used to traverse the document.<br/>&#160;&#160;Dim&#160;oText&#160; &#160;&#160;'The document text object<br/>
&#160;&#160;oText&#160;=&#160;ThisComponent.Text&#160; &#160; &#160; &#160; &#160;'Writer documents have a Text object<br/>&#160;&#160;oCursor&#160;=&#160;oText.createTextCursor()&#160;'Create a text cursor<br/>
&#160;&#160;REM Move cursor to the start of the document and do not select text.<br/>&#160;&#160;oCursor.GoToStart(False)<br/>
&#160;&#160;REM Move to the end of the paragraph, selecting the entire paragraph.<br/>&#160;&#160;REM gotoNextParagraph() returns False if it fails.<br/>&#160;&#160;Do&#160;While&#160;oCursor.gotoNextParagraph(True)<br/>&#160; &#160;&#160;oCursor.CharLocale&#160;=&#160;aLocale&#160;'This can fail for some paragraph types<br/>&#160; &#160;&#160;oCursor.goRight(0,&#160;False)&#160; &#160;&#160;'Deselect all text<br/>&#160;&#160;Loop<br/>End&#160;Sub<br/>
The&#160;spell-checker,&#160;hyphenation, and thesaurus&#160;all&#160;require&#160;a&#160;locale&#160;to&#160;function.&#160;They&#160;will&#160;not&#160;function,&#160;<br/>however,&#160;if they&#160;aren’t&#160;properly&#160;configured. Use&#160;<b>Tools&#160;|&#160;Options&#160;|&#160;Language&#160;Settings&#160;|&#160;Writing&#160;Aids</b>&#160;to&#160;<br/>configure&#160;these&#160;in&#160;OOo.&#160;The&#160;macro i<a href="libremacros.html#337">n&#160;Listing&#160;313&#160;obt</a>ains&#160;a&#160;SpellChecker,&#160;Hyphenator,&#160;and&#160;Thesaurus, all&#160;of<br/>which&#160;require&#160;a&#160;Locale&#160;object.<br/>
<i><b>Listing&#160;313.</b>&#160;Spell&#160;Check, Hyphenate, and Thesaurus.<br/></i>Sub&#160;SpellCheckExample<br/>&#160;&#160;Dim&#160;s()&#160; &#160; &#160; &#160; &#160;&#160;'Contains the words to check<br/>&#160;&#160;Dim&#160;vReturn&#160; &#160; &#160;&#160;'Value returned from SpellChecker, Hyphenator, and Thesaurus<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;'Utility index variable<br/>
334<br/>
<hr/>
<a name=338></a>&#160;&#160;Dim&#160;msg$&#160; &#160; &#160; &#160; &#160;'Message string<br/>&#160;&#160;<br/>&#160;&#160;REM Although I create an empty argument array, I could also<br/>&#160;&#160;REM use Array() to return an empty array.<br/>&#160;&#160;Dim&#160;emptyArgs()&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;aLocale&#160;As&#160;New&#160;com.sun.star.lang.Locale<br/>&#160;&#160;aLocale.Language&#160;=&#160;&#34;en&#34;&#160;&#160;'Use the English language<br/>&#160;&#160;aLocale.Country&#160;=&#160;&#34;US&#34;&#160; &#160;'Use the United States as the country<br/>&#160; &#160;&#160;<br/>&#160;&#160;REM Words to check for spelling, hyphenation, and thesaurus<br/>&#160;&#160;s&#160;=&#160;Array(&#34;hello&#34;,&#160;&#34;anesthesiologist&#34;,_<br/>&#160; &#160; &#160;&#160;&#34;PNEUMONOULTRAMICROSCOPICSILICOVOLCANOCONIOSIS&#34;,_<br/>&#160; &#160; &#160;&#160;&#34;Pitonyak&#34;,&#160;&#34;misspell&#34;)<br/>&#160; &#160;&#160;<br/>&#160;&#160;REM *********Spell Check Example!<br/>&#160;&#160;Dim&#160;vSpeller&#160;As&#160;Variant<br/>&#160;&#160;vSpeller&#160;=&#160;createUnoService(&#34;com.sun.star.linguistic2.SpellChecker&#34;)<br/>&#160;&#160;'Use vReturn = vSpeller.spell(s, aLocale, emptyArgs()) if you want options!<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(s())&#160;To&#160;UBound(s())<br/>&#160; &#160;&#160;vReturn&#160;=&#160;vSpeller.isValid(s(i),&#160;aLocale,&#160;emptyArgs())<br/>&#160; &#160;&#160;msg&#160;=&#160;msg&#160;&amp;&#160;vReturn&#160;&amp;&#160;&#34; for &#34;&#160;&amp;&#160;s(i)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;msg,&#160;0,&#160;&#34;Spell Check Words&#34;<br/>&#160;&#160;msg&#160;=&#160;&#34;&#34;<br/>&#160;&#160;<br/>&#160;&#160;'******Hyphenation Example!<br/>&#160;&#160;Dim&#160;vHyphen&#160;As&#160;Variant<br/>&#160;&#160;vHyphen&#160;=&#160;createUnoService(&#34;com.sun.star.linguistic2.Hyphenator&#34;)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(s())&#160;To&#160;UBound(s())<br/>&#160; &#160;&#160;'vReturn = vHyphen.hyphenate(s(i), aLocale, 0, emptyArgs())<br/>&#160; &#160;&#160;vReturn&#160;=&#160;vHyphen.createPossibleHyphens(s(i),&#160;aLocale,&#160;emptyArgs())<br/>&#160; &#160;&#160;If&#160;IsNull(vReturn)&#160;Then<br/>&#160; &#160; &#160;&#160;'hyphenation is probablly off in the configuration<br/>&#160; &#160; &#160;&#160;msg&#160;=&#160;msg&#160;&amp;&#160;&#34; null for &#34;&#160;&amp;&#160;s(i)&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;msg&#160;=&#160;msg&#160;&amp;&#160;vReturn.getPossibleHyphens()&#160;&amp;&#160;&#34; for &#34;&#160;&amp;&#160;s(i)&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;msg,&#160;0,&#160;&#34;Hyphenate Words&#34;<br/>&#160;&#160;msg&#160;=&#160;&#34;&#34;<br/>&#160;&#160;<br/>
335<br/>
<hr/>
<a name=339></a>&#160;&#160;'******Thesaurus Example!<br/>&#160;&#160;Dim&#160;vThesaurus&#160;As&#160;Variant&#160;<br/>&#160;&#160;Dim&#160;j&#160;As&#160;Integer,&#160;k&#160;As&#160;Integer<br/>&#160;&#160;vThesaurus&#160;=&#160;createUnoService(&#34;com.sun.star.linguistic2.Thesaurus&#34;)<br/>&#160;&#160;s&#160;=&#160;Array(&#34;hello&#34;,&#160;&#34;stamp&#34;,&#160;&#34;cool&#34;)&#160;<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(s())&#160;To&#160;UBound(s())<br/>&#160; &#160;&#160;vReturn&#160;=&#160;vThesaurus.queryMeanings(s(i),&#160;aLocale,&#160;emptyArgs())<br/>&#160; &#160;&#160;If&#160;UBound(vReturn)&#160;&lt;&#160;0&#160;Then<br/>&#160; &#160; &#160;&#160;Print&#160;&#34;Thesaurus found nothing for &#34;&#160;&amp;&#160;s(i)<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;msg&#160;=&#160;&#34;Word &#34;&#160;&amp;&#160;s(i)&#160;&amp;&#160;&#34; has the following meanings:&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160;&#160;For&#160;j&#160;=&#160;LBound(vReturn)&#160;To&#160;UBound(vReturn)<br/>&#160; &#160; &#160; &#160;&#160;msg=msg&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;Meaning = &#34;&#160;&amp;&#160;vReturn(j).getMeaning()&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160; &#160;&#160;msg&#160;=&#160;msg&#160;&amp;&#160;Join(vReturn(j).querySynonyms(),&#160;&#34; &#34;)&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160;&#160;Next<br/>&#160; &#160; &#160;&#160;MsgBox&#160;msg,&#160;0,&#160;&#34;Althernate Meanings&#34;<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
It&#160;is&#160;possible&#160;to obtain the&#160;default&#160;locale&#160;that&#160;is&#160;configured for OOo. Laurent&#160;Godard, an active&#160;<br/>OpenOffice.org&#160;volunteer,&#160;wrote&#160;the&#160;macro i<a href="libremacros.html#339">n&#160;Listing&#160;314, w</a>hich obtains&#160;OOo’s&#160;currently&#160;configured locale.<br/>
<i><b>Listing&#160;314.</b>&#160;Currently&#160;configured language&#160;(Locale).<br/></i>Sub&#160;OOoLang()<br/>&#160;&#160;'Retreives the running OOO version<br/>&#160;&#160;'Author : Laurent Godard<br/>&#160;&#160;'e-mail : listes.godard@laposte.net<br/>&#160;&#160;'<br/>&#160;&#160;Dim&#160;aSettings,&#160;aConfigProvider<br/>&#160;&#160;Dim&#160;aParams2(0)&#160;As&#160;new&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;Dim&#160;sProvider$,&#160;sAccess$<br/>&#160;&#160;sProvider&#160;=&#160;&#34;com.sun.star.configuration.ConfigurationProvider&#34;<br/>&#160;&#160;sAccess&#160; &#160;=&#160;&#34;com.sun.star.configuration.ConfigurationAccess&#34;<br/>&#160;&#160;aConfigProvider&#160;=&#160;createUnoService(sProvider)<br/>&#160;&#160;aParams2(0).Name&#160;=&#160;&#34;nodepath&#34;<br/>&#160;&#160;aParams2(0).Value&#160;=&#160;&#34;/org.openoffice.Setup/L10N&#34;<br/>&#160;&#160;aSettings&#160;=&#160;aConfigProvider.createInstanceWithArguments(sAccess,&#160;aParams2())<br/>
&#160;&#160;Dim&#160;OOLangue&#160;as&#160;string<br/>&#160;&#160;OOLangue=&#160;aSettings.getbyname(&#34;ooLocale&#34;)&#160; &#160;&#160;'en-US<br/>&#160;&#160;MsgBox&#160;&#34;OOo is configured with Locale &#34;&#160;&amp;&#160;OOLangue,&#160;0,&#160;&#34;OOo Locale&#34;<br/>End&#160;Sub<br/>
The&#160;above&#160;macro is&#160;reputed to&#160;fail&#160;on&#160;AOO, but, the&#160;following should&#160;work correctly.&#160;The&#160;macro does&#160;<br/>function correctly&#160;with LO.&#160;The&#160;macro shown below&#160;should work for both&#160;AOO&#160;and LO.<br/>
<i><b>Listing&#160;315.</b>&#160;You can use&#160;the&#160;tools&#160;library&#160;to get&#160;the&#160;current&#160;locale&#160;as&#160;a string.<br/></i>GlobalScope.BasicLibraries.loadLibrary(&#160;&#34;Tools&#34;&#160;)<br/>Print&#160;GetRegistryKeyContent(&#34;org.openoffice.Setup/L10N&#34;,FALSE).getByName(&#34;ooLocale&#34;)&#160;<br/>
336<br/>
<hr/>
<a name=340></a><i><b>&#160;13.14.&#160;Enumerating&#160;printers<br/></b></i>The&#160;ability&#160;to&#160;enumerate&#160;printers&#160;has&#160;long been lacking in&#160;OOo.&#160;To&#160;obtain&#160;a&#160;printer list&#160;in&#160;OOo version&#160;1.x&#160;<br/>or 2.x&#160;I&#160;used the&#160;.uno:print&#160;dispatch&#160;to open the&#160;print&#160;dialog, and then I&#160;directly&#160;access&#160;the&#160;dialog to&#160;extract&#160;<br/>the&#160;list&#160;of available&#160;printers.&#160;<br/>
The&#160;PrinterServer service&#160;was&#160;introduced, but&#160;it&#160;was&#160;not&#160;properly&#160;constructed, so the&#160;methods&#160;in&#160;the&#160;<br/>XPrinterServer interface&#160;are&#160;not&#160;directly&#160;available;&#160;according&#160;to&#160;Ariel&#160;Constenla-Haile&#160;this&#160;is&#160;slated&#160;to be&#160;<br/>ready&#160;in&#160;OOo 3.5.&#160;Thankfully,&#160;Niklas&#160;Nebel&#160;provided a&#160;working&#160;solution.&#160;The&#160;solution is&#160;a&#160;bit&#160;tricky,&#160;but&#160;it&#160;<br/>demonstrates&#160;how&#160;to work around the&#160;problem.<br/>
<i><b>Listing&#160;316.</b>&#160;Display&#160;available&#160;printers.<br/></i>Sub&#160;PrintAllPrinterNames()<br/>&#160;&#160;Dim&#160;oPrintServer&#160;' The print server service.<br/>&#160;&#160;Dim&#160;oCore&#160; &#160; &#160; &#160;&#160;' Get classes and other objects by name.<br/>&#160;&#160;Dim&#160;oClass&#160; &#160; &#160; &#160;' XPrinterServer class object.<br/>&#160;&#160;Dim&#160;oMethod&#160; &#160; &#160;&#160;' getPrinterNames method from the XPrinterServer class.<br/>&#160;&#160;Dim&#160;aNames&#160; &#160; &#160; &#160;' List of printer names.<br/>&#160;&#160;<br/>&#160;&#160;' Create the object that will not be directly usable until OOo 3.5.<br/>&#160;&#160;oPrintServer&#160;=&#160;CreateUnoService(&#34;com.sun.star.awt.PrinterServer&#34;)<br/>&#160;&#160;oCore&#160;=&#160;CreateUnoService(&#34;com.sun.star.reflection.CoreReflection&#34;)<br/>&#160;&#160;<br/>&#160;&#160;' Get the class object for the XPrinterServer interface.<br/>&#160;&#160;oClass&#160;=&#160;oCore.forName(&#34;com.sun.star.awt.XPrinterServer&#34;)<br/>&#160;&#160;<br/>&#160;&#160;' Get the getPrinterNames method for the XPrinterServer class.<br/>&#160;&#160;oMethod&#160;=&#160;oClass.getMethod(&#34;getPrinterNames&#34;)<br/>&#160;&#160;<br/>&#160;&#160;' Call the getPrinterNames method on the PrinterServer object.<br/>&#160;&#160;aNames&#160;=&#160;oMethod.invoke(oPrintServer,&#160;Array())&#160;<br/>&#160;&#160;MsgBox&#160;Join(aNames,&#160;CHR$(10))<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
If&#160;OOo&#160;does not&#160;recognize&#160;your&#160;printer&#160;by&#160;it's name,&#160;surround the&#160;printer&#160;name&#160;with angle&#160;brackets&#160;<br/>
“&lt;printer_name&gt;”,&#160;in the&#160;past&#160;some&#160;printers required&#160;this.<br/>
Prior to OOo 3.5, the PrinterServer cannot be used from Basic, because XTypeProvider is not declared to be<br/>
inherited by that class; although it is implemented in the class. Basic cannot, therefore, recognize the <br/>
methods supported by the object. The code i<a href="libremacros.html#340">n Listing 316 de</a>monstrates how to call the method directly.<br/>
<i><b>&#160;13.15.&#160;Printing&#160;documents<br/></b></i>The&#160;primary&#160;printing functionality&#160;is&#160;common&#160;to all&#160;OOo document&#160;types.&#160;The&#160;interface&#160;<br/>com.sun.star.view.XPrintable&#160;defines&#160;three&#160;methods&#160;(see<a href="libremacros.html#340">&#160;Table&#160;113)</a>.<br/>
<i>Table&#160;113. Object&#160;methods&#160;defined by&#160;com.sun.star.view.XPrintable.</i><br/>
<i><b>Object&#160;Method</b></i><br/>
<i><b>Description</b></i><br/>
getPrinter()<br/>
Default&#160;printer&#160;as&#160;an array&#160;of&#160;properties&#160;(com.sun.star.view.PrinterDescriptor).<br/>
setPrinter(properties)&#160;<br/>
Assign a&#160;new&#160;printer&#160;to the&#160;object&#160;(com.sun.star.view.PrinterDescriptor).<br/>
print(properties)&#160;<br/>
Print&#160;the&#160;document&#160;(com.sun.star.view.PrintOptions).<br/>
337<br/>
<hr/>
<a name=341></a>The&#160;object&#160;method&#160;getPrinter() returns&#160;an array&#160;of properties&#160;that&#160;describe&#160;the&#160;printer (see<a href="libremacros.html#342">&#160;Figure&#160;91).&#160;</a>The&#160;<br/>macro i<a href="libremacros.html#341">n&#160;Listing&#160;317&#160;de</a>monstrates&#160;how&#160;to&#160;access&#160;and interpret&#160;each of the&#160;properties&#160;(see<a href="libremacros.html#342">&#160;Table&#160;114&#160;fo</a>r&#160;<br/>supported&#160;properties).&#160;<br/>
<i><b>Listing&#160;317.</b>&#160;Display&#160;printer&#160;properties.<br/></i>Sub&#160;DisplayPrinterProperties<br/>&#160;&#160;Dim&#160;Props&#160;&#160;'Array of com.sun.star.beans.PropertyValue<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160;'Index variable of type Integer<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160;'Display string<br/>&#160;&#160;Dim&#160;v&#160; &#160; &#160;&#160;'<br/>&#160;&#160;Dim&#160;sName$&#160;'<br/>&#160;&#160;On&#160;Error&#160;Resume&#160;Next<br/>&#160;&#160;Props&#160;=&#160;ThisComponent.getPrinter()<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;UBound(Props)<br/>&#160; &#160;&#160;sName&#160;=&#160;props(i).Name<br/>&#160; &#160;&#160;v&#160;=&#160;props(i).Value<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sName&#160;&amp;&#160;&#34; &#160;= &#160;&#34;<br/>&#160; &#160;&#160;If&#160;sName&#160;=&#160;&#34;PaperOrientation&#34;&#160;Then<br/>&#160; &#160; &#160;&#160;REM com.sun.star.view.PaperOrientation.LANDSCAPE also supported<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;IIf(v=com.sun.star.view.PaperOrientation.PORTRAIT,_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;Portrait&#34;,&#160;&#34;Landscape&#34;)&#160;&amp;&#160;&#34; &#160;= &#160;&#34;&#160;&amp;&#160;CStr(v)<br/>&#160; &#160;&#160;ElseIf&#160;sName&#160;=&#160;&#34;PaperFormat&#34;&#160;Then<br/>&#160; &#160; &#160;&#160;Select&#160;Case&#160;v<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;com.sun.star.view.PaperFormat.A3<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;A3&#34;<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;com.sun.star.view.PaperFormat.A4<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;A4&#34;<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;com.sun.star.view.PaperFormat.A5<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;A5&#34;<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;com.sun.star.view.PaperFormat.B4<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;B4&#34;<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;com.sun.star.view.PaperFormat.B5<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;B5&#34;<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;com.sun.star.view.PaperFormat.LETTER<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;LETTER&#34;<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;com.sun.star.view.PaperFormat.LEGAL<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;LEGAL&#34;<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;com.sun.star.view.PaperFormat.TABLOID<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;TABLOID&#34;<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;com.sun.star.view.PaperFormat.USER<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;USER&#34;<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;Else<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Unknown value&#34;<br/>&#160; &#160; &#160;&#160;End&#160;Select<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; &#160;= &#160;&#34;&#160;&amp;&#160;CStr(v)<br/>&#160; &#160;&#160;ElseIf&#160;sName&#160;=&#160;&#34;PaperSize&#34;&#160;Then<br/>&#160; &#160; &#160;&#160;REM type is com.sun.star.awt.Size<br/>&#160; &#160; &#160;&#160;REM The size is in TWIPS and there are 1440 twips per inch<br/>&#160; &#160; &#160;&#160;s=s&#160;&amp;&#160;CDbl(v.Width)/1440.0&#160;&amp;&#160;&#34;x&#34;&#160;&amp;&#160;CDbl(v.Height)/1440.0&#160;&amp;&#160;&#34; (inches)&#34;<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(v)<br/>
338<br/>
<hr/>
<a name=342></a>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Printer Properties&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;91.</b>&#160;Properties&#160;of&#160;the&#160;default&#160;printer.</i><br/>
<i>Table&#160;114. Properties&#160;defined by&#160;the&#160;service&#160;com.sun.star.view.PrinterDescriptor.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Name&#160;<br/>
Name&#160;of&#160;the&#160;printer&#160;queue.<br/>
PaperOrientation&#160;<br/>
Paper&#160;orientation (com.sun.star.view.PaperOrientation).<br/>
PaperFormat&#160;<br/>
Predefined&#160;paper&#160;sizes (com.sun.star.view.PaperFormat).<br/>
PaperSize&#160;<br/>
Paper&#160;size&#160;in&#160;twips (com.sun.star.awt.Size).<br/>
IsBusy&#160;<br/>
Is&#160;the&#160;printer&#160;busy?<br/>
CanSetPaperOrientation&#160;<br/>
Can the&#160;paper&#160;orientation be&#160;set?<br/>
CanSetPaperFormat&#160;<br/>
Are&#160;other&#160;paper&#160;formats&#160;supported?<br/>
CanSetPaperSize&#160;<br/>
Can the&#160;paper&#160;size&#160;be&#160;set?<br/>
Call&#160;the&#160;print() method&#160;with no properties&#160;to&#160;print&#160;a&#160;single&#160;copy&#160;of the&#160;document&#160;to the&#160;current&#160;printer.&#160;All&#160;of<br/>the&#160;document&#160;types&#160;support&#160;the&#160;properties&#160;i<a href="libremacros.html#342">n&#160;Table&#160;115.&#160;</a>The&#160;Pages&#160;property&#160;supports&#160;the&#160;standard format&#160;<br/>used in&#160;the&#160;Print&#160;dialog.&#160;The&#160;format&#160;string&#160;“1, 3, 4-7, 9-”&#160;prints&#160;pages&#160;1, 3, 4 through 7, and 9 through the&#160;<br/>last&#160;page.<br/>
<i>Table&#160;115. Properties&#160;defined by&#160;com.sun.star.view.PrintOptions.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Collate&#160;<br/>
Collate&#160;the&#160;printed&#160;pages (set&#160;to&#160;True&#160;or&#160;False).<br/>
CopyCount&#160;<br/>
Number&#160;of&#160;copies to print.<br/>
DuplexMode<br/>
Use&#160;the&#160;com.sun.star.view.DuplexMode&#160;constants to&#160;set&#160;duplex&#160;mode.&#160;Supported&#160;<br/>
values include&#160;UNKNOWN&#160;(0),&#160;OFF&#160;(1),&#160;LONGEDGE (2), and&#160;SHORTEDGE&#160;<br/>(3).<br/>
FileName&#160;<br/>
Send the&#160;output&#160;to a&#160;file&#160;rather&#160;than to the&#160;printer.<br/>
Pages&#160;<br/>
Specifies pages and&#160;page&#160;ranges to print.<br/>
Wait<br/>
If&#160;TRUE,&#160;the&#160;print&#160;request&#160;is synchronous;&#160;wait&#160;for&#160;the&#160;job to&#160;finish before&#160;<br/>returning.<br/>
339<br/>
<hr/>
<a name=343></a><i><b>Listing&#160;318.</b>&#160;Print&#160;pages&#160;30 and 31 of&#160;the&#160;current&#160;document.<br/></i>Dim&#160;Props(1)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>Props(0).Name&#160;=&#160;&#34;Pages&#34;&#160;:&#160;Props(0).Value&#160;=&#160;&#34;30-31&#34;<br/>ThisComponent.print(Props())<br/>
When&#160;a&#160;document&#160;is&#160;printed, control&#160;returns&#160;to&#160;the&#160;caller before&#160;the&#160;printing is&#160;complete. If&#160;you close&#160;the&#160;<br/>document&#160;before&#160;printing is&#160;done, OpenOffice&#160;is&#160;likely&#160;to crash because&#160;the&#160;OO&#160;internals&#160;are&#160;still&#160;using the&#160;<br/>document.&#160;It’s&#160;possible&#160;to&#160;set&#160;up an event&#160;listener that&#160;watches&#160;for the&#160;print&#160;job&#160;to&#160;finish, but&#160;there’s&#160;an easier<br/>way&#160;that&#160;isn’t&#160;currently&#160;documented.&#160;The&#160;print() method accepts&#160;an array&#160;of properties&#160;that&#160;direct&#160;the&#160;<br/>printing.&#160;The&#160;“wait”&#160;argument&#160;with&#160;a&#160;Boolean value&#160;of&#160;True&#160;instructs&#160;the&#160;print() method&#160;to not&#160;return until&#160;<br/>after printing&#160;is&#160;complete.&#160;As&#160;of May&#160;17, 2011&#160;with OOo 3.3, the&#160;wait&#160;argument&#160;does&#160;not&#160;work;&#160;print&#160;listener<br/>is&#160;demonstrated&#160;in section<a href="libremacros.html#347">&#160;13.15.3&#160;A&#160;Calc&#160;example&#160;with&#160;a&#160;Print&#160;listener.</a><br/>
<b>TIP</b><br/>
Closing&#160;a&#160;document&#160;while&#160;OpenOffice.org&#160;is printing&#160;the&#160;document&#160;can cause&#160;OpenOffice.org&#160;<br/>
to crash. Use&#160;the&#160;“wait”&#160;property&#160;to&#160;avoid&#160;this problem.<br/>
On Unix-type&#160;computers, printers&#160;are&#160;configured to&#160;work with&#160;OpenOffice.org&#160;using&#160;the&#160;“spadmin”&#160;utility.&#160;<br/>After a&#160;printer has&#160;been configured for OOo, it&#160;is&#160;available&#160;for use&#160;by&#160;name.&#160;You can still&#160;use&#160;printers&#160;that&#160;<br/>have&#160;not&#160;been configured for OOo, but&#160;you must&#160;enclose&#160;the&#160;printer name&#160;between the&#160;characters&#160;“&lt;”&#160;and&#160;<br/>“&gt;”.&#160;To&#160;print&#160;with a&#160;printer other than&#160;the&#160;default, use&#160;code&#160;similar to&#160;the&#160;following:<br/>
Public&#160;oProps(0)&#160;as&#160;New&#160;com.sun.star.beans.PropertyValue<br/>Public&#160;oOpts(1)&#160;as&#160;New&#160;com.sun.star.beans.PropertyValue<br/>Dim&#160;oDoc&#160; &#160; &#160; &#160;&#160;'Document to print.<br/>Dim&#160;oPrinter&#160; &#160;&#160;'Array of properties that define the printer.<br/>Dim&#160;sUrl$&#160; &#160; &#160; &#160;'URL of the document to load and print.<br/>Dim&#160;sPrinter$&#160; &#160;'Name of the printer.<br/>
REM Set the name of the printer as known by the system.<br/>sPrinter&#160;=&#160;&#34;HP-Color-LaserJet-4650DN&#34;<br/>
REM Load the document in hidden mode so it is not visible<br/>REM on the screen.<br/>oProps(0).Name&#160;=&#160;&#34;Hidden&#34;<br/>oProps(0).Value&#160;=&#160;True<br/>
REM Now load the document.<br/>sUrl&#160;=&#160;&#34;file:///c:/test_doc.sxw&#34;<br/>oDoc&#160;=&#160;oDesk.LoadComponentFromUrl(sUrl,&#160;&#34;_blank&#34;,&#160;63,&#160;oProps())<br/>
REM Obtain the current printer object from the document.<br/>REM This is really an array of property values.<br/>REM Change the name of the object to reference the printer that<br/>REM you want to use. Notice that the printer name is the system name.<br/>oPrinter&#160;=&#160;oDoc.getPrinter()<br/>For&#160;i&#160;=&#160;LBound(oPrinter)&#160;to&#160;UBound(oPrinter)<br/>&#160;&#160;If&#160;oPrinter(i).Name&#160;=&#160;&#34;Name&#34;&#160;Then<br/>&#160; &#160;&#160;oPrinter(i).Value&#160;=&#160;sPrinter<br/>&#160;&#160;End&#160;If<br/>Next&#160;i<br/>
340<br/>
<hr/>
<a name=344></a>REM Set the printer back into the document. The only thing<br/>REM that has changed is the printer name.<br/>oDoc.setPrinter(oPrinter)<br/>
REM Now, set up the print options for actual printing.<br/>REM Notice that the printer name is surrounded by the characters &lt; and &gt;.<br/>REM Also notice that the print() method is set to not return until<br/>REM after printing is completed.<br/>oOpts(0).Name&#160;=&#160;&#34;Name&#34;<br/>oOpts(0).Value&#160;=&#160;&#34;&lt;&#34;&#160;&amp;&#160;sPrinter&#160;&amp;&#160;&#34;&gt;&#34;<br/>oOpts(1).Name&#160;=&#160;&#34;Wait&#34;<br/>oOpts(1).Value&#160;=&#160;True<br/>oDoc.Print(oOpts())<br/>
<b>TIP</b><br/>
Historically,&#160;it&#160;has been experimentally&#160;determined that&#160;you must&#160;set&#160;the&#160;destination printer&#160;in the&#160;<br/>
document&#160;before&#160;trying&#160;to&#160;print&#160;to a&#160;printer&#160;other&#160;than&#160;the&#160;default.<br/>
<b>&#160;13.15.1.&#160;Printing&#160;Writer&#160;documents<br/></b>Different&#160;document&#160;types&#160;support&#160;extra&#160;options&#160;for printing.&#160;Text&#160;documents&#160;support&#160;the&#160;interface&#160;<br/>com.sun.star.text.XPagePrintable&#160;(see<a href="libremacros.html#344">&#160;Table&#160;116)</a>.&#160;The&#160;XPagePrintable&#160;interface&#160;implements&#160;an alternate&#160;<br/>method&#160;of printing the&#160;document&#160;that&#160;provides&#160;more&#160;control&#160;of the&#160;output.&#160;The&#160;primary&#160;advantage&#160;is&#160;that&#160;you<br/>can print&#160;multiple&#160;pages&#160;from&#160;the&#160;document&#160;on a&#160;single&#160;output&#160;page.<br/>
<i>Table&#160;116. Methods&#160;defined by&#160;the&#160;com.sun.star.text.XPagePrintable&#160;interface.</i><br/>
<i><b>Object&#160;Methods</b></i><br/>
<i><b>Description</b></i><br/>
getPagePrintSettings()<br/>
Returns an&#160;array&#160;of&#160;properties (see<a href="libremacros.html#344">&#160;Table&#160;117)</a>.<br/>
setPagePrintSettings(properties)<br/>
Change&#160;the&#160;settings (see<a href="libremacros.html#344">&#160;Table&#160;117)</a>.<br/>
printPages(properties)<br/>
Print&#160;using&#160;properties&#160;in<a href="libremacros.html#342">&#160;Table&#160;115.</a><br/>
The&#160;object&#160;method&#160;printPages() accepts&#160;the&#160;same&#160;properties&#160;as&#160;the&#160;print() method&#160;(see<a href="libremacros.html#342">&#160;Table&#160;115)</a>.&#160;The&#160;<br/>methods&#160;to get&#160;and set&#160;the&#160;page&#160;print&#160;properties&#160;are&#160;outlined&#160;i<a href="libremacros.html#344">n&#160;Table&#160;117.&#160;</a>The&#160;macro i<a href="libremacros.html#345">n&#160;Listing&#160;319&#160;obt</a>ains&#160;<br/>and prints&#160;the&#160;current&#160;page&#160;print&#160;properties, shown in<a href="libremacros.html#345">&#160;Figure&#160;92.</a><br/>
<i>Table&#160;117. Properties&#160;used by&#160;the&#160;com.sun.star.text.XPagePrintable&#160;interface.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
PageRows<br/>
Number&#160;of&#160;rows&#160;of&#160;pages on each printed&#160;page.<br/>
PageColumns<br/>
Number&#160;of&#160;columns of&#160;pages on each&#160;printed&#160;page.<br/>
LeftMargin<br/>
Left&#160;margin.<br/>
RightMargin<br/>
Right&#160;margin.<br/>
TopMargin<br/>
Top&#160;margin.<br/>
BottomMargin<br/>
Bottom&#160;margin.<br/>
HoriMargin<br/>
Margin between&#160;rows of&#160;pages.<br/>
VertMargin<br/>
Margin between&#160;columns&#160;of&#160;pages.<br/>
IsLandscape<br/>
True&#160;or&#160;False;&#160;print&#160;in&#160;landscape&#160;format.<br/>
341<br/>
<hr/>
<a name=345></a><i><b>Listing&#160;319.</b>&#160;Display&#160;Page&#160;Print&#160;Properties.<br/></i>Sub&#160;DisplayPagePrintProperties<br/>&#160;&#160;Dim&#160;Props&#160;&#160;'Array of com.sun.star.beans.PropertyValue<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160;'Index variable of type Integer<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160;'Display string<br/>&#160;&#160;If&#160;HasUnoInterfaces(ThisComponent,&#160;&#34;com.sun.star.text.XPagePrintable&#34;)&#160;Then<br/>&#160; &#160;&#160;Props&#160;=&#160;ThisComponent.getPagePrintSettings()<br/>&#160; &#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;UBound(Props)<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;props(i).Name&#160;&amp;&#160;&#34; &#160;= &#160;&#34;&#160;&amp;&#160;CStr(props(i).Value)&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;Next<br/>&#160; &#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Page Print Properties&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;Sorry, this document does not support the XPagePrintable interface&#34;<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
<i><b>Figure&#160;92.</b>&#160;Page&#160;print&#160;properties&#160;of&#160;a Writer&#160;document.</i><br/>
The&#160;macro i<a href="libremacros.html#345">n&#160;Listing&#160;320&#160;a</a>ttempts&#160;to&#160;print&#160;a&#160;document&#160;with&#160;two pages&#160;on each printed&#160;page&#160;in&#160;landscape&#160;<br/>mode.&#160;With my&#160;latest&#160;testing in OOo version&#160;3.3, the&#160;document&#160;is&#160;printed normally,&#160;which is&#160;an&#160;<br/>improvement&#160;over the&#160;previous&#160;behavior of crashing OOo.<br/>
<i><b>Listing&#160;320.</b>&#160;Print&#160;Two&#160;Per&#160;Page.<br/></i>Sub&#160;PrintTwoPerPage<br/>&#160;&#160;Dim&#160;Props(0&#160;To&#160;1)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;Props(0).Name&#160;=&#160;&#34;PageColumns&#34;&#160;:&#160;Props(0).Value&#160;=&#160;2<br/>&#160;&#160;Props(1).Name&#160;=&#160;&#34;IsLandscape&#34;&#160;:&#160;Props(1).Value&#160;=&#160;True<br/>&#160;&#160;If&#160;HasUnoInterfaces(ThisComponent,&#160;&#34;com.sun.star.text.XPagePrintable&#34;)&#160;Then<br/>&#160; &#160;&#160;ThisComponent.setPagePrintSettings(Props())&#160;&#160;'<br/>&#160; &#160;&#160;ThisComponent.printPages(Array())&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Use default properties<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;Sorry, this document does not support the XPagePrintable interface&#34;<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
Although the&#160;macro in<a href="libremacros.html#345">&#160;Listing 320&#160;s</a>topped working&#160;with&#160;OOo 1.1.1, a&#160;small&#160;modification allows&#160;the&#160;macro&#160;<br/>to run.&#160;The&#160;new&#160;macro still&#160;causes&#160;OOo to crash under Linux&#160;and to&#160;close&#160;the&#160;document&#160;under&#160;Windows, but<br/>it&#160;does&#160;manage&#160;to&#160;print&#160;the&#160;document.&#160;As&#160;with<a href="libremacros.html#345">&#160;Listing 320, t</a>he&#160;document&#160;is&#160;printed in&#160;portrait&#160;mode&#160;rather&#160;<br/>than landscape&#160;mode&#160;— this&#160;is&#160;an OOo bug.<br/>
342<br/>
<hr/>
<a name=346></a><b>&#160;13.15.2.&#160;Printing&#160;Calc&#160;documents<br/></b>To&#160;perform&#160;special&#160;printing functions&#160;with a&#160;Writer document,&#160;a&#160;special&#160;object&#160;method&#160;is&#160;called.&#160;To&#160;perform&#160;<br/>special&#160;printing&#160;functions&#160;with Calc&#160;documents,&#160;you&#160;must&#160;modify&#160;the&#160;document&#160;properties&#160;and page-style&#160;<br/>properties&#160;and then&#160;use&#160;the&#160;standard print() method. For example,&#160;it&#160;is&#160;common for &#160;a&#160;Calc&#160;sheet&#160;to&#160;be&#160;too&#160;<br/>large&#160;to&#160;fit&#160;on a&#160;single&#160;sheet&#160;of paper.&#160;To&#160;scale&#160;the&#160;sheet&#160;to fit&#160;on a&#160;specified number of pages, set&#160;the&#160;<br/>ScaleToPages&#160;property&#160;to&#160;contain the&#160;number of pages&#160;that&#160;should&#160;contain&#160;the&#160;sheet.&#160;To&#160;simply&#160;scale&#160;the&#160;<br/>page&#160;based on a&#160;percentage, use&#160;the&#160;PageScale&#160;property&#160;(see<a href="libremacros.html#346">&#160;Listing&#160;321).</a><br/>
<i><b>Listing&#160;321.</b>&#160;Print&#160;a spreadsheet&#160;at&#160;25 percent; this&#160;is&#160;very&#160;small!<br/></i>Sub&#160;PrintScaledSpreadsheet<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160;'Style name<br/>&#160;&#160;Dim&#160;oStyle&#160;'The current page style<br/>
&#160;&#160;REM Use the currently active sheet to obtain the page style.<br/>&#160;&#160;REM In a Calc document, the current controller knows which sheet<br/>&#160;&#160;REM is active.&#160;<br/>&#160;&#160;s&#160;=&#160;ThisComponent.CurrentController.getActiveSheet().PageStyle<br/>&#160;&#160;oStyle&#160;=&#160;ThisComponent.StyleFamilies.getByName(&#34;PageStyles&#34;).getByName(s)<br/>&#160;&#160;REM oStyle.PageScale = 100 &#160; Default value is 100 (as in 100%)<br/>&#160;&#160;REM oStyle.ScaleToPages = 0 &#160;Default value is 0, as in don't scale<br/>&#160;&#160;oStyle.PageScale&#160;=&#160;25&#160; &#160; &#160; &#160; &#160;'Scale document to 25% (very very very small)<br/>&#160;&#160;ThisComponent.Print(Array())&#160;&#160;'Print the document<br/>End&#160;Sub<br/>
The&#160;second aspect&#160;to&#160;printing Calc&#160;documents&#160;involves&#160;setting the&#160;area&#160;to&#160;print&#160;along with&#160;the&#160;column&#160;and&#160;<br/>row&#160;titles&#160;(see<a href="libremacros.html#346">&#160;Table&#160;118)</a>.<br/>
<i>Table&#160;118. Properties&#160;used by&#160;the&#160;com.sun.star.sheet.XPrintAreas&#160;interface.</i><br/>
<i><b>Object&#160;Method</b></i><br/>
<i><b>Description</b></i><br/>
getPrintAreas()<br/>
Return array&#160;of&#160;type&#160;com.sun.star.table.CellRangeAddress.<br/>
setPrintAreas(ranges)<br/>
Set&#160;print&#160;areas&#160;for&#160;the&#160;sheet&#160;with array&#160;of&#160;type&#160;CellRangeAddress. Print&#160;everything&#160;if&#160;<br/>
nothing&#160;is set.<br/>
getPrintTitleColumns()<br/>
Return&#160;True&#160;if&#160;title&#160;columns&#160;are&#160;repeated&#160;to the&#160;right.<br/>
setPrintTitleColumns(boolean)<br/>
Set&#160;True&#160;if&#160;title&#160;columns&#160;are&#160;repeated&#160;on all&#160;print&#160;pages to the&#160;right.<br/>
getTitleColumns()<br/>
Array&#160;of&#160;type&#160;com.sun.star.table.CellRangeAddress.<br/>
setTitleColumns(ranges)<br/>
Set&#160;columns&#160;to use&#160;as titles.&#160;Rows&#160;are&#160;ignored;&#160;only&#160;columns matter.<br/>
getPrintTitleRows()<br/>
Return&#160;True&#160;if&#160;title&#160;rows&#160;are&#160;repeated&#160;on all&#160;print&#160;pages.<br/>
setPrintTitleRows(boolean)<br/>
Set&#160;to&#160;True&#160;if&#160;row&#160;titles are&#160;repeated on all&#160;print&#160;pages&#160;to the&#160;bottom.<br/>
getTitleRows()<br/>
Return array&#160;of&#160;type&#160;com.sun.star.table.CellRangeAddress.<br/>
setTitleRows(ranges)<br/>
Set&#160;rows to use&#160;as titles.&#160;Columns&#160;are&#160;ignored;&#160;only&#160;rows&#160;matter.<br/>
The&#160;methods&#160;i<a href="libremacros.html#346">n&#160;Table&#160;118&#160;a</a>re&#160;based on sheets&#160;in a&#160;Calc&#160;document;&#160;as&#160;opposed to&#160;the&#160;entire&#160;Calc&#160;document.&#160;<br/>The&#160;macro i<a href="libremacros.html#346">n&#160;Listing&#160;322&#160;s</a>ets&#160;two print&#160;ranges&#160;and then prints&#160;the&#160;document.&#160;Each print&#160;range&#160;is&#160;printed on a<br/>new&#160;page.<br/>
<i><b>Listing&#160;322.</b>&#160;Set&#160;and print&#160;multiple&#160;ranges&#160;in&#160;a Calc&#160;document.</i><br/>
Sub&#160;PrintSpreadsheetAreas<br/>&#160;&#160;Dim&#160;oRanges(1)&#160;As&#160;New&#160;com.sun.star.table.CellRangeAddress<br/>
343<br/>
<hr/>
<a name=347></a>&#160;&#160;oRanges(0).Sheet&#160;=&#160;0&#160;<br/>&#160;&#160;oRanges(0).StartColumn&#160;=&#160;0&#160;:&#160;oRanges(0).StartRow&#160;=&#160;0&#160;'A1<br/>&#160;&#160;oRanges(0).EndColumn&#160;=&#160;3&#160; &#160;:&#160;oRanges(0).EndRow&#160;=&#160;4&#160; &#160;'D5<br/>&#160;&#160;<br/>&#160;&#160;oRanges(1).Sheet&#160;=&#160;0&#160;<br/>&#160;&#160;oRanges(1).StartColumn&#160;=&#160;0&#160;:&#160;oRanges(1).StartRow&#160;=&#160;8&#160;'A9<br/>&#160;&#160;oRanges(1).EndColumn&#160;=&#160;3&#160; &#160;:&#160;oRanges(1).EndRow&#160;=&#160;10&#160;&#160;'D11<br/>&#160;&#160;<br/>&#160;&#160;ThisComponent.CurrentController.getActiveSheet().setPrintAreas(oRanges())<br/>&#160;&#160;ThisComponent.Print(Array())<br/>End&#160;Sub<br/>
<b>&#160;13.15.3.&#160;A&#160;Calc&#160;example&#160;with&#160;a&#160;Print&#160;listener<br/></b>Sheet1 in&#160;a&#160;Calc&#160;document&#160;contains&#160;a&#160;button&#160;that&#160;prints&#160;Sheet2&#160;and leaves&#160;Sheet1&#160;as&#160;the&#160;active&#160;sheet.&#160;To&#160;<br/>print&#160;Sheet2,&#160;it&#160;must&#160;be&#160;made&#160;the&#160;active&#160;sheet.&#160;The&#160;code&#160;was&#160;structured as&#160;follows:<br/>
1.&#160;Set&#160;Sheet2&#160;active.<br/>
2.&#160;Call&#160;the&#160;document&#160;level&#160;print&#160;method.<br/>
3.&#160;Set&#160;Sheet1&#160;active.<br/>
The&#160;print&#160;method&#160;returns&#160;immediately&#160;and the&#160;document&#160;is&#160;printed in&#160;the&#160;background. Sheet1,&#160;therefore,&#160;<br/>becomes&#160;the&#160;active&#160;sheet&#160;before&#160;printing begins, so Sheet1&#160;is&#160;printed&#160;rather than&#160;Sheet2.&#160;The&#160;correct&#160;solution<br/>is&#160;to&#160;register a&#160;print&#160;listener that&#160;sets&#160;Sheet1 active&#160;after printing&#160;is&#160;complete.&#160;<br/>
A&#160;listener is&#160;stored in&#160;a&#160;Global&#160;variable&#160;so that&#160;is&#160;lives&#160;after the&#160;macro is&#160;finished running. Be&#160;warned,&#160;<br/>however,&#160;that&#160;if you&#160;edit&#160;any&#160;macro the&#160;global&#160;variable&#160;will&#160;be&#160;erased but&#160;the&#160;listener will&#160;still&#160;be&#160;registered;&#160;<br/>and you&#160;will&#160;have&#160;no way&#160;to&#160;unregister it&#160;without&#160;closing the&#160;document.&#160;So, first, create&#160;the&#160;variables&#160;to&#160;<br/>reference&#160;the&#160;listener.&#160;The&#160;document&#160;is&#160;also&#160;stored, but&#160;I&#160;could&#160;have&#160;referenced&#160;ThisComponent&#160;instead.<br/>
<i><b>Listing&#160;323.</b>&#160;Global&#160;variables&#160;that&#160;reference&#160;the&#160;listener&#160;and the&#160;document.<br/></i>Global&#160;oPrintListener<br/>Global&#160;oPrintJobListnerDoc<br/>
The&#160;current&#160;active&#160;sheet&#160;is&#160;set&#160;as&#160;part&#160;of the&#160;real&#160;world macro, so it&#160;is&#160;also shown here.<br/>
<i><b>Listing&#160;324.</b>&#160;Utility&#160;routine&#160;to&#160;set&#160;a Calc&#160;document's&#160;active&#160;sheet.</i><br/>
REM *******************************<br/>REM ** oDoc - Calc sheet on which to operate. No error checking is performed<br/>REM ** sSheetName - Sheet name to make active. The sheet is verified to exist.<br/>REM *******************************<br/>Sub&#160;set_active_sheet(oDoc,&#160;sSheetName)<br/>&#160;&#160;Dim&#160;oSheets<br/>&#160;&#160;oSheets&#160;=&#160;oDoc.Sheets<br/>&#160;&#160;If&#160;oSheets.hasByName(sSheetName)&#160;Then<br/>&#160; &#160;&#160;oDoc.currentController.setActiveSheet(oSheets.getByName(sSheetName))<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
An event&#160;is&#160;sent&#160;to&#160;the&#160;listener if the&#160;listener is&#160;being disposed.&#160;The&#160;text&#160;“print_listener_”&#160;prefixes&#160;the&#160;<br/>routines&#160;used to implement&#160;the&#160;listener.&#160;<br/>
344<br/>
<hr/>
<a name=348></a><i><b>Listing&#160;325.</b>&#160;Print&#160;listener&#160;disposing&#160;method.<br/></i>REM *******************************<br/>REM ** The print job is disposing, so, remove it.<br/>REM *******************************<br/>Sub&#160;print_listener_disposing(oEvent)<br/>&#160;&#160;On&#160;Error&#160;Resume&#160;Next<br/>&#160;&#160;Dim&#160;emptyObj<br/>&#160;&#160;If&#160;NOT&#160;IsNull(oPrintJobListnerDoc)&#160;AND&#160;NOT&#160;IsEMpty(oPrintJobListnerDoc)&#160;Then<br/>&#160; &#160;&#160;oPrintJobListnerDoc.removePrintJobListener(oPrintListener)<br/>&#160; &#160;&#160;oPrintJobListnerDoc&#160;=&#160;emptyObj<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
The&#160;listener is&#160;called&#160;every&#160;time&#160;the&#160;print&#160;job&#160;changes&#160;state.<br/>
<i><b>Listing&#160;326.</b>&#160;Print&#160;listener&#160;status&#160;changed event.<br/></i>REM *******************************<br/>REM ** Called everytime the state of the print job changes.<br/>REM ** Error messages are printed if they occur.&#160;<br/>REM ** If the event announces an error or that the job is finished,<br/>REM ** the print job listener is removed and the &#34;Input Data&#34; sheet is set to active.<br/>REM *******************************<br/>Sub&#160;print_listener_printJobEvent(oPrintJobEvent)<br/>&#160;&#160;Dim&#160;bCleanup&#160;As&#160;Boolean&#160;' Set to true if the listener should be removed.<br/>&#160;&#160;Dim&#160;sMessage$&#160; &#160; &#160; &#160; &#160; &#160;' If not empty, a message is printed.<br/>
&#160;&#160;REM All supported event state changes are shown.<br/>&#160;&#160;Select&#160;Case&#160;oPrintJobEvent.State<br/>&#160; &#160;&#160;Case&#160;com.sun.star.view.PrintableState.JOB_STARTED<br/>&#160; &#160; &#160;&#160;' Rendering the document to print.<br/>&#160; &#160; &#160;&#160;bCleanup&#160;=&#160;False<br/>&#160; &#160;&#160;Case&#160;com.sun.star.view.PrintableState.JOB_COMPLETED<br/>&#160; &#160; &#160;&#160;' Rendering is finished, start spooling.<br/>&#160; &#160; &#160;&#160;bCleanup&#160;=&#160;False<br/>&#160; &#160;&#160;Case&#160;com.sun.star.view.PrintableState.JOB_SPOOLED<br/>&#160; &#160; &#160;&#160;' Success!<br/>&#160; &#160; &#160;&#160;'sMessage = &#34;Print job spooled to the printer.&#34;<br/>&#160; &#160; &#160;&#160;bCleanup&#160;=&#160;True<br/>&#160; &#160;&#160;Case&#160;com.sun.star.view.PrintableState.JOB_ABORTED<br/>&#160; &#160; &#160;&#160;sMessage&#160;=&#160;&#34;Printing was aborted.&#34;<br/>&#160; &#160; &#160;&#160;bCleanup&#160;=&#160;True<br/>&#160; &#160;&#160;Case&#160;com.sun.star.view.PrintableState.JOB_FAILED<br/>&#160; &#160; &#160;&#160;sMessage&#160;=&#160;&#34;Error printing.&#34;<br/>&#160; &#160; &#160;&#160;bCleanup&#160;=&#160;True<br/>&#160; &#160;&#160;Case&#160;com.sun.star.view.PrintableState.JOB_SPOOLING_FAILED<br/>&#160; &#160; &#160;&#160;sMessage&#160;=&#160;&#34;Document failed to print or spool to the print.&#34;<br/>&#160; &#160; &#160;&#160;bCleanup&#160;=&#160;True<br/>&#160; &#160;&#160;Case&#160;Else<br/>&#160; &#160; &#160;&#160;sMessage&#160;=&#160;&#34;Unknown unexpected print state.&#34;<br/>&#160; &#160; &#160;&#160;bCleanup&#160;=&#160;True<br/>&#160;&#160;End&#160;Select<br/>
&#160;&#160;REM Remove the listener if printing is finished, then call a worker macro<br/>&#160;&#160;REM to set Sheet1 as active.<br/>
345<br/>
<hr/>
<a name=349></a>&#160;&#160;If&#160;bCleanup&#160;AND&#160;NOT&#160;IsNull(oPrintJobListnerDoc)&#160;AND&#160;NOT&#160;IsEMpty(oPrintJobListnerDoc)&#160;Then<br/>&#160; &#160;&#160;On&#160;Error&#160;Resume&#160;Next<br/>&#160; &#160;&#160;Dim&#160;emptyObj<br/>&#160; &#160;&#160;oPrintJobListnerDoc.removePrintJobListener(oPrintListener)<br/>&#160; &#160;&#160;Call&#160;set_active_sheet(oPrintJobListnerDoc,&#160;&#34;Sheet1&#34;)<br/>&#160; &#160;&#160;oPrintJobListnerDoc&#160;=&#160;emptyObj<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;sMessage&#160;&lt;&gt;&#160;&#34;&#34;&#160;Then<br/>&#160; &#160;&#160;MsgBox&#160;sMessage<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
If&#160;the&#160;sheet&#160;name&#160;exists, the&#160;desired sheet&#160;is&#160;set&#160;to be&#160;active,&#160;the&#160;print&#160;job listener is&#160;created and registered,&#160;<br/>and then document&#160;printing is&#160;requested.<br/>
<i><b>Listing&#160;327.</b>&#160;Print&#160;the&#160;specified sheet.<br/></i>Sub&#160;PrintSheet(oDoc,&#160;sSheetToPrint)<br/>&#160;&#160;Dim&#160;sPrefix$&#160;&#160;' Prefix used to identify the print listener routines.<br/>&#160;&#160;Dim&#160;sService$&#160;' Print listener service name.<br/>
&#160;&#160;sPrefix&#160;=&#160;&#34;print_listener_&#34;<br/>&#160;&#160;sService&#160;=&#160;&#34;com.sun.star.view.XPrintJobListener&#34;<br/>
&#160;&#160;If&#160;NOT&#160;oDoc.sheets().hasByName(sSheetToPrint)&#160;Then<br/>&#160; &#160;&#160;MsgBox&#160;&#34;Document does not contain a sheet named &#34;&#160;&amp;&#160;sSheetToPrint<br/>&#160; &#160;&#160;Exit&#160;sub<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;Call&#160;set_active_sheet(oDoc,&#160;sSheetToPrint)<br/>&#160;&#160;<br/>&#160;&#160;oPrintListener&#160;=&#160;CreateUnoListener(sPrefix,&#160;sService)&#160;&#160;<br/>&#160;&#160;oDoc.addPrintJobListener(oPrintListener)<br/>&#160;&#160;oPrintJobListnerDoc&#160;=&#160;oDoc<br/>&#160;&#160;oDoc.Print(Array())<br/>End&#160;Sub&#160;<br/>
<b>&#160;13.15.4.&#160;Print&#160;examples&#160;by&#160;Vincent&#160;Van&#160;Houtte<br/></b>I&#160;found some&#160;very&#160;nice&#160;examples&#160;by&#160;Vincent&#160;Van Houtte, that&#160;he&#160;has&#160;graciously&#160;allowed me&#160;to reproduce&#160;<br/>here. Some&#160;highlights&#160;of the&#160;contained macros:<br/>
•<br/>
printDoc&#160;– Print&#160;a&#160;document&#160;with&#160;specific&#160;paper size, with&#160;specific&#160;paper trays,&#160;and with&#160;(or without)<br/>a&#160;page&#160;background image. Numerous&#160;stub methods&#160;are&#160;included to&#160;call&#160;this&#160;one&#160;routine.&#160;Note&#160;that&#160;the<br/>method&#160;directly&#160;specifies&#160;the&#160;destination printer.&#160;<br/>
•<br/>
printPage&#160;– Same&#160;as&#160;printDoc, but&#160;prints&#160;a&#160;single&#160;page.<br/>
•<br/>
closeDocument&#160;– Close&#160;the&#160;specified document.<br/>
•<br/>
ExportAsPdfAndSendEmail&#160;– Export&#160;as&#160;a&#160;PDF&#160;document&#160;and send an email.<br/>
<b>TIP</b><br/>
The&#160;very&#160;popular&#160;routine&#160;FindCreateNumberFormatStyle&#160;(see<a href="libremacros.html#440">&#160;Listing&#160;391)</a>&#160;is used by<a href="libremacros.html#350">&#160;Listing&#160;328.</a><br/>
346<br/>
<hr/>
<a name=350></a><i><b>Listing&#160;328.</b>&#160;Print&#160;examples&#160;by&#160;Vincent&#160;Van Houtte.<br/></i>Sub&#160;PrintWithCopyStamp()<br/>' ------------------------------<br/>' This macro inserts a 'COPY'-stamp and prints the document<br/>' without the background(-image) to tray1.<br/>'<br/>' Written by Vincent Van Houtte (2010)<br/>' ------------------------------<br/>&#160; &#160;REM Insert timestamp of sending<br/>&#160; &#160;Dim&#160;sActionText&#160;AS&#160;String<br/>&#160; &#160;sActionText&#160;=&#160;&#34;KOPIE&#34;<br/>&#160; &#160;InsertDTstamp(sActionText)<br/>
&#160; &#160;REM Print the page<br/>&#160; &#160;PrintDocWithoutBgToTray1()<br/>&#160; &#160;<br/>&#160; &#160;REM Remove the copystamp-frame<br/>&#160; &#160;RemoveDTstamp()<br/>End&#160;Sub<br/>
Sub&#160;InsertDTstamp(sActionText)<br/>' ------------------------------<br/>' This macro inserts a 'DATE/TIME'-stamp with sActionText 'Printed' or 'Sent'<br/>'<br/>' Written by Vincent Van Houtte (2011)<br/>' ------------------------------<br/>&#160; &#160;DIM&#160;oCursor,&#160;oText,&#160;oDoc&#160;AS&#160;Object<br/>&#160; &#160;oDoc&#160;=&#160;ThisComponent<br/>&#160; &#160;oText&#160;=&#160;oDoc.getText()<br/>&#160; &#160;oCursor&#160;=&#160;oText.createTextCursor()<br/>&#160; &#160;oCursor.goToStart(FALSE)<br/>
&#160; &#160;REM Create the date and time objects<br/>&#160; &#160;DIM&#160;oDate,&#160;oTime&#160;AS&#160;Object<br/>&#160; &#160;oDate&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.TextField.DateTime&#34;)<br/>&#160; &#160;oDate.IsFixed&#160;=&#160;TRUE<br/>&#160; &#160;oDate.IsDate&#160;=&#160;TRUE<br/>&#160; &#160;oDate.NumberFormat&#160;=&#160;FindCreateNumberFormatStyle(&#34;D MMMM JJJJ&#34;,&#160;oDoc)<br/>&#160; &#160;<br/>&#160; &#160;oTime&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.TextField.DateTime&#34;)<br/>&#160; &#160;oTime.IsFixed&#160;=&#160;True<br/>&#160; &#160;oTime.IsDate&#160;=&#160;False<br/>&#160; &#160;oTime.NumberFormat&#160;=&#160;FindCreateNumberFormatStyle(&#34;UU:MM&#34;,&#160;oDoc)<br/>
&#160; &#160;REM Create the frame<br/>&#160; &#160;DIM&#160;oFrameDT&#160;AS&#160;Object<br/>&#160; &#160;oFrameDT&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.TextFrame&#34;)<br/>&#160; &#160;With&#160;oFrameDT<br/>&#160; &#160;.setName(&#34;FrameDT&#34;)<br/>&#160; &#160;.AnchorType&#160;=&#160;com.sun.star.text.TextContentAnchorType.AT_PAGE<br/>&#160; &#160;.HoriOrient&#160;=&#160;com.sun.star.text.HoriOrientation.NONE<br/>
347<br/>
<hr/>
<a name=351></a>&#160; &#160;.VertOrient&#160;=&#160;com.sun.star.text.VertOrientation.NONE<br/>&#160; &#160;.HoriOrientPosition&#160;=&#160;-4900<br/>&#160; &#160;.VertOrientPosition&#160;=&#160;-1600<br/>&#160; &#160;.width&#160;=&#160;4000<br/>&#160; &#160;.height&#160;=&#160;1500<br/>&#160; &#160;.BorderDistance&#160;=&#160;100<br/>&#160; &#160;End&#160;With<br/>
&#160; &#160;REM Insert the frame into the text document<br/>&#160; &#160;oText.insertTextContent(&#160;oCursor,&#160;oFrameDT,&#160;True&#160;)<br/>
&#160; &#160;REM Write the text inside the frame<br/>&#160; &#160;DIM&#160;oCursor2&#160;AS&#160;Object<br/>&#160; &#160;oCursor2&#160;=&#160;oFrameDT.createTextCursor()<br/>&#160; &#160;With&#160;oCursor2<br/>&#160; &#160;.charHeight&#160;=&#160;16<br/>&#160; &#160;.charWeight&#160;=&#160;com.sun.star.awt.FontWeight.BOLD<br/>&#160; &#160;.paraAdjust&#160;=&#160;com.sun.star.style.ParagraphAdjust.CENTER<br/>&#160; &#160;End&#160;With<br/>
&#160; &#160;oFrameDT.insertString(&#160;oCursor2,&#160;sActionText,&#160;False&#160;)<br/>
&#160; &#160;With&#160;oCursor2<br/>&#160; &#160;.charHeight&#160;=&#160;9<br/>&#160; &#160;.charWeight&#160;=&#160;com.sun.star.awt.FontWeight.NORMAL<br/>&#160; &#160;.paraAdjust&#160;=&#160;com.sun.star.style.ParagraphAdjust.CENTER<br/>&#160; &#160;End&#160;With<br/>
&#160; &#160;oFrameDT.insertControlCharacter(&#160;oCursor2,&#160;<br/>com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK,&#160;False&#160;)<br/>&#160; &#160;oFrameDT.insertTextContent(&#160;oCursor2,&#160;oDate,&#160;False&#160;)<br/>
&#160; &#160;oFrameDT.insertControlCharacter(&#160;oCursor2,&#160;com.sun.star.text.ControlCharacter.LINE_BREAK,&#160;<br/>False&#160;)<br/>&#160; &#160;oFrameDT.insertTextContent(&#160;oCursor2,&#160;oTime,&#160;False&#160;)<br/>End&#160;Sub<br/>
Sub&#160;RemoveDTstamp()<br/>' ------------------------------<br/>' This macro removes the 'DATE/TIME'-stamp created with the previous macro<br/>'<br/>' Written by Vincent Van Houtte (2011)<br/>' ------------------------------<br/>&#160; &#160;DIM&#160;oDoc,&#160;oTextFrames,&#160;oFrameDT&#160;AS&#160;Object<br/>&#160; &#160;oDoc&#160;=&#160;ThisComponent<br/>
&#160; &#160;REM Look for the datetimestamp-frame and remove it<br/>&#160; &#160;oTextFrames&#160;=&#160;oDoc.getTextFrames<br/>&#160; &#160;If&#160;oTextFrames.hasByName(&#34;FrameDT&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;oFrameDT&#160;=&#160;oTextFrames.getByName(&#34;FrameDT&#34;)<br/>&#160; &#160; &#160;&#160;oFrameDT.dispose()<br/>&#160; &#160;EndIf<br/>
348<br/>
<hr/>
<a name=352></a>End&#160;Sub<br/>
Sub&#160;PrintDocWithBgToTray1<br/>' ------------------------------<br/>' This macro prints the document with the background(-image) to the<br/>' first papertray. This is only used to save on stationary, if you<br/>' have run out on stationary or if the second printertray is jammed ;)<br/>'<br/>' Written by Vincent Van Houtte (2010)<br/>' ------------------------------<br/>&#160; &#160;DIM&#160;sTray1&#160;AS&#160;String<br/>&#160; &#160;DIM&#160;sTray2&#160;AS&#160;String<br/>&#160; &#160;DIM&#160;bBg1&#160;AS&#160;Boolean<br/>&#160; &#160;DIM&#160;bBg2&#160;AS&#160;Boolean<br/>&#160; &#160;DIM&#160;wait&#160;AS&#160;Boolean<br/>&#160; &#160;sTray1&#160;=&#160;&#34;Tray1&#34;<br/>&#160; &#160;sTray2&#160;=&#160;&#34;Tray1&#34;<br/>&#160; &#160;bBg1&#160;=&#160;True<br/>&#160; &#160;bBg2&#160;=&#160;False<br/>&#160; &#160;wait&#160;=&#160;True<br/>&#160; &#160;printDoc(sTray1,&#160;sTray2,&#160;bBg1,&#160;bBg2,&#160;wait)<br/>End&#160;Sub<br/>
Sub&#160;PrintDocWithoutBgToTray1<br/>' ------------------------------<br/>' This macro prints the document without the background(-image) to the<br/>' first papertray. This is useful for copies of the letters you sent out.<br/>'<br/>' Written by Vincent Van Houtte (2010)<br/>' ------------------------------<br/>&#160; &#160;DIM&#160;sTray1&#160;AS&#160;String<br/>&#160; &#160;DIM&#160;sTray2&#160;AS&#160;String<br/>&#160; &#160;DIM&#160;bBg1&#160;AS&#160;Boolean<br/>&#160; &#160;DIM&#160;bBg2&#160;AS&#160;Boolean<br/>&#160; &#160;DIM&#160;wait&#160;AS&#160;Boolean<br/>&#160; &#160;sTray1&#160;=&#160;&#34;Tray1&#34;<br/>&#160; &#160;sTray2&#160;=&#160;&#34;Tray1&#34;<br/>&#160; &#160;bBg1&#160;=&#160;False<br/>&#160; &#160;bBg2&#160;=&#160;False<br/>&#160; &#160;wait&#160;=&#160;True<br/>&#160; &#160;printDoc(sTray1,&#160;sTray2,&#160;bBg1,&#160;bBg2,&#160;wait)<br/>End&#160;Sub<br/>
Sub&#160;PrintDocWithoutBgToTray2_old<br/>' ------------------------------<br/>' This macro prints the document without the background(-image) to the<br/>' second papertray. This is useful when you have pre-printed stationary:<br/>' you can set an image as a background, that you don't want to print,<br/>' but that you want to show up when converted to PDF.<br/>'<br/>' Written by Vincent Van Houtte (2010)<br/>' ------------------------------<br/>&#160; &#160;DIM&#160;sTray1&#160;AS&#160;String<br/>
349<br/>
<hr/>
<a name=353></a>&#160; &#160;DIM&#160;sTray2&#160;AS&#160;String<br/>&#160; &#160;DIM&#160;bBg1&#160;AS&#160;Boolean<br/>&#160; &#160;DIM&#160;bBg2&#160;AS&#160;Boolean<br/>&#160; &#160;DIM&#160;wait&#160;AS&#160;Boolean<br/>&#160; &#160;sTray1&#160;=&#160;&#34;Tray2&#34;<br/>&#160; &#160;sTray2&#160;=&#160;&#34;Tray1&#34;<br/>&#160; &#160;bBg1&#160;=&#160;False<br/>&#160; &#160;bBg2&#160;=&#160;False<br/>&#160; &#160;wait&#160;=&#160;True<br/>&#160; &#160;printDoc(sTray1,&#160;sTray2,&#160;bBg1,&#160;bBg2,&#160;wait)<br/>End&#160;Sub<br/>
Sub&#160;PrintDocWithoutBgToTray2<br/>' ------------------------------<br/>' This macro prints the first page (without the backgroundimage) to the<br/>' second papertray and all other pages (without the backgroundimage) to the<br/>' first papertray.<br/>' This is useful when you have pre-printed stationary, but want to save on it<br/>' by only printing the first page on expensive stationary<br/>' you can set an image as a background, that you don't want to print,<br/>' but that you want to show up when converted to PDF.<br/>'<br/>' Written by Vincent Van Houtte (2011)<br/>' ------------------------------<br/>
&#160; &#160;DIM&#160;oDoc&#160;AS&#160;Object<br/>&#160; &#160;DIM&#160;iPageCount,&#160;n&#160;AS&#160;Integer<br/>&#160; &#160;DIM&#160;sPage&#160;AS&#160;String<br/>&#160; &#160;oDoc&#160;=&#160;ThisComponent<br/>
&#160; &#160;REM Count the amount of pages<br/>&#160; &#160;iPageCount&#160;=&#160;oDoc.getCurrentController().getPropertyValue(&#34;PageCount&#34;)<br/>
&#160; &#160;REM Loop over every page<br/>&#160; &#160;n&#160;=&#160;1<br/>&#160; &#160;Do&#160;Until&#160;n&#160;&gt;&#160;iPageCount<br/>&#160; &#160;<br/>&#160; &#160;REM Print every page to the right tray<br/>&#160; &#160; &#160;&#160;If&#160;n&#160;=&#160;1&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;Print_stat(n)<br/>&#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160; &#160;Print_plain(n)<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160;&#160;n&#160;=&#160;n&#160;+&#160;1<br/>&#160; &#160;Loop<br/>
End&#160;Sub<br/>
Sub&#160;Print_stat(sPageNr&#160;AS&#160;String)<br/>' ------------------------------<br/>' This macro prints the first page without the background(-image) to the<br/>' second papertray. This is useful when you have pre-printed stationary:<br/>' you can set an image as a background, that you don't want to print,<br/>
350<br/>
<hr/>
<a name=354></a>' but that you want to show up when converted to PDF.<br/>'<br/>' Written by Vincent Van Houtte (2011)<br/>' ------------------------------<br/>&#160; &#160;DIM&#160;sTray1&#160;AS&#160;String<br/>&#160; &#160;DIM&#160;sTray2&#160;AS&#160;String<br/>&#160; &#160;DIM&#160;bBg1&#160;AS&#160;Boolean<br/>&#160; &#160;DIM&#160;bBg2&#160;AS&#160;Boolean<br/>&#160; &#160;DIM&#160;wait&#160;AS&#160;Boolean<br/>&#160; &#160;sTray1&#160;=&#160;&#34;Tray2&#34;<br/>&#160; &#160;sTray2&#160;=&#160;&#34;Tray1&#34;<br/>&#160; &#160;bBg1&#160;=&#160;False<br/>&#160; &#160;bBg2&#160;=&#160;False<br/>&#160; &#160;wait&#160;=&#160;True<br/>&#160; &#160;printPage(sTray1,&#160;sTray2,&#160;bBg1,&#160;bBg2,&#160;wait,&#160;sPageNr)<br/>End&#160;Sub<br/>
Sub&#160;Print_plain(sPageNr&#160;AS&#160;String)<br/>' ------------------------------<br/>' This macro prints the next page without the background(-image) to the<br/>' first papertray. This is useful when you want to saveon your pre-printed stationary:<br/>' you can set an image as a background, that you don't want to print,<br/>' but that you want to show up when converted to PDF.<br/>'<br/>' Written by Vincent Van Houtte (2011)<br/>' ------------------------------<br/>&#160; &#160;DIM&#160;sTray1&#160;AS&#160;String<br/>&#160; &#160;DIM&#160;sTray2&#160;AS&#160;String<br/>&#160; &#160;DIM&#160;bBg1&#160;AS&#160;Boolean<br/>&#160; &#160;DIM&#160;bBg2&#160;AS&#160;Boolean<br/>&#160; &#160;DIM&#160;wait&#160;AS&#160;Boolean<br/>&#160; &#160;sTray1&#160;=&#160;&#34;Tray1&#34;<br/>&#160; &#160;sTray2&#160;=&#160;&#34;Tray1&#34;<br/>&#160; &#160;bBg1&#160;=&#160;False<br/>&#160; &#160;bBg2&#160;=&#160;False<br/>&#160; &#160;wait&#160;=&#160;True<br/>&#160; &#160;printPage(sTray1,&#160;sTray2,&#160;bBg1,&#160;bBg2,&#160;wait,&#160;sPageNr)<br/>End&#160;Sub<br/>
Sub&#160;printDoc(sTray1,&#160;sTray2,&#160;bBg1,&#160;bBg2,&#160;wait)<br/>' ------------------------------<br/>' This macro prints the document given the chosen arguments<br/>'<br/>' Written by Vincent Van Houtte (2010)<br/>' ------------------------------<br/>&#160; &#160;DIM&#160;oDoc&#160;AS&#160;Object<br/>&#160; &#160;oDoc&#160;=&#160;ThisComponent<br/>
&#160; &#160;REM Set backgroundImage-option in DocumentSettings to False<br/>&#160; &#160;DIM&#160;oSettings&#160;AS&#160;Object<br/>&#160; &#160;oSettings&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.DocumentSettings&#34;)<br/>&#160; &#160;oSettings.PrintPageBackground&#160;=&#160;bBg1<br/>
351<br/>
<hr/>
<a name=355></a>&#160; &#160;REM choose a certain printer<br/>&#160; &#160;DIM&#160;mPrinterOpts(2)&#160;AS&#160;NEW&#160;com.sun.star.beans.PropertyValue<br/>&#160; &#160;mPrinterOpts(0).Name&#160;=&#160;&#34;Name&#34;<br/>&#160; &#160;mPrinterOpts(0).Value&#160;=&#160;&#34;MFC8880DN&#34;<br/>&#160; &#160;mPrinterOpts(1).Name&#160;=&#160;&#34;PaperFormat&#34;<br/>&#160; &#160;mPrinterOpts(1).Value&#160;=&#160;com.sun.star.view.PaperFormat.A4<br/>&#160; &#160;mPrinterOpts(2).Name&#160;=&#160;&#34;PaperOrientation&#34;<br/>&#160; &#160;mPrinterOpts(2).Value&#160;=&#160;com.sun.star.view.PaperOrientation.PORTRAIT<br/>&#160; &#160;oDoc.Printer&#160;=&#160;mPrinterOpts()<br/>
&#160; &#160;REM set Papertray in Styles<br/>&#160; &#160;DIM&#160;oStyle&#160;AS&#160;Object<br/>&#160; &#160;DIM&#160;sPageStyle&#160;AS&#160;String&#160; &#160;<br/>&#160; &#160;sPageStyle&#160;=&#160;oDoc.CurrentController.getViewCursor().PageStyleName<br/>&#160; &#160;ostyle&#160;=&#160;oDoc.StyleFamilies.getByName(&#34;PageStyles&#34;).getByName(sPageStyle)<br/>&#160; &#160;oStyle.PrinterPaperTray&#160;=&#160;sTray1<br/>
&#160; &#160;REM Set printOptions<br/>&#160; &#160;DIM&#160;mPrintOpts(2)&#160;AS&#160;NEW&#160;com.sun.star.beans.PropertyValue<br/>&#160; &#160;mPrintOpts(0).Name&#160;=&#160;&#34;CopyCount&#34;<br/>&#160; &#160;mPrintOpts(0).Value&#160;=&#160;1<br/>&#160; &#160;mPrintOpts(1).Name&#160;=&#160;&#34;Collate&#34;<br/>&#160; &#160;mPrintOpts(1).Value&#160;=&#160;True<br/>&#160; &#160;mPrintOpts(2).Name&#160;=&#160;&#34;Wait&#34;<br/>&#160; &#160;mPrintOpts(2).Value&#160;=&#160;True<br/>
&#160; &#160;REM Print<br/>&#160; &#160;oDoc.Print(mPrintOpts())<br/>
&#160; &#160;REM RESET OPTIONS<br/>&#160; &#160;REM Reset backgroundImage-option in DocumentSettings<br/>&#160; &#160;oSettings.PrintPageBackground&#160;=&#160;bBg2<br/>&#160; &#160;REM Reset Papertray in Styles<br/>&#160; &#160;oStyle.PrinterPaperTray&#160;=&#160;sTray2<br/>&#160; &#160;REM Do a 0-print to complete the reset<br/>&#160; &#160;DIM&#160;mPrintOpts2(0)&#160;AS&#160;NEW&#160;com.sun.star.beans.PropertyValue<br/>&#160; &#160;mPrintOpts2(0).Name&#160;=&#160;&#34;CopyCount&#34;<br/>&#160; &#160;mPrintOpts2(0).Value&#160;=&#160;0<br/>&#160; &#160;oDoc.Print(mPrintOpts2())<br/>End&#160;Sub<br/>
Sub&#160;printPage(sTray1,&#160;sTray2,&#160;bBg1,&#160;bBg2,&#160;wait,&#160;sPageNr)<br/>' ------------------------------<br/>' This macro prints the document given the chosen arguments<br/>'<br/>' Written by Vincent Van Houtte (2010)<br/>' ------------------------------<br/>&#160; &#160;DIM&#160;oDoc&#160;AS&#160;Object<br/>&#160; &#160;oDoc&#160;=&#160;ThisComponent<br/>
&#160; &#160;REM Set backgroundImage-option in DocumentSettings to False<br/>&#160; &#160;DIM&#160;oSettings&#160;AS&#160;Object<br/>
352<br/>
<hr/>
<a name=356></a>&#160; &#160;oSettings&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.DocumentSettings&#34;)<br/>&#160; &#160;oSettings.PrintPageBackground&#160;=&#160;bBg1<br/>
&#160; &#160;REM choose a certain printer<br/>&#160; &#160;DIM&#160;mPrinterOpts(3)&#160;AS&#160;NEW&#160;com.sun.star.beans.PropertyValue<br/>&#160; &#160;mPrinterOpts(0).Name&#160;=&#160;&#34;Name&#34;<br/>&#160; &#160;mPrinterOpts(0).Value&#160;=&#160;&#34;MFC8880DN&#34;<br/>&#160; &#160;mPrinterOpts(1).Name&#160;=&#160;&#34;PaperFormat&#34;<br/>&#160; &#160;mPrinterOpts(1).Value&#160;=&#160;com.sun.star.view.PaperFormat.A4<br/>&#160; &#160;mPrinterOpts(2).Name&#160;=&#160;&#34;PaperOrientation&#34;<br/>&#160; &#160;mPrinterOpts(2).Value&#160;=&#160;com.sun.star.view.PaperOrientation.PORTRAIT<br/>&#160; &#160;oDoc.Printer&#160;=&#160;mPrinterOpts()<br/>
&#160; &#160;REM set Papertray in Styles<br/>&#160; &#160;DIM&#160;oStyle&#160;AS&#160;Object<br/>&#160; &#160;DIM&#160;sPageStyle&#160;AS&#160;String&#160; &#160;<br/>&#160; &#160;sPageStyle&#160;=&#160;oDoc.CurrentController.getViewCursor().PageStyleName<br/>&#160; &#160;ostyle&#160;=&#160;oDoc.StyleFamilies.getByName(&#34;PageStyles&#34;).getByName(sPageStyle)<br/>&#160; &#160;oStyle.PrinterPaperTray&#160;=&#160;sTray1<br/>
&#160; &#160;REM Set printOptions<br/>&#160; &#160;DIM&#160;mPrintOpts(3)&#160;AS&#160;NEW&#160;com.sun.star.beans.PropertyValue<br/>&#160; &#160;mPrintOpts(0).Name&#160;=&#160;&#34;CopyCount&#34;<br/>&#160; &#160;mPrintOpts(0).Value&#160;=&#160;1<br/>&#160; &#160;mPrintOpts(1).Name&#160;=&#160;&#34;Collate&#34;<br/>&#160; &#160;mPrintOpts(1).Value&#160;=&#160;True<br/>&#160; &#160;mPrintOpts(2).Name&#160;=&#160;&#34;Pages&#34;<br/>&#160; &#160;mPrintOpts(2).Value&#160;=&#160;sPageNr<br/>&#160; &#160;mPrintOpts(3).Name&#160;=&#160;&#34;Wait&#34;<br/>&#160; &#160;mPrintOpts(3).Value&#160;=&#160;True<br/>
&#160; &#160;REM Print<br/>&#160; &#160;oDoc.Print(mPrintOpts())<br/>
&#160; &#160;REM RESET OPTIONS<br/>&#160; &#160;REM Reset backgroundImage-option in DocumentSettings<br/>&#160; &#160;oSettings.PrintPageBackground&#160;=&#160;bBg2<br/>&#160; &#160;REM Reset Papertray in Styles<br/>&#160; &#160;oStyle.PrinterPaperTray&#160;=&#160;sTray2<br/>&#160; &#160;REM Do a 0-print to complete the reset<br/>&#160; &#160;DIM&#160;mPrintOpts2(0)&#160;AS&#160;NEW&#160;com.sun.star.beans.PropertyValue<br/>&#160; &#160;mPrintOpts2(0).Name&#160;=&#160;&#34;CopyCount&#34;<br/>&#160; &#160;mPrintOpts2(0).Value&#160;=&#160;0<br/>&#160; &#160;oDoc.Print(mPrintOpts2())<br/>End&#160;Sub<br/>
Sub&#160;closeDocument(oDoc&#160;AS&#160;Object)<br/>' ------------------------------<br/>' This macro closes the current document<br/>'<br/>' Written by Andrew Pitonyak (2010)<br/>
353<br/>
<hr/>
<a name=357></a>' Adapted by Vincent Van Houtte (2011)<br/>' ------------------------------<br/>
&#160; &#160;REM Check if the document exists<br/>&#160; &#160;If&#160;IsNull(oDoc)&#160;Then<br/>&#160; &#160; &#160;&#160;Exit&#160;Sub<br/>&#160; &#160;End&#160;If<br/>
&#160; &#160;REM Store the document if it was modified<br/>&#160; &#160;If&#160;(oDoc.isModified)&#160;Then<br/>&#160; &#160; &#160;If&#160;(oDoc.hasLocation&#160;AND&#160;(Not&#160;oDoc.isReadOnly))&#160;Then<br/>&#160; &#160; &#160; &#160;oDoc.store()<br/>&#160; &#160; &#160;Else<br/>&#160; &#160; &#160; &#160;oDoc.setModified(False)<br/>&#160; &#160; &#160;End&#160;If<br/>&#160; &#160;End&#160;If<br/>&#160; &#160;<br/>&#160; &#160;REM Close the document<br/>&#160; &#160;oDoc.close(true)<br/>End&#160;Sub<br/>
Sub&#160;ExportAsPdfAndSendEmail<br/>' ------------------------------<br/>' This macro converts the active document to PDF and then adds the PDF<br/>' to a new emailmessage. The recipientaddress and subject are<br/>' generated automagically from a textfield inside the document<br/>'<br/>' This macro assumes the default email application is set<br/>' in Tools -&gt; Options -&gt; OpenOffice.org -&gt; External Programs.<br/>'<br/>' This macro uses SimpleCommandMail, which might not work in windows<br/>' Try SimpleSystemMail instead<br/>'<br/>' Written by Vincent Van Houtte (2010)<br/>' ------------------------------<br/>&#160; &#160;DIM&#160;oDoc,&#160;MailClient,&#160;MailAgent,&#160;MailMessage&#160;AS&#160;Object<br/>&#160; &#160;DIM&#160;sDocURL,&#160;sPDFURL,&#160;sTo,&#160;sSubject&#160;AS&#160;String<br/>
&#160; &#160;REM Get location of the doc<br/>&#160; &#160;oDoc&#160;=&#160;ThisComponent<br/>&#160; &#160;If&#160;(Not&#160;oDoc.hasLocation())&#160;Then<br/>&#160; &#160; &#160;&#160;oDoc.store()<br/>&#160; &#160;End&#160;if<br/>
&#160; &#160;REM Insert timestamp of sending<br/>&#160; &#160;Dim&#160;sActionText&#160;AS&#160;String<br/>&#160; &#160;sActionText&#160;=&#160;&#34;VERZONDEN&#34;<br/>&#160; &#160;InsertDTstamp(sActionText)<br/>
&#160; &#160;REM Print the page<br/>&#160; &#160;PrintDocWithoutBgToTray1()<br/>
&#160; &#160;REM Replace .odt with .pdf<br/>
354<br/>
<hr/>
<a name=358></a>&#160; &#160;sDocURL&#160;=&#160;oDoc.getURL()<br/>&#160; &#160;sPDFURL&#160;=&#160;Left$(sDocURL,Len(sDocURL)-4)&#160;+&#160;&#34;.pdf&#34;<br/>
&#160; &#160;REM Save as PDF<br/>&#160; &#160;DIM&#160;args(0)&#160;AS&#160;NEW&#160;com.sun.star.beans.PropertyValue<br/>&#160; &#160;args(0).Name&#160;=&#160;&#34;FilterName&#34;<br/>&#160; &#160;args(0).Value&#160;=&#160;&#34;writer_pdf_Export&#34;<br/>&#160; &#160;oDoc.storeToURL(sPDFURL,args())<br/>
&#160; &#160;REM Remove the Date/time-stamp<br/>&#160; &#160;RemoveDTstamp()<br/>
&#160; &#160;REM Get the values of the textfields inside the document to form the subject line<br/>&#160; &#160;DIM&#160;enuTF,&#160;aTextField&#160;AS&#160;Object<br/>&#160; &#160;DIM&#160;sDosName,&#160;sDosNum,&#160;sDosUref&#160;AS&#160;String<br/>&#160; &#160;enuTF&#160;=&#160;oDoc.TextFields.createEnumeration<br/>&#160; &#160; &#160;&#160;Do&#160;While&#160;enuTF.hasMoreElements<br/>&#160; &#160; &#160;&#160;aTextField&#160;=&#160;enuTF.nextElement<br/>&#160; &#160; &#160; &#160; &#160;if&#160;aTextField.supportsService(&#34;com.sun.star.text.TextField.Input&#34;)&#160;then<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Select&#160;Case&#160;aTextField.getPropertyValue(&#34;Hint&#34;)<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Case&#160;&#34;DOS_NAAM&#34;:<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;sDosName&#160;=&#160;aTextField.getPropertyValue(&#34;Content&#34;)<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Case&#160;&#34;DOS_NUM&#34;:<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;sDosNum&#160;=&#160;aTextField.getPropertyValue(&#34;Content&#34;)<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Case&#160;&#34;REF_O&#34;:<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;sDosNum&#160;=&#160;aTextField.getPropertyValue(&#34;Content&#34;)<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Case&#160;&#34;UREF&#34;:<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;sDosUref&#160;=&#160;aTextField.getPropertyValue(&#34;Content&#34;)<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Case&#160;&#34;EMAIL_ADDR&#34;:<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;sTo&#160;=&#160;aTextField.getPropertyValue(&#34;Content&#34;)<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;End&#160;Select<br/>&#160; &#160; &#160; &#160; &#160;end&#160;if<br/>&#160; &#160; &#160;&#160;Loop<br/>&#160; &#160;sSubject&#160;=&#160;sDosName&#160;+&#160;&#34; - &#34;&#160;+&#160;sDosUref&#160;+&#160;&#34; - &#34;&#160;+&#160;sDosNum<br/>
&#160; &#160;REM Send the PDF as an attachment<br/>&#160; &#160;MailAgent&#160;=&#160;CreateUnoService(&#34;com.sun.star.system.SimpleCommandMail&#34;)<br/>&#160; &#160;MailClient&#160;=&#160;MailAgent.querySimpleMailClient()<br/>&#160; &#160; &#160;&#160;MailMessage=MailClient.createSimpleMailMessage()<br/>&#160; &#160; &#160;&#160;MailMessage.setRecipient(sTo)<br/>&#160; &#160; &#160;&#160;MailMessage.setSubject(sSubject)<br/>&#160; &#160; &#160;&#160;MailMessage.setAttachement(array(sPDFURL))<br/>&#160; &#160;MailClient.sendSimpleMailMessage(MailMessage,&#160;0)<br/>
&#160; &#160;REM Save and close the document<br/>&#160; &#160;closeDocument(oDoc)<br/>End&#160;Sub<br/>
355<br/>
<hr/>
<a name=359></a><i><b>&#160;13.16.&#160;Creating&#160;services<br/></b></i>An object&#160;that&#160;supports&#160;the&#160;XMultiServiceFactory&#160;interface&#160;may&#160;create&#160;services.&#160;An object&#160;is&#160;usually&#160;created&#160;<br/>by&#160;the&#160;object&#160;that&#160;will&#160;own it.&#160;As&#160;an example,&#160;a&#160;text&#160;table&#160;is&#160;created by&#160;the&#160;text&#160;document&#160;that&#160;will&#160;contain&#160;<br/>the&#160;text&#160;table. Similarly,&#160;the&#160;DocumentSettings&#160;object&#160;is&#160;created&#160;by&#160;the&#160;document&#160;of interest.&#160;The&#160;function&#160;&#160;<br/>CreateUnoService&#160;creates&#160;services&#160;in&#160;the&#160;scope&#160;of the&#160;OOo application.&#160;<br/>
The&#160;oSettings&#160;object&#160;in<a href="libremacros.html#359">&#160;Listing 329&#160;s</a>upports&#160;the&#160;service&#160;com.sun.star.text.DocumentSettings.&#160;The&#160;oSettings&#160;<br/>object&#160;is&#160;related to&#160;ThisComponent&#160;in&#160;that&#160;it&#160;reflects&#160;the&#160;settings&#160;for&#160;ThisComponent&#160;— the&#160;current&#160;<br/>document&#160;— but&#160;not&#160;for any&#160;other document.<br/>
<i><b>Listing&#160;329.</b>&#160;Create&#160;an object&#160;that&#160;supports&#160;the&#160;DocumentSettings&#160;service.<br/></i>oSettings=ThisComponent.createInstance(&#34;com.sun.star.text.DocumentSettings&#34;)<br/>
The&#160;createInstance() method returns&#160;an object&#160;that&#160;supports&#160;the&#160;requested service&#160;if&#160;it&#160;can;&#160;if it&#160;cannot,&#160;it&#160;<br/>returns&#160;NULL.&#160;The&#160;returned object&#160;may&#160;support&#160;other services&#160;as&#160;well&#160;(see<a href="libremacros.html#343">&#160;Listing&#160;318&#160;a</a><a href="libremacros.html#360">nd&#160;Figure&#160;93).</a><br/>
<i><b>Listing&#160;330.</b>&#160;Inspect&#160;a text&#160;document&#160;settings&#160;object.<br/></i>Sub&#160;WriteDocumentSettings<br/>&#160;&#160;Dim&#160;oSettings&#160;'Settings object to create<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160;&#160;'Utility string<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160;&#160;'Uitlity index variable<br/>&#160;&#160;Dim&#160;v&#160; &#160; &#160; &#160; &#160;'This will contain an array of service names<br/>
&#160;&#160;REM Create an object that supports the DocumentSettings service<br/>&#160;&#160;oSettings=ThisComponent.createInstance(&#34;com.sun.star.text.DocumentSettings&#34;)<br/>
&#160;&#160;v&#160;=&#160;oSettings.getSupportedServiceNames()<br/>&#160;&#160;s&#160;=&#160;&#34;**** Specified Supported Services ****&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;Join(v,&#160;CHR$(10))<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;**** Tested Services ****&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;<br/>&#160;&#160;REM Now check to see if this created object supports any other services.<br/>&#160;&#160;v&#160;=&#160;Array(&#34;com.sun.star.comp.Writer.DocumentSettings&#34;,_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;com.sun.star.text.PrintSettings&#34;)<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;UBound(v)<br/>&#160; &#160;&#160;If&#160;oSettings.supportsService(v(i))&#160;Then<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Supports service &#34;&#160;&amp;&#160;v(i)&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Some services for &#34;&#160;&amp;&#160;oSettings.getImplementationName()<br/>&#160;&#160;<br/>&#160;&#160;REM What is the status of the PrintControls property?<br/>&#160;&#160;Print&#160;oSettings.PrintControls<br/>&#160;&#160;<br/>&#160;&#160;REM I could set this to True or False<br/>&#160;&#160;'oSettings.Printcontrols = True<br/>End&#160;Sub<br/>
356<br/>
<hr/>
<a name=360></a><i><b>Figure&#160;93.</b>&#160;Some&#160;Writer&#160;document&#160;settings.</i><br/>
A&#160;careful&#160;inspecti<a href="libremacros.html#359">on of&#160;Listing 330&#160;a</a><a href="libremacros.html#360">nd&#160;Figure&#160;93&#160;de</a>monstrate&#160;that&#160;the&#160;object&#160;supports&#160;multiple&#160;services.&#160;<br/>
The&#160;method&#160;getSupportedServiceNames() lists&#160;the&#160;services&#160;supported by&#160;the&#160;object.<br/>
The&#160;method&#160;getImplementationName() returns&#160;the&#160;service&#160;that&#160;uniquely&#160;identifies&#160;the&#160;returned service&#160;<br/>(com.sun.star.comp.Writer.DocumentSettings).&#160;The&#160;unique&#160;service&#160;name&#160;is&#160;not&#160;in the&#160;list&#160;of supported&#160;<br/>service&#160;names.<br/>
Although not&#160;shown in<a href="libremacros.html#359">&#160;Listing 330, t</a>he&#160;two “Tested&#160;Services”&#160;in<a href="libremacros.html#360">&#160;Figure&#160;93&#160;c</a>annot&#160;be&#160;created using&#160;the&#160;<br/>createInstance() object&#160;method. I&#160;discovered the&#160;PrintSettings&#160;service&#160;entirely&#160;by&#160;accident. I&#160;inspected&#160;the&#160;<br/>dbg_properties&#160;property,&#160;which contained&#160;PrintControls.&#160;I&#160;then searched Google&#160;for “site:api.openoffice.org&#160;<br/>PrintSettings”.&#160;The&#160;important&#160;things&#160;to&#160;notice&#160;are&#160;as&#160;follows:<br/>
1.&#160;There&#160;are&#160;different&#160;methods&#160;of inspecting an object;&#160;use&#160;all&#160;of them.<br/>
2.&#160;The&#160;documentation&#160;is&#160;not&#160;complete.&#160;You must&#160;manually&#160;inspect&#160;an object&#160;to&#160;see&#160;what&#160;it&#160;supports.&#160;<br/>
However,&#160;undocumented&#160;methods&#160;and properties&#160;may&#160;be&#160;deprecated&#160;and removed later — so do this&#160;<br/>carefully.<br/>
3.&#160;You can search the&#160;Internet&#160;for services&#160;and properties.<br/>
<i><b>&#160;13.17.&#160;Document&#160;settings<br/></b></i>OOo contains&#160;numerous&#160;document&#160;options;&#160;these&#160;are&#160;available&#160;in the&#160;<b>Tools&#160;|&#160;Options</b>&#160;dialog. For&#160;example,&#160;<br/>Text&#160;Document&#160;contains&#160;a&#160;Print&#160;tab, which&#160;allows&#160;graphics&#160;to&#160;be&#160;printed, or not.&#160;The&#160;typical&#160;method&#160;for&#160;<br/>modifying&#160;properties&#160;in&#160;a&#160;document&#160;involves&#160;using&#160;either “get”&#160;and “set”&#160;methods, or directly&#160;accessing&#160;<br/>object&#160;properties.&#160;To&#160;access&#160;advanced document&#160;settings, however,&#160;you must&#160;use&#160;a&#160;completely&#160;different&#160;<br/>method.&#160;First&#160;the&#160;document&#160;has&#160;to&#160;create&#160;an object&#160;that&#160;supports&#160;the&#160;document&#160;settings. Every&#160;document&#160;<br/>type, except&#160;for the&#160;Math&#160;type, has&#160;the&#160;ability&#160;to&#160;create&#160;a&#160;service&#160;using&#160;the&#160;createInstance() met<a href="libremacros.html#360">hod.&#160;Table&#160;<br/>119&#160;c</a>ontains&#160;a&#160;list&#160;of the&#160;properties&#160;common&#160;to all&#160;of the&#160;document&#160;setting types;&#160;there&#160;are&#160;more.<br/>
<i>Table&#160;119. Common document&#160;properties&#160;in&#160;com.sun.star.document.Settings.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
ForbiddenCharacters&#160;<br/>
Allow&#160;access&#160;to otherwise&#160;forbidden characters.<br/>
LinkUpdateMode&#160;<br/>
The&#160;update&#160;mode&#160;for&#160;links&#160;when loading&#160;text&#160;documents.<br/>
PrinterName&#160;<br/>
Printer&#160;used&#160;by&#160;the&#160;document.<br/>
357<br/>
<hr/>
<a name=361></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
PrinterSetup&#160;<br/>
Platform-&#160;and&#160;driver-dependent&#160;printer&#160;setup&#160;data.<br/>
IsKernAsianPunctuation&#160;<br/>
Is&#160;kerning&#160;applied&#160;to&#160;Asian&#160;punctuation?<br/>
CharacterCompressionType&#160;<br/>
Compression (character&#160;spacing)&#160;used for&#160;Asian characters.<br/>
ApplyUserData&#160;<br/>
Should user-specific&#160;settings saved&#160;in a&#160;document&#160;be&#160;loaded&#160;again?<br/>
SaveVersionOnClose&#160;<br/>
Is&#160;a&#160;new&#160;version created when a&#160;modified&#160;document&#160;is closed?<br/>
UpdateFromTemplate&#160;<br/>
Should a&#160;document&#160;be&#160;updated&#160;when&#160;its&#160;creation template&#160;changes?<br/>
FieldAutoUpdate&#160;<br/>
Are&#160;text&#160;document&#160;fields automatically&#160;updated?<br/>
CurrentDatabaseDataSource&#160;<br/>
Name&#160;of&#160;the&#160;data&#160;source&#160;from&#160;which the&#160;current&#160;data&#160;is&#160;taken.<br/>
CurrentDatabaseCommand&#160;<br/>
Displayed&#160;object’s&#160;name&#160;(or&#160;the&#160;SQL&#160;statement&#160;used).<br/>
CurrentDatabaseCommandType&#160;<br/>
Specifies how&#160;to interpret&#160;the&#160;DataTableName&#160;property.<br/>
DefaultTabStop&#160;<br/>
Default&#160;tab width.<br/>
IsPrintBooklet&#160;<br/>
Is&#160;the&#160;document&#160;printed&#160;as a&#160;booklet&#160;(brochure)?<br/>
IsPrintBookletFront&#160;<br/>
If&#160;True,&#160;only&#160;the&#160;front&#160;pages of&#160;a&#160;booklet&#160;are&#160;printed.<br/>
IsPrintBookletBack&#160;<br/>
If&#160;True,&#160;only&#160;the&#160;back pages of&#160;a&#160;booklet&#160;are&#160;printed.<br/>
PrintQuality&#160;<br/>
Quality&#160;to&#160;use&#160;when&#160;printing.<br/>
ColorTableURL&#160;<br/>
URL&#160;of&#160;the&#160;color&#160;table&#160;(SOC&#160;file)&#160;showing&#160;a&#160;palette&#160;in&#160;dialogs that&#160;use&#160;colors.<br/>
PrinterIndependentLayout&#160;<br/>
If&#160;true,&#160;do&#160;not&#160;use&#160;printer&#160;metrics for&#160;layout.<br/>
Specific&#160;document&#160;settings&#160;services&#160;exist&#160;for&#160;Writer,&#160;Calc, Draw,&#160;and Impress&#160;documents&#160;(see<a href="libremacros.html#361">&#160;Table&#160;120).&#160;<br/></a>Although each of these&#160;services&#160;implements&#160;the&#160;Settings&#160;service&#160;as&#160;shown i<a href="libremacros.html#360">n&#160;Table&#160;119, a</a>ll&#160;of the&#160;properties&#160;<br/>except&#160;for PrinterName&#160;and PrinterSetup&#160;are&#160;optional.<br/>
<i>Table&#160;120. Specific&#160;document&#160;settings&#160;service&#160;types.</i><br/>
<i><b>Document&#160;Settings&#160;Service</b></i><br/>
<i><b>Document&#160;Type</b></i><br/>
com.sun.star.text.DocumentSettings<br/>
Writer<br/>
com.sun.star.sheet.DocumentSettings<br/>
Calc<br/>
com.sun.star.drawing.DocumentSettings<br/>
Draw<br/>
com.sun.star.presentation.DocumentSettings<br/>
Impress<br/>
As&#160;shown in<a href="libremacros.html#359">&#160;Listing 330&#160;a</a><a href="libremacros.html#360">nd&#160;Figure&#160;93, t</a>he&#160;Writer document&#160;settings&#160;support&#160;the&#160;PrintSettings&#160;service&#160;(se<a href="libremacros.html#361">e<br/>Table&#160;121)</a>.&#160;The&#160;Draw&#160;and Impress&#160;document&#160;settings&#160;services&#160;each contain&#160;special&#160;settings&#160;that&#160;apply&#160;only&#160;<br/>to their respective&#160;document&#160;types.<br/>
<i>Table&#160;121. Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.text.PrintSettings&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
PrintGraphics&#160;<br/>
If&#160;True, print&#160;graphic&#160;object.<br/>
PrintTables&#160;<br/>
If&#160;True, print&#160;text&#160;tables.<br/>
PrintDrawings&#160;<br/>
If&#160;True, print&#160;shapes.<br/>
PrintLeftPages&#160;<br/>
If&#160;True, print&#160;left&#160;pages.<br/>
PrintRightPages&#160;<br/>
If&#160;True, print&#160;right&#160;pages.<br/>
358<br/>
<hr/>
<a name=362></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
PrintControls&#160;<br/>
If&#160;True, print&#160;control&#160;contained in&#160;the&#160;document.<br/>
PrintReversed&#160;<br/>
If&#160;True, print&#160;the&#160;pages in&#160;reverse&#160;order,&#160;starting&#160;with&#160;the&#160;last&#160;page.<br/>
PrintPaperFromSetup&#160;<br/>
If&#160;True, use&#160;the&#160;paper&#160;tray&#160;specified for&#160;the&#160;system&#160;printer.&#160;If&#160;False, use&#160;the&#160;paper&#160;tray&#160;<br/>
specified by&#160;the&#160;page&#160;style.<br/>
PrintFaxName&#160;<br/>
Name&#160;of&#160;the&#160;fax.<br/>
PrintAnnotationMode&#160;<br/>
Specify&#160;how&#160;notes are&#160;printed.&#160;Uses com.sun.star.text.NotePrintMode&#160;enumerated&#160;value.&#160;<br/>Possible&#160;values include&#160;NOT,&#160;ONLY,&#160;DOC_END, or&#160;PAGE_END.<br/>
PrintProspect&#160;<br/>
If&#160;True, prospect&#160;printing&#160;is used;&#160;however,&#160;I&#160;cannot&#160;find&#160;a&#160;definition for&#160;prospect&#160;printing.<br/>
PrintPageBackground&#160;<br/>
If&#160;True, the&#160;background color&#160;and/or&#160;background graphic&#160;is&#160;printed.<br/>
PrintBlackFonts&#160;<br/>
If&#160;True, characters are&#160;always printed&#160;in&#160;black.<br/>
<i><b>&#160;13.18.&#160;The&#160;coolest&#160;trick&#160;I&#160;know<br/></b></i>Sadly,&#160;this&#160;only&#160;works&#160;in&#160;LibreOffice, and not&#160;in OOo.&#160;While&#160;editing a&#160;document:<br/>
1.&#160;Use&#160;<b>File&#160;&gt;&#160;Open</b>&#160;to open the&#160;Open dialog.<br/>
2.&#160;Enter “vnd.sun.star.tdoc:/”&#160;for the&#160;file&#160;name&#160;and click&#160;Open.<br/>
3.&#160;Currently&#160;open documents&#160;are&#160;shown for selection.&#160;Select&#160;a&#160;document;&#160;and click open.<br/>
You are&#160;looking&#160;at&#160;the&#160;document's&#160;internal&#160;structures.&#160;You can even open an image&#160;embedded in a&#160;document.<br/>A&#160;document&#160;containing pictures&#160;is&#160;a&#160;good example&#160;to&#160;try.<br/>
<i><b>&#160;13.19.&#160;Converting&#160;to&#160;a&#160;URL&#160;in&#160;other&#160;languages<br/></b></i>Basic&#160;provides&#160;the&#160;methods&#160;ConvertToURL&#160;and ConvertFromURL, other languages&#160;do not.&#160;Some&#160;URI&#160;<br/>schemes&#160;leave&#160;unspecified important&#160;aspects&#160;of how&#160;to interpret&#160;URIs&#160;of those&#160;schemes. For example,&#160;it&#160;is&#160;<br/>unspecified&#160;for “file”&#160;URLs&#160;how&#160;to&#160;map the&#160;byte&#160;sequences&#160;that&#160;constitute&#160;the&#160;path&#160;segments&#160;of a&#160;“file”&#160;URL<br/>to filenames&#160;on a&#160;given platform:&#160;The&#160;UNO&#160;environment&#160;always&#160;assumes&#160;that&#160;path&#160;segments&#160;of “file”&#160;URLs&#160;<br/>represent&#160;UTF-8–encoded strings&#160;(which have&#160;to be&#160;mapped to&#160;filenames&#160;in&#160;a&#160;platform-specific&#160;way),&#160;while&#160;<br/>other applications&#160;typically&#160;assume&#160;that&#160;path segments&#160;of “file”&#160;URLs&#160;directly&#160;represent&#160;a&#160;platform's&#160;byte-<br/>sequence&#160;filenames.&#160;The&#160;ExternalUriReferenceTranslator offers&#160;methods&#160;to&#160;translate&#160;between such internal&#160;<br/>URIs&#160;(e.g., UTF-8–encoded “file”&#160;URLs&#160;used within&#160;the&#160;UNO&#160;environment) and external&#160;URIs&#160;(e.g., byte-<br/>sequence–oriented “file”&#160;URLs&#160;used by&#160;other applications).&#160;Typically,&#160;only&#160;“file”&#160;URLs&#160;are&#160;affected&#160;by&#160;this&#160;<br/>translation.&#160;<br/>
x&#160;=&#160;CreateUnoService(&#34;com.sun.star.uri.ExternalUriReferenceTranslator&#34;)<br/>Print&#160;x.translateToExternal(&#34;file:///c:/MyDoc.oot&#34;)<br/>Print&#160;x.translateToInternal(&#34;file:/c:/MyDoc.oot&#34;)&#160;<br/>
<i><b>&#160;13.20.&#160;Conclusion<br/></b></i>The&#160;interfaces&#160;and services&#160;introduced in this&#160;chapter provide&#160;a&#160;good introduction to&#160;the&#160;capabilities&#160;of OOo&#160;<br/>that&#160;are&#160;not&#160;directly&#160;related to&#160;a&#160;specific&#160;document&#160;type. OOo contains&#160;numerous&#160;other capabilities&#160;that&#160;I&#160;<br/>could have&#160;included&#160;in this&#160;chapter,&#160;but&#160;it&#160;isn’t&#160;possible&#160;to exhaustively&#160;cover every&#160;subject. Use&#160;these&#160;topics<br/>and methods&#160;as&#160;a&#160;starting point&#160;to investigate&#160;the&#160;other capabilities&#160;of OpenOffice.org.<br/>
359<br/>
<hr/>
<a name=363></a><b>&#160;14.&#160;Writer&#160;Documents<br/></b>Writer documents&#160;primarily&#160;deal&#160;with text&#160;content&#160;arranged in paragraphs.&#160;This&#160;chapter introduces&#160;<br/>appropriate&#160;methods&#160;to&#160;manipulate,&#160;traverse, search, format,&#160;and modify&#160;the&#160;content&#160;contained&#160;in an&#160;<br/>OpenOffice.org&#160;Writer document. First,&#160;a&#160;bit&#160;of review&#160;that&#160;is&#160;applicable&#160;to&#160;most&#160;document&#160;types.<br/>
Conceptually,&#160;all&#160;document&#160;types&#160;have&#160;two components:&#160;the&#160;data&#160;they&#160;contain&#160;and the&#160;controller that&#160;<br/>determines&#160;how&#160;the&#160;data&#160;is&#160;displayed.&#160;Writer documents&#160;primarily&#160;contain&#160;simple&#160;formatted text. In&#160;addition&#160;<br/>to simple&#160;text,&#160;Writer documents&#160;may&#160;contain other content&#160;such as&#160;tables, frames, graphics, text&#160;fields,&#160;<br/>bookmarks, footnotes, endnotes, text&#160;sections,&#160;index&#160;entries, tracked document&#160;changes&#160;(called redlining),&#160;<br/>objects&#160;for styling, and objects&#160;for numbering. OOo uses&#160;the&#160;same&#160;methods&#160;and interfaces&#160;to&#160;interact&#160;with&#160;<br/>most&#160;of these&#160;capabilities. Consequently,&#160;learning to manipulate&#160;a&#160;few&#160;types&#160;of content&#160;will&#160;give&#160;you a&#160;solid&#160;<br/>basis&#160;for dealing with all&#160;of them.<br/>
<b>TIP</b><br/>
In&#160;OOo,&#160;the&#160;data&#160;contained&#160;in a&#160;document&#160;is called&#160;the&#160;“model.”&#160;The&#160;base&#160;model&#160;interface&#160;is&#160;<br/>
com.sun.star.frame.XModel.<br/>
In&#160;OpenOffice.org, the&#160;data&#160;contained&#160;in a&#160;document&#160;is&#160;called the&#160;model. Each model&#160;has&#160;a&#160;controller that&#160;is&#160;<br/>responsible&#160;for the&#160;visual&#160;presentation&#160;of the&#160;data.&#160;The&#160;controller knows&#160;the&#160;location of the&#160;visible&#160;text&#160;<br/>cursor,&#160;the&#160;current&#160;page, and what&#160;is&#160;currently&#160;selected.<br/>
<b>TIP</b><br/>
While&#160;trying&#160;to determine&#160;which portion of&#160;the&#160;OOo&#160;API&#160;to use&#160;to&#160;solve&#160;a&#160;specific&#160;problem, first&#160;ask if&#160;the&#160;<br/>problem&#160;is&#160;display-centric&#160;or&#160;data-centric.&#160;For&#160;example,&#160;a&#160;paragraph boundary&#160;is&#160;specified&#160;in&#160;the&#160;data,&#160;but&#160;a<br/>
new&#160;line&#160;is&#160;usually&#160;determined&#160;by&#160;the&#160;controller&#160;when&#160;the&#160;data&#160;is formatted.<br/>
Every&#160;text&#160;document&#160;supports&#160;the&#160;com.sun.star.text.TextDocument&#160;service.&#160;When I&#160;write&#160;a&#160;macro that&#160;must&#160;<br/>be&#160;user friendly&#160;and requires&#160;a&#160;text&#160;document, I&#160;verify&#160;that&#160;the&#160;document&#160;is&#160;the&#160;correct&#160;type&#160;by&#160;using the&#160;<br/>object&#160;method&#160;supportsService&#160;(see<a href="libremacros.html#363">&#160;Listing&#160;331).</a><br/>
<i><b>Listing&#160;331.</b>&#160;Text&#160;documents&#160;support&#160;the&#160;com.sun.star.text.TextDocument&#160;service.</i><br/>
REM If it really matters, you should check the document type<br/>REM to avoid a run-time error.<br/>If&#160;NOT&#160;ThisComponent.supportsService(&#34;com.sun.star.text.TextDocument&#34;)&#160;Then<br/>&#160;&#160;MsgBox&#160;&#34;The current document is not a Writer text document&#34;,&#160;48,&#160;&#34;Error&#34;<br/>&#160;&#160;Exit&#160;Sub<br/>End&#160;If<br/>
An interface&#160;defines&#160;a&#160;series&#160;of methods. If&#160;an object&#160;implements&#160;an interface, it&#160;also&#160;implements&#160;every&#160;<br/>method&#160;defined&#160;by&#160;that&#160;interface.&#160;A&#160;service&#160;defines&#160;an object&#160;by&#160;specifying the&#160;interfaces&#160;that&#160;it&#160;implements,&#160;<br/>the&#160;properties&#160;that&#160;it&#160;contains,&#160;and the&#160;other services&#160;that&#160;it&#160;exports.&#160;A&#160;service&#160;indirectly&#160;specifies&#160;the&#160;<br/>implemented methods&#160;by&#160;specifying interfaces.&#160;The&#160;interfaces&#160;supported by&#160;the&#160;TextDocument&#160;service&#160;<br/>provide&#160;a&#160;good overview&#160;of the&#160;provided&#160;functionality&#160;(see<a href="libremacros.html#364">&#160;Table&#160;122).</a><br/>
360<br/>
<hr/>
<a name=364></a><i><b>Table&#160;122.&#160;</b>Interfaces&#160;supported by&#160;text&#160;documents.</i><br/>
<i><b>Service</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.text.XTextDocument&#160;<br/>
Main&#160;text&#160;document&#160;interface.<br/>
com.sun.star.text.XBookmarksSupplier&#160;<br/>
Access the&#160;bookmarks.<br/>
com.sun.star.text.XChapterNumberingSupplier&#160;<br/>
Numbering&#160;rules for&#160;chapters.<br/>
com.sun.star.text.XDocumentIndexesSupplier&#160;<br/>
Access the&#160;collection of&#160;indexes.<br/>
com.sun.star.text.XTextEmbeddedObjectsSupplier&#160;<br/>
Access embedded&#160;objects.<br/>
com.sun.star.text.XEndnotesSupplier&#160;<br/>
Access endnote&#160;content.<br/>
com.sun.star.text.XFootnotesSupplier&#160;<br/>
Access footnote&#160;content.<br/>
com.sun.star.text.XLineNumberingSupplier&#160;<br/>
Numbering&#160;rules for&#160;line&#160;numbers.<br/>
com.sun.star.text.XPagePrintable&#160;<br/>
Print&#160;multiple&#160;pages on one&#160;page.<br/>
com.sun.star.text.XReferenceMarksSupplier&#160;<br/>
Access the&#160;document&#160;reference&#160;marks,&#160;which are&#160;used&#160;to&#160;<br/>refer&#160;to text&#160;positions in&#160;a&#160;text&#160;document.<br/>
com.sun.star.text.XTextFieldsSupplier&#160;<br/>
Access contained&#160;fields.<br/>
com.sun.star.text.XTextFramesSupplier&#160;<br/>
Access contained&#160;text&#160;frames.<br/>
com.sun.star.text.XTextGraphicObjectsSupplier&#160;<br/>
Access embedded&#160;and&#160;linked&#160;graphics.<br/>
com.sun.star.text.XTextSectionsSupplier&#160;<br/>
Access contained&#160;text&#160;sections.<br/>
com.sun.star.text.XTextTablesSupplier&#160;<br/>
Access contained&#160;tables.<br/>
com.sun.star.style.XStyleFamiliesSupplier&#160;<br/>
Access contained&#160;styles&#160;by&#160;type.<br/>
com.sun.star.util.XNumberFormatsSupplier&#160;<br/>
Access contained&#160;number&#160;formats.<br/>
com.sun.star.util.XRefreshable&#160;<br/>
Refresh data&#160;that&#160;can be&#160;refreshed&#160;from&#160;a&#160;database.<br/>
com.sun.star.util.XReplaceable&#160;<br/>
Replace&#160;text&#160;found with a&#160;search descriptor.<br/>
com.sun.star.util.XSearchable&#160;<br/>
Search&#160;a&#160;text&#160;range&#160;for&#160;a&#160;specific&#160;string&#160;pattern.<br/>
com.sun.star.beans.XPropertySet&#160;<br/>
Access document&#160;properties&#160;by&#160;name.<br/>
<i><b>&#160;14.1.&#160;Basic&#160;building&#160;blocks<br/></b></i>While&#160;dealing&#160;with&#160;Writer documents,&#160;you’ll&#160;see&#160;that&#160;a&#160;few&#160;simple&#160;interfaces&#160;and concepts&#160;recur.&#160;These&#160;basic<br/>building&#160;blocks&#160;are&#160;interrelated&#160;in that&#160;their respective&#160;interfaces&#160;are&#160;circularly&#160;defined&#160;(they&#160;refer to each&#160;<br/>other). Fortunately,&#160;the&#160;concepts&#160;are&#160;intuitive&#160;and therefore&#160;easy&#160;to&#160;grasp, even with&#160;a&#160;brief introduction.&#160;This<br/>section briefly&#160;introduces&#160;these&#160;basic&#160;building blocks, laying&#160;the&#160;groundwork for detailed coverage&#160;later.<br/>
<b>&#160;14.1.1.&#160;Primary&#160;text&#160;content:&#160;the&#160;XText&#160;interface<br/></b>Text&#160;content&#160;is&#160;contained&#160;in an object&#160;that&#160;implements&#160;the&#160;XText&#160;interface.&#160;The&#160;primary&#160;purpose&#160;of a&#160;text&#160;<br/>object&#160;is&#160;to&#160;contain text&#160;content, create&#160;text&#160;cursors&#160;to move&#160;through text,&#160;insert&#160;text, and remove&#160;text&#160;(se<a href="libremacros.html#365">e<br/><b>Table&#160;123</b>)</a>.<br/>
361<br/>
<hr/>
<a name=365></a><i><b>Table&#160;123.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.text.XText&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
createTextCursor()<br/>
Return a&#160;TextCursor&#160;service&#160;used&#160;to traverse&#160;the&#160;text&#160;object.<br/>
createTextCursorByRange(XTextRange)<br/>
Return a&#160;TextCursor&#160;that&#160;is located&#160;at&#160;the&#160;specified&#160;TextRange.<br/>
insertString(XTextRange,&#160;String, boolean)<br/>
Insert&#160;a&#160;string&#160;of&#160;characters into the&#160;text&#160;at&#160;the&#160;specified&#160;text&#160;range.&#160;<br/>
Each CR&#160;(ASCII&#160;13)&#160;inserts a&#160;new&#160;paragraph and each LF&#160;(ASCII&#160;10)&#160;<br/>inserts a&#160;new&#160;line. If&#160;the&#160;Boolean value&#160;is&#160;True,&#160;the&#160;text&#160;in&#160;the&#160;range&#160;is&#160;<br/>
overwritten;&#160;otherwise, the&#160;text&#160;characters are&#160;inserted&#160;after&#160;the&#160;text&#160;<br/>range.<br/>
insertControlCharacter(XTextRange,&#160;Short,&#160;<br/>
Insert&#160;a&#160;control&#160;character&#160;(such as a&#160;paragraph break&#160;or&#160;a&#160;hard&#160;space)&#160;<br/>
boolean)<br/>
into the&#160;text.&#160;The&#160;short&#160;integer&#160;is a&#160;value&#160;from&#160;the&#160;constant&#160;group&#160;<br/>
com.sun.star.text.ControlCharacter:<br/>•<br/>
PARAGRAPH_BREAK&#160;=&#160;0&#160;–&#160;Start&#160;a&#160;new&#160;paragraph. &#160;<br/>
•<br/>
LINE_BREAK&#160;=&#160;1&#160;–&#160;Start&#160;a&#160;new&#160;line&#160;in&#160;a&#160;paragraph.&#160;&#160;<br/>
•<br/>
HARD_HYPHEN&#160;=&#160;2 –&#160;Insert&#160;a&#160;dash that&#160;will&#160;not&#160;hyphenate.<br/>
•<br/>
SOFT_HYPHEN&#160;=&#160;3 –&#160;Define&#160;a&#160;preferred hyphenation point&#160;if&#160;the&#160;<br/>word must&#160;be&#160;split&#160;at&#160;the&#160;end&#160;of&#160;a&#160;line.<br/>
•<br/>
HARD_SPACE&#160;=&#160;4&#160;– Insert&#160;a&#160;space&#160;that&#160;prevents&#160;two&#160;words from&#160;<br/>splitting&#160;at&#160;a&#160;line&#160;break.<br/>
•<br/>
APPEND_PARAGRAPH&#160;=&#160;5 –&#160;Append&#160;a&#160;new&#160;paragraph.&#160;If&#160;the&#160;<br/>Boolean value&#160;is&#160;True, the&#160;text&#160;in&#160;the&#160;text&#160;range&#160;is&#160;overwritten;&#160;<br/>
otherwise,&#160;the&#160;control&#160;character&#160;is inserted&#160;after&#160;the&#160;text&#160;range.<br/>
insertTextContent(XTextRange,&#160;XTextContent,&#160;<br/>
Insert&#160;text&#160;content&#160;such as a&#160;text&#160;table,&#160;text&#160;frame, or&#160;text&#160;field. In&#160;<br/>
boolean)<br/>
general,&#160;the&#160;text&#160;content&#160;should&#160;be&#160;created&#160;by&#160;the&#160;text&#160;object.&#160;If&#160;the&#160;<br/>Boolean&#160;value&#160;is&#160;True,&#160;the&#160;text&#160;in the&#160;text&#160;range&#160;is overwritten;&#160;<br/>
otherwise, the&#160;text&#160;content&#160;is inserted&#160;after&#160;the&#160;text&#160;range.<br/>
removeTextContent(XTextContent)<br/>
Remove&#160;the&#160;specified&#160;text&#160;content&#160;from&#160;the&#160;text&#160;object.<br/>
Because&#160;the&#160;XText&#160;interface&#160;is&#160;derived&#160;from&#160;the&#160;XTextRange&#160;interface, all&#160;objects&#160;that&#160;implement&#160;the&#160;XText&#160;<br/>interface&#160;also&#160;support&#160;the&#160;object&#160;methods&#160;defined by&#160;the&#160;XTextRange&#160;interface&#160;(see<a href="libremacros.html#366">&#160;Table&#160;124).</a><br/>
<b>&#160;14.1.2.&#160;Text&#160;ranges:&#160;the&#160;XTextRange&#160;interface<br/></b>A&#160;text&#160;range&#160;is&#160;one&#160;of the&#160;most&#160;important&#160;concepts&#160;in&#160;a&#160;text&#160;document&#160;because&#160;so many&#160;interfaces&#160;derive&#160;<br/>from&#160;the&#160;XTextRange&#160;interface.&#160;The&#160;primary&#160;purpose&#160;of a&#160;text&#160;range&#160;is&#160;to&#160;define&#160;a&#160;start&#160;and end position in&#160;<br/>the&#160;text&#160;(see<a href="libremacros.html#366">&#160;Table&#160;124). I</a>t&#160;is&#160;possible&#160;that&#160;the&#160;start&#160;position and the&#160;end position&#160;in a&#160;text&#160;range&#160;are&#160;the&#160;same.<br/>When&#160;the&#160;start&#160;and end positions&#160;are&#160;the&#160;same, the&#160;text&#160;range&#160;identifies&#160;a&#160;position in&#160;the&#160;text—for example,&#160;<br/>the&#160;cursor in&#160;a&#160;text&#160;document&#160;when no text&#160;is&#160;selected. If&#160;the&#160;start&#160;and end positions&#160;of a&#160;text&#160;range&#160;are&#160;not&#160;<br/>the&#160;same, they&#160;represent&#160;a&#160;section of text.<br/>
362<br/>
<hr/>
<a name=366></a><i><b>Table&#160;124.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.text.XTextRange&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getText()<br/>
Return the&#160;XText&#160;interface&#160;that&#160;contains the&#160;text&#160;range.<br/>
getStart()<br/>
A&#160;text&#160;range&#160;has a&#160;start&#160;and&#160;end&#160;position.&#160;The&#160;getStart()&#160;method&#160;returns a&#160;text&#160;range&#160;that&#160;<br/>contains&#160;only&#160;the&#160;start&#160;position of&#160;this text&#160;range.<br/>
getEnd()<br/>
A&#160;text&#160;range&#160;has a&#160;start&#160;and&#160;end&#160;position.&#160;The&#160;getStart()&#160;method&#160;returns a&#160;text&#160;range&#160;that&#160;<br/>contains&#160;only&#160;the&#160;end&#160;position of&#160;this&#160;text&#160;range.<br/>
setString(String)<br/>
A&#160;text&#160;range&#160;has a&#160;start&#160;and&#160;end&#160;position.&#160;The&#160;setString()&#160;method&#160;replaces&#160;all&#160;of&#160;the&#160;text&#160;<br/>between the&#160;start&#160;and&#160;end&#160;positions with&#160;the&#160;argument&#160;string.&#160;All&#160;styles are&#160;removed and all&#160;text<br/>
in&#160;this&#160;text&#160;range&#160;is&#160;replaced.<br/>
getString()<br/>
Return a&#160;string&#160;that&#160;represents the&#160;text&#160;in this text&#160;range.&#160;Strings in OOo&#160;Basic&#160;are&#160;limited to&#160;<br/>
64KB&#160;in&#160;size,&#160;but&#160;text&#160;ranges and&#160;text&#160;objects are&#160;not;&#160;use&#160;this with&#160;care.<br/>
Every&#160;XTextRange&#160;object&#160;is&#160;associated with&#160;a&#160;text&#160;object.&#160;It&#160;can be&#160;said that&#160;an XTextRange&#160;object&#160;is&#160;<br/>contained in&#160;an object&#160;that&#160;implements&#160;the&#160;XText&#160;interface.&#160;The&#160;XText&#160;interface&#160;is&#160;itself derived&#160;from&#160;the&#160;<br/>XTextRange&#160;interface. Use&#160;the&#160;getText() object&#160;method&#160;to obtain the&#160;text&#160;object&#160;that&#160;is&#160;associated with&#160;the&#160;<br/>text&#160;range.<br/>
<b>TIP</b><br/>
Common tasks&#160;include&#160;obtaining&#160;a&#160;bookmark, obtaining&#160;the&#160;bookmark’s&#160;anchor&#160;position (a&#160;text&#160;range),&#160;and<br/>then inserting&#160;text&#160;content&#160;at&#160;the&#160;bookmark’s&#160;anchor&#160;position.&#160;Although&#160;the&#160;setString()&#160;method&#160;is the&#160;<br/>
quickest&#160;way&#160;to&#160;add&#160;text&#160;at&#160;the&#160;anchor&#160;position, inserting&#160;text&#160;content&#160;requires an&#160;object&#160;that&#160;supports the&#160;<br/>XText&#160;interface.&#160;The&#160;getText()&#160;method returns&#160;an object&#160;that&#160;can insert&#160;text&#160;content&#160;using&#160;the&#160;text&#160;range.<br/>
Writer documents&#160;primarily&#160;contain formatted text.&#160;To&#160;access&#160;the&#160;formatted text, either call&#160;the&#160;document’s&#160;<br/>object&#160;method&#160;getText() or directly&#160;access&#160;the&#160;document’s&#160;Text&#160;property.&#160;I&#160;usually&#160;directly&#160;access&#160;the&#160;Text&#160;<br/>property&#160;because&#160;it&#160;requires&#160;less&#160;typing.<br/>
ThisComponent.Text&#160; &#160; &#160;&#160;'Current document's text object<br/>ThisComponent.getText()&#160;'Current document's text object<br/>
The&#160;document’s&#160;text&#160;object&#160;implements&#160;the&#160;XTextRange&#160;interface.&#160;The&#160;simplest&#160;method&#160;to&#160;obtain&#160;all&#160;of the&#160;<br/>text&#160;characters&#160;contained in&#160;a&#160;text&#160;document&#160;is&#160;to&#160;call&#160;the&#160;getString() object&#160;method&#160;(see<a href="libremacros.html#366">&#160;Table&#160;124)</a>.&#160;The&#160;<br/>getString() method&#160;returns&#160;a&#160;single&#160;string containing&#160;a&#160;text&#160;version of the&#160;document.&#160;Each cell&#160;in a&#160;text&#160;table&#160;<br/>is&#160;returned as&#160;a&#160;single&#160;paragraph, and all&#160;formatting is&#160;lost.&#160;The&#160;object&#160;method&#160;setString() can be&#160;used to&#160;set&#160;<br/>the&#160;entire&#160;document’s&#160;text&#160;in one&#160;call—when setString() is&#160;used, all&#160;of the&#160;existing text&#160;is&#160;lost! See<a href="libremacros.html#366">&#160;Listing&#160;<br/>332<b>.&#160;</b></a><br/>
<i><b>Listing&#160;332.&#160;</b>Get&#160;and set&#160;the&#160;entire&#160;document&#160;text&#160;with&#160;no formatting.</i><br/>
MsgBox&#160;ThisComponent.Text.getString(),&#160;0,&#160;&#34;Document Text String&#34;<br/>ThisComponent.Text.setString(&#34;This is text to set&#34;)<br/>
<b>TIP</b><br/>
Use&#160;getString()&#160;only&#160;on small&#160;text&#160;documents. I&#160;wrote&#160;a&#160;macro&#160;that&#160;computed&#160;word-usage&#160;statistics&#160;by&#160;first&#160;<br/>
calling&#160;the&#160;getString()&#160;object&#160;method.&#160;Because&#160;OOo&#160;Basic&#160;strings are&#160;limited&#160;to 64KB&#160;characters, the&#160;<br/>macro failed on large&#160;documents.<br/>
The&#160;getString() and setString() object&#160;methods&#160;are&#160;limited,&#160;because&#160;OOo Basic&#160;strings&#160;are&#160;limited&#160;to 64KB&#160;<br/>in size&#160;and they&#160;contain&#160;no formatting information.&#160;Due&#160;to these&#160;limitations, other methods&#160;are&#160;usually&#160;used&#160;<br/>to get&#160;and set&#160;the&#160;document&#160;text.&#160;Generally,&#160;large&#160;or complex&#160;documents&#160;are&#160;best&#160;handled&#160;with the&#160;getText()&#160;<br/>method&#160;and related&#160;methods,&#160;because&#160;they&#160;support&#160;arbitrary&#160;size&#160;and modular management&#160;of complex&#160;<br/>documents.<br/>
363<br/>
<hr/>
<a name=367></a><b>&#160;14.1.3.&#160;Inserting&#160;simple&#160;text<br/></b>With the&#160;limited information&#160;already&#160;presented, you can already&#160;insert&#160;simple&#160;text&#160;content&#160;at&#160;the&#160;beginning&#160;<br/>and the&#160;end of a&#160;document.&#160;The&#160;getStart() and getEnd() object&#160;methods&#160;both return a&#160;text&#160;range&#160;that&#160;can be&#160;<br/>used to&#160;insert&#160;text&#160;into&#160;a&#160;text&#160;object&#160;(see<a href="libremacros.html#365">&#160;Table&#160;123&#160;a</a><a href="libremacros.html#366">nd&#160;Table&#160;124)</a>.&#160;The&#160;code&#160;i<a href="libremacros.html#367">n&#160;Listing&#160;333&#160;i</a>nserts&#160;simple&#160;<br/>text&#160;at&#160;the&#160;start&#160;of the&#160;document&#160;and a&#160;new&#160;paragraph at&#160;the&#160;end of the&#160;document.<br/>
<i><b>Listing&#160;333.&#160;</b>Insert&#160;simple&#160;text&#160;at&#160;the&#160;start&#160;and end of&#160;the&#160;document.<br/></i>Sub&#160;InsertSimpleText<br/>&#160;&#160;Dim&#160;oText&#160;As&#160;Object<br/>&#160;&#160;oText&#160;=&#160;ThisComponent.Text<br/>&#160;&#160;<br/>&#160;&#160;REM Insert some simple text at the start<br/>&#160;&#160;oText.insertString(oText.getStart(),&#160;&#34;Text object start.&#34;&#160;&amp;&#160;CHR$(13),&#160;False)<br/>&#160;&#160;REM Append a new paragraph at the end<br/>&#160;&#160;oText.InsertControlCharacter(oText.getEnd(),_<br/>&#160; &#160; &#160; &#160; &#160; &#160;com.sun.star.text.ControlCharacter.APPEND_PARAGRAPH,&#160;False)<br/>End&#160;Sub<br/>
<b>&#160;14.1.4.&#160;Text&#160;content:&#160;the&#160;TextContent&#160;service<br/></b>The&#160;primary&#160;purpose&#160;of the&#160;TextContent&#160;service&#160;is&#160;to anchor an object&#160;(text&#160;content) to&#160;its&#160;surrounding text.&#160;<br/>Conceptually&#160;there&#160;are&#160;two types&#160;of text&#160;content:&#160;content&#160;that&#160;is&#160;part&#160;of the&#160;surrounding text&#160;(a&#160;text&#160;field,&#160;for&#160;<br/>example), and content&#160;that&#160;is&#160;more&#160;like&#160;a&#160;floating field&#160;(a&#160;graphic&#160;image, for example).<br/>
To&#160;determine&#160;where&#160;text&#160;content&#160;is&#160;anchored in&#160;the&#160;text, call&#160;the&#160;getAnchor() object&#160;method.&#160;This&#160;returns&#160;a&#160;<br/>text&#160;range&#160;that&#160;defines&#160;the&#160;anchor location.&#160;For&#160;floating text&#160;content&#160;objects,&#160;the&#160;text&#160;needs&#160;to know&#160;how&#160;to&#160;<br/>flow&#160;around the&#160;object&#160;and how&#160;the&#160;object&#160;is&#160;anchored to the&#160;text&#160;(see<a href="libremacros.html#368">&#160;Table&#160;125)</a>.&#160;The&#160;behavior of text&#160;<br/>content&#160;inserted&#160;as&#160;a&#160;character should be&#160;well&#160;understood.&#160;The&#160;content&#160;acts&#160;just&#160;like&#160;a&#160;character would act:&#160;<br/>The&#160;text&#160;content&#160;is&#160;moved&#160;along between two other characters.&#160;When text&#160;content&#160;is&#160;anchored at&#160;a&#160;<br/>paragraph, however,&#160;the&#160;text&#160;content&#160;is&#160;not&#160;required to move&#160;as&#160;the&#160;characters&#160;before&#160;and after it&#160;are&#160;moved.&#160;<br/>It&#160;is&#160;only&#160;required that&#160;the&#160;object&#160;stay&#160;attached to a&#160;paragraph, and the&#160;object&#160;is&#160;not&#160;inserted&#160;into&#160;a&#160;paragraph.<br/>I&#160;usually&#160;anchor an object&#160;to&#160;a&#160;paragraph when I&#160;want&#160;text&#160;to&#160;flow&#160;around the&#160;object;&#160;for example,&#160;a&#160;graphic&#160;<br/>on the&#160;right&#160;and text&#160;on the&#160;left.<br/>
364<br/>
<hr/>
<a name=368></a><i><b>Table&#160;125.&#160;</b>Properties&#160;supported by&#160;the&#160;com.sun.star.text.TextContent&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
AnchorType<br/>
Enumeration of&#160;type&#160;com.sun.star.text.TextContentAnchorType&#160;that&#160;defines how&#160;this&#160;text&#160;content&#160;is&#160;<br/>
attached to&#160;the&#160;surrounding&#160;text.<br/>•<br/>
AT_PARAGRAPH&#160;–&#160;The&#160;anchor&#160;is&#160;set&#160;at&#160;the&#160;top left&#160;position of&#160;the&#160;paragraph.&#160;The&#160;object&#160;moves&#160;<br/>
if&#160;the&#160;paragraph&#160;moves.<br/>
•<br/>
AS_CHARACTER&#160;–&#160;The&#160;text&#160;content&#160;object&#160;is anchored&#160;as a&#160;character.&#160;The&#160;size&#160;of&#160;the&#160;object&#160;<br/>
influences the&#160;height&#160;of&#160;the&#160;text&#160;line&#160;and&#160;the&#160;object&#160;can move&#160;as a&#160;character&#160;if&#160;the&#160;surrounding&#160;text&#160;<br/>moves.<br/>
•<br/>
AT_PAGE&#160;–&#160;The&#160;text&#160;content&#160;object&#160;is&#160;anchored&#160;to the&#160;page.&#160;The&#160;object&#160;does not&#160;move&#160;even&#160;if&#160;the<br/>text&#160;content&#160;around&#160;it&#160;changes.<br/>
•<br/>
AT_FRAME –&#160;The&#160;text&#160;content&#160;object&#160;is anchored&#160;to a&#160;text&#160;frame.<br/>
•<br/>
AT_CHARACTER&#160;–&#160;The&#160;text&#160;content&#160;object&#160;is anchored to a&#160;character.&#160;The&#160;object&#160;moves if&#160;the&#160;<br/>
character&#160;moves.<br/>
AnchorTypes<br/>
Array&#160;of&#160;TextContentAnchorType&#160;that&#160;contains the&#160;anchor&#160;types of&#160;the&#160;text&#160;content. &#160;<br/>
TextWrap<br/>
Enumeration of&#160;type&#160;com.sun.star.text.WrapTextMode&#160;that&#160;defines&#160;how&#160;the&#160;surrounding&#160;text&#160;wraps&#160;<br/>around this text&#160;content&#160;object.<br/>•<br/>
NONE&#160;–&#160;Text&#160;does not&#160;flow&#160;around the&#160;object.<br/>
•<br/>
THROUGHT&#160;–&#160;Text&#160;flow&#160;ignores the&#160;object.&#160;(Yes,&#160;it&#160;is&#160;THROUGHT.)&#160;This can be&#160;thought&#160;of&#160;as&#160;<br/>
THROUGH&#160;iT,&#160;as in, “the&#160;text&#160;flows&#160;through the&#160;object.”<br/>
•<br/>
PARALLEL&#160;–&#160;Text&#160;flows&#160;to the&#160;left&#160;and&#160;right&#160;of&#160;the&#160;object.<br/>
•<br/>
DYNAMIC&#160;–&#160;The&#160;text&#160;formatting&#160;decides the&#160;best&#160;wrapping&#160;method.<br/>
•<br/>
LEFT&#160;–&#160;Text&#160;flows&#160;to the&#160;left&#160;of&#160;the&#160;object.<br/>
•<br/>
RIGHT&#160;–&#160;Text&#160;flows&#160;to&#160;the&#160;right&#160;of&#160;the&#160;object.<br/>
The&#160;text&#160;object&#160;contains&#160;methods&#160;to&#160;insert&#160;TextContent&#160;objects&#160;at&#160;specified locations&#160;(see<a href="libremacros.html#365">&#160;Table&#160;123)</a>. &#160;In&#160;<br/>general, the&#160;TextContent&#160;type&#160;must&#160;be&#160;created&#160;by&#160;the&#160;document&#160;before&#160;it&#160;is&#160;inserted (see<a href="libremacros.html#368">&#160;Listing 334)</a>.<br/>
<i><b>Listing&#160;334.&#160;</b>Insert&#160;text&#160;content&#160;(a&#160;text&#160;table) at&#160;the&#160;end of&#160;the&#160;current&#160;document.</i><br/>
Sub&#160;InsertSimpleTableAtEnd<br/>&#160;&#160;Dim&#160;oTable&#160;&#160;'Newly created table to insert<br/>
&#160;&#160;REM Let the document create the text table. &#160;<br/>&#160;&#160;oTable&#160;=&#160;ThisComponent.createInstance(&#160;&#34;com.sun.star.text.TextTable&#34;&#160;)<br/>&#160;&#160;oTable.initialize(3,&#160;2)&#160;'Three rows, two columns<br/>&#160;&#160;<br/>&#160;&#160;REM Now insert the text table at the end of the document.<br/>&#160;&#160;ThisComponent.Text.insertTextContent(_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;ThisComponent.Text.getEnd(),&#160;oTable,&#160;False)<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
In&#160;general,&#160;the&#160;TextContent&#160;type&#160;must&#160;be&#160;created&#160;by&#160;the&#160;document&#160;before&#160;it&#160;is inserted.<br/>
Call&#160;the&#160;removeTextContent(XTextContent) object&#160;method&#160;(see<a href="libremacros.html#365">&#160;Table&#160;123)</a>&#160;to&#160;remove&#160;text&#160;content.&#160;Another&#160;<br/>method&#160;of removing text&#160;content&#160;is&#160;to&#160;write&#160;new&#160;text&#160;content&#160;in&#160;its&#160;place.&#160;A&#160;simple&#160;example&#160;of this&#160;is&#160;to call&#160;<br/>the&#160;setString() method on a&#160;text&#160;range&#160;that&#160;includes&#160;the&#160;text&#160;content&#160;(see<a href="libremacros.html#368">&#160;Listing&#160;335).</a><br/>
<i><b>Listing&#160;335.&#160;</b>Clear&#160;the&#160;entire&#160;document&#160;of&#160;all&#160;text&#160;content.</i><br/>
ThisComponent.Text.setString(&#34;&#34;)&#160;&#160;'Clear an entire document!<br/>
365<br/>
<hr/>
<a name=369></a><i><b>&#160;14.2.&#160;Enumerating&#160;paragraphs<br/></b></i>Writer documents&#160;primarily&#160;contain formatted text&#160;that&#160;is&#160;arranged into paragraphs.&#160;Writer methods&#160;can&#160;<br/>operate&#160;on words, sentences, paragraphs, and entire&#160;text&#160;objects.&#160;Paragraphs&#160;are&#160;the&#160;most&#160;basic&#160;<br/>organizational&#160;unit&#160;for formatted&#160;text,&#160;and methods&#160;on paragraphs&#160;are&#160;often&#160;the&#160;most&#160;reliable, meaning they&#160;<br/>contain&#160;fewer bugs.&#160;The&#160;paragraphs&#160;can be&#160;enumerated&#160;sequentially&#160;using the&#160;XEnumerationAccess&#160;<br/>interface&#160;defined in&#160;the&#160;document’s&#160;text&#160;object. OOo treats&#160;tables&#160;as&#160;a&#160;special&#160;type&#160;of paragraph, and they&#160;are<br/>returned while&#160;enumerating paragraphs&#160;(see<a href="libremacros.html#369">&#160;Listing&#160;336).</a><br/>
<i><b>Listing&#160;336.</b>&#160;Count&#160;paragraphs&#160;and text&#160;tables.<br/></i>Sub&#160;enumerateParagraphs<br/>&#160;&#160;Dim&#160;oEnum&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'com.sun.star.container.XEnumerationAccess<br/>&#160;&#160;Dim&#160;oPar&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Paragraph of some sort<br/>&#160;&#160;Dim&#160;nPars&#160;As&#160;Integer&#160; &#160;'Number of paragraphs<br/>&#160;&#160;Dim&#160;nTables&#160;As&#160;Integer&#160;'Number of tables<br/>&#160;&#160;<br/>&#160;&#160;REM ThisComponent refers to the current OOo document<br/>&#160;&#160;REM Text is a property of ThisComponent for a text document<br/>&#160;&#160;REM The getText() object method returns the same thing.<br/>&#160;&#160;REM createEnumeration() is an object method.<br/>&#160;&#160;oEnum&#160;=&#160;ThisComponent.Text.createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements()<br/>&#160; &#160;&#160;oPar&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM The returned paragraph will be a paragraph or a text table<br/>&#160; &#160;&#160;If&#160;oPar.supportsService(&#34;com.sun.star.text.Paragraph&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;nPars&#160;=&#160;nPars&#160;+&#160;1<br/>&#160; &#160;&#160;ElseIf&#160;oPar.supportsService(&#34;com.sun.star.text.TextTable&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;nTables&#160;=&#160;nTables&#160;+&#160;1<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Loop<br/>&#160;&#160;MsgBox&#160;CStr(nPars)&#160;&amp;&#160;&#34; Paragraph(s)&#34;&#160;&amp;&#160;CHR$(13)&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;CStr(nTables)&#160;&amp;&#160;&#34; Table(s)&#34;&#160;&amp;&#160;CHR$(13),&#160;0,_<br/>&#160; &#160; &#160; &#160; &#160;&#34;Paragraph Types In Document&#34;<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
Visual&#160;Basic&#160;for&#160;Applications&#160;(VBA)&#160;supports&#160;accessing&#160;paragraphs using&#160;an index;&#160;OOo does not.<br/>
While&#160;enumerating&#160;the&#160;paragraphs&#160;in&#160;a&#160;Writer document, both&#160;paragraphs&#160;and tables&#160;are&#160;returned.&#160;The&#160;object<br/>method&#160;supportsService() is&#160;used to determine&#160;if a&#160;paragraph or a&#160;table&#160;is&#160;returned. Paragraph objects&#160;<br/>support&#160;both the&#160;XTextRange&#160;interface&#160;and the&#160;XTextContent&#160;interface.&#160;TextTable&#160;objects,&#160;however,&#160;support&#160;<br/>only&#160;the&#160;XTextContent&#160;interface.<br/>
The&#160;macro i<a href="libremacros.html#369">n&#160;Listing&#160;336&#160;e</a>numerates&#160;paragraphs&#160;in&#160;the&#160;high level&#160;text&#160;object. Many&#160;objects&#160;contains&#160;their&#160;<br/>own text&#160;object;&#160;fore&#160;example,&#160;each cell&#160;in a&#160;text&#160;table&#160;and each frame.<br/>
<b>&#160;14.2.1.&#160;Paragraph&#160;properties<br/></b>Paragraphs&#160;contain&#160;numerous&#160;paragraph-related properties&#160;encapsulated&#160;in services.&#160;The&#160;properties&#160;that&#160;are&#160;<br/>primarily&#160;related&#160;to the&#160;entire&#160;paragraph are&#160;encapsulated&#160;in the&#160;ParagraphProperties&#160;service&#160;(see<a href="libremacros.html#370">&#160;Table&#160;126)</a>.<br/>
366<br/>
<hr/>
<a name=370></a><b>TIP</b><br/>
The&#160;Paragraph service&#160;is not&#160;the&#160;only&#160;service&#160;that&#160;supports the&#160;ParagraphProperties service.&#160;Other&#160;services,<br/>
especially&#160;those&#160;that&#160;are&#160;also&#160;a&#160;text&#160;range,&#160;also&#160;support&#160;paragraph properties.&#160;Techniques used&#160;to modify&#160;<br/>paragraph&#160;properties&#160;in&#160;paragraphs apply&#160;to these&#160;services as well.<br/>
<i><b>Table&#160;126.&#160;</b>Properties&#160;supported by&#160;the&#160;com.sun.style.ParagraphProperties&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
ParaAdjust&#160;<br/>
Specify&#160;how&#160;the&#160;paragraph is aligned&#160;(or&#160;justified). Five&#160;values are&#160;supported&#160;from&#160;<br/>
the&#160;com.sun.star.style.ParagraphAdjust&#160;enumeration:<br/>•<br/>
LEFT&#160;– Left-align the&#160;paragraph.<br/>
•<br/>
RIGHT&#160;–&#160;Right-align the&#160;paragraph.<br/>
•<br/>
CENTER&#160;–&#160;Center-align the&#160;paragraph.<br/>
•<br/>
BLOCK&#160;– Fill-justify&#160;every&#160;line&#160;except&#160;for&#160;the&#160;last&#160;line.<br/>
•<br/>
STRETCH&#160;– Fill-justify&#160;every&#160;line&#160;including&#160;the&#160;last&#160;line.<br/>
ParaLastLineAdjust&#160;<br/>
Adjust&#160;the&#160;last&#160;line&#160;if&#160;the&#160;ParaAdjust&#160;is set&#160;to&#160;BLOCK.<br/>
ParaLineSpacing&#160;<br/>
Specify&#160;the&#160;paragraph&#160;line&#160;spacing.&#160;The&#160;property&#160;is a&#160;structure&#160;of&#160;type&#160;<br/>
com.sun.star.style.LineSpacing,&#160;which contains two properties of&#160;type&#160;Short.&#160;The&#160;<br/>Height&#160;property&#160;specifies the&#160;height&#160;and&#160;the&#160;Mode&#160;property&#160;specifies how&#160;to use&#160;the&#160;<br/>
Height&#160;property.&#160;The&#160;Mode&#160;property&#160;supports values defined&#160;in the&#160;<br/>com.sun.star.style.LineSpacingMode&#160;constants group.&#160;<br/>•<br/>
PROP&#160;=&#160;0&#160;–&#160;The&#160;height&#160;is&#160;proportional.<br/>
•<br/>
MINIMUM =&#160;1 –&#160;The&#160;height&#160;is&#160;the&#160;minimum&#160;line&#160;height.<br/>
•<br/>
LEADING&#160;=&#160;2 –&#160;The&#160;height&#160;is&#160;the&#160;distance&#160;to the&#160;previous line.<br/>
•<br/>
FIX&#160;=&#160;3 –&#160;The&#160;height&#160;is&#160;fixed.<br/>
ParaBackColor&#160;<br/>
Specify&#160;the&#160;paragraph&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
ParaBackTransparent&#160;<br/>
If&#160;True,&#160;set&#160;the&#160;paragraph background color&#160;to transparent.<br/>
ParaBackGraphicURL&#160;<br/>
Specify&#160;the&#160;URL&#160;of&#160;the&#160;paragraph background graphic.<br/>
ParaBackGraphicFilter&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;graphic&#160;filter&#160;for&#160;the&#160;paragraph background&#160;graphic.<br/>
ParaBackGraphicLocation&#160;<br/>
Specify&#160;the&#160;position&#160;of&#160;the&#160;background&#160;graphic&#160;using&#160;the&#160;enumeration&#160;&#160;<br/>sun.star.style.GraphicLocation:<br/>•<br/>
NONE&#160;–&#160;A&#160;location is not&#160;yet&#160;assigned.<br/>
•<br/>
LEFT_TOP&#160;–&#160;The&#160;graphic&#160;is in the&#160;top&#160;left&#160;corner.<br/>
•<br/>
MIDDLE_TOP&#160;–&#160;The&#160;graphic&#160;is&#160;in&#160;the&#160;middle&#160;of&#160;the&#160;top edge.<br/>
•<br/>
RIGHT_TOP&#160;–&#160;The&#160;graphic&#160;is in the&#160;top&#160;right&#160;corner.<br/>
•<br/>
LEFT_MIDDLE&#160;–&#160;The&#160;graphic&#160;is in the&#160;middle&#160;of&#160;the&#160;left&#160;edge.<br/>
•<br/>
MIDDLE_MIDDLE&#160;–&#160;The&#160;graphic&#160;is&#160;in&#160;the&#160;center&#160;of&#160;the&#160;surrounding&#160;object.<br/>
•<br/>
RIGHT_MIDDLE &#160;–&#160;The&#160;graphic&#160;is&#160;in&#160;the&#160;middle&#160;of&#160;the&#160;right&#160;edge.<br/>
•<br/>
LEFT_BOTTOM &#160;–&#160;The&#160;graphic&#160;is in the&#160;bottom&#160;left&#160;corner.<br/>
•<br/>
MIDDLE_BOTTOM&#160;–&#160;The&#160;graphic&#160;is&#160;in&#160;the&#160;middle&#160;of&#160;the&#160;bottom&#160;edge.<br/>
•<br/>
RIGHT_BOTTOM &#160;–&#160;The&#160;graphic&#160;is in the&#160;bottom&#160;right&#160;corner.<br/>
•<br/>
AREA&#160;–&#160;The&#160;graphic&#160;is&#160;scaled to&#160;fill&#160;the&#160;whole&#160;surrounding&#160;area.<br/>
•<br/>
TILED&#160;–&#160;The&#160;graphic&#160;is&#160;repeated&#160;over&#160;the&#160;surrounding&#160;object&#160;like&#160;tiles.<br/>
ParaExpandSingleWord&#160;<br/>
If&#160;True,&#160;single&#160;words may&#160;be&#160;stretched.<br/>
ParaLeftMargin&#160;<br/>
Specify&#160;the&#160;left&#160;paragraph margin in 0.01&#160;mm&#160;as a&#160;Long Integer.<br/>
367<br/>
<hr/>
<a name=371></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
ParaRightMargin&#160;<br/>
Specify&#160;the&#160;right&#160;paragraph margin in&#160;0.01&#160;mm&#160;as a&#160;Long Integer.<br/>
ParaTopMargin&#160;<br/>
Specify&#160;the&#160;top paragraph margin&#160;in&#160;0.01&#160;mm&#160;as&#160;a&#160;Long&#160;Integer.&#160;The&#160;distance&#160;<br/>between two paragraphs is the&#160;maximum&#160;of&#160;the&#160;bottom&#160;margin of&#160;the&#160;previous&#160;<br/>
paragraph&#160;and&#160;the&#160;top&#160;margin of&#160;the&#160;next&#160;paragraph.<br/>
ParaBottomMargin&#160;<br/>
Specify&#160;the&#160;bottom&#160;paragraph margin in 0.01&#160;mm&#160;as a&#160;Long Integer.&#160;The&#160;distance&#160;<br/>
between two paragraphs is the&#160;maximum&#160;of&#160;the&#160;bottom&#160;margin of&#160;the&#160;previous&#160;<br/>paragraph&#160;and&#160;the&#160;top&#160;margin of&#160;the&#160;next&#160;paragraph.<br/>
ParaLineNumberCount&#160;<br/>
If&#160;True,&#160;this paragraph is included in&#160;line&#160;numbering.<br/>
ParaLineNumberStartValue&#160;<br/>
Specify&#160;the&#160;start&#160;value&#160;for&#160;line&#160;numbering&#160;as a&#160;Long&#160;Integer.<br/>
PageDescName&#160;<br/>
Setting&#160;this string&#160;causes a&#160;page&#160;break to&#160;occur&#160;before&#160;the&#160;paragraph.&#160;The&#160;new&#160;page&#160;<br/>uses the&#160;specified&#160;page&#160;style&#160;name.<br/>
PageNumberOffset&#160;<br/>
Specify&#160;a&#160;new&#160;page&#160;number&#160;if&#160;a&#160;page&#160;break occurs.<br/>
ParaRegisterModeActive&#160;<br/>
If&#160;True,&#160;and if&#160;the&#160;paragraph's page&#160;style&#160;also&#160;has the&#160;register&#160;mode&#160;set&#160;to&#160;True,&#160;the&#160;<br/>
register&#160;mode&#160;is active&#160;for&#160;this&#160;paragraph. If&#160;register&#160;mode&#160;is active,&#160;each line&#160;has&#160;<br/>the&#160;same&#160;height.<br/>
ParaTabStops&#160;<br/>
Specify&#160;the&#160;tab stops for&#160;this&#160;paragraph.&#160;This is an array&#160;of&#160;structures&#160;of&#160;type&#160;<br/>com.sun.star.style.TabStop.&#160;Each structure&#160;contains&#160;the&#160;following&#160;properties:<br/>•<br/>
Position –&#160;Long&#160;integer&#160;position&#160;relative&#160;to the&#160;left&#160;border.<br/>
•<br/>
Alignment&#160;–&#160;Alignment&#160;of&#160;the&#160;text&#160;range&#160;before&#160;the&#160;tab.&#160;This is&#160;an enumeration&#160;<br/>
of&#160;type&#160;com.sun.star.style.TabAlign.&#160;Valid values include&#160;LEFT,&#160;RIGHT,&#160;<br/>CENTER, DECIMAL, and DEFAULT.<br/>
•<br/>
DecimalChar&#160;– Specifies which&#160;character&#160;is the&#160;decimal.<br/>
•<br/>
FillChar&#160;– Character&#160;used&#160;to fill&#160;space&#160;between&#160;the&#160;text.<br/>
ParaStyleName&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;current&#160;paragraph style.<br/>
DropCapFormat&#160;<br/>
Structure&#160;that&#160;determines&#160;if&#160;the&#160;first&#160;characters&#160;of&#160;the&#160;paragraph use&#160;dropped&#160;capital&#160;<br/>
letters.&#160;The&#160;com.sun.star.style.DropCapFormat&#160;&#160;contains the&#160;following&#160;properties:<br/>•<br/>
Lines –&#160;Number&#160;of&#160;lines used&#160;for&#160;a&#160;drop cap.<br/>
•<br/>
Count&#160;– Number&#160;of&#160;characters in&#160;the&#160;drop&#160;cap.<br/>
•<br/>
Distance&#160;–&#160;Distance&#160;between the&#160;drop&#160;cap and the&#160;following&#160;text.<br/>
DropCapWholeWord&#160;<br/>
If&#160;True,&#160;the&#160;DropCapFormat&#160;is applied&#160;to the&#160;entire&#160;first&#160;word.<br/>
ParaKeepTogether&#160;<br/>
If&#160;True,&#160;prevents a&#160;page&#160;or&#160;column&#160;break&#160;after&#160;this paragraph—for&#160;example, to&#160;<br/>
prevent&#160;a&#160;title&#160;from&#160;being&#160;the&#160;last&#160;line&#160;on a&#160;page&#160;or&#160;column.<br/>
ParaSplit&#160;<br/>
If&#160;False, prevents the&#160;paragraph from&#160;splitting&#160;into&#160;two&#160;pages or&#160;columns.<br/>
NumberingLevel&#160;<br/>
Specify&#160;the&#160;numbering&#160;level&#160;of&#160;the&#160;paragraph.<br/>
NumberingRules&#160;<br/>
Specify&#160;the&#160;numbering&#160;rules applied&#160;to this&#160;paragraph.&#160;This object&#160;implements the&#160;<br/>
com.sun.star.container.XIndexReplace&#160;interface.<br/>
NumberingStartValue&#160;<br/>
Specify&#160;the&#160;start&#160;value&#160;for&#160;numbering&#160;if&#160;ParaIsNumberingRestart&#160;is&#160;True.<br/>
ParaIsNumberingRestart&#160;<br/>
Specify&#160;if&#160;numbering&#160;restarts at&#160;the&#160;current&#160;paragraph (see&#160;NumberingStartValue).<br/>
NumberingStyleName&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;style&#160;for&#160;numbering&#160;(see&#160;ParaLineNumberCount).<br/>
ParaOrphans&#160;<br/>
Specify&#160;the&#160;minimum&#160;number&#160;of&#160;lines at&#160;the&#160;bottom&#160;of&#160;a&#160;page&#160;if&#160;the&#160;paragraph spans&#160;<br/>more&#160;than&#160;one&#160;page.<br/>
ParaWidows&#160;<br/>
Specify&#160;the&#160;minimum&#160;number&#160;of&#160;lines at&#160;the&#160;top&#160;of&#160;a&#160;page&#160;if&#160;the&#160;paragraph spans&#160;<br/>more&#160;than&#160;one&#160;page.<br/>
ParaShadowFormat&#160;<br/>
Specify&#160;the&#160;paragraph&#160;shadow&#160;format&#160;as a&#160;com.sun.star.table.ShadowFormat:<br/>
368<br/>
<hr/>
<a name=372></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
•<br/>
Location –&#160;Specify&#160;the&#160;shadow&#160;location as an enumeration of&#160;type&#160;<br/>
com.sun.star.table.ShadowLocation.&#160;Valid&#160;values include&#160;NONE,&#160;TOP_LEFT,&#160;<br/>TOP_RIGHT,&#160;BOTTOM_LEFT,&#160;and BOTTOM_RIGHT.<br/>
•<br/>
ShadowWidth&#160;–&#160;Specify&#160;the&#160;size&#160;of&#160;the&#160;shadow&#160;as an Integer.<br/>
•<br/>
IsTransparent&#160;–&#160;If&#160;True,&#160;the&#160;shadow&#160;is&#160;transparent.<br/>
•<br/>
Color&#160;–&#160;Specify&#160;the&#160;color&#160;of&#160;the&#160;shadow&#160;as&#160;a&#160;Long&#160;Integer.<br/>
LeftBorder&#160;<br/>
Specify&#160;the&#160;left&#160;border&#160;as a&#160;com.sun.star.table.BorderLine&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
RightBorder&#160;<br/>
Specify&#160;the&#160;right&#160;border&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
TopBorder&#160;<br/>
Specify&#160;the&#160;top border&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
BottomBorder&#160;<br/>
Specify&#160;the&#160;bottom&#160;border&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
BorderDistance&#160;<br/>
Specify&#160;the&#160;distance&#160;from&#160;the&#160;border&#160;to the&#160;object&#160;(in 0.01&#160;mm).<br/>
LeftBorderDistance&#160;<br/>
Specify&#160;the&#160;distance&#160;from&#160;the&#160;left&#160;border&#160;to the&#160;object&#160;(in&#160;0.01&#160;mm).<br/>
RightBorderDistance&#160;<br/>
Specify&#160;the&#160;distance&#160;from&#160;the&#160;right&#160;border&#160;to&#160;the&#160;object&#160;(in 0.01 mm).<br/>
TopBorderDistance&#160;<br/>
Specify&#160;the&#160;distance&#160;from&#160;the&#160;top&#160;border&#160;to the&#160;object&#160;(in 0.01&#160;mm).<br/>
BottomBorderDistance&#160;<br/>
Specify&#160;the&#160;distance&#160;from&#160;the&#160;bottom&#160;border&#160;to the&#160;object&#160;(in&#160;0.01&#160;mm).<br/>
BreakType&#160;<br/>
Specify&#160;the&#160;type&#160;of&#160;break&#160;that&#160;is applied&#160;at&#160;the&#160;start&#160;of&#160;the&#160;paragraph.&#160;This is&#160;an&#160;<br/>enumeration&#160;of&#160;type&#160;com.sun.star.style.BreakType&#160;with the&#160;following&#160;values:<br/>•<br/>
NONE&#160;– No&#160;column&#160;or&#160;page&#160;break is&#160;applied.<br/>
•<br/>
COLUMN_BEFORE –&#160;A&#160;column&#160;break&#160;is applied before&#160;the&#160;current&#160;paragraph.&#160;<br/>
The&#160;current&#160;paragraph,&#160;therefore,&#160;is&#160;the&#160;first&#160;in&#160;the&#160;column.<br/>
•<br/>
COLUMN_AFTER&#160;–&#160;A&#160;column&#160;break is&#160;applied&#160;after&#160;the&#160;current&#160;paragraph.&#160;The<br/>
current&#160;paragraph, therefore,&#160;is the&#160;last&#160;in&#160;the&#160;column.<br/>
•<br/>
COLUMN_BOTH&#160;–&#160;A&#160;column&#160;break is&#160;applied&#160;before&#160;and&#160;after&#160;the&#160;current&#160;<br/>
paragraph.&#160;The&#160;current&#160;paragraph, therefore,&#160;is the&#160;only&#160;paragraph in&#160;the&#160;column.<br/>
•<br/>
PAGE_BEFORE –&#160;A&#160;page&#160;break&#160;is applied before&#160;the&#160;current&#160;paragraph.&#160;The&#160;<br/>
current&#160;paragraph, therefore,&#160;is the&#160;first&#160;on the&#160;page.<br/>
•<br/>
PAGE_AFTER&#160;–&#160;A&#160;page&#160;break is&#160;applied&#160;after&#160;the&#160;current&#160;paragraph.&#160;The&#160;<br/>
current&#160;paragraph, therefore,&#160;is the&#160;last&#160;on the&#160;page.<br/>
•<br/>
PAGE_BOTH&#160;–&#160;A&#160;page&#160;break is&#160;applied&#160;before&#160;and&#160;after&#160;the&#160;current&#160;paragraph.&#160;<br/>
The&#160;current&#160;paragraph,&#160;therefore,&#160;is&#160;the&#160;only&#160;paragraph on&#160;the&#160;page.<br/>
DropCapCharStyleName&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;character&#160;style&#160;for&#160;drop&#160;caps.<br/>
ParaFirstLineIndent&#160;<br/>
Specify&#160;the&#160;indent&#160;for&#160;the&#160;first&#160;line&#160;in a&#160;paragraph.<br/>
ParaIsAutoFirstLineIndent&#160;<br/>
If&#160;True,&#160;the&#160;first&#160;line&#160;is&#160;indented&#160;automatically.<br/>
ParaIsHyphenation&#160;<br/>
If&#160;True,&#160;automatic&#160;hyphenation is&#160;applied.<br/>
ParaHyphenationMaxHyphens&#160;<br/>
Specify&#160;the&#160;maximum&#160;number&#160;of&#160;consecutive&#160;hyphens for&#160;each word&#160;contained in&#160;<br/>
the&#160;current&#160;paragraph.<br/>
ParaHyphenationMaxLeadingChars&#160;<br/>
Specify&#160;the&#160;maximum&#160;number&#160;of&#160;characters to&#160;remain&#160;before&#160;a&#160;hyphen&#160;character.<br/>
ParaHyphenationMaxTrailingChars&#160;<br/>
Specify&#160;the&#160;maximum&#160;number&#160;of&#160;characters to&#160;remain&#160;after&#160;a&#160;hyphen character.<br/>
ParaVertAlignment&#160;<br/>
Specify&#160;the&#160;vertical&#160;alignment&#160;of&#160;the&#160;paragraph.&#160;This&#160;is a&#160;constant&#160;group&#160;of&#160;type&#160;<br/>
com.sun.star.text.ParagraphVertAlign with&#160;valid&#160;values:<br/>•<br/>
AUTOMATIC&#160;=&#160;0&#160;–&#160;In&#160;automatic&#160;mode, horizontal&#160;text&#160;is aligned&#160;to the&#160;<br/>
baseline.&#160;The&#160;same&#160;applies to text&#160;that&#160;is&#160;rotated 90 degrees.&#160;Text&#160;that&#160;is rotated&#160;<br/>270&#160;degrees&#160;is aligned&#160;to the&#160;center.<br/>
•<br/>
BASELINE&#160;=&#160;1&#160;–&#160;The&#160;text&#160;is&#160;aligned to&#160;the&#160;baseline.<br/>
369<br/>
<hr/>
<a name=373></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
•<br/>
TOP&#160;=&#160;2 –&#160;The&#160;text&#160;is aligned&#160;to the&#160;top.<br/>
•<br/>
CENTER&#160;=&#160;3 –&#160;The&#160;text&#160;is aligned&#160;to the&#160;center.<br/>
•<br/>
BOTTOM&#160;=&#160;4&#160;–&#160;The&#160;text&#160;is&#160;aligned&#160;to bottom.<br/>
ParaUserDefinedAttributes&#160;<br/>
Stores&#160;XML&#160;attributes that&#160;are&#160;saved and&#160;restored&#160;from&#160;the&#160;automatic&#160;styles inside&#160;<br/>XML&#160;files.&#160;The&#160;object&#160;implements the&#160;com.sun.star.container.XNameContainer&#160;<br/>
interface.<br/>
NumberingIsNumber&#160;<br/>
If&#160;True,&#160;the&#160;numbering&#160;of&#160;a&#160;paragraph is&#160;a&#160;number&#160;but&#160;has no symbol.&#160;This is&#160;void if&#160;<br/>
the&#160;paragraph is not&#160;part&#160;of&#160;a&#160;paragraph numbering&#160;sequence.<br/>
ParaIsConnectBorder&#160;<br/>
If&#160;True,&#160;paragraph borders are&#160;merged&#160;with&#160;the&#160;previous paragraph if&#160;the&#160;borders are<br/>
identical.&#160;This property&#160;may&#160;be&#160;void.<br/>
<b>TIP</b><br/>
Paragraph&#160;properties&#160;are&#160;usually&#160;set&#160;using&#160;paragraph styles—at&#160;least&#160;they&#160;should be.<br/>
Many&#160;of the&#160;properties&#160;i<a href="libremacros.html#370">n&#160;Table&#160;126&#160;a</a>re&#160;structures;&#160;they&#160;require&#160;special&#160;care&#160;if you want&#160;to modify&#160;them,&#160;<br/>because&#160;a&#160;structure&#160;is&#160;copied by&#160;value&#160;rather than by&#160;reference. For&#160;example, the&#160;ParaLineSpacing property&#160;<br/>is&#160;a&#160;structure.&#160;Although the&#160;code&#160;in<a href="libremacros.html#373">&#160;Listing 337&#160;l</a>ooks&#160;correct, it&#160;fails;&#160;this&#160;usage&#160;is&#160;a&#160;very&#160;common&#160;error&#160;<br/>committed by&#160;OOo Basic&#160;programmers.<br/>
<i><b>Listing&#160;337.&#160;</b>This&#160;code&#160;fails&#160;because&#160;ParaLineSpacing&#160;is&#160;a structure.</i><br/>
oPar.ParaLineSpacing.Mode&#160;=&#160;com.sun.star.style.LineSpacing.LEADING<br/>
The&#160;code&#160;in<a href="libremacros.html#373">&#160;Listing 337&#160;f</a>ails&#160;because&#160;the&#160;code&#160;“oPar.ParaLineSpacing”&#160;made&#160;a&#160;copy&#160;of the&#160;structure.&#160;The&#160;<br/>Mode&#160;is&#160;set,&#160;but&#160;it&#160;is&#160;set&#160;only&#160;on the&#160;copy,&#160;leaving&#160;the&#160;original&#160;intact.&#160;The&#160;code&#160;in<a href="libremacros.html#373">&#160;Listing 338<b>&#160;</b></a>demonstrates&#160;<br/>the&#160;proper way&#160;to modify&#160;the&#160;value&#160;of a&#160;structure&#160;when it&#160;is&#160;used as&#160;a&#160;property.&#160;A&#160;copy&#160;of the&#160;structure&#160;is&#160;<br/>stored in the&#160;variable&#160;v,&#160;which is&#160;then modified and copied back.<br/>
<i><b>Listing&#160;338.&#160;</b>This&#160;works&#160;because&#160;it&#160;makes&#160;a copy&#160;and then copies&#160;it&#160;back.</i><br/>
v&#160;=&#160;oPar.ParaLineSpacing<br/>v.Mode&#160;=&#160;com.sun.star.style.LineSpacing.LEADING<br/>oPar.ParaLineSpacing&#160;=&#160;v<br/>
<i><b>Insert&#160;a&#160;page&#160;break<br/></b></i>To&#160;insert&#160;a&#160;page&#160;break, set&#160;the&#160;PageDescName&#160;property&#160;to the&#160;name&#160;of the&#160;page&#160;style&#160;to use&#160;after the&#160;page&#160;<br/>break.&#160;This&#160;style&#160;may&#160;be&#160;the&#160;same&#160;as&#160;the&#160;current&#160;page&#160;style;&#160;it&#160;is&#160;the&#160;act&#160;of setting the&#160;PageDescName&#160;<br/>property—not&#160;changing&#160;it&#160;to&#160;a&#160;new&#160;value—that&#160;causes&#160;a&#160;page&#160;break to occur.&#160;The&#160;page&#160;style&#160;name&#160;must&#160;exist<br/>in the&#160;document&#160;or a&#160;page&#160;break is&#160;not&#160;inserted.&#160;When you insert&#160;a&#160;page&#160;break, you can also&#160;set&#160;a&#160;new&#160;page&#160;<br/>number by&#160;setting&#160;the&#160;PageNumberOffset&#160;property&#160;to&#160;the&#160;new&#160;page&#160;number.&#160;See<a href="libremacros.html#373">&#160;Listing&#160;339.</a><br/>
<b>TIP</b><br/>
It&#160;is&#160;rare&#160;to insert&#160;a&#160;page&#160;break while&#160;enumerating&#160;paragraphs.&#160;It&#160;is&#160;more&#160;common&#160;to&#160;insert&#160;a&#160;page&#160;break&#160;<br/>using&#160;a&#160;text&#160;cursor&#160;or&#160;a&#160;text&#160;range.&#160;You can&#160;use&#160;any&#160;service&#160;that&#160;supports paragraph properties to insert&#160;a&#160;<br/>
page&#160;break.<br/>
<i><b>Listing&#160;339.</b>&#160;Insert&#160;a page&#160;break&#160;after&#160;the&#160;last&#160;paragraph.</i><br/>
Sub&#160;SetPageBreakAtEndFromEnumeration<br/>&#160;&#160;Dim&#160;oEnum&#160; &#160;&#160;'com.sun.star.container.XEnumerationAccess<br/>&#160;&#160;Dim&#160;oParTest&#160;'Paragraph of some sort<br/>&#160;&#160;Dim&#160;oPar&#160; &#160; &#160;'Last Paragraph object<br/>
370<br/>
<hr/>
<a name=374></a>&#160;&#160;REM Find the last paragraph &#160;<br/>&#160;&#160;oEnum&#160;=&#160;ThisComponent.Text.createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements()<br/>&#160; &#160;&#160;oParTest&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160;&#160;If&#160;oParTest.supportsService(&#34;com.sun.star.text.Paragraph&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;oPar&#160;=&#160;oParTest<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Loop<br/>&#160;&#160;<br/>&#160;&#160;REM Note that this does not actually change the page style name<br/>&#160;&#160;oPar.PageDescName&#160;=&#160;oPar.PageStyleName<br/>&#160;&#160;<br/>&#160;&#160;REM Set the new page number to be 7<br/>&#160;&#160;oPar.PageNumberOffset&#160;=&#160;7<br/>End&#160;Sub<br/>
<i><b>Set&#160;the&#160;paragraph&#160;style<br/></b></i>The&#160;ParaStyleName&#160;property&#160;indicates&#160;the&#160;paragraph style&#160;for that&#160;paragraph.&#160;This&#160;property&#160;may&#160;be&#160;directly&#160;<br/>set.<br/>
<i><b>Listing&#160;340.</b>&#160;Enumerate&#160;the&#160;paragraph styles&#160;in the&#160;current&#160;document.<br/></i>Sub&#160;EnumerateParStyles()<br/>&#160;&#160;Dim&#160;oEnum&#160; &#160;&#160;'com.sun.star.container.XEnumerationAccess<br/>&#160;&#160;Dim&#160;oCurPar&#160;&#160;'Last Paragraph object.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160;'General string variable.<br/>
&#160;&#160;oEnum&#160;=&#160;ThisComponent.Text.createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements()<br/>&#160; &#160;&#160;oCurPar&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oCurPar.ParaStyleName&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Loop<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<b>&#160;14.2.2.&#160;Character&#160;properties<br/></b>Paragraphs&#160;contain&#160;numerous&#160;character-related properties. Like&#160;the&#160;paragraph-specific&#160;properties, these&#160;<br/>properties&#160;are&#160;optional&#160;and are&#160;encapsulated in&#160;services.&#160;The&#160;properties&#160;that&#160;are&#160;primarily&#160;related&#160;to&#160;<br/>characters&#160;are&#160;found in&#160;the&#160;CharacterProperties&#160;service&#160;(see<a href="libremacros.html#374">&#160;<b>Table&#160;127</b>)</a>.<br/>
<b>TIP</b><br/>
Many&#160;of&#160;the&#160;properties are&#160;represented by&#160;a&#160;value&#160;in&#160;a&#160;constant&#160;group.&#160;Constant&#160;groups associate&#160;<br/>meaningful&#160;names to constant&#160;values. For&#160;example,&#160;the&#160;CharFontFamily&#160;accepts the&#160;value&#160;<br/>
com.sun.star.awt.FontFamily.ROMAN&#160;to specify&#160;a&#160;Roman font&#160;with serifs.&#160;A&#160;value&#160;of&#160;3&#160;may&#160;also&#160;be&#160;used.&#160;<br/>In&#160;almost&#160;all&#160;cases, the&#160;first&#160;value&#160;is&#160;0, the&#160;second value&#160;is&#160;1,&#160;and so on. Code&#160;that&#160;uses the&#160;descriptive&#160;<br/>
names is easier&#160;to read and&#160;understand.<br/>
<i><b>Table&#160;127.&#160;</b>Properties&#160;supported by&#160;the&#160;com.sun.style.CharacterProperties&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
CharFontName&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;font&#160;in&#160;western&#160;text.&#160;This may&#160;be&#160;a&#160;comma-separated&#160;list&#160;of&#160;<br/>names.<br/>
CharFontStyleName&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;font&#160;style.<br/>
371<br/>
<hr/>
<a name=375></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
CharFontFamily&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;font&#160;family&#160;as specified in&#160;com.sun.star.awt.FontFamily&#160;<br/>
constant&#160;group.<br/>•<br/>
DONTKNOW&#160;=&#160;0&#160;–&#160;The&#160;font&#160;family&#160;is not&#160;known.<br/>
•<br/>
DECORATIVE&#160;=&#160;1 –&#160;The&#160;font&#160;family&#160;uses decorative&#160;fonts.<br/>
•<br/>
MODERN&#160;=&#160;2 –&#160;The&#160;font&#160;family&#160;is&#160;a&#160;modern font;&#160;this is&#160;a&#160;specific&#160;style.<br/>
•<br/>
ROMAN&#160;=&#160;3&#160;–&#160;The&#160;font&#160;family&#160;is a&#160;Roman&#160;font&#160;with&#160;serifs.<br/>
•<br/>
SCRIPT&#160;=&#160;4 –&#160;The&#160;font&#160;family&#160;is&#160;a&#160;script&#160;font.<br/>
•<br/>
SWISS&#160;=&#160;5 –&#160;The&#160;font&#160;family&#160;is&#160;a&#160;Roman font&#160;without&#160;serifs.<br/>
•<br/>
SYSTEM&#160;=&#160;6&#160;–&#160;The&#160;font&#160;family&#160;is a&#160;system&#160;font.<br/>
CharFontCharSet&#160;<br/>
Specify&#160;the&#160;text&#160;encoding&#160;of&#160;the&#160;font&#160;using&#160;the&#160;com.sun.star.awt.CharSet&#160;constant&#160;<br/>group.&#160;The&#160;values&#160;are&#160;self-explanatory:&#160;DONTKNOW,&#160;ANSI,&#160;MAC, IBMPC_437&#160;<br/>
(IBM&#160;PC&#160;character&#160;set&#160;number&#160;437),&#160;IBMPC_850,&#160;IBMPC_860,&#160;IBMPC_86,&#160;<br/>IBMPC_863, IBMPC_865, SYSTEM, and&#160;SYMBOL.<br/>
CharFontPitch&#160;<br/>
Specify&#160;the&#160;character&#160;font&#160;pitch&#160;using&#160;the&#160;com.sun.star.awt.FontPitch constant&#160;<br/>group.&#160;The&#160;values&#160;are&#160;self-explanatory:&#160;DONTKNOW,&#160;FIXED,&#160;and&#160;VARIABLE.<br/>
CharColor&#160;<br/>
Specify&#160;the&#160;text&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
CharEscapement&#160;<br/>
Specify&#160;the&#160;Short&#160;Integer&#160;representing&#160;the&#160;percentage&#160;of&#160;raising&#160;or&#160;lowering&#160;for&#160;<br/>
superscript/subscript&#160;characters.&#160;Negative&#160;values lower&#160;the&#160;characters.<br/>
CharHeight&#160;<br/>
Specify&#160;the&#160;character&#160;height&#160;in points&#160;as&#160;a&#160;decimal&#160;number.<br/>
CharUnderline&#160;<br/>
Specify&#160;the&#160;character&#160;underline&#160;type&#160;using&#160;the&#160;com.sun.star.awt.FontUnderline&#160;<br/>constant&#160;group.<br/>•<br/>
NONE =&#160;0 –&#160;No&#160;underlining.<br/>
•<br/>
SINGLE&#160;=&#160;1 –&#160;Single&#160;line.<br/>
•<br/>
DOUBLE&#160;=&#160;2&#160;– Double&#160;line.<br/>
•<br/>
DOTTED&#160;=&#160;3 –&#160;Dotted line.<br/>
•<br/>
DONTKNOW&#160;=&#160;4&#160;–&#160;Unknown&#160;underlining.<br/>
•<br/>
DASH&#160;=&#160;5 –&#160;Dashed&#160;line.<br/>
•<br/>
LONGDASH&#160;=&#160;6 –&#160;Long dashes.<br/>
•<br/>
DASHDOT&#160;=&#160;7 –&#160;Dash and dot&#160;sequence.<br/>
•<br/>
DASHDOTDOT&#160;=&#160;8&#160;– Dash,&#160;dot, dot&#160;sequence.<br/>
•<br/>
SMALLWAVE =&#160;9 –&#160;Small&#160;wave.<br/>
•<br/>
WAVE&#160;=&#160;10&#160;–&#160;Wave.<br/>
•<br/>
DOUBLEWAVE =&#160;11&#160;– Double&#160;wave.<br/>
•<br/>
BOLD&#160;=&#160;12&#160;– Bold&#160;line.<br/>
•<br/>
BOLDDOTTED&#160;=&#160;13&#160;– Bold&#160;dots.<br/>
•<br/>
BOLDDASH&#160;=&#160;14&#160;– Bold&#160;dashes.<br/>
•<br/>
BOLDLONGDASH&#160;=&#160;15&#160;– Long&#160;bold dashes.<br/>
•<br/>
BOLDDASHDOT&#160;=&#160;16&#160;– Dash&#160;and&#160;dot&#160;sequence&#160;in&#160;bold.<br/>
•<br/>
BOLDDASHDOTDOT&#160;=&#160;17&#160;–&#160;Dash, dot,&#160;dot&#160;sequence&#160;in&#160;bold.<br/>
•<br/>
BOLDWAVE&#160;=&#160;18 –&#160;Bold&#160;wave.<br/>
CharWeight&#160;<br/>
Specify&#160;the&#160;font&#160;weight&#160;using&#160;the&#160;com.sun.star.awt.FontWeight&#160;constant&#160;group.<br/>•<br/>
DONTKNOW&#160;=&#160;0.000 –&#160;Not&#160;specified/unknown.<br/>
•<br/>
THIN&#160;=&#160;50.00&#160;– 50%&#160;font&#160;weight.<br/>
•<br/>
ULTRALIGHT&#160;=&#160;60.00&#160;– 60%&#160;font&#160;weight.<br/>
372<br/>
<hr/>
<a name=376></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
•<br/>
LIGHT&#160;=&#160;75.00&#160;–&#160;75%&#160;font&#160;weight.<br/>
•<br/>
SEMILIGHT&#160;=&#160;90.00&#160;–&#160;90%&#160;font&#160;weight.<br/>
•<br/>
NORMAL&#160;=&#160;100.00&#160;– normal&#160;font&#160;weight&#160;(100%).<br/>
•<br/>
SEMIBOLD&#160;=&#160;110.00&#160;–&#160;110%&#160;font&#160;weight.<br/>
•<br/>
BOLD&#160;=&#160;150.00&#160;–&#160;150%&#160;font&#160;weight.<br/>
•<br/>
ULTRABOLD&#160;=&#160;175.00&#160;– 175%&#160;font&#160;weight.<br/>
•<br/>
BLACK&#160;=&#160;200.00&#160;–&#160;200%&#160;font&#160;weight.<br/>
CharPosture&#160;<br/>
Specify&#160;the&#160;character&#160;posture&#160;using&#160;the&#160;com.sun.star.awt.FontSlant&#160;enumeration&#160;<br/>with&#160;values:<br/>•<br/>
NONE –&#160;No slant, regular&#160;text.<br/>
•<br/>
OBLIQUE&#160;–&#160;Oblique&#160;font&#160;(slant&#160;not&#160;designed&#160;into the&#160;font).<br/>
•<br/>
ITALIC&#160;– Italic&#160;font&#160;(slant&#160;designed&#160;into the&#160;font).<br/>
•<br/>
DONTKNOW&#160;– Unknown&#160;slant.<br/>
•<br/>
REVERSE_OBLIQUE&#160;–&#160;Reverse&#160;oblique&#160;(slant&#160;not&#160;designed&#160;into the&#160;font).<br/>
•<br/>
REVERSE_ITALIC&#160;–&#160;Reverse&#160;italic&#160;font&#160;(slant&#160;designed&#160;into&#160;the&#160;font).<br/>
CharAutoKerning&#160;<br/>
Set&#160;to&#160;True&#160;to use&#160;the&#160;kerning&#160;tables for&#160;the&#160;current&#160;font.&#160;Automatic&#160;kerning&#160;adjusts&#160;<br/>the&#160;spacing&#160;between&#160;certain pairs&#160;of&#160;characters to improve&#160;readability.<br/>
CharBackColor&#160;<br/>
Specify&#160;the&#160;text&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
CharBackTransparent&#160;<br/>
If&#160;True, the&#160;text&#160;background color&#160;is&#160;transparent.<br/>
CharCaseMap&#160;<br/>
Specify&#160;how&#160;characters should be&#160;displayed&#160;using&#160;the&#160; com.sun.star.style.CaseMap&#160;<br/>constant&#160;group.&#160;This does not&#160;change&#160;the&#160;actual&#160;text—only&#160;the&#160;way&#160;it&#160;is&#160;displayed.<br/>•<br/>
NONE =&#160;0 –&#160;No&#160;case&#160;mapping&#160;is&#160;performed;&#160;this&#160;is the&#160;most&#160;commonly&#160;used&#160;<br/>value.<br/>
•<br/>
UPPERCASE =&#160;1 –&#160;All&#160;characters&#160;are&#160;displayed&#160;in uppercase.<br/>
•<br/>
LOWERCASE =&#160;2 –&#160;All&#160;characters&#160;are&#160;displayed&#160;in lowercase.<br/>
•<br/>
TITLE&#160;=&#160;3&#160;–&#160;The&#160;first&#160;character&#160;of&#160;each word&#160;is displayed&#160;in uppercase.<br/>
•<br/>
SMALLCAPS&#160;=&#160;4 –&#160;All&#160;characters&#160;are&#160;displayed&#160;in uppercase,&#160;but&#160;with&#160;a&#160;<br/>
smaller&#160;font.<br/>
CharCrossedOut&#160;<br/>
If&#160;True, the&#160;characters have&#160;a&#160;line&#160;through them.<br/>
CharFlash&#160;<br/>
If&#160;True, the&#160;characters are&#160;displayed&#160;flashing.<br/>
CharStrikeout&#160;<br/>
Specify&#160;character&#160;strikeout&#160;using&#160;the&#160;com.sun.star.awt.FontStrikeout&#160;constant&#160;group:<br/>•<br/>
NONE =&#160;0 &#160;– Do&#160;not&#160;strike&#160;out&#160;characters.<br/>
•<br/>
SINGLE&#160;=&#160;1 –&#160;Strike&#160;out&#160;the&#160;characters with a&#160;single&#160;line.<br/>
•<br/>
DOUBLE&#160;=&#160;2&#160;– Strike&#160;out&#160;the&#160;characters with&#160;a&#160;double&#160;line.<br/>
•<br/>
DONTKNOW&#160;=&#160;3&#160;–&#160;The&#160;strikeout&#160;mode&#160;is not&#160;specified.<br/>
•<br/>
BOLD&#160;=&#160;4 –&#160;Strike&#160;out&#160;the&#160;characters with&#160;a&#160;bold&#160;line.<br/>
•<br/>
SLASH&#160;=&#160;5 –&#160;Strike&#160;out&#160;the&#160;characters with&#160;slashes.<br/>
•<br/>
X&#160;=&#160;6 –&#160;Strike&#160;out&#160;the&#160;characters with X's.<br/>
CharWordMode&#160;<br/>
If&#160;True, white&#160;spaces&#160;(spaces and&#160;tabs)&#160;ignore&#160;the&#160;CharStrikeout&#160;and&#160;CharUnderline<br/>
properties.<br/>
CharKerning&#160;<br/>
Specify&#160;the&#160;character&#160;kerning&#160;value&#160;as a&#160;Short&#160;Integer.<br/>
CharLocale&#160;<br/>
Specify&#160;the&#160;character&#160;locale&#160;as a&#160;com.star.lang.Locale&#160;structure.<br/>
CharKeepTogether&#160;<br/>
If&#160;True, OOo&#160;tries to keep&#160;the&#160;character&#160;range&#160;on the&#160;same&#160;line.&#160;If&#160;a&#160;break&#160;must&#160;<br/>
373<br/>
<hr/>
<a name=377></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
occur,&#160;it&#160;occurs before&#160;the&#160;characters.<br/>
CharNoLineBreak&#160;<br/>
If&#160;True, OOo&#160;ignores a&#160;line&#160;break in the&#160;character&#160;range.&#160;If&#160;a&#160;break&#160;must&#160;occur, it&#160;<br/>occurs after&#160;the&#160;characters so it&#160;is possible&#160;that&#160;they&#160;will&#160;cross a&#160;border.<br/>
CharShadowed&#160;<br/>
If&#160;True, the&#160;characters are&#160;formatted&#160;and&#160;displayed&#160;with a&#160;shadow&#160;effect.<br/>
CharFontType&#160;<br/>
Specify&#160;the&#160;fundamental&#160;technology&#160;of&#160;the&#160;font&#160;using&#160;the&#160;com.sun.star.awt.FontType<br/>
constant&#160;group.<br/>•<br/>
DONTKNOW&#160;=&#160;0&#160;–&#160;The&#160;type&#160;of&#160;the&#160;font&#160;is&#160;not&#160;known.<br/>
•<br/>
RASTER&#160;=&#160;1&#160;–&#160;The&#160;font&#160;is a&#160;raster&#160;(bitmapped)&#160;font.<br/>
•<br/>
DEVICE&#160;=&#160;2 –&#160;The&#160;font&#160;is&#160;output-device&#160;specific,&#160;such as a&#160;printer&#160;font.<br/>
•<br/>
SCALABLE&#160;=&#160;3 –&#160;The&#160;font&#160;is scalable.<br/>
CharStyleName&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;font&#160;style&#160;as a&#160;string.<br/>
CharContoured&#160;<br/>
If&#160;True, characters are&#160;formatted and displayed&#160;with&#160;a&#160;contour&#160;(3-D&#160;outline)&#160;effect.<br/>
CharCombineIsOn<br/>
If&#160;True, text&#160;is&#160;formatted and displayed&#160;using&#160;two lines.&#160;The&#160;CharCombinePrefix&#160;<br/>
string&#160;precedes&#160;the&#160;text&#160;in full&#160;size, and the&#160;CharCombineSuffix follows the&#160;text&#160;in&#160;<br/>full&#160;size.<br/>
CharCombinePrefix&#160;<br/>
Specify&#160;the&#160;prefix (usually&#160;parentheses)&#160;used&#160;with&#160;the&#160;CharCombineIsOn property.<br/>
CharCombineSuffix&#160;<br/>
Specify&#160;the&#160;suffix (usually&#160;parentheses)&#160;used with&#160;the&#160;CharCombineIsOn property.<br/>
CharEmphasize&#160;<br/>
Specify&#160;the&#160;type&#160;and&#160;position of&#160;emphasis marks in&#160;Asian texts&#160;using&#160;the&#160;<br/>com.sun.star.text.FontEmphasis&#160;constant&#160;group:<br/>•<br/>
NONE =&#160;0 –&#160;No&#160;emphasis mark is&#160;used.<br/>
•<br/>
DOT_ABOVE&#160;=&#160;1 –&#160;A&#160;dot&#160;is&#160;set&#160;above&#160;(or&#160;right&#160;from&#160;vertical&#160;text)&#160;the&#160;text.<br/>
•<br/>
CIRCLE_ABOVE =&#160;2&#160;–&#160;A&#160;circle&#160;is&#160;set&#160;above&#160;(or&#160;right&#160;from&#160;vertical&#160;text)&#160;the&#160;<br/>text.<br/>
•<br/>
DISK_ABOVE =&#160;3&#160;–&#160;A&#160;disk is set&#160;above&#160;(or&#160;right&#160;from&#160;vertical&#160;text)&#160;the&#160;text.<br/>
•<br/>
ACCENT_ABOVE&#160;=&#160;4 –&#160;An&#160;accent&#160;is&#160;set&#160;above&#160;(or&#160;right&#160;from&#160;vertical&#160;text)&#160;the&#160;<br/>
text.<br/>
•<br/>
DOT_BELOW&#160;=&#160;11&#160;–&#160;A&#160;dot&#160;is&#160;set&#160;below&#160;(or&#160;left&#160;from&#160;vertical&#160;text)&#160;the&#160;text.<br/>
•<br/>
CIRCLE_BELOW&#160;=&#160;12&#160;–&#160;A&#160;circle&#160;is&#160;set&#160;below&#160;(or&#160;left&#160;from&#160;vertical&#160;text)&#160;the&#160;<br/>text.<br/>
•<br/>
DISK_BELOW&#160;=&#160;13&#160;–&#160;A&#160;disk is set&#160;below&#160;(or&#160;left&#160;from&#160;vertical&#160;text)&#160;the&#160;text.<br/>
•<br/>
ACCENT_BELOW&#160;=&#160;14&#160;–&#160;An&#160;accent&#160;is&#160;set&#160;below&#160;(or&#160;left&#160;from&#160;vertical&#160;text)&#160;the<br/>
text.<br/>
CharRelief&#160;<br/>
Specify&#160;the&#160;relief&#160;value&#160;from&#160;the&#160;com.sun.star.text.FontRelief&#160;constant&#160;group:<br/>•<br/>
NONE =&#160;0 –&#160;No&#160;relief&#160;is used;&#160;normal&#160;text.<br/>
•<br/>
EMBOSSED&#160;=&#160;1&#160;–&#160;Characters look&#160;embossed&#160;(raised).<br/>
•<br/>
ENGRAVED&#160;=&#160;2&#160;–&#160;Characters look&#160;engraved&#160;(lowered).<br/>
RubyText&#160;<br/>
Specify&#160;the&#160;text&#160;that&#160;is&#160;set&#160;as ruby.&#160;“Ruby&#160;Text”&#160;acts as an annotation and is&#160;<br/>
associated&#160;with a&#160;“Ruby&#160;Base.”&#160;This is&#160;typically&#160;used&#160;in&#160;Asian writing&#160;systems,&#160;<br/>providing&#160;a&#160;helper&#160;for&#160;uncommonly&#160;used writing&#160;characters&#160;that&#160;are&#160;not&#160;easily&#160;<br/>
recognizable,&#160;especially&#160;by&#160;children. For&#160;example, in&#160;Japanese&#160;writing, the&#160;phonetic<br/>Hiragana&#160;alphabet&#160;is used&#160;to pair&#160;phonetic&#160;“helper”&#160;readings (called&#160;Furigana&#160;or&#160;<br/>
Yomigana&#160;in&#160;Japanese)&#160;with the&#160;Chinese&#160;character&#160;counterpart.<br/>
RubyAdjust&#160;<br/>
Specify&#160;the&#160;ruby&#160;text&#160;adjustment&#160;using&#160;the&#160;com.sun.star.text.RubyAdjust&#160;<br/>
enumeration:<br/>•<br/>
LEFT&#160;–&#160;Adjust&#160;to the&#160;left.<br/>
374<br/>
<hr/>
<a name=378></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
•<br/>
CENTER&#160;–&#160;Adjust&#160;to the&#160;center.<br/>
•<br/>
RIGHT&#160;–&#160;Adjust&#160;to&#160;the&#160;right.<br/>
•<br/>
BLOCK&#160;–&#160;Adjust&#160;to both borders (stretched).<br/>
•<br/>
INDENT_BLOCK&#160;–&#160;Adjust&#160;to both&#160;borders with a&#160;small&#160;indent&#160;on both sides.<br/>
RubyCharStyleName&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;character&#160;style&#160;that&#160;is applied to&#160;RubyText.<br/>
RubyIsAbove&#160;<br/>
If&#160;True, the&#160;Ruby&#160;is printed above&#160;the&#160;text&#160;(right&#160;if&#160;the&#160;text&#160;is&#160;vertical).<br/>
CharRotation&#160;<br/>
Specify&#160;the&#160;rotation of&#160;a&#160;character&#160;in degrees as a&#160;Short&#160;Integer.&#160;Not&#160;all&#160;<br/>
implementations support&#160;all&#160;values.<br/>
CharRotationIsFitToLine&#160;<br/>
If&#160;True, OOo&#160;tries to fit&#160;the&#160;rotated&#160;text&#160;to the&#160;surrounding&#160;line&#160;height.<br/>
CharScaleWidth&#160;<br/>
Specify&#160;the&#160;scaling&#160;for&#160;superscript&#160;and subscript&#160;as a&#160;percentage&#160;using&#160;a&#160;Short&#160;<br/>Integer.<br/>
HyperLinkURL&#160;<br/>
Specify&#160;the&#160;URL&#160;of&#160;a&#160;hyperlink&#160;(if&#160;set)&#160;as&#160;a&#160;String.<br/>
HyperLinkTarget&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;target&#160;for&#160;a&#160;hyperlink&#160;(if&#160;set)&#160;as&#160;a&#160;String.<br/>
HyperLinkName&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;hyperlink (if&#160;set)&#160;as a&#160;String.<br/>
VisitedCharStyleName&#160;<br/>
Specify&#160;the&#160;character&#160;style&#160;for&#160;visited&#160;hyperlinks&#160;as a&#160;String.<br/>
UnvisitedCharStyleName&#160;<br/>
Specify&#160;the&#160;character&#160;style&#160;name&#160;for&#160;unvisited&#160;hyperlinks&#160;as&#160;a&#160;String.<br/>
CharEscapementHeight&#160;<br/>
Specify&#160;the&#160;additional&#160;height&#160;used&#160;for&#160;subscript&#160;or&#160;superscript&#160;characters as an&#160;<br/>
Integer&#160;percent.&#160;For&#160;subscript&#160;characters the&#160;value&#160;is&#160;negative.<br/>
CharNoHyphenation&#160;<br/>
If&#160;True, the&#160;word&#160;cannot&#160;be&#160;hyphenated&#160;at&#160;the&#160;character.<br/>
CharUnderlineColor&#160;<br/>
Specify&#160;the&#160;color&#160;of&#160;the&#160;underline&#160;as a&#160;Long&#160;Integer.<br/>
CharUnderlineHasColor&#160;<br/>
If&#160;True, the&#160;CharUnderlineColor&#160;is used for&#160;an underline.<br/>
CharStyleNames&#160;<br/>
An&#160;array&#160;of&#160;character&#160;style&#160;names applied&#160;to the&#160;text.&#160;The&#160;order&#160;is not&#160;necessarily&#160;<br/>relevant.&#160;<br/>
<b>TIP</b><br/>
When&#160;a&#160;property&#160;supports a&#160;DONTKNOW&#160;value, the&#160;property&#160;is&#160;usually&#160;used&#160;as&#160;a&#160;hint&#160;to perform&#160;certain&#160;<br/>
operations more&#160;efficiently&#160;or&#160;to find a&#160;close&#160;replacement&#160;value&#160;if&#160;the&#160;requested&#160;value&#160;is not&#160;available.&#160;For&#160;<br/>example,&#160;if&#160;a&#160;particular&#160;font&#160;is not&#160;available,&#160;you&#160;can use&#160;the&#160;CharFontFamily&#160;to choose&#160;a&#160;font&#160;of&#160;the&#160;<br/>
correct&#160;type.<br/>
The&#160;code&#160;in<a href="libremacros.html#378">&#160;Listing 341&#160;de</a>monstrates&#160;modifying the&#160;character properties&#160;by&#160;modifying the&#160;FontRelief&#160;<br/>property&#160;and then changing it&#160;back.<br/>
<i><b>Listing&#160;341.</b>&#160;Set&#160;then&#160;restore&#160;the&#160;font&#160;relief.</i><br/>
Sub&#160;ViewFontRelief<br/>&#160;&#160;Dim&#160;oEnum&#160;'com.sun.star.container.XEnumerationAccess<br/>&#160;&#160;Dim&#160;oPar&#160;&#160;'Paragraph of some sort<br/>&#160;&#160;Dim&#160;i%&#160; &#160;&#160;'General Counting variable<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;<br/>&#160;&#160;oEnum&#160;=&#160;ThisComponent.Text.createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements()<br/>&#160; &#160;&#160;oPar&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160;&#160;<br/>
375<br/>
<hr/>
<a name=379></a>&#160; &#160;&#160;REM The returned paragraph will be a paragraph or a text table<br/>&#160; &#160;&#160;If&#160;oPar.supportsService(&#34;com.sun.star.text.Paragraph&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;i&#160;=&#160;i&#160;+&#160;1<br/>&#160; &#160; &#160;&#160;oPar.CharRelief&#160;=&#160;i&#160;MOD&#160;3<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Loop<br/>&#160;&#160;<br/>&#160;&#160;MsgBox&#160;&#34;The document now uses NONE, EMBOSSED, and ENGRAVED character relief&#34;<br/>&#160;&#160;<br/>&#160;&#160;oEnum&#160;=&#160;ThisComponent.Text.createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements()<br/>&#160; &#160;&#160;oPar&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM The returned paragraph will be a paragraph or a text table<br/>&#160; &#160;&#160;If&#160;oPar.supportsService(&#34;com.sun.star.text.Paragraph&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;i&#160;=&#160;i&#160;+&#160;1<br/>&#160; &#160; &#160;&#160;oPar.CharRelief&#160;=&#160;&#160;com.sun.star.text.FontRelief.NONE<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Loop<br/>End&#160;Sub<br/>
<b>&#160;14.2.3.&#160;Enumerating&#160;text&#160;sections&#160;(paragraph&#160;portions)<br/></b>It&#160;is&#160;not&#160;unusual&#160;for a&#160;paragraph to&#160;contain&#160;text&#160;with dissimilar formatting—for example,&#160;a&#160; single&#160;word may<br/>be&#160;displayed in&#160;<b>bold</b>&#160;in&#160;the&#160;middle&#160;of a&#160;sentence&#160;that&#160;is&#160;displayed in&#160;the&#160;font’s&#160;normal&#160;state. Just&#160;as&#160;you&#160;can&#160;<br/>enumerate&#160;the&#160;paragraphs&#160;in&#160;a&#160;document,&#160;you&#160;can enumerate&#160;the&#160;text&#160;sections&#160;in a&#160;paragraph.&#160;Text&#160;within&#160;<br/>each enumerated portion&#160;uses&#160;the&#160;same&#160;properties&#160;and is&#160;of the&#160;same&#160;type<a href="libremacros.html#380">.&#160;Table&#160;128&#160;l</a>ists&#160;the&#160;properties&#160;<br/>directly&#160;supported by&#160;the&#160;TextPortion&#160;service.&#160;The&#160;TextPortion service&#160;exports&#160;the&#160;TextRange&#160;service&#160;so it&#160;<br/>also supports&#160;the&#160;paragraph properties&#160;in<a href="libremacros.html#370">&#160;Table&#160;126&#160;a</a>nd the&#160;character properties&#160;i<a href="libremacros.html#374">n&#160;Table&#160;127.</a><br/>
<b>TIP</b><br/>
An&#160;object&#160;that&#160;supports paragraph&#160;or&#160;character&#160;properties typically&#160;provides a&#160;way&#160;to enclose&#160;a&#160;range&#160;of&#160;<br/>text. If&#160;a&#160;specific&#160;property&#160;changes&#160;value&#160;in&#160;the&#160;text&#160;range,&#160;it&#160;usually&#160;isn’t&#160;available&#160;to&#160;be&#160;set. For&#160;example,&#160;a<br/>
text&#160;range&#160;can contain more&#160;than one&#160;paragraph. If&#160;all&#160;of&#160;the&#160;contained&#160;paragraphs in&#160;the&#160;text&#160;range&#160;do&#160;not&#160;<br/>support&#160;the&#160;same&#160;paragraph style,&#160;the&#160;paragraph style&#160;property&#160;is not&#160;available&#160;to&#160;the&#160;text&#160;range.&#160;If,&#160;<br/>
however,&#160;the&#160;text&#160;range&#160;is reduced&#160;to contain only&#160;paragraphs&#160;that&#160;support&#160;a&#160;single&#160;paragraph style,&#160;the&#160;<br/>paragraph&#160;style&#160;property&#160;will&#160;be&#160;available&#160;to that&#160;text&#160;range.<br/>
376<br/>
<hr/>
<a name=380></a><i><b>Table&#160;128.&#160;</b>Properties&#160;supported by&#160;the&#160;com.sun.text.TextPortion service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
TextPortionType&#160;<br/>
String&#160;containing&#160;the&#160;type&#160;of&#160;the&#160;text&#160;portion.&#160;Valid&#160;content&#160;type&#160;names&#160;are:<br/>•<br/>
Text&#160;–&#160;String&#160;content.<br/>
•<br/>
TextField&#160;–&#160;TextField&#160;content.<br/>
•<br/>
TextContent&#160;– Indicates&#160;that&#160;text&#160;content&#160;is anchored&#160;as or&#160;to a&#160;character&#160;that&#160;is&#160;not&#160;really&#160;<br/>part&#160;of&#160;the&#160;paragraph—for&#160;example, a&#160;text&#160;frame&#160;or&#160;a&#160;graphic&#160;object.&#160;As&#160;of&#160;OOo 1.1.0 and&#160;<br/>
OOo 1.1.1, the&#160;type&#160;“Frame”&#160;is&#160;returned&#160;rather&#160;than “TextContent”.&#160;The&#160;OOo&#160;team&#160;refers to<br/>this as issue&#160;#24444.<br/>
•<br/>
Frame&#160;–&#160;This is&#160;not&#160;a&#160;documented&#160;return value,&#160;but&#160;it&#160;is&#160;returned&#160;rather&#160;than the&#160;type&#160;<br/>“TextContent”.<br/>
•<br/>
Footnote&#160;–&#160;Footnote&#160;or&#160;endnote.<br/>
•<br/>
ControlCharacter&#160;–&#160;Control&#160;character.<br/>
•<br/>
ReferenceMark –&#160;Reference&#160;mark.<br/>
•<br/>
DocumentIndexMark&#160;– Document&#160;index&#160;mark.<br/>
•<br/>
Bookmark –&#160;Bookmark.<br/>
•<br/>
Redline&#160;– Redline&#160;portion,&#160;which is a&#160;result&#160;of&#160;the&#160;change-tracking&#160;feature.<br/>
•<br/>
Ruby&#160;– Ruby&#160;attribute&#160;(used&#160;in&#160;Asian text).<br/>
ControlCharacter&#160;<br/>
Short&#160;Integer&#160;containing&#160;the&#160;control&#160;character&#160;if&#160;the&#160;text&#160;portion&#160;contains a&#160;ControlCharacter.<br/>
Bookmark&#160;<br/>
If&#160;the&#160;text&#160;content&#160;is a&#160;bookmark, this&#160;is&#160;a&#160;reference&#160;to the&#160;bookmark.&#160;The&#160;property&#160;implements&#160;<br/>the&#160;com.sun.star.text.XTextContent&#160;interface.<br/>
IsCollapsed&#160;<br/>
If&#160;True, the&#160;text&#160;portion is&#160;a&#160;point.<br/>
IsStart&#160;<br/>
If&#160;True, the&#160;text&#160;portion is&#160;a&#160;start&#160;portion if&#160;two portions are&#160;needed&#160;to include&#160;an object.&#160;<br/>
For&#160;example,&#160;a&#160;DocmentIndexMark has a&#160;start&#160;and&#160;end text&#160;portion&#160;surrounding&#160;the&#160;text&#160;<br/>to be&#160;indexed.<br/>
The&#160;macro i<a href="libremacros.html#380">n&#160;Listing&#160;342&#160;de</a>monstrates&#160;enumerating the&#160;text&#160;content&#160;inside&#160;a&#160;paragraph. It&#160;displays&#160;the&#160;<br/>paragraph number and the&#160;included text&#160;portion types&#160;in a&#160;dialog.&#160;The&#160;paragraph number is&#160;calculated and is&#160;<br/>not&#160;a&#160;property&#160;of the&#160;paragraph.<br/>
<i><b>Listing&#160;342.</b>&#160;See&#160;text&#160;portion types.<br/></i>Sub&#160;EnumerateTextSections<br/>&#160;&#160;Dim&#160;oParEnum&#160; &#160; &#160; &#160; &#160; &#160;'Paragraph enumerator<br/>&#160;&#160;Dim&#160;osecEnum&#160; &#160; &#160; &#160; &#160; &#160;'Text section enumerator<br/>&#160;&#160;Dim&#160;oPar&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Current paragraph<br/>&#160;&#160;Dim&#160;oParSection&#160; &#160; &#160; &#160;&#160;'Current section<br/>&#160;&#160;Dim&#160;nPars&#160;As&#160;Integer&#160; &#160;'Number of paragraphs<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;<br/>&#160;&#160;oParEnum&#160;=&#160;ThisComponent.Text.createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oParEnum.hasMoreElements()<br/>&#160; &#160;&#160;oPar&#160;=&#160;oParEnum.nextElement()<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;If&#160;oPar.supportsService(&#34;com.sun.star.text.Paragraph&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;nPars&#160;=&#160;nPars&#160;+&#160;1<br/>&#160; &#160; &#160;&#160;oSecEnum&#160;=&#160;oPar.createEnumeration()<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;nPars&#160;&amp;&#160;&#34;:&#34;<br/>&#160; &#160; &#160;&#160;Do&#160;While&#160;oSecEnum.hasMoreElements()<br/>&#160; &#160; &#160; &#160;&#160;oParSection&#160;=&#160;oSecEnum.nextElement()<br/>
377<br/>
<hr/>
<a name=381></a>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oParSection.TextPortionType&#160;&amp;&#160;&#34;:&#34;<br/>&#160; &#160; &#160;&#160;Loop<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160;&#160;If&#160;nPars&#160;MOD&#160;10&#160;=&#160;0&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Paragraph Text Sections&#34;<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Loop<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Paragraph Text Sections&#34;<br/>End&#160;Sub<br/>
<i><b>&#160;14.3.&#160;Graphics<br/></b></i>The&#160;following&#160;macro inserts&#160;a&#160;text&#160;graphic&#160;object&#160;as&#160;a&#160;link in&#160;to&#160;the&#160;current&#160;document.&#160;This&#160;is&#160;a&#160;text&#160;graphics<br/>object,&#160;which is&#160;inserted at&#160;a&#160;cursor position.&#160;Although you&#160;must&#160;set&#160;the&#160;image&#160;size,&#160;you&#160;do not&#160;need to&#160;set&#160;<br/>the&#160;position.<br/>
<i><b>Listing&#160;343.</b>&#160;Insert&#160;a Graphics&#160;as&#160;a link&#160;at&#160;the&#160;start&#160;of&#160;the&#160;document.<br/></i>Sub&#160;InsertGraphicObject(oDoc,&#160;sURL$)<br/>&#160;&#160;Dim&#160;oCursor<br/>&#160;&#160;Dim&#160;oGraph<br/>&#160;&#160;Dim&#160;oText<br/>
&#160;&#160;oText&#160;=&#160;oDoc.getText()<br/>&#160;&#160;oCursor&#160;=&#160;oText.createTextCursor()<br/>&#160;&#160;oCursor.goToStart(FALSE)<br/>&#160;&#160;oGraph&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.GraphicObject&#34;)<br/>
&#160;&#160;With&#160;oGraph<br/>&#160; &#160;&#160;.GraphicURL&#160;=&#160;sURL<br/>&#160; &#160;&#160;.AnchorType&#160;=&#160;com.sun.star.text.TextContentAnchorType.AS_CHARACTER<br/>&#160; &#160;&#160;.Width&#160;=&#160;6000<br/>&#160; &#160;&#160;.Height&#160;=&#160;8000<br/>&#160;&#160;End&#160;With<br/>
&#160;&#160;'now insert the image into the text document<br/>&#160;&#160;oText.insertTextContent(&#160;oCursor,&#160;oGraph,&#160;False&#160;)<br/>End&#160;Sub<br/>
You can also insert&#160;a&#160;graphics&#160;object&#160;shape, which&#160;is&#160;inserted into the&#160;draw&#160;page&#160;rather than&#160;at&#160;a&#160;cursor&#160;<br/>location, but&#160;you&#160;must&#160;use&#160;a&#160;com.sun.star.drawing.GraphicObjectShape, and then set&#160;both&#160;the&#160;location&#160;and&#160;<br/>the&#160;size.<br/>
Sometimes,&#160;you&#160;must&#160;guess&#160;the&#160;image&#160;size&#160;because&#160;it&#160;is&#160;not&#160;available.&#160;The&#160;following method&#160;assumes&#160;that&#160;<br/>the&#160;argument&#160;is&#160;a&#160;service&#160;of type&#160;com.sun.star.graphic.GraphicDescriptor,&#160;which&#160;optionally&#160;provides&#160;the&#160;<br/>image&#160;size&#160;in 100th&#160;mm&#160;and in pixels.&#160;The&#160;method&#160;returns&#160;a&#160;value&#160;in&#160;100th&#160;mm,&#160;which&#160;is&#160;what&#160;is&#160;required&#160;<br/>for the&#160;internal&#160;display.<br/>
Integers&#160;are&#160;not&#160;used because&#160;the&#160;intermediate&#160;values&#160;may&#160;be&#160;large.<br/>
If&#160;the&#160;size&#160;is&#160;available&#160;in 100th&#160;mm,&#160;then this&#160;is&#160;used. Next, the&#160;size&#160;is&#160;checked in Pixels.&#160;An image&#160;has&#160;both&#160;<br/>a&#160;size&#160;in pixels, and an expected pixel&#160;density&#160;(Dots&#160;Per Inch).&#160;We&#160;may&#160;have&#160;the&#160;number of pixels, but&#160;we&#160;do<br/>
378<br/>
<hr/>
<a name=382></a>not&#160;have&#160;the&#160;DPI.&#160;I&#160;guess&#160;the&#160;pixel&#160;density&#160;as&#160;the&#160;pixel&#160;density&#160;of the&#160;computer display.&#160;In&#160;other words, if the&#160;<br/>expected&#160;size&#160;is&#160;not&#160;available, then assume&#160;that&#160;this&#160;was&#160;created&#160;for display&#160;on the&#160;current&#160;monitor.<br/>
<i><b>Listing&#160;344.</b>&#160;Guess&#160;image&#160;size.<br/></i>Function&#160;RecommendGraphSize(oGraph)<br/>&#160;&#160;Dim&#160;oSize<br/>&#160;&#160;Dim&#160;lMaxW&#160;As&#160;Double&#160;&#160;' Maximum width in 100th mm<br/>&#160;&#160;Dim&#160;lMaxH&#160;As&#160;Double&#160;&#160;' Maximum height in 100th mm<br/>
&#160;&#160;lMaxW&#160;=&#160;6.75&#160;*&#160;2540&#160;' 6.75 inches<br/>&#160;&#160;lMaxH&#160;=&#160;9.5&#160;*&#160;2540&#160;&#160;' 9.5 inches<br/>&#160;&#160;<br/>&#160;&#160;If&#160;IsNull(oGraph)&#160;OR&#160;IsEmpty(oGraph)&#160;Then<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;oSize&#160;=&#160;oGraph.Size100thMM<br/>&#160;&#160;If&#160;oSize.Height&#160;=&#160;0&#160;OR&#160;oSize.Width&#160;=&#160;0&#160;Then<br/>&#160; &#160;&#160;' 2540 is 25.40 mm in an inch, but I need 100th mm.<br/>&#160; &#160;&#160;' There are 1440 twips in an inch<br/>&#160; &#160;&#160;oSize.Height&#160;=&#160;oGraph.SizePixel.Height&#160;*&#160;2540.0&#160;*&#160;TwipsPerPixelY()&#160;/&#160;1440<br/>&#160; &#160;&#160;oSize.Width&#160;=&#160;oGraph.SizePixel.Width&#160;*&#160;2540.0&#160;*&#160;TwipsPerPixelX()&#160;/&#160;1440<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;oSize.Height&#160;=&#160;0&#160;OR&#160;oSize.Width&#160;=&#160;0&#160;Then<br/>&#160; &#160;&#160;'oSize.Height = 2540<br/>&#160; &#160;&#160;'oSize.Width = 2540<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;oSize.Width&#160;&gt;&#160;lMaxW&#160;Then<br/>&#160; &#160;&#160;oSize.Height&#160;=&#160;oSize.Height&#160;*&#160;lMaxW&#160;/&#160;oSize.Width<br/>&#160; &#160;&#160;oSize.Width&#160;=&#160;lMaxW<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;oSize.Height&#160;&gt;&#160;lMaxH&#160;Then<br/>&#160; &#160;&#160;oSize.Width&#160;=&#160;oSize.Width&#160;*&#160;lMaxH&#160;/&#160;oSize.Height<br/>&#160; &#160;&#160;oSize.Height&#160;=&#160;lMaxH<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;RecommendGraphSize&#160;=&#160;oSize<br/>End&#160;Function<br/>
An image&#160;is&#160;embedded as&#160;follows:<br/>
1.&#160;A&#160;shape&#160;is&#160;created and added to the&#160;draw&#160;page.&#160;<br/>
2.&#160;The&#160;graphic&#160;provider service&#160;is&#160;used to&#160;obtain&#160;image&#160;descriptor from&#160;disk&#160;before&#160;it&#160;is&#160;loaded.<br/>
3.&#160;The&#160;image&#160;descriptor is&#160;used to&#160;guess&#160;the&#160;image&#160;size.&#160;The&#160;image&#160;size&#160;is&#160;guessed, because&#160;we&#160;only&#160;<br/>
know&#160;what&#160;is&#160;in&#160;the&#160;descriptor,&#160;and the&#160;descriptor may&#160;not&#160;really&#160;know.<br/>
4.&#160;The&#160;shape&#160;is&#160;set&#160;to image&#160;as&#160;provided&#160;by&#160;the&#160;graphic&#160;provider service.&#160;At&#160;this&#160;point,&#160;the&#160;image&#160;is&#160;<br/>
loaded and known by&#160;OOo.<br/>
5.&#160;A&#160;newly&#160;created&#160;graph object&#160;sets&#160;its&#160;URL&#160;to&#160;the&#160;URL&#160;used by&#160;the&#160;shape&#160;object.&#160;As&#160;such, the&#160;graphic&#160;<br/>
and the&#160;shape&#160;should&#160;reference&#160;the&#160;same&#160;image.<br/>
6.&#160;The&#160;graph is&#160;anchored as&#160;a&#160;character and then&#160;inserted into the&#160;document&#160;at&#160;the&#160;cursor.<br/>
379<br/>
<hr/>
<a name=383></a>7.&#160;The&#160;shape&#160;is&#160;no longer required, so it&#160;is&#160;removed.<br/>
For&#160;reasons&#160;I&#160;do not&#160;understand,&#160;all&#160;images&#160;inserted as&#160;a&#160;very&#160;small&#160;images&#160;(less&#160;than 1 cm). I&#160;use&#160;the&#160;<br/>guessed image&#160;size&#160;to set&#160;the&#160;graphic&#160;size.&#160;<br/>
<i><b>Listing&#160;345.</b>&#160;Embed an image&#160;in&#160;a document.<br/></i>' oDoc - document to contain the image.&#160;<br/>' oCurs - Cursor where the image is added<br/>' sURL - URL of the image to insert.<br/>' sParStyle - set the paragraph style to this.<br/>Sub&#160;EmbedGraphic(oDoc,&#160;oCurs,&#160;sURL$,&#160;sParStyle$)<br/>&#160;&#160;Dim&#160;oShape<br/>&#160;&#160;Dim&#160;oGraph&#160; &#160; &#160;'The graphic object is text content.<br/>&#160;&#160;Dim&#160;oProvider&#160;&#160;'GraphicProvider service.<br/>&#160;&#160;Dim&#160;oText<br/>
&#160;&#160;oShape&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.drawing.GraphicObjectShape&#34;)<br/>&#160;&#160;oGraph&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.GraphicObject&#34;)<br/>
&#160;&#160;oDoc.getDrawPage().add(oShape)<br/>
&#160;&#160;oProvider&#160;=&#160;createUnoService(&#34;com.sun.star.graphic.GraphicProvider&#34;)<br/>
&#160;&#160;Dim&#160;oProps(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;oProps(0).Name&#160;&#160;=&#160;&#34;URL&#34;<br/>&#160;&#160;oProps(0).Value&#160;=&#160;sURL<br/>
&#160;&#160;REM Save the original size.<br/>&#160;&#160;Dim&#160;oSize100thMM<br/>&#160;&#160;Dim&#160;lHeight&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;lWidth&#160;As&#160;Long<br/>&#160;&#160;oSize100thMM&#160;=&#160;RecommendGraphSize(oProvider.queryGraphicDescriptor(oProps))<br/>&#160;&#160;If&#160;NOT&#160;IsNull(oSize100thMM)&#160;AND&#160;NOT&#160;IsEmpty(oSize100thMM)&#160;Then<br/>&#160; &#160;&#160;lHeight&#160;=&#160;oSize100thMM.Height<br/>&#160; &#160;&#160;lWidth&#160;=&#160;oSize100thMM.Width<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;oShape.Graphic&#160;=&#160;oProvider.queryGraphic(oProps())<br/>&#160;&#160;oGraph.graphicurl&#160;=&#160;oShape.graphicurl<br/>&#160;&#160;oGraph.AnchorType&#160;=&#160;com.sun.star.text.TextContentAnchorType.AS_CHARACTER<br/>&#160;&#160;oText=&#160;oCurs.getText()<br/>&#160;&#160;oText.insertTextContent(oCurs,&#160;oGraph,&#160;false)<br/>&#160;&#160;oDoc.getDrawPage().remove(oShape)<br/>
&#160;&#160;If&#160;lHeight&#160;&gt;&#160;0&#160;AND&#160;lWidth&#160;&gt;&#160;0&#160;Then<br/>&#160; &#160;&#160;Dim&#160;oSize<br/>&#160; &#160;&#160;oSize&#160;=&#160;oGraph.Size<br/>&#160; &#160;&#160;oSize.Height&#160;=&#160;lHeight<br/>&#160; &#160;&#160;oSize.Width&#160;=&#160;lWidth<br/>&#160; &#160;&#160;oGraph.Size&#160;=&#160;oSize<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;' Set the paragraph style if it is in the document.<br/>
380<br/>
<hr/>
<a name=384></a>&#160;&#160;Dim&#160;oStyles<br/>&#160;&#160;oStyles&#160;=&#160;oDoc.StyleFamilies.getByName(&#34;ParagraphStyles&#34;)<br/>&#160;&#160;If&#160;oStyles.hasByName(sParStyle)&#160;Then<br/>&#160; &#160;&#160;oCurs.ParaStyleName&#160;=&#160;sParStyle<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
<i><b>&#160;14.4.&#160;Paste&#160;HTML&#160;then&#160;embed&#160;linked&#160;graphics<br/></b></i>After copying&#160;a&#160;web page&#160;and pasting it&#160;into&#160;a&#160;text&#160;document, all&#160;of the&#160;images&#160;are&#160;embedded. Graphics&#160;in&#160;a&#160;<br/>document&#160;contain the&#160;GraphicURL&#160;property.&#160;The&#160;URL&#160;for a&#160;graphic&#160;contained in&#160;the&#160;document&#160;begins&#160;with&#160;<br/>the&#160;“vnd.sun.star.GraphiObject:”. Graphic&#160;inserted&#160;using the&#160;API&#160;are&#160;inserted as&#160;links&#160;– they&#160;are&#160;not&#160;<br/>embedded into&#160;the&#160;document&#160;without&#160;some&#160;work.<br/>
The&#160;following&#160;macro brings&#160;many&#160;concepts&#160;together to find&#160;all&#160;linked&#160;images&#160;and convert&#160;them&#160;into&#160;<br/>embedded images&#160;contained&#160;in the&#160;document.<br/>
<i><b>Listing&#160;346.</b>&#160;Convert&#160;all&#160;linked images&#160;to embedded images.</i><br/>
Sub&#160;ConvertAllLinkedGraphics(Optional&#160;aDoc)<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160;&#160;' Working document<br/>&#160;&#160;Dim&#160;oDP&#160; &#160; &#160; &#160; &#160;' Draw page<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160;&#160;' Index counter<br/>&#160;&#160;Dim&#160;oGraph&#160; &#160; &#160;&#160;' Graph object in the draw page<br/>&#160;&#160;Dim&#160;iLinked%&#160; &#160;&#160;' Number of linked images<br/>&#160;&#160;Dim&#160;iEmbedded%&#160;&#160;' Number of embedded images<br/>&#160;&#160;Dim&#160;iConverted%&#160;' Linked images converted to embedded<br/>&#160;&#160;Dim&#160;s1$&#160; &#160; &#160; &#160; &#160;' Graphic service name<br/>&#160;&#160;Dim&#160;s2$&#160; &#160; &#160; &#160; &#160;' Graphic service name<br/>
&#160;&#160;REM Only know how to convert these types<br/>&#160;&#160;s1&#160;=&#160;&#34;com.sun.star.drawing.GraphicObjectShape&#34;<br/>&#160;&#160;s2&#160;=&#160;&#34;com.sun.star.text.TextGraphicObject&#34;<br/>
&#160;&#160;If&#160;IsMissing(aDoc)&#160;OR&#160;IsNull(aDoc)&#160;OR&#160;IsEmpty(aDoc)&#160;Then<br/>&#160; &#160;&#160;oDoc&#160;=&#160;ThisComponent<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oDoc&#160;=&#160;aDoc<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM Get the document draw page and then enumerate the images.<br/>&#160;&#160;oDP&#160;=&#160;oDoc.getDrawPage()<br/>&#160;&#160;For&#160;i=0&#160;To&#160;oDP.getCount()-1<br/>&#160; &#160;&#160;oGraph&#160;=&#160;oDP.getByIndex(i)<br/>&#160; &#160;&#160;If&#160;oGraph.supportsService(s1)&#160;OR&#160;oGraph.supportsService(s2)&#160;Then<br/>&#160; &#160; &#160;&#160;If&#160;InStr(oGraph.GraphicURL,&#160;&#34;vnd.sun&#34;)&#160;&lt;&gt;&#160;0&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;iEmbedded&#160;=&#160;iEmbedded&#160;+&#160;1<br/>&#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160;&#160;iLinked&#160;=&#160;iLinked&#160;+&#160;1<br/>&#160; &#160; &#160; &#160;&#160;If&#160;EmbedLinkedGraphic(oGraph,&#160;oDoc)&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;iConverted&#160;=&#160;iConverted&#160;+&#160;1<br/>&#160; &#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>
381<br/>
<hr/>
<a name=385></a>&#160;&#160;Print&#160;&#34;Found &#34;&#160;&amp;&#160;iLinked&#160;&amp;&#160;&#34; linked and &#34;&#160;&amp;&#160;iEmbedded&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160;&#160;&#34; embedded images and converted &#34;&#160;&amp;&#160;iConverted<br/>End&#160;Sub<br/>
Function&#160;EmbedLinkedGraphic(oGraph,&#160;oDoc)&#160;As&#160;Boolean<br/>&#160;&#160;REM Author: Andrew Pitonyak<br/>&#160;&#160;Dim&#160;sGraphURL$&#160;&#160;' External URL of the image.<br/>&#160;&#160;Dim&#160;oGraph_2&#160; &#160;&#160;' Created image.<br/>&#160;&#160;Dim&#160;oCurs&#160; &#160; &#160; &#160;' Cursor where the image is located.<br/>&#160;&#160;Dim&#160;oText&#160; &#160; &#160; &#160;' Text object containing image.<br/>&#160;&#160;Dim&#160;oAnchor&#160; &#160; &#160;' Anchor point of the image<br/>&#160;&#160;Dim&#160;s1$&#160; &#160; &#160; &#160; &#160;' Graphic service name<br/>&#160;&#160;Dim&#160;s2$&#160; &#160; &#160; &#160; &#160;' Graphic service name<br/>
&#160;&#160;EmbedLinkedGraphic&#160;=&#160;False<br/>&#160;&#160;If&#160;InStr(oGraph.GraphicURL,&#160;&#34;vnd.sun&#34;)&#160;&lt;&gt;&#160;0&#160;Then<br/>&#160; &#160;&#160;REM Ignore an image that is already embedded<br/>&#160; &#160;&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;s1&#160;=&#160;&#34;com.sun.star.drawing.GraphicObjectShape&#34;<br/>&#160;&#160;s2&#160;=&#160;&#34;com.sun.star.text.TextGraphicObject&#34;<br/>&#160;&#160;If&#160;oGraph.supportsService(s1)&#160;Then<br/>
&#160; &#160;&#160;REM Convert a GraphicObjectShape.<br/>&#160; &#160;&#160;oAnchor&#160;=&#160;oGraph.getAnchor()<br/>&#160; &#160;&#160;oText&#160;=&#160;oAnchor.getText()<br/>&#160;&#160;<br/>&#160; &#160;&#160;oGraph_2&#160;=&#160;ThisComponent.createInstance(s)<br/>&#160; &#160;&#160;oGraph_2.GraphicObjectFillBitmap&#160;=&#160;oGraph.GraphicObjectFillBitmap<br/>&#160; &#160;&#160;oGraph_2.Size&#160;=&#160;oGraph.Size<br/>&#160; &#160;&#160;oGraph_2.Position&#160;=&#160;oGraph.Position<br/>&#160; &#160;&#160;oText.insertTextContent(oAnchor,&#160;oGraph_2,&#160;False)<br/>&#160; &#160;&#160;oText.removeTextContent(oGraph)<br/>&#160; &#160;&#160;EmbedLinkedGraphic&#160;=&#160;True<br/>&#160; &#160;&#160;<br/>&#160;&#160;ElseIf&#160;oGraph.supportsService(s2)&#160;Then<br/>&#160;&#160;<br/>&#160; &#160;&#160;REM Convert a TextGraphicObject.<br/>&#160; &#160;&#160;Dim&#160;oBitmaps<br/>&#160; &#160;&#160;Dim&#160;sNewURL$<br/>&#160; &#160;&#160;Dim&#160;sName$<br/>
&#160; &#160;&#160;sName$&#160;=&#160;oGraph.LinkDisplayName<br/>&#160; &#160;&#160;oBitmaps&#160;=&#160;oDoc.createInstance(&#160;&#34;com.sun.star.drawing.BitmapTable&#34;&#160;)<br/>&#160; &#160;&#160;If&#160;oBitMaps.hasByName(sName)&#160;Then<br/>&#160; &#160; &#160;&#160;Print&#160;&#34;Link display name &#34;&#160;&amp;&#160;sName&#160;&amp;&#160;&#34; already exists&#34;<br/>&#160; &#160; &#160;&#160;Exit&#160;Function<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;'Print &#34;Ready to insert &#34; &amp; sName<br/>&#160; &#160;&#160;oBitmaps.insertByName(&#160;sName,&#160;oGraph.GraphicURL&#160;)<br/>&#160; &#160;&#160;sNewURL$&#160;=&#160;oBitmaps.getByName(&#160;sName&#160;)<br/>&#160; &#160;&#160;'Print &#34;inserted URL &#34; &amp; sNewURL<br/>&#160; &#160;&#160;oGraph.GraphicURL&#160;=&#160;sNewURL<br/>
382<br/>
<hr/>
<a name=386></a>&#160; &#160;&#160;EmbedLinkedGraphic&#160;=&#160;True<br/>&#160;&#160;End&#160;If<br/>End&#160;Function&#160;<br/>
<i><b>&#160;14.5.&#160;Cursors<br/></b></i>The&#160;capability&#160;to&#160;enumerate&#160;the&#160;entire&#160;text&#160;content&#160;is&#160;primarily&#160;used for tasks&#160;such as&#160;exporting a&#160;document,&#160;<br/>because&#160;exporting&#160;requires&#160;all&#160;of the&#160;content&#160;to&#160;be&#160;accessed in&#160;sequential&#160;order.&#160;A&#160;more&#160;typical&#160;method&#160;for&#160;<br/>accessing and manipulating a&#160;document&#160;involves&#160;the&#160;use&#160;of cursors.&#160;A&#160;TextCursor is&#160;a&#160;TextRange, which&#160;can<br/>be&#160;moved within a&#160;Text&#160;object.&#160;In&#160;other words, a&#160;text&#160;cursor not&#160;only&#160;can specify&#160;a&#160;single&#160;point&#160;in&#160;the&#160;text,&#160;<br/>but&#160;it&#160;also can encompass&#160;a&#160;range&#160;of text.&#160;You can use&#160;the&#160;cursor movement&#160;methods&#160;to reposition the&#160;cursor<br/>and to expand the&#160;section&#160;of selected&#160;text.&#160;Two primary&#160;types&#160;of text&#160;cursors&#160;are&#160;available&#160;in&#160;OOo:&#160;cursors&#160;<br/>that&#160;are&#160;view&#160;cursors&#160;(see<a href="libremacros.html#386">&#160;Table&#160;129) a</a>nd cursors&#160;that&#160;are&#160;not&#160;(see<a href="libremacros.html#388">&#160;Table&#160;131).</a><br/>
<b>&#160;14.5.1.&#160;View&#160;cursors<br/></b>As&#160;its&#160;name&#160;implies, the&#160;view&#160;cursor deals&#160;with&#160;the&#160;visible&#160;cursor.&#160;In&#160;a&#160;single&#160;document&#160;window,&#160;you&#160;see&#160;one<br/>view&#160;at&#160;a&#160;time.&#160;Analogously, you&#160;can have&#160;one&#160;view&#160;cursor at&#160;a&#160;time.&#160;View&#160;cursors&#160;support&#160;commands&#160;that&#160;<br/>are&#160;directly&#160;related&#160;to viewing.&#160;To&#160;move&#160;a&#160;cursor one&#160;line&#160;at&#160;a&#160;time, or one&#160;screen at&#160;a&#160;time, requires&#160;a&#160;view&#160;<br/>cursor.&#160;The&#160;view&#160;cursor knows&#160;how&#160;the&#160;text&#160;is&#160;displayed (see<a href="libremacros.html#386">&#160;Table&#160;130).</a><br/>
<i><b>Table&#160;129.&#160;</b>In general,&#160;view cursors&#160;are&#160;not&#160;related&#160;to text&#160;ranges&#160;or&#160;XTextCursor.</i><br/>
<i><b>Cursor</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.view.XViewCursor<br/>
Simple&#160;cursor&#160;with basic&#160;movement&#160;methods that&#160;work in both&#160;<br/>
text&#160;and&#160;tables.<br/>
com.sun.star.text.XTextViewCursor<br/>
Derived&#160;from&#160;XTextCursor,&#160;this describes a&#160;cursor&#160;in&#160;a&#160;text&#160;<br/>
document’s&#160;view.&#160;It&#160;supports only&#160;very&#160;simple&#160;movements.<br/>
com.sun.star.view.XLineCursor<br/>
Defines line-related&#160;methods;&#160;this interface&#160;is&#160;not&#160;derived&#160;from&#160;a<br/>
text&#160;range.<br/>
com.sun.star.text.XPageCursor<br/>
Defines page-related&#160;methods;&#160;this&#160;interface&#160;is not&#160;derived&#160;from&#160;<br/>
a&#160;text&#160;range.<br/>
com.sun.star.view.XScreenCursor<br/>
Defines methods&#160;to move&#160;up and&#160;down&#160;one&#160;screen at&#160;a&#160;time.<br/>
Most&#160;of the&#160;cursor movement&#160;methods&#160;accept&#160;a&#160;Boolean argument&#160;that&#160;determines&#160;whether the&#160;text&#160;range&#160;of&#160;<br/>the&#160;cursor is&#160;expanded (True) or whether the&#160;cursor is&#160;simply&#160;moved&#160;to the&#160;new&#160;position&#160;(False). In&#160;other&#160;<br/>words, if the&#160;Boolean&#160;expression is&#160;False, the&#160;cursor is&#160;moved&#160;to the&#160;new&#160;position and no text&#160;is&#160;selected by&#160;<br/>the&#160;cursor.&#160;The&#160;description of the&#160;Boolean&#160;variable&#160;is&#160;assumed and not&#160;explicitly&#160;stated for each of the&#160;cursor<br/>movement&#160;methods&#160;in<a href="libremacros.html#386">&#160;Table&#160;130.&#160;</a>Another commonality&#160;with&#160;the&#160;movement&#160;methods&#160;is&#160;that&#160;they&#160;return a&#160;<br/>Boolean value.&#160;A&#160;True&#160;value&#160;means&#160;that&#160;the&#160;movement&#160;worked, and a&#160;False&#160;value&#160;means&#160;that&#160;the&#160;movement&#160;<br/>failed.&#160;A&#160;movement&#160;request&#160;fails&#160;if it&#160;cannot&#160;be&#160;completed successfully.&#160;It&#160;is&#160;not&#160;possible, for example, to&#160;<br/>move&#160;the&#160;cursor down if it&#160;is&#160;already&#160;at&#160;the&#160;end of the&#160;document.&#160;The&#160;screen cursor is&#160;obtained from&#160;the&#160;<br/>document’s&#160;current&#160;controller (see<a href="libremacros.html#387">&#160;Listing 347)</a>.<br/>
<i><b>Table&#160;130.&#160;</b>Object&#160;methods&#160;related to view cursors.</i><br/>
<i><b>Defined</b></i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
XViewCursor<br/>
goDown(n, Boolean)<br/>
Move&#160;the&#160;cursor&#160;down by&#160;n lines.<br/>
XViewCursor<br/>
goUp(n, Boolean)<br/>
Move&#160;the&#160;cursor&#160;up by&#160;n lines.<br/>
XViewCursor<br/>
goLeft(n, Boolean)<br/>
Move&#160;the&#160;cursor&#160;left&#160;by&#160;n&#160;characters.<br/>
383<br/>
<hr/>
<a name=387></a><i><b>Defined</b></i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
XViewCursor<br/>
goRight(n, Boolean)<br/>
Move&#160;the&#160;cursor&#160;right&#160;by&#160;n&#160;characters.<br/>
XTextViewCursor<br/>
isVisible()<br/>
Return&#160;True&#160;if&#160;the&#160;cursor&#160;is&#160;visible.<br/>
XTextViewCursor<br/>
setVisible(Boolean)<br/>
Show&#160;or&#160;hide&#160;the&#160;cursor.<br/>
XTextViewCursor<br/>
getPosition()<br/>
Return a&#160;com.sun.star.awt.Point&#160;structure&#160;<br/>specifying&#160;the&#160;cursor’s&#160;coordinates relative&#160;to&#160;<br/>
the&#160;top-left&#160;position of&#160;the&#160;first&#160;page&#160;of&#160;the&#160;<br/>document.<br/>
XLineCursor<br/>
isAtStartOfLine()<br/>
Return&#160;True&#160;if&#160;the&#160;cursor&#160;is&#160;at&#160;the&#160;start&#160;of&#160;the&#160;<br/>line.<br/>
XLineCursor<br/>
isAtEndOfLine()<br/>
Return&#160;True&#160;if&#160;the&#160;cursor&#160;is&#160;at&#160;the&#160;end of&#160;the&#160;<br/>line.<br/>
XLineCursor<br/>
gotoEndOfLine(Boolean)<br/>
Move&#160;the&#160;cursor&#160;to the&#160;end&#160;of&#160;the&#160;current&#160;line.&#160;<br/>
XLineCursor<br/>
gotoStartOfLine(Boolean)<br/>
Move&#160;the&#160;cursor&#160;to the&#160;start&#160;of&#160;the&#160;current&#160;line.&#160;<br/>
XPageCursor<br/>
jumpToFirstPage()<br/>
Move&#160;the&#160;cursor&#160;to the&#160;first&#160;page.<br/>
XPageCursor<br/>
jumpToLastPage()<br/>
Move&#160;the&#160;cursor&#160;to the&#160;last&#160;page.<br/>
XPageCursor<br/>
jumpToPage(n)<br/>
Move&#160;the&#160;cursor&#160;to the&#160;specified&#160;page.<br/>
XPageCursor<br/>
getPage()<br/>
Return the&#160;current&#160;page&#160;as a&#160;Short&#160;Integer.<br/>
XPageCursor<br/>
jumpToNextPage()<br/>
Move&#160;the&#160;cursor&#160;to the&#160;next&#160;page.<br/>
XPageCursor<br/>
jumpToPreviousPage()<br/>
Move&#160;the&#160;cursor&#160;to the&#160;previous page.<br/>
XPageCursor<br/>
jumpToEndOfPage()<br/>
Move&#160;the&#160;cursor&#160;to the&#160;end&#160;of&#160;the&#160;current&#160;page.<br/>
XPageCursor<br/>
jumpToStartOfPage()<br/>
Move&#160;the&#160;cursor&#160;to the&#160;start&#160;of&#160;the&#160;current&#160;page.<br/>
XScreenCursor<br/>
screenDown()<br/>
Scroll&#160;the&#160;view&#160;forward&#160;by&#160;one&#160;visible&#160;page.<br/>
XScreenCursor<br/>
screenUp()<br/>
Scroll&#160;the&#160;view&#160;backward&#160;by&#160;one&#160;visible&#160;page.<br/>
<i><b>Listing&#160;347.&#160;</b>ScrollDownOneScreen is&#160;found in&#160;the&#160;Writer&#160;module&#160;in this&#160;chapter’s&#160;source&#160;code&#160;files&#160;as&#160;<br/>SC13.sxw.<br/></i>Sub&#160;ScrollDownOneScreen<br/>&#160;&#160;REM Get the view cursor from the current controller<br/>&#160;&#160;ThisComponent.currentController.getViewCursor().screenDown()<br/>End&#160;Sub<br/>
A&#160;more&#160;typical&#160;use&#160;of the&#160;view&#160;cursor is&#160;to&#160;insert&#160;some&#160;special&#160;text&#160;content&#160;at&#160;the&#160;current&#160;cursor position.&#160;The<br/>macro i<a href="libremacros.html#387">n&#160;Listing&#160;348&#160;i</a>nserts&#160;the&#160;character with Unicode&#160;value&#160;257 (“a”&#160;with&#160;a&#160;bar over it) at&#160;the&#160;current&#160;<br/>cursor position.&#160;This&#160;type&#160;of macro is&#160;typically&#160;associated&#160;with a&#160;keystroke&#160;to&#160;insert&#160;special&#160;characters&#160;that&#160;<br/>are&#160;not&#160;present&#160;on the&#160;keyboard.&#160;The&#160;macro i<a href="libremacros.html#387">n&#160;Listing&#160;348&#160;i</a>s&#160;short&#160;and simple,&#160;yet&#160;very&#160;useful.<br/>
<i><b>Listing&#160;348.&#160;</b>Insert&#160;the&#160;character&#160;with&#160;Unicode&#160;value&#160;257 at&#160;the&#160;current&#160;cursor.</i><br/>
Sub&#160;InsertControlCharacterAtCurrentCursor<br/>&#160;&#160;Dim&#160;oViewCursor&#160;As&#160;Object<br/>&#160;&#160;oViewCursor&#160;=&#160;ThisComponent.CurrentController.getViewCursor()<br/>&#160;&#160;oViewCursor.getText.insertString(oViewCursor.getStart(),&#160;CHR$(257),&#160;False)<br/>End&#160;Sub<br/>
384<br/>
<hr/>
<a name=388></a><b>&#160;14.5.2.&#160;Text&#160;(non-view)&#160;cursors<br/></b>The&#160;view&#160;cursor knows&#160;how&#160;the&#160;data&#160;is&#160;displayed, but&#160;doesn’t&#160;know&#160;about&#160;the&#160;data&#160;itself.&#160;Text&#160;cursors&#160;(non-<br/>view&#160;cursors), however,&#160;know&#160;a&#160;lot&#160;about&#160;the&#160;data&#160;but&#160;very&#160;little&#160;about&#160;how&#160;it&#160;is&#160;displayed. For&#160;example,&#160;<br/>view&#160;cursors&#160;do not&#160;know&#160;about&#160;words&#160;or paragraphs, and text&#160;cursors&#160;do not&#160;know&#160;about&#160;lines, screens, or&#160;<br/>pages&#160;(see<a href="libremacros.html#388">&#160;Table&#160;131)</a>.<br/>
<i><b>Table&#160;131.&#160;</b>Text&#160;cursor&#160;interfaces&#160;all&#160;implement&#160;the&#160;XTextCursor&#160;interface.</i><br/>
<i><b>Cursor</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.text.XTextCursor<br/>
The&#160;primary&#160;text&#160;cursor&#160;that&#160;defines simple&#160;movement&#160;<br/>
methods.<br/>
com.sun.star.text.XWordCursor<br/>
Provides word-related movement&#160;and testing&#160;methods.<br/>
com.sun.star.text.XSentenceCursor<br/>
Provides sentence-related movement&#160;and testing&#160;methods.<br/>
com.sun.star.text.XParagraphCursor<br/>
Provides paragraph-related&#160;movement&#160;and&#160;testing&#160;methods.<br/>
com.sun.star.text.XTextViewCursor<br/>
Derived&#160;from&#160;XTextCursor,&#160;this describes a&#160;cursor&#160;in&#160;a&#160;text&#160;<br/>document’s&#160;view.<br/>
<b>TIP</b><br/>
Text&#160;cursors&#160;and&#160;view&#160;cursors have&#160;some&#160;overlap.&#160;The&#160;XTextViewCursor&#160;is derived&#160;from&#160;the&#160;XTextCursor&#160;<br/>
so it&#160;supports the&#160;XTextCursor&#160;methods.&#160;This does&#160;not&#160;provide&#160;functionality&#160;with respect&#160;to the&#160;underlying&#160;<br/>data&#160;such as word-related&#160;or&#160;paragraph-related&#160;methods (see<a href="libremacros.html#388">&#160;Table&#160;132)</a>.<br/>
The&#160;word cursor,&#160;sentence&#160;cursor,&#160;and paragraph cursor all&#160;define&#160;essentially&#160;identical&#160;object&#160;methods&#160;(se<a href="libremacros.html#388">e<br/>Table&#160;132)</a>.&#160;The&#160;XTextViewCursor interface&#160;is&#160;listed in<a href="libremacros.html#386">&#160;Table&#160;130&#160;s</a>o it&#160;is&#160;omitted from<a href="libremacros.html#388">&#160;Table&#160;132.</a><br/>
<i><b>Table&#160;132.&#160;</b>Object&#160;methods&#160;related to text&#160;cursors.</i><br/>
<i><b>Defined</b></i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
XTextCursor<br/>
collapseToStart()<br/>
Set&#160;the&#160;end position to the&#160;start&#160;position.<br/>
XTextCursor<br/>
collapseToEnd()<br/>
Set&#160;the&#160;start&#160;position&#160;to the&#160;end position.<br/>
XTextCursor<br/>
isCollapsed()<br/>
Return&#160;True&#160;if&#160;the&#160;start&#160;and&#160;end&#160;positions&#160;<br/>
are&#160;the&#160;same.<br/>
XTextCursor<br/>
goLeft(n, Boolean)<br/>
Move&#160;the&#160;cursor&#160;left&#160;by&#160;n&#160;characters.<br/>
XTextCursor<br/>
goRight(n,&#160;Boolean)<br/>
Move&#160;the&#160;cursor&#160;right&#160;by&#160;n characters.<br/>
XTextCursor<br/>
gotoStart(Boolean)<br/>
Move&#160;the&#160;cursor&#160;to&#160;the&#160;start&#160;of&#160;the&#160;text.<br/>
XTextCursor<br/>
gotoEnd(Boolean)<br/>
Move&#160;the&#160;cursor&#160;to&#160;the&#160;end of&#160;the&#160;text.<br/>
XTextCursor<br/>
gotoRange(XTextRange,&#160;Boolean)<br/>
Move&#160;or&#160;expand&#160;the&#160;cursor&#160;to the&#160;<br/>
TextRange.<br/>
XWordCursor<br/>
isStartOfWord()<br/>
Return&#160;True&#160;if&#160;at&#160;the&#160;start&#160;of&#160;a&#160;word.<br/>
XWordCursor<br/>
isEndOfWord()<br/>
Return&#160;True&#160;if&#160;at&#160;the&#160;end of&#160;a&#160;word.<br/>
XWordCursor<br/>
gotoNextWord(Boolean)<br/>
Move&#160;to the&#160;start&#160;of&#160;the&#160;next&#160;word.<br/>
XWordCursor<br/>
gotoPreviousWord(Boolean)<br/>
Move&#160;to the&#160;end&#160;of&#160;the&#160;previous word.<br/>
XWordCursor<br/>
gotoEndOfWord(Boolean)<br/>
Move&#160;to the&#160;end&#160;of&#160;the&#160;current&#160;word.<br/>
XWordCursor<br/>
gotoStartOfWord(Boolean)<br/>
Move&#160;to the&#160;start&#160;of&#160;the&#160;current&#160;word.<br/>
XSentenceCursor<br/>
isStartOfSentence()<br/>
Return&#160;True&#160;if&#160;at&#160;the&#160;start&#160;of&#160;a&#160;sentence.<br/>
XSentenceCursor<br/>
isEndOfSentence()<br/>
Return&#160;True&#160;if&#160;at&#160;the&#160;end of&#160;a&#160;sentence.<br/>
385<br/>
<hr/>
<a name=389></a><i><b>Defined</b></i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
XSentenceCursor<br/>
gotoNextSentence(Boolean)<br/>
Move&#160;to the&#160;start&#160;of&#160;the&#160;next&#160;sentence.<br/>
XSentenceCursor<br/>
gotoPreviousSentence(Boolean)<br/>
Move&#160;to the&#160;end&#160;of&#160;the&#160;previous sentence.<br/>
XSentenceCursor<br/>
gotoEndOfSentence(Boolean)<br/>
Move&#160;to the&#160;end&#160;of&#160;the&#160;current&#160;sentence.<br/>
XSentenceCursor<br/>
gotoStartOfSentence(Boolean)<br/>
Move&#160;to the&#160;start&#160;of&#160;the&#160;current&#160;sentence.<br/>
XParagraphCursor<br/>
isStartOfParagraph()<br/>
True&#160;if&#160;at&#160;the&#160;start&#160;of&#160;a&#160;paragraph.<br/>
XParagraphCursor<br/>
isEndOfParagraph()<br/>
True&#160;if&#160;at&#160;the&#160;end of&#160;a&#160;paragraph.<br/>
XParagraphCursor<br/>
gotoNextParagraph(Boolean)<br/>
Move&#160;to the&#160;start&#160;of&#160;the&#160;next&#160;paragraph.<br/>
XParagraphCursor<br/>
gotoPreviousParagraph(Boolean)<br/>
Move&#160;to the&#160;end&#160;of&#160;the&#160;previous&#160;<br/>paragraph.<br/>
XParagraphCursor<br/>
gotoEndOfParagraph(Boolean)<br/>
Move&#160;to the&#160;end&#160;of&#160;the&#160;current&#160;paragraph.<br/>
XParagraphCursor<br/>
gotoStartOfParagraph(Boolean)<br/>
Move&#160;to the&#160;start&#160;of&#160;the&#160;current&#160;<br/>
paragraph.<br/>
<b>&#160;14.5.3.&#160;Using&#160;cursors&#160;to&#160;traverse&#160;text<br/></b>Although traversing text&#160;using a&#160;cursor is&#160;not&#160;inherently&#160;difficult, I&#160;struggled with&#160;cursors&#160;for a&#160;long time&#160;<br/>before&#160;I&#160;finally&#160;realized&#160;that&#160;I&#160;had a&#160;very&#160;basic&#160;and yet&#160;simple&#160;misunderstanding.&#160;A&#160;very&#160;common,&#160;and yet&#160;<br/>subtly&#160;incorrect,&#160;method&#160;of traversing text&#160;content&#160;using&#160;cursors&#160;is&#160;shown i<a href="libremacros.html#389">n&#160;Listing&#160;349.&#160;</a>This&#160;macro&#160;<br/>attempts&#160;to move&#160;the&#160;cursor from&#160;one&#160;paragraph to the&#160;next, selecting one&#160;paragraph at&#160;a&#160;time.&#160;Typically,&#160;<br/>something would&#160;be&#160;done&#160;to manipulate&#160;or modify&#160;the&#160;paragraph, such as&#160;setting the&#160;paragraph style.<br/>
<i><b>Listing&#160;349.&#160;</b>Example&#160;of&#160;incorrect&#160;use&#160;of&#160;cursors: This&#160;code&#160;misses&#160;the&#160;last&#160;paragraph in the&#160;document.</i><br/>
Dim&#160;oCursor<br/>REM Create a text cursor<br/>oCursor&#160;=&#160;ThisComponent.Text.createTextCursor()<br/>REM Start at the beginning of the document.<br/>REM This is the same as the start of the first document.<br/>oCursor.gotoStart(False)<br/>REM And this is where things go wrong!<br/>REM The cursor now spans from the start of the<br/>REM first paragraph to the start of the second paragraph.<br/>Do&#160;While&#160;oCursor.gotoNextParagraph(True)<br/>&#160;&#160;REM Process the paragraph here!<br/>&#160;&#160;REM Now, deselect all of the text, leaving the cursor at the<br/>&#160;&#160;REM start of the next paragraph.<br/>&#160;&#160;oCursor.goRight(0,&#160;False)<br/>Loop<br/>
<b>TIP</b><br/>
I&#160;produced&#160;incorrect&#160;code&#160;as shown&#160;i<a href="libremacros.html#389">n&#160;Listing&#160;349&#160;b</a>efore&#160;I&#160;understood cursors.<br/>
The&#160;problem&#160;in<a href="libremacros.html#389">&#160;Listing 349&#160;i</a>s&#160;that&#160;the&#160;method&#160;gotoNextParagraph(True) causes&#160;the&#160;cursor to extend&#160;its&#160;<br/>selection&#160;from&#160;the&#160;start&#160;of one&#160;paragraph to&#160;the&#160;start&#160;of the&#160;next.&#160;The&#160;first&#160;problem&#160;with selecting from&#160;the&#160;<br/>start&#160;of one&#160;paragraph to&#160;the&#160;start&#160;of the&#160;next&#160;is&#160;that&#160;more&#160;than&#160;just&#160;one&#160;paragraph is&#160;selected.&#160;If&#160;the&#160;two&#160;<br/>different&#160;paragraphs&#160;do not&#160;have&#160;the&#160;same&#160;paragraph style, the&#160;ParaStyleName&#160;property&#160;will&#160;return an empty&#160;<br/>string rather than a&#160;value.&#160;The&#160;second problem&#160;is&#160;that&#160;when the&#160;cursor (as&#160;shown i<a href="libremacros.html#389">n&#160;Listing&#160;349) i</a>s&#160;<br/>positioned at&#160;the&#160;start&#160;of the&#160;last&#160;paragraph, it&#160;is&#160;not&#160;possible&#160;to&#160;go to the&#160;next&#160;paragraph because&#160; the&#160;next&#160;<br/>paragraph does&#160;not&#160;exist.&#160;Therefore, the&#160;statement&#160;“gotoNextParagraph(True)”&#160;returns&#160;False&#160;and the&#160;last&#160;<br/>
386<br/>
<hr/>
<a name=390></a>paragraph is&#160;never processed.&#160;The&#160;code&#160;i<a href="libremacros.html#390">n&#160;Listing&#160;350&#160;de</a>monstrates&#160;one&#160;correct&#160;method&#160;of traversing all&#160;of&#160;<br/>the&#160;paragraphs&#160;using a&#160;cursor.<br/>
<i><b>Listing&#160;350.&#160;</b>The&#160;correct&#160;way&#160;to use&#160;cursors.<br/></i>Dim&#160;oCursor<br/>REM Create a text cursor.<br/>oCursor&#160;=&#160;ThisComponent.Text.createTextCursor()<br/>REM Start at the beginning of the document.<br/>REM This is the same as the start of the first document.<br/>oCursor.gotoStart(False)<br/>Do<br/>&#160;&#160;REM The cursor is already positioned at the start<br/>&#160;&#160;REM of the current paragraph, so select the entire paragraph.<br/>&#160;&#160;oCursor.gotoEndOfParagraph(True)<br/>&#160;&#160;REM Process the paragraph here!<br/>&#160;&#160;REM The Loop statement moves to the next paragraph and<br/>&#160;&#160;REM it also deselects the text in the cursor.<br/>Loop&#160;While&#160;oCursor.gotoNextParagraph(False)<br/>
The&#160;point&#160;is&#160;to&#160;align the&#160;cursor over the&#160;current&#160;paragraph, and then&#160;iterate&#160;aligned with&#160;the&#160;paragraphs,&#160;<br/>rather than&#160;ever looking ahead to&#160;the&#160;next&#160;paragraph while&#160;in the&#160;midst&#160;of dealing&#160;with&#160;the&#160;cursor.<br/>
<b>TIP</b><br/>
&#160;You can&#160;use&#160;cursors and enumeration to traverse&#160;an entire&#160;document&#160;and obtain all&#160;of&#160;the&#160;paragraphs.&#160;<br/>Using&#160;a&#160;cursor&#160;is five&#160;times&#160;faster&#160;than using&#160;an enumerator.<br/>
It&#160;is&#160;very&#160;simple&#160;to&#160;write&#160;an iterator that&#160;traverses&#160;the&#160;text&#160;while&#160;counting the&#160;words, sentences, and&#160;<br/>paragraphs&#160;(see<a href="libremacros.html#390">&#160;Listing 351)</a>.<br/>
<i><b>Listing&#160;351.&#160;</b>Count&#160;paragraphs, sentences, and words.<br/></i>Sub&#160;CountWordSentPar<br/>&#160;&#160;Dim&#160;oCursor<br/>&#160;&#160;Dim&#160;nPars&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;nSentences&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;nWords&#160;As&#160;Long<br/>&#160;&#160;<br/>&#160;&#160;REM Create a text cursor.<br/>&#160;&#160;oCursor&#160;=&#160;ThisComponent.Text.createTextCursor()<br/>&#160;&#160;oCursor.gotoStart(False)<br/>&#160;&#160;Do<br/>&#160; &#160;&#160;nPars&#160;=&#160;nPars&#160;+&#160;1<br/>&#160;&#160;Loop&#160;While&#160;oCursor.gotoNextParagraph(False)<br/>&#160;&#160;oCursor.gotoStart(False)<br/>&#160;&#160;Do<br/>&#160; &#160;&#160;nSentences&#160;=&#160;nSentences&#160;+&#160;1<br/>&#160;&#160;Loop&#160;While&#160;oCursor.gotoNextSentence(False)<br/>&#160;&#160;<br/>&#160;&#160;oCursor.gotoStart(False)<br/>&#160;&#160;Do<br/>&#160; &#160;&#160;nWords&#160;=&#160;nWords&#160;+&#160;1<br/>&#160;&#160;Loop&#160;While&#160;oCursor.gotoNextWord(False)<br/>&#160;&#160;<br/>&#160;&#160;MsgBox&#160;&#34;Paragraphs: &#34;&#160;&amp;&#160;nPars&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#34;Sentences: &#34;&#160;&amp;&#160;nSentences&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>
387<br/>
<hr/>
<a name=391></a>&#160; &#160; &#160;&#34;Words: &#34;&#160;&amp;&#160;nWords&#160;&amp;&#160;CHR$(10),&#160;0,&#160;&#34;Doc Statistics&#34;<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
With&#160;OOo&#160;1.1, I&#160;found gotoNextSentence()&#160;and gotoNextWord()&#160;to be&#160;unreliable,&#160;but&#160;the&#160;paragraph&#160;cursor&#160;<br/>worked&#160;well.&#160;To&#160;count&#160;words, therefore,&#160;I&#160;used the&#160;word&#160;count&#160;macros from&#160;Andrew&#160;Brows:<br/>
<a href="http://www.darwinwars.com/lunatic/bugs/oo_macros.html"><b>http://www.darwinwars.com/lunatic/bugs/oo_macros.html</b>.</a><br/>
<i><b>Keep&#160;the&#160;view&#160;cursor&#160;and&#160;text&#160;cursor&#160;in&#160;sync<br/></b></i>A&#160;paragraph is&#160;broken into lines&#160;based on the&#160;page&#160;margins.&#160;Adjust&#160;the&#160;page&#160;margins&#160;and the&#160;line&#160;breaks&#160;<br/>change.&#160;Also,&#160;text&#160;copied from&#160;writer as&#160;text&#160;do not&#160;contain&#160;the&#160;page&#160;breaks. For the&#160;real&#160;world&#160;example&#160;i<a href="libremacros.html#391">n<br/>Listing 352&#160;a</a>dds&#160;real&#160;line&#160;breaks&#160;into the&#160;text&#160;based on how&#160;the&#160;lines&#160;break on screen.&#160;<br/>
Both a view cursor and a non­view cursor are required to move through the text. The view cursor knows <br/>
where a line ends, but it does not know where the paragraph starts or ends. A non­view cursor knows about <br/>
paragraphs, but the view cursor does not.<br/>
<a href="libremacros.html#391">Listing 352&#160;m</a>oves&#160;the&#160;view&#160;cursor around on the&#160;screen, demonstrating how&#160;to&#160;change&#160;its&#160;location.<br/>
<i><b>Listing&#160;352.</b>&#160;Add line&#160;breaks&#160;in&#160;a paragraph.<br/></i>Sub&#160;LineBreaksInParagraph<br/>&#160;&#160;Dim&#160;oText&#160; &#160; &#160; &#160;'Save typing ThisComponent.Text<br/>&#160;&#160;Dim&#160;oViewCursor&#160;'Save typing<br/>&#160;&#160;ThisComponent.CurrentController.getViewCursor()<br/>&#160;&#160;Dim&#160;oTextCursor&#160;'Created text cursor<br/>&#160;&#160;Dim&#160;oSaveCursor&#160;'In case I want to restore the view cursor<br/>&#160;&#160;<br/>&#160;&#160;oText&#160;=&#160;ThisComponent.Text<br/>&#160;&#160;<br/>&#160;&#160;REM You require a view cursor&#160;<br/>&#160;&#160;REM because only the view knows where a line ends.<br/>&#160;&#160;oViewCursor&#160;=&#160;ThisComponent.CurrentController.getViewCursor()<br/>&#160;&#160;<br/>&#160;&#160;REM You require a text cursor so that you know where the paragraph ends.<br/>&#160;&#160;REM Too bad the view cursor is not a paragraph cursor.<br/>&#160;&#160;oTextCursor&#160;=&#160;oText.createTextCursorByRange(oViewCursor)<br/>&#160;&#160;<br/>&#160;&#160;REM You only need this if you want to restore the view cursor<br/>&#160;&#160;oSaveCursor&#160;=&#160;oText.createTextCursorByRange(oViewCursor)<br/>
&#160;&#160;REM Move the cursor to the start of the current paragraph<br/>&#160;&#160;REM so that the entire paragraph can be processed.<br/>&#160;&#160;If&#160;NOT&#160;oTextCursor.isStartOfParagraph()&#160;Then<br/>&#160; &#160;&#160;oTextCursor.gotoStartOfParagraph(False)<br/>&#160; &#160;&#160;oViewCursor.gotoRange(oTextCursor,&#160;False)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;REM Now visit each line of the paragraph.<br/>&#160;&#160;Do&#160;While&#160;True<br/>&#160; &#160;&#160;REM Only the view cursor knows where the end of the line is<br/>&#160; &#160;&#160;REM because this is a formatting issue and not determined by<br/>&#160; &#160;&#160;REM punctuation.<br/>&#160; &#160;&#160;oViewCursor.gotoEndOfLine(false)<br/>
388<br/>
<hr/>
<a name=392></a>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Move with the view cursor to the end of the current line<br/>&#160; &#160;&#160;REM and then see if you're at the end of the paragraph.<br/>&#160; &#160;&#160;oTextCursor.gotoRange(oViewCursor,&#160;False)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Check for end of paragraph BEFORE inserting the line break.<br/>&#160; &#160;&#160;If&#160;oTextCursor.isEndOfParagraph()&#160;Then&#160;Exit&#160;Do<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Insert a line break at the current view cursor.<br/>&#160; &#160;&#160;oText.insertControlCharacter(oViewCursor,_<br/>&#160; &#160; &#160; &#160;com.sun.star.text.ControlCharacter.LINE_BREAK,&#160;false)<br/>&#160;&#160;Loop<br/>&#160;&#160;REM If you only want to move the cursor away from the end of the<br/>&#160;&#160;REM current paragraph, then this will suffice.<br/>&#160;&#160;oViewCursor.goRight(1,&#160;False)<br/>&#160;&#160;REM I want to restore the view cursor location, however.<br/>&#160;&#160;REM oViewCursor.gotoRange(oSaveCursor, False)<br/>End&#160;Sub<br/>
<b>&#160;14.5.4.&#160;Accessing&#160;content&#160;using&#160;cursors<br/></b>I&#160;have&#160;a&#160;habit&#160;of inspecting the&#160;objects&#160;returned to&#160;me&#160;by&#160;OOo.&#160;While&#160;inspecting a&#160;view&#160;cursor,&#160;I&#160;noticed that<br/>the&#160;view&#160;cursor contained useful&#160;undocumented&#160;properties.&#160;According&#160;to&#160;the&#160;developers&#160;at&#160;Sun, these&#160;will&#160;<br/>eventually&#160;be&#160;documented.&#160;Some&#160;of the&#160;properties&#160;that&#160;I&#160;noticed include:&#160;Cell,&#160;DocumentIndex,&#160;<br/>DocumentIndexMark, Endnote, Footnote, ReferenceMark,&#160;Text,&#160;TextField,&#160;TextFrame,&#160;TextSection,&#160;and&#160;<br/>TextTable.&#160;If&#160;a&#160;cursor is&#160;in a&#160;text&#160;table, the&#160;cursor’s&#160;TextTable&#160;property&#160;is&#160;not&#160;empty.&#160;If&#160;a&#160;cursor is&#160;on a&#160;text&#160;<br/>field, the&#160;cursor’s&#160;TextField property&#160;is&#160;not&#160;empty.&#160;These&#160;special&#160;properties&#160;are&#160;empty&#160;if they&#160;are&#160;not&#160;<br/>relevant.&#160;I&#160;first&#160;used these&#160;undocumented&#160;properties&#160;when I&#160;was&#160;asked how&#160;to determine&#160;if the&#160;view&#160;cursor&#160;<br/>was&#160;positioned in&#160;a&#160;text&#160;table,&#160;and if&#160;so, what&#160;cell&#160;contains&#160;the&#160;view&#160;cursor.&#160;See<a href="libremacros.html#392">&#160;Listing&#160;353.</a><br/>
<i><b>Listing&#160;353.&#160;</b>Testing&#160;view cursor&#160;properties.</i><br/>
If&#160;NOT&#160;IsEmpty(oViewCursor.TextTable)&#160;Then<br/>
Cursors&#160;provide&#160;the&#160;ability&#160;to&#160;quickly&#160;find objects&#160;in close&#160;proximity&#160;to&#160;something else. For&#160;example, I&#160;was&#160;<br/>recently&#160;asked how&#160;to&#160;find a&#160;text&#160;field&#160;contained in&#160;the&#160;current&#160;paragraph—the&#160;current&#160;paragraph is&#160;defined&#160;<br/>as&#160;the&#160;paragraph containing&#160;the&#160;view&#160;cursor.&#160;It’s&#160;easy&#160;to&#160;obtain&#160;the&#160;view&#160;cursor,&#160;and you&#160;can use&#160;a&#160;paragraph&#160;<br/>cursor to move&#160;around the&#160;current&#160;paragraph.&#160;<br/>
My&#160;first&#160;attempt&#160;called&#160;the&#160;createContentEnumeration(&#34;com.sun.star.text.TextContent&#34;) object&#160;method&#160;on&#160;<br/>the&#160;cursor.&#160;This&#160;creates&#160;an enumeration&#160;of text&#160;content, enumerating objects&#160;such as&#160;inserted buttons. I&#160;had&#160;<br/>mistakenly&#160;assumed&#160;that&#160;this&#160;would&#160;include&#160;text&#160;fields&#160;in&#160;the&#160;enumeration.&#160;My&#160;second attempt&#160;to find a&#160;text&#160;<br/>field, which was&#160;successful, uses&#160;the&#160;createEnumeration() object&#160;method.&#160;The&#160;createEnumeration() method&#160;<br/>returns&#160;an enumeration&#160;of the&#160;paragraphs&#160;contained&#160;in the&#160;cursor.&#160;Enumerating the&#160;content&#160;contained in&#160;a&#160;<br/>paragraph provides&#160;access&#160;to the&#160;text&#160;field.&#160;My&#160;final&#160;attempt, which was&#160;also successful, moves&#160;the&#160;cursor to<br/>the&#160;start&#160;of the&#160;document&#160;and then&#160;moves&#160;through the&#160;paragraph one&#160;location&#160;at&#160;a&#160;time&#160;looking for a&#160;text&#160;<br/>field.&#160;The&#160;macro i<a href="libremacros.html#392">n&#160;Listing&#160;354&#160;de</a>monstrates&#160;all&#160;of the&#160;methods&#160;that&#160;I&#160;used to&#160;try&#160;to find a&#160;text&#160;field&#160;in the&#160;<br/>current&#160;paragraph.<br/>
<i><b>Listing&#160;354.</b>&#160;Check&#160;current&#160;paragraph for&#160;a text&#160;field.</i><br/>
Sub&#160;TextFieldInCurrentParagraph<br/>&#160;&#160;Dim&#160;oEnum&#160; &#160; &#160; &#160; &#160;'Cursor enumerator<br/>&#160;&#160;Dim&#160;oSection&#160; &#160; &#160;&#160;'Current section<br/>&#160;&#160;Dim&#160;oViewCursor&#160; &#160;'Current view cursor<br/>
389<br/>
<hr/>
<a name=393></a>&#160;&#160;Dim&#160;oTextCursor&#160; &#160;'Created text cursor<br/>&#160;&#160;Dim&#160;oText&#160; &#160; &#160; &#160; &#160;'Text object in current document<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Dim&#160;sTextContent$&#160;'Service name for text content.<br/>&#160;&#160;sTextContent&#160;=&#160;&#34;com.sun.star.text.TextContent&#34;<br/>&#160;&#160;<br/>&#160;&#160;oText&#160;=&#160;ThisComponent.Text<br/>&#160;&#160;oViewCursor&#160;=&#160;ThisComponent.CurrentController.getViewCursor()<br/>&#160;&#160;<br/>&#160;&#160;REM Obtain the view cursor, and then select the paragraph<br/>&#160;&#160;REM containing the view cursor.<br/>&#160;&#160;oTextCursor&#160;=&#160;oText.createTextCursorByRange(oViewCursor)<br/>&#160;&#160;<br/>&#160;&#160;REM Move to the start of the paragraph as a single point.<br/>&#160;&#160;oTextCursor.gotoStartOfParagraph(False)<br/>&#160;&#160;REM Move to the end of the current paragraph and expand the<br/>&#160;&#160;REM selection so that the entire paragraph is selected.<br/>&#160;&#160;oTextCursor.gotoEndOfParagraph(True)<br/>&#160;&#160;<br/>&#160;&#160;REM I want to enumerate the text content contained by this text cursor.<br/>&#160;&#160;REM Although this will find inserted drawing objects, such as the shape<br/>&#160;&#160;REM used by a button, it will not find a text field!<br/>&#160;&#160;oEnum&#160;=&#160;oTextCursor.createContentEnumeration(sTextContent)<br/>&#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements()<br/>&#160; &#160;&#160;oSection&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160;&#160;Print&#160;&#34;Enumerating TextContent: &#34;&#160;&amp;&#160;oSection.ImplementationName<br/>&#160;&#160;Loop<br/>
&#160;&#160;REM And this enumerates the paragraphs that are contained in<br/>&#160;&#160;REM the text cursor.<br/>&#160;&#160;oEnum&#160;=&#160;oTextCursor.createEnumeration()<br/>&#160;&#160;Dim&#160;v<br/>&#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements()<br/>&#160; &#160;&#160;v&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160;&#160;Dim&#160;oSubSection<br/>&#160; &#160;&#160;Dim&#160;oSecEnum<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Now create an enumeration of the paragraphs.<br/>&#160; &#160;&#160;REM We can enumerate the sections of the paragraph to&#160;<br/>&#160; &#160;&#160;REM obtain the text field and other paragraph content.<br/>&#160; &#160;&#160;oSecEnum&#160;=&#160;v.createEnumeration()<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;Enumerating section type: &#34;&#160;&amp;&#160;v.ImplementationName<br/>&#160; &#160;&#160;Do&#160;While&#160;oSecEnum.hasMoreElements()<br/>&#160; &#160; &#160; &#160;&#160;oSubSection&#160;=&#160;oSecEnum.nextElement()<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;oSubSection.TextPortionType<br/>&#160; &#160; &#160; &#160;&#160;If&#160;oSubSection.TextPortionType&#160;=&#160;&#34;TextField&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; &lt;== Type &#34;&#160;&amp;&#160;oSubSection.TextField.ImplementationName<br/>&#160; &#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Loop<br/>&#160; &#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Enumerate Single Paragraph&#34;<br/>&#160;&#160;Loop<br/>&#160;&#160;<br/>&#160;&#160;REM And this is yet another way to find the text field.<br/>
390<br/>
<hr/>
<a name=394></a>&#160;&#160;REM Start at the beginning of the paragraph and then move the cursor<br/>&#160;&#160;REM through it, looking for text fields.<br/>&#160;&#160;oTextCursor.gotoStartOfParagraph(False)<br/>&#160;&#160;Do&#160;While&#160;oTextCursor.goRight(1,&#160;False)&#160;AND&#160;_<br/>&#160; &#160; &#160; &#160;NOT&#160;oTextCursor.isEndOfParagraph()<br/>&#160; &#160;&#160;If&#160;NOT&#160;IsEmpty(oTextCursor.TextField)&#160;Then<br/>&#160; &#160; &#160;&#160;Print&#160;&#34;It is NOT empty, you can use the text field&#34;<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Loop&#160;&#160;<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
As&#160;unintuitive&#160;as it&#160;sounds,&#160;it&#160;is not&#160;only&#160;possible—but&#160;common—for&#160;the&#160;end&#160;of&#160;a&#160;text&#160;range&#160;to come&#160;<br/>before&#160;the&#160;start&#160;of&#160;a&#160;text&#160;range.&#160;The&#160;order&#160;of&#160;the&#160;start&#160;and end&#160;is primarily&#160;an issue&#160;when dealing&#160;with text&#160;<br/>
selected&#160;by&#160;a&#160;human&#160;user&#160;but&#160;may&#160;also&#160;occur&#160;due&#160;to&#160;the&#160;movement&#160;of&#160;a&#160;text&#160;cursor&#160;while&#160;expanding&#160;the&#160;text<br/>range.<br/>
As&#160;the&#160;object&#160;methods&#160;getStart() and getEnd() imply,&#160;it’s&#160;possible&#160;for a&#160;text&#160;range&#160;to represent&#160;a&#160;single&#160;point.&#160;<br/>It’s&#160;also possible&#160;that&#160;the&#160;start&#160;position&#160;comes&#160;after the&#160;end position. Unexpected&#160;start&#160;and end positions&#160;are&#160;<br/>typically&#160;a&#160;problem&#160;while&#160;dealing with&#160;selected&#160;text.&#160;When you select&#160;text&#160;using a&#160;mouse&#160;or your&#160;keyboard,&#160;<br/>the&#160;initial&#160;selection&#160;point&#160;is&#160;generally&#160;the&#160;start&#160;location. Moving&#160;the&#160;final&#160;selection point&#160;toward the&#160;start&#160;of&#160;<br/>the&#160;document&#160;causes&#160;the&#160;end position&#160;to occur before&#160;the&#160;start&#160;position&#160;in the&#160;text&#160;range.&#160;The&#160;same&#160;behavior&#160;<br/>may&#160;occur while&#160;manually&#160;moving and expanding a&#160;cursor.&#160;This&#160;behavior is&#160;not&#160;documented, but&#160;it&#160;has&#160;been&#160;<br/>observed in OOo 1.1.0, and like&#160;all&#160;undocumented&#160;behavior,&#160;it&#160;may&#160;change&#160;at&#160;any&#160;time.&#160;The&#160;text&#160;object&#160;can&#160;<br/>compare&#160;two ranges&#160;(see<a href="libremacros.html#394">&#160;Table&#160;133), but</a>&#160;the&#160;text&#160;object&#160;must&#160;contain&#160;both text&#160;ranges—a&#160;text&#160;range&#160;has&#160;the&#160;<br/>getText() object&#160;method to&#160;return the&#160;text&#160;object&#160;that&#160;contains&#160;the&#160;text&#160;range.<br/>
<i><b>Table&#160;133.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.text.XTextRangeCompare&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
compareRegionStarts(XTextRange,&#160;<br/>
•<br/>
Return 1&#160;if&#160;the&#160;first&#160;range&#160;starts before&#160;the&#160;second.<br/>
XTextRange)<br/>
•<br/>
Return 0&#160;if&#160;the&#160;first&#160;range&#160;starts at&#160;the&#160;same&#160;<br/>position&#160;as&#160;the&#160;second.<br/>
•<br/>
Return -1&#160;if&#160;the&#160;first&#160;range&#160;starts&#160;after&#160;the&#160;second.<br/>
compareRegionEnds(XTextRange,&#160;<br/>
•<br/>
Return 1&#160;if&#160;the&#160;first&#160;range&#160;ends&#160;before&#160;the&#160;second.<br/>
XTextRange)<br/>
•<br/>
Return 0&#160;if&#160;the&#160;first&#160;range&#160;ends&#160;at&#160;the&#160;same&#160;<br/>position&#160;as&#160;the&#160;second.<br/>
•<br/>
Return -1&#160;if&#160;the&#160;first&#160;range&#160;ends after&#160;the&#160;second.<br/>
<i><b>&#160;14.6.&#160;Selected&#160;text<br/></b></i>Selected text&#160;refers&#160;to the&#160;text&#160;that&#160;has&#160;been selected by&#160;a&#160;user,&#160;probably&#160;using the&#160;keyboard or the&#160;mouse.&#160;<br/>Selected text&#160;is&#160;represented&#160;as&#160;nothing&#160;more&#160;than&#160;a&#160;text&#160;range.&#160;After you&#160;find a&#160;text&#160;selection, it’s&#160;possible&#160;to&#160;<br/>get&#160;the&#160;text&#160;[getString()] and set&#160;the&#160;text&#160;[setString()].&#160;Although strings&#160;are&#160;limited to&#160;64KB&#160;in&#160;size,&#160;<br/>selections&#160;are&#160;not.&#160;There&#160;are&#160;some&#160;instances, therefore, when you&#160;can’t&#160;use&#160;the&#160;getString() and setString()&#160;<br/>methods.&#160;Therefore, it’s&#160;probably&#160;better to use&#160;a&#160;cursor to traverse&#160;the&#160;selected&#160;text&#160;and then use&#160;the&#160;cursor’s&#160;<br/>text&#160;object&#160;to insert&#160;text&#160;content.&#160;Most&#160;problems&#160;using selected&#160;text&#160;look&#160;the&#160;same&#160;at&#160;an abstract&#160;level.&#160;<br/>
If nothing is selected then<br/>&#160; do work on entire document<br/>else<br/>
391<br/>
<hr/>
<a name=395></a>&#160; for each selected area<br/>&#160; &#160; do work on selected area<br/>
The&#160;difficult&#160;part&#160;that&#160;changes&#160;each time&#160;is&#160;writing a&#160;macro that&#160;iterates&#160;over a&#160;selection or between two text&#160;<br/>ranges.<br/>
<b>&#160;14.6.1.&#160;Is&#160;text&#160;selected?<br/></b>Text&#160;documents&#160;support&#160;the&#160;XTextSectionsSupplier interface&#160;(see<a href="libremacros.html#364">&#160;Table&#160;122)</a>, which defines&#160;the&#160;single&#160;<br/>method&#160;getCurrentSelection(). If&#160;there&#160;is&#160;no current&#160;controller (which means&#160;that&#160;you’re&#160;an advanced user&#160;<br/>running OpenOffice.org&#160;as&#160;a&#160;server with&#160;no user interface&#160;and you&#160;won’t&#160;be&#160;looking for selected text&#160;<br/>anyway),&#160;getCurrentSelection() returns&#160;a&#160;null&#160;rather than any&#160;selected&#160;text.<br/>
If&#160;the&#160;selection&#160;count&#160;is&#160;zero, nothing is&#160;selected.&#160;I&#160;have&#160;never seen a&#160;selection&#160;count&#160;of zero, but&#160;I&#160;check for&#160;<br/>it&#160;anyway.&#160;If&#160;no text&#160;is&#160;selected, there&#160;is&#160;one&#160;selection of zero length—the&#160;start&#160;and end positions&#160;are&#160;the&#160;<br/>same.&#160;I&#160;have&#160;seen examples,&#160;which I&#160;consider unsafe, where&#160;a&#160;zero-length selection is&#160;determined&#160;as&#160;follows:<br/>
If&#160;Len(oSel.getString())&#160;=&#160;0&#160;Then&#160;nothing&#160;is&#160;selected<br/>
It&#160;is&#160;possible&#160;that&#160;selected&#160;text&#160;will&#160;contain&#160;more&#160;than 64KB characters, and a&#160;string cannot&#160;contain&#160;more&#160;<br/>than 64KB characters.&#160;Therefore, don’t&#160;check the&#160;length&#160;of the&#160;selected string&#160;to&#160;see&#160;if&#160;it&#160;is&#160;zero;&#160;this&#160;is&#160;not&#160;<br/>safe.&#160;The&#160;better solution is&#160;to create&#160;a&#160;text&#160;cursor from&#160;the&#160;selected range&#160;and then check to see&#160;if the&#160;start&#160;<br/>and end points&#160;are&#160;the&#160;same.&#160;<br/>
oCursor&#160;=&#160;oDoc.Text.CreateTextCursorByRange(oSel)<br/>If&#160;oCursor.IsCollapsed()&#160;Then&#160;nothing&#160;is&#160;selected<br/>
The&#160;macro function in<a href="libremacros.html#395">&#160;Listing 355&#160;pe</a>rforms&#160;the&#160;entire&#160;check, returning&#160;True&#160;if&#160;something is&#160;selected, and&#160;<br/>False&#160;if nothing is&#160;selected.<br/>
<i><b>Listing&#160;355.&#160;</b>Determine&#160;if&#160;anything is&#160;selected.<br/></i>Function&#160;IsAnythingSelected(oDoc&#160;As&#160;Object)&#160;As&#160;Boolean<br/>&#160;&#160;Dim&#160;oSelections&#160;'Contains all of the selections<br/>&#160;&#160;Dim&#160;oSel&#160; &#160; &#160; &#160;&#160;'Contains one specific selection<br/>&#160;&#160;Dim&#160;oCursor&#160; &#160; &#160;'Text cursor to check for a collapsed range &#160;<br/>&#160;&#160;REM Assume nothing is selected<br/>&#160;&#160;IsAnythingSelected&#160;=&#160;False<br/>&#160;&#160;If&#160;IsNull(oDoc)&#160;Then&#160;Exit&#160;Function<br/>&#160;&#160;' The current selection in the current controller.&#160;<br/>&#160;&#160;'If there is no current controller, it returns NULL.<br/>&#160;&#160;oSelections&#160;=&#160;oDoc.getCurrentSelection()<br/>&#160;&#160;If&#160;IsNull(oSelections)&#160;Then&#160;Exit&#160;Function<br/>&#160;&#160;If&#160;oSelections.getCount()&#160;=&#160;0&#160;Then&#160;Exit&#160;Function<br/>&#160;&#160;If&#160;oSelections.getCount()&#160;&gt;&#160;1&#160;Then<br/>&#160; &#160;&#160;REM There is more than one selection so return True<br/>&#160; &#160;&#160;IsAnythingSelected&#160;=&#160;True<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;REM There is only one selection so obtain the first selection<br/>&#160; &#160;&#160;oSel&#160;=&#160;oSelections.getByIndex(0)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Create a text cursor that covers the range and then see if it is<br/>&#160; &#160;&#160;REM collapsed.<br/>&#160; &#160;&#160;oCursor&#160;=&#160;oDoc.Text.CreateTextCursorByRange(oSel)<br/>&#160; &#160;&#160;If&#160;Not&#160;oCursor.IsCollapsed()&#160;Then&#160;IsAnythingSelected&#160;=&#160;True<br/>
392<br/>
<hr/>
<a name=396></a>&#160; &#160;&#160;REM You can also compare these to see if the selection starts and ends at<br/>&#160; &#160;&#160;REM the same location.<br/>&#160; &#160;&#160;REM If oDoc.Text.compareRegionStarts(oSel.getStart(),_<br/>&#160; &#160;&#160;REM &#160; &#160; &#160;oSel.getEnd()) &lt;&gt; 0 Then<br/>&#160; &#160;&#160;REM &#160;IsAnythingSelected = True<br/>&#160; &#160;&#160;REM End If<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
Obtaining a&#160;selection is&#160;complicated because&#160;it’s&#160;possible&#160;to&#160;have&#160;multiple&#160;non-contiguous&#160;selections. Some&#160;<br/>selections&#160;are&#160;empty&#160;and some&#160;are&#160;not.&#160;If&#160;you&#160;write&#160;code&#160;to handle&#160;text&#160;selection,&#160;it&#160;should handle&#160;all&#160;of these<br/>cases&#160;because&#160;they&#160;occur frequently.&#160;The&#160;example&#160;in<a href="libremacros.html#396">&#160;Listing 356&#160;i</a>terates&#160;through all&#160;selected&#160;sections&#160;and&#160;<br/>displays&#160;them&#160;in a&#160;message&#160;box.<br/>
<i><b>Listing&#160;356.&#160;</b>Display&#160;selected text.</i><br/>
Sub&#160;PrintMultipleTextSelection<br/>&#160;&#160;Dim&#160;oSelections&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Contains all of the selections<br/>&#160;&#160;Dim&#160;oSel&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Contains one specific selection<br/>&#160;&#160;Dim&#160;lWhichSelection&#160;As&#160;Long&#160;'Which selection to print<br/>&#160;&#160;<br/>&#160;&#160;If&#160;NOT&#160;IsAnythingSelected(ThisComponent)&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;Nothing is selected&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oSelections&#160;=&#160;ThisComponent.getCurrentSelection()<br/>&#160; &#160;&#160;For&#160;lWhichSelection&#160;=&#160;0&#160;To&#160;oSelections.getCount()&#160;-&#160;1<br/>&#160; &#160; &#160;&#160;oSel&#160;=&#160;oSelections.getByIndex(lWhichSelection)<br/>&#160; &#160; &#160;&#160;MsgBox&#160;oSel.getString(),&#160;0,&#160;&#34;Selection &#34;&#160;&amp;&#160;lWhichSelection<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
<b>&#160;14.6.2.&#160;Selected&#160;text:&#160;Which&#160;end&#160;is&#160;which?<br/></b>Selections&#160;are&#160;text&#160;ranges&#160;with&#160;a&#160;start&#160;and an end.&#160;Although selections&#160;have&#160;both&#160;a&#160;start&#160;and an end, which&#160;<br/>side&#160;of the&#160;text&#160;is&#160;which is&#160;determined&#160;by&#160;the&#160;selection method. For example,&#160;position the&#160;cursor in the&#160;<br/>middle&#160;of a&#160;line,&#160;and then select&#160;text&#160;by&#160;moving the&#160;cursor either right&#160;or left. In&#160;both cases, the&#160;start&#160;position<br/>is&#160;the&#160;same.&#160;In&#160;one&#160;of these&#160;cases, the&#160;start&#160;position&#160;is&#160;after the&#160;end position.&#160;The&#160;text&#160;object&#160;provides&#160;<br/>methods&#160;to compare&#160;starting and ending positions&#160;of text&#160;ranges&#160;(see<a href="libremacros.html#394">&#160;Table&#160;133)</a>. I&#160;use&#160;the&#160;two methods&#160;i<a href="libremacros.html#396">n<br/>Listing 357&#160;t</a>o find&#160;the&#160;leftmost&#160;and rightmost&#160;cursor position of selected text.<br/>
<i><b>Listing&#160;357.&#160;</b>Get&#160;left&#160;and right&#160;cursor.</i><br/>
'oSel is a text selection or cursor range<br/>'oText is the text object<br/>Function&#160;GetLeftMostCursor(oSel,&#160;oText)<br/>&#160;&#160;Dim&#160;oRange<br/>&#160;&#160;Dim&#160;oCursor<br/>
&#160;&#160;If&#160;oText.compareRegionStarts(oSel.getEnd(),&#160;oSel)&#160;&gt;=&#160;0&#160;Then<br/>&#160; &#160;&#160;oRange&#160;=&#160;oSel.getEnd()<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oRange&#160;=&#160;oSel.getStart()<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;oCursor&#160;=&#160;oText.CreateTextCursorByRange(oRange)<br/>&#160;&#160;oCursor.goRight(0,&#160;False)<br/>
393<br/>
<hr/>
<a name=397></a>&#160;&#160;GetLeftMostCursor&#160;=&#160;oCursor<br/>End&#160;Function<br/>
'oSel is a text selection or cursor range<br/>'oText is the text object<br/>Function&#160;GetRightMostCursor(oSel,&#160;oText)<br/>&#160;&#160;Dim&#160;oRange<br/>&#160;&#160;Dim&#160;oCursor<br/>&#160;&#160;<br/>&#160;&#160;If&#160;oText.compareRegionStarts(oSel.getEnd(),&#160;oSel)&#160;&gt;=&#160;0&#160;Then<br/>&#160; &#160;&#160;oRange&#160;=&#160;oSel.getStart()<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oRange&#160;=&#160;oSel.getEnd()<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;oCursor&#160;=&#160;oText.CreateTextCursorByRange(oRange)<br/>&#160;&#160;oCursor.goLeft(0,&#160;False)<br/>&#160;&#160;GetRightMostCursor&#160;=&#160;oCursor<br/>End&#160;Function<br/>
While&#160;using text&#160;cursors&#160;to move&#160;through a&#160;document, I&#160;noticed that&#160;cursors&#160;remember the&#160;direction in&#160;<br/>which&#160;they&#160;are&#160;traveling.&#160;The&#160;cursors&#160;returned by&#160;the&#160;macros&#160;in<a href="libremacros.html#396">&#160;Listing 357&#160;a</a>re&#160;oriented to&#160;travel&#160;into&#160;the&#160;<br/>text&#160;selection&#160;by&#160;moving&#160;the&#160;cursor left&#160;or right&#160;zero characters.&#160;This&#160;is&#160;also an issue&#160;while&#160;moving&#160;a&#160;cursor&#160;<br/>to the&#160;right&#160;and then&#160;turning it&#160;around to move&#160;left. I&#160;always&#160;start&#160;by&#160;moving the&#160;cursor zero characters&#160;in&#160;the<br/>desired direction before&#160;actually&#160;moving the&#160;cursor.&#160;Then my&#160;macro can use&#160;these&#160;cursors&#160;to&#160;traverse&#160;the&#160;<br/>selected text&#160;from&#160;the&#160;start&#160;(moving&#160;right)&#160;or the&#160;end (moving left).<br/>
<b>&#160;14.6.3.&#160;Selected&#160;text&#160;framework<br/></b>While&#160;dealing&#160;with&#160;selected text, I&#160;use&#160;a&#160;framework that&#160;returns&#160;a&#160;two-dimensional&#160;array&#160;of start&#160;and end&#160;<br/>cursors&#160;over which&#160;to iterate. Using a&#160;framework allows&#160;me&#160;to&#160;use&#160;a&#160;very&#160;minimal&#160;code&#160;base&#160;to&#160;iterate&#160;over&#160;<br/>selected text&#160;or the&#160;entire&#160;document. If&#160;no text&#160;is&#160;selected, the&#160;framework asks&#160;if the&#160;macro should&#160;use&#160;the&#160;<br/>entire&#160;document.&#160;If&#160;the&#160;answer is&#160;yes, a&#160;cursor is&#160;created at&#160;the&#160;start&#160;and the&#160;end of the&#160;document. If&#160;text&#160;is&#160;<br/>selected, each selection is&#160;retrieved,&#160;and a&#160;cursor is&#160;obtained at&#160;the&#160;start&#160;and end of each selection.&#160;Se<a href="libremacros.html#397">e<br/>Listing 358.</a><br/>
<i><b>Listing&#160;358.</b>&#160;Create&#160;cursors&#160;with&#160;selected areas.</i><br/>
'sPrompt : How to ask if should iterate over the entire text<br/>'oCursors() : Has the return cursors<br/>'Returns True if should iterate and False if should not<br/>Function&#160;CreateSelectedTextIterator(oDoc,&#160;sPrompt$,&#160;oCursors())&#160;As&#160;Boolean<br/>&#160;&#160;Dim&#160;oSelections&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Contains all of the selections<br/>&#160;&#160;Dim&#160;oSel&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Contains one specific selection<br/>&#160;&#160;Dim&#160;oText&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Document text object<br/>&#160;&#160;Dim&#160;lSelCount&#160;As&#160;Long&#160; &#160; &#160; &#160;'Number of selections<br/>&#160;&#160;Dim&#160;lWhichSelection&#160;As&#160;Long&#160;'Current selection<br/>&#160;&#160;Dim&#160;oLCursor,&#160;oRCursor&#160; &#160; &#160;&#160;'Temporary cursors<br/>&#160;&#160;CreateSelectedTextIterator&#160;=&#160;True<br/>&#160;&#160;oText&#160;=&#160;oDoc.Text<br/>&#160;&#160;If&#160;Not&#160;IsAnythingSelected(oDoc)&#160;Then<br/>&#160; &#160;&#160;Dim&#160;i%<br/>&#160; &#160;&#160;i%&#160;=&#160;MsgBox(&#34;No text selected!&#34;&#160;+&#160;CHR$(13)&#160;+&#160;sPrompt,&#160;_<br/>&#160; &#160; &#160;&#160;1&#160;OR&#160;32&#160;OR&#160;256,&#160;&#34;Warning&#34;)<br/>&#160; &#160;&#160;If&#160;i%&#160;=&#160;1&#160;Then<br/>
394<br/>
<hr/>
<a name=398></a>&#160; &#160; &#160;&#160;oLCursor&#160;=&#160;oText.createTextCursorByRange(oText.getStart())<br/>&#160; &#160; &#160;&#160;oRCursor&#160;=&#160;oText.createTextCursorByRange(oText.getEnd())<br/>&#160; &#160; &#160;&#160;oCursors&#160;=&#160;DimArray(0,&#160;1)&#160;&#160;'Two-Dimensional array with one row<br/>&#160; &#160; &#160;&#160;oCursors(0,&#160;0)&#160;=&#160;oLCursor<br/>&#160; &#160; &#160;&#160;oCursors(0,&#160;1)&#160;=&#160;oRCursor<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;oCursors&#160;=&#160;DimArray()&#160; &#160; &#160;&#160;'Return an empty array<br/>&#160; &#160; &#160;&#160;CreateSelectedTextIterator&#160;=&#160;False<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oSelections&#160;=&#160;oDoc.getCurrentSelection()<br/>&#160; &#160;&#160;lSelCount&#160;=&#160;oSelections.getCount()<br/>&#160; &#160;&#160;oCursors&#160;=&#160;DimArray(lSelCount&#160;-&#160;1,&#160;1)<br/>&#160; &#160;&#160;For&#160;lWhichSelection&#160;=&#160;0&#160;To&#160;lSelCount&#160;-&#160;1<br/>&#160; &#160; &#160;&#160;oSel&#160;=&#160;oSelections.getByIndex(lWhichSelection)<br/>&#160; &#160; &#160;&#160;oLCursor&#160;=&#160;GetLeftMostCursor(oSel,&#160;oText)<br/>&#160; &#160; &#160;&#160;oRCursor&#160;=&#160;GetRightMostCursor(oSel,&#160;oText)<br/>&#160; &#160; &#160;&#160;oCursors(lWhichSelection,&#160;0)&#160;=&#160;oLCursor<br/>&#160; &#160; &#160;&#160;oCursors(lWhichSelection,&#160;1)&#160;=&#160;oRCursor<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
<b>TIP</b><br/>
The&#160;argument&#160;oCursors()&#160;is&#160;an array&#160;that&#160;is set&#160;in&#160;the&#160;macro in<a href="libremacros.html#397">&#160;Listing&#160;358.</a><br/>
The&#160;macro i<a href="libremacros.html#398">n&#160;Listing&#160;359<b>&#160;</b></a>uses&#160;the&#160;selected text&#160;framework to print&#160;the&#160;Unicode&#160;values&#160;of the&#160;selected text.<br/>
<i><b>Listing&#160;359.</b>&#160;Display&#160;Unicode&#160;of&#160;the&#160;selected&#160;text.</i><br/>
Sub&#160;PrintUnicodeExamples<br/>&#160;&#160;Dim&#160;oCursors(),&#160;i%<br/>&#160;&#160;If&#160;Not&#160;CreateSelectedTextIterator(ThisComponent,&#160;_<br/>&#160; &#160;&#160;&#34;Print Unicode for the entire document?&#34;,&#160;oCursors())&#160;Then&#160;Exit&#160;Sub<br/>&#160;&#160;For&#160;i%&#160;=&#160;LBound(oCursors())&#160;To&#160;UBound(oCursors())<br/>&#160; &#160;&#160;PrintUnicode_worker(oCursors(i%,&#160;0),&#160;oCursors(i%,&#160;1),&#160;ThisComponent.Text)<br/>&#160;&#160;Next&#160;i%<br/>End&#160;Sub<br/>
Sub&#160;PrintUnicode_worker(oLCursor,&#160;oRCursor,&#160;oText)<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160;'contains the primary message string<br/>&#160;&#160;Dim&#160;ss&#160;As&#160;String&#160;&#160;'used as a temporary string<br/>
&#160;&#160;If&#160;IsNull(oLCursor)&#160;Or&#160;IsNull(oRCursor)&#160;Or&#160;IsNull(oText)&#160;Then&#160;Exit&#160;Sub<br/>&#160;&#160;If&#160;oText.compareRegionEnds(oLCursor,&#160;oRCursor)&#160;&lt;=&#160;0&#160;Then&#160;Exit&#160;Sub<br/>
&#160;&#160;REM Start the cursor in the correct direction with no text selected<br/>&#160;&#160;oLCursor.goRight(0,&#160;False)<br/>&#160;&#160;Do&#160;While&#160;oLCursor.goRight(1,&#160;True)_<br/>&#160; &#160; &#160;AND&#160;oText.compareRegionEnds(oLCursor,&#160;oRCursor)&#160;&gt;=&#160;0<br/>&#160; &#160;&#160;ss&#160;=&#160;oLCursor.getString()<br/>&#160; &#160;&#160;REM The string may be empty<br/>&#160; &#160;&#160;If&#160;Len(ss)&#160;&gt;&#160;0&#160;Then&#160;<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oLCursor.getString()&#160;&amp;&#160;&#34;=&#34;&#160;&amp;&#160;ASC(oLCursor.getString())&#160;&amp;&#160;&#34; &#34;<br/>&#160; &#160;&#160;End&#160;If<br/>
395<br/>
<hr/>
<a name=399></a>&#160; &#160;&#160;oLCursor.goRight(0,&#160;False)<br/>&#160;&#160;Loop<br/>&#160;&#160;msgBox&#160;s,&#160;0,&#160;&#34;Unicode Values&#34;<br/>End&#160;Sub<br/>
<b>&#160;14.6.4.&#160;Remove&#160;empty&#160;spaces&#160;and&#160;lines:&#160;A&#160;larger&#160;example<br/></b>A&#160;common&#160;request&#160;is&#160;for a&#160;macro that&#160;removes&#160;extra&#160;blank&#160;spaces.&#160;To&#160;remove&#160;all&#160;empty&#160;paragraphs, it’s&#160;<br/>better to&#160;use&#160;the&#160;Remove&#160;Blank Paragraphs&#160;option&#160;from&#160;the&#160;AutoCorrect&#160;dialog (<b>Tools&#160;|&#160;AutoCorrect&#160;<br/>Options&#160;|&#160;Options</b>).&#160;To&#160;remove&#160;only&#160;selected&#160;paragraphs&#160;or runs&#160;of blank&#160;space, a&#160;macro is&#160;required.<br/>
This&#160;section&#160;presents&#160;a&#160;set&#160;of macros&#160;that&#160;replaces&#160;all&#160;runs&#160;of white-space&#160;characters&#160;with a&#160;single&#160;white-<br/>space&#160;character.&#160;You can easily&#160;modify&#160;this&#160;macro to delete&#160;different&#160;types&#160;of white&#160;space.&#160;The&#160;different&#160;<br/>types&#160;of space&#160;are&#160;ordered by&#160;importance, so if you have&#160;a&#160;regular space&#160;followed by&#160;a&#160;new&#160;paragraph, the&#160;<br/>new&#160;paragraph stays&#160;and the&#160;single&#160;space&#160;is&#160;removed.&#160;The&#160;end effect&#160;is&#160;that&#160;leading and trailing white&#160;space&#160;<br/>is&#160;removed from&#160;each line.<br/>
<i><b>What&#160;is&#160;white&#160;space?<br/></b></i>The&#160;term&#160;“white&#160;space”&#160;typically&#160;refers&#160;to any&#160;character that&#160;is&#160;displayed as&#160;a&#160;blank space.&#160;This&#160;includes&#160;tabs<br/>(ASCII&#160;value&#160;9), regular spaces&#160;(ASCII&#160;value&#160;32), non-breaking spaces&#160;(ASCII&#160;value&#160;160), new&#160;paragraphs&#160;<br/>(ASCII&#160;value&#160;13), and new&#160;lines&#160;(ASCII&#160;value&#160;10). By&#160;encapsulating&#160;the&#160;definition&#160;of white&#160;space&#160;into&#160;a&#160;<br/>function (see<a href="libremacros.html#399">&#160;Listing&#160;360), y</a>ou&#160;can trivially&#160;change&#160;the&#160;definition of white&#160;space&#160;to&#160;ignore&#160;certain&#160;characters.<br/>
<i><b>Listing&#160;360.</b>&#160;Determine&#160;if&#160;a character&#160;is&#160;white&#160;space.</i><br/>
Function&#160;IsWhiteSpace(iChar&#160;As&#160;Integer)&#160;As&#160;Boolean<br/>&#160;&#160;Select&#160;Case&#160;iChar<br/>&#160;&#160;Case&#160;9,&#160;10,&#160;13,&#160;32,&#160;160<br/>&#160; &#160;&#160;IsWhiteSpace&#160;=&#160;True<br/>&#160;&#160;Case&#160;Else<br/>&#160; &#160;&#160;IsWhiteSpace&#160;=&#160;False<br/>&#160;&#160;End&#160;Select&#160;&#160;<br/>End&#160;Function<br/>
If&#160;time&#160;is&#160;a&#160;serious&#160;issue, it&#160;is&#160;faster to create&#160;an array&#160;that&#160;is&#160;indexed&#160;by&#160;the&#160;Unicode&#160;value&#160;that&#160;contains&#160;true&#160;<br/>or false&#160;to&#160;indicate&#160;if a&#160;character is&#160;white&#160;space.&#160;The&#160;problem&#160;is&#160;that&#160;the&#160;array&#160;must&#160;be&#160;set&#160;before&#160;the&#160;call.<br/>
&#160;&#160;For&#160;i&#160;=&#160;LBound(isWhiteArray)&#160;To&#160;UBound(isWhiteArray)&#160;<br/>&#160; &#160;&#160;isWhiteArray(i)&#160;=&#160;False<br/>&#160;&#160;Next<br/>&#160;&#160;isWhiteArray(9)&#160;=&#160;True<br/>&#160;&#160;isWhiteArray(10)&#160;=&#160;True<br/>&#160;&#160;isWhiteArray(13)&#160;=&#160;True<br/>&#160;&#160;isWhiteArray(32)&#160;=&#160;True<br/>&#160;&#160;isWhiteArray(160)&#160;=&#160;True<br/>
The&#160;function to&#160;test&#160;is&#160;as&#160;follows:<br/>
Function&#160;IsWhiteSpace2(iChar&#160;As&#160;Integer)&#160;As&#160;Boolean<br/>&#160;&#160;If&#160;iChar&#160;&gt;&#160;UBound(isWhiteArray)&#160;Then<br/>&#160; &#160;&#160;IsWhiteSpace2&#160;=&#160;False<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;IsWhiteSpace2&#160;=&#160;isWhiteArray(iChar)<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
396<br/>
<hr/>
<a name=400></a><i><b>Rank&#160;characters&#160;for&#160;deletion<br/></b></i>While&#160;removing runs&#160;of white&#160;space, each character is&#160;compared to&#160;the&#160;character before&#160;it.&#160;If&#160;both characters&#160;<br/>are&#160;white&#160;space, the&#160;less&#160;important&#160;character is&#160;deleted.&#160;For&#160;example, if there&#160;is&#160;both&#160;a&#160;space&#160;and a&#160;new&#160;<br/>paragraph, the&#160;space&#160;is&#160;deleted.&#160;The&#160;RankChar() function (see<a href="libremacros.html#400">&#160;Listing&#160;361) a</a>ccepts&#160;two characters:&#160;the&#160;<br/>previous&#160;character and the&#160;current&#160;character.&#160;The&#160;returned integer indicates&#160;which,&#160;if any,&#160;character should&#160;be<br/>deleted.<br/>
<i><b>Listing&#160;361.</b>&#160;Rank&#160;characters&#160;for&#160;deletion.<br/></i>'-1 means delete the previous character<br/>' 0 means ignore this character<br/>' 1 means delete this character<br/>' If an input character is 0, this is the start of a line.<br/>' Rank from highest to lowest is: 0, 13, 10, 9, 160, 32<br/>Function&#160;RankChar(iPrevChar,&#160;iCurChar)&#160;As&#160;Integer<br/>&#160;&#160;If&#160;Not&#160;IsWhiteSpace(iCurChar)&#160;Then&#160; &#160; &#160;&#160;'Current not white space, ignore it<br/>&#160; &#160;&#160;RankChar&#160;=&#160;0<br/>&#160;&#160;ElseIf&#160;iPrevChar&#160;=&#160;0&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Line start, current is white space<br/>&#160; &#160;&#160;RankChar&#160;=&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' &#160; &#160; &#160;delete the current character.<br/>&#160;&#160;ElseIf&#160;Not&#160;IsWhiteSpace(iPrevChar)&#160;Then&#160;'Current is space but not previous<br/>&#160; &#160;&#160;RankChar&#160;=&#160;0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' &#160; &#160; &#160; ignore the current character.<br/>&#160; &#160;&#160;<br/>&#160;&#160;REM At this point, both characters are white space<br/>&#160;&#160;ElseIf&#160;iPrevChar&#160;=&#160;13&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Previous is highest ranked space<br/>&#160; &#160;&#160;RankChar&#160;=&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' &#160; &#160; &#160;delete the current character.<br/>&#160;&#160;ElseIf&#160;iCurChar&#160;=&#160;13&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Current is highest ranked space<br/>&#160; &#160;&#160;RankChar&#160;=&#160;-1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' &#160; &#160; delete the previous character.<br/>
&#160;&#160;REM Neither character is a new paragraph, the highest ranked<br/>&#160;&#160;ElseIf&#160;iPrevChar&#160;=&#160;10&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Previous is new line<br/>&#160; &#160;&#160;RankChar&#160;=&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' &#160; &#160; &#160;delete the current character.<br/>&#160;&#160;ElseIf&#160;iCurChar&#160;=&#160;10&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Current is new line<br/>&#160; &#160;&#160;RankChar&#160;=&#160;-1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' &#160; &#160; delete the previous character.<br/>
&#160;&#160;REM At this point, the highest ranking possible is a tab<br/>&#160;&#160;ElseIf&#160;iPrevChar&#160;=&#160;9&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Previous char is tab<br/>&#160; &#160;&#160;RankChar&#160;=&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' &#160; &#160; &#160;delete the current character.<br/>&#160;&#160;ElseIf&#160;iCurChar&#160;=&#160;9&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Current char is tab<br/>&#160; &#160;&#160;RankChar&#160;=&#160;-1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' &#160; &#160; delete the previous character.<br/>&#160;&#160;ElseIf&#160;iPrevChar&#160;=&#160;160&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Previous char is a hard space<br/>&#160; &#160;&#160;RankChar&#160;=&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' &#160; &#160; &#160;delete the current character.<br/>&#160;&#160;ElseIf&#160;iCurChar&#160;=&#160;160&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Current char is a hard space<br/>&#160; &#160;&#160;RankChar&#160;=&#160;-1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' &#160; &#160; delete the previous character.<br/>&#160;&#160;ElseIf&#160;iPrevChar&#160;=&#160;32&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Previous char is a regular space<br/>&#160; &#160;&#160;RankChar&#160;=&#160;1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' &#160; &#160; &#160;delete the current character.<br/>
&#160;&#160;REM Probably should never get here... both characters are white space<br/>&#160;&#160;REM and the previous is not any known white space character.<br/>&#160;&#160;ElseIf&#160;iCurChar&#160;=&#160;32&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Current char is a regular space<br/>&#160; &#160;&#160;RankChar&#160;=&#160;-1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' &#160; &#160; delete the previous character.<br/>&#160;&#160;Else&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Should probably not get here<br/>&#160; &#160;&#160;RankChar&#160;=&#160;0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'so simply ignore it!<br/>&#160;&#160;End&#160;If<br/>
397<br/>
<hr/>
<a name=401></a>End&#160;Function<br/>
<i><b>Use&#160;the&#160;standard&#160;framework<br/></b></i>The&#160;standard framework is&#160;used to remove&#160;the&#160;empty&#160;spaces.&#160;The&#160;primary&#160;routine&#160;is&#160;simple&#160;enough that&#160;it&#160;<br/>barely&#160;warrants&#160;mentioning.<br/>
<i><b>Listing&#160;362.&#160;</b>Remove&#160;empty&#160;space.<br/></i>Sub&#160;RemoveEmptySpace<br/>&#160;&#160;Dim&#160;oCursors(),&#160;i%<br/>&#160;&#160;If&#160;Not&#160;CreateSelectedTextIterator(ThisComponent,&#160;_<br/>&#160; &#160;&#160;&#34;ALL empty space will be removed from the ENTIRE document?&#34;,&#160;oCursors())&#160;Then&#160;Exit&#160;Sub<br/>&#160;&#160;For&#160;i%&#160;=&#160;LBOUND(oCursors())&#160;To&#160;UBOUND(oCursors())<br/>&#160; &#160; &#160;RemoveEmptySpaceWorker&#160;(oCursors(i%,&#160;0),&#160;oCursors(i%,&#160;1),&#160;ThisComponent.Text)<br/>&#160;&#160;Next&#160;i%<br/>End&#160;Sub<br/>
<i><b>The&#160;worker&#160;macro<br/></b></i>The&#160;macro i<a href="libremacros.html#401">n&#160;Listing&#160;363&#160;re</a>presents&#160;the&#160;interesting part&#160;of this&#160;problem;&#160;it&#160;decides&#160;what&#160;is&#160;deleted and what&#160;<br/>is&#160;left&#160;untouched. Some&#160;interesting points&#160;should be&#160;noted:<br/>
Because a text cursor is used, the formatting is left unchanged.<br/>A text range (cursor) may contain text content that returns a zero­length string. This includes, for example, <br/>
buttons and graphic images contained in the document. Handling exceptional cases adds complexity to the <br/>
macro. Many tasks are very simple if you ignore the exceptional cases, such as inserted graphics. If you <br/>
know that your macro will run with simple controlled data, you may choose to sacrifice robustness to reduce<br/>
complexity.<a href="libremacros.html#401"> Listing 363 ha</a>ndles the exceptional cases.<br/>If the selected text starts or ends with white space, it will be removed even if it does not start or end the <br/>
document.<br/>
<i><b>Listing&#160;363.&#160;</b>RemoveEmptySpaceWorker.</i><br/>
Sub&#160;RemoveEmptySpaceWorker(oLCursor,&#160;oRCursor,&#160;oText)<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160;'Temporary text string<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160;&#160;'Temporary integer used for comparing text ranges<br/>&#160;&#160;Dim&#160;iLastChar&#160;As&#160;Integer&#160;&#160;'Unicode of last character<br/>&#160;&#160;Dim&#160;iThisChar&#160;As&#160;Integer&#160;&#160;'Unicode of the current character<br/>&#160;&#160;Dim&#160;iRank&#160;As&#160;Integer&#160; &#160; &#160;&#160;'Integer ranking that decides what to delete<br/>&#160;&#160;<br/>&#160;&#160;REM If something is null, then do nothing<br/>&#160;&#160;If&#160;IsNull(oLCursor)&#160;Or&#160;IsNull(oRCursor)&#160;Or&#160;IsNull(oText)&#160;Then&#160;Exit&#160;Sub<br/>
&#160;&#160;REM Ignore any collapsed ranges<br/>&#160;&#160;If&#160;oText.compareRegionEnds(oLCursor,&#160;oRCursor)&#160;&lt;=&#160;0&#160;Then&#160;Exit&#160;Sub<br/>
&#160;&#160;REM Default the first and last character to indicate start of new line<br/>&#160;&#160;iLastChar&#160;=&#160;0<br/>&#160;&#160;iThisChar&#160;=&#160;0<br/>
&#160;&#160;REM Start the leftmost cursor moving toward the end of the document<br/>&#160;&#160;REM and make certain that no text is currently selected.<br/>&#160;&#160;oLCursor.goRight(0,&#160;False)<br/>
398<br/>
<hr/>
<a name=402></a>&#160;&#160;REM At the end of the document, the cursor can no longer move right<br/>&#160;&#160;Do&#160;While&#160;oLCursor.goRight(1,&#160;True)<br/>&#160;&#160;<br/>&#160; &#160;&#160;REM It is possible that the string is zero length.<br/>&#160; &#160;&#160;REM This can happen when stepping over certain objects anchored into<br/>&#160; &#160;&#160;REM the text that contain no text. Extra care must be taken because<br/>&#160; &#160;&#160;REM this routine can delete these items because the cursor steps over<br/>&#160; &#160;&#160;REM them but they have no text length. I arbitrarily call this a regular<br/>&#160; &#160;&#160;REM ASCII character without obtaining the string.<br/>&#160; &#160;&#160;s&#160;=&#160;oLCursor.getString()<br/>&#160; &#160;&#160;If&#160;Len(s)&#160;=&#160;0&#160;Then<br/>&#160; &#160; &#160;&#160;oLCursor.goRight(0,&#160;False)<br/>&#160; &#160; &#160;&#160;iThisChar&#160;=&#160;65<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;iThisChar&#160;=&#160;Asc(oLCursor.getString())<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM If at the last character Then always remove white space<br/>&#160; &#160;&#160;i&#160;=&#160;oText.compareRegionEnds(oLCursor,&#160;oRCursor)<br/>&#160; &#160;&#160;If&#160;i&#160;=&#160;0&#160;Then<br/>&#160; &#160; &#160;&#160;If&#160;IsWhiteSpace(iThisChar)&#160;Then&#160;oLCursor.setString(&#34;&#34;)<br/>&#160; &#160; &#160;&#160;Exit&#160;Do<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM If went past the end then get out<br/>&#160; &#160;&#160;If&#160;i&#160;&lt;&#160;0&#160;Then&#160;Exit&#160;Do<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;iRank&#160;=&#160;RankChar(iLastChar,&#160;iThisChar)<br/>&#160; &#160;&#160;If&#160;iRank&#160;=&#160;1&#160;Then<br/>&#160; &#160; &#160;&#160;REM Ready to delete the current character.<br/>&#160; &#160; &#160;&#160;REM The iLastChar is not changed.<br/>&#160; &#160; &#160;&#160;REM Deleting the current character by setting the text to the<br/>&#160; &#160; &#160;&#160;REM empty string causes no text to be selected.<br/>&#160; &#160; &#160;&#160;'Print &#34;Deleting Current with &#34; + iLastChar + &#34; and &#34; + iThisChar<br/>&#160; &#160; &#160;&#160;oLCursor.setString(&#34;&#34;)<br/>&#160; &#160;&#160;ElseIf&#160;iRank&#160;=&#160;-1&#160;Then<br/>&#160; &#160; &#160;&#160;REM Ready to delete the previous character. One character is already<br/>&#160; &#160; &#160;&#160;REM selected. It was selected by moving right so moving left two<br/>&#160; &#160; &#160;&#160;REM deslects the currently selected character and selects the&#160;<br/>&#160; &#160; &#160;&#160;REM character to the left.<br/>&#160; &#160; &#160;&#160;oLCursor.goLeft(2,&#160;True)<br/>&#160; &#160; &#160;&#160;'Print &#34;Deleting to the left with &#34; + iLastChar + &#34; and &#34; + iThisChar<br/>&#160; &#160; &#160;&#160;oLCursor.setString(&#34;&#34;)<br/>&#160; &#160; &#160;&#160;REM Now the cursor is moved over the current character again but<br/>&#160; &#160; &#160;&#160;REM this time it is not selected.<br/>&#160; &#160; &#160;&#160;oLCursor.goRight(1,&#160;False)<br/>&#160; &#160; &#160;&#160;REM Set the previous character to the current character.<br/>&#160; &#160; &#160;&#160;iLastChar&#160;=&#160;iThisChar<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;REM Instructed to ignore the current character so deselect any text<br/>&#160; &#160; &#160;&#160;REM and then set the last character to the current character.<br/>&#160; &#160; &#160;&#160;oLCursor.goRight(0,&#160;False)<br/>
399<br/>
<hr/>
<a name=403></a>&#160; &#160; &#160;&#160;iLastChar&#160;=&#160;iThisChar<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Loop<br/>End&#160;Sub<br/>
<b>&#160;14.6.5.&#160;Selected&#160;text,&#160;closing&#160;thoughts<br/></b>Anyone&#160;who has&#160;studied algorithms&#160;will&#160;tell&#160;you that&#160;a&#160;better algorithm&#160;is&#160;almost&#160;always&#160;better than a&#160;faster&#160;<br/>computer.&#160;An early&#160;problem&#160;that&#160;I&#160;solved was&#160;counting words&#160;in&#160;selected&#160;text.&#160;I&#160;created&#160;three&#160;solutions&#160;with&#160;<br/>varying degrees&#160;of success.<br/>
My first solution converted the selected text to OOo Basic strings and then manipulated the strings. This <br/>
solution was fast, counting 8000 words in 2.7 seconds. This solution failed when text strings exceeded <br/>
64KB in size, rendering it useless for large documents.<br/>My second solution used a cursor as it walked through the text one character at a time. This solution, <br/>
although able to handle any length of text, required 47 seconds to count the same 8000 words. In other <br/>
words, the users found the solution unusably slow.<br/>My final solution used a word cursor, which counted the words in 1.7 seconds. Unfortunately, sometimes <br/>
the word cursor is sometimes unreliable.<br/>
<b>TIP</b><br/>
To&#160;count&#160;words correctly,&#160;visit&#160;Andrew&#160;Brown’s&#160;useful&#160;macro&#160;Web&#160;site:&#160;<br/><a href="http://www.darwinwars.com/lunatic/bugs/oo_macros.html"><b>http://www.darwinwars.com/lunatic/bugs/oo_macros.html</b>.</a><br/>
<i><b>&#160;14.7.&#160;Search&#160;and&#160;replace<br/></b></i>The&#160;search process&#160;is&#160;directed by&#160;a&#160;search descriptor,&#160;which&#160;is&#160;able&#160;to&#160;search only&#160;the&#160;object&#160;that&#160;created it.&#160;<br/>In&#160;other words, you&#160;cannot&#160;use&#160;the&#160;same&#160;search descriptor to&#160;search multiple&#160;documents.&#160;The&#160;search&#160;<br/>descriptor&#160;specifies&#160;the&#160;search text&#160;and how&#160;the&#160;text&#160;is&#160;searched (see<a href="libremacros.html#403">&#160;Table&#160;134)</a>.&#160;The&#160;search descriptor&#160;is&#160;the&#160;<br/>most&#160;complicated component&#160;of searching.<br/>
<i><b>Table&#160;134.&#160;</b>Properties&#160;of&#160;the&#160;com.sun.star.util.SearchDescriptor&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
SearchBackwards&#160;<br/>
If&#160;True, search the&#160;document&#160;backwards.<br/>
SearchCaseSensitive&#160;<br/>
If&#160;True, the&#160;case&#160;of&#160;the&#160;letters affects&#160;the&#160;search.<br/>
SearchWords&#160;<br/>
If&#160;True, only&#160;complete&#160;words are&#160;found.<br/>
SearchRegularExpression&#160;<br/>
If&#160;True, the&#160;search string&#160;is&#160;treated&#160;as a&#160;regular&#160;expression.<br/>
SearchStyles&#160;<br/>
If&#160;True, text&#160;is&#160;found based&#160;on applied&#160;style&#160;names—not&#160;on the&#160;text&#160;content.<br/>
SearchSimilarity&#160;<br/>
If&#160;True, a&#160;“similarity&#160;search”&#160;is&#160;performed.<br/>
SearchSimilarityRelax&#160;<br/>
If&#160;True, the&#160;properties SearchSimilarityRelax, SearchSimilarityRemove,&#160;<br/>
SearchSimilarityAdd, and SearchSimilarityExchange&#160;are&#160;all&#160;used.<br/>
SearchSimilarityRemove&#160;<br/>
Short&#160;Integer&#160;specifying&#160;how&#160;many&#160;characters may&#160;be&#160;ignored&#160;in a&#160;match.<br/>
SearchSimilarityAdd&#160;<br/>
Short&#160;Integer&#160;specifying&#160;how&#160;many&#160;characters may&#160;be&#160;added in&#160;a&#160;match.<br/>
SearchSimilarityExchange&#160;<br/>
Short&#160;Integer&#160;specifying&#160;how&#160;many&#160;characters may&#160;be&#160;replaced&#160;in a&#160;match.<br/>
400<br/>
<hr/>
<a name=404></a>Although not&#160;included&#160;i<a href="libremacros.html#403">n&#160;Table&#160;134, a</a>&#160;search descriptor supports&#160;the&#160;string property&#160;SearchString, which&#160;<br/>represents&#160;the&#160;string&#160;to&#160;search.&#160;The&#160;XSearchDescriptor interface&#160;defines&#160;the&#160;methods&#160;getSearchString() and&#160;<br/>setSearchString() to&#160;get&#160;and set&#160;the&#160;property&#160;if&#160;you&#160;prefer to&#160;use&#160;a&#160;method rather than directly&#160;setting the&#160;<br/>property.&#160;The&#160;XSearchable&#160;interface&#160;defines&#160;the&#160;methods&#160;used for searching&#160;and creating the&#160;search&#160;<br/>descriptor&#160;(see<a href="libremacros.html#404">&#160;Table&#160;135)</a>.<br/>
<i><b>Table&#160;135.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.util.XSearchable&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
createSearchDescriptor()<br/>
Create&#160;a&#160;new&#160;SearchDescriptor.<br/>
findAll(XSearchDescriptor)<br/>
Return an XindexAccess containing&#160;all&#160;occurrences.<br/>
findFirst(XSearchDescriptor)<br/>
Starting&#160;from&#160;the&#160;beginning&#160;of&#160;the&#160;searchable&#160;object,&#160;return&#160;a&#160;text&#160;<br/>
range&#160;containing&#160;the&#160;first&#160;found text.<br/>
findNext(XTextRange,&#160;XSearchDescriptor)<br/>
Starting&#160;from&#160;the&#160;provided&#160;text&#160;range, return a&#160;text&#160;range&#160;containing&#160;<br/>
the&#160;first&#160;found text.<br/>
The&#160;macro i<a href="libremacros.html#404">n&#160;Listing&#160;364<b>&#160;</b></a>is&#160;very&#160;simple;&#160;it&#160;sets&#160;the&#160;CharWeight&#160;character property&#160;of all&#160;occurrences&#160;of the&#160;<br/>text&#160;“hello”&#160;to com.sun.start.awt.FontWeight.BOLD—text&#160;ranges&#160;support&#160;character and paragraph&#160;<br/>properties.<br/>
<i><b>Listing&#160;364.&#160;</b>Set&#160;all&#160;occurrences&#160;of&#160;the&#160;word&#160;“hello”&#160;to bold&#160;text.</i><br/>
Sub&#160;SetHelloToBold<br/>&#160;&#160;Dim&#160;oDescriptor&#160;&#160;'The search descriptor<br/>&#160;&#160;Dim&#160;oFound&#160; &#160; &#160; &#160;'The found range<br/>
&#160;&#160;oDescriptor&#160;=&#160;ThisComponent.createSearchDescriptor()<br/>&#160;&#160;With&#160;oDescriptor<br/>&#160; &#160;&#160;.SearchString&#160;=&#160;&#34;hello&#34;<br/>&#160; &#160;&#160;.SearchWords&#160;=&#160;true&#160; &#160; &#160; &#160; &#160; &#160;'The attributes default to False<br/>&#160; &#160;&#160;.SearchCaseSensitive&#160;=&#160;False&#160;&#160;'So setting one to False is redundant<br/>&#160;&#160;End&#160;With<br/>
&#160;&#160;' Find the first one<br/>&#160;&#160;oFound&#160;=&#160;ThisComponent.findFirst(oDescriptor)<br/>&#160;&#160;Do&#160;While&#160;Not&#160;IsNull(oFound)<br/>&#160; &#160;&#160;Print&#160;oFound.getString()<br/>&#160; &#160;&#160;oFound.CharWeight&#160;=&#160;com.sun.star.awt.FontWeight.BOLD<br/>&#160; &#160;&#160;oFound&#160;=&#160;ThisComponent.findNext(oFound.End,&#160;oDescriptor)<br/>&#160;&#160;Loop<br/>End&#160;Sub<br/>
<b>&#160;14.7.1.&#160;Searching&#160;selected&#160;text&#160;or&#160;a&#160;specified&#160;range<br/></b>The&#160;trick to&#160;searching a&#160;specified range&#160;of text&#160;is&#160;to&#160;notice&#160;that&#160;you&#160;can use&#160;any&#160;text&#160;range, including a&#160;text&#160;<br/>cursor,&#160;in the&#160;findNext&#160;routine.&#160;After each call&#160;to findNext(), check the&#160;end points&#160;of the&#160;find to&#160;see&#160;if&#160;the&#160;<br/>search went&#160;too&#160;far.&#160;You may,&#160;therefore, constrain&#160;a&#160;search to any&#160;text&#160;range.&#160;The&#160;primary&#160;purpose&#160;of the&#160;<br/>findFirst&#160;method&#160;is&#160;to&#160;obtain&#160;the&#160;initial&#160;text&#160;range&#160;for the&#160;findNext&#160;routine.&#160;You can use&#160;the&#160;selected&#160;text&#160;<br/>framework very&#160;easily&#160;to&#160;search a&#160;range&#160;of text.<br/>
<i><b>Listing&#160;365.&#160;</b>Iterate&#160;through all&#160;occurrences&#160;of&#160;text&#160;between two cursors.</i><br/>
Sub&#160;SearchSelectedWorker(oLCursor,&#160;oRCursor,&#160;oText,&#160;oDescriptor)<br/>&#160;&#160;If&#160;oText.compareRegionEnds(oLCursor,&#160;oRCursor)&#160;&lt;=&#160;0&#160;Then&#160;Exit&#160;Sub<br/>
401<br/>
<hr/>
<a name=405></a>&#160;&#160;oLCursor.goRight(0,&#160;False)<br/>&#160;&#160;Dim&#160;oFound<br/>&#160;&#160;REM There is no reason to perform a findFirst.<br/>&#160;&#160;oFound&#160;=&#160;&#160;oDoc.findNext(oLCursor,&#160;oDescriptor)<br/>&#160;&#160;Do&#160;While&#160;Not&#160;IsNull(oFound)<br/>&#160; &#160;&#160;REM See if we searched past the end<br/>&#160; &#160;&#160;If&#160;-1&#160;=&#160;oText.compareRegionEnds(oFound,&#160;oRCursor)&#160;Then&#160;Exit&#160;Do<br/>&#160; &#160;&#160;Print&#160;oFound.getString()<br/>&#160; &#160;&#160;oFound&#160;=&#160;ThisComponent.findNext(oFound.End,&#160;oDescriptor)<br/>&#160;&#160;Loop<br/>End&#160;Sub<br/>
The&#160;text&#160;object&#160;cannot&#160;compare&#160;two regions&#160;unless&#160;they&#160;both&#160;belong to that&#160;text&#160;object.&#160;Text&#160;that&#160;resides&#160;in a&#160;<br/>different&#160;frame, section,&#160;or even a&#160;text&#160;table, uses&#160;a&#160;different&#160;text&#160;object&#160;than&#160;the&#160;main document&#160;text&#160;object.&#160;<br/>As&#160;an exercise, investigate&#160;what&#160;happens&#160;if the&#160;found text&#160;is&#160;in a&#160;different&#160;text&#160;object&#160;than&#160;the&#160;text&#160;object&#160;that<br/>contains&#160;oRCursor in<a href="libremacros.html#404">&#160;Listing 365. I</a>s&#160;the&#160;code&#160;i<a href="libremacros.html#404">n&#160;Listing&#160;365&#160;robus</a>t?<br/>
<b>Searching&#160;for&#160;all&#160;occurrences<br/></b>It&#160;is&#160;significantly&#160;faster to&#160;search for all&#160;occurrences&#160;of the&#160;text&#160;at&#160;one&#160;time&#160;using the&#160;findAll() object&#160;method<br/>than to&#160;repeatedly&#160;call&#160;findNext(). Care&#160;must&#160;be&#160;used, however,&#160;when using all&#160;occurrences&#160;of the&#160;specified&#160;<br/>text.&#160;The&#160;macro in<a href="libremacros.html#405">&#160;Listing 366&#160;i</a>s&#160;an extreme&#160;example&#160;of code&#160;gone&#160;bad on purpose.<br/>
<i><b>Listing&#160;366.&#160;</b>Find&#160;and replace&#160;all&#160;occurrences&#160;of&#160;the&#160;word&#160;“helloxyzzy”.<br/></i>Sub&#160;SimpleSearchHelloXyzzy<br/>&#160;&#160;Dim&#160;oDescriptor&#160;&#160;'The search descriptor<br/>&#160;&#160;Dim&#160;oFound&#160; &#160; &#160; &#160;'The found range<br/>&#160;&#160;Dim&#160;oFoundAll&#160; &#160;&#160;'The found range<br/>&#160;&#160;Dim&#160;n%&#160; &#160; &#160; &#160; &#160; &#160;'General index variable<br/>&#160;&#160;oDescriptor&#160;=&#160;ThisComponent.createSearchDescriptor()<br/>&#160;&#160;oDescriptor.SearchString&#160;=&#160;&#34;helloxyzzy&#34;<br/>&#160;&#160;oFoundAll&#160;=&#160;ThisComponent.findAll(oDescriptor)<br/>&#160;&#160;For&#160;n%&#160;=&#160;0&#160;to&#160;oFoundAll.getCount()-1<br/>&#160; &#160;&#160;oFound&#160;=&#160;oFoundAll.getByIndex(n%)<br/>&#160; &#160;&#160;'Print oFound.getString()<br/>&#160; &#160;&#160;oFound.setString(&#34;hello&#34;&#160;&amp;&#160;n%)<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
The&#160;macro i<a href="libremacros.html#405">n&#160;Listing&#160;366&#160;obt</a>ains&#160;a&#160;list&#160;of text&#160;ranges&#160;that&#160;encapsulate&#160;the&#160;text&#160;“helloxyzzy”.&#160;This&#160;text&#160;is&#160;then<br/>replaced with&#160;a&#160;shorter piece&#160;of text.&#160;In&#160;a&#160;perfect&#160;world,&#160;the&#160;occurrences&#160;of “helloxyzzy”&#160;would be&#160;replaced&#160;<br/>with “hello0”, “hello1”,&#160;“hello2”, ...&#160;When&#160;each instance&#160;is&#160;replaced with&#160;the&#160;shorter text,&#160;the&#160;total&#160;length&#160;of&#160;<br/>the&#160;document&#160;changes. Remember that&#160;the&#160;text-range&#160;objects&#160;were&#160;all&#160;obtained&#160;before&#160;the&#160;first&#160;instance&#160;of&#160;<br/>text&#160;is&#160;modified.&#160;Although the&#160;text-range&#160;interface&#160;is&#160;clearly&#160;defined, the&#160;internal&#160;workings&#160;are&#160;not.&#160;I&#160;<br/>purposely&#160;created this&#160;example&#160;because&#160;I&#160;expected it&#160;to fail,&#160;and with no defined behavior my&#160;only&#160;option&#160;<br/>was&#160;to create&#160;a&#160;test. Experimentally,&#160;I&#160;observed that&#160;if multiple&#160;occurrences&#160;of “helloxyzzy”&#160;are&#160;contained in&#160;<br/>the&#160;same&#160;word, poor behavior&#160;results.&#160;I&#160;also observed that&#160;if all&#160;occurrences&#160;of “helloxyzzy”&#160;are&#160;contained in<br/>separate&#160;words, everything&#160;works&#160;great,&#160;and only&#160;occurrences&#160;of “helloxyzzy”&#160;are&#160;changed—leaving the&#160;<br/>surrounding text&#160;intact.&#160;I&#160;can but&#160;nod my&#160;head in approval&#160;at&#160;the&#160;brilliance&#160;of the&#160;programmers&#160;that&#160;allow&#160;<br/>this&#160;behavior,&#160;while&#160;remaining cautiously&#160;paranoid, expecting that&#160;code&#160;relying&#160;on this&#160;behavior will&#160;fail&#160;in&#160;<br/>the&#160;future.<br/>
402<br/>
<hr/>
<a name=406></a>Investigating&#160;the&#160;behavior&#160;of the&#160;macro in<a href="libremacros.html#405">&#160;Listing 366&#160;i</a>s&#160;more&#160;than&#160;simple&#160;academics. I&#160;use&#160;a&#160;similar macro&#160;<br/>regularly&#160;in&#160;my&#160;own writing. For&#160;various&#160;reasons, the&#160;numbering used during the&#160;creation&#160;of this&#160;book was&#160;<br/>done&#160;manually&#160;rather than using&#160;the&#160;built-in&#160;numbering capabilities&#160;of OOo—in other words, I&#160;should&#160;have&#160;<br/>read Chapter 5 of&#160;<i>Taming&#160;OpenOffice.org&#160;Writer&#160;1.1</i>&#160;by&#160;Jean&#160;Hollis&#160;Weber.&#160;Manually&#160;inserting numbering is&#160;<br/>a&#160;problem&#160;when a&#160;table, figure, or code&#160;listing is&#160;deleted,&#160;inserted,&#160;or moved.&#160;In&#160;other words, if I&#160;delete&#160;the&#160;<br/>first&#160;table&#160;in my&#160;document, all&#160;of my&#160;tables&#160;will&#160;be&#160;numbered incorrectly.&#160;I&#160;created a&#160;macro that&#160;verifies&#160;that&#160;<br/>the&#160;items&#160;are&#160;sequentially&#160;numbered starting&#160;with&#160;1. Consider tables, for example.&#160;The&#160;table&#160;captions&#160;use&#160;the&#160;<br/>paragraph style&#160;“_table&#160;caption.”&#160;Tables&#160;are&#160;numbered using the&#160;form<a href="libremacros.html#364">&#160;“Table&#160;122.”</a>&#160;The&#160;macro in<a href="libremacros.html#440">&#160;<b>Listing&#160;<br/>390</b>&#160;ve</a>rifies&#160;that&#160;the&#160;captions&#160;are&#160;sequentially&#160;numbered, and it&#160;renumbers&#160;them&#160;if required.&#160;When&#160;the&#160;text&#160;<br/>“Table&#160;#”&#160;is&#160;found in&#160;a&#160;paragraph using the&#160;“_table&#160;caption”&#160;paragraph style, it&#160;is&#160;assumed&#160;to be&#160;identifying&#160;a<br/>table.&#160;The&#160;macro in<a href="libremacros.html#440">&#160;Listing 390&#160;r</a>enumbers&#160;these&#160;based on their occurrence&#160;in&#160;the&#160;document.&#160;Each&#160;<br/>occurrence&#160;of “Table&#160;#”&#160;that&#160;is&#160;not&#160;in&#160;the&#160;“_table&#160;caption”&#160;paragraph style&#160;is&#160;assumed to&#160;be&#160;a&#160;reference&#160;to&#160;a&#160;<br/>table.<br/>
<b>&#160;14.7.2.&#160;Searching&#160;and&#160;replacing<br/></b>You can perform&#160;simple&#160;searching and replacing&#160;by&#160;searching and manually&#160;replacing each found occurrence<br/>with the&#160;replacement&#160;text. OOo also defines&#160;the&#160;XReplaceable&#160;interface, which&#160;adds&#160;the&#160;ability&#160;to&#160;replace&#160;all<br/>occurrences&#160;using one&#160;method.&#160;You must&#160;use&#160;an XReplaceDescriptor&#160;rather than an XSearchDescriptor,&#160;<br/>however.&#160;Replacing all&#160;occurrences&#160;of text&#160;is&#160;very&#160;simple&#160;(see<a href="libremacros.html#406">&#160;Listing&#160;367).</a><br/>
<b>TIP</b><br/>
The&#160;XReplaceable&#160;interface&#160;is derived&#160;from&#160;the&#160;XSearchable&#160;interface, and&#160;the&#160;XReplaceDescriptor&#160;is&#160;<br/>
derived&#160;from&#160;the&#160;XSearchDescriptor&#160;interface.<br/>
<i><b>Listing&#160;367.&#160;</b>Replace&#160;“hello you”&#160;with&#160;“hello&#160;me”.</i><br/>
oDescriptor&#160;=&#160;oDoc.createReplaceDescriptor()<br/>With&#160;oDescriptor<br/>&#160;&#160;.SearchString&#160;=&#160;&#34;hello you&#34;<br/>&#160;&#160;.ReplaceString&#160;=&#160;&#34;hello me&#34;<br/>End&#160;With<br/>oDoc.ReplaceAll(oDescriptor)<br/>
<b>&#160;14.7.3.&#160;Advanced&#160;search&#160;and&#160;replace<br/></b>While&#160;using the&#160;OOo GUI&#160;for searching and replacing, it&#160;is&#160;possible&#160;to search for and replace&#160; attributes&#160;as&#160;<br/>well&#160;as&#160;text.&#160;An inspection of the&#160;search-and-replace&#160;descriptors&#160;reveals&#160;the&#160;object&#160;methods&#160;<br/>setSearchAttributes() and setReplaceAttributes(). I&#160;discovered how&#160;to use&#160;these&#160;object&#160;methods&#160;when I&#160;<br/>found some&#160;code&#160;written&#160;by&#160;Alex&#160;Savitsky,&#160;whom&#160;I&#160;do not&#160;know,&#160;and Laurent&#160;Godard, whom&#160;I&#160;do.&#160;<br/>
The&#160;macro i<a href="libremacros.html#407">n&#160;Listing&#160;368&#160;fi</a>nds&#160;all&#160;text&#160;that&#160;is&#160;in bold type, converts&#160;the&#160;text&#160;to&#160;regular type, and then&#160;<br/>surrounds&#160;the&#160;text&#160;with&#160;two sets&#160;of curly&#160;brackets.&#160;The&#160;conversion of attributes&#160;to&#160;text&#160;tags&#160;is&#160;frequently&#160;done<br/>while&#160;converting&#160;formatted text&#160;to&#160;regular&#160;ASCII&#160;text&#160;with&#160;no special&#160;formatting capabilities.&#160;While&#160;readi<a href="libremacros.html#407">ng<br/>Listing 368, l</a>ook for the&#160;following interesting techniques:<br/>
To search for all text that is bold regardless of the content, you must use a regular expression. In OOo, the <br/>
period matches any single character and the asterisk means “find zero or more occurrences of the previous <br/>
character.” Placed together, the regular expression “.*” matches any text. Regular expressions are required <br/>
to find “any text” that is bold.<br/>While searching regular expressions, the ampersand character is replaced by the found text.<a href="libremacros.html#407"> In Listing 368, </a><br/>
the replacement text “{{ &amp; }}” causes the found text “hello” to become “{{ hello }}”.<br/>
403<br/>
<hr/>
<a name=407></a>Text that is set to bold using an applied style is found only while searching character attributes if <br/>
SearchStyles is set to True. If the SearchStyles attribute is set to False, only text that has been directly set to <br/>
bold will be found.<br/>To search for text with specific attributes, create an array of structures of type PropertyValue. There should <br/>
be one entry in the array for each attribute you want to search. Set the property name to the name of the <br/>
attribute to search, and the property value to the value for which to search. Although this is complicated to <br/>
describe using words, it is clearly shown in<a href="libremacros.html#407"> Listing 368.<br/></a>You can set attribute values by specifying the replacement attributes in the same way that you set the search <br/>
attributes.<br/>
<i><b>Listing&#160;368.&#160;</b>Replace&#160;bold&#160;text.<br/></i>Sub&#160;ReplaceFormatting<br/>&#160;&#160;REM original code : Alex Savitsky<br/>&#160;&#160;REM modified by : Laurent Godard<br/>&#160;&#160;REM modified by : Andrew Pitonyak<br/>&#160;&#160;REM The purpose of this macro is to surround all BOLD elements with {{ }}<br/>&#160;&#160;REM and change the Bold attribute to NORMAL by using a regular expression.<br/>
&#160;&#160;Dim&#160;oReplace<br/>&#160;&#160;Dim&#160;SrchAttributes(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;Dim&#160;ReplAttributes(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>
&#160;&#160;oReplace&#160;=&#160;ThisComponent.createReplaceDescriptor()<br/>
&#160;&#160;oReplace.SearchString&#160;=&#160;&#34;.*&#34;&#160; &#160; &#160; &#160; &#160; &#160;'Regular expression. Match any text<br/>&#160;&#160;oReplace.ReplaceString&#160;=&#160;&#34;{{ &amp; }}&#34;&#160; &#160; &#160;'Note the &amp; places the found text back<br/>&#160;&#160;oReplace.SearchRegularExpression=True&#160;&#160;'Use regular expressions<br/>&#160;&#160;oReplace.searchStyles=True&#160; &#160; &#160; &#160; &#160; &#160; &#160;'We want to search styles<br/>&#160;&#160;oReplace.searchAll=True&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Do the entire document<br/>
&#160;&#160;REM This is the attribute to find<br/>&#160;&#160;SrchAttributes(0).Name&#160;=&#160;&#34;CharWeight&#34;<br/>&#160;&#160;SrchAttributes(0).Value&#160;=com.sun.star.awt.FontWeight.BOLD<br/>
&#160;&#160;REM This is the attribute to replace it with<br/>&#160;&#160;ReplAttributes(0).Name&#160;=&#160;&#34;CharWeight&#34;<br/>&#160;&#160;ReplAttributes(0).Value&#160;=com.sun.star.awt.FontWeight.NORMAL<br/>
&#160;&#160;REM Set the attributes in the replace descriptor<br/>&#160;&#160;oReplace.SetSearchAttributes(SrchAttributes())<br/>&#160;&#160;oReplace.SetReplaceAttributes(ReplAttributes())<br/>
&#160;&#160;REM Now do the work!<br/>&#160;&#160;ThisComponent.replaceAll(oReplace)<br/>End&#160;Sub<br/>
<a href="libremacros.html#408"><b>Table&#160;136&#160;</b></a>lists&#160;the&#160;supported regular expression characters.<br/>
404<br/>
<hr/>
<a name=408></a><i><b>Table&#160;136.&#160;</b>Supported regular&#160;expression characters.</i><br/>
<i><b>Character</b></i><br/>
<i><b>Description</b></i><br/>
.<br/>
A&#160;period&#160;represents&#160;any&#160;single&#160;character.&#160;The&#160;search&#160;term&#160;&#34;sh.rt&#34;&#160;finds both “shirt”&#160;and&#160;<br/>
“short”.<br/>
*<br/>
An&#160;asterisk represents&#160;any&#160;number&#160;of&#160;characters.&#160;The&#160;search term&#160;“sh*rt”&#160;finds “shrt”,&#160;<br/>
“shirt”,&#160;”shiirt”,&#160;“shioibaldawpclasdfa&#160;asdf&#160;asdfrt”&#160;and&#160;“short”—to name&#160;a&#160;few&#160;things&#160;<br/>that&#160;it&#160;can find.<br/>
^<br/>
A&#160;caret&#160;represents the&#160;beginning&#160;of&#160;a&#160;paragraph.&#160;The&#160;search term&#160;“^Bob”&#160;only&#160;finds the&#160;<br/>word “Bob”&#160;if&#160;it&#160;is at&#160;the&#160;beginning&#160;of&#160;a&#160;paragraph.&#160;The&#160;search term&#160;“^.”&#160;finds the&#160;first&#160;<br/>
character&#160;in&#160;a&#160;paragraph.<br/>
$<br/>
A&#160;dollar&#160;sign represents the&#160;end&#160;of&#160;a&#160;paragraph.&#160;The&#160;search term&#160;“Bob$”&#160;only&#160;finds the&#160;<br/>
word “Bob”&#160;if&#160;it&#160;is at&#160;the&#160;end&#160;of&#160;a&#160;paragraph.<br/>
^$<br/>
Search&#160;for&#160;an empty&#160;paragraph.&#160;This&#160;is listed&#160;here&#160;only&#160;because&#160;it&#160;is&#160;used so frequently.<br/>
+<br/>
A&#160;plus sign&#160;indicates&#160;that&#160;the&#160;preceding&#160;character&#160;must&#160;appear&#160;at&#160;least&#160;once.&#160;The&#160;plus&#160;<br/>sign also&#160;works with&#160;the&#160;wildcard&#160;character&#160;“.”. For&#160;example, “t.+s”&#160;finds a&#160;section&#160;of&#160;<br/>
text&#160;that&#160;starts with&#160;a&#160;“t”&#160;and&#160;ends with&#160;an “s”.<br/>
The&#160;longest&#160;possible&#160;text&#160;within&#160;the&#160;paragraph is&#160;always found. In&#160;other&#160;words, multiple&#160;<br/>words may&#160;be&#160;found, but&#160;the&#160;found&#160;text&#160;will&#160;always reside&#160;in the&#160;same&#160;paragraph.<br/>
?<br/>
A&#160;question mark&#160;marks the&#160;previous&#160;character&#160;as optional.&#160;For&#160;example,&#160;you could&#160;find&#160;<br/>words that&#160;include&#160;the&#160;characters that&#160;come&#160;before&#160;the&#160;character&#160;that&#160;is&#160;in&#160;front&#160;of&#160;the&#160;<br/>
“\”.&#160;For&#160;example, “birds?”&#160;finds both “bird”&#160;and “birds”.<br/>
\n<br/>
The&#160;text&#160;“\n”&#160;has two uses.&#160;When searching,&#160;this finds a&#160;hard row&#160;break inserted with&#160;<br/>
Shift+Enter.&#160;In&#160;the&#160;replace&#160;field, this&#160;represents a&#160;paragraph break.&#160;You can,&#160;therefore,&#160;<br/>replace&#160;all&#160;hard breaks with a&#160;paragraph break.<br/>
\t<br/>
The&#160;text&#160;“\t”&#160;is&#160;used&#160;to find a&#160;tab. In&#160;the&#160;replace&#160;field,&#160;this adds a&#160;tab.<br/>
\&gt;<br/>
Using&#160;the&#160;text&#160;“\&gt;”&#160;indicates that&#160;the&#160;preceding&#160;text&#160;must&#160;end a&#160;word. For&#160;example,&#160;<br/>
“book\&gt;”&#160;finds “checkbook”&#160;but&#160;not&#160;“bookmark”.<br/>
\&lt;<br/>
Using&#160;the&#160;text&#160;“\&lt;”&#160;indicates that&#160;the&#160;following&#160;text&#160;must&#160;start&#160;a&#160;word. For&#160;example,&#160;<br/>
“\&lt;book”&#160;finds “bookmark”&#160;but&#160;not&#160;“checkbook”.<br/>
\xXXXX<br/>
A&#160;backslash&#160;followed&#160;by&#160;a&#160;lowercase&#160;x&#160;followed&#160;by&#160;a&#160;four-digit&#160;hexadecimal&#160;number&#160;<br/>
(XXXX)&#160;finds the&#160;character&#160;whose&#160;Unicode&#160;(ASCII)&#160;value&#160;is the&#160;same&#160;as the&#160;four-digit&#160;<br/>hexadecimal&#160;number.<br/>
\<br/>
The&#160;backslash character&#160;followed by&#160;anything&#160;other&#160;than&#160;“n”,&#160;“t”, “&gt;”,&#160;“&lt;”,&#160;or&#160;“x”&#160;is&#160;<br/>used&#160;to specify&#160;the&#160;character&#160;that&#160;follows. For&#160;example,&#160;“\M”&#160;finds “M”.&#160;The&#160;primary&#160;<br/>
purpose&#160;is&#160;to&#160;allow&#160;special&#160;wild characters to be&#160;found. For&#160;example,&#160;assume&#160;that&#160;I&#160;<br/>wanted&#160;to find any&#160;character&#160;preceded&#160;by&#160;a&#160;“+”.&#160;Well, the&#160;“+”&#160;is a&#160;special&#160;character&#160;so I&#160;<br/>
need&#160;to precede&#160;it&#160;with a&#160;“\”.&#160;Use&#160;“.\+”&#160;to find&#160;any&#160;character&#160;preceding&#160;a&#160;“+”&#160;character.<br/>
&amp;<br/>
The&#160;ampersand is&#160;used in&#160;the&#160;replace&#160;text&#160;to add&#160;the&#160;found characters.&#160;In<a href="libremacros.html#407">&#160;Listing&#160;368,&#160;</a><br/>
the&#160;ampersand&#160;is used to&#160;surround all&#160;bold&#160;text&#160;with “{{“&#160;and&#160;“}}”.<br/>
[abc123]<br/>
Match any&#160;character&#160;that&#160;is between square&#160;brackets.&#160;For&#160;example, “t[ex]+t”&#160;finds&#160;<br/>
“text”, “teet”,&#160;and “txeeet”;&#160;to name&#160;a&#160;few&#160;examples of&#160;what&#160;it&#160;finds.<br/>
[a-e]<br/>
The&#160;minus&#160;sign is&#160;used&#160;to define&#160;a&#160;range&#160;when used&#160;inside&#160;of&#160;square&#160;brackets. For&#160;<br/>
example,&#160;“[a-e]”&#160;matches characters&#160;between “a”&#160;and “e”&#160;and&#160;“[a-ex-z]”&#160;matches&#160;<br/>characters between “a”&#160;and “e”&#160;or&#160;<br/>
“x”&#160;and “z”.<br/>
[^a-e]<br/>
Placing&#160;a&#160;caret&#160;symbol&#160;inside&#160;square&#160;brackets will&#160;find anything&#160;but&#160;the&#160;specified&#160;<br/>
characters.&#160;<br/>For&#160;example,&#160;“[^a-e]”&#160;finds any&#160;character&#160;that&#160;is&#160;not&#160;between “a”&#160;and “e”.<br/>
405<br/>
<hr/>
<a name=409></a><i><b>Character</b></i><br/>
<i><b>Description</b></i><br/>
|<br/>
Placing&#160;a&#160;vertical&#160;bar&#160;between&#160;two&#160;search strings will&#160;match what&#160;is&#160;before&#160;and also&#160;<br/>
match&#160;what&#160;is after.&#160;For&#160;example, “bob|jean”&#160;matches the&#160;string&#160;“bob”&#160;and&#160;also&#160;matches&#160;<br/>the&#160;string&#160;“jean”.<br/>
{2}<br/>
Placing&#160;a&#160;number&#160;between&#160;curly&#160;brackets finds that&#160;many&#160;occurrences of&#160;the&#160;previous&#160;<br/>character.&#160;<br/>
For&#160;example,&#160;“me{2}t”&#160;matches “meet”,&#160;and “[0-9]{3}”&#160;matches any&#160;three-digit&#160;<br/>number.&#160;Note&#160;that&#160;<br/>
“[0-9]{3}”&#160;will&#160;also find the&#160;first&#160;three&#160;digits of&#160;a&#160;number&#160;with&#160;more&#160;than three&#160;digits,&#160;<br/>unless&#160;“find&#160;whole&#160;words”&#160;is&#160;also specified.<br/>
{1,2}<br/>
Placing&#160;two numbers separated by&#160;a&#160;comma&#160;between curly&#160;brackets finds the&#160;preceding&#160;<br/>character&#160;a&#160;variable&#160;number&#160;of&#160;times. For&#160;example, “[0-9]{1,4}”&#160;finds&#160;any&#160;number&#160;that&#160;<br/>
contains&#160;between one&#160;and four&#160;digits.<br/>
(&#160;)<br/>
Text&#160;placed&#160;within&#160;parentheses is&#160;treated&#160;as a&#160;reference.&#160;The&#160;text&#160;“\1”&#160;finds the&#160;first&#160;<br/>
reference, “\2”&#160;finds the&#160;second&#160;reference, and so on. For&#160;example, “([0-9]{3})-[0-9]<br/>{2}-\1”&#160;finds&#160;“123-45-123”&#160;but&#160;not&#160;“123-45-678”.<br/>
Parentheses can also be&#160;used&#160;for&#160;grouping. For&#160;example, “(he|she|me)$”&#160;finds any&#160;<br/>
paragraph that&#160;ends&#160;with “he”, “she”, or&#160;“me”.<br/>
[:digit:]<br/>
Finds a&#160;single-digit&#160;number.&#160;For&#160;example,&#160;“[:digit:]?”&#160;finds a&#160;single-digit&#160;number&#160;and&#160;<br/>
“[:digit:]+”&#160;finds any&#160;number&#160;with one&#160;or&#160;more&#160;digits.<br/>
[:space:]<br/>
Finds any&#160;white&#160;space,&#160;such&#160;as spaces and tabs.<br/>
[:print:]<br/>
Finds any&#160;printable&#160;characters.<br/>
[:cntrl:]<br/>
Finds any&#160;non-printing&#160;characters.<br/>
[:alnum:]<br/>
Finds any&#160;alphanumeric&#160;characters (numbers and&#160;text&#160;characters).<br/>
[:alpha:]<br/>
Finds any&#160;alphabetic&#160;characters, both uppercase&#160;and lowercase.<br/>
[:lower:]<br/>
Finds any&#160;lowercase&#160;characters if&#160;“Match case”&#160;is&#160;selected in&#160;the&#160;Options area.<br/>
[:upper:]<br/>
Finds any&#160;uppercase&#160;characters if&#160;“Match case”&#160;is selected&#160;in&#160;the&#160;Options area.<br/>
<i><b>&#160;14.8.&#160;Text&#160;content<br/></b></i>The&#160;primary&#160;purpose&#160;of a&#160;Writer document&#160;is&#160;to&#160;contain&#160;simple&#160;text.&#160;The&#160;text&#160;is&#160;stored and enumerated by&#160;<br/>paragraphs.&#160;When a&#160;paragraph enumerates&#160;content, each enumerated&#160;section uses&#160;the&#160;same&#160;set&#160;of properties.&#160;<br/>In&#160;general, text&#160;content&#160;must&#160;be&#160;created&#160;by&#160;the&#160;document&#160;that&#160;will&#160;contain the&#160;content.&#160;After creation, the&#160;text<br/>content&#160;is&#160;inserted into the&#160;document&#160;at&#160;a&#160;specified&#160;location. Paragraphs, however,&#160;are&#160;not&#160;specifically&#160;<br/>created and then inserted&#160;(see<a href="libremacros.html#367">&#160;Listing 333&#160;ne</a>ar the&#160;beginning of this&#160;chapter). Paragraph text&#160;is&#160;inserted as&#160;a&#160;<br/>string and new&#160;paragraphs&#160;are&#160;inserted&#160;as&#160;control&#160;characters&#160;(see<a href="libremacros.html#365">&#160;Table&#160;123)</a>. More&#160;complicated text&#160;content&#160;<br/>is&#160;typically&#160;added using the&#160;insertTextContent() object&#160;method (see<a href="libremacros.html#368">&#160;Listing&#160;334).&#160;</a>There&#160;are&#160;other,&#160;less-used&#160;<br/>methods&#160;to insert&#160;text&#160;content—for example,&#160;pasting&#160;content&#160;from&#160;the&#160;clipboard (see<a href="libremacros.html#421">&#160;Listing 381&#160;l</a>ater in&#160;this<br/>chapter) and inserting an entire&#160;document&#160;(see<a href="libremacros.html#409">&#160;Listing 369)</a>.<br/>
<i><b>Listing&#160;369.&#160;</b>Insert&#160;a document&#160;at&#160;a text&#160;cursor.&#160;<br/></i>oCursor.insertDocumentFromURL(sFileURL,&#160;Array())<br/>
Most&#160;text&#160;content&#160;is&#160;named&#160;and accessible&#160;in&#160;a&#160;similar way&#160;(see<a href="libremacros.html#410">&#160;<b>Table&#160;137</b>)</a>.&#160;The&#160;most&#160;popular content&#160;type&#160;<br/>i<a href="libremacros.html#410">n&#160;Table&#160;137&#160;i</a>s&#160;undoubtedly&#160;text&#160;tables.<br/>
406<br/>
<hr/>
<a name=410></a><i><b>Table&#160;137.&#160;</b>Content&#160;contained in a text&#160;document.</i><br/>
<i><b>Content&#160;Type</b></i><br/>
<i><b>Mechanism</b></i><br/>
<i><b>Access&#160;Method</b></i><br/>
Footnotes<br/>
Index&#160;Access<br/>
getFootnotes()<br/>
Endnotes<br/>
Index&#160;Access<br/>
getEndnotes()<br/>
Reference&#160;marks<br/>
Named&#160;Access<br/>
getReferenceMarks()<br/>
Graphic&#160;objects<br/>
Named&#160;Access<br/>
getGraphicObjects()<br/>
Embedded&#160;objects<br/>
Named&#160;Access<br/>
getEmbeddedObjects()<br/>
Text&#160;tables<br/>
Named&#160;Access<br/>
getTables()<br/>
Bookmarks<br/>
Named&#160;Access<br/>
getBookmarks()<br/>
Style&#160;families<br/>
Named&#160;Access<br/>
getStyleFamilies()<br/>
Document&#160;indexes<br/>
Index&#160;Access<br/>
getDocumentIndexes()<br/>
Text&#160;fields<br/>
Enumeration&#160;Access<br/>
getTextFields()<br/>
Text&#160;field&#160;masters<br/>
Named&#160;Access<br/>
getTextFieldMasters()<br/>
Text&#160;frames<br/>
Named&#160;Access<br/>
getTextFrames()<br/>
Text&#160;sections<br/>
Named&#160;Access<br/>
getTextSections()<br/>
<b>TIP</b><br/>
Content&#160;accessible&#160;using&#160;named&#160;access&#160;also&#160;provides indexed&#160;access.<br/>
<i><b>&#160;14.9.&#160;Text&#160;tables<br/></b></i>Writer documents&#160;act&#160;as&#160;a&#160;text-tables&#160;supplier,&#160;so you can directly&#160;retrieve&#160;text&#160;tables&#160;from&#160;Writer&#160;<br/>documents.&#160;Although text&#160;tables&#160;are&#160;enumerated&#160;as&#160;text&#160;content&#160;along&#160;with&#160;paragraphs&#160;(see<a href="libremacros.html#369">&#160;Listing&#160;336),&#160;<br/></a>tables&#160;are&#160;more&#160;typically&#160;obtained by&#160;name&#160;or by&#160;index&#160;(see<a href="libremacros.html#410">&#160;<b>Listing 370</b>&#160;a</a>nd<a href="libremacros.html#411"><b>&#160;Figure&#160;94</b>).</a><br/>
<i><b>Listing&#160;370.</b>&#160;Demonstrate&#160;enumerating&#160;text&#160;tables.<br/></i>Sub&#160;EnumrateAllTextTables<br/>&#160;&#160;Dim&#160;oTables&#160;&#160;'All of the text tables<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160;'Work string<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160;'Index variable<br/>&#160;&#160;<br/>&#160;&#160;oTables&#160;=&#160;ThisComponent.TextTables&#160;&#160;REM First, access the tables based on index.<br/>&#160;&#160;s&#160;=&#160;&#34;Tables By Index&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oTables.getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Table &#34;&#160;&amp;&#160;(i+1)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;oTables(i).Name&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;Text Tables By Name&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;Join(oTables.getElementNames(),&#160;CHR$(10))<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Tables&#34;<br/>End&#160;Sub<br/>
407<br/>
<hr/>
<a name=411></a><i><b>Figure&#160;94.&#160;</b>Tables&#160;contained in a document,&#160;by&#160;index&#160;and named access.</i><br/>
<b>TIP</b><br/>
Most&#160;named text&#160;content&#160;is&#160;retrieved,&#160;created,&#160;inserted,&#160;and&#160;disposed&#160;of&#160;in&#160;the&#160;same&#160;way.&#160;Learn to do&#160;this&#160;<br/>using&#160;tables&#160;and&#160;you’ll&#160;be&#160;ready&#160;to use&#160;other&#160;named text&#160;content—bookmarks, for&#160;example.<br/>
As&#160;with&#160;most&#160;text&#160;content,&#160;tables&#160;must&#160;be&#160;created by&#160;the&#160;document&#160;before&#160;they&#160;are&#160;inserted into the&#160;<br/>document.&#160;The&#160;macro in<a href="libremacros.html#411">&#160;Listing 371&#160;i</a>nserts&#160;a&#160;table&#160;named&#160;“SampleTable”&#160;if it&#160;does&#160;not&#160;exist,&#160;and removes&#160;it<br/>if it&#160;does.<br/>
<i><b>Listing&#160;371.&#160;</b>Insert&#160;then&#160;delete&#160;a text&#160;table.&#160;<br/></i>Sub&#160;InsertDeleteTable<br/>&#160;&#160;Dim&#160;oTable&#160; &#160; &#160; &#160;'Newly created table to insert<br/>&#160;&#160;Dim&#160;oTables&#160; &#160; &#160;&#160;'All of the text tables<br/>&#160;&#160;Dim&#160;oInsertPoint&#160;'Where the table will be inserted<br/>&#160;&#160;Dim&#160;sTableName&#160;as&#160;String<br/>&#160;&#160;<br/>&#160;&#160;sTableName&#160;=&#160;&#34;SampleTable&#34;<br/>&#160;&#160;oTables&#160;=&#160;ThisComponent.TextTables<br/>&#160;&#160;<br/>&#160;&#160;If&#160;oTables.hasByName(sTableName)&#160;Then<br/>&#160; &#160;&#160;oTable&#160;=&#160;oTables.getByName(sTableName)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Although this seems like the correct way to remove text content,<br/>&#160; &#160;&#160;REM what if the table is not inserted into the primary document's<br/>&#160; &#160;&#160;REM text object? oTable.dispose() may be safer to use.<br/>&#160; &#160;&#160;ThisComponent.Text.removeTextContent(oTable)<br/>&#160;&#160;Else<br/>
&#160; &#160;&#160;REM Let the document create the text table. &#160;<br/>&#160; &#160;&#160;oTable&#160;=&#160;ThisComponent.createInstance(&#160;&#34;com.sun.star.text.TextTable&#34;&#160;)<br/>&#160; &#160;&#160;oTable.initialize(2,&#160;3)&#160;'Two rows, three columns<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM If there is a bookmark named &#34;InsertTableHere&#34;, then insert<br/>&#160; &#160;&#160;REM the table at that point. If this bookmark does not exist,&#160;<br/>&#160; &#160;&#160;REM then simply choose the very end of the document.<br/>&#160; &#160;&#160;If&#160;ThisComponent.getBookmarks().hasByName(&#34;InsertTableHere&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;oInsertPoint&#160;=_<br/>&#160; &#160; &#160; &#160;&#160;ThisComponent.getBookmarks().getByName(&#34;InsertTableHere&#34;).getAnchor()<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;oInsertPoint&#160;=&#160;ThisComponent.Text.getEnd()<br/>
408<br/>
<hr/>
<a name=412></a>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160; &#160;&#160;REM Now insert the text table at the end of the document.<br/>&#160; &#160;&#160;REM Note that the text object from the oInsertPoint text<br/>&#160; &#160;&#160;REM range is used rather than the document text object.<br/>&#160; &#160;&#160;oInsertPoint.getText().insertTextContent(oInsertPoint&#160;,&#160;oTable,&#160;False)<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;<br/>&#160; &#160;&#160;REM The setData() object method works ONLY with numerical data.<br/>&#160; &#160;&#160;REM The setDataArray() object method, however, also allows strings.<br/>&#160; &#160;&#160;oTable.setDataArray(Array(Array(0,&#160;&#34;One&#34;,&#160;2),&#160;Array(3,&#160;&#34;Four&#34;,&#160;5)))<br/>&#160; &#160;&#160;oTable.setName(sTableName)<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
In&#160;general,&#160;it&#160;is&#160;better&#160;to set&#160;table&#160;properties before&#160;inserting&#160;the&#160;table&#160;into the&#160;document.&#160;This prevents&#160;<br/>
screen flicker&#160;as the&#160;object&#160;is&#160;modified&#160;and&#160;then redrawn on&#160;the&#160;screen.&#160;Due&#160;to a&#160;bug&#160;in&#160;OOo&#160;1.1.0,&#160;i<a href="libremacros.html#411">f<br/>Listing&#160;371&#160;i</a>s modified&#160;to set&#160;the&#160;data&#160;before&#160;inserting&#160;the&#160;table, the&#160;table&#160;name&#160;is&#160;modified and&#160;it&#160;contains&#160;<br/>
an&#160;extra&#160;garbage&#160;character&#160;at&#160;the&#160;end.&#160;Be&#160;warned,&#160;however,&#160;that&#160;some&#160;text&#160;content, such as text&#160;field&#160;<br/>masters,&#160;cannot&#160;change&#160;their&#160;names after&#160;they&#160;have&#160;been inserted&#160;into&#160;a&#160;document.&#160;<br/>
The&#160;macro i<a href="libremacros.html#411">n&#160;Listing&#160;371&#160;de</a>monstrates&#160;many&#160;useful&#160;techniques:<br/>
•<br/>
A named text content is found and obtained. Notice that finding the table and the bookmark are very <br/>
similar processes.<br/>
•<br/>
A bookmark is used.<br/>
•<br/>
A text table is created, initialized, and inserted at a location marked by a bookmark.<br/>
•<br/>
Text content is deleted.<br/>
•<br/>
A table is initialized with data.<br/>
•<br/>
The table name is set.<br/>
<b>&#160;14.9.1.&#160;Using&#160;the&#160;correct&#160;text&#160;object<br/></b>It&#160;is&#160;very&#160;important&#160;that&#160;you&#160;use&#160;the&#160;correct&#160;text&#160;object. It&#160;is&#160;possible&#160;that&#160;the&#160;text&#160;object&#160;in&#160;a&#160;text&#160;section&#160;or&#160;<br/>table&#160;cell&#160;is&#160;not&#160;the&#160;same&#160;as&#160;the&#160;text&#160;object&#160;returned by&#160;the&#160;document.&#160;Each text&#160;range&#160;is&#160;associated with&#160;a&#160;<br/>specific&#160;text&#160;object.&#160;Attempting to use&#160;object&#160;methods&#160;from&#160;one&#160;text&#160;object&#160;to&#160;operate&#160;on a&#160;text&#160;range&#160;<br/>associated&#160;with a&#160;different&#160;text&#160;object&#160;causes&#160;an error.&#160;In<a href="libremacros.html#411">&#160;Listing 371, a</a>&#160;table&#160;is&#160;removed,&#160;with the&#160;single&#160;line&#160;<br/>shown in<a href="libremacros.html#412">&#160;<b>Listing&#160;372</b>.</a><br/>
<i><b>Listing&#160;372.&#160;</b>What&#160;if&#160;the&#160;table&#160;is&#160;not&#160;contained in&#160;the&#160;document’s&#160;text&#160;object?<br/></i>ThisComponent.Text.removeTextContent(oTable)<br/>
The&#160;code&#160;in<a href="libremacros.html#412">&#160;Listing 372&#160;a</a>ssumes&#160;that&#160;the&#160;table&#160;is&#160;contained&#160;in the&#160;document’s&#160;text&#160;object.&#160;If&#160;the&#160;table&#160;is&#160;not&#160;<br/>contained in&#160;the&#160;primary&#160;document’s&#160;text&#160;object,&#160;the&#160;code&#160;in<a href="libremacros.html#412">&#160;Listing 372&#160;w</a>ill&#160;fail.&#160;Alt<a href="libremacros.html#412">hough&#160;Listing 372&#160;w</a>ill&#160;<br/>rarely&#160;fail, it&#160;will&#160;undoubtedly&#160;fail&#160;at&#160;the&#160;worst&#160;possible&#160;time.&#160;The&#160;macro works&#160;because&#160;the&#160;sample&#160;<br/>document&#160;was&#160;designed so that&#160;the&#160;table&#160;is&#160;inserted into the&#160;primary&#160;document’s&#160;text&#160;object. Either solution&#160;<br/>shown in<a href="libremacros.html#413">&#160;Listing 373&#160;m</a>ay&#160;be&#160;a&#160;better solution for deleting the&#160;table.<br/>
409<br/>
<hr/>
<a name=413></a><i><b>Listing&#160;373.&#160;</b>Two&#160;safe&#160;methods&#160;to delete&#160;the&#160;table.<br/></i>oTable.getAnchor().getText().removeTextContent(oTable)<br/>oTable.dispose()<br/>
The&#160;second time&#160;that&#160;a&#160;text&#160;object&#160;is&#160;used i<a href="libremacros.html#411">n&#160;Listing&#160;371, i</a>t&#160;is&#160;obtained&#160;from&#160;the&#160;anchor returned from&#160;a&#160;<br/>bookmark—this&#160;is&#160;safe.<br/>
<i><b>Listing&#160;374.&#160;</b>A&#160;safe&#160;way&#160;to&#160;get&#160;a text&#160;object.<br/></i>oInsertPoint.getText().insertTextContent(oInsertPoint&#160;,&#160;oTable,&#160;False)<br/>
If&#160;the&#160;text&#160;range&#160;oInsertPoint&#160;is&#160;not&#160;contained in&#160;the&#160;document’s&#160;text&#160;object, attempting to insert&#160;the&#160;table&#160;<br/>using the&#160;document’s&#160;text&#160;object&#160;will&#160;fail. Only&#160;you&#160;can decide&#160;how&#160;careful&#160;you need to&#160;be&#160;when accessing&#160;<br/>text&#160;objects.&#160;Consider the&#160;selected text&#160;framework.&#160;What&#160;text&#160;object&#160;is&#160;used to&#160;create&#160;text&#160;cursors&#160;and to&#160;<br/>compare&#160;text&#160;cursors?&#160;Can&#160;you&#160;make&#160;the&#160;code&#160;more&#160;robust?<br/>
<b>&#160;14.9.2.&#160;Methods&#160;and&#160;properties<br/></b>The&#160;methods&#160;supported by&#160;text&#160;tables&#160;are&#160;very&#160;similar to&#160;the&#160;methods&#160;supported&#160;by&#160;spreadsheets&#160;contained&#160;in<br/>Calc&#160;documents&#160;(see&#160;Chapte<a href="libremacros.html#455">r&#160;15, “Calc&#160;Documents”</a><a href="libremacros.html#413">).&#160;Table&#160;138&#160;s</a>ummarizes&#160;the&#160;object&#160;methods&#160;supported&#160;<br/>by&#160;text&#160;tables.<br/>
<i><b>Table&#160;138.&#160;</b>Object&#160;methods&#160;supported by&#160;text&#160;tables.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
autoFormat(name)<br/>
Apply&#160;the&#160;specified&#160;auto-format&#160;name&#160;to the&#160;table.<br/>
createCursorByCellName(name)<br/>
XTextTableCursor&#160;positioned&#160;at&#160;the&#160;specified&#160;cell.<br/>
createSortDescriptor()<br/>
Array&#160;of&#160;PropertyValues that&#160;specify&#160;the&#160;sort&#160;criteria.<br/>
dispose()<br/>
Destroy&#160;a&#160;text&#160;object, which&#160;also&#160;removes it&#160;from&#160;the&#160;document.<br/>
getAnchor()<br/>
Return a&#160;text&#160;range&#160;identifying&#160;where&#160;the&#160;table&#160;is&#160;anchored.&#160;This method&#160;<br/>
allows text&#160;content&#160;to be&#160;added easily&#160;before&#160;or&#160;after&#160;a&#160;text&#160;table.<br/>
getCellByName(name)<br/>
Return an XCell&#160;based&#160;on&#160;the&#160;cell&#160;name, such&#160;as&#160;“B3”.<br/>
getCellByPosition(col,&#160;row)<br/>
Numbering&#160;starts at&#160;zero.&#160;This has difficulties with complex&#160;tables.<br/>
getCellNames()<br/>
String&#160;array&#160;of&#160;cell&#160;names contained&#160;in the&#160;table.<br/>
getCellRangeByName(name)<br/>
XCellRange&#160;based&#160;on cell&#160;name, such as&#160;A1:B4.&#160;Fails if&#160;the&#160;name&#160;<br/>identifies&#160;a&#160;cell&#160;that&#160;has&#160;been split.<br/>
getCellRangeByPosition(left,&#160;top, right,&#160;<br/>
XCellRange&#160;based&#160;on numeric&#160;range.<br/>
bottom)<br/>getColumnDescriptions()<br/>
Array&#160;of&#160;strings&#160;describing&#160;the&#160;columns.&#160;Fails for&#160;complex&#160;tables.<br/>
getColumns()<br/>
XTableColumns&#160;object&#160;enumerates columns by&#160;index.&#160;Also supports&#160;<br/>
insertByIndex(idx, count)&#160;and&#160;removeByIndex(idx, count).<br/>
getData()<br/>
Get&#160;numerical&#160;data&#160;as a&#160;nested sequence&#160;of&#160;values (arrays&#160;in an array).&#160;<br/>
Fails for&#160;complex&#160;tables.<br/>
getDataArray()<br/>
Same&#160;as&#160;getData()&#160;but&#160;may&#160;contain String&#160;or&#160;Double.<br/>
getName()<br/>
Get&#160;the&#160;table&#160;name&#160;as a&#160;string.<br/>
getRowDescriptions()<br/>
Array&#160;of&#160;strings&#160;describing&#160;the&#160;rows. Fails for&#160;complex&#160;tables.<br/>
getRows()<br/>
XTableRows&#160;object&#160;enumerates rows by&#160;index.&#160;Also supports&#160;<br/>insertByIndex(idx, count)&#160;and&#160;removeByIndex(idx, count).<br/>
initialize(rows, cols)<br/>
Set&#160;the&#160;numbers&#160;of&#160;rows and&#160;columns. Must&#160;be&#160;done&#160;before&#160;the&#160;table&#160;is&#160;<br/>
410<br/>
<hr/>
<a name=414></a><i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
inserted&#160;(see<a href="libremacros.html#368">&#160;Listing&#160;334)</a>.<br/>
setColumnDescriptions(string())<br/>
Set&#160;the&#160;column&#160;descriptions from&#160;an array&#160;of&#160;strings.<br/>
setData(Double())<br/>
Set&#160;numerical&#160;data&#160;as a&#160;nested&#160;sequence&#160;of&#160;values. Fails&#160;for&#160;complex&#160;<br/>
tables.<br/>
setDataArray(array())<br/>
Same&#160;as&#160;setData()&#160;but&#160;may&#160;contain String&#160;or&#160;Double.<br/>
setName(name)<br/>
Set&#160;the&#160;table&#160;name.<br/>
setRowDescriptions(string())<br/>
Set&#160;the&#160;row&#160;descriptions from&#160;an array&#160;of&#160;strings.<br/>
sort(array())<br/>
Sort&#160;the&#160;table&#160;based&#160;on a&#160;sort&#160;descriptor.<br/>
Text&#160;table&#160;objects&#160;also&#160;support&#160;a&#160;variety&#160;of properties&#160;(see<a href="libremacros.html#414">&#160;Table&#160;139)</a>.&#160;Text&#160;tables&#160;support&#160; many&#160;of the&#160;same&#160;<br/>properties&#160;that&#160;are&#160;supported&#160;by&#160;paragraphs&#160;(see<a href="libremacros.html#370">&#160;Table&#160;126).</a><br/>
<i><b>Table&#160;139.&#160;</b>Properties&#160;supported by&#160;the&#160;com.sun.star.text.TextTable&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BreakType&#160;<br/>
Specify&#160;the&#160;type&#160;of&#160;break&#160;that&#160;is applied&#160;at&#160;the&#160;start&#160;of&#160;the&#160;table&#160;(see&#160;the&#160;BreakType&#160;<br/>attribute&#160;in<a href="libremacros.html#370">&#160;Table&#160;126)</a>.<br/>
LeftMargin&#160;<br/>
Specify&#160;the&#160;left&#160;table&#160;margin in 0.01&#160;mm&#160;as a&#160;Long&#160;Integer.&#160;Set&#160;the&#160;HoriOrient&#160;property&#160;to&#160;<br/>something&#160;other&#160;than&#160;FULL.<br/>
RightMargin&#160;<br/>
Specify&#160;the&#160;right&#160;table&#160;margin in 0.01&#160;mm&#160;as a&#160;Long Integer.&#160;Set&#160;the&#160;HoriOrient&#160;property&#160;<br/>to something&#160;other&#160;than FULL.<br/>
HoriOrient&#160;<br/>
Specify&#160;the&#160;horizontal&#160;orientation&#160;using&#160;the&#160;com.sun.star.text.HoriOrientation constants.&#160;<br/>The&#160;default&#160;value&#160;is&#160;com.sun.star.text.HoriOrientation.FULL.<br/>•<br/>
NONE&#160;=&#160;0&#160;– No&#160;alignment&#160;is&#160;applied.<br/>
•<br/>
RIGHT&#160;=&#160;1 –&#160;The&#160;object&#160;is aligned&#160;at&#160;the&#160;right&#160;side.<br/>
•<br/>
CENTER&#160;=&#160;2 –&#160;The&#160;object&#160;is&#160;aligned at&#160;the&#160;middle.<br/>
•<br/>
LEFT&#160;=&#160;3&#160;–&#160;The&#160;object&#160;is aligned&#160;at&#160;the&#160;left&#160;side.<br/>
•<br/>
INSIDE&#160;=&#160;4 –&#160;(Not&#160;yet&#160;supported)<br/>
•<br/>
OUTSIDE&#160;=&#160;5&#160;–&#160;(Not&#160;yet&#160;supported)<br/>
•<br/>
FULL&#160;=&#160;6&#160;–&#160;The&#160;object&#160;uses the&#160;full&#160;space&#160;(for&#160;text&#160;tables only).<br/>
•<br/>
LEFT_AND_WIDTH&#160;=&#160;7&#160;–&#160;The&#160;left&#160;offset&#160;and&#160;the&#160;width of&#160;the&#160;object&#160;are&#160;defined.<br/>
KeepTogether&#160;<br/>
If&#160;True,&#160;prevents page&#160;or&#160;column breaks between&#160;this&#160;table&#160;and the&#160;following&#160;paragraph or&#160;<br/>text&#160;table.<br/>
Split&#160;<br/>
If&#160;False, the&#160;table&#160;will&#160;not&#160;split&#160;across two pages.<br/>
PageDescName&#160;<br/>
If&#160;this string&#160;is set,&#160;a&#160;page&#160;break occurs before&#160;the&#160;paragraph, and the&#160;new&#160;page&#160;uses the&#160;<br/>
given&#160;page&#160;style&#160;name&#160;(see&#160;PageDescName&#160;in<a href="libremacros.html#370">&#160;Table&#160;126)</a>.<br/>
PageNumberOffset&#160;<br/>
If&#160;a&#160;page&#160;break occurs, specify&#160;a&#160;new&#160;page&#160;number&#160;(see&#160;PageNumberOffset&#160;i<a href="libremacros.html#370">n&#160;Table&#160;126)</a>.<br/>
RelativeWidth&#160;<br/>
Specify&#160;the&#160;width&#160;of&#160;the&#160;table&#160;relative&#160;to&#160;its&#160;environment&#160;as a&#160;Short&#160;Integer.<br/>
IsWidthRelative&#160;<br/>
If&#160;True,&#160;the&#160;relative&#160;width is valid.<br/>
RepeatHeadline&#160;<br/>
If&#160;True,&#160;the&#160;first&#160;row&#160;of&#160;the&#160;table&#160;is repeated&#160;on every&#160;new&#160;page.<br/>
ShadowFormat&#160;<br/>
Specify&#160;the&#160;type,&#160;color,&#160;and&#160;size&#160;of&#160;the&#160;shadow&#160;(see&#160;ParaShadowFormat&#160;i<a href="libremacros.html#370">n&#160;Table&#160;126)</a>.<br/>
TopMargin&#160;<br/>
Specify&#160;the&#160;top table&#160;margin in&#160;0.01&#160;mm&#160;as a&#160;Long Integer.<br/>
BottomMargin&#160;<br/>
Specify&#160;the&#160;bottom&#160;table&#160;margin in 0.01&#160;mm&#160;as a&#160;Long&#160;Integer.<br/>
411<br/>
<hr/>
<a name=415></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BackTransparent&#160;<br/>
If&#160;True,&#160;the&#160;background color&#160;is transparent.<br/>
Width&#160;<br/>
Specify&#160;the&#160;absolute&#160;table&#160;width&#160;as&#160;a&#160;Long&#160;Integer—this is a&#160;read-only&#160;property.<br/>
ChartRowAsLabel&#160;<br/>
If&#160;True,&#160;the&#160;first&#160;row&#160;is treated&#160;as axis&#160;labels&#160;if&#160;a&#160;chart&#160;is created.<br/>
ChartColumnAsLabel&#160;<br/>
If&#160;True,&#160;the&#160;first&#160;column is treated&#160;as&#160;axis&#160;labels if&#160;a&#160;chart&#160;is created.<br/>
TableBorder&#160;<br/>
Specify&#160;the&#160;table&#160;borders in a&#160;com.sun.star.table.TableBorder&#160;structure.&#160;The&#160;structure&#160;<br/>
contains numerous complicated&#160;properties:<br/>•<br/>
The&#160;properties&#160;TopLine,&#160;BottomLine, LeftLine, RightLine, HorizontalLine, and&#160;<br/>
VerticalLine&#160;are&#160;all&#160;structures of&#160;type&#160;BorderLine&#160;as described&#160;by&#160;the&#160;LeftBorder&#160;<br/>property&#160;i<a href="libremacros.html#370">n&#160;Table&#160;126.</a><br/>
•<br/>
The&#160;Distance&#160;property&#160;contains&#160;the&#160;distance&#160;between&#160;the&#160;lines and&#160;other&#160;contents.<br/>
•<br/>
You can&#160;turn each border&#160;property&#160;on or&#160;off&#160;by&#160;setting&#160;one&#160;of&#160;the&#160;following&#160;properties&#160;<br/>
to&#160;True&#160;or&#160;False:&#160;IsTopLineValid,&#160;IsBottomLineValid, IsLeftLineValid,&#160;<br/>IsRightLineValid, IsHorizontalLineValid, IsVerticalLineValid, and&#160;IsDistanceValid.<br/>
TableColumnSeparators&#160;<br/>
Specify&#160;the&#160;width&#160;of&#160;each column&#160;with an&#160;array&#160;of&#160;table&#160;column&#160;separators. Each separator<br/>is a&#160;com.sun.star.text.TableColumnSeparator&#160;structure.&#160;<br/>•<br/>
Position is&#160;a&#160;Short&#160;Integer&#160;that&#160;defines the&#160;position of&#160;a&#160;cell&#160;separator.<br/>
•<br/>
IsVisible&#160;determines if&#160;the&#160;separator&#160;is&#160;visible.<br/>
The&#160;width&#160;of&#160;a&#160;cell&#160;is&#160;defined&#160;by&#160;the&#160;position of&#160;the&#160;separator&#160;between adjacent&#160;cells.&#160;<br/>
When&#160;two&#160;cells are&#160;merged,&#160;the&#160;separator&#160;is hidden,&#160;not&#160;removed.<br/>
The&#160;Position values are&#160;relative&#160;to the&#160;text&#160;table&#160;&#160;TableColumnRelativeSum&#160;property.&#160;This&#160;<br/>property&#160;is&#160;valid&#160;for&#160;a&#160;table&#160;only&#160;if&#160;every&#160;row&#160;has the&#160;same&#160;structure.&#160;If&#160;they&#160;do&#160;not, obtain&#160;<br/>
the&#160;separators from&#160;the&#160;individual&#160;row&#160;objects.<br/>
TableColumnRelativeSum&#160;<br/>
Specify&#160;the&#160;sum&#160;of&#160;the&#160;column-width values used&#160;in&#160;TableColumnSeparators as a&#160;Short&#160;<br/>
Integer.<br/>
BackColor&#160;<br/>
Specify&#160;the&#160;paragraph&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
BackGraphicURL&#160;<br/>
Specify&#160;the&#160;URL&#160;of&#160;the&#160;paragraph background graphic.<br/>
BackGraphicFilter&#160;<br/>
Specify&#160;the&#160;name&#160;of&#160;the&#160;graphic&#160;filter&#160;for&#160;the&#160;paragraph background&#160;graphic.<br/>
BackGraphicLocation&#160;<br/>
Specify&#160;the&#160;position&#160;of&#160;a&#160;background&#160;graphic&#160;(see&#160;ParaBackGraphicLocation&#160;in<a href="libremacros.html#370">&#160;Table&#160;<br/>126)</a>.<br/>
<b>&#160;14.9.3.&#160;Simple&#160;and&#160;complex&#160;tables<br/></b>Simply&#160;speaking, a&#160;text&#160;table&#160;is&#160;a&#160;set&#160;of rows&#160;and columns&#160;of text.&#160;All&#160;of the&#160;tables&#160;in&#160;this&#160;book are&#160;<br/>represented&#160;using simple&#160;text&#160;tables. OOo supports&#160;both simple&#160;and complex&#160;tables.&#160;A&#160;simple&#160;table&#160;contains&#160;<br/>no merged or split&#160;cells;&#160;the&#160;table&#160;cells&#160;are&#160;laid out&#160;in&#160;a&#160;simple&#160;grid (see<a href="libremacros.html#416">&#160;<b>Table&#160;140</b>)</a>. Each column is&#160;labeled&#160;<br/>alphabetically&#160;starting with&#160;the&#160;letter&#160;A, and each row&#160;is&#160;labeled numerically&#160;starting with&#160;the&#160;number 1.&#160;The&#160;<br/>object&#160;method&#160;getCellByName() uses&#160;this&#160;name&#160;to&#160;return the&#160;specified&#160;cell.&#160;A&#160;similar object&#160;method,&#160;<br/>getCellByPosition(), returns&#160;the&#160;cell&#160;based on the&#160;column and row&#160;number.&#160;The&#160;column&#160;and row&#160;number are&#160;<br/>zero-based numbers, so requesting (1, 2) returns&#160;the&#160;cell&#160;named&#160;“B3”.<br/>
412<br/>
<hr/>
<a name=416></a><i><b>Table&#160;140.</b>&#160;Simple&#160;table&#160;with the&#160;cell&#160;names&#160;labeled.</i><br/>
A1<br/>
B1<br/>
C1<br/>
D1<br/>
A2<br/>
B2<br/>
C2<br/>
D2<br/>
A3<br/>
B3<br/>
C3<br/>
D3<br/>
A4<br/>
B4<br/>
C4<br/>
D4<br/>
Use&#160;getRows()&#160;to obtain the&#160;rows&#160;from&#160;the&#160;text&#160;table.&#160;The&#160;returned rows&#160;object&#160;is&#160;useful&#160;to determine&#160;<br/>how&#160;many&#160;rows&#160;are&#160;present,&#160;retrieving, inserting, and deleting rows.<br/>
<i><b>Table&#160;141.</b>&#160;Main access&#160;methods&#160;supported by&#160;a table&#160;rows&#160;object.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getByIndex<br/>
Retrieve&#160;a&#160;specific&#160;row.<br/>
getCount<br/>
Number&#160;of&#160;rows in the&#160;table.<br/>
hasElements<br/>
Determine&#160;if&#160;there&#160;are&#160;any&#160;rows&#160;in&#160;the&#160;table.<br/>
insertByIndex<br/>
Add rows&#160;to the&#160;table.<br/>
removeByIndex<br/>
Remove&#160;rows&#160;from&#160;the&#160;table.<br/>
Although it&#160;is&#160;easy&#160;to enumerate&#160;individual&#160;rows, a&#160;row&#160;is&#160;not&#160;useful&#160;for obtaining&#160;the&#160;cells&#160;that&#160;it&#160;contains.&#160;<br/>An individual&#160;row&#160;object&#160;is&#160;primarily&#160;used as&#160;follows:<br/>
•<br/>
Set&#160;the&#160;row&#160;height&#160;using the&#160;Height&#160;attribute.<br/>
•<br/>
Set&#160;IsAutoHeight&#160;to true&#160;so that&#160;the&#160;rows&#160;height&#160;is&#160;automatically&#160;adjusted.<br/>
•<br/>
Set&#160;IsSplitAllowed to&#160;false&#160;so that&#160;a&#160;row&#160;can not&#160;be&#160;split&#160;at&#160;a&#160;page&#160;boundary.<br/>
•<br/>
Modify&#160;the&#160;TableColumnSeparators&#160;to change&#160;column&#160;widths.<br/>
Use&#160;getColumns()&#160;to obtain the&#160;columns&#160;from&#160;the&#160;text&#160;table.&#160;The&#160;columns&#160;object&#160;supports&#160;the&#160;same&#160;<br/>methods&#160;as&#160;the&#160;rows&#160;object. It&#160;is&#160;not&#160;possible,&#160;however,&#160;to&#160;obtain&#160;a&#160;specific&#160;column&#160;from&#160;a&#160;column object;&#160;<br/>the&#160;method&#160;getByIndex()&#160;exists, but&#160;it&#160;returns&#160;null.&#160;Although I&#160;expected to set&#160;a&#160;column width by&#160;<br/>obtaining a&#160;specific&#160;column&#160;and setting the&#160;width,&#160;you&#160;need to&#160;modify&#160;the&#160;table&#160;column&#160;separators&#160;available&#160;<br/>from&#160;the&#160;row&#160;object.<br/>
A&#160;complex&#160;text&#160;table&#160;is&#160;a&#160;text&#160;table&#160;that&#160;is&#160;not&#160;simple.&#160;More&#160;accurately,&#160;a&#160;complex&#160;text&#160;table&#160;contains&#160;cells&#160;<br/>that&#160;have&#160;been split,&#160;or merged.&#160;To&#160;demonstrate&#160;a&#160;complex&#160;text&#160;table, start&#160;with<a href="libremacros.html#416">&#160;<i>Table&#160;140</i>&#160;a</a>nd perform&#160;the&#160;<br/>following&#160;tasks:<br/>
1)&#160;Right&#160;click in cell&#160;A2 and choose&#160;Cell&#160;&gt;&#160;Split&#160;&gt;&#160;Horizontal.&#160;Cell&#160;A2 becomes&#160;two cells.&#160; From&#160;a&#160;cell&#160;<br/>
naming perspective, a&#160;new&#160;third&#160;row&#160;is&#160;inserted that&#160;contains&#160;one&#160;column.&#160;At&#160;this&#160;point,&#160;the&#160;API&#160;<br/>indicates&#160;that&#160;there&#160;are&#160;five&#160;rows&#160;and four columns.<br/>
413<br/>
<hr/>
<a name=417></a><i><b>Table&#160;142.</b>&#160;Split&#160;cell&#160;A2 horizontally.</i><br/>
A1<br/>
B1<br/>
C1<br/>
D1<br/>
A2<br/>
B2<br/>
C2<br/>
D2<br/>
(A3)<br/>A3=&gt;A4<br/>
B3=&gt;B4<br/>
C3=&gt;C4<br/>
D3=&gt;D4<br/>
A4=&gt;A5<br/>
B4=&gt;B5<br/>
C4=&gt;C5<br/>
D4=&gt;D5<br/>
2)&#160;Right&#160;click in cell&#160;B2 and choose&#160;Cell&#160;&gt;&#160;Split&#160;&gt;&#160;Vertical. Cell&#160;B2 becomes&#160;two distinct&#160;cells, B2 and&#160;<br/>
C2;&#160;a&#160;new&#160;column appears&#160;to&#160;have&#160;been inserted at&#160;cell&#160;B2.&#160;The&#160;API&#160;still&#160;indicates&#160;that&#160;there&#160;are&#160;five&#160;<br/>rows&#160;and four columns.<br/>
<i><b>Table&#160;143.</b>&#160;Split&#160;cell&#160;B2 vertically..</i><br/>
A1<br/>
B1<br/>
C1<br/>
D1<br/>
A2<br/>
B2<br/>
(C2)<br/>
C2=&gt;D2<br/>
D2=&gt;E2<br/>
A3<br/>A4<br/>
B4<br/>
C4<br/>
D4<br/>
A5<br/>
B5<br/>
C5<br/>
D5<br/>
3)&#160;Select&#160;cells&#160;A4 and B4, right&#160;click and choose&#160;Cell&#160;&gt;&#160;Merge.<br/>
<i><b>Table&#160;144.</b>&#160;Complex&#160;table&#160;after&#160;merging cells&#160;in the&#160;same&#160;row.</i><br/>
A1<br/>
B1<br/>
C1<br/>
D1<br/>
A2<br/>
B2<br/>
C2<br/>
D2<br/>
E2<br/>
A3<br/>A4, (B4) =&gt; A4<br/>
C4=&gt;B4<br/>
D4=&gt;C4<br/>
A5<br/>
B5<br/>
C5<br/>
D5<br/>
4)&#160;Select&#160;cells&#160;B4 and C5, right&#160;click and choose&#160;Cell&#160;&gt;&#160;Merge. Cell&#160;C5 just&#160;goes&#160;away.<br/>
<i><b>Table&#160;145.</b>&#160;Split&#160;cell&#160;B2 vertically..</i><br/>
A1<br/>
B1<br/>
C1<br/>
D1<br/>
A2<br/>
B2<br/>
C2<br/>
D2<br/>
E2<br/>
A3<br/>A4<br/>
B4, (C5)=&gt;B4<br/>
C4<br/>
A5<br/>
B5<br/>
D5<br/>
<b>TIP</b><br/>
Not&#160;all&#160;object&#160;methods work with&#160;complex&#160;tables.&#160;For&#160;example,&#160;the&#160;object&#160;methods getData()&#160;<br/>
and&#160;setData()&#160;cause&#160;an exception for&#160;complex&#160;tables,&#160;which makes sense.<br/>
414<br/>
<hr/>
<a name=418></a>Although the&#160;object&#160;method getCellByName() works&#160;as&#160;expected&#160;for complex&#160;tables,&#160;getCellByPosition() is&#160;<br/>not&#160;able&#160;to return all&#160;of the&#160;cells&#160;because&#160;it&#160;allows&#160;only&#160;a&#160;column&#160;and a&#160;row&#160;number.&#160;Use&#160;the&#160;getCellNames()&#160;<br/>object&#160;method&#160;to return the&#160;names&#160;of the&#160;cells&#160;in a&#160;table&#160;(see<a href="libremacros.html#418">&#160;Listing 375);</a>&#160;you&#160;can then use&#160;the&#160;cell&#160;names&#160;to<br/>individually&#160;obtain&#160;each cell&#160;in&#160;the&#160;table.<br/>
<i><b>Listing&#160;375.&#160;</b>Join the&#160;array&#160;of&#160;strings&#160;to&#160;print&#160;the&#160;cell&#160;names&#160;in&#160;a table.<br/></i>MsgBox&#160;Join(oTable.getCellNames(),&#160;&#34;|&#34;)<br/>
Place&#160;the&#160;text&#160;cursor in&#160;a&#160;text&#160;table&#160;and run the&#160;following macro to&#160;set&#160;the&#160;text&#160;in&#160;each cell&#160;to&#160;the&#160;text&#160;name;&#160;<br/>this&#160;modifies&#160;the&#160;text&#160;table&#160;and erases&#160;all&#160;existing text.<br/>
<i><b>Listing&#160;376.</b>&#160;Set&#160;the&#160;text&#160;of&#160;each cell&#160;to&#160;contain&#160;the&#160;cell's&#160;name.<br/></i>Sub&#160;SetCellNames<br/>&#160;&#160;Dim&#160;oTable<br/>&#160;&#160;Dim&#160;sNames<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;<br/>&#160;&#160;oTable&#160;=&#160;ThisComponent.currentController.ViewCursor.TextTable<br/>&#160;&#160;If&#160;IsNull(oTable)&#160;Then<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;sNames&#160;=&#160;oTable.getCellNames()<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(sNames)&#160;To&#160;UBound(sNames)<br/>&#160; &#160;&#160;oTable.getCellByName(sNames(i)).setString(sNames(i))<br/>&#160;&#160;Next&#160;&#160;<br/>End&#160;Sub&#160;<br/>
<b>&#160;14.9.4.&#160;Tables&#160;contain&#160;cells<br/></b>The&#160;cells&#160;in&#160;a&#160;text&#160;table&#160;are&#160;very&#160;versatile&#160;objects&#160;capable&#160;of holding&#160;all&#160;types&#160;of data.&#160;The&#160;cell&#160;objects&#160;<br/>implement&#160;both&#160;the&#160;XText&#160;interface&#160;(see<a href="libremacros.html#365">&#160;Table&#160;123&#160;ne</a>ar the&#160;beginning of this&#160;chapter) as&#160;well&#160;as&#160;the&#160;XCell&#160;<br/>interface&#160;(see<a href="libremacros.html#418">&#160;Table&#160;146).</a><br/>
<b>TIP</b><br/>
Tables are&#160;able&#160;to create&#160;a&#160;text&#160;table&#160;cursor&#160;with&#160;methods&#160;and&#160;properties specifically&#160;designed to&#160;traverse&#160;<br/>
and&#160;select&#160;cells,&#160;and&#160;each&#160;individual&#160;cell&#160;is&#160;able&#160;to&#160;produce&#160;a&#160;text&#160;cursor&#160;that&#160;is local&#160;to the&#160;cell&#160;text&#160;object.<br/>
<i><b>Table&#160;146.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.table.XCell&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getFormula()<br/>
The&#160;original&#160;string&#160;typed&#160;into the&#160;cell,&#160;even if&#160;it&#160;is not&#160;a&#160;formula.<br/>
setFormula(String)<br/>
Set&#160;the&#160;cell’s&#160;formula. Use&#160;setString()&#160;from&#160;the&#160;XText&#160;interface&#160;to set&#160;text.<br/>
getValue()<br/>
Floating-point&#160;(Double)&#160;value&#160;of&#160;the&#160;cell.<br/>
setValue(Double)<br/>
Set&#160;the&#160;floating-point&#160;value&#160;of&#160;the&#160;cell.<br/>
getType()<br/>
Return a&#160;com.sun.star.table.CellContentType&#160;enumeration with&#160;valid&#160;values of&#160;EMPTY,&#160;<br/>VALUE,&#160;TEXT,&#160;and FORMULA.<br/>
getError()<br/>
Long&#160;Integer&#160;error&#160;value. If&#160;the&#160;cell&#160;is&#160;not&#160;a&#160;formula, the&#160;error&#160;value&#160;is&#160;zero.<br/>
415<br/>
<hr/>
<a name=419></a>Each cell&#160;object&#160;posses&#160;numerous&#160;properties.&#160;These&#160;properties&#160;are&#160;generally&#160;familiar because&#160;they&#160;are&#160;used in<br/>other objects. For example,&#160;the&#160;BackColor,&#160;BackGraphicFilter,&#160;BackGraphicLocation,&#160;BackGraphicURL,&#160;<br/>BackTransparent,&#160;BorderDistance, BottomBorder,&#160;BottomBorderDistance, LeftBorder,&#160;LeftBorderDistance,&#160;<br/>RightBorder,&#160;RightBorderDistance,&#160;TopBorder,&#160;and&#160;TopBorderDistance&#160;properties&#160;are&#160;defined for text&#160;tables<br/>i<a href="libremacros.html#414">n&#160;Table&#160;139&#160;a</a>nd/or paragraph properties&#160;i<a href="libremacros.html#370">n&#160;Table&#160;126. O</a>ne&#160;of the&#160;more&#160;useful&#160;properties&#160;that&#160;is&#160;available&#160;<br/>only&#160;in the&#160;cell&#160;object, however,&#160;is&#160;CellName.&#160;This&#160;is&#160;useful&#160;to&#160;determine&#160;the&#160;location of the&#160;current&#160;cursor.&#160;&#160;<br/>The&#160;macro i<a href="libremacros.html#419">n&#160;Listing&#160;377&#160;de</a>monstrates&#160;a&#160;few&#160;new&#160;manipulations&#160;for tables.<br/>
The text tables, rows, columns, and cells all support the BackColor propert<a href="libremacros.html#419">y. Listing 377 s</a>ets the <br/>
background color of the first row to a light gray, which is commonly used to mark headings.<br/>The insertByIndex(index, num) object method is used to insert new rows at the end of a table. Rows can <br/>
also be inserted into the middle or at the start of a table.<br/>Individual cells are retrieved by name; both numeric values and strings are set. Notice that strings are set <br/>
using setString() rather than setFormula().<br/>
<b>TIP</b><br/>
Although the&#160;Web-based&#160;OOo&#160;documentation makes no distinction between&#160;cells contained&#160;in text&#160;tables&#160;<br/>
and&#160;cells&#160;contained in&#160;spreadsheets,&#160;the&#160;two cell&#160;types do&#160;not&#160;support&#160;the&#160;same&#160;property&#160;set.&#160;For&#160;example,&#160;<br/>the&#160;CellStyle,&#160;CellBackColor,&#160;and&#160;RotateAngle&#160;properties are&#160;not&#160;supported in&#160;a&#160;text&#160;document.<br/>
<i><b>Listing&#160;377.&#160;</b>Simple&#160;text&#160;table&#160;manipulations.<br/></i>Sub&#160;SimpleTableManipulations<br/>&#160;&#160;Dim&#160;oTable&#160; &#160; &#160; &#160;'Newly created table to insert<br/>&#160;&#160;Dim&#160;oTables&#160; &#160; &#160;&#160;'All of the text tables<br/>&#160;&#160;Dim&#160;oInsertPoint&#160;'Where the table will be inserted<br/>&#160;&#160;Dim&#160;sTableName&#160;as&#160;String<br/>&#160;&#160;<br/>&#160;&#160;sTableName&#160;=&#160;&#34;SampleTable&#34;<br/>&#160;&#160;oTables&#160;=&#160;ThisComponent.TextTables<br/>
&#160;&#160;REM Remove the table if it exists! &#160;<br/>&#160;&#160;If&#160;oTables.hasByName(sTableName)&#160;Then<br/>&#160; &#160;&#160;ThisComponent.Text.removeTextContent(oTables.getByName(sTableName))<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;REM Let the document create the text table. &#160;<br/>&#160;&#160;oTable&#160;=&#160;ThisComponent.createInstance(&#160;&#34;com.sun.star.text.TextTable&#34;&#160;)<br/>&#160;&#160;oTable.initialize(4,&#160;3)&#160;'Two rows, three columns<br/>
&#160;&#160;REM If there is a bookmark named &#34;InsertTableHere&#34;, then insert<br/>&#160;&#160;REM the table at that point. If this bookmark does not exist,&#160;<br/>&#160;&#160;REM then simply choose the very end of the document.<br/>&#160;&#160;If&#160;ThisComponent.getBookmarks().hasByName(&#34;InsertTableHere&#34;)&#160;Then<br/>&#160; &#160;&#160;oInsertPoint&#160;=_<br/>&#160; &#160; &#160;&#160;ThisComponent.getBookmarks().getByName(&#34;InsertTableHere&#34;).getAnchor()<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oInsertPoint&#160;=&#160;ThisComponent.Text.getEnd()<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;oInsertPoint.getText().insertTextContent(oInsertPoint&#160;,&#160;oTable,&#160;False)<br/>
416<br/>
<hr/>
<a name=420></a>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;<br/>&#160;&#160;oTable.setDataArray(Array(Array(&#34;Name&#34;,&#160;&#34;Score&#34;,&#160;&#34;Test&#34;),_<br/>&#160; &#160;&#160;Array(&#34;Bob&#34;,&#160;80,&#160;&#34;CCW&#34;),&#160;Array(&#34;Andy&#34;,&#160;80,&#160;&#34;CCW&#34;),_<br/>&#160; &#160;&#160;Array(&#34;Jean&#34;,&#160;100,&#160;&#34;CCI&#34;)))<br/>&#160;&#160;oTable.setName(sTableName)<br/>&#160;&#160;REM Set the first row to have a gray background.<br/>&#160;&#160;oTable.getRows().getByIndex(0).BackColor&#160;=&#160;RGB(235,&#160;235,&#160;235)<br/>
&#160;&#160;REM removeByIndex uses the same arguments as insertByIndex, namely<br/>&#160;&#160;REM the index at which to insert or remove followed by the number<br/>&#160;&#160;REM of rows to insert or remove. The following line inserts<br/>&#160;&#160;REM one row at index 4.<br/>&#160;&#160;oTable.getRows().insertByIndex(4,&#160;1)<br/>&#160;&#160;<br/>&#160;&#160;REM Obtain the individual cells and set the values.<br/>&#160;&#160;oTable.getCellByName(&#34;A5&#34;).setString(&#34;Whil&#34;)<br/>&#160;&#160;oTable.getCellByName(&#34;B5&#34;).setValue(100)<br/>&#160;&#160;oTable.getCellByName(&#34;C5&#34;).setString(&#34;Advanced&#34;)<br/>End&#160;Sub<br/>
<b>&#160;14.9.5.&#160;Using&#160;a&#160;table&#160;cursor<br/></b>Although text&#160;table&#160;cursors&#160;implement&#160;methods&#160;specific&#160;to&#160;traversing&#160;text&#160;tables, they&#160;are&#160;not&#160;significantly&#160;<br/>different&#160;from&#160;their text&#160;cursor counterparts&#160;in&#160;general&#160;functionality.&#160;You can select&#160;and manipulate&#160;ranges&#160;of<br/>cells, and set&#160;cell&#160;properties.<br/>
<b>TIP</b><br/>
You cannot&#160;obtain a&#160;text&#160;table&#160;from&#160;the&#160;document&#160;and&#160;then simply&#160;insert&#160;it&#160;again at&#160;another&#160;location.&#160;So,&#160;<br/>
how&#160;do&#160;you copy&#160;a&#160;text&#160;table?&#160;See<a href="libremacros.html#421">&#160;Listing&#160;381.</a><br/>
Like&#160;text&#160;cursors, text&#160;table&#160;cursor movement&#160;methods&#160;accept&#160;a&#160;Boolean argument&#160;that&#160;indicates&#160;if the&#160;<br/>current&#160;selection should&#160;be&#160;expanded (True) or if the&#160;cursor should simply&#160;be&#160;moved&#160;(False).&#160;The&#160;movement&#160;<br/>methods&#160;also return a&#160;Boolean&#160;value&#160;indicating if the&#160;movement&#160;was&#160;successful.<a href="libremacros.html#420">&#160;Table&#160;147&#160;c</a>ontains&#160;the&#160;<br/>methods&#160;defined by&#160;the&#160;XTextTableCursor interface.<br/>
<i><b>Table&#160;147.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.text.XTextTableCursor&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getRangeName()<br/>
Return the&#160;cell&#160;range&#160;selected&#160;by&#160;this&#160;cursor&#160;as a&#160;string.&#160;For&#160;example,&#160;“B3:D5”.<br/>
gotoCellByName(String,&#160;<br/>
Move&#160;the&#160;cursor&#160;to&#160;the&#160;cell&#160;with&#160;the&#160;specified&#160;name;&#160;return Boolean.<br/>
boolean)<br/>goLeft(n, boolean)<br/>
Move&#160;the&#160;cursor&#160;left&#160;n&#160;cells;&#160;return Boolean.<br/>
goRight(n, boolean)<br/>
Move&#160;the&#160;cursor&#160;right&#160;n&#160;cells;&#160;return Boolean.<br/>
goUp(n, boolean)<br/>
Move&#160;the&#160;cursor&#160;up n&#160;cells;&#160;return&#160;Boolean.<br/>
goDown(n, boolean)<br/>
Move&#160;the&#160;cursor&#160;down&#160;n&#160;cells;&#160;return&#160;Boolean.<br/>
gotoStart(boolean)<br/>
Move&#160;the&#160;cursor&#160;to&#160;the&#160;top&#160;left&#160;cell.<br/>
gotoEnd(boolean)<br/>
Move&#160;the&#160;cursor&#160;to&#160;the&#160;bottom&#160;right&#160;cell.<br/>
mergeRange()<br/>
Merge&#160;the&#160;selected&#160;range&#160;of&#160;cells;&#160;return&#160;True&#160;for&#160;success.<br/>
splitRange(n,&#160;boolean)<br/>
Create&#160;n&#160;(an&#160;integer)&#160;new&#160;cells in&#160;each cell&#160;selected&#160;by&#160;the&#160;cursor.&#160;For&#160;the&#160;Boolean,&#160;<br/>specify&#160;True&#160;to split&#160;horizontally,&#160;False&#160;for&#160;vertically.&#160;Returns&#160;True&#160;on&#160;success.<br/>
417<br/>
<hr/>
<a name=421></a>Text&#160;table&#160;cursors&#160;are&#160;used to&#160;split&#160;and merge&#160;table&#160;cells.&#160;In&#160;general, I&#160;consider this&#160;to&#160;be&#160;the&#160;primary&#160;use&#160;of a<br/>text&#160;table&#160;cursor.&#160;You can use&#160;text&#160;table&#160;cursors&#160;to move&#160;around the&#160;table&#160;by&#160;using the&#160;methods&#160;in<a href="libremacros.html#420">&#160;Table&#160;147.&#160;<br/></a>The&#160;macro i<a href="libremacros.html#421">n&#160;Listing&#160;378&#160;obt</a>ains&#160;the&#160;table&#160;cell&#160;names, creates&#160;a&#160;cell&#160;cursor that&#160;contains&#160;the&#160;first&#160;table&#160;cell,&#160;<br/>and then moves&#160;the&#160;cursor to&#160;the&#160;last&#160;cell&#160;in&#160;the&#160;table.&#160;A&#160;cell&#160;range&#160;is&#160;created based on the&#160;range&#160;name, and&#160;<br/>then the&#160;entire&#160;table&#160;is&#160;selected by&#160;the&#160;current&#160;controller.<br/>
<i><b>Listing&#160;378.&#160;</b>Select&#160;an entire&#160;table&#160;using&#160;a cursor.&#160;This&#160;may&#160;fail&#160;for&#160;a complex&#160;table.<br/></i>oCellNames&#160;=&#160;oTable.getCellNames()<br/>oCursor&#160;=&#160;oTable.createCursorByCellName(oCellNames(0))<br/>oCursor.gotoCellByName(oCellNames(UBound(oCellNames())),&#160;True)<br/>oRange&#160;=&#160;oTable.getCellRangeByName(oCursor.getRangeName())&#160;'This may fail!<br/>Thiscomponent.getCurrentController.select(oRange)<br/>
<a href="libremacros.html#421">Listing 378&#160;de</a>monstrates&#160;how&#160;to select&#160;all&#160;cells&#160;in&#160;a&#160;table&#160;by&#160;using a&#160;table&#160;cell&#160;cursor.&#160;You can then&#160;<br/>manipulate&#160;the&#160;entire&#160;table&#160;using&#160;the&#160;cursor.&#160;It&#160;may&#160;fail,&#160;however,&#160;in&#160;selecting the&#160;entire&#160;table&#160;in&#160;the&#160;current&#160;<br/>view.&#160;Table&#160;cell&#160;cursors&#160;have&#160;no problems&#160;with&#160;complex&#160;tables.&#160;The&#160;object&#160;methods&#160;supported by&#160;tables,&#160;<br/>however,&#160;do not&#160;all&#160;support&#160;complex&#160;tables.&#160;A&#160;notable&#160;example&#160;is&#160;the&#160;object&#160;method&#160;<br/>getCellRangeByName(), as&#160;used i<a href="libremacros.html#421">n&#160;Listing&#160;378.&#160;</a>This&#160;is&#160;very&#160;unfortunate&#160;because&#160;the&#160;view&#160;cursor is&#160;able&#160;to&#160;<br/>select&#160;text&#160;based on a&#160;cell&#160;range, but&#160;the&#160;table&#160;cannot&#160;return a&#160;cell&#160;range&#160;that&#160;has&#160;a&#160;split&#160;cell&#160;as&#160;one&#160;of the&#160;<br/>endpoints.&#160;For&#160;example, the&#160;cell&#160;range&#160;A1.2.1:C4 fails.<br/>
There&#160;is&#160;no easy&#160;method to&#160;duplicate&#160;an entire&#160;text&#160;table.&#160;The&#160;clipboard has&#160;always&#160;been the&#160;solution of&#160;<br/>choice&#160;to copy&#160;general&#160;text&#160;(see<a href="libremacros.html#421">&#160;Listing&#160;381), but</a>, if&#160;available,&#160;use&#160;transferable&#160;content&#160;instead (see<a href="libremacros.html#422">&#160;Listing&#160;<br/>382)</a>. First,&#160;use&#160;the&#160;view&#160;cursor or current&#160;controller to&#160;select&#160;the&#160;object&#160;that&#160;you want&#160;to copy.&#160;Then use&#160;a&#160;<br/>dispatcher to copy&#160;the&#160;object&#160;to the&#160;clipboard, move&#160;the&#160;view&#160;cursor where&#160;the&#160;object&#160;should&#160;be&#160;placed, and&#160;<br/>then use&#160;a&#160;dispatcher to paste&#160;the&#160;object&#160;from&#160;the&#160;clipboard.<br/>
As&#160;you&#160;may&#160;have&#160;guessed, the&#160;difficult&#160;part&#160;in&#160;this&#160;process&#160;is&#160;selecting the&#160;table&#160;with&#160;the&#160;view&#160;cursor.&#160;<br/>Although numerous&#160;people&#160;have&#160;tried and failed&#160;to solve&#160;this&#160;problem,&#160;a&#160;brilliant&#160;solution&#160;was&#160;provided&#160;by&#160;<br/>Paolo Mantovani,&#160;a&#160;contributor&#160;on the&#160;OOo mailing lists. Paolo&#160;starts&#160;by&#160;noting&#160;that&#160;selecting an entire&#160;table&#160;<br/>with the&#160;current&#160;controller places&#160;the&#160;view&#160;cursor at&#160;the&#160;start&#160;of the&#160;first&#160;cell&#160;(see<a href="libremacros.html#421">&#160;Listing 379)</a>.<br/>
<i><b>Listing&#160;379.&#160;</b>Place&#160;the&#160;cursor&#160;at&#160;the&#160;start&#160;of&#160;the&#160;first&#160;cell&#160;in the&#160;table.<br/></i>ThisComponent.CurrentController.select(oTable)<br/>
Althou<a href="libremacros.html#421">gh&#160;Listing&#160;379&#160;doe</a>s&#160;not&#160;entirely&#160;solve&#160;the&#160;problem, it&#160;does&#160;provide&#160;a&#160;good start,&#160;because&#160;the&#160;view&#160;<br/>cursor is&#160;in&#160;the&#160;table&#160;at&#160;a&#160;known position.&#160;Paolo&#160;then provides&#160;a&#160;very&#160;succinct&#160;method&#160;to select&#160;the&#160;entire&#160;<br/>table&#160;(see<a href="libremacros.html#421">&#160;Listing 380)</a>.<br/>
<i><b>Listing&#160;380.&#160;</b>Select&#160;the&#160;entire&#160;table&#160;in the&#160;current&#160;view.<br/></i>ThisComponent.CurrentController.select(oTable)<br/>oVCursor.gotoEnd(True)&#160;&#160;'Move to the end of the current cell<br/>oVCursor.gotoEnd(True)&#160;&#160;'Move to the end of the table<br/>
<b>TIP</b><br/>
Remember&#160;to&#160;carefully&#160;test&#160;all&#160;code&#160;dealing&#160;with&#160;tables.&#160;A&#160;different&#160;solution proposed by&#160;Paolo—which&#160;<br/>
failed—was to use&#160;goRight()&#160;and&#160;then&#160;goDown()&#160;based&#160;on the&#160;number&#160;of&#160;rows and&#160;columns.<br/>
The&#160;macro i<a href="libremacros.html#421">n&#160;Listing&#160;381&#160;s</a>elects&#160;a&#160;table&#160;by&#160;name,&#160;copies&#160;the&#160;table&#160;to the&#160;clipboard, and then pastes&#160;it&#160;at&#160;the&#160;<br/>end of the&#160;document.<br/>
<i><b>Listing&#160;381.&#160;</b>Copy&#160;a text&#160;table&#160;using the&#160;clipboard.</i><br/>
Sub&#160;CopyNamedTableToEndWithClipboard(sName&#160;As&#160;String)<br/>&#160;&#160;Dim&#160;oTable&#160; &#160; &#160; &#160;&#160;'Table to copy<br/>&#160;&#160;Dim&#160;oText&#160; &#160; &#160; &#160; &#160;'Document's text object<br/>
418<br/>
<hr/>
<a name=422></a>&#160;&#160;Dim&#160;oFrame&#160; &#160; &#160; &#160;&#160;'Current frame to use with the dispatcher<br/>&#160;&#160;Dim&#160;oVCursor&#160; &#160; &#160;&#160;'Current view cursor<br/>&#160;&#160;Dim&#160;oDispatcher&#160; &#160;'Dispatcher for clipboard commands<br/>&#160;&#160;<br/>&#160;&#160;oVCursor&#160;=&#160;ThisComponent.CurrentController.getViewCursor()<br/>&#160;&#160;oText&#160;=&#160;ThisComponent.getText()<br/>&#160;&#160;oFrame&#160;=&#160;ThisComponent.CurrentController.Frame<br/>&#160;&#160;oDispatcher&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>&#160;&#160;<br/>&#160;&#160;If&#160;NOT&#160;ThisComponent.getTextTables().hasByName(sName)&#160;Then<br/>&#160; &#160;&#160;MsgBox&#160;&#34;Sorry, the document does not contain table &#34;&#160;&amp;&#160;sName<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;oTable&#160;=&#160;ThisComponent.getTextTables().getByName(sName)<br/>&#160;&#160;<br/>&#160;&#160;REM Place the cursor in the start of the first cell.<br/>&#160;&#160;REM This is very easy!<br/>&#160;&#160;ThisComponent.CurrentController.select(oTable)<br/>&#160;&#160;oVCursor.gotoEnd(True)&#160;&#160;'Move to the end of the current cell.<br/>&#160;&#160;oVCursor.gotoEnd(True)&#160;&#160;'Move to the end of the table.<br/>
&#160;&#160;REM Copy the table to the clipboard.<br/>&#160;&#160;oDispatcher.executeDispatch(oFrame,&#160;&#34;.uno:Copy&#34;,&#160;&#34;&#34;,&#160;0,&#160;Array())<br/>
&#160;&#160;REM Move the cursor to the end of the document and then paste the table.<br/>&#160;&#160;oVCursor.gotoRange(oText.getEnd(),&#160;False)<br/>&#160;&#160;oDispatcher.executeDispatch(oFrame,&#160;&#34;.uno:Paste&#34;,&#160;&#34;&#34;,&#160;0,&#160;Array())<br/>End&#160;Sub<br/>
The&#160;clipboard is&#160;used by&#160;all&#160;applications&#160;so another application&#160;may&#160;modify&#160;the&#160;clipboard while&#160;the&#160;problem&#160;<br/>is&#160;running.&#160;The&#160;current&#160;controller provides&#160;access&#160;to&#160;the&#160;transferable&#160;content&#160;without&#160;using the&#160;clipboard.&#160;<br/>
<i><b>Listing&#160;382.&#160;</b>Copy&#160;a text&#160;table&#160;using transferable&#160;content.<br/></i>Sub&#160;CopyNamedTableToEndUsingTransferable(sName&#160;As String)<br/>&#160; Dim&#160;oTable&#160; &#160; &#160; &#160;&#160;'Table to copy<br/>&#160; Dim&#160;oText&#160; &#160; &#160; &#160; &#160;'Document's text object<br/>&#160; Dim&#160;oVCursor&#160; &#160; &#160;&#160;'Current view cursor<br/>&#160; Dim&#160;o&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Transferable content<br/>&#160;&#160;<br/>&#160;&#160;oVCursor&#160;= ThisComponent.CurrentController.getViewCursor()<br/>&#160;&#160;oText&#160;= ThisComponent.getText()<br/>&#160;&#160;<br/>&#160; If NOT ThisComponent.getTextTables().hasByName(sName) Then<br/>&#160; &#160; MsgBox&#160;&#34;Sorry, the document does not contain table &#34;&#160;&amp;&#160;sName<br/>&#160; &#160; Exit Sub<br/>&#160; End If<br/>&#160;&#160;<br/>&#160;&#160;oTable&#160;= ThisComponent.getTextTables().getByName(sName)<br/>&#160;&#160;<br/>&#160;&#160;REM Place the cursor in the start of the first cell.<br/>&#160;&#160;REM This is very easy!<br/>&#160; ThisComponent.CurrentController.select(oTable)<br/>&#160;&#160;oVCursor.gotoEnd(True) &#160;'Move to the end of the current cell.<br/>
419<br/>
<hr/>
<a name=423></a>&#160;&#160;oVCursor.gotoEnd(True) &#160;'Move to the end of the table.<br/>&#160;&#160;o&#160;= ThisComponent.CurrentController.getTransferable()<br/>
&#160;&#160;REM Move the cursor to the end of the document and then paste the table.<br/>&#160;&#160;oVCursor.gotoRange(oText.getEnd(),&#160;False)<br/>&#160; ThisComponent.CurrentController.insertTransferable(o)<br/>End Sub&#160;<br/>
<b>&#160;14.9.6.&#160;Formatting&#160;a&#160;text&#160;table<br/></b>I&#160;format&#160;text&#160;tables&#160;using paragraph styles, alternating the&#160;background color for each row,&#160;and by&#160;changing&#160;<br/>the&#160;cell&#160;borders.&#160;<br/>
<i><b>Listing&#160;383.</b>&#160;Format&#160;a text&#160;table.<br/></i>Sub&#160;FormatTable(Optional&#160;oUseTable)<br/>&#160;&#160;Dim&#160;oTable<br/>&#160;&#160;Dim&#160;oCell<br/>&#160;&#160;Dim&#160;nRow&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;nCol&#160;As&#160;Long<br/>&#160;&#160;<br/>&#160;&#160;If&#160;IsMissing(oUseTable)&#160;Then<br/>&#160; &#160;&#160;oTable&#160;=&#160;ThisComponent.CurrentController.getViewCursor().TextTable<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oTable&#160;=&#160;oUseTable<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;If&#160;IsNull(oTable)&#160;OR&#160;IsEmpty(oTable)&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;FormatTable: No table specified&#34;<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;Dim&#160;v<br/>&#160;&#160;Dim&#160;x<br/>&#160;&#160;v&#160;=&#160;oTable.TableBorder<br/>&#160;&#160;x&#160;=&#160;v.TopLine&#160;:&#160;x.OuterLineWidth&#160;=&#160;2<br/>&#160;&#160;v.TopLine&#160;=&#160;x<br/>&#160;&#160;<br/>&#160;&#160;x&#160;=&#160;v.LeftLine<br/>&#160;&#160;x.OuterLineWidth&#160;=&#160;2<br/>&#160;&#160;v.LeftLine&#160;=&#160;x<br/>&#160;&#160;<br/>&#160;&#160;x&#160;=&#160;v.RightLine<br/>&#160;&#160;x.OuterLineWidth&#160;=&#160;2<br/>&#160;&#160;v.RightLine&#160;=&#160;x<br/>&#160;&#160;<br/>&#160;&#160;x&#160;=&#160;v.TopLine<br/>&#160;&#160;x.OuterLineWidth&#160;=&#160;2<br/>&#160;&#160;v.TopLine&#160;=&#160;x<br/>&#160;&#160;<br/>&#160;&#160;x&#160;=&#160;v.VerticalLine<br/>&#160;&#160;x.OuterLineWidth&#160;=&#160;2<br/>&#160;&#160;v.VerticalLine&#160;=&#160;x<br/>&#160;&#160;<br/>&#160;&#160;x&#160;=&#160;v.HorizontalLine<br/>
420<br/>
<hr/>
<a name=424></a>&#160;&#160;x.OuterLineWidth&#160;=&#160;0<br/>&#160;&#160;v.HorizontalLine&#160;=&#160;x<br/>&#160;&#160;<br/>&#160;&#160;x&#160;=&#160;v.BottomLine<br/>&#160;&#160;x.OuterLineWidth&#160;=&#160;2<br/>&#160;&#160;v.BottomLine&#160;=&#160;x<br/>
&#160;&#160;oTable.TableBorder&#160;=&#160;v<br/>
&#160;&#160;For&#160;nRow&#160;=&#160;0&#160;To&#160;oTable.getRows().getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;For&#160;nCol&#160;=&#160;0&#160;To&#160;oTable.getColumns().getCount()&#160;-&#160;1<br/>&#160; &#160; &#160;&#160;oCell&#160;=&#160;oTable.getCellByPosition(nCol,&#160;nRow)<br/>&#160; &#160; &#160;&#160;If&#160;nRow&#160;=&#160;0&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;oCell.BackColor&#160;=&#160;128<br/>&#160; &#160; &#160; &#160;&#160;SetParStyle(oCell.getText(),&#160;&#34;OOoTableHeader&#34;)<br/>&#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160;&#160;SetParStyle(oCell.getText(),&#160;&#34;OOoTableText&#34;)<br/>&#160; &#160; &#160; &#160;&#160;If&#160;nRow&#160;MOD&#160;2&#160;=&#160;1&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;oCell.BackColor&#160;=&#160;-1<br/>&#160; &#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM color is (230, 230, 230)<br/>&#160; &#160; &#160; &#160; &#160;&#160;oCell.BackColor&#160;=&#160;15132390<br/>&#160; &#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
Each cell&#160;has&#160;its&#160;own text&#160;object.&#160;The&#160;following macro sets&#160;every&#160;paragraph in&#160;a&#160;text&#160;object&#160;to use&#160;the&#160;same&#160;<br/>paragraph style.<br/>
<i><b>Listing&#160;384.</b>&#160;Set&#160;the&#160;paragraph style&#160;for&#160;every&#160;paragraph in a text&#160;object.<br/></i>Sub&#160;SetParStyle(oText,&#160;sParStyle&#160;As&#160;String)<br/>&#160;&#160;Dim&#160;oEnum<br/>&#160;&#160;Dim&#160;oPar<br/>&#160;&#160;oEnum&#160;=&#160;oText.createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements()<br/>&#160; &#160;&#160;oPar&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160;&#160;If&#160;opar.supportsService(&#34;com.sun.star.text.Paragraph&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;'oPar.ParaConditionalStyleName = sParStyle<br/>&#160; &#160; &#160;&#160;oPar.ParaStyleName&#160;=&#160;sParStyle<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Loop<br/>End&#160;Sub<br/>
<i><b>&#160;14.10.&#160;Text&#160;fields<br/></b></i>A&#160;text&#160;field&#160;is&#160;text&#160;content&#160;that&#160;is&#160;usually&#160;seamlessly&#160;inserted into the&#160;existing text, but&#160;the&#160;actual&#160;content&#160;<br/>comes&#160;from&#160;elsewhere—for example, the&#160;total&#160;number of pages&#160;or a&#160;database&#160;field.<a href="libremacros.html#425">&#160;Table&#160;148&#160;l</a>ists&#160;the&#160;<br/>standard field&#160;types.<br/>
421<br/>
<hr/>
<a name=425></a><i><b>Table&#160;148.&#160;</b>Text&#160;field services&#160;starting&#160;with com.sun.star.text.TextField.</i><br/>
<i><b>Field&#160;Type</b></i><br/>
<i><b>Description</b></i><br/>
Annotation<br/>
Inserted&#160;note&#160;with string&#160;properties&#160;Author&#160;and&#160;Content.&#160;The&#160;property&#160;Date,&#160;of&#160;type&#160;&#160;<br/>
com.sun.star.util.Date,&#160;contains the&#160;date&#160;that&#160;the&#160;note&#160;was&#160;created.<br/>
Author<br/>
Displays the&#160;document’s&#160;author.&#160;The&#160;following&#160;optional&#160;fields may&#160;be&#160;present:<br/>•<br/>
IsFixed&#160;– If&#160;False,&#160;the&#160;author&#160;is modified&#160;every&#160;time&#160;the&#160;document&#160;is&#160;saved.<br/>
•<br/>
Content&#160;–&#160;String&#160;content&#160;of&#160;the&#160;text&#160;field.<br/>
•<br/>
AuthorFormat&#160;– Constants&#160;from&#160;the&#160;com.sun.star.text.AuthorDisplayFormat&#160;constant&#160;<br/>group;&#160;these&#160;have&#160;the&#160;values:&#160;FULL&#160;(0),&#160;LAST_NAME&#160;(1),&#160;FIRST_NAME&#160;(2),&#160;or&#160;<br/>
INITIALS&#160;(3).<br/>
•<br/>
CurrentPresentation – String&#160;containing&#160;the&#160;current&#160;text&#160;of&#160;the&#160;field.<br/>
•<br/>
FullName&#160;–&#160;If&#160;False,&#160;the&#160;initials&#160;are&#160;displayed&#160;rather&#160;than the&#160;full&#160;name.<br/>
Bibliography<br/>
Contains a&#160;property&#160;named&#160;Fields,&#160;which is an array&#160;of&#160;type&#160;PropertyValue.&#160;This field&#160;is&#160;<br/>
dependent&#160;on&#160;a&#160;Bibliography&#160;text&#160;field&#160;master.<br/>
Chapter<br/>
Chapter&#160;information.&#160;The&#160;Level&#160;property&#160;is a&#160;Byte&#160;integer.&#160;The&#160;ChapterFormat&#160;property&#160;is&#160;<br/>
a&#160;constant&#160;group of&#160;type&#160;com.sun.star.text.ChapterFormat&#160;with&#160;the&#160;following&#160;valid values:&#160;<br/>NAME (0), NUMBER&#160;(1),&#160;NAME_NUMBER&#160;(2), NO_PREFIX_SUFFIX&#160;(3),&#160;or&#160;DIGIT&#160;<br/>
(4).<br/>
CharacterCount<br/>
Indicates the&#160;number&#160;of&#160;characters in the&#160;document.&#160;This contains one&#160;property,&#160;<br/>
NumberingType,&#160;from&#160;the&#160;constant&#160;group&#160;com.sun.star.style.NumberingType;&#160;valid&#160;values&#160;<br/>are&#160;shown i<a href="libremacros.html#431">n&#160;Table&#160;149.</a><br/>
CombinedCharacters<br/>
Displays one&#160;to&#160;six characters&#160;and&#160;treats them&#160;as one&#160;character.<br/>
ConditionalText<br/>
Displays text&#160;that&#160;changes&#160;based&#160;on&#160;a&#160;condition in&#160;the&#160;text&#160;field.<br/>•<br/>
TrueContent&#160;–&#160;String&#160;to&#160;use&#160;if&#160;the&#160;condition is&#160;True.<br/>
•<br/>
FalseContent&#160;–&#160;String&#160;to use&#160;if&#160;the&#160;condition&#160;is False.<br/>
•<br/>
Condition –&#160;String&#160;condition&#160;to evaluate.<br/>
•<br/>
IsConditionTrue&#160;–&#160;Boolean&#160;result&#160;of&#160;the&#160;evaluation (read-only&#160;value).<br/>
DDE<br/>
Displays the&#160;result&#160;from&#160;a&#160;DDE&#160;connection. Uses a&#160;DDE text&#160;field&#160;master.<br/>
Database<br/>
Database&#160;text&#160;field&#160;used&#160;as&#160;a&#160;mail-merge&#160;field.&#160;This field&#160;depends on a&#160;text&#160;field master&#160;and<br/>
contains&#160;the&#160;following&#160;properties:<br/>•<br/>
Content&#160;–&#160;Merged&#160;database&#160;content&#160;as a&#160;String.<br/>
•<br/>
CurrentPresentation – Displays content&#160;as a&#160;String.<br/>
•<br/>
DataBaseFormat&#160;– If&#160;True, the&#160;database&#160;number&#160;display&#160;format&#160;is&#160;used.<br/>
•<br/>
NumberFormat&#160;–&#160;com.sun.star.util.NumberFormatter&#160;that&#160;formats the&#160;field.<br/>
DatabaseName<br/>
Display&#160;the&#160;database&#160;name&#160;when&#160;performing&#160;database&#160;operations (depends on a&#160;text&#160;field&#160;<br/>
master)&#160;with&#160;these&#160;properties:<br/>•<br/>
DataBaseName&#160;–&#160;String&#160;containing&#160;the&#160;database&#160;name.<br/>
•<br/>
DataCommandType&#160;–&#160;Constant&#160;group&#160;com.sun.star.sdb.CommandType&#160;specifies&#160;what&#160;<br/>DataTableName&#160;supports:&#160;TABLE&#160;(0),&#160;QUERY(1),&#160;or&#160;COMMAND&#160;(2).<br/>
•<br/>
DataTableName&#160;– String&#160;containing&#160;the&#160;table&#160;name, query,&#160;or&#160;statement.<br/>
DatabaseNextSet<br/>
Increment&#160;a&#160;selection (depends&#160;on a&#160;text&#160;field&#160;master)&#160;with&#160;these&#160;properties:<br/>•<br/>
DataBaseName&#160;–&#160;String&#160;name&#160;of&#160;the&#160;database.<br/>
•<br/>
DataCommandType&#160;–&#160;Constant&#160;group&#160;com.sun.star.sdb.CommandType&#160;specifies&#160;what&#160;<br/>
DataTableName&#160;supports:&#160;TABLE&#160;(0),&#160;QUERY(1),&#160;or&#160;COMMAND&#160;(2).<br/>
•<br/>
DataTableName&#160;– String&#160;containing&#160;the&#160;table&#160;name, query,&#160;or&#160;statement.<br/>
•<br/>
Condition –&#160;String&#160;that&#160;determines if&#160;the&#160;selection is&#160;advanced to&#160;the&#160;next&#160;position.<br/>
422<br/>
<hr/>
<a name=426></a><i><b>Field&#160;Type</b></i><br/>
<i><b>Description</b></i><br/>
DatabaseNumberOfSet<br/>
Display&#160;the&#160;current&#160;database&#160;set&#160;number&#160;(depends&#160;on a&#160;text&#160;field&#160;master)&#160;with&#160;these&#160;<br/>
properties:<br/>•<br/>
DataBaseName&#160;–&#160;String&#160;name&#160;of&#160;the&#160;database.<br/>
•<br/>
DataCommandType&#160;–&#160;Constant&#160;group&#160;com.sun.star.sdb.CommandType&#160;specifies&#160;what&#160;<br/>DataTableName&#160;supports:&#160;TABLE&#160;(0),&#160;QUERY(1),&#160;or&#160;COMMAND&#160;(2).<br/>
•<br/>
DataTableName&#160;– String&#160;containing&#160;the&#160;table&#160;name, query,&#160;or&#160;statement.<br/>
•<br/>
NumberingType&#160;–&#160;See<a href="libremacros.html#431">&#160;Table&#160;149&#160;p</a>roperty&#160;for&#160;valid&#160;values.<br/>
•<br/>
SetNumber&#160;–&#160;Long Integer&#160;database&#160;set.<br/>
DatabaseSetNumber<br/>
Set&#160;the&#160;database&#160;cursor&#160;selection&#160;(depends on a&#160;text&#160;field&#160;master)&#160;with these&#160;properties:<br/>•<br/>
DataBaseName&#160;–&#160;String&#160;name&#160;of&#160;the&#160;database.<br/>
•<br/>
DataCommandType&#160;–&#160;Constant&#160;group&#160;com.sun.star.sdb.CommandType&#160;specifies&#160;what&#160;<br/>
DataTableName&#160;supports:&#160;TABLE&#160;(0),&#160;QUERY(1),&#160;or&#160;COMMAND&#160;(2).<br/>
•<br/>
DataTableName&#160;– String&#160;containing&#160;the&#160;table&#160;name, query,&#160;or&#160;statement.<br/>
•<br/>
Condition –&#160;String&#160;condition&#160;that&#160;determines if&#160;the&#160;SetNumber&#160;is applied.<br/>
•<br/>
SetNumber&#160;–&#160;Long Integer&#160;set&#160;number&#160;to&#160;be&#160;applied.&#160;<br/>
DateTime<br/>
Display&#160;a&#160;date&#160;or&#160;time&#160;with&#160;the&#160;following&#160;optional&#160;properties:<br/>•<br/>
IsFixed&#160;– If&#160;False,&#160;the&#160;current&#160;date&#160;or&#160;time&#160;is&#160;displayed.<br/>
•<br/>
IsDate&#160;–&#160;If&#160;False,&#160;this&#160;is only&#160;a&#160;time. If&#160;True,&#160;this&#160;is a&#160;date&#160;with&#160;an optional&#160;time.<br/>
•<br/>
DateTimeValue&#160;–&#160;com.sun.star.util.DateTime&#160;object&#160;with the&#160;actual&#160;content.<br/>
•<br/>
NumberFormat&#160;–&#160;com.sun.star.util.NumberFormatter&#160;that&#160;formats the&#160;field.<br/>
•<br/>
Adjust&#160;–&#160;Long Integer&#160;offset&#160;to&#160;the&#160;date&#160;or&#160;time&#160;in&#160;minutes.<br/>
•<br/>
IsFixedLanguage&#160;– If&#160;False,&#160;setting&#160;the&#160;adjacent&#160;text&#160;language&#160;may&#160;change&#160;the&#160;field&#160;<br/>display.<br/>
DropDown<br/>
Display&#160;a&#160;drop-down&#160;field&#160;with&#160;the&#160;following&#160;properties:&#160;<br/>•<br/>
Name&#160;–&#160; Field&#160;name.<br/>
•<br/>
Items&#160;–&#160;Array&#160;of&#160;strings with the&#160;drop-down&#160;value.<br/>
•<br/>
SelectedItem&#160;–&#160;The&#160;selected&#160;item&#160;or&#160;an empty&#160;string&#160;if&#160;nothing&#160;is selected.<br/>
EmbeddedObjectCount<br/>
Display&#160;the&#160;number&#160;of&#160;objects embedded&#160;in the&#160;document. Contains the&#160;NumberingType&#160;<br/>property;&#160;see<a href="libremacros.html#431">&#160;Table&#160;149&#160;p</a>roperty&#160;for&#160;valid&#160;values.<br/>
ExtendedUser<br/>
Display&#160;information for&#160;the&#160;user&#160;data&#160;(under&#160;Tools |&#160;Options |&#160;OpenOffice.org&#160;|&#160;User&#160;Data)&#160;<br/>such&#160;as&#160;name,&#160;address, or&#160;phone&#160;number.&#160;<br/>•<br/>
Content&#160;–&#160;String&#160;content.<br/>
•<br/>
CurrentPresentation – String&#160;containing&#160;the&#160;current&#160;text&#160;of&#160;the&#160;field.<br/>
•<br/>
IsFixed&#160;– If&#160;False,&#160;the&#160;content&#160;is&#160;updated.<br/>
•<br/>
UserDataType&#160;– Specify&#160;what&#160;to display&#160;from&#160;the&#160;com.sun.star.text.UserDataPart&#160;<br/>
constant&#160;group:&#160;COMPANY,&#160;FIRSTNAME,&#160;NAME, SHORTCUT,&#160;STREET,&#160;<br/>COUNTRY,&#160;ZIP,&#160;CITY,&#160;TITLE,&#160;POSITION,&#160;PHONE_PRIVATE,&#160;<br/>
PHONE_COMPANY,&#160;FAX, EMAIL,&#160;STATE.<br/>
FileName<br/>
Display&#160;the&#160;document&#160;file&#160;name&#160;(URL). Contains the&#160;following&#160;properties:&#160;<br/>•<br/>
CurrentPresentation – String&#160;containing&#160;the&#160;current&#160;text&#160;of&#160;the&#160;field.<br/>
•<br/>
FileFormat&#160;– File&#160;name&#160;format&#160;com.sun.star.text.FilenameDisplayFormat&#160;constants&#160;<br/>
with the&#160;following&#160;values:&#160;FULL,&#160;PATH,&#160;NAME,&#160;and&#160;NAME_AND_EXT.<br/>
•<br/>
IsFixed&#160;– If&#160;False,&#160;the&#160;content&#160;is&#160;updated.<br/>
423<br/>
<hr/>
<a name=427></a><i><b>Field&#160;Type</b></i><br/>
<i><b>Description</b></i><br/>
GetExpression<br/>
Display&#160;the&#160;result&#160;from&#160;a&#160;“SetExpression”&#160;text&#160;field.&#160;&#160;(use&#160;<b>Insert&#160;&gt; Fields&#160;&gt;&#160;Other</b>, to&#160;<br/>
open the&#160;Fields dialog,&#160;then&#160;navigate&#160;to the&#160;Cross-references tab).<br/>•<br/>
Content&#160;–&#160;String&#160;content.<br/>
•<br/>
CurrentPresentation – String&#160;containing&#160;the&#160;current&#160;text&#160;of&#160;the&#160;field.<br/>
•<br/>
NumberFormat&#160;–&#160;com.sun.star.util.NumberFormatter&#160;that&#160;formats the&#160;field.<br/>
•<br/>
NumberingType&#160;–&#160;See<a href="libremacros.html#431">&#160;Table&#160;149&#160;p</a>roperty&#160;for&#160;valid&#160;values.<br/>
•<br/>
IsShowFormula&#160;–&#160;If&#160;True,&#160;the&#160;formula&#160;is displayed&#160;rather&#160;than&#160;the&#160;content.<br/>
•<br/>
SubType&#160;–&#160;Variable&#160;type&#160;from&#160;the&#160;com.sun.star.text.SetVariableType&#160;constants with&#160;the&#160;<br/>following&#160;values:&#160;VAR,&#160;SEQUENCE,&#160;FORMULA, and STRING.<br/>
•<br/>
Value&#160;– Numerical&#160;(Double)&#160;value&#160;of&#160;the&#160;field.<br/>
•<br/>
IsFixedLanguage&#160;– If&#160;False,&#160;setting&#160;the&#160;adjacent&#160;text&#160;language&#160;may&#160;change&#160;the&#160;field&#160;<br/>
display.<br/>
<i>A&#160;GetExpression&#160;field references a&#160;SetExpression&#160;field.&#160;If&#160;you delete&#160;the&#160;corresponding&#160;</i><br/>
<i>SetExpression&#160;field,&#160;the&#160;CurrentPresentation&#160;says something&#160;like&#160;“Invalid&#160;reference”, but&#160;I<br/>know&#160;of&#160;no&#160;other way&#160;to determine&#160;that&#160;the&#160;reference&#160;is&#160;no&#160;longer valid.</i><br/>
GetReference<br/>
Reference&#160;field with&#160;these&#160;properties:<br/>•<br/>
CurrentPresentation – String&#160;containing&#160;the&#160;current&#160;text&#160;of&#160;the&#160;field.<br/>
•<br/>
ReferenceFieldSource&#160;– com.sun.star.text.ReferenceFieldSource&#160;constant&#160;with the&#160;<br/>following&#160;values:&#160;REFERENCE_MARK, SEQUENCE_FIELD,&#160;BOOKMARK,&#160;<br/>
FOOTNOTE, or&#160;ENDNOTE.<br/>
•<br/>
SourceName&#160;– String&#160;reference&#160;name&#160;such as a&#160;bookmark name.<br/>
•<br/>
ReferenceFieldPart&#160;–&#160;com.sun.star.text.ReferenceFieldPart&#160;constant&#160;with the&#160;following&#160;<br/>values:&#160;PAGE,&#160;CHAPTER,&#160;TEXT,&#160;UP_DOWN,&#160;PAGE_DESC,&#160;<br/>
CATEGORY_AND_NUMBER, ONLY_CAPTION,&#160;and&#160;<br/>ONLY_SEQUENCE_NUMBER.<br/>
•<br/>
SequenceNumber&#160;– Short&#160;integer&#160;sequence&#160;number&#160;used&#160;as sequence&#160;field&#160;or&#160;<br/>ReferenceId&#160;property&#160;of&#160;a&#160;footnote&#160;or&#160;endnote.<br/>
GraphicObjectCount<br/>
Display&#160;the&#160;number&#160;of&#160;graphic&#160;objects embedded&#160;in the&#160;document. Contains the&#160;<br/>NumberingType&#160;property;&#160;see<a href="libremacros.html#431">&#160;Table&#160;149&#160;pr</a>operty&#160;for&#160;valid&#160;values.<br/>
HiddenParagraph<br/>
Allow&#160;a&#160;paragraph to be&#160;hidden.&#160;Used, for&#160;example, to create&#160;a&#160;test&#160;with&#160;the&#160;questions&#160;and&#160;<br/>answers all&#160;in&#160;one&#160;document. Setting&#160;the&#160;answers&#160;to hidden allows&#160;the&#160;test&#160;questions to be&#160;<br/>
printed&#160;for&#160;the&#160;students.<br/>•<br/>
Condition –&#160;String&#160;condition&#160;to evaluate.<br/>
•<br/>
IsHidden –&#160;Boolean result&#160;of&#160;the&#160;last&#160;evaluation of&#160;the&#160;condition.<br/>
HiddenText<br/>
A&#160;field&#160;with hidden text. Differs from&#160;a&#160;hidden paragraph in that&#160;only&#160;the&#160;text&#160;in the&#160;field&#160;is<br/>
hidden,&#160;rather&#160;than&#160;the&#160;entire&#160;containing&#160;paragraph.<br/>•<br/>
Content&#160;–&#160;String&#160;text&#160;content&#160;of&#160;the&#160;hidden text&#160;field.<br/>
•<br/>
Condition –&#160;String&#160;condition.<br/>
•<br/>
IsHidden –&#160;Boolean result&#160;of&#160;the&#160;last&#160;evaluation of&#160;the&#160;condition.<br/>
Input<br/>
Text&#160;input&#160;field.<br/>•<br/>
Content&#160;–&#160;String&#160;text&#160;content&#160;of&#160;the&#160;field.<br/>
•<br/>
Hint&#160;–&#160;String&#160;hint&#160;text.<br/>
InputUser<br/>
User-defined&#160;text&#160;field that&#160;depends on a&#160;field&#160;master.<br/>•<br/>
Content&#160;–&#160;String&#160;text&#160;content&#160;of&#160;the&#160;field.<br/>
•<br/>
Hint&#160;–&#160;String&#160;hint&#160;text.<br/>
424<br/>
<hr/>
<a name=428></a><i><b>Field&#160;Type</b></i><br/>
<i><b>Description</b></i><br/>
JumpEdit<br/>
Placeholder&#160;text&#160;field.<br/>•<br/>
Hint&#160;–&#160;String&#160;hint&#160;text.<br/>
•<br/>
PlaceHolder&#160;– String&#160;text&#160;of&#160;the&#160;placeholder.<br/>
•<br/>
PlaceHolderType&#160;– com.sun.star.text.PlaceholderType&#160;constant&#160;with&#160;the&#160;following&#160;valid<br/>values:&#160;TEXT,&#160;TABLE,&#160;TEXTFRAME,&#160;GRAPHIC,&#160;or&#160;OBJECT.<br/>
Macro<br/>
Macro&#160;text&#160;field.<br/>•<br/>
Hint&#160;–&#160;String&#160;hint&#160;text.<br/>
•<br/>
MacroName&#160;–&#160;String&#160;macro&#160;name&#160;to run.<br/>
•<br/>
MacroLibrary&#160;–&#160;String&#160;library&#160;name&#160;that&#160;contains the&#160;macro.<br/>
PageCount<br/>
Display&#160;the&#160;number&#160;of&#160;pages in the&#160;document. Contains the&#160;NumberingType&#160;property;&#160;se<a href="libremacros.html#431">e<br/>Table&#160;149&#160;pr</a>operty&#160;for&#160;valid&#160;values.<br/>
PageNumber<br/>
Display&#160;a&#160;page&#160;number.<br/>•<br/>
Offset&#160;– Short&#160;Integer&#160;offset&#160;to show&#160;a&#160;different&#160;page&#160;number.<br/>
•<br/>
SubType&#160;–&#160;Which page&#160;is displayed&#160;from&#160;the&#160;com.sun.star.text.PageNumberType&#160;<br/>enumeration.&#160;Valid&#160;values:&#160;PREV,&#160;CURRENT,&#160;or&#160;NEXT.<br/>
•<br/>
UserText&#160;– String&#160;that&#160;is displayed&#160;when&#160;the&#160;NumberingType&#160;is&#160;CHAR_SPECIAL.<br/>
•<br/>
NumberingType&#160;–&#160;See<a href="libremacros.html#431">&#160;Table&#160;149&#160;p</a>roperty&#160;for&#160;valid&#160;values.<br/>
ParagraphCount<br/>
Display&#160;the&#160;number&#160;of&#160;paragraphs in the&#160;document. Contains the&#160;NumberingType&#160;property;<br/>see<a href="libremacros.html#431">&#160;Table&#160;149&#160;p</a>roperty&#160;for&#160;valid&#160;values.<br/>
ReferencePageGet<br/>
Display&#160;the&#160;page&#160;number&#160;of&#160;a&#160;reference&#160;point.&#160;Contains&#160;the&#160;NumberingType&#160;property;&#160;se<a href="libremacros.html#431">e<br/>Table&#160;149&#160;pr</a>operty&#160;for&#160;valid&#160;values.<br/>
ReferencePageSet<br/>
Insert&#160;additional&#160;page&#160;numbers.&#160;Contains these&#160;properties:<br/>•<br/>
Offset&#160;– Short&#160;Integer&#160;that&#160;changes the&#160;displayed&#160;value&#160;of&#160;a&#160;ReferencePageGet&#160;field.<br/>
•<br/>
NameOn&#160;– If&#160;True, the&#160;ReferencePageGet&#160;text&#160;fields&#160;are&#160;displayed.<br/>
Script<br/>
Display&#160;text&#160;obtained by&#160;running&#160;a&#160;script. Contains&#160;these&#160;properties:<br/>•<br/>
Content&#160;–&#160;Script&#160;text&#160;or&#160;URL&#160;of&#160;the&#160;script&#160;as a&#160;string.<br/>
•<br/>
ScriptType&#160;– String&#160;script&#160;type,&#160;such as JavaScript.<br/>
•<br/>
URLContent&#160;–&#160;If&#160;True,&#160;Content&#160;is a&#160;URL.&#160;If&#160;False,&#160;Content&#160;is&#160;the&#160;script&#160;text.<br/>
425<br/>
<hr/>
<a name=429></a><i><b>Field&#160;Type</b></i><br/>
<i><b>Description</b></i><br/>
SetExpression<br/>
An&#160;expression&#160;text&#160;field (use&#160;<b>Insert&#160;&gt;&#160;Fields &gt;&#160;Other</b>,&#160;to open the&#160;Fields&#160;dialog,&#160;then&#160;<br/>
navigate&#160;to&#160;the&#160;Variables tab). Contains these&#160;properties:<br/>•<br/>
Content&#160;–&#160;String&#160;content.<br/>
•<br/>
CurrentPresentation – String&#160;containing&#160;the&#160;current&#160;text&#160;of&#160;the&#160;field.<br/>
•<br/>
NumberFormat&#160;–&#160;com.sun.star.util.NumberFormatter&#160;that&#160;formats the&#160;field.<br/>
•<br/>
NumberingType&#160;–&#160;See<a href="libremacros.html#431">&#160;Table&#160;149&#160;p</a>roperty&#160;for&#160;valid&#160;values.<br/>
•<br/>
IsShowFormula&#160;–&#160;If&#160;True,&#160;the&#160;formula&#160;is displayed&#160;rather&#160;than&#160;the&#160;content.<br/>
•<br/>
Hint&#160;–&#160;String&#160;hint&#160;used&#160;if&#160;this is&#160;an input&#160;field.<br/>
•<br/>
IsInput&#160;–&#160;If&#160;True,&#160;the&#160;field&#160;is an input&#160;field.<br/>
•<br/>
IsVisible&#160;– If&#160;True,&#160;the&#160;field&#160;is visible.<br/>
•<br/>
SequenceValue&#160;–&#160;Sequence&#160;value&#160;when this field&#160;is used&#160;as&#160;sequence&#160;field.<br/>
•<br/>
SubType&#160;–&#160;Variable&#160;type&#160;from&#160;the&#160;com.sun.star.text.SetVariableType&#160;constants with&#160;the&#160;<br/>following&#160;values:&#160;VAR,&#160;SEQUENCE,&#160;FORMULA, and STRING.<br/>
•<br/>
Value&#160;– Numerical&#160;(Double)&#160;value&#160;of&#160;the&#160;field.<br/>
•<br/>
VariableName&#160;– Name&#160;of&#160;the&#160;associated&#160;set&#160;expression field master.<br/>
•<br/>
IsFixedLanguage&#160;– If&#160;False,&#160;setting&#160;the&#160;adjacent&#160;text&#160;language&#160;may&#160;change&#160;the&#160;field&#160;<br/>display.<br/>
TableCount<br/>
Display&#160;the&#160;number&#160;of&#160;tables in the&#160;document. Contains the&#160;NumberingType&#160;property;&#160;se<a href="libremacros.html#431">e<br/>Table&#160;149&#160;pr</a>operty&#160;for&#160;valid&#160;values.<br/>
TemplateName<br/>
Display&#160;the&#160;name&#160;of&#160;the&#160;template&#160;used to create&#160;the&#160;document. Supports the&#160;FileFormat&#160;<br/>property&#160;as supported&#160;by&#160;the&#160;Filename&#160;property.<br/>
URL<br/>
Display&#160;a&#160;URL.&#160;Contains these&#160;properties:<br/>•<br/>
Format&#160;– Short&#160;Integer&#160;specifying&#160;the&#160;URL&#160;output&#160;format.<br/>
•<br/>
URL&#160;–&#160;String&#160;containing&#160;the&#160;unparsed&#160;original&#160;URL.<br/>
•<br/>
Representation&#160;– Display&#160;string&#160;shown&#160;to the&#160;user.<br/>
•<br/>
TargetFrame&#160;–&#160;String&#160;frame&#160;name&#160;where&#160;the&#160;URL&#160;will&#160;be&#160;opened.<br/>
User<br/>
Display&#160;a&#160;user-defined&#160;field&#160;with a&#160;field&#160;master.&#160;Contains these&#160;properties:<br/>•<br/>
IsShowFormula&#160;–&#160;If&#160;True,&#160;the&#160;formula&#160;is displayed&#160;rather&#160;than&#160;the&#160;content.<br/>
•<br/>
IsVisible&#160;– If&#160;True,&#160;the&#160;field&#160;is visible.<br/>
•<br/>
NumberFormat&#160;–&#160;com.sun.star.util.NumberFormatter&#160;that&#160;formats the&#160;field.<br/>
•<br/>
IsFixedLanguage&#160;– If&#160;False,&#160;setting&#160;the&#160;adjacent&#160;text&#160;language&#160;may&#160;change&#160;the&#160;field&#160;<br/>
display.<br/>
WordCount<br/>
Display&#160;the&#160;number&#160;of&#160;words in&#160;the&#160;document. Contains&#160;the&#160;NumberingType&#160;property;&#160;se<a href="libremacros.html#431">e</a><br/>
<a href="libremacros.html#431">Table&#160;149&#160;pr</a>operty&#160;for&#160;valid&#160;values.<br/>
docinfo.ChangeAuthor<br/>
Display&#160;the&#160;name&#160;of&#160;the&#160;last&#160;author&#160;to modify&#160;the&#160;document.<br/>•<br/>
Author&#160;– String&#160;containing&#160;the&#160;name&#160;of&#160;the&#160;author.<br/>
•<br/>
CurrentPresentation – Current&#160;content&#160;of&#160;the&#160;text&#160;field as a&#160;String.<br/>
•<br/>
IsFixed&#160;– If&#160;False,&#160;the&#160;content&#160;is&#160;updated&#160;when the&#160;document&#160;is saved.<br/>
426<br/>
<hr/>
<a name=430></a><i><b>Field&#160;Type</b></i><br/>
<i><b>Description</b></i><br/>
docinfo.ChangeDateTime<br/>
Display&#160;the&#160;date&#160;and time&#160;the&#160;document&#160;was&#160;last&#160;changed.&#160;Contains these&#160;properties:<br/>•<br/>
CurrentPresentation – Current&#160;content&#160;of&#160;the&#160;text&#160;field as a&#160;String.<br/>
•<br/>
IsFixed&#160;– If&#160;False,&#160;the&#160;current&#160;date&#160;or&#160;time&#160;is&#160;displayed.<br/>
•<br/>
IsDate&#160;–&#160;If&#160;False,&#160;this&#160;is only&#160;a&#160;time. If&#160;True,&#160;this&#160;is a&#160;date&#160;with&#160;an optional&#160;time.<br/>
•<br/>
DateTimeValue&#160;–&#160;com.sun.star.util.DateTime&#160;object&#160;with the&#160;actual&#160;content.<br/>
•<br/>
NumberFormat&#160;–&#160;com.sun.star.util.NumberFormatter&#160;that&#160;formats the&#160;field.<br/>
•<br/>
IsFixedLanguage&#160;– If&#160;False,&#160;setting&#160;the&#160;adjacent&#160;text&#160;language&#160;may&#160;change&#160;the&#160;field&#160;<br/>
display.<br/>
docinfo.CreateAuthor<br/>
Display&#160;the&#160;name&#160;of&#160;the&#160;author&#160;who&#160;created&#160;the&#160;document&#160;(see&#160;docinfo.ChangeAuthor&#160;for&#160;<br/>
supported properties).<br/>
docinfo.CreateDateTime<br/>
Display&#160;the&#160;date&#160;and time&#160;the&#160;document&#160;was&#160;created&#160;(see&#160;docinfo.ChangeDateTime&#160;for&#160;<br/>
supported properties).<br/>
docinfo.Custom<br/>
Display&#160;the&#160;user-defined&#160;field in&#160;the&#160;document&#160;information;&#160;used&#160;to be&#160;docinfo.Info0.<br/>
docinfo.Description<br/>
Display&#160;the&#160;document&#160;description as contained&#160;in&#160;the&#160;document&#160;properties (File&#160;|&#160;<br/>Properties).<br/>•<br/>
Content&#160;–&#160;String&#160;content.<br/>
•<br/>
CurrentPresentation – String&#160;containing&#160;the&#160;current&#160;text&#160;of&#160;the&#160;field.<br/>
•<br/>
IsFixed&#160;– If&#160;False,&#160;the&#160;content&#160;is&#160;updated&#160;when the&#160;document&#160;information is&#160;changed.<br/>
docinfo.EditTime<br/>
Display&#160;the&#160;duration the&#160;document&#160;has been edited.&#160;In&#160;other&#160;words,&#160;how&#160;long&#160;did it&#160;take&#160;to&#160;<br/>
write?<br/>•<br/>
CurrentPresentation – String&#160;containing&#160;the&#160;current&#160;text&#160;of&#160;the&#160;field.<br/>
•<br/>
IsFixed&#160;– If&#160;False,&#160;the&#160;date&#160;or&#160;time&#160;is always displayed&#160;as&#160;the&#160;current&#160;date&#160;or&#160;time.<br/>
•<br/>
DateTimeValue&#160;–&#160;Date&#160;and&#160;time&#160;as a&#160;Double.<br/>
•<br/>
NumberFormat&#160;–&#160;com.sun.star.util.NumberFormatter&#160;that&#160;formats the&#160;field.<br/>
•<br/>
IsFixedLanguage&#160;– If&#160;False,&#160;setting&#160;the&#160;adjacent&#160;text&#160;language&#160;may&#160;change&#160;the&#160;field&#160;<br/>
display.<br/>
docinfo.Info0<br/>
Deprecated,&#160;use&#160;docinfo.Custom&#160;instead.<br/>
docinfo.Info1<br/>
Deprecated,&#160;use&#160;docinfo.Custom&#160;instead.<br/>
docinfo.Info2<br/>
Deprecated,&#160;use&#160;docinfo.Custom&#160;instead.<br/>
docinfo.Info3<br/>
Deprecated,&#160;use&#160;docinfo.Custom&#160;instead.<br/>
docinfo.Keywords<br/>
Display&#160;the&#160;document&#160;info keywords&#160;(see&#160;docinfo.Description).<br/>
docinfo.PrintAuthor<br/>
Display&#160;the&#160;name&#160;of&#160;the&#160;author&#160;who&#160;printed&#160;the&#160;document&#160;(see&#160;docinfo.ChangeAuthor&#160;for&#160;<br/>supported properties).<br/>
docinfo.PrintDateTime<br/>
Display&#160;the&#160;time&#160;the&#160;document&#160;was last&#160;printed&#160;(see&#160;docinfo.ChangeDateTime&#160;for&#160;<br/>supported properties).<br/>
docinfo.Revision<br/>
Display&#160;the&#160;current&#160;document&#160;revision (see&#160;docinfo.Description).<br/>
docinfo.Subject<br/>
Display&#160;the&#160;document&#160;subject&#160;specified in&#160;the&#160;document&#160;information (see&#160;<br/>
docinfo.Description).<br/>
docinfo.Title<br/>
Display&#160;the&#160;document&#160;title&#160;specified&#160;in the&#160;document&#160;information (see&#160;<br/>
docinfo.Description).<br/>
427<br/>
<hr/>
<a name=431></a><b>TIP</b><br/>
The&#160;Annotation field&#160;is a&#160;service&#160;of&#160;type&#160;com.sun.star.text.TextField.Annotation.&#160;Some&#160;sources&#160;of&#160;<br/>
documentation show&#160;the&#160;text&#160;“textfield”&#160;in&#160;all&#160;lowercase&#160;letters;&#160;this is&#160;incorrect.&#160;The&#160;code&#160;in<a href="libremacros.html#432">&#160;Listing&#160;385<b>&#160;<br/></b></a>shows this correctly.<br/>
<a href="libremacros.html#431">Table&#160;149&#160;c</a>ontains&#160;the&#160;valid&#160;values&#160;for the&#160;CharacterCount&#160;property&#160;from<a href="libremacros.html#425">&#160;Table&#160;148. M</a>ost&#160;API&#160;listings&#160;stop&#160;<br/>at&#160;CIRCLE_NUMBER=14, I&#160;do not&#160;know&#160;why.<br/>
<i><b>Table&#160;149.&#160;</b>Constants&#160;defined by&#160;com.sun.star.style.NumberingType.</i><br/>
<i><b>Constant</b></i><br/>
<i><b>Description</b></i><br/>
CHARS_UPPER_LETTER&#160;<br/>
Numbering&#160;is&#160;in&#160;uppercase&#160;letters as “A, B,&#160;C, D,&#160;...”.<br/>
CHARS_LOWER_LETTER&#160;<br/>
Numbering&#160;is&#160;in&#160;lowercase&#160;letters&#160;as&#160;“a,&#160;b, c,&#160;d,...”.<br/>
ROMAN_UPPER&#160;<br/>
Numbering&#160;is&#160;in&#160;Roman numbers with&#160;uppercase&#160;letters as “I,&#160;II,&#160;III,&#160;<br/>
IV,&#160;...”.<br/>
ROMAN_LOWER&#160;<br/>
Numbering&#160;is&#160;in&#160;Roman numbers with&#160;lowercase&#160;letters&#160;as&#160;“i, ii, iii,&#160;iv,&#160;...”.<br/>
ARABIC&#160;<br/>
Numbering&#160;is&#160;in&#160;Arabic&#160;numbers&#160;as&#160;“1,&#160;2, 3,&#160;4,&#160;...”.<br/>
NUMBER_NONE&#160;<br/>
Numbering&#160;is&#160;invisible.<br/>
CHAR_SPECIAL&#160;<br/>
Use&#160;a&#160;character&#160;from&#160;a&#160;specified&#160;font.<br/>
PAGE_DESCRIPTOR&#160;<br/>
Numbering&#160;is&#160;specified&#160;in&#160;the&#160;page&#160;style.<br/>
BITMAP&#160;<br/>
Numbering&#160;is&#160;displayed&#160;as a&#160;bitmap&#160;graphic.<br/>
CHARS_UPPER_LETTER_N&#160;<br/>
Numbering&#160;is&#160;in&#160;uppercase&#160;letters as “A, B,&#160;...,&#160;Y,&#160;Z,&#160;AA,&#160;BB,&#160;CC, ...&#160;<br/>
AAA,&#160;...”.<br/>
CHARS_LOWER_LETTER_N&#160;<br/>
Numbering&#160;is&#160;in&#160;lowercase&#160;letters&#160;as&#160;“a,&#160;b, ..., y,&#160;z, aa,&#160;bb,&#160;cc,&#160;...&#160;aaa, ...”.<br/>
TRANSLITERATION&#160;<br/>
A&#160;transliteration module&#160;is used&#160;to produce&#160;numbers in Chinese, Japanese,<br/>etc.<br/>
NATIVE_NUMBERING&#160;<br/>
The&#160;native-number-supplier&#160;service&#160;is&#160;called to&#160;produce&#160;numbers&#160;in&#160;native<br/>languages.<br/>
FULLWIDTH_ARABIC&#160;<br/>
Numbering&#160;for&#160;full-width&#160;Arabic&#160;number.<br/>
CIRCLE_NUMBER&#160;<br/>
Bullet&#160;for&#160;Circle&#160;Number.<br/>
NUMBER_LOWER_ZH&#160;<br/>
Numbering&#160;for&#160;Chinese&#160;lowercase&#160;numbers.<br/>
NUMBER_UPPER_ZH&#160;<br/>
Numbering&#160;for&#160;Chinese&#160;uppercase&#160;numbers.<br/>
NUMBER_UPPER_ZH_TW&#160;<br/>
Numbering&#160;for&#160;Traditional&#160;Chinese&#160;uppercase&#160;numbers.<br/>
TIAN_GAN_ZH&#160;<br/>
Bullet&#160;for&#160;Chinese&#160;Tian Gan.<br/>
DI_ZI_ZH&#160;<br/>
Bullet&#160;for&#160;Chinese&#160;Di&#160;Zi.<br/>
NUMBER_TRADITIONAL_JA&#160;<br/>
Numbering&#160;for&#160;Japanese&#160;traditional&#160;numbers.<br/>
AIU_FULLWIDTH_JA&#160;<br/>
Bullet&#160;for&#160;Japanese&#160;AIU&#160;full&#160;width.<br/>
AIU_HALFWIDTH_JA&#160;<br/>
Bullet&#160;for&#160;Japanese&#160;AIU&#160;half&#160;width.<br/>
IROHA_FULLWIDTH_JA&#160;<br/>
Bullet&#160;for&#160;Japanese&#160;IROHA&#160;full&#160;width.<br/>
IROHA_HALFWIDTH_JA&#160;<br/>
Bullet&#160;for&#160;Japanese&#160;IROHA&#160;half&#160;width.<br/>
NUMBER_UPPER_KO&#160;<br/>
Numbering&#160;for&#160;Korean uppercase&#160;numbers.<br/>
NUMBER_HANGUL_KO&#160;<br/>
Numbering&#160;for&#160;Korean hangul&#160;numbers.<br/>
HANGUL_JAMO_KO&#160;<br/>
Bullet&#160;for&#160;Korean Hangul&#160;Jamo.<br/>
428<br/>
<hr/>
<a name=432></a><i><b>Constant</b></i><br/>
<i><b>Description</b></i><br/>
HANGUL_SYLLABLE_KO&#160;<br/>
Bullet&#160;for&#160;Korean Hangul&#160;Syllable.<br/>
HANGUL_CIRCLED_JAMO_KO&#160;<br/>
Bullet&#160;for&#160;Korean Hangul&#160;Circled Jamo.<br/>
HANGUL_CIRCLED_SYLLABLE_KO&#160;<br/>
Bullet&#160;for&#160;Korean Hangul&#160;Circled Syllable.<br/>
CHARS_ARABIC&#160;<br/>
Numbering&#160;in&#160;Arabic&#160;alphabet&#160;letters.<br/>
CHARS_THAI&#160;<br/>
Numbering&#160;in&#160;Thai&#160;alphabet&#160;letters.<br/>
The&#160;text&#160;fields&#160;contained in&#160;the&#160;document&#160;are&#160;available&#160;using the&#160;getTextFields() object&#160;method&#160;(see<a href="libremacros.html#410">&#160;Table&#160;<br/>137)</a>. Every&#160;text&#160;field object&#160;supports&#160;the&#160;object&#160;method&#160;getPresentation(boolean), which returns&#160;a&#160;string&#160;<br/>representing either the&#160;field&#160;type&#160;(True) or the&#160;displayed&#160;text&#160;(False). See<a href="libremacros.html#432">&#160;<b>Listing&#160;385</b>&#160;and&#160;<b>Figure&#160;95</b>.</a><br/>
<i><b>Listing&#160;385.&#160;</b>Display&#160;Fields.<br/></i>Sub&#160;DisplayFields<br/>&#160;&#160;oEnum&#160;=&#160;ThisComponent.getTextFields().createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements()<br/>&#160; &#160;&#160;oField&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oField.getPresentation(True)&#160;&#160;&amp;&#160;&#34; = &#34;&#160; &#160;&#160;'Field type<br/>&#160; &#160;&#160;If&#160;oField.supportsService(&#34;com.sun.star.text.TextField.Annotation&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;REM More cryptic, I could use If oField.getPresentation(True) = &#34;Note&#34;...<br/>&#160; &#160; &#160;&#160;REM A &#34;Note&#34; has no displayed content so calling getPresentation(False)<br/>&#160; &#160; &#160;&#160;REM returns an empty string. Instead, obtain the author and the content.<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oField.Author&#160;&amp;&#160;&#34; says &#34;&#160;&amp;&#160;oField.Content<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oField.getPresentation(False)&#160; &#160; &#160; &#160; &#160;&#160;'String content<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(13)<br/>&#160;&#160;Loop<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Text Fields&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;95.&#160;</b>Text&#160;fields&#160;in the&#160;current&#160;document.</i><br/>
The&#160;source&#160;document&#160;used to&#160;create<a href="libremacros.html#432">&#160;Figure&#160;95&#160;c</a>ontains&#160;a&#160;DateTime&#160;field, PageNumber fields,&#160;Annotation&#160;<br/>field, and a&#160;User field.&#160;The&#160;code&#160;in<a href="libremacros.html#432">&#160;Listing 385&#160;p</a>rovides&#160;special&#160;treatment&#160;for note&#160;fields&#160;to&#160;display&#160;both&#160;the&#160;<br/>author and the&#160;note.&#160;The&#160;field&#160;is&#160;checked to&#160;see&#160;if it&#160;supports&#160;the&#160;Annotation&#160;service&#160;by&#160;using the&#160;<br/>supportsServiceObject() method.<br/>
The&#160;primary&#160;method of finding a&#160;specific&#160;text&#160;field is&#160;by&#160;enumerating the&#160;text&#160;fields&#160;as&#160;shown in<a href="libremacros.html#432">&#160;Listing 385.<br/></a>If&#160;the&#160;document&#160;is&#160;large&#160;and contains&#160;many&#160;text&#160;fields, it&#160;may&#160;take&#160;a&#160;long time&#160;to&#160;find a&#160;specific&#160;text&#160;field.&#160;If&#160;<br/>you&#160;know&#160;where&#160;the&#160;text&#160;field is&#160;located in&#160;the&#160;document<a href="libremacros.html#392">,&#160;Listing&#160;354&#160;de</a>monstrates&#160;how&#160;to&#160;find a&#160;text&#160;field&#160;<br/>by&#160;enumerating text&#160;content&#160;in a&#160;paragraph.<br/>
429<br/>
<hr/>
<a name=433></a><b>TIP</b><br/>
Text&#160;fields implement&#160;the&#160;object&#160;method update().&#160;The&#160;update()&#160;method&#160;causes a&#160;text&#160;field to&#160;update&#160;itself&#160;<br/>
with the&#160;most&#160;current&#160;information if&#160;it&#160;is applicable.&#160;For&#160;example,&#160;date/time,&#160;file&#160;name,&#160;and&#160;the&#160;document&#160;<br/>information text&#160;fields all&#160;update&#160;to&#160;the&#160;most&#160;current&#160;information.<br/>
<b>&#160;14.10.1.&#160;Text&#160;master&#160;fields<br/></b>Some&#160;text&#160;fields&#160;contain&#160;their own content,&#160;and others&#160;rely&#160;on an external&#160;source&#160;to obtain the&#160;displayed&#160;<br/>information.&#160;The&#160;external&#160;source&#160;is&#160;called a&#160;master field.<a href="libremacros.html#433">&#160;Table&#160;150&#160;l</a>ists&#160;the&#160;text&#160;field types&#160;that&#160;require&#160;a&#160;<br/>master field.&#160;Besides&#160;the&#160;properties&#160;shown in<a href="libremacros.html#433">&#160;Table&#160;150, e</a>very&#160;text&#160;field master also&#160;supports&#160;the&#160;properties&#160;<br/>shown in<a href="libremacros.html#434">&#160;Table&#160;151.</a><br/>
<b>TIP</b><br/>
The&#160;object&#160;method&#160;getTextFieldMaster()&#160;returns&#160;a&#160;text&#160;field’s&#160;master&#160;field. Unfortunately,&#160;every&#160;field,&#160;even&#160;<br/>
fields that&#160;do&#160;not&#160;have&#160;master&#160;fields, implements this method&#160;and&#160;returns a&#160;non-null&#160;master&#160;field.&#160;OOo may&#160;<br/>crash if&#160;you obtain and&#160;manipulate&#160;a&#160;master&#160;field&#160;from&#160;a&#160;field that&#160;does not&#160;contain&#160;one.<br/>
Although text&#160;fields&#160;are&#160;accessible&#160;only&#160;by&#160;enumeration,&#160;master fields&#160;are&#160;accessible&#160;by&#160;name&#160;and&#160;<br/>enumeration&#160;(see<a href="libremacros.html#410">&#160;Table&#160;137)</a>.&#160;The&#160;name&#160;used for a&#160;master field&#160;is&#160;obtained&#160;by&#160;appending the&#160;field name&#160;to&#160;<br/>the&#160;field&#160;master type. For&#160;example, the&#160;User field&#160;“AndyField”, as&#160;shown in<a href="libremacros.html#432">&#160;Figure&#160;95, ha</a>s&#160;a&#160;master field&#160;<br/>named com.sun.star.text.FieldMaster.User.AndyField. Database&#160;master fields&#160;are&#160;named differently&#160;than all&#160;<br/>of the&#160;other master fields;&#160;they&#160;append the&#160;DatabaseName, DatatableName, and DataColumnName&#160;to&#160;the&#160;<br/>service&#160;name<a href="libremacros.html#434">.&#160;Listing&#160;386&#160;de</a>monstrates&#160;how&#160;to&#160;obtain&#160;the&#160;text&#160;field&#160;masters&#160;in a&#160;document<a href="libremacros.html#435">.&#160;Figure&#160;96&#160;s</a>hows&#160;<br/>the&#160;results.<br/>
<i><b>Table&#160;150.&#160;</b>Text&#160;field services&#160;starting&#160;with com.sun.star.text.FieldMaster.</i><br/>
<i><b>Field&#160;</b></i><br/>
<i><b>Description</b></i><br/>
<i><b>Type</b></i><br/>
Bibliography<br/>
Field&#160;master&#160;to a&#160;Bibliography&#160;text&#160;field. Contains these&#160;properties:<br/>•<br/>
IsNumberEntries –&#160;If&#160;True,&#160;the&#160;fields are&#160;numbered;&#160;otherwise,&#160;the&#160;short&#160;entry&#160;name&#160;is&#160;<br/>
used.<br/>
•<br/>
IsSortByPosition&#160;– If&#160;True, the&#160;bibliography&#160;index&#160;is sorted&#160;by&#160;the&#160;document&#160;position&#160;<br/>
(see&#160;SortKeys).<br/>
•<br/>
BracketBefore&#160;–&#160;The&#160;opening&#160;bracket&#160;displayed&#160;in the&#160;Bibliography&#160;text&#160;field.<br/>
•<br/>
BracketAfter&#160;–&#160;The&#160;closing&#160;bracket&#160;displayed&#160;in the&#160;Bibliography&#160;text&#160;field.<br/>
•<br/>
SortKeys&#160;–&#160;This&#160;array&#160;of&#160;PropertyValues is&#160;used if&#160;IsSortByPosition is&#160;False.&#160;The&#160;<br/>
properties are&#160;a&#160;sequence&#160;of&#160;the&#160;property&#160;SortKey&#160;<br/>(com.sun.star.text.BibliographyDataField constant&#160;identifying&#160;the&#160;field to sort)&#160;and&#160;<br/>
IsSortAscending&#160;(Boolean).<br/>
•<br/>
Locale&#160;–&#160;com.sun.star.lang.Locale&#160;of&#160;the&#160;field master.<br/>
•<br/>
SortAlgorithm&#160;–&#160;String&#160;containing&#160;the&#160;name&#160;of&#160;the&#160;sort&#160;algorithm&#160;used to&#160;sort&#160;the&#160;text&#160;<br/>fields.<br/>
DDE<br/>
Field&#160;master&#160;to a&#160;DDE text&#160;field.&#160;Contains these&#160;properties:<br/>•<br/>
DDECommandElement&#160;– DDE&#160;command as a&#160;string.<br/>
•<br/>
DDECommandFile&#160;– File&#160;string&#160;of&#160;the&#160;DDE&#160;command.<br/>
•<br/>
DDECommandType&#160;– DDE&#160;command type&#160;as&#160;a&#160;string.<br/>
•<br/>
IsAutomaticUpdate&#160;– If&#160;True,&#160;the&#160;DDE link is&#160;automatically&#160;updated.<br/>
430<br/>
<hr/>
<a name=434></a><i><b>Field&#160;</b></i><br/>
<i><b>Description</b></i><br/>
<i><b>Type</b></i><br/>
Database<br/>
Field&#160;master&#160;to a&#160;Database&#160;text&#160;field.&#160;Contains&#160;these&#160;properties:<br/>•<br/>
DataBaseName&#160;–&#160;String&#160;name&#160;of&#160;the&#160;data&#160;source.<br/>
•<br/>
CommandType&#160;– Long&#160;Integer&#160;CommandType&#160;(0 =&#160;table,&#160;1 =&#160;query,&#160;2 =&#160;statement).<br/>
•<br/>
DataTableName&#160;– Command string&#160;type&#160;is determined&#160;by&#160;the&#160;CommandType&#160;property.<br/>
•<br/>
DataColumnName&#160;– Database&#160;column&#160;name&#160;as a&#160;String.<br/>
SetExpression<br/>
Field&#160;master&#160;to a&#160;“set&#160;expression”&#160;text&#160;field.&#160;Contains these&#160;properties:<br/>•<br/>
ChapterNumberingLevel&#160;–&#160;Chapter&#160;number&#160;as a&#160;byte,&#160;if&#160;this is a&#160;number&#160;sequence.<br/>
•<br/>
NumberingSeparator&#160;–&#160;Numbering&#160;separator&#160;string,&#160;used if&#160;this&#160;is&#160;a&#160;number&#160;sequence.<br/>
•<br/>
SubType&#160;–&#160;Variable&#160;type&#160;from&#160;the&#160;com.sun.star.text.SetVariableType&#160;constants with&#160;the<br/>following&#160;values:&#160;VAR,&#160;SEQUENCE,&#160;FORMULA, and STRING.<br/>
User<br/>
Field&#160;master&#160;to a&#160;user&#160;text&#160;field. Contains the&#160;properties:<br/>•<br/>
IsExpression – If&#160;True,&#160;the&#160;field&#160;contains an expression.<br/>
•<br/>
Value&#160;– Double&#160;value.<br/>
•<br/>
Content&#160;–&#160;Field content&#160;as a&#160;string.<br/>
<i><b>Table&#160;151.&#160;</b>Properties&#160;defined&#160;by&#160;the&#160;service&#160;com.sun.star.text.FieldMaster.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Name&#160;<br/>
Optional&#160;string&#160;with the&#160;field name;&#160;this&#160;must&#160;be&#160;set&#160;before&#160;the&#160;field&#160;is added to&#160;the&#160;document.<br/>
DependentTextFields&#160;<br/>
Array&#160;of&#160;text&#160;fields that&#160;use&#160;this&#160;master&#160;field.<br/>
InstanceName&#160;<br/>
String&#160;instance&#160;name&#160;as&#160;it&#160;is used&#160;in the&#160;XTextFieldsSupplier.<br/>
<i><b>Listing&#160;386.&#160;</b>Show text&#160;field&#160;masters.<br/></i>Sub&#160;ShowFieldMasters<br/>&#160;&#160;Dim&#160;oMasters&#160; &#160; &#160;&#160;'All of the text field masters<br/>&#160;&#160;Dim&#160;oMasterNames&#160;&#160;'Array of the text field master names<br/>&#160;&#160;Dim&#160;i%,&#160;j%&#160; &#160; &#160; &#160;&#160;'Index variables<br/>&#160;&#160;Dim&#160;sMasterName$&#160;&#160;'Full name of the master field<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Utility string<br/>&#160;&#160;Dim&#160;oMaster&#160; &#160; &#160; &#160;'Master field<br/>
&#160;&#160;REM Obtain the text field masters object.<br/>&#160;&#160;oMasters&#160;=&#160;ThisComponent.getTextFieldMasters()<br/>
&#160;&#160;REM Obtain ALL of the text master field names.<br/>&#160;&#160;REM This is an array of strings.<br/>&#160;&#160;oMasterNames&#160;=&#160;oMasters.getElementNames()<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(oMasterNames)&#160;to&#160;UBound(oMasterNames)<br/>&#160;&#160;<br/>&#160; &#160;&#160;REM For a given name, obtain the master field,<br/>&#160; &#160;&#160;REM then look at the DependentTextFields property,<br/>&#160; &#160;&#160;REM which is an array of text fields that depend<br/>&#160; &#160;&#160;REM on this master field.<br/>&#160; &#160;&#160;sMasterName&#160;=&#160;oMasterNames(i)<br/>&#160; &#160;&#160;oMaster&#160;=&#160;oMasters.getByName(sMasterName)<br/>
431<br/>
<hr/>
<a name=435></a>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;***&#34;&#160;&amp;&#160;sMasterName&#160;&amp;&#160;&#34;***&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oMaster.Name&#160;&amp;&#160;&#34; Contains &#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;CStr(UBound(oMaster.DependentTextFields)&#160;+&#160;1)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34; dependent fields&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(13)<br/>&#160;&#160;Next&#160;I<br/>&#160;&#160;REM Directly obtain a master field based on the name.<br/>&#160;&#160;REM This is a user field that I added to the source code file.<br/>&#160;&#160;If&#160;oMasters.hasByName(&#34;com.sun.star.text.FieldMaster.User.AndyField&#34;)&#160;Then<br/>&#160; &#160;&#160;oMaster=oMasters.getByName(&#34;com.sun.star.text.FieldMaster.User.AndyField&#34;)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Directly obtained the field master &#34;&#160;&amp;&#160;oMaster.Name&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34;The field contains the text &#34;&#160;&amp;&#160;oMaster.Content<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Text Field Masters&#34;&#160;&#160;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;96.&#160;</b>Text&#160;master&#160;fields&#160;in the&#160;current&#160;document.</i><br/>
<b>&#160;14.10.2.&#160;Creating&#160;and&#160;adding&#160;text&#160;fields<br/></b>Text&#160;fields&#160;must&#160;be&#160;created&#160;by&#160;the&#160;document&#160;that&#160;will&#160;contain them. It&#160;is&#160;also&#160;the&#160;document&#160;that&#160;will&#160;destroy&#160;<br/>them&#160;if you&#160;choose&#160;to remove&#160;them&#160;from&#160;the&#160;document<a href="libremacros.html#436">.&#160;Listing&#160;387&#160;de</a>monstrates&#160;the&#160;creation,&#160;<br/>configuration, and insertion&#160;of both a&#160;DateTime&#160;text&#160;field&#160;and an&#160;Annotation text&#160;field.&#160;The&#160;text&#160;fields&#160;are&#160;<br/>appended to&#160;the&#160;end of the&#160;document.&#160;The&#160;DateTime&#160;text&#160;field is&#160;formatted in&#160;an unusual&#160;manner,&#160;so a&#160;new&#160;<br/>number format&#160;style&#160;is&#160;created if it&#160;does&#160;not&#160;yet&#160;exist.<br/>
<b>TIP</b><br/>
The&#160;very&#160;popular&#160;routine&#160;FindCreateNumberFormatStyle&#160;(see<a href="libremacros.html#440">&#160;Listing&#160;391)</a>&#160;is used by<a href="libremacros.html#436">&#160;Listing&#160;387.</a><br/>
What&#160;is&#160;required to&#160;properly&#160;insert&#160;an annotation field&#160;has&#160;changed over time&#160;and may&#160;differ between&#160;AOO&#160;<br/>and LO.&#160;When OOo, inserting an annotation&#160;set&#160;the&#160;insertion&#160;date&#160;to the&#160;current&#160;time.&#160;My&#160;latest&#160;testing&#160;with&#160;<br/>LO&#160;4.0.1.2 does&#160;not&#160;set&#160;a&#160;date. In&#160;LO, there&#160;is&#160;a&#160;Date&#160;property,&#160;which seems&#160;to be&#160;ignored.&#160;To&#160;set&#160;the&#160;date, ou<br/>must&#160;set&#160;the&#160;DateTimeValue&#160;property&#160;instead.&#160;The&#160;insertion&#160;date/time&#160;must&#160;be&#160;set&#160;before&#160;the&#160;text&#160;field is&#160;<br/>inserted, the&#160;date/time&#160;cannot&#160;be&#160;changed after.&#160;I&#160;have&#160;not&#160;tested this&#160;particular macro with&#160;AOO.<br/>
432<br/>
<hr/>
<a name=436></a><i><b>Listing&#160;387.&#160;</b>Insert&#160;text&#160;fields.<br/></i>Sub&#160;InsertFields<br/>&#160;&#160;Dim&#160;oText&#160; &#160;'Text object for the current document<br/>&#160;&#160;Dim&#160;oField&#160;&#160;'Field to insert<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160;&#160;'oDoc is fewer characters than ThisComponent<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;ThisComponent<br/>&#160;&#160;oText&#160;=&#160;oDoc.Text<br/>&#160;&#160;<br/>&#160;&#160;REM Start by inserting a date time text field at the end of the<br/>&#160;&#160;REM document. Format the date time as &#34;DD. MMM YYYY&#34;<br/>&#160;&#160;REM Insert some explanatory text before the newly inserted field.<br/>&#160;&#160;oText.insertString(oText.getEnd(),&#160;&#34;Today is &#34;,&#160;FALSE)<br/>&#160;&#160;<br/>&#160;&#160;REM Create a date time field.<br/>&#160;&#160;oField&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.TextField.DateTime&#34;)<br/>&#160;&#160;oField.IsFixed&#160;=&#160;TRUE<br/>&#160;&#160;oField.NumberFormat&#160;=&#160;FindCreateNumberFormatStyle(&#34;DD. MMMM YYYY&#34;,&#160;oDoc)<br/>&#160;&#160;oText.insertTextContent(oText.getEnd(),&#160;oField,&#160;False)<br/>
&#160;&#160;REM Now, insert an Annotation after the inserted text field. &#160;<br/>&#160;&#160;REM Lie about the date and say that I did it a little while ago!<br/>&#160;&#160;Dim&#160;oDate&#160;As&#160;New&#160;com.sun.star.util.Date&#160;&#160;<br/>&#160;&#160;Dim&#160;oRightNow<br/>&#160;&#160;oRightNow&#160;=&#160;Now<br/>&#160;&#160;With&#160;oDate<br/>&#160; &#160;&#160;.Day&#160; &#160;=&#160;Day(oRightNow&#160;-&#160;10)<br/>&#160; &#160;&#160;.Month&#160;=&#160;Month(oRightNow&#160;-&#160;10)<br/>&#160; &#160;&#160;.Year&#160;&#160;=&#160;Year(oRightNow&#160;-&#160;10)<br/>&#160;&#160;End&#160;With<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;oDT&#160;As&#160;New&#160;com.sun.star.util.DateTime<br/>&#160;&#160;With&#160;oDT<br/>&#160; &#160;&#160;.Day&#160; &#160;=&#160;Day(oRightNow&#160;-&#160;10)<br/>&#160; &#160;&#160;.Month&#160;=&#160;Month(oRightNow&#160;-&#160;10)<br/>&#160; &#160;&#160;.Year&#160;&#160;=&#160;Year(oRightNow&#160;-&#160;10)<br/>&#160; &#160;&#160;.Hours&#160;=&#160;4<br/>&#160; &#160;&#160;.Minutes&#160;=&#160;5<br/>&#160; &#160;&#160;.Seconds&#160;=&#160;6<br/>&#160; &#160;&#160;.HundredthSeconds&#160;=&#160;0<br/>&#160;&#160;End&#160;With<br/>
&#160;&#160;REM Like most text content, the field must be created by the document&#160;<br/>&#160;&#160;REM that will contain it.<br/>&#160;&#160;REM In LO, setting the Date field does nothing.<br/>&#160;&#160;oField&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.TextField.Annotation&#34;)<br/>&#160;&#160;With&#160;oField<br/>&#160; &#160;&#160;.Author&#160;&#160;=&#160;&#34;AP&#34;<br/>&#160; &#160;&#160;.Content&#160;=&#160;&#34;This note is next to a date field that I just added&#34;<br/>&#160; &#160;&#160;.Date&#160; &#160;&#160;=&#160;oDate&#160;<br/>&#160; &#160;&#160;.DateTimeValue&#160;=&#160;oDT<br/>&#160;&#160;End&#160;With<br/>&#160;&#160;oText.insertTextContent(oText.getEnd(),&#160;oField,&#160;False)<br/>
433<br/>
<hr/>
<a name=437></a>&#160;&#160;MsgBox&#160;&#34;Two fields inserted at the end of the document&#34;<br/>End&#160;Sub<br/>
Inserting a&#160;field&#160;that&#160;requires&#160;a&#160;text&#160;field master is&#160;slightly&#160;more&#160;difficult&#160;than&#160;inserting a&#160;regular text&#160;field.&#160;<br/>Both&#160;the&#160;master field&#160;and the&#160;dependent&#160;text&#160;field&#160;must&#160;be&#160;created by&#160;the&#160;document&#160;using the&#160;object&#160;method&#160;<br/>createInstance().&#160;The&#160;master field&#160;must&#160;be&#160;named&#160;before&#160;it&#160;is&#160;used;&#160;after inserting a&#160;field&#160;into a&#160;document,&#160;<br/>you&#160;cannot&#160;change&#160;the&#160;name.&#160;The&#160;dependent&#160;field is&#160;attached to&#160;the&#160;master field,&#160;which&#160;provides&#160;the&#160;content&#160;<br/>to the&#160;dependent&#160;field.&#160;The&#160;dependent&#160;field,&#160;not&#160;the&#160;master field, is&#160;inserted as&#160;text&#160;content&#160;into&#160;the&#160;<br/>document.&#160;The&#160;dependent&#160;field&#160;can be&#160;removed from&#160;the&#160;document&#160;by&#160;using the&#160;removeTextContent() object<br/>method.&#160;To&#160;remove&#160;the&#160;master field,&#160;use&#160;the&#160;dispose() method of the&#160;master field.<br/>
<a href="libremacros.html#437">Listing 388&#160;de</a>monstrates&#160;the&#160;use&#160;of master fields&#160;by&#160;performing&#160;various&#160;operations&#160;on a&#160;master field&#160;named&#160;<br/>“TestField”.&#160;Three&#160;specific&#160;states&#160;are&#160;checked and appropriate&#160;behavior is&#160;taken as&#160;follows:<br/>
If the master field does not exist, the master field and a dependent field are created and inserted into the <br/>
document. The field is now visible by opening the Field dialog using Insert | Fields | Other and choosing the <br/>
Variables tab.<br/>If the master field exists with a corresponding dependent field, the dependent field is removed from the <br/>
document. The master field still exists, but no dependent field is inserted in the document. You can view the<br/>
master field by using the Field dialog.<br/>If the master field exists and has no corresponding dependent field, the master field is removed by using the <br/>
dispose() object method. The Field dialog no longer shows the master field.<br/>
<i><b>Listing&#160;388.&#160;</b>Insert&#160;field&#160;master.</i><br/>
Sub&#160;InsertFieldMaster<br/>&#160;&#160;Dim&#160;oMasters&#160;&#160;'All of the text field masters<br/>&#160;&#160;Dim&#160;oText&#160; &#160; &#160;'Text object for the current document<br/>&#160;&#160;Dim&#160;oUField&#160; &#160;'User field to insert<br/>&#160;&#160;Dim&#160;oMField&#160; &#160;'The master field for the user field<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160;&#160;'oDoc is fewer characters than ThisComponent<br/>&#160;&#160;Dim&#160;sLead$&#160; &#160;&#160;'Leading field name<br/>&#160;&#160;Dim&#160;sName$&#160; &#160;&#160;'Name of the field to remove or insert<br/>&#160;&#160;Dim&#160;sTotName$&#160;'The entire name<br/>
&#160;&#160;REM Set the names.<br/>&#160;&#160;sName&#160;=&#160;&#34;TestField&#34;<br/>&#160;&#160;sLead&#160;=&#160;&#34;com.sun.star.text.FieldMaster.User&#34;<br/>&#160;&#160;sTotName&#160;=&#160;sLead&#160;&amp;&#160;&#34;.&#34;&#160;&amp;&#160;sName<br/>
&#160;&#160;REM Initialize some values.<br/>&#160;&#160;oDoc&#160;=&#160;ThisComponent<br/>&#160;&#160;oText&#160;=&#160;oDoc.Text<br/>&#160;&#160;oMasters&#160;=&#160;ThisComponent.getTextFieldMasters()<br/>
&#160;&#160;REM If the master field already exists, then perform special handling.&#160;<br/>&#160;&#160;REM Special handling is for illustrative purposes only, not that it<br/>&#160;&#160;REM solves any particularly fun and exciting problem.<br/>&#160;&#160;If&#160;oMasters.hasByName(sTotName)&#160;Then<br/>&#160; &#160;&#160;REM Obtain the master field and the fields dependent on this field.<br/>&#160; &#160;&#160;oMField&#160;=&#160;oMasters.getByName(sTotName)<br/>&#160; &#160;&#160;<br/>
434<br/>
<hr/>
<a name=438></a>&#160; &#160;&#160;REM If there are fields dependent on this field then<br/>&#160; &#160;&#160;REM the array of dependent fields has values!<br/>&#160; &#160;&#160;If&#160;UBound(oMField.DependentTextFields)&#160;&gt;=&#160;0&#160;Then<br/>&#160; &#160; &#160;&#160;REM Remove the text content and it disappears from the<br/>&#160; &#160; &#160;&#160;REM document. The master field still exists, however!<br/>&#160; &#160; &#160;&#160;oUField&#160;=&#160;oMField.DependentTextFields(0)<br/>&#160; &#160; &#160;&#160;oText.removeTextContent(oUField)<br/>&#160; &#160; &#160;&#160;MsgBox&#160;&#34;Removed one instance from the document&#34;<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;REM I arbitrarily decided that I would destroy the master field<br/>&#160; &#160; &#160;&#160;REM but I could just as easily create a new user field and<br/>&#160; &#160; &#160;&#160;REM attach it to the existing master field and then insert<br/>&#160; &#160; &#160;&#160;REM the new field into the document.<br/>&#160; &#160; &#160;&#160;MsgBox&#160;&#34;No instances in the document, disposing master field&#34;<br/>&#160; &#160; &#160;&#160;oMField.content=&#34;&#34;<br/>&#160; &#160; &#160;&#160;oMField.dispose()<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;REM Create a User text field that requires a master field.<br/>&#160; &#160;&#160;oUField&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.TextField.User&#34;)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Now create the master field.<br/>&#160; &#160;&#160;Dim&#160;oMasterField<br/>&#160; &#160;&#160;oMasterField&#160;=&#160;oDoc.createInstance(sLead)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM You CANNOT change the name of a master field AFTER it is inserted<br/>&#160; &#160;&#160;REM into a document so you must set it now.<br/>&#160; &#160;&#160;oMasterField.Name&#160;=&#160;sName<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM This is the data that will be displayed. Remember that the<br/>&#160; &#160;&#160;REM user field displays what the master tells it to display.<br/>&#160; &#160;&#160;oMasterField.Content&#160;=&#160;&#34;Hello&#34;<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM A user field must be attached to a master field.<br/>&#160; &#160;&#160;REM The user field is now a &#34;DependentTextField&#34;.<br/>&#160; &#160;&#160;oUField.attachTextFieldMaster(oMasterField)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Insert the user field into the document.<br/>&#160; &#160;&#160;oText.insertTextContent(oText.getEnd(),&#160;oUField,&#160;False)<br/>&#160; &#160;&#160;MsgBox&#160;&#34;One field inserted at the end of the document&#34;<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
<i><b>&#160;14.11.&#160;Bookmarks<br/></b></i>A&#160;bookmark is&#160;text&#160;content&#160;that&#160;is&#160;accessible&#160;based on its&#160;name.&#160;A&#160;bookmark may&#160;encompass&#160;a&#160;text&#160;range&#160;or&#160;<br/>a&#160;single&#160;point<a href="libremacros.html#411">.&#160;Listing&#160;371&#160;i</a>nserts&#160;text&#160;content&#160;at&#160;the&#160;point&#160;where&#160;a&#160;bookmark is&#160;anchored. Use&#160;the&#160;<br/>getString() object&#160;method&#160;to obtain the&#160;string contained&#160;in the&#160;bookmark. Use&#160;setString() to&#160;set&#160;the&#160;string&#160;<br/>contained in&#160;the&#160;bookmark. If&#160;the&#160;bookmark is&#160;merely&#160;a&#160;point,&#160;the&#160;text&#160;is&#160;merely&#160;inserted&#160;before&#160;the&#160;<br/>bookmark.&#160;When a&#160;created bookmark is&#160;inserted into the&#160;text,&#160;the&#160;insertion point&#160;determines&#160;the&#160;bookmark’s&#160;<br/>anchor position.<br/>
435<br/>
<hr/>
<a name=439></a><i><b>Listing&#160;389.</b>&#160;Demonstrate&#160;how to&#160;add a bookmark.<br/></i>Sub&#160;AddBookmark<br/>&#160;&#160;Dim&#160;oBookmark&#160;&#160;'Created bookmark to add<br/>&#160;&#160;Dim&#160;oCurs&#160; &#160; &#160;&#160;'Text cursor<br/>&#160;&#160;<br/>&#160;&#160;REM Create a text cursor that contains the last four characters<br/>&#160;&#160;REM in the document.<br/>&#160;&#160;oCurs&#160;=&#160;ThisComponent.Text.createTextCursor()<br/>&#160;&#160;oCurs.gotoEnd(False)<br/>&#160;&#160;oCurs.goLeft(4,&#160;True)<br/>
&#160;&#160;REM Create the bookmark.<br/>&#160;&#160;oBookmark&#160;=&#160;ThisComponent.createInstance(&#34;com.sun.star.text.Bookmark&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM If the bookmark is not given a name, OOo will create a name.<br/>&#160;&#160;REM If the name already exists, a number is appended to the name.<br/>&#160;&#160;oBookmark.setName(&#34;Bobert&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Because True is used, the bookmark contains the last four characters<br/>&#160;&#160;REM in the document. If False is used instead, then the bookmark<br/>&#160;&#160;REM contains no characters and it is positioned before the fourth character<br/>&#160;&#160;REM from the end of the document.<br/>&#160;&#160;ThisComponent.Text.insertTextContent(oCurs,&#160;oBookmark,&#160;False)<br/>End&#160;Sub<br/>
<i><b>&#160;14.12.&#160;Sequence&#160;fields,&#160;references,&#160;and&#160;formatting<br/></b></i>Consider the&#160;caption fo<a href="libremacros.html#439">r&#160;Listing&#160;389. I</a>gnoring&#160;formatting, enter the&#160;caption as&#160;follows:<br/>
1.&#160;Enter the&#160;text&#160;“Listing ”.<br/>
2.&#160;Use&#160;<b>Insert &gt;&#160;Fields&#160;&gt;&#160;Other</b>&#160;to open the&#160;Fields&#160;dialog.&#160;<br/>
3.&#160;Select&#160;the&#160;Variables&#160;tab.<br/>
4.&#160;Select&#160;the&#160;Number Range&#160;type&#160;.<br/>
5.&#160;Enter&#160;<i>Listing</i>&#160;for name&#160;and Listing +&#160;1 for the&#160;value.<br/>
6.&#160;Click Insert.<br/>
7.&#160;Enter the&#160;rest&#160;of the&#160;caption.<br/>
Sequence&#160;fields&#160;(number ranges) work well&#160;because&#160;they&#160;automatically&#160;renumber as&#160;captions&#160;are&#160;added and&#160;<br/>removed.&#160;A&#160;reference&#160;to&#160;a&#160;sequence&#160;field renumbers&#160;if the&#160;field&#160;itself changes&#160;value&#160;because&#160;a&#160;field is&#160;added&#160;<br/>or removed.<br/>
I&#160;had a&#160;collection of documents&#160;containing hundreds&#160;of captions&#160;and references. Unfortunately,&#160;all&#160;captions&#160;<br/>and references&#160;were&#160;text&#160;as&#160;opposed to&#160;fields. I&#160;needed a&#160;macro to&#160;convert&#160;the&#160;text&#160;captions&#160;and references&#160;to<br/>use&#160;sequence&#160;fields&#160;and linked&#160;cross&#160;references.&#160;<br/>
<b>&#160;14.12.1.&#160;Formatting&#160;numbers&#160;and&#160;dates<br/></b>Sequence&#160;fields&#160;can be&#160;formatted&#160;in many&#160;ways.&#160;Ultimately,&#160;the&#160;formatting is&#160;associated to&#160;a&#160;defined format&#160;<br/>string. OOo is&#160;configured to know&#160;many&#160;common number and date&#160;formats, and you can create&#160;new&#160;formats&#160;<br/>
436<br/>
<hr/>
<a name=440></a>as&#160;you desire. Each number format&#160;is&#160;assigned a&#160;numeric&#160;ID.&#160;Things&#160;that&#160;format&#160;numbers&#160;and dates&#160;– such as<br/>fields&#160;and table&#160;cells&#160;– contain the&#160;numeric&#160;key&#160;for the&#160;formatting string&#160;used to&#160;display&#160;the&#160;contained&#160;value.&#160;<br/>
<i><b>List&#160;formats&#160;known&#160;to&#160;the&#160;current&#160;document<br/></b></i>When&#160;you&#160;create&#160;a&#160;new&#160;number format,&#160;the&#160;format&#160;is&#160;stored in&#160;the&#160;current&#160;document.&#160;The&#160;supported numeric<br/>formats&#160;and the&#160;ID&#160;for a&#160;specific&#160;format&#160;will&#160;differ from&#160;document&#160;to&#160;document.&#160;<br/>
<i><b>Listing&#160;390.</b>&#160;List&#160;the&#160;formats&#160;in the&#160;current&#160;document.<br/></i>Sub&#160;ListFormatsInCurrentDocument()<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160; &#160;' Document created to hold the format strings.<br/>&#160;&#160;Dim&#160;oFormats&#160; &#160; &#160; &#160;' Formats in the current document.<br/>&#160;&#160;Dim&#160;oFormat&#160; &#160; &#160; &#160;&#160;' Current format object.<br/>&#160;&#160;Dim&#160;oData&#160; &#160; &#160; &#160; &#160;&#160;' Keys queried from the formats.<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160; &#160; &#160;' General index variable.<br/>&#160;&#160;Dim&#160;sFormat$&#160; &#160; &#160; &#160;' Current format string.<br/>&#160;&#160;Dim&#160;sPrevFormat$&#160; &#160;' Previous format string.<br/>&#160;&#160;Dim&#160;aLocale&#160;as&#160;new&#160;com.sun.star.lang.Locale<br/>
&#160;&#160;oFormats&#160;=&#160;ThisComponent.getNumberFormats()<br/>&#160;&#160;<br/>&#160;&#160;' Create an output document.<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#160;&#34;private:factory/swriter&#34;,&#160;&#34;_blank&#34;,&#160;0,&#160;Array()&#160;)<br/>&#160;&#160;oData&#160;=&#160;oFormats.queryKeys(com.sun.star.util.NumberFormat.ALL,&#160;aLocale,&#160;False)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(oData)&#160;To&#160;UBound(oData)<br/>&#160; &#160;&#160;oFormat=oFormats.getbykey(oData(i))<br/>&#160; &#160;&#160;sFormat=oFormat.FormatString<br/>&#160; &#160;&#160;If&#160;sFormat&lt;&gt;sPrevFormat&#160;Then<br/>&#160; &#160; &#160;&#160;sPrevFormat=sFormat<br/>&#160; &#160; &#160;&#160;oDoc.getText().insertString(oDoc.getText().End,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;CStr(oData(i))&#160;&amp;&#160;CHR$(9)&#160;&amp;&#160;sFormat&#160;&amp;&#160;CHR$(10),&#160;False)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
<i><b>Find&#160;or&#160;create&#160;a&#160;numeric&#160;format.<br/></b></i>When&#160;a&#160;number format&#160;is&#160;added, it&#160;may&#160;be&#160;modified&#160;and stored in&#160;a&#160;slightly&#160;different&#160;format. QueryKey&#160;<br/>searches&#160;the&#160;internal&#160;modified&#160;query&#160;strings&#160;without&#160;first&#160;modifying the&#160;input&#160;string.&#160;The&#160;end result&#160;is&#160;that&#160;<br/>after storing a&#160;key&#160;queryKey&#160;will&#160;claim&#160;that&#160;the&#160;format&#160;string is&#160;not&#160;present. If&#160;you&#160;then&#160;dutifully,&#160;add the&#160;<br/>format&#160;string, an exception&#160;will&#160;be&#160;thrown because&#160;it&#160;already&#160;exists.<br/>
1.&#160;Adding &#34;#,##0.00_);[Red](#,##0.000)&#34; stores&#160;&#34;#,##0.00_);[RED](#,##0.000)&#34;;&#160;red is&#160;converted to&#160;<br/>
upper case&#160;(see<a href="https://issues.apache.org/ooo/show_bug.cgi?id=72380">&#160;&#160;https://issues.apache.org/ooo/show_bug.cgi?id=72380).&#160;</a><br/>
2.&#160;While&#160;storing, &#34;##0,0#\h&#34;&#160;is&#160;changed to&#160;&#34;##,00#\h&#34;.&#160;<br/>
The&#160;usual&#160;advice&#160;is&#160;to&#160;use&#160;a&#160;number format&#160;that&#160;does&#160;not&#160;change.&#160;<br/>
<a href="libremacros.html#440">Listing 391&#160;r</a>eturns&#160;the&#160;ID&#160;that&#160;identifies&#160;the&#160;specified format.&#160;The&#160;returned ID&#160;can be&#160;used to format&#160;a&#160;value.<br/>If&#160;you&#160;add a&#160;format&#160;and then the&#160;format&#160;is&#160;not&#160;available,&#160;make&#160;note&#160;of the&#160;format&#160;ID&#160;and use<a href="libremacros.html#440">&#160;Listing&#160;390&#160;t</a>o&#160;<br/>display&#160;the&#160;formats&#160;in&#160;the&#160;modified&#160;form.<br/>
<i><b>Listing&#160;391.</b>&#160;Find&#160;or&#160;create&#160;a numeric&#160;format.<br/></i>'sFormat – Format to find / create.<br/>
437<br/>
<hr/>
<a name=441></a>'oDoc &#160; &#160;- Document to use. If omitted, the current document is used.<br/>'locale &#160;- Locale to use. If omitted, the default locale is used.<br/>Function&#160;FindCreateNumberFormatStyle&#160;(sFormat$,&#160;Optional&#160;oDoc,&#160;Optional&#160;locale)<br/>&#160;&#160;Dim&#160;oDocument&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;aLocale&#160;as&#160;new&#160;com.sun.star.lang.Locale<br/>&#160;&#160;Dim&#160;oFormats&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;formatNum&#160;As&#160;Long<br/>&#160;&#160;oDocument&#160;=&#160;IIf(IsMissing(oDoc),&#160;ThisComponent,&#160;oDoc)<br/>&#160;&#160;oFormats&#160;=&#160;oDocument.getNumberFormats()<br/>&#160;&#160;'I could set the locale from values stored at<br/>&#160;&#160;'http://www.ics.uci.edu/pub/ietf/http/related/iso639.txt<br/>&#160;&#160;'http://www.chemie.fu-berlin.de/diverse/doc/ISO_3166.html<br/>&#160;&#160;'I use a NULL locale and let it use what ever it likes.<br/>&#160;&#160;'First, see if the number format exists<br/>&#160;&#160;If&#160;(&#160;Not&#160;IsMissing(locale))&#160;Then<br/>&#160; &#160;&#160;aLocale&#160;=&#160;locale<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;formatNum&#160;=&#160;oFormats.queryKey&#160;(sFormat,&#160;aLocale,&#160;TRUE)<br/>&#160;&#160;'MsgBox &#34;Current Format number is&#34; &amp; formatNum<br/>&#160;&#160;'If the number format does not exist then add it<br/>&#160;&#160;If&#160;(formatNum&#160;=&#160;-1)&#160;Then<br/>&#160; &#160;&#160;formatNum&#160;=&#160;oFormats.addNew(sFormat,&#160;aLocale)<br/>&#160; &#160;&#160;If&#160;(formatNum&#160;=&#160;-1)&#160;Then&#160;formatNum&#160;=&#160;0<br/>&#160; &#160;&#160;'MsgBox &#34;new Format number is &#34; &amp; formatNum<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;FindCreateNumberFormatStyle&#160;=&#160;formatNum<br/>End&#160;Function<br/>
<i><b>Default&#160;formats<br/></b></i>It&#160;is&#160;possible&#160;to get&#160;formats&#160;of a&#160;specific&#160;type&#160;without&#160;manually&#160;specifying the&#160;format&#160;using the&#160;<br/>getStandardFormat&#160;method&#160;on the&#160;Formats&#160;object. Specify&#160;the&#160;desired format&#160;using the&#160;NumberFormat&#160;<br/>constant&#160;group. Consider this&#160;snippet&#160;to set&#160;cells&#160;in&#160;Calc&#160;to&#160;the&#160;local&#160;currency&#160;format:<br/>
&#160;oFormats&#160;=&#160;oDoc.NumberFormats<br/>&#160;&#160;Dim&#160;aLocale&#160;As&#160;New&#160;com.sun.star.lang.Locale<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;D2:F19&#34;)<br/>&#160;&#160;oRange.NumberFormat&#160;=&#160;oFormats.getStandardFormat(_<br/>&#160; &#160; &#160;&#160;com.sun.star.util.NumberFormat.CURRENCY,&#160;aLocale)<br/>
<i><b>Table&#160;152.</b>&#160;Constants&#160;for&#160;the&#160;com.sun.star.util.NumberFormat&#160;constant&#160;group.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Name</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
ALL&#160;<br/>
selects all&#160;number&#160;formats.<br/>
1<br/>
DEFINED&#160;<br/>
selects only&#160;user-defined&#160;number&#160;formats.<br/>
2<br/>
DATE&#160;<br/>
selects date&#160;formats.<br/>
4<br/>
TIME&#160;<br/>
selects time&#160;formats.<br/>
8<br/>
CURRENCY&#160;<br/>
selects currency&#160;formats.<br/>
16<br/>
NUMBER&#160;<br/>
selects decimal&#160;number&#160;formats.<br/>
32<br/>
SCIENTIFIC&#160;<br/>
selects scientific&#160;number&#160;formats.<br/>
64<br/>
FRACTION&#160;<br/>
selects number&#160;formats for&#160;fractions.<br/>
438<br/>
<hr/>
<a name=442></a>128<br/>
PERCENT&#160;<br/>
selects percentage&#160;number&#160;formats.<br/>
256<br/>
TEXT&#160;<br/>
selects text&#160;number&#160;formats.<br/>
6<br/>
DATETIME&#160;<br/>
selects number&#160;formats which&#160;contain&#160;date&#160;and&#160;time.<br/>
1024<br/>
LOGICAL&#160;<br/>
selects boolean number&#160;formats.<br/>
2048<br/>
UNDEFINED&#160;<br/>
is used&#160;as&#160;a&#160;return value&#160;if&#160;no format&#160;exists.<br/>
<b>&#160;14.12.2.&#160;Create&#160;a&#160;field&#160;master<br/></b>A&#160;<i>Listing</i>&#160;sequence&#160;field is&#160;associated&#160;to the&#160; com.sun.star.text.FieldMaster.SetExpression.Listing master&#160;<br/>field, which must&#160;exist&#160;before&#160;the&#160;sequence&#160;field&#160;can be&#160;use<a href="libremacros.html#442">d.&#160;Listing 392&#160;D</a>emonstrates&#160;how&#160;to&#160;create&#160;a&#160;<br/>master field&#160;if it&#160;does&#160;not&#160;exist, and how&#160;to&#160;get&#160;the&#160;master field if&#160;it&#160;does.&#160;<br/>
<i><b>Listing&#160;392.</b>&#160;Creating a master&#160;field.<br/></i>&#160;&#160;oMasters&#160;=&#160;oDoc.getTextFieldMasters<br/>&#160;&#160;If&#160;NOT&#160;oMasters.hasByName(&#34;com.sun.star.text.FieldMaster.SetExpression.Listing&#34;)&#160;Then<br/>&#160; &#160;&#160;oMasterField&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.FieldMaster.SetExpression&#34;)<br/>&#160; &#160;&#160;oMasterField.Name&#160;=&#160;&#34;Listing&#34;<br/>&#160; &#160;&#160;oMasterField.SubType&#160;=&#160;com.sun.star.text.SetVariableType.SEQUENCE<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oMasterField&#160;=&#160;oMasters.getByName(&#34;com.sun.star.text.FieldMaster.SetExpression.Listing&#34;)<br/>&#160;&#160;End&#160;If<br/>
The&#160;master field&#160;sub-type&#160;determines&#160;the&#160;field type&#160;(see<a href="libremacros.html#442">&#160;Table&#160;153).</a><br/>
<i><b>Table&#160;153.</b>&#160;Constants&#160;for&#160;com.sun.star.text.SetVariableType.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Constant</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
com.sun.star.text.SetVariableType.VAR&#160;<br/>
Simple&#160;variable. &#160;<br/>
1<br/>
com.sun.star.text.SetVariableType.SEQUENCE&#160;<br/>
Number&#160;sequence&#160;field. &#160;<br/>
2<br/>
com.sun.star.text.SetVariableType.FORMULA&#160;<br/>
Formula&#160;field. &#160;<br/>
3<br/>
com.sun.star.text.SetVariableType.STRING&#160;<br/>
String&#160;field.&#160;&#160;<br/>
<b>&#160;14.12.3.&#160;Insert&#160;a&#160;sequence&#160;field<br/></b>The&#160;sequence&#160;field is&#160;created by&#160;the&#160;document,&#160;then the&#160;numbering type&#160;is&#160;set&#160;to&#160;arabic.&#160;The&#160;number format&#160;<br/>is&#160;set, the&#160;master field&#160;is&#160;associated to&#160;the&#160;field&#160;(the&#160;master field is&#160;a&#160;sequence&#160;field), and then the&#160;field&#160;<br/>content&#160;is&#160;set&#160;to&#160;increment&#160;the&#160;value&#160;(Listing +&#160;1). Note&#160;that&#160;when the&#160;field&#160;is&#160;inserted, the&#160;field may&#160;not&#160;be&#160;<br/>immediately&#160;updated. Either wait&#160;for the&#160;field&#160;to update,&#160;or force&#160;an update&#160;using&#160;<b>Tools&#160;&gt;&#160;Update&#160;&gt;&#160;Fields</b>.<br/>
<i><b>Listing&#160;393.</b>&#160;Creating a set&#160;expression&#160;sequence&#160;field.<br/></i>&#160; &#160;&#160;oField&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.TextField.SetExpression&#34;)<br/>&#160; &#160;&#160;oField.NumberingType&#160;=&#160;com.sun.star.style.NumberingType.ARABIC<br/>&#160; &#160;&#160;oField.NumberFormat&#160;=&#160;FindCreateNumberFormatStyle(&#34;###0&#34;,&#160;oDoc)<br/>&#160; &#160;&#160;oField.attachTextFieldMaster(oMasterField)<br/>&#160; &#160;&#160;oField.Content&#160;=&#160;name&#160;&amp;&#160;&#34; + 1&#34;<br/>
Constants&#160;used to&#160;set&#160;the&#160;numbering type&#160;are&#160;set&#160;as&#160;shown in&#160;the<a href="libremacros.html#431">&#160;Table&#160;149.</a><br/>
439<br/>
<hr/>
<a name=443></a><b>&#160;14.12.4.&#160;Replace&#160;text&#160;with&#160;a&#160;sequence&#160;field<br/></b>Finally,&#160;the&#160;main&#160;working&#160;macro to&#160;find the&#160;text&#160;and replace&#160;it&#160;with&#160;a&#160;sequence&#160;field.&#160;The&#160;location&#160;to&#160;insert&#160;<br/>the&#160;sequence&#160;field&#160;is&#160;found by&#160;searching&#160;for a&#160;regular expression.&#160;The&#160;regular expression&#160;&#34;^Listing [:digit:]<br/>+\.[:space:]+&#34;&#160;searches&#160;for a&#160;line&#160;that&#160;begins&#160;with the&#160;text&#160;“Listing”, followed by&#160;a&#160;space, one&#160;or more&#160;<br/>numeric&#160;digits,&#160;a&#160;period, and one&#160;or more&#160;spaces;&#160;for example, “Listing 12. ”.<br/>
<i><b>Listing&#160;394.</b>&#160;Replace&#160;text&#160;with sequence&#160;fields.<br/></i>Function&#160;FindReplaceTextFields(oDoc,&#160;name$)&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;oDescriptor&#160;&#160;' Search descriptor used to find the captions.<br/>&#160;&#160;Dim&#160;oFound&#160; &#160; &#160; &#160;' Text matching the search descriptor.<br/>&#160;&#160;Dim&#160;oMasters&#160; &#160; &#160;' Master fields in this document.<br/>&#160;&#160;Dim&#160;oMasterField&#160;' The associated master field.<br/>&#160;&#160;Dim&#160;oFrame&#160; &#160; &#160; &#160;' Documents main frame, used for dispatches.<br/>&#160;&#160;Dim&#160;oDispatcher&#160;&#160;' Dispatcher object.<br/>&#160;&#160;Dim&#160;oCurs&#160; &#160; &#160; &#160;&#160;' Text cursor used to insert text content.<br/>&#160;&#160;Dim&#160;oField&#160; &#160; &#160; &#160;' Sequence field to insert.<br/>&#160;&#160;Dim&#160;formatNum&amp;&#160; &#160;' ID (Key) for the format for the field.<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;' General index variable.<br/>
&#160;&#160;'Assume that no text fields are inserted.<br/>&#160;&#160;FindReplaceTextFields&#160;=&#160;0<br/>
&#160;&#160;'What number format to use for the field.<br/>&#160;&#160;formatNum&#160;=&#160;FindCreateNumberFormatStyle(&#34;###0&#34;,&#160;oDoc)<br/>
&#160;&#160;' Create the master field if needed. &#160;<br/>&#160;&#160;oMasters&#160;=&#160;oDoc.getTextFieldMasters<br/>&#160;&#160;If&#160;NOT&#160;oMasters.hasByName(&#34;com.sun.star.text.FieldMaster.SetExpression.&#34;&#160;&amp;&#160;name)&#160;Then<br/>&#160; &#160;&#160;oMasterField&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.FieldMaster.SetExpression&#34;)<br/>&#160; &#160;&#160;oMasterField.Name&#160;=&#160;name<br/>&#160; &#160;&#160;oMasterField.SubType&#160;=&#160;com.sun.star.text.SetVariableType.SEQUENCE<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oMasterField&#160;=&#160;oMasters.getByName(&#34;com.sun.star.text.FieldMaster.SetExpression.&#34;&#160;&amp;&#160;name)<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;'Search for a line beginning with the name, a space, a number, a period, and a space.<br/>&#160;&#160;oDescriptor&#160;=&#160;oDoc.createSearchDescriptor()<br/>&#160;&#160;With&#160;oDescriptor<br/>&#160; &#160;&#160;.SearchString&#160;=&#160;&#34;^&#34;&#160;&amp;&#160;name&#160;&amp;&#160;&#34; [:digit:]+\.[:space:]+&#34;<br/>&#160; &#160;&#160;.SearchRegularExpression&#160;=&#160;True<br/>&#160;&#160;End&#160;With<br/>
&#160;&#160;'Prepare to issue a dispatch to clear formatting.<br/>&#160;&#160;oFrame&#160;=&#160;oDoc.CurrentController.Frame<br/>&#160;&#160;oDispatcher&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>
&#160;&#160;'Begin the find process.<br/>&#160;&#160;oFound&#160;=&#160;oDoc.findFirst(oDescriptor)<br/>&#160;&#160;Do&#160;While&#160;Not&#160;IsNull(oFound)<br/>&#160; &#160;&#160;' Use the strong emphasis character style for &#34;Listing 7.&#34;<br/>&#160; &#160;&#160;oFound.CharStyleName&#160;=&#160;&#34;OOoStrongEmphasis&#34;<br/>
440<br/>
<hr/>
<a name=444></a>&#160; &#160;&#160;' Create and configure the sequence field.<br/>&#160; &#160;&#160;oField&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.TextField.SetExpression&#34;)<br/>&#160; &#160;&#160;oField.NumberingType&#160;=&#160;com.sun.star.style.NumberingType.ARABIC<br/>&#160; &#160;&#160;oField.NumberFormat&#160;=&#160;formatNum<br/>&#160; &#160;&#160;oField.attachTextFieldMaster(oMasterField)<br/>&#160; &#160;&#160;oField.Content&#160;=&#160;name&#160;&amp;&#160;&#34; + 1&#34;<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;' Create a text cursor with the found text.<br/>&#160; &#160;&#160;oCurs&#160;=&#160;oFound.getText().createTextCursorByRange(oFound)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;' Insert the text such as &#34;Listing &lt;sequence variable&gt;. &#34;<br/>&#160; &#160;&#160;' This inserted text replaces the found text.<br/>&#160; &#160;&#160;oFound.getText().insertString(oCurs,&#160;name&#160;&amp;&#160;&#34; &#34;,&#160;True)<br/>&#160; &#160;&#160;oCurs.collapseToEnd()<br/>&#160; &#160;&#160;oFound.getText().insertTextContent(oCurs,&#160;oField,&#160;True)<br/>&#160; &#160;&#160;oCurs.collapseToEnd()<br/>&#160; &#160;&#160;oFound.getText().insertString(oCurs,&#160;&#34;.&#34;,&#160;True)<br/>&#160; &#160;&#160;oCurs.collapseToEnd()<br/>&#160; &#160;&#160;oFound.getText().insertString(oCurs,&#160;&#34; &#34;,&#160;True)<br/>&#160; &#160;&#160;oCurs.collapseToEnd()<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;' The inserted text uses strong emphasis.&#160;<br/>&#160; &#160;&#160;' Move the cursor back one so that it is before the space.<br/>&#160; &#160;&#160;' Jump to the end of the paragraph and reset the attributes.<br/>&#160; &#160;&#160;oCurs.goLeft(1,&#160;False)<br/>&#160; &#160;&#160;oCurs.gotoEndofParagraph(True)<br/>&#160; &#160;&#160;oDoc.CurrentController.Select(oCurs)<br/>&#160; &#160;&#160;oDispatcher.executeDispatch(oFrame,&#160;&#34;.uno:ResetAttributes&#34;,&#160;&#34;&#34;,&#160;0,&#160;Array())<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;' Find the next occurrence.&#160;<br/>&#160; &#160;&#160;oFound&#160;=&#160;oDoc.findNext(oFound.End,&#160;oDescriptor)<br/>&#160; &#160;&#160;i&#160;=&#160;i&#160;+&#160;1<br/>&#160;&#160;Loop<br/>&#160;&#160;FindReplaceTextFields&#160;=&#160;i<br/>End&#160;Function<br/>
The&#160;above&#160;method contains&#160;extra&#160;code&#160;that&#160;clears&#160;formatting after the&#160;main&#160;sequence&#160;variables.<br/>
<b>&#160;14.12.5.&#160;Create&#160;a&#160;GetReference&#160;field<br/></b>An inserted sequence&#160;field&#160;is&#160;directly&#160;associated&#160;to a&#160;field&#160;master,&#160;which may&#160;be&#160;referenced by&#160;many&#160;<br/>different&#160;fields;&#160;every&#160;listing in this&#160;book references&#160;a&#160;single&#160;field&#160;master.&#160;A&#160;GetReference&#160;field,&#160;however,&#160;<br/>does&#160;not&#160;reference&#160;a&#160;field as&#160;easily.&#160;When a&#160;field is&#160;inserted, OOo automatically&#160;assigns&#160;a&#160;sequence&#160;value.&#160;<br/>The&#160;GetReference&#160;field&#160;has&#160;a&#160;SequenceNumber attribute&#160;that&#160;takes&#160;the&#160;numeric&#160;SequenceValue&#160;from&#160;the&#160;<br/>referenced field (see<a href="libremacros.html#445">&#160;Listing&#160;395).&#160;</a><br/>
The&#160;reference&#160;field source&#160;indicates&#160;the&#160;type&#160;of field&#160;that&#160;is&#160;referenced.&#160;The&#160;supported types&#160;are&#160;shown i<a href="libremacros.html#445">n<br/>Table&#160;155. M</a>uch of this&#160;is&#160;poorly&#160;documented,&#160;and I&#160;speculate&#160;that&#160;the&#160;sequence&#160;value&#160;may&#160;be&#160;unique&#160;<br/>relative&#160;to field&#160;source.<br/>
The&#160;ReferenceFieldPart&#160;indicates&#160;how&#160;the&#160;reference&#160;is&#160;displayed.&#160;Valid values&#160;are&#160;shown i<a href="libremacros.html#445">n&#160;Table&#160;154.&#160;</a>The&#160;<br/>example&#160;i<a href="libremacros.html#445">n&#160;Listing&#160;395&#160;us</a>es&#160;the&#160;category&#160;and the&#160;number.&#160;In&#160;a&#160;caption,&#160;all&#160;text&#160;before&#160;the&#160;number is&#160;the&#160;<br/>category.&#160;<br/>
441<br/>
<hr/>
<a name=445></a><i><b>Listing&#160;395.</b>&#160;Inserting&#160;a GetReference&#160;field.<br/></i>oField&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.textfield.GetReference&#34;)<br/>oField.ReferenceFieldPart&#160;=&#160;com.sun.star.text.ReferenceFieldPart.CATEGORY_AND_NUMBER<br/>oField.ReferenceFieldSource&#160;=&#160;com.sun.star.text.ReferenceFieldSource.SEQUENCE_FIELD<br/>oField.SequenceNumber&#160;=&#160;oReferencedField.SequenceValue<br/>oField.SourceName&#160;=&#160;sSeqName<br/>oText.insertTextContent(oCurs,&#160;oField,&#160;True)<br/>
<i><b>Table&#160;154.</b>&#160;Constants&#160;for&#160;com.sun.star.text.ReferenceFieldPart.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Constant</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
PAGE&#160;<br/>
The&#160;page&#160;number&#160;is&#160;displayed&#160;using&#160;Arabic&#160;numbers. &#160;<br/>
1<br/>
CHAPTER&#160;<br/>
The&#160;chapter&#160;number&#160;is displayed.&#160;&#160;<br/>
2<br/>
TEXT&#160;<br/>
The&#160;reference&#160;text&#160;is displayed.&#160;&#160;<br/>
3<br/>
UP_DOWN&#160;<br/>
Use&#160;localized&#160;words for&#160;&#34;above&#34;&#160;or&#160;&#34;below&#34;. &#160;<br/>
4<br/>
PAGE_DESC&#160;<br/>
The&#160;page&#160;number&#160;is&#160;displayed&#160;using&#160;the&#160;numbering&#160;type&#160;defined&#160;in&#160;the&#160;<br/>
page&#160;style&#160;of&#160;the&#160;reference&#160;position. &#160;<br/>
5<br/>
CATEGORY_AND_NUMBER&#160;<br/>
The&#160;category&#160;and the&#160;number&#160;of&#160;a&#160;caption is&#160;displayed;&#160;for&#160;example,&#160;<br/>
Listing&#160;7.<br/>
6<br/>
ONLY_CAPTION&#160;<br/>
The&#160;caption text&#160;of&#160;a&#160;caption is displayed.<br/>
7<br/>
ONLY_SEQUENCE_NUMBER&#160;<br/>
The&#160;number&#160;of&#160;a&#160;sequence&#160;field&#160;is displayed.&#160;&#160;<br/>
8<br/>
NUMBER&#160;<br/>
The&#160;numbering&#160;label&#160;and depending&#160;of&#160;the&#160;reference&#160;field&#160;context&#160;<br/>
numbering&#160;labels of&#160;superior&#160;list&#160;levels of&#160;the&#160;reference&#160;are&#160;displayed. &#160;<br/>
9<br/>
NUMBER_NO_CONTEXT&#160;<br/>
The&#160;numbering&#160;label&#160;of&#160;the&#160;reference&#160;is displayed.&#160;&#160;<br/>
10<br/>
NUMBER_FULL_CONTEXT&#160;<br/>
The&#160;numbering&#160;label&#160;and numbering&#160;labels of&#160;superior&#160;list&#160;levels of&#160;the&#160;<br/>reference&#160;are&#160;displayed. &#160;<br/>
<i><b>Table&#160;155.</b>&#160;Constants&#160;for&#160;com.sun.star.text.ReferenceFieldSource.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Constant</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
REFERENCE_MARK&#160;<br/>
The&#160;source&#160;is&#160;a&#160;reference&#160;mark. &#160;<br/>
1<br/>
SEQUENCE_FIELD&#160;<br/>
The&#160;source&#160;is&#160;a&#160;number&#160;sequence&#160;field. &#160;<br/>
2<br/>
BOOKMARK&#160;<br/>
The&#160;source&#160;is&#160;a&#160;bookmark. &#160;<br/>
3<br/>
FOOTNOTE&#160;<br/>
The&#160;source&#160;is&#160;a&#160;footnote.&#160;&#160;<br/>
4<br/>
ENDNOTE&#160;<br/>
The&#160;source&#160;is&#160;an endnote.&#160;&#160;<br/>
<b>&#160;14.12.6.&#160;Replace&#160;text&#160;with&#160;a&#160;GetReference&#160;field<br/></b><a href="libremacros.html#445">Listing 396&#160;a</a>ccepts&#160;an array&#160;of strings&#160;and a&#160;string to&#160;find in&#160;the&#160;array.&#160;The&#160;function returns&#160;the&#160;index&#160;of the&#160;<br/>string in&#160;the&#160;array.&#160;The&#160;need for this&#160;macro is&#160;explained&#160;below.<br/>
<i><b>Listing&#160;396.</b>&#160;Find&#160;a string in&#160;an array.<br/></i>Function&#160;FindStringInArray(oData,&#160;s)&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;FindStringInArray&#160;=&#160;-1<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(oData)&#160;To&#160;UBound(oData)<br/>&#160; &#160;&#160;If&#160;oData(i)&#160;=&#160;s&#160;Then<br/>
442<br/>
<hr/>
<a name=446></a>&#160; &#160; &#160;&#160;FindStringInArray&#160;=&#160;i<br/>&#160; &#160; &#160;&#160;Exit&#160;Function<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>End&#160;Function<br/>
The&#160;inner workings&#160;of the&#160;main&#160;macro are&#160;described in&#160;the&#160;comments&#160;of the&#160;macro itself (see<a href="libremacros.html#446">&#160;Listing&#160;397).</a><br/>
<i><b>Listing&#160;397.</b>&#160;Replace&#160;text&#160;with a GetReference&#160;field.<br/></i>Function&#160;referenceSequenceVariables(oDoc,&#160;sSeqName)&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;oEnum&#160; &#160; &#160; &#160; &#160; &#160;&#160;' Enumeration of text sections.<br/>&#160;&#160;Dim&#160;oField&#160; &#160; &#160; &#160; &#160; &#160;' Enumerated text field.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' Generic string variable.<br/>&#160;&#160;Dim&#160;oFrame&#160; &#160; &#160; &#160; &#160; &#160;' Documents main frame, used for dispatches.<br/>&#160;&#160;Dim&#160;oDispatcher&#160; &#160; &#160;&#160;' Dispatcher object.<br/>&#160;&#160;Dim&#160;oFields()&#160; &#160; &#160; &#160;&#160;' Set expressions that may be referenced.&#160;<br/>&#160;&#160;Dim&#160;sPresentations()&#160;' Text of what is displayed; for example, &#34;Listing 7&#34;<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160;' Location of a reference (such as &#34;Listing 7&#34;) in sPresentations.<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Integer&#160; &#160; &#160;' Count the fields.<br/>&#160;&#160;Dim&#160;oCurs&#160; &#160; &#160; &#160; &#160; &#160;&#160;' Cursor used to clear formatting.<br/>&#160;&#160;Dim&#160;oDescriptor&#160; &#160; &#160;&#160;' The search descriptor.<br/>&#160;&#160;Dim&#160;oFound&#160; &#160; &#160; &#160; &#160; &#160;' The found range.<br/>
&#160;&#160;' Default to no references created.&#160;<br/>&#160;&#160;referenceSequenceVariables&#160;=&#160;0<br/>
&#160;&#160;' Setup to perform a dispatch.<br/>&#160;&#160;oFrame&#160;=&#160;oDoc.CurrentController.Frame<br/>&#160;&#160;oDispatcher&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>
&#160;&#160;' Enumerate the text fields and identify the appropriate set field expressions.<br/>&#160;&#160;' The field presentation is the number as it is displayed.<br/>&#160;&#160;' When this section is finished:<br/>&#160;&#160;' oFields() - All the set expression fields for the specified name.&#160;<br/>&#160;&#160;' sPresentations() - Contains the full reference such as &#34;Listing 7&#34; for the listing<br/>&#160;&#160;' &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;sequence with the value 7.<br/>&#160;&#160;oEnum&#160;=&#160;oDoc.getTextFields().createEnumeration()<br/>&#160;&#160;If&#160;Not&#160;IsNull(oEnum)&#160;Then<br/>&#160; &#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements()<br/>&#160; &#160; &#160;&#160;oField&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160; &#160;&#160;If&#160;oField.supportsService(&#34;com.sun.star.text.TextField.SetExpression&#34;)&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;If&#160;oField.VariableName&#160;=&#160;sSeqName&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;ReDim&#160;Preserve&#160;oFields(0&#160;To&#160;n)<br/>&#160; &#160; &#160; &#160; &#160;&#160;ReDim&#160;Preserve&#160;sPresentations(0&#160;To&#160;n)<br/>&#160; &#160; &#160; &#160; &#160;&#160;oFields(n)&#160;=&#160;oField<br/>&#160; &#160; &#160; &#160; &#160;&#160;sPresentations(n)&#160;=&#160;sSeqName&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;oField.CurrentPresentation<br/>&#160; &#160; &#160; &#160; &#160;&#160;n&#160;=&#160;n&#160;+&#160;1<br/>&#160; &#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Loop<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;' Create the search descriptor to find all instances of things such as &#34;Listing 23&#34;.<br/>&#160;&#160;' Values in fields are not found, because search does NOT search fields.<br/>
443<br/>
<hr/>
<a name=447></a>&#160;&#160;oDescriptor&#160;=&#160;oDoc.createSearchDescriptor()<br/>&#160;&#160;With&#160;oDescriptor<br/>&#160; &#160;&#160;.SearchString&#160;=&#160;&#160;sSeqName&#160;&amp;&#160;&#34; [:digit:]+&#34;<br/>&#160; &#160;&#160;.SearchRegularExpression&#160;=&#160;True<br/>&#160;&#160;End&#160;With<br/>
&#160;&#160;n&#160;=&#160;0<br/>&#160;&#160;oFound&#160;=&#160;oDoc.findFirst(oDescriptor)<br/>&#160;&#160;Do&#160;While&#160;Not&#160;IsNull(oFound)<br/>
&#160; &#160;&#160;' Look for a field with the text such as &#34;Listing 7&#34;<br/>&#160; &#160;&#160;i&#160;=&#160;FindStringInArray(sPresentations,&#160;oFound.getString())<br/>&#160; &#160;&#160;If&#160;i&#160;&gt;=&#160;0&#160;Then<br/>&#160; &#160; &#160;&#160;' Create and configure the GetReference field<br/>&#160; &#160; &#160;&#160;oField&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.text.textfield.GetReference&#34;)<br/>&#160; &#160; &#160;&#160;oField.ReferenceFieldPart&#160;=&#160;com.sun.star.text.ReferenceFieldPart.CATEGORY_AND_NUMBER<br/>&#160; &#160; &#160;&#160;oField.ReferenceFieldSource&#160;=&#160;com.sun.star.text.ReferenceFieldSource.SEQUENCE_FIELD<br/>&#160; &#160; &#160;&#160;oField.SequenceNumber&#160;=&#160;oFields(i).SequenceValue<br/>&#160; &#160; &#160;&#160;oField.SourceName&#160;=&#160;sSeqName<br/>
&#160; &#160; &#160;&#160;' Create a text cursor where the text was found.&#160;<br/>&#160; &#160; &#160;&#160;' Clear the text, then insert the GetReference field at that location.&#160;<br/>&#160; &#160; &#160;&#160;oCurs&#160;=&#160;oFound.getText().createTextCursorByRange(oFound)<br/>&#160; &#160; &#160;&#160;oCurs.setString(&#34;&#34;)<br/>&#160; &#160; &#160;&#160;oFound.getText().insertTextContent(oCurs,&#160;oField,&#160;True)<br/>
&#160; &#160; &#160;&#160;' Sometimes, special formatting was used for the reference text.&#160;<br/>&#160; &#160; &#160;&#160;' A cursor cannot move into a field, so collapsing the cursor then selecting<br/>&#160; &#160; &#160;&#160;' one character to the left will select the GetReference field.<br/>&#160; &#160; &#160;&#160;oCurs.collapseToEnd()<br/>&#160; &#160; &#160;&#160;oCurs.goLeft(1,&#160;True)<br/>
&#160; &#160; &#160;&#160;' Select the GetReference field on the display, then use a<br/>&#160; &#160; &#160;&#160;' dispatch to clear all attributes.<br/>&#160; &#160; &#160;&#160;oDoc.CurrentController.select(oCurs)<br/>&#160; &#160; &#160;&#160;oDispatcher.executeDispatch(oFrame,&#160;&#34;.uno:ResetAttributes&#34;,&#160;&#34;&#34;,&#160;0,&#160;Array())<br/>&#160; &#160; &#160;&#160;n&#160;=&#160;n&#160;+&#160;1<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Failed to find (&#34;&#160;&amp;&#160;oFound.getString()&#160;&amp;&#160;&#34;)&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;oFound&#160;=&#160;oDoc.findNext(oFound.End,&#160;oDescriptor)<br/>&#160;&#160;Loop<br/>&#160;&#160;referenceSequenceVariables&#160;=&#160;n<br/>&#160;&#160;If&#160;s&#160;&lt;&gt;&#160;&#34;&#34;&#160;Then<br/>&#160; &#160;&#160;Msgbox&#160;s<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
<b>&#160;14.12.7.&#160;The&#160;worker&#160;that&#160;ties&#160;it&#160;all&#160;together<br/></b>The&#160;main&#160;worker macro starts&#160;by&#160;replacing captions&#160;for Figure, Listing, and&#160;Table&#160;with sequence&#160;variables.&#160;<br/>It&#160;is&#160;assumed,&#160;but&#160;never verified,&#160;that&#160;the&#160;captions&#160;are&#160;sequentially&#160;numbered as&#160;they&#160;appear in&#160;the&#160;document&#160;<br/>
444<br/>
<hr/>
<a name=448></a>with no gaps&#160;in numbering. In&#160;other words, the&#160;routines&#160;are&#160;a&#160;bit&#160;fragile,&#160;but&#160;they&#160;worked great&#160;for the&#160;<br/>documents&#160;that&#160;I&#160;desired to&#160;use.<br/>
My&#160;first&#160;test&#160;set&#160;about&#160;100 captions.&#160;All&#160;cross-references&#160;failed because&#160;the&#160;fields&#160;had not&#160;yet&#160;updated.&#160;After&#160;<br/>creating all&#160;sequence&#160;fields, a&#160;dispatch&#160;causes&#160;the&#160;fields&#160;to&#160;update&#160;so that&#160;the&#160;next&#160;phase&#160;can begin. Note&#160;that&#160;<br/>if this&#160;is&#160;not&#160;done, then the&#160;CurrentPresentation attribute&#160;on the&#160;sequence&#160;fields&#160;will&#160;be&#160;incorrect.<br/>
<i><b>Listing&#160;398.</b>&#160;Set&#160;captions&#160;and references&#160;for&#160;a document.<br/></i>sub&#160;replaceCaptions()<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;' Document on which to operate.<br/>&#160;&#160;Dim&#160;oFrame&#160; &#160; &#160; &#160;' Documents main frame, used for dispatches.<br/>&#160;&#160;Dim&#160;oDispatcher&#160;&#160;' Dispatcher object.<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;' General index variable.<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Integer&#160;' Number of fields created.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160;' Summary of work performed.<br/>&#160;&#160;Dim&#160;fields()&#160; &#160; &#160;' Field names on which to operate.<br/>
&#160;&#160;fields&#160;=&#160;Array(&#34;Listing&#34;,&#160;&#34;Table&#34;,&#160;&#34;Figure&#34;)<br/>&#160;&#160;oDoc&#160;=&#160;ThisComponent<br/>&#160;&#160;oFrame&#160;=&#160;oDoc.CurrentController.Frame<br/>&#160;&#160;oDispatcher&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)<br/>&#160;&#160;<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(fields())&#160;To&#160;UBound(fields())<br/>&#160; &#160;&#160;n&#160;=&#160;FindReplaceTextFields(ThisComponent,&#160;fields(i))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Fixed &#34;&#160;&amp;&#160;n&#160;&amp;&#160;&#34; captions for &#34;&#160;&amp;&#160;fields(i)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>
&#160;&#160;' This next part will NOT work until after all of the fields have updated.<br/>&#160;&#160;' So, force an update.<br/>&#160;&#160;oDispatcher.executeDispatch(oFrame,&#160;&#34;.uno:UpdateFields&#34;,&#160;&#34;&#34;,&#160;0,&#160;Array())<br/>
&#160;&#160;For&#160;i&#160;=&#160;LBound(fields())&#160;To&#160;UBound(fields())<br/>&#160; &#160;&#160;n&#160;=&#160;referenceSequenceVariables(ThisComponent,&#160;fields(i))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;set &#34;&#160;&amp;&#160;n&#160;&amp;&#160;&#34; references to &#34;&#160;&amp;&#160;fields(i)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
<i><b>&#160;14.13.&#160;Table&#160;of&#160;contents<br/></b></i>Finding and inserting&#160;a&#160;table&#160;of contents&#160;(TOC) is&#160;easy&#160;unless&#160;you want&#160;to&#160;change&#160;the&#160;defaults.&#160;The&#160;<br/>following&#160;macro checks&#160;ThisComponent&#160;to&#160;see&#160;if the&#160;document&#160;contains&#160;a&#160;content&#160;index.<br/>
&#160; REM Find TOC if it exists.<br/>&#160;&#160;oIndexes&#160;=&#160;ThisComponent.getDocumentIndexes()<br/>&#160;&#160;bIndexFound&#160;=&#160;False<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oIndexes.getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;oIndex&#160;=&#160;oIndexes.getByIndex(i)<br/>&#160; &#160;&#160;If&#160;oIndex.supportsService(&#34;com.sun.star.text.ContentIndex&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;bIndexFound&#160;=&#160;True<br/>&#160; &#160; &#160;&#160;Exit&#160;For<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>
445<br/>
<hr/>
<a name=449></a>Use&#160;dispose&#160;to remove&#160;an existing&#160;index&#160;from&#160;the&#160;document.&#160;<br/>
When&#160;I&#160;create&#160;a&#160;TOC, I&#160;usually&#160;set&#160;CreateFromOutline&#160;to&#160;true&#160;to create&#160;the&#160;index&#160;based on the&#160;document&#160;<br/>outline&#160;styles&#160;(see<a href="libremacros.html#449">&#160;Listing&#160;399).</a><br/>
<i><b>Listing&#160;399.</b>&#160;Insert&#160;a standard&#160;TOC into&#160;a document.<br/></i>Sub&#160;InsertATOC<br/>&#160;&#160;REM Author: Andrew Pitonyak<br/>&#160;&#160;Dim&#160;oCurs&#160; &#160; &#160;&#160;'Used to insert the text content.<br/>&#160;&#160;Dim&#160;oIndexes&#160; &#160;'All of the existing indexes<br/>&#160;&#160;Dim&#160;oIndex&#160; &#160; &#160;'TOC if it exists and a new one if not<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160;'Find an existing TOC<br/>&#160;&#160;Dim&#160;bIndexFound&#160;As&#160;Boolean&#160;'Flag to track if the TOC was found<br/>
&#160;&#160;REM Find TOC if it exists.<br/>&#160;&#160;oIndexes&#160;=&#160;ThisComponent.getDocumentIndexes()<br/>&#160;&#160;bIndexFound&#160;=&#160;False<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oIndexes.getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;oIndex&#160;=&#160;oIndexes.getByIndex(i)<br/>&#160; &#160;&#160;If&#160;oIndex.supportsService(&#34;com.sun.star.text.ContentIndex&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;bIndexFound&#160;=&#160;True<br/>&#160; &#160; &#160;&#160;Exit&#160;For<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;If&#160;Not&#160;bIndexFound&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;I did not find an existing content index&#34;<br/>&#160; &#160;&#160;REM Create and insert a new TOC.<br/>&#160; &#160;&#160;REM The new TOC must be created by the document that will contain the TOC.<br/>&#160; &#160;&#160;oIndex&#160;=&#160;ThisComponent.createInstance(&#34;com.sun.star.text.ContentIndex&#34;)<br/>
&#160; &#160;&#160;oIndex.CreateFromOutline&#160;=&#160;True<br/>&#160; &#160;&#160;oCurs&#160;=&#160;ThisComponent.getText().createTextCursor()<br/>&#160; &#160;&#160;oCurs.gotoStart(False)<br/>&#160; &#160;&#160;ThisComponent.getText().insertTextContent(oCurs,&#160;oIndex,&#160;False)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;REM Even the newly inserted index is not updated until right HERE!<br/>&#160;&#160;oIndex.update()<br/>End&#160;Sub<br/>
The&#160;same&#160;code&#160;can be&#160;used to&#160;create&#160;a&#160;DocumentIndex,&#160;ContentIndex, UserDefinedIndex, IllustrationIndex,&#160;<br/>TableIndex,&#160;or ObjectIndex.&#160;Properties&#160;common&#160;to all&#160;index&#160;types&#160;are&#160;shown in<a href="libremacros.html#450">&#160;Table&#160;156.</a><br/>
446<br/>
<hr/>
<a name=450></a><i><b>Table&#160;156.</b>&#160;Common index&#160;properties.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BackColor<br/>
Background color.&#160;Set&#160;to -1 for&#160;none.&#160;<br/>
BackGraphicFilter&#160;<br/>
Filter&#160;for&#160;the&#160;graphic&#160;displayed&#160;as background graphic.<br/>
BackGraphicLocation<br/>
Location of&#160;the&#160;back graphic.&#160;Set&#160;using&#160;the&#160;com.sun.star.style.GraphicLocation constants.<br/>
This&#160;includes NONE,&#160;LEFT_TOP,&#160;MIDDLE_TOP,&#160;RIGHT_TOP,&#160;LEFT_MIDDLE,&#160;<br/>MIDDLE_MIDDLE,&#160;RIGHT_MIDDLE,&#160;LEFT_BOTTOM,&#160;MIDDLE_BOTTOM,&#160;<br/>
RIGHT_BOTTOM,&#160;AREA, and&#160;TILED<br/>
BackGraphicURL<br/>
URL&#160;to the&#160;graphic&#160;displayed&#160;as&#160;a&#160;background&#160;graphic.&#160;I&#160;did not&#160;experiment&#160;with&#160;this, it&#160;<br/>
may&#160;require&#160;an internal&#160;URL??<br/>
CreateFromChapter<br/>
Set&#160;to&#160;True&#160;to create&#160;an index&#160;based on the&#160;current&#160;chapter&#160;rather&#160;than&#160;the&#160;entire&#160;<br/>
document.<br/>
IsProtected<br/>
If&#160;true,&#160;the&#160;index&#160;is protected&#160;and cannot&#160;be&#160;edited&#160;as part&#160;of&#160;the&#160;text.<br/>
ParaStyleHeading<br/>
Paragraph&#160;style&#160;name&#160;used for&#160;the&#160;heading.<br/>
ParaStyleLevel1<br/>
Paragraph&#160;style&#160;named&#160;used&#160;for&#160;level&#160;1. Note&#160;that&#160;there&#160;is&#160;an attribute&#160;for&#160;levels 1&#160;through<br/>
10.<br/>
Title<br/>
Index&#160;title&#160;that&#160;is inserted&#160;as part&#160;of&#160;the&#160;TOC.&#160;I&#160;usually&#160;leave&#160;this blank and place&#160;the&#160;title<br/>
before&#160;the&#160;TOC&#160;using&#160;the&#160;“Heading&#160;1”&#160;paragraph&#160;style&#160;so that&#160;it&#160;is&#160;included&#160;as part&#160;of&#160;the&#160;<br/>TOC;&#160;silly,&#160;I&#160;know.<br/>
A&#160;TOC contains&#160;columns&#160;of data;&#160;for example, section&#160;numbering, section&#160;title,&#160;and page&#160;number.&#160;Each&#160;<br/>column&#160;is&#160;represented by&#160;an array&#160;of named properties.&#160;The&#160;supported properties&#160;are&#160;show<a href="libremacros.html#450">n&#160;Table&#160;157.</a><br/>
<i><b>Table&#160;157.</b>&#160;Supported column tokens.</i><br/>
<i><b>Token</b></i><br/>
<i><b>Description</b></i><br/>
TokenType<br/>
Identifies&#160;the&#160;contents of&#160;the&#160;column.&#160;Every&#160;column has a&#160;token&#160;type&#160;as the&#160;first&#160;property.&#160;<br/>
TokenType&#160;property&#160;values are&#160;strings shown&#160;i<a href="libremacros.html#451">n&#160;Table&#160;158.</a><br/>
CharacterStyleName<br/>
Name&#160;of&#160;the&#160;character&#160;style&#160;applied&#160;to the&#160;element. Do not&#160;include&#160;for&#160;tab&#160;stops.&#160;An&#160;empty&#160;<br/>
value&#160;causes the&#160;Default&#160;style&#160;to be&#160;used.<br/>
TabStopRightAligned<br/>
Tab&#160;stop&#160;is right&#160;aligned.&#160;Only&#160;valid for&#160;tab stops.<br/>
TabStopPosition<br/>
Position&#160;of&#160;the&#160;tab&#160;stop.&#160;Only&#160;valid for&#160;tab stops.<br/>
TabStopFillCharacter<br/>
Fill&#160;character&#160;in tab&#160;stops. Only&#160;valid&#160;for&#160;tab&#160;stops.<br/>
WithTab<br/>
If&#160;true&#160;insert&#160;tab&#160;character.<br/>
Text<br/>
Only&#160;valid in user&#160;defined&#160;text.<br/>
ChapterFormat<br/>
Valid&#160;in chapter&#160;info and entry&#160;number&#160;only.&#160;The&#160;chapter&#160;format&#160;is&#160;also&#160;mentioned&#160;in<a href="libremacros.html#425">&#160;Table&#160;<br/>148. F</a>or&#160;chapter&#160;info&#160;NUMBER&#160;and NAME_NUMBER&#160;are&#160;allowed&#160;and for&#160;an&#160;entry&#160;<br/>
NUMBER&#160;and DIGIT&#160;are&#160;allowed.<br/>
ChapterLevel<br/>
Valid&#160;in chapter&#160;info and entry&#160;number&#160;only.&#160;Denotes the&#160;level&#160;up to&#160;which the&#160;chapter&#160;<br/>
information is given.&#160;Values permitted&#160;1&#160;to 10&#160;inclusive.<br/>
Some&#160;token&#160;types&#160;are&#160;not&#160;supported by&#160;all&#160;index&#160;types.&#160;The&#160;Value&#160;is&#160;the&#160;string name&#160;used to&#160;identify&#160;the&#160;<br/>token type.&#160;The&#160;Entry&#160;column contains&#160;the&#160;text&#160;used in&#160;the&#160;GUI&#160;while&#160;specifying the&#160;columns. If&#160;an entry&#160;is&#160;<br/>empty,&#160;it&#160;is&#160;because&#160;I&#160;did not&#160;verify&#160;every&#160;type&#160;to&#160;see&#160;what&#160;values&#160;are&#160;used and I&#160;do not&#160;know&#160;the&#160;value.<br/>
447<br/>
<hr/>
<a name=451></a><i><b>Table&#160;158.</b>&#160;Supported TokenType&#160;values.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Entry</b></i><br/>
<i><b>Comment</b></i><br/>
<i><b>Supported&#160;Index&#160;Types</b></i><br/>
TokenEntryNumber<br/>
E#<br/>
Chapter&#160;number<br/>
Content<br/>
TokenEntryText<br/>
E<br/>
Entry&#160;text<br/>
All<br/>
TokenTabStop<br/>
T<br/>
Tab&#160;stop<br/>
All<br/>
TokenText<br/>
User&#160;defined&#160;text<br/>
TokenPageNumber<br/>
#<br/>
page&#160;number<br/>
All<br/>
TokenChapterInfo<br/>
Chapter&#160;information<br/>
Illustration,&#160;Table,&#160;User,&#160;Table&#160;of&#160;<br/>Objects, and&#160;Alphabetical<br/>
TokenHyperlinkStart<br/>
LS<br/>
Begin a&#160;hyperlink<br/>
TokenHyperlinkEnd<br/>
LE<br/>
End a&#160;hyperlink<br/>
TokenBibliographyDataField<br/>
Bibliographic&#160;data&#160;field<br/>
The&#160;macro i<a href="libremacros.html#451">n&#160;Listing&#160;400&#160;i</a>nspects&#160;the&#160;level&#160;formatting for the&#160;TOC in the&#160;current&#160;document&#160;and then inserts&#160;<br/>text&#160;at&#160;the&#160;end of the&#160;current&#160;document.<br/>
<i><b>Listing&#160;400.</b>&#160;Inspect&#160;the&#160;TOC in&#160;the&#160;current&#160;document.</i><br/>
Sub&#160;InspectCurrentTOCColumns<br/>&#160;&#160;'Inspect ThisComponent<br/>&#160;&#160;Dim&#160;oCurs&#160; &#160; &#160;&#160;'Used to insert the text content.<br/>&#160;&#160;Dim&#160;oIndexes&#160; &#160;'All of the existing indexes<br/>&#160;&#160;Dim&#160;oIndex&#160; &#160; &#160;'TOC if it exists and a new one if not<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160;'Find an existing TOC<br/>&#160;&#160;Dim&#160;bIndexFound&#160;As&#160;Boolean&#160;'Flag to track if the TOC was found<br/>&#160;&#160;Dim&#160;iLevel%&#160; &#160;&#160;' Iterate over the levels in the LevelFormat property.<br/>&#160;&#160;Dim&#160;iCol%&#160; &#160; &#160;&#160;' Iterate over the columns in each level.<br/>&#160;&#160;Dim&#160;iProp%&#160; &#160; &#160;' Iterate over the properties for a single column.<br/>&#160;&#160;Dim&#160;oLevel&#160; &#160; &#160;' Level object.<br/>&#160;&#160;Dim&#160;oCol&#160; &#160; &#160; &#160;' Column object.<br/>&#160;&#160;Dim&#160;s$<br/>
&#160;&#160;REM Find TOC if it exists.<br/>&#160;&#160;oIndexes&#160;=&#160;ThisComponent.getDocumentIndexes()<br/>&#160;&#160;bIndexFound&#160;=&#160;False<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oIndexes.getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;oIndex&#160;=&#160;oIndexes.getByIndex(i)<br/>&#160; &#160;&#160;If&#160;oIndex.supportsService(&#34;com.sun.star.text.ContentIndex&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;bIndexFound&#160;=&#160;True<br/>&#160; &#160; &#160;&#160;Exit&#160;For<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;If&#160;Not&#160;bIndexFound&#160;Then<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;s&#160;=&#160;&#34;Level&#34;&#160;&amp;&#160;CHR$(9)&#160;&amp;&#160;&#34;Column&#34;&#160;&amp;&#160;CHR$(9)&#160;&amp;&#160;&#34;Property&#34;&#160;&amp;&#160;CHR$(9)&#160;&amp;&#160;&#34;Name&#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;CHR$(9)&#160;&amp;&#160;&#34;Value&#34;&#160;&amp;&#160;CHR$(13)<br/>&#160;&#160;For&#160;iLevel&#160;=&#160;0&#160;To&#160;oIndex.LevelFormat.getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;oLevel&#160;=&#160;oIndex.LevelFormat.getByIndex(iLevel)<br/>
448<br/>
<hr/>
<a name=452></a>&#160; &#160;&#160;For&#160;iCol&#160;=&#160;LBound(oLevel)&#160;To&#160;UBound(oLevel)<br/>&#160; &#160; &#160;&#160;oCol&#160;=&#160;oLevel(iCol)<br/>&#160; &#160; &#160;&#160;For&#160;iProp&#160;=&#160;LBound(oCol)&#160;To&#160;UBound(oCol)<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;iLevel&#160;&amp;&#160;CHR$(9)&#160;&amp;&#160;iCol&#160;&amp;&#160;CHR$(9)&#160;&amp;&#160;iProp&#160;&#160;&amp;&#160;CHR$(9)&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;oCol(iProp).Name&#160;&amp;&#160;CHR$(9)&#160;&amp;&#160;oCol(iProp).Value&#160;&amp;&#160;CHR$(13)<br/>&#160; &#160; &#160;&#160;Next<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;Next<br/>&#160;&#160;ThisComponent.getText().insertString(ThisComponent.getText().End,&#160;s,&#160;False)<br/>End&#160;Sub<br/>
I&#160;ran the&#160;macro i<a href="libremacros.html#451">n&#160;Listing&#160;400&#160;w</a>ith&#160;OOo version 3.3.0 and noticed that&#160;level&#160;0 contains&#160;no entries, and levels<br/>1 – 10 are&#160;identical.&#160;The&#160;output&#160;for level&#160;1 is&#160;shown in<a href="libremacros.html#452">&#160;Table&#160;159.&#160;</a><br/>
•<br/>
Column 0 is&#160;the&#160;TokenEntryNumber formatted with&#160;the&#160;Default&#160;character style. In&#160;the&#160;TOC, this&#160;is&#160;<br/>the&#160;chapter numbering.<br/>
•<br/>
A&#160;hyperlink&#160;begins&#160;in&#160;column&#160;1, and it&#160;is&#160;formatted&#160;using the&#160;“Internet&#160;Link”&#160;character style.<br/>
•<br/>
Column 2 contains&#160;the&#160;heading&#160;text.&#160;No character style&#160;is&#160;provided, but&#160;it&#160;is&#160;formatted using&#160;the&#160;<br/>“Internet&#160;Link”&#160;style&#160;because&#160;it&#160;is&#160;included in&#160;the&#160;hyperlink.<br/>
•<br/>
Column 3 specifies&#160;the&#160;end of the&#160;hyperlink, so the&#160;hyperlink&#160;includes&#160;only&#160;the&#160;heading text.<br/>
•<br/>
Column 4 specifies&#160;a&#160;right&#160;aligned tab&#160;stop that&#160;fills&#160;the&#160;empty&#160;space&#160;between the&#160;heading text&#160;and&#160;<br/>the&#160;page&#160;number with periods.<br/>
•<br/>
Column 5 contains&#160;the&#160;page&#160;number.<br/>
<i><b>Table&#160;159.</b>&#160;Level&#160;format&#160;for&#160;level&#160;1.</i><br/>
<i><b>Level</b></i><br/>
<i><b>Column</b></i><br/>
<i><b>Property</b></i><br/>
<i><b>Name</b></i><br/>
<i><b>Value</b></i><br/>
1<br/>
0<br/>
0<br/>
TokenType<br/>
TokenEntryNumber<br/>
1<br/>
0<br/>
1<br/>
CharacterStyleName<br/>
1<br/>
1<br/>
0<br/>
TokenType<br/>
TokenHyperlinkStart<br/>
1<br/>
1<br/>
1<br/>
CharacterStyleName<br/>
Internet&#160;link<br/>
1<br/>
2<br/>
0<br/>
TokenType<br/>
TokenEntryText<br/>
1<br/>
2<br/>
1<br/>
CharacterStyleName<br/>
1<br/>
3<br/>
0<br/>
TokenType<br/>
TokenHyperlinkEnd<br/>
1<br/>
4<br/>
0<br/>
TokenType<br/>
TokenTabStop<br/>
1<br/>
4<br/>
1<br/>
TabStopRightAligned<br/>
TRUE<br/>
1<br/>
4<br/>
2<br/>
TabStopFillCharacter<br/>
.<br/>
1<br/>
4<br/>
3<br/>
CharacterStyleName<br/>
1<br/>
4<br/>
4<br/>
WithTab<br/>
TRUE<br/>
1<br/>
5<br/>
0<br/>
TokenType<br/>
TokenPageNumber<br/>
1<br/>
5<br/>
1<br/>
CharacterStyleName<br/>
449<br/>
<hr/>
<a name=453></a>While&#160;creating a&#160;TOC manually,&#160;the&#160;columns&#160;are&#160;edited&#160;to include&#160;things&#160;such as&#160;chapter numbers, chapter&#160;<br/>text,&#160;hyperlink&#160;start, hyperlink end, page&#160;number,&#160;and other things.&#160;These&#160;values&#160;are&#160;stored in the&#160;&#160;<br/>LevelFormat&#160;property.&#160;<br/>
<i><b>Listing&#160;401.</b>&#160;Insert&#160;a TOC with&#160;hyperlinks.<br/></i>Sub&#160;InsertATOCWithHyperlinks<br/>&#160;&#160;REM Author: Andrew Pitonyak<br/>&#160;&#160;Dim&#160;oCurs&#160; &#160; &#160;&#160;'Used to insert the text content.<br/>&#160;&#160;Dim&#160;oIndexes&#160; &#160;'All of the existing indexes.<br/>&#160;&#160;Dim&#160;oIndex&#160; &#160; &#160;'TOC if it exists and a new one if not.<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160;'Find an existing TOC.<br/>&#160;&#160;Dim&#160;bIndexFound&#160;As&#160;Boolean&#160;'Flag to track if the TOC was found.<br/>&#160;&#160;Dim&#160;iLevel<br/>
&#160;&#160;REM Find TOC if it exists.<br/>&#160;&#160;oIndexes&#160;=&#160;ThisComponent.getDocumentIndexes()<br/>&#160;&#160;bIndexFound&#160;=&#160;False<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oIndexes.getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;oIndex&#160;=&#160;oIndexes.getByIndex(i)<br/>&#160; &#160;&#160;If&#160;oIndex.supportsService(&#34;com.sun.star.text.ContentIndex&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;bIndexFound&#160;=&#160;True<br/>&#160; &#160; &#160;&#160;Exit&#160;For<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;If&#160;Not&#160;bIndexFound&#160;Then<br/>&#160; &#160;&#160;REM Create and insert a new TOC.<br/>&#160; &#160;&#160;REM The new TOC must be created by the document that will contain the TOC.<br/>&#160; &#160;&#160;oIndex&#160;=&#160;ThisComponent.createInstance(&#34;com.sun.star.text.ContentIndex&#34;)<br/>
&#160; &#160;&#160;oIndex.CreateFromOutline&#160;=&#160;True<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;' Ignore level 0<br/>&#160; &#160;&#160;For&#160;iLevel&#160;=&#160;1&#160;To&#160;oIndex.LevelFormat.getCount()&#160;-&#160;1<br/>&#160; &#160; &#160;&#160;oIndex.LevelFormat.replaceByIndex(iLevel,&#160;CreateTOCColumnEntries())<br/>&#160; &#160;&#160;Next<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;oCurs&#160;=&#160;ThisComponent.getText().createTextCursor()<br/>&#160; &#160;&#160;oCurs.gotoRange(ThisComponent.CurrentController.ViewCursor,&#160;False)<br/>&#160; &#160;&#160;ThisComponent.getText().insertTextContent(oCurs,&#160;oIndex,&#160;False)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;REM Even the newly inserted index is not updated until right HERE!<br/>&#160;&#160;oIndex.update()<br/>End&#160;Sub<br/>
Function&#160;CreateTOCColumnEntries()<br/>&#160;&#160;Dim&#160;o<br/>&#160;&#160;o&#160;=&#160;Array(&#160;Array(MakeProperty(&#34;TokenType&#34;,&#160;&#34;TokenEntryNumber&#34;),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;MakeProperty(&#34;CharacterStyleName&#34;,&#160;&#34;&#34;)),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;Array(MakeProperty(&#34;TokenType&#34;,&#160;&#34;TokenHyperlinkStart&#34;),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;MakeProperty(&#34;CharacterStyleName&#34;,&#160;&#34;Internet link&#34;)),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;Array(MakeProperty(&#34;TokenType&#34;,&#160;&#34;TokenEntryText&#34;),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;MakeProperty(&#34;CharacterStyleName&#34;,&#160;&#34;&#34;)),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;Array(MakeProperty(&#34;TokenType&#34;,&#160;&#34;TokenHyperlinkEnd&#34;)),&#160;_<br/>
450<br/>
<hr/>
<a name=454></a>&#160; &#160; &#160; &#160; &#160; &#160; &#160;Array(MakeProperty(&#34;TokenType&#34;,&#160;&#34;TokenTabStop&#34;),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;MakeProperty(&#34;TabStopRightAligned&#34;,&#160;TRUE),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;MakeProperty(&#34;TabStopFillCharacter&#34;,&#160;&#34;.&#34;),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;MakeProperty(&#34;CharacterStyleName&#34;,&#160;&#34;&#34;),&#160;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;MakeProperty(&#34;WithTab&#34;,&#160;TRUE)),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;Array(MakeProperty(&#34;TokenType&#34;,&#160;&#34;TokenPageNumber&#34;),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;MakeProperty(&#34;CharacterStyleName&#34;,&#160;&#34;&#34;)))<br/>&#160;&#160;CreateTOCColumnEntries()&#160;=&#160;o<br/>End&#160;Function<br/>
Function&#160;MakeProperty(sName$,&#160;value)&#160;<br/>&#160;&#160;Dim&#160;oProp<br/>&#160;&#160;oProp&#160;=&#160;CreateObject(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>&#160;&#160;oProp.Name&#160;=&#160;sName<br/>&#160;&#160;oProp.Value&#160;=&#160;value<br/>&#160;&#160;MakeProperty&#160;=&#160;oProp<br/>End&#160;Function<br/>
<i><b>&#160;14.14.&#160;Conclusion<br/></b></i>Although this&#160;chapter didn’t&#160;cover every&#160;object&#160;and capability&#160;supported&#160;by&#160;Writer,&#160;it&#160;did&#160;discuss&#160;the&#160;<br/>capabilities&#160;most&#160;frequently&#160;questioned&#160;on the&#160;mailing lists.&#160;Many&#160;of the&#160;techniques&#160;demonstrated&#160;in this&#160;<br/>chapter are&#160;representative&#160;of the&#160;techniques&#160;that&#160;are&#160;required for objects&#160;not&#160;discussed. For example,&#160;all&#160;<br/>objects&#160;supporting named access&#160;are&#160;retrieved in the&#160;same&#160;manner.&#160;Use&#160;the&#160;material&#160;covered here&#160;as&#160;a&#160;<br/>starting point&#160;in your&#160;exploration&#160;of&#160;Writer documents&#160;in OpenOffice.org.<br/>
451<br/>
<hr/>
<a name=455></a><b>&#160;15.&#160;Calc&#160;Documents<br/></b>The&#160;primary&#160;purpose&#160;of a&#160;Calc&#160;document&#160;is&#160;to contain multiple&#160;spreadsheets,&#160;which&#160;in turn contain rows&#160;and<br/>columns&#160;of data&#160;—&#160;in&#160;other words, tables.&#160;This&#160;chapter introduces&#160;appropriate&#160;methods&#160;to manipulate,&#160;<br/>traverse, format,&#160;and modify&#160;the&#160;content&#160;contained&#160;in a&#160;Calc&#160;document.&#160;&#160;<br/>
OpenOffice.org&#160;supports&#160;three&#160;primary&#160;table&#160;types:&#160;text&#160;tables&#160;in&#160;Writer documents,&#160;database&#160;tables, and&#160;<br/>spreadsheets&#160;in Calc&#160;documents. Each of the&#160;different&#160;table&#160;types&#160;is&#160;tailored for a&#160;specific&#160;purpose.&#160;Text&#160;<br/>tables&#160;in&#160;Writer documents&#160;support&#160;complex&#160;text&#160;formatting but&#160;only&#160;simple&#160;table&#160;calculations. Spreadsheet&#160;<br/>documents, on the&#160;other hand, support&#160;complex&#160;calculations&#160;and only&#160;simple&#160;text&#160;formatting.<br/>
Conceptually,&#160;all&#160;document&#160;types&#160;have&#160;two components:&#160;the&#160;data&#160;they&#160;contain&#160;and the&#160;controller that&#160;<br/>determines&#160;how&#160;the&#160;data&#160;is&#160;displayed. In&#160;OpenOffice.org, the&#160;collection&#160;of data&#160;contained in&#160;a&#160;document&#160;is&#160;<br/>called the&#160;<i>model</i>. Each model&#160;has&#160;a&#160;controller that&#160;is&#160;responsible&#160;for the&#160;visual&#160;presentation&#160;of the&#160;data.&#160;The&#160;<br/>controller knows&#160;the&#160;location of the&#160;visible&#160;text&#160;cursor and the&#160;current&#160;page, and knows&#160;what&#160;is&#160;currently&#160;<br/>selected.<br/>
Every&#160;Calc&#160;document&#160;supports&#160;the&#160;com.sun.star.sheet.SpreadsheetDocument&#160;service.&#160;When&#160;I&#160;write&#160;a&#160;macro&#160;<br/>that&#160;must&#160;be&#160;user-friendly&#160;and requires&#160;a&#160;spreadsheet&#160;document, I&#160;verify&#160;that&#160;the&#160;document&#160;is&#160;the&#160;correct&#160;type<br/>by&#160;using&#160;the&#160;object&#160;method&#160;supportsService(). See<a href="libremacros.html#455">&#160;Listing&#160;402.</a><br/>
<i><b>Listing&#160;402.</b>&#160;Calc&#160;documents&#160;support&#160;the&#160;com.sun.star.sheet.SpreadsheetDocument&#160;service.<br/></i>REM A trick is used to avoid a bug in OOo.<br/>REM This function tests the argument to see if it supports a service.<br/>REM If the object does not support a service, a runtime error<br/>REM occurs that complains that the variable is not set.<br/>REM Assigning the argument to a temporary variable and<br/>REM using that to call SupportsService avoids the error.<br/>Function&#160;isCalcDocument(oDoc) As Boolean<br/>&#160; On Error Goto&#160;ErrorJumpPoint<br/>&#160; Dim&#160;s$ :&#160;s$ =&#160;&#34;com.sun.star.sheet.SpreadsheetDocument&#34;<br/>
&#160;&#160;isCalcDocument&#160;=&#160;False<br/>&#160; If&#160;oDoc.SupportsService(s$) Then<br/>&#160; &#160;&#160;isCalcDocument&#160;=&#160;True<br/>&#160; End If<br/>&#160;&#160;ErrorJumpPoint:<br/>End Function<br/>
An interface&#160;defines&#160;a&#160;series&#160;of methods. If&#160;an object&#160;implements&#160;an interface, it&#160;implements&#160;every&#160;method&#160;<br/>defined&#160;by&#160;that&#160;interface.&#160;A&#160;service&#160;defines&#160;an object&#160;by&#160;specifying the&#160;interfaces&#160;that&#160;it&#160;implements, the&#160;<br/>properties&#160;that&#160;it&#160;contains, and the&#160;other services&#160;that&#160;it&#160;exports.&#160;A&#160;service&#160;indirectly&#160;specifies&#160;the&#160;<br/>implemented methods&#160;by&#160;specifying interfaces.&#160;The&#160;interfaces&#160;supported by&#160;Calc&#160;documents&#160;provide&#160;a&#160;good&#160;<br/>overview&#160;of the&#160;provided functionality&#160;(see<a href="libremacros.html#456">&#160;Table&#160;160)</a>.<br/>
452<br/>
<hr/>
<a name=456></a><i><b>Table&#160;160.</b>&#160;Some&#160;interfaces&#160;supported by&#160;Calc&#160;documents.</i><br/>
<i><b>Service</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.document.XActionLockable<br/>
Temporarily&#160;lock&#160;the&#160;document&#160;from&#160;user&#160;interaction&#160;and&#160;automatic&#160;cell<br/>
updates. Locking&#160;an object&#160;makes it&#160;possible&#160;to prevent&#160;internal&#160;object&#160;<br/>updates while&#160;you quickly&#160;change&#160;multiple&#160;parts&#160;of&#160;the&#160;objects&#160;that&#160;<br/>
might&#160;temporarily&#160;invalidate&#160;each other.<br/>
com.sun.star.drawing.XDrawPagesSupplier<br/>
Access all&#160;draw&#160;pages in this document;&#160;there&#160;is&#160;one&#160;draw&#160;page&#160;for&#160;each<br/>
contained&#160;sheet.<br/>
com.sun.star.sheet.XCalculatable<br/>
Control&#160;automatic&#160;calculation of&#160;cells.<br/>
com.sun.star.sheet.XConsolidatable<br/>
Perform&#160;data&#160;consolidation.<br/>
com.sun.star.sheet.XGoalSeek<br/>
Perform&#160;a&#160;“Goal&#160;Seek”&#160;for&#160;a&#160;cell.<br/>
com.sun.star.sheet.XSpreadsheetDocument<br/>
Access the&#160;contained&#160;spreadsheets.<br/>
com.sun.star.style.XStyleFamiliesSupplier<br/>
Access the&#160;contained&#160;styles&#160;by&#160;type.<br/>
com.sun.star.util.XNumberFormatsSupplier<br/>
Access the&#160;number&#160;formats.<br/>
com.sun.star.util.XProtectable<br/>
Protect&#160;and&#160;unprotect&#160;the&#160;document.<br/>
The&#160;createNewCalcDoc&#160;function is&#160;used to&#160;create&#160;a&#160;new&#160;empty&#160;Calc&#160;document.&#160;This&#160;method is&#160;used by&#160;other<br/>methods&#160;in this&#160;chapter.<br/>
<i><b>Listing&#160;403.</b>&#160;Create&#160;a new&#160;Calc&#160;document.<br/></i>Function&#160;createNewCalcDoc<br/>&#160;&#160;Dim&#160;noArgs()&#160; &#160; &#160; &#160; &#160;&#160;'An empty array for the arguments<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160; &#160;&#160;'URL of the document to load<br/>&#160;&#160;Dim&#160;oDoc<br/>
&#160;&#160;sURL&#160;=&#160;&#34;private:factory/scalc&#34;<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.LoadComponentFromUrl(sURL,&#160;&#34;_blank&#34;,&#160;0,&#160;noArgs())<br/>&#160;&#160;createNewCalcDoc&#160;=&#160;oDoc<br/>End&#160;Function<br/>
<i><b>&#160;15.1.&#160;Accessing&#160;sheets<br/></b></i>The&#160;primary&#160;purpose&#160;of a&#160;spreadsheet&#160;document&#160;is&#160;to&#160;act&#160;as&#160;a&#160;container for individual&#160;sheets&#160;through the&#160;<br/>XSpreadsheetDocument&#160;interface.&#160;The&#160;XSpreadsheetDocument&#160;interface&#160;defines&#160;the&#160;single&#160;method&#160;<br/>getSheets() that&#160;returns&#160;a&#160;Spreadsheets&#160;object&#160;used to&#160;manipulate&#160;the&#160;individual&#160;sheets&#160;(see<a href="libremacros.html#456">&#160;Listing 404)</a>.<br/>
<i><b>Listing&#160;404.</b>&#160;Obtain a com.sun.star.sheet.Spreadsheets&#160;service&#160;using&#160;a method or&#160;a property.<br/></i>ThisComponent.getSheets()&#160;'Method defined by XSpreadsheetDocument interface.&#160;<br/>ThisComponent.Sheets&#160; &#160; &#160;&#160;'Property of the spreadsheet document.<br/>
The&#160;Spreadsheet&#160;service&#160;allows&#160;the&#160;individual&#160;sheets&#160;to&#160;be&#160;returned by&#160;index,&#160;by&#160;enumeration, and by&#160;name&#160;<br/>(see<a href="libremacros.html#457">&#160;Table&#160;161)</a>.&#160;The&#160;Spreadsheets&#160;service&#160;also allows&#160;sheets&#160;to be&#160;created,&#160;moved, and deleted. Many&#160;of the&#160;<br/>methods&#160;shown i<a href="libremacros.html#457">n&#160;Table&#160;161&#160;a</a>re&#160;demonstrated in<a href="libremacros.html#457">&#160;Listing 405.</a><br/>
453<br/>
<hr/>
<a name=457></a><i><b>Table&#160;161.</b>&#160;Methods&#160;implemented by&#160;the&#160;com.sun.star.sheet.Spreadsheets&#160;service.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
copyByName(&#160;srcName,&#160;destName, index&#160;)<br/>
Copy&#160;the&#160;sheet&#160;named srcName&#160;to the&#160;specified&#160;index&#160;and&#160;name&#160;it&#160;<br/>
destName.<br/>
createEnumeration()<br/>
Create&#160;an&#160;object&#160;that&#160;enumerates the&#160;spreadsheets.<br/>
getByIndex(index)<br/>
Obtain&#160;a&#160;spreadsheet&#160;based on the&#160;sheet’s&#160;index.<br/>
getByName(name)<br/>
Obtain&#160;a&#160;spreadsheet&#160;based on the&#160;sheet’s&#160;name.<br/>
getCount()<br/>
Return the&#160;number&#160;of&#160;sheets as a&#160;Long&#160;Integer.<br/>
hasByName(name)<br/>
Return&#160;True&#160;if&#160;the&#160;named spreadsheet&#160;exits.<br/>
hasElements()<br/>
Return&#160;True&#160;if&#160;the&#160;document&#160;contains&#160;at&#160;least&#160;one&#160;spreadsheet.<br/>
insertNewByName(name,&#160;index)<br/>
Create&#160;a&#160;new&#160;spreadsheet&#160;and&#160;insert&#160;it&#160;at&#160;the&#160;specified&#160;location with the&#160;<br/>
supplied&#160;name.<br/>
moveByName(name,&#160;index)<br/>
Move&#160;the&#160;named&#160;spreadsheet&#160;to the&#160;specified index.<br/>
removeByName(name)<br/>
Remove&#160;the&#160;named spreadsheet.<br/>
<i><b>Listing&#160;405.</b>&#160;Manipulate&#160;sheets&#160;in a Calc&#160;document.</i><br/>
Sub&#160;AccessSheets<br/>&#160;&#160;Dim&#160;oSheets&#160; &#160; &#160; &#160;'The sheets object that contains all of the sheets<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;'Individual sheet<br/>&#160;&#160;Dim&#160;oSheetEnum&#160; &#160;&#160;'For accessing by enumeration<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160;'String variable to hold temporary data<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;oDoc<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;createNewCalcDoc()<br/>&#160;&#160;oSheets&#160;=&#160;oDoc.Sheets<br/>&#160;&#160;<br/>&#160;&#160;REM Insert new sheet as the second sheet.<br/>&#160;&#160;oSheets.insertNewByName(&#34;CreatedSheet&#34;,&#160;1)<br/>&#160;&#160;<br/>&#160;&#160;REM Create a new sheet named &#34;First&#34; at the start.<br/>&#160;&#160;oSheets.insertNewByName(&#34;First&#34;,&#160;0)<br/>
&#160;&#160;REM Verify that the sheet named &#34;Sheet3&#34; exists<br/>&#160;&#160;If&#160;oSheets.hasbyName(&#34;Sheet3&#34;)&#160;Then<br/>&#160; &#160;&#160;oSheet&#160;=&#160;oSheets.getByName(&#34;Sheet3&#34;)<br/>&#160; &#160;&#160;oSheet.getCellByPosition(0,&#160;0).setString(&#34;Test&#34;)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Copy &#34;Sheet3&#34; to the end. That is copy, not move!<br/>&#160; &#160;&#160;oSheets.copyByName(&#34;Sheet3&#34;,&#160;&#34;Copy1&#34;,&#160;oSheets.getCount())<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;If&#160;oSheets.hasbyName(&#34;Sheet1&#34;)&#160;Then<br/>&#160; &#160;&#160;oSheets.removeByName(&#34;Sheet1&#34;)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;<br/>
454<br/>
<hr/>
<a name=458></a>&#160;&#160;REM The sheets are indexed starting at zero, but getCount() indicates<br/>&#160;&#160;REM exactly how many sheets there are.<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oSheets.getCount()-1<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Sheet &#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;oSheets.getByIndex(i).Name&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;Msgbox&#160;s,&#160;0,&#160;&#34;After Inserting New Sheets&#34;<br/>&#160;&#160;<br/>&#160;&#160;REM Now remove the new sheets that I inserted<br/>&#160;&#160;oSheets.removeByName(&#34;First&#34;)<br/>&#160;&#160;oSheets.removeByName(&#34;Copy1&#34;)<br/>
&#160;&#160;s&#160;=&#160;&#34;&#34;&#160;:&#160;i&#160;=&#160;0<br/>&#160;&#160;oSheetEnum&#160;=&#160;oSheets.createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oSheetEnum.hasMoreElements()<br/>&#160; &#160;&#160;oSheet&#160;=&#160;oSheetEnum.nextElement()<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Sheet &#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;oSheet.Name&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;i&#160;=&#160;i&#160;+&#160;1<br/>&#160;&#160;Loop<br/>&#160;&#160;Msgbox&#160;s,&#160;0,&#160;&#34;After Deleting Sheets&#34;<br/>End&#160;Sub<br/>
<i><b>&#160;15.2.&#160;Sheet&#160;cells&#160;contain&#160;the&#160;data<br/></b></i>A&#160;spreadsheet&#160;document&#160;contains&#160;individual&#160;sheets&#160;that&#160;are&#160;composed&#160;of rows&#160;and columns&#160;of cells.&#160;Each&#160;<br/>column&#160;is&#160;labeled&#160;alphabetically&#160;starting with&#160;the&#160;letter&#160;A, and each row&#160;is&#160;labeled numerically&#160;starting with&#160;<br/>the&#160;number 1.&#160;A&#160;cell&#160;can be&#160;identified by&#160;its&#160;name,&#160;which uses&#160;the&#160;column letter and the&#160;row&#160;number,&#160;or by&#160;<br/>its&#160;position.&#160;The&#160;upper-left&#160;cell&#160;is&#160;“A1”&#160;at&#160;position (0, 0) and cell&#160;“B3”&#160;is&#160;at&#160;location (1, 2).&#160;<br/>
The&#160;Calc&#160;user interface&#160;identifies&#160;cells&#160;with&#160;names&#160;such as&#160;“Sheet2.D5”.&#160;A&#160;cell, on the&#160;other hand, identifies&#160;<br/>itself by&#160;the&#160;row&#160;and column offset, which requires&#160;a&#160;bit&#160;of work to&#160;turn into&#160;human-readable&#160;form.&#160;The&#160;<br/>CellAddressConversion&#160;service&#160;converts&#160;a&#160;cell&#160;address&#160;into human&#160;readable&#160;form.&#160;The&#160;<br/>CellAddressConversion&#160;service&#160;is&#160;not&#160;yet&#160;documented,&#160;so I&#160;performed&#160;some&#160;tests.&#160;When&#160;a&#160;cell&#160;address&#160;is&#160;<br/>assigned to&#160;the&#160;Address&#160;property&#160;(See<a href="libremacros.html#458">&#160;Listing 406)</a>, the&#160;PersistentRepresentation property&#160;is&#160;set&#160;to&#160;the&#160;full&#160;<br/>cell&#160;name&#160;including the&#160;sheet&#160;name.&#160;The&#160; UserInterfaceRepresentation&#160;property,&#160;however,&#160;contains&#160;the&#160;sheet&#160;<br/>name&#160;only&#160;if the&#160;cell&#160;is&#160;not&#160;contained in&#160;the&#160;active&#160;sheet.<br/>
<i><b>Listing&#160;406.</b>&#160;Obtain the&#160;cell&#160;name&#160;using the&#160;CellAddressConversion&#160;service.</i><br/>
&#160;&#160;Dim&#160;oConv<br/>&#160;&#160;Dim&#160;oCell<br/>&#160;&#160;oConv&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.table.CellAddressConversion&#34;)<br/>&#160;&#160;oCell&#160;=&#160;ThisComponent.Sheets(2).getCellByPosition(0,&#160;0)&#160;'Cell A1<br/>&#160;&#160;oConv.Address&#160;=&#160;oCell.getCellAddress()<br/>&#160;&#160;Print&#160;oConv.UserInterfaceRepresentation&#160; &#160;'A1<br/>&#160;&#160;print&#160;oConv.PersistentRepresentation&#160; &#160; &#160;&#160;'Sheet1.A1<br/>
I&#160;had difficulty&#160;with&#160;the&#160;CellAddressConversion service,&#160;so I&#160;opted to&#160;write&#160;my&#160;own.&#160;The&#160;following method&#160;<br/>accepts&#160;the&#160;sheet&#160;number,&#160;column,&#160;and row,&#160;and returns&#160;an address.&#160;The&#160;“cheat”&#160;that&#160;I&#160;used, is&#160;to assume&#160;that<br/>the&#160;sheet&#160;name&#160;is&#160;formatted as&#160;Sheet1, Sheet2,&#160;etc.&#160;This&#160;is&#160;trivial&#160;to&#160;change, but&#160;I&#160;opted to&#160;not&#160;do it.&#160;The&#160;only<br/>tricky&#160;part&#160;is&#160;to&#160;understand that&#160;columns&#160;are&#160;labeled using Base&#160;26 where&#160;the&#160;digits&#160;are&#160;A-Z&#160;and not&#160;0-9;&#160;and&#160;<br/>being enough of a&#160;technical&#160;person to&#160;understand what&#160;that&#160;means.<br/>
<i><b>Listing&#160;407.</b>&#160;Format&#160;a single&#160;cell&#160;address&#160;assuming all&#160;sheets&#160;are&#160;named Sheet.</i><br/>
Function&#160;AddressString(iSheet&#160;As&#160;Long,&#160;iCol&#160;As&#160;Long,&#160;iRow&#160;As&#160;Long,&#160;bWwithSheet&#160;As&#160;Boolean)<br/>&#160;&#160;Dim&#160;s$<br/>
455<br/>
<hr/>
<a name=459></a>&#160;&#160;iCol&#160;=&#160;iCol&#160;+&#160;1<br/>&#160; Do<br/>&#160; &#160;&#160;iCol&#160;=&#160;iCol&#160;-&#160;1<br/>&#160; &#160;&#160;s&#160;= CHR$((iCol&#160;MOD&#160;26) +&#160;65) &amp;&#160;s<br/>&#160; &#160;&#160;&#160;iCol&#160;=&#160;iCol&#160;\&#160;26&#160;-&#160;1<br/>&#160;&#160;Loop&#160;Until&#160;iCol&#160;&lt;&#160;0<br/>&#160;&#160;If&#160;bWwithSheet&#160;&#160;Then<br/>&#160; &#160;&#160;AddressString&#160;=&#160;&#34;Sheet&#34;&#160;&amp;&#160;CStr(iSheet&#160;+&#160;1)&#160;&#160;&amp;&#160;&#34;.&#34;&#160;&amp;&#160;s&#160;&amp;&#160;CStr(iRow&#160;+&#160;1)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;AddressString&#160;=&#160;s&#160;&amp;&#160;CStr(iRow&#160;+&#160;1)<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
This&#160;next&#160;function&#160;accepts&#160;a&#160;range&#160;address.&#160;<br/>
<i><b>Listing&#160;408.</b>&#160;Format&#160;a single&#160;range&#160;address&#160;assuming all&#160;sheets&#160;are&#160;named Sheet.</i><br/>
Function&#160;prettyRangeAddressName(oRangeAddr)<br/>&#160;&#160;Dim&#160;s1$,&#160;s2$<br/>&#160;&#160;Dim&#160;oConv<br/>&#160;&#160;Dim&#160;oCellAddr&#160;As&#160;New&#160;com.sun.star.table.CellAddress<br/>&#160;&#160;<br/>&#160;&#160;s1&#160;=&#160;AddressString(oRangeAddr.Sheet,&#160;oRangeAddr.StartColumn,&#160;oRangeAddr.StartRow,&#160;True)<br/>&#160;&#160;s2&#160;=&#160;AddressString(oRangeAddr.Sheet,&#160;oRangeAddr.EndColumn,&#160;oRangeAddr.EndRow,&#160;False)<br/>&#160;&#160;prettyRangeAddressName&#160;=&#160;s1&#160;&amp;&#160;&#34;:&#34;&#160;&amp;&#160;s2<br/>End&#160;Function<br/>
<b>&#160;15.2.1.&#160;Cell&#160;address<br/></b>In&#160;OOo, a&#160;cell’s&#160;address&#160;is&#160;specified&#160;by&#160;the&#160;sheet&#160;that&#160;contains&#160;the&#160;cell, and the&#160;row&#160;and column in&#160;which&#160;the&#160;<br/>cell&#160;is&#160;located.&#160;OOo encapsulates&#160;a&#160;cell’s&#160;address&#160;in a&#160;CellAddress&#160;structure&#160;(see<a href="libremacros.html#459">&#160;Table&#160;162)</a>.&#160;The&#160;<br/>CellAddress&#160;structure&#160;is&#160;available&#160;directly&#160;from&#160;a&#160;cell&#160;and it&#160;is&#160;also used as&#160;an argument&#160;to&#160;numerous&#160;object&#160;<br/>methods.<br/>
<i><b>Table&#160;162.</b>&#160;Properties&#160;of&#160;the&#160;com.sun.star.table.CellAddress&#160;structure.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Sheet<br/>
Short&#160;Integer&#160;index&#160;of&#160;the&#160;sheet&#160;that&#160;contains the&#160;cell.<br/>
Column<br/>
Long Integer&#160;index&#160;of&#160;the&#160;column&#160;where&#160;the&#160;cell&#160;is located.<br/>
Row<br/>
Long Integer&#160;index&#160;of&#160;the&#160;row&#160;where&#160;the&#160;cell&#160;is&#160;located.<br/>
<b>&#160;15.2.2.&#160;Cell&#160;data<br/></b>A&#160;cell&#160;can contain four types&#160;of data.&#160;Use&#160;the&#160;method getType()&#160;to&#160;find out&#160;the&#160;type&#160;of data&#160;that&#160;it&#160;contains.&#160;A<br/>cell&#160;that&#160;contains&#160;no data&#160;is&#160;considered empty.&#160;A&#160;cell&#160;can contain&#160;a&#160;floating-point&#160;Double&#160;value. Use&#160;the&#160;<br/>object&#160;methods&#160;getValue() and setValue(Double) to&#160;get&#160;and set&#160;a&#160;cell’s&#160;value.&#160;<br/>
<b>Tip</b><br/>
If&#160;the&#160;cell&#160;contains a&#160;formula, you can still&#160;determine&#160;the&#160;type&#160;of&#160;data&#160;that&#160;is stored&#160;in the&#160;cell&#160;from&#160;the&#160;<br/>FormulaResultType&#160;property&#160;shown i<a href="libremacros.html#465">n&#160;Table&#160;166.</a><br/>
A&#160;cell&#160;can contain textual&#160;data.&#160;The&#160;standard method of getting and setting textual&#160;data&#160;is&#160;to&#160;use&#160;the&#160;methods&#160;<br/>getString() and setString(String).&#160;The&#160;real&#160;story,&#160;however,&#160;is&#160;that&#160;the&#160;com.sun.star.table.Cell&#160;service&#160;<br/>
456<br/>
<hr/>
<a name=460></a>implements&#160;the&#160;com.sun.star.text.XText&#160;interface.&#160;The&#160;XText&#160;interface&#160;is&#160;the&#160;primary&#160;text&#160;interface&#160;used in&#160;<br/>Writer documents,&#160;and it&#160;allows&#160;individual&#160;cells&#160;to contain very&#160;complex&#160;data.<br/>
<b>Tip</b><br/>
Sheet&#160;cells support&#160;the&#160;com.sun.star.text.XText&#160;interface.&#160;It&#160;should come&#160;as no surprise,&#160;therefore,&#160;that&#160;cells<br/>
also&#160;support&#160;the&#160;com.sun.star.text.XTextFieldsSupplier&#160;interface&#160;—&#160;in case&#160;you want&#160;to&#160;insert&#160;special&#160;text&#160;<br/>fields into a&#160;cell.<br/>
A&#160;cell&#160;can contain a&#160;formula.&#160;The&#160;methods&#160;getFormula() and setFormula(String) get&#160;and set&#160;a&#160;cell’s&#160;formula.&#160;<br/>To&#160;determine&#160;if a&#160;formula&#160;contains&#160;an error,&#160;use&#160;the&#160;getError() method&#160;—&#160;the&#160;Long Integer return value&#160;is&#160;<br/>zero if there&#160;is&#160;no error.&#160;The&#160;macro in<a href="libremacros.html#460">&#160;Listing 409&#160;de</a>monstrates&#160;how&#160;to inspect&#160;a&#160;cell’s&#160;type.<br/>
<b>Tip</b><br/>
When&#160;setting&#160;a&#160;cell’s&#160;formula,&#160;you&#160;must&#160;include&#160;the&#160;leading&#160;equals&#160;sign (=)&#160;and the&#160;formula&#160;must&#160;be&#160;in&#160;<br/>
English.&#160;To&#160;set&#160;a&#160;formula&#160;using&#160;your&#160;own&#160;local&#160;language,&#160;use&#160;the&#160;FormulaLocal&#160;property&#160;shown&#160;i<a href="libremacros.html#465">n&#160;Table&#160;<br/>166.</a><br/>
<i><b>Listing&#160;409.</b>&#160;Get&#160;a string representation of&#160;the&#160;cell&#160;type.<br/></i>Function&#160;GetCellType(oCell)&#160;As&#160;String<br/>&#160;&#160;Select&#160;Case&#160;oCell.getType()&#160;<br/>&#160;&#160;Case&#160;com.sun.star.table.CellContentType.EMPTY<br/>&#160; &#160;&#160;GetCellType&#160;=&#160;&#34;Empty&#34;<br/>&#160;&#160;Case&#160;com.sun.star.table.CellContentType.VALUE<br/>&#160; &#160;&#160;GetCellType&#160;=&#160;&#34;Value&#34;<br/>&#160;&#160;Case&#160;com.sun.star.table.CellContentType.TEXT<br/>&#160; &#160;&#160;GetCellType&#160;=&#160;&#34;Text&#34;<br/>&#160;&#160;Case&#160;com.sun.star.table.CellContentType.FORMULA<br/>&#160; &#160;&#160;GetCellType&#160;=&#160;&#34;Formula&#34;<br/>&#160;&#160;Case&#160;Else<br/>&#160; &#160;&#160;GetCellType&#160;=&#160;&#34;Unknown&#34;<br/>&#160;&#160;End&#160;Select&#160;<br/>End&#160;Function<br/>
<a href="libremacros.html#460">Listing 410&#160;de</a>monstrates&#160;how&#160;to get&#160;and set&#160;information&#160;in a&#160;cell.&#160;A&#160;numeric&#160;value,&#160;a&#160;string, and a&#160;formula&#160;<br/>are&#160;set&#160;in&#160;a&#160;cell.&#160;After setting&#160;each type, information&#160;is&#160;printed about&#160;the&#160;cell&#160;(see<a href="libremacros.html#461">&#160;Figure&#160;97)</a>.&#160;The&#160;macro i<a href="libremacros.html#460">n<br/>Listing 410&#160;i</a>s&#160;very&#160;simple&#160;but&#160;it&#160;demonstrates&#160;some&#160;very&#160;important&#160;behavior.&#160;Inspect&#160;the&#160;output&#160;i<a href="libremacros.html#461">n&#160;Figure&#160;97&#160;<br/></a>to see&#160;what&#160;is&#160;returned by&#160;getString(), getValue(), and getFormula() for each different&#160;cell&#160;content&#160;type.<br/>
<i><b>Listing&#160;410.</b>&#160;Get&#160;cell&#160;information.</i><br/>
Function&#160;SimpleCellInfo(oCell)&#160;As&#160;String<br/>&#160;&#160;SimpleCellInfo&#160;=&#160;oCell.AbsoluteName&#160;&amp;&#160;&#34; has type &#34;&#160;&amp;_<br/>&#160; &#160; &#160;&#160;GetCellType(oCell)&#160;&amp;&#160;&#34; String(&#34;&#160;&amp;&#160;oCell.getString()&#160;&amp;&#160;&#34;) Value(&#34;&#160;&amp;_<br/>&#160; &#160; &#160;&#160;oCell.getValue()&#160; &#160;&amp;&#160;&#34;) Formula(&#34;&#160;&amp;&#160;oCell.getFormula()&#160;&amp;&#160;&#34;)&#34;<br/>End&#160;Function<br/>
Sub&#160;GetSetCells<br/>&#160;&#160;Dim&#160;oCell<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dim&#160;oDoc<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;createNewCalcDoc()<br/>
&#160;&#160;oCell&#160;=&#160;oDoc.Sheets(0).getCellByPosition(0,&#160;0)&#160;'Cell A1<br/>
457<br/>
<hr/>
<a name=461></a>&#160;&#160;oCell.setString(&#34;Andy&#34;)<br/>&#160;&#160;oCell&#160;=&#160;oDoc.Sheets(0).getCellByPosition(104,&#160;0)&#160;'Cell DA1<br/>&#160;&#160;s&#160;=&#160;SimpleCellInfo(oCell)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;oCell.setValue(23.2)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;SimpleCellInfo(oCell)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;oCell.setString(&#34;4&#34;)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;SimpleCellInfo(oCell)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;oCell.setFormula(&#34;=A1&#34;)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;SimpleCellInfo(oCell)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;oCell.setFormula(&#34;&#34;)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;SimpleCellInfo(oCell)&#160;&amp;&#160;CHR$(10)<br/>&#160; MsgBox&#160;s,&#160;0,&#160;&#34;Cell Values And Types&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;97.</b>&#160;Values&#160;returned by&#160;getType(),&#160;getString(), getValue(),&#160;and getFormula()&#160;for&#160;different&#160;</i><br/>
<i>types&#160;of&#160;content.</i><br/>
<b>Tip</b><br/>
The&#160;methods getString()&#160;and getFormula()&#160;return relevant&#160;values even when the&#160;cell&#160;type&#160;is not&#160;String&#160;or&#160;<br/>Formula&#160;(see<a href="libremacros.html#461">&#160;Figure&#160;97)</a>.&#160;Notice&#160;also that&#160;setting&#160;a&#160;string&#160;value&#160;of&#160;4&#160;does not&#160;set&#160;a&#160;numeric&#160;value, and&#160;the&#160;<br/>
formula&#160;even&#160;shows a&#160;single&#160;quotation mark in front&#160;of&#160;the&#160;“4”.&#160;This&#160;provides a&#160;pretty&#160;good&#160;clue&#160;that&#160;you&#160;<br/>can also&#160;do&#160;things such as setFormula(&#34;'I&#160;am&#160;text&#34;)&#160;to set&#160;text.<br/>
<b>&#160;15.2.3.&#160;Cell&#160;properties<br/></b>Cells&#160;contained&#160;in a&#160;sheet&#160;are&#160;defined by&#160;the&#160;com.sun.star.sheet.SheetCell&#160;service, which&#160;supports&#160;numerous&#160;<br/>properties&#160;for formatting the&#160;cell&#160;contents.&#160;Given that&#160;a&#160;cell&#160;also supports&#160;the&#160;Text&#160;service, it&#160;is&#160;of no surprise<br/>that&#160;it&#160;also supports&#160;properties&#160;related to&#160;text&#160;content:&#160;CharacterProperties,&#160;CharacterPropertiesAsian,&#160;<br/>CharacterPropertiesComplex,&#160;and ParagraphProperties.&#160;There&#160;are&#160;also&#160;cell-specific&#160;properties&#160;such as&#160;setting<br/>border lines.&#160;You specify&#160;the&#160;border lines&#160;for cells&#160;by&#160;using a&#160;BorderLine&#160;structure&#160;as&#160;shown i<a href="libremacros.html#461">n&#160;Table&#160;163.&#160;<br/></a>The&#160;BorderLine&#160;structure&#160;defines&#160;how&#160;a&#160;single&#160;border line&#160;is&#160;displayed, and the&#160;TableBorder structure&#160;<br/>defines&#160;how&#160;the&#160;lines&#160;in&#160;a&#160;given range&#160;are&#160;displayed (see<a href="libremacros.html#462">&#160;Table&#160;164)</a>.<br/>
<i><b>Table&#160;163.</b>&#160;Properties&#160;of&#160;the&#160;com.sun.star.table.BorderLine&#160;structure.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Color<br/>
Line&#160;color&#160;as a&#160;Long Integer.<br/>
InnerLineWidth<br/>
Width of&#160;the&#160;inner&#160;part&#160;of&#160;a&#160;double&#160;line&#160;(in 0.01 mm)&#160;as a&#160;Short&#160;Integer&#160;—&#160;zero for&#160;a&#160;single&#160;line.<br/>
OuterLineWidth<br/>
Width of&#160;a&#160;single&#160;line,&#160;or&#160;width&#160;of&#160;the&#160;outer&#160;part&#160;of&#160;a&#160;double&#160;line&#160;(in 0.01&#160;mm)&#160;as a&#160;Short&#160;Integer.<br/>
LineDistance<br/>
Distance&#160;between&#160;the&#160;inner&#160;and outer&#160;parts of&#160;a&#160;double&#160;line&#160;(in 0.01&#160;mm)&#160;as a&#160;Short&#160;Integer.<br/>
458<br/>
<hr/>
<a name=462></a><i><b>Table&#160;164.</b>&#160;Properties&#160;of&#160;the&#160;com.sun.star.table.TableBorder&#160;structure.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
TopLine<br/>
Line&#160;style&#160;at&#160;the&#160;top&#160;edge&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
IsTopLineValid<br/>
If&#160;True,&#160;the&#160;TopLine&#160;is&#160;used when setting&#160;values.<br/>
BottomLine&#160;<br/>
Line&#160;style&#160;at&#160;the&#160;bottom&#160;edge&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
IsBottomLineValid<br/>
If&#160;True,&#160;the&#160;BottomLine&#160;is used when setting&#160;values.<br/>
LeftLine<br/>
Line&#160;style&#160;at&#160;the&#160;left&#160;edge&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
IsLeftLineValid<br/>
If&#160;True,&#160;the&#160;LeftLine&#160;is&#160;used&#160;when&#160;setting&#160;values.<br/>
RightLine<br/>
Line&#160;style&#160;at&#160;the&#160;right&#160;edge&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
IsRightLineValid<br/>
If&#160;True,&#160;the&#160;RightLine&#160;is&#160;used when setting&#160;values.<br/>
HorizontalLine<br/>
Line&#160;style&#160;for&#160;horizontal&#160;lines between cells (see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
IsHorizontalLineValid<br/>
If&#160;True,&#160;the&#160;HorizontalLine&#160;is used&#160;when&#160;setting&#160;values.<br/>
VerticalLine&#160;<br/>
Line&#160;style&#160;for&#160;vertical&#160;lines between&#160;cells (see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
IsVerticalLineValid<br/>
If&#160;True,&#160;the&#160;VerticalLine&#160;is&#160;used&#160;when&#160;setting&#160;values.<br/>
Distance<br/>
Distance&#160;between the&#160;lines and other&#160;contents as a&#160;Short&#160;Integer.<br/>
IsDistanceValid<br/>
If&#160;True,&#160;the&#160;Distance&#160;is used when setting&#160;values.<br/>
When&#160;setting values&#160;in a&#160;TableBorder structure, not&#160;all&#160;values&#160;are&#160;always&#160;required. For&#160;example, when using&#160;<br/>a&#160;TableBorder structure&#160;to&#160;configure&#160;a&#160;cell’s&#160;border,&#160;the&#160;individual&#160;values&#160;are&#160;used only&#160;if the&#160;corresponding&#160;<br/>“Is...Valid”&#160;property&#160;is&#160;set.&#160;This&#160;provides&#160;the&#160;ability&#160;to&#160;set&#160;a&#160;single&#160;value&#160;and leave&#160;the&#160;other values&#160;<br/>unchanged. If, on the&#160;other hand, a&#160;TableBorder structure&#160;is&#160;obtained by&#160;using a&#160;query&#160;(meaning you&#160;get&#160;the&#160;<br/>value), the&#160;flags&#160;indicate&#160;that&#160;not&#160;all&#160;lines&#160;use&#160;the&#160;same&#160;value.&#160;<br/>
Consider the&#160;following macro that&#160;sets&#160;all&#160;four borders&#160;on a&#160;single&#160;range.&#160;<br/>
<i><b>Listing&#160;411.</b>&#160;Add cell&#160;borders.</i><br/>
Sub&#160;SetCalcBorder<br/>&#160;&#160;Dim&#160;oDoc<br/>&#160;&#160;Dim&#160;oSheet<br/>&#160;&#160;Dim&#160;oCells<br/>&#160;&#160;Dim&#160;oBorder<br/>
&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#34;private:factory/scalc&#34;,&#160;&#34;_default&#34;,&#160;0,&#160;Array())<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets(0)<br/>&#160;&#160;oCells&#160;=&#160;oSheet.getCellRangeByName(&#34;B2:C6&#34;)<br/>&#160;&#160;<br/>&#160;&#160;' Create the structure so that I know the values<br/>&#160;&#160;' are all zero.<br/>&#160;&#160;oBorder&#160;=&#160;CreateUnoStruct(&#34;com.sun.star.table.BorderLine&#34;)<br/>&#160;&#160;' If you want to modify an existing border, copy it.<br/>&#160;&#160;'oBorder = oCells.LeftBorder<br/>&#160;&#160;<br/>&#160;&#160;' Set color to red.<br/>&#160;&#160;oBorder.Color&#160;=&#160;RGB(199,&#160;50,&#160;0)<br/>&#160;&#160;oBorder.OuterLineWidth&#160;=&#160;35<br/>&#160;&#160;oCells.LeftBorder&#160;=&#160;oBorder<br/>
459<br/>
<hr/>
<a name=463></a>&#160;&#160;' Set color to blue. &#160;<br/>&#160;&#160;oBorder.Color&#160;=&#160;RGB(0,&#160;102,&#160;199)<br/>&#160;&#160;oBorder.InnerLineWidth&#160;=&#160;35<br/>&#160;&#160;<br/>&#160; &#160;&#160;<br/>&#160;&#160;oCells.TopBorder&#160;=&#160;oBorder<br/>&#160;&#160;oBorder.LineDistance&#160;=&#160;35<br/>&#160;&#160;oCells.RightBorder&#160;=&#160;oBorder<br/>&#160;&#160;oCells.BottomBorder&#160;=&#160;oBorder<br/>&#160;&#160;<br/>&#160;&#160;oBorder&#160;=&#160;oSheet.getCellRangeByName(&#34;C2&#34;).LeftBorder<br/>&#160;&#160;Print&#160;&#34;Red portion of border = &#34;&#160;&amp;&#160;Red(oBorder.Color)<br/>End&#160;Sub<br/>
<i><b>Figure&#160;98.</b>&#160;Cells&#160;with borders.</i><br/>
Please&#160;note&#160;the&#160;following:<br/>
•<br/>
The&#160;BorderLine&#160;structure&#160;is&#160;copied&#160;by&#160;value, not&#160;reference.&#160;To&#160;modify&#160;the&#160;structure, therefore, you&#160;<br/>must&#160;copy&#160;the&#160;structure&#160;to&#160;a&#160;variable,&#160;modify&#160;the&#160;variable,&#160;and then&#160;copy&#160;the&#160;structure&#160;back to the&#160;<br/>left, right,&#160;top,&#160;or bottom&#160;border.<br/>
•<br/>
You can set&#160;borders&#160;on a&#160;cell&#160;range&#160;as&#160;well&#160;as&#160;an individual&#160;cell.<br/>
•<br/>
Although the&#160;left&#160;border on cell&#160;B2 and C2 are&#160;both a&#160;red line, the&#160;red line&#160;is&#160;not&#160;shown in&#160;cell&#160;C2&#160;<br/>(see<a href="libremacros.html#463">&#160;&#160;Figure&#160;98)</a>. How&#160;does&#160;OOo decide&#160;which border should&#160;be&#160;used right&#160;or left,&#160;top&#160;or bottom?&#160;<br/>Although the&#160;behavior is&#160;not&#160;documented, the&#160;following precedence&#160;was&#160;observed:&#160;<br/>
◦<br/>
A&#160;border with&#160;a&#160;line&#160;distance&#160;is&#160;more&#160;important&#160;than a&#160;border without&#160;a&#160;line&#160;distance.<br/>
◦<br/>
Top and left&#160;borders&#160;are&#160;more&#160;important&#160;than right&#160;or bottom&#160;borders.<br/>
<a href="libremacros.html#463">Table&#160;165&#160;c</a>ontains&#160;cell-specific&#160;properties.&#160;Cell&#160;properties&#160;use&#160;the&#160;TableBorder structure&#160;to&#160;set&#160;the&#160;border&#160;<br/>types.<br/>
<i><b>Table&#160;165.</b>&#160;Properties&#160;supported by&#160;the&#160;com.sun.star.table.CellProperties&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
CellStyle<br/>
Optional&#160;property;&#160;the&#160;name&#160;of&#160;the&#160;style&#160;of&#160;the&#160;cell&#160;as a&#160;String.<br/>
CellBackColor<br/>
The&#160;cell&#160;background color&#160;as a&#160;Long&#160;Integer&#160;(see&#160;IsCellBackgroundTransparent).<br/>
IsCellBackgroundTransparent<br/>
If&#160;True, the&#160;cell&#160;background&#160;is transparent&#160;and&#160;the&#160;CellBackColor&#160;is&#160;ignored.<br/>
460<br/>
<hr/>
<a name=464></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
HoriJustify<br/>
The&#160;cell’s&#160;horizontal&#160;alignment&#160;as a&#160;com.sun.star.table.CellHoriJustify&#160;enum:<br/>•<br/>
STANDARD&#160;– Default&#160;alignment&#160;is left&#160;for&#160;numbers and right&#160;for&#160;text.<br/>
•<br/>
LEFT&#160;–&#160;Content&#160;is aligned&#160;to the&#160;cell’s&#160;left&#160;edge.<br/>
•<br/>
CENTER&#160;– Content&#160;is horizontally&#160;centered.<br/>
•<br/>
RIGHT&#160;– Content&#160;is aligned&#160;to the&#160;cell’s&#160;right&#160;edge.<br/>
•<br/>
BLOCK&#160;–&#160;Content&#160;is&#160;justified&#160;to the&#160;cell’s&#160;width (but&#160;this doesn’t&#160;seem&#160;to work).<br/>
•<br/>
REPEAT&#160;– Content&#160;is repeated&#160;to fill&#160;the&#160;cell.<br/>
VertJustify<br/>
The&#160;cell’s&#160;vertical&#160;alignment&#160;as a&#160;com.sun.star.table.CellVertJustify&#160;enum:<br/>•<br/>
STANDARD&#160;– Use&#160;the&#160;default.<br/>
•<br/>
TOP&#160;–&#160;Align&#160;to the&#160;upper&#160;edge&#160;of&#160;the&#160;cell.<br/>
•<br/>
CENTER&#160;–&#160;Align to the&#160;vertical&#160;middle&#160;of&#160;the&#160;cell.<br/>
•<br/>
BOTTOM –&#160;Align to&#160;the&#160;lower&#160;edge&#160;of&#160;the&#160;cell.<br/>
IsTextWrapped<br/>
If&#160;True, the&#160;cell’s&#160;content&#160;is automatically&#160;wrapped at&#160;the&#160;right&#160;border.<br/>
ParaIndent<br/>
The&#160;indentation of&#160;the&#160;cell’s&#160;content&#160;(in 0.01&#160;mm)&#160;as&#160;a&#160;Short&#160;Integer.<br/>
Orientation<br/>
If&#160;the&#160;RotateAngle&#160;is zero,&#160;this specifies the&#160;orientation of&#160;the&#160;cell’s&#160;content&#160;as an enum&#160;<br/>
of&#160;type&#160;com.sun.star.table.CellOrientation:<br/>•<br/>
STANDARD&#160;–&#160;The&#160;cell’s&#160;content&#160;is displayed&#160;from&#160;left&#160;to right.<br/>
•<br/>
TOPBOTTOM&#160;–&#160;The&#160;cell’s&#160;content&#160;is displayed&#160;from&#160;top&#160;to bottom.<br/>
•<br/>
BOTTOMTOP&#160;–&#160;The&#160;cell’s&#160;content&#160;is&#160;displayed&#160;from&#160;bottom&#160;to top.<br/>
•<br/>
STACKED&#160;–&#160;Same&#160;as&#160;TOPBOTTOM but&#160;each character&#160;is&#160;horizontal.<br/>
RotateAngle<br/>
Defines how&#160;much to rotate&#160;the&#160;cell’s&#160;content&#160;(in 0.01&#160;degrees)&#160;as a&#160;Long Integer.&#160;The&#160;<br/>
entire&#160;string&#160;is&#160;rotated&#160;as one&#160;unit&#160;rather&#160;than&#160;as individual&#160;characters.<br/>
RotateReference<br/>
Defines the&#160;edge&#160;where&#160;rotated&#160;cells are&#160;aligned&#160;using&#160;the&#160;same&#160;enum&#160;as&#160;VertJustify.<br/>
AsianVerticalMode<br/>
If&#160;True, only&#160;Asian characters use&#160;a&#160;vertical&#160;orientation. In&#160;other&#160;words, in&#160;Asian&#160;mode&#160;<br/>only&#160;Asian characters&#160;are&#160;printed&#160;in&#160;horizontal&#160;orientation if&#160;the&#160;Orientation property&#160;is&#160;<br/>
STACKED;&#160;for&#160;other&#160;orientations, this value&#160;is not&#160;used.<br/>
TableBorder<br/>
Description&#160;of&#160;the&#160;cell&#160;or&#160;cell&#160;range&#160;border&#160;(see<a href="libremacros.html#462">&#160;Table&#160;164)</a>.&#160;When&#160;used&#160;with&#160;a&#160;single&#160;cell,&#160;the&#160;<br/>
values&#160;set&#160;the&#160;borders&#160;for&#160;the&#160;single&#160;cell.&#160;When&#160;used&#160;with&#160;a&#160;range&#160;of&#160;cells,&#160;the&#160;borders&#160;are&#160;for&#160;the&#160;<br/>outer&#160;edges&#160;of&#160;the&#160;range&#160;rather&#160;than&#160;the&#160;individual&#160;cells.<br/>
TopBorder<br/>
Description&#160;of&#160;the&#160;cell’s&#160;top&#160;border&#160;line&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
BottomBorder<br/>
Description&#160;of&#160;the&#160;cell’s&#160;bottom&#160;border&#160;line&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
LeftBorder<br/>
Description&#160;of&#160;the&#160;cell’s&#160;left&#160;border&#160;line&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
RightBorder<br/>
Description&#160;of&#160;the&#160;cell’s&#160;right&#160;border&#160;line&#160;(see<a href="libremacros.html#461">&#160;Table&#160;163)</a>.<br/>
NumberFormat<br/>
Index of&#160;the&#160;cell’s&#160;number&#160;format.&#160;The&#160;proper&#160;value&#160;can be&#160;determined by&#160;using&#160;the&#160;<br/>com.sun.star.util.XNumberFormatter&#160;interface&#160;supported&#160;by&#160;the&#160;document.<br/>
ShadowFormat<br/>
Defines the&#160;shadow&#160;format&#160;using&#160;a&#160;com.sun.star.table.ShadowFormat&#160;structure:<br/>
Location –&#160;The&#160;shadow’s&#160;location as a&#160;com.sun.star.table.ShadowLocation&#160;enum&#160;with<br/>
valid values&#160;of&#160;NONE,&#160;TOP_LEFT,&#160;TOP_RIGHT,&#160;BOTTOM_LEFT,&#160;and&#160;<br/>BOTTOM_RIGHT.<br/>
•<br/>
ShadowWidth –&#160;The&#160;shadow’s&#160;size&#160;as&#160;a&#160;Short&#160;Integer.<br/>
•<br/>
IsTransparent&#160;– If&#160;True,&#160;the&#160;shadow&#160;is transparent.<br/>
•<br/>
Color&#160;–&#160;The&#160;shadow’s&#160;color&#160;as a&#160;Long Integer.<br/>
461<br/>
<hr/>
<a name=465></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
CellProtection<br/>
Defines the&#160;cell’s&#160;protection as a&#160;com.sun.star.util.CellProtection&#160;structure:&#160;<br/>•<br/>
IsLocked&#160;–&#160;If&#160;True,&#160;the&#160;cell&#160;is&#160;locked&#160;from&#160;modifications&#160;by&#160;the&#160;user.<br/>
•<br/>
IsFormulaHidden&#160;–&#160;If&#160;True,&#160;the&#160;formula&#160;is hidden from&#160;the&#160;user.<br/>
•<br/>
IsHidden&#160;–&#160;If&#160;True,&#160;the&#160;cell&#160;is&#160;hidden from&#160;the&#160;user.<br/>
•<br/>
IsPrintHidden&#160;–&#160;If&#160;True,&#160;the&#160;cell&#160;is hidden on printouts.<br/>
UserDefinedAttributes<br/>
This property&#160;is used to&#160;store&#160;additional&#160;attributes in a&#160;<br/>com.sun.star.container.XNameContainer&#160;interface.<br/>
In&#160;general, the&#160;process&#160;of setting&#160;cell&#160;attributes&#160;is&#160;very&#160;simple.&#160;The&#160;macro i<a href="libremacros.html#465">n&#160;Listing&#160;412&#160;de</a>monstrates&#160;some&#160;<br/>of the&#160;properties&#160;i<a href="libremacros.html#463">n&#160;Table&#160;165&#160;b</a>y&#160;setting the&#160;text&#160;of cell&#160;B1 to&#160;“Hello”,&#160;centering the&#160;text, and then rotating&#160;<br/>the&#160;text&#160;30 degrees&#160;counterclockwise.<br/>
<i><b>Listing&#160;412.</b>&#160;Center&#160;“Hello”&#160;and rotate&#160;it&#160;30 degrees.<br/></i>Sub&#160;RotateCellText<br/>&#160;&#160;Dim&#160;oCell<br/>&#160;&#160;Dim&#160;oDoc<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;createNewCalcDoc()<br/>&#160;&#160;oCell&#160;=&#160;oDoc.Sheets(0).getCellByPosition(1,&#160;0)&#160;'Cell B1<br/>&#160;&#160;oCell.setString(&#34;Hello&#34;)<br/>&#160;&#160;oCell.HoriJustify&#160;=&#160;com.sun.star.table.CellHoriJustify.CENTER<br/>&#160;&#160;oCell.RotateAngle&#160;=&#160;3000&#160; '30 degrees &#160;<br/>End&#160;Sub<br/>
<i>Figure&#160;99.&#160;Cell&#160;value&#160;rotated 30 degrees.</i><br/>
Cell&#160;properties&#160;(see<a href="libremacros.html#463">&#160;Table&#160;165)</a>&#160;are&#160;generic&#160;to&#160;most&#160;types&#160;of cells&#160;including text&#160;table&#160;cells. Cells&#160;in a&#160;<br/>spreadsheet&#160;contain&#160;other properties&#160;as&#160;well&#160;(see<a href="libremacros.html#465">&#160;Table&#160;166).</a><br/>
<i><b>Table&#160;166.</b>&#160;Properties&#160;supported by&#160;the&#160;com.sun.star.sheet.SheetCell&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Position&#160;<br/>
The&#160;position of&#160;the&#160;cell&#160;in the&#160;sheet&#160;(in 0.01&#160;mm)&#160;as&#160;a&#160;com.sun.star.awt.Point&#160;structure.&#160;This&#160;<br/>is&#160;the&#160;absolute&#160;position in&#160;the&#160;entire&#160;sheet, not&#160;the&#160;position&#160;in&#160;the&#160;visible&#160;area.<br/>•<br/>
X&#160;–&#160;The&#160;x-coordinate&#160;as&#160;a&#160;Long&#160;Integer.<br/>
•<br/>
Y&#160;–&#160;The&#160;y-coordinate&#160;as&#160;a&#160;Long&#160;Integer.<br/>
Size&#160;<br/>
The&#160;size&#160;of&#160;the&#160;cell&#160;(in&#160;0.01 mm)&#160;as a&#160;com.sun.star.awt.Size&#160;structure:<br/>•<br/>
Width –&#160;The&#160;width as a&#160;Long&#160;Integer.<br/>
•<br/>
Height&#160;–&#160;The&#160;height&#160;as a&#160;Long&#160;Integer.<br/>
FormulaLocal&#160;<br/>
Optional&#160;string&#160;containing&#160;the&#160;formula&#160;using&#160;localized function&#160;names.<br/>
462<br/>
<hr/>
<a name=466></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
FormulaResultType&#160;<br/>
Formula&#160;result&#160;type&#160;with&#160;values&#160;from&#160;the&#160;com.sun.star.sheet.FormulaResult&#160;constant&#160;group:<br/>•<br/>
VALUE&#160;=&#160;1&#160;–&#160;The&#160;formula&#160;returns a&#160;Double&#160;precision floating-point&#160;number.<br/>
•<br/>
STRING&#160;=&#160;2 –&#160;The&#160;formula&#160;returns a&#160;String&#160;value.<br/>
•<br/>
ERROR&#160;=&#160;4 –&#160;The&#160;formula&#160;has an error&#160;of&#160;some&#160;sort.<br/>
ConditionalFormat&#160;<br/>
The&#160;conditional&#160;formatting&#160;settings for&#160;this&#160;cell.&#160;When a&#160;conditional&#160;format&#160;is&#160;changed,&#160;it&#160;<br/>
must&#160;be&#160;reinserted&#160;into the&#160;property&#160;set.<br/>
ConditionalFormatLocal<br/>
Optional&#160;property&#160;duplicating&#160;ConditionalFormat&#160;except&#160;that&#160;formula&#160;names&#160;use&#160;local&#160;<br/>
names.<br/>
Validation&#160;<br/>
The&#160;data&#160;validation settings&#160;for&#160;this&#160;cell&#160;as a&#160;com.sun.star.beans.XPropertySet.<br/>
ValidationLocal&#160;<br/>
Optional&#160;property&#160;duplicating&#160;Validation except&#160;that&#160;formula&#160;names use&#160;local&#160;names.<br/>
The&#160;macro i<a href="libremacros.html#466">n&#160;Listing&#160;413&#160;de</a>monstrates&#160;how&#160;to&#160;obtain&#160;a&#160;cell’s&#160;position and size&#160;in&#160;a&#160;sheet.<br/>
<i><b>Listing&#160;413.</b>&#160;Print&#160;cell&#160;dimensions.</i><br/>
Sub&#160;CellDimensions<br/>&#160;&#160;Dim&#160;oCell<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;oCell&#160;=&#160;ThisComponent.Sheets(0).getCellByPosition(1,&#160;0)&#160;'Cell B1<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(oCell.Position.X&#160;\&#160;100)&#160;&#160;&amp;&#160;&#34; mm from the left&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(oCell.Position.Y&#160;\&#160;100)&#160;&#160;&amp;&#160;&#34; mm from the top&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(oCell.Size.Width&#160;\&#160;100)&#160;&#160;&amp;&#160;&#34; mm wide&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CStr(oCell.Size.Height&#160;\&#160;100)&#160;&amp;&#160;&#34; mm tall&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Size And Postion Of Cell &#34;&#160;&amp;&#160;oCell.AbsoluteName<br/>End&#160;Sub<br/>
<b>&#160;15.2.4.&#160;Cell&#160;annotations<br/></b>Each cell&#160;can contain&#160;one&#160;annotation&#160;that&#160;consists&#160;of simple&#160;unformatted text.&#160;The&#160;cell’s&#160;getAnnotation()&#160;<br/>method&#160;returns&#160;an object&#160;that&#160;supports&#160;the&#160;com.sun.star.sheet.CellAnnotation service.&#160;Cell&#160;annotations&#160;<br/>support&#160;the&#160;XSimpleText&#160;interface&#160;used in&#160;Writer documents&#160;as&#160;well&#160;as&#160;the&#160;more&#160;specific&#160;methods&#160;shown i<a href="libremacros.html#466">n<br/>Table&#160;167.&#160;</a><br/>
<i><b>Table&#160;167.</b>&#160;Methods&#160;implemented by&#160;the&#160;com.sun.star.sheet.CellAnnotation service.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getParent()<br/>
Get&#160;the&#160;object&#160;(cell)&#160;containing&#160;this&#160;annotation.<br/>
setParent(oCell)<br/>
Set&#160;the&#160;cell&#160;that&#160;contains&#160;this&#160;annotation.<br/>
getPosition()<br/>
Get&#160;the&#160;com.sun.star.table.CellAddress of&#160;the&#160;cell&#160;containing&#160;this annotation (see<a href="libremacros.html#459">&#160;Table&#160;162)</a>.<br/>
getAuthor()<br/>
Get&#160;the&#160;user&#160;who last&#160;changed&#160;the&#160;annotation as a&#160;String.<br/>
getDate()<br/>
Get&#160;the&#160;date&#160;the&#160;annotation was last&#160;changed&#160;as&#160;a&#160;formatted&#160;String.<br/>
getIsVisible()<br/>
Returns&#160;True&#160;if&#160;the&#160;annotation is&#160;visible.<br/>
setIsVisible(boolean)<br/>
Set&#160;whether&#160;the&#160;annotation is&#160;visible.<br/>
The&#160;spreadsheet&#160;object&#160;supports&#160;the&#160;method&#160;getAnnotations(), which&#160;returns&#160;all&#160;of the&#160;annotations&#160;in&#160;the&#160;<br/>spreadsheet.&#160;You can obtain&#160;individual&#160;annotations&#160;by&#160;using indexed access&#160;or enumeration.&#160;The&#160;object&#160;<br/>
463<br/>
<hr/>
<a name=467></a>returned by&#160;getAnnotations() also supports&#160;the&#160;methods&#160;removeByIndex(n) and insertNew(CellAddress,&#160;<br/>String).<br/>
<i><b>Listing&#160;414.</b>&#160;Manipulate&#160;cell&#160;annotations.<br/></i>Sub&#160;manipulateAnnotations<br/>&#160;&#160;Dim&#160;doc&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;aSheet&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;aCell&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;annotations&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;myAnnotation&#160;As&#160;Object<br/>&#160;&#160;<br/>&#160;&#160;doc&#160;=&#160;ThisComponent<br/>&#160;&#160;aSheet&#160;=&#160;doc.sheets.getByIndex(0)<br/>&#160;&#160;<br/>&#160;&#160;'Insert a new annotation.<br/>&#160;&#160;aCell&#160;=&#160;aSheet.getCellByPosition(0,&#160;0)<br/>&#160;&#160;annotations&#160;=&#160;aSheet.annotations<br/>&#160;&#160;annotations.insertNew(aCell.cellAddress,&#160;&#34;Text content&#34;)<br/>&#160;&#160;<br/>&#160;&#160;'Modify an existing annotation.<br/>&#160;&#160;'Cannot use the cell's pseudo-property &#34;annotation&#34; which is read-only<br/>&#160;&#160;myAnnotation&#160;=&#160;getAnnotationByCell(aCell)<br/>&#160;&#160;myAnnotation.isVisible&#160;=&#160;true<br/>&#160;&#160;myAnnotation.annotationShape.fillColor&#160;=&#160;rgb(148,&#160;0,&#160;107)<br/>&#160;&#160;myAnnotation.annotationShape.charFontName&#160;=&#160;&#34;Tahoma&#34;<br/>&#160;&#160;myAnnotation.annotationShape.charHeight&#160;=&#160;12<br/>
End&#160;Sub<br/>
Function&#160;getAnnotationByCell(aCell&#160;As&#160;Object)&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;result&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;annotations&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;annotationIndex&#160;As&#160;Long<br/>&#160;&#160;Dim&#160;anAnnotation&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;isFound&#160;As&#160;Boolean<br/>&#160;&#160;<br/>&#160;&#160;annotations&#160;=&#160;aCell.spreadSheet.annotations<br/>&#160;&#160;While&#160;((annotationIndex&#160;&lt;&#160;annotations.count)&#160;and&#160;(not&#160;isFound))<br/>&#160; &#160; &#160; &#160; &#160;&#160;anAnnotation&#160;=&#160;annotations.getByIndex(annotationIndex)<br/>&#160; &#160; &#160; &#160; &#160;&#160;isFound&#160;=&#160;((anAnnotation.position.row&#160;=&#160;aCell.cellAddress.row)&#160;and&#160;<br/>(anAnnotation.position.column&#160;=&#160;aCell.cellAddress.column))<br/>&#160; &#160;&#160;If&#160;(isFound)&#160;Then<br/>&#160; &#160; &#160;&#160;result&#160;=&#160;anAnnotation<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;annotationIndex&#160;=&#160;annotationIndex&#160;+&#160;1<br/>&#160;&#160;Wend<br/>&#160;&#160;getAnnotationByCell&#160;=&#160;result<br/>End&#160;Function<br/>
<i><b>&#160;15.3.&#160;Uninterpreted&#160;XML&#160;Attributes<br/></b></i>OpenOffice.org&#160;stores&#160;documents&#160;as&#160;XML.&#160;When&#160;an OOo document&#160;is&#160;read, it&#160;is&#160;parsed by&#160;an XML&#160;parser.&#160;<br/>User-defined attributes&#160;are&#160;not&#160;interpreted by&#160;the&#160;parser,&#160;but&#160;they&#160;are&#160;simply&#160;read, stored, and then written.&#160;<br/>
464<br/>
<hr/>
<a name=468></a>The&#160;intent&#160;is&#160;that&#160;a&#160;parser can store&#160;attributes&#160;that&#160;it&#160;cannot&#160;handle&#160;by&#160;itself on reading an XML&#160;file.&#160;When&#160;<br/>the&#160;file&#160;is&#160;stored again, the&#160;unknown attributes&#160;can be&#160;written back without&#160;loss.<br/>
Uninterpreted&#160;attributes&#160;also allow&#160;you&#160;to&#160;add your&#160;own properties&#160;that&#160;are&#160;saved with&#160;the&#160;document.<br/>
<i><b>Table&#160;168.</b>&#160;Methods&#160;to&#160;manipulate&#160;user&#160;defined attributes.</i><br/>
<i>Method</i><br/>
<i>Description</i><br/>
getByName<br/>
Get&#160;the&#160;named attribute.<br/>
getElementNames<br/>
Get&#160;an array&#160;of&#160;strings&#160;containing&#160;the&#160;existing&#160;attribute&#160;names.<br/>
hasByName(name)<br/>
Determine&#160;if&#160;the&#160;named attribute&#160;exists.<br/>
hasElements<br/>
Determine&#160;if&#160;any&#160;attributes exist.<br/>
insertByName(name,&#160;attr)<br/>
Insert&#160;a&#160;new&#160;attribute.<br/>
removeByName(name)<br/>
Remove&#160;an existing&#160;attribute.<br/>
replaceByName(name, attr)<br/>
Replace&#160;an existing&#160;attribute.<br/>
<i><b>Listing&#160;415.</b>&#160;To&#160;manipulate&#160;UserDefinedAttributes, use&#160;a copy&#160;and then&#160;assign&#160;it&#160;back.<br/></i>&#160;&#160;Sub&#160;UserDefinedAttributeToCell<br/>&#160; Dim&#160;oCell&#160; &#160; &#160; &#160;'The cell that will contain the attribute<br/>&#160; Dim&#160;oUserData&#160; &#160;'A copy of the UserDefinedAttributes<br/>&#160; Dim&#160;oMyAttribute&#160;As New&#160;com.sun.star.xml.AttributeData<br/>&#160; Dim&#160;oAttribute<br/>&#160; Dim&#160;oDoc<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;createNewCalcDoc()<br/>&#160;&#160;REM First, get the cell that will contain the new attribute<br/>&#160;&#160;oCell&#160;=&#160;oDoc.Sheets(0).getCellByPosition(1,&#160;0)&#160;'Cell B1<br/>
&#160;&#160;REM Now add data to the attribute.<br/>&#160;&#160;REM The Namespace is usually left blank, but set it if you want to.<br/>&#160;&#160;REM omyAttribute.Namespace = &#34;http://what/ever/you/want&#34;&#160;<br/>
&#160;&#160;REM Notice that the type is CDATA and not something like &#34;String&#34;<br/>&#160;&#160;oMyAttribute.Type =&#160;&#34;CDATA&#34;<br/>&#160;&#160;oMyAttribute.Value&#160;=&#160;&#34;Andrew Pitonyak&#34;<br/>
&#160;&#160;REM Here is where things usually go wrong with a statement like&#160;<br/>&#160;&#160;REM oCell.UserDefinedAttributes.insertByName(&#34;Andy&#34;, oMyAttribute)<br/>&#160;&#160;REM This fails every time. Instead, first make a copy and then<br/>&#160;&#160;REM operate on the copy.<br/>&#160;&#160;oUserData&#160;=&#160;oCell.UserDefinedAttributes<br/>&#160; If NOT&#160;oUserData.hasByName(&#34;Andy&#34;) Then<br/>&#160; &#160;&#160;oUserData.insertByName(&#34;Andy&#34;,&#160;oMyAttribute)<br/>&#160; &#160;&#160;oCell.UserDefinedAttributes&#160;=&#160;oUserData<br/>&#160; End If<br/>&#160;&#160;oAttribute&#160;=&#160;oCell.UserDefinedAttributes.getByName(&#34;Andy&#34;)<br/>&#160; Print&#160;oAttribute.Value<br/>End Sub<br/>
<b>Tip</b><br/>
All&#160;services&#160;that&#160;support&#160;UserDefinedAttributes work the&#160;same&#160;way.<br/>
465<br/>
<hr/>
<a name=469></a><i><b>&#160;15.4.&#160;Sheet&#160;cell&#160;ranges<br/></b></i>In&#160;Writer documents,&#160;continuous&#160;text&#160;can be&#160;grouped in&#160;a&#160;text&#160;range. In&#160;a&#160;spreadsheet,&#160;cells&#160;can be&#160;grouped&#160;<br/>in rectangular regions&#160;with&#160;a&#160;SheetCellRange. Grouping cells&#160;together allows&#160;multiple&#160;cells&#160;to&#160;be&#160;operated&#160;<br/>on at&#160;one&#160;time.&#160;The&#160;SheetCellRange&#160;service&#160;supports&#160;many&#160;of the&#160;same&#160;interfaces&#160;and properties&#160;as&#160;a&#160;<br/>SheetCell.&#160;<br/>
<b>Tip</b><br/>
Each sheet&#160;in&#160;a&#160;spreadsheet&#160;document&#160;is&#160;also a&#160;SheetRange.<br/>
Each cell&#160;has&#160;a&#160;cell&#160;address&#160;(see<a href="libremacros.html#459">&#160;Table&#160;162) t</a>hat&#160;identifies&#160;its&#160;location&#160;in the&#160;spreadsheet&#160;document. Each cell<br/>range&#160;has&#160;an analogous&#160;structure&#160;that&#160;identifies&#160;its&#160;location&#160;in the&#160;spreadsheet&#160;(see<a href="libremacros.html#469">&#160;Table&#160;169)</a>.<br/>
<i><b>Table&#160;169.</b>&#160;Properties&#160;of&#160;the&#160;com.sun.star.table.CellRangeAddress&#160;structure.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Sheet<br/>
Short&#160;Integer&#160;index&#160;of&#160;the&#160;sheet&#160;that&#160;contains&#160;the&#160;cell. &#160;<br/>
StartColumn<br/>
Long&#160;Integer&#160;index of&#160;the&#160;column&#160;where&#160;the&#160;left&#160;edge&#160;is&#160;located.<br/>
StartRow<br/>
Long&#160;Integer&#160;index of&#160;the&#160;row&#160;where&#160;the&#160;top&#160;edge&#160;is located.&#160;<br/>
EndColumn<br/>
Long&#160;Integer&#160;index of&#160;the&#160;column&#160;of&#160;the&#160;right&#160;edge&#160;of&#160;the&#160;range.<br/>
EndRow<br/>
Long&#160;Integer&#160;index of&#160;the&#160;row&#160;of&#160;the&#160;bottom&#160;edge&#160;of&#160;the&#160;range.<br/>
A&#160;single&#160;sheet&#160;cell&#160;range&#160;exists&#160;in&#160;a&#160;single&#160;sheet&#160;and contains&#160;one&#160;rectangular region.&#160;Multiple&#160;ranges&#160;are&#160;<br/>encapsulated&#160;by&#160;the&#160;SheetCellRanges&#160;service, which supports&#160;most&#160;of the&#160;same&#160;properties&#160;and services&#160;as&#160;a&#160;<br/>SheetCellRange.&#160;The&#160;similarity&#160;in&#160;functionality&#160;simplifies&#160;the&#160;learning curve&#160;and offers&#160;a&#160;lot&#160;of otherwise&#160;<br/>complicated functionality.<br/>
The&#160;SheetCellRanges&#160;service&#160;provides&#160;access&#160;to&#160;each range&#160;through the&#160;use&#160;of the&#160;XElementAccess&#160;<br/>interface&#160;and the&#160;XIndexAccess&#160;interface.&#160;The&#160;methods&#160;i<a href="libremacros.html#469">n&#160;Table&#160;170<b>&#160;</b></a>also provide&#160;access&#160;to&#160;the&#160;contained&#160;<br/>cell&#160;ranges.<br/>
<i><b>Table&#160;170.</b>&#160;Methods&#160;defined by&#160;the&#160;com.sun.star.table.XSheetCellRanges&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getCells()<br/>
Return the&#160;collection of&#160;contained&#160;cells&#160;as&#160;an XEnumerationAccess.<br/>
getRangeAddressesAsString()<br/>
Return a&#160;string&#160;with&#160;the&#160;addresses of&#160;all&#160;contained&#160;ranges.&#160;The&#160;output&#160;format&#160;is&#160;<br/>similar&#160;to “Sheet1.B2:D6;Sheet3.C4:D5”.<br/>
getRangeAddresses()<br/>
Return an array&#160;of&#160;services&#160;of&#160;type&#160;CellRangeAddress&#160;(see<a href="libremacros.html#469">&#160;Table&#160;169)</a>.<br/>
<b>&#160;15.4.1.&#160;Sheet&#160;cell&#160;range&#160;properties<br/></b>Sheet&#160;cell&#160;ranges&#160;and sheet&#160;cells&#160;both&#160;support&#160;the&#160;properties&#160;Position,&#160;Size, ConditionalFormat,&#160;<br/>ConditionalFormatLocal,&#160;Validation,&#160;and&#160;ValidationLocal&#160;(see<a href="libremacros.html#465">&#160;Table&#160;166)</a>.&#160;The&#160;Position&#160;property&#160;for a&#160;sheet&#160;<br/>cell&#160;range&#160;provides&#160;the&#160;location of the&#160;upper-left&#160;cell&#160;—&#160;this&#160;is&#160;equivalent&#160;to obtaining the&#160;position&#160;property&#160;<br/>from&#160;the&#160;upper-left&#160;cell&#160;in&#160;the&#160;range.&#160;The&#160;Size&#160;property&#160;for a&#160;cell&#160;returns&#160;the&#160;size&#160;of a&#160;single&#160;cell,&#160;and the&#160;Size<br/>property&#160;for a&#160;sheet&#160;cell&#160;range&#160;provides&#160;the&#160;size&#160;for all&#160;of the&#160;cells&#160;contained in&#160;the&#160;range.<br/>
466<br/>
<hr/>
<a name=470></a><i><b>Validation&#160;settings<br/></b></i>Sheet&#160;cells&#160;and sheet&#160;cell&#160;ranges&#160;are&#160;able&#160;to validate&#160;the&#160;data&#160;that&#160;they&#160;contain,&#160;to prevent&#160;invalid&#160;data&#160;from&#160;<br/>populating the&#160;cells.&#160;You can display&#160;a&#160;dialog when invalid&#160;data&#160;is&#160;entered (see<a href="libremacros.html#470">&#160;Table&#160;172).&#160;</a>The&#160;service&#160;<br/>com.sun.star.sheet.TableValidation controls&#160;the&#160;validation process.<br/>
Before&#160;demonstrating how&#160;a&#160;validation is&#160;performed,&#160;I&#160;must&#160;introduce&#160;a&#160;few&#160;enumerated&#160;values, properties,&#160;<br/>and methods. Specify&#160;the&#160;validation that&#160;is&#160;performed&#160;by&#160;using the&#160;enumerated&#160;values&#160;shown i<a href="libremacros.html#470">n&#160;Table&#160;171.</a><br/>
<i><b>Table&#160;171.</b>&#160;Validation types&#160;defined by&#160;the&#160;com.sun.star.sheet.ValidationType&#160;enum.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.ValidationType.ANY&#160;<br/>
All&#160;content&#160;is&#160;valid;&#160;no conditions are&#160;used.<br/>
com.sun.star.sheet.ValidationType.WHOLE&#160;<br/>
Compare&#160;a&#160;whole&#160;(integer)&#160;number&#160;against&#160;the&#160;specified&#160;condition.<br/>
com.sun.star.sheet.ValidationType.DECIMAL&#160;<br/>
Compare&#160;any&#160;number&#160;against&#160;the&#160;specified condition.<br/>
com.sun.star.sheet.ValidationType.DATE&#160;<br/>
Compare&#160;a&#160;date&#160;value&#160;against&#160;the&#160;specified condition.<br/>
com.sun.star.sheet.ValidationType.TIME&#160;<br/>
Compare&#160;a&#160;time&#160;value&#160;against&#160;the&#160;specified&#160;condition.<br/>
com.sun.star.sheet.ValidationType.TEXT_LEN&#160;<br/>
Compare&#160;a&#160;string&#160;length against&#160;the&#160;specified&#160;condition.<br/>
com.sun.star.sheet.ValidationType.LIST&#160;<br/>
Only&#160;allow&#160;strings in&#160;the&#160;specified&#160;list.<br/>
com.sun.star.sheet.ValidationType.CUSTOM&#160;<br/>
Specify&#160;a&#160;formula&#160;that&#160;determines&#160;if&#160;the&#160;contents&#160;are&#160;valid.<br/>
When&#160;a&#160;cell&#160;containing&#160;invalid&#160;data&#160;is&#160;found, the&#160;ValidationAlertStyle&#160;enum&#160;specifies&#160;how&#160;the&#160;invalid data&#160;<br/>should be&#160;handled (see<a href="libremacros.html#470">&#160;Table&#160;172</a><a href="libremacros.html#471">).&#160;Table&#160;173&#160;l</a>ists&#160;the&#160;supported conditional&#160;operators.<br/>
<i><b>Table&#160;172.</b>&#160;Validation alerts&#160;defined by&#160;the&#160;com.sun.star.sheet.ValidationAlertStyle&#160;enum.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.ValidationAlertStyle.STOP&#160;<br/>
Display&#160;an error&#160;message&#160;and reject&#160;the&#160;change.<br/>
com.sun.star.sheet.ValidationAlertStyle.WARNING&#160;<br/>
Display&#160;a&#160;warning&#160;message&#160;and ask the&#160;user&#160;if&#160;the&#160;change&#160;will&#160;be<br/>
accepted.&#160;The&#160;default&#160;answer&#160;is&#160;No.<br/>
com.sun.star.sheet.ValidationAlertStyle.INFO&#160;<br/>
Display&#160;an information message&#160;and&#160;ask the&#160;user&#160;if&#160;the&#160;change&#160;<br/>
will&#160;be&#160;accepted.&#160;The&#160;default&#160;answer&#160;is&#160;Yes.<br/>
com.sun.star.sheet.ValidationAlertStyle.MACRO&#160;<br/>
Execute&#160;a&#160;specified&#160;macro.<br/>
467<br/>
<hr/>
<a name=471></a><i><b>Table&#160;173.</b>&#160;Conditions&#160;defined by&#160;the&#160;com.sun.star.sheet.ConditionOperator&#160;enum.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.ConditionOperator.NONE&#160;<br/>
No&#160;condition is specified.<br/>
com.sun.star.sheet.ConditionOperator.EQUAL&#160;<br/>
The&#160;value&#160;must&#160;be&#160;equal&#160;to the&#160;specified value.<br/>
com.sun.star.sheet.ConditionOperator.NOT_EQUAL&#160;<br/>
The&#160;value&#160;must&#160;not&#160;be&#160;equal&#160;to the&#160;specified&#160;value.<br/>
com.sun.star.sheet.ConditionOperator.GREATER&#160;<br/>
The&#160;value&#160;must&#160;be&#160;greater&#160;than&#160;the&#160;specified&#160;value.<br/>
com.sun.star.sheet.ConditionOperator.GREATER_EQUAL&#160;<br/>
The&#160;value&#160;must&#160;be&#160;greater&#160;than&#160;or&#160;equal&#160;to the&#160;specified&#160;<br/>
value.<br/>
com.sun.star.sheet.ConditionOperator.LESS&#160;<br/>
The&#160;value&#160;must&#160;be&#160;less than the&#160;specified&#160;value.<br/>
com.sun.star.sheet.ConditionOperator.LESS_EQUAL&#160;<br/>
The&#160;value&#160;must&#160;be&#160;less than or&#160;equal&#160;to&#160;the&#160;specified value.<br/>
com.sun.star.sheet.ConditionOperator.BETWEEN&#160;<br/>
The&#160;value&#160;must&#160;be&#160;between&#160;the&#160;two specified&#160;values.<br/>
com.sun.star.sheet.ConditionOperator.NOT_BETWEEN&#160;<br/>
The&#160;value&#160;must&#160;be&#160;outside&#160;of&#160;the&#160;two specified&#160;values.<br/>
com.sun.star.sheet.ConditionOperator.FORMULA&#160;<br/>
The&#160;specified&#160;formula&#160;must&#160;have&#160;a&#160;non-zero result.<br/>
The&#160;validation&#160;object&#160;defines&#160;the&#160;type&#160;of validation&#160;and how&#160;to&#160;react&#160;to&#160;the&#160;validation using properties&#160;of the&#160;<br/>object&#160;(see<a href="libremacros.html#471">&#160;Table&#160;174)</a>.&#160;<br/>
<i><b>Table&#160;174.</b>&#160;Properties&#160;supported by&#160;the&#160;com.sun.star.sheet.TableValidation&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Type&#160;<br/>
The&#160;type&#160;of&#160;validation&#160;to perform,&#160;as&#160;shown&#160;in<a href="libremacros.html#470">&#160;Table&#160;171.</a><br/>
ShowInputMessage&#160;<br/>
If&#160;True, an input&#160;message&#160;appears&#160;when&#160;the&#160;cursor&#160;is&#160;in&#160;an invalid&#160;cell.<br/>
InputTitle&#160;<br/>
Title&#160;(String)&#160;of&#160;the&#160;dialog&#160;with&#160;the&#160;input&#160;message.<br/>
InputMessage&#160;<br/>
Text&#160;(String)&#160;of&#160;the&#160;input&#160;message.<br/>
ShowErrorMessage&#160;<br/>
If&#160;True, an error&#160;message&#160;appears&#160;when invalid data&#160;is&#160;entered.<br/>
ErrorTitle&#160;<br/>
Title&#160;(String)&#160;of&#160;the&#160;dialog&#160;showing&#160;the&#160;error&#160;message.<br/>
ErrorMessage&#160;<br/>
Text&#160;(String)&#160;of&#160;the&#160;error&#160;message.<br/>
IgnoreBlankCells&#160;<br/>
If&#160;True, blank&#160;cells are&#160;allowed.<br/>
ErrorAlertStyle&#160;<br/>
The&#160;action that&#160;is&#160;taken when an error&#160;occurs, as shown&#160;in<a href="libremacros.html#470">&#160;Table&#160;172.</a><br/>
Finally,&#160;the&#160;comparison that&#160;is&#160;performed&#160;is&#160;specified using methods&#160;implemented by&#160;the&#160;TableValidation&#160;<br/>service&#160;(see<a href="libremacros.html#472">&#160;Table&#160;175).</a><br/>
468<br/>
<hr/>
<a name=472></a><i><b>Table&#160;175.</b>&#160;Methods&#160;supported by&#160;the&#160;com.sun.star.sheet.TableValidation&#160;service.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getOperator()<br/>
Get&#160;the&#160;operator&#160;used&#160;in the&#160;condition,&#160;as&#160;shown&#160;in<a href="libremacros.html#471">&#160;Table&#160;173.</a><br/>
setOperator(condition)<br/>
Set&#160;the&#160;operator&#160;used in the&#160;condition,&#160;as shown i<a href="libremacros.html#471">n&#160;Table&#160;173.</a><br/>
getFormula1()<br/>
Get&#160;the&#160;comparison value&#160;(String)&#160;used in&#160;the&#160;condition, or&#160;the&#160;first&#160;value&#160;if&#160;two&#160;are&#160;<br/>
needed.<br/>
setFormula1(String)<br/>
Set&#160;the&#160;comparison value&#160;used&#160;in the&#160;condition, or&#160;the&#160;first&#160;value&#160;if&#160;two are&#160;required.<br/>
getFormula2()<br/>
Get&#160;the&#160;second&#160;value&#160;(String)&#160;if&#160;two&#160;are&#160;required.<br/>
setFormula2(String)<br/>
Set&#160;the&#160;second&#160;value&#160;(String)&#160;if&#160;two are&#160;required.<br/>
getSourcePosition()<br/>
Get&#160;the&#160;CellAddress&#160;that&#160;is used as a&#160;base&#160;for&#160;relative&#160;references in the&#160;formulas&#160;<br/>(see<a href="libremacros.html#459">&#160;Table&#160;162)</a>.<br/>
setSourcePosition(CellAddress)<br/>
Set&#160;the&#160;CellAddress that&#160;is used&#160;as&#160;a&#160;base&#160;for&#160;relative&#160;references in the&#160;formulas&#160;<br/>(see<a href="libremacros.html#459">&#160;Table&#160;162)</a>.<br/>
The&#160;macro i<a href="libremacros.html#472">n&#160;Listing&#160;416&#160;s</a>ets&#160;a&#160;validation range&#160;in&#160;the&#160;first&#160;sheet&#160;—&#160;that&#160;is,&#160;the&#160;sheet&#160;with&#160;a&#160;numerical&#160;index<br/>of 0.&#160;The&#160;cells&#160;from&#160;B2 to D6 are&#160;set&#160;to&#160;disallow&#160;any&#160;values&#160;that&#160;are&#160;not&#160;between 1 and 10.&#160;The&#160;macro itself&#160;<br/>is&#160;unexpectedly&#160;simple.<br/>
<i><b>Listing&#160;416.</b>&#160;Set&#160;validation range&#160;in&#160;Calc.<br/></i>Sub&#160;SetValidationRange<br/>&#160;&#160;Dim&#160;oRange &#160; &#160; &#160; &#160;'Range that will accept the validation<br/>&#160;&#160;Dim&#160;oValidation &#160;&#160;'The validation object<br/>&#160;&#160;Dim&#160;oDoc<br/>&#160;&#160;<br/>&#160; oDoc&#160;=&#160;createNewCalcDoc()<br/>
&#160;&#160;REM Sheets support returning a cell range based on UI type names.<br/>&#160; oRange&#160;=&#160;oDoc.Sheets(0).getCellRangeByName(&#34;B2:D6&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Obtain the Validation object<br/>&#160; oValidation&#160;=&#160;oRange.Validation<br/>&#160;&#160;<br/>&#160;&#160;REM Configure the validation to perform<br/>&#160; oValidation.Type&#160;=&#160;com.sun.star.sheet.ValidationType.DECIMAL<br/>&#160; oValidation.ErrorMessage&#160;=&#160;&#34;Please enter a number between one and ten&#34;<br/>&#160; oValidation.ShowErrorMessage&#160;=&#160;True<br/>&#160; oValidation.ErrorAlertStyle&#160;=&#160;com.sun.star.sheet.ValidationAlertStyle.STOP<br/>&#160; oValidation.setOperator(com.sun.star.sheet.ConditionOperator.BETWEEN)<br/>&#160;&#160;<br/>&#160; oValidation.setFormula1(1.0)<br/>&#160; oValidation.setFormula2(10.0)<br/>
&#160;&#160;REM Now set the validation<br/>&#160; oRange.Validation&#160;=&#160;oValidation<br/>&#160;&#160;Print&#160;&#34;Try to enter a number in cells B2:D6 that is not between 1 and 10.&#34;<br/>End&#160;Sub&#160;<br/>
The&#160;example&#160;i<a href="libremacros.html#472">n&#160;Listing&#160;416&#160;s</a>ets&#160;a&#160;Decimal&#160;validation&#160;between 1 and 10.&#160;This&#160;validation example&#160;does&#160;not&#160;<br/>generate&#160;an error for a&#160;value&#160;of 0 or 0.5.&#160;Try&#160;a&#160;few&#160;examples&#160;to&#160;see&#160;what&#160;else&#160;might&#160;fail.<br/>
469<br/>
<hr/>
<a name=473></a><i><b>Conditional&#160;formatting<br/></b></i>Conditional&#160;formatting allows&#160;the&#160;cell&#160;style&#160;to&#160;change&#160;based on the&#160;cell’s&#160;content.&#160;Sheet&#160;cells&#160;and sheet&#160;cell&#160;<br/>ranges&#160;both support&#160;the&#160;ConditionalFormat&#160;property,&#160;which in&#160;turn supports&#160;the&#160;XSheetConditionalEntries&#160;<br/>interface.&#160;You can access&#160;conditional&#160;formatting entries&#160;by&#160;using&#160;element&#160;access, indexed&#160;access, or the&#160;<br/>methods&#160;addNew(properties()), clear(), and removeByIndex(index).<br/>
You can also apply&#160;multiple&#160;conditional&#160;formatting entries&#160;to&#160;the&#160;same&#160;cell.&#160;The&#160;first&#160;one&#160;that&#160;matches&#160;is&#160;<br/>applied.&#160;Each formatting entry&#160;is&#160;represented by&#160;an array&#160;of PropertyValue&#160;structures. Conditional&#160;formatting<br/>is&#160;very&#160;similar&#160;to validation in&#160;that&#160;they&#160;both use&#160;values&#160;and types&#160;from<a href="libremacros.html#470">&#160;Table&#160;171&#160;t</a>hrou<a href="libremacros.html#472">gh&#160;Table&#160;175.&#160;</a><br/>
Validation&#160;is&#160;a&#160;relatively&#160;simple&#160;condition&#160;on a&#160;data&#160;element,&#160;enforcing type&#160;and format&#160;constraints.&#160;<br/>Conditional&#160;formatting supports&#160;validation and a&#160;more&#160;extended set&#160;of checks, including attributes&#160;or&#160;<br/>metadata&#160;defined&#160;on elements&#160;or collections&#160;of elements&#160;—&#160;the&#160;names&#160;are&#160;similar,&#160;but&#160;the&#160;actual&#160;operations,&#160;<br/>applications, and implications&#160;are&#160;much&#160;more&#160;elaborate.&#160;It&#160;is&#160;more&#160;difficult&#160;to&#160;explain&#160;than it&#160;is&#160;to&#160;<br/>demonstrate.&#160;The&#160;macro i<a href="libremacros.html#473">n&#160;Listing&#160;417&#160;s</a>ets&#160;a&#160;range&#160;of cells&#160;to&#160;use&#160;the&#160;“Heading1”&#160;style&#160;if the&#160;cell&#160;contains&#160;a&#160;<br/>negative&#160;number.&#160;<br/>
<i><b>Listing&#160;417.</b>&#160;Set&#160;conditional&#160;style&#160;in&#160;Calc.<br/></i>Sub&#160;SetConditionalStyle<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160;&#160;'Cell range to use<br/>&#160;&#160;Dim&#160;oConFormat&#160; &#160;&#160;'Conditional format object<br/>&#160;&#160;Dim&#160;oCondition(2)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>
&#160;&#160;REM Sheets support returning a cell range based on UI type names.<br/>&#160;&#160;oRange&#160;=&#160;ThisComponent.Sheets(0).getCellRangeByName(&#34;B2:D6&#34;)<br/>&#160;&#160;oConFormat&#160;=&#160;oRange.ConditionalFormat<br/>&#160;&#160;<br/>&#160;&#160;oCondition(0).Name&#160;=&#160;&#34;Operator&#34;<br/>&#160;&#160;oCondition(0).Value&#160;=&#160;com.sun.star.sheet.ConditionOperator.LESS<br/>&#160;&#160;oCondition(1).Name&#160;=&#160;&#34;Formula1&#34;<br/>&#160;&#160;oCondition(1).Value&#160;=&#160;0<br/>&#160;&#160;oCondition(2).Name&#160;=&#160;&#34;StyleName&#34;<br/>&#160;&#160;oCondition(2).Value&#160;=&#160;&#34;Heading1&#34;<br/>&#160;&#160;oConFormat.addNew(oCondition())<br/>&#160;&#160;oRange.ConditionalFormat&#160;=&#160;oConFormat<br/>End&#160;Sub<br/>
<b>&#160;15.4.2.&#160;Sheet&#160;cell&#160;range&#160;services<br/></b>Sheet&#160;cells&#160;and sheet&#160;cell&#160;ranges&#160;have&#160;numerous&#160;services&#160;in common&#160;—&#160;for example, CellProperties&#160;(se<a href="libremacros.html#463">e<br/>Table&#160;165)</a>, CharacterProperties, CharacterPropertiesAsian,&#160;CharacterPropertiesComplex,&#160;<br/>ParagraphProperties, and SheetRangesQuery.<br/>
<i><b>Retrieving&#160;cells&#160;and&#160;ranges<br/></b></i>A&#160;SheetCellRange&#160;support&#160;the&#160;CellRange&#160;service,&#160;which in&#160;turn supports&#160;CellProperties&#160;(see<a href="libremacros.html#463">&#160;Table&#160;165).&#160;</a>The<br/>CellRange&#160;service&#160;offers&#160;extra&#160;functionality&#160;that&#160;is&#160;appropriate&#160;for cell&#160;ranges, but&#160;not&#160;for individual&#160;cells&#160;—&#160;<br/>for example,&#160;retrieving cells&#160;and cell&#160;ranges.&#160;When&#160;a&#160;cell&#160;range&#160;is&#160;retrieved using the&#160;methods&#160;i<a href="libremacros.html#474">n&#160;Table&#160;176,&#160;<br/></a>the&#160;cells&#160;are&#160;indexed relative&#160;to&#160;the&#160;top-left&#160;corner of the&#160;range.&#160;When the&#160;range&#160;is&#160;an entire&#160;sheet, the&#160;<br/>location (0, 0) refers&#160;to the&#160;cell&#160;“A1.”&#160;If&#160;the&#160;range&#160;includes&#160;the&#160;cells&#160;“B2:D6”, however,&#160;the&#160;location&#160;(0,0)&#160;<br/>refers&#160;to&#160;cell&#160;“B2.”&#160;The&#160;macros&#160;in<a href="libremacros.html#460">&#160;Listing 410&#160;t</a>hrou<a href="libremacros.html#466">gh&#160;Listing 413&#160;a</a>ll&#160;use&#160;the&#160;method&#160;getCellByPosition().<br/>
470<br/>
<hr/>
<a name=474></a><i><b>Table&#160;176.</b>&#160;Methods&#160;supported by&#160;the&#160;com.sun.star.table.XCellRange&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getCellByPosition(left, top)<br/>
Get&#160;a&#160;cell&#160;within&#160;the&#160;range.<br/>
getCellRangeByPosition(left,&#160;top, right, bottom)<br/>
Get&#160;a&#160;cell&#160;range&#160;within&#160;the&#160;range.<br/>
getCellRangeByName(name)<br/>
Get&#160;a&#160;cell&#160;range&#160;within&#160;the&#160;range&#160;based&#160;on&#160;its&#160;name.&#160;The&#160;string&#160;<br/>
directly&#160;references cells using&#160;the&#160;standard&#160;formats&#160;—&#160;such&#160;as&#160;<br/>“B2:D5”&#160;or&#160;“$B$2”&#160;—&#160;or&#160;defined&#160;cell&#160;range&#160;names.<br/>
<b>Tip</b><br/>
The&#160;methods getCellByPosition(), getCellRangeByPosition(),&#160;and&#160;getCellRangeByName()&#160;<br/>
cannot&#160;return a&#160;value&#160;that&#160;is not&#160;in the&#160;range&#160;(see<a href="libremacros.html#509">&#160;Listing&#160;445)</a>.<br/>
<i><b>Querying&#160;cells<br/></b></i>Sheet&#160;cell&#160;ranges&#160;and sheet&#160;cells&#160;both&#160;support&#160;the&#160;ability&#160;to find&#160;cells&#160;with&#160;specific&#160;properties.&#160;This&#160;ability&#160;<br/>provides&#160;a&#160;mechanism&#160;for finding all&#160;cells&#160;that&#160;are&#160;referenced by&#160;the&#160;current&#160;cell’s&#160;formula&#160;and the&#160;ability&#160;to&#160;<br/>see&#160;which cells&#160;reference&#160;the&#160;current&#160;cell.&#160;While&#160;performing a&#160;query&#160;based on the&#160;cell’s&#160;content, the&#160;<br/>CellFlags&#160;in<a href="libremacros.html#474">&#160;Table&#160;177&#160;s</a>pecify&#160;the&#160;content&#160;type&#160;to search.<br/>
<i><b>Table&#160;177.</b>&#160;Values&#160;in&#160;the&#160;com.sun.star.sheet.CellFlags&#160;constant&#160;group.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Flag</b></i><br/>
<i><b>Description</b></i><br/>
1<br/>
com.sun.star.sheet.CellFlags.VALUE<br/>
Select&#160;numbers not&#160;formatted&#160;as dates or&#160;times.<br/>
2<br/>
com.sun.star.sheet.CellFlags.DATETIME<br/>
Select&#160;numbers formatted&#160;as&#160;dates or&#160;times.<br/>
4<br/>
com.sun.star.sheet.CellFlags.STRING<br/>
Select&#160;strings.<br/>
8<br/>
com.sun.star.sheet.CellFlags.ANNOTATION<br/>
Select&#160;cell&#160;annotations.<br/>
16<br/>
com.sun.star.sheet.CellFlags.FORMULA<br/>
Select&#160;formulas.<br/>
32<br/>
com.sun.star.sheet.CellFlags.HARDATTR<br/>
Select&#160;explicit&#160;formatting&#160;—&#160;not&#160;styles.<br/>
64<br/>
com.sun.star.sheet.CellFlags.STYLES<br/>
Select&#160;cell&#160;styles.<br/>
128<br/>
com.sun.star.sheet.CellFlags.OBJECTS<br/>
Select&#160;drawing&#160;objects such as buttons and graphics.<br/>
256<br/>
com.sun.star.sheet.CellFlags.EDITATTR<br/>
Select&#160;formatting&#160;within the&#160;cell’s&#160;content.<br/>
Each of the&#160;methods&#160;used to&#160;query&#160;a&#160;cell&#160;range&#160;(see<a href="libremacros.html#474">&#160;Table&#160;178)</a>&#160;also&#160;returns&#160;a&#160;cell&#160;range&#160;(see<a href="libremacros.html#469">&#160;Table&#160;170)</a>.<br/>
<i><b>Table&#160;178.</b>&#160;Methods&#160;to&#160;query&#160;a cell&#160;range.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
queryDependents(boolean)<br/>
Return all&#160;cells that&#160;reference&#160;cells in&#160;this&#160;range.&#160;If&#160;True,&#160;search is&#160;recursive.<br/>
queryPrecedents(boolean)<br/>
Return all&#160;cells referenced by&#160;cells in&#160;this&#160;range.&#160;If&#160;True,&#160;search is&#160;recursive.<br/>
queryVisibleCells()<br/>
Return all&#160;visible&#160;cells.<br/>
queryEmptyCells()<br/>
Return all&#160;empty&#160;cells.<br/>
queryContentCells(CellFlags)<br/>
Return all&#160;cells with the&#160;specified&#160;content&#160;types&#160;(see<a href="libremacros.html#474">&#160;Table&#160;177)</a>.<br/>
queryFormulaCells(FormulaResult)<br/>
Return all&#160;cells containing&#160;a&#160;formula&#160;with the&#160;specified&#160;result&#160;type&#160;(see&#160;<br/>FormulaResultType&#160;in<a href="libremacros.html#465">&#160;Table&#160;166)</a>.<br/>
queryColumnDifferences(CellAddress)<br/>
Return all&#160;cells that&#160;differ&#160;from&#160;the&#160;comparison&#160;cell&#160;in the&#160;specified cell’s&#160;<br/>row&#160;(see<a href="libremacros.html#459">&#160;Table&#160;162)</a>.<br/>
471<br/>
<hr/>
<a name=475></a><i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
queryRowDifferences(CellAddress)<br/>
Return all&#160;cells that&#160;differ&#160;from&#160;the&#160;comparison&#160;cell&#160;in the&#160;specified cell’s&#160;<br/>
column&#160;(see<a href="libremacros.html#459">&#160;Table&#160;162)</a>.<br/>
queryIntersection(CellRangeAddress)<br/>
Return the&#160;range&#160;of&#160;cells that&#160;intersect&#160;the&#160;specified range&#160;(see<a href="libremacros.html#469">&#160;Table&#160;169)</a>.<br/>
<i><b>Finding&#160;non-empty&#160;cells&#160;in&#160;a&#160;range<br/></b></i>Use&#160;the&#160;method queryContentCells(CellFlags) to&#160;obtain&#160;a&#160;list&#160;of all&#160;cells&#160;in&#160;a&#160;range&#160;that&#160;are&#160;not&#160;empty.&#160;The&#160;<br/>CellFlags&#160;argument&#160;is&#160;set&#160;to return all&#160;cells&#160;that&#160;contain a&#160;value, string, formula,&#160;or date/time.&#160;The&#160;interesting<br/>thing about<a href="libremacros.html#475">&#160;Listing&#160;418&#160;i</a>s&#160;not&#160;that&#160;it&#160;uses&#160;a&#160;query&#160;to find the&#160;nonempty&#160;cells,&#160;but&#160;rather that&#160;it&#160;demonstrates&#160;<br/>how&#160;to&#160;extract&#160;the&#160;cells&#160;from&#160;the&#160;query&#160;and enumerate&#160;all&#160;of the&#160;returned cells. In&#160;other words, the&#160;macro i<a href="libremacros.html#475">n<br/>Listing 418&#160;de</a>monstrates&#160;how&#160;to visit&#160;all&#160;of the&#160;nonempty&#160;cells&#160;in a&#160;specific&#160;range.<br/>
<i><b>Listing&#160;418.</b>&#160;Find&#160;cells&#160;that&#160;are&#160;not&#160;empty&#160;in&#160;a range.<br/></i>Function&#160;NonEmptyCellsInRange(oRange,&#160;sep$)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;oCell&#160; &#160; &#160; &#160; &#160;'The cell to use!<br/>&#160;&#160;Dim&#160;oRanges&#160; &#160; &#160; &#160;'Ranges returned after querying for the cells<br/>&#160;&#160;Dim&#160;oAddrs()&#160; &#160; &#160;&#160;'Array of CellRangeAddress<br/>&#160;&#160;Dim&#160;oAddr&#160; &#160; &#160; &#160; &#160;'One CellRangeAddress<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;'Sheet that contains the cell range<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Long&#160; &#160; &#160;'General index variable<br/>&#160;&#160;Dim&#160;nRow&#160;As&#160;Long&#160;&#160;'Row number<br/>&#160;&#160;Dim&#160;nCol&#160;As&#160;Long&#160;&#160;'Column number<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;<br/>&#160;&#160;REM First, find the cells that are NOT empty in this range!<br/>&#160;&#160;REM I consider a cell to be not empty if it has a value,<br/>&#160;&#160;REM date/time, string, or formula.<br/>&#160;&#160;oRanges&#160;=&#160;oRange.queryContentCells(_<br/>&#160; &#160;&#160;com.sun.star.sheet.CellFlags.VALUE&#160;OR&#160;_<br/>&#160; &#160;&#160;com.sun.star.sheet.CellFlags.DATETIME&#160;OR&#160;_<br/>&#160; &#160;&#160;com.sun.star.sheet.CellFlags.STRING&#160;OR&#160;_<br/>&#160; &#160;&#160;com.sun.star.sheet.CellFlags.FORMULA)<br/>&#160; &#160;&#160;<br/>&#160;&#160;oAddrs()&#160;=&#160;oRanges.getRangeAddresses()<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;UBound(oAddrs())<br/>&#160;&#160;<br/>&#160; &#160;&#160;REM Get a specific address range<br/>&#160; &#160;&#160;oAddr&#160;=&#160;oAddrs(i)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;For&#160;nRow&#160;=&#160;oAddr.StartRow&#160;To&#160;oAddr.EndRow<br/>&#160; &#160; &#160;&#160;For&#160;nCol&#160;=&#160;oAddr.StartColumn&#160;To&#160;oAddr.EndColumn<br/>&#160; &#160; &#160; &#160;&#160;oCell&#160;=&#160;oRange.Spreadsheet.getCellByPosition(nCol,&#160;nRow)<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oCell.AbsoluteName&#160;&amp;&#160;sep$<br/>&#160; &#160; &#160;&#160;Next<br/>&#160; &#160;&#160;Next<br/>&#160; &#160;&#160;<br/>&#160;&#160;Next<br/>&#160;&#160;NonEmptyCellsInRange&#160;=&#160;s<br/>End&#160;Function<br/>
472<br/>
<hr/>
<a name=476></a><i><b>Using&#160;complex&#160;queries<br/></b></i>Although the&#160;query&#160;methods&#160;are&#160;easy&#160;to&#160;use, some&#160;of them&#160;are&#160;conceptually&#160;quite&#160;complicated.&#160;All&#160;of the&#160;<br/>query&#160;methods&#160;return a&#160;SheetCellRanges&#160;object.&#160;The&#160;macro in<a href="libremacros.html#476">&#160;Listing 419&#160;de</a>monstrates&#160;how&#160;to find the&#160;cells<br/>referenced by&#160;a&#160;formula&#160;using the&#160;queryPrecedents() method,&#160;how&#160;to&#160;find the&#160;cells&#160;referencing a&#160;particular&#160;<br/>cell&#160;using the&#160;queryDependents() method, as&#160;well&#160;as&#160;how&#160;to&#160;find row&#160;and column&#160;differences&#160;using the&#160;<br/>queryRowDifferences() and queryColumnDifferences() methods.&#160;<br/>
The&#160;macro i<a href="libremacros.html#476">n&#160;Listing&#160;419&#160;c</a>onfigures&#160;the&#160;first&#160;sheet&#160;with values&#160;and formulas, and then the&#160;macro performs&#160;<br/>some&#160;queries.&#160;The&#160;code&#160;that&#160;performs&#160;the&#160;demonstrated&#160;queries&#160;is&#160;simple&#160;and short.&#160;The&#160;code&#160;that&#160;creates&#160;the<br/>data&#160;that&#160;is&#160;queried, however,&#160;is&#160;more&#160;complicated and instructive. &#160;More&#160;specifically,&#160;the&#160;macro i<a href="libremacros.html#476">n&#160;Listing&#160;<br/>419&#160;de</a>monstrates&#160;how&#160;to clear a&#160;range&#160;of cells&#160;by&#160;using&#160;the&#160;clearContents() method.&#160;The&#160;dialog produced b<a href="libremacros.html#476">y<br/>Listing 419&#160;i</a>s&#160;shown in<a href="libremacros.html#477">&#160;Figure&#160;100.&#160;</a><br/>
<i><b>Listing&#160;419.</b>&#160;Query&#160;a range&#160;of&#160;cells&#160;to&#160;find references, dependencies, and differences.<br/></i>Sub&#160;QueryCellRange<br/>&#160;&#160;Dim&#160;oCell&#160; &#160; &#160; &#160; &#160;'Holds a cell temporarily<br/>&#160;&#160;Dim&#160;oCellAddress&#160;&#160;'Holds a cell's address<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160;&#160;'The primary range<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;'The first sheet<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;&#160;'Temporary index variable<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160;'Temporary String<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;&#160;:&#160;oDoc&#160;=&#160;createNewCalcDoc()<br/>&#160;&#160;<br/>&#160;&#160;PopulateSheetForQuery(oDoc)<br/>
&#160;&#160;REM Sheets support returning a cell range based on UI type names.<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets(0)<br/>
&#160;&#160;REM Get the range I want to use! &#160;<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A1:F8&#34;)<br/>&#160;&#160;s&#160;=&#160;InputBox(&#34;Query which cell?&#34;,&#160;&#34;Enter Cell Address&#34;,&#160;&#34;C7&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM This includes cells &#34;C2:C7&#34;. Notice that it includes the cell itself<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(2,&#160;6)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;=SUM(C2:C6) directly references &#34;&#160;&amp;_<br/>&#160; &#160; &#160;oCell.queryPrecedents(False).getRangeAddressesAsString()&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160;<br/>&#160;&#160;REM This includes cells &#34;B2:B6;C2:C7&#34;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;=SUM(C2:C6) Including indirect references &#34;&#160;&amp;_<br/>&#160; &#160; &#160;oCell.queryPrecedents(True).getRangeAddressesAsString()&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160;<br/>&#160;&#160;REM Find direct and indirect references &#160;<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(1,&#160;2)&#160; &#160; &#160;'B3<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Cells that reference B3 &#34;&#160;&amp;_<br/>&#160; &#160; &#160;oCell.queryDependents(True).getRangeAddressesAsString()&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;oCellAddress&#160;=&#160;oCell.CellAddress<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Column differences for B3 &#34;&#160;&amp;_<br/>&#160; &#160; &#160;oRange.queryColumnDifferences(oCellAddress).getRangeAddressesAsString()<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Row differences for B3 &#34;&#160;&amp;_<br/>
473<br/>
<hr/>
<a name=477></a>&#160; &#160; &#160;oRange.queryRowDifferences(oCellAddress).getRangeAddressesAsString()<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160; &#160;<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Manipulating A Range&#34;<br/>End&#160;Sub<br/>
<i><b>Figure&#160;100.</b>&#160;Query&#160;a range&#160;of&#160;cells&#160;to&#160;find references, dependencies, and similarities.</i><br/>
<a href="libremacros.html#477">Table&#160;179&#160;s</a>hows&#160;the&#160;formulas&#160;and values&#160;created by&#160;the&#160;macro in<a href="libremacros.html#476">&#160;Listing 419, a</a>ssists&#160;in&#160;understanding the&#160;<br/>output&#160;shown in<a href="libremacros.html#477">&#160;Figure&#160;100.&#160;</a><br/>
<i><b>Table&#160;179.</b>&#160;The&#160;formulas&#160;and values&#160;set&#160;by<a href="libremacros.html#476">&#160;Listing 419.</a></i><br/>
<b>B</b><br/>
<b>C</b><br/>
<b>D</b><br/>
<b>E</b><br/>
<b>1</b><br/>
2<br/>
=B1-1<br/>
<b>2</b><br/>
1<br/>
=B2+1<br/>
=C2-1<br/>
<b>3</b><br/>
2<br/>
=B3+1<br/>
=C3-1<br/>
2<br/>
<b>4</b><br/>
3<br/>
=B4+1<br/>
=C4-1<br/>
<b>5</b><br/>
4<br/>
=B5+1<br/>
=C5-1<br/>
<b>6</b><br/>
5<br/>
=B6+1<br/>
=C6-1<br/>
<b>7</b><br/>
=SUM(B2:B5)<br/>
=SUM(C2:C6)<br/>
<b>8</b><br/>
2<br/>
2<br/>
<b>Query&#160;Precedents&#160;and&#160;Dependents<br/></b>The&#160;first&#160;line&#160;in<a href="libremacros.html#477">&#160;Figure&#160;100&#160;s</a>hows&#160;the&#160;result&#160;of queryPrecedents(False) on a&#160;range&#160;that&#160;contains&#160;only&#160;cell&#160;C7.&#160;<br/>As&#160;shown in<a href="libremacros.html#477">&#160;Table&#160;179, c</a>ell&#160;C7 directly&#160;references&#160;the&#160;cells&#160;C2:C6 and itself. By&#160;calling&#160;<br/>queryPrecedents(True)&#160;—&#160;the&#160;second line&#160;i<a href="libremacros.html#477">n&#160;Figure&#160;100&#160;—&#160;</a>the&#160;cells&#160;B2:B6 are&#160;added because&#160;the&#160;cells&#160;in&#160;<br/>column&#160;C reference&#160;the&#160;cells&#160;in&#160;column&#160;B.<br/>
The&#160;method&#160;queryDependents(True) provides&#160;the&#160;third line&#160;i<a href="libremacros.html#477">n&#160;Figure&#160;100, w</a>hich displays&#160;all&#160;of the&#160;cells&#160;that&#160;<br/>reference&#160;B3, directly&#160;or indirectly.<a href="libremacros.html#477">&#160;Table&#160;179&#160;s</a>hows&#160;that&#160;B3, B7, and C3 directly&#160;reference&#160;cell&#160;B3, and that&#160;<br/>cells&#160;C7&#160;and D3 indirectly&#160;reference&#160;cell&#160;B3.<br/>
474<br/>
<hr/>
<a name=478></a><b>Query&#160;Column&#160;Differences<br/></b>The&#160;fourth&#160;line&#160;i<a href="libremacros.html#477">n&#160;Figure&#160;100&#160;l</a>ists&#160;the&#160;“column&#160;differences”&#160;based on cell&#160;B3.&#160;While&#160;calculating column&#160;<br/>differences, only&#160;the&#160;row&#160;matters. In&#160;other words, the&#160;same&#160;result&#160;is&#160;returned if cell&#160;A3, C3, D3, or E3 is&#160;used<br/>instead of cell&#160;B<a href="libremacros.html#478">3.&#160;Figure&#160;101&#160;s</a>hows&#160;the&#160;sheet;&#160;the&#160;cells&#160;that&#160;are&#160;considered different&#160;are&#160;marked with a&#160;black<br/>backg<a href="libremacros.html#478">round.&#160;Figure&#160;101&#160;he</a>lps&#160;to&#160;illustrate&#160;what&#160;is,&#160;and is&#160;not,&#160;considered a&#160;difference. By&#160;choosing cell&#160;B3,&#160;<br/>all&#160;of the&#160;cells&#160;in&#160;each column (of the&#160;range) are&#160;compared to&#160;the&#160;cell&#160;in&#160;row&#160;3 (in the&#160;same&#160;column).&#160;The&#160;<br/>first&#160;column,&#160;A, has&#160;no cells&#160;selected&#160;because&#160;they&#160;are&#160;all&#160;empty;&#160;therefore, all&#160;the&#160;cells&#160;in&#160;the&#160;column have&#160;<br/>the&#160;same&#160;value. In&#160;column&#160;B, cell&#160;B3 contains&#160;the&#160;constant&#160;value&#160;of 2. Cells&#160;B1 and B8 also contain&#160;the&#160;<br/>constant&#160;value&#160;2, so these&#160;cells&#160;are&#160;not&#160;considered different. Column&#160;C is&#160;very&#160;interesting in that&#160;it&#160;does&#160;not&#160;<br/>contain&#160;constants, but&#160;rather it&#160;contains&#160;formulas&#160;that&#160;are&#160;similar.&#160;The&#160;cells&#160;C2, C4, C5,&#160;and C6 are&#160;similar to<br/>cell&#160;C3.&#160;The&#160;formulas&#160;are&#160;effectively&#160;the&#160;same&#160;(see<a href="libremacros.html#477">&#160;Table&#160;179) i</a>n that&#160;they&#160;all&#160;add 1 to&#160;the&#160;cell&#160;to the&#160;left.&#160;The<br/>formula&#160;in&#160;C1 is&#160;not&#160;similar&#160;to C3&#160;so it&#160;is&#160;included&#160;in the&#160;difference&#160;list.&#160;Column D&#160;is&#160;similar&#160;to column C&#160;<br/>and column&#160;E&#160;is&#160;similar to column B. I&#160;leave&#160;it&#160;as&#160;an exercise&#160;for the&#160;reader to&#160;explain&#160;the&#160;row&#160;differences&#160;as<br/>shown in<a href="libremacros.html#478">&#160;Figure&#160;101.</a><br/>
<i>Figure&#160;101.&#160;Output&#160;from<a href="libremacros.html#476">&#160;Listing&#160;419&#160;wi</a></i><i>th “column differences”&#160;highlighted.</i><br/>
<b>&#160;15.4.3.&#160;Searching&#160;and&#160;replacing<br/></b>The&#160;thing that&#160;I&#160;find most&#160;interesting&#160;about&#160;searching in&#160;a&#160;spreadsheet&#160;document&#160;is&#160;that&#160;searching is&#160;not&#160;<br/>supported&#160;by&#160;the&#160;document&#160;object.&#160;Cell&#160;object&#160;and cell&#160;range&#160;objects&#160;support&#160;searching, however.&#160;Each sheet&#160;<br/>is&#160;also a&#160;sheet&#160;range, so it’s&#160;possible&#160;to&#160;search an entire&#160;sheet.&#160;It&#160;is&#160;not&#160;possible, therefore, to&#160;search an entire&#160;<br/>document&#160;at&#160;one&#160;time;&#160;you&#160;must&#160;search each sheet&#160;separately.<a href="libremacros.html#478">&#160;Listing 420<b>&#160;</b></a>demonstrates&#160;searching&#160;and&#160;<br/>replacing text&#160;in&#160;a&#160;single&#160;sheet.<br/>
<i><b>Listing&#160;420.</b>&#160;Simple&#160;Calc&#160;search.<br/></i>Sub&#160;SearchSheet<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160;&#160;'Sheet in which to replace<br/>&#160;&#160;Dim&#160;oReplace&#160;&#160;'Replace descriptor<br/>&#160;&#160;Dim&#160;nCount&#160; &#160;&#160;'Number of times replaced<br/>&#160;&#160;<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.Sheets(3)<br/>&#160;&#160;oReplace&#160;=&#160;oSheet.createReplaceDescriptor()<br/>&#160;&#160;oReplace.setSearchString(&#34;Xyzzy&#34;)<br/>&#160;&#160;oReplace.setReplaceString(&#34;Something Else&#34;)<br/>&#160;&#160;oReplace.SearchWords&#160;=&#160;False<br/>&#160;&#160;nCount&#160;=&#160;oSheet.replaceAll(oReplace)<br/>&#160;&#160;MsgBox&#160;&#34;Replaced &#34;&#160;&amp;&#160;nCount<br/>End&#160;Sub<br/>
475<br/>
<hr/>
<a name=479></a>Searching&#160;a&#160;sheet&#160;in&#160;a&#160;Calc&#160;document&#160;is&#160;almost&#160;identical&#160;to searching&#160;for text&#160;in a&#160;Writer document.&#160;In&#160;a&#160;<br/>Calc&#160;document, setting&#160;SearchWords&#160;to&#160;True&#160;forces&#160;the&#160;entire&#160;cell&#160;to contain&#160;the&#160;search text. In&#160;a&#160;Writer&#160;<br/>document,&#160;setting SearchWords&#160;to&#160;True&#160;forces&#160;the&#160;text&#160;to&#160;not&#160;be&#160;part&#160;of another word.&#160;<br/>
<b>Tip</b><br/>
In&#160;a&#160;Calc&#160;document,&#160;setting&#160;SearchWords to&#160;True&#160;forces the&#160;entire&#160;cell&#160;to contain the&#160;search text.<br/>
<b>&#160;15.4.4.&#160;Merging&#160;cells<br/></b>Use&#160;the&#160;merge&#160;method to&#160;merge&#160;and unmerge&#160;a&#160;range&#160;of cells.&#160;After merging the&#160;range&#160;B2:D7, cell&#160;B2&#160;<br/>appears&#160;in the&#160;area&#160;formerly&#160;used by&#160;the&#160;entire&#160;range.&#160;What&#160;is&#160;not&#160;shown in<a href="libremacros.html#479">&#160;Figure&#160;102&#160;i</a>s&#160;that&#160;the&#160;cells&#160;that&#160;<br/>aren’t&#160;visible&#160;still&#160;exist&#160;and are&#160;accessible;&#160;they&#160;are&#160;simply&#160;not&#160;displayed. Use&#160;the&#160;getIsMerged() method&#160;to&#160;<br/>determine&#160;if all&#160;of the&#160;cells&#160;in&#160;a&#160;range&#160;are&#160;merged.<br/>
<i><b>Listing&#160;421.</b>&#160;Merge&#160;a range&#160;of&#160;cells.</i><br/>
Sub&#160;MergeExperiment<br/>&#160;&#160;Dim&#160;oCell&#160; &#160; &#160; &#160; &#160;'Holds a cell temporarily<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160;&#160;'The primary range<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;'The first sheet<br/>
&#160;&#160;REM Merge a range of cells<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.Sheets(0)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;B2:D7&#34;)<br/>&#160;&#160;oRange.merge(True)<br/>&#160;&#160;<br/>&#160;&#160;REM Now obtain a cell that was merged<br/>&#160;&#160;REM and I can do it!<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(2,&#160;3)&#160; &#160; &#160;'C4<br/>&#160;&#160;Print&#160;oCell.getValue()<br/>End&#160;Sub<br/>
<i>Figure&#160;102.&#160;Merging cells&#160;causes&#160;the&#160;top-left&#160;cell&#160;to&#160;use&#160;the&#160;entire&#160;merged area.</i><br/>
<b>&#160;15.4.5.&#160;Retrieving,&#160;inserting,&#160;and&#160;deleting&#160;columns&#160;and&#160;rows<br/></b>Use&#160;the&#160;methods&#160;getColumns() and getRows() to retrieve&#160;columns&#160;and rows&#160;covered by&#160;cells&#160;and cell&#160;ranges.<br/>After retrieving the&#160;columns&#160;for a&#160;range&#160;or a&#160;cell,&#160;you&#160;can retrieve&#160;the&#160;individual&#160;columns&#160; by&#160;using&#160;the&#160;<br/>interfaces&#160;XElementAccess&#160;or XindexAccess.&#160;You can use&#160;two additional&#160;methods&#160;—&#160;insertByIndex(index,&#160;<br/>count) and removeByIndex(index, count)&#160;—&#160;to&#160;insert&#160;and remove&#160;columns.&#160;After obtaining a&#160;single&#160;column,&#160;<br/>you&#160;can get&#160;the&#160;column’s&#160;name&#160;with getName(), set&#160;cell&#160;properties&#160;for the&#160;entire&#160;column, and extract&#160;cells&#160;by<br/>using the&#160;cell&#160;range&#160;methods&#160;in<a href="libremacros.html#474">&#160;Table&#160;176.</a><br/>
476<br/>
<hr/>
<a name=480></a>All&#160;of the&#160;manipulations&#160;mentioned for columns&#160;—&#160;except&#160;for getName()&#160;—&#160;also apply&#160;to the&#160;rows&#160;obtained&#160;<br/>by&#160;using&#160;the&#160;getRows() method.&#160;The&#160;difference&#160;lies&#160;in&#160;the&#160;properties&#160;supported by&#160;the&#160;individual&#160;columns&#160;<br/>and rows&#160;(see<a href="libremacros.html#480">&#160;Table&#160;180).</a><br/>
<i><b>Table&#160;180.</b>&#160;Individual&#160;row and column properties.</i><br/>
<i><b>Type</b></i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Column<br/>
Width<br/>
Width of&#160;the&#160;column (in 0.01&#160;mm)&#160;as a&#160;Long&#160;Integer.<br/>
Row<br/>
Height<br/>
Height&#160;of&#160;the&#160;row&#160;(in 0.01 mm)&#160;as a&#160;Long Integer.<br/>
Column<br/>
OptimalWidth<br/>
If&#160;True,&#160;the&#160;column&#160;always&#160;keeps&#160;its&#160;optimal&#160;width.<br/>
Row<br/>
OptimalHeight<br/>
If&#160;True,&#160;the&#160;row&#160;always keeps its&#160;optimal&#160;height.<br/>
Both<br/>
IsVisible<br/>
If&#160;True,&#160;the&#160;row&#160;or&#160;column&#160;is visible.<br/>
Both<br/>
IsStartOfNewPage<br/>
If&#160;True,&#160;a&#160;horizontal&#160;(vertical)&#160;page&#160;break is&#160;attached&#160;to the&#160;column&#160;(row).<br/>
The&#160;macro i<a href="libremacros.html#480">n&#160;Listing&#160;422<b>&#160;</b></a>obtains&#160;the&#160;range&#160;“B6:C9”&#160;and then traverses&#160;all&#160;of the&#160;nonempty&#160;cells.&#160;The&#160;hard&#160;<br/>part&#160;is&#160;done&#160;in&#160;the&#160;routine&#160;NonEmptyCellsInRange() as&#160;shown in<a href="libremacros.html#475">&#160;Listing 418</a><a href="libremacros.html#480">.&#160;Listing 422, ho</a>wever,&#160;<br/>demonstrates&#160;how&#160;to extract&#160;the&#160;individual&#160;rows&#160;from&#160;a&#160;range.&#160;Typically,&#160;when writing a&#160;macro, you know&#160;<br/>where&#160;the&#160;data&#160;lies&#160;so you&#160;simply&#160;write&#160;code&#160;to traverse&#160;the&#160;data&#160;directly.<a href="libremacros.html#481">&#160;Figure&#160;103<b>&#160;</b></a>shows&#160;the&#160;output<a href="libremacros.html#480">&#160;from<br/>Listing 422&#160;w</a>hen the&#160;macro is&#160;run using&#160;the&#160;data&#160;shown in<a href="libremacros.html#478">&#160;Figure&#160;101.</a><br/>
<i><b>Listing&#160;422.</b>&#160;Enumerate&#160;rows&#160;in a range&#160;and find&#160;nonempty&#160;cells.</i><br/>
Sub&#160;TraverseRows<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160;&#160;'The primary range<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;'The fourth sheet<br/>&#160;&#160;Dim&#160;oRows&#160; &#160; &#160; &#160; &#160;'Rows object<br/>&#160;&#160;Dim&#160;oRow&#160; &#160; &#160; &#160; &#160;&#160;'A single row<br/>&#160;&#160;Dim&#160;oRowEnum&#160; &#160; &#160;&#160;'Enumerator for the rows<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160;'General String Variable<br/>&#160;&#160;<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.Sheets(3)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;B6:C9&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM I now want to find ALL of the cells that are NOT empty in the<br/>&#160;&#160;REM rows that are related to the range. Notice that I do not want to<br/>&#160;&#160;REM limit myself to cells in the range, but that I am interested in the<br/>&#160;&#160;REM rows.<br/>&#160;&#160;oRows&#160;&#160;=&#160;oRange.getRows()<br/>&#160;&#160;REM Sure, I could access things by index, but you probably expected that!<br/>&#160;&#160;oRowEnum&#160;=&#160;oRows.createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oRowEnum.hasMoreElements()<br/>&#160; &#160;&#160;oRow&#160;=&#160;oRowEnum.nextElement()<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;NonEmptyCellsInRange(oRow,&#160;&#34; &#160;&#34;)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Loop<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Non-Empty Cells In Rows&#34;<br/>End&#160;Sub<br/>
477<br/>
<hr/>
<a name=481></a><i>Figure&#160;103.&#160;The&#160;nonempty&#160;cells&#160;are&#160;displayed from&#160;rows&#160;6 through 8.</i><br/>
<b>&#160;15.4.6.&#160;Retrieving&#160;and&#160;setting&#160;data&#160;as&#160;an&#160;array<br/></b>You can quickly&#160;and easily&#160;obtain&#160;all&#160;data&#160;from&#160;a&#160;range&#160;as&#160;an array&#160;of arrays&#160;by&#160;using the&#160;getDataArray()&#160;<br/>method.&#160;The&#160;data&#160;in each cell&#160;is&#160;returned as&#160;either a&#160;number or a&#160;string.&#160;You can also set&#160;the&#160;data&#160;for a&#160;range&#160;<br/>by&#160;using&#160;the&#160;setDataArray() method;&#160;just&#160;be&#160;certain that&#160;the&#160;array&#160;dimensions&#160;match&#160;the&#160;range&#160;dimensions&#160;<br/>(see<a href="libremacros.html#481">&#160;Listing 423)</a>.<br/>
<i><b>Listing&#160;423.</b>&#160;Get&#160;and set&#160;data in&#160;a Calc&#160;sheet.<br/></i>Sub&#160;GetAndSetData<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160;&#160;'The primary range<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;'The fourth sheet<br/>&#160;&#160;Dim&#160;oAllData&#160; &#160; &#160;&#160;'Array containing the data<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160;'General string variable<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;&#160;'General index variable<br/>&#160;&#160;<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.Sheets(3)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;B6:E8&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Get the data contained in the range!<br/>&#160;&#160;REM Data from empty cells is included.<br/>&#160;&#160;oAllData&#160;=&#160;oRange.getDataArray()<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;UBound(oAllData)<br/>&#160; &#160;&#160;REM oAllData(i) is an array, so simply join the data together<br/>&#160; &#160;&#160;REM for a quick printing!<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;(&#34;&#160;&amp;&#160;Join(oAllData(i),&#160;&#34;) (&#34;)&#160;&amp;&#160;&#34;)&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Data In Range&#34;<br/>
&#160;&#160;REM Now quickly set some data. &#160;<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;F1:G2&#34;)<br/>&#160;&#160;oRange.setDataArray(Array(Array(1,&#160;&#34;One&#34;),&#160;Array(2,&#160;&#34;Two&#34;)))<br/>End&#160;Sub<br/>
<b>Tip</b><br/>
As&#160;of&#160;Calc&#160;3.0,&#160;the&#160;maximum&#160;number&#160;of&#160;columns&#160;is 1024&#160;(column is&#160;AMJ),&#160;the&#160;maximum&#160;number&#160;of&#160;rows&#160;<br/>is 65,536,&#160;and&#160;the&#160;maximum&#160;number&#160;cells in a&#160;sheet&#160;is 67,108,864.&#160;Laurent&#160;Godard&#160;performed tests and&#160;<br/>
increased&#160;the&#160;number&#160;for&#160;testing&#160;purposes:&#160;see<br/><a href="http://blogs.nuxeo.com/dev/2006/08/the-spreadsheet-next.html">http://blogs.nuxeo.com/dev/2006/08/the-spreadsheet-next.html&#160;<br/></a><a href="http://wiki.services.openoffice.org/wiki/Calc/hacks/number_of_rows">http://wiki.services.openoffice.org/wiki/Calc/hacks/number_of_rows&#160;</a><br/>
478<br/>
<hr/>
<a name=482></a>Sheet&#160;cell&#160;ranges&#160;also provide&#160;the&#160;ability&#160;to&#160;get&#160;and set&#160;formulas&#160;in bulk&#160;using arrays. Use&#160;the&#160;methods&#160;<br/>getFormulaArray() and setFormulaArray()&#160;to&#160;get&#160;and set&#160;the&#160;formulas&#160;in&#160;a&#160;range&#160;as&#160;an array&#160;—&#160;these&#160;two&#160;<br/>methods&#160;can be&#160;a&#160;real&#160;time&#160;saver.<br/>
If&#160;you&#160;inspect&#160;a&#160;sheet&#160;range, you will&#160;notice&#160;that&#160;a&#160;sheet&#160;supports&#160;getData() and getDataArray(). Both&#160;<br/>methods&#160;return an array&#160;of arrays.&#160;The&#160;method getDataArray&#160;returns&#160;numbers&#160;and strings.&#160;The&#160;getData&#160;<br/>method&#160;defined&#160;by&#160;the&#160;XChartData&#160;interface, however,&#160;returns&#160;numbers&#160;and ignores&#160;strings.<br/>
<b>&#160;15.4.7.&#160;Computing&#160;functions&#160;on&#160;a&#160;range<br/></b>It’s&#160;possible&#160;to&#160;compute&#160;a&#160;value&#160;based on a&#160;specified range&#160;(see<a href="libremacros.html#475">&#160;Listing 418&#160;a</a><a href="libremacros.html#480">nd&#160;Listing 422)</a>, but&#160;it&#160;is&#160;<br/>tedious.&#160;You can use&#160;the&#160;getDataArray() method&#160;(see<a href="libremacros.html#481">&#160;Listing 423)</a>&#160;to&#160;quickly&#160;obtain all&#160;of the&#160;data&#160;and&#160;<br/>simply&#160;process&#160;the&#160;data&#160;in&#160;the&#160;nested arrays.&#160;To&#160;easily&#160;apply&#160;a&#160;simple&#160;function&#160;to&#160;a&#160;range, use&#160;the&#160;object&#160;<br/>method&#160;computeFunction(GeneralFuncti<a href="libremacros.html#482">on).&#160;Table&#160;181&#160;l</a>ists&#160;the&#160;functions&#160;supported&#160;by&#160;the&#160;GeneralFunction&#160;<br/>enumeration.<br/>
<i><b>Table&#160;181.</b>&#160;The&#160;com.sun.star.sheet.GeneralFunction&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.GeneralFunction.NONE<br/>
Nothing&#160;is&#160;calculated.<br/>
com.sun.star.sheet.GeneralFunction.AUTO<br/>
Use&#160;SUM if&#160;all&#160;values are&#160;numerical;&#160;otherwise&#160;use&#160;COUNT.<br/>
com.sun.star.sheet.GeneralFunction.SUM<br/>
Sum&#160;(add)&#160;all&#160;of&#160;the&#160;numerical&#160;values.<br/>
com.sun.star.sheet.GeneralFunction.COUNT<br/>
Count&#160;all&#160;of&#160;the&#160;values.<br/>
com.sun.star.sheet.GeneralFunction.AVERAGE<br/>
Average&#160;all&#160;of&#160;the&#160;numerical&#160;values.<br/>
com.sun.star.sheet.GeneralFunction.MAX<br/>
Maximum&#160;numerical&#160;value.<br/>
com.sun.star.sheet.GeneralFunction.MIN<br/>
Minimum&#160;numerical&#160;value.<br/>
com.sun.star.sheet.GeneralFunction.PRODUCT<br/>
Product&#160;(multiplication)&#160;of&#160;all&#160;the&#160;numerical&#160;values.<br/>
com.sun.star.sheet.GeneralFunction.COUNTNUMS<br/>
Count&#160;the&#160;numerical&#160;values.<br/>
com.sun.star.sheet.GeneralFunction.STDEV<br/>
Standard&#160;deviation based on a&#160;sample.&#160;&#160;<br/>
com.sun.star.sheet.GeneralFunction.STDEVP<br/>
Standard&#160;deviation based on the&#160;entire&#160;population. &#160;<br/>
com.sun.star.sheet.GeneralFunction.VAR<br/>
Variance&#160;based&#160;on a&#160;sample.&#160;&#160;<br/>
com.sun.star.sheet.GeneralFunction.VARP<br/>
Variance&#160;based&#160;on the&#160;entire&#160;population. &#160;<br/>
The&#160;macro i<a href="libremacros.html#482">n&#160;Listing&#160;424&#160;de</a>monstrates&#160;the&#160;use&#160;of the&#160;compute&#160;function. Using the&#160;sheet&#160; shown in<a href="libremacros.html#478">&#160;Figure&#160;<br/>101&#160;a</a>nd the&#160;macro i<a href="libremacros.html#482">n&#160;Listing&#160;424, t</a>here&#160;are&#160;seven nonempty&#160;cells&#160;in the&#160;range&#160;A5:C9.<br/>
<i><b>Listing&#160;424.</b>&#160;Compute&#160;a function&#160;on a range.<br/></i>Sub&#160;UseCompute<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160;&#160;'The primary range<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;'The fourth sheet<br/>&#160;&#160;Dim&#160;d&#160;As&#160;Double&#160; &#160;'Return value<br/>&#160;&#160;<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.Sheets(3)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A5:C9&#34;)<br/>&#160;&#160;d&#160;=&#160;oRange.computeFunction(com.sun.star.sheet.GeneralFunction.COUNT)<br/>&#160;&#160;MsgBox&#160;&#34;Non-Empty cells in A5:C9 = &#34;&#160;&amp;&#160;d,&#160;0,&#160;&#34;ComputFuntion()&#34;<br/>End&#160;Sub<br/>
479<br/>
<hr/>
<a name=483></a><b>&#160;15.4.8.&#160;Clearing&#160;cells&#160;and&#160;cell&#160;ranges<br/></b>In&#160;a&#160;Calc&#160;document, click on a&#160;cell&#160;and press&#160;the&#160;Delete&#160;key.&#160;A&#160;dialog opens&#160;with&#160;a&#160;list&#160;of things&#160;that&#160;can be&#160;<br/>deleted.&#160;The&#160;ability&#160;to delete&#160;any&#160;combination&#160;of things&#160;from&#160;different&#160;types&#160;of content&#160;or formatting is&#160;<br/>amazingly&#160;powerful&#160;and flexible.&#160;The&#160;types&#160;of things&#160;that&#160;can be&#160;deleted are&#160;encapsulated by&#160;the&#160;CellFlags&#160;<br/>shown in<a href="libremacros.html#474">&#160;Table&#160;177. Ce</a>llFlags&#160;may&#160;be&#160;combined&#160;using the&#160;OR operator and passed to&#160;the&#160;<br/>clearContents(CellFlags) method (see<a href="libremacros.html#476">&#160;Listing&#160;419).</a><br/>
<b>Tip</b><br/>
The&#160;clearContents()&#160;method is&#160;supported&#160;by&#160;cells, cell&#160;ranges,&#160;and&#160;even rows&#160;and&#160;columns.<br/>
<b>&#160;15.4.9.&#160;Automatic&#160;data&#160;fill<br/></b><a href="libremacros.html#476">Listing 419&#160;pa</a>infully&#160;fills&#160;consecutive&#160;cells&#160;with&#160;data. Sheet&#160;cell&#160;ranges&#160;provide&#160;a&#160;better method for&#160;<br/>automatically&#160;filling a&#160;range&#160;with data&#160;by&#160;using the&#160;fillAuto(FillDirection,&#160;nCount) method.&#160;The&#160;<br/>FillDirection&#160;enumerated values&#160;shown in<a href="libremacros.html#483">&#160;Table&#160;182&#160;c</a>ontrol&#160;how&#160;the&#160;data&#160;is&#160;propagated.<br/>
<i><b>Table&#160;182.</b>&#160;The&#160;com.sun.star.sheet.FillDirection&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.FillDirection.TO_BOTTOM<br/>
Rows&#160;are&#160;filled&#160;from&#160;top&#160;to bottom.<br/>
com.sun.star.sheet.FillDirection.TO_RIGHT<br/>
Columns&#160;are&#160;filled&#160;from&#160;left&#160;to right.<br/>
com.sun.star.sheet.FillDirection.TO_TOP<br/>
Rows&#160;are&#160;filled&#160;from&#160;bottom&#160;to top.<br/>
com.sun.star.sheet.FillDirection.TO_LEFT<br/>
Columns&#160;are&#160;filled&#160;from&#160;right&#160;to left.<br/>
Use&#160;the&#160;method fillAuto(FillDirection, nCount) to&#160;automatically&#160;fill&#160;an area. First,&#160;select&#160;the&#160;range&#160;that&#160;you&#160;<br/>want&#160;to fill.&#160;Second, set&#160;the&#160;initial&#160;value&#160;that&#160;will&#160;be&#160;incremented&#160;by&#160;the&#160;fillAuto() method.&#160;The&#160;location&#160;of&#160;<br/>the&#160;initial&#160;values&#160;depend on the&#160;direction&#160;that&#160;will&#160;be&#160;filled. For example,&#160;if using&#160;TO_LEFT,&#160;the&#160;rightmost&#160;<br/>cells&#160;in&#160;the&#160;range&#160;must&#160;contain an initial&#160;value&#160;so that&#160;they&#160;can be&#160;filled to&#160;the&#160;left.<br/>
While&#160;filling new&#160;values, the&#160;fillAuto() method&#160;increments&#160;the&#160;number by&#160;1 while&#160;moving to the&#160;right&#160;or&#160;<br/>bottom,&#160;and decrements&#160;the&#160;number by&#160;1 while&#160;moving&#160;to&#160;the&#160;left&#160;or top. If&#160;the&#160;number is&#160;formatted as&#160;a&#160;<br/>time&#160;or date, incrementing&#160;by&#160;1 adds&#160;one&#160;day.<br/>
<b>Tip</b><br/>
When&#160;a&#160;time&#160;is incremented&#160;using&#160;fillAuto(), it&#160;is incremented&#160;by&#160;one&#160;day.&#160;If&#160;the&#160;cell&#160;is formatted to&#160;show&#160;<br/>
only&#160;the&#160;time, it&#160;will&#160;appear&#160;as though the&#160;value&#160;does not&#160;change&#160;—&#160;although it&#160;has.&#160;This should&#160;be&#160;obvious<br/>if&#160;you&#160;think about&#160;it.<br/>
The&#160;fillAuto() method uses&#160;the&#160;last&#160;argument,&#160;nCount,&#160;to determine&#160;how&#160;many&#160;cells&#160;to&#160;move&#160;before&#160;entering&#160;<br/>a&#160;new&#160;value.&#160;A&#160;value&#160;of 1, therefore, fills&#160;every&#160;cell&#160;as&#160;the&#160;cursor moves.&#160;While&#160;filling new&#160;cells, the&#160;<br/>fillAuto() method won’t&#160;move&#160;outside&#160;the&#160;range&#160;used to call&#160;fillAuto().&#160;The&#160;code&#160;snippet&#160;i<a href="libremacros.html#483">n&#160;Listing&#160;425&#160;<br/></a>assumes&#160;that&#160;Sheet&#160;3 contains&#160;numerical&#160;values&#160;in&#160;the&#160;cell&#160;range&#160;E11:E20.<br/>
<i><b>Listing&#160;425.</b>&#160;Fill&#160;values&#160;from&#160;E11:N20 using&#160;fillAuto.<br/></i>oSheet&#160;=&#160;ThisComponent.Sheets(3)<br/>oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;E11:N20&#34;)<br/>oRange.fillAuto(com.sun.star.sheet.FillDirection.TO_RIGHT,&#160;1)<br/>
OOo also supports&#160;more&#160;complicated fill&#160;methods.&#160;The&#160;FillMode&#160;enumeration (see<a href="libremacros.html#484">&#160;Table&#160;183) di</a>rects&#160;the&#160;<br/>special&#160;functionality&#160;provided&#160;by&#160;the&#160;method&#160;fillSeries().&#160;The&#160;fillAuto() method always&#160;uses&#160;the&#160;LINEAR&#160;<br/>mode&#160;to&#160;increment&#160;the&#160;value&#160;by&#160;one, whereas&#160;the&#160;fillSeries() method allows&#160;for any&#160;fill&#160;mode.<br/>
480<br/>
<hr/>
<a name=484></a><i><b>Table&#160;183.</b>&#160;The&#160;com.sun.star.sheet.FillMode&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.FillMode.SIMPLE<br/>
All&#160;of&#160;the&#160;values are&#160;the&#160;same&#160;(constant&#160;series).<br/>
com.sun.star.sheet.FillMode.LINEAR<br/>
The&#160;values change&#160;by&#160;a&#160;constant&#160;increment&#160;(arithmetic&#160;series).<br/>
com.sun.star.sheet.FillMode.GROWTH<br/>
The&#160;values change&#160;by&#160;a&#160;constant&#160;multiple&#160;(geometric&#160;series).<br/>
com.sun.star.sheet.FillMode.DATE<br/>
An&#160;arithmetic&#160;series for&#160;date&#160;values.&#160;This causes all&#160;numbers to be&#160;treated&#160;<br/>as dates, regardless of&#160;formatting.<br/>
com.sun.star.sheet.FillMode.AUTO<br/>
The&#160;cells&#160;are&#160;filled from&#160;a&#160;user-defined&#160;list.<br/>
The&#160;fillSeries() method recognizes&#160;dates&#160;and times&#160;based on the&#160;numerical&#160;format&#160;used to&#160;display&#160;them.&#160;<br/>Using&#160;the&#160;FillMode&#160;DATE&#160;forces&#160;all&#160;numbers&#160;to&#160;be&#160;recognized as&#160;dates&#160;rather than&#160;just&#160;numbers&#160;that&#160;are&#160;<br/>formatted as&#160;dates.&#160;When a&#160;date&#160;is&#160;filled, the&#160;day,&#160;month,&#160;or year can be&#160;changed as&#160;specified by&#160;the&#160;<br/>FillDateMode&#160;enumerated&#160;values&#160;(see<a href="libremacros.html#484">&#160;Table&#160;184)</a>.<br/>
<i><b>Table&#160;184.</b>&#160;The&#160;com.sun.star.sheet.FillDateMode&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.FillDateMode.FILL_DATE_DAY&#160;<br/>
Increment&#160;the&#160;day&#160;by&#160;1.<br/>
com.sun.star.sheet.FillDateMode.FILL_DATE_WEEKDAY&#160;<br/>
Increment&#160;the&#160;day&#160;by&#160;1&#160;but&#160;skip Saturday&#160;and Sunday.<br/>
com.sun.star.sheet.FillDateMode.FILL_DATE_MONTH&#160;<br/>
Increment&#160;the&#160;month (the&#160;day&#160;is&#160;unchanged).<br/>
com.sun.star.sheet.FillDateMode.FILL_DATE_YEAR&#160;<br/>
Increment&#160;the&#160;year&#160;(the&#160;day&#160;and&#160;month are&#160;unchanged).<br/>
The&#160;method&#160;fillSeries(FillDirection,&#160;FillMode, FillDateMode, nStep,&#160;nEndValue) provides&#160;the&#160;greatest&#160;<br/>flexibility&#160;for filling&#160;values.&#160;The&#160;nStep&#160;value&#160;indicates&#160;how&#160;the&#160;value&#160;is&#160;modified from&#160;cell&#160;to&#160;cell.&#160;The&#160;final&#160;<br/>argument&#160;specifies&#160;a&#160;final&#160;value&#160;not&#160;to exceed during the&#160;fill.&#160;The&#160;fillSeries() method will&#160;not&#160;modify&#160;a&#160;value<br/>outside&#160;of the&#160;range&#160;and stops&#160;adding values&#160;when passing the&#160;end value.&#160;While&#160;specifying&#160;an end value,&#160;<br/>remember that&#160;dates&#160;expressed as&#160;a&#160;regular number are&#160;rather large;&#160;40000 refers&#160;to July<a href="libremacros.html#484">&#160;6, 2009.&#160;Listing&#160;426<br/></a>uses&#160;the&#160;fillSeries() method&#160;to&#160;fill&#160;a&#160;range&#160;of dates.<br/>
<b>Tip</b><br/>
The&#160;fillAuto()&#160;method increments or&#160;decrements the&#160;value&#160;depending&#160;on the&#160;direction in which the&#160;values&#160;<br/>
are&#160;filled.&#160;The&#160;fillSeries()&#160;method,&#160;however,&#160;always uses the&#160;nStep&#160;value&#160;regardless of&#160;the&#160;direction.<br/>
<i><b>Listing&#160;426.</b>&#160;Fill&#160;values&#160;from&#160;E11:N20 using&#160;fillSeries().</i><br/>
oSheet&#160;=&#160;ThisComponent.Sheets(3)<br/>oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;E11:N20&#34;)<br/>oRange.fillSeries(com.sun.star.sheet.FillDirection.TO_LEFT,_<br/>&#160;&#160;com.sun.star.sheet.FillMode.LINEAR,_<br/>&#160;&#160;com.sun.star.sheet.FillDateMode.FILL_DATE_DAY,2,&#160;40000)<br/>
If&#160;text&#160;containing a&#160;number is&#160;found in an initial&#160;cell,&#160;the&#160;copied value&#160;copies&#160;the&#160;text&#160;and increments&#160;the&#160;<br/>rightmost&#160;number in&#160;the&#160;text.&#160;For&#160;example, I&#160;entered the&#160;text&#160;“Text&#160;1”&#160;and the&#160;filled&#160;text&#160;contained “Text&#160;3”,&#160;<br/>“Text&#160;5”, and so on.<br/>
<b>&#160;15.4.10.&#160;Array&#160;formulas<br/></b>The&#160;simplest&#160;usage&#160;of an array&#160;formula&#160;that&#160;I&#160;have&#160;seen involves&#160;placing an array&#160;formula&#160;in&#160;one&#160;cell&#160;and&#160;<br/>using the&#160;formula&#160;in multiple&#160;cells.&#160;Now&#160;that&#160;I&#160;have&#160;provided just&#160;enough detail&#160;to&#160;cause&#160;confusion,&#160;consider<br/>the&#160;simple&#160;example&#160;shown i<a href="libremacros.html#485">n&#160;Table&#160;185.</a><br/>
481<br/>
<hr/>
<a name=485></a><i><b>Table&#160;185.</b>&#160;A&#160;simple&#160;formula in&#160;column I.</i><br/>
<b>F</b><br/>
<b>G</b><br/>
<b>H</b><br/>
<b>I</b><br/>
<b>J</b><br/>
<b>K</b><br/>
<b>3</b><br/>
1<br/>
3<br/>
=G3+H3<br/>
<b>4</b><br/>
2<br/>
4<br/>
=G4+H4<br/>
<b>5</b><br/>
3<br/>
5<br/>
=G5+H5<br/>
<b>6</b><br/>
4<br/>
6<br/>
=G6+H6<br/>
<b>7</b><br/>
5<br/>
7<br/>
=G7+H7<br/>
<b>8</b><br/>
6<br/>
8<br/>
=G8+H8<br/>
Column I&#160;contains&#160;the&#160;formula&#160;to add column G&#160;to column H.&#160;This&#160;can be&#160;done&#160;using an array&#160;formula&#160;by&#160;<br/>entering one&#160;formula&#160;in&#160;one&#160;cell.&#160;To&#160;enter an array&#160;formula&#160;into&#160;column&#160;J&#160;that&#160;mimics&#160;the&#160;formula&#160;in&#160;column&#160;<br/>I,&#160;first&#160;place&#160;the&#160;cursor in&#160;cell&#160;J3.&#160;Enter the&#160;formula&#160;“=G3:G8+H3:H8”&#160;and then&#160;press&#160;Ctrl-Shift-Enter.&#160;The&#160;<br/>cells&#160;J3 through J8 now&#160;contain&#160;the&#160;single&#160;formula&#160;“{=G3:G8+H3:H8}”&#160;and the&#160;values&#160;in&#160;column&#160;J&#160;should&#160;<br/>match&#160;those&#160;in column I.&#160;Column I&#160;contains&#160;six&#160;formulas&#160;that&#160;are&#160;not&#160;directly&#160;related to&#160;each other,&#160;but&#160;the&#160;<br/>cells&#160;in&#160;column&#160;J&#160;use&#160;only&#160;one&#160;formula.&#160;The&#160;macro in<a href="libremacros.html#485">&#160;Listing 427&#160;s</a>ets&#160;a&#160;sheet&#160;to look&#160;like<a href="libremacros.html#485">&#160;Table&#160;185&#160;a</a>nd then<br/>sets&#160;column&#160;J&#160;to contain an array&#160;formula&#160;that&#160;calculates&#160;the&#160;same&#160;values&#160;as&#160;column&#160;I.<br/>
<i><b>Listing&#160;427.</b>&#160;Demonstrate&#160;an array&#160;formula.<br/></i>Sub&#160;ArrayFormula<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160;&#160;'The primary range<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;'The fourth sheet<br/>&#160;&#160;Dim&#160;oCell&#160; &#160; &#160; &#160; &#160;'Holds a cell temporarily<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160;&#160;'General Index Variable<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;&#160;'Reference newly created calc document.<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#34;private:factory/scalc&#34;,&#160;&#34;_default&#34;,&#160;0,&#160;Array())<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets(0)<br/>&#160;&#160;<br/>&#160;&#160;REM Set the two top cells in G3:H8<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(6,&#160;2)&#160; &#160; &#160;'Cell G3<br/>&#160;&#160;oCell.setValue(1)<br/>&#160;&#160;<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(7,&#160;2)&#160; &#160; &#160;'Cell H3<br/>&#160;&#160;oCell.setValue(3)<br/>&#160;&#160;<br/>&#160;&#160;REM Fill the values down!<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;G3:H8&#34;)<br/>&#160;&#160;oRange.fillAuto(com.sun.star.sheet.FillDirection.TO_BOTTOM,&#160;1)<br/>
&#160;&#160;REM This demonstrates setting each cell individually.<br/>&#160;&#160;For&#160;i&#160;=&#160;3&#160;To&#160;8<br/>&#160; &#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(8,&#160;i-1)&#160; &#160; &#160;'Cell I3 - I8<br/>&#160; &#160;&#160;oCell.setFormula(&#34;=G&#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34;+H&#34;&#160;&amp;&#160;i)<br/>&#160;&#160;Next<br/>&#160;&#160;<br/>&#160;&#160;REM Setting a single array formula is much easier in this case.<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;J3:J8&#34;)<br/>&#160;&#160;oRange.setArrayFormula(&#34;=G3:G8+H3:H8&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Add some headings!<br/>
482<br/>
<hr/>
<a name=486></a>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;G2:J2&#34;)<br/>&#160;&#160;oRange.setDataArray(Array(Array(&#34;G&#34;,&#160;&#34;H&#34;,&#160;&#34;Formula&#34;,&#160;&#34;Array Formula&#34;)))<br/>End&#160;Sub<br/>
<b>&#160;15.4.11.&#160;Computing&#160;multiple&#160;functions&#160;on&#160;a&#160;range<br/></b>OOo supports&#160;using a&#160;series&#160;of single&#160;variable&#160;formulas&#160;against&#160;a&#160;series&#160;of values.&#160;A&#160;typical&#160;example&#160;&#160;<br/>involves&#160;a&#160;single&#160;column&#160;(or row) of numbers&#160;with&#160;adjacent&#160;columns&#160;(or rows) containing formulas&#160;using&#160;<br/>the&#160;numbers.&#160;The&#160;enumerated&#160;values&#160;i<a href="libremacros.html#486">n&#160;Table&#160;186<b>&#160;</b></a>specify&#160;if rows&#160;or columns&#160;are&#160;used.<br/>
<i><b>Table&#160;186.</b>&#160;The&#160;com.sun.star.sheet.TableOperationMode&#160;enumeration</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.TableOperationMode.COLUMN&#160;<br/>
Apply&#160;the&#160;operation down&#160;the&#160;columns.<br/>
com.sun.star.sheet.TableOperationMode.ROW&#160;<br/>
Apply&#160;the&#160;operation across&#160;the&#160;rows.<br/>
com.sun.star.sheet.TableOperationMode.BOTH&#160;<br/>
Apply&#160;the&#160;operation to both rows and columns.<br/>
The&#160;setTableOperation() method&#160;provides&#160;the&#160;ability&#160;to quickly&#160;apply&#160;multiple&#160;single&#160;variable&#160;functions&#160;to&#160;<br/>the&#160;same&#160;set&#160;of data&#160;producing a&#160;table&#160;of values. &#160;The&#160;method&#160;setTableOperation() accepts&#160;four arguments&#160;as&#160;<br/>follows:<br/>
1.&#160;CellRangeAddress — Cell range address that contains the functions to apply.<br/>2.&#160;TableOperationMode — Identifies if the data is in rows or columns (see<a href="libremacros.html#486"> Table 186).<br/></a>3.&#160;CellAddress — Cell address that is used if using columns (row mode or both).<br/>4.&#160;CellAddress — Cell address that is used if using rows (column mode or both).<br/>
The&#160;macro i<a href="libremacros.html#486">n&#160;Listing&#160;428&#160;g</a>enerates&#160;a&#160;column of numbers&#160;from&#160;0 to&#160;6.3, the&#160;functions&#160;Sin() and Cos() are&#160;<br/>then applied to&#160;the&#160;columns.<br/>
<i><b>Listing&#160;428.</b>&#160;Use&#160;setTableOperation&#160;to quickly&#160;set&#160;an operation&#160;on a column.<br/></i>Sub&#160;MultipleOpsColumns<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160;&#160;'The primary range<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;'The fourth sheet<br/>&#160;&#160;Dim&#160;oCell&#160; &#160; &#160; &#160; &#160;'Holds a cell temporarily<br/>&#160;&#160;Dim&#160;oBlockAddress&#160;'Address of the block to fill<br/>&#160;&#160;Dim&#160;oCellAddress&#160;&#160;'Row or column cell<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;&#160;'Reference newly created calc document.<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#34;private:factory/scalc&#34;,&#160;&#34;_default&#34;,&#160;0,&#160;Array())<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets(0)<br/>&#160;&#160;<br/>&#160;&#160;REM Set the top-most value!<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(0,&#160;9)&#160; &#160; &#160;'Cell A10<br/>&#160;&#160;oCell.setValue(0)<br/>&#160;&#160;<br/>&#160;&#160;REM Fill the values down! for 0 to 6.4<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A10:A74&#34;)<br/>&#160;&#160;oRange.fillSeries(com.sun.star.sheet.FillDirection.TO_BOTTOM,_<br/>&#160; &#160;&#160;com.sun.star.sheet.FillMode.LINEAR,_<br/>&#160; &#160;&#160;com.sun.star.sheet.FillDateMode.FILL_DATE_DAY,&#160;0.1,&#160;6.4)<br/>
483<br/>
<hr/>
<a name=487></a>&#160;&#160;REM Now set the Sin() and Cos() Header values<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(1,&#160;8)&#160; &#160; &#160;'Cell B9<br/>&#160;&#160;oCell.setString(&#34;Sin()&#34;)<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(2,&#160;8)&#160; &#160; &#160;'Cell C9<br/>&#160;&#160;oCell.setString(&#34;Cos()&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Now set the Sin() and Cos() formulas<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(1,&#160;9)&#160; &#160; &#160;'Cell B10<br/>&#160;&#160;oCell.setFormula(&#34;=Sin(A10)&#34;)<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(2,&#160;9)&#160; &#160; &#160;'Cell C10<br/>&#160;&#160;oCell.setFormula(&#34;=Cos(A10)&#34;)<br/>
&#160;&#160;REM Obtain the entire block on which to operate.<br/>&#160;&#160;oRange&#160;=&#160;&#160;oSheet.getCellRangeByName(&#34;A11:C74&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Obtain the address that contains the formulas to copy.<br/>&#160;&#160;oBlockAddress&#160;=&#160;oSheet.getCellRangeByName(&#34;B10:C10&#34;).getRangeAddress()<br/>&#160;&#160;<br/>&#160;&#160;REM The address of the cell that contains the column of data.<br/>&#160;&#160;oCellAddress&#160;=&#160;oSheet.getCellByPosition(0,&#160;9).getCellAddress()<br/>&#160;&#160;<br/>&#160;&#160;REM I really only need the column value because the row value is not used.<br/>&#160;&#160;oRange.setTableOperation(oBlockAddress,_<br/>&#160; &#160;&#160;com.sun.star.sheet.TableOperationMode.COLUMN,_<br/>&#160; &#160;&#160;oCellAddress,&#160;oCellAddress)<br/>End&#160;Sub<br/>
If&#160;the&#160;table&#160;operation mode&#160;is&#160;set&#160;to&#160;BOTH&#160;rather than&#160;just&#160;ROW&#160;or COLUMN, then a&#160;single&#160;function is&#160;<br/>applied&#160;to two variables.&#160;The&#160;macro i<a href="libremacros.html#487">n&#160;Listing&#160;429&#160;c</a>reates&#160;the&#160;multiplication table&#160;that&#160;I&#160;memorized in&#160;third&#160;<br/>grade.<br/>
<i><b>Listing&#160;429.</b>&#160;Use&#160;a table&#160;operation&#160;to create&#160;a multiplication&#160;table<br/></i>Sub&#160;createMultiplicationTableWrapper()<br/>&#160;&#160;createMultiplicationTable()&#160;<br/>End Sub<br/>
Function&#160;createMultiplicationTable()&#160;<br/>&#160; Dim&#160;oRowCell&#160; &#160; &#160;&#160;'The row cell<br/>&#160; Dim&#160;oColCell&#160; &#160; &#160;&#160;'The column cell<br/>&#160; Dim&#160;oRange&#160; &#160; &#160; &#160;&#160;'The primary range<br/>&#160; Dim&#160;oSheet&#160; &#160; &#160; &#160;&#160;'The fourth sheet<br/>&#160; Dim&#160;oCell&#160; &#160; &#160; &#160; &#160;'Holds a cell temporarily<br/>&#160; Dim&#160;oBlockAddress&#160;'Address of the block to fill<br/>&#160; Dim&#160;oCellAddress&#160;&#160;'Row or column cell &#160;<br/>&#160; Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;&#160;'Reference newly created calc document.<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;= StarDesktop.loadComponentFromURL(&#34;private:factory/scalc&#34;,&#160;&#34;_default&#34;,&#160;0, Array())<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets(0)<br/>&#160;&#160;<br/>&#160;&#160;REM Set the row of constant values<br/>&#160;&#160;oRowCell&#160;=&#160;oSheet.getCellByPosition(1,&#160;9) &#160; &#160;'Cell B10<br/>&#160;&#160;oRowCell.setValue(1)<br/>
484<br/>
<hr/>
<a name=488></a>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;B10:K10&#34;)<br/>&#160;&#160;oRange.fillAuto(com.sun.star.sheet.FillDirection.TO_RIGHT,&#160;1)<br/>&#160;&#160;oRange.CharWeight&#160;=&#160;com.sun.star.awt.FontWeight.BOLD<br/>&#160;&#160;oRange.CharHeight&#160;=&#160;14<br/>&#160;&#160;<br/>&#160;&#160;REM Set the column of constant values<br/>&#160;&#160;oColCell&#160;=&#160;oSheet.getCellByPosition(0,&#160;10) &#160;&#160;'Cell A11<br/>&#160;&#160;oColCell.setValue(1)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A11:A20&#34;)<br/>&#160;&#160;oRange.fillAuto(com.sun.star.sheet.FillDirection.TO_BOTTOM,&#160;1)<br/>&#160;&#160;oRange.CharWeight&#160;=&#160;com.sun.star.awt.FontWeight.BOLD<br/>&#160;&#160;oRange.CharHeight&#160;=&#160;14<br/>
&#160;&#160;REM Set the formula that will be used. It references the first values!<br/>&#160;&#160;oCell&#160;=&#160;oSheet.getCellByPosition(0,&#160;9) &#160; &#160;'Cell A10<br/>&#160;&#160;oCell.setFormula(&#34;=A11*B10&#34;)<br/>
&#160;&#160;REM Get the range of the cells &#160;<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A10:K20&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Fill the multiplication tables for the values 1x1 through 10x10<br/>&#160;&#160;oRange.setTableOperation(oRange.getRangeAddress(),_<br/>&#160; &#160;&#160;com.sun.star.sheet.TableOperationMode.BOTH,_<br/>&#160; &#160;&#160;oColCell.getCellAddress(),_<br/>&#160; &#160;&#160;oRowCell.getCellAddress())<br/>&#160;&#160;createMultiplicationTable() &#160;=&#160;oDoc<br/>End Function<br/>
<b>&#160;15.4.12.&#160;Cells&#160;with&#160;the&#160;same&#160;formatting<br/></b>Sheet&#160;cell&#160;ranges&#160;provide&#160;two methods&#160;for obtaining groups&#160;of cells&#160;that&#160;contain the&#160;same&#160;format.&#160;The&#160;<br/>getCellFormatRanges() method&#160;returns&#160;an object&#160;that&#160;supports&#160;both index&#160;and enumeration access.&#160;The&#160;<br/>equally&#160;formatted&#160;cells&#160;are&#160;split&#160;into multiple&#160;rectangular ranges.&#160;The&#160;enumerated&#160;ranges&#160;are&#160;returned as&#160;a&#160;<br/>SheetCellRange&#160;object.<br/>
The&#160;object&#160;method&#160;getUniqueCellFormatRanges() is&#160;very&#160;similar to&#160;the&#160;method getCellFormatRanges()&#160;<br/>except&#160;that&#160;the&#160;returned values&#160;are&#160;objects&#160;of type&#160;SheetCellRanges.&#160;The&#160;primary&#160;difference&#160;is&#160;that&#160;all&#160;of the&#160;<br/>similarly&#160;formatted objects&#160;are&#160;returned in&#160;one&#160;container.&#160;The&#160;macro in<a href="libremacros.html#488">&#160;Listing 430<b>&#160;</b></a>displays&#160;the&#160;similarly&#160;<br/>formatted ranges&#160;using&#160;the&#160;two different&#160;methods.<br/>
<i><b>Listing&#160;430.</b>&#160;Use&#160;two&#160;different&#160;methods&#160;to&#160;display&#160;groups&#160;of&#160;cells&#160;that&#160;contain&#160;the&#160;same&#160;format..<br/></i>Sub&#160;DisplaySimilarRanges<br/>&#160;&#160;Dim&#160;oSheetCellRange&#160;&#160;'An individual sheet cell range<br/>&#160;&#160;Dim&#160;oSheetCellRanges&#160;'Sheet cell ranges<br/>&#160;&#160;Dim&#160;oAddr&#160; &#160; &#160; &#160; &#160; &#160;&#160;'An address object from the sheet cell range<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Utility string variable<br/>&#160;&#160;Dim&#160;x&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'The returned range objects are stored here<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Utility index variable<br/>&#160;&#160;Dim&#160;oSheet<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Reference newly created calc document.<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;createMultiplicationTable()<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets(0)<br/>
485<br/>
<hr/>
<a name=489></a>&#160;&#160;<br/>&#160;&#160;REM Do this for the entire sheet!<br/>&#160;&#160;x&#160;=&#160;oSheet.getCellFormatRanges()<br/>&#160;&#160;s&#160;=&#160;&#34;**** getCellFormatRanges()&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;x.getcount()-1<br/>&#160; &#160;&#160;oSheetCellRange&#160;=&#160;x.getByIndex(i)<br/>&#160; &#160;&#160;oAddr&#160;=&#160;oSheetCellRange.getRangeAddress()<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;prettyRangeAddressName(oAddr)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;<br/>&#160;&#160;REM SheetCellRanges<br/>&#160;&#160;x&#160;=&#160;oSheet.getUniqueCellFormatRanges()<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;**** getUniqueCellFormatRanges()&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;x.getcount()-1<br/>&#160; &#160;&#160;oSheetCellRanges&#160;=&#160;x.getByIndex(i)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;i&#160;&amp;&#160;&#34; = &#34;&amp;&#160;oSheetCellRanges.getRangeAddressesAsString()&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Like Ranges&#34;<br/>End&#160;Sub<br/>
<a href="libremacros.html#489">Figure&#160;104<b>&#160;</b></a>demonstrates&#160;very&#160;clearly&#160;the&#160;difference&#160;between the&#160;two methods.&#160;The&#160;getCellFormatRanges()&#160;<br/>method&#160;continually&#160;lists&#160;the&#160;rectangular ranges&#160;that&#160;are&#160;formatted similarly:&#160;with&#160;each change&#160;of format&#160;a&#160;<br/>new&#160;range&#160;starts.&#160;The&#160;getUniqueCellFormatRanges() method&#160;groups&#160;the&#160;found ranges&#160;in containers&#160;that&#160;<br/>contain&#160;ranges&#160;of similar&#160;format.&#160;So out&#160;of the&#160;seven ranges&#160;there&#160;are&#160;five&#160;(index&#160;0) resp. two (index&#160;1) that&#160;<br/>are&#160;formatted&#160;similarly.&#160;Both&#160;methods&#160;contain the&#160;same&#160;ranges;&#160;it&#160;is&#160;only&#160;a&#160;question of grouping.<br/>
<i>Figure&#160;104.&#160;The&#160;two&#160;methods&#160;group the&#160;data differently.</i><br/>
486<br/>
<hr/>
<a name=490></a><b>&#160;15.4.13.&#160;Sorting<br/></b>In&#160;general, OOo knows&#160;what&#160;type&#160;of data&#160;a&#160;cell&#160;contains. Knowledge&#160;of the&#160;contained data&#160;types&#160;reduces&#160;the&#160;<br/>need to&#160;inform&#160;OOo of the&#160;type&#160;of data&#160;that&#160;it&#160;is&#160;sorting, but&#160;it&#160;is&#160;still&#160;possible&#160;using the&#160;TableSortFieldType&#160;<br/>enumeration&#160;(see<a href="libremacros.html#490">&#160;Table&#160;187)</a>.&#160;When&#160;you&#160;request&#160;a&#160;sort&#160;operation,&#160;an array&#160;of&#160;TableSortField structures&#160;<br/>identifies&#160;which columns&#160;or rows&#160;are&#160;used to&#160;determine&#160;the&#160;sort&#160;order and how&#160;they&#160;are&#160;sorted&#160;(see<a href="libremacros.html#490">&#160;Table&#160;<br/>188)</a>.<br/>
<i><b>Table&#160;187.</b>&#160;The&#160;com.sun.star.table.TableSortFieldType&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.table.TableSortFieldType.AUTOMATIC&#160;<br/>
Automatically&#160;determine&#160;the&#160;data&#160;type.<br/>
com.sun.star.table.TableSortFieldType.NUMERIC&#160;<br/>
Sort&#160;the&#160;data&#160;as a&#160;number.<br/>
com.sun.star.table.TableSortFieldType.ALPHANUMERIC&#160;<br/>
Sort&#160;the&#160;data&#160;as text.<br/>
<i><b>Table&#160;188.</b>&#160;The&#160;com.sun.star.table.TableSortField structure.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Field<br/>
Zero-based index of&#160;the&#160;row&#160;or&#160;column&#160;in&#160;the&#160;table&#160;to sort.&#160;The&#160;index&#160;is relative&#160;to the&#160;<br/>
start&#160;of&#160;the&#160;sort&#160;range.<br/>
IsAscending<br/>
If&#160;True, sort&#160;the&#160;data&#160;in ascending&#160;order.<br/>
IsCaseSensitive<br/>
If&#160;True, the&#160;sort&#160;is&#160;case&#160;sensitive.<br/>
FieldType<br/>
Specify&#160;the&#160;data&#160;type&#160;as a&#160;TableSortFieldType&#160;(see<a href="libremacros.html#490">&#160;Table&#160;187)</a>.<br/>
CollatorLocale<br/>
The&#160;Locale&#160;object&#160;to use&#160;when sorting&#160;text.<br/>
CollatorAlgorithm<br/>
The&#160;sorting&#160;algorithm&#160;used&#160;by&#160;the&#160;collator&#160;when&#160;sorting&#160;text. Check the&#160;interface&#160;<br/>
com.sun.star.i18n.XCollator&#160;to&#160;investigate&#160;what&#160;algorithms&#160;are&#160;supported&#160;for&#160;your&#160;locale.&#160;<br/>I&#160;have&#160;always used&#160;the&#160;default&#160;value.<br/>
When&#160;you&#160;request&#160;a&#160;sort&#160;operation,&#160;an array&#160;of properties&#160;is&#160;passed to the&#160;sort&#160;routine.&#160;The&#160;properties&#160;<br/>determine&#160;what&#160;to&#160;sort&#160;and how&#160;it&#160;is&#160;sorted.&#160;One&#160;of the&#160;supported&#160;properties&#160;is&#160;SortFields&#160;(see<a href="libremacros.html#490">&#160;Table&#160;189)</a>,&#160;<br/>which&#160;contains&#160;the&#160;array&#160;of&#160;TableSortField structures&#160;that&#160;determine&#160;how&#160;the&#160;rows&#160;or columns&#160;are&#160;sorted.<br/>
<i><b>Table&#160;189.</b>&#160;The&#160;old&#160;way&#160;to&#160;specify&#160;a sort&#160;using&#160;a SortDescriptor.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
IsCaseSensitive<br/>
If&#160;True, the&#160;sort&#160;is&#160;case&#160;sensitive.<br/>
SortAscending<br/>
If&#160;True, sort&#160;the&#160;data&#160;in ascending&#160;order.&#160;This property&#160;typically&#160;is not&#160;used, because&#160;the&#160;<br/>TableSortField specifies&#160;IsAscending&#160;for&#160;each&#160;field.<br/>
SortColumns<br/>
If&#160;True, columns&#160;are&#160;sorted. If&#160;False,&#160;rows are&#160;sorted.<br/>
CollatorLocale<br/>
The&#160;Locale&#160;object&#160;to use&#160;when sorting&#160;text&#160;(usually&#160;set&#160;in the&#160;TableSortField).<br/>
CollatorAlgorithm<br/>
Sorting&#160;algorithm&#160;to use&#160;(usually&#160;set&#160;in the&#160;TableSortField).<br/>
SortFields<br/>
Array&#160;of&#160;type&#160;TableSortField (see<a href="libremacros.html#490">&#160;Table&#160;188)</a>&#160;that&#160;directs what&#160;is&#160;sorted.<br/>
MaxSortFieldsCount<br/>
Long&#160;Integer&#160;that&#160;specifies&#160;the&#160;maximum&#160;number&#160;of&#160;sort&#160;fields the&#160;descriptor&#160;can hold.&#160;This&#160;<br/>value&#160;cannot&#160;be&#160;set, but&#160;it&#160;can be&#160;read.&#160;<br/>
ContainsHeader<br/>
If&#160;True, the&#160;first&#160;row&#160;or&#160;column&#160;is&#160;considered&#160;a&#160;header&#160;and is&#160;not&#160;sorted.&#160;<br/>
Orientation<br/>
This property&#160;is deprecated and&#160;should no longer&#160;be&#160;used!<br/>
487<br/>
<hr/>
<a name=491></a><a href="libremacros.html#490">Table&#160;188&#160;and&#160;Table&#160;189&#160;r</a>eveal&#160;that&#160;there&#160;is&#160;a&#160;great&#160;deal&#160;of redundancy.&#160;For example, you can specify&#160;if&#160;the&#160;<br/>sort&#160;is&#160;case&#160;sensitive&#160;either globally&#160;(using<a href="libremacros.html#490">&#160;Table&#160;189) o</a>r for each specific&#160;field&#160;(using<a href="libremacros.html#490">&#160;Table&#160;188).&#160;</a>Although&#160;<br/>the&#160;redundant&#160;fields&#160;in<a href="libremacros.html#490">&#160;Table&#160;189&#160;a</a>re&#160;not&#160;required and are&#160;therefore&#160;typically&#160;not&#160;used, a&#160;new&#160;set&#160;of sort&#160;<br/>descriptors&#160;has&#160;been introduced (see<a href="libremacros.html#491">&#160;Table&#160;190)</a>.&#160;Although you&#160;can use&#160;properties&#160;from<a href="libremacros.html#490">&#160;Table&#160;189&#160;o</a><a href="libremacros.html#491">r&#160;Table&#160;<br/>190, y</a>ou&#160;cannot&#160;mix&#160;the&#160;two. My&#160;recommendation&#160;is&#160;that&#160;you&#160;use&#160;the&#160;new&#160;set&#160;i<a href="libremacros.html#491">n&#160;Table&#160;190;</a>&#160;the&#160;OO&#160;<br/>development&#160;team&#160;has&#160;already&#160;deprecated&#160;the&#160;use&#160;of the&#160;Orientation&#160;property&#160;i<a href="libremacros.html#490">n&#160;Table&#160;189.</a><br/>
<i><b>Table&#160;190.</b>&#160;The&#160;new way&#160;to specify&#160;a sort&#160;using a SortDescriptor2.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
SortFields<br/>
Array&#160;of&#160;type&#160;TableSortField (see<a href="libremacros.html#490">&#160;Table&#160;188)</a>&#160;that&#160;directs what&#160;is&#160;sorted.<br/>
MaxSortFieldsCount<br/>
Long&#160;Integer&#160;that&#160;specifies&#160;the&#160;maximum&#160;number&#160;of&#160;sort&#160;fields the&#160;descriptor&#160;can hold.&#160;This&#160;<br/>value&#160;cannot&#160;be&#160;set, but&#160;it&#160;can be&#160;read.&#160;<br/>
IsSortColumns<br/>
If&#160;True, columns&#160;are&#160;sorted. If&#160;False,&#160;rows are&#160;sorted.<br/>
BindFormatsToContent<br/>
If&#160;True, cell&#160;formats are&#160;moved&#160;with&#160;the&#160;contents during&#160;the&#160;sort.&#160;This&#160;property&#160;matters only&#160;<br/>
if&#160;different&#160;cells in the&#160;sort&#160;range&#160;use&#160;different&#160;formatting.<br/>
IsUserListEnabled<br/>
If&#160;True, a&#160;user-defined&#160;sorting&#160;list&#160;is&#160;used&#160;from&#160;the&#160;GlobalSheetSettings.<br/>
UserListIndex<br/>
Specify&#160;which user-defined&#160;sorting&#160;list&#160;is&#160;used&#160;as a&#160;Long&#160;Integer.<br/>
CopyOutputData<br/>
If&#160;True, the&#160;sorted&#160;data&#160;is copied&#160;to another&#160;position in the&#160;document.<br/>
OutputPosition<br/>
CellAddress that&#160;specifies&#160;where&#160;to copy&#160;the&#160;sorted&#160;data&#160;(if&#160;CopyOutputData&#160;is&#160;True).<br/>
ContainsHeader<br/>
If&#160;True, the&#160;first&#160;row&#160;or&#160;column&#160;is&#160;considered&#160;a&#160;header&#160;and is&#160;not&#160;sorted.<br/>
The&#160;first&#160;step in&#160;sorting a&#160;range&#160;is&#160;to&#160;define&#160;the&#160;fields&#160;on which to&#160;sort&#160;by&#160;using an array&#160;of type&#160;SortField.&#160;<br/>Next,&#160;define&#160;the&#160;properties&#160;from<a href="libremacros.html#491">&#160;Table&#160;190&#160;t</a>hat&#160;you&#160;intend to&#160;use&#160;in&#160;the&#160;sort. Finally,&#160;call&#160;the&#160;sort() routine&#160;<br/>on the&#160;range&#160;to&#160;sort.&#160;The&#160;macro in<a href="libremacros.html#491">&#160;Listing 431&#160;pe</a>rforms&#160;a&#160;descending sort&#160;on the&#160;first&#160;column.<br/>
<i><b>Listing&#160;431.</b>&#160;Sort&#160;one&#160;column in a Calc&#160;sheet.<br/></i>Sub&#160;SortColZero<br/>&#160;&#160;Dim&#160;oSheet<br/>&#160;&#160;Dim&#160;oRange<br/>&#160;&#160;Dim&#160;oSortFields(0)&#160;as&#160;new&#160;com.sun.star.util.SortField<br/>&#160;&#160;Dim&#160;oSortDesc(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>
&#160;&#160;oSheet&#160;=&#160;ThisComponent.Sheets(0)<br/>&#160;&#160;REM Set the range on which to sort<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;B28:D33&#34;)<br/>
&#160;&#160;REM Sort on the first field in the range<br/>&#160;&#160;oSortFields(0).Field&#160;=&#160;0<br/>&#160;&#160;oSortFields(0).SortAscending&#160;=&#160;FALSE<br/>
&#160;&#160;REM Set the sort fields to use<br/>&#160;&#160;oSortDesc(0).Name&#160;=&#160;&#34;SortFields&#34;<br/>&#160;&#160;oSortDesc(0).Value&#160;=&#160;oSortFields()<br/>&#160;&#160;<br/>&#160;&#160;REM Now sort the range!<br/>&#160;&#160;oRange.Sort(oSortDesc())<br/>End&#160;Sub<br/>
488<br/>
<hr/>
<a name=492></a>Sorting on two columns&#160;rather than just&#160;one&#160;is&#160;as&#160;easy&#160;as&#160;adding a&#160;second sort&#160;fiel<a href="libremacros.html#492">d.&#160;Listing&#160;432&#160;s</a>orts&#160;on the&#160;<br/>second and third columns.<br/>
<i><b>Listing&#160;432.</b>&#160;Sort&#160;two columns&#160;in a Calc&#160;sheet.<br/></i>Sub&#160;SortColOne<br/>&#160;&#160;Dim&#160;oSheet<br/>&#160;&#160;Dim&#160;oRange<br/>&#160;&#160;Dim&#160;oSortFields(1)&#160;as&#160;new&#160;com.sun.star.util.SortField<br/>&#160;&#160;Dim&#160;oSortDesc(0)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>
&#160;&#160;oSheet&#160;=&#160;ThisComponent.Sheets(0)<br/>
&#160;&#160;REM Set the range on which to sort<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;B28:D33&#34;)<br/>
&#160;&#160;REM Sort on the second field in the range<br/>&#160;&#160;oSortFields(0).Field&#160;=&#160;1<br/>&#160;&#160;oSortFields(0).SortAscending&#160;=&#160;True<br/>&#160;&#160;oSortFields(0).FieldType&#160;=&#160;com.sun.star.util.SortFieldType.NUMERIC<br/>
&#160;&#160;REM Sort on the third field in the range<br/>&#160;&#160;oSortFields(1).Field&#160;=&#160;2<br/>&#160;&#160;oSortFields(1).SortAscending&#160;=&#160;True<br/>&#160;&#160;oSortFields(1).FieldType&#160;=&#160;com.sun.star.util.SortFieldType.ALPHANUMERIC<br/>
&#160;&#160;REM Set the sort fields to use<br/>&#160;&#160;oSortDesc(0).Name&#160;=&#160;&#34;SortFields&#34;<br/>&#160;&#160;oSortDesc(0).Value&#160;=&#160;oSortFields()<br/>&#160;&#160;<br/>&#160;&#160;REM Now sort the range!<br/>&#160;&#160;oRange.Sort(oSortDesc())<br/>End&#160;Sub<br/>
The&#160;method&#160;createSortDescriptor() returns&#160;an array&#160;of property&#160;values&#160;that&#160;define&#160;how&#160;a&#160;sort&#160;should occur.&#160;<br/>Inspecting&#160;this&#160;created&#160;sort&#160;descriptor&#160;indicates&#160;that&#160;you&#160;can use&#160;a&#160;maximum&#160;of three&#160;fields&#160;when sorting (see<br/>the&#160;MaxSortFieldsCount&#160;in<a href="libremacros.html#491">&#160;Table&#160;190)</a>.&#160;The&#160;macro i<a href="libremacros.html#492">n&#160;Listing&#160;433&#160;c</a>reates&#160;a&#160;sort&#160;descriptor and then displays&#160;<br/>the&#160;properties&#160;that&#160;it&#160;contains&#160;(see<a href="libremacros.html#493">&#160;Figure&#160;105)</a>.<br/>
<i>Listing&#160;433.&#160;Display&#160;sort&#160;descriptor&#160;properties&#160;in Calc.</i><br/>
Sub&#160;DisplaySortDescriptor<br/>&#160;&#160;On&#160;Error&#160;Resume&#160;Next<br/>&#160;&#160;Dim&#160;oSheet<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160;' A range is needed to create the sort descriptor.<br/>&#160;&#160;Dim&#160;oSortDescript<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;&#160;'Reference newly created calc document.<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#34;private:factory/scalc&#34;,&#160;&#34;_default&#34;,&#160;0,&#160;Array())<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets(0)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;B28:D33&#34;)<br/>&#160;&#160;oSortDescript&#160;=&#160;oRange.createSortDescriptor()<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(oSortDescript)&#160;To&#160;UBound(oSortDescript)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oSortDescript(i).Name&#160;&amp;&#160;&#34; = &#34;<br/>
489<br/>
<hr/>
<a name=493></a>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;oSortDescript(i).Value<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Sort Descriptor&#34;<br/>End&#160;Sub<br/>
<i>Figure&#160;105.&#160;Sort&#160;descriptor&#160;attributes.</i><br/>
<i><b>&#160;15.5.&#160;Sheets<br/></b></i>Most&#160;of a&#160;Calc&#160;document’s&#160;functionality&#160;is&#160;contained&#160;in the&#160;individual&#160;sheets&#160;rather than the&#160;document&#160;as&#160;a&#160;<br/>whole.&#160;The&#160;interfaces&#160;implemented by&#160;the&#160;spreadsheet&#160;document&#160;(see<a href="libremacros.html#456">&#160;Table&#160;160)</a>&#160;are&#160;primarily&#160;related&#160;to the&#160;<br/>document&#160;as&#160;a&#160;whole,&#160;rather than&#160;the&#160;individual&#160;sheets.&#160;<br/>
The&#160;sheets&#160;in a&#160;Calc&#160;document&#160;implement&#160;the&#160;SheetCellRange&#160;service, which provides&#160;extensive&#160;<br/>functionality.&#160;The&#160;functionality&#160;provided by&#160;sheet&#160;cell&#160;ranges&#160;applies&#160;to&#160;any&#160;sheet&#160;cell&#160;range&#160;and is&#160;not&#160;<br/>limited&#160;to sheets. In&#160;other words, any&#160;range&#160;is&#160;able&#160;to use&#160;the&#160;methods&#160;implemented&#160;by&#160;the&#160;SheetCellRange&#160;<br/>service.&#160;The&#160;individual&#160;sheets&#160;support&#160;other interfaces&#160;that&#160;are&#160;not&#160;directly&#160;related&#160;to sheet&#160;cell&#160;ranges&#160;(se<a href="libremacros.html#494">e<br/>Table&#160;191)</a>.<br/>
490<br/>
<hr/>
<a name=494></a><i><b>Table&#160;191.</b>&#160;Interfaces&#160;implemented by&#160;the&#160;com.sun.star.sheet.Spreadsheet&#160;service.</i><br/>
<i><b>Interfaces</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.XSpreadsheet<br/>
Methods to create&#160;a&#160;cell&#160;cursor.<br/>
com.sun.star.container.XNamed<br/>
Access the&#160;spreadsheet&#160;name.<br/>
com.sun.star.util.XProtectable<br/>
Methods to protect&#160;and unprotect&#160;the&#160;individual&#160;sheet.<br/>
com.sun.star.sheet.XDataPilotTablesSupplier<br/>
Access the&#160;DataPilot&#160;tables with&#160;the&#160;method&#160;<br/>getDataPilotTables().&#160;In&#160;LibreOffice,&#160;the&#160;Data&#160;Pilot&#160;is called&#160;<br/>
Pivot&#160;Tables.<br/>
com.sun.star.sheet.XScenariosSupplier<br/>
Access the&#160;scenarios with&#160;the&#160;method&#160;getScenarios().<br/>
com.sun.star.sheet.XSheetAnnotationsSupplier<br/>
Access the&#160;annotations with the&#160;method getAnnotations().<br/>
com.sun.star.drawing.XDrawPageSupplier<br/>
Access the&#160;sheet’s&#160;draw&#160;page&#160;with the&#160;method getDrawPage().<br/>
com.sun.star.table.XTableChartsSupplier<br/>
Access the&#160;document’s&#160;chart&#160;objects with&#160;the&#160;method&#160;<br/>getCharts().<br/>
com.sun.star.sheet.XCellRangeMovement<br/>
Move&#160;cell&#160;ranges inside&#160;the&#160;sheet&#160;or&#160;to other&#160;spreadsheets in this&#160;<br/>document.<br/>
com.sun.star.sheet.XPrintAreas<br/>
Access to the&#160;print-area&#160;settings of&#160;this sheet.&#160;<br/>
com.sun.star.sheet.XSheetPageBreak<br/>
Access and&#160;modify&#160;the&#160;page&#160;breaks in this sheet.<br/>
com.sun.star.sheet.XScenario<br/>
Provide&#160;methods for&#160;a&#160;scenario&#160;sheet.<br/>
com.sun.star.sheet.XSheetOutline<br/>
Access the&#160;row&#160;and column outline&#160;settings&#160;for&#160;the&#160;sheet.<br/>
com.sun.star.sheet.XSheetAuditing<br/>
Look for&#160;linked cells (detective).<br/>
com.sun.star.sheet.XSheetLinkable<br/>
Methods to link to existing&#160;sheets in&#160;other&#160;documents.<br/>
<b>&#160;15.5.1.&#160;Linking&#160;to&#160;an&#160;external&#160;spreadsheet<br/></b>An individual&#160;sheet&#160;may&#160;link to&#160;a&#160;sheet&#160;from&#160;another spreadsheet&#160;document. Linking causes&#160;the&#160;“link sheet”&#160;<br/>to act&#160;as&#160;a&#160;container for the&#160;“linked&#160;sheet.”&#160;After linking to a&#160;sheet, although you&#160;can modify&#160;the&#160;linked&#160;sheet<br/>in the&#160;container,&#160;these&#160;updates&#160;are&#160;not&#160;propagated back to&#160;the&#160;original&#160;document.&#160;If&#160;the&#160;linked sheet&#160;is&#160;<br/>changed in&#160;the&#160;original&#160;document,&#160;the&#160;change&#160;is&#160;not&#160;visible&#160;in the&#160;link&#160;document&#160;unless&#160;the&#160;link itself is&#160;<br/>refreshed.&#160;You can link documents&#160;by&#160;using&#160;one&#160;of the&#160;enumerated values&#160;in<a href="libremacros.html#494">&#160;Table&#160;192.</a><br/>
<i><b>Table&#160;192.</b>&#160;Values&#160;supported by&#160;the&#160;com.sun.star.sheet.SheetLinkMode&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.SheetLinkMode.NONE<br/>
The&#160;sheet&#160;is&#160;not&#160;linked.<br/>
com.sun.star.sheet.SheetLinkMode.NORMAL<br/>
Copy&#160;the&#160;entire&#160;content&#160;including&#160;values and&#160;<br/>formulas.<br/>
com.sun.star.sheet.SheetLinkMode.VALUE<br/>
Copy&#160;the&#160;content&#160;by&#160;value;&#160;each formula’s&#160;returned&#160;<br/>value&#160;is copied&#160;rather&#160;than the&#160;formula&#160;itself.<br/>
Use&#160;the&#160;link() method&#160;to establish a&#160;link with&#160;a&#160;sheet&#160;in another document.<a href="libremacros.html#494">&#160;Table&#160;193&#160;l</a>ists&#160;the&#160;link-related&#160;<br/>methods&#160;supported by&#160;a&#160;sheet.<br/>
<i><b>Table&#160;193.</b>&#160;Methods&#160;defined by&#160;the&#160;com.sun.star.sheet.XSheetLinkable&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getLinkMode()<br/>
Get&#160;the&#160;sheet’s&#160;link&#160;mode&#160;(see<a href="libremacros.html#494">&#160;Table&#160;192)</a>.<br/>
491<br/>
<hr/>
<a name=495></a><i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getLinkMode(SheetLinkMode)<br/>
Set&#160;the&#160;link mode&#160;(see<a href="libremacros.html#494">&#160;Table&#160;192)</a>.<br/>
getLinkUrl()<br/>
Get&#160;the&#160;link&#160;URL.<br/>
setLinkUrl(url)<br/>
Set&#160;the&#160;link URL.<br/>
getLinkSheetName()<br/>
Get&#160;the&#160;name&#160;of&#160;the&#160;linked&#160;sheet.<br/>
setLinkSheetName(name)<br/>
Set&#160;the&#160;name&#160;of&#160;the&#160;linked&#160;sheet.<br/>
link(url,&#160;sheetName,&#160;filterName,&#160;filterOptions,&#160;<br/>
Link&#160;the&#160;sheet&#160;to another&#160;sheet&#160;in&#160;another&#160;document.<br/>
SheetLinkMode)<br/>
The&#160;macro i<a href="libremacros.html#495">n&#160;Listing&#160;434&#160;c</a>reates&#160;a&#160;sheet&#160;named “LinkIt”&#160;and then links&#160;to a&#160;sheet&#160;in a&#160;specified external&#160;<br/>document.&#160;If&#160;the&#160;“LinkIt”&#160;sheet&#160;already&#160;exists, the&#160;link&#160;is&#160;obtained from&#160;the&#160;spreadsheet&#160;document&#160;and the&#160;<br/>link&#160;is&#160;refreshed. Refreshing a&#160;link&#160;causes&#160;the&#160;data&#160;linked into&#160;the&#160;current&#160;document&#160;to&#160;be&#160;updated.<br/>
<i><b>Listing&#160;434.</b>&#160;Link&#160;to&#160;an external&#160;sheet.<br/></i>Sub&#160;LinkASheet<br/>&#160;&#160;Dim&#160;oSheets&#160; &#160; &#160; &#160; &#160;&#160;'The sheets object that contains all of the sheets<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160; &#160; &#160;'Individual sheet<br/>&#160;&#160;Dim&#160;oSheetEnum&#160; &#160; &#160; &#160;'For accessing by enumeration<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160;&#160;'String variable to hold temporary data<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160;'Index variable<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160; &#160;'URL of the document to import<br/>&#160;&#160;Dim&#160;oLink&#160; &#160; &#160; &#160; &#160; &#160;&#160;'The link object<br/>
&#160;&#160;sURL&#160;=&#160;&#34;file://C:/My%20Documents/CH15/test.ods&#34;<br/>&#160;&#160;oSheets&#160;=&#160;ThisComponent.Sheets<br/>&#160;&#160;<br/>&#160;&#160;If&#160;oSheets.hasbyName(&#34;LinkIt&#34;)&#160;Then<br/>&#160; &#160;&#160;REM The links are available from the document object<br/>&#160; &#160;&#160;REM based on the URL used to load them.<br/>&#160; &#160;&#160;oLink&#160;=&#160;ThisComponent.SheetLinks.getByName(sURL)<br/>&#160; &#160;&#160;oLink.refresh()<br/>&#160; &#160;&#160;MsgBox&#160;&#34;The sheet named LinkIt was refreshed&#34;<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;REM Insert the new sheet at the end.<br/>&#160;&#160;oSheets.insertNewByName&#160;(&#34;LinkIt&#34;,&#160;oSheets.getCount())<br/>&#160;&#160;oSheet&#160;=&#160;oSheets.getByName(&#34;LinkIt&#34;)<br/>&#160;&#160;<br/>&#160;&#160;oSheet.link(sURL,&#160;&#34;Sheet1&#34;,&#160;&#34;&#34;,&#160;&#34;&#34;,&#160;com.sun.star.sheet.SheetLinkMode.NORMAL)&#160;&#160;<br/>
End&#160;Sub<br/>
The&#160;first&#160;application&#160;that&#160;I&#160;saw&#160;for linked sheets&#160;was&#160;to&#160;consolidate&#160;a&#160;list&#160;of various&#160;investments&#160;that&#160;were&#160;<br/>tracked in&#160;different&#160;Calc&#160;documents. Each of the&#160;Calc&#160;documents&#160;contained a&#160;summary&#160;sheet&#160;for the&#160;<br/>investments&#160;in&#160;the&#160;document.&#160;A&#160;single&#160;summary&#160;document&#160;inserted&#160;links&#160;to the&#160;summary&#160;page&#160;for each of&#160;<br/>the&#160;other investment&#160;sheets.<br/>
Although linked sheets&#160;are&#160;nice, they&#160;are&#160;sometimes&#160;overkill. If&#160;you&#160;don’t&#160;want&#160;to&#160;reference&#160;an entire&#160;sheet&#160;<br/>from&#160;another document, you can set&#160;the&#160;formula&#160;to&#160;directly&#160;access&#160;just&#160;one&#160;cell. See<a href="libremacros.html#496"><b>&#160;</b>Listing&#160;435.</a><br/>
492<br/>
<hr/>
<a name=496></a><i><b>Listing&#160;435.</b>&#160;Link&#160;cell&#160;A1 to&#160;K89 in&#160;another&#160;document.<br/></i>oCell&#160;=&#160;thiscomponent.sheets(0).getcellbyposition(0,0)&#160;' A1&#160;<br/>oCell.setFormula(&#34;=&#34;&#160;&amp;&#160;&#34;'file:///home/USER/CalcFile2.odt'#$Sheet2.K89&#34;)<br/>
<b>&#160;15.5.2.&#160;Finding&#160;dependencies&#160;by&#160;using&#160;auditing&#160;functions<br/></b>The&#160;methods&#160;queryDependents() and queryPrecedents(), listed in<a href="libremacros.html#474">&#160;Table&#160;178,</a>&#160;return a&#160;list&#160;of cells&#160;that&#160;depend&#160;<br/>on a&#160;range.&#160;The&#160;query&#160;methods&#160;are&#160;useful&#160;for writing macros&#160;that&#160;manipulate&#160;each dependent&#160;cell.&#160;The&#160;<br/>auditing functionality&#160;provided&#160;by&#160;the&#160;XSheetAuditing&#160;interface&#160;provides&#160;methods&#160;for visualizing cell&#160;<br/>dependencies&#160;(see&#160;<br/><a href="libremacros.html#496">Table&#160;194)</a>.<br/>
<i><b>Table&#160;194.</b>&#160;Methods&#160;supported by&#160;the&#160;com.sun.star.sheet.XSheetAuditing interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
hideDependents(CellAddress)<br/>
Remove&#160;arrows for&#160;one&#160;level&#160;of&#160;dependents;&#160;return&#160;True&#160;if&#160;cells are&#160;marked.<br/>
hidePrecedents(CellAddress)<br/>
Remove&#160;arrows for&#160;one&#160;level&#160;of&#160;precedents;&#160;return&#160;True&#160;if&#160;cells are&#160;marked.<br/>
showDependents(CellAddress)<br/>
Draw&#160;arrows from&#160;the&#160;CellAddress&#160;(see<a href="libremacros.html#459">&#160;Table&#160;162)</a>&#160;to its dependents;&#160;return&#160;True&#160;if&#160;<br/>cells are&#160;marked.<br/>
showPrecedents(CellAddress)<br/>
Draw&#160;arrows to the&#160;CellAddress&#160;(see<a href="libremacros.html#459">&#160;Table&#160;162)</a>&#160;from&#160;its precedents;&#160;return&#160;True&#160;if&#160;<br/>cells are&#160;marked.<br/>
showErrors(CellAddress)<br/>
Draw&#160;arrows from&#160;the&#160;CellAddress&#160;(see<a href="libremacros.html#459">&#160;Table&#160;162)</a>&#160;containing&#160;an error&#160;and&#160;the&#160;cells&#160;<br/>causing&#160;the&#160;error;&#160;return&#160;True&#160;if&#160;cells&#160;are&#160;marked.<br/>
showInvalid()&#160;<br/>
Show&#160;all&#160;cells containing&#160;invalid&#160;values;&#160;return&#160;True&#160;if&#160;cells are&#160;marked.<br/>
clearArrows()<br/>
Remove&#160;all&#160;auditing&#160;arrows&#160;from&#160;the&#160;sheet.<br/>
Each time&#160;that&#160;the&#160;showPrecedents() method is&#160;called, another level&#160;of precedents&#160;is&#160;marked with&#160;arrows.&#160;<br/>After the&#160;first&#160;call, arrows&#160;are&#160;drawn from&#160;all&#160;cells&#160;directly&#160;referenced by&#160;the&#160;specified&#160;cell.&#160;The&#160;QueryRange<br/>macro i<a href="libremacros.html#476">n&#160;Listing&#160;419&#160;di</a>splays&#160;the&#160;dependencies&#160;(see<a href="libremacros.html#477">&#160;Figure&#160;100);</a><a href="libremacros.html#496">&#160;Listing&#160;436, how</a>ever,&#160;displays&#160;the&#160;<br/>precedents&#160;in&#160;the&#160;spreadsheet.<a href="libremacros.html#497">&#160;Figure&#160;106&#160;s</a>hows&#160;one&#160;level&#160;of precedents.&#160;<br/>
The&#160;cell&#160;B7 contains&#160;the&#160;formula&#160;“=Sum(B1:B6)”.&#160;As<a href="libremacros.html#497">&#160;Figure&#160;106&#160;s</a>hows, cell&#160;B7 refers&#160;to&#160;all&#160;of the&#160;<br/>“summed”&#160;cells.&#160;If&#160;you&#160;call&#160;the&#160;method showPrecedents() again, you’ll&#160;see&#160;the&#160;cells&#160;that&#160;reference&#160;the&#160;cells&#160;<br/>B2:B6.&#160;The&#160;showPrecedents() method returns&#160;True&#160;as&#160;long as&#160;more&#160;precedent&#160;cells&#160;are&#160;marked with arrows<a href="libremacros.html#497">.<br/>Figure&#160;107&#160;s</a>hows&#160;the&#160;next&#160;level&#160;of precedents.<br/>
<i><b>Listing&#160;436.</b>&#160;Display&#160;precedents.<br/></i>Function&#160;SimpleCalcDocAddition()<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;&#160;'Reference newly created calc document.<br/>&#160;&#160;Dim&#160;oSheet<br/>&#160;&#160;Dim&#160;oRange<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#34;private:factory/scalc&#34;,&#160;&#34;_default&#34;,&#160;0,&#160;Array())<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets(0)<br/>&#160;&#160;oSheet.getCellByPosition(0,&#160;0).setValue(1)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A1:A6&#34;)<br/>&#160;&#160;oRange.fillAuto(com.sun.star.sheet.FillDirection.TO_BOTTOM,&#160;1)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;B1:B6&#34;)<br/>&#160;&#160;oRange.setArrayFormula(&#34;=A1:A6+1&#34;)<br/>&#160;&#160;oSheet.getCellByPosition(1,&#160;6).setFormula(&#34;=Sum(B1:B6)&#34;)<br/>&#160;&#160;SimpleCalcDocAddition&#160;=&#160;oDoc<br/>
493<br/>
<hr/>
<a name=497></a>End&#160;Function<br/>
Sub&#160;ShowCellPrecedence()<br/>&#160;&#160;Dim&#160;oDoc<br/>&#160;&#160;Dim&#160;oSheet<br/>&#160;&#160;Dim&#160;oAddr<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;SimpleCalcDocAddition()<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets(0)<br/>&#160;&#160;oAddr&#160;=&#160;oSheet.getCellByPosition(1,&#160;6).CellAddress<br/>&#160;&#160;oSheet.showPrecedents(oAddr)<br/>&#160;&#160;Print&#160;&#34;See one level of Precedents for cells B1:B6&#34;<br/>&#160;&#160;oSheet.showPrecedents(oAddr)&#160;<br/>&#160;&#160;Print&#160;&#34;See two levels of Precedents for cell B1:B6&#34;<br/>End&#160;Sub<br/>
<i>Figure&#160;106.&#160;One&#160;level&#160;of&#160;precedents.</i><br/>
<i>Figure&#160;107.&#160;Two levels&#160;of&#160;precedents&#160;with an array&#160;formula in&#160;B1:B6.</i><br/>
The&#160;arrows&#160;in<a href="libremacros.html#497">&#160;Figure&#160;107&#160;de</a>monstrate&#160;two levels&#160;of precedents&#160;assuming an array&#160;formula. If&#160;a&#160;simple&#160;<br/>formula&#160;is&#160;used in&#160;each cell&#160;rather than&#160;an array&#160;formula,&#160;the&#160;figure&#160;changes&#160;noticeably.&#160;As&#160;an exercise,&#160;<br/>consider why&#160;this&#160;is.<br/>
494<br/>
<hr/>
<a name=498></a><i>Figure&#160;108.&#160;Two levels&#160;of&#160;precedents&#160;with formulas&#160;in B2:B6.</i><br/>
<b>&#160;15.5.3.&#160;Outlines<br/></b>Outlines&#160;in a&#160;Calc&#160;document&#160;group rows&#160;and columns&#160;together so that&#160;you can collapse&#160;and expand the&#160;<br/>groups&#160;with&#160;a&#160;single&#160;mouse&#160;click.&#160;When you create&#160;an outline,&#160;you&#160;must&#160;specify&#160;whether it’s&#160;row-centric&#160;or&#160;<br/>column-centric&#160;by&#160;using&#160;TableOrientation&#160;enumeration (see<a href="libremacros.html#498">&#160;Table&#160;195).&#160;</a>The&#160;methods&#160;in<a href="libremacros.html#498">&#160;Table&#160;196<b>&#160;</b></a>behave&#160;<br/>like&#160;their menu&#160;counterparts&#160;in&#160;the&#160;OOo GUI&#160;for dealing with&#160;spreadsheet&#160;outlines.<br/>
<i><b>Table&#160;195.</b>&#160;Values&#160;defined by&#160;the&#160; com.sun.star.table.TableOrientation enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.table.TableOrientation.ROWS<br/>
Use&#160;rows.<br/>
com.sun.star.table.TableOrientation.COLUMNS<br/>
Use&#160;columns.<br/>
<i><b>Table&#160;196.</b>&#160;Methods&#160;supported by&#160;the&#160;com.sun.star.sheet.XSheetOutline&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
group(CellRangeAddress,&#160;TableOrientation)<br/>
Group&#160;the&#160;cells in the&#160;cell&#160;range&#160;into&#160;one&#160;group.<br/>
ungroup(CellRangeAddress,&#160;TableOrientation)<br/>
Remove&#160;the&#160;innermost&#160;levels from&#160;the&#160;group.<br/>
autoOutline(CellRangeAddress)<br/>
Create&#160;outline&#160;groups based&#160;on formula&#160;<br/>
references.<br/>
clearOutline()<br/>
Remove&#160;all&#160;outline&#160;groups from&#160;the&#160;sheet.<br/>
hideDetail(CellRangeAddress)<br/>
Collapse&#160;an outline&#160;group.<br/>
showDetail(CellRangeAddress)<br/>
Open (uncollapse)&#160;an&#160;outline&#160;group.<br/>
showLevel(n, CellRangeAddress)<br/>
Show&#160;outlined groups from&#160;levels one&#160;through&#160;n.<br/>
<b>&#160;15.5.4.&#160;Copying,&#160;moving,&#160;and&#160;inserting&#160;cells<br/></b>In&#160;a&#160;Writer document,&#160;the&#160;primary&#160;method&#160;for moving or copying text&#160;content&#160;is&#160;to&#160;use&#160;the&#160;clipboard.&#160;The&#160;<br/>Spreadsheet&#160;service,&#160;however,&#160;provides&#160;methods&#160;for directly&#160;moving and inserting cells.&#160;When new&#160;cells&#160;are&#160;<br/>inserted, you&#160;specify&#160;how&#160;cells&#160;are&#160;moved out&#160;of the&#160;way&#160;by&#160;using the&#160;CellInsertMode&#160;enumeration&#160;(se<a href="libremacros.html#499">e<br/>Table&#160;197)</a>.<br/>
495<br/>
<hr/>
<a name=499></a><i><b>Table&#160;197.</b>&#160;Values&#160;defined by&#160;the&#160;com.sun.star.sheet.CellInsertMode&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.CellInsertMode.NONE<br/>
No cells are&#160;moved.<br/>
com.sun.star.sheet.CellInsertMode.DOWN<br/>
Move&#160;cells down.<br/>
com.sun.star.sheet.CellInsertMode.RIGHT<br/>
Move&#160;cells right.<br/>
com.sun.star.sheet.CellInsertMode.ROWS<br/>
Move&#160;the&#160;entire&#160;row&#160;down.<br/>
com.sun.star.sheet.CellInsertMode.COLUMNS<br/>
Move&#160;the&#160;entire&#160;column right.<br/>
Use&#160;the&#160;insertCells(CellRangeAddress, CellInsertMode) method&#160;to create&#160;space&#160;the&#160;size&#160;of the&#160;cell&#160;range&#160;<br/>address. If&#160;the&#160;insert&#160;mode&#160;is&#160;COLUMNS, then&#160;the&#160;entire&#160;column,&#160;starting&#160;with&#160;the&#160;leftmost&#160;column&#160;in&#160;the&#160;<br/>range, is&#160;shifted&#160;to the&#160;right&#160;the&#160;width of the&#160;range. If&#160;the&#160;insert&#160;mode&#160;is&#160;RIGHT,&#160;then the&#160;entire&#160;column&#160;is&#160;<br/>not&#160;shifted&#160;right;&#160;only&#160;the&#160;rows&#160;in&#160;the&#160;range&#160;are&#160;shifted.&#160;The&#160;cell&#160;insert&#160;modes&#160;ROWS&#160;and DOWN&#160;behave&#160;<br/>similarly&#160;to&#160;the&#160;COLUMNS&#160;and RIGHT&#160;modes. Using the&#160;cell&#160;insert&#160;range&#160;of NONE&#160;causes&#160;no cells&#160;to be&#160;<br/>moved;&#160;in other words, nothing happens<a href="libremacros.html#499">.&#160;Listing 437&#160;m</a>oves&#160;cells&#160;down.<br/>
<i><b>Listing&#160;437.</b>&#160;Move&#160;the&#160;range&#160;L4:M5 down.<br/></i>Dim&#160;oSheet<br/>Dim&#160;oRangeAddress&#160; &#160;'The range to move<br/>oSheet&#160;=&#160;ThisComponent.Sheets(0)<br/>oRangeAddress&#160;=&#160;oSheet.getCellRangeByName(&#34;L4:M5&#34;).getRangeAddress()<br/>oSheet.insertCells(oRangeAddress,&#160;com.sun.star.sheet.CellInsertMode.DOWN)<br/>
<b>Tip</b><br/>
&#160;The&#160;insertCells()&#160;and removeRange()&#160;methods&#160;silently&#160;fail&#160;if&#160;the&#160;insertion will&#160;cause&#160;an&#160;array&#160;formula&#160;to be<br/>
split.<br/>
The&#160;removeRange(CellRangeAddress, CellInsertMode) method is&#160;essentially&#160;an “undo”&#160;command&#160;for the&#160;<br/>insertCells() method.<br/>
Use&#160;the&#160;copyRange(CellAddress, CellRangeAddress) method&#160;to copy&#160;a&#160;range&#160;of cells&#160;to the&#160;location&#160;<br/>specified&#160;by&#160;the&#160;cell&#160;address.&#160;The&#160;top-left&#160;cell&#160;in&#160;the&#160;cell&#160;range&#160;address&#160;is&#160;positioned&#160;at&#160;the&#160;specified&#160;cell&#160;<br/>address&#160;when the&#160;range&#160;is&#160;copied.&#160;The&#160;net&#160;effect&#160;of the&#160;copyRange() method&#160;is&#160;the&#160;same&#160;as&#160;copying a&#160;range&#160;<br/>of cells&#160;to&#160;the&#160;clipboard, positioning&#160;the&#160;cursor at&#160;the&#160;specified cell, and then pasting the&#160;cells&#160;into place&#160;(se<a href="libremacros.html#499">e<br/>Listing 438)</a>.<br/>
<i><b>Listing&#160;438.</b>&#160;Copy&#160;the&#160;range&#160;L4:M5 to&#160;N8.</i><br/>
Dim&#160;oSheet<br/>Dim&#160;oRangeAddress&#160;'The range to copy<br/>Dim&#160;oCellAddress&#160;&#160;'Destination address<br/>oSheet&#160;=&#160;ThisComponent.Sheets(0)<br/>oRangeAddress&#160;=&#160;oSheet.getCellRangeByName(&#34;L4:M5&#34;).getRangeAddress()<br/>oCellAddress&#160;&#160;=&#160;oSheet.getCellByPosition(13,&#160;7).getCellAddress()&#160;&#160;'N8<br/>oSheet.copyRange(oCellAddress,&#160;oRangeAddress)<br/>
Use&#160;the&#160;moveRange(CellAddress, CellRangeAddress) method&#160;to&#160;move&#160;(rather than copy)&#160;a&#160;range&#160;of cells.&#160;<br/>The&#160;behavior&#160;of the&#160;moveRange() method&#160;is&#160;similar to&#160;that&#160;of the&#160;copyRange() method&#160;except&#160;that&#160;the&#160;cells&#160;<br/>are&#160;moved, rather than copied;&#160;the&#160;cells&#160;in&#160;the&#160;original&#160;range&#160;are&#160;left&#160;empty.<br/>
496<br/>
<hr/>
<a name=500></a><b>&#160;15.5.5.&#160;Copy&#160;data&#160;between&#160;documents<br/></b>The&#160;copyRange&#160;method&#160;only&#160;supports&#160;copying&#160;a&#160;range&#160;in&#160;the&#160;same&#160;document.&#160;Other methods&#160;must&#160;be&#160;used&#160;<br/>to copy&#160;data&#160;between different&#160;documents.<br/>
<i><b>Data&#160;functions<br/></b></i>Use&#160;getData() and setData() to copy&#160;numbers. Use&#160;getDataArray() and setDataArray() to copy&#160;numbers&#160;and&#160;<br/>strings.&#160;The&#160;data&#160;functions&#160;are&#160;fast&#160;and easy,&#160;but&#160;they&#160;only&#160;copy&#160;data, not&#160;formatting.<br/>
<i><b>Clipboard<br/></b></i>Use&#160;dispatch commands&#160;to&#160;copy&#160;data&#160;using the&#160;clipboard.&#160;The&#160;clipboard provides&#160;many&#160;options&#160;when&#160;<br/>copying&#160;data.&#160;The&#160;primary&#160;issue&#160;with using the&#160;clipboard, is&#160;that&#160;the&#160;clipboard is&#160;inherently&#160;unsafe&#160;because&#160;<br/>other applications&#160;may&#160;be&#160;using the&#160;clipboard at&#160;the&#160;same&#160;time.&#160;Although the&#160;clipboard is&#160;not&#160;inherently&#160;safe,<br/>Paste&#160;Special&#160;provides&#160;numerous&#160;options&#160;when pasting data&#160;not&#160;available&#160;using other methods.<br/>
<i><b>Listing&#160;439.</b>&#160;Use&#160;the&#160;clipboard&#160;to&#160;copy&#160;data&#160;between two documents.<br/></i>oDispatcher&#160;=&#160;createUnoService(&#34;com.sun.star.frame.DispatchHelper&#34;)&#160;<br/>oFrame1&#160;=&#160;oDoc1.CurrentController.Frame&#160;<br/>' Use the documents controller to select the cells A1:B2.<br/>oSheet&#160;=&#160;oDoc1.Sheets(0)<br/>rng&#160;=&#160;oSheet.getCellRangeByName(&#34;A1:B2&#34;)<br/>oDoc1.CurrentController.Select(rng)<br/>' Use a dispatch to copy to the clipboard.<br/>oDispatcher.executeDispatch(oFrame1,&#160;&#34;.uno:Copy&#34;,&#160;&#34;&#34;,&#160;0,&#160;Array())<br/>' Upper left corner of where to paste the data.<br/>rng&#160;=&#160;oDoc2.Sheets(0).getCellRangeByName(&#34;A1&#34;)<br/>' Place the view cursor there then paste the clipboard.<br/>oDoc2.CurrentController.Select(rng)&#160;<br/>oFrame2&#160;=&#160;oDoc2.CurrentController.Frame&#160;<br/>oDispatcher.executeDispatch(oFrame2,&#160;&#34;.uno:Paste&#34;,&#160;&#34;&#34;,&#160;0,&#160;Array())<br/>
Use&#160;the&#160;macro recorder with&#160;Paste&#160;Special&#160;to see&#160;how&#160;arguments&#160;are&#160;set&#160;with&#160;paste&#160;special. One&#160;example&#160;is&#160;<br/>as&#160;follows:<br/>
<i><b>Listing&#160;440.</b>&#160;Arguments&#160;for&#160;Paste&#160;Special.</i><br/>
Dim&#160;args1(5)&#160;as&#160;new&#160;com.sun.star.beans.PropertyValue<br/>args1(0).Name&#160;=&#160;&#34;Flags&#34;<br/>args1(0).Value&#160;=&#160;&#34;SVDNT&#34;<br/>args1(1).Name&#160;=&#160;&#34;FormulaCommand&#34;<br/>args1(1).Value&#160;=&#160;0<br/>args1(2).Name&#160;=&#160;&#34;SkipEmptyCells&#34;<br/>args1(2).Value&#160;=&#160;false<br/>args1(3).Name&#160;=&#160;&#34;Transpose&#34;<br/>args1(3).Value&#160;=&#160;false<br/>args1(4).Name&#160;=&#160;&#34;AsLink&#34;<br/>args1(4).Value&#160;=&#160;false<br/>args1(5).Name&#160;=&#160;&#34;MoveMode&#34;<br/>args1(5).Value&#160;=&#160;4<br/>oDispatcher.executeDispatch(oFrame2,&#160;&#34;.uno:InsertContents&#34;,&#160;&#34;&#34;,&#160;0,&#160;args1())&#160;<br/>
497<br/>
<hr/>
<a name=501></a><i><b>Transferable&#160;content<br/></b></i>Transferable&#160;content, the&#160;newest&#160;method available&#160;for copying content,&#160;returns&#160;a&#160;copy&#160;of the&#160;selected data&#160;as&#160;<br/>though it&#160;was&#160;copied&#160;to the&#160;clipboard, without&#160;using&#160;the&#160;clipboard.&#160;Transferable&#160;content&#160;is&#160;also available&#160;in&#160;<br/>Writer documents.&#160;Unlike&#160;the&#160;clipboard, there&#160;is&#160;no inherent&#160;problems&#160;with&#160;transferable&#160;content, but&#160;you&#160;<br/>also do not&#160;have&#160;the&#160;flexibility&#160;of paste&#160;special.<br/>
<i><b>Listing&#160;441.</b>&#160;Use&#160;transferable&#160;content&#160;to&#160;copy&#160;data between&#160;two&#160;documents.<br/></i>&#160;&#160;Dim&#160;o<br/>&#160;&#160;Dim&#160;oSheet<br/>&#160;&#160;Dim&#160;oRange<br/>&#160;&#160;Dim&#160;oDoc<br/>
&#160;&#160;oRange&#160;=&#160;oDoc1.Sheets(0).getCellRangeByName(&#34;B2:C3&#34;)<br/>&#160;&#160;oDoc1.CurrentController.select(oRange)<br/>&#160;&#160;o&#160;=&#160;oDoc1.CurrentController.getTransferable()<br/>&#160;&#160;<br/>&#160;&#160;oRange&#160;=&#160;oDoc2.Sheets(0).getCellRangeByName(&#34;F1&#34;)<br/>&#160;&#160;oDoc2.CurrentController.select(oRange)<br/>&#160;&#160;oDoc2.CurrentController.insertTransferable(o)<br/>
<b>&#160;15.5.6.&#160;Data&#160;pilot&#160;and&#160;pivot&#160;tables<br/></b>OpenOffice.org&#160;has&#160;a&#160;feature&#160;named Data&#160;Pilot,&#160;but&#160;LibreOffice&#160;changed the&#160;name&#160;the&#160;Pivot&#160;Tables.&#160;This&#160;<br/>section assumes&#160;that&#160;you&#160;already&#160;know&#160;and understand the&#160;feature, and merely&#160;demonstrates&#160;how&#160;to&#160;<br/>implement&#160;some&#160;of the&#160;functions&#160;using macros.<br/>
<b>Tip</b><br/>
I&#160;could&#160;write&#160;a&#160;large&#160;section&#160;on the&#160;numerous uses&#160;of&#160;data&#160;pilot&#160;tables.&#160;To&#160;get&#160;a&#160;feel&#160;for&#160;the&#160;possibilities,&#160;<br/>look&#160;at&#160;the&#160;input&#160;table&#160;i<a href="libremacros.html#502">n&#160;Table&#160;198&#160;a</a>nd&#160;then inspect&#160;the&#160;summary&#160;data&#160;i<a href="libremacros.html#505">n&#160;Figure&#160;109,&#160;</a>which&#160;is&#160;<br/>
automatically&#160;generated&#160;by&#160;the&#160;data&#160;pilot&#160;functionality.&#160;<br/>
The&#160;DataPilot&#160;is&#160;a&#160;powerful&#160;mechanism&#160;that&#160;allows&#160;you&#160;to&#160;combine,&#160;compare, and analyze&#160;large&#160;amounts&#160;of&#160;<br/>data.&#160;The&#160;DataPilot&#160;manipulates&#160;portions&#160;of the&#160;data&#160;from&#160;the&#160;“source&#160;table”&#160;and then displays&#160;the&#160;results&#160;in&#160;<br/>a&#160;new&#160;location. Unfortunately,&#160;numerous&#160;details&#160;are&#160;involved&#160;with the&#160;creation&#160;and manipulation of data&#160;<br/>pilot&#160;tables, but&#160;this&#160;is&#160;due&#160;to&#160;their enormous&#160;flexibility.<br/>
There&#160;are&#160;numerous&#160;details&#160;with&#160;respect&#160;to&#160;creating and using data&#160;pilot&#160;tables.&#160;Although the&#160;numerous&#160;<br/>details&#160;are&#160;logical&#160;and straightforward, they&#160;are&#160;so many&#160;that&#160;it&#160;is&#160;easy&#160;to&#160;become&#160;lost&#160;in the&#160;details.&#160;It’s&#160;<br/>instructive, therefore, to&#160;review&#160;a&#160;simple&#160;example&#160;that&#160;clarifies&#160;the&#160;details.&#160;I’ll&#160;present&#160;the&#160;specific&#160;types&#160;and&#160;<br/>enumerations&#160;following the&#160;example;&#160;you&#160;can review&#160;these&#160;as&#160;required.<br/>
<i><b>A&#160;data&#160;pilot&#160;example<br/></b></i>For&#160;this&#160;example, I&#160;assume&#160;a&#160;fake&#160;company&#160;that&#160;sells&#160;books, candy,&#160;and pens.&#160;The&#160;company&#160;has&#160;offices&#160;in&#160;<br/>three&#160;states&#160;and multiple&#160;salespeople&#160;in each state. I&#160;created&#160;a&#160;spreadsheet&#160;that&#160;shows&#160;the&#160;sales&#160;for each&#160;<br/>product&#160;broken down by&#160;salesperson and year.&#160;The&#160;final&#160;goal&#160;of this&#160;example&#160;is&#160;to&#160;create&#160;a&#160;data&#160;pilot&#160;table&#160;<br/>that&#160;summarizes&#160;the&#160;sales&#160;of each product&#160;by&#160;type&#160;and state.&#160;The&#160;initial&#160;data&#160;used for this&#160;example&#160;in&#160;shown&#160;<br/>i<a href="libremacros.html#502">n&#160;Table&#160;198.</a><br/>
498<br/>
<hr/>
<a name=502></a><i><b>Table&#160;198.</b>&#160;Data values&#160;used for&#160;the&#160;DataPilot&#160;/&#160;PivotTable&#160;examples.</i><br/>
Item<br/>
State<br/>
Team<br/>
2002<br/>
2003<br/>
2004<br/>
Books<br/>
Michigan<br/>
Jean<br/>
$14,788.00<br/>
$30,222.00<br/>
$23,490.00<br/>
Candy<br/>
Michigan<br/>
Jean<br/>
$26,388.00<br/>
$15,641.00<br/>
$32,849.00<br/>
Pens<br/>
Michigan<br/>
Jean<br/>
$16,569.00<br/>
$32,675.00<br/>
$25,396.00<br/>
Books<br/>
Michigan<br/>
Volker<br/>
$21,961.00<br/>
$21,242.00<br/>
$29,009.00<br/>
Candy<br/>
Michigan<br/>
Volker<br/>
$26,142.00<br/>
$22,407.00<br/>
$32,841.00<br/>
Pens<br/>
Michigan<br/>
Volker<br/>
$29,149.00<br/>
$18,320.00<br/>
$34,429.00<br/>
Books<br/>
Ohio<br/>
Rebecca<br/>
$21,845.00<br/>
$33,503.00<br/>
$32,200.00<br/>
Candy<br/>
Ohio<br/>
Rebecca<br/>
$23,799.00<br/>
$23,597.00<br/>
$23,020.00<br/>
Pens<br/>
Ohio<br/>
Rebecca<br/>
$28,328.00<br/>
$17,930.00<br/>
$23,303.00<br/>
Books<br/>
Ohio<br/>
Catherine<br/>
$22,797.00<br/>
$31,386.00<br/>
$39,490.00<br/>
Candy<br/>
Ohio<br/>
Catherine<br/>
$13,613.00<br/>
$16,174.00<br/>
$35,163.00<br/>
Pens<br/>
Ohio<br/>
Catherine<br/>
$17,103.00<br/>
$32,563.00<br/>
$35,804.00<br/>
Books<br/>
Kentucky<br/>
Michelle<br/>
$29,952.00<br/>
$19,133.00<br/>
$33,480.00<br/>
Candy<br/>
Kentucky<br/>
Michelle<br/>
$15,348.00<br/>
$31,094.00<br/>
$39,722.00<br/>
Pens<br/>
Kentucky<br/>
Michelle<br/>
$24,358.00<br/>
$27,236.00<br/>
$27,129.00<br/>
Books<br/>
Kentucky<br/>
Andy<br/>
$17,199.00<br/>
$26,386.00<br/>
$30,450.00<br/>
Candy<br/>
Kentucky<br/>
Andy<br/>
$11,628.00<br/>
$18,232.00<br/>
$28,953.00<br/>
Pens<br/>
Kentucky<br/>
Andy<br/>
$23,828.00<br/>
$32,031.00<br/>
$37,551.00<br/>
<b>Generating&#160;the&#160;data<br/></b>The&#160;data&#160;shown in<a href="libremacros.html#502">&#160;Table&#160;198&#160;i</a>s&#160;generated by&#160;the&#160;macro in<a href="libremacros.html#503">&#160;Listing 442, w</a>hich&#160;sets&#160;both the&#160;data&#160;and the&#160;<br/>formatting.&#160;Watch for the&#160;following&#160;techniques:<br/>
•<br/>
Generating random data.<br/>
•<br/>
Setting all of the data at one time using the method setDataArray().<br/>
•<br/>
Centering the headers and setting the cell background color.<br/>
•<br/>
Formatting a cell as currency.<br/>
499<br/>
<hr/>
<a name=503></a><i><b>Listing&#160;442.</b>&#160;Create&#160;the&#160;document&#160;used for&#160;the&#160;DataPilot&#160;/&#160;PivotTable&#160;examples.<br/></i>Function&#160;createPivotTableDoc()<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;&#160;'Reference newly created calc document.<br/>&#160;&#160;Dim&#160;oSheet<br/>&#160;&#160;Dim&#160;oRange<br/>&#160;&#160;Dim&#160;oData<br/>&#160;&#160;Dim&#160;oFormats<br/>&#160;&#160;<br/>&#160;&#160;oData&#160;=&#160;Array(Array(&#34;Item&#34;,&#160;&#34;State&#34;,&#160;&#34;Team&#34;,&#160;&#34;2002&#34;,&#160;&#34;2003&#34;,&#160;&#34;2004&#34;),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Books&#34;,&#160;&#34;Michigan&#34;,&#160;&#34;Jean&#34;,&#160;14788,&#160;30222,&#160;23490),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Candy&#34;,&#160;&#34;Michigan&#34;,&#160;&#34;Jean&#34;,&#160;26388,&#160;15641,&#160;32849),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Pens&#34;,&#160;&#34;Michigan&#34;,&#160;&#34;Jean&#34;,&#160;16569,&#160;32675,&#160;25396),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Books&#34;,&#160;&#34;Michigan&#34;,&#160;&#34;Volker&#34;,&#160;21961,&#160;21242,&#160;29009),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Candy&#34;,&#160;&#34;Michigan&#34;,&#160;&#34;Volker&#34;,&#160;26142,&#160;22407,&#160;32841),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Pens&#34;,&#160;&#34;Michigan&#34;,&#160;&#34;Volker&#34;,&#160;29149,&#160;18320,&#160;34429),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Books&#34;,&#160;&#34;Ohio&#34;,&#160;&#34;Rebecca&#34;,&#160;21845,&#160;33503,&#160;32200),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Candy&#34;,&#160;&#34;Ohio&#34;,&#160;&#34;Rebecca&#34;,&#160;23799,&#160;23597,&#160;23020),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Pens&#34;,&#160;&#34;Ohio&#34;,&#160;&#34;Rebecca&#34;,&#160;28328,&#160;17930,&#160;23303),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Books&#34;,&#160;&#34;Ohio&#34;,&#160;&#34;Catherine&#34;,&#160;22797,&#160;31386,&#160;39490),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Candy&#34;,&#160;&#34;Ohio&#34;,&#160;&#34;Catherine&#34;,&#160;13613,&#160;16174,&#160;35163),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Pens&#34;,&#160;&#34;Ohio&#34;,&#160;&#34;Catherine&#34;,&#160;17103,&#160;32563,&#160;35804),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Books&#34;,&#160;&#34;Kentucky&#34;,&#160;&#34;Michelle&#34;,&#160;29952,&#160;19133,&#160;33480),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Candy&#34;,&#160;&#34;Kentucky&#34;,&#160;&#34;Michelle&#34;,&#160;15348,&#160;31094,&#160;39722),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Pens&#34;,&#160;&#34;Kentucky&#34;,&#160;&#34;Michelle&#34;,&#160;24358,&#160;27236,&#160;27129),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Books&#34;,&#160;&#34;Kentucky&#34;,&#160;&#34;Andy&#34;,&#160;17199,&#160;26386,&#160;30450),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Candy&#34;,&#160;&#34;Kentucky&#34;,&#160;&#34;Andy&#34;,&#160;11628,&#160;18232,&#160;28953),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Array(&#34;Pens&#34;,&#160;&#34;Kentucky&#34;,&#160;&#34;Andy&#34;,&#160;23828,&#160;32031,&#160;37551))<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#34;private:factory/scalc&#34;,&#160;&#34;_default&#34;,&#160;0,&#160;Array())<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets(0)<br/>&#160;&#160;oSheet.getCellRangeByName(&#34;A1:F19&#34;).setDataArray(oData)<br/>&#160;&#160;<br/>&#160;&#160;' Set the title area<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A1:F1&#34;)<br/>&#160;&#160;oRange.HoriJustify&#160;=&#160;com.sun.star.table.CellHoriJustify.CENTER<br/>&#160;&#160;oRange.CellBackColor&#160;=&#160;RGB(225,&#160;225,&#160;225)<br/>&#160;&#160;<br/>&#160;&#160;' Format numbers as currency<br/>&#160;&#160;oFormats&#160;=&#160;oDoc.NumberFormats<br/>&#160;&#160;Dim&#160;aLocale&#160;As&#160;New&#160;com.sun.star.lang.Locale<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;D2:F19&#34;)<br/>&#160;&#160;oRange.NumberFormat&#160;=&#160;oFormats.getStandardFormat(_<br/>&#160; &#160; &#160;&#160;com.sun.star.util.NumberFormat.CURRENCY,&#160;aLocale)<br/>&#160;&#160;createPivotTableDoc&#160;=&#160;oDoc<br/>End&#160;Function<br/>
<b>Creating&#160;the&#160;data&#160;pilot&#160;table<br/></b>The&#160;macro i<a href="libremacros.html#504">n&#160;Listing&#160;443&#160;c</a>reates&#160;and inserts&#160;a&#160;data&#160;pilot&#160;table&#160;as&#160;follows:<br/>
1.&#160;Create&#160;the&#160;data&#160;pilot&#160;table&#160;descriptor using the&#160;method createDataPilotDescriptor().<br/>
2.&#160;Set&#160;the&#160;source&#160;range&#160;of the&#160;data&#160;to&#160;use.<br/>
500<br/>
<hr/>
<a name=504></a>3.&#160;Configure&#160;which column is&#160;used for which purpose.<br/>
4.&#160;Insert&#160;the&#160;data&#160;pilot&#160;table&#160;descriptor into&#160;the&#160;set&#160;of tables.<br/>
<i><b>Listing&#160;443.</b>&#160;Create&#160;a data&#160;pilot&#160;table.<br/></i>Sub&#160;CreateDataPilotTable()<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;'Sheet that contains the data pilot<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160;'Range for the data pilot source<br/>&#160;&#160;Dim&#160;oRangeAddress'The address of the range object<br/>&#160;&#160;Dim&#160;oTables&#160; &#160; &#160;&#160;'Collection of data pilot tables<br/>&#160;&#160;Dim&#160;oTDescriptor&#160;'A single data pilot descriptor<br/>&#160;&#160;Dim&#160;oFields&#160; &#160; &#160;&#160;'Collection of all fields<br/>&#160;&#160;Dim&#160;oField&#160; &#160; &#160; &#160;'A single field<br/>&#160;&#160;Dim&#160;oCellAddress&#160;As&#160;New&#160;com.sun.star.table.CellAddress<br/>&#160;&#160;Dim&#160;oDoc<br/>
&#160;&#160;oDoc&#160;=&#160;createPivotTableDoc()<br/>&#160;&#160;oSheet&#160;=&#160;oDoc.Sheets.getByIndex(0)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A1:F19&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Sure, I could simply specify the address, but this is much more fun!<br/>&#160;&#160;REM Set the destination address to be two rows below the data.<br/>&#160;&#160;oRangeAddress&#160;=&#160;oRange.getRangeAddress()<br/>&#160;&#160;oCellAddress.Sheet&#160;&#160;=&#160;oRangeAddress.Sheet<br/>&#160;&#160;oCellAddress.Column&#160;=&#160;oRangeAddress.StartColumn<br/>&#160;&#160;oCellAddress.Row&#160; &#160;&#160;=&#160;oRangeAddress.EndRow&#160;+&#160;2<br/>&#160;&#160;<br/>&#160;&#160;oTables&#160;=&#160;oSheet.getDataPilotTables()<br/>&#160;&#160;<br/>&#160;&#160;REM Step 1, create the descriptor<br/>&#160;&#160;oTDescriptor&#160;=&#160;oTables.createDataPilotDescriptor()<br/>&#160;&#160;<br/>&#160;&#160;REM Step 2, Set the source range<br/>&#160;&#160;oTDescriptor.setSourceRange(oRangeAddress)<br/>&#160;&#160;<br/>&#160;&#160;REM Step 3, Set the fields<br/>&#160;&#160;oFields&#160;=&#160;oTDescriptor.getDataPilotFields()<br/>&#160;&#160;<br/>&#160;&#160;REM Column 0 in the source is Item and I want this as a row item.<br/>&#160;&#160;oField&#160;=&#160;oFields.getByIndex(0)<br/>&#160;&#160;oField.Orientation&#160;=&#160;com.sun.star.sheet.DataPilotFieldOrientation.ROW<br/>&#160;&#160;<br/>&#160;&#160;REM Column 1 in the source is State and I want this as a column item.<br/>&#160;&#160;oField&#160;=&#160;oFields.getByIndex(1)<br/>&#160;&#160;oField.Orientation&#160;=&#160;com.sun.star.sheet.DataPilotFieldOrientation.COLUMN<br/>&#160;&#160;<br/>&#160;&#160;REM Column 3 in the source is 2002. Create a sum in the data for this!<br/>&#160;&#160;oField&#160;=&#160;oFields.getByIndex(3)<br/>&#160;&#160;oField.Orientation&#160;=&#160;com.sun.star.sheet.DataPilotFieldOrientation.DATA<br/>&#160;&#160;oField.Function&#160;=&#160;com.sun.star.sheet.GeneralFunction.SUM<br/>&#160;&#160;<br/>&#160;&#160;oTables.insertNewByName(&#34;MyFirstDataPilot&#34;,&#160;oCellAddress,&#160;oTDescriptor)<br/>End&#160;Sub<br/>
501<br/>
<hr/>
<a name=505></a><i>Figure&#160;109.&#160;The&#160;macro&#160;i<a href="libremacros.html#504">n&#160;Listing 443&#160;i</a></i><i>nserts&#160;the&#160;data&#160;pilot&#160;table&#160;immediately&#160;after&#160;the&#160;source&#160;data.</i><br/>
<i><b>Manipulating&#160;data&#160;pilot&#160;tables<br/></b></i>The&#160;getDataPilotTables() method, supported by&#160;each spreadsheet,&#160;returns&#160;an object&#160;that&#160;supports&#160;the&#160;service&#160;<br/>com.sun.star.sheet.DataPilotTables.&#160;The&#160;returned service&#160;provides&#160;access&#160;to the&#160;data&#160;pilot&#160;tables&#160;in&#160;the&#160;<br/>spreadsheet&#160;using both&#160;indexed&#160;and enumeration&#160;access.&#160;The&#160;DataPilotTables&#160;object&#160;also supports&#160;the&#160;<br/>methods&#160;i<a href="libremacros.html#505">n&#160;Table&#160;199.</a><br/>
<i>Table&#160;199.&#160;Methods&#160;defined by&#160;the&#160;com.sun.star.sheet.XDataPilotTables&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
createDataPilotDescriptor()<br/>
Create&#160;a&#160;new&#160;data&#160;pilot&#160;descriptor.<br/>
insertNewByName(name,&#160;CellAddress,&#160;<br/>
Add&#160;a&#160;new&#160;data&#160;pilot&#160;table&#160;to the&#160;collection that&#160;uses the&#160;provided&#160;<br/>
DataPilotDescriptor)<br/>
CellAddress (see<a href="libremacros.html#459">&#160;Table&#160;162)</a>&#160;as the&#160;top-left&#160;corner&#160;of&#160;the&#160;table.<br/>
removeByName(name)<br/>
Delete&#160;a&#160;data&#160;pilot&#160;table&#160;from&#160;the&#160;collection.<br/>
<b>Data&#160;pilot&#160;fields<br/></b>Each “field”&#160;in the&#160;created data&#160;pilot&#160;table&#160;is&#160;represented by&#160;a&#160;column in&#160;the&#160;source&#160;data&#160;pilot&#160;table&#160;(cell&#160;<br/>range) and is&#160;named&#160;using the&#160;topmost&#160;cell&#160;of the&#160;column&#160;in the&#160;range.&#160;The&#160;field&#160;name&#160;is&#160;available&#160;through&#160;<br/>the&#160;methods&#160;getName() and setName(String).&#160;<br/>
Each field contains&#160;an Orientation&#160;property&#160;of type&#160;DataPilotFieldOrientation&#160;that&#160;specifies&#160;how&#160;the&#160;field is&#160;<br/>used in&#160;the&#160;final&#160;output&#160;(see<a href="libremacros.html#505">&#160;Table&#160;200).</a>&#160;The&#160;Function property&#160;specifies&#160;the&#160;function used to calculate&#160;<br/>results&#160;for this&#160;field&#160;based on the&#160;GeneralFunction&#160;enumeration (see<a href="libremacros.html#482">&#160;Table&#160;181).</a><br/>
<i>Table&#160;200.&#160;Values&#160;defined by&#160;the&#160;com.sun.star.sheet.DataPilotFieldOrientation&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.DataPilotFieldOrientation.HIDDEN&#160;<br/>
Do&#160;not&#160;use&#160;the&#160;field.<br/>
com.sun.star.sheet.DataPilotFieldOrientation.COLUMN&#160;<br/>
Use&#160;the&#160;field as a&#160;column&#160;field.<br/>
com.sun.star.sheet.DataPilotFieldOrientation.ROW&#160;<br/>
Use&#160;the&#160;field as a&#160;row&#160;field.<br/>
com.sun.star.sheet.DataPilotFieldOrientation.PAGE&#160;<br/>
Use&#160;the&#160;field as a&#160;page&#160;field.<br/>
com.sun.star.sheet.DataPilotFieldOrientation.DATA&#160;<br/>
Use&#160;the&#160;field as a&#160;data&#160;field.<br/>
502<br/>
<hr/>
<a name=506></a><b>Filtering&#160;data&#160;pilot&#160;fields<br/></b>The&#160;fields&#160;in&#160;the&#160;created&#160;table&#160;may&#160;be&#160;conditionally&#160;displayed based on a&#160;FilterOperator (see<a href="libremacros.html#506">&#160;Table&#160;201).</a><br/>
<i>Table&#160;201.&#160;Values&#160;defined by&#160;the&#160;com.sun.star.sheet.FilterOperator&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.FilterOperator.EMPTY<br/>
Select&#160;empty&#160;entries.<br/>
com.sun.star.sheet.FilterOperator.NOT_EMPTY<br/>
Select&#160;nonempty&#160;entries.<br/>
com.sun.star.sheet.FilterOperator.EQUAL<br/>
The&#160;entry’s&#160;value&#160;must&#160;equal&#160;the&#160;specified&#160;value.<br/>
com.sun.star.sheet.FilterOperator.NOT_EQUAL<br/>
The&#160;entry’s&#160;value&#160;must&#160;not&#160;be&#160;equal&#160;to the&#160;specified value.<br/>
com.sun.star.sheet.FilterOperator.GREATER<br/>
The&#160;entry’s&#160;value&#160;must&#160;be&#160;greater&#160;than the&#160;specified&#160;value.<br/>
com.sun.star.sheet.FilterOperator.GREATER_EQUAL<br/>
The&#160;entry’s&#160;value&#160;must&#160;be&#160;greater&#160;than or&#160;equal&#160;to&#160;the&#160;<br/>specified value.<br/>
com.sun.star.sheet.FilterOperator.LESS<br/>
The&#160;entry’s&#160;value&#160;must&#160;be&#160;less than&#160;the&#160;specified value.<br/>
com.sun.star.sheet.FilterOperator.LESS_EQUAL<br/>
The&#160;entry’s&#160;value&#160;must&#160;be&#160;less than&#160;or&#160;equal&#160;to the&#160;<br/>
specified value.<br/>
com.sun.star.sheet.FilterOperator.TOP_VALUES<br/>
Select&#160;a&#160;specified&#160;number&#160;with&#160;the&#160;greatest&#160;values.<br/>
com.sun.star.sheet.FilterOperator.TOP_PERCENT<br/>
Select&#160;a&#160;specified&#160;percentage&#160;with&#160;the&#160;greatest&#160;values.<br/>
com.sun.star.sheet.FilterOperator.BOTTOM_VALUES<br/>
Select&#160;a&#160;specified&#160;number&#160;with&#160;the&#160;lowest&#160;values.<br/>
com.sun.star.sheet.FilterOperator.BOTTOM_PERCENT<br/>
Select&#160;a&#160;specified&#160;percentage&#160;with&#160;the&#160;lowest&#160;values.<br/>
The&#160;individual&#160;filter operators&#160;are&#160;combined using the&#160;FilterConnection&#160;enumeration&#160;(see<a href="libremacros.html#506">&#160;Table&#160;202)</a>. Each&#160;<br/>individual&#160;filter field is&#160;stored in a&#160;TableFilterField&#160;structure&#160;(see<a href="libremacros.html#506">&#160;Table&#160;203).&#160;</a>The&#160;entire&#160;collection&#160;of&#160;<br/>TableFilterFields&#160;is&#160;stored in a&#160;SheetFilterDescriptor.&#160;The&#160;descriptor supports&#160;the&#160;methods&#160;getFilterFields()&#160;<br/>and setFilterFields(), to&#160;get&#160;and set&#160;the&#160;table&#160;filter fields&#160;as&#160;an array&#160;of&#160;TableFilterField&#160;structures.&#160;The&#160;<br/>properties&#160;in&#160;<br/><a href="libremacros.html#507">Table&#160;204&#160;a</a>re&#160;defined&#160;by&#160;the&#160;SheetFilterDescriptor to&#160;direct&#160;the&#160;filtering process.<br/>
<i>Table&#160;202.&#160;Values&#160;defined by&#160;the&#160;com.sun.star.sheet.FilterConnection&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.FilterConnection.AND&#160;<br/>
Both conditions must&#160;be&#160;satisfied.<br/>
com.sun.star.sheet.FilterConnection.OR&#160;<br/>
At&#160;least&#160;one&#160;of&#160;the&#160;conditions must&#160;be&#160;satisfied.<br/>
<i>Table&#160;203.&#160;Properties&#160;in the&#160;com.sun.star.sheet.TableFilterField structure.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Connection<br/>
Specify&#160;how&#160;the&#160;condition is&#160;connected&#160;to the&#160;previous condition as a&#160;FilterConnection (se<a href="libremacros.html#506">e</a><br/>
<a href="libremacros.html#506">Table&#160;202)</a>.<br/>
Field<br/>
Specify&#160;which&#160;field (column)&#160;is used&#160;for&#160;the&#160;condition as a&#160;Long&#160;Integer.<br/>
Operator<br/>
Specify&#160;the&#160;condition type&#160;as a&#160;FilterOperator&#160;(see<a href="libremacros.html#506">&#160;Table&#160;201)</a>.<br/>
IsNumeric<br/>
If&#160;True,&#160;the&#160;NumericValue&#160;property&#160;is used;&#160;otherwise&#160;the&#160;StringValue&#160;is used.<br/>
NumericValue<br/>
Specify&#160;a&#160;numeric&#160;value&#160;for&#160;the&#160;condition as a&#160;Double.<br/>
StringValue<br/>
Specify&#160;a&#160;String&#160;value&#160;for&#160;the&#160;condition.<br/>
503<br/>
<hr/>
<a name=507></a><i>Table&#160;204.&#160;Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.sheet.SheetFilterDescriptor&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
IsCaseSensitive<br/>
If&#160;True,&#160;string&#160;comparisons are&#160;case&#160;sensitive.<br/>
SkipDuplicates<br/>
If&#160;True,&#160;duplicate&#160;entries&#160;are&#160;not&#160;included&#160;in the&#160;result.<br/>
UseRegularExpressions<br/>
If&#160;True,&#160;string&#160;values in the&#160;TableFilterField&#160;structure&#160;are&#160;interpreted&#160;as regular&#160;<br/>
expressions.<br/>
SaveOutputPosition<br/>
If&#160;True&#160;(and&#160;CopyOutputData&#160;is&#160;True),&#160;the&#160;OutputPosition is saved&#160;for&#160;future&#160;calls.<br/>
Orientation<br/>
Specify&#160;if&#160;columns&#160;or&#160;rows are&#160;filtered&#160;using&#160;the&#160;TableOrientation enumeration (se<a href="libremacros.html#498">e<br/>Table&#160;195)</a>.<br/>
ContainsHeader<br/>
If&#160;True,&#160;the&#160;first&#160;row&#160;(or&#160;column)&#160;is assumed to be&#160;a&#160;header&#160;and&#160;is not&#160;filtered.<br/>
CopyOutputData<br/>
If&#160;True,&#160;the&#160;filtered&#160;data&#160;is copied&#160;to the&#160;OutputPosition.<br/>
OutputPosition<br/>
Specify&#160;where&#160;filtered&#160;data&#160;is copied&#160;as a&#160;CellAddress (see<a href="libremacros.html#459">&#160;Table&#160;162)</a>.<br/>
MaxFieldCount<br/>
The&#160;maximum&#160;number&#160;of&#160;filter&#160;fields in&#160;the&#160;descriptor&#160;as a&#160;Long&#160;Integer.<br/>
<b>Tables<br/></b>Each data&#160;pilot&#160;table&#160;is&#160;based on a&#160;spreadsheet&#160;cell&#160;range. Each data&#160;pilot&#160;table&#160;also&#160;supports&#160;the&#160;object&#160;<br/>method&#160;getOutputRange(), which returns&#160;a&#160;CellRangeAddress&#160;(see<a href="libremacros.html#469">&#160;Table&#160;169).&#160;</a>The&#160;refresh() method&#160;re-<br/>creates&#160;the&#160;table&#160;using&#160;the&#160;current&#160;data&#160;in&#160;the&#160;source&#160;range. Each data&#160;pilot&#160;table&#160;also suports&#160;the&#160;<br/>DataPilotDescriptor&#160;service, which&#160;defines&#160;the&#160;methods&#160;i<a href="libremacros.html#507">n&#160;Table&#160;205.</a><br/>
<i>Table&#160;205.&#160;Methods&#160;defined by&#160;the&#160;com.sun.star.sheet.XDataPilotDescriptor&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getTag()<br/>
Get&#160;the&#160;data&#160;pilot&#160;table&#160;tag&#160;as&#160;a&#160;String.<br/>
setTag(String)<br/>
Set&#160;the&#160;data&#160;pilot&#160;table&#160;tag.<br/>
getSourceRange()<br/>
Return the&#160;CellRangeAddress (see<a href="libremacros.html#469">&#160;Table&#160;169)</a>&#160;containing&#160;the&#160;data&#160;for&#160;<br/>
the&#160;data&#160;pilot&#160;table.<br/>
setSourceRange(CellRangeAddress)<br/>
Set&#160;the&#160;cell&#160;range&#160;containing&#160;the&#160;data&#160;for&#160;the&#160;data&#160;pilot&#160;table.<br/>
getFilterDescriptor()<br/>
Get&#160;the&#160;SheetFilterDescriptor&#160;(see<a href="libremacros.html#507">&#160;Table&#160;204)</a>&#160;that&#160;specifies which data<br/>from&#160;the&#160;source&#160;cell&#160;range&#160;is used for&#160;the&#160;data&#160;pilot&#160;table.<br/>
getDataPilotFields()<br/>
Get&#160;the&#160;data&#160;pilot&#160;fields&#160;as&#160;an object&#160;that&#160;supports indexed&#160;access.<br/>
getColumnFields()<br/>
Get&#160;the&#160;data&#160;pilot&#160;fields&#160;used as column&#160;fields as an&#160;object&#160;that&#160;<br/>
supports indexed&#160;access.<br/>
getRowFields()<br/>
Get&#160;the&#160;data&#160;pilot&#160;fields&#160;used as row&#160;fields as an object&#160;that&#160;supports&#160;<br/>
indexed&#160;access.<br/>
getPageFields()<br/>
Get&#160;the&#160;data&#160;pilot&#160;fields&#160;used as page&#160;fields as an&#160;object&#160;that&#160;supports&#160;<br/>
indexed&#160;access.<br/>
getDataFields()<br/>
Get&#160;the&#160;data&#160;pilot&#160;fields&#160;used as data&#160;fields as an object&#160;that&#160;supports&#160;<br/>
indexed&#160;access.<br/>
getHiddenFields()<br/>
Get&#160;the&#160;data&#160;pilot&#160;fields&#160;that&#160;are&#160;not&#160;used as column, row,&#160;page,&#160;or&#160;data<br/>
fields.<br/>
<b>&#160;15.5.7.&#160;Sheet&#160;cursors<br/></b>In&#160;a&#160;Calc&#160;document, a&#160;cursor is&#160;a&#160;cell&#160;range&#160;that&#160;contains&#160;methods&#160;to&#160;move&#160;through the&#160;contained cells.&#160;<br/>Cursors&#160;are&#160;not&#160;used as&#160;frequently&#160;with&#160;Calc&#160;documents&#160;as&#160;with&#160;Writer documents&#160;because, unlike&#160;Writer&#160;<br/>
504<br/>
<hr/>
<a name=508></a>documents, most&#160;content&#160;is&#160;directly&#160;accessible&#160;by&#160;index&#160;or name.&#160;Sheet&#160;cursors, like&#160;cell&#160;ranges, are&#160;limited&#160;<br/>to one&#160;sheet&#160;at&#160;a&#160;time.&#160;The&#160;SheetCellCursor service&#160;used by&#160;Calc&#160;documents&#160;is&#160;similar to&#160;cell&#160;cursors&#160;used in<br/>text&#160;tables&#160;(see<a href="libremacros.html#508">&#160;Table&#160;206)</a>.<br/>
<i>Table&#160;206.&#160;Primary&#160;components&#160;supported by&#160;the&#160;com.sun.star.sheet.SheetCellCursor&#160;service.</i><br/>
<i><b>Component</b></i><br/>
<i><b>Description</b></i><br/>
&#160;com.sun.star.table.CellCursor<br/>
Methods to control&#160;the&#160;position of&#160;a&#160;cell&#160;cursor.<br/>
&#160;com.sun.star.table.CellRange<br/>
Methods to access cells&#160;or&#160;subranges of&#160;a&#160;cell&#160;range&#160;(see<a href="libremacros.html#474">&#160;Table&#160;176)</a>.<br/>
com.sun.star.sheet.XSheetCellCursor<br/>
Advanced&#160;methods to&#160;control&#160;the&#160;position of&#160;the&#160;cursor.<br/>
com.sun.star.sheet.SheetCellRange<br/>
A&#160;rectangular&#160;range&#160;of&#160;cells in a&#160;spreadsheet&#160;document;&#160;this&#160;is&#160;an&#160;<br/>extension of&#160;the&#160;CellRange&#160;service&#160;for&#160;use&#160;in spreadsheet&#160;documents.<br/>
com.sun.star.sheet.XUsedAreaCursor<br/>
Methods to find the&#160;used area&#160;in a&#160;sheet.<br/>
The&#160;primary&#160;methods&#160;supported by&#160;the&#160;SheetCellCursor are&#160;shown in<a href="libremacros.html#508">&#160;Table&#160;207.</a><br/>
<i>Table&#160;207.&#160;Primary&#160;methods&#160;supported by&#160;the&#160;com.sun.star.sheet.SheetCellCursor&#160;service.</i><br/>
<i><b>Interface</b></i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
XCellCursor<br/>
gotoStart()<br/>
Move&#160;the&#160;cursor&#160;to&#160;the&#160;first&#160;filled&#160;cell&#160;at&#160;the&#160;beginning&#160;of&#160;a&#160;<br/>contiguous series of&#160;filled cells.&#160;This cell&#160;may&#160;be&#160;outside&#160;the&#160;<br/>
cursor’s&#160;range.<br/>
XCellCursor<br/>
gotoEnd()<br/>
Move&#160;the&#160;cursor&#160;to&#160;the&#160;last&#160;filled cell&#160;at&#160;the&#160;end of&#160;a&#160;contiguous&#160;<br/>
series of&#160;filled cells.&#160;This&#160;cell&#160;may&#160;be&#160;outside&#160;the&#160;cursor’s&#160;range.<br/>
XCellCursor<br/>
gotoNext()<br/>
Move&#160;the&#160;cursor&#160;to&#160;the&#160;next&#160;(right)&#160;unprotected&#160;cell.<br/>
XCellCursor<br/>
gotoPrevious()<br/>
Move&#160;the&#160;cursor&#160;to&#160;the&#160;previous (left)&#160;unprotected&#160;cell.<br/>
XCellCursor<br/>
gotoOffset(nCol, nRow)<br/>
Shift&#160;the&#160;cursor’s&#160;range&#160;relative&#160;to the&#160;current&#160;position.&#160;Negative&#160;<br/>
numbers shift&#160;left&#160;and&#160;up;&#160;positive&#160;numbers shift&#160;right&#160;and down.<br/>
XCellRange<br/>
getCellByPosition(left, top)<br/>
Get&#160;a&#160;cell&#160;within&#160;the&#160;range.<br/>
XCellRange<br/>
getCellRangeByPosition(left<br/>
Get&#160;a&#160;cell&#160;range&#160;within&#160;the&#160;range.<br/>
, top,&#160;right,&#160;bottom)<br/>
XCellRange<br/>
getCellRangeByName(name<br/>
Get&#160;a&#160;cell&#160;range&#160;within&#160;the&#160;range&#160;based&#160;on&#160;its&#160;name.&#160;The&#160;string&#160;<br/>
)<br/>
directly&#160;references cells using&#160;the&#160;standard&#160;formats&#160;—&#160;such&#160;as&#160;<br/>
“B2:D5”&#160;or&#160;“$B$2”&#160;—&#160;or&#160;defined&#160;cell&#160;range&#160;names.<br/>
XSheetCellCursor<br/>
collapseToCurrentRegion()<br/>
Expand the&#160;range&#160;to contain all&#160;contiguous nonempty&#160;cells.<br/>
XSheetCellCursor<br/>
collapseToCurrentArray()<br/>
Expand the&#160;range&#160;to contain the&#160;current&#160;array&#160;formula.<br/>
XSheetCellCursor<br/>
collapseToMergedArea()<br/>
Expand the&#160;range&#160;to contain merged cells that&#160;intersect&#160;the&#160;range.<br/>
XSheetCellCursor<br/>
expandToEntireColumns()<br/>
Expand the&#160;range&#160;to contain all&#160;columns&#160;that&#160;intersect&#160;the&#160;range.<br/>
XSheetCellCursor<br/>
expandToEntireRows()<br/>
Expand the&#160;range&#160;to contain all&#160;rows that&#160;intersect&#160;the&#160;range.<br/>
XSheetCellCursor<br/>
collapseToSize(nCols,&#160;<br/>
Without&#160;changing&#160;the&#160;upper-left&#160;corner,&#160;set&#160;the&#160;cursor&#160;range&#160;size.<br/>
nRows)<br/>
XSheetCellRange<br/>
getSpreadsheet()<br/>
Get&#160;the&#160;sheet&#160;object&#160;that&#160;contains&#160;the&#160;cell&#160;range.<br/>
XUsedAreaCursor<br/>
gotoStartOfUsedArea()<br/>
Set&#160;the&#160;cursor&#160;to the&#160;start&#160;of&#160;the&#160;used area.<br/>
XUsedAreaCursor<br/>
gotoEndOfUsedArea()<br/>
Set&#160;the&#160;cursor&#160;to the&#160;end&#160;of&#160;the&#160;used&#160;area.<br/>
505<br/>
<hr/>
<a name=509></a>Cell&#160;ranges, and therefore&#160;cell&#160;cursors, deal&#160;with&#160;rectangular regions.&#160;The&#160;use&#160;of rectangular regions&#160;may&#160;be&#160;<br/>obvious&#160;now&#160;that&#160;I&#160;state&#160;it,&#160;but&#160;it&#160;caught&#160;me&#160;by&#160;surprise&#160;when I&#160;tested the&#160;gotoStart() and gotoEnd() methods&#160;<br/>listed in<a href="libremacros.html#508">&#160;Table&#160;207. I</a>&#160;started with&#160;the&#160;configuration&#160;shown i<a href="libremacros.html#478">n&#160;Figure&#160;101&#160;w</a>hen writing the&#160;code&#160;in<a href="libremacros.html#509">&#160;Listing&#160;<br/>444.&#160;</a><br/>
<i><b>Listing&#160;444.</b>&#160;Simple&#160;cursor&#160;movement&#160;commands&#160;use&#160;contiguous&#160;blocks.<br/></i>oCurs&#160;=&#160;oSheet.createCursorByRange(oSheet.getCellRangeByName(&#34;C3&#34;))<br/>oCurs.gotoStart()&#160;&#160;REM Move the cursor to cell B1<br/>oCurs.gotoEnd()&#160; &#160;&#160;REM Move the cursor to cell E8<br/>oCurs.gotoStart()&#160;&#160;REM Move the cursor to cell E8<br/>
The&#160;first&#160;line&#160;in<a href="libremacros.html#509">&#160;Listing 444&#160;pos</a>itions&#160;the&#160;cursor at&#160;cell&#160;C3, right&#160;in the&#160;middle&#160;of a&#160;block of values.&#160;In<a href="libremacros.html#478">&#160;Figure<br/>101, t</a>he&#160;leftmost&#160;contiguous&#160;column is&#160;B&#160;and the&#160;topmost&#160;contiguous&#160;row&#160;is&#160;1.&#160;The&#160;method gotoStart(),&#160;<br/>therefore, positions&#160;the&#160;cursor in&#160;the&#160;top-left&#160;corner at&#160;location&#160;B1.&#160;This&#160;is&#160;where&#160;things&#160;become&#160;a&#160;little&#160;bit&#160;<br/>unexpected.&#160;The&#160;rightmost&#160;contiguous&#160;column&#160;is&#160;E&#160;and the&#160;bottommost&#160;contiguous&#160;row&#160;is&#160;8.&#160;The&#160;method&#160;<br/>gotoEnd(), therefore, positions&#160;the&#160;cursor at&#160;location&#160;E8.&#160;As&#160;it&#160;is&#160;shown i<a href="libremacros.html#478">n&#160;Figure&#160;101, t</a>he&#160;cell&#160;E8&#160;is&#160;<br/>completely&#160;disconnected from&#160;the&#160;contiguous&#160;group of cells.&#160;The&#160;cursor is&#160;positioned&#160;to cell&#160;E8, even if it&#160;<br/>does&#160;not&#160;contain&#160;a&#160;value.&#160;The&#160;cursor is&#160;no longer related&#160;to the&#160;original&#160;block of cells, so the&#160;method&#160;<br/>gotoStart() does&#160;not&#160;move&#160;the&#160;cursor back to cell&#160;B1.<br/>
To&#160;understand the&#160;behavi<a href="libremacros.html#509">or of&#160;Listing 444, i</a>t’s&#160;important&#160;to&#160;understand how&#160;OOo determines&#160;contiguous&#160;<br/>cells, because&#160;it&#160;isn’t&#160;documented anywhere&#160;that&#160;I&#160;can find. Experimentally,&#160;I&#160;have&#160;determined that&#160;the&#160;set&#160;of&#160;<br/>contiguous&#160;nonempty&#160;cells&#160;is&#160;defined&#160;as&#160;the&#160;smallest&#160;range&#160;(square&#160;block of cells) that&#160;can be&#160;enclosed by&#160;<br/>empty&#160;cells.&#160;If&#160;cell&#160;E9&#160;contained a&#160;value, then&#160;even though cells&#160;E8 and E9 are&#160;not&#160;directly&#160;connected via&#160;<br/>nonempty&#160;cells&#160;to the&#160;original&#160;block of cells, they&#160;would both&#160;be&#160;considered part&#160;of the&#160;block of contiguous&#160;<br/>nonempty&#160;cells.&#160;<br/>
The&#160;method&#160;collapseToCurrentRegion() causes&#160;the&#160;cursor to contain the&#160;block of contiguous&#160;cells.&#160;The&#160;only&#160;<br/>caveat&#160;is&#160;that&#160;after the&#160;range&#160;is&#160;collapsed, it&#160;always&#160;contains&#160;the&#160;original&#160;range, even if this&#160;range&#160;includes&#160;<br/>unnecessary&#160;empty&#160;cells.&#160;The&#160;method collapseToCurrentArray()&#160;is&#160;similar to&#160;collapseToCurrentRegion(),&#160;<br/>except&#160;that&#160;it&#160;returns&#160;a&#160;range&#160;that&#160;contains&#160;an array&#160;formula.&#160;The&#160;upper-left&#160;corner of the&#160;region must&#160;include&#160;<br/>an array&#160;formula&#160;for the&#160;collapseToCurrentArray() method&#160;to work.<br/>
The&#160;code&#160;snippet&#160;in<a href="libremacros.html#509">&#160;Listing 445<b>&#160;</b></a>creates&#160;a&#160;cursor over a&#160;range&#160;and then demonstrates&#160;that&#160;getCellByPosition()<br/>and getCellRangeByPosition() are&#160;relative&#160;to the&#160;upper-left&#160;corner of the&#160;range.&#160;The&#160;method&#160;<br/>getCellRangeByName() generates&#160;an exception if a&#160;cell&#160;outside&#160;the&#160;range&#160;is&#160;requested.<br/>
<i><b>Listing&#160;445.</b>&#160;Some&#160;commands&#160;work&#160;only&#160;relative&#160;to&#160;the&#160;range.</i><br/>
oCurs&#160;&#160;=&#160;oSheet.createCursorByRange(oSheet.getCellRangeByName(&#34;C3:F12&#34;))<br/>oCell&#160;&#160;=&#160;oCurs.getCellByPosition(0,&#160;0)&#160; &#160; &#160; &#160; &#160; &#160;&#160;REM Cell C3<br/>oRange&#160;=&#160;oCurs.getCellRangeByPosition(1,&#160;0,&#160;3,&#160;2)&#160;REM D3:F5<br/>oRange&#160;=&#160;oCurs.getCellRangeByName(&#34;C4:D6&#34;)&#160; &#160; &#160; &#160;&#160;REM C4:D6<br/>oRange&#160;=&#160;oCurs.getCellRangeByName(&#34;C2:D6&#34;)&#160; &#160; &#160; &#160;&#160;REM Error C2 not in range!<br/>
<b>Tip</b><br/>
The&#160;methods getCellByPosition(), getCellRangeByPosition(),&#160;and&#160;getCellRangeByName()&#160;cannot&#160;return a&#160;<br/>value&#160;that&#160;is not&#160;in&#160;the&#160;range.<br/>
<i><b>&#160;15.6.&#160;Calc&#160;documents<br/></b></i>Many&#160;of the&#160;document-level&#160;methods&#160;and properties&#160;affect&#160;the&#160;entire&#160;document&#160;—&#160;for &#160;example,&#160;the&#160;ability&#160;<br/>to save&#160;and print&#160;a&#160;document.&#160;Other methods&#160;and properties&#160;exist&#160;purely&#160;as&#160;a&#160;convenience&#160;and the&#160;<br/>information is&#160;also available&#160;at&#160;the&#160;sheet&#160;level. For example,&#160;the&#160;Calc&#160;document&#160;acts&#160;as&#160;a&#160;draw-page&#160;supplier<br/>
506<br/>
<hr/>
<a name=510></a>to access&#160;all&#160;of the&#160;draw&#160;pages, even though they&#160;are&#160;available&#160;individually&#160;from&#160;the&#160;sheet&#160;that&#160;contains&#160;<br/>them.<br/>
<b>&#160;15.6.1.&#160;Named&#160;range<br/></b>The&#160;official&#160;definition&#160;of a&#160;named range&#160;is&#160;a&#160;named&#160;formula&#160;expression.&#160;Typically,&#160;a&#160;named&#160;range&#160;represents&#160;<br/>a&#160;cell&#160;range, but&#160;it&#160;may&#160;also refer to external&#160;data.&#160;Naming ranges&#160;allows&#160;you&#160;to&#160;give&#160;meaningful&#160;names&#160;to&#160;<br/>things&#160;that&#160;you&#160;reference. Named ranges&#160;may&#160;therefore&#160;be&#160;used as&#160;an address&#160;in&#160;a&#160;formula;&#160;for example,&#160;after<br/>defining a&#160;range&#160;named Scores, I&#160;can use&#160;the&#160;formula&#160;=Sum(Scores).&#160;The&#160;NamedRangeFlag constants&#160;define<br/>how&#160;a&#160;named range&#160;may&#160;be&#160;used (see<a href="libremacros.html#510">&#160;Table&#160;208).</a><br/>
<i>Table&#160;208.&#160;Constants&#160;defined by&#160;the&#160;com.sun.star.sheet.NamedRangeFlag&#160;constant&#160;group.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Name</b></i><br/>
<i><b>Description</b></i><br/>
1<br/>
FILTER_CRITERIA&#160;<br/>
The&#160;range&#160;contains&#160;filter&#160;criteria.<br/>
2<br/>
PRINT_AREA&#160;<br/>
The&#160;range&#160;can be&#160;used&#160;as a&#160;print&#160;range.<br/>
4<br/>
COLUMN_HEADER&#160;<br/>
The&#160;range&#160;can be&#160;used&#160;as column&#160;headers for&#160;printing.<br/>
8<br/>
ROW_HEADER&#160;<br/>
The&#160;range&#160;can be&#160;used&#160;as row&#160;headers&#160;for&#160;printing.<br/>
Each named&#160;range&#160;service&#160;supports&#160;the&#160;methods&#160;in<a href="libremacros.html#510">&#160;Table&#160;209.</a><br/>
<i>Table&#160;209.&#160;Methods&#160;implemented by&#160;the&#160;com.sun.star.sheet.NamedRange&#160;service.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getReferredCells()<br/>
Get&#160;the&#160;CellRange&#160;referenced by&#160;named range.<br/>
getContent()<br/>
The&#160;named&#160;range&#160;content&#160;is a&#160;string&#160;and can&#160;be&#160;a&#160;reference&#160;to a&#160;cell, cell&#160;range,&#160;<br/>
or&#160;formula&#160;expression.<br/>
setContent(String)<br/>
Set&#160;the&#160;content&#160;of&#160;the&#160;named&#160;range.<br/>
getReferencePosition()<br/>
Get&#160;the&#160;CellAddress used&#160;as&#160;a&#160;base&#160;for&#160;relative&#160;references in the&#160;content.<br/>
setReferencePosition(CellAddress)<br/>
Set&#160;the&#160;reference&#160;position.<br/>
getType()<br/>
Get&#160;the&#160;type&#160;as a&#160;NamedRangeFlag&#160;constant&#160;(see<a href="libremacros.html#510">&#160;Table&#160;208)</a>.<br/>
setType(NamedRangeFlag)<br/>
Set&#160;the&#160;type&#160;of&#160;the&#160;named range.<br/>
The&#160;document’s&#160;NamedRanges&#160;property&#160;contains&#160;the&#160;collection&#160;of named&#160;ranges&#160;in&#160;the&#160;document.&#160;You can&#160;<br/>extract&#160;each individual&#160;named range&#160;by&#160;using named&#160;and indexed&#160;access.<br/>
The&#160;method&#160;addNewByname() accepts&#160;four arguments;&#160;the&#160;name,&#160;content,&#160;position, and type.&#160;The&#160;fourth&#160;<br/>argument&#160;to the&#160;method&#160;addNewByName() is&#160;a&#160;combination&#160;of flags&#160;that&#160;specify&#160;how&#160;the&#160;named&#160;range&#160;will&#160;<br/>be&#160;used — the&#160;most&#160;common&#160;value&#160;is&#160;0, which is&#160;not&#160;a&#160;defined&#160;constant&#160;value.&#160;The&#160;name&#160;and the&#160;content&#160;are<br/>both of type&#160;String.&#160;The&#160;CellAddress&#160;specifies&#160;the&#160;base&#160;address&#160;for relative&#160;cell&#160;references.<br/>
<i><b>Listing&#160;446.</b>&#160;Create&#160;a named range&#160;that&#160;references&#160;$Sheet1.$B$3:$D$6.<br/></i>Sub&#160;AddNamedRange()<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160;' The created range.<br/>&#160;&#160;Dim&#160;oRanges&#160; &#160;&#160;' All named ranges.<br/>&#160;&#160;Dim&#160;sName$&#160; &#160; &#160;' Name of the named range to create.<br/>&#160;&#160;Dim&#160;oCell&#160; &#160; &#160;&#160;' Cell object.<br/>&#160;&#160;Dim&#160;s$<br/>
507<br/>
<hr/>
<a name=511></a>&#160;&#160;sName$&#160;=&#160;&#34;MyNRange&#34;<br/>&#160;&#160;oRanges&#160;=&#160;ThisComponent.NamedRanges<br/>&#160;&#160;If&#160;NOT&#160;oRanges.hasByName(sName$)&#160;Then<br/>&#160; &#160;&#160;REM I can obtain the cell address by obtaining the cell<br/>&#160; &#160;&#160;REM and then extracting the address from the cell.<br/>&#160; &#160;&#160;Dim&#160;oCellAddress&#160;As&#160;new&#160;com.sun.star.table.CellAddress<br/>&#160; &#160;&#160;oCellAddress.Sheet&#160;=&#160;0&#160; &#160; &#160;'The first sheet.<br/>&#160; &#160;&#160;oCellAddress.Column&#160;=&#160;1&#160; &#160;&#160;'Column B.<br/>&#160; &#160;&#160;oCellAddress.Row&#160;=&#160;2&#160; &#160; &#160; &#160;'Row 3.<br/>
&#160; &#160;&#160;REM The first argument is the range name.<br/>&#160; &#160;&#160;REM The second argument is formula or expression to<br/>&#160; &#160;&#160;REM use. The second argument is usually a string that<br/>&#160; &#160;&#160;REM defines a range.<br/>&#160; &#160;&#160;REM The third argument specifies the base address for<br/>&#160; &#160;&#160;REM relative cell references.<br/>&#160; &#160;&#160;REM The fourth argument is a set of flags that define<br/>&#160; &#160;&#160;REM how the range is used, but most ranges use 0.<br/>&#160; &#160;&#160;REM The fourth argument uses values from the<br/>&#160; &#160;&#160;REM NamedRangeFlag constants.<br/>&#160; &#160;&#160;s$&#160;=&#160;&#34;$Sheet1.$B$3:$D$6&#34;<br/>&#160; &#160;&#160;oRanges.addNewByName(sName$,&#160;s$,&#160;oCellAddress,&#160;0)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;REM Get a range using the created named range.<br/>&#160;&#160;oRange&#160;=&#160;ThisComponent.NamedRanges.getByName(sName$)<br/>
&#160;&#160;REM Print the string contained in cell $Sheet1.$B$3<br/>&#160;&#160;oCell&#160;=&#160;oRange.getReferredCells().getCellByPosition(0,0)<br/>&#160;&#160;Print&#160;oCell.getString()<br/>End&#160;Sub<br/>
The&#160;third&#160;argument, a&#160;cell&#160;address, acts&#160;as&#160;the&#160;base&#160;address&#160;for cells&#160;referenced in a&#160;relative&#160;way.&#160;If&#160;the&#160;cell&#160;<br/>range&#160;is&#160;not&#160;specified&#160;as&#160;an absolute&#160;address, the&#160;referenced range&#160;will&#160;be&#160;different&#160;based on where&#160;in&#160;the&#160;<br/>spreadsheet&#160;the&#160;range&#160;is&#160;used.&#160;The&#160;relative&#160;behavior is&#160;illustrated&#160;i<a href="libremacros.html#511">n&#160;Listing&#160;447, w</a>hich also illustrates&#160;<br/>another usage&#160;of a&#160;named range—defining an equation.&#160;The&#160;macro creates&#160;the&#160;named&#160;range&#160;AddLeft,&#160;which&#160;<br/>refers&#160;to&#160;the&#160;equation&#160;A3+B3 with&#160;C3 as&#160;the&#160;reference&#160;cell.&#160;The&#160;cells&#160;A3 and B3&#160;are&#160;the&#160;two cells&#160;directly&#160;to&#160;<br/>the&#160;left&#160;of C3,&#160;so, the&#160;equation&#160;=AddLeft&#160;calculates&#160;the&#160;sum&#160;of the&#160;two cells&#160;directly&#160;to the&#160;left&#160;of the&#160;cell&#160;<br/>that&#160;contains&#160;the&#160;equation.&#160;Changing the&#160;reference&#160;cell&#160;to&#160;C4, which&#160;is&#160;below&#160;A3 and B3, causes&#160;the&#160;AddLeft<br/>equation&#160;to calculate&#160;the&#160;sum&#160;of the&#160;two cells&#160;that&#160;are&#160;to the&#160;left&#160;on the&#160;previous&#160;row.<br/>
<i><b>Listing&#160;447.</b>&#160;Create&#160;the&#160;AddLeft&#160;named range.</i><br/>
Sub&#160;AddNamedFunction()<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160; &#160;&#160;'Sheet that contains the named range.<br/>&#160;&#160;Dim&#160;oCellAddress&#160; &#160;&#160;'Address for relative references.<br/>&#160;&#160;Dim&#160;oRanges&#160; &#160; &#160; &#160; &#160;'The NamedRanges property.<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160; &#160;&#160;'Single cell range.<br/>&#160;&#160;Dim&#160;sName&#160;As&#160;String&#160;'Name of the equation to create.<br/>
&#160;&#160;sName&#160;=&#160;&#34;AddLeft&#34;<br/>&#160;&#160;oRanges&#160;=&#160;ThisComponent.NamedRanges<br/>&#160;&#160;If&#160;NOT&#160;oRanges.hasByName(sName)&#160;Then<br/>&#160; &#160;&#160;oSheet&#160;=&#160;ThisComponent.getSheets().getByIndex(0)<br/>&#160; &#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;C3&#34;)<br/>
508<br/>
<hr/>
<a name=512></a>&#160; &#160;&#160;oCellAddress&#160;=&#160;oRange.getCellAddress()<br/>&#160; &#160;&#160;oRanges.addNewByName(sName,&#160;&#34;A3+B3&#34;,&#160;oCellAddress,&#160;0)<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
Use&#160;the&#160;method addNewFromTitles(CellRangeAddress, Border) to create&#160;named&#160;cell&#160;ranges&#160;from&#160;titles&#160;in&#160;a&#160;<br/>cell&#160;range.&#160;The&#160;Border value&#160;is&#160;taken from<a href="libremacros.html#512">&#160;Table&#160;210<b>&#160;</b></a>and it&#160;specifies&#160;where&#160;the&#160;titles&#160;are&#160;located in&#160;the&#160;cell&#160;<br/>range.<br/>
<i><b>Table&#160;210.</b>&#160;Enumerated values&#160;defined&#160;by&#160;the&#160;com.sun.star.sheet.Border&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.sheet.Border.TOP&#160;<br/>
Select&#160;the&#160;top&#160;border.<br/>
com.sun.star.sheet.Border.BOTTOM&#160;<br/>
Select&#160;the&#160;bottom&#160;border.<br/>
com.sun.star.sheet.Border.RIGHT&#160;<br/>
Select&#160;the&#160;right&#160;border.<br/>
com.sun.star.sheet.Border.LEFT&#160;<br/>
Select&#160;the&#160;left&#160;border.<br/>
The&#160;next&#160;macro creates&#160;three&#160;named ranges&#160;based on the&#160;top&#160;row&#160;of a&#160;cell&#160;range.<br/>
<i><b>Listing&#160;448.</b>&#160;Create&#160;many&#160;named ranges.</i><br/>
Sub&#160;AddManyNamedRanges()<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160;&#160;'Sheet that contains the named range.<br/>&#160;&#160;Dim&#160;oAddress&#160;&#160;'Range address.<br/>&#160;&#160;Dim&#160;oRanges&#160; &#160;'The NamedRanges property.<br/>&#160;&#160;Dim&#160;oRange&#160; &#160;&#160;'Single cell range.<br/>
&#160;&#160;oRanges&#160;=&#160;ThisComponent.NamedRanges<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.getSheets().getByIndex(0)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A1:C20&#34;)<br/>&#160;&#160;oAddress&#160;=&#160;oRange.getRangeAddress()<br/>&#160;&#160;oRanges.addNewFromTitles(oAddress,&#160;com.sun.star.sheet.Border.TOP)<br/>End&#160;Sub<br/>
Use&#160;the&#160;method outputList(CellAddress) to&#160;write&#160;a&#160;list&#160;of the&#160;named ranges&#160;to&#160;a&#160;sheet.&#160;The&#160;first&#160;column&#160;<br/>contains&#160;the&#160;name&#160;of each named range, and the&#160;second column&#160;contains&#160;the&#160;content.&#160;Finally,&#160;use&#160;the&#160;<br/>removeByName(name) method to&#160;remove&#160;a&#160;named&#160;range.<br/>
<b>&#160;15.6.2.&#160;Database&#160;range<br/></b>Although a&#160;database&#160;range&#160;can be&#160;used as&#160;a&#160;regular named range, a&#160;database&#160;range&#160;also defines&#160;a&#160;range&#160;of&#160;<br/>cells&#160;in&#160;a&#160;spreadsheet&#160;to be&#160;used as&#160;a&#160;database. Each row&#160;in a&#160;range&#160;corresponds&#160;to&#160;a&#160;record and each cell&#160;<br/>corresponds&#160;to&#160;a&#160;field.&#160;You can sort, group, search, and perform&#160;calculations&#160;on the&#160;range&#160;as&#160;if it&#160;were&#160;a&#160;<br/>database.<br/>
A&#160;database&#160;range&#160;provides&#160;behavior that&#160;is&#160;useful&#160;when performing database&#160;related activities. For example,&#160;<br/>you&#160;can mark the&#160;first&#160;row&#160;as&#160;headings.&#160;To&#160;create, modify,&#160;or delete&#160;a&#160;database&#160;range, use&#160;<b>Data &gt;&#160;Define&#160;<br/>Range</b>&#160;to&#160;open the&#160;Define&#160;Data&#160;Range&#160;dialog.<br/>
In&#160;a&#160;macro, a&#160;database&#160;range&#160;is&#160;accesses, created, and deleted&#160;from&#160;the&#160;DatabaseRanges&#160;property.&#160;The&#160;<br/>following&#160;macro creates&#160;a&#160;database&#160;range&#160;named “MyName”&#160;and sets&#160;the&#160;range&#160;to be&#160;used as&#160;an auto filter.<br/>
<i><b>Listing&#160;449.</b>&#160;Create&#160;a database&#160;range&#160;and an auto&#160;filter.<br/></i>Sub&#160;AddNewDatabaseRange()<br/>
509<br/>
<hr/>
<a name=513></a>&#160;&#160;Dim&#160;oRange&#160;'DatabaseRange object.<br/>&#160;&#160;Dim&#160;oAddr&#160;&#160;'Cell address range for the database range.<br/>&#160;&#160;Dim&#160;oSheet&#160;'First sheet, which will contain the range.<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160;'Reference ThisComponent with a shorter name.<br/>
&#160;&#160;oDoc&#160;=&#160;ThisComponent<br/>&#160;&#160;If&#160;NOT&#160;oDoc.DatabaseRanges.hasByName(&#34;MyName&#34;)&#160;Then<br/>&#160; &#160;&#160;oSheet&#160;=&#160;ThisComponent.getSheets().getByIndex(0)<br/>&#160; &#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A1:F10&#34;)<br/>&#160; &#160;&#160;oAddr&#160;=&#160;oRange.getRangeAddress()<br/>&#160; &#160;&#160;oDoc.DatabaseRanges.addNewByName(&#34;MyName&#34;,&#160;oAddr)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;oRange&#160;=&#160;oDoc.DatabaseRanges.getByName(&#34;MyName&#34;)<br/>&#160;&#160;oRange.AutoFilter&#160;=&#160;True<br/>End&#160;Sub<br/>
<b>&#160;15.6.3.&#160;Filters<br/></b>Use&#160;filters&#160;to&#160;limit&#160;the&#160;visible&#160;rows&#160;in a&#160;spreadsheet.&#160;Generic&#160;filters, common&#160;to all&#160;sorts&#160;of data&#160;<br/>manipulations, are&#160;automatically&#160;provided&#160;by&#160;the&#160;auto&#160;filter capability.&#160;You can also define&#160;your own filters.<br/>
<i><b>Listing&#160;450.</b>&#160;Create&#160;a simple&#160;sheet&#160;filter.<br/></i>Sub&#160;SimpleSheetFilter()<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160;' Sheet that will contain the filter.<br/>&#160;&#160;Dim&#160;oFilterDesc&#160;&#160;' Filter descriptor.<br/>&#160;&#160;Dim&#160;oFields(0)&#160;As&#160;New&#160;com.sun.star.sheet.TableFilterField<br/>&#160;&#160;<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.getSheets().getByIndex(0)<br/>&#160;&#160;<br/>&#160;&#160;REM If argument is True, creates an empty filter<br/>&#160;&#160;REM descriptor. If argument is False, create a&#160;<br/>&#160;&#160;REM descriptor with the previous settings.<br/>&#160;&#160;oFilterDesc&#160;=&#160;oSheet.createFilterDescriptor(True)<br/>&#160;&#160;<br/>&#160;&#160;With&#160;oFields(0)<br/>&#160; &#160;&#160;REM I could use the Connection property to indicate&#160;<br/>&#160; &#160;&#160;REM how to connect to the previous field. This is&#160;<br/>&#160; &#160;&#160;REM the first field so this is not required.<br/>&#160; &#160;&#160;'.Connection = com.sun.star.sheet.FilterConnection.AND<br/>&#160; &#160;&#160;'.Connection = com.sun.star.sheet.FilterConnection.OR<br/>
&#160; &#160;&#160;REM The Field property is the zero based column<br/>&#160; &#160;&#160;REM number to filter. If you have the cell, you<br/>&#160; &#160;&#160;REM can use .Field = oCell.CellAddress.Column.<br/>&#160; &#160;&#160;.Field&#160;=&#160;5<br/>
&#160; &#160;&#160;REM Compare using a numeric or a string?<br/>&#160; &#160;&#160;.IsNumeric&#160;=&#160;True<br/>
&#160; &#160;&#160;REM The NumericValue property is used&#160;<br/>&#160; &#160;&#160;REM because .IsNumeric = True from above.<br/>&#160; &#160;&#160;.NumericValue&#160;=&#160;80<br/>
510<br/>
<hr/>
<a name=514></a>&#160; &#160;&#160;REM If IsNumeric was False, then the&#160;<br/>&#160; &#160;&#160;REM StringValue property would be used.<br/>&#160; &#160;&#160;REM .StringValue = &#34;what ever&#34;<br/>
&#160; &#160;&#160;REM Valid operators include EMPTY, NOT_EMPTY, EQUAL,<br/>&#160; &#160;&#160;REM NOT_EQUAL, GREATER, GREATER_EQUAL, LESS,<br/>&#160; &#160;&#160;REM LESS_EQUAL, TOP_VALUES, TOP_PERCENT,<br/>&#160; &#160;&#160;REM BOTTOM_VALUES, and BOTTOM_PERCENT<br/>&#160; &#160;&#160;.Operator&#160;=&#160;com.sun.star.sheet.FilterOperator.GREATER_EQUAL<br/>&#160;&#160;End&#160;With<br/>&#160;&#160;<br/>&#160;&#160;REM The filter descriptor supports the following<br/>&#160;&#160;REM properties: IsCaseSensitive, SkipDuplicates,<br/>&#160;&#160;REM UseRegularExpressions,&#160;<br/>&#160;&#160;REM SaveOutputPosition, Orientation, ContainsHeader,&#160;<br/>&#160;&#160;REM CopyOutputData, OutputPosition, and MaxFieldCount.<br/>&#160;&#160;oFilterDesc.setFilterFields(oFields())<br/>&#160;&#160;oFilterDesc.ContainsHeader&#160;=&#160;True<br/>&#160;&#160;oSheet.filter(oFilterDesc)<br/>End&#160;Sub<br/>
When&#160;a&#160;filter is&#160;applied to&#160;a&#160;sheet,&#160;it&#160;replaces&#160;any&#160;existing filter for the&#160;sheet. Setting an empty&#160;filter in a&#160;<br/>sheet&#160;will&#160;therefore&#160;remove&#160;all&#160;filters&#160;for that&#160;sheet.<br/>
<i><b>Listing&#160;451.</b>&#160;Remove&#160;the&#160;current&#160;sheet&#160;filter.</i><br/>
Sub&#160;RemoveSheetFilter()<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160; &#160;&#160;' Sheet to filter.<br/>&#160;&#160;Dim&#160;oFilterDesc&#160; &#160; &#160;' Filter descriptor.<br/>&#160;&#160;<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.getSheets().getByIndex(0)<br/>&#160;&#160;oFilterDesc&#160;=&#160;oSheet.createFilterDescriptor(True)<br/>&#160;&#160;oSheet.filter(oFilterDesc)<br/>End&#160;Sub<br/>
A&#160;more&#160;advanced filter may&#160;filter more&#160;than one&#160;column.&#160;<br/>
<i><b>Listing&#160;452.</b>&#160;A&#160;simple&#160;sheet&#160;filter&#160;using&#160;two&#160;columns.<br/></i>Sub&#160;SimpleSheetFilter_2()<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160; &#160;&#160;' Sheet to filter.<br/>&#160;&#160;Dim&#160;oRange&#160; &#160; &#160; &#160; &#160;&#160;' Range to be filtered.<br/>&#160;&#160;Dim&#160;oFilterDesc&#160; &#160; &#160;' Filter descriptor.<br/>&#160;&#160;Dim&#160;oFields(1)&#160;As&#160;New&#160;com.sun.star.sheet.TableFilterField<br/>&#160;&#160;<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.getSheets().getByIndex(0)<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;E12:G19&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM If argument is True, creates an&#160;<br/>&#160;&#160;REM empty filter descriptor.<br/>&#160;&#160;oFilterDesc&#160;=&#160;oRange.createFilterDescriptor(True)<br/>
&#160;&#160;REM Setup a field to view cells with content that&#160;<br/>&#160;&#160;REM start with the letter b.<br/>&#160;&#160;With&#160;oFields(0)&#160; &#160;<br/>&#160; &#160;&#160;.Field&#160;=&#160;0&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' Filter column A.<br/>
511<br/>
<hr/>
<a name=515></a>&#160; &#160;&#160;.IsNumeric&#160;=&#160;False&#160; &#160; &#160;&#160;' Use a string, not a number.<br/>&#160; &#160;&#160;.StringValue&#160;=&#160;&#34;b.*&#34;&#160; &#160;&#160;' Everything starting with b.<br/>&#160; &#160;&#160;.Operator&#160;=&#160;com.sun.star.sheet.FilterOperator.EQUAL<br/>&#160;&#160;End&#160;With<br/>
&#160;&#160;REM Setup a field that requires both conditions and<br/>&#160;&#160;REM this new condition requires a value greater or&#160;<br/>&#160;&#160;REM equal to 70.<br/>&#160;&#160;With&#160;oFields(1)<br/>&#160; &#160;&#160;.Connection&#160;=&#160;com.sun.star.sheet.FilterConnection.AND<br/>&#160; &#160;&#160;.Field&#160;=&#160;5&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;' Filter column F.<br/>&#160; &#160;&#160;.IsNumeric&#160;=&#160;True&#160; &#160; &#160; &#160;' Use a number<br/>&#160; &#160;&#160;.NumericValue&#160;=&#160;70&#160; &#160; &#160;&#160;' Values greater than &#160;or equal to 70<br/>&#160; &#160;&#160;.Operator&#160;=&#160;com.sun.star.sheet.FilterOperator.GREATER_EQUAL<br/>&#160;&#160;End&#160;With<br/>
&#160;&#160;oFilterDesc.setFilterFields(oFields())<br/>&#160;&#160;oFilterDesc.ContainsHeader&#160;=&#160;False<br/>&#160;&#160;oFilterDesc.UseRegularExpressions&#160;=&#160;True<br/>&#160;&#160;oSheet.filter(oFilterDesc)<br/>End&#160;Sub<br/>
An advanced filter supports&#160;up to&#160;eight&#160;filter conditions,&#160;as&#160;opposed to the&#160;three&#160;supported by&#160;the&#160;simple&#160;<br/>filter.&#160;The&#160;criteria&#160;for an advanced filter is&#160;stored in a&#160;sheet.&#160;The&#160;first&#160;step in&#160;creating an advanced filter is&#160;<br/>entering the&#160;filter criteria&#160;into&#160;the&#160;spreadsheet.<br/>
1.&#160;Select&#160;an empty&#160;space&#160;in&#160;the&#160;Calc&#160;document.&#160;The&#160;empty&#160;space&#160;may&#160;reside&#160;in&#160;any&#160;sheet&#160;in any&#160;<br/>
location in&#160;the&#160;Calc&#160;document.<br/>
2.&#160;Duplicate&#160;the&#160;column&#160;headings&#160;from&#160;the&#160;area&#160;to be&#160;filtered into&#160;the&#160;area&#160;that&#160;will&#160;contain the&#160;filter&#160;<br/>
criteria.<br/>
3.&#160;Enter the&#160;filter criteria&#160;underneath the&#160;column&#160;headings.&#160;The&#160;criterion&#160;in each column&#160;of a&#160;row&#160;is&#160;<br/>
connected&#160;with&#160;AND.&#160;The&#160;criteria&#160;from&#160;each row&#160;are&#160;connected with&#160;OR.<br/>
Applying an advanced filter using a&#160;macro is&#160;simple.&#160;The&#160;cell&#160;range&#160;containing the&#160;filter criteria&#160;is&#160;used to&#160;<br/>create&#160;a&#160;filter descriptor,&#160;which&#160;is&#160;then used to&#160;filter the&#160;range&#160;containing the&#160;data.<br/>
<i><b>Listing&#160;453.</b>&#160;Use&#160;an advanced filter.<br/></i>Sub&#160;UseAnAdvancedFilter()<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160;'A sheet from the Calc document.<br/>&#160;&#160;Dim&#160;oRanges&#160; &#160;&#160;'The NamedRanges property.<br/>&#160;&#160;Dim&#160;oCritRange&#160;'Range that contains the filter criteria.<br/>&#160;&#160;Dim&#160;oDataRange&#160;'Range that contains the data to filter.<br/>&#160;&#160;Dim&#160;oFiltDesc&#160;&#160;'Filter descriptor.<br/>
&#160;&#160;REM Range that contains the filter criteria<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.getSheets().getByIndex(1)<br/>&#160;&#160;oCritRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A1:G3&#34;)<br/>
&#160;&#160;REM You can also obtain the range containing the&#160;<br/>&#160;&#160;REM filter criteria from a named range.<br/>&#160;&#160;REM oRanges = ThisComponent.NamedRanges<br/>&#160;&#160;REM oRange = oRanges.getByName(&#34;AverageLess80&#34;)<br/>&#160;&#160;REM oCritRange = oRange.getReferredCells()<br/>
512<br/>
<hr/>
<a name=516></a>&#160;&#160;REM The data that I want to filter<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.getSheets().getByIndex(0)<br/>&#160;&#160;oDataRange&#160;=&#160;oSheet.getCellRangeByName(&#34;A1:G16&#34;)<br/>
&#160;&#160;oFiltDesc&#160;=&#160;oCritRange.createFilterDescriptorByObject(oDataRange)<br/>&#160;&#160;oDataRange.filter(oFiltDesc)<br/>End&#160;Sub<br/>
<b>&#160;15.6.4.&#160;Protecting&#160;documents&#160;and&#160;sheets<br/></b>Calc&#160;documents&#160;and individual&#160;spreadsheets&#160;support&#160;the&#160;XProtectable&#160;interface. Use&#160;the&#160;methods&#160;<br/>protect(password) and unprotect(password) to activate&#160;or disable&#160;protection.&#160;The&#160;password is&#160;passed in&#160;as&#160;a&#160;<br/>String.&#160;The&#160;isProtected() method returns&#160;True&#160;if protection is&#160;currently&#160;active.<br/>
<b>&#160;15.6.5.&#160;Controlling&#160;recalculation<br/></b>By&#160;default,&#160;a&#160;Calc&#160;document&#160;automatically&#160;recalculates&#160;formulas&#160;when the&#160;cells&#160;to&#160;which&#160;they&#160;refer are&#160;<br/>modified.&#160;At&#160;times, it&#160;is&#160;useful&#160;to disable&#160;automatic&#160;recalculation.&#160;The&#160;methods&#160;in<a href="libremacros.html#516">&#160;Table&#160;211<b>&#160;</b></a>allow&#160;you to&#160;<br/>control&#160;recalculation in&#160;the&#160;entire&#160;document.<br/>
<i><b>Table&#160;211.</b>&#160;Methods&#160;defined by&#160;the&#160;com.sun.star.sheet.XCalculatable&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
calculate()<br/>
Recalculate&#160;all&#160;cells with&#160;changed&#160;content.<br/>
calculateAll()<br/>
Recalculate&#160;all&#160;cells.<br/>
isAutomaticCalculationEnabled()<br/>
True&#160;if&#160;automatic&#160;calculation is enabled.<br/>
enableAutomaticCalculation(Boolean)<br/>
Enable&#160;or&#160;disable&#160;automatic&#160;calculation.<br/>
<b>&#160;15.6.6.&#160;Using&#160;Goal&#160;Seek<br/></b>“Goal&#160;Seek”&#160;attempts&#160;to solve&#160;equations&#160;with&#160;one&#160;unknown variable. In&#160;other words, after defining a&#160;<br/>formula&#160;with&#160;multiple&#160;fixed&#160;values&#160;and one&#160;variable&#160;value,&#160;Goal&#160;Seek tries&#160;to find an acceptable&#160;value&#160;for&#160;<br/>the&#160;unknown variable.<br/>
Consider a&#160;very&#160;simple&#160;example.&#160;If&#160;you&#160;jump off&#160;a&#160;cliff, gravity&#160;will&#160;accelerate&#160;you&#160;toward the&#160;ground at&#160;32&#160;<br/>feet&#160;per second each second. In&#160;other words, in&#160;one&#160;second you&#160;will&#160;be&#160;traveling at&#160;32 feet&#160;per second and in&#160;<br/>two seconds&#160;you&#160;will&#160;be&#160;traveling at&#160;64 feet&#160;per second.&#160;The&#160;equation&#160;is&#160;given as&#160;“velocity&#160;=&#160;acceleration&#160;*&#160;<br/>time”. I&#160;have&#160;a&#160;constant&#160;value&#160;for the&#160;acceleration due&#160;to&#160;gravity,&#160;and I&#160;want&#160;to&#160;know&#160;how&#160;long before&#160;I&#160;am&#160;<br/>traveling at&#160;100 feet&#160;per second.&#160;Admittedly,&#160;this&#160;is&#160;a&#160;trivial&#160;example,&#160;but&#160;it&#160;is&#160;easy&#160;to understand.<br/>
Use&#160;the&#160;document&#160;method&#160;seekGoal(CellAddress, CellAddress, String) to perform&#160;a&#160;Goal&#160;Seek operation.&#160;<br/>The&#160;first&#160;cell&#160;address&#160;identifies&#160;the&#160;cell&#160;that&#160;contains&#160;the&#160;formula&#160;to&#160;solve.&#160;The&#160;second cell&#160;address&#160;identifies&#160;<br/>the&#160;cell&#160;that&#160;contains&#160;the&#160;variable&#160;that&#160;will&#160;change. Place&#160;the&#160;best&#160;guess&#160;that&#160;you&#160;can make&#160;into&#160;this&#160;cell.&#160;The&#160;<br/>final&#160;string contains&#160;the&#160;value&#160;that&#160;you&#160;want&#160;to&#160;obtain&#160;from&#160;the&#160;formula.&#160;The&#160;macro i<a href="libremacros.html#516">n&#160;Listing&#160;454&#160;s</a>ets&#160;the&#160;<br/>formula&#160;and then performs&#160;a&#160;Goal&#160;Seek operation.<br/>
<i><b>Listing&#160;454.</b>&#160;Set&#160;a simple&#160;goal&#160;seek.<br/></i>Sub&#160;GoalSeekExample<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160;'oSheet will contain the first sheet.<br/>&#160;&#160;Dim&#160;oGCell&#160; &#160;'B24, gravity value of 32<br/>&#160;&#160;Dim&#160;oTCell&#160; &#160;'C24, time value<br/>
513<br/>
<hr/>
<a name=517></a>&#160;&#160;Dim&#160;oRCell&#160; &#160;'Resulting equation &#34;=B24*C24&#34;<br/>&#160;&#160;Dim&#160;oGoal&#160; &#160;&#160;'Returned goal object<br/>&#160;&#160;oSheet&#160;=&#160;ThisComponent.Sheets(0)<br/>&#160;&#160;oGCell&#160;=&#160;oSheet.getCellByPosition(1,&#160;23)<br/>&#160;&#160;oGCell.setValue(32)<br/>&#160;&#160;<br/>&#160;&#160;oTCell&#160;=&#160;oSheet.getCellByPosition(2,&#160;23)<br/>&#160;&#160;oTCell.setValue(1)<br/>
&#160;&#160;oRCell&#160;=&#160;oSheet.getCellByPosition(0,&#160;23)<br/>&#160;&#160;oRCell.setFormula(&#34;=B24 * C24&#34;)<br/>&#160;&#160;<br/>&#160;&#160;oGoal=ThisComponent.seekGoal(oRCell.CellAddress,&#160;oTCell.CellAddress,&#160;&#34;100&#34;)<br/>&#160;&#160;MsgBox&#160;&#34;Result = &#34;&#160;&amp;&#160;oGoal.Result&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#34;The result changed by &#34;&#160;&amp;&#160;oGoal.Divergence&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#34; in the last iteration&#34;,&#160;0,&#160;&#34;Goal Seek&#34;<br/>End&#160;Sub<br/>
The&#160;seekGoal() method returns&#160;a&#160;structure&#160;containing&#160;two floating-point&#160;Double&#160;values.&#160;The&#160;Result&#160;property&#160;<br/>identifies&#160;the&#160;proposed solution.&#160;The&#160;Divergence&#160;property&#160;identifies&#160;the&#160;difference&#160;between the&#160;last&#160;guessed&#160;<br/>result&#160;and the&#160;current&#160;result. If&#160;the&#160;divergence&#160;is&#160;small,&#160;the&#160;result&#160;is&#160;probably&#160;reasonably&#160;accurate.&#160;If,&#160;<br/>however,&#160;the&#160;divergence&#160;is&#160;large, the&#160;result&#160;is&#160;probably&#160;inaccurate.&#160;I&#160;performed a&#160;test&#160;where&#160;there&#160;was&#160;no&#160;<br/>solution.&#160;The&#160;divergence&#160;value&#160;was&#160;roughly&#160;1.0E308.<br/>
Do not&#160;let&#160;the&#160;simplicity&#160;of the&#160;provided&#160;example&#160;fool&#160;you. I&#160;used the&#160;seekGoal() method&#160;to provide&#160;a&#160;<br/>solution to&#160;a&#160;problem&#160;that&#160;had no closed form&#160;solution&#160;—&#160;I&#160;had to use&#160;a&#160;numerical&#160;algorithm&#160;to&#160;solve&#160;the&#160;<br/>problem.<br/>
<i><b>&#160;15.7.&#160;Write&#160;your&#160;own&#160;Calc&#160;functions<br/></b></i>With OOo, it’s&#160;trivial&#160;to&#160;write&#160;and use&#160;your&#160;own functions&#160;that&#160;are&#160;recognized&#160;by&#160;the&#160;Calc&#160;document.&#160;It’s&#160;as&#160;<br/>simple&#160;as&#160;writing&#160;a&#160;macro and then addressing&#160;it&#160;directly.&#160;I&#160;wrote&#160;an example&#160;of this&#160;i<a href="libremacros.html#517">n&#160;Listing&#160;455&#160;t</a>hat&#160;<br/>returns&#160;information&#160;about&#160;the&#160;passed argument&#160;as&#160;a&#160;Stri<a href="libremacros.html#518">ng.&#160;Table&#160;212<b>&#160;</b></a>shows&#160;the&#160;return values&#160;for different&#160;<br/>arguments.<br/>
<i><b>Listing&#160;455.</b>&#160;Print&#160;information&#160;about&#160;the&#160;argument.<br/></i>Function&#160;WahooFunc(Optional&#160;x)&#160;As&#160;Variant<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;s&#160;=&#160;&#34;I am in WahooFunc. &#34;<br/>&#160;&#160;If&#160;IsMissing(x)&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;No argument was passed&#34;<br/>&#160;&#160;ElseIf&#160;NOT&#160;IsArray(x)&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Scalar argument (&#34;&#160;&amp;&#160;CStr(x)&#160;&amp;&#160;&#34;) is type &#34;&#160;&amp;&#160;TypeName(x)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Argument is an array (&#34;&#160;&amp;&#160;LBound(x,&#160;1)&#160;&amp;&#160;&#34; To &#34;&#160;&amp;&#160;UBound(x,&#160;1)&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;, &#34;&#160;&amp;&#160;LBound(x,&#160;2)&#160;&amp;&#160;&#34; To &#34;&#160;&amp;&#160;UBound(x,&#160;2)&#160;&amp;&#160;&#34;)&#34;<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;WahooFunc&#160;=&#160;s<br/>End&#160;Function<br/>
514<br/>
<hr/>
<a name=518></a><i><b>Table&#160;212.</b>&#160;Return&#160;values&#160;for&#160;different&#160;arguments&#160;to WahooFunc&#160;(assume&#160;cell&#160;E9&#160;contains&#160;2).</i><br/>
<i><b>Function</b></i><br/>
<i><b>Return</b></i><br/>
“=WahooFunc()”<br/>
I&#160;am&#160;in&#160;WahooFunc. No&#160;argument&#160;was&#160;passed.<br/>
“=WahooFunc(E9)”<br/>
I&#160;am&#160;in&#160;WahooFunc. Scalar&#160;argument&#160;(2)&#160;is type&#160;Double.<br/>
“=WahooFunc(2)”<br/>
I&#160;am&#160;in&#160;WahooFunc. Scalar&#160;argument&#160;(2)&#160;is type&#160;Double.<br/>
“=WahooFunc(A11:C15)”<br/>
I&#160;am&#160;in&#160;WahooFunc.&#160;Argument&#160;is&#160;an array&#160;(1&#160;To&#160;5,&#160;1&#160;To&#160;3).<br/>
The&#160;argument&#160;that&#160;is&#160;passed to&#160;the&#160;function&#160;that&#160;you&#160;write, may&#160;be&#160;missing. If&#160;the&#160;argument&#160;is&#160;declared as&#160;<br/>optional, use&#160;the&#160;IsMissing() method&#160;to&#160;test&#160;if&#160;a&#160;value&#160;has&#160;been passed. For example, “=WahooFunc()”.<br/>
You can directly&#160;pass&#160;a&#160;single&#160;scalar value&#160;either as&#160;a&#160;constant,&#160;or by&#160;referencing&#160;a&#160;single&#160;cell.&#160;For&#160;example,&#160;<br/>“=WahooFunc(32)”&#160;and “=WahooFunc(E7)”&#160;both pass&#160;a&#160;scalar value&#160;to&#160;the&#160;function.&#160;The&#160;first&#160;example&#160;<br/>passes&#160;the&#160;numeric&#160;value&#160;32 and the&#160;second example&#160;passes&#160;the&#160;contents&#160;of cell&#160;E7.<br/>
<b>Tip</b><br/>
The&#160;actual&#160;type&#160;of&#160;argument&#160;that&#160;is&#160;passed&#160;to your&#160;own&#160;functions depends&#160;on how&#160;it&#160;is&#160;called&#160;<br/>(see<a href="libremacros.html#518">&#160;Table&#160;212)</a>.&#160;When&#160;a&#160;range&#160;is&#160;used&#160;as the&#160;argument,&#160;the&#160;data&#160;is&#160;passed&#160;as a&#160;two-dimensional&#160;array&#160;that&#160;<br/>
does&#160;not&#160;use&#160;the&#160;traditional&#160;lower&#160;bound&#160;of&#160;zero.<br/>
If&#160;the&#160;argument&#160;refers&#160;to&#160;a&#160;range, a&#160;two-dimensional&#160;array&#160;is&#160;passed to&#160;the&#160;function.&#160;For example,&#160;<br/>“=WahooFunc(E7:F32)”&#160;passes&#160;the&#160;contents&#160;of the&#160;cells&#160;in&#160;the&#160;range&#160;E7 through F32 as&#160;a&#160;two-dimensional&#160;<br/>array.&#160;Be&#160;absolutely&#160;certain&#160;to use&#160;the&#160;functions&#160;LBound() and UBound(), because&#160;the&#160;lower bounds&#160;start&#160;at&#160;1<br/>rather than&#160;at&#160;the&#160;expected value&#160;of 0 (see<a href="libremacros.html#518">&#160;Listing&#160;456).</a><br/>
<i>Listing&#160;456.&#160;Add all&#160;elements&#160;together.</i><br/>
Function&#160;SumAll(myArray&#160;as&#160;Variant)<br/>&#160;&#160;Dim&#160;iRow%,&#160;iCol%<br/>&#160;&#160;Dim&#160;d&#160;As&#160;Double<br/>&#160;&#160;For&#160;iRow&#160;=&#160;LBound(myArray,&#160;1)&#160;To&#160;UBound(myArray,&#160;1)<br/>&#160; &#160;&#160;For&#160;iCol&#160;=&#160;LBound(myArray,&#160;2)&#160;To&#160;UBound(myArray,&#160;2)<br/>&#160; &#160; &#160;&#160;d&#160;=&#160;d&#160;+&#160;myArray(iRow,&#160;iCol)<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;Next<br/>&#160;&#160;SumAll&#160;=&#160;d<br/>End&#160;Function<br/>
The&#160;Calc&#160;function&#160;must&#160;be&#160;visible&#160;/&#160;available&#160;to the&#160;Calc&#160;document, so I&#160;store&#160;my&#160;Calc&#160;functions&#160;in&#160;the&#160;<br/>Standard library&#160;of the&#160;document&#160;that&#160;will&#160;use&#160;the&#160;functions.&#160;Sometimes,&#160;when I&#160;write&#160;a&#160;new&#160;function,&#160;the&#160;<br/>new&#160;function&#160;is&#160;not&#160;noticed until&#160;the&#160;document&#160;has&#160;been saved, closed, and then reopened.&#160;<br/>
<b>Tip</b><br/>
If&#160;Calc&#160;does not&#160;see&#160;a&#160;newly&#160;created&#160;function,&#160;save, close,&#160;and reopen the&#160;Calc&#160;document.<br/>
<b>Warn</b><br/>
Do not&#160;return&#160;a&#160;time&#160;or&#160;date&#160;in a&#160;Calc&#160;function, return a&#160;double&#160;instead.<br/>
Macros used as Calc functions have their values converted to a double or a string before they are stored in a <br/>
cell. The date type is converted to a string, which is not useful for date calculations. The proper way to <br/>
return a date and/or time is to convert the value to a Double and return the double. Calc will treat the value <br/>
as a date / time based on the cell formatting. <br/>
515<br/>
<hr/>
<a name=519></a><i><b>&#160;15.8.&#160;Using&#160;the&#160;current&#160;controller<br/></b></i>Each OOo document&#160;contains&#160;a&#160;controller that&#160;interacts&#160;with the&#160;user.&#160;Therefore, the&#160;current&#160;controller&#160;<br/>knows&#160;what&#160;text&#160;is&#160;selected,&#160;the&#160;location of the&#160;current&#160;cursor,&#160;and which sheet&#160;is&#160;active.<br/>
<b>&#160;15.8.1.&#160;Selected&#160;cells<br/></b>The&#160;document’s&#160;controller interacts&#160;with&#160;the&#160;user and therefore&#160;knows&#160;which&#160;cells&#160;are&#160;selected.&#160;In&#160;a&#160;Calc&#160;<br/>document,&#160;a&#160;selected&#160;cell&#160;can be&#160;a&#160;few&#160;different&#160;things.&#160;The&#160;following cases&#160;are&#160;numbered to simply&#160;<br/>reference&#160;each case;&#160;the&#160;numbering serves&#160;no other purpose.<br/>
1.&#160;One&#160;cell&#160;selected.&#160;To&#160;select&#160;an entire&#160;cell,&#160;click in&#160;a&#160;cell&#160;once&#160;and then hold&#160;down the&#160;Shift&#160;key&#160;and&#160;<br/>
click&#160;in the&#160;cell&#160;again.<br/>
2.&#160;Partial&#160;text&#160;in&#160;a&#160;single&#160;cell&#160;selected. Double-click in&#160;a&#160;single&#160;cell&#160;and then select&#160;some&#160;text.<br/>
3.&#160;Nothing appears&#160;selected. Single-click&#160;in a&#160;cell&#160;or tab&#160;between cells.<br/>
4.&#160;Multiple&#160;cells&#160;selected.&#160;Single-click in&#160;a&#160;cell&#160;and then drag the&#160;cursor.<br/>
5.&#160;Multiple&#160;disjointed&#160;selections.&#160;Select&#160;some&#160;cells. Hold down the&#160;Ctrl&#160;key&#160;and select&#160;some&#160;more.<br/>
So far,&#160;I&#160;have&#160;not&#160;been able&#160;to&#160;distinguish&#160;between the&#160;first&#160;three&#160;cases;&#160;they&#160;all&#160;look&#160;like&#160;one&#160;cell&#160;is&#160;selected.<br/>If&#160;only&#160;one&#160;cell&#160;is&#160;selected,&#160;the&#160;current&#160;selection&#160;returned by&#160;the&#160;current&#160;controller is&#160;the&#160;sheet&#160;cell&#160;containing<br/>the&#160;cursor.&#160;If&#160;a&#160;single&#160;cell&#160;is&#160;selected (cases&#160;1 through 3), the&#160;selections&#160;object&#160;supports&#160;the&#160;SheetCell&#160;service&#160;<br/>(see<a href="libremacros.html#519">&#160;Listing 457)</a>.<br/>
If&#160;multiple&#160;cells&#160;are&#160;selected as&#160;a&#160;single&#160;range&#160;(case&#160;4), the&#160;selections&#160;object&#160;is&#160;a&#160;SheetCellRange. Check to&#160;<br/>see&#160;if the&#160;selections&#160;object&#160;supports&#160;the&#160;SheetCellRanges&#160;service. If&#160;so, then more&#160;than&#160;one&#160;cell&#160;range&#160;is&#160;<br/>selected. Use&#160;the&#160;getCount() method&#160;of the&#160;selections&#160;object&#160;to&#160;see&#160;how&#160;many&#160;ranges&#160;are&#160;selected.&#160;<br/>
<i><b>Listing&#160;457.</b>&#160;Determine&#160;if&#160;anything is&#160;selected.<br/></i>Function&#160;CalcIsAnythingSelected(oDoc)&#160;As&#160;Boolean<br/>&#160;&#160;Dim&#160;oSelections<br/>
&#160;&#160;REM Assume that nothing is selected.<br/>&#160;&#160;CalcIsAnythingSelected&#160;=&#160;False<br/>&#160;&#160;If&#160;IsNull(oDoc)&#160;Then&#160;Exit&#160;Function<br/>&#160;&#160;REM The current selection in the current controller.&#160;<br/>&#160;&#160;REM If there is no current controller, this returns NULL.<br/>&#160;&#160;oSelections&#160;=&#160;oDoc.getCurrentSelection()<br/>&#160;&#160;If&#160;IsNull(oSelections)&#160;Then&#160;Exit&#160;Function<br/>
&#160;&#160;If&#160;oSelections.supportsService(&#34;com.sun.star.sheet.SheetCell&#34;)&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;One Cell selected = &#34;&#160;&amp;&#160;oSelections.getImplementationName()<br/>&#160; &#160;&#160;MsgBox&#160;&#34;getString() = &#34;&#160;&amp;&#160;oSelections.getString()<br/>&#160;&#160;ElseIf&#160;oSelections.supportsService(&#34;com.sun.star.sheet.SheetCellRange&#34;)&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;One Cell Range selected = &#34;&#160;&amp;&#160;oSelections.getImplementationName()<br/>&#160;&#160;ElseIf&#160;oSelections.supportsService(&#34;com.sun.star.sheet.SheetCellRanges&#34;)&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;Multiple Cell Ranges selected = &#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;oSelections.getImplementationName()<br/>&#160; &#160;&#160;Print&#160;&#34;Count = &#34;&#160;&amp;&#160;oSelections.getCount()<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;Something else selected = &#34;&#160;&amp;&#160;oSelections.getImplementationName()<br/>&#160;&#160;End&#160;If<br/>
516<br/>
<hr/>
<a name=520></a>&#160;&#160;CalcIsAnythingSelected&#160;=&#160;True<br/>End&#160;Function<br/>
<i><b>Enumerating&#160;the&#160;selected&#160;cells<br/></b></i><a href="libremacros.html#520">Listing 458&#160;i</a>s&#160;a&#160;utility&#160;routine&#160;that&#160;sets&#160;the&#160;text&#160;of the&#160;cells&#160;in&#160;a&#160;range&#160;to a&#160;specific&#160;value.&#160;Althoug<a href="libremacros.html#520">h&#160;Listing&#160;<br/>458&#160;i</a>s&#160;specifically&#160;designed to&#160;operate&#160;on a&#160;cell&#160;range, it&#160;uses&#160;methods&#160;that&#160;are&#160;also supported&#160;by&#160;a&#160;single&#160;<br/>cell.&#160;The&#160;macro, therefore, may&#160;be&#160;used by&#160;a&#160;cell&#160;or a&#160;cell&#160;range&#160;object.&#160;The&#160;method&#160;used in<a href="libremacros.html#520">&#160;Listing 458&#160;i</a>s&#160;a&#160;<br/>modification&#160;of an algorithm&#160;introduced to&#160;me&#160;by&#160;Sasa&#160;Kelecevic, on the&#160;OOo dev mailing list.&#160;<br/>
<i><b>Listing&#160;458.</b>&#160;Set&#160;all&#160;text&#160;in&#160;a range&#160;to&#160;a value.</i><br/>
Sub&#160;SetRangeText(oRange,&#160;s&#160;As&#160;String)<br/>&#160;&#160;Dim&#160;nCol&#160;As&#160;Long&#160;'Column index variable<br/>&#160;&#160;Dim&#160;nRow&#160;As&#160;Long&#160;'Row index variable<br/>&#160;&#160;Dim&#160;oCols&#160; &#160; &#160; &#160;&#160;'Columns in the selected range<br/>&#160;&#160;Dim&#160;oRows&#160; &#160; &#160; &#160;&#160;'Rows in the selected range<br/>
&#160;&#160;oCols&#160;=&#160;oRange.Columns&#160;:&#160;oRows&#160;=&#160;oRange.Rows<br/>&#160;&#160;For&#160;nCol&#160;=&#160;0&#160;To&#160;oCols.getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;For&#160;nRow&#160;=&#160;0&#160;To&#160;oRows.getCount()&#160;-&#160;1<br/>&#160; &#160; &#160;&#160;oRange.getCellByPosition(nCol,&#160;nRow).setString(s)<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
To&#160;demonstrate&#160;how&#160;to&#160;inspect&#160;all&#160;of the&#160;selected&#160;cells, the&#160;macro i<a href="libremacros.html#520">n&#160;Listing&#160;459&#160;s</a>ets&#160;the&#160;text&#160;in every&#160;<br/>selected cell&#160;to a&#160;specific&#160;text&#160;value.<br/>
<i><b>Listing&#160;459.</b>&#160;Set&#160;all&#160;selected&#160;cells&#160;to&#160;a value.</i><br/>
Sub&#160;SetSelectedCells(s&#160;As&#160;String)<br/>&#160;&#160;Dim&#160;oSelections&#160;'The selections object<br/>&#160;&#160;Dim&#160;oCell&#160; &#160; &#160; &#160;'If one cell is selected<br/>&#160;&#160;Dim&#160;oRanges&#160; &#160; &#160;'If multiple ranges are selected, use this<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Long&#160; &#160;'General index variable<br/>
&#160;&#160;REM The current selection in the current controller.&#160;<br/>&#160;&#160;REM If there is no current controller, this returns NULL.<br/>&#160;&#160;oSelections&#160;=&#160;ThisComponent.getCurrentSelection()<br/>&#160;&#160;If&#160;IsNull(oSelections)&#160;Then&#160;Exit&#160;Sub<br/>
&#160;&#160;If&#160;oSelections.supportsService(&#34;com.sun.star.sheet.SheetCell&#34;)&#160;Then<br/>&#160; &#160;&#160;oCell&#160;=&#160;oSelections<br/>&#160; &#160;&#160;oCell.setString(s)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM For consistency, I could use the same call for a range as a cell<br/>&#160; &#160;&#160;REM but this is only because a cell can also return the columns and rows.<br/>&#160; &#160;&#160;REM SetRangeText(oSelections, s)<br/>&#160;&#160;ElseIf&#160;oSelections.supportsService(&#34;com.sun.star.sheet.SheetCellRange&#34;)&#160;Then<br/>&#160; &#160;&#160;SetRangeText(oSelections,&#160;s)<br/>&#160;&#160;ElseIf&#160;oSelections.supportsService(&#34;com.sun.star.sheet.SheetCellRanges&#34;)&#160;Then<br/>&#160; &#160;&#160;oRanges&#160;=&#160;oSelections<br/>&#160; &#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oRanges.getCount()&#160;-&#160;1<br/>&#160; &#160; &#160;&#160;SetRangeText(oRanges.getByIndex(i),&#160;s)<br/>&#160; &#160;&#160;Next<br/>
517<br/>
<hr/>
<a name=521></a>&#160;&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;Something else selected = &#34;&#160;&amp;&#160;oSelections.getImplementationName()<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
&#160;While&#160;writing the&#160;macro in<a href="libremacros.html#520">&#160;Listing 459, I</a>&#160;experienced some&#160;initially&#160;perplexing behavior.&#160; My&#160;initial&#160;<br/>version&#160;o<a href="libremacros.html#520">f&#160;Listing&#160;459&#160;w</a>ould sometimes&#160;generate&#160;an error as&#160;it&#160;attempted to&#160;enter the&#160;subroutine, depending&#160;<br/>on the&#160;selected values.&#160;The&#160;run-time&#160;error would complain&#160;that&#160;an unsupported property&#160;or invalid&#160;value&#160;was<br/>used.&#160;To&#160;explain&#160;the&#160;problem&#160;(and the&#160;solution),&#160;notice&#160;that&#160;there&#160;are&#160;two places&#160;in&#160;the&#160;code&#160;where&#160;I&#160;assign&#160;<br/>oSelections&#160;to&#160;a&#160;temporary&#160;variable&#160;and then I&#160;use&#160;the&#160;variable.<a href="libremacros.html#521">&#160;Listing 460&#160;c</a>ontains&#160;the&#160;small&#160;sections&#160;of&#160;<br/>code&#160;extracted&#160;from<a href="libremacros.html#520">&#160;Listing&#160;459.</a><br/>
<i><b>Listing&#160;460.</b>&#160;I&#160;assign&#160;oSelections&#160;to a temporary&#160;variable&#160;before&#160;use.</i><br/>
oCell&#160;=&#160;oSelections<br/>oCell.setString(s)<br/>.....<br/>oRanges&#160;=&#160;oSelections<br/>For&#160;i&#160;=&#160;0&#160;To&#160;oRanges.getCount()&#160;-&#160;1<br/>&#160;&#160;SetRangeText(oRanges.getByIndex(i),&#160;s)<br/>Next<br/>
If&#160;oSelections&#160;refers&#160;to&#160;a&#160;cell, it&#160;doesn’t&#160;support&#160;the&#160;object&#160;method&#160;getCount(). If&#160;oSelections&#160;refers&#160;to a&#160;<br/>SheetCellRanges&#160;object,&#160;it&#160;doesn’t&#160;support&#160;the&#160;setString() object&#160;method.&#160;I&#160;can but&#160;assume&#160;that&#160;the&#160;OOo&#160;<br/>Basic&#160;interpreter attempts&#160;to resolve&#160;the&#160;properties&#160;and methods&#160;that&#160;an object&#160;references&#160;when it&#160;is&#160;assigned&#160;<br/>a&#160;value.&#160;For&#160;example, if the&#160;selections&#160;object&#160;is&#160;a&#160;cell, an error is&#160;raised because&#160;a&#160;cell&#160;doesn’t&#160;support&#160;the&#160;<br/>getCount() method. On the&#160;other hand, if more&#160;than one&#160;cell&#160;is&#160;selected,&#160;the&#160;returned object&#160;does&#160;not&#160;support&#160;<br/>the&#160;setString() method.&#160;Although this&#160;is&#160;not&#160;the&#160;first&#160;time&#160;that&#160;I&#160;have&#160;experienced this&#160;problem,&#160;it&#160;is&#160;the&#160;first&#160;<br/>time&#160;that&#160;I&#160;determined the&#160;nature&#160;of the&#160;problem&#160;and how&#160;to&#160;avoid it.<br/>
<i><b>Selecting&#160;text<br/></b></i>The&#160;current&#160;controller is&#160;used to determine&#160;the&#160;current&#160;selection,&#160;and it&#160;can also be&#160;used to&#160;set&#160;the&#160;current&#160;<br/>selection.&#160;Use&#160;the&#160;current&#160;controller’s&#160;select(obj) method to&#160;select&#160;cells&#160;in&#160;a&#160;sheet.&#160;The&#160;documentation&#160;<br/>essentially&#160;says&#160;that&#160;if&#160;the&#160;controller recognizes&#160;and is&#160;able&#160;to&#160;select&#160;the&#160;object&#160;passed as&#160;an argument,&#160;it&#160;will.<br/><a href="libremacros.html#521">Listing 461&#160;de</a>monstrates&#160;how&#160;to select&#160;cells.<br/>
<i><b>Listing&#160;461.</b>&#160;Select&#160;B28:D33 and then select&#160;cell&#160;A1 instead.</i><br/>
Dim&#160;oSheet,&#160;oRange,&#160;oCell,&#160;oController<br/>oController&#160;=&#160;ThisComponent.getCurrentController()<br/>oSheet&#160;=&#160;ThisComponent.Sheets(3)<br/>oRange&#160;=&#160;oSheet.getCellRangeByName(&#34;B28:D33&#34;)<br/>oController.select(oRange)<br/>oCell&#160;=&#160;oSheet.getCellByPosition(0,&#160;0)<br/>oController.select(oCell)<br/>
<i><b>The&#160;active&#160;cell<br/></b></i>The&#160;active&#160;cell&#160;contains&#160;the&#160;cursor.&#160;There&#160;is&#160;an active&#160;cell&#160;even when multiple&#160;cells&#160;are&#160;selected.&#160;<br/>Unfortunately,&#160;OOo does&#160;not&#160;provide&#160;a&#160;method&#160;to return the&#160;active&#160;cell&#160;when more&#160;than one&#160;cell&#160;is&#160;selected.&#160;<br/>Paolo Mantovani&#160;posted a&#160;very&#160;nice&#160;solution&#160;to this&#160;problem&#160;on the&#160;dev mailing list&#160;as&#160;shown in<a href="libremacros.html#521">&#160;Listing 462.<br/></a>The&#160;disadvantage&#160;to the&#160;macro i<a href="libremacros.html#521">n&#160;Listing&#160;462&#160;i</a>s&#160;that&#160;the&#160;active&#160;cell&#160;is&#160;no longer active&#160;after the&#160;macro runs.<br/>
<i>Listing&#160;462.&#160;Obtain the&#160;active&#160;cell.</i><br/>
REM Author: Paolo Mantovani<br/>
518<br/>
<hr/>
<a name=522></a>REM email: mantovani.paolo@tin.it<br/>Sub&#160;RetrieveTheActiveCell()<br/>&#160;&#160;Dim&#160;oOldSelection&#160;'The original selection of cell ranges<br/>&#160;&#160;Dim&#160;oRanges&#160; &#160; &#160; &#160;'A blank range created by the document<br/>&#160;&#160;Dim&#160;oActiveCell&#160; &#160;'The current active cell<br/>&#160;&#160;Dim&#160;oConv&#160; &#160; &#160; &#160; &#160;'The cell address conversion service<br/>&#160;&#160;Dim&#160;oDoc<br/>&#160;&#160;oDoc&#160;=&#160;ThisComponent<br/>
&#160;&#160;REM store the current selection<br/>&#160;&#160;oOldSelection&#160;=&#160;oDoc.CurrentSelection<br/>
&#160;&#160;REM Create an empty SheetCellRanges service and then select it.<br/>&#160;&#160;REM This leaves ONLY the active cell selected.<br/>&#160;&#160;oRanges&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.sheet.SheetCellRanges&#34;)<br/>&#160;&#160;oDoc.CurrentController.Select(oRanges)<br/>
&#160;&#160;REM Get the active cell!<br/>&#160;&#160;oActiveCell&#160;=&#160;oDoc.CurrentSelection<br/>
&#160;&#160;oConv&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.table.CellAddressConversion&#34;)<br/>&#160;&#160;oConv.Address&#160;=&#160;oActiveCell.getCellAddress<br/>&#160;&#160;Print&#160;oConv.UserInterfaceRepresentation<br/>&#160;&#160;print&#160;oConv.PersistentRepresentation<br/>
&#160;&#160;REM Restore the old selection, but lose the previously active cell<br/>&#160;&#160;oDoc.CurrentController.Select(oOldSelection)<br/>End&#160;Sub<br/>
<b>&#160;15.8.2.&#160;General&#160;functionality<br/></b>When&#160;searching for view-related&#160;functionality,&#160;the&#160;current&#160;controller is&#160;a&#160;good place&#160;to&#160;start<a href="libremacros.html#523">.&#160;Table&#160;213&#160;a</a><a href="libremacros.html#524">nd<br/>Table&#160;214&#160;c</a>ontain&#160;most&#160;of the&#160;methods&#160;and properties&#160;supported&#160;by&#160;the&#160;current&#160;controller that&#160;have&#160;not&#160;<br/>already&#160;been discussed.<br/>
519<br/>
<hr/>
<a name=523></a><i><b>Table&#160;213.</b>&#160;Methods&#160;supported by&#160;the&#160;current&#160;controller&#160;not&#160;already&#160;discussed.</i><br/>
<i><b>Methods</b></i><br/>
<i><b>Description</b></i><br/>
getActiveSheet()<br/>
Get&#160;the&#160;active&#160;spreadsheet.<br/>
setActiveSheet(XSpreadsheet)<br/>
Cause&#160;the&#160;specified sheet&#160;to become&#160;active.<br/>
getIsWindowSplit()<br/>
Return&#160;True&#160;if&#160;the&#160;view&#160;is split.<br/>
getSplitHorizontal()<br/>
Long&#160;Integer&#160;horizontal&#160;split&#160;position&#160;(in pixels).<br/>
getSplitVertical()<br/>
Long&#160;Integer&#160;vertical&#160;split&#160;position (in&#160;pixels).<br/>
getSplitColumn()<br/>
Long&#160;Integer&#160;column&#160;before&#160;which the&#160;view&#160;is&#160;split.<br/>
getSplitRow()<br/>
Long&#160;Integer&#160;row&#160;before&#160;which the&#160;view&#160;is split.<br/>
splitAtPosition(x,&#160;y)<br/>
Split&#160;the&#160;view&#160;at&#160;the&#160;specified&#160;position. If&#160;x=0,&#160;the&#160;split&#160;is only&#160;horizontal.&#160;<br/>If&#160;y=0,&#160;the&#160;split&#160;is only&#160;vertical.<br/>
hasFrozenPanes()<br/>
True&#160;if&#160;the&#160;view&#160;contains frozen panes.<br/>
freezeAtPosition(nCol,&#160;nRow)<br/>
Freeze&#160;panes with the&#160;specified&#160;number&#160;of&#160;columns&#160;and rows.<br/>
getFirstVisibleColumn()<br/>
Get&#160;the&#160;first&#160;visible&#160;column&#160;in&#160;the&#160;pane&#160;as&#160;a&#160;Long&#160;Integer.<br/>
setFirstVisibleColumn(Long)<br/>
Set&#160;the&#160;first&#160;visible&#160;column&#160;in the&#160;pane.<br/>
getFirstVisibleRow()<br/>
Get&#160;the&#160;first&#160;visible&#160;row&#160;in the&#160;pane&#160;as a&#160;Long&#160;Integer.<br/>
setFirstVisibleRow(Long)<br/>
Set&#160;the&#160;first&#160;visible&#160;row&#160;in the&#160;pane.<br/>
getVisibleRange()<br/>
Get&#160;the&#160;visible&#160;range&#160;in&#160;the&#160;pane&#160;as a&#160;CellRangeAddress.<br/>
520<br/>
<hr/>
<a name=524></a><i>Table&#160;214.&#160;Properties&#160;supported by&#160;the&#160;current&#160;controller&#160;not&#160;already&#160;discussed.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
ShowFormulas<br/>
If&#160;True, formulas are&#160;displayed&#160;instead&#160;of&#160;their&#160;results.<br/>
ShowZeroValues<br/>
If&#160;True, zero values are&#160;visible.<br/>
IsValueHighlightingEnabled<br/>
If&#160;True, strings, values, and&#160;formulas are&#160;displayed&#160;in different&#160;colors.<br/>
ShowNotes<br/>
If&#160;True, a&#160;marker&#160;is&#160;shown&#160;for&#160;notes in cells.<br/>
HasVerticalScrollBar<br/>
If&#160;True, a&#160;vertical&#160;scroll&#160;bar&#160;is used&#160;in&#160;the&#160;view.<br/>
HasHorizontalScrollBar<br/>
If&#160;True, a&#160;horizontal&#160;scroll&#160;bar&#160;is&#160;used in&#160;the&#160;view.<br/>
HasSheetTabs<br/>
If&#160;True, sheet&#160;tabs&#160;are&#160;used&#160;in the&#160;view.<br/>
IsOutlineSymbolsSet<br/>
If&#160;True, outline&#160;symbols&#160;are&#160;displayed.<br/>
HasColumnRowHeaders<br/>
If&#160;True, column&#160;and row&#160;headers are&#160;visible.<br/>
ShowGrid<br/>
If&#160;True, cell&#160;grid&#160;lines are&#160;displayed.<br/>
GridColor<br/>
Grid&#160;color&#160;as&#160;a&#160;Long&#160;Integer.<br/>
ShowHelpLines<br/>
If&#160;True, help lines&#160;are&#160;displayed&#160;while&#160;moving&#160;drawing&#160;objects.<br/>
ShowAnchor<br/>
If&#160;True, anchor&#160;symbols are&#160;displayed&#160;when drawing&#160;objects&#160;are&#160;selected.<br/>
ShowPageBreaks<br/>
If&#160;True, page&#160;breaks&#160;are&#160;displayed.<br/>
SolidHandles<br/>
If&#160;True, solid&#160;(colored)&#160;handles are&#160;displayed&#160;when&#160;drawing&#160;objects are&#160;selected.<br/>
ShowObjects<br/>
If&#160;True, embedded&#160;objects&#160;are&#160;displayed.<br/>
ShowCharts<br/>
If&#160;True, charts are&#160;displayed.<br/>
ShowDrawing<br/>
If&#160;True, drawing&#160;objects are&#160;displayed.<br/>
HideSpellMarks<br/>
If&#160;True, spelling&#160;marks&#160;are&#160;not&#160;displayed;&#160;this seems&#160;to be&#160;disabled.<br/>
ZoomType<br/>
Document&#160;zoom&#160;type&#160;as a&#160;com.sun.star.view.DocumentZoomType&#160;with&#160;the&#160;<br/>following&#160;values:<br/>•<br/>
OPTIMAL&#160;=&#160;0 –&#160;Fit&#160;the&#160;current&#160;page&#160;content&#160;width&#160;(no&#160;margins).<br/>
•<br/>
PAGE_WIDTH&#160;=&#160;1 –&#160;Fit&#160;the&#160;page&#160;width at&#160;the&#160;current&#160;selection.<br/>
•<br/>
ENTIRE_PAGE&#160;=&#160;2&#160;– Fit&#160;an entire&#160;page.<br/>
•<br/>
BY_VALUE&#160;=&#160;3 –&#160;The&#160;zoom&#160;is relative&#160;and set&#160;by&#160;ZoomValue.<br/>
•<br/>
PAGE_WIDTH_EXACT&#160;=&#160;4&#160;– Fit&#160;the&#160;current&#160;width and fit&#160;exactly&#160;to page&#160;<br/>end.<br/>
ZoomValue<br/>
Zoom&#160;value&#160;if&#160;the&#160;ZoomType&#160;is&#160;set&#160;to BY_VALUE .&#160;ZoomType&#160;must&#160;be&#160;set&#160;<br/>before&#160;the&#160;ZoomValue&#160;is set.<br/>
<i><b>&#160;15.9.&#160;Control&#160;Calc&#160;from&#160;Microsoft&#160;Office<br/></b></i>It&#160;turns&#160;out&#160;that&#160;you can control&#160;OOo from&#160;within&#160;the&#160;Microsoft&#160;Office&#160;family&#160;of products.&#160;The&#160;trick is&#160;to&#160;<br/>create&#160;a&#160;service&#160;manager,&#160;which&#160;starts&#160;OOo if it&#160;is&#160;not&#160;currently&#160;running.&#160;Accessing OOo documents&#160;from&#160;<br/>Microsoft&#160;Office&#160;is&#160;similar to&#160;accessing OOo documents&#160;using&#160;other non-StarBasic&#160;languages. OOo Basic&#160;<br/>provides&#160;nice&#160;shortcuts&#160;that&#160;are&#160;not&#160;available&#160;from&#160;Microsoft&#160;Office. For&#160;example, in&#160;OOo Basic, when I&#160;<br/>want&#160;the&#160;third sheet,&#160;I&#160;simply&#160;use&#160;oDoc.Sheets(2);&#160;in Microsoft&#160;Office, however,&#160;you cannot&#160;access&#160;the&#160;<br/>Sheets&#160;property&#160;as&#160;an array.&#160;I&#160;wrote&#160;and ran the&#160;macro in<a href="libremacros.html#525">&#160;Listing 463&#160;f</a>rom&#160;Microsoft&#160;Visual&#160;Basic&#160;from&#160;<br/>Microsoft&#160;Excel.<br/>
521<br/>
<hr/>
<a name=525></a><i><b>Listing&#160;463.</b>&#160;ControlOOo()&#160;demonstrates&#160;how to&#160;control&#160;OOo from&#160;Excel.<br/></i>Sub&#160;ControlOOo()<br/>&#160;&#160;Rem The service manager is always the first thing to create.<br/>&#160;&#160;Rem If OOo is not running, it is started.<br/>&#160;&#160;Set&#160;oManager&#160;=&#160;CreateObject(&#34;com.sun.star.ServiceManager&#34;)<br/>
&#160;&#160;Rem Create the desktop.<br/>&#160;&#160;Set&#160;oDesktop&#160;=&#160;oManager.createInstance(&#34;com.sun.star.frame.Desktop&#34;)<br/>
&#160;&#160;Rem Open a new empty Calc document.<br/>&#160;&#160;Dim&#160;args()<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Set&#160;s&#160;=&#160;&#34;private:factory/scalc&#34;<br/>&#160;&#160;Set&#160;oDoc&#160;=&#160;oDesktop.loadComponentFromURL(s,&#160;&#34;_blank&#34;,&#160;0,&#160;args())<br/>
&#160;&#160;Dim&#160;oSheet&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;oSheets&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;oCell&#160;As&#160;Object<br/>&#160;&#160;<br/>&#160;&#160;Set&#160;oSheets&#160;=&#160;oDoc.sheets.CreateEnumeration<br/>&#160;&#160;Set&#160;oSheet&#160;=&#160;oSheets.nextElement<br/>&#160;&#160;Set&#160;oCell&#160;=&#160;oSheet.getCellByPosition(0,&#160;0)<br/>&#160;&#160;oCell.setFormula&#160;(&#34;Hello From Excel&#34;)&#160;'Cell A1<br/>&#160;&#160;oCell.CellBackColor&#160;=&#160;RGB(127,&#160;127,&#160;127)<br/>End&#160;Sub<br/>
<i><b>&#160;15.10.&#160;Accessing&#160;Calc&#160;functions<br/></b></i>You can call&#160;Calc&#160;functions&#160;from&#160;a&#160;macro.<br/>
<i><b>Listing&#160;464.</b>&#160;Call&#160;the&#160;MIN function&#160;directly.</i><br/>
Sub&#160;callFunction<br/>&#160;&#160;Dim&#160;oFA<br/>&#160;&#160;oFA&#160;=&#160;createUnoService(&#160;&#34;com.sun.star.sheet.FunctionAccess&#34;&#160;)<br/>
&#160;&#160;' Calculate min of numbers.<br/>&#160;&#160;print&#160;oFA.callFunction(&#160;&#34;MIN&#34;,&#160;array(&#160;10,&#160;23,&#160;5,&#160;345&#160;)&#160;)<br/>End&#160;Sub&#160;<br/>
<i><b>&#160;15.11.&#160;Finding&#160;URLs&#160;in&#160;Calc<br/></b></i>In&#160;a&#160;Calc&#160;document, links&#160;(URLs) are&#160;stored in text&#160;fields.&#160;The&#160;following macro enumerates&#160;the&#160;text&#160;content&#160;<br/>in cell&#160;A1 of the&#160;first&#160;sheet&#160;for URLs. Note&#160;that&#160;the&#160;presentation&#160;and the&#160;URL&#160;may&#160;be&#160;different.<br/>
<i><b>Listing&#160;465.</b>&#160;Finds&#160;URLS in&#160;a sheet&#160;cell.</i><br/>
Sub&#160;FindHyperLinkInCell<br/>&#160;&#160;Dim&#160;oCell,&#160;oText,&#160;oParEnum,&#160;oParElement<br/>&#160;&#160;Dim&#160;oEnum,&#160;oElement&#160;<br/>&#160;&#160;oCell&#160;=&#160;ThisComponent.Sheets(0).getCellByPosition(0,&#160;0)<br/>&#160;&#160;oParEnum&#160;=&#160;oCell.getText().createEnumeration()<br/>&#160;&#160;Do&#160;While&#160;oParEnum.hasMoreElements&#160;()<br/>&#160; &#160;&#160;oParElement&#160;=&#160;oParEnum.nextElement()<br/>&#160; &#160;&#160;oEnum&#160;=&#160;oParElement.createEnumeration()<br/>&#160; &#160;&#160;Do&#160;While&#160;oEnum.hasMoreElements&#160;()<br/>
522<br/>
<hr/>
<a name=526></a>&#160; &#160; &#160;&#160;oElement&#160;=&#160;oEnum.nextElement()<br/>&#160; &#160; &#160;&#160;If&#160;oElement.TextPortionType&#160;=&#160;&#34;TextField&#34;&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;If&#160;oElement.TextField.supportsService(&#34;com.sun.star.text.TextField.URL&#34;)&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;'STRING &#160;Representation =&#160;<br/>&#160; &#160; &#160; &#160; &#160;&#160;'STRING &#160;TargetFrame =&#160;<br/>&#160; &#160; &#160; &#160; &#160;&#160;'STRING &#160;URL =&#160;<br/>&#160; &#160; &#160; &#160; &#160;&#160;Print&#160;oElement.TextField.URL<br/>&#160; &#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Loop<br/>&#160;&#160;Loop<br/>End&#160;Sub&#160;<br/>
<i><b>&#160;15.12.&#160;Importing&#160;and&#160;Exporting&#160;XML&#160;Files&#160;Using&#160;Calc<br/></b></i>This&#160;section,&#160;originally&#160;written&#160;by&#160;Volker Lenhardt,&#160;discusses&#160;simple&#160;methods&#160;for importing&#160;and exporting&#160;<br/>Extensible&#160;Markup Language&#160;(XML) files.&#160;The&#160;ideas&#160;and code&#160;are&#160;taken from&#160;a&#160;working&#160;project.<br/>
XML&#160;is&#160;a&#160;formal&#160;description of tags&#160;and how&#160;tags&#160;can be&#160;combined to&#160;form&#160;a&#160;hierarchical&#160;data&#160;structure.&#160;You<br/>can choose&#160;the&#160;tag&#160;and attributes&#160;names&#160;as&#160;you like&#160;– within&#160;limits.&#160;HTML&#160;is&#160;XML&#160;with fewer rules&#160;– so&#160;<br/>valid&#160;HTML&#160;need not&#160;be&#160;valid XML.&#160;Wikipedia&#160;is&#160;a&#160;good place&#160;to&#160;learn more&#160;about&#160;XML.<br/>
<b>Warn</b><br/>
Some&#160;methods caused&#160;OOo&#160;version 3.3&#160;to crash;&#160;for&#160;example,&#160;getElementsByTagName&#160;crashed&#160;for&#160;some&#160;<br/>tag&#160;names.&#160;The&#160;methods&#160;functioned&#160;correctly&#160;with LibreOffice,&#160;I&#160;have&#160;not&#160;checked them&#160;against&#160;AOO.<br/>
XML&#160;files&#160;are&#160;simple&#160;text&#160;files.&#160;If&#160;you need to&#160;regularly&#160;convert&#160;XML&#160;to&#160;Calc&#160;or Base&#160;you&#160;could write&#160;an&#160;<br/>XSLT&#160;filter,&#160;which&#160;is&#160;not&#160;covered in this&#160;book.<br/>
Most&#160;modern programming&#160;languages&#160;have&#160;implemented&#160;two tools&#160;to import&#160;XML&#160;data:&#160;SAX&#160;(Simple&#160;API&#160;<br/>for XML) and DOM&#160;(Document&#160;Object&#160;Model). UNO&#160;defines&#160;com.sun.star.xml.sax.XParser for SAX&#160;<br/>processing and com.sun.star.xml.dom.DocumentBuilder for DOM&#160;processing.&#160;The&#160;main difference&#160;between&#160;<br/>these&#160;two tools&#160;is&#160;the&#160;way&#160;that&#160;they&#160;read the&#160;data&#160;from&#160;the&#160;file.&#160;SAX&#160;reads&#160;the&#160;data&#160;continually,&#160;the&#160;Basic&#160;<br/>code&#160;implements&#160;a&#160;listener to&#160;handle&#160;the&#160;data&#160;as&#160;it&#160;is&#160;read. DOM, on the&#160;other hand, reads&#160;all&#160;of the&#160;data&#160;into&#160;<br/>an in memory&#160;hierarchically&#160;structured object.&#160;DOM&#160;is&#160;fast,&#160;but&#160;uses&#160;more&#160;memory,&#160;SAX&#160;can easily&#160;handle&#160;<br/>large&#160;files.&#160;This&#160;section covers&#160;DOM, not&#160;SAX.&#160;The&#160;coverage&#160;ignores&#160;complex&#160;topics&#160;such as&#160;validation,&#160;<br/>name&#160;spaces, and exceptions.<br/>
<b>Tip</b><br/>
It&#160;is&#160;very&#160;important&#160;that&#160;you are&#160;acquainted&#160;with the&#160;data&#160;structure&#160;of&#160;the&#160;XML&#160;file&#160;in&#160;question.<br/>
<b>&#160;15.12.1.&#160;Read&#160;an&#160;XML&#160;file<br/></b>The&#160;com.sun.star.xml.dom.DocumentBuilder service&#160;has&#160;two parse&#160;methods&#160;that&#160;return the&#160;entire&#160;data&#160;tree&#160;<br/>as&#160;a&#160;DOM&#160;object.&#160;The&#160;first&#160;parse&#160;method accepts&#160;an input&#160;stream, which may&#160;come&#160;from&#160;anywhere;&#160;for a&#160;<br/>simple&#160;text&#160;file, SimpleFileAccess&#160;can return an input&#160;stream.&#160;The&#160;second parse&#160;method&#160;accepts&#160;the&#160;URL&#160;of&#160;<br/>the&#160;file&#160;(see<a href="libremacros.html#526">&#160;Listing 466)</a>.<br/>
<i><b>Listing&#160;466.</b>&#160;Read an XML&#160;file.<br/></i>REM Build a DOM Document tree from an XML file.<br/>Function&#160;BuildDOMDoc(sUrl&#160;As String)<br/>&#160;&#160;Dim&#160;oDocBuilder<br/>
523<br/>
<hr/>
<a name=527></a>&#160;&#160;Dim&#160;oDOM<br/>&#160;&#160;BuildDOMDoc&#160;=&#160;oDOM<br/>&#160;&#160;<br/>&#160; On Error Goto&#160;Catch<br/>&#160;&#160;<br/>&#160;&#160;oDocBuilder&#160;=&#160;createUnoService(&#34;com.sun.star.xml.dom.DocumentBuilder&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM oDocBuilder reads the complete XML file and returns an object<br/>&#160;&#160;REM containing a tree structure of all &#34;nodes&#34;.<br/>&#160;&#160;oDOM&#160;=&#160;oDocBuilder.parseURI(sURL)<br/>&#160;&#160;<br/>&#160;&#160;REM There were no errors.<br/>&#160;&#160;oDOM.normalize()<br/>&#160;&#160;BuildDOMDoc&#160;=&#160;oDOM<br/>&#160;&#160;Exit Function<br/>&#160;&#160;<br/>&#160;&#160;Catch:<br/>&#160;&#160;MsgBox&#160;&#34;Error while importing the XML data &#34;&#160;&amp; CHR$(10) &amp; CHR$(10) _<br/>&#160; &#160; &amp;&#160;Error$ &amp;&#160;&#34; &#34;&#160;&amp; CHR$(10) &amp;&#160;&#34; &#34;,&#160;16,&#160;&#34;XML Import&#34;<br/>End Function<br/>
The&#160;XML&#160;file&#160;i<a href="libremacros.html#527">n&#160;Listing&#160;467&#160;i</a>s&#160;based on a&#160;real&#160;example.&#160;The&#160;entire&#160;document&#160;contains&#160;an outer slots&#160;tag,&#160;<br/>which&#160;represents&#160;a&#160;database. Each record is&#160;called a&#160;slot, some&#160;are&#160;active, some&#160;are&#160;reserved, some&#160;are&#160;free.&#160;<br/>Each slot&#160;represents&#160;a&#160;single&#160;client.<br/>
<i><b>Listing&#160;467.</b>&#160;Sample&#160;XML&#160;file.</i><br/>
&lt;<b>slots</b>&gt;<br/>&#160;&#160;&lt;<b>slot</b>&#160;<b>status</b>=&#34;active&#34;&#160;ID=&#34;10317&#34;&gt;<br/>&#160; &#160;&#160;&lt;<b>document</b>&#160;ID=&#34;1234&#34;&#160;title=&#34;Boom boom&#34;&#160;/&gt;<br/>&#160; &#160;&#160;&lt;<b>validTo</b>&gt;12/03/2011&lt;/<b>validTo</b>&gt;<br/>&#160; &#160;&#160;&lt;<b>customer</b>&#160;<b>name</b>=&#34;Becker&#34;&#160;<b>gender</b>=&#34;m&#34;&#160;ID=&#34;11051&#34;&#160;<b>email</b>=<a href="mailto:bb@tennis.de">&#34;bb@tennis.de&#34;</a>&#160;/&gt;<br/>&#160;&#160;&lt;/<b>slot</b>&gt;<br/>&#160;&#160;&lt;<b>slot</b>&#160;<b>status</b>=&#34;free&#34;&#160;ID=&#34;60072&#34;&gt;<br/>&#160;&#160;&lt;/<b>slot</b>&gt;<br/>&lt;/<b>slots</b>&gt;<br/>
The&#160;problem&#160;was&#160;to&#160;create&#160;a&#160;mail&#160;merge&#160;to&#160;ask active&#160;clients&#160;about&#160;to&#160;expire&#160;if they&#160;desired to prolong their&#160;<br/>service.&#160;The&#160;macro needed to&#160;appropriately&#160;filter the&#160;data&#160;based on the&#160;status&#160;attribute&#160;and&#160;ValidTo&#160;element,&#160;<br/>then extract&#160;the&#160;name, gender,&#160;email,&#160;ID,&#160;and document&#160;title.&#160;The&#160;elements,&#160;attributes, and text&#160;contents&#160;are&#160;<br/>represented&#160;as&#160;“nodes”&#160;in&#160;the&#160;DOM&#160;tree;&#160;the&#160;entire&#160;document&#160;is&#160;the&#160;root&#160;node.&#160;The&#160;<br/>com.sun.star.xml.dom.XNode&#160;API&#160;documentation&#160;describes&#160;this&#160;primary&#160;DOM&#160;datatype&#160;as&#160;follows:<br/>
“The&#160;Node&#160;interface&#160;is&#160;the&#160;primary&#160;datatype&#160;for the&#160;entire&#160;Document&#160;Object&#160;Model. It&#160;represents&#160;a&#160;single&#160;<br/>node&#160;in the&#160;document&#160;tree.&#160;While&#160;all&#160;objects&#160;implementing&#160;the&#160;Node&#160;interface&#160;expose&#160;methods&#160;for dealing&#160;<br/>with children, not&#160;all&#160;objects&#160;implementing the&#160;Node&#160;interface&#160;may&#160;have&#160;children. For example,&#160;Text&#160;nodes&#160;<br/>may&#160;not&#160;have&#160;children, and adding children to such nodes&#160;results&#160;in a&#160;DOMException&#160;being raised.<br/>
The&#160;“nodeName”, “nodeValue”, and “attributes”&#160;properties&#160;provide&#160;access&#160;to commonly&#160;used data&#160;from&#160;a&#160;<br/>node.&#160;The&#160;property&#160;returns&#160;null&#160;if there&#160;is&#160;no obvious&#160;mapping&#160;of these&#160;attributes&#160;for a&#160;specific&#160;nodeType;&#160;for<br/>example,&#160;a&#160;comment&#160;cannot&#160;have&#160;attributes. Specific&#160;node&#160;types&#160;may&#160;contain additional&#160;more&#160;convenient&#160;<br/>mechanisms&#160;to get&#160;and set&#160;relevant&#160;information.<br/>
524<br/>
<hr/>
<a name=528></a><a href="libremacros.html#528">Table&#160;215&#160;s</a>hows&#160;the&#160;specialized&#160;node&#160;interfaces&#160;that&#160;are&#160;derived from&#160;XNode&#160;together with their types,&#160;<br/>names, and values.&#160;The&#160;node&#160;type&#160;is&#160;the&#160;corresponding value&#160;from&#160;the&#160;com.sun.star.xml.dom.NodeType&#160;<br/>enumeration.<br/>
<i><b>Table&#160;215.</b>&#160;Specialized Nodes.</i><br/>
<i><b>Interface</b></i><br/>
<i><b>Node&#160;Type</b></i><br/>
<i><b>Node&#160;Name&#160;</b></i><br/>
<i><b>Node&#160;Value</b></i><br/>
XAttr<br/>
ATTRIBUTE_NODE<br/>
The&#160;name&#160;of&#160;the&#160;<br/>
The&#160;value&#160;of&#160;the&#160;attribute<br/>
attribute<br/>
XCDATASection<br/>
CDATA_SECTION_NODE<br/>
&#34;#cdata-section&#34;<br/>
The&#160;content&#160;of&#160;the&#160;CDATA&#160;<br/>
section<br/>
XComment<br/>
COMMENT_NODE<br/>
&#34;#comment&#34;<br/>
The&#160;content&#160;of&#160;the&#160;comment<br/>
XDocument<br/>
DOCUMENT_NODE<br/>
&#34;#document&#34;<br/>
Null<br/>
XDocumentFragment<br/>
DOCUMENT_FRAGMENT_NODE<br/>
&#34;#document-fragment&#34;<br/>
Null<br/>
XDocumentType<br/>
DOCUMENT_TYPE_NODE<br/>
The&#160;document&#160;type&#160;<br/>
Null<br/>
name<br/>
XElement<br/>
ELEMENT_NODE<br/>
The&#160;tag&#160;name<br/>
Null<br/>
XEntity<br/>
ENTITY_NODE<br/>
The&#160;entity&#160;name<br/>
Null<br/>
XEntityReference<br/>
ENTITY_REFERENCE_NODE<br/>
The&#160;name&#160;of&#160;entity&#160;<br/>
Null<br/>
referenced<br/>
XNotation<br/>
NOTATION_NODE<br/>
The&#160;notation&#160;name<br/>
Null<br/>
XProcessingInstruction<br/>
PROCESSING_INSTRUCTION_NODE<br/>
The&#160;target<br/>
The&#160;entire&#160;content&#160;excluding&#160;<br/>
the&#160;target<br/>
XText<br/>
TEXT_NODE<br/>
&#34;#text&#34;<br/>
The&#160;content&#160;of&#160;the&#160;text&#160;node<br/>
For&#160;the&#160;methods&#160;implemented with&#160;XNode&#160;see<a href="libremacros.html#528">&#160;Table&#160;216.</a><br/>
<i><b>Table&#160;216.</b>&#160;Methods&#160;implemented in&#160;the&#160;com.sun.star.xml.dom.XNode&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
appendChild(newChild)<br/>
Adds the&#160;node&#160;newChild to the&#160;end&#160;of&#160;the&#160;list&#160;of&#160;children of&#160;this&#160;node.<br/>
cloneNode(deep&#160;As&#160;boolean)<br/>
Returns a&#160;duplicate&#160;of&#160;this node,&#160;i.e.,&#160;serves as a&#160;generic&#160;copy&#160;constructor&#160;for&#160;nodes.<br/>Parameter&#160;deep:&#160;True&#160;=&#160;clone&#160;node&#160;together&#160;with any&#160;children, &#160;False&#160;=&#160;clone&#160;without&#160;<br/>
children<br/>
getAttributes()<br/>
Returns a&#160;NamedNodeMap&#160;containing&#160;the&#160;attributes of&#160;this node&#160;(if&#160;it&#160;is an Element)&#160;or<br/>
null&#160;otherwise.<br/>
getChildNodes()<br/>
Returns a&#160;NodeList&#160;that&#160;contains&#160;all&#160;children of&#160;this node.<br/>
getFirstChild()<br/>
Returns the&#160;first&#160;child&#160;of&#160;this node.<br/>
getLastChild()<br/>
Returns the&#160;last&#160;child of&#160;this&#160;node.<br/>
getLocalName()<br/>
Returns the&#160;local&#160;part&#160;of&#160;the&#160;qualified&#160;name&#160;of&#160;this node.<br/>
getNamespaceURI()<br/>
The&#160;namespace&#160;URI&#160;of&#160;this&#160;node, or&#160;null&#160;if&#160;it&#160;is unspecified.<br/>
getNextSibling()<br/>
Returns the&#160;node&#160;immediately&#160;following&#160;this node.<br/>
getNodeName()<br/>
The&#160;name&#160;of&#160;this node,&#160;depending&#160;on its&#160;type;&#160;see&#160;the&#160;table&#160;above.<br/>
getNodeType()<br/>
A&#160;code&#160;representing&#160;the&#160;type&#160;of&#160;the&#160;underlying&#160;object,&#160;as defined&#160;above.<br/>
getNodeValue()<br/>
Returns the&#160;value&#160;of&#160;this node.<br/>
getOwnerDocument()<br/>
The&#160;Document&#160;object&#160;associated&#160;with this node.<br/>
525<br/>
<hr/>
<a name=529></a><i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getParentNode()<br/>
The&#160;parent&#160;of&#160;this node.<br/>
getPrefix()<br/>
The&#160;namespace&#160;prefix&#160;of&#160;this&#160;node, or&#160;null&#160;if&#160;it&#160;is unspecified.<br/>
getPreviousSibling()<br/>
The&#160;node&#160;immediately&#160;preceding&#160;this node.<br/>
hasAttributes()<br/>
Returns whether&#160;this&#160;node&#160;(if&#160;it&#160;is&#160;an element)&#160;has&#160;any&#160;attributes.<br/>
hasChildNodes()<br/>
Returns whether&#160;this&#160;node&#160;has any&#160;children.<br/>
insertBefore(newChild, refChild)<br/>
Inserts the&#160;node&#160;newChild before&#160;the&#160;existing&#160;child node&#160;refChild.<br/>
isSupported(feature, ver)<br/>
Tests whether&#160;the&#160;DOM&#160;implementation implements&#160;a&#160;specific&#160;feature&#160;and that&#160;feature&#160;<br/>
is supported&#160;by&#160;this&#160;node.<br/>
normalize()<br/>
Puts&#160;all&#160;Text&#160;nodes&#160;in&#160;the&#160;full&#160;depth of&#160;the&#160;sub-tree&#160;underneath this Node,&#160;including&#160;<br/>
attribute&#160;nodes,&#160;into&#160;a&#160;&#34;normal&#34;&#160;form&#160;where&#160;only&#160;structure&#160;(e.g., elements, comments,&#160;<br/>processing&#160;instructions,&#160;CDATA&#160;sections, and entity&#160;references)&#160;separates&#160;Text&#160;nodes,&#160;<br/>
i.e.,&#160;there&#160;are&#160;neither&#160;adjacent&#160;Text&#160;nodes nor&#160;empty&#160;Text&#160;nodes.<br/>
removeChild(oldChild)<br/>
Removes the&#160;child node&#160;indicated&#160;by&#160;oldChild from&#160;the&#160;list&#160;of&#160;children,&#160;and&#160;returns it.<br/>
replaceChild(newChild,&#160;oldChild)<br/>
Replaces the&#160;child&#160;node&#160;oldChild&#160;with newChild in the&#160;list&#160;of&#160;children,&#160;and&#160;returns the&#160;<br/>oldChild node.&#160;<br/>
setNodeValue(nodeValue)<br/>
The&#160;value&#160;of&#160;this node,&#160;depending&#160;on its type;&#160;see&#160;the&#160;table&#160;above.<br/>
setPrefix(prefix)<br/>
The&#160;namespace&#160;prefix&#160;of&#160;this&#160;node, or&#160;null&#160;if&#160;it&#160;is unspecified.<br/>
A&#160;node&#160;list&#160;is&#160;usually&#160;returned as&#160;a&#160;com.sun.star.xml.dom.XNodeList&#160;interface.&#160;The&#160;most&#160;used methods&#160;from<br/>the&#160;XNodeList&#160;interface&#160;are&#160;getLength(), to determine&#160;the&#160;number of listed&#160;nodes, and item(Long)&#160;to&#160;get&#160;a&#160;<br/>single&#160;node&#160;based on its&#160;location&#160;in&#160;the&#160;list.&#160;A&#160;node&#160;list&#160;is&#160;sometimes&#160;returned as&#160;a&#160;the&#160;<br/>com.sun.star.xml.dom.XNamedNodeMap interface, which&#160;provides&#160;access&#160;to&#160;the&#160;contained nodes&#160;by&#160;name.&#160;<br/>The&#160;following&#160;macro demonstrates&#160;three&#160;methods&#160;for getting the&#160;value&#160;of an element&#160;attribute.<br/>
<i><b>Listing&#160;468.</b>&#160;Three&#160;ways&#160;to get&#160;an attribute&#160;from&#160;an element.<br/></i>'The long way<br/>oAttList&#160;=&#160;oElement.getAttributes &#160; &#160; &#160; &#160; &#160;' Get all attributes.<br/>oAttNode&#160;=&#160;oAttList.getNamedItem(&#34;ID&#34;) &#160; &#160;&#160;' Get the attribute node from attributes.<br/>sAttVal&#160;=&#160;oAttNode.getValue &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' Get the value from the attribute node.<br/>'A shorter way<br/>oAttNode&#160;=&#160;oElement.getAttributeNode(&#34;ID&#34;)&#160;' Get the attribute node from the element.<br/>sAttVal&#160;=&#160;oAttNode.getValue &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;' Get the value from the attribute node.<br/>'The shortest way<br/>sAttVal&#160;=&#160;oElement.getAttribute(&#34;ID&#34;) &#160; &#160; &#160;' Get the value directly from the node.<br/>
Recursion&#160;is&#160;typically&#160;used to parse&#160;DOM&#160;documents.<br/>
oElemList&#160;=&#160;oElem.getChildNodes &#160; &#160; &#160; &#160;'At the very start oElem is oDOM<br/>For&#160;i&#160;=&#160;0&#160;To&#160;oElemList.getLength&#160;–&#160;1<br/>&#160;&#160;oElem&#160;=&#160;oElemList.item(i)<br/>&#160; Select Case&#160;oElem.getNodeType<br/>&#160; &#160; Case&#160;com.sun.star.xml.dom.ELEMENT_NODE<br/>&#160; &#160; &#160;&#160;sName&#160;=&#160;oElem.getNodeName<br/>&#160; &#160; &#160; If&#160;oElem.hasAttributes&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;oAtts&#160;=&#160;oElem.getAttributes<br/>&#160; &#160; &#160; &#160; For&#160;j&#160;=&#160;0&#160;To&#160;oAtts.getLength&#160;–&#160;1<br/>&#160; &#160; &#160; &#160; &#160;&#160;sName&#160;=&#160;oAtts.item(j).getName<br/>&#160; &#160; &#160; &#160; &#160;&#160;sValue&#160;=&#160;oAtts.item(j).getValue<br/>
526<br/>
<hr/>
<a name=530></a>&#160; &#160; &#160; &#160; &#160;&#160;'Further work to be done<br/>&#160; &#160; &#160; &#160; Next<br/>&#160; &#160; &#160; End If<br/>&#160; &#160; &#160; If&#160;oElem.hasChildNodes&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;'Start the recursion here<br/>&#160; &#160; &#160; End If<br/>&#160; &#160; Case&#160;com.sun.star.xml.dom.TEXT_NODE<br/>&#160; &#160; &#160;&#160;sText&#160;=&#160;oElem.getNodeValue<br/>&#160; &#160; &#160;&#160;'Further work to be done<br/>&#160; &#160;&#160;<a href="libremacros.html#528">'More Case statements for the node types in&#160;Table 215<br/></a>&#160; End Select<br/>Next<br/>
<b>TIP</b><br/>
When&#160;you encounter&#160;a&#160;text&#160;node&#160;between different&#160;element&#160;nodes,&#160;you&#160;most&#160;probably&#160;have&#160;found ignorable<br/>white&#160;space;&#160;so you can probably&#160;ignore&#160;it.<br/>
In&#160;the&#160;slots&#160;example, we&#160;do not&#160;need to&#160;iterate&#160;over all&#160;the&#160;nodes&#160;because&#160;we&#160;know&#160;the&#160;structure&#160;and we&#160;only<br/>need specific&#160;nodes. Use&#160;getElementsByTagName(name) to&#160;start&#160;with&#160;a&#160;limited&#160;number of elements<a href="libremacros.html#530">. &#160;Listing<br/>469&#160;s</a>hows&#160;how&#160;to&#160;extract&#160;the&#160;desired data&#160;into&#160;a&#160;Calc&#160;sheet.&#160;First,&#160;the&#160;XML&#160;file&#160;is&#160;created,&#160;and then&#160;it&#160;is&#160;read<br/>into&#160;a&#160;new&#160;Calc&#160;document.<br/>
<i><b>Listing&#160;469.</b>&#160;Parse&#160;an XML&#160;file&#160;to extract&#160;specific&#160;data into a CalcFile..<br/></i>REM Import an XML file using DOM and extract specific data into a Calc file<br/>Sub&#160;XMLImport<br/>&#160; Dim&#160;sURL&#160;As String &#160; &#160;&#160;'Whole path of the XML file in URL notation<br/>&#160; Dim&#160;oCalcDoc&#160; &#160; &#160; &#160; &#160; &#160;'Destination spreadsheet document<br/>&#160; Dim&#160;oSheet&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Destination table<br/>&#160; Dim&#160;oWriterDoc&#160; &#160; &#160; &#160; &#160;'Text document to show the original XML text file<br/>&#160; Dim&#160;oDOM&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'The DOM document tree<br/>&#160; Dim&#160;tDeadline&#160;as Date &#160;'A specific date to filter the data<br/>&#160;&#160;<br/>&#160;&#160;REM Create an example XML file with fancy data<br/>&#160;&#160;sURL&#160;=&#160;GetWorkDir() &amp;&#160;&#34;/oome_xml_import.xml&#34;<br/>&#160;&#160;MakeXMLExampleFile(sUrl)<br/>&#160;&#160;Wait&#160;500&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Give the OS time to store the file to disk<br/>&#160;&#160;tDeadline&#160;= DateValue(CDate(Now +&#160;20))<br/>&#160;&#160;<br/>&#160;&#160;REM Build the DOM tree<br/>&#160;&#160;oDOM&#160;=&#160;BuildDOMDoc(sUrl)<br/>&#160; If&#160;IsEmpty(oDOM) Then Exit Sub &#160;'There was an error loading the XML file<br/>&#160;&#160;<br/>&#160;&#160;REM Copy specific data into a new Calc spreadsheet<br/>&#160;&#160;oCalcDoc&#160;= StarDesktop.loadComponentFromURL( _<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#34;private:factory/scalc&#34;,&#160;&#34;_blank&#34;,&#160;0, Array())<br/>&#160;&#160;oSheet&#160;=&#160;oCalcDoc.Sheets(0)<br/>&#160;&#160;GetData(oDOM,&#160;oSheet,&#160;tDeadline)<br/>&#160;&#160;<br/>&#160;&#160;REM Show the original XML text file in a new Writer text document<br/>&#160;&#160;REM LibreOffice requires that the FilterName be specified, AOO does not.<br/>&#160; Dim&#160;noArgs(1) As New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;noArgs(0).Name =&#160;&#34;FilterName&#34;<br/>&#160;&#160;noArgs(0).Value&#160;=&#160;&#34;Text&#34;&#160;<br/>&#160;&#160;oWriterDoc&#160;= StarDesktop.loadComponentFromURL(sUrl,&#160;&#34;_blank&#34;,&#160;0,&#160;noArgs() )<br/>
527<br/>
<hr/>
<a name=531></a>End Sub<br/>
REM Read the relevant data from the DOM document<br/>Sub&#160;GetData(oDOMDoc,&#160;oSheet,&#160;tDeadline&#160;as Date)<br/>&#160; Dim&#160;oVtList&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'List of all validTo nodes in the DOM document<br/>&#160; Dim&#160;oSlotItem&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'slot = parent node of the validTo node<br/>&#160; Dim&#160;oSlotChildList&#160; &#160; &#160; &#160; &#160;'List of all child nodes of a slot<br/>&#160; Dim&#160;oSlotChild&#160; &#160; &#160; &#160; &#160; &#160; &#160;'A specific child node of a slot<br/>&#160; Dim&#160;sID&#160;As string &#160; &#160; &#160; &#160; &#160;'Value of the slot attribute &#34;ID&#34;<br/>&#160; Dim&#160;i%,&#160;j%,&#160;k%<br/>&#160; Dim&#160;iCustCount&#160;As Integer &#160;'Number of custumers using a slot<br/>&#160; Dim&#160;aoCusts() &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Array of customer nodes within a slot<br/>&#160; Dim&#160;iCustLimit&#160;As Integer &#160;'Default upper value for the array dimension<br/>&#160; Dim&#160;sTitle&#160;As String &#160; &#160; &#160;&#160;'The title of the slot's document<br/>&#160; Dim&#160;iEntries&#160;As Integer &#160; &#160;'The number of rows written to the sheet<br/>&#160;&#160;<br/>&#160;&#160;REM A slot node includes all information on the specific slot service.<br/>&#160;&#160;REM List all nodes named &#34;validTo&#34;, so all slots with the &#34;status&#34;<br/>&#160;&#160;REM attribute's value &#34;reserved&#34; or &#34;free&#34; are not included.<br/>
&#160;&#160;oVtList&#160;=&#160;oDOMDoc.getElementsByTagName(&#34;validTo&#34;)<br/>&#160;&#160;iCustLimit&#160;=&#160;10&#160;&#160;'There will seldom be more than 10 customers to a slot.<br/>
&#160; For&#160;i&#160;=&#160;0&#160;To&#160;oVtList.getLength&#160;-&#160;1<br/>&#160; &#160;&#160;' Use item to get an element return by getElementsByTagName.<br/>&#160; &#160;&#160;' Use getParentNode to get the parent &#34;slot&#34; node.<br/>&#160; &#160;&#160;oSlotItem&#160;=&#160;oVtList.item(i).getParentNode<br/>&#160; &#160;&#160;' IsProperSlot checks to see if the node is active.<br/>&#160; &#160; If&#160;IsProperSlot(oSlotItem) Then<br/>&#160; &#160; &#160;&#160;sID&#160;=&#160;oSlotItem.getAttribute(&#34;ID&#34;)<br/>&#160; &#160; &#160;&#160;REM The validTo element has exactly one text node<br/>&#160; &#160; &#160;&#160;REM containing a date string, so getFirstChild is used to<br/>&#160; &#160; &#160; REM get the text element. GetNodeValue returns the text&#160;<br/>&#160; &#160; &#160; REM in that element, which is a date.<br/>&#160; &#160; &#160; If&#160;IsWithinDateTarget&#160;_<br/>&#160; &#160; &#160; &#160; (oVtList.item(i).getFirstChild.getNodeValue,&#160;tDeadline) &gt;&#160;0&#160;Then<br/>
&#160; &#160; &#160; &#160;&#160;' Everything passes, so collect data.&#160;<br/>&#160; &#160; &#160; &#160;&#160;' A list of child elements of the slot is created to inspect&#160;<br/>&#160; &#160; &#160; &#160;&#160;' each contained element in order to extract both the document title&#160;<br/>&#160; &#160; &#160; &#160;&#160;' and the customers’ data. The Select Case construction is used:<br/>&#160; &#160; &#160; &#160;&#160;oSlotChildList&#160;=&#160;oSlotItem.getChildNodes<br/>&#160; &#160; &#160; &#160;&#160;REM Iterate over the list of child nodes to collect the data.<br/>&#160; &#160; &#160; &#160; ReDim&#160;aoCusts(1&#160;To&#160;iCustLimit)<br/>&#160; &#160; &#160; &#160;&#160;iCustCount&#160;=&#160;0<br/>&#160; &#160; &#160; &#160;&#160;sTitle&#160;=&#160;&#34;&#34;<br/>&#160; &#160; &#160; &#160; For&#160;j&#160;=&#160;0&#160;To&#160;oSlotChildList.getLength&#160;-&#160;1<br/>&#160; &#160; &#160; &#160; &#160;&#160;oSlotChild&#160;=&#160;oSlotChildList.item(j)<br/>&#160; &#160; &#160; &#160; &#160; Select Case&#160;oSlotChild.getNodeName<br/>&#160; &#160; &#160; &#160; &#160; &#160; Case&#160;&#34;document&#34;<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; If&#160;oSlotChild.hasAttribute(&#34;title&#34;) Then<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;sTitle&#160;=&#160;oSlotChild.getAttribute(&#34;title&#34;)<br/>
528<br/>
<hr/>
<a name=532></a>&#160; &#160; &#160; &#160; &#160; &#160; &#160; End If<br/>&#160; &#160; &#160; &#160; &#160; &#160; Case&#160;&#34;customer&#34;<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;iCustCount&#160;=&#160;iCustCount&#160;+&#160;1<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;REM Just in case there really are more customers than thought<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; If&#160;iCustCount&#160;&gt;&#160;iCustLimit&#160;Then<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ReDim Preserve&#160;aoCusts(1&#160;To&#160;iCustCount)<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; End If<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;aoCusts(iCustCount) =&#160;oSlotChild<br/>&#160; &#160; &#160; &#160; &#160; &#160; Case Else<br/>&#160; &#160; &#160; &#160; &#160; End Select<br/>&#160; &#160; &#160; &#160; Next<br/>&#160; &#160; &#160; &#160; If&#160;sTitle&#160;&lt;&gt;&#160;&#34;&#34;&#160;AND&#160;iCustCount&#160;&gt;&#160;0&#160;Then<br/>&#160; &#160; &#160; &#160; &#160; For&#160;k&#160;=&#160;1&#160;To&#160;iCustCount<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;REM Write the data to the Calc sheet<br/>&#160; &#160; &#160; &#160; &#160; &#160; ' Having collected all relevant data of a slot GetData&#160;<br/>&#160; &#160; &#160; &#160; &#160; &#160; ' can store it in the Calc sheet calling the ImportSlot<br/>&#160; &#160; &#160; &#160; &#160; &#160; ' &#160;subroutine. At last, when we are through with all&#160;<br/>&#160; &#160; &#160; &#160; &#160; &#160; ' slots, the Calc sheet is sorted for convenience.<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;ImportSlot(aoCusts(k),&#160;sID,&#160;sTitle,&#160;oSheet)<br/>&#160; &#160; &#160; &#160; &#160; Next<br/>&#160; &#160; &#160; &#160; &#160;&#160;iEntries&#160;=&#160;iEntries&#160;+&#160;iCustCount<br/>&#160; &#160; &#160; &#160; End If<br/>&#160; &#160; &#160; End If<br/>&#160; &#160; End If<br/>&#160; Next<br/>&#160;&#160;SortCustomers(oSheet,&#160;iEntries)<br/>End Sub<br/>
REM Check, if the specific slot has the suiting attribute values<br/>Function&#160;IsProperSlot(oSlot) As Boolean<br/>&#160;&#160;IsProperSlot&#160;=&#160;False<br/>&#160; If&#160;oSlot.hasAttribute(&#34;status&#34;) AND&#160;oSlot.hasAttribute(&#34;ID&#34;) Then<br/>&#160; &#160; If&#160;oSlot.getAttribute(&#34;status&#34;) =&#160;&#34;active&#34;&#160;Then<br/>&#160; &#160; &#160;&#160;IsProperSlot&#160;=&#160;True<br/>&#160; &#160; End If<br/>&#160; End If<br/>End Function<br/>
REM Check, if validTo shows a date earlier than the deadline<br/>Function&#160;IsWithinDateTarget(sDate&#160;As String,&#160;tDeadline&#160;as Date) As Integer<br/>&#160; Dim&#160;tValidTo&#160;As Date<br/>&#160; On Error Goto&#160;Catch<br/>&#160;&#160;<br/>&#160;&#160;REM If the OOo Basic function DateValue cannot convert the string<br/>&#160;&#160;REM to a date value, the runtime error 5 is thrown. In this case<br/>&#160;&#160;REM the return value of -1 lets the calling routine establish a<br/>&#160;&#160;REM device to track down erroneous database entries.<br/>&#160;&#160;tValidTo&#160;= DateValue(sDate)<br/>&#160; If&#160;tDeadline&#160;&lt;&#160;tValidTo&#160;Then<br/>&#160; &#160;&#160;IsWithinDateTarget&#160;=&#160;0<br/>&#160; Else<br/>
529<br/>
<hr/>
<a name=533></a>&#160; &#160;&#160;IsWithinDateTarget&#160;=&#160;1<br/>&#160; End If<br/>&#160; Exit Function<br/>&#160;&#160;<br/>&#160;&#160;Catch:<br/>&#160;&#160;IsWithinDateTarget&#160;= -1<br/>End Function<br/>
REM Writes the relevant slot data to the Calc sheet<br/>Sub&#160;ImportSlot(oCust,&#160;sID&#160;As String,&#160;sTitle&#160;As String,&#160;oSheet)<br/>&#160; REM There is one row for each document belonging to each customer.<br/>&#160; REM So if multiple customers share one document there are as many rows<br/>&#160; REM as there are customers to a document.<br/>&#160; Static&#160;iRow&#160;As Integer &#160; &#160; &#160;&#160;'Row count<br/>
&#160; If&#160;iRow&#160;=&#160;0&#160;Then &#160; &#160; &#160; &#160; &#160; &#160;&#160;'The header<br/>&#160; &#160;&#160;oSheet.getCellByPosition(0,&#160;iRow).String =&#160;&#34;Name&#34;<br/>&#160; &#160;&#160;oSheet.getCellByPosition(1,&#160;iRow).String =&#160;&#34;Email&#34;<br/>&#160; &#160;&#160;oSheet.getCellByPosition(2,&#160;iRow).String =&#160;&#34;Gender&#34;<br/>&#160; &#160;&#160;oSheet.getCellByPosition(3,&#160;iRow).String =&#160;&#34;ID&#34;<br/>&#160; &#160;&#160;oSheet.getCellByPosition(4,&#160;iRow).String =&#160;&#34;Title&#34;<br/>&#160; End If<br/>&#160;&#160;iRow&#160;=&#160;iRow&#160;+&#160;1<br/>&#160; If&#160;oCust.hasAttribute(&#34;name&#34;) Then<br/>&#160; &#160;&#160;oSheet.getCellByPosition(0,&#160;iRow).String = _<br/>&#160; &#160; &#160;&#160;oCust.getAttribute(&#34;name&#34;)<br/>&#160; End If<br/>&#160; If&#160;oCust.hasAttribute(&#34;email&#34;) Then<br/>&#160; &#160;&#160;oSheet.getCellByPosition(1,&#160;iRow).String = _<br/>&#160; &#160; &#160;&#160;oCust.getAttribute(&#34;email&#34;)<br/>&#160; End If<br/>&#160; If&#160;oCust.hasAttribute(&#34;gender&#34;) Then<br/>&#160; &#160;&#160;oSheet.getCellByPosition(2,&#160;iRow).String = _<br/>&#160; &#160; &#160;&#160;oCust.getAttribute(&#34;gender&#34;)<br/>&#160; End If<br/>&#160;&#160;oSheet.getCellByPosition(3,&#160;iRow).String =&#160;sID<br/>&#160;&#160;oSheet.getCellByPosition(4,&#160;iRow).String =&#160;sTitle<br/>&#160;&#160;<br/>End Sub<br/>
REM Sort the sheet for convenience<br/>Sub&#160;SortCustomers(oSheet,&#160;iRows&#160;As Integer)<br/>&#160; Dim&#160;oRange<br/>&#160; Dim&#160;aSortFields(2) As new&#160;com.sun.star.util.SortField<br/>&#160; Dim&#160;aSortDesc(1) As new&#160;com.sun.star.beans.PropertyValue<br/>
&#160;&#160;REM Sort options:<br/>&#160;&#160;REM (1) Customer's name<br/>&#160;&#160;REM (2) Customer's email (in case different persons have identical names)<br/>&#160;&#160;REM (3) Slot ID<br/>&#160; With&#160;aSortFields(0): .Field&#160;=&#160;0<br/>
530<br/>
<hr/>
<a name=534></a>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;.SortAscending&#160;=&#160;True: End With<br/>&#160; With&#160;aSortFields(1): .Field&#160;=&#160;1<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;.SortAscending&#160;=&#160;True: End With<br/>&#160; With&#160;aSortFields(2): .Field&#160;=&#160;2<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;.SortAscending&#160;=&#160;True: End With<br/>&#160;&#160;<br/>&#160; With&#160;aSortDesc(0): .Name =&#160;&#34;SortFields&#34;<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;.Value&#160;=&#160;aSortFields(): End With<br/>&#160; With&#160;aSortDesc(1): .Name =&#160;&#34;ContainsHeader&#34;<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;.Value&#160;=&#160;True&#160; &#160; &#160; &#160; &#160;: End With<br/>&#160;<br/>&#160;&#160;oRange&#160;=&#160;oSheet.getCellRangeByPosition(0,&#160;0,&#160;4,&#160;iRows)<br/>&#160;&#160;oRange.sort(aSortDesc())<br/>End Sub<br/>
<b>&#160;15.12.2.&#160;Write&#160;XML&#160;File<br/></b>Two steps&#160;are&#160;used to export&#160;the&#160;Calc&#160;document&#160;to&#160;an XML&#160;file.&#160;<br/>
1.&#160;Build the&#160;DOM&#160;document&#160;tree&#160;from&#160;scratch.<br/>
2.&#160;Parse&#160;the&#160;tree&#160;and build the&#160;output&#160;simple&#160;text&#160;lines&#160;from&#160;the&#160;data.&#160;In&#160;other words, you&#160;have&#160;to add all<br/>
the&#160;elements&#160;in&#160;angle&#160;brackets, the&#160;attribute&#160;pairs, the&#160;comments&#160;regarding the&#160;rules&#160;of XML&#160;– and&#160;<br/>format&#160;the&#160;tree&#160;output&#160;in&#160;a&#160;readable&#160;way.<br/>
As&#160;you&#160;can see&#160;from<a href="libremacros.html#528">&#160;Table&#160;215, t</a>he&#160;DOM&#160;document&#160;is&#160;a&#160;specialized node. It&#160;can use&#160;the&#160;parent&#160;XNode&#160;<br/>methods&#160;and a&#160;couple&#160;of additional&#160;ones&#160;that&#160;are&#160;listed in<a href="libremacros.html#534">&#160;Table&#160;217.</a><br/>
<i><b>Table&#160;217.</b>&#160;Methods&#160;implemented in&#160;the&#160;com.sun.star.xml.dom.XDocument&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description&#160;(taken&#160;from&#160;the&#160;API&#160;documentation)</b></i><br/>
createAttribute(name)<br/>
Creates an&#160;Attr&#160;of&#160;the&#160;given name.<br/>
createAttributeNS(namespaceURI,&#160;<br/>
Creates an&#160;attribute&#160;of&#160;the&#160;given qualified&#160;name&#160;and&#160;namespace&#160;URI.<br/>
qualifiedName)<br/>createCDATASection(data)<br/>
Creates a&#160;CDATASection node&#160;whose&#160;value&#160;is the&#160;specified&#160;string.<br/>
createComment(text)<br/>
Creates a&#160;Comment&#160;node&#160;given the&#160;specified string.<br/>
createDocumentFragment()<br/>
Creates an&#160;empty&#160;DocumentFragment&#160;object.<br/>
createElement(tagName)<br/>
Creates an&#160;element&#160;of&#160;the&#160;type&#160;specified.<br/>
createElementNS(namespaceURI,&#160;<br/>
Creates an&#160;element&#160;of&#160;the&#160;given qualified name&#160;and namespace&#160;URI.<br/>
qualifiedName)<br/>createEntityReference(name)<br/>
Creates an&#160;EntityReference&#160;object.<br/>
createProcessingInstruction(target,&#160;<br/>
Creates a&#160;ProcessingInstruction node&#160;given the&#160;specified name&#160;and data&#160;strings.<br/>
data)<br/>createTextNode(text)<br/>
Creates a&#160;Text&#160;node&#160;given the&#160;specified&#160;string.<br/>
getDoctype()<br/>
The&#160;Document&#160;Type&#160;Declaration&#160;(see&#160;DocumentType)&#160;associated&#160;with this document.<br/>
getDocumentElement()<br/>
This&#160;is a&#160;convenience&#160;attribute&#160;that&#160;allows&#160;direct&#160;access to the&#160;child&#160;node&#160;that&#160;is the&#160;root<br/>element&#160;of&#160;the&#160;document.<br/>
getElementById(elementIdstring)<br/>
Returns the&#160;Element&#160;whose&#160;ID&#160;is given by&#160;elementId.<br/>
getElementsByTagName(tagname)<br/>
Returns a&#160;NodeList&#160;of&#160;all&#160;the&#160;Elements with a&#160;given tag name&#160;in&#160;the&#160;order&#160;in&#160;which they<br/>
are&#160;encountered&#160;in a&#160;preorder&#160;traversal&#160;of&#160;the&#160;Document&#160;tree<br/>
531<br/>
<hr/>
<a name=535></a><i><b>Method</b></i><br/>
<i><b>Description&#160;(taken&#160;from&#160;the&#160;API&#160;documentation)</b></i><br/>
GetElementsByTagNameNS<br/>
Returns a&#160;NodeList&#160;of&#160;all&#160;the&#160;Elements with a&#160;given local&#160;name&#160;and&#160;namespace&#160;URI&#160;in&#160;<br/>
(namespaceURI,&#160;localName)<br/>
the&#160;order&#160;in which they&#160;are&#160;encountered in&#160;a&#160;preorder&#160;traversal&#160;of&#160;the&#160;Document&#160;tree.&#160;<br/>
getImplementation()<br/>
The&#160;DOMImplementation&#160;object&#160;that&#160;handles&#160;this&#160;document.<br/>
importNode(importedNode, deep)<br/>
Imports&#160;a&#160;node&#160;from&#160;another&#160;document&#160;to&#160;this&#160;document.<br/>
Use&#160;the&#160;DocumentBuilder service&#160;to create&#160;an empty&#160;DOM&#160;document&#160;object.<br/>
oDocBuilder&#160;=&#160;createUnoService(&#34;com.sun.star.xml.dom.DocumentBuilder&#34;)<br/>oDOM&#160;=&#160;oDocBuilder.newDocument<br/>
Next,&#160;populate&#160;the&#160;document&#160;with child nodes. Child&#160;nodes&#160;are&#160;created&#160;and then added to the&#160;parent&#160;element.<br/>Child nodes&#160;must&#160;be&#160;created by&#160;the&#160;document’s&#160;create&#160;methods. It&#160;does&#160;not&#160;matter when the&#160;nodes&#160;are&#160;<br/>created, or in which order.&#160;Use&#160;appendChild to&#160;append a&#160;child to&#160;a&#160;node. Each new&#160;child is&#160;added to&#160;the&#160;end&#160;<br/>of the&#160;list&#160;of the&#160;already&#160;added child&#160;nodes. If&#160;the&#160;child&#160;elements&#160;are&#160;to&#160;be&#160;output&#160;in sequence, you must&#160;must<br/>take&#160;care&#160;to&#160;add them&#160;in&#160;the&#160;desired order.&#160;Use&#160;createComment&#160;to&#160;create&#160;a&#160;comment&#160;node&#160;with&#160;the&#160;comment&#160;<br/>text&#160;string&#160;as&#160;the&#160;argument. Use&#160;createElement&#160;to&#160;create&#160;an element&#160;node&#160;with&#160;the&#160;tag name&#160;as&#160;the&#160;argument.<br/>
You must&#160;obey&#160;the&#160;XML&#160;naming rules:&#160;Names&#160;can contain&#160;letters, numbers, and other characters. Spaces&#160;are<br/>not&#160;allowed.&#160;The&#160;first&#160;character may&#160;not&#160;be&#160;a&#160;number or punctuation.&#160;The&#160;name&#160;may&#160;not&#160;start&#160;with the&#160;string&#160;<br/>“xml”&#160;(be&#160;it&#160;upper or lower case).<br/>
REM Child nodes added to the root node<br/>oNComment&#160;=&#160;oDOM.createComment(sComment)&#160;<br/>oNPlayers&#160;=&#160;oDOM.createElement(&#34;Players&#34;)<br/>oDOM.appendChild(oNComment)<br/>oDOM.appendChild(oNPlayers)<br/>
REM A child node added to another node<br/>oNPlayer&#160;=&#160;oDOM.createElement(&#34;Player&#34;)<br/>oNPlayers.appendChild(oNPlayer)<br/>
Attributes&#160;need not&#160;be&#160;created by&#160;the&#160;DOM&#160;document.&#160;You can set&#160;– that&#160;means&#160;add – them&#160;directly&#160;using&#160;<br/>the&#160;XElement&#160;method setAttribute(name, value), because&#160;the&#160;order is&#160;not&#160;so relevant&#160;for the&#160;attributes.&#160;They&#160;<br/>are&#160;listed in&#160;a&#160;NamedNodeMap and can be&#160;retrieved by&#160;name.&#160;The&#160;setAttribute&#160;method&#160;has&#160;two arguments,&#160;<br/>the&#160;attribute's&#160;name&#160;and the&#160;attribute's&#160;value, both&#160;are&#160;strings:<br/>
oNPlayer.setAttribute(oSheet.getCellByPosition(iCol,&#160;0).String,&#160;sCellContent)<br/>
Use&#160;the&#160;createTextNode&#160;method&#160;to&#160;create&#160;a&#160;text&#160;node&#160;with the&#160;text&#160;string&#160;as&#160;the&#160;argument.&#160;As&#160;a&#160;text&#160;node&#160;can&#160;<br/>have&#160;no attributes&#160;and no child&#160;nodes&#160;there&#160;is&#160;seldom&#160;a&#160;need to reference&#160;the&#160;node&#160;by&#160;a&#160;variable:<br/>
oNName.appendChild(oDOM.createTextNode(sCellContent))<br/>
To&#160;show&#160;the&#160;whole&#160;process&#160;with a&#160;real&#160;Calc&#160;sheet&#160;I&#160;devised&#160;a&#160;list&#160;of a&#160;couple&#160;of current&#160;and former tennis&#160;<br/>professionals&#160;(see<a href="libremacros.html#535">&#160;Figure&#160;110).&#160;</a>This&#160;sheet&#160;is&#160;taken&#160;as&#160;the&#160;data&#160;source&#160;of the&#160;XML&#160;output.<br/>
<i><b>Figure&#160;110.</b>&#160;Detail&#160;of&#160;the&#160;source&#160;sheet&#160;for&#160;the&#160;XML&#160;export.</i><br/>
532<br/>
<hr/>
<a name=536></a>The&#160;macro i<a href="libremacros.html#529">n&#160;Listing&#160;468&#160;re</a>ads&#160;a&#160;sheet&#160;as&#160;shown i<a href="libremacros.html#535">n&#160;Figure&#160;110&#160;a</a>nd returns&#160;a&#160;DOM&#160;document&#160;tree.<br/>
<i><b>Listing&#160;470.</b>&#160;Creation a DOM from&#160;a Calc&#160;sheet.<br/></i>REM Convert a sheet data table into XML using DOM.<br/>REM Each row is a record. The first row contains the headers.<br/>REM Assign each column to the proper node as text or attribute.<br/>REM This function is devised for the specific sheet data.<br/>REM The function returns a DOM document.<br/>Function&#160;MakeXMLFromSheet(oSheet)<br/>&#160;&#160;Dim&#160;oDocBuilder&#160;&#160;'The DOM DocumentBuilder interface<br/>&#160;&#160;Dim&#160;oDOM&#160; &#160; &#160; &#160; &#160;'The DOM document tree<br/>&#160;&#160;Dim&#160;iRow&amp;,&#160;iCol&amp;<br/>&#160;&#160;Dim&#160;sCellContent$&#160;'All XML values are strings<br/>&#160;&#160;Dim&#160;sComment$&#160; &#160;'A comment that is not part of the data<br/>&#160;&#160;Dim&#160;oNComment&#160; &#160;' Comment node<br/>&#160;&#160;Dim&#160;oNPlayers&#160; &#160;' &#34;Players&#34; element<br/>&#160;&#160;Dim&#160;oNPlayer&#160; &#160;&#160;' &#34;Player&#34; element is a child of the &#34;Players&#34; element<br/>&#160;&#160;Dim&#160;oNName&#160; &#160; &#160;&#160;' &#34;Name&#34; element is a child of a &#34;Player&#34; element<br/>&#160;&#160;Dim&#160;ONStats&#160; &#160; &#160;' &#34;Statistics&#34; element is a child of the &#34;Player&#34; element<br/>&#160;&#160;Dim&#160;oNGSlams&#160; &#160;&#160;' &#34;GrandSlams&#34; element node is a child of a &#34;Player&#34; element<br/>&#160;&#160;Dim&#160;oNGSlam&#160; &#160; &#160;' Each Grand Slam element is a child of the &#34;GrandSlams&#34; element<br/>
&#160;&#160;REM Create the empty DOM document tree.<br/>&#160;&#160;oDocBuilder&#160;=&#160;createUnoService(&#34;com.sun.star.xml.dom.DocumentBuilder&#34;)<br/>&#160;&#160;oDOM&#160;=&#160;oDocBuilder.newDocument<br/>&#160;&#160;<br/>&#160; REM The DOM document will hold the following tree:<br/>&#160; REM &lt;!-- ... --&gt;<br/>&#160; REM &lt;Players&gt;<br/>&#160; REM &#160; &lt;Player ID=&#34;...&#34; Gender=&#34;...&#34; Nationality=&#34;...&#34;&gt;<br/>&#160; REM &#160; &#160; &lt;Name&gt;The player's name&lt;/Name&gt;<br/>&#160; REM &#160; &#160; &lt;Statistics Record=&#34;...&#34; Titles=&#34;...&#34; HighRank=&#34;...&#34; /&gt;<br/>&#160; REM &#160; &#160; &lt;GrandSlams&gt;<br/>&#160; REM &#160; &#160; &#160; &lt;Melbourne&gt;List of victory years&lt;/Melbourne&gt;<br/>&#160; REM &#160; &#160; &#160; &lt;Paris&gt;...&lt;/Paris&gt;<br/>&#160; REM &#160; &#160; &#160; ... (more Grand Slam nodes)<br/>&#160; REM &#160; &#160; &lt;/GrandSlams&gt;<br/>&#160; REM &#160; &lt;/Player&gt;<br/>&#160; REM &#160; ... (more Player nodes)<br/>&#160; REM &lt;/Players&gt;<br/>&#160;&#160;<br/>&#160;&#160;sComment&#160;=&#160;&#34;This is a list of famous tennis players who dominated&#34;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&amp; CHR$(10) &amp; _<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#34; &#160; &#160; the world ATP tennis circus in the past decades.&#34;<br/>&#160; REM Create the comment node and the &#34;Players&#34; element and add them<br/>&#160; REM to the end of the list of children of the root node.<br/>&#160;&#160;oNComment&#160;=&#160;oDOM.createComment(sComment)&#160;<br/>&#160;&#160;oNPlayers&#160;=&#160;oDOM.createElement(&#34;Players&#34;)<br/>&#160;&#160;oDOM.appendChild(oNComment)<br/>&#160;&#160;oDOM.appendChild(oNPlayers)<br/>&#160;&#160;<br/>&#160;&#160;REM Access the record cells starting with row 1, as row 0 are the headers.<br/>&#160;&#160;iRow&#160;=&#160;1<br/>
533<br/>
<hr/>
<a name=537></a>&#160;&#160;Do While&#160;oSheet.getCellByPosition(0,&#160;iRow).Value&#160;&lt;&gt;&#160;0<br/>&#160; &#160;&#160;REM With each new row a new &#34;Player&#34; element is created and added<br/>&#160; &#160;&#160;REM to the end of the list of children of the &#34;Players&#34; element.<br/>&#160; &#160;&#160;oNPlayer&#160;=&#160;oDOM.createElement(&#34;Player&#34;)<br/>&#160; &#160;&#160;oNPlayers.appendChild(oNPlayer)<br/>&#160; &#160;&#160;REM Create three elements and add them to the end<br/>&#160; &#160;&#160;REM of the list of children of the &#34;Player&#34; element.<br/>&#160; &#160;&#160;oNName&#160;=&#160;oDOM.createElement(&#34;Name&#34;)<br/>&#160; &#160;&#160;oNStats&#160;=&#160;oDOM.createElement(&#34;Statistics&#34;)<br/>&#160; &#160;&#160;oNGSlams&#160;=&#160;oDOM.createElement(&#34;GrandSlams&#34;)<br/>&#160; &#160;&#160;oNPlayer.appendChild(oNName)<br/>&#160; &#160;&#160;oNPlayer.appendChild(oNStats)<br/>&#160; &#160;&#160;oNPlayer.appendChild(oNGSlams)<br/>&#160; &#160;&#160;For&#160;iCol&#160;=&#160;0&#160;To&#160;10<br/>&#160; &#160; &#160;&#160;sCellContent&#160;=&#160;Trim(oSheet.getCellByPosition(iCol,&#160;iRow).String)<br/>&#160; &#160; &#160;&#160;Select Case&#160;iCol<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;0,&#160;1,&#160;2&#160;&#160;'The player's attributes ID, Gender, and Nationality<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM Set the attribute with two arguments:<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM name from the header, value from the current cell<br/>&#160; &#160; &#160; &#160; &#160;&#160;oNPlayer.setAttribute&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;(oSheet.getCellByPosition(iCol,&#160;0).String,&#160;sCellContent)<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;3<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM Append a new text node with the player's name as value<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM as the only child of the &#34;Name&#34; element.<br/>&#160; &#160; &#160; &#160; &#160;&#160;oNName.appendChild(oDOM.createTextNode(sCellContent))<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;4,&#160;5,&#160;6&#160; &#160; &#160;'The player's statistics<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM Set the attribute with two arguments:<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM name from the header, value from the current cell<br/>&#160; &#160; &#160; &#160; &#160;&#160;oNStats.setAttribute&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;(oSheet.getCellByPosition(iCol,&#160;0).String,&#160;sCellContent)<br/>&#160; &#160; &#160; &#160;&#160;Case&#160;7,&#160;8,&#160;9,&#160;10&#160;&#160;'The player's Grand Slam victories.<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM Create a new Grand Slam element and add it to the end<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM of the list of children of the &#34;GrandSlams&#34; element.<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM The header is taken as its tag name.<br/>&#160; &#160; &#160; &#160; &#160;&#160;oNGSlam&#160;=&#160;oDOM.createElement&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;(oSheet.getCellByPosition(iCol,&#160;0).String)<br/>&#160; &#160; &#160; &#160; &#160;&#160;oNGSlams.appendChild(oNGSlam)<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM Append a new text node with the Grand Slam years as value<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM as the only child of the Grand Slam element.<br/>&#160; &#160; &#160; &#160; &#160;&#160;oNGSlam.appendChild(oDOM.createTextNode(sCellContent))<br/>&#160; &#160; &#160;&#160;End Select<br/>&#160; &#160;&#160;Next<br/>&#160; &#160;&#160;iRow&#160;=&#160;iRow&#160;+&#160;1<br/>&#160;&#160;Loop<br/>&#160;&#160;MakeXMLFromSheet&#160;=&#160;oDOM<br/>End Function<br/>
The&#160;macro creates&#160;and adds&#160;a&#160;comment&#160;and the&#160;container element&#160;“Players”&#160;to the&#160;root&#160;node&#160;oDOM. For&#160;<br/>each new&#160;row&#160;(record), a&#160;“Player”&#160;element&#160;is&#160;created and added to the&#160;“Players”&#160;element.&#160;Each “Player”&#160;<br/>node&#160;contains&#160;the&#160;“Name”, “Statistics”, and “GrandSlams”child&#160;elements.<br/>
The&#160;macro then iterates&#160;over the&#160;columns. Columns&#160;0, 1, and 2 are&#160;attributes&#160;of the&#160;“Player”&#160;element.&#160;The&#160;<br/>attributes&#160;are&#160;set&#160;from&#160;the&#160;cell&#160;content&#160;as&#160;value&#160;and the&#160;column header as&#160;name&#160;– the&#160;headers&#160;were&#160;purposely&#160;<br/>
534<br/>
<hr/>
<a name=538></a>named to&#160;be&#160;valid XML&#160;names.&#160;Column 3, the&#160;person’s&#160;name, is&#160;added as&#160;a&#160;text&#160;node&#160;to the&#160;“Name”&#160;<br/>element.&#160;Colums&#160;4, 5, and 6 are&#160;attributes&#160;of the&#160;“Statistics”&#160;element.&#160;They&#160;are&#160;set&#160;in&#160;the&#160;same&#160;way&#160;as&#160;<br/>columns&#160;0, 1, and 2. Finally,&#160;columns&#160;7 through 10 contain&#160;the&#160;years&#160;of victory&#160;in&#160;the&#160;four Grand Slam&#160;<br/>events.&#160;For&#160;each of the&#160;locations&#160;a&#160;new&#160;element&#160;is&#160;created using the&#160;header as&#160;its&#160;tag&#160;name&#160;and added to&#160;the&#160;<br/>“GrandSlams”&#160;element.&#160;The&#160;current&#160;cell&#160;content&#160;is&#160;added as&#160;a&#160;text&#160;node&#160;to&#160;this&#160;new&#160;Grand Slam&#160;element.<br/>
<i><b>Table&#160;218.</b>&#160;Methods&#160;implemented in&#160;the&#160;com.sun.star.xml.dom.XElement&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description&#160;(taken&#160;from&#160;the&#160;API&#160;documentation)</b></i><br/>
getAttribute(name)<br/>
Retrieves&#160;an attribute&#160;value&#160;by&#160;name.<br/>
getAttributeNode(name)<br/>
Retrieves&#160;an attribute&#160;node&#160;by&#160;name.<br/>
getAttributeNodeNS(namespaceURI,<br/>
Retrieves&#160;an&#160;Attr&#160;node&#160;by&#160;local&#160;name&#160;and&#160;namespace&#160;URI.<br/>
name)<br/>getAttributeNS(namespaceURI,&#160;<br/>
Retrieves&#160;an attribute&#160;value&#160;by&#160;local&#160;name&#160;and namespace&#160;URI.<br/>
name)<br/>getElementsByTagName(name)<br/>
Returns a&#160;NodeList&#160;of&#160;all&#160;descendant&#160;Elements&#160;with&#160;a&#160;given tag&#160;name, in&#160;the&#160;order&#160;in&#160;<br/>
which they&#160;are&#160;encountered in&#160;a&#160;preorder&#160;traversal&#160;of&#160;this&#160;Element&#160;tree.<br/>
getElementsByTagNameNS(namespa<br/>
Returns a&#160;NodeList&#160;of&#160;all&#160;the&#160;descendant&#160;Elements with a&#160;given local&#160;name&#160;and&#160;<br/>
ceURI,&#160;name)<br/>
namespace&#160;URI&#160;in&#160;the&#160;order&#160;in&#160;which&#160;they&#160;are&#160;encountered&#160;in a&#160;preorder&#160;traversal&#160;of&#160;<br/>this Element&#160;tree.<br/>
getTagName()<br/>
The&#160;name&#160;of&#160;the&#160;element.<br/>
hasAttribute(name)<br/>
Returns true&#160;when an attribute&#160;with&#160;a&#160;given name&#160;is specified&#160;on this element&#160;or&#160;has a&#160;<br/>
default&#160;value, false&#160;otherwise.<br/>
hasAttributeNS(namespaceURI,&#160;<br/>
Returns true&#160;when an attribute&#160;with&#160;a&#160;given local&#160;name&#160;and&#160;namespace&#160;URI&#160;is&#160;<br/>
name)<br/>
specified&#160;on this element&#160;or&#160;has&#160;a&#160;default&#160;value,&#160;false&#160;otherwise.<br/>
removeAttribute(name)<br/>
Removes an attribute&#160;by&#160;name.<br/>
removeAttributeNode(oldAttr)<br/>
Removes the&#160;specified&#160;attribute&#160;node.<br/>
removeAttributeNS(namespaceURI,&#160;<br/>
Removes an attribute&#160;by&#160;local&#160;name&#160;and&#160;namespace&#160;URI.<br/>
name)<br/>setAttribute(name,&#160;value)<br/>
Adds a&#160;new&#160;attribute.<br/>
setAttributeNode(newAttr)<br/>
Adds a&#160;new&#160;attribute&#160;node.<br/>
setAttributeNodeNS(newAttr)<br/>
Adds a&#160;new&#160;attribute.<br/>
setAttributeNS(namespaceURI,&#160;<br/>
Adds a&#160;new&#160;attribute.<br/>
qualifiedName,&#160;value)<br/>
<a href="libremacros.html#538">Table&#160;218&#160;s</a>hows&#160;the&#160;methods&#160;that&#160;are&#160;implemented&#160;by&#160;the&#160;XElement&#160;interface. Every&#160;XElement&#160;is&#160;also&#160;an&#160;<br/>XNode&#160;so the&#160;methods&#160;in<a href="libremacros.html#528">&#160;Table&#160;216&#160;a</a>re&#160;also implemented.<br/>
The&#160;following&#160;code&#160;snippet&#160;demonstrates&#160;how&#160;to iterate&#160;through child&#160;nodes&#160;and identify&#160;the&#160;specific&#160;node&#160;<br/>types:<br/>
<i><b>Listing&#160;471.</b>&#160;Processing&#160;child&#160;nodes.<br/></i>If&#160;oNode.hasChildNodes&#160;Then<br/>&#160;&#160;oChildren&#160;=&#160;oNode.getChildNodes<br/>&#160; For&#160;i&#160;=&#160;0&#160;To&#160;oChildren.getLength&#160;–&#160;1<br/>&#160; &#160;&#160;oChild&#160;=&#160;oChildren.item(i)<br/>&#160; &#160; &#160; If&#160;oChild.getNodeType&#160;=&#160;com.sun.star.xml.dom.NodeType.COMMENT_NODE&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;'Comment nodes can contain text, but not attributes or child nodes.<br/>&#160; &#160; &#160; &#160;&#160;sCommentText&#160;=&#160;oChild.getNodeValue<br/>
535<br/>
<hr/>
<a name=539></a>&#160; &#160; &#160; Elseif&#160;Child.getNodeType&#160;=&#160;com.sun.star.xml.dom.NodeType.ELEMENT_NODE&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;…<br/>&#160; &#160; &#160; Elseif&#160;Child.getNodeType&#160;=&#160;com.sun.star.xml.dom.NodeType.TEXT_NODE&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;'Comment nodes can contain text, but not attributes or child nodes.<br/>&#160; &#160; &#160; &#160;&#160;sText&#160;=&#160;oChild.getNodeValue<br/>
Element&#160;nodes&#160;can contain attributes. Comments&#160;and text&#160;nodes&#160;cannot&#160;have&#160;attributes. Use&#160;getAttributes&#160;to&#160;<br/>access&#160;the&#160;attribute&#160;nodes&#160;as&#160;a&#160;NamedNodeMap. Null&#160;is&#160;returned if&#160;no attributes&#160;are&#160;present.&#160;The&#160;following&#160;<br/>code&#160;iterates&#160;through the&#160;attributes, getting the&#160;attribute&#160;name&#160;and value.<br/>
<i><b>Listing&#160;472.</b>&#160;Iterate&#160;through each attribute&#160;for&#160;an element.<br/></i>oAttList&#160;=&#160;oElement.getAttributes<br/>If Not IsNull(oAttList) Then<br/>&#160; For&#160;i&#160;=&#160;0&#160;To&#160;oAttList.getLength&#160;–&#160;1<br/>&#160; &#160;&#160;oAtt&#160;=&#160;oAttList.item(i)<br/>&#160; &#160;&#160;sValue&#160;=&#160;oAtt.getNodeValue<br/>&#160; &#160;&#160;sName&#160;=&#160;oAtt.getNodeName<br/>
Element&#160;nodes&#160;can contain child nodes:&#160;multiple&#160;comments,&#160;multiple&#160;elements&#160;or one&#160;single&#160;text&#160;node. So&#160;<br/>the&#160;code&#160;inspects&#160;these&#160;child nodes&#160;recursively.&#160;The&#160;subroutine&#160;PrintDom&#160;is&#160;called&#160;for each element&#160;level.<br/>
<i><b>Listing&#160;473.</b>&#160;Macro&#160;to&#160;write&#160;a DOM&#160;document&#160;as&#160;an XML&#160;text&#160;file.</i><br/>
REM Export the contents of a Calc sheet into an XML file.<br/>Sub&#160;ExportSheetToXML<br/>&#160;&#160;REM Typically this subroutine will be very short:<br/>&#160;&#160;'Dim sURL<br/>&#160;&#160;'sURL = ChooseAFileName &#160;'Function stored in this file's UNO module<br/>&#160;&#160;'WriteDomToFile(MakeXMLFromSheet(ThisComponent.Sheets(0)), sURL)<br/>&#160;&#160;REM But for this example a new Calc document is created first,<br/>&#160;&#160;REM some data are written into sheet 0,<br/>&#160;&#160;REM and at the end the stored XML file is opened for inspection.<br/>
&#160;&#160;Dim&#160;oCalcDoc&#160; &#160; &#160; &#160;&#160;'The source Calc spreadsheet document<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160; &#160;&#160;'The source sheet<br/>&#160;&#160;Dim&#160;sURL&#160;As String&#160;&#160;'The URL of the output file<br/>&#160;&#160;<br/>&#160;&#160;sURL&#160;=&#160;GetWorkDir() &amp;&#160;&#34;/oome_xml_export.xml&#34;<br/>&#160;&#160;oCalcDoc&#160;= StarDesktop.loadComponentFromURL( _<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#34;private:factory/scalc&#34;,&#160;&#34;_blank&#34;,&#160;0, Array())<br/>&#160;&#160;oSheet&#160;=&#160;oCalcDoc.Sheets(0)<br/>&#160;&#160;REM Fill the sheet with fancy data.<br/>&#160;&#160;CreateExampleSheet(oSheet)<br/>&#160;&#160;REM The following subroutine has to be devised using the specific sheet data.<br/>&#160;&#160;REM Typically it is placed in the document library.<br/>&#160;&#160;WriteDomToFile(MakeXMLFromSheet(oSheet),&#160;sURL)<br/>&#160;&#160;Wait&#160;500&#160; &#160; &#160; &#160; &#160; &#160; 'Give the OS time to store the file to disk<br/>&#160;&#160;REM Load the XML file in a Writer document.<br/>&#160;&#160;REM LibreOffice requires that the FilterName be specified, AOO does not.<br/>&#160; Dim&#160;noArgs(1) As New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;noArgs(0).Name =&#160;&#34;FilterName&#34;<br/>&#160;&#160;noArgs(0).Value&#160;=&#160;&#34;Text&#34;&#160;<br/>&#160; StarDesktop.loadComponentFromURL(sUrl,&#160;&#34;_blank&#34;,&#160;0,&#160;noArgs() )<br/>End Sub<br/>
536<br/>
<hr/>
<a name=540></a>REM Writes the structure of the current DOM document<br/>REM into a valid and nicely formatted XML text file.<br/>REM This subroutine and the called subroutines and functions are not<br/>REM document specific and needn't be part of the document library.<br/>REM They can be stored in the &#34;My Macros&#34; library.<br/>Sub&#160;WriteDomToFile(oDOM,&#160;sFilePath&#160;As String)<br/>&#160;&#160;Dim&#160;oSimpleFileAccess&#160;'SimpleFileAccess service<br/>&#160;&#160;Dim&#160;oOutputStream&#160; &#160; &#160;'Stream returned from SimpleFileAccess<br/>&#160;&#160;Dim&#160;oTextOutput&#160; &#160; &#160; &#160;'TextOutputStream service<br/>&#160;&#160;Dim&#160;oNodes&#160; &#160; &#160; &#160; &#160; &#160;&#160;'List of child nodes of the root node<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;iIndentLevel&#160;As&#160;Integer&#160;&#160;'Indentation level<br/>&#160;&#160;Dim&#160;iIndentSpaces&#160;As&#160;Integer&#160;'Number of spaces added to each indentation level<br/>&#160;&#160;<br/>&#160;&#160;On Error Goto&#160;Catch<br/>&#160;&#160;<br/>&#160;&#160;iIndentSpaces&#160;=&#160;2<br/>&#160;&#160;REM Set the output stream<br/>&#160;&#160;sFilePath&#160;= ConvertToURL(sFilePath)<br/>&#160;&#160;oSimpleFileAccess&#160;= createUnoService(&#34;com.sun.star.ucb.SimpleFileAccess&#34;)<br/>&#160;&#160;With&#160;oSimpleFileAccess<br/>&#160; &#160;&#160;If .exists(sFilePath) Then .kill(sFilePath)<br/>&#160; &#160;&#160;oOutputStream&#160;= .openFileWrite(sFilePath)<br/>&#160;&#160;End With<br/>&#160;&#160;<br/>&#160;&#160;oTextOutput&#160;= createUnoService(&#34;com.sun.star.io.TextOutputStream&#34;)<br/>&#160;&#160;With&#160;oTextOutput<br/>&#160; &#160;&#160;.OutputStream&#160;=&#160;oOutputStream<br/>&#160; &#160;&#160;.setEncoding(&#34;UTF-8&#34;)<br/>&#160; &#160;&#160;REM The first line is a processing instruction. It usually isn't part of<br/>&#160; &#160;&#160;REM the DOM tree. So we write it separately.<br/>&#160; &#160;&#160;.WriteString(&#34;&lt;?xml version=&#34;&#34;1.0&#34;&#34; encoding=&#34;&#34;UTF-8&#34;&#34;?&gt;&#34;&#160;&amp; CHR$(10))<br/>&#160; &#160; &#160;&#160;<br/>&#160; &#160;&#160;REM A DOM tree can consist of zero, one or more child nodes on the<br/>&#160; &#160;&#160;REM root level. The child nodes are treated hierarchically.<br/>&#160; &#160;&#160;If&#160;oDOM.hasChildNodes&#160;Then<br/>&#160; &#160; &#160;&#160;oNodes&#160;=&#160;oDOM.getChildNodes<br/>&#160; &#160; &#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oNodes.getLength&#160;-&#160;1<br/>&#160; &#160; &#160; &#160;&#160;PrintDom(oNodes.item(i),&#160;oTextOutput,&#160;iIndentLevel,&#160;iIndentSpaces)<br/>&#160; &#160; &#160;&#160;Next<br/>&#160; &#160;&#160;End If<br/>&#160; &#160;&#160;.closeOutput<br/>&#160;&#160;End With<br/>&#160;&#160;oOutputStream.closeOutput<br/>
&#160;&#160;Exit Sub<br/>&#160;&#160;<br/>&#160;&#160;Catch:<br/>&#160;&#160;Print&#160;&#34;Error &#34;&#160;&amp; Err &amp;&#160;&#34; (&#34;&#160;&amp; Error(Err) &amp;&#160;&#34;)&#34;<br/>End Sub<br/>
537<br/>
<hr/>
<a name=541></a>REM Writes the elements of a DOM tree recursively line after line into a<br/>REM text file. Mark to start with iLevel 0.<br/>REM Indents lower levels by accumulating iIndent spaces, except for text nodes:<br/>REM they are written in the same line directly after the element start tag<br/>REM and are directly followed by the element end tag.<br/>REM It is assumed that there are either one text node or one or more other<br/>REM child nodes to an element, if any.<br/>Sub&#160;PrintDom(oNode,&#160;oStream,&#160;iLevel&#160;As Integer,&#160;iIndent&#160;As Integer)<br/>&#160;&#160;Dim&#160;oElementChildren<br/>&#160;&#160;Dim&#160;oChild<br/>&#160;&#160;Dim&#160;sLine&#160;As String<br/>&#160;&#160;Dim&#160;sAtt&#160;As String<br/>&#160;&#160;Dim&#160;sIndent&#160;As String<br/>&#160;&#160;Dim&#160;i%,&#160;iLen%<br/>&#160;&#160;Dim&#160;sNodeName&#160;As String<br/>&#160;&#160;<br/>&#160;&#160;sNodeName&#160;=&#160;oNode.getNodeName<br/>&#160;&#160;sIndent&#160;= String(iLevel&#160;*&#160;iIndent,&#160;&#34; &#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Only comments and elements are treated.<br/>&#160;&#160;If&#160;oNode.getNodeType&#160;=&#160;com.sun.star.xml.dom.NodeType.COMMENT_NODE&#160;Then<br/>&#160; &#160;&#160;REM XML comment<br/>&#160; &#160;&#160;sLine&#160;=&#160;sIndent&#160;&amp;&#160;&#34;&lt;!-- &#34;&#160;&amp;&#160;oNode.getNodeValue&#160;&amp;&#160;&#34; --&gt;&#34;<br/>&#160; &#160;&#160;oStream.writeString(sLine&#160;&amp; CHR$(10))<br/>&#160;&#160;Elseif&#160;oNode.getNodeType&#160;= _<br/>&#160; &#160; &#160;&#160;com.sun.star.xml.dom.NodeType.ELEMENT_NODE&#160;Then<br/>&#160; &#160;&#160;REM XML element<br/>&#160; &#160;&#160;sAtt&#160;=&#160;AttString(oNode.getAttributes)<br/>&#160; &#160;&#160;REM Check, if the element has data. Otherwise the element is skipped.<br/>&#160; &#160;&#160;If&#160;oNode.hasChildNodes&#160;OR&#160;sAtt&#160;&lt;&gt;&#160;&#34;&#34;&#160;Then<br/>&#160; &#160; &#160;&#160;oElementChildren&#160;=&#160;oNode.getChildNodes<br/>&#160; &#160; &#160;&#160;If&#160;HasContent(oElementChildren) Then<br/>&#160; &#160; &#160; &#160;&#160;sLine&#160;=&#160;sIndent&#160;&amp;&#160;&#34;&lt;&#34;&#160;&amp;&#160;sNodeName&#160;&amp;&#160;sAtt&#160;&amp;&#160;&#34;&gt;&#34;&#160;&#160;'Start tag line<br/>&#160; &#160; &#160; &#160;&#160;iLen&#160;=&#160;oElementChildren.getLength<br/>&#160; &#160; &#160; &#160;&#160;If&#160;iLen&#160;=&#160;1&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM Test for text node, assuming that there are no other<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM sibling nodes besides a text node.<br/>&#160; &#160; &#160; &#160; &#160;&#160;oChild&#160;=&#160;oElementChildren.item(0)<br/>&#160; &#160; &#160; &#160; &#160;&#160;If&#160;oChild.getNodeType&#160;=&#160;com.sun.star.xml.dom.NodeType.TEXT_NODE&#160;Then<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;sLine&#160;=&#160;sLine&#160;&amp;&#160;oChild.getNodeValue&#160;&amp;&#160;&#34;&lt;/&#34;&#160;&amp;&#160;sNodeName&#160;&amp;&#160;&#34;&gt;&#34;<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;REM Write the line: start tag plus text value plus end tag.<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;oStream.writeString(sLine&#160;&amp; CHR$(10))<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Exit Sub<br/>&#160; &#160; &#160; &#160; &#160;&#160;End If<br/>&#160; &#160; &#160; &#160;&#160;End If<br/>&#160; &#160; &#160; &#160;&#160;REM At this point there are child elements other than text nodes.<br/>&#160; &#160; &#160; &#160;&#160;REM Write the start tag line.<br/>&#160; &#160; &#160; &#160;&#160;oStream.writeString(sLine&#160;&amp; CHR$(10))<br/>&#160; &#160; &#160; &#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;iLen&#160;-&#160;1<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM Start the recursion, increment the indentation level<br/>&#160; &#160; &#160; &#160; &#160;&#160;PrintDom(oElementChildren.item(i),&#160;oStream,&#160;iLevel&#160;+&#160;1,&#160;iIndent)<br/>&#160; &#160; &#160; &#160;&#160;Next<br/>&#160; &#160; &#160; &#160;&#160;sLine&#160;=&#160;sIndent&#160;&amp;&#160;&#34;&lt;/&#34;&#160;&amp;&#160;sNodeName&#160;&amp;&#160;&#34;&gt;&#34;&#160; &#160;'End tag line<br/>
538<br/>
<hr/>
<a name=542></a>&#160; &#160; &#160; &#160;&#160;REM Write the end tag line.<br/>&#160; &#160; &#160; &#160;&#160;oStream.writeString(sLine&#160;&amp; CHR$(10))<br/>&#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160;&#160;REM There are no child elements to be written.<br/>&#160; &#160; &#160; &#160;&#160;REM If there are attributes, the short notation is used.<br/>&#160; &#160; &#160; &#160;&#160;REM If there are not even attributes, no element tag is written.<br/>&#160; &#160; &#160; &#160;&#160;If&#160;sAtt&#160;&lt;&gt;&#160;&#34;&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;sLine&#160;=&#160;sIndent&#160;&amp;&#160;&#34;&lt;&#34;&#160;&amp;&#160;sNodeName&#160;&amp;&#160;sAtt&#160;&amp;&#160;&#34; /&gt;&#34;<br/>&#160; &#160; &#160; &#160; &#160;&#160;REM Write the element in a short notation line.<br/>&#160; &#160; &#160; &#160; &#160;&#160;oStream.writeString(sLine&#160;&amp; CHR$(10))<br/>&#160; &#160; &#160; &#160;&#160;End If<br/>&#160; &#160; &#160;&#160;End If<br/>&#160; &#160;&#160;End If<br/>&#160;&#160;End If<br/>End Sub<br/>
REM Returns a string of all the attributes of an element.<br/>Function&#160;AttString(oAttList) As String<br/>&#160;&#160;Dim&#160;oAtt&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'A single attribute node<br/>&#160;&#160;Dim&#160;sValue&#160;As String&#160; &#160; &#160; &#160;&#160;'A single attribute's value<br/>&#160;&#160;Dim&#160;sAtts&#160;As String&#160; &#160; &#160; &#160; &#160;'The string containing all attributes<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;<br/>&#160;&#160;If Not IsNull(oAttList) Then<br/>&#160; &#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oAttList.getLength&#160;-&#160;1<br/>&#160; &#160; &#160;&#160;oAtt&#160;=&#160;oAttList.item(i)<br/>&#160; &#160; &#160;&#160;sValue&#160;=&#160;oAtt.getNodeValue<br/>&#160; &#160; &#160;&#160;If&#160;sValue&#160;&lt;&gt;&#160;&#34;&#34;&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;sAtts&#160;=&#160;sAtts&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;oAtt.getNodeName&#160;&amp;&#160;&#34;=&#34;&#34;&#34;&#160;&amp;&#160;sValue&#160;&amp;&#160;&#34;&#34;&#34;&#34;<br/>&#160; &#160; &#160;&#160;End If<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;End If<br/>&#160;&#160;AttString&#160;=&#160;sAtts<br/>End Function<br/>
REM Checks recursively, if there is some child node with content, be it text,<br/>REM comment or attribute value other than &#34;&#34;. Returns True, if some content<br/>REM is found in the tree, otherwise False.<br/>REM It is called by PrintDom, before the actual element start tag is written,<br/>REM so PrintDom can abstain from printing an empty element.<br/>Function&#160;HasContent(oElementList) As Boolean<br/>&#160;&#160;Dim&#160;oChild&#160; &#160; &#160; &#160; &#160;&#160;'A single child node of oElementList<br/>&#160;&#160;Dim&#160;oAttributes&#160; &#160; &#160;'The attributes of oChild<br/>&#160;&#160;Dim&#160;oChildren&#160; &#160; &#160; &#160;'The child nodes of oChild<br/>&#160;&#160;Dim&#160;i%,&#160;j%<br/>&#160;&#160;<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oElementList.getLength&#160;-&#160;1<br/>&#160; &#160;&#160;oChild&#160;=&#160;oElementList.item(i)<br/>&#160; &#160;&#160;If&#160;oChild.hasAttributes&#160;Then<br/>&#160; &#160; &#160;&#160;oAttributes&#160;=&#160;oChild.getAttributes<br/>&#160; &#160; &#160;&#160;For&#160;j&#160;=&#160;0&#160;To&#160;oAttributes.getLength&#160;-&#160;1<br/>
539<br/>
<hr/>
<a name=543></a>&#160; &#160; &#160; &#160;&#160;If&#160;oAttributes.item(j).getNodeValue&#160;&lt;&gt;&#160;&#34;&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;HasContent&#160;=&#160;True<br/>&#160; &#160; &#160; &#160; &#160;&#160;Exit Function<br/>&#160; &#160; &#160; &#160;&#160;End If<br/>&#160; &#160; &#160;&#160;Next<br/>&#160; &#160;&#160;End If<br/>&#160; &#160;&#160;If&#160;oChild.getNodeType&#160;=&#160;com.sun.star.xml.dom.NodeType.TEXT_NODE&#160;Then<br/>&#160; &#160; &#160;&#160;If&#160;oChild.getNodeValue&#160;&lt;&gt;&#160;&#34;&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;HasContent&#160;=&#160;True<br/>&#160; &#160; &#160; &#160; &#160;&#160;Exit Function<br/>&#160; &#160; &#160;&#160;End If<br/>&#160; &#160;&#160;Elseif&#160;oChild.getNodeType&#160;=&#160;com.sun.star.xml.dom.NodeType.COMMENT_NODE&#160;Then<br/>&#160; &#160; &#160;&#160;If&#160;oChild.getNodeValue&#160;&lt;&gt;&#160;&#34;&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;HasContent&#160;=&#160;True<br/>&#160; &#160; &#160; &#160; &#160;&#160;Exit Function<br/>&#160; &#160; &#160;&#160;End If<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;oChildren&#160;=&#160;oChild.getChildNodes()<br/>&#160; &#160; &#160;&#160;If&#160;oChildren.getLength&#160;&lt;&gt;&#160;0&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;REM Start the recursion<br/>&#160; &#160; &#160; &#160;&#160;If&#160;HasContent(oChildren) Then<br/>&#160; &#160; &#160; &#160; &#160;&#160;HasContent&#160;=&#160;True<br/>&#160; &#160; &#160; &#160; &#160;&#160;Exit Function<br/>&#160; &#160; &#160; &#160;&#160;End If<br/>&#160; &#160; &#160;&#160;End If<br/>&#160; &#160; End If<br/>&#160;&#160;Next<br/>&#160;&#160;HasContent&#160;=&#160;False<br/>End Function<br/>
The&#160;WriteDomToFile&#160;subroutine&#160;takes&#160;two arguments,&#160;the&#160;DOM&#160;document&#160;and the&#160;file&#160;URL.&#160;An output&#160;<br/>stream&#160;is&#160;obtained from&#160;the&#160;SimpleFileAccess, which is&#160;then used by&#160;a&#160;TextOutputStream&#160;to&#160;write&#160;a&#160;UTF-8&#160;<br/>encoded text&#160;file&#160;one&#160;line&#160;at&#160;a&#160;time.<br/>
1.&#160;The&#160;first&#160;line&#160;of an XML&#160;file&#160;is&#160;the&#160;xml&#160;processing instruction that&#160;is&#160;not&#160;part&#160;of the&#160;DOM&#160;document.&#160;<br/>
2.&#160;The&#160;macro iterates&#160;over root&#160;nodes&#160;children and prints&#160;each using PrintDom.&#160;PrintDom&#160;calls&#160;itself to&#160;<br/>
print&#160;children of the&#160;node&#160;with which it&#160;was&#160;called.<br/>
3.&#160;PrintDom&#160;accepts&#160;four arguments:&#160;the&#160;current&#160;node, the&#160;output&#160;stream, the&#160;indentation&#160;level, and the&#160;<br/>
number of spaces&#160;used for indentation.&#160;The&#160;first&#160;level&#160;is&#160;not&#160;indented,&#160;for each lower level&#160;– that&#160;is&#160;<br/>for each consecutive&#160;call&#160;of PrintDom&#160;– two spaces&#160;are&#160;added.<br/>
4.&#160;If&#160;the&#160;current&#160;node&#160;is&#160;a&#160;comment,&#160;PrintDom&#160;writes&#160;the&#160;text&#160;of the&#160;comment&#160;in the&#160;XML&#160;comment&#160;<br/>
notation:&#160;&lt;!--&#160;Text&#160;--&gt;. Line&#160;feed characters&#160;within the&#160;text&#160;break the&#160;output&#160;into&#160;new&#160;lines. PrintDom<br/>terminates.<br/>
5.&#160;For&#160;element&#160;nodes, PrintDom&#160; uses&#160;the&#160;AttString function&#160;to print&#160;attributes.<br/>
Special&#160;attention&#160;is&#160;made&#160;to&#160;print&#160;the&#160;XML&#160;in&#160;a&#160;“pretty”&#160;way;&#160;for example, if&#160;possible, a&#160;node&#160;is&#160;printed&#160;as&#160;<br/>&lt;Name/&gt;&#160;rather than &lt;Name&gt;&lt;/Name&gt;.<br/>
540<br/>
<hr/>
<a name=544></a><i><b>&#160;15.13.&#160;Charts<br/></b></i>Many&#160;things&#160;can be&#160;done&#160;with charts, but&#160;only&#160;a&#160;small&#160;portion&#160;of the&#160;capabilities&#160;are&#160;shown here&#160;in&#160;an&#160;<br/>attempt&#160;to provide&#160;an overview&#160;of what&#160;can be&#160;accomplished.&#160;<br/>
Although a&#160;chart&#160;is&#160;a&#160;document&#160;(it&#160;has&#160;its&#160;own document&#160;model), charts&#160;are&#160;always&#160;embedded in other OOo&#160;<br/>documents. Objects&#160;that&#160;support&#160;embedded charts&#160;(Calc&#160;sheets) implement&#160;the&#160;getCharts&#160;method&#160;as&#160;defined&#160;<br/>by&#160;the&#160;XTtableChartsSupplier interface, which returns&#160;a&#160;TableCharts&#160;service.<br/>
ThisComponent.Sheets(0).getCharts()<br/>
<i><b>Table&#160;219.</b>&#160;Methods&#160;implemented in&#160;the&#160;com.sun.star.table.XTableCharts&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
addNewByName&#160;(&#160;name,&#160;size,&#160;data,&#160;bCol,&#160;bRow&#160;)<br/>
Create&#160;and&#160;add&#160;the&#160;named&#160;chart.<br/>
createEnumeration()<br/>
Create&#160;an enumeration.<br/>
getByIndex(&#160;i&#160;)<br/>
Get&#160;chart&#160;by&#160;index.<br/>
getByName(&#160;name&#160;)<br/>
Get&#160;chart&#160;by&#160;name.<br/>
getCount(&#160; )<br/>
Number&#160;of&#160;charts.<br/>
getElementNames(&#160;)<br/>
Array&#160;of&#160;chart&#160;names.<br/>
hasByName&#160;(&#160;name&#160;)<br/>
Determine&#160;if&#160;a&#160;named&#160;chart&#160;exists.<br/>
hasElements&#160;(&#160;)<br/>
Determine&#160;if&#160;any&#160;charts&#160;exist.<br/>
removeByName&#160;(&#160;name&#160;)<br/>
Delete&#160;a&#160;named chart.<br/>
Sample&#160;data&#160;is&#160;needed to discuss&#160;charts.<br/>
<i><b>Listing&#160;474.</b>&#160;Create&#160;sample&#160;chart&#160;data.<br/></i>Function&#160;CreateCalcForChart<br/>&#160;&#160;Dim&#160;oCalcDoc&#160; &#160; &#160; &#160;&#160;'The source Calc spreadsheet document<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160; &#160; &#160;&#160;'The source sheet<br/>&#160;&#160;Dim&#160;sDataRng$&#160; &#160; &#160; &#160;'Where is the data<br/>&#160;&#160;<br/>&#160;&#160;oCalcDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#160;&#34;private:factory/scalc&#34;,&#160;&#34;_blank&#34;,&#160;0,&#160;Array())<br/>&#160;&#160;oSheet&#160;=&#160;oCalcDoc.Sheets(0)<br/>&#160;&#160;sDataRng&#160;=&#160;&#34;A1:D6&#34;<br/>&#160;&#160;Dim&#160;oData<br/>&#160;&#160;oData&#160;=&#160;Array(&#160;Array(&#34;A&#34;,&#160;&#34;B&#34;,&#160;&#34;C&#34;,&#160;&#34;D&#34;),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Array(3,&#160;1,&#160;5,&#160;4),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Array(2,&#160;2,&#160;4,&#160;1),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Array(1,&#160;3,&#160;3,&#160;0),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Array(2,&#160;4,&#160;2,&#160;1),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Array(3,&#160;5,&#160;1,&#160;4))<br/>&#160;&#160;oSheet.getCellRangeByName(&#160;sDataRng&#160;).setDataArray(oData)<br/>&#160;&#160;CreateCalcForChart&#160;=&#160;oCalcDoc<br/>End&#160;Function<br/>
The&#160;sample&#160;data&#160;is&#160;shown below:<br/>
541<br/>
<hr/>
<a name=545></a><i><b>Table&#160;220.</b>&#160;Sample&#160;data&#160;for&#160;charts.</i><br/>
A<br/>
B<br/>
C<br/>
D<br/>
1<br/>
A<br/>
B<br/>
C<br/>
D<br/>
2<br/>
3<br/>
1<br/>
5<br/>
4<br/>
3<br/>
2<br/>
2<br/>
4<br/>
1<br/>
4<br/>
1<br/>
3<br/>
3<br/>
0<br/>
5<br/>
2<br/>
4<br/>
2<br/>
1<br/>
6<br/>
3<br/>
5<br/>
1<br/>
4<br/>
Consider the&#160;simple&#160;example&#160;below&#160;that&#160;creates&#160;a&#160;simple&#160;chart.&#160;A&#160;Calc&#160;document&#160;is&#160;created&#160;with simple&#160;data&#160;<br/>(see<a href="libremacros.html#544">&#160;Listing 474&#160;a</a><a href="libremacros.html#545">nd&#160;Table&#160;220)</a>. If&#160;the&#160;chart&#160;does&#160;not&#160;exist,&#160;it&#160;is&#160;created&#160;10 cm&#160;(about&#160;4 inches) from&#160;the&#160;left&#160;<br/>edge&#160;and 1 cm&#160;from&#160;the&#160;top edge.&#160;The&#160;graph is&#160;10 cm&#160;x&#160;10 cm&#160;in size.An array&#160;of cell&#160;range&#160;addresses&#160;is&#160;<br/>passed as&#160;the&#160;third argument&#160;to addNewByName&#160;to define&#160;the&#160;data&#160;that&#160;is&#160;charted.<br/>
<i><b>Listing&#160;475.</b>&#160;Create&#160;a simple&#160;chart.</i><br/>
Sub&#160;CreateCalcWithSimpleChart<br/>&#160;&#160;Dim&#160;oSheet &#160; &#160;&#160;'Sheet containing the chart<br/>&#160;&#160;Dim&#160;oRect &#160; &#160; &#160;'How big is the chart<br/>&#160;&#160;Dim&#160;oCharts &#160; &#160;'Charts in the sheet<br/>&#160;&#160;Dim&#160;oChart &#160; &#160;&#160;'Created chart<br/>&#160;&#160;Dim&#160;oAddress &#160;&#160;'Address of data to plot<br/>&#160;&#160;Dim&#160;sName$&#160; &#160; &#160;'Chart name<br/>&#160;&#160;Dim&#160;oChartDoc &#160;'Embedded chart object<br/>&#160;&#160;Dim&#160;oTitle &#160; &#160;&#160;'Chart title object<br/>&#160;&#160;Dim&#160;oDiagram &#160;&#160;'Inserted diagram (data).<br/>&#160;&#160;Dim&#160;sDataRng$&#160;&#160;'Where is the data<br/>&#160;&#160;Dim&#160;oCalcDoc<br/>&#160;&#160;<br/>&#160; oCalcDoc&#160;=&#160;CreateCalcForChart()<br/>
&#160; sName&#160;=&#160;&#34;ADP_Chart&#34;<br/>&#160; sDataRng&#160;=&#160;&#34;A1:D6&#34;<br/>
&#160; oSheet&#160;=&#160;oCalcDoc.sheets(0)<br/>&#160; oAddress&#160;=&#160;oSheet.getCellRangeByName(&#160;sDataRng&#160;).getRangeAddress()&#160;<br/>&#160; oCharts&#160;=&#160;oSheet.getCharts()<br/>&#160;&#160;If&#160;NOT&#160;oCharts.hasByName(sName)&#160;Then<br/>&#160; &#160; oRect &#160; &#160; &#160;&#160;=&#160;createObject(&#34;com.sun.star.awt.Rectangle&#34;)<br/>&#160; &#160; oRect.X &#160; &#160;&#160;=&#160;10000<br/>&#160; &#160; oRect.Y &#160; &#160;&#160;=&#160;1000<br/>&#160; &#160; oRect.width&#160;=&#160;10000<br/>&#160; &#160; oRect.Height=&#160;10000<br/>
&#160; &#160;&#160;' The rectangle identifies the dimensions in 1/100 mm.<br/>&#160; &#160;&#160;' The address is the location of the data.<br/>&#160; &#160;&#160;' True indicates that column headings should be used.<br/>&#160; &#160;&#160;' False indicates that Row headings should not be used.<br/>&#160; &#160; oCharts.addNewByName(sName,&#160;oRect,&#160;Array(oAddress),&#160;True,&#160;False)<br/>
542<br/>
<hr/>
<a name=546></a>&#160;&#160;End&#160;If<br/>
&#160; oChart&#160;=&#160;oCharts.getByName(&#160;sName&#160;)<br/>&#160; oChart.setRanges(Array(oAddress))<br/>&#160; oChartDoc&#160;=&#160;oChart.getEmbeddedObject()<br/>&#160;&#160;'oChartDoc.attachData(oAddress)<br/>&#160; oTitle&#160;=&#160;oChartDoc.getTitle()<br/>&#160; oTitle.String&#160;=&#160;&#34;Andy - &#34;&#160;&amp;&#160;Now<br/>
&#160;&#160;' Create a diagram.<br/>&#160; oDiagram&#160;=&#160;oChartDoc.createInstance(&#160;&#34;com.sun.star.chart.LineDiagram&#34;&#160;)<br/>&#160; oChartDoc.setDiagram(&#160;oDiagram&#160;)<br/>&#160; oDiagram&#160;=&#160;oChartDoc.getDiagram()<br/>&#160; oDiagram.DataCaption&#160;=&#160;com.sun.star.chart.ChartDataCaption.VALUE<br/>&#160; oDiagram.DataRowSource&#160;=&#160;com.sun.star.chart.ChartDataRowSource.COLUMNS&#160;<br/>End&#160;Sub&#160;<br/>
<i><b>Figure&#160;111.</b>&#160;Simple&#160;chart&#160;created by<a href="libremacros.html#545">&#160;Listing 475.</a></i><br/>
The&#160;chart&#160;can be&#160;modified after it&#160;is&#160;in&#160;the&#160;document.&#160;The&#160;following snippet&#160;changes&#160;the&#160;already&#160;inserted&#160;<br/>chart&#160;and uses&#160;three&#160;ranges&#160;that&#160;need not&#160;be&#160;contiguous.&#160;<br/>
543<br/>
<hr/>
<a name=547></a><i><b>Listing&#160;476.</b>&#160;Modify&#160;an existing&#160;chart.<br/></i>&#160;&#160;sName&#160;=&#160;&#34;ADP_Chart&#34;<br/>&#160;&#160;sDataRng&#160;=&#160;&#34;A1:D6&#34;<br/>
&#160;&#160;oSheet&#160;=&#160;ThisComponent.sheets(0)<br/>&#160;&#160;oCharts&#160;=&#160;oSheet.getCharts()<br/>&#160;&#160;If&#160;oCharts.hasByName(sName)&#160;Then<br/>&#160; &#160;&#160;oChart&#160;=&#160;oCharts.getByName(sName)<br/>&#160; &#160;&#160;oData&#160;=&#160;Array(oSheet.getCellRangeByName(&#160;&#34;A1:A6&#34;&#160;).getRangeAddress(),&#160;_<br/>&#160; &#160; &#160; &#160;&#160;oSheet.getCellRangeByName(&#160;&#34;C1:C6&#34;&#160;).getRangeAddress(),&#160;_<br/>&#160; &#160; &#160; &#160;&#160;oSheet.getCellRangeByName(&#160;&#34;D1:D6&#34;&#160;).getRangeAddress())<br/>&#160; &#160;&#160;oChart.setRanges(oData)<br/>&#160;&#160;End&#160;If<br/>
<i><b>Figure&#160;112.</b>&#160;Modify&#160;the&#160;chart.</i><br/>
The&#160;chart&#160;supports&#160;the&#160;com.sun.star.table.TableChart&#160;service.&#160;The&#160;primary&#160;methods&#160;of interest&#160;are&#160;shown &#160;i<a href="libremacros.html#548">n<br/>Table&#160;221.&#160;</a>A&#160;TableChart&#160;object&#160;also&#160;implements&#160;methods&#160;to add and remove&#160;listeners.<br/>
544<br/>
<hr/>
<a name=548></a><i><b>Table&#160;221.</b>&#160;Main methods&#160;to&#160;control&#160;a TableChart.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getEmbeddedObject()<br/>
Get&#160;the&#160;chart&#160;model.<br/>
getHasColumnHeaders()<br/>
Are&#160;the&#160;cells of&#160;the&#160;topmost&#160;row&#160;of&#160;the&#160;source&#160;data&#160;used&#160;as&#160;column&#160;headers.<br/>
getHasRowHeaders()<br/>
Are&#160;the&#160;cells of&#160;the&#160;leftmost&#160;column&#160;of&#160;the&#160;source&#160;data&#160;used&#160;as row&#160;headers.<br/>
getName()<br/>
Get&#160;the&#160;chart&#160;name.<br/>
getRanges()<br/>
Get&#160;an array&#160;of&#160;ranges used in&#160;the&#160;chart.<br/>
setHasColumnHeaders(&#160;b&#160;)<br/>
Set&#160;if&#160;the&#160;cells of&#160;the&#160;topmost&#160;row&#160;of&#160;the&#160;source&#160;data&#160;are&#160;used&#160;as column&#160;headers.<br/>
setHasRowHeaders (&#160;b )<br/>
Set&#160;if&#160;the&#160;cells of&#160;the&#160;leftmost&#160;column&#160;of&#160;the&#160;source&#160;data&#160;are&#160;used as row&#160;headers.<br/>
setName&#160;(&#160;name&#160;)<br/>
Set&#160;the&#160;chart&#160;name.<br/>
setRanges (&#160;ranges )<br/>
Set&#160;the&#160;ranges used&#160;in the&#160;report.<br/>
The&#160;chart&#160;model&#160;has&#160;significant&#160;complexity&#160;– you&#160;do remember that&#160;it&#160;is&#160;an embedded document.&#160;There&#160;are&#160;<br/>multiple&#160;methods&#160;for dealing with&#160;chart&#160;titles.&#160;The&#160;chart&#160;title&#160;object&#160;supports&#160;backgrounds, bitmaps, text&#160;<br/>rotation,&#160;paragraph styles, and an array&#160;of &#160;formatted text&#160;objects&#160;that&#160;represent&#160;the&#160;text&#160;of the&#160;title.&#160;In&#160;our&#160;<br/>example,&#160;the&#160;title&#160;has&#160;a&#160;single&#160; text&#160;element,&#160;which can be&#160;changed as&#160;follows:<br/>
<i><b>Listing&#160;477.</b>&#160;Set&#160;the&#160;chart&#160;title&#160;using getTitleObject().<br/></i>oChartDoc&#160;=&#160;oChart.getEmbeddedObject()<br/>Dim&#160;txtArray<br/>txtArray&#160;=&#160;oChartDoc.getTitleObject().getText()<br/>&#160; &#160;&#160;(0).setString(&#34;New Title Text&#34;)<br/>
Formatted&#160;strings&#160;support&#160;properties&#160;related to&#160;formatting such as&#160;CharColor,&#160;CharEmphasis,&#160;<br/>CharFontName,&#160;and CharFontStyleName. I&#160;recommend&#160;object&#160;inspection&#160;to see&#160;what&#160;is&#160;supported.&#160;The&#160;chart<br/>doc&#160;also supports&#160;the&#160;getTitle() method which encapsulates&#160;the&#160;title&#160;as&#160;a&#160;single&#160;string and supports&#160;similar&#160;<br/>text&#160;formatting characteristics.&#160;The&#160;object&#160;returned by&#160;getTitle&#160;implements&#160;the&#160;XShape&#160;interface, so it&#160;can be<br/>used to&#160;change&#160;the&#160;position and size.&#160;<br/>
<i><b>Listing&#160;478.</b>&#160;Set&#160;the&#160;chart&#160;title&#160;using getTitle().</i><br/>
oChartDoc.getTitle().String&#160;=&#160;&#34;one two three&#34;<br/>
The&#160;subtitle,&#160;available&#160;using getSubtitle(), is&#160;also a&#160;com.sun.star.comp.chart.Title&#160;service,&#160;so, all&#160;methods&#160;<br/>that&#160;apply&#160;to the&#160;title,&#160;also apply&#160;to the&#160;subtitle.&#160;<br/>
<i><b>Listing&#160;479.</b>&#160;Set&#160;the&#160;chart&#160;subtitle.</i><br/>
oChartDoc.getSubTitle().String&#160;=&#160;&#34;I am the subtitle&#34;<br/>
Use&#160;getLegend() to&#160;get&#160;the&#160;legend (com.sun.star.comp.chart.Legend), which&#160;you&#160;can use&#160;to&#160;change&#160;the&#160;font,&#160;<br/>size,&#160;position,&#160;and other formatting characteristics.&#160;The&#160;legend object&#160;does&#160;not&#160;allow&#160;you&#160;to&#160;change&#160;the&#160;text&#160;<br/>of the&#160;legend, however.&#160;<br/>
Changing&#160;the&#160;chart&#160;type&#160;involves&#160;asking the&#160;chart&#160;document&#160;for an appropriate&#160;diagram&#160;type, and then&#160;<br/>setting it&#160;(see<a href="libremacros.html#545">&#160;Listing&#160;475). N</a>ote&#160;that&#160;the&#160;TypesDocCanCreate&#160;macro i<a href="libremacros.html#238">n&#160;Listing&#160;214&#160;c</a>an also be&#160;used here.<br/>
<i><b>Listing&#160;480.</b>&#160;List&#160;services&#160;the&#160;chart&#160;document&#160;can create.</i><br/>
Dim&#160;oWriteDoc<br/>Dim&#160;oText<br/>Dim&#160;sn<br/>oWriteDoc&#160;= StarDesktop.loadComponentFromURL(&#34;private:factory/swriter&#34;,&#160;&#34;_blank&#34;,&#160;0, Array())<br/>oText&#160;=&#160;oWriteDoc.getText()<br/>
545<br/>
<hr/>
<a name=549></a>sn&#160;=&#160;oChartDoc.getAvailableServiceNames()<br/>MsgBox Join(sn, CHR$(10))<br/>oText.insertString&#160;(&#160;oText.End, Join(sn, CHR$(10)),&#160;False&#160;)<br/>
The&#160;list&#160;returned by&#160;Apache&#160;OpenOffice&#160;3.4 is&#160;as&#160;follows:<br/>
1.&#160;com.sun.star.chart.AreaDiagram<br/>
2.&#160;com.sun.star.chart.BarDiagram<br/>
3.&#160;com.sun.star.chart.BubbleDiagram<br/>
4.&#160;com.sun.star.chart.DonutDiagram<br/>
5.&#160;com.sun.star.chart.FilledNetDiagram<br/>
6.&#160;com.sun.star.chart.LineDiagram<br/>
7.&#160;com.sun.star.chart.NetDiagram<br/>
8.&#160;com.sun.star.chart.PieDiagram<br/>
9.&#160;com.sun.star.chart.StockDiagram<br/>
10.&#160;com.sun.star.chart.XYDiagram<br/>
11.&#160;com.sun.star.document.ExportGraphicObjectResolver<br/>
12.&#160;com.sun.star.document.ImportGraphicObjectResolver<br/>
13.&#160;com.sun.star.drawing.BitmapTable<br/>
14.&#160;com.sun.star.drawing.DashTable<br/>
15.&#160;com.sun.star.drawing.GradientTable<br/>
16.&#160;com.sun.star.drawing.HatchTable<br/>
17.&#160;com.sun.star.drawing.MarkerTable<br/>
18.&#160;com.sun.star.drawing.TransparencyGradientTable<br/>
19.&#160;com.sun.star.xml.NamespaceMap<br/>
The&#160;first&#160;10 items&#160;are&#160;chart&#160;types. Changing&#160;the&#160;diagram&#160;type&#160;is&#160;trivial.<br/>
<i><b>Listing&#160;481.</b>&#160;Set&#160;chart&#160;type&#160;to PieDiagram.<br/></i>oChartDoc&#160;=&#160;oChart.getEmbeddedObject()<br/>oDiagram&#160;=&#160;oChartDoc.createInstance(&#160;&#34;com.sun.star.chart.PieDiagram&#34;&#160;)<br/>oChartDoc.setDiagram(&#160;oDiagram&#160;)<br/>
Use&#160;getArea() to get&#160;the&#160;com.sun.star.comp.chart.Area&#160;for the&#160;chart.&#160;Use&#160;the&#160;Area&#160;object&#160;to set&#160;visual&#160;<br/>characteristics&#160;such as&#160;colors, size,&#160;and position.<br/>
The&#160;actual&#160;plot&#160;is&#160;contained&#160;in the&#160;diagram,&#160;available&#160;using getDiagram().&#160;To&#160;get&#160;a&#160;feel&#160;for some&#160;of the&#160;<br/>properties&#160;supported by&#160;the&#160;diagram&#160;object, look&#160;at<a href="libremacros.html#550">&#160;Table&#160;222. N</a>umerous&#160;other properties&#160;and methods&#160;are&#160;<br/>also supported,&#160;but&#160;they&#160;are&#160;omitted&#160;due&#160;to&#160;space&#160;constraints.&#160;Inspect&#160;the&#160;object&#160;to&#160;find properties&#160;related to&#160;<br/>axis, colors, bitmaps, and grids.&#160;<br/>
546<br/>
<hr/>
<a name=550></a><i><b>Table&#160;222.</b>&#160;Properties&#160;used to set&#160;error&#160;bars.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
ConstantErrorLow<br/>
Lower&#160;limit&#160;of&#160;the&#160;error&#160;range&#160;of&#160;a&#160;data&#160;row.<br/>
ConstantErrorHigh<br/>
Upper&#160;limit&#160;of&#160;the&#160;error&#160;range&#160;of&#160;a&#160;data&#160;row.&#160;<br/>
ErrorBarStyle<br/>
Use&#160;com.sun.star.chart.ErrorBarStyle&#160;constants&#160;to set&#160;the&#160;error&#160;bar&#160;style.&#160;Use:&#160;NONE,&#160;<br/>
VARIANCE,&#160;STANDARD_DEVIATION,&#160;ABSOLUTE,&#160;RELATIVE, ERROR_MARGIN,&#160;<br/>STANDARD_ERROR, or&#160;FROM_DATA.<br/>
PercentageError<br/>
Percentage&#160;used&#160;to display&#160;error&#160;bars.<br/>
ErrorMargin<br/>
Percentage&#160;for&#160;the&#160;margin of&#160;errors.<br/>
ErrorIndicator<br/>
Use&#160;com.sun.star.chart.ChartErrorIndicatorType&#160;enum&#160;to&#160;specify&#160;how&#160;the&#160;error&#160;is&#160;indicated.&#160;<br/>Valid values include&#160;NONE,&#160;TOP_AND_BOTTOM,&#160;UPPER, or&#160;LOWER.<br/>
ErrorBarRangePositive<br/>
Cell&#160;range&#160;string&#160;for&#160;positive&#160;error&#160;bars –&#160;assuming&#160;the&#160;ErrorBarStyle&#160;is set&#160;to FROM_DATA.<br/>
ErrorBarRangeNegative<br/>
Cell&#160;range&#160;string&#160;for&#160;negative&#160;error&#160;bars –&#160;assuming&#160;the&#160;ErrorBarStyle&#160;is&#160;set&#160;to FROM_DATA.<br/>
MeanValue<br/>
Set&#160;to true&#160;to display&#160;the&#160;mean value&#160;for&#160;a&#160;data&#160;row&#160;as a&#160;line.<br/>
RegressionCurves<br/>
Use&#160;com.sun.star.chart.ChartRegressionCurveType&#160;enum&#160;to specify&#160;the&#160;type&#160;of&#160;regression for&#160;<br/>
the&#160;data&#160;row&#160;values.&#160;Valid&#160;values include:&#160;NONE,&#160;LINEAR,&#160;LOGARITHM,&#160;EXPONENTIAL,&#160;<br/>or&#160;POWER.<br/>
DataCaption<br/>
Use&#160;com.sun.star.chart.ChartDataCaption constants to determine&#160;how&#160;points are&#160;captioned.&#160;Valid<br/>values&#160;include&#160;NONE,&#160;VALUE,&#160;PERCENT,&#160;TEXT,&#160; or&#160;SYMBOL.&#160;The&#160;chart&#160;in<a href="libremacros.html#547">&#160;Figure&#160;112&#160;i</a>s&#160;set<br/>
to&#160;VALUE, so the&#160;numeric&#160;values are&#160;shown at&#160;each&#160;data&#160;point.<br/>
DataRowSource<br/>
Use&#160;com.sun.star.chart.ChartDataRowSource&#160;enum&#160;values to to determine&#160;if&#160;data&#160;is in rows&#160;or&#160;<br/>
columns.&#160;Valid values include&#160;ROWS, &#160;or&#160;COLUMNS.<br/>
<i><b>&#160;15.14.&#160;Conclusion<br/></b></i>Calc&#160;documents&#160;are&#160;feature-rich and they&#160;support&#160;a&#160;wide&#160;variety&#160;of capabilities.&#160;In&#160;my&#160;opinion,&#160;Calc&#160;<br/>documents&#160;provide&#160;more&#160;functionality&#160;than any&#160;other document&#160;type&#160;supported by&#160;OOo.&#160;This&#160;chapter,&#160;<br/>therefore, is&#160;only&#160;the&#160;beginning of the&#160;wonderful&#160;things&#160;that&#160;you&#160;can do using Calc&#160;documents.<br/>
547<br/>
<hr/>
<a name=551></a><b>&#160;16.&#160;Draw&#160;and&#160;Impress&#160;Documents<br/></b>This&#160;chapter introduces&#160;methods&#160;to&#160;manipulate&#160;and modify&#160;the&#160;content&#160;contained in&#160;Draw&#160;and Impress&#160;<br/>documents.&#160;Although the&#160;drawing functionality&#160;is&#160;the&#160;same&#160;in Draw&#160;and Impress, Impress&#160;contains&#160;extra&#160;<br/>functionality&#160;to&#160;facilitate&#160;presentations.<br/>
Draw&#160;and Impress&#160;are&#160;vector-oriented graphical&#160;applications.&#160;They&#160;can also&#160;display&#160;bitmap images, but&#160;their&#160;<br/>strength is&#160;not&#160;in&#160;photo editing.&#160;Vector-oriented&#160;applications&#160;represent&#160;many&#160;graphical&#160;objects&#160;as&#160;objects&#160;<br/>rather than&#160;as&#160;bit-mapped images. For&#160;example, lines, circles, rectangles, and text&#160;are&#160;each represented&#160;as&#160;<br/>special&#160;objects.&#160;One&#160;advantage&#160;of vector graphics&#160;is&#160;that&#160;you&#160;can independently&#160;manipulate&#160;and transform&#160;<br/>multiple&#160;overlapping elements&#160;without&#160;worrying&#160;about&#160;resolution&#160;and pixels.&#160;<br/>
Photo-editing graphics&#160;packages&#160;typically&#160;represent&#160;and manipulate&#160;images&#160;as&#160;bitmaps.&#160;A&#160;bitmap&#160;<br/>representing an image&#160;is&#160;characterized by&#160;the&#160;width&#160;and height&#160;of the&#160;image&#160;in pixels. Each pixel&#160;represents&#160;<br/>a&#160;single, colored dot&#160;in the&#160;image.&#160;The&#160;drawing capability&#160;in&#160;OpenOffice.org, however,&#160;is&#160;focused on vector&#160;<br/>operations.<br/>
Every&#160;Draw&#160;document&#160;supports&#160;the&#160;com.sun.star.drawing.DrawingDocument&#160;service&#160;and every&#160;Impress&#160;<br/>document&#160;supports&#160;the&#160;com.sun.star.presentation.PresentationDocument&#160;service.&#160;When I&#160;write&#160;a&#160;macro that&#160;<br/>must&#160;be&#160;user friendly&#160;and requires&#160;a&#160;specific&#160;document&#160;type, I&#160;verify&#160;that&#160;the&#160;document&#160;is&#160;the&#160;correct&#160;type&#160;by&#160;<br/>using the&#160;object&#160;method supportsService&#160;(see<a href="libremacros.html#551">&#160;Listing 482)</a>.<br/>
<i><b>Listing&#160;482.</b>&#160;Check&#160;for&#160;an Impress&#160;document&#160;before&#160;checking&#160;for&#160;a Draw document.<br/></i>REM If it really matters, you should check the document type<br/>REM to avoid a run-time error.<br/>sDraw$&#160;=&#160;&#34;com.sun.star.drawing.DrawingDocument&#34;<br/>sImpress$&#160;=&#160;&#34;com.sun.star.presentation.PresentationDocument&#34;<br/>If&#160;ThisComponent.SupportsService(sImpress$)&#160;Then<br/>&#160;&#160;MsgBox&#160;&#34;The current document is an Impress document&#34;,&#160;0,&#160;&#34;Impress Document&#34;<br/>ElseIf&#160;ThisComponent.SupportsService(sDraw$)&#160;Then<br/>&#160;&#160;MsgBox&#160;&#34;The current document is a Draw document&#34;,&#160;0,&#160;&#34;Draw Document&#34;<br/>Else<br/>&#160;&#160;MsgBox&#160;&#34;The current document is not the correct type&#34;,&#160;48,&#160;&#34;Error&#34;<br/>&#160;&#160;Exit&#160;Sub<br/>End&#160;If<br/>
<b>Warn</b><br/>
The&#160;PresentationDocument&#160;service&#160;implements&#160;the&#160;DrawingDocument&#160;service.&#160;This means&#160;that&#160;every&#160;<br/>
presentation document&#160;looks like&#160;a&#160;drawing&#160;document.&#160;To&#160;distinguish between the&#160;two&#160;document&#160;types,&#160;<br/>you&#160;must&#160;first&#160;check for&#160;a&#160;presentation (Impress)&#160;document&#160;and then check&#160;for&#160;a&#160;drawing&#160;document.<br/>
The&#160;simple&#160;function&#160;below&#160;returns&#160;a&#160;new&#160;document,&#160;this&#160;is&#160;used in other macros&#160;for this&#160;chapter.<br/>
<i><b>Listing&#160;483.</b>&#160;Create&#160;a new&#160;document.<br/></i>REM Create a new empty document<br/>REM consider document types of<br/>REM scalc, swriter, sdraw, smath, and simpress<br/>Function&#160;LoadEmptyDocument(docType$)<br/>&#160;&#160;Dim&#160;noArgs()&#160; &#160; &#160; &#160; &#160;&#160;'An empty array for the arguments<br/>&#160;&#160;Dim&#160;sURL&#160;As&#160;String&#160; &#160;&#160;'URL of the document to load<br/>&#160;&#160;sURL&#160;=&#160;&#34;private:factory/&#34;&#160;&amp;&#160;docType<br/>&#160;&#160;LoadEmptyDocument&#160;=&#160;StarDesktop.LoadComponentFromUrl(sURL,&#160;&#34;_blank&#34;,&#160;0,&#160;noArgs())<br/>End&#160;Function&#160;<br/>
548<br/>
<hr/>
<a name=552></a><i><b>&#160;16.1.&#160;Draw&#160;pages<br/></b></i>The&#160;primary&#160;function&#160;of Draw&#160;and Impress&#160;documents&#160;is&#160;to&#160;contain&#160;graphical&#160;data, which&#160;is&#160;stored in&#160;draw&#160;<br/>pages.&#160;The&#160;primary&#160;draw-page&#160;functionality&#160;is&#160;implemented by&#160;a&#160;GenericDrawPage.&#160;There&#160;are&#160;two types&#160;of&#160;<br/>draw&#160;pages—the&#160;MasterPage&#160;and the&#160;DrawPage. Both draw-page&#160;types&#160;implement&#160;the&#160;GenericDrawPage&#160;<br/>and are&#160;therefore&#160;able&#160;to hold&#160;and manipulate&#160;the&#160;same&#160;content.<br/>
A&#160;master page&#160;acts&#160;as&#160;a&#160;common&#160;background for zero&#160;or more&#160;draw&#160;pages. Each draw&#160;page&#160;may&#160;link to&#160;one&#160;<br/>master page. Each master page&#160;is&#160;constrained as&#160;follows:<br/>
•<br/>
A&#160;master page, unlike&#160;a&#160;regular draw&#160;page, may&#160;not&#160;link to&#160;a&#160;master page.<br/>
•<br/>
A&#160;master page&#160;may&#160;not&#160;be&#160;removed&#160;from&#160;a&#160;document&#160;if any&#160;draw&#160;page&#160;links&#160;to it.<br/>
•<br/>
Modifications&#160;made&#160;to&#160;a&#160;master page&#160;are&#160;immediately&#160;visible&#160;on every&#160;draw&#160;page&#160;that&#160;uses&#160;that&#160;<br/>master page.<br/>
The&#160;method&#160;getMasterPages() returns&#160;the&#160;document’s&#160;collection&#160;of master pages.&#160;The&#160;method&#160;<br/>getDrawPages() returns&#160;the&#160;document’s&#160;collection of draw&#160;pages. Both&#160;methods&#160;return the&#160;same&#160;object&#160;type;&#160;<br/>they&#160;differ only&#160;in&#160;how&#160;their contents&#160;are&#160;used (see<a href="libremacros.html#552">&#160;Table&#160;223).</a><br/>
<i><b>Table&#160;223.</b>&#160;Methods&#160;supported by&#160;the&#160;com.sun.star.drawing.XDrawPages&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
duplicate(DrawPage)<br/>
Duplicate&#160;the&#160;DrawPage&#160;and&#160;return&#160;the&#160;new&#160;DrawPage.<br/>
getByIndex(Long)<br/>
Get&#160;the&#160;specified&#160;draw&#160;page.<br/>
getByName(String)<br/>
Get&#160;the&#160;specified&#160;draw&#160;page.<br/>
getCount()<br/>
Return the&#160;number&#160;of&#160;contained objects as a&#160;Long&#160;Integer.<br/>
hasByName(String)<br/>
Return&#160;True&#160;if&#160;the&#160;named page&#160;exists.<br/>
hasElements()<br/>
Return&#160;True&#160;if&#160;there&#160;are&#160;draw&#160;pages&#160;to return.<br/>
insertNewByIndex(Long)<br/>
Create&#160;and&#160;insert&#160;a&#160;new&#160;draw&#160;page&#160;at&#160;the&#160;specified&#160;index.<br/>
remove(DrawPage)<br/>
Remove&#160;a&#160;specific&#160;draw&#160;page.<br/>
Each draw&#160;page&#160;has&#160;a&#160;name, which you can access&#160;by&#160;using the&#160;methods&#160;getName() and setName().&#160;A&#160;draw&#160;<br/>page&#160;that&#160;is&#160;not&#160;a&#160;master supports&#160;the&#160;methods&#160;getMasterPage() and setMasterPage() to get&#160;and set&#160;the&#160;<br/>master page<a href="libremacros.html#552">.&#160;Listing&#160;484&#160;de</a>monstrates&#160;enumerating the&#160;document’s&#160;draw&#160;pages&#160;and their corresponding&#160;<br/>master pages.<br/>
<i><b>Listing&#160;484.</b>&#160;Print&#160;information&#160;related to&#160;draw pages&#160;and master&#160;pages.</i><br/>
Sub&#160;getPages()<br/>&#160;&#160;Dim&#160;s$<br/>&#160; Dim&#160;oDoc<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;LoadEmptyDocument(&#34;simpress&#34;)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;getPagesInfo(oDoc.getDrawPages(),&#160;&#34;Draw Pages&#34;)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;getPagesInfo(oDoc.getMasterPages(),&#160;&#34;Master Pages&#34;)<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Pages&#34;<br/>End&#160;Sub<br/>
Function&#160;getPagesInfo(oDPages,&#160;sType$)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;i%,&#160;s$<br/>
549<br/>
<hr/>
<a name=553></a>&#160;&#160;Dim&#160;oDPage,&#160;oMPage<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;*** There are &#34;&#160;&amp;&#160;oDPages.getCount()&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;sType&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oDPages.getCount()-1<br/>&#160; &#160;&#160;oDPage&#160;=&#160;oDPages.getByIndex(i)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;Page &#34;&#160;&amp;&#160;i&#160;&amp;&#160;&#34; = '&#34;&#160;&amp;&#160;oDPage.getName()&#160;&amp;&#160;&#34;'&#34;<br/>&#160; &#160;&#160;If&#160;NOT&#160;oDPage.supportsService(&#34;com.sun.star.drawing.MasterPage&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;oMPage&#160;=&#160;oDPage.getMasterPage()<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34; master = &#34;<br/>&#160; &#160; &#160;&#160;If&#160;NOT&#160;IsNull(oMPage)&#160;AND&#160;NOT&#160;IsEmpty(oMPage)&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;'&#34;&#160;&amp;&#160;oMPage.getName()&#160;&amp;&#160;&#34;'&#34;<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next<br/>&#160;&#160;getPagesInfo&#160;=&#160;s<br/>End&#160;Function<br/>
Although you can get&#160;a&#160;draw&#160;page&#160;based on its&#160;name, you&#160;can have&#160;more&#160;than one&#160;draw&#160;page&#160;with&#160;the&#160;same&#160;<br/>name. If&#160;multiple&#160;draw&#160;pages&#160;use&#160;the&#160;same&#160;name&#160;and you&#160;retrieve&#160;the&#160;draw&#160;page&#160;based on the&#160;name, it&#160;is&#160;not&#160;<br/>specified&#160;which&#160;draw&#160;page&#160;is&#160;returned.&#160;The&#160;macro in<a href="libremacros.html#553">&#160;Listing 485, w</a>hich&#160;searches&#160;for a&#160;draw&#160;page&#160;with&#160;a&#160;<br/>specific&#160;name, is&#160;used in&#160;numerous&#160;places&#160;in&#160;this&#160;chapter.<br/>
<i><b>Listing&#160;485.</b>&#160;Create&#160;a new&#160;page&#160;by&#160;name, avoiding multiple&#160;names.</i><br/>
Function&#160;createDrawPage(oDoc,&#160;sName$,&#160;bForceNew&#160;As&#160;boolean)&#160;As&#160;Variant<br/>&#160;&#160;Dim&#160;oPages&#160;'All of the draw pages<br/>&#160;&#160;Dim&#160;oPage&#160;&#160;'A single draw page<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160;'General index variable<br/>&#160;&#160;oPages&#160;=&#160;oDoc.getDrawPages()<br/>&#160;&#160;If&#160;oPages.hasByName(sName)&#160;Then<br/>&#160; &#160;&#160;REM If we require a new page then delete<br/>&#160; &#160;&#160;REM the page.<br/>&#160; &#160;&#160;If&#160;bForceNew&#160;Then<br/>&#160; &#160; &#160;&#160;oPages.remove(oPages.getByName(sName))<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;REM Did not request a new page so return the found page<br/>&#160; &#160; &#160;&#160;REM and then get out of the function.<br/>&#160; &#160; &#160;&#160;createDrawPage&#160;=&#160;oPages.getByName(sName)<br/>&#160; &#160; &#160;&#160;Exit&#160;Function<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;REM Did not find the page, or found the page and removed it.<br/>&#160;&#160;REM Create a new page, set the name, and return the page.<br/>&#160;&#160;oPages.insertNewByIndex(oPages.getCount())<br/>&#160;&#160;oPage&#160;=&#160;oPages.getByIndex(oPages.getCount()-1)<br/>&#160;&#160;oPage.setName(sName)<br/>&#160;&#160;createDrawPage&#160;=&#160;oPage<br/>End&#160;Function<br/>
<b>&#160;16.1.1.&#160;Generic&#160;draw&#160;page<br/></b>Both&#160;regular and master draw&#160;pages&#160;support&#160;the&#160;GenericDrawPage&#160;service.&#160;As&#160;its&#160;name&#160;implies,&#160;the&#160;&#160;<br/>GenericDrawPage&#160;service&#160;provides&#160;the&#160;primary&#160;generic&#160;drawing&#160;functionality.&#160;Writer and Calc&#160;documents&#160;<br/>
550<br/>
<hr/>
<a name=554></a>provide&#160;specific&#160;styles&#160;for formatting entire&#160;pages. Draw&#160;pages, however,&#160;use&#160;the&#160;properties&#160;shown in<a href="libremacros.html#554">&#160;Table&#160;<br/>224.</a><br/>
<i><b>Table&#160;224.</b>&#160;Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.drawing.GenericDrawPage&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BorderBottom<br/>
Bottom&#160;border&#160;in&#160;1/100&#160;mm,&#160;represented as a&#160;Long Integer.<br/>
BorderLeft<br/>
Left&#160;border&#160;in 1/100 mm,&#160;represented&#160;as a&#160;Long&#160;Integer.<br/>
BorderRight<br/>
Right&#160;border&#160;in 1/100 mm,&#160;represented&#160;as a&#160;Long&#160;Integer.<br/>
BorderTop<br/>
Top&#160;border&#160;in&#160;1/100&#160;mm,&#160;represented as a&#160;Long&#160;Integer.<br/>
Height<br/>
Height&#160;in&#160;1/100&#160;mm,&#160;represented as a&#160;Long&#160;Integer.<br/>
IsBackgroundDark<br/>
This is&#160;True&#160;if&#160;the&#160;averaged&#160;background fill&#160;color’s&#160;luminance&#160;is&#160;below&#160;a&#160;specified&#160;threshold&#160;<br/>value.<br/>
NavigationOrder<br/>
Provides index&#160;access in&#160;navigation order&#160;for&#160;the&#160;top&#160;level&#160;shapes inside&#160;the&#160;page. By&#160;default&#160;<br/>this&#160;is&#160;equal&#160;to the&#160;index access of&#160;the&#160;slide&#160;itself, making&#160;the&#160;z-order&#160;the&#160;default&#160;navigation&#160;<br/>
order&#160;for&#160;top&#160;level&#160;shapes.&#160;<br/>
Number&#160;<br/>
Draw&#160;page&#160;number&#160;as a&#160;Short&#160;Integer.&#160;This&#160;read-only&#160;value&#160;labels the&#160;first&#160;page&#160;1.<br/>
Orientation<br/>
Page&#160;orientation as a&#160;com.sun.star.view.PaperOrientation enumeration.&#160;Two&#160;values are&#160;<br/>supported—PORTRAIT&#160;and LANDSCAPE.<br/>
UserDefinedAttributes<br/>
User-defined&#160;XML&#160;attributes.<br/>
Width<br/>
Width in&#160;1/100&#160;mm,&#160;represented as a&#160;Long Integer.<br/>
The&#160;primary&#160;purpose&#160;of a&#160;draw&#160;page&#160;is&#160;to contain&#160;shapes.&#160;The&#160;methods&#160;addShape(Shape) and&#160;<br/>removeShape(Shape) add and remove&#160;a&#160;shape&#160;from&#160;a&#160;document. Before&#160;a&#160;shape&#160;can be&#160;added to a&#160;draw&#160;<br/>page, it&#160;must&#160;be&#160;created&#160;by&#160;the&#160;document. Each line&#160;produced by<a href="libremacros.html#554"><b>&#160;</b>Listing 486&#160;a</a>nd shown i<a href="libremacros.html#555">n&#160;Figure&#160;113&#160;i</a>s&#160;a&#160;<br/>separate, unrelated shape.&#160;You can independently&#160;manipulate&#160;each shapes.<br/>
<i><b>Listing&#160;486.</b>&#160;Draw 20 lines&#160;in&#160;a Draw or&#160;Impress&#160;document.<br/></i>Function&#160;draw20Lines()<br/>&#160;&#160;Dim&#160;oPage&#160;&#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;oPoint&#160;'Initial start point of the line<br/>&#160;&#160;Dim&#160;oSize&#160;&#160;'Width and height of the line<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160;'Index variable<br/>&#160;&#160;Dim&#160;n%&#160; &#160; &#160;'Number of iterations to perform<br/>&#160;&#160;Dim&#160;nShift%'Shift the graphic down<br/>&#160;&#160;Dim&#160;oDoc<br/>&#160;&#160;<br/>&#160;&#160;oDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>&#160;&#160;draw20Lines&#160;=&#160;oDoc<br/>&#160;&#160;oPage&#160;=&#160;createDrawPage(oDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160;&#160;nShift&#160;=&#160;oPage.Height&#160;/&#160;4<br/>&#160;&#160;<br/>&#160;&#160;n&#160;=&#160;20<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;n<br/>&#160; &#160;&#160;oShape&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.drawing.LineShape&#34;)<br/>&#160; &#160;&#160;oShape.LineColor&#160;=&#160;RGB(&#160;255,&#160;0,&#160;i+20&#160;)<br/>&#160; &#160;&#160;oShape.LineWidth&#160;=&#160;20<br/>&#160; &#160;&#160;oPoint&#160;=&#160;oShape.Position<br/>&#160; &#160;&#160;oPoint.X&#160;=&#160;oPage.Width&#160;/&#160;4<br/>
551<br/>
<hr/>
<a name=555></a>&#160; &#160;&#160;oPoint.Y&#160;=&#160;i&#160;*&#160;oPage.Height&#160;/&#160;n&#160;/&#160;4&#160;+&#160;nShift<br/>&#160; &#160;&#160;oShape.Position&#160;=&#160;oPoint<br/>&#160; &#160;&#160;oSize&#160;=&#160;oShape.Size<br/>&#160; &#160;&#160;oSize.Height&#160;=&#160;(oPage.Height&#160;-&#160;2&#160;*&#160;i&#160;*&#160;oPage.Height&#160;/&#160;n)&#160;/&#160;4<br/>&#160; &#160;&#160;oSize.Width&#160;=&#160;oPage.Width&#160;/&#160;2<br/>&#160; &#160;&#160;oShape.Size&#160;=&#160;oSize<br/>&#160; &#160;&#160;oPage.add(oShape)<br/>&#160;&#160;Next<br/>End&#160;Function<br/>
<i><b>Figure&#160;113.</b>&#160;Twenty&#160;lines&#160;in a Draw document.</i><br/>
The&#160;macro i<a href="libremacros.html#554">n&#160;Listing&#160;486&#160;w</a>orks&#160;with&#160;Draw&#160;and Impress.&#160;The&#160;20 red lines&#160;are&#160;drawn on a&#160;page&#160;named&#160;“Test&#160;<br/>Draw”. If&#160;the&#160;page&#160;does&#160;not&#160;exist,&#160;it&#160;is&#160;created.&#160;<br/>
<b>&#160;16.1.2.&#160;Combining&#160;shapes<br/></b>The&#160;macro i<a href="libremacros.html#554">n&#160;Listing&#160;486&#160;c</a>reates&#160;20 independent&#160;lines.&#160;You can group shapes&#160;together and then manipulate&#160;<br/>them&#160;as&#160;a&#160;single&#160;shape.&#160;The&#160;method&#160;group(XShapes) accepts&#160;a&#160;collection&#160;of shapes&#160;and turns&#160;them&#160;into a&#160;<br/>single&#160;group;&#160;an XShapeObject&#160;is&#160;returned.&#160;The&#160;macro i<a href="libremacros.html#555">n&#160;Listing&#160;487&#160;s</a>tarts&#160;by&#160;callin<a href="libremacros.html#554">g&#160;Listing&#160;486&#160;a</a>nd then it<br/>adds&#160;all&#160;of the&#160;lines&#160;to&#160;a&#160;single&#160;group.&#160;<br/>
<i><b>Listing&#160;487.</b>&#160;Group many&#160;shapes&#160;into&#160;a single&#160;shape.<br/></i>Sub&#160;groupShapes<br/>&#160;&#160;&#160; Dim&#160;oPage&#160; &#160;'Page on which to draw<br/>&#160; Dim&#160;oShapes&#160;'Shapes to group<br/>&#160; Dim&#160;i% &#160; &#160; &#160;'Index variable<br/>&#160; Dim&#160;oDoc<br/>&#160;&#160;<br/>&#160;&#160;REM Create the shapes!<br/>&#160;&#160;oDoc&#160;=&#160;draw20Lines()<br/>&#160;&#160;oPage&#160;=&#160;oDoc.getDrawPages().getByName(&#34;Test Draw&#34;)<br/>
&#160;&#160;REM Create a shape collection object to group the shapes<br/>&#160;&#160;oShapes&#160;= createUnoService(&#34;com.sun.star.drawing.ShapeCollection&#34;)<br/>&#160; For&#160;i&#160;=&#160;0&#160;To&#160;oPage.getCount() -&#160;1<br/>&#160; &#160;&#160;oShapes.add(oPage.getByIndex(i))<br/>
552<br/>
<hr/>
<a name=556></a>&#160; Next<br/>&#160;&#160;oPage.group(oShapes)<br/>End&#160;Sub<br/>
When&#160;several&#160;shapes&#160;are&#160;grouped together using the&#160;group() method,&#160;the&#160;entire&#160;group is&#160;added as&#160;a&#160;single&#160;<br/>shape&#160;into the&#160;draw&#160;page, which&#160;you&#160;can retrieve&#160;by&#160;using oPage.getByIndex(). It’s&#160;no longer possible&#160;to&#160;<br/>select&#160;a&#160;single&#160;line&#160;and independently&#160;manipulate&#160;it.&#160;To&#160;convert&#160;a&#160;group of shapes&#160;back to independent&#160;<br/>shapes, use&#160;the&#160;ungroup(XShapeObject) method.&#160;The&#160;ungroup() method removes&#160;the&#160;objects&#160;from&#160;the&#160;group&#160;<br/>and adds&#160;them&#160;back to the&#160;draw&#160;page&#160;as&#160;individual&#160;objects&#160;(see<a href="libremacros.html#556">&#160;Listing&#160;488).</a><br/>
<i><b>Listing&#160;488.</b>&#160;Convert&#160;a grouped shape&#160;back&#160;into multiple&#160;shapes.<br/></i>Sub&#160;unGroupShapes<br/>&#160;&#160;Dim&#160;oPage&#160; &#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160;&#160;'Single shape<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;<br/>&#160;&#160;oPage&#160;=&#160;ThisComponent.getDrawPages().getByName(&#34;Test Draw&#34;)<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oPage.getCount() -&#160;1<br/>&#160; &#160;&#160;oShape&#160;=&#160;oPage.getByIndex(i)<br/>&#160; &#160;&#160;If&#160;oShape.supportsService(&#34;com.sun.star.drawing.GroupShape&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;oPage.ungroup(oShape)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
Although shapes&#160;that&#160;are&#160;grouped together are&#160;manipulated as&#160;one&#160;shape, they&#160;are&#160;really&#160;a&#160;collection of&#160;<br/>shapes.&#160;The&#160;combine(XShapes) method,&#160;on the&#160;other hand, converts&#160;each shape&#160;into a&#160;PolyPolygonShape&#160;<br/>and then combines&#160;them&#160;into&#160;one&#160;PolyPolygonShape.&#160;The&#160;new&#160;shape&#160;is&#160;added to the&#160;draw&#160;page, and the&#160;<br/>original&#160;shapes&#160;are&#160;removed and deleted.&#160;The&#160;split(XShape) method&#160;converts&#160;the&#160;shape&#160;to&#160;a&#160;<br/>PolyPolygonShape&#160;(if it&#160;is&#160;not&#160;already)&#160;and then&#160;the&#160;shape&#160;is&#160;split&#160;into&#160;several&#160;shapes&#160;of type&#160;<br/>PolyPolygonShape.&#160;The&#160;new&#160;shapes&#160;are&#160;added to the&#160;draw&#160;page&#160;and the&#160;original&#160;shape&#160;is&#160;removed&#160;and&#160;<br/>deleted.<br/>
<i><b>Listing&#160;489.</b>&#160;Combine&#160;all&#160;shapes&#160;into&#160;a ShapeCollection.<br/></i>Sub&#160;combineShapes<br/>&#160; Dim&#160;oPage,&#160;oShapes,&#160;i%,&#160;oDoc<br/>&#160;&#160;<br/>&#160;&#160;REM Create the shapes!<br/>&#160;&#160;oDoc&#160;=&#160;draw20Lines()<br/>&#160;&#160;oPage&#160;=&#160;oDoc.getDrawPages().getByName(&#34;Test Draw&#34;)<br/>
&#160;&#160;oShapes&#160;= createUnoService(&#34;com.sun.star.drawing.ShapeCollection&#34;)<br/>&#160; For&#160;i&#160;=&#160;0&#160;To&#160;oPage.getCount() -&#160;1<br/>&#160; &#160;&#160;oShapes.add(oPage.getByIndex(i))<br/>&#160; Next<br/>&#160;&#160;oPage.combine(oShapes)<br/>End&#160;Sub<br/>
Combining a&#160;shape&#160;does&#160;not&#160;change&#160;how&#160;the&#160;shape&#160;appears&#160;so the&#160;output&#160;o<a href="libremacros.html#556">f&#160;Listing&#160;489&#160;i</a>s&#160;the&#160;same&#160;a<a href="libremacros.html#554">s<br/>Listing 486. Bi</a>nding a&#160;shape, as&#160;shown in<a href="libremacros.html#556">&#160;Listing 490, ho</a>wever,&#160;connects&#160;the&#160;lines&#160;together with a&#160;Bezier&#160;<br/>curve.<br/>
<i><b>Listing&#160;490.</b>&#160;Bind&#160;shapes&#160;together.<br/></i>Sub&#160;bindShapes()<br/>
553<br/>
<hr/>
<a name=557></a>&#160;&#160;Dim&#160;oPage,&#160;oShapes,&#160;i%<br/>&#160;&#160;<br/>&#160;&#160;REM Create the shapes!<br/>&#160;&#160;draw20Lines()<br/>&#160;&#160;oPage&#160;=&#160;ThisComponent.getDrawPages().getByName(&#34;Test Draw&#34;)<br/>
&#160;&#160;oShapes&#160;=&#160;createUnoService(&#34;com.sun.star.drawing.ShapeCollection&#34;)<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oPage.getCount()-1<br/>&#160; &#160;&#160;oShapes.add(oPage.getByIndex(i))<br/>&#160;&#160;Next<br/>&#160;&#160;oPage.bind(oShapes)<br/>End&#160;Sub<br/>
<i><b>Figure&#160;114.</b>&#160;Using bind&#160;connects&#160;the&#160;lines&#160;with Bezier&#160;curves.</i><br/>
The&#160;unbind(XShape) method&#160;converts&#160;the&#160;shape&#160;to&#160;a&#160;PolyPolygonShape&#160;(if it&#160;is&#160;not&#160;already)&#160;and then each&#160;<br/>line&#160;segment&#160;is&#160;converted to&#160;a&#160;new&#160;PolyPolygonShape.&#160;The&#160;original&#160;shape&#160;is&#160;removed from&#160;the&#160;draw&#160;page&#160;<br/>and deleted.&#160;The&#160;shape&#160;produced by<a href="libremacros.html#556">&#160;Listing 490, c</a>ombines&#160;21 lines&#160;into a&#160;one&#160;shape. Using unbind&#160;on the&#160;<br/>single&#160;shape&#160;does&#160;not&#160;change&#160;what&#160;the&#160;user sees, but&#160;each line&#160;is&#160;now&#160;its&#160;own shape, so there&#160;are&#160;41 shapes&#160;<br/>rather than&#160;just&#160;one;&#160;the&#160;original&#160;21 shapes&#160;and 20 lines&#160;connecting the&#160;original&#160;21.<br/>
<i><b>&#160;16.2.&#160;Shapes<br/></b></i>Graphical&#160;content&#160;is&#160;expressed as&#160;a&#160;shape&#160;object.&#160;Shape&#160;objects&#160;are&#160;created by&#160;the&#160;document&#160;and then&#160;added&#160;<br/>to the&#160;draw&#160;page.&#160;To&#160;quickly&#160;find out&#160;what&#160;objects&#160;a&#160;document&#160;can create, use&#160;the&#160;TypesDocCanCreate&#160;<br/>macro i<a href="libremacros.html#238">n&#160;Listing&#160;214&#160;w</a>ith&#160;a&#160;Draw&#160;document&#160;to see&#160;the&#160;objects&#160;that&#160;a&#160;Draw&#160;document&#160;can create. Filter the&#160;<br/>list&#160;a&#160;little&#160;more&#160;if you only&#160;want&#160;to&#160;see&#160;the&#160;shape&#160;types.<br/>
<i><b>Listing&#160;491.</b>&#160;Shape&#160;services&#160;supported&#160;by&#160;Draw.<br/></i>Sub&#160;SupportedDrawDocShapes<br/>&#160; Dim&#160;oDrawDoc<br/>&#160;&#160;' Create a temporary draw document.<br/>&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>&#160;&#160;' Generate the list<br/>
554<br/>
<hr/>
<a name=558></a>&#160;&#160;TypesDocCanCreate(oDrawDoc,&#160;&#34;shape&#34;)<br/>&#160;&#160;' Close the temporary draw document.<br/>&#160;&#160;oDrawDoc.Close(true)<br/>End Sub<br/>
Use&#160;the&#160;same&#160;method to&#160;find shapes&#160;supported by&#160;Impress.<br/>
<i><b>Listing&#160;492.</b>&#160;Shape&#160;services&#160;supported&#160;by&#160;Impress.</i><br/>
Sub&#160;SupportedImpressDocShapes<br/>&#160;&#160;Dim&#160;oDoc<br/>&#160;&#160;' Create a temporary Impress document.<br/>&#160;&#160;oDoc&#160;=&#160;LoadEmptyDocument(&#34;simpress&#34;)<br/>&#160;&#160;' Generate the list<br/>&#160;&#160;TypesDocCanCreate(oDoc,&#160;&#34;shape&#34;)<br/>&#160;&#160;' Close the temporary Impress document.<br/>&#160;&#160;oDoc.Close(true)<br/>End&#160;Sub&#160;<br/>
The&#160;general&#160;drawing&#160;shapes&#160;are&#160;shown in<a href="libremacros.html#558">&#160;Table&#160;225.&#160;</a>The&#160;shapes&#160;specific&#160;to a&#160;presentation&#160;document&#160;are&#160;<br/>shown in<a href="libremacros.html#560">&#160;Table&#160;226. M</a>any&#160;of the&#160;shapes&#160;are&#160;either not&#160;published, or not&#160;documented.&#160;If&#160;a&#160;service&#160;or interface<br/>is&#160;not&#160;“published”, the&#160;developers&#160;expect&#160;the&#160;service&#160;or interface&#160;to&#160;change&#160;in&#160;the&#160;future, be&#160;removed, or to&#160;<br/>be&#160;unsuitable&#160;for public&#160;use&#160;for some&#160;reason.If a&#160;service&#160;is&#160;not&#160;documented,&#160;then no documentation&#160;is&#160;easily&#160;<br/>available,&#160;so it&#160;is&#160;probably&#160;not&#160;published. Use&#160;objects&#160;that&#160;are&#160;not&#160;documented or published at&#160;your own risk,<br/>they&#160;may&#160;change&#160;in the&#160;future. Sadly,&#160;even the&#160;documented&#160;shapes&#160;may&#160;not&#160;be&#160;well&#160;documented.&#160;<br/>
<b>Tip</b><br/>
If&#160;a&#160;service&#160;or&#160;interface&#160;is&#160;not&#160;“published”, the&#160;developers expect&#160;the&#160;service&#160;or&#160;interface&#160;to change&#160;in the&#160;<br/>future,&#160;be&#160;removed,&#160;or&#160;to be&#160;unsuitable&#160;for&#160;public&#160;use&#160;for&#160;some&#160;reason.<br/>
Some&#160;shape&#160;types&#160;are&#160;not&#160;created&#160;directly&#160;by&#160;the&#160;document;&#160;for example&#160;the&#160;PolyPolygonBezierShape.&#160;<br/>Sadly,&#160;these&#160;types&#160;are&#160;also&#160;poorly&#160;documented.&#160;Some&#160;of the&#160;types&#160;may&#160;be&#160;created indirectly.&#160;As&#160;a&#160;test, I&#160;used&#160;<br/>an Impress&#160;document&#160;to&#160;create&#160;an instance&#160;of CalcShape, but&#160;the&#160;returned object&#160;did not&#160;support&#160;the&#160;<br/>CalcShape&#160;service.&#160;Inserting the&#160;created&#160;service&#160;in&#160;the&#160;Impress&#160;document&#160;caused the&#160;shape&#160;to become&#160;an&#160;<br/>OLE2Shape&#160;service&#160;– and it&#160;still&#160;did not&#160;support&#160;the&#160;CalcShape&#160;service.&#160;<br/>
<i><b>Table&#160;225.</b>&#160;Draw&#160;shapes&#160;(com.sun.star.drawing).</i><br/>
<i><b>Shape&#160;Type</b></i><br/>
<i><b>Description</b></i><br/>
AppletShape<br/>
Encapsulate&#160;a&#160;Java&#160;Applet.<br/>
CaptionShape<br/>
Rectangular&#160;drawing&#160;shape&#160;with&#160;an additional&#160;set&#160;of&#160;lines. It&#160;can be&#160;used as a&#160;<br/>description for&#160;a&#160;fixed point&#160;inside&#160;a&#160;drawing.&#160;<br/>
ClosedBezierShape<br/>
A&#160;series&#160;of&#160;Bezier&#160;shapes that&#160;are&#160;closed.<br/>
ClosedFreeHandShape<br/>
Closed&#160;Freehand shape&#160;drawn&#160;using&#160;the&#160;GUI.<br/>
ConnectorShape<br/>
Used&#160;to connect&#160;shapes&#160;or&#160;glue&#160;points.<br/>
ControlShape<br/>
A&#160;shape&#160;that&#160;displays&#160;a&#160;control&#160;such as a&#160;button.<br/>
CustomShape<br/>
Create&#160;a&#160;custom&#160;shape;&#160;but&#160;it&#160;is&#160;not&#160;published.<br/>
EllipseShape<br/>
Draw&#160;a&#160;circle,&#160;an ellipse,&#160;or&#160;an arc.<br/>
FrameShape<br/>
Undocumented, but&#160;seems&#160;to be&#160;used&#160;by&#160;other&#160;things as a&#160;frame.<br/>
GraphicObjectShape<br/>
Display&#160;a&#160;graphic&#160;object&#160;such&#160;as&#160;a&#160;bitmap image.&#160;There&#160;are&#160;separate&#160;types for&#160;<br/>
presentation documents and drawing&#160;documents.<br/>
GroupShape<br/>
Represent&#160;multiple&#160;shapes as a&#160;single&#160;shape.<br/>
555<br/>
<hr/>
<a name=559></a><i><b>Shape&#160;Type</b></i><br/>
<i><b>Description</b></i><br/>
LineShape<br/>
A&#160;single&#160;line.<br/>
MeasureShape<br/>
A&#160;shape&#160;used for&#160;measuring&#160;in&#160;a&#160;diagram.<br/>
MediaShape<br/>
Undocumented.<br/>
OLE2Shape<br/>
Display&#160;an OLE&#160;object&#160;in a&#160;Draw&#160;document.<br/>
OpenBezierShape<br/>
A&#160;series&#160;of&#160;Bezier&#160;lines.<br/>
OpenFreeHandShape<br/>
Open Freehand&#160;shape&#160;drawn&#160;using&#160;the&#160;GUI.<br/>
PageShape<br/>
Display&#160;a&#160;preview&#160;of&#160;another&#160;page&#160;in a&#160;Draw&#160;document.<br/>
PluginShape<br/>
Represent&#160;a&#160;media&#160;type&#160;that&#160;is&#160;not&#160;directly&#160;supported.<br/>
PolyLinePathShape<br/>
Undocumented.<br/>
PolyLineShape<br/>
A&#160;series&#160;of&#160;connected&#160;straight&#160;lines.<br/>
PolyPolygonBezierShape<br/>
Undocumented.<br/>
PolyPolygonPathShape<br/>
Undocumented.<br/>
PolyPolygonShape<br/>
A&#160;series&#160;of&#160;straight&#160;lines with the&#160;first&#160;and last&#160;points connected.<br/>
RectangleShape<br/>
Draw&#160;rectangles.<br/>
Shape3DCubeObject<br/>
Undocumented.<br/>
Shape3DExtrudeObject<br/>
Undocumented.<br/>
Shape3DLatheObject<br/>
Undocumented.<br/>
Shape3DPolygonObject<br/>
Undocumented.<br/>
Shape3DSceneObject<br/>
Undocumented.<br/>
Shape3DSphereObject<br/>
Undocumented.<br/>
TableShape<br/>
Table&#160;object&#160;in a&#160;Draw&#160;document.<br/>
TextShape<br/>
Box&#160;designed&#160;to hold&#160;text.<br/>
556<br/>
<hr/>
<a name=560></a><i><b>Table&#160;226.</b>&#160;Impress&#160;shapes&#160;(com.sun.star.presentation).</i><br/>
<i><b>Shape&#160;Type</b></i><br/>
<i><b>Description</b></i><br/>
CalcShape<br/>
Calc&#160;sheet&#160;in&#160;an Impress document.<br/>
ChartShape<br/>
Chart&#160;shape&#160;in an&#160;Impress document.<br/>
DateTimeShape<br/>
Not&#160;published.<br/>
FooterShape<br/>
Not&#160;published.<br/>
GraphicObjectShape<br/>
Display&#160;a&#160;graphic&#160;object&#160;such&#160;as&#160;a&#160;bitmap image&#160;in an&#160;Impress document.<br/>
HandoutShape<br/>
A&#160;drawing&#160;document&#160;PageShape&#160;for&#160;handouts in an Impress document.<br/>
HeaderShape<br/>
Not&#160;published.<br/>
MediaShape<br/>
Undocumented.<br/>
NotesShape<br/>
A&#160;TextShape&#160;for&#160;notes in&#160;an Impress document.<br/>
OLE2Shape<br/>
Display&#160;an OLE&#160;object&#160;in an&#160;Impress document.<br/>
OrgChartShape<br/>
Not&#160;documented.<br/>
OutlinerShape<br/>
A&#160;TextShape&#160;for&#160;outlines in an&#160;Impress document.<br/>
PageShape<br/>
Display&#160;a&#160;preview&#160;of&#160;another&#160;page&#160;in an Impress document.<br/>
SlideNumberShape<br/>
Not&#160;published.<br/>
SubtitleShape<br/>
A&#160;TextShape&#160;for&#160;subtitles&#160;in&#160;an Impress document.<br/>
TableShape<br/>
Table&#160;object&#160;in an Impress&#160;document.<br/>
TitleTextShape<br/>
A&#160;TextShape&#160;for&#160;titles&#160;in&#160;an Impress document.<br/>
<b>&#160;16.2.1.&#160;Common&#160;attributes<br/></b>A&#160;shape’s&#160;position is&#160;stored in&#160;a&#160;com.sun.star.awt.Point&#160;structure, which contains&#160;two Long Integer values, X<br/>and&#160;Y,&#160;representing the&#160;upper-left&#160;corner in&#160;1/100 mm.&#160;A&#160;shape’s&#160;size&#160;is&#160;stored in a&#160;com.sun.star.awt.Size&#160;<br/>structure, which contains&#160;two Long Integer values,&#160;Width and Height, in&#160;1/100&#160;mm.<br/>
<i><b>Table&#160;227.</b>&#160;Methods&#160;supported by&#160;Shape&#160;objects.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getPosition()<br/>
Get&#160;the&#160;shape’s&#160;current&#160;position in&#160;1/100&#160;mm.<br/>
setPosition(Point)<br/>
Set&#160;the&#160;shape’s&#160;current&#160;position&#160;in&#160;1/100&#160;mm.<br/>
getSize()<br/>
Get&#160;the&#160;shape’s&#160;current&#160;size&#160;in&#160;1/100&#160;mm.<br/>
setSize(Size)<br/>
Set&#160;the&#160;shape’s&#160;current&#160;size&#160;in 1/100 mm.<br/>
getGluePoints()<br/>
Get&#160;an object&#160;that&#160;provides indexed&#160;access to&#160;a&#160;set&#160;of&#160;glue&#160;points used&#160;internally&#160;by&#160;the&#160;object.&#160;<br/>
Each&#160;glue&#160;point&#160;is a&#160;com.sun.star.drawing.GluePoint2 structure&#160;(see<a href="libremacros.html#584">&#160;Table&#160;241)</a>.<br/>
getShapeType()<br/>
String&#160;representing&#160;the&#160;shape’s&#160;type.<br/>
Macros&#160;that&#160;deal&#160;with shape&#160;objects&#160;frequently&#160;require&#160;the&#160;Size&#160;and Point&#160;structures.&#160;The&#160;two methods&#160;i<a href="libremacros.html#560">n<br/>Listing 493&#160;m</a>ake&#160;it&#160;easier to create&#160;and set&#160;these&#160;structures.<br/>
<i><b>Listing&#160;493.</b>&#160;Create&#160;and return a Point&#160;or&#160;Size&#160;structure.<br/></i>Function&#160;CreatePoint(ByVal&#160;x&#160;As&#160;Long,ByVal&#160;y&#160;As&#160;Long)&#160;As&#160;com.sun.star.awt.Point<br/>&#160;&#160;Dim&#160;oPoint<br/>&#160;&#160;oPoint&#160;=&#160;createUnoStruct(&#160;&#34;com.sun.star.awt.Point&#34;&#160;)<br/>
557<br/>
<hr/>
<a name=561></a>&#160;&#160;oPoint.X&#160;=&#160;x&#160;:&#160;oPoint.Y&#160;=&#160;y<br/>&#160;&#160;CreatePoint&#160;=&#160;oPoint<br/>End&#160;Function<br/>
Function&#160;CreateSize(ByVal&#160;x&#160;As&#160;Long,ByVal&#160;y&#160;As&#160;Long)&#160;As&#160;com.sun.star.awt.Size<br/>&#160;&#160;Dim&#160;oSize<br/>&#160;&#160;oSize&#160;=&#160;createUnoStruct(&#160;&#34;com.sun.star.awt.Size&#34;&#160;)<br/>&#160;&#160;oSize.Width&#160;=&#160;x&#160;:&#160;oSize.Height&#160;=&#160;y<br/>&#160;&#160;CreateSize&#160;=&#160;oSize<br/>End&#160;Function<br/>
Interfaces&#160;define&#160;methods&#160;and they&#160;may&#160;be&#160;derived from&#160;other interfaces. Services, on the&#160;other hand,&#160;<br/>implement&#160;interfaces&#160;and other services. Services&#160;also&#160;define&#160;properties. Some&#160;services&#160;are&#160;defined strictly&#160;<br/>to define&#160;a&#160;group of related properties. &#160;The&#160;properties&#160;defined by&#160;the&#160;Shape&#160;service&#160;are&#160;general&#160;and&#160;<br/>applicable&#160;to most&#160;shape&#160;types&#160;(see<a href="libremacros.html#561">&#160;Table&#160;228).&#160;</a><br/>
<i><b>Table&#160;228.</b>&#160;Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.drawing.Shape&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
ZOrder<br/>
Long Integer&#160;representing&#160;the&#160;ZOrder&#160;of&#160;this shape.&#160;This controls the&#160;drawing&#160;order&#160;of&#160;objects,&#160;<br/>effectively&#160;moving&#160;an object&#160;forward&#160;or&#160;backward.<br/>
LayerID<br/>
Short&#160;Integer&#160;identifying&#160;the&#160;layer&#160;that&#160;contains&#160;the&#160;shape.<br/>
LayerName<br/>
Name&#160;of&#160;the&#160;layer&#160;that&#160;contains&#160;the&#160;shape.<br/>
Printable<br/>
If&#160;True,&#160;the&#160;shape&#160;is&#160;included&#160;in printed output.<br/>
MoveProtect<br/>
If&#160;True,&#160;the&#160;shape&#160;cannot&#160;be&#160;moved&#160;interactively&#160;by&#160;the&#160;user.<br/>
Name<br/>
Shape&#160;name&#160;as a&#160;String.<br/>
SizeProtect<br/>
If&#160;True,&#160;the&#160;user&#160;may&#160;not&#160;change&#160;the&#160;shape’s&#160;size.<br/>
Style<br/>
Shape’s&#160;style&#160;as a&#160;com.sun.star.style.XStyle&#160;object.<br/>
Transformation<br/>
Transformation matrix&#160;of&#160;type&#160;com.sun.star.drawing.HomogenMatrix3 that&#160;can contain&#160;<br/>
translation, rotation, shearing,&#160;and&#160;scaling.<br/>
OOo defines&#160;separate&#160;services&#160;that&#160;encapsulate&#160;properties&#160;and methods&#160;specific&#160;to&#160;lines, text,&#160;shadows, shape<br/>rotation,&#160;and filling area. Not&#160;all&#160;shape&#160;types&#160;support&#160;all&#160;of these&#160;services. For example,&#160;it&#160;makes&#160;no sense&#160;<br/>for a&#160;line&#160;shape&#160;to&#160;support&#160;the&#160;properties&#160;and methods&#160;related&#160;to filling areas. &#160;The&#160;services&#160;of interest&#160;for the<br/>common&#160;properties:<br/>
•<br/>
com.sun.star.drawing.Text<br/>
•<br/>
com.sun.star.drawing.LineProperties<br/>
•<br/>
com.sun.star.drawing.FillProperties<br/>
•<br/>
com.sun.star.drawing.ShadowProperties<br/>
•<br/>
com.sun.star.drawing.RotationDescriptor<br/>
I&#160;used a&#160;macro to&#160;quickly&#160;determine&#160;which&#160;shapes&#160;support&#160;which&#160;common&#160;service. First,&#160;a&#160;list&#160;of services&#160;<br/>where&#160;the&#160;service&#160;name&#160;contains&#160;the&#160;word shape;&#160;for example, “com.sun.star.presentation.TableShape”.&#160;<br/>
<i><b>Listing&#160;494.</b>&#160;Return a filtered list&#160;of&#160;services&#160;supported&#160;by&#160;an object.</i><br/>
Function&#160;GetListCanCreate(oObj,&#160;nameFilter$)<br/>&#160;&#160;Dim&#160;allNames&#160; &#160;' List of all the names.<br/>
558<br/>
<hr/>
<a name=562></a>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;<br/>&#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160;&#160;allNames&#160;=&#160;oObj.getAvailableServiceNames()<br/>
&#160;&#160;For&#160;i&#160;=&#160;LBound(allNames)&#160;To&#160;UBound(allNames)<br/>&#160; &#160;&#160;If&#160;(InStr(allNames(i),&#160;nameFilter)&#160;&gt;&#160;0)&#160;Then<br/>&#160; &#160; &#160;&#160;If&#160;Len(s)&#160;&gt;&#160;0&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;,&#34;&#160;&amp;&#160;allNames(i)<br/>&#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;allNames(i)<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;GetListCanCreate&#160;=&#160;Split(s,&#160;&#34;,&#34;)<br/>End&#160;Function<br/>
The&#160;following&#160;macro creates&#160;an Impress&#160;document.&#160;The&#160;impress&#160;document&#160;is&#160;asked which services&#160;it&#160;can&#160;<br/>create&#160;that&#160;contain&#160;the&#160;word “Shape”. Each shape&#160;is&#160;then&#160;inspected to&#160;see&#160;if it&#160;supports&#160;the&#160;categories&#160;of&#160;<br/>interest.&#160;Sadly,&#160;none&#160;of the&#160;categories&#160;of interest&#160;are&#160;supported by&#160;the&#160;shape&#160;until&#160;after the&#160;shape&#160;is&#160;inserted&#160;<br/>into&#160;the&#160;document. Each shape, therefore, is&#160;added to&#160;the&#160;Impress&#160;document,&#160;inspected to&#160;see&#160;what&#160;services&#160;it<br/>supports,&#160;and then&#160;that&#160;shape&#160;is&#160;disposed.<br/>
<b>TIP</b><br/>
When&#160;a&#160;shape&#160;is&#160;created,&#160;it&#160;is&#160;not&#160;fully&#160;fleshed&#160;out&#160;and&#160;available&#160;until&#160;after&#160;it&#160;has been inserted&#160;into a&#160;<br/>
document.<br/>
<i><b>Listing&#160;495.</b>&#160;Categorize&#160;shape&#160;types.</i><br/>
Sub&#160;CategorizeShapeTypes<br/>&#160;&#160;Dim&#160;oSize&#160;as&#160;New&#160;com.sun.star.awt.Size<br/>&#160;&#160;Dim&#160;oPos&#160;as&#160;New&#160;com.sun.star.awt.Point<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;Categories&#160;' Service names of interest<br/>&#160;&#160;Dim&#160;iRow%&#160; &#160; &#160;&#160;' Iterate over data rows.<br/>&#160;&#160;DIm&#160;iName%&#160; &#160; &#160;' Iterate over supported service names.<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;oShape&#160; &#160; &#160;' Created shapes.<br/>&#160;&#160;Dim&#160;oPage&#160; &#160; &#160;&#160;' Draw page where shapes are inserted.<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;oCalc&#160; &#160; &#160;&#160;' Calc document to hold results.<br/>&#160;&#160;Dim&#160;oImpress&#160; &#160;' Impress document on which to test.<br/>&#160;&#160;Dim&#160;oData&#160; &#160; &#160;&#160;' Holds temporary Cell data.<br/>&#160;&#160;Dim&#160;oCellRange&#160;' Range to hold the results in Calc.<br/>&#160;&#160;Dim&#160;shapeNames&#160;' List of supported shape names.<br/>&#160;&#160;Dim&#160;oSheet&#160; &#160; &#160;' Calc sheet containing results.<br/>&#160;&#160;Dim&#160;oRow&#160; &#160; &#160; &#160;' One row from the oData array.<br/>&#160;&#160;<br/>&#160;&#160;REM Load an Impress document and a Calc document.<br/>&#160;&#160;oImpress&#160;=&#160;LoadEmptyDocument(&#34;simpress&#34;)<br/>&#160;&#160;oCalc&#160;=&#160;LoadEmptyDocument(&#34;scalc&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Get the list of supported shape names.<br/>&#160;&#160;shapeNames&#160;=&#160;GetListCanCreate(oImpress,&#160;&#34;shape&#34;)<br/>
559<br/>
<hr/>
<a name=563></a>&#160;&#160;Rem Make each shape the same size and position. &#160;<br/>&#160;&#160;oSize.Width&#160;=&#160;6000<br/>&#160;&#160;oSize.Height&#160;=&#160;6100<br/>&#160;&#160;oPos.X&#160;=&#160;6000<br/>&#160;&#160;oPos.Y&#160;=&#160;5000<br/>&#160;&#160;<br/>&#160;&#160;REM First draw page to contain the created shapes.<br/>&#160;&#160;oPage&#160;=&#160;oImpress.DrawPages.getByIndex(0)<br/>&#160;&#160;<br/>&#160;&#160;REM Categories of inerest.<br/>&#160;&#160;Categories&#160;=&#160;Array(&#34;com.sun.star.drawing.Text&#34;,&#160;_<br/>&#160; &#160; &#160;&#34;com.sun.star.drawing.LineProperties&#34;,&#160;_<br/>&#160; &#160; &#160;&#34;com.sun.star.drawing.FillProperties&#34;,&#160;_<br/>&#160; &#160; &#160;&#34;com.sun.star.drawing.ShadowProperties&#34;,&#160;_<br/>&#160; &#160; &#160;&#34;com.sun.star.drawing.RotationDescriptor&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Get the cell range that will hold the results.<br/>&#160;&#160;oSheet&#160;=&#160;oCalc.getSheets().getByIndex(0)<br/>&#160;&#160;oCellRange&#160;=&#160;oSheet.getCellRangeByPosition(0,&#160;0,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;UBound(Categories)&#160;-&#160;LBound(Categories)&#160;+&#160;1,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;UBound(shapeNames)&#160;-&#160;LBound(shapeNames)&#160;+&#160;1)<br/>&#160;&#160;<br/>&#160;&#160;oData&#160;=&#160;oCellRange.getDataArray()<br/>
&#160;&#160;REM Set the row title<br/>&#160;&#160;oRow&#160;=&#160;oData(0)<br/>&#160;&#160;For&#160;iRow&#160;=&#160;1&#160;To&#160;UBound(oRow)<br/>&#160; &#160;&#160;oRow(iRow)&#160;=&#160;Categories(iRow&#160;-&#160;1)<br/>&#160;&#160;Next&#160;<br/>&#160;&#160;<br/>&#160;&#160;REM For each shape name<br/>&#160;&#160;For&#160;iName&#160;=&#160;0&#160;To&#160;UBound(shapeNames)<br/>&#160; &#160;&#160;REM Get the row for this shape name<br/>&#160; &#160;&#160;oRow&#160;=&#160;oData(iName&#160;+&#160;1)<br/>&#160; &#160;&#160;oRow(0)&#160;=&#160;shapeNames(iName)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Create the shape, add it to the draw page.<br/>&#160; &#160;&#160;oShape&#160;=&#160;oImpress.CreateInstance(shapeNames(iName))<br/>&#160; &#160;&#160;oPage.Add(oShape)<br/>&#160; &#160;&#160;oShape.setSize(oSize)<br/>&#160; &#160;&#160;oShape.setPosition(oPos)<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Find out which services are supported by the current shape.<br/>&#160; &#160;&#160;For&#160;iRow&#160;=&#160;LBound(Categories)&#160;To&#160;UBound(Categories)<br/>&#160; &#160; &#160;&#160;If&#160;oShape.supportsService(Categories(iRow))&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;oRow(iRow&#160;+&#160;1)&#160;=&#160;&#34;X&#34;<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Next<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;REM Get rid of the created shape.<br/>&#160; &#160;&#160;oShape.dispose()<br/>&#160;&#160;Next<br/>
560<br/>
<hr/>
<a name=564></a>&#160;&#160;<br/>&#160;&#160;REM Set the results in the Calc document.<br/>&#160;&#160;oCellRange.setDataArray(oData)<br/>End&#160;Sub<br/>
The&#160;Calc&#160;document&#160;created&#160;by<a href="libremacros.html#562">&#160;Listing 495&#160;i</a>s&#160;not&#160;sorted,&#160;and the&#160;full&#160;service&#160;names&#160;are&#160;used.&#160;The&#160;data&#160;is&#160;<br/>summarized&#160;here&#160;in two tables. ,&#160;The&#160;com.sun.star.drawing shapes&#160;are&#160;shown in<a href="libremacros.html#565">&#160;Table&#160;229, a</a>nd the&#160;<br/>com.sun.star.presentation shapes&#160;are&#160;i<a href="libremacros.html#566">n&#160;Table&#160;230.</a><br/>
561<br/>
<hr/>
<a name=565></a><i><b>Table&#160;229.</b>&#160;Which Drawing shapes&#160;support&#160;which service.</i><br/>
<i><b>Shape</b></i><br/>
<i><b>Text</b></i><br/>
<i><b>Line</b></i><br/>
<i><b>Fill</b></i><br/>
<i><b>Shadow</b></i><br/>
<i><b>Rotation</b></i><br/>
<i><b>Properties</b></i><br/>
<i><b>Properties</b></i><br/>
<i><b>Properties</b></i><br/>
<i><b>Descriptor</b></i><br/>
AppletShape<br/>CaptionShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
ClosedBezierShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
ClosedFreeHandShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
ConnectorShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
ControlShape<br/>CustomShape<br/>
X<br/>
X<br/>
X<br/>
EllipseShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
FrameShape<br/>GraphicObjectShape<br/>
X<br/>
X<br/>
X<br/>
GroupShape<br/>LineShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
MeasureShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
MediaShape<br/>OLE2Shape<br/>OpenBezierShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
OpenFreeHandShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
PageShape<br/>PluginShape<br/>PolyLinePathShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
PolyLineShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
PolyPolygonPathShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
PolyPolygonShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
RectangleShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
Shape3DCubeObject<br/>Shape3DExtrudeObject<br/>Shape3DLatheObject<br/>Shape3DPolygonObject<br/>Shape3DSceneObject<br/>Shape3DSphereObject<br/>TableShape<br/>TextShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
562<br/>
<hr/>
<a name=566></a><i><b>Table&#160;230.</b>&#160;Which Impress&#160;shapes&#160;support&#160;which&#160;service.</i><br/>
<i><b>Shape</b></i><br/>
<i><b>Text</b></i><br/>
<i><b>Line</b></i><br/>
<i><b>Fill</b></i><br/>
<i><b>Shadow</b></i><br/>
<i><b>Rotation</b></i><br/>
<i><b>Properties</b></i><br/>
<i><b>Properties</b></i><br/>
<i><b>Properties</b></i><br/>
<i><b>Descriptor</b></i><br/>
CalcShape<br/>ChartShape<br/>DateTimeShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
FooterShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
GraphicObjectShape<br/>
X<br/>
X<br/>
X<br/>
HandoutShape<br/>HeaderShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
MediaShape<br/>NotesShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
OLE2Shape<br/>OrgChartShape<br/>OutlinerShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
PageShape<br/>SlideNumberShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
SubtitleShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
TableShape<br/>TitleTextShape<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
<i><b>Drawing&#160;text&#160;service<br/></b></i>Any&#160;shape&#160;that&#160;supports&#160;the&#160;com.sun.star.drawing.Text&#160;service&#160;has&#160;the&#160;ability&#160;to&#160;contain&#160;text.&#160;The&#160;drawing&#160;<br/>text&#160;service&#160;supports&#160;the&#160;standard com.sun.star.text.XText&#160;interface&#160;and a&#160;special&#160;set&#160;of drawing&#160;text&#160;<br/>properties.&#160;Besides&#160;character and paragraph properties, the&#160;drawing text&#160;properties&#160;service&#160;defines&#160;properties<br/>specifically&#160;designed for shape&#160;objects&#160;(see<a href="libremacros.html#566">&#160;Table&#160;231).</a><br/>
<i><b>Table&#160;231.</b>&#160;Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.drawing.TextProperties&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
IsNumbering<br/>
If&#160;True,&#160;numbering&#160;is ON&#160;for&#160;the&#160;text&#160;in this shape.<br/>
NumberingRules<br/>
Describes&#160;the&#160;numbering&#160;levels as a&#160;sequence&#160;of&#160;com.sun.star.style.NumberingRule.<br/>
TextAnimationAmount<br/>
Number&#160;of&#160;pixels the&#160;text&#160;is&#160;moved&#160;in each animation&#160;step.<br/>
TextAnimationCount<br/>
Number&#160;of&#160;times the&#160;text&#160;animation&#160;is repeated.<br/>
TextAnimationDelay<br/>
Delay,&#160;in&#160;thousandths&#160;of&#160;a&#160;second,&#160;between each&#160;animation step.<br/>
TextAnimationDirection<br/>
Enumerated&#160;value&#160;of&#160;type&#160;com.sun.star.drawing.TextAnimationDirection:&#160;LEFT,&#160;RIGHT,&#160;<br/>
UP,&#160;and&#160;DOWN.<br/>
563<br/>
<hr/>
<a name=567></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
TextAnimationKind<br/>
Enumerated&#160;value&#160;of&#160;type&#160;com.sun.star.drawing.TextAnimationKind:<br/>•<br/>
NONE&#160;– No&#160;animation.<br/>
•<br/>
BLINK&#160;–&#160;Continuously&#160;switch the&#160;text&#160;between visible&#160;and&#160;invisible.<br/>
•<br/>
SCROLL&#160;– Scroll&#160;the&#160;text.<br/>
•<br/>
ALTERNATE&#160;– Scroll&#160;the&#160;text&#160;from&#160;one&#160;side&#160;to the&#160;other&#160;and back.<br/>
•<br/>
SLIDE –&#160;Scroll&#160;the&#160;text&#160;from&#160;one&#160;side&#160;to the&#160;final&#160;position&#160;and&#160;stop.<br/>
TextAnimationStartInside<br/>
If&#160;True,&#160;the&#160;text&#160;is&#160;visible&#160;at&#160;the&#160;start&#160;of&#160;the&#160;animation.<br/>
TextAnimationStopInside<br/>
If&#160;True,&#160;the&#160;text&#160;is&#160;visible&#160;at&#160;the&#160;end&#160;of&#160;the&#160;animation.<br/>
TextAutoGrowHeight<br/>
If&#160;True,&#160;the&#160;shape&#160;height&#160;changes automatically&#160;when text&#160;is added&#160;or&#160;removed.<br/>
TextAutoGrowWidth<br/>
If&#160;True,&#160;the&#160;shape&#160;width changes automatically&#160;when text&#160;is added or&#160;removed.<br/>
TextContourFrame<br/>
If&#160;True,&#160;the&#160;text&#160;is&#160;aligned&#160;with the&#160;left&#160;edge&#160;of&#160;the&#160;shape.<br/>
TextFitToSize<br/>
Enumerated&#160;value&#160;of&#160;type&#160;com.sun.star.drawing.TextFitToSizeType:<br/>•<br/>
NONE&#160;–&#160;The&#160;text&#160;size&#160;is&#160;defined by&#160;the&#160;font&#160;properties.<br/>
•<br/>
PROPORTIONAL&#160;–&#160;Scale&#160;the&#160;text&#160;if&#160;the&#160;shape&#160;is scaled.<br/>
•<br/>
ALLLINES&#160;–&#160;Like&#160;PROPORTIONAL,&#160;but&#160;the&#160;width&#160;of&#160;each row&#160;is also scaled.<br/>
•<br/>
RESIZEATTR&#160;–&#160;If&#160;the&#160;shape&#160;is&#160;scaled,&#160;scale&#160;the&#160;font&#160;attributes.<br/>
TextHorizontalAdjust<br/>
Enumerated&#160;value&#160;of&#160;type&#160;com.sun.star.drawing.TextHorizontalAdjust:<br/>•<br/>
LEFT&#160;–&#160;The&#160;left&#160;edge&#160;of&#160;the&#160;text&#160;is&#160;adjusted to&#160;the&#160;left&#160;edge&#160;of&#160;the&#160;shape.<br/>
•<br/>
CENTER&#160;–&#160;The&#160;text&#160;is centered inside&#160;the&#160;shape.<br/>
•<br/>
RIGHT&#160;–&#160;The&#160;right&#160;edge&#160;of&#160;the&#160;text&#160;is adjusted&#160;to the&#160;right&#160;edge&#160;of&#160;the&#160;shape.<br/>
•<br/>
BLOCK&#160;–&#160;The&#160;text&#160;extends from&#160;the&#160;left&#160;to the&#160;right&#160;edge&#160;of&#160;the&#160;shape.<br/>
TextLeftDistance<br/>
Distance&#160;from&#160;the&#160;left&#160;edge&#160;of&#160;the&#160;shape&#160;to the&#160;text&#160;as a&#160;Long Integer.<br/>
TextLowerDistance<br/>
Distance&#160;from&#160;the&#160;lower&#160;edge&#160;of&#160;the&#160;shape&#160;to&#160;the&#160;text&#160;as a&#160;Long&#160;Integer.<br/>
TextMaximumFrameHeight<br/>
Limit&#160;a&#160;shape’s&#160;height&#160;as it&#160;grows automatically&#160;as you&#160;enter&#160;text.<br/>
TextMaximumFrameWidth<br/>
Limit&#160;a&#160;shape’s&#160;width as it&#160;grows automatically&#160;as you&#160;enter&#160;text.<br/>
TextMinimumFrameHeight<br/>
Limit&#160;a&#160;shape’s&#160;minimum&#160;height&#160;as&#160;it&#160;grows&#160;automatically&#160;as you enter&#160;text.<br/>
TextMinimumFrameWidth<br/>
Limit&#160;a&#160;shape’s&#160;minimum&#160;width as it&#160;grows&#160;automatically&#160;as&#160;you enter&#160;text.<br/>
TextRightDistance<br/>
Distance&#160;from&#160;the&#160;right&#160;edge&#160;of&#160;the&#160;shape&#160;to the&#160;text&#160;as&#160;a&#160;Long&#160;Integer.<br/>
TextUpperDistance<br/>
Distance&#160;from&#160;the&#160;upper&#160;edge&#160;of&#160;the&#160;shape&#160;to the&#160;text&#160;as a&#160;Long Integer.<br/>
TextVerticalAdjust<br/>
Enumerated&#160;value&#160;of&#160;type&#160;com.sun.star.drawing.TextVerticalAdjust:<br/>•<br/>
TOP&#160;–&#160;The&#160;top&#160;edge&#160;of&#160;the&#160;text&#160;is&#160;adjusted&#160;to the&#160;top edge&#160;of&#160;the&#160;shape.<br/>
•<br/>
CENTER&#160;–&#160;The&#160;text&#160;is centered inside&#160;the&#160;shape.<br/>
•<br/>
BOTTOM&#160;–&#160;The&#160;bottom&#160;edge&#160;of&#160;the&#160;text&#160;is&#160;adjusted to&#160;the&#160;bottom&#160;edge&#160;of&#160;the&#160;shape.<br/>
•<br/>
BLOCK&#160;–&#160;The&#160;text&#160;extends from&#160;the&#160;top&#160;to the&#160;bottom&#160;edge&#160;of&#160;the&#160;shape.<br/>
TextWritingMode<br/>
Enumerated&#160;value&#160;of&#160;type&#160;com.sun.star.text.TextWritingMode:<br/>•<br/>
LR_TB&#160;–&#160;Text&#160;is&#160;written left&#160;to&#160;right&#160;and top&#160;to bottom.<br/>
•<br/>
RL_TB&#160;–&#160;Text&#160;is&#160;written right&#160;to left&#160;and top&#160;to bottom.<br/>
•<br/>
TB_RL&#160;–&#160;Text&#160;is&#160;written top&#160;to bottom&#160;and&#160;lines are&#160;placed right&#160;to left.<br/>
564<br/>
<hr/>
<a name=568></a><i><b>MeasureShape<br/></b></i>The&#160;default&#160;behavior of a&#160;MeasureShape&#160;(see<a href="libremacros.html#569"><b>&#160;</b>Figure&#160;115)</a>&#160;is&#160;to display&#160;the&#160;actual&#160;length of the&#160;shape.&#160;The&#160;<br/>macro in<a href="libremacros.html#568"><b>&#160;</b>Listing&#160;496&#160;c</a>reates&#160;two measure&#160;shapes&#160;and changes&#160;the&#160;text&#160;of one&#160;of them&#160;to “Width”.&#160;To&#160;help&#160;<br/>illustrate&#160;setting the&#160;properties&#160;in<a href="libremacros.html#566">&#160;Table&#160;231, t</a>he&#160;TextAnimationKind&#160;property&#160;is&#160;set&#160;to&#160;SCROLL&#160;so that&#160;the&#160;<br/>text&#160;continuously&#160;scrolls&#160;from&#160;right&#160;to&#160;left;&#160;or at&#160;least&#160;it&#160;would&#160;if it&#160;were&#160;in&#160;an Impress&#160;document.<br/>
<i><b>Listing&#160;496.</b>&#160;Draw a MeasureShape.<br/></i>Sub&#160;drawMeasureShape()<br/>&#160;&#160;Dim&#160;oPage &#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;oStart&#160;As&#160;new&#160;com.sun.star.awt.Point<br/>&#160;&#160;Dim&#160;oEnd&#160;As&#160;new&#160;com.sun.star.awt.Point<br/>&#160;&#160;Dim&#160;oDrawDoc &#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160; oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>&#160;&#160;<br/>&#160; oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160; oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.MeasureShape&#34;)<br/>&#160; oPage.add(oShape)<br/>&#160;&#160;<br/>&#160;&#160;REM The following values MUST be set AFTER the object is inserted.<br/>&#160; oStart.X&#160;=&#160;oPage.Width&#160;/&#160;4&#160;:&#160;oEnd.X&#160;=&#160;oPage.Width&#160;/&#160;2<br/>&#160; oStart.Y&#160;=&#160;oPage.Height/4&#160;&#160;:&#160;oEnd.Y&#160;=&#160;oPage.Height/4<br/>&#160; oShape.StartPosition&#160;=&#160;oStart<br/>&#160; oShape.EndPosition&#160;=&#160;oEnd<br/>&#160; oShape.setString(&#34;Width&#34;)<br/>&#160; oShape.TextAnimationKind&#160;=&#160;com.sun.star.drawing.TextAnimationKind.SCROLL<br/>
&#160; oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.MeasureShape&#34;)<br/>&#160; oPage.add(oShape)<br/>&#160; oStart.X&#160;=&#160;oPage.Width&#160;/&#160;5&#160;:&#160;oEnd.X&#160;=&#160;oPage.Width&#160;/&#160;5<br/>&#160; oStart.Y&#160;=&#160;oPage.Height/4&#160;&#160;:&#160;oEnd.Y&#160;=&#160;oPage.Height/2.5<br/>&#160; oShape.StartPosition&#160;=&#160;oStart<br/>&#160; oShape.EndPosition&#160;=&#160;oEnd<br/>End&#160;Sub<br/>
565<br/>
<hr/>
<a name=569></a><i><b>Figure&#160;115.</b>&#160;By&#160;default,&#160;measure&#160;shapes&#160;show the&#160;actual&#160;size—you can override&#160;this.</i><br/>
<i><b>Drawing&#160;line&#160;properties<br/></b></i>Shapes&#160;that&#160;support&#160;the&#160;com.sun.star.drawing.LineProperties&#160;service&#160;can influence&#160;how&#160;lines&#160;are&#160;drawn.&#160;<br/>Most&#160;shapes&#160;support&#160;line&#160;properties&#160;because&#160;most&#160;shapes&#160;contain&#160;lines&#160;of some&#160;sort.&#160;The&#160;specific&#160;properties&#160;<br/>dealing&#160;with&#160;line&#160;endpoints&#160;and start&#160;points&#160;are&#160;supported only&#160;by&#160;shapes&#160;with open ends.<br/>
<i><b>Table&#160;232.</b>&#160;Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.drawing.LineProperties&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
LineColor&#160;<br/>
Line&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
LineDash&#160;<br/>
Enumerated&#160;value&#160;of&#160;type&#160;com.sun.star.drawing.LineDash that&#160;defines how&#160;dashed&#160;lines are&#160;drawn.<br/>•<br/>
Style&#160;–&#160;Enumerated&#160;value&#160;of&#160;type&#160;com.sun.star.drawing.DashStyle:&#160;RECT,&#160;ROUND,&#160;<br/>
RECTRELATIVE, and&#160;ROUNDRELATIVE.<br/>
•<br/>
Dots – Number&#160;of&#160;dots in this LineDash as a&#160;Long Integer.<br/>
•<br/>
DotLen –&#160;Length&#160;of&#160;a&#160;dot&#160;as&#160;a&#160;Long&#160;Integer.<br/>
•<br/>
Dashes –&#160;Number&#160;of&#160;dashes&#160;as&#160;a&#160;Short&#160;Integer.<br/>
•<br/>
DashLen –&#160;Length&#160;of&#160;a&#160;single&#160;dash as a&#160;Long Integer.<br/>
•<br/>
Distance&#160;–&#160;Distance&#160;between the&#160;dots as a&#160;Long&#160;Integer.<br/>
LineEnd&#160;<br/>
Line&#160;end in&#160;the&#160;form&#160;of&#160;a&#160;PolyPolygonBezierCoords.<br/>
LineEndCenter&#160;<br/>
If&#160;True,&#160;the&#160;line&#160;ends in the&#160;center&#160;of&#160;the&#160;polygon.<br/>
LineEndName&#160;<br/>
Name&#160;of&#160;the&#160;line&#160;end&#160;point’s&#160;PolyPolygonBezierCoords.<br/>
LineEndWidth&#160;<br/>
Width of&#160;the&#160;line&#160;end polygon.<br/>
LineJoint&#160;<br/>
Enumerated&#160;value&#160;of&#160;type&#160;com.sun.star.drawing.LineJoint:<br/>•<br/>
NONE&#160;–&#160;The&#160;joint&#160;between lines is&#160;not&#160;connected.<br/>
•<br/>
MIDDLE&#160;–&#160;The&#160;middle&#160;value&#160;between joints is&#160;used.<br/>
•<br/>
BEVEL&#160;–&#160;The&#160;edges&#160;are&#160;joined by&#160;lines.<br/>
•<br/>
MITER&#160;–&#160;Lines join at&#160;intersections.<br/>
•<br/>
ROUND&#160;–&#160;Lines are&#160;joined with&#160;an arc.<br/>
LineStart&#160;<br/>
Line&#160;start&#160;in the&#160;form&#160;of&#160;a&#160;PolyPolygonBezierCoords .<br/>
566<br/>
<hr/>
<a name=570></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
LineStartCenter&#160;<br/>
If&#160;True,&#160;the&#160;line&#160;starts&#160;from&#160;the&#160;center&#160;of&#160;the&#160;polygon.<br/>
LineStartName&#160;<br/>
Name&#160;of&#160;the&#160;line&#160;start&#160;point’s&#160;PolyPolygonBezierCoords.<br/>
LineStartWidth&#160;<br/>
Width of&#160;the&#160;line&#160;start&#160;polygon.<br/>
LineStyle&#160;<br/>
Enumerated&#160;value&#160;of&#160;type&#160;com.sun.star.drawing.LineStyle:&#160;NONE&#160;(the&#160;line&#160;is hidden),&#160;SOLID,&#160;and&#160;<br/>DASH.<br/>
LineTransparence&#160;<br/>
Line&#160;transparency&#160;percentage&#160;as a&#160;Short&#160;Integer.<br/>
LineWidth&#160;<br/>
Line&#160;width in 1/100&#160;mm&#160;as&#160;a&#160;Long&#160;Integer.<br/>
<i><b>Filling&#160;space&#160;with&#160;a&#160;ClosedBezierShape<br/></b></i>Shapes&#160;that&#160;support&#160;the&#160;com.sun.star.drawing.FillProperties&#160;service&#160;are&#160;able&#160;to&#160;control&#160;how&#160;open area&#160;in the&#160;<br/>shape&#160;is&#160;filled.&#160;In&#160;general, if&#160;the&#160;shape&#160;is&#160;closed, it&#160;can be&#160;filled.<br/>
<i><b>Table&#160;233.</b>&#160;Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.drawing.FillProperties&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
FillBackground&#160;<br/>
If&#160;True, the&#160;transparent&#160;background of&#160;a&#160;hatch-filled area&#160;is&#160;drawn&#160;in the&#160;current&#160;<br/>
background color.<br/>
FillBitmap&#160;<br/>
If&#160;the&#160;FillStyle&#160;is BITMAP,&#160;this&#160;is the&#160;bitmap used.<br/>
FillBitmapLogicalSize&#160;<br/>
Specifies if&#160;the&#160;size&#160;is given in percentage&#160;or&#160;as an absolute&#160;value.<br/>
FillBitmapMode&#160;<br/>
com.sun.star.drawing.BitmapMode&#160;enum:<br/>
•<br/>
REAPEAT&#160;Repeate&#160;over&#160;the&#160;fill&#160;area.<br/>
•<br/>
STRETCH&#160;Stretch to fill&#160;the&#160;area.<br/>
•<br/>
NO_REPEAT&#160;One&#160;copy&#160;in the&#160;original&#160;size.<br/>
FillBitmapName&#160;<br/>
If&#160;the&#160;FillStyle&#160;is BITMAP,&#160;this&#160;is the&#160;name&#160;of&#160;the&#160;fill&#160;bitmap style&#160;used.<br/>
FillBitmapOffsetX&#160;<br/>
The&#160;horizontal&#160;offset&#160;where&#160;the&#160;tile&#160;starts. It&#160;is&#160;given as a&#160;percentage&#160;in&#160;relation to<br/>the&#160;width&#160;of&#160;the&#160;bitmap.<br/>
FillBitmapOffsetY&#160;<br/>
The&#160;vertical&#160;offset&#160;where&#160;the&#160;tile&#160;starts. It&#160;is given as a&#160;percentage&#160;in&#160;relation&#160;to&#160;<br/>the&#160;height&#160;of&#160;the&#160;bitmap.<br/>
FillBitmapPositionOffsetX&#160;<br/>
Every&#160;second line&#160;of&#160;tiles is&#160;moved the&#160;given&#160;percentage&#160;of&#160;the&#160;width of&#160;the&#160;<br/>bitmap.<br/>
FillBitmapPositionOffsetY&#160;<br/>
Every&#160;second row&#160;of&#160;tiles is moved the&#160;given percentage&#160;of&#160;the&#160;height&#160;of&#160;the&#160;<br/>bitmap.<br/>
FillBitmapRectanglePoint&#160;<br/>
The&#160;RectanglePoint&#160;specifies the&#160;position inside&#160;the&#160;bitmap&#160;to use&#160;as the&#160;top-left&#160;<br/>position for&#160;rendering.<br/>
FillBitmapSizeX&#160;<br/>
The&#160;width of&#160;the&#160;tile&#160;for&#160;filling.<br/>
FillBitmapSizeY&#160;<br/>
The&#160;height&#160;of&#160;the&#160;tile&#160;for&#160;filling.<br/>
FillBitmapURL&#160;<br/>
If&#160;the&#160;FillStyle&#160;is BITMAP,&#160;this&#160;is a&#160;URL&#160;to the&#160;bitmap&#160;used.<br/>
FillColor&#160;<br/>
Color&#160;to&#160;use&#160;if&#160;the&#160;FillStyle&#160;is&#160;SOLID.<br/>
FillGradient&#160;<br/>
If&#160;the&#160;FillStyle&#160;is GRADIENT,&#160;this&#160;describes the&#160;gradient&#160;used&#160; (see<a href="libremacros.html#571">&#160;Table&#160;234)</a>.<br/>
FillGradientName&#160;<br/>
If&#160;the&#160;FillStyle&#160;is GRADIENT,&#160;this&#160;is&#160;the&#160;name&#160;of&#160;the&#160;fill&#160;gradient&#160;style&#160;used.<br/>
FillHatch&#160;<br/>
If&#160;the&#160;FillStyle&#160;is HATCH,&#160;this&#160;describes the&#160;hatch used.<br/>
FillHatchName&#160;<br/>
If&#160;the&#160;FillStyle&#160;is GRADIENT,&#160;this&#160;is&#160;the&#160;name&#160;of&#160;the&#160;fill&#160;hatch style&#160;used.<br/>
567<br/>
<hr/>
<a name=571></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
FillStyle&#160;<br/>
com.sun.star.drawing.FillStyle&#160;enum:&#160;<br/>
•<br/>
NONE&#160;Do not&#160;fill.<br/>
•<br/>
SOLID&#160;Solid&#160;color.<br/>
•<br/>
GRADIENT&#160;Use&#160;a&#160;gradient.<br/>
•<br/>
HATCH&#160;Fill&#160;with a&#160;hatch.<br/>
•<br/>
BITMAP&#160;Use&#160;a&#160;bitmap&#160;such as a&#160;JPG.<br/>
FillTransparence&#160;<br/>
Transparency&#160;percentage&#160;if&#160;the&#160;FillStyle&#160;is SOLID.<br/>
FillTransparenceGradient&#160;<br/>
Defines the&#160;gradient&#160;with a&#160;com.sun.star.awt.Gradient&#160;structure&#160;(see<a href="libremacros.html#571">&#160;Table&#160;234)</a>.<br/>
FillTransparenceGradientName&#160;<br/>
Name&#160;of&#160;the&#160;gradient&#160;style&#160;to use;&#160;empty&#160;is&#160;okay.<br/>
Gradients&#160;are&#160;defined as&#160;follows:<br/>
<i><b>Table&#160;234.</b>&#160;com.sun.star.awt.Gradient&#160;structure.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Style&#160;<br/>
Gradient&#160;style&#160;using&#160;an &#160;com.sun.star.awt.GradientStyle&#160;enum:<br/>
•<br/>
LINEAR&#160;Linear&#160;gradient.<br/>
•<br/>
AXIAL&#160;Axial&#160;gradient.<br/>
•<br/>
RADIAL&#160;Radial&#160;gradient.<br/>
•<br/>
ELLIPTICAL&#160;Gradient&#160;in&#160;the&#160;shape&#160;of&#160;an elipse.<br/>
•<br/>
SQUARE Gradient&#160;in&#160;the&#160;shape&#160;of&#160;a&#160;square.<br/>
•<br/>
RECT&#160;Gradient&#160;in&#160;the&#160;shape&#160;of&#160;a&#160;rectangle.<br/>
StartColor&#160;<br/>
Gradient&#160;start&#160;color.<br/>
EndColor&#160;<br/>
Gradient&#160;end color.<br/>
Angle&#160;<br/>
Gradient&#160;angle&#160;in 1/10&#160;degree.<br/>
Border&#160;<br/>
Per&#160;cent&#160;of&#160;the&#160;total&#160;width where&#160;just&#160;the&#160;start&#160;color&#160;is&#160;used. &#160;<br/>
XOffset&#160;<br/>
X-coordinate,&#160;where&#160;the&#160;gradient&#160;begins. &#160;<br/>
YOffset&#160;<br/>
Y-coordinate,&#160;where&#160;the&#160;gradient&#160;begins. &#160;<br/>
StartIntensity&#160;<br/>
Intensity&#160;at&#160;the&#160;start&#160;point&#160;of&#160;the&#160;gradient.<br/>
EndIntensity&#160;<br/>
Intensity&#160;at&#160;the&#160;end point&#160;of&#160;the&#160;gradient. &#160;<br/>
StepCount&#160;<br/>
Number&#160;of&#160;steps&#160;of&#160;change&#160;color.&#160;&#160;<br/>
The&#160;macro i<a href="libremacros.html#571">n&#160;Listing&#160;497&#160;dra</a>ws&#160;a&#160;closed Bezier shape.&#160;The&#160;fill&#160;style&#160;is&#160;set&#160;to use&#160;a&#160;gradient, which means&#160;<br/>that&#160;the&#160;darkness&#160;of the&#160;shape&#160;changes&#160;over the&#160;shape.&#160;The&#160;resulting figure&#160;contains&#160;narrow&#160;bands&#160;of each&#160;<br/>color or intensity.&#160;You can smooth&#160;the&#160;appearance&#160;of the&#160;gradient&#160; by&#160;using&#160;the&#160;FillTransparenceGradient&#160;<br/>property&#160;as&#160;mentioned&#160;i<a href="libremacros.html#570">n&#160;Table&#160;233.</a><br/>
<i><b>Listing&#160;497.</b>&#160;Draw a ClosedBezierShape&#160;with a gradient.</i><br/>
Sub&#160;DrawClosedBezierShape<br/>&#160;&#160;Dim&#160;oPage &#160;&#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape &#160;'Shape to insert<br/>&#160;&#160;Dim&#160;oCoords&#160;'Coordinates of the polygon to insert<br/>&#160;&#160;Dim&#160;oDrawDoc &#160;'Temporary draw document.<br/>&#160;&#160;<br/>
568<br/>
<hr/>
<a name=572></a>&#160; oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>
&#160; oCoords&#160;=&#160;createUnoStruct(&#34;com.sun.star.drawing.PolyPolygonBezierCoords&#34;)<br/>
&#160;&#160;REM Fill in the actual coordinates. The first and last points<br/>&#160;&#160;REM are normal points and the middle points are Bezier control points.<br/>&#160; oCoords.Coordinates&#160;=&#160;Array(_<br/>&#160; &#160;&#160;Array(_<br/>&#160; &#160; &#160; CreatePoint(&#160;1000,&#160;1000&#160;),_<br/>&#160; &#160; &#160; CreatePoint(&#160;3000,&#160;4000&#160;),_<br/>&#160; &#160; &#160; CreatePoint(&#160;3000,&#160;4000&#160;),_<br/>&#160; &#160; &#160; CreatePoint(&#160;5000,&#160;1000&#160;)_<br/>&#160; &#160;&#160;)_<br/>&#160;&#160;)<br/>&#160; oCoords.Flags&#160;=&#160;Array(_<br/>&#160; &#160;&#160;Array(_<br/>&#160; &#160; &#160; com.sun.star.drawing.PolygonFlags.NORMAL,_<br/>&#160; &#160; &#160; com.sun.star.drawing.PolygonFlags.CONTROL,_<br/>&#160; &#160; &#160; com.sun.star.drawing.PolygonFlags.CONTROL,_<br/>&#160; &#160; &#160; com.sun.star.drawing.PolygonFlags.NORMAL&#160;_<br/>&#160; &#160;&#160;)_<br/>&#160;&#160;)<br/>&#160; &#160;<br/>&#160; oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160; oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.ClosedBezierShape&#34;)<br/>&#160; oPage.add(oShape)<br/>&#160; oShape.FillStyle&#160;=&#160;com.sun.star.drawing.FillStyle.GRADIENT<br/>&#160; oShape.PolyPolygonBezier&#160;=&#160;oCoords<br/>End&#160;Sub<br/>
Sub&#160;drawRectangleWithShadow()<br/>&#160;&#160;Dim&#160;oPage &#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;oDrawDoc &#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160; oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>&#160;&#160;<br/>&#160; oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160; oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;)<br/>&#160; oPage.add(oShape)<br/>&#160; oShape.setPosition(createPoint(1000,&#160;1000))<br/>&#160; oShape.setSize(createSize(4000,&#160;1000))<br/>&#160; oShape.setString(&#34;box 1&#34;)<br/>&#160; oShape.Shadow&#160;=&#160;True<br/>&#160;<br/>&#160; oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;)<br/>&#160; oPage.add(oShape)<br/>&#160; oShape.setPosition(createPoint(6000,&#160;1000))<br/>&#160; oShape.setSize(createSize(4000,&#160;1000))<br/>&#160; oShape.setString(&#34;box 2&#34;)<br/>&#160; oShape.Shadow&#160;=&#160;True<br/>&#160; oShape.ShadowXDistance&#160;=&#160;-150<br/>&#160; oShape.CornerRadius&#160;=&#160;100<br/>
569<br/>
<hr/>
<a name=573></a>End&#160;Sub<br/>
<i><b>Figure&#160;116.</b>&#160;Bezier&#160;shape&#160;using&#160;a gradient&#160;fill.</i><br/>
<i><b>Shadows&#160;and&#160;a&#160;RectangleShape<br/></b></i>Shapes&#160;that&#160;support&#160;the&#160;ShadowProperties&#160;service&#160;can be&#160;drawn with a&#160;shadow.&#160;You can set&#160;the&#160;shadow&#160;<br/>location and color &#160;by&#160;using the&#160;properties&#160;i<a href="libremacros.html#573">n&#160;Table&#160;235.</a><br/>
<i><b>Table&#160;235.</b>&#160;Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.drawing.ShadowProperties&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Shadow<br/>
If&#160;True, the&#160;shape&#160;has a&#160;shadow.<br/>
ShadowColor<br/>
Color&#160;of&#160;the&#160;shadow&#160;as a&#160;Long&#160;Integer.<br/>
ShadowTransparence<br/>
Shadow&#160;transparency&#160;as a&#160;percentage.<br/>
ShadowXDistance<br/>
Horizontal&#160;distance&#160;of&#160;the&#160;left&#160;edge&#160;of&#160;the&#160;shape&#160;to the&#160;shadow.&#160;&#160;<br/>
ShadowYDistance<br/>
Vertical&#160;distance&#160;of&#160;the&#160;top&#160;edge&#160;of&#160;the&#160;shape&#160;to the&#160;shadow.&#160;&#160;<br/>
A&#160;common&#160;method&#160;for drawing&#160;shadows&#160;is&#160;to draw&#160;the&#160;shape&#160;at&#160;an offset&#160;location using a&#160;shadow&#160;color,&#160;and&#160;<br/>then draw&#160;the&#160;shape&#160;normally&#160;(see<a href="libremacros.html#574">&#160;Figure&#160;117).&#160;</a>With&#160;this&#160;in mind,&#160;consider the&#160;properties&#160;ShadowXDistance<br/>and ShadowYDistance&#160;as&#160;the&#160;distance&#160;that&#160;the&#160;“shadow&#160;object”&#160;is&#160;shifted when it&#160;is&#160;drawn.&#160;The&#160;default&#160;<br/>values&#160;for ShadowXDistance&#160;and ShadowYDistance&#160;are&#160;positive,&#160;which shifts&#160;the&#160;shadow&#160;right&#160;and down.&#160;A<br/>negative&#160;shadow&#160;distance&#160;shifts&#160;the&#160;shadow&#160;left&#160;and up.&#160;The&#160;macro in<a href="libremacros.html#573">&#160;Listing 498&#160;d</a>raws&#160;two boxes;&#160;the&#160;first&#160;<br/>box&#160;uses&#160;a&#160;standard shadow&#160;that&#160;is&#160;shifted&#160;right&#160;and down, and the&#160;second box&#160;has&#160;the&#160;shadow&#160;shifted&#160;left&#160;<br/>and down (see<a href="libremacros.html#574">&#160;Figure&#160;117)</a>.<br/>
<i><b>Listing&#160;498.</b>&#160;Draw rectangles&#160;with text, rounded corners, and drop shadows.</i><br/>
Sub&#160;drawRectangleWithShadow()<br/>&#160;&#160;Dim&#160;oPage&#160;&#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;oDrawDoc&#160;&#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>&#160;&#160;<br/>&#160;&#160;oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;)<br/>&#160;&#160;oPage.add(oShape)<br/>&#160;&#160;oShape.setPosition(createPoint(1000,&#160;1000))<br/>&#160;&#160;oShape.setSize(createSize(4000,&#160;1000))<br/>&#160;&#160;oShape.setString(&#34;box 1&#34;)<br/>&#160;&#160;oShape.Shadow&#160;=&#160;True<br/>&#160;<br/>&#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;)<br/>&#160;&#160;oPage.add(oShape)<br/>&#160;&#160;oShape.setPosition(createPoint(6000,&#160;1000))<br/>
570<br/>
<hr/>
<a name=574></a>&#160;&#160;oShape.setSize(createSize(4000,&#160;1000))<br/>&#160;&#160;oShape.setString(&#34;box 2&#34;)<br/>&#160;&#160;oShape.Shadow&#160;=&#160;True<br/>&#160;&#160;oShape.ShadowXDistance&#160;=&#160;-150<br/>&#160;&#160;oShape.CornerRadius&#160;=&#160;100<br/>End&#160;Sub<br/>
<i><b>Figure&#160;117.</b>&#160;Notice&#160;the&#160;different&#160;shadows&#160;and that&#160;box&#160;2 has&#160;rounded corners.</i><br/>
<i><b>Rotation&#160;and&#160;shearing<br/></b></i>The&#160;com.sun.star.drawing.RotationDescriptor provides&#160;the&#160;ability&#160;to rotate&#160;and shear a&#160;shape. Shear stretches<br/>a&#160;shape&#160;and would,&#160;for example,&#160;change&#160;a&#160;rectangle&#160;into&#160;a&#160;parallelogram.&#160;The&#160;RotateAngle&#160;property&#160;is&#160;a&#160;<br/>Long&#160;Integer measured in 1/100&#160;degrees.&#160;The&#160;shape&#160;is&#160;rotated counterclockwise&#160;around the&#160;center of the&#160;<br/>shape’s&#160;bounding box.&#160;The&#160;ShearAngle&#160;property&#160;is&#160;also a&#160;Long Integer measured in 1/100&#160;degrees, but&#160;the&#160;<br/>shape&#160;is&#160;sheared clockwise&#160;around the&#160;center of the&#160;bounding box.<br/>
The&#160;macro i<a href="libremacros.html#574">n&#160;Listing&#160;499&#160;rot</a>ates&#160;a&#160;rectangle&#160;20 degrees&#160;counterclockwise&#160;and shears&#160;a&#160;rectangle&#160;25 degrees&#160;<br/>clockwise.&#160;This&#160;code&#160;also&#160;draws&#160;a&#160;normal&#160;rectangle&#160;with&#160;no rotation or shear to help&#160;you&#160;visualize&#160;the&#160;effects<br/>(see<a href="libremacros.html#575">&#160;Figure&#160;118)</a>.<br/>
<i><b>Listing&#160;499.</b>&#160;Rotate&#160;and shear&#160;rectangles&#160;with text.<br/></i>Sub&#160;drawRotateRectangle()<br/>&#160;&#160;Dim&#160;oPage &#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;oDrawDoc &#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160; oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>&#160;&#160;<br/>&#160; oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160; oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;)<br/>&#160; oPage.add(oShape)<br/>&#160; oShape.setPosition(createPoint(1000,&#160;1000))<br/>&#160; oShape.setSize(createSize(4000,&#160;1500))<br/>&#160; oShape.setString(&#34;box 1&#34;)<br/>&#160; oShape.RotateAngle&#160;=&#160;2000&#160;&#160;'20 degrees<br/>
&#160; oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;)<br/>&#160; oPage.add(oShape)<br/>&#160; oShape.setPosition(createPoint(1000,&#160;1000))<br/>&#160; oShape.setSize(createSize(4000,&#160;1500))<br/>&#160; oShape.FillStyle&#160;=&#160;com.sun.star.drawing.FillStyle.NONE<br/>&#160; oShape.LineStyle&#160;=&#160;com.sun.star.drawing.LineStyle.DASH<br/>
&#160; oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;)<br/>&#160; oPage.add(oShape)<br/>&#160; oShape.setPosition(createPoint(6000,&#160;1000))<br/>
571<br/>
<hr/>
<a name=575></a>&#160; oShape.setSize(createSize(4000,&#160;1500))<br/>&#160; oShape.setString(&#34;box 2&#34;)<br/>&#160; oShape.ShearAngle&#160;=&#160;2500&#160; &#160;'25 degrees<br/>
&#160; oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;)<br/>&#160; oPage.add(oShape)<br/>&#160; oShape.setPosition(createPoint(6000,&#160;1000))<br/>&#160; oShape.setSize(createSize(4000,&#160;1500))<br/>&#160; oShape.FillStyle&#160;=&#160;com.sun.star.drawing.FillStyle.NONE<br/>&#160; oShape.LineStyle&#160;=&#160;com.sun.star.drawing.LineStyle.DASH<br/>End&#160;Sub<br/>
<i><b>Figure&#160;118.</b>&#160;The&#160;rectangles&#160;with&#160;dashed lines&#160;are&#160;the&#160;original&#160;rectangles.</i><br/>
<b>&#160;16.2.2.&#160;Shape&#160;types<br/></b>OOo supports&#160;many&#160;different&#160;shape&#160;types, which build on each other.&#160;Most&#160;of the&#160;shape&#160;types&#160;are&#160;obvious&#160;<br/>from&#160;their names. For example,&#160;a&#160;LineShape&#160;is&#160;a&#160;line.&#160;I&#160;was&#160;initially&#160;confused, however,&#160;by&#160;the&#160;gratuitous&#160;<br/>use&#160;of the&#160;word “Poly”&#160;in&#160;shape&#160;names&#160;such as&#160;PolyLineShape&#160;and PolyPolygonShape.&#160;The&#160;prefix&#160;“Poly”&#160;<br/>comes&#160;from&#160;the&#160;Greek and it&#160;means&#160;“many.”&#160;So in&#160;OOo, a&#160;Polygon is&#160;a&#160;figure&#160;containing many&#160;angles, a&#160;<br/>PolyLineShape&#160;contains&#160;many&#160;line&#160;shapes, and a&#160;PolyPolygonShape&#160;contains&#160;many&#160;polygon shapes.<br/>
<i><b>Simple&#160;lines<br/></b></i>The&#160;purpose&#160;of the&#160;LineShape&#160;service&#160;is&#160;to draw&#160;a&#160;simple&#160;line.&#160;A&#160;LineShape&#160;requires&#160;an initial&#160;position&#160;and a<br/>size.&#160;The&#160;macro in<a href="libremacros.html#575">&#160;Listing 500&#160;d</a>raws&#160;a&#160;line&#160;from&#160;the&#160;point&#160;(1000, 1000) to the&#160;point&#160;(1999, 1999).&#160;The&#160;<br/>endpoint&#160;of the&#160;line&#160;is&#160;set&#160;by&#160;setting the&#160;shape’s&#160;size.<br/>
<i><b>Listing&#160;500.</b>&#160;Draw a line.<br/></i>Sub&#160;SimpleLine<br/>&#160; Dim&#160;oPage&#160;&#160;'Page on which to draw<br/>&#160; Dim&#160;oShape&#160;'Shape to insert<br/>&#160; Dim&#160;oDrawDoc&#160;&#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>&#160;&#160;<br/>&#160;&#160;oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.LineShape&#34;)<br/>&#160;&#160;oPage.add(oShape)<br/>&#160;&#160;oShape.setPosition(CreatePoint(1000,&#160;1000))<br/>&#160;&#160;oShape.setSize(CreateSize(1000,&#160;1000))<br/>End&#160;Sub<br/>
572<br/>
<hr/>
<a name=576></a>Although I&#160;have&#160;never seen it&#160;used, the&#160;LineShape&#160;service&#160;supports&#160;the&#160;service&#160;PolyPolygonDescriptor (se<a href="libremacros.html#576">e<br/>Table&#160;236)</a>.&#160;The&#160;implication is&#160;that&#160;internally&#160;simple&#160;lines&#160;are&#160;represented&#160;as&#160;an open polygon that&#160;contains&#160;<br/>one&#160;line.&#160;The&#160;PolyPolygonDescriptor&#160;is&#160;used in other services&#160;as&#160;well.<br/>
<i><b>Table&#160;236.</b>&#160;Properties&#160;in the&#160;com.sun.star.drawing.PolyPolygonDescriptor&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
PolygonKind<br/>
This read-only&#160;property&#160;identifies the&#160;polygon type&#160;(see<a href="libremacros.html#576">&#160;Table&#160;237)</a>.<br/>
PolyPolygon<br/>
Reference&#160;points for&#160;this polygon.&#160;This is&#160;an array&#160;of&#160;arrays.&#160;Each contained array&#160;is&#160;<br/>an array&#160;of&#160;com.sun.star.awt.Point&#160;structures.&#160;These&#160;points are&#160;used to&#160;draw&#160;the&#160;<br/>
polygon&#160;and&#160;may&#160;have&#160;been transformed by&#160;a&#160;rotation or&#160;other&#160;transformation.<br/>
Geometry<br/>
These&#160;are&#160;the&#160;PolyPolygon points with no transformations.<br/>
The&#160;PolygonKind&#160;enumeration&#160;identifies&#160;the&#160;polygon type&#160;(see<a href="libremacros.html#576">&#160;Table&#160;237)</a>.&#160;The&#160;PolygonKind&#160;is&#160;a&#160;read-only&#160;<br/>property&#160;in the&#160;PolyPolygonDescriptor service&#160;(see<a href="libremacros.html#576">&#160;Table&#160;236)</a>. In&#160;other words, you can see&#160;what&#160;the&#160;type&#160;is,&#160;<br/>but&#160;you can’t&#160;set&#160;it.<br/>
<i><b>Table&#160;237.</b>&#160;Values&#160;defined by&#160;the&#160;com.sun.star.drawing.PolygonKind enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
LINE<br/>
Identifies a&#160;LineShape.&#160;&#160;<br/>
POLY<br/>
Identifies a&#160;PolyPolygonShape. &#160;<br/>
PLIN<br/>
Identifies a&#160;PolyLineShape. &#160;<br/>
PATHLINE<br/>
Identifies an OpenBezierShape. &#160;<br/>
PATHFILL<br/>
Identifies a&#160;ClosedBezierShape. &#160;<br/>
FREELINE<br/>
Identifies an OpenFreeHandShape. &#160;<br/>
FREEFILL<br/>
Identifies a&#160;ClosedFreeHandShape. &#160;<br/>
PATHPOLY<br/>
Identifies a&#160;PolyPolygonPathShape.&#160;&#160;<br/>
PATHPLIN<br/>
Identifies a&#160;PolyLinePathShape.&#160;&#160;<br/>
The&#160;PolyPolygon property&#160;in<a href="libremacros.html#576">&#160;Table&#160;236&#160;a</a>llows&#160;you&#160;to&#160;inspect&#160;the&#160;actual&#160;points&#160;used in&#160;the&#160;creation of the&#160;<br/>line.&#160;The&#160;code&#160;in<a href="libremacros.html#576">&#160;Listing 501&#160;a</a>ssumes&#160;that&#160;oShape&#160;contains&#160;a&#160;LineShape&#160;object&#160;and it&#160;displays&#160;the&#160;two points<br/>in the&#160;line.<br/>
<i><b>Listing&#160;501.</b>&#160;Inspect&#160;the&#160;points&#160;used in&#160;a LineShape.<br/></i>&#160;&#160;x&#160;=&#160;oShape.PolyPolygon(0)<br/>&#160;&#160;MsgBox&#160;&#34;&#34;&#160;&amp;&#160;x(0).X&#160;&amp;&#160;&#34; and &#34;&#160;&amp;&#160;x(0).Y<br/>&#160;&#160;MsgBox&#160;&#34;&#34;&#160;&amp;&#160;x(1).X&#160;&amp;&#160;&#34; and &#34;&#160;&amp;&#160;x(1).Y<br/>
<i><b>PolyLineShape<br/></b></i>The&#160;LineShape&#160;service&#160;defines&#160;a&#160;single&#160;line, and the&#160;PolyLineShape&#160;service&#160;defines&#160;a&#160;series&#160;of lines.&#160;A&#160;<br/>LineShape&#160;is&#160;defined by&#160;setting its&#160;position and size.&#160;A&#160;PolyLineShape, however,&#160;is&#160;defined by&#160;the&#160;<br/>PolyPolygonDescriptor (see<a href="libremacros.html#576">&#160;Table&#160;236).&#160;</a>Although it’s&#160;easy&#160;to&#160;create&#160;a&#160;PolyLineShape&#160;when you know&#160;how,&#160;<br/>it&#160;isn’t&#160;widely&#160;understood.<br/>
<b>TIP</b><br/>
The&#160;PolyPolygon property&#160;is&#160;an array&#160;of&#160;arrays that&#160;contain points.<br/>
573<br/>
<hr/>
<a name=577></a>The&#160;lines&#160;in the&#160;PolyLineShape&#160;are&#160;defined&#160;by&#160;the&#160;PolyPolygon property,&#160;which is&#160;an array&#160;that&#160;contains&#160;one&#160;<br/>or more&#160;arrays&#160;of points. Each array&#160;of points&#160;is&#160;drawn as&#160;a&#160;series&#160;of connected lines, but&#160;each array&#160;is&#160;not&#160;<br/>specifically&#160;connected to&#160;the&#160;other.&#160;The&#160;macro in<a href="libremacros.html#577">&#160;Listing 502<b>&#160;</b></a>generates&#160;two arrays&#160;of points&#160;(oPoints_1 and&#160;<br/>oPoints_2) and then&#160;the&#160;arrays&#160;are&#160;stored in&#160;another array.<br/>
<i><b>Listing&#160;502.</b>&#160;Draw a simple&#160;PolyLineShape.<br/></i>Sub&#160;SimplePolyLineShape<br/>&#160;&#160;Dim&#160;oPage&#160; &#160; &#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160; &#160;&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;oPoints_1&#160;'First set of points to plot<br/>&#160;&#160;Dim&#160;oPoints_2&#160;'Second set of points to plot<br/>&#160;&#160;Dim&#160;oDrawDoc&#160;&#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>&#160;&#160;<br/>&#160;&#160;oPoints_1&#160;=&#160;Array(_<br/>&#160; &#160;&#160;CreatePoint(&#160;1000,&#160;1000&#160;),_<br/>&#160; &#160;&#160;CreatePoint(&#160;3000,&#160;2000&#160;),_<br/>&#160; &#160;&#160;CreatePoint(&#160;1000,&#160;2000&#160;),_<br/>&#160; &#160;&#160;CreatePoint(&#160;3000,&#160;1000&#160;)_<br/>&#160;&#160;)<br/>
&#160;&#160;oPoints_2&#160;=&#160;Array(_<br/>&#160; &#160;&#160;CreatePoint(&#160;4000,&#160;1200&#160;),_<br/>&#160; &#160;&#160;CreatePoint(&#160;4000,&#160;2000&#160;),_<br/>&#160; &#160;&#160;CreatePoint(&#160;5000,&#160;2000&#160;),_<br/>&#160; &#160;&#160;CreatePoint(&#160;5000,&#160;1200&#160;)_<br/>&#160;&#160;)<br/>
&#160;&#160;oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.PolyLineShape&#34;)<br/>&#160;&#160;oPage.add(oShape)<br/>&#160;&#160;oShape.PolyPolygon&#160;=&#160;Array(oPoints_1,&#160;oPoints_2)<br/>&#160;&#160;oShape.LineWidth&#160;=&#160;50<br/>End&#160;Sub<br/>
<i><b>Figure&#160;119.</b>&#160;A&#160;single&#160;PolyLineShape&#160;produces&#160;two&#160;shapes&#160;that&#160;are&#160;not&#160;connected.</i><br/>
<b>TIP</b><br/>
The&#160;shape&#160;is added to&#160;the&#160;draw&#160;page&#160;before&#160;points are&#160;assigned&#160;to the&#160;PolyPolygon&#160;property.<br/>
The&#160;PolyPolygon property&#160;is&#160;an array&#160;of arrays.&#160;You can run the&#160;macro in<a href="libremacros.html#577">&#160;Listing 502&#160;w</a>ith only&#160;one&#160;set&#160;of&#160;<br/>points,&#160;but&#160;the&#160;single&#160;array&#160;of points&#160;must&#160;still&#160;reside&#160;inside&#160;a&#160;second array.<br/>
<i><b>Listing&#160;503.</b>&#160;The&#160;PolyPolygon property&#160;is&#160;an array&#160;of&#160;arrays&#160;of&#160;points.<br/></i>&#160;&#160;oShape.PolyPolygon&#160;=&#160;Array(oPoints_1)<br/>
574<br/>
<hr/>
<a name=578></a><i><b>PolyPolygonShape<br/></b></i>The&#160;PolyPolygonShape&#160;service&#160;defines&#160;a&#160;series&#160;of closed polygons&#160;that&#160;are&#160;not&#160;connected&#160;(see<a href="libremacros.html#578">&#160;Figure&#160;120)</a>.&#160;<br/>This&#160;service&#160;is&#160;essentially&#160;a&#160;closed-shape&#160;version&#160;of the&#160;PolyLineShape. Because&#160;it&#160;produces&#160;closed shapes,&#160;<br/>the&#160;PolyPolygonShape&#160;service&#160;supports&#160;fill&#160;properties.<br/>
The&#160;macro i<a href="libremacros.html#578">n&#160;Listing&#160;504&#160;us</a>es&#160;the&#160;same&#160;set&#160;of points&#160;as&#160;the&#160;macro i<a href="libremacros.html#577">n&#160;Listing&#160;502, but</a>&#160;I&#160;moved things&#160;around&#160;<br/>to demonstrate&#160;different&#160;methods&#160;for creating an array&#160;of arrays&#160;of points. Both macros, however,&#160;create&#160;the&#160;<br/>shape&#160;and add it&#160;to&#160;the&#160;draw&#160;page&#160;before&#160;setting the&#160;properties.<br/>
<i><b>Listing&#160;504.</b>&#160;Draw a simply&#160;PolyPolygonShape&#160;that&#160;is&#160;filled.<br/></i>Sub&#160;SimplePolyPolygonShapeFilled<br/>&#160;&#160;Dim&#160;oPage&#160; &#160; &#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160; &#160;&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;oDrawDoc&#160;&#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>
&#160;&#160;oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.PolyPolygonShape&#34;)<br/>&#160;&#160;oPage.add(oShape)<br/>&#160;&#160;oShape.PolyPolygon&#160;=&#160;Array(_<br/>&#160; &#160;&#160;Array(&#160;CreatePoint(&#160;1000,&#160;1000&#160;),_<br/>&#160; &#160; &#160; &#160; &#160; &#160;CreatePoint(&#160;3000,&#160;2000&#160;),_<br/>&#160; &#160; &#160; &#160; &#160; &#160;CreatePoint(&#160;1000,&#160;2000&#160;),_<br/>&#160; &#160; &#160; &#160; &#160; &#160;CreatePoint(&#160;3000,&#160;1000&#160;)_<br/>&#160; &#160; &#160; &#160; &#160;),_<br/>&#160; &#160;&#160;Array(&#160;CreatePoint(&#160;4000,&#160;1200&#160;),_<br/>&#160; &#160; &#160; &#160; &#160; &#160;CreatePoint(&#160;4000,&#160;2000&#160;),_<br/>&#160; &#160; &#160; &#160; &#160; &#160;CreatePoint(&#160;5000,&#160;2000&#160;),_<br/>&#160; &#160; &#160; &#160; &#160; &#160;CreatePoint(&#160;5000,&#160;1200&#160;)_<br/>&#160; &#160; &#160; &#160; &#160;)_<br/>&#160; &#160;&#160;)<br/>
&#160;&#160;oShape.LineWidth&#160;=&#160;50<br/>End&#160;Sub<br/>
<i><b>Figure&#160;120.</b>&#160;The&#160;PolyPolygonShape&#160;produces&#160;a closed-shape&#160;version of&#160;the&#160;PolyLineShape.</i><br/>
<i><b>RectangleShape&#160;and&#160;TextShape<br/></b></i>Externally,&#160;the&#160;RectangleShape&#160;and the&#160;TextShape&#160;are&#160;virtually&#160;identical.&#160;The&#160;two shape&#160;types&#160;support&#160;the&#160;<br/>same&#160;set&#160;of services&#160;(except&#160;for the&#160;defining service, of course) and they&#160;can be&#160;configured to&#160;produce&#160;the&#160;<br/>same&#160;output.&#160;The&#160;primary&#160;difference&#160;between the&#160;two shape&#160;types&#160;is&#160;their default&#160;values&#160;while&#160;producing&#160;<br/>output.&#160;In&#160;principle, properties&#160;can be&#160;adjusted from&#160;default&#160;values, so that&#160;each type&#160;could&#160;produce&#160;either&#160;<br/>output.&#160;The&#160;macro in<a href="libremacros.html#578">&#160;Listing 505<b>&#160;</b></a>creates&#160;a&#160;rectangle&#160;shape&#160;and a&#160;text&#160;shape&#160;next&#160;to each other (see<a href="libremacros.html#579"><b>&#160;</b>Figure&#160;<br/>121)</a>.<br/>
<i><b>Listing&#160;505.</b>&#160;Draw a rectangle&#160;and a text&#160;object.</i><br/>
Sub&#160;SimpleRectangleShape2<br/>&#160;&#160;Dim&#160;oPage&#160; &#160; &#160;'Page on which to draw<br/>
575<br/>
<hr/>
<a name=579></a>&#160;&#160;Dim&#160;oShape&#160; &#160;&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;oDrawDoc&#160;&#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>
&#160;&#160;oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;)<br/>&#160;&#160;oPage.add(oShape)<br/>&#160;&#160;<br/>&#160;&#160;oShape.setPosition(createPoint(1000,&#160;1000))<br/>&#160;&#160;oShape.setSize(createSize(6000,&#160;1000))<br/>&#160;&#160;oShape.setString(&#34;rectangle&#34;)<br/>&#160;&#160;oShape.Shadow&#160;=&#160;True<br/>
&#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.TextShape&#34;)<br/>&#160;&#160;oPage.add(oShape)<br/>&#160;&#160;<br/>&#160;&#160;oShape.setPosition(createPoint(8000,&#160;1000))<br/>&#160;&#160;oShape.setSize(createSize(10000,&#160;1000))<br/>&#160;&#160;oShape.setString(&#34;text&#34;)<br/>&#160;&#160;oShape.Shadow&#160;=&#160;True<br/>End&#160;Sub<br/>
<i><b>Figure&#160;121.</b>&#160;Two&#160;shapes&#160;that&#160;are&#160;drawn in&#160;the&#160;same&#160;way—but&#160;with&#160;different,&#160;nearly&#160;identical&#160;shape&#160;types</i><br/>
<i>that&#160;have&#160;different&#160;default&#160;values—produce&#160;different&#160;output.</i><br/>
The&#160;RectangleShape&#160;and the&#160;TextShape&#160;types&#160;both support&#160;the&#160;CornerRadius&#160;property.&#160;The&#160;corner radius&#160;is&#160;a<br/>Long&#160;Integer that&#160;indicates&#160;the&#160;radius&#160;of the&#160;circle&#160;used to&#160;produce&#160;the&#160;corners.&#160;This&#160;is&#160;demonstrated i<a href="libremacros.html#574">n<br/>Figure&#160;117&#160;a</a>s&#160;produced by<a href="libremacros.html#573">&#160;Listing 498.</a><br/>
<i><b>EllipseShape<br/></b></i>A&#160;mathematician&#160;would&#160;say&#160;that&#160;an ellipse&#160;is&#160;a&#160;closed curve&#160;that&#160;is&#160;formed from&#160;two points&#160;(called the&#160;foci)&#160;<br/>in which the&#160;sum&#160;of the&#160;distances&#160;from&#160;any&#160;point&#160;on the&#160;curve&#160;to&#160;the&#160;two points&#160;is&#160;a&#160;constant.&#160;If&#160;the&#160;two foci&#160;<br/>are&#160;at&#160;the&#160;same&#160;point,&#160;the&#160;ellipse&#160;is&#160;a&#160;circle. In&#160;simpler terms,&#160;an ellipse&#160;is&#160;a&#160;circle&#160;or a&#160;squashed circle.<br/>
While&#160;drawing a&#160;rectangle, the&#160;position&#160;identifies&#160;the&#160;upper-left&#160;corner of the&#160;rectangle&#160;and then the&#160;size&#160;<br/>defines&#160;the&#160;width and height.&#160;If&#160;the&#160;same&#160;point&#160;and size&#160;is&#160;used to&#160;draw&#160;an ellipse, the&#160;ellipse&#160;will&#160;be&#160;<br/>contained inside&#160;the&#160;rectangle&#160;and will&#160;just&#160;barely&#160;touch the&#160;four sides&#160;of the&#160;rectangle. Mathematically,&#160;the&#160;<br/>sides&#160;of the&#160;rectangle&#160;are&#160;tangent&#160;to&#160;the&#160;ellipse&#160;at&#160;its&#160;principal&#160;axes,&#160;the&#160;maximum&#160;and minimum&#160;distances&#160;<br/>across&#160;the&#160;ellipse.&#160;The&#160;macro i<a href="libremacros.html#579">n&#160;Listing&#160;506&#160;s</a>tarts&#160;by&#160;drawing four ellipse&#160;shapes.&#160;The&#160;final&#160;ellipse&#160;is&#160;rotated&#160;<br/>30 degrees.&#160;The&#160;macro then draws&#160;a&#160;rectangle&#160;using the&#160;same&#160;position,&#160;size,&#160;and rotation&#160;as&#160;the&#160;last&#160;ellipse&#160;<br/>(see<a href="libremacros.html#580">&#160;Figure&#160;122)</a>.&#160;The&#160;final&#160;rectangle&#160;helps&#160;to illustrate&#160;the&#160;relationship&#160;between a&#160;rectangle&#160;and an ellipse.<br/>
<i><b>Listing&#160;506.</b>&#160;Draw ellipse&#160;shapes.</i><br/>
Sub&#160;SimpleEllipseShapes<br/>&#160;&#160;Dim&#160;oPage&#160; &#160; &#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160; &#160;&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160;&#160;'Loop variable.<br/>&#160;&#160;Dim&#160;x&#160; &#160; &#160; &#160; &#160;'One location point.<br/>
576<br/>
<hr/>
<a name=580></a>&#160;&#160;Dim&#160;nLocs&#160; &#160; &#160;'Locations array.<br/>&#160;&#160;Dim&#160;oDrawDoc&#160;&#160;'Temporary draw document.<br/>
&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>
&#160;&#160;nLocs&#160;=&#160;Array(_<br/>&#160; &#160;&#160;Array(CreatePoint(1000,&#160;1000),&#160;createSize(1000,&#160;1000)),_<br/>&#160; &#160;&#160;Array(CreatePoint(3000,&#160;1000),&#160;createSize(1000,&#160;1500)),_<br/>&#160; &#160;&#160;Array(CreatePoint(5000,&#160;1000),&#160;createSize(1500,&#160;1000)),_<br/>&#160; &#160;&#160;Array(CreatePoint(7000,&#160;1000),&#160;createSize(1500,&#160;1000))_<br/>&#160;&#160;)<br/>
&#160;&#160;oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(nLocs)&#160;To&#160;UBound(nLocs)<br/>&#160; &#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.EllipseShape&#34;)<br/>&#160; &#160;&#160;oPage.add(oShape)<br/>&#160; &#160;&#160;x&#160;=&#160;nLocs(i)<br/>&#160; &#160;&#160;oShape.setPosition(x(0))<br/>&#160; &#160;&#160;oShape.setSize(x(1))<br/>&#160; &#160;&#160;oShape.setString(i)<br/>&#160;&#160;Next<br/>&#160;&#160;oShape.RotateAngle&#160;=&#160;3000<br/>
&#160;&#160;REM Now draw a rectangle the same size as the last ellipse. &#160;<br/>&#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;)<br/>&#160;&#160;oPage.add(oShape)<br/>&#160;&#160;oShape.setPosition(x(0))<br/>&#160;&#160;oShape.setSize(x(1))<br/>&#160;&#160;oShape.RotateAngle&#160;=&#160;3000<br/>&#160;&#160;oShape.FillStyle&#160;=&#160;com.sun.star.drawing.FillStyle.NONE<br/>End&#160;Sub<br/>
<i><b>Figure&#160;122.</b>&#160;The&#160;size&#160;parameters&#160;determine&#160;shape; other&#160;parameters&#160;set&#160;position&#160;and orientation.</i><br/>
The&#160;EllipseShape&#160;service&#160;contains&#160;a&#160;property&#160;of type&#160;CircleKind that&#160;determines&#160;whether the&#160;entire&#160;ellipse&#160;<br/>should be&#160;drawn, or only&#160;a&#160;portion&#160;of it&#160;(see<a href="libremacros.html#580">&#160;Table&#160;238)</a>. In&#160;other words, you can draw&#160;an arc.&#160;The&#160;properties&#160;<br/>CircleStartAngle&#160;and CircleEndAngle&#160;define&#160;where&#160;the&#160;arc&#160;starts&#160;and ends. Each ellipse&#160;in<a href="libremacros.html#580">&#160;Figure&#160;122&#160;us</a>es&#160;a<br/>FULL&#160;CircleKind.<br/>
<i><b>Table&#160;238.</b>&#160;Values&#160;defined by&#160;the&#160;com.sun.star.drawing.CircleKind enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
com.sun.star.drawing.CircleKind.FULL<br/>
A&#160;full&#160;ellipse.<br/>
com.sun.star.drawing.CircleKind.SECTION<br/>
An&#160;ellipse&#160;with a&#160;cut&#160;connected by&#160;two lines.<br/>
com.sun.star.drawing.CircleKind.CUT<br/>
An&#160;ellipse&#160;with a&#160;cut&#160;connected by&#160;one&#160;line.<br/>
com.sun.star.drawing.CircleKind.ARC<br/>
An&#160;ellipse&#160;with an&#160;open cut.<br/>
577<br/>
<hr/>
<a name=581></a><b>Warn</b><br/>
Both&#160;AOO&#160;and LO&#160;incorrectly&#160;swapped&#160;the&#160;meaning&#160;for&#160;SECTION&#160;and CUT.<br/>
The&#160;four different&#160;circle&#160;kinds&#160;are&#160;drawn by<a href="libremacros.html#581"><b>&#160;</b>Listing&#160;507<b>&#160;</b></a>and shown in<a href="libremacros.html#581">&#160;Figure&#160;123.</a><br/>
<i><b>Listing&#160;507.</b>&#160;Draw&#160;Arcs.<br/></i>Sub&#160;ArcEllipseShapes<br/>&#160;&#160;Dim&#160;oPage&#160; &#160; &#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160; &#160;&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;x<br/>&#160;&#160;Dim&#160;nLocs<br/>&#160;&#160;Dim&#160;oDrawDoc&#160;&#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>
&#160;&#160;nLocs&#160;=&#160;Array(_<br/>&#160; &#160;&#160;com.sun.star.drawing.CircleKind.FULL,_<br/>&#160; &#160;&#160;com.sun.star.drawing.CircleKind.SECTION,_<br/>&#160; &#160;&#160;com.sun.star.drawing.CircleKind.CUT,_<br/>&#160; &#160;&#160;com.sun.star.drawing.CircleKind.ARC,_<br/>&#160;&#160;)<br/>
&#160;&#160;oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(nLocs)&#160;To&#160;UBound(nLocs)<br/>&#160; &#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.EllipseShape&#34;)<br/>&#160; &#160;&#160;oPage.add(oShape)<br/>&#160; &#160;&#160;oShape.setPosition(CreatePoint((i+1)*2000,&#160;1000))<br/>&#160; &#160;&#160;oShape.setSize(CreateSize(1000,700))<br/>&#160; &#160;&#160;oShape.setString(i)<br/>&#160; &#160;&#160;oShape.CircleStartAngle&#160;=&#160;9000<br/>&#160; &#160;&#160;oShape.CircleEndAngle&#160;=&#160;36000<br/>&#160; &#160;&#160;oShape.CircleKind&#160;=&#160;nLocs(i)<br/>End&#160;Sub<br/>
<i><b>Figure&#160;123.</b>&#160;Each supported CircleKind drawn&#160;in order.</i><br/>
<i><b>Bezier&#160;curves<br/></b></i>A&#160;Bezier curve&#160;is&#160;a&#160;smooth curve&#160;controlled&#160;by&#160;multiple&#160;points.&#160;Bezier curves&#160;connect&#160;the&#160;first&#160;and last&#160;<br/>points,&#160;but&#160;are&#160;only&#160;influenced by&#160;the&#160;other points.&#160;Mathematicians&#160;like&#160;Bezier curves&#160;because&#160;they&#160;are&#160;<br/>invariant&#160;under any&#160;affine&#160;mapping (any&#160;arbitrary&#160;combination&#160;of translation&#160;or rotation). Computer graphics<br/>professionals&#160;like&#160;Bezier curves&#160;because&#160;they&#160;are&#160;easy&#160;to&#160;manipulate&#160;and transform.<br/>
Bezier curves&#160;are&#160;controlled by&#160;a&#160;PolyPolygonBezierDescriptor&#160;(see<a href="libremacros.html#582">&#160;Table&#160;239)</a>, which is&#160;almost&#160;identical&#160;to&#160;<br/>the&#160;PolyPolygonDescriptor&#160;described in<a href="libremacros.html#576">&#160;Table&#160;236.&#160;</a>The&#160;difference&#160;between the&#160;two descriptors&#160;is&#160;that&#160;each&#160;<br/>point&#160;in&#160;the&#160;Bezier curve&#160;is&#160;categorized based on how&#160;the&#160;point&#160;affects&#160;the&#160;curve.<br/>
578<br/>
<hr/>
<a name=582></a><i><b>Table&#160;239.</b>&#160;Properties&#160;in the&#160;com.sun.star.drawing.PolyPolygonBezierDescriptor&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
PolygonKind<br/>
This read-only&#160;property&#160;identifies the&#160;polygon type&#160;(see<a href="libremacros.html#576">&#160;Table&#160;237)</a>.<br/>
PolyPolygonBezier<br/>
Reference&#160;points for&#160;this Bezier&#160;curve.&#160;This is&#160;a&#160;PolyPolygonBezierCoords structure.&#160;<br/>The&#160;structure&#160;contains an array&#160;of&#160;points and&#160;an array&#160;of&#160;flags to categorize&#160;each&#160;point<br/>
as to its function in&#160;the&#160;curve.<br/>
Geometry<br/>
This is&#160;the&#160;PolyPolygonBezierCoords with&#160;no transformations.<br/>
The&#160;PolyPolygonBezier property&#160;(see<a href="libremacros.html#582">&#160;Table&#160;239)</a>&#160;is&#160;a&#160;PolyPolygonBezierCoords&#160;structure&#160;that&#160;contains&#160;two&#160;<br/>properties,&#160;Coordinates&#160;and Flags.&#160;The&#160;Coordinates&#160;property&#160;is&#160;an array&#160;of arrays&#160;of points&#160;that&#160;represent&#160;the&#160;<br/>control&#160;points&#160;for the&#160;Bezier curve.&#160;The&#160;Flags&#160;property&#160;is&#160;an array&#160;of arrays&#160;of PolygonFlags&#160;(see<a href="libremacros.html#582">&#160;Table&#160;240)&#160;<br/></a>that&#160;identifies&#160;how&#160;the&#160;corresponding point&#160;affects&#160;the&#160;curve.&#160;<br/>
<i><b>Table&#160;240.</b>&#160;Values&#160;in&#160;the&#160;com.sun.star.drawing.PolygonFlags&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
NORMAL&#160;<br/>
The&#160;curve&#160;travels through normal&#160;points.<br/>
SMOOTH&#160;<br/>
The&#160;point&#160;is&#160;smooth through the&#160;point.<br/>
CONTROL&#160;<br/>
Influence&#160;the&#160;curve.<br/>
SYMMETRIC&#160;<br/>
The&#160;point&#160;is&#160;symmetric&#160;through&#160;the&#160;point.<br/>
The&#160;macro i<a href="libremacros.html#582">n&#160;Listing&#160;508<b>&#160;</b></a>draws&#160;a&#160;small&#160;circle&#160;at&#160;each point&#160;in&#160;the&#160;Coordinates&#160;array.&#160;Drawing&#160;each point&#160;<br/>helps&#160;to&#160;visualize&#160;and understand how&#160;the&#160;different&#160;points&#160;affect&#160;the&#160;shape&#160;of a&#160;Bezier curve.<br/>
<i><b>Listing&#160;508.</b>&#160;Draw a circle&#160;at&#160;each point&#160;in&#160;an array.</i><br/>
Sub&#160;DrawControlPoints(oCoords,&#160;oPage,&#160;oDoc,&#160;nWidth&#160;As&#160;Long)<br/>&#160;&#160;Dim&#160;oPoints&#160;&#160;'One subarray of points<br/>&#160;&#160;Dim&#160;oPoint&#160; &#160;'One point<br/>&#160;&#160;Dim&#160;oFlags&#160; &#160;'One subarray of flags<br/>&#160;&#160;Dim&#160;oShape&#160; &#160;'The circle to draw<br/>&#160;&#160;Dim&#160;nShape%&#160;&#160;'Index into the oCoords arrays<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160;'General index variable<br/>&#160;&#160;<br/>&#160;&#160;For&#160;nShape&#160;=&#160;LBound(oCoords.Coordinates)&#160;To&#160;UBound&#160;(oCoords.Coordinates)<br/>&#160; &#160;&#160;oPoints&#160;=&#160;oCoords.Coordinates(nShape)<br/>&#160; &#160;&#160;oFlags&#160;&#160;=&#160;oCoords.Flags(nShape)<br/>&#160; &#160;&#160;For&#160;i&#160;=&#160;LBound(oPoints)&#160;To&#160;UBound(oPoints)<br/>&#160; &#160; &#160;&#160;oShape&#160;=&#160;oDoc.createInstance(&#34;com.sun.star.drawing.EllipseShape&#34;)<br/>&#160; &#160; &#160;&#160;oPage.add(oShape)<br/>&#160; &#160; &#160;&#160;oPoint&#160;=&#160;oPoints(i)<br/>&#160; &#160; &#160;&#160;REM To center the circle, I need to set the position&#160;<br/>&#160; &#160; &#160;&#160;REM as half width back and half width up.<br/>&#160; &#160; &#160;&#160;oShape.setPosition(CreatePoint(oPoint.X-nWidth/2,&#160;oPoint.Y-nWidth/2))<br/>&#160; &#160; &#160;&#160;oShape.setSize(CreateSize(nWidth,&#160;nWidth)<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
579<br/>
<hr/>
<a name=583></a><a href="libremacros.html#583">Listing 509&#160;d</a>raws&#160;two disconnected&#160;Bezier curves&#160;(see<a href="libremacros.html#584">&#160;Figure&#160;124)</a>.&#160;The&#160;second curve&#160;places&#160;two control&#160;<br/>points&#160;at&#160;the&#160;same&#160;location.&#160;The&#160;DrawControlPoints&#160;macro in<a href="libremacros.html#582">&#160;Listing 508&#160;i</a>s&#160;used to draw&#160;the&#160;control&#160;points&#160;<br/>along with&#160;the&#160;Bezier curve.<br/>
<i><b>Listing&#160;509.</b>&#160;Draw an Open Bezier&#160;Curve.<br/></i>Sub&#160;DrawOpenBezierCurves()<br/>&#160;&#160;Dim&#160;oPage&#160; &#160; &#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160; &#160;&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;Dim&#160;oCoords&#160;'Coordinates of the polygon to insert<br/>&#160;&#160;Dim&#160;oDrawDoc&#160;&#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>
&#160;&#160;oCoords&#160;=&#160;createUnoStruct(&#34;com.sun.star.drawing.PolyPolygonBezierCoords&#34;)<br/>
&#160;&#160;REM Fill in the actual coordinates. The first and last points<br/>&#160;&#160;REM are normal points and the middle points are Bezier control points.<br/>&#160;&#160;oCoords.Coordinates&#160;=&#160;Array(_<br/>&#160; &#160;&#160;Array(_<br/>&#160; &#160; &#160;&#160;CreatePoint(&#160;1000,&#160;1000&#160;),_<br/>&#160; &#160; &#160;&#160;CreatePoint(&#160;2000,&#160;3000&#160;),_<br/>&#160; &#160; &#160;&#160;CreatePoint(&#160;3000,&#160;0500&#160;),_<br/>&#160; &#160; &#160;&#160;CreatePoint(&#160;4000,&#160;1000&#160;),_<br/>&#160; &#160;&#160;),_<br/>&#160; &#160;&#160;Array(_<br/>&#160; &#160; &#160;&#160;CreatePoint(&#160;5000,&#160;1000&#160;),_<br/>&#160; &#160; &#160;&#160;CreatePoint(&#160;6500,&#160;0200&#160;),_<br/>&#160; &#160; &#160;&#160;CreatePoint(&#160;6500,&#160;0200&#160;),_<br/>&#160; &#160; &#160;&#160;CreatePoint(&#160;8000,&#160;1000&#160;),_<br/>&#160; &#160;&#160;),_<br/>&#160;&#160;)<br/>&#160;&#160;oCoords.Flags&#160;=&#160;Array(_<br/>&#160; &#160;&#160;Array(_<br/>&#160; &#160; &#160;&#160;com.sun.star.drawing.PolygonFlags.NORMAL,_<br/>&#160; &#160; &#160;&#160;com.sun.star.drawing.PolygonFlags.CONTROL,_<br/>&#160; &#160; &#160;&#160;com.sun.star.drawing.PolygonFlags.CONTROL,_<br/>&#160; &#160; &#160;&#160;com.sun.star.drawing.PolygonFlags.NORMAL,_<br/>&#160; &#160;&#160;),_<br/>&#160; &#160;&#160;Array(_<br/>&#160; &#160; &#160;&#160;com.sun.star.drawing.PolygonFlags.NORMAL,_<br/>&#160; &#160; &#160;&#160;com.sun.star.drawing.PolygonFlags.CONTROL,_<br/>&#160; &#160; &#160;&#160;com.sun.star.drawing.PolygonFlags.CONTROL,_<br/>&#160; &#160; &#160;&#160;com.sun.star.drawing.PolygonFlags.NORMAL,_<br/>&#160; &#160;&#160;)_<br/>&#160;&#160;)<br/>
&#160;&#160;oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.OpenBezierShape&#34;)<br/>&#160;&#160;oPage.add(oShape)<br/>&#160;&#160;oShape.PolyPolygonBezier&#160;=&#160;oCoords<br/>&#160;&#160;DrawControlPoints(oCoords,&#160;oPage,&#160;oDrawDoc,&#160;100)<br/>End&#160;Sub<br/>
580<br/>
<hr/>
<a name=584></a><i><b>Figure&#160;124.</b>&#160;Notice&#160;how&#160;the&#160;control&#160;points&#160;influence&#160;the&#160;curve.</i><br/>
Not&#160;all&#160;combinations&#160;of points&#160;and flags&#160;are&#160;valid.&#160;&#160;A&#160;complete&#160;discussion of what&#160;constitutes&#160;a&#160;valid&#160;<br/>combination&#160;of points&#160;and flags&#160;is&#160;beyond the&#160;scope&#160;of this&#160;book.&#160;A&#160;run-time&#160;error occurs&#160;if you use&#160;an&#160;<br/>incorrect&#160;number of points&#160;or an unsupported sequence&#160;of control&#160;flags.<br/>
<i><b>ConnectorShape<br/></b></i>Use&#160;the&#160;ConnectorShape&#160;to&#160;provide&#160;a&#160;connection between two shapes.&#160;A&#160;“glue&#160;point”&#160;is&#160;a&#160;position&#160;inside&#160;a&#160;<br/>shape&#160;where&#160;the&#160;endpoint&#160;of a&#160;ConnectorShape&#160;can connect. Each glue&#160;point&#160;is&#160;defined&#160;by&#160;the&#160;GluePoint2&#160;<br/>structure&#160;(see<a href="libremacros.html#584">&#160;Table&#160;241)</a>.<br/>
<i><b>Table&#160;241.</b>&#160;Properties&#160;in the&#160;com.sun.star.drawing.GluePoint2&#160;structure.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Position<br/>
Glue-point&#160;position&#160;as&#160;a&#160;point&#160;structure.<br/>
IsRelative<br/>
If&#160;True,&#160;Position is given in 1/100&#160;percent.<br/>
PositionAlignment<br/>
com.sun.star.drawing.Alignment&#160;enumerated value&#160;that&#160;specifies&#160;how&#160;the&#160;point&#160;is moved if&#160;the&#160;<br/>
shape&#160;is resized.&#160;Valid&#160;values include:&#160;TOP_LEFT,&#160;TOP,&#160;TOP_RIGHT,&#160;LEFT,&#160;CENTER,&#160;RIGHT,<br/>BOTTOM_LEFT,&#160;BOTTOM, and&#160;BOTTOM_RIGHT.<br/>
Escape<br/>
com.sun.star.drawing.EscapeDirection enumerated&#160;value&#160;that&#160;specifies the&#160;escape&#160;direction for&#160;a&#160;<br/>glue&#160;point.&#160;Valid&#160;values include:&#160;SMART,&#160;LEFT,&#160;RIGHT,&#160;UP,&#160;DOWN, HORIZONTAL,&#160;and&#160;<br/>
VERTICAL.<br/>
IsUserDefined<br/>
If&#160;False, this&#160;is&#160;a&#160;default&#160;glue&#160;point.<br/>
Each shape&#160;contains&#160;a&#160;default&#160;glue&#160;point&#160;at&#160;the&#160;top,&#160;right, bottom,&#160;and left&#160;of the&#160;shape.&#160;You can access&#160;a&#160;<br/>shape’s&#160;glue&#160;points&#160;by&#160;using the&#160;getGluePoints() method&#160;(see<a href="libremacros.html#560">&#160;Table&#160;227)</a>.&#160;The&#160;index&#160;of the&#160;default&#160;glue&#160;<br/>points&#160;are&#160;0 (top), 1 (right),&#160;2 (bottom),&#160;and 3 (left).&#160;You also can add new&#160;glue&#160;points&#160;to a&#160;shape’s&#160;default&#160;<br/>glue&#160;points&#160;(see<a href="libremacros.html#587">&#160;Listing 511).</a><br/>
Connector shapes&#160;contain&#160;StartPosition&#160;and EndPosition properties, which identify&#160;the&#160;connector’s&#160;start&#160;and&#160;<br/>end positions.&#160;The&#160;start&#160;and end positions&#160;are&#160;used only&#160;if the&#160;corresponding&#160;properties&#160;StartShape&#160;and&#160;<br/>EndShape&#160;are&#160;empty.&#160;If&#160;the&#160;StartShape&#160;and EndShape&#160;properties&#160;are&#160;not&#160;empty,&#160;the&#160;connector&#160;shape&#160;connects<br/>to a&#160;glue&#160;point&#160;in the&#160;corresponding shape. Connector shapes&#160;reference&#160;other shapes’&#160;glue&#160;points&#160;by&#160;index&#160;<br/>using the&#160;StartGluePointIndex&#160;and EndGluePointIndex&#160;properties.<br/>
<i><b>Table&#160;242.</b>&#160;Properties&#160;in the&#160;com.sun.star.drawing.ConnectorShape&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
StartShape&#160;<br/>
Start&#160;shape,&#160;or&#160;empty&#160;if&#160;the&#160;start&#160;point&#160;is not&#160;connected&#160;to a&#160;shape.<br/>
StartGluePointIndex&#160;<br/>
Index&#160;of&#160;the&#160;glue&#160;point&#160;in the&#160;start&#160;shape.<br/>
StartPosition&#160;<br/>
Start&#160;point&#160;position&#160;in&#160;1/100&#160;mm.&#160;You can set&#160;the&#160;position only&#160;if&#160;the&#160;start&#160;point&#160;is&#160;not&#160;<br/>
connected,&#160;but&#160;you&#160;can always&#160;read&#160;the&#160;point.<br/>
EndShape&#160;<br/>
End&#160;shape,&#160;or&#160;empty&#160;if&#160;the&#160;start&#160;point&#160;is&#160;not&#160;connected to&#160;a&#160;shape.<br/>
581<br/>
<hr/>
<a name=585></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
EndPosition&#160;<br/>
End&#160;point&#160;position in 1/100 mm.&#160;You can&#160;set&#160;the&#160;position only&#160;if&#160;the&#160;end&#160;point&#160;is not&#160;connected,&#160;<br/>
but&#160;you can always read&#160;the&#160;point.<br/>
EndGluePointIndex&#160;<br/>
Index&#160;of&#160;the&#160;glue&#160;point&#160;in the&#160;end&#160;shape.<br/>
EdgeLine1Delta&#160;<br/>
Distance&#160;of&#160;line&#160;1.<br/>
EdgeLine2Delta&#160;<br/>
Distance&#160;of&#160;line&#160;2.<br/>
EdgeLine3Delta&#160;<br/>
Distance&#160;of&#160;line&#160;3.<br/>
EdgeKind<br/>
Type&#160;of&#160;connector&#160;(see<a href="libremacros.html#585">&#160;Table&#160;243)</a>.<br/>
Four connector types&#160;are&#160;supported&#160;(see<a href="libremacros.html#585">&#160;Table&#160;243)</a>.&#160;The&#160;connector&#160;type&#160;determines&#160;how&#160;the&#160;line&#160;is&#160;drawn&#160;<br/>between the&#160;two points.&#160;The&#160;STANDARD&#160;type&#160;prefers&#160;to&#160;use&#160;three&#160;lines&#160;to&#160;connect&#160;the&#160;shapes, but&#160;it&#160;will&#160;<br/>use&#160;more&#160;lines&#160;if required.<br/>
<i><b>Table&#160;243.</b>&#160;Properties&#160;in the&#160;com.sun.star.drawing.ConnectorType&#160;enumeration.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
STANDARD&#160;<br/>
The&#160;ConnectorShape&#160;is&#160;drawn&#160;with&#160;three&#160;lines, with&#160;the&#160;middle&#160;line&#160;perpendicular&#160;to the&#160;other&#160;two.<br/>
CURVE&#160;<br/>
The&#160;ConnectorShape&#160;is&#160;drawn&#160;as a&#160;curve.<br/>
LINE&#160;<br/>
The&#160;ConnectorShape&#160;is&#160;drawn&#160;as one&#160;straight&#160;line.<br/>
LINES&#160;<br/>
The&#160;ConnectorShape&#160;is&#160;drawn&#160;with&#160;three&#160;lines.<br/>
The&#160;macro i<a href="libremacros.html#585">n&#160;Listing&#160;510&#160;dra</a>ws&#160;four rectangles&#160;and then connects&#160;the&#160;rectangles&#160;using a&#160;ConnectorShape.&#160;<br/>Although the&#160;macro specifies&#160;the&#160;initial&#160;glue&#160;point,&#160;the&#160;end glue&#160;point&#160;is&#160;automatically&#160;chosen by&#160;OOo. If&#160;the<br/>macro did not&#160;explicitly&#160;set&#160;the&#160;initial&#160;glue&#160;point,&#160;it&#160;also would be&#160;automatically&#160;chosen.&#160;When a&#160;glue&#160;point&#160;<br/>is&#160;automatically&#160;chosen, it&#160;is&#160;done&#160;intelligently,&#160;as&#160;you&#160;can see&#160;in<a href="libremacros.html#587">&#160;Figure&#160;125.</a><br/>
<i><b>Listing&#160;510.</b>&#160;Illustrate&#160;four&#160;connector&#160;types.</i><br/>
Sub&#160;DrawConnectorShapeNormal<br/>&#160;&#160;DrawConnectorShape(False,&#160;False)<br/>End Sub<br/>
Sub&#160;DrawConnectorShape(doCustom&#160;As Boolean,&#160;useArrows&#160;as Boolean)<br/>&#160; Dim&#160;oPage&#160; &#160; &#160;'Page on which to draw<br/>&#160; Dim&#160;oShapes&#160; &#160;'Shapes to insert<br/>&#160; Dim&#160;oShape&#160; &#160;&#160;'Shape to insert<br/>&#160; Dim&#160;nConTypes&#160;'Array of connection types<br/>&#160; Dim&#160;i%<br/>&#160; Dim&#160;oGlue&#160; &#160; &#160;'Custom Glue Shape<br/>&#160; Dim&#160;oStyles<br/>&#160; Dim&#160;oDrawDoc&#160;&#160;'Temporary draw document.<br/>&#160;&#160;<br/>&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>&#160;&#160;<br/>&#160;&#160;nConTypes&#160;= Array(_<br/>&#160; &#160;&#160;com.sun.star.drawing.ConnectorType.STANDARD,_<br/>&#160; &#160;&#160;com.sun.star.drawing.ConnectorType.CURVE,_<br/>&#160; &#160;&#160;com.sun.star.drawing.ConnectorType.LINE,_<br/>&#160; &#160;&#160;com.sun.star.drawing.ConnectorType.LINES,_<br/>
582<br/>
<hr/>
<a name=586></a>&#160; &#160; )<br/>&#160; &#160;&#160;<br/>&#160;&#160;oShapes&#160;= Array(_<br/>&#160; &#160;&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;),_<br/>&#160; &#160;&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;),_<br/>&#160; &#160;&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;),_<br/>&#160; &#160;&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.RectangleShape&#34;),_<br/>&#160; &#160; )<br/>&#160; &#160;&#160;<br/>&#160;&#160;REM Create the draw page and then add the shapes before manipulating them.<br/>&#160;&#160;oPage&#160;=&#160;createDrawPage(oDrawDoc,&#160;&#34;Test Draw&#34;,&#160;True)<br/>&#160; For&#160;i&#160;=&#160;0&#160;To&#160;3<br/>&#160; &#160;&#160;oPage.add(oShapes(i))<br/>&#160; &#160;&#160;oShapes(i).setSize(createSize(1300,&#160;1000))<br/>&#160; Next<br/>&#160;&#160;<br/>&#160;&#160;oShapes(0).setPosition(createPoint(3000,&#160;3500))<br/>&#160;&#160;oShapes(1).setPosition(createPoint(6000,&#160;3000))<br/>&#160;&#160;oShapes(2).setPosition(createPoint(9000,&#160;2500))<br/>&#160;&#160;oShapes(3).setPosition(createPoint(6000,&#160;4500))<br/>
&#160; For&#160;i&#160;=&#160;0&#160;To&#160;3<br/>&#160; &#160;&#160;oShapes(i).setString(i)<br/>&#160; &#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.ConnectorShape&#34;)<br/>&#160; &#160;&#160;oPage.add(oShape)<br/>&#160; &#160;&#160;oShape.StartShape&#160;=&#160;oShapes(i)<br/>&#160; &#160;&#160;oShape.StartGluePointIndex&#160;=&#160;i<br/>&#160; &#160;&#160;oShape.EndShape&#160;=&#160;oShapes((i&#160;+&#160;1) MOD&#160;4)<br/>&#160; &#160;&#160;oShape.EdgeKind&#160;=&#160;nConTypes(i)<br/>&#160; &#160;&#160;<br/>&#160; &#160; If&#160;doCustom&#160;Then<br/>&#160; &#160; &#160;&#160;Rem Now create a glue point in the center of the shape.<br/>&#160; &#160; &#160;&#160;oGlue&#160;= createUnoStruct(&#34;com.sun.star.drawing.GluePoint2&#34;)<br/>&#160; &#160; &#160;&#160;oGlue.IsRelative&#160;=&#160;False<br/>&#160; &#160; &#160;&#160;oGlue.Escape&#160;=&#160;com.sun.star.drawing.EscapeDirection.SMART<br/>&#160; &#160; &#160;&#160;oGlue.PositionAlignment&#160;=&#160;com.sun.star.drawing.Alignment.CENTER<br/>&#160; &#160; &#160;&#160;oGlue.IsUserDefined&#160;=&#160;True<br/>&#160; &#160; &#160;&#160;oGlue.Position.X&#160;=&#160;oShapes(i).getPosition().X&#160;+&#160;650<br/>&#160; &#160; &#160;&#160;oGlue.Position.Y&#160;=&#160;oShapes(i).getPosition().Y&#160;+&#160;500<br/>&#160; &#160; &#160;&#160;oShape.StartGluePointIndex&#160;=&#160;oShapes(i).getGluePoints().insert(oGlue)<br/>&#160; &#160; End If<br/>&#160; &#160;&#160;<br/>&#160; &#160; If&#160;useArrows&#160;Then<br/>&#160; &#160; &#160;&#160;oStyles&#160;=&#160;oDrawDoc.getStyleFamilies().getByName(&#34;graphics&#34;)<br/>&#160; &#160; &#160;&#160;oShape.Style&#160;=&#160;oStyles.getByName(&#34;objectwitharrow&#34;)<br/>&#160; &#160; End If<br/>&#160; &#160;&#160;<br/>&#160; Next<br/>End&#160;Sub<br/>
583<br/>
<hr/>
<a name=587></a><i><b>Figure&#160;125.</b>&#160;Notice&#160;the&#160;different&#160;connector&#160;types.</i><br/>
<b>TIP</b><br/>
Many&#160;of&#160;a&#160;shape’s&#160;properties&#160;are&#160;reset&#160;when&#160;the&#160;shape&#160;is added&#160;to a&#160;draw&#160;page.&#160;Therefore,&#160;you&#160;should set&#160;<br/>
most&#160;properties after&#160;adding&#160;the&#160;shape&#160;to&#160;the&#160;draw&#160;page.&#160;It&#160;is&#160;also&#160;important&#160;to set&#160;properties in the&#160;correct&#160;<br/>order&#160;because&#160;setting&#160;some&#160;properties resets other&#160;properties. For&#160;example,&#160;setting&#160;a&#160;connector’s&#160;StartShape<br/>
resets the&#160;StartGluePointIndex.<br/>
<b>Creating&#160;your&#160;own&#160;glue&#160;points<br/></b>If&#160;you&#160;want&#160;to attach a&#160;connector to&#160;a&#160;shape&#160;at&#160;a&#160;location&#160;of your&#160;choosing, you must&#160;create&#160;a&#160;GluePoint2&#160;<br/>structure&#160;and add it&#160;to&#160;the&#160;shape. Immediately&#160;after setting&#160;the&#160;EdgeKind&#160;property,&#160;create&#160;a&#160;glue&#160;point&#160;located<br/>at&#160;the&#160;center of the&#160;rectangle&#160;and then uses&#160;this&#160;point&#160;as&#160;the&#160;start&#160;point<a href="libremacros.html#584">.&#160;Table&#160;241&#160;c</a>ontains&#160;a&#160;description of&#160;<br/>the&#160;GluePoint2 structure.<br/>
<i><b>Listing&#160;511.</b>&#160;Draw a connector&#160;shape&#160;from&#160;the&#160;center&#160;of&#160;the&#160;shape.</i><br/>
Sub&#160;DrawConnectorShapeCenter<br/>&#160;&#160;DrawConnectorShape(True,&#160;False)<br/>End&#160;Sub<br/>
<i><b>Figure&#160;126.</b>&#160;Custom&#160;glue&#160;points: Connectors&#160;start&#160;in&#160;the&#160;middle&#160;of&#160;the&#160;rectangles.</i><br/>
<b>Adding&#160;arrows&#160;by&#160;using&#160;styles<br/></b>You can set&#160;many&#160;properties&#160;for a&#160;shape&#160;by&#160;creating&#160;a&#160;style. If&#160;you frequently&#160;use&#160;certain&#160;fill&#160;styles&#160;and&#160;<br/>shadow&#160;styles, create&#160;a&#160;special&#160;style&#160;so you can quickly&#160;change&#160;the&#160;objects&#160;if require<a href="libremacros.html#587">d.&#160;Listing 512&#160;di</a>splays&#160;<br/>the&#160;style&#160;families&#160;and the&#160;graphics&#160;styles&#160;supported by&#160;a&#160;draw&#160;document.<br/>
<i><b>Listing&#160;512.</b>&#160;Print&#160;the&#160;supported graphics&#160;styles.<br/></i>Sub&#160;PrintGraphicsStyles<br/>&#160;&#160;Dim&#160;oStyles<br/>&#160;&#160;Dim&#160;oStyleFamilies<br/>&#160;&#160;Dim&#160;oDrawDoc&#160;&#160;'Temporary draw document.<br/>&#160;&#160;<br/>
584<br/>
<hr/>
<a name=588></a>&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>
&#160;&#160;oStyleFamilies&#160;=&#160;oDrawDoc.getStyleFamilies()<br/>&#160;&#160;MsgBox&#160;Join(oStyleFamilies.getElementNames(),&#160;CHR$(10)),&#160;0,&#160;&#34;Families&#34;<br/>
&#160;&#160;oStyles&#160;=&#160;oDrawDoc.getStyleFamilies().getByName(&#34;graphics&#34;)<br/>&#160;&#160;MsgBox&#160;Join(oStyles.getElementNames(),&#160;CHR$(10)),&#160;0,&#160;&#34;Graphics Styles&#34;<br/>&#160;&#160;oDrawDoc.Close(True)<br/>End&#160;Sub<br/>
<i>  </i><br/>
<i><b>Figure&#160;127.</b>&#160;Graphics&#160;styles&#160;supported by&#160;Draw documents.</i><br/>
You can add arrows&#160;to a&#160;shape&#160;by&#160;setting the&#160;shape’s&#160;style&#160;to&#160;“objectwitharrow”. If&#160;you don’t&#160;like&#160;the&#160;default&#160;<br/>values&#160;in the&#160;“objectwitharrow”&#160;style, which produces&#160;very&#160;wide&#160;lines&#160;(see<a href="libremacros.html#589">&#160;Figure&#160;128)</a>, you can create&#160;your&#160;<br/>own style&#160;and use&#160;that&#160;instead.<br/>
<i><b>Listing&#160;513.</b>&#160;Draw connectors&#160;with&#160;arrows.<br/></i>Sub&#160;ConnectorWithArrows<br/>&#160;&#160;DrawConnectorShape(False,&#160;True)<br/>End&#160;Sub<br/>
585<br/>
<hr/>
<a name=589></a><i><b>Figure&#160;128.</b>&#160;The&#160;default&#160;arrow style&#160;draws&#160;an arrow&#160;from&#160;the&#160;end shape&#160;to the&#160;start&#160;shape.</i><br/>
<i><b>Insert&#160;a&#160;TableShape<br/></b></i>The&#160;following&#160;macro inserts&#160;a&#160;TableShape&#160;into&#160;the&#160;first&#160;draw&#160;page&#160;and sets&#160;a&#160;value&#160;into a&#160;single&#160;cell.&#160;Finally,&#160;<br/>one&#160;cell&#160;is&#160;set&#160;to&#160;contain a&#160;graphic&#160;as&#160;the&#160;background fill&#160;style.<br/>
<i><b>Listing&#160;514.</b>&#160;Insert&#160;a table&#160;into&#160;a Draw or&#160;Impress&#160;document.<br/></i>Sub&#160;DrawTableShape<br/>&#160; Dim&#160;oSize&#160;as New&#160;com.sun.star.awt.Size<br/>&#160; Dim&#160;oPos&#160;as New&#160;com.sun.star.awt.Point<br/>&#160; Dim&#160;oPage&#160; &#160; &#160;' Draw page to contain the shape.<br/>&#160; Dim&#160;oTable&#160; &#160;&#160;' Table to insert.<br/>&#160; Dim&#160;oCell&#160; &#160; &#160;' A cell that will contain a value.<br/>&#160; Dim&#160;oDrawDoc&#160;&#160;' Temporary draw document.<br/>
&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>
&#160;&#160;' Set a size and table position.<br/>&#160;&#160;oSize.Width&#160;=&#160;6000&#160; &#160;:&#160;oSize.Height&#160;=&#160;6100<br/>&#160;&#160;oPos.X&#160;=&#160;6000&#160; &#160; &#160; &#160; :&#160;oPos.Y&#160;=&#160;5000<br/>&#160;&#160;<br/>&#160;&#160;' Get the first draw page<br/>&#160;&#160;oPage&#160;=&#160;oDrawDoc.DrawPages.getByIndex(0)<br/>&#160;&#160;oTable&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.TableShape&#34;)<br/>&#160;&#160;oPage.add(oTable)<br/>&#160;&#160;<br/>&#160;&#160;' Set the number of rows and columns to 5<br/>&#160;&#160;oTable.Model.Rows.InsertByIndex(1,4)<br/>&#160;&#160;oTable.Model.Columns.InsertByIndex(1,4)<br/>&#160;&#160;oTable.setSize(oSize)<br/>&#160;&#160;oTable.setPosition(oPos)<br/>&#160;&#160;<br/>&#160;&#160;' Get the cell in the first column and second row and set to contain the text X.<br/>&#160;&#160;oCell&#160;=&#160;oTable.Model.getCellByPosition(0,1)<br/>&#160;&#160;oCell.getText().setString(&#34;X&#34;)<br/>&#160;&#160;<br/>&#160;&#160;' Get the cell in the third row and column.<br/>&#160;&#160;oCell&#160;=&#160;oTable.Model.getCellByPosition(2,2)<br/>&#160;&#160;<br/>&#160;&#160;' Fill the cell with a bitmap of an image.<br/>&#160;&#160;oCell.FillStyle&#160;=&#160;com.sun.star.drawing.FillStyle.BITMAP<br/>&#160;&#160;oCell.FillBitmapURL&#160;= _<br/>
586<br/>
<hr/>
<a name=590></a>&#160; &#160; &#160; &#160; &#160;&#160;&#34;http://www.openoffice.org/images/AOO_logos/OOo_Website_v2_copy.png&#34;<br/>End Sub<br/>
<i><b>&#160;16.3.&#160;Forms<br/></b></i>When&#160;a&#160;control&#160;is&#160;inserted&#160;into&#160;a&#160;document, it&#160;is&#160;stored in a&#160;form.&#160;Forms&#160;are&#160;contained&#160;in draw&#160;pages, which&#160;<br/>implement&#160;the&#160;com.sun.star.form.XFormsSupplier&#160;interface.&#160;The&#160;visible&#160;portion&#160;of the&#160;control—what&#160;you&#160;<br/>see—is&#160;stored in a&#160;draw&#160;page&#160;and it&#160;is&#160;represented by&#160;a&#160;ControlShape.&#160;The&#160;data&#160;model&#160;for the&#160;control&#160;is&#160;<br/>stored in a&#160;form&#160;and it&#160;is&#160;referenced by&#160;the&#160;ControlShape.&#160;The&#160;method getForms() returns&#160;an object&#160;that&#160;<br/>contains&#160;the&#160;forms&#160;for the&#160;draw&#160;page&#160;(see<a href="libremacros.html#590">&#160;Table&#160;244).</a><br/>
<i><b>Table&#160;244.</b>&#160;Some&#160;methods&#160;supported by&#160;the&#160;com.sun.star.form.Forms&#160;service.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
createEnumeration()<br/>
Create&#160;an&#160;enumeration of&#160;the&#160;forms.<br/>
getByIndex(Long)<br/>
Get&#160;a&#160;form&#160;by&#160;index.<br/>
getByName(String)<br/>
Get&#160;a&#160;form&#160;by&#160;name.<br/>
getCount()<br/>
Get&#160;the&#160;number&#160;of&#160;forms.<br/>
hasByName(String)<br/>
Return&#160;True&#160;if&#160;the&#160;form&#160;with&#160;the&#160;specified&#160;name&#160;exists.<br/>
hasElements()<br/>
Return&#160;True&#160;if&#160;the&#160;page&#160;contains at&#160;least&#160;one&#160;form.<br/>
insertByIndex(Long, Form)<br/>
Insert&#160;a&#160;form&#160;by&#160;index.<br/>
insertByName(String,&#160;Form)<br/>
Insert&#160;a&#160;form&#160;by&#160;name.<br/>
removeByIndex(Long)<br/>
Remove&#160;a&#160;form&#160;by&#160;index.<br/>
removeByName(String)<br/>
Remove&#160;the&#160;named form.<br/>
replaceByIndex(Long,&#160;Form)<br/>
Replace&#160;a&#160;form&#160;by&#160;index.<br/>
replaceByName(String, Form)<br/>
Replace&#160;a&#160;form&#160;by&#160;name.<br/>
The&#160;purpose<a href="libremacros.html#590">&#160;of&#160;Listing 515&#160;i</a>s&#160;to&#160;demonstrate&#160;how&#160;to add a&#160;form&#160;to a&#160;draw&#160;page. Forms&#160;are&#160;not&#160;interesting&#160;<br/>unless&#160;they&#160;contain a&#160;control,&#160;s<a href="libremacros.html#590">o&#160;Listing 515&#160;a</a>dds&#160;a&#160;drop-down list&#160;box&#160;with some&#160;values&#160;to&#160;select.&#160;When&#160;I&#160;<br/>tested using&#160;AOO, the&#160;form&#160;was&#160;left&#160;in&#160;design mode, and you must&#160;exit&#160;design mode&#160;before&#160;you&#160;can test&#160;the&#160;<br/>control.<br/>
<i><b>Listing&#160;515.</b>&#160;Add a form&#160;with&#160;a control&#160;to&#160;the&#160;first&#160;draw&#160;page.&#160;<br/></i>&#160;&#160;Dim&#160;oPage&#160; &#160; &#160; &#160; &#160;'Page on which to draw<br/>&#160;&#160;Dim&#160;oShape&#160; &#160; &#160; &#160;&#160;'Shape to insert<br/>&#160;&#160;Dim&#160;oForm&#160; &#160; &#160; &#160; &#160;'Individual form<br/>&#160;&#160;Dim&#160;oControlModel&#160;'Model for a control<br/>&#160;&#160;Dim&#160;s&#160;(0&#160;To&#160;5)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;oDrawDoc&#160;&#160;' Temporary draw document.<br/>
&#160;&#160;oDrawDoc&#160;=&#160;LoadEmptyDocument(&#34;sdraw&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Data for the combo box!<br/>&#160;&#160;s(0)&#160;=&#160;&#34;Zero&#34;&#160; &#160;:&#160;s(1)&#160;=&#160;&#34;One&#34;&#160; &#160;:&#160;s(2)&#160;=&#160;&#34;Two&#34;<br/>&#160;&#160;s(3)&#160;=&#160;&#34;Three&#34;&#160;&#160;:&#160;s(4)&#160;=&#160;&#34;Four&#34;&#160;&#160;:&#160;s(5)&#160;=&#160;&#34;Five&#34;<br/>
&#160;&#160;oPage&#160;=&#160;oDrawDoc.DrawPages.getByIndex(0)<br/>
&#160;&#160;REM Create a shape for the control.<br/>
587<br/>
<hr/>
<a name=591></a>&#160;&#160;oShape&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.drawing.ControlShape&#34;)<br/>&#160;&#160;oShape.Position&#160;=&#160;createPoint(3000,&#160;4500)<br/>&#160;&#160;oShape.Size&#160;=&#160;createSize(2500,&#160;800)<br/>
&#160;&#160;REM Create a combo box model.<br/>&#160;&#160;oControlModel&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.form.component.ComboBox&#34;)<br/>&#160;&#160;oControlModel.Name&#160;=&#160;&#34;NumberSelection&#34;<br/>&#160;&#160;oControlModel.Text&#160;=&#160;&#34;Zero&#34;<br/>&#160;&#160;oControlModel.Dropdown&#160;=&#160;True<br/>&#160;&#160;oControlModel.StringItemList&#160;=&#160;s()<br/>
&#160;&#160;REM Set the shape's control model!<br/>&#160;&#160;oShape.Control&#160;=&#160;oControlModel<br/>
&#160;&#160;oForm&#160;=&#160;oDrawDoc.createInstance(&#34;com.sun.star.form.component.Form&#34;)<br/>&#160;&#160;oForm.Name&#160;=&#160;&#34;NumberForm&#34;<br/>&#160;&#160;oPage.Forms.insertByIndex(&#160;0,&#160;oForm&#160;)<br/>&#160;&#160;<br/>&#160;&#160;REM Add the control model to the first form in the collection.<br/>&#160;&#160;oForm.insertByIndex(&#160;0,&#160;oControlModel&#160;)<br/>&#160;&#160;oPage.add(&#160;oShape&#160;)<br/>End&#160;Sub<br/>
Regular forms, as&#160;created by<a href="libremacros.html#590">&#160;Listing 515, g</a>roup form&#160;components&#160;together.&#160;A&#160;DataForm, however,&#160;can&#160;<br/>connect&#160;to a&#160;database&#160;and display&#160;the&#160;results&#160;of SQL&#160;queries.&#160;An HTMLForm, on the&#160;other hand, contains&#160;<br/>controls&#160;specific&#160;to&#160;HTML&#160;pages.<br/>
<i><b>Table&#160;245.</b>&#160;Control&#160;component&#160;that&#160;can be&#160;added to&#160;forms.</i><br/>
<i><b>Component</b></i><br/>
<i><b>Description</b></i><br/>
CheckBox&#160;<br/>
Check&#160;box&#160;control.<br/>
ComboBox&#160;<br/>
Provides text&#160;input&#160;or&#160;selection from&#160;a&#160;list&#160;of&#160;text&#160;values.<br/>
CommandButton&#160;<br/>
A&#160;clickable&#160;button.<br/>
CurrencyField&#160;<br/>
An&#160;edit&#160;field with&#160;a&#160;currency&#160;value.<br/>
DatabaseCheckBox&#160;<br/>
A&#160;data-aware&#160;check&#160;box&#160;that&#160;can be&#160;bound to a&#160;database&#160;field.<br/>
DatabaseComboBox&#160;<br/>
A&#160;data-aware&#160;combo box that&#160;can&#160;be&#160;bound to&#160;a&#160;database&#160;field.<br/>
DatabaseCurrencyField&#160;<br/>
A&#160;data-aware&#160;edit&#160;field&#160;with a&#160;currency&#160;value&#160;that&#160;can&#160;be&#160;bound to&#160;a&#160;database&#160;field.<br/>
DatabaseDateField&#160;<br/>
A&#160;data-aware&#160;date&#160;field that&#160;can&#160;be&#160;bound to&#160;a&#160;database&#160;field.<br/>
DatabaseFormattedField&#160;<br/>
A&#160;data-aware&#160;formatted field&#160;that&#160;can be&#160;bound to a&#160;database&#160;field.<br/>
DatabaseImageControl&#160;<br/>
A&#160;field&#160;for&#160;displaying&#160;images stored&#160;in a&#160;database.<br/>
DatabaseListBox&#160;<br/>
A&#160;data-aware&#160;list&#160;box that&#160;can&#160;be&#160;bound to&#160;a&#160;database&#160;field.<br/>
DatabaseNumericField&#160;<br/>
A&#160;data-aware&#160;numeric&#160;field&#160;that&#160;can be&#160;bound&#160;to a&#160;database&#160;field.<br/>
DatabasePatternField&#160;<br/>
A&#160;data-aware&#160;pattern field&#160;that&#160;can be&#160;bound to a&#160;database&#160;field.<br/>
DatabaseRadioButton&#160;<br/>
A&#160;data-aware&#160;radio button that&#160;can be&#160;bound to a&#160;database&#160;field.<br/>
DatabaseTextField&#160;<br/>
A&#160;data-aware&#160;text&#160;field that&#160;can&#160;be&#160;bound to&#160;a&#160;database&#160;field.<br/>
DatabaseTimeField&#160;<br/>
A&#160;data-aware&#160;time&#160;field&#160;that&#160;can be&#160;bound to a&#160;database&#160;field.<br/>
DateField&#160;<br/>
An&#160;edit&#160;field with&#160;a&#160;date&#160;value.<br/>
FileControl&#160;<br/>
An&#160;edit&#160;field for&#160;a&#160;file&#160;name.<br/>
588<br/>
<hr/>
<a name=592></a><i><b>Component</b></i><br/>
<i><b>Description</b></i><br/>
FixedText&#160;<br/>
Display&#160;text&#160;that&#160;cannot&#160;be&#160;edited by&#160;the&#160;user.<br/>
FormattedField&#160;<br/>
An&#160;edit&#160;field that&#160;contains&#160;formatted text.<br/>
GridControl&#160;<br/>
Display&#160;data&#160;in a&#160;table-like&#160;way.<br/>
GroupBox&#160;<br/>
A&#160;control&#160;that&#160;can&#160;visually&#160;group&#160;controls.<br/>
HiddenControl&#160;<br/>
A&#160;control&#160;that&#160;is&#160;hidden.<br/>
ImageButton&#160;<br/>
A&#160;clickable&#160;button which is&#160;represented by&#160;an&#160;image.<br/>
ListBox&#160;<br/>
A&#160;control&#160;with&#160;multiple&#160;values from&#160;which&#160;to choose.<br/>
NumericField&#160;<br/>
An&#160;edit&#160;field with&#160;a&#160;numeric&#160;value.<br/>
PatternField&#160;<br/>
An&#160;edit&#160;field with&#160;text&#160;that&#160;matches&#160;a&#160;pattern.<br/>
RadioButton&#160;<br/>
A&#160;radio&#160;button.<br/>
TextField&#160;<br/>
A&#160;text-edit&#160;field&#160;that&#160;supports&#160;single-line&#160;and&#160;multi-line&#160;data.<br/>
TimeField&#160;<br/>
An&#160;edit&#160;field with&#160;a&#160;time&#160;value.<br/>
<i><b>&#160;16.4.&#160;Presentations<br/></b></i>The&#160;Presentation&#160;service&#160;contains&#160;properties&#160;(see<a href="libremacros.html#592">&#160;Table&#160;246) a</a>nd methods&#160;that&#160;control&#160;a&#160;specific&#160;<br/>presentation.&#160;You can create&#160;multiple&#160;presentation objects&#160;for different&#160;types&#160;of presentations. For example,&#160;<br/>you&#160;might&#160;have&#160;one&#160;presentation&#160;that&#160;runs&#160;continuously&#160;at&#160;a&#160;trade&#160;show&#160;and one&#160;that&#160;requires&#160;manual&#160;<br/>intervention—for example,&#160;for a&#160;client&#160;sales&#160;visit.&#160;The&#160;document’s&#160;getPresentation() method&#160;returns&#160;a&#160;new&#160;<br/>presentation object.&#160;After setting a&#160;presentation’s&#160;properties&#160;as&#160;shown in<a href="libremacros.html#592">&#160;Table&#160;246, t</a>he&#160;methods&#160;start() and&#160;<br/>end() are&#160;used to start&#160;and stop&#160;a&#160;presentation.&#160;The&#160;method&#160;rehearseTimings() starts&#160;a&#160;presentation&#160;while&#160;<br/>displaying&#160;a&#160;running clock to&#160;help you determine&#160;the&#160;running time&#160;of your&#160;presentation.<br/>
<i><b>Table&#160;246.</b>&#160;Properties&#160;defined&#160;by&#160;the&#160;the&#160;com.sun.star.presentation.Presentation&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
AllowAnimations&#160;<br/>
If&#160;True,&#160;animations&#160;are&#160;enabled.<br/>
CustomShow&#160;<br/>
Name&#160;of&#160;a&#160;customized&#160;show&#160;to&#160;use&#160;for&#160;this&#160;presentation;&#160;an empty&#160;value&#160;is&#160;allowed.<br/>
FirstPage&#160;<br/>
Name&#160;of&#160;the&#160;first&#160;page&#160;in the&#160;presentation;&#160;an empty&#160;value&#160;is allowed.<br/>
IsAlwaysOnTop&#160;<br/>
If&#160;True,&#160;the&#160;presentation window&#160;is always&#160;the&#160;top&#160;window.<br/>
IsAutomatic&#160;<br/>
If&#160;True,&#160;page&#160;changes happen automatically.<br/>
IsEndless&#160;<br/>
If&#160;True,&#160;the&#160;presentation repeats endlessly.<br/>
IsFullScreen&#160;<br/>
If&#160;True,&#160;the&#160;presentation runs&#160;in&#160;full-screen mode.<br/>
IsLivePresentation&#160;<br/>
If&#160;True,&#160;the&#160;presentation runs&#160;in&#160;live&#160;mode.<br/>
IsMouseVisible&#160;<br/>
If&#160;True,&#160;the&#160;mouse&#160;is visible&#160;during&#160;the&#160;presentation.<br/>
Pause&#160;<br/>
Long Integer&#160;duration&#160;that&#160;the&#160;black screen is displayed&#160;after&#160;the&#160;presentation is&#160;finished.<br/>
StartWithNavigator&#160;<br/>
If&#160;True,&#160;the&#160;Navigator&#160;opens at&#160;the&#160;start&#160;of&#160;the&#160;presentation.<br/>
UsePen&#160;<br/>
If&#160;True,&#160;a&#160;pen appears during&#160;the&#160;presentation so that&#160;you can draw&#160;on the&#160;screen.<br/>
<i><b>Listing&#160;516.</b>&#160;Start&#160;the&#160;current&#160;presentation.<br/></i>Sub&#160;SimplePresentation()<br/>&#160;&#160;Dim&#160;oPres<br/>&#160;&#160;oPres&#160;=&#160;ThisComponent.getPresentation()<br/>
589<br/>
<hr/>
<a name=593></a>&#160;&#160;oPres.UsePen&#160;=&#160;True<br/>&#160;&#160;REM This will start the presentation.<br/>&#160;&#160;REM Be ready to press the space bar to move through the slides.<br/>&#160;&#160;oPres.Start()<br/>End&#160;Sub<br/>
A&#160;custom&#160;presentation can show&#160;the&#160;presentation’s&#160;pages&#160;in any&#160;order.&#160;Pages&#160;can be&#160;shown multiple&#160;times&#160;or<br/>not&#160;at&#160;all.&#160;The&#160;getCustomPresentations() method&#160;returns&#160;a&#160;custom&#160;presentations&#160;object&#160;that&#160;contains&#160;all&#160;<br/>custom&#160;presentations&#160;(see<a href="libremacros.html#593">&#160;Table&#160;247)</a>.<br/>
<i><b>Table&#160;247.</b>&#160;Some&#160;methods&#160;supported by&#160;the&#160;XCustomPresentationSupplier&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
createInstance()<br/>
Create&#160;a&#160;custom&#160;presentation.<br/>
getByName(String)<br/>
Get&#160;a&#160;custom&#160;presentation by&#160;name.<br/>
getElementNames()<br/>
Array&#160;of&#160;custom&#160;presentation names.<br/>
hasByName(String)<br/>
Return&#160;True&#160;if&#160;the&#160;custom&#160;presentation with&#160;the&#160;specified&#160;name&#160;exists.<br/>
hasElements()<br/>
Return&#160;True&#160;if&#160;the&#160;page&#160;contains at&#160;least&#160;one&#160;custom&#160;presentation.<br/>
insertByName(String,&#160;CustomPresentation)<br/>
Insert&#160;a&#160;custom&#160;presentation by&#160;name.<br/>
removeByName(String)<br/>
Remove&#160;the&#160;named custom&#160;presentation.<br/>
replaceByName(String, CustomPresentation)<br/>
Replace&#160;a&#160;custom&#160;presentation by&#160;name.<br/>
A&#160;custom&#160;presentation is&#160;a&#160;container for draw&#160;pages&#160;that&#160;supports&#160;the&#160;XNamed and XIndexedAccess&#160;<br/>interfaces. Create&#160;the&#160;custom&#160;presentation,&#160;add the&#160;draw&#160;pages&#160;in&#160;the&#160;order that&#160;you want&#160;them&#160;to&#160;appear,&#160;and<br/>then save&#160;the&#160;custom&#160;presentation.&#160;A&#160;custom&#160;presentation&#160;is&#160;displayed in&#160;exactly&#160;the&#160;same&#160;way&#160;that&#160;regular&#160;<br/>presentations&#160;are&#160;displayed, using a&#160;Presentation object,&#160;but&#160;the&#160;CustomShow&#160;attribute&#160;is&#160;set&#160;to&#160;reference&#160;the&#160;<br/>custom&#160;presentation.<br/>
<i><b>Listing&#160;517.</b>&#160;Creating a custom&#160;presentation.</i><br/>
Sub&#160;CustomPresentation()<br/>&#160;&#160;Dim&#160;oPres&#160; &#160;'Presentations, both customer and regular<br/>&#160;&#160;Dim&#160;oPages&#160;&#160;'Draw pages<br/>&#160;&#160;<br/>&#160;&#160;oPres&#160;&#160;=&#160;ThisComponent.getCustomPresentations().createInstance()<br/>&#160;&#160;If&#160;NOT&#160;ThisComponent.getCustomPresentations().hasByName(&#34;custom&#34;)&#160;Then<br/>&#160; &#160;&#160;oPages&#160;=&#160;ThisComponent.getDrawPages()<br/>
&#160; &#160;&#160;REM Display pages 0, 2, 1, 0<br/>&#160; &#160;&#160;oPres.insertByIndex(0,&#160;oPages.getByIndex(0))<br/>&#160; &#160;&#160;oPres.insertByIndex(1,&#160;oPages.getByIndex(2))<br/>&#160; &#160;&#160;oPres.insertByIndex(2,&#160;oPages.getByIndex(1))<br/>&#160; &#160;&#160;oPres.insertByIndex(3,&#160;oPages.getByIndex(0))<br/>&#160; &#160;&#160;ThisComponent.getCustomPresentations().insertByName(&#34;custom&#34;,&#160;oPres)<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM Now, run the customer presentation.<br/>&#160;&#160;oPres&#160;=&#160;ThisComponent.getPresentation()<br/>&#160;&#160;oPres.CustomShow&#160;=&#160;&#34;custom&#34;<br/>&#160;&#160;oPres.Start()<br/>End&#160;Sub<br/>
590<br/>
<hr/>
<a name=594></a><b>&#160;16.4.1.&#160;Presentation&#160;draw&#160;pages<br/></b>Draw&#160;pages&#160;in&#160;a&#160;presentation document&#160;are&#160;slightly&#160;different&#160;from&#160;those&#160;in a&#160;drawing&#160;document.&#160;The&#160;<br/>properties&#160;i<a href="libremacros.html#594">n&#160;Table&#160;248&#160;di</a>ctate&#160;how&#160;and when page&#160;transitions&#160;occur while&#160;showing presentations.<br/>
<i><b>Table&#160;248.</b>&#160;Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.presentation.DrawPage&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Change&#160;<br/>
Long&#160;Integer&#160;that&#160;specifies&#160;what&#160;causes a&#160;page&#160;change.<br/>•<br/>
0 –&#160;A&#160;mouse-click&#160;triggers the&#160;next&#160;animation&#160;or&#160;page&#160;change.<br/>
•<br/>
1 –&#160;The&#160;page&#160;change&#160;is&#160;automatic.<br/>
•<br/>
2 –&#160;Object&#160;effects&#160;run automatically,&#160;but&#160;the&#160;user&#160;must&#160;click on&#160;the&#160;page&#160;to change&#160;it.<br/>
Duration&#160;<br/>
Long&#160;Integer&#160;time&#160;in seconds&#160;the&#160;page&#160;is shown if&#160;the&#160;Change&#160;property&#160;is set&#160;to&#160;1.<br/>
Effect&#160;<br/>
Effect&#160;used&#160;to fade&#160;in or&#160;out&#160;(see<a href="libremacros.html#594">&#160;Table&#160;249)</a>.<br/>
Layout&#160;<br/>
Index of&#160;the&#160;presentation layout&#160;page&#160;if&#160;this&#160;is&#160;not&#160;zero.<br/>
Speed&#160;<br/>
Speed of&#160;the&#160;fade-in&#160;effect&#160;using&#160;the&#160;com.sun.star.presentation.AnimationSpeed&#160;enumeration:&#160;<br/>SLOW,&#160;MEDIUM,&#160;or&#160;FAST.<br/>
Page&#160;transitions&#160;are&#160;governed by&#160;the&#160;Effect&#160;property&#160;of the&#160;presentation&#160;draw&#160;page&#160;(see<a href="libremacros.html#594">&#160;Table&#160;249)</a>.<br/>
<i><b>Table&#160;249.</b>&#160;Values&#160;defined by&#160;the&#160;com.sun.star.presentation.FadeEffect&#160;enumeration.</i><br/>
<i><b>Values</b></i><br/>
<i><b>Values</b></i><br/>
<i><b>Values</b></i><br/>
NONE<br/>
VERTICAL_STRIPES<br/>
HORIZONTAL_STRIPES<br/>
DISSOLVE<br/>
VERTICAL_CHECKERBOARD<br/>
HORIZONTAL_CHECKERBOARD<br/>
RANDOM<br/>
VERTICAL_LINES<br/>
HORIZONTAL_LINES<br/>
FADE_FROM_LEFT<br/>
MOVE_FROM_LEFT<br/>
UNCOVER_TO_LEFT<br/>
FADE_FROM_TOP<br/>
MOVE_FROM_TOP<br/>
UNCOVER_TO_UPPERLEFT<br/>
FADE_FROM_RIGHT<br/>
MOVE_FROM_RIGHT<br/>
UNCOVER_TO_TOP<br/>
FADE_FROM_BOTTOM<br/>
MOVE_FROM_BOTTOM<br/>
UNCOVER_TO_UPPERRIGHT<br/>
FADE_FROM_UPPERLEFT<br/>
MOVE_FROM_UPPERLEFT<br/>
UNCOVER_TO_RIGHT<br/>
FADE_FROM_UPPERRIGHT<br/>
MOVE_FROM_UPPERRIGHT<br/>
UNCOVER_TO_LOWERRIGHT<br/>
FADE_FROM_LOWERLEFT<br/>
MOVE_FROM_LOWERRIGHT<br/>
UNCOVER_TO_BOTTOM<br/>
FADE_FROM_LOWERRIGHT<br/>
MOVE_FROM_LOWERLEFT<br/>
UNCOVER_TO_LOWERLEFT<br/>
FADE_TO_CENTER<br/>
ROLL_FROM_LEFT<br/>
CLOSE_VERTICAL<br/>
FADE_FROM_CENTER<br/>
ROLL_FROM_TOP<br/>
CLOSE_HORIZONTAL<br/>
CLOCKWISE<br/>
ROLL_FROM_RIGHT<br/>
OPEN_VERTICAL<br/>
COUNTERCLOCKWISE<br/>
ROLL_FROM_BOTTOM<br/>
OPEN_HORIZONTAL<br/>
STRETCH_FROM_LEFT<br/>
WAVYLINE_FROM_LEFT<br/>
SPIRALIN_LEFT<br/>
STRETCH_FROM_TOP<br/>
WAVYLINE_FROM_TOP<br/>
SPIRALIN_RIGHT<br/>
STRETCH_FROM_RIGHT<br/>
WAVYLINE_FROM_RIGHT<br/>
SPIRALOUT_LEFT<br/>
STRETCH_FROM_BOTTOM<br/>
WAVYLINE_FROM_BOTTOM<br/>
SPIRALOUT_RIGHT<br/>
The&#160;following&#160;macro sets&#160;the&#160;transitions&#160;on all&#160;draw&#160;pages&#160;to&#160;RANDOM.<br/>
<i><b>Listing&#160;518.</b>&#160;Set&#160;Transition&#160;Effects&#160;to&#160;RANDOM.<br/></i>Sub&#160;SetTransitionEffects()<br/>
591<br/>
<hr/>
<a name=595></a>&#160;&#160;Dim&#160;oPages&#160;&#160;'Draw pages<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;<br/>&#160;&#160;oPages&#160;=&#160;ThisComponent.getDrawPages()<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oPages.getCount()&#160;-&#160;1<br/>&#160; &#160;&#160;With&#160;oPages.getByIndex(i)<br/>&#160; &#160; &#160;&#160;.Effect&#160;=&#160;com.sun.star.presentation.FadeEffect.RANDOM<br/>&#160; &#160; &#160;&#160;.Change&#160;=&#160;1<br/>&#160; &#160; &#160;&#160;.Duration&#160;=&#160;2<br/>&#160; &#160; &#160;&#160;.Speed&#160;=&#160;com.sun.star.presentation.AnimationSpeed.FAST<br/>&#160; &#160;&#160;End&#160;With<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
<b>&#160;16.4.2.&#160;Presentation&#160;shapes<br/></b>Shapes&#160;contained in&#160;Impress&#160;documents&#160;differ from&#160;shapes&#160;in Draw&#160;documents&#160;in&#160;that&#160;they&#160;support&#160;the&#160;<br/>com.sun.star.presentation.Shape&#160;service.&#160;The&#160;presentation&#160;Shape&#160;service&#160;provides&#160;properties&#160;that&#160;define&#160;<br/>special&#160;behavior to&#160;enhance&#160;presentations&#160;(see<a href="libremacros.html#595">&#160;Table&#160;250).</a><br/>
<i><b>Table&#160;250.</b>&#160;Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.presentation.Shape&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Bookmark<br/>
Generic&#160;URL&#160;string&#160;used&#160;if&#160;the&#160;OnClick&#160;property&#160;requires a&#160;URL.<br/>
DimColor<br/>
Color&#160;for&#160;dimming&#160;this&#160;shape&#160;if&#160;DimPrevious is&#160;True&#160;and DimHide&#160;is&#160;False.<br/>
DimHide<br/>
If&#160;True&#160;and DimPrevious is&#160;True, the&#160;shape&#160;is hidden.<br/>
DimPrevious<br/>
If&#160;True, the&#160;shape&#160;is dimmed after&#160;executing&#160;its animation effect.<br/>
Effect<br/>
Animation effect&#160;for&#160;this shape&#160;(see<a href="libremacros.html#596">&#160;Table&#160;251)</a>.<br/>
IsEmptyPresentationObject<br/>
True&#160;if&#160;this&#160;is&#160;the&#160;default&#160;presentation&#160;shape&#160;and&#160;it&#160;is&#160;empty.<br/>
IsPresentationObject<br/>
True&#160;if&#160;this&#160;is&#160;a&#160;presentation&#160;object.<br/>
OnClick<br/>
Specify&#160;an&#160;action if&#160;the&#160;user&#160;clicks&#160;the&#160;shape&#160;(see<a href="libremacros.html#597">&#160;Table&#160;252)</a>.<br/>
PlayFull<br/>
If&#160;True, the&#160;sound&#160;of&#160;this&#160;shape&#160;is played&#160;in&#160;full.<br/>
PresentationOrder<br/>
Long&#160;Integer&#160;representing&#160;the&#160;order&#160;in&#160;which the&#160;shapes&#160;are&#160;animated.<br/>
Sound<br/>
URL&#160;string&#160;for&#160;a&#160;sound file&#160;that&#160;is played&#160;while&#160;the&#160;shape’s&#160;animation is&#160;running.<br/>
SoundOn<br/>
If&#160;True, sound is&#160;played&#160;during&#160;the&#160;animation.<br/>
Speed<br/>
Speed of&#160;the&#160;fade-in&#160;effect&#160;using&#160;the&#160;com.sun.star.presentation.AnimationSpeed&#160;<br/>
enumeration:&#160;SLOW,&#160;MEDIUM, or&#160;FAST.<br/>
TextEffect<br/>
Animation effect&#160;for&#160;the&#160;text&#160;inside&#160;this shape&#160;(see<a href="libremacros.html#596">&#160;Table&#160;251)</a>.<br/>
Verb<br/>
Long&#160;Integer&#160;“ole2”&#160;verb&#160;if&#160;the&#160;ClickAction is&#160;VERB.<br/>
The&#160;animation&#160;effects&#160;supported by&#160;shapes&#160;(see<a href="libremacros.html#594">&#160;Table&#160;249)</a>&#160;are&#160;similar to,&#160;but&#160;more&#160;plentiful&#160;than,&#160;the&#160;<br/>animation&#160;effects&#160;supported by&#160;draw&#160;pages&#160;(see<a href="libremacros.html#596">&#160;Table&#160;251)</a>.<br/>
592<br/>
<hr/>
<a name=596></a><i><b>Table&#160;251.</b>&#160;Values&#160;defined by&#160;the&#160;com.sun.star.presentation.AnimationEffect&#160;enumeration.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Property</b></i><br/>
<i><b>Property</b></i><br/>
NONE<br/>
DISSOLVE<br/>
CLOCKWISE<br/>
RANDOM<br/>
APPEAR<br/>
COUNTERCLOCKWISE<br/>
PATH<br/>
HIDE<br/>
MOVE_FROM_LEFT<br/>
MOVE_TO_LEFT<br/>
MOVE_SHORT_TO_LEFT<br/>
MOVE_FROM_TOP<br/>
MOVE_TO_TOP<br/>
MOVE_SHORT_TO_TOP<br/>
MOVE_FROM_RIGHT<br/>
MOVE_TO_RIGHT<br/>
MOVE_SHORT_TO_RIGHT<br/>
MOVE_FROM_BOTTOM<br/>
MOVE_TO_BOTTOM<br/>
MOVE_SHORT_TO_BOTTOM<br/>
MOVE_FROM_UPPERLEFT<br/>
MOVE_TO_UPPERLEFT<br/>
MOVE_SHORT_TO_UPPERLEFT<br/>
MOVE_FROM_UPPERRIGHT<br/>
MOVE_TO_UPPERRIGHT<br/>
MOVE_SHORT_TO_UPPERRIGHT<br/>
MOVE_FROM_LOWERRIGHT<br/>
MOVE_TO_LOWERRIGHT<br/>
MOVE_SHORT_TO_LOWERRIGHT<br/>
MOVE_FROM_LOWERLEFT<br/>
MOVE_TO_LOWERLEFT<br/>
MOVE_SHORT_TO_LOWERLEFT<br/>
MOVE_SHORT_FROM_LEFT<br/>
LASER_FROM_LEFT<br/>
STRETCH_FROM_LEFT<br/>
MOVE_SHORT_FROM_TOP<br/>
LASER_FROM_TOP<br/>
STRETCH_FROM_UPPERLEFT<br/>
MOVE_SHORT_FROM_RIGHT<br/>
LASER_FROM_RIGHT<br/>
STRETCH_FROM_TOP<br/>
MOVE_SHORT_FROM_BOTTOM<br/>
LASER_FROM_BOTTOM<br/>
STRETCH_FROM_UPPERRIGHT<br/>
MOVE_SHORT_FROM_UPPERLEFT<br/>
LASER_FROM_UPPERLEFT<br/>
STRETCH_FROM_RIGHT<br/>
MOVE_SHORT_FROM_UPPERRIGHT<br/>
LASER_FROM_UPPERRIGHT<br/>
STRETCH_FROM_LOWERRIGHT<br/>
MOVE_SHORT_FROM_LOWERRIGHT<br/>
LASER_FROM_LOWERLEFT<br/>
STRETCH_FROM_BOTTOM<br/>
MOVE_SHORT_FROM_LOWERLEFT<br/>
LASER_FROM_LOWERRIGHT<br/>
STRETCH_FROM_LOWERLEFT<br/>
ZOOM_IN_FROM_LEFT<br/>
ZOOM_OUT_FROM_LEFT<br/>
FADE_FROM_LEFT<br/>
ZOOM_IN_FROM_TOP<br/>
ZOOM_OUT_FROM_TOP<br/>
FADE_FROM_TOP<br/>
ZOOM_IN_FROM_RIGHT<br/>
ZOOM_OUT_FROM_RIGHT<br/>
FADE_FROM_RIGHT<br/>
ZOOM_IN_FROM_BOTTOM<br/>
ZOOM_OUT_FROM_BOTTOM<br/>
FADE_FROM_BOTTOM<br/>
ZOOM_IN_FROM_CENTER<br/>
ZOOM_OUT_FROM_CENTER<br/>
FADE_FROM_CENTER<br/>
ZOOM_IN_FROM_UPPERLEFT<br/>
ZOOM_OUT_FROM_UPPERLEFT<br/>
FADE_FROM_UPPERLEFT<br/>
ZOOM_IN_FROM_UPPERRIGHT<br/>
ZOOM_OUT_FROM_UPPERRIGHT<br/>
FADE_FROM_UPPERRIGHT<br/>
ZOOM_IN_FROM_LOWERRIGHT<br/>
ZOOM_OUT_FROM_LOWERRIGHT<br/>
FADE_FROM_LOWERLEFT<br/>
ZOOM_IN_FROM_LOWERLEFT<br/>
ZOOM_OUT_FROM_LOWERLEFT<br/>
FADE_FROM_LOWERRIGHT<br/>FADE_TO_CENTER<br/>
ZOOM_IN<br/>
VERTICAL_CHECKERBOARD<br/>
VERTICAL_STRIPES<br/>
ZOOM_IN_SMALL<br/>
HORIZONTAL_CHECKERBOARD<br/>
HORIZONTAL_STRIPES<br/>
ZOOM_IN_SPIRAL<br/>
HORIZONTAL_ROTATE<br/>
VERTICAL_LINES<br/>
ZOOM_OUT<br/>
VERTICAL_ROTATE<br/>
HORIZONTAL_LINES<br/>
ZOOM_OUT_SMALL<br/>
HORIZONTAL_STRETCH<br/>
ZOOM_OUT_SPIRAL<br/>
VERTICAL_STRETCH<br/>
WAVYLINE_FROM_LEFT<br/>
SPIRALIN_LEFT<br/>
CLOSE_VERTICAL<br/>
WAVYLINE_FROM_TOP<br/>
SPIRALIN_RIGHT<br/>
CLOSE_HORIZONTAL<br/>
WAVYLINE_FROM_RIGHT<br/>
SPIRALOUT_LEFT<br/>
OPEN_VERTICAL<br/>
WAVYLINE_FROM_BOTTOM<br/>
SPIRALOUT_RIGHT<br/>
OPEN_HORIZONTAL<br/>
Shapes&#160;contained in&#160;presentation documents&#160;support&#160;special&#160;actions&#160;by&#160;setting&#160;the&#160;shape’s&#160;OnClick property.<br/>
593<br/>
<hr/>
<a name=597></a><i><b>Table&#160;252.</b>&#160;Values&#160;defined by&#160;the&#160;com.sun.star.presentation.ClickAction&#160;enumeration.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
NONE&#160;<br/>
No&#160;action&#160;is performed.<br/>
PREVPAGE&#160;<br/>
Jump&#160;to the&#160;previous page.<br/>
NEXTPAGE&#160;<br/>
Jump&#160;to the&#160;next&#160;page.<br/>
FIRSTPAGE&#160;<br/>
Jump&#160;to the&#160;first&#160;page.<br/>
LASTPAGE&#160;<br/>
Jump&#160;to the&#160;last&#160;page.<br/>
BOOKMARK&#160;<br/>
Jump&#160;to a&#160;bookmark specified&#160;by&#160;the&#160;Bookmark property&#160;in<a href="libremacros.html#595">&#160;Table&#160;250.</a><br/>
DOCUMENT&#160;<br/>
Jump&#160;to another&#160;document&#160;specified&#160;by&#160;the&#160;Bookmark property&#160;i<a href="libremacros.html#595">n&#160;Table&#160;250.</a><br/>
INVISIBLE&#160;<br/>
The&#160;object&#160;becomes invisible.<br/>
SOUND&#160;<br/>
Play&#160;a&#160;sound specified by&#160;the&#160;Bookmark&#160;property&#160;in<a href="libremacros.html#595">&#160;Table&#160;250.</a><br/>
VERB&#160;<br/>
An&#160;OLE&#160;verb&#160;is performed as specified by&#160;the&#160;Verb&#160;property&#160;in<a href="libremacros.html#595">&#160;Table&#160;250.&#160;</a>An&#160;OLE&#160;object&#160;<br/>supports actions called&#160;verbs.&#160;An&#160;OLE&#160;object&#160;that&#160;displays a&#160;video clip might&#160;support&#160;the&#160;<br/>
verb&#160;“play,”&#160;for&#160;example.<br/>
VANISH&#160;<br/>
The&#160;object&#160;vanishes.<br/>
PROGRAM&#160;<br/>
Execute&#160;another&#160;program&#160;specified by&#160;the&#160;Bookmark&#160;property&#160;in<a href="libremacros.html#595">&#160;Table&#160;250.</a><br/>
MACRO&#160;<br/>
Execute&#160;a&#160;Star&#160;Basic&#160;macro specified by&#160;the&#160;Bookmark&#160;property&#160;in<a href="libremacros.html#595">&#160;Table&#160;250.</a><br/>
STOPPRESENTATION&#160;<br/>
Stop&#160;the&#160;presentation.<br/>
<i><b>&#160;16.5.&#160;Conclusion<br/></b></i>Impress&#160;and Draw&#160;documents&#160;contain&#160;numerous&#160;features&#160;supporting drawing&#160;and graphics&#160;in documents.&#160;<br/>Both&#160;types&#160;of documents&#160;have&#160;many&#160;drawing and graphical&#160;presentation features&#160;in&#160;common,&#160;and Impress&#160;<br/>documents&#160;facilitate&#160;the&#160;construction of graphic&#160;presentations&#160;with&#160;support&#160;for manual&#160;or automatic&#160;page&#160;<br/>presentation.&#160;Although these&#160;documents&#160;support&#160;the&#160;display&#160;of bit-mapped images, their strength&#160;is&#160;vector&#160;<br/>drawings&#160;rather than&#160;photographic&#160;images.&#160;The&#160;results&#160;possible&#160;with Impress&#160;and Draw&#160;documents&#160;range&#160;<br/>from&#160;simple&#160;to&#160;quite&#160;complex.&#160;Consider this&#160;chapter as&#160;only&#160;a&#160;starting point&#160;for your explorations&#160;on the&#160;<br/>capabilities&#160;of these&#160;two document&#160;types.<br/>
594<br/>
<hr/>
<a name=598></a><b>&#160;17.&#160;Library&#160;Management<br/></b>This&#160;chapter discusses&#160;how&#160;and where&#160;macro libraries&#160;are&#160;stored, along with methods&#160;you&#160;can use&#160;to&#160;<br/>manipulate&#160;them.&#160;This&#160;chapter also&#160;covers&#160;the&#160;subtleties&#160;of the&#160;macro organizer as&#160;well&#160;as&#160;using the&#160;UNO&#160;<br/>API&#160;to manipulate&#160;libraries&#160;and modules.<br/>
This&#160;chapter assumes&#160;a&#160;basic&#160;understanding&#160;of library&#160;containers, libraries, and modules.&#160;If&#160;the&#160;following&#160;<br/>summary&#160;is&#160;not&#160;familiar,&#160;review&#160;the&#160;material&#160;presented in&#160;Chapte<a href="libremacros.html#17">r&#160;2, “Getting Started.”</a><br/>
•<br/>
A library container contains zero or more libraries.<br/>
•<br/>
Each library contains zero or more modules and dialogs.<br/>
•<br/>
Each module contains zero or more macros.<br/>
•<br/>
The application is a library container. Libraries stored in the application are globally available to all <br/>
macros.<br/>
•<br/>
Every document is a library container.<br/>
•<br/>
The library named Standard is special; it always exists and cannot be overwritten. I recommend <br/>
against using the Standard library.<br/>
•<br/>
Always give meaningful names to the libraries and modules that you create. For example, Library1 <br/>
and Module4 are not meaningful names, although AXONInvoiceForm1 might be more descriptive <br/>
and helpful.<br/>
<i><b>&#160;17.1.&#160;Accessing&#160;libraries&#160;using&#160;OOo&#160;Basic<br/></b></i>I&#160;packaged some&#160;of the&#160;macros&#160;that&#160;I&#160;use&#160;into&#160;an application-level&#160;library&#160;with&#160;the&#160;name&#160;“Pitonyak.”&#160;The&#160;<br/>next&#160;day,&#160;I&#160;started&#160;OpenOffice.org, and to&#160;my&#160;surprise, I&#160;was&#160;not&#160;able&#160;to&#160;use&#160;any&#160;macros&#160;in&#160;my&#160;new&#160;library.&#160;It&#160;<br/>turns&#160;out&#160;that&#160;libraries&#160;must&#160;be&#160;loaded before&#160;they&#160;are&#160;available.<br/>
<b>TIP</b><br/>
A&#160;library&#160;must&#160;be&#160;loaded&#160;before&#160;it&#160;is available.<br/>
To&#160;manually&#160;load&#160;a&#160;library,&#160;open the&#160;Macro Organizer dialog (Tools&#160;|&#160;Macros&#160;|&#160;Macro) and double-click&#160;the&#160;<br/>library&#160;that&#160;you want&#160;to load.&#160;You can also access&#160;libraries&#160;by&#160;using a&#160;macro. OOo Basic&#160;provides&#160;the&#160;<br/>variable&#160;GlobalScope&#160;to&#160;manipulate&#160;application-level&#160;libraries&#160;(see<a href="libremacros.html#598">&#160;Listing&#160;519).</a><br/>
<i><b>Listing&#160;519.&#160;</b>Use&#160;GlobalScope&#160;to&#160;load application-level&#160;libraries.<br/></i>GlobalScope.BasicLibraries.loadLibrary(&#34;Pitonyak&#34;)<br/>
<b>TIP</b><br/>
The&#160;GlobalScope&#160;variable&#160;does not&#160;support&#160;the&#160;“dbg”&#160;properties. In&#160;other&#160;words, you cannot&#160;inspect&#160;the&#160;<br/>
GlobalScope&#160;variable.<br/>
Libraries&#160;contain two things—dialogs&#160;and macros.&#160;The&#160;GlobalScope&#160;variable&#160;has&#160;two properties—<br/>BasicLibraries&#160;and DialogLibraries—that&#160;provide&#160;access&#160;to&#160;the&#160;Basic&#160;and dialog library&#160;containers&#160;in the&#160;<br/>application&#160;library&#160;container.&#160;The&#160;BasicLibraries&#160;and DialogLibraries&#160;properties&#160;both&#160;support&#160;the&#160;same&#160;set&#160;of&#160;<br/>interfaces&#160;for accessing the&#160;contained&#160;library&#160;containers&#160;(see<a href="libremacros.html#599">&#160;Table&#160;253).</a><br/>
595<br/>
<hr/>
<a name=599></a><i><b>Table&#160;253.&#160;</b>Methods&#160;supported by&#160;library&#160;container&#160;objects.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
createLibrary(Name)<br/>
Create&#160;a&#160;new&#160;library&#160;with the&#160;given name.<br/>
createLibraryLink(Name,&#160;Url, ReadOnly)<br/>
Create&#160;a&#160;link to an “external”&#160;library.&#160;The&#160;Name&#160;and&#160;URL&#160;are&#160;both strings.&#160;<br/>If&#160;the&#160;ReadOnly&#160;flag&#160;is&#160;True,&#160;the&#160;library&#160;cannot&#160;be&#160;modified.<br/>
removeLibrary(Name)<br/>
Remove&#160;the&#160;named&#160;library.&#160;If&#160;the&#160;library&#160;is a&#160;link, only&#160;the&#160;link&#160;is&#160;removed,&#160;<br/>not&#160;the&#160;actual&#160;library.<br/>
isLibraryLoaded(Name)<br/>
True&#160;if&#160;the&#160;library&#160;is loaded,&#160;False&#160;otherwise.<br/>
loadLibrary(Name)<br/>
Load&#160;a&#160;library&#160;if&#160;it&#160;is not&#160;already&#160;loaded.<br/>
isLibraryLink(Name)<br/>
True&#160;if&#160;the&#160;library&#160;is a&#160;link&#160;to&#160;another&#160;library.<br/>
getLibraryLinkURL(Name)<br/>
Return the&#160;URL&#160;of&#160;a&#160;linked&#160;library.&#160;An&#160;error&#160;occurs if&#160;the&#160;library&#160;is not&#160;a&#160;<br/>
link.<br/>
isLibraryReadOnly(Name)<br/>
Return&#160;True&#160;if&#160;the&#160;library&#160;is read-only.&#160;<br/>
setLibraryReadOnly(Name, ReadOnly)<br/>
Set&#160;the&#160;named&#160;library&#160;to read-only&#160;if&#160;ReadOnly&#160;is&#160;True.<br/>
renameLibrary(Name, NewName)&#160;<br/>
Rename&#160;a&#160;library.&#160;If&#160;the&#160;library&#160;is linked,&#160;only&#160;the&#160;link&#160;is renamed.<br/>
changeLibraryPassword(Name, Pass,&#160;<br/>
Change&#160;a&#160;library’s&#160;password.<br/>
NewPass)<br/>getByName(Name)<br/>
Get&#160;the&#160;named&#160;library.<br/>
getElementNames()<br/>
Get&#160;an array&#160;of&#160;library&#160;names.<br/>
hasByName(Name)<br/>
True,&#160;if&#160;the&#160;named&#160;library&#160;exists.<br/>
hasElements()<br/>
True,&#160;if&#160;at&#160;least&#160;one&#160;library&#160;exists.<br/>
isLibraryPasswordProtected(Name)<br/>
True,&#160;if&#160;the&#160;library&#160;is password&#160;protected.<br/>
isLibraryPasswordVerified(Name)<br/>
True,&#160;if&#160;the&#160;password has&#160;already&#160;been used&#160;to unlock a&#160;library.<br/>
verifyLibraryPassword(Name,&#160;Pass)<br/>
Unlock a&#160;password-protected&#160;library.<br/>
<b>TIP</b><br/>
The&#160;GlobalScope&#160;variable&#160;is&#160;not&#160;available&#160;outside&#160;of&#160;OOo&#160;Basic.&#160;It&#160;is, however,&#160;possible&#160;to create&#160;and&#160;use&#160;<br/>the&#160;undocumented&#160;UNO&#160;service&#160;com.sun.star.script.ApplicationScriptLibraryContainer&#160;to&#160;access the&#160;global<br/>
Basic&#160;libraries.<br/>
The&#160;contained libraries&#160;are&#160;stored as&#160;XML&#160;strings&#160;inside&#160;named&#160;containers<a href="libremacros.html#599">.&#160;Table&#160;254&#160;c</a>ontains&#160;the&#160;methods&#160;<br/>supported&#160;by&#160;library&#160;objects.<br/>
<i><b>Table&#160;254.&#160;</b>Methods&#160;supported by&#160;library&#160;objects.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getByName(Name)<br/>
Get&#160;the&#160;named&#160;module&#160;as a&#160;String.<br/>
getElementNames()<br/>
Get&#160;an array&#160;of&#160;module&#160;names.<br/>
hasByName(Name)<br/>
True,&#160;if&#160;the&#160;library&#160;contains&#160;the&#160;named&#160;module.<br/>
hasElements()<br/>
True,&#160;if&#160;the&#160;library&#160;contains&#160;at&#160;least&#160;one&#160;module.<br/>
insertByName(Name,&#160;Module)<br/>
Insert&#160;the&#160;named module&#160;into the&#160;library.<br/>
removeByName(Name)<br/>
Remove&#160;the&#160;named&#160;module.<br/>
replaceByName(Name, Module)<br/>
Replace&#160;the&#160;named module.<br/>
596<br/>
<hr/>
<a name=600></a>When&#160;you&#160;use&#160;the&#160;macro organizer&#160;to create&#160;a&#160;library,&#160;it&#160;automatically&#160;creates&#160;both&#160;a&#160;dialog library&#160;and a&#160;<br/>Basic&#160;library.&#160;The&#160;newly&#160;created&#160;Basic&#160;library&#160;contains&#160;the&#160;module&#160;named&#160;“Module1,”&#160;which contains&#160;an&#160;<br/>empty&#160;subroutine&#160;named&#160;“Main.”&#160;The&#160;following steps&#160;illustrate&#160;the&#160;process:<br/>
1.&#160;Open the Macro dialog using <b>Tools&#160;|&#160;Macros&#160;|&#160;Organize&#160;Macros&#160;|&#160;OpenOffice.org Basic</b>.<br/>
2.&#160;Click the <b>Organizer</b> button to open the <i>Basic&#160;Macro&#160;Organizer</i> dialog. The organizer dialog can <br/>
also be opened using <b>Tools&#160;|&#160;Macros&#160;|&#160;Organize&#160;Dialogs</b>.<br/>
3.&#160;Click the <i>Libraries</i> tab.<br/>
4.&#160;Click the <b>New</b> button and give the library the name “TestLib” (see<a href="libremacros.html#600"> Figure 129)</a>. <br/>
5.&#160;Click <b>OK</b> to close the <i>New&#160;Library</i> dialog.<br/>
6.&#160;Click the <b>Close</b> button on the <i>Basic&#160;Macro&#160;Organizer</i> dialog.<br/>
7.&#160;Click the <b>Close</b> button on the <i>Basic&#160;Macros</i> dialog.<br/>
<i><b>Figure&#160;129.&#160;</b>Creating&#160;a new&#160;library&#160;in the&#160;application&#160;library&#160;container.</i><br/>
To&#160;see&#160;the&#160;contents&#160;of the&#160;TestLib library,&#160;enter and run the&#160;macro in<a href="libremacros.html#600">&#160;Listing 520.&#160;</a>As&#160;seen in<a href="libremacros.html#601">&#160;Figure&#160;130,&#160;<br/></a>TestLib contains&#160;a&#160;Module1&#160;with a&#160;single&#160;subroutine.<br/>
<i><b>Listing&#160;520.&#160;</b>Print&#160;Module1 in&#160;the&#160;newly&#160;created&#160;TestLib&#160;library.<br/></i>Sub&#160;PrintTestLib<br/>&#160; If GlobalScope.BasicLibraries.hasByName(&#34;TestLib&#34;) Then<br/>&#160; &#160; Dim&#160;oLib<br/>&#160; &#160;&#160;oLib&#160;= GlobalScope.BasicLibraries.getByName(&#34;TestLib&#34;)<br/>&#160; &#160; MsgBox&#160;oLib.getByName(&#34;Module1&#34;),&#160;0,&#160;&#34;Module1 in TestLib&#34;<br/>&#160; Else<br/>&#160; &#160; MsgBox&#160;&#34;Library 'TestLib' does not exist&#34;<br/>&#160; End If<br/>
597<br/>
<hr/>
<a name=601></a>End Sub<br/>
<i><b>Figure&#160;130.&#160;</b>Module1&#160;is&#160;automatically&#160;created by&#160;the&#160;dialog&#160;organizer.</i><br/>
You can use&#160;the&#160;code&#160;in<a href="libremacros.html#601">&#160;Listing 521&#160;t</a>o verify&#160;that&#160;both&#160;a&#160;Basic&#160;and a&#160;dialog&#160;library&#160;exist.&#160;Although the&#160;dialog<br/>library&#160;exists, it&#160;does&#160;not&#160;contain any&#160;dialogs. If&#160;the&#160;TestLib library&#160;does&#160;not&#160;exist,&#160;the&#160;returned library&#160;is&#160;null.<br/>
<i><b>Listing&#160;521.&#160;</b>Obtain the&#160;Basic&#160;and the&#160;dialog&#160;library.<br/></i>oLib&#160;=&#160;GlobalScope.BasicLibraries.getByName(&#34;TestLib&#34;)<br/>oLib&#160;=&#160;GlobalScope.DialogLibraries.getByName(&#34;TestLib&#34;)<br/>
<b>TIP</b><br/>
Libraries created using&#160;the&#160;methods i<a href="libremacros.html#599">n&#160;Table&#160;254&#160;d</a>o not&#160;automatically&#160;create&#160;both&#160;a&#160;dialog and a&#160;macro&#160;<br/>library.<br/>
Libraries&#160;created&#160;using the&#160;UNO&#160;API&#160;in<a href="libremacros.html#599">&#160;Table&#160;254&#160;c</a>ause&#160;only&#160;one&#160;library&#160;to&#160;be&#160;created.&#160;The&#160;macro i<a href="libremacros.html#601">n&#160;Listing&#160;<br/>522<b>&#160;</b></a>creates&#160;a&#160;dialog library&#160;and a&#160;corresponding Basic&#160;library,&#160;adds&#160;Module1 to&#160;the&#160;code&#160;library,&#160;and adds&#160;a&#160;<br/>subroutine&#160;to&#160;Module1. See<a href="libremacros.html#602">&#160;Figure&#160;131.</a><br/>
<i><b>Listing&#160;522.&#160;</b>Create&#160;A&#160;Global&#160;Library.&#160;<br/></i>Sub&#160;CreateAGlobalLib<br/>&#160;&#160;Dim&#160;oLib<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;If&#160;GlobalScope.BasicLibraries.hasByName(&#34;TestLib&#34;)&#160;Then<br/>&#160; &#160;&#160;GlobalScope.BasicLibraries.removeLibrary(&#34;TestLib&#34;)<br/>&#160; &#160;&#160;GlobalScope.DialogLibraries.removeLibrary(&#34;TestLib&#34;)<br/>&#160; &#160;&#160;MsgBox&#160;&#34;Deleted TestLib&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;GlobalScope.BasicLibraries.createLibrary(&#34;TestLib&#34;)<br/>&#160; &#160;&#160;GlobalScope.DialogLibraries.createLibrary(&#34;TestLib&#34;)<br/>&#160; &#160;&#160;oLib&#160;=&#160;GlobalScope.BasicLibraries.getByName(&#34;TestLib&#34;)<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;Sub Main&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34; &#160;x = x + 1&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160;&#160;&#34;End Sub&#34;<br/>&#160; &#160;&#160;oLib.insertByName(&#34;Module1&#34;,&#160;s)<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;=== Basic Libs ===&#34;&#160;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;oLib&#160;=&#160;GlobalScope.BasicLibraries.getByName(&#34;TestLib&#34;)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;Join(oLib.getElementNames(),&#160;CHR$(10))<br/>&#160; &#160;&#160;oLib&#160;=&#160;GlobalScope.DialogLibraries.getByName(&#34;TestLib&#34;)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;=== Dialog Libs ===&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;Join(oLib.getElementNames(),&#160;CHR$(10))<br/>&#160; &#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Modules in the TestLib Library&#34;<br/>&#160; &#160;&#160;oLib&#160;=&#160;GlobalScope.BasicLibraries.getByName(&#34;TestLib&#34;)<br/>&#160; &#160;&#160;MsgBox&#160;oLib.getByName(&#34;Module1&#34;),&#160;0,&#160;&#34;Module1 in TestLib&#34;<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
598<br/>
<hr/>
<a name=602></a><i><b>Figure&#160;131.&#160;</b>Although the&#160;dialog&#160;library&#160;exists,&#160;it&#160;contains&#160;no dialogs.</i><br/>
<i><b>&#160;17.2.&#160;Libraries&#160;contained&#160;in&#160;a&#160;document<br/></b></i>OOo Basic&#160;defines&#160;the&#160;variables&#160;BasicLibraries&#160;and DialogLibraries&#160;to&#160;access&#160;libraries&#160;contained&#160;in a&#160;<br/>document.&#160;The&#160;behavior is&#160;the&#160;same&#160;as&#160;their GlobalScope&#160;counterparts&#160;except&#160;that&#160;they&#160;access&#160;the&#160;library&#160;<br/>container for the&#160;current&#160;document.&#160;Modify<a href="libremacros.html#601">&#160;Listing&#160;522&#160;b</a>y&#160;removing all&#160;references&#160;to GlobalScope, and the&#160;<br/>macro acts&#160;on the&#160;current&#160;document.<br/>
Although the&#160;BasicLibraries&#160;and DialogLibraries&#160;variables&#160;provided by&#160;OOo Basic&#160;provide&#160;an excellent&#160;<br/>method&#160;of accessing dialogs&#160;and libraries&#160;contained in&#160;a&#160;document, you may&#160;find&#160;code&#160;that&#160;uses&#160;the&#160;<br/>deprecated method&#160;getLibraryContainer(). Each document&#160;supports&#160;the&#160;method&#160;getLibraryContainer().&#160;The&#160;<br/>returned object&#160;supports&#160;the&#160;method getModuleContainer(), which returns&#160;the&#160;contained&#160;Basic&#160;modules, and&#160;<br/>the&#160;method getDialogContainer(), which in&#160;my&#160;testing always&#160;returns&#160;a&#160;null&#160;object<a href="libremacros.html#602">.&#160;Table&#160;255&#160;s</a>hows&#160;how&#160;to&#160;<br/>obtain&#160;a&#160;module&#160;using old and new&#160;methods.<br/>
<i><b>Table&#160;255.&#160;</b>Obtain&#160;the&#160;module&#160;aMod from&#160;the&#160;library&#160;TestLib&#160;contained&#160;in a document.</i><br/>
<b>Using&#160;BasicLibraries</b><br/>
<b>Using&#160;oDoc.getLibraryContainer()</b><br/>
oLibs&#160;=&#160;BasicLibraries<br/>
oLibs&#160;=&#160;oDoc.getLibraryContainer()<br/>
If&#160;oLibs.hasByName(&#34;TestLib&#34;)&#160;Then<br/>
If&#160;oLibs.hasByName(&#34;TestLib&#34;)&#160;Then<br/>
&#160;&#160;oLib&#160;=&#160;oLibs.getByName(&#34;TestLib&#34;)<br/>
&#160;&#160;oLib&#160;=&#160;oLibs.getByName(&#34;TestLib&#34;)<br/>
&#160;&#160;If&#160;oLib.hasByName(&#34;AMod&#34;)&#160;Then<br/>
&#160;&#160;oMods&#160;=&#160;oLib.getModuleContainer()<br/>
&#160; &#160;&#160;oMod&#160;=&#160;oLib.getByName(&#34;AMod&#34;)<br/>
&#160;&#160;If&#160;NOT&#160;IsNull(oMods)&#160;Then<br/>
&#160;&#160;End&#160;If<br/>
&#160; &#160;&#160;If&#160;oMods.hasByName(&#34;AMod&#34;)&#160;Then<br/>
End&#160;If<br/>
&#160; &#160; &#160;&#160;oMod&#160;=&#160;oMods.getByName(&#34;AMod&#34;)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;End&#160;If<br/>End&#160;If<br/>
<b>TIP</b><br/>
The&#160;BasicLibraries and DialogLibraries variables are&#160;only&#160;available&#160;if&#160;the&#160;currently&#160;running&#160;subroutine&#160;is&#160;<br/>contained&#160;in&#160;the&#160;document.&#160;Unfortunately,&#160;this&#160;leaves no way&#160;to obtain a&#160;dialog&#160;from&#160;a&#160;document&#160;except&#160;<br/>
from&#160;code&#160;contained&#160;in&#160;the&#160;document.&#160;Write&#160;a&#160;dialog creation function that&#160;is&#160;contained&#160;in the&#160;document&#160;<br/>containing&#160;the&#160;dialog in question.<br/>
<i><b>&#160;17.3.&#160;Writing&#160;an&#160;installer<br/></b></i>I&#160;make&#160;no attempt&#160;at&#160;writing a&#160;full-fledged installer,&#160;but&#160;I&#160;do provide&#160;some&#160;clues&#160;here&#160;as&#160;to&#160;how&#160;to&#160;do it.&#160;The&#160;<br/>macro i<a href="libremacros.html#603">n&#160;Listing&#160;523&#160;c</a>opies&#160;a&#160;single&#160;library,&#160;whose&#160;name&#160;may&#160;be&#160;changed when it&#160;is&#160;copied.&#160;The&#160;process&#160;is&#160;<br/>simple&#160;and straightforward.&#160;The&#160;modules&#160;in&#160;the&#160;source&#160;library&#160;are&#160;copied one&#160;at&#160;a&#160;time&#160;into&#160;the&#160;destination&#160;<br/>library.&#160;The&#160;final&#160;argument&#160;determines&#160;if the&#160;destination library&#160;is&#160;cleared before&#160;the&#160;copy&#160;begins. If&#160;the&#160;<br/>destination&#160;library&#160;is&#160;not&#160;cleared first&#160;and it&#160;contains&#160;modules&#160;that&#160;do not&#160;exist&#160;in the&#160;source&#160;library,&#160;those&#160;<br/>modules&#160;will&#160;still&#160;exist&#160;in&#160;the&#160;destination&#160;library&#160;after the&#160;library&#160;is&#160;copied.<br/>
599<br/>
<hr/>
<a name=603></a><i><b>Listing&#160;523.&#160;</b>Copy&#160;a library.<br/></i>REM sSrcLib is the name of the source library contained in oSrcLibs<br/>REM sDestLib is the name of the destination library contained in oDestLibs<br/>REM oSrcLibs is the source library container<br/>REM oDestLibs is the destination library container<br/>REM if bClearDest is True, then the destination library is cleared<br/>Sub&#160;AddOneLib(sSrcLib$,&#160;sDestLib$,&#160;oSrcLibs,&#160;oDestLibs,&#160;bClearDest&#160;As&#160;Boolean)<br/>&#160;&#160;Dim&#160;oSrcLib&#160; &#160;'The source library to copy<br/>&#160;&#160;Dim&#160;oDestLib&#160; 'The destination library to receive the modules in oSrcLib<br/>&#160;&#160;Dim&#160;sNames<br/>&#160;&#160;Dim&#160;i%<br/>&#160;&#160;<br/>&#160;&#160;REM If there is no destination library then simply return<br/>&#160;&#160;If&#160;IsNull(oDestLibs)&#160;OR&#160;IsEmpty(oDestLibs)&#160;Then<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM Clear the destination library if requested<br/>&#160;&#160;If&#160;bClearDest&#160;AND&#160;oDestLibs.hasByName(sDestLib)&#160;Then<br/>&#160; &#160;&#160;oDestLibs.removeLibrary(sDestLib)<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM If there is no source library, then there is nothing else to do<br/>&#160;&#160;If&#160;IsNull(oSrcLibs)&#160;OR&#160;IsEmpty(oSrcLibs)&#160;Then<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM If the source library does not exist, then there is nothing else to do<br/>&#160;&#160;If&#160;NOT&#160;oSrcLibs.hasByName(sSrcLib)&#160;Then<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM If the destination library does not exist, then create it<br/>&#160;&#160;If&#160;NOT&#160;oDestLibs.hasByName(sDestLib)&#160;Then<br/>&#160; &#160;&#160;oDestLibs.createLibrary(sDestLib)<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM This is where the real fun begins!<br/>&#160;&#160;REM It may seem obvious, but the libraries must be loaded first.<br/>&#160;&#160;REM Common mistake to not load the libraries first!<br/>&#160;&#160;oSrcLibs.loadLibrary(sSrcLib)<br/>&#160;&#160;oDestLibs.loadLibrary(sDestLib)<br/>
&#160;&#160;REM Get the source and destination libraries<br/>&#160;&#160;REM Get all of the contained modules that should be copied<br/>&#160;&#160;oSrcLib&#160;=&#160;oSrcLibs.getByName(sSrcLib)<br/>&#160;&#160;oDestLib&#160;=&#160;oDestLibs.getByName(sDestLib)<br/>&#160;&#160;sNames&#160;=&#160;oSrcLib.getElementNames()<br/>
&#160;&#160;REM For each module, either add it or replace it<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(sNames)&#160;To&#160;UBound(sNames)<br/>&#160; &#160;&#160;If&#160;oDestLib.hasByName(sNames(i))&#160;Then<br/>&#160; &#160; &#160;&#160;oDestLib.replaceByName(sNames(i),&#160;oSrcLib.getByName(sNames(i)))<br/>
600<br/>
<hr/>
<a name=604></a>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;oDestLib.insertByName(sNames(i),&#160;oSrcLib.getByName(sNames(i)))<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
Assume&#160;that&#160;you want&#160;to&#160;copy&#160;a&#160;specific&#160;library&#160;from&#160;the&#160;application&#160;into&#160;a&#160;document&#160;so that&#160;you can send it&#160;<br/>to a&#160;friend.&#160;The&#160;fastest&#160;method is&#160;to simply&#160;use&#160;the&#160;macro organizer and append the&#160;library&#160;from&#160;the&#160;<br/>application&#160;into&#160;the&#160;document.&#160;Sure, you&#160;can write&#160;a&#160;macro, but&#160;some&#160;things&#160;are&#160;done&#160;faster manually.&#160;If,&#160;on&#160;<br/>the&#160;other hand, you&#160;need to&#160;copy&#160;libraries&#160;frequently,&#160;it&#160;makes&#160;sense&#160;to write&#160;a&#160;macro to&#160;do the&#160;work.&#160;The&#160;<br/>macro i<a href="libremacros.html#604">n&#160;Listing&#160;524&#160;a</a>ccepts&#160;the&#160;name&#160;of a&#160;library&#160;contained in&#160;the&#160;application&#160;and then copies&#160;the&#160;library&#160;<br/>into&#160;the&#160;current&#160;document.&#160;Both the&#160;code&#160;library&#160;and the&#160;dialog library&#160;are&#160;copied.&#160;The&#160;analogous&#160;macro to&#160;<br/>copy&#160;a&#160;library&#160;from&#160;the&#160;document&#160;back to&#160;the&#160;application&#160;is&#160;trivial&#160;and nearly&#160;identical&#160;t<a href="libremacros.html#604">o&#160;Listing&#160;524.</a><br/>
<i><b>Listing&#160;524.&#160;</b>Add a global&#160;library&#160;to to&#160;the&#160;current&#160;document.<br/></i>Sub&#160;AppLibToDocLib(sLibName$)<br/>&#160;&#160;Dim&#160;oGlobalLib<br/>&#160;&#160;oGlobalLib&#160;=&#160;GlobalScope.BasicLibraries<br/>&#160;&#160;AddOneLib(sLibName,&#160;sLibName,&#160;oGlobalLib,&#160;BasicLibraries,&#160;True)<br/>&#160;&#160;oGlobalLib&#160;=&#160;GlobalScope.DialogLibraries<br/>&#160;&#160;AddOneLib(sLibName,&#160;sLibName,&#160;oGlobalLib,&#160;DialogLibraries,&#160;True)<br/>End&#160;Sub<br/>
<i><b>&#160;17.4.&#160;Conclusion<br/></b></i>Although sometimes&#160;it’s&#160;quicker to&#160;manipulate&#160;libraries&#160;by&#160;hand, it’s&#160; easy&#160;to&#160;manipulate&#160;and copy&#160;them&#160;<br/>using macros.&#160;The&#160;methods&#160;outlined&#160;in this&#160;chapter will&#160;allow&#160;you to perform&#160;most&#160;of the&#160;operations&#160;that&#160;<br/>you&#160;need for libraries.<br/>
601<br/>
<hr/>
<a name=605></a><b>&#160;18.&#160;Dialogs&#160;and&#160;Controls<br/></b>This&#160;chapter discusses&#160;how&#160;to create&#160;and use&#160;dialogs&#160;and the&#160;controls&#160;that&#160;they&#160;contain.&#160;It&#160;focuses&#160;on the&#160;<br/>Basic&#160;IDE&#160;as&#160;the&#160;primary&#160;method of creating dialogs.&#160;This&#160;chapter covers&#160;each of the&#160;different&#160;controls&#160;and&#160;<br/>provides&#160;examples&#160;for most&#160;of the&#160;control&#160;types. It&#160;also&#160;includes&#160;a&#160;method&#160;to&#160;build&#160;dialogs&#160;and controls&#160;at&#160;<br/>run time,&#160;rather than&#160;using the&#160;Basic&#160;IDE.<br/>
In&#160;computer terms,&#160;a&#160;window&#160;is&#160;an area&#160;shown on the&#160;computer screen in&#160;which information&#160;is&#160;displayed.&#160;In&#160;<br/>most&#160;applications, it&#160;isn’t&#160;always&#160;easy&#160;to&#160;tell&#160;the&#160;difference&#160;between a&#160;dialog and a&#160;window.&#160;Although the&#160;<br/>word “dialog”&#160;has&#160;multiple&#160;definitions, the&#160;definition usually&#160;specifies&#160;an exchange&#160;of information between&#160;<br/>two entities—usually&#160;people. In&#160;OpenOffice, a&#160;dialog is&#160;a&#160;window&#160;that&#160;is&#160;displayed to interact&#160;with&#160;a&#160;user.<br/>
A&#160;“modal&#160;window”&#160;blocks&#160;its&#160;parent&#160;application&#160;(or window) from&#160;further activity&#160;until&#160;the&#160;window&#160;has&#160;<br/>completed executing its&#160;code&#160;and has&#160;been closed successfully.&#160;In&#160;other words, when you open a&#160;“modal”&#160;<br/>window,&#160;it&#160;has&#160;the&#160;focus;&#160;you&#160;can't&#160;just&#160;move&#160;it&#160;out&#160;of the&#160;way&#160;and use&#160;the&#160;window&#160;underneath&#160;it.&#160;If&#160;a&#160;<br/>window&#160;is&#160;modal,&#160;it’s&#160;usually&#160;considered to be&#160;a&#160;dialog.<br/>
<b>TIP</b><br/>
While&#160;a&#160;modal&#160;dialog&#160;is displayed,&#160;you&#160;can access the&#160;dialog&#160;but&#160;not&#160;the&#160;document&#160;window.&#160;Dialogs are&#160;<br/>
almost&#160;always&#160;modal, and&#160;general&#160;application windows, such as those&#160;displaying&#160;documents under&#160;user&#160;<br/>control, are&#160;almost&#160;never&#160;modal<br/>
The&#160;Find &amp;&#160;Replace&#160;dialog in a&#160;Writer document&#160;is&#160;an example&#160;of a&#160;non-modal&#160;dialog.&#160;After opening the&#160;<br/>Find &amp;&#160;Replace&#160;dialog, you&#160;can still&#160;access&#160;and edit&#160;the&#160;document.&#160;Another criterion&#160;for a&#160;window&#160;being&#160;<br/>classified as&#160;a&#160;dialog&#160;is&#160;based on function.&#160;The&#160;primary&#160;display&#160;window&#160;for a&#160;program&#160;is&#160;typically&#160;not&#160;a&#160;<br/>dialog.&#160;The&#160;information&#160;displayed or requested&#160;in a&#160;dialog is&#160;usually&#160;secondary&#160;compared to&#160;the&#160;function&#160;of&#160;<br/>the&#160;program.&#160;For&#160;example, configuration information&#160;and error notices&#160;are&#160;frequently&#160;displayed&#160;in&#160;a&#160;dialog,&#160;<br/>but&#160;the&#160;primary&#160;text&#160;of a&#160;Writer document&#160;is&#160;not.&#160;Although the&#160;difference&#160;between a&#160;window&#160;and a&#160;dialog is&#160;<br/>somewhat&#160;arbitrary,&#160;you&#160;can create&#160;and use&#160;your&#160;own dialogs&#160;in&#160;Basic, but&#160;you can’t&#160;open and start&#160;a&#160;general&#160;<br/>application&#160;window.&#160;This&#160;is&#160;reasonable,&#160;because&#160;the&#160;usual&#160;purpose&#160;of a&#160;dialog is&#160;to&#160;communicate&#160;some&#160;<br/>details&#160;relevant&#160;to&#160;the&#160;configuration&#160;of an application,&#160;object,&#160;or document&#160;that&#160;is&#160;already&#160;active.<br/>
<i><b>&#160;18.1.&#160;My&#160;first&#160;dialog<br/></b></i>To&#160;create&#160;a&#160;dialog&#160;in&#160;the&#160;IDE, you must&#160;first&#160;create&#160;an empty&#160;dialog.&#160;You can use&#160;one&#160;of two methods&#160;to&#160;add&#160;<br/>an empty&#160;dialog to a&#160;library.&#160;The&#160;first&#160;method is&#160;to use&#160;the&#160;Macro Organizer&#160;dialog.&#160;The&#160;advantage&#160;of using&#160;<br/>the&#160;Macro Organizer is&#160;that&#160;you&#160;can immediately&#160;provide&#160;a&#160;meaningful&#160;name&#160;for the&#160;dialog.<br/>
You can also create&#160;dialogs&#160;and modules&#160;directly&#160;in&#160;the&#160;Basic&#160;IDE&#160;by&#160;right-clicking&#160;the&#160;Module&#160;tab.&#160;The&#160;tabs&#160;<br/>shown at&#160;the&#160;bottom&#160;of the&#160;Basic&#160;IDE&#160;identify&#160;the&#160;opened modules&#160;and dialogs. Place&#160;the&#160;cursor on any&#160;tab,&#160;<br/>right-click&#160;and select&#160;<b>Insert |&#160;BASIC</b>&#160;Dialog&#160;(see<a href="libremacros.html#606">&#160;Figure&#160;132).</a><br/>
A&#160;new&#160;dialog is&#160;created&#160;with the&#160;name&#160;Dialog1. Right-click the&#160;Dialog1 tab and choose&#160;Rename&#160;to change&#160;<br/>the&#160;name&#160;of the&#160;dialog from&#160;Dialog1 to&#160;HelloDlg.&#160;An empty&#160;dialog&#160;appears&#160;in&#160;the&#160;middle&#160;of the&#160;IDE&#160;page.&#160;<br/>This&#160;dialog, which is&#160;currently&#160;empty,&#160;is&#160;the&#160;one&#160;that&#160;will&#160;be&#160;displayed when you&#160;are&#160;finished.&#160;To&#160;select&#160;the&#160;<br/>dialog, click in&#160;its&#160;lower right&#160;corner.&#160;After you’ve&#160;selected the&#160;dialog, you&#160;can use&#160;the&#160;mouse&#160;to change&#160;its&#160;<br/>size&#160;or location.&#160;If&#160;you&#160;had selected the&#160;dialog&#160;by&#160;clicking anywhere&#160;in it,&#160;the&#160;more&#160;common&#160;activity&#160;of&#160;<br/>selecting controls&#160;contained&#160;in the&#160;dialog&#160;would be&#160;more&#160;difficult.<br/>
<b>TIP</b><br/>
When&#160;something&#160;is&#160;selected,&#160;green&#160;boxes&#160;appear&#160;around&#160;the&#160;selected&#160;item.&#160;The&#160;green boxes are&#160;called&#160;<br/>
handles.<br/>
602<br/>
<hr/>
<a name=606></a>Click In&#160;A&#160;Tab<br/>
<i><b>Figure&#160;132.&#160;</b>Right-click&#160;the&#160;module&#160;tab&#160;and select&#160;Insert&#160;|&#160;BASIC Dialog.</i><br/>
Click the&#160;Controls&#160;Dialog icon in&#160;the&#160;toolbar to open the&#160;Controls&#160;toolbar (see<a href="libremacros.html#608">&#160;Figure&#160;133).&#160;</a>The&#160;Controls&#160;<br/>toolbar is&#160;non-modal, so you can leave&#160;it&#160;open and still&#160;manipulate&#160;the&#160;dialog. Click&#160;the&#160;lower right&#160;Test&#160;<br/>Mode&#160;button&#160;to open a&#160;copy&#160;of the&#160;dialog in test&#160;mode.&#160;This&#160;allows&#160;you&#160;to&#160;see&#160;how&#160;the&#160;dialog looks.&#160;To&#160;close<br/>the&#160;dialog after opening it&#160;in test&#160;mode,&#160;click the&#160;Close&#160;icon&#160;in the&#160;upper right&#160;corner of the&#160;dialog.<br/>
<b>TIP</b><br/>
The&#160;Controls toolbar&#160;is sometimes referred&#160;to as the&#160;“design tools&#160;window”&#160;or&#160;“Toolbox”,&#160;differs in&#160;<br/>appearance&#160;and what&#160;it&#160;contains between LO&#160;and&#160;AOO.<br/>
Most&#160;of the&#160;icons&#160;in&#160;the&#160;Controls&#160;toolbar are&#160;used to add controls&#160;to&#160;your dialog. If&#160;you&#160;click&#160;any&#160;of the&#160;<br/>control&#160;icons&#160;in the&#160;Controls&#160;toolbar,&#160;the&#160;cursor changes&#160;from&#160;an arrow-shaped selection&#160;cursor to&#160;a&#160;cross-<br/>shaped cursor.&#160;You can click&#160;the&#160;Select&#160;icon to&#160;change&#160;the&#160;cursor back to&#160;the&#160;selection&#160;shape&#160;rather than&#160;<br/>insert&#160;a&#160;new&#160;control.<br/>
<i><b>Table&#160;256.&#160;</b>Dialog&#160;controls.</i><br/>
AOO<br/>
LO<br/>
Description<br/>Select<br/>
Manage&#160;Language<br/>
Test&#160;mode&#160;on /&#160;off.<br/>
603<br/>
<hr/>
<a name=607></a>Properties<br/>
Button<br/>Image&#160;control<br/>
Check box<br/>
Radio&#160;button<br/>
Label&#160;field<br/>
Text&#160;box<br/>
List&#160;box<br/>
Combo&#160;box<br/>
Vertical&#160;scroll&#160;bar<br/>
Horizontal&#160;scroll&#160;bar<br/>
Goup box<br/>
Progress&#160;bar<br/>
Horizontal&#160;line<br/>
Vertical&#160;line<br/>
Date&#160;field<br/>
Time&#160;field<br/>
Numeric&#160;field<br/>
Currency&#160;field<br/>
Formatted&#160;field<br/>
Pattern&#160;field<br/>
File&#160;selection<br/>
Tree&#160;control<br/>
Spin&#160;button&#160;is&#160;missing (by&#160;default)&#160;on the&#160;Toolbox&#160;bar in&#160;AOO&#160;and<br/>it&#160;is&#160;not&#160;usable&#160;in&#160;an&#160;AOO&#160;dialog anyway&#160;(I&#160;think).<br/>
604<br/>
<hr/>
<a name=608></a><b>TIP</b><br/>
Other&#160;controls&#160;do&#160;exist, but&#160;they&#160;are&#160;not&#160;shown&#160;in the&#160;Toolbox&#160;bar&#160;by&#160;default;&#160;for&#160;example,&#160;database&#160;<br/>
controls&#160;such as a&#160;Table&#160;control.&#160;Just&#160;as well&#160;since&#160;they&#160;are&#160;not&#160;usable&#160;in&#160;a&#160;dialog.<br/>
<i><b>Figure&#160;133.&#160;</b>Click&#160;the&#160;lower&#160;right&#160;corner&#160;to&#160;enable&#160;the&#160;green handles.</i><br/>
<b>&#160;18.1.1.&#160;The&#160;Properties&#160;dialog<br/></b>Much of what&#160;a&#160;dialog&#160;or control&#160;does&#160;is&#160;controlled&#160;by&#160;properties, which&#160;you&#160;can set&#160;at&#160;both&#160;run time&#160;and&#160;<br/>design time.&#160;To&#160;set&#160;properties&#160;at&#160;design time,&#160;first&#160;select&#160;the&#160;object.&#160;After the&#160;object&#160;is&#160;selected, either right-<br/>click&#160;the&#160;object&#160;and select&#160;Properties, or click the&#160;Properties&#160;button&#160;in&#160;the&#160;Controls&#160;dialog (see<a href="libremacros.html#609">&#160;Figure&#160;134)</a>.<br/>
The&#160;Name&#160;property&#160;(see<a href="libremacros.html#609">&#160;Figure&#160;134) s</a>ets&#160;the&#160;name&#160;used to&#160;retrieve&#160;the&#160;control&#160;from&#160;the&#160;dialog. For a&#160;dialog,&#160;<br/>there&#160;is&#160;no reason to&#160;change&#160;the&#160;name, because&#160;the&#160;dialog is&#160;not&#160;retrieved in&#160;the&#160;same&#160;way&#160;that&#160;a&#160;control&#160;is&#160;<br/>retrieved.&#160;The&#160;Title&#160;property&#160;exists&#160;for dialogs&#160;(and only&#160;for dialogs), and it&#160;sets&#160;the&#160;value&#160;of the&#160;dialog’s&#160;title<br/>—I&#160;set&#160;the&#160;title&#160;for my&#160;example&#160;dialog to “Hello&#160;World.”&#160;Although the&#160;Properties&#160;dialog supports&#160;setting the&#160;<br/>position and size, this&#160;is&#160;usually&#160;done&#160;using the&#160;mouse.<br/>
605<br/>
<hr/>
<a name=609></a><i><b>Figure&#160;134.&#160;</b>Set&#160;the&#160;properties&#160;for&#160;the&#160;dialog.</i><br/>
<b>TIP</b><br/>
The&#160;properties shown&#160;in the&#160;Properties dialog change&#160;based on the&#160;selected object<br/>
Use&#160;the&#160;following steps&#160;to set&#160;up the&#160;dialog in this&#160;example.<br/>
1.&#160;Use <b>View&#160;&gt;&#160;Toolbars&#160;&gt;&#160;Form&#160;Controls</b> to open the Controls toolbar.<br/>2.&#160;Select the dialog by clicking the lower right corner of the dialog (see<a href="libremacros.html#608"> Figure 133)</a>.<br/>3.&#160;Click the Properties icon on the Controls toolbar to open the Properties dialog (see<a href="libremacros.html#609"> Figure 134)</a>.<br/>4.&#160;Set the dialog’s name to HelloDlg—I like to name things.<br/>
606<br/>
<hr/>
<a name=610></a>5.&#160;Set the dialog’s title to “Hello World.” When the cursor leaves the Title property field, the title is <br/>
displayed in the dialog’s title bar.<br/>
6.&#160;Make certain that the Properties dialog is not covering the Hello World dialog.<br/>7.&#160;Click the Button icon in the Controls toolbar to add a button to the Hello World dialog. When the cursor <br/>
moves over the dialog, it changes from the selection arrow to a cross. Position the cursor where you <br/>
want the button, and then click the mouse button and drag to define the appropriate size.<br/>
8.&#160;When the button is created, it defaults to the name CommandButton1. Use the Properties dialog to <br/>
change the button’s name to OKButton and the button’s label to “OK”. <br/>
9.&#160;Use the Properties dialog to change the button type to OK so that the button will automatically close the <br/>
dialog. If you don’t do this, the button will do nothing unless a handler is registered for the button—<br/>
event handlers are set from the Events tab in the Properties dialog.<br/>
10.&#160;In the “Help text” field, enter the text “Click Here” so that some help text is displayed when the cursor <br/>
rests over the button.<br/>
<b>TIP</b><br/>
OpenOffice.org&#160;includes numerous excellent&#160;examples of&#160;dialog and&#160;control&#160;manipulation in the&#160;module&#160;<br/>
named&#160;ModuleControls contained&#160;in the&#160;Tools library.<br/>
<b>&#160;18.1.2.&#160;Starting&#160;a&#160;dialog&#160;from&#160;a&#160;macro<br/></b>Dialogs&#160;can be&#160;stored in&#160;the&#160;document&#160;or in&#160;a&#160;global&#160;library&#160;(see&#160;Chapter 16, “Library&#160;Management”).&#160;<br/>Regardless&#160;of where&#160;the&#160;dialog is&#160;stored, it&#160;must&#160;be&#160;loaded before&#160;it&#160;can be&#160;used. Remember that&#160;you&#160;can&#160;<br/>access&#160;the&#160;dialog libraries&#160;stored in&#160;the&#160;current&#160;document&#160;by&#160;using DialogLibraries,&#160;and the&#160;libraries&#160;stored&#160;<br/>in the&#160;application&#160;by&#160;using GlobalScope.DialogLibraries. Use&#160;the&#160;following sequence&#160;of steps&#160;to load,&#160;<br/>create, and execute&#160;a&#160;dialog:<br/>
1.&#160;Use the loadLibrary() method to load the library containing the dialog. Although you can skip this step if<br/>
the library is already loaded, it is probably not prudent to assume this. <br/>
2.&#160;Use the getByName() method to retrieve the library from DialogLibraries. <br/>3.&#160;Use the method getByName() to retrieve the dialog from the retrieved library. <br/>4.&#160;Create the dialog using CreateUnoDialog(). <br/>5.&#160;Execute the dialog.<br/>
<a href="libremacros.html#610">Listing 525&#160;l</a>oads&#160;and executes&#160;a&#160;dialog stored in&#160;the&#160;current&#160;document.<br/>
<i><b>Listing&#160;525.&#160;</b>Load and run the&#160;test&#160;dialog.<br/></i>Dim&#160;oHelloDlg&#160; &#160; &#160;'The run-time dialog that is created<br/>Sub&#160;RunHelloDlg<br/>&#160;&#160;Dim&#160;oLib&#160; &#160; &#160; &#160;&#160;'Library that contains the dialog<br/>&#160;&#160;Dim&#160;oLibDlg&#160; &#160; &#160;'Dialog as stored in the library<br/>
&#160;&#160;REM First, load the library.<br/>&#160;&#160;REM If the dialog is stored in an application-level library rather than<br/>&#160;&#160;REM in the document, then GlobalScope.DialogLibraries must be used.<br/>&#160;&#160;DialogLibraries.loadLibrary(&#34;OOME_30&#34;)<br/>
607<br/>
<hr/>
<a name=611></a>&#160;&#160;REM Obtain the entire library now that it has been loaded.<br/>&#160;&#160;oLib&#160;=&#160;DialogLibraries.getByName(&#34;OOME_30&#34;)<br/>
&#160;&#160;REM Obtain the dialog as stored in the library.<br/>&#160;&#160;REM I usually think of this as the definition of the dialog.<br/>&#160;&#160;oLibDlg&#160;=&#160;oLib.getByName(&#34;HelloDlg&#34;)<br/>
&#160;&#160;REM Create a dialog that can be used.<br/>&#160;&#160;oHelloDlg&#160;=&#160;CreateUnoDialog(oLibDlg)<br/>
&#160;&#160;REM Now start the dialog.<br/>&#160;&#160;REM The execute() method is really a function that returns 1 if OK<br/>&#160;&#160;REM is used to close the dialog and 0 if Cancel is used to close the<br/>&#160;&#160;REM dialog. Clicking the Close button in the upper right corner<br/>&#160;&#160;REM of the dialog is considered the same as clicking Cancel.<br/>&#160;&#160;oHelloDlg.execute()<br/>End&#160;Sub<br/>
<b>TIP</b><br/>
The&#160;variable&#160;that&#160;contains the&#160;dialog&#160;is&#160;declared outside&#160;of&#160;the&#160;subroutine&#160;that&#160;creates&#160;the&#160;dialog so that&#160;the&#160;<br/>
dialog&#160;can be&#160;accessed&#160;in event&#160;handlers,&#160;which are&#160;implemented&#160;as subroutines.<br/>
<b>&#160;18.1.3.&#160;Assign&#160;an&#160;event&#160;handler<br/></b>Controls&#160;and dialogs&#160;can call&#160;external&#160;event&#160;handlers.&#160;You can assign individual&#160;subroutines&#160;as&#160;event&#160;<br/>handlers&#160;by&#160;using the&#160;Events&#160;tab of the&#160;Properties&#160;dialog (see<a href="libremacros.html#611">&#160;Figure&#160;135)</a>.&#160;A&#160;quick&#160;look at&#160;the&#160;title&#160;shows&#160;<br/>that&#160;the&#160;events&#160;in<a href="libremacros.html#611">&#160;Figure&#160;135&#160;a</a>re&#160;for a&#160;command&#160;button.&#160;The&#160;supported events&#160;can change&#160;based on the&#160;<br/>selected object.<br/>
<i><b>Figure&#160;135.&#160;</b>Events&#160;for&#160;a command button.</i><br/>
608<br/>
<hr/>
<a name=612></a>You can use&#160;an event&#160;handler to&#160;close&#160;the&#160;Hello&#160;World&#160;dialog. Use&#160;the&#160;Properties&#160;dialog to change&#160;the&#160;Button<br/>type&#160;from&#160;OK&#160;to&#160;default;&#160;the&#160;dialog will&#160;no longer close&#160;on its&#160;own.&#160;You might&#160;want&#160;to&#160;do this, for example,&#160;<br/>if you&#160;want&#160;to&#160;validate&#160;input&#160;before&#160;closing a&#160;dialog. Now,&#160;write&#160;the&#160;event&#160;handler that&#160;will&#160;close&#160;the&#160;dialog&#160;<br/>(see<a href="libremacros.html#612">&#160;Listing 526)</a>.<br/>
<i><b>Listing&#160;526.&#160;</b>Close&#160;the&#160;hello&#160;dialog.<br/></i>Sub&#160;ExitHelloDlg<br/>&#160;&#160;oHelloDlg.endExecute()<br/>End&#160;Sub<br/>
To&#160;assign the&#160;“Execuate&#160;action”&#160;event&#160;to&#160;call&#160;the&#160;ExitHelloDlg macro, open the&#160;Properties&#160;dialog for the&#160;<br/>button&#160;and click&#160;the&#160;Events&#160;tab.&#160;Click the&#160;three&#160;dots&#160;to the&#160;right&#160;of the&#160;desired event&#160;(see<a href="libremacros.html#611">&#160;Figure&#160;135) t</a>o open<br/>the&#160;Assign action dialog (see<a href="libremacros.html#612">&#160;Figure&#160;136)</a>.&#160;<br/>
<b>Warn</b><br/>
I&#160;have&#160;seen&#160;different&#160;behaviors depending&#160;on the&#160;OOo variant&#160;and&#160;version. In&#160;LO&#160;4.0.2.2,&#160;if&#160;I&#160;click the&#160;dots&#160;<br/>
for&#160;Execute&#160;action (see<a href="libremacros.html#611">&#160;Figure&#160;135)</a>&#160;and then assign a&#160;macro to&#160;Item&#160;Status&#160;changed&#160;(see<a href="libremacros.html#612">&#160;Figure&#160;136)</a>,&#160;&#160;<br/>nothing&#160;was assigned. In&#160;other&#160;versions (not&#160;LO)&#160;I&#160;have&#160;assigned multiple&#160;actions and&#160;different&#160;actions and&#160;<br/>
they&#160;worked.<br/>
<i><b>Figure&#160;136.&#160;</b>Assign macros&#160;to&#160;event&#160;handlers.</i><br/>
609<br/>
<hr/>
<a name=613></a><b>Warn</b><br/>
To&#160;assign an event&#160;handler,&#160;you must&#160;click the&#160;Assign button and not&#160;the&#160;OK&#160;button.&#160;The&#160;only&#160;purpose&#160;for&#160;<br/>
the&#160;OK&#160;button is to close&#160;the&#160;Assign Macro&#160;dialog.&#160;It&#160;is a&#160;common&#160;and&#160;frustrating&#160;mistake&#160;to select&#160;an&#160;<br/>event&#160;handler&#160;for&#160;an event, and&#160;then click&#160;OK&#160;rather&#160;than&#160;Assign.<br/>
Highlight&#160;event&#160;and click the&#160;<b>Macro</b>&#160;button to open the&#160;<i>Macro&#160;Selector</i>&#160;dialog.<br/>
<b>TIP</b><br/>
If&#160;the&#160;dialog will&#160;be&#160;used with&#160;an XDialogEventHandler,&#160;then use&#160;the&#160;Component&#160;button&#160;in&#160;the&#160;<i>Assign&#160;</i><br/>
<i>action</i>&#160;dialog (see<a href="libremacros.html#612">&#160;Figure&#160;136)</a>&#160;and enter&#160;the&#160;name&#160;of&#160;the&#160;method&#160;to call.<br/>
<i><b>Figure&#160;137.&#160;</b>Assign macros&#160;to&#160;event&#160;handlers.</i><br/>
Use&#160;the&#160;<i>Library</i>&#160;tree&#160;control&#160;to select&#160;the&#160;macro library&#160;container (My&#160;Macros, application macros, or a&#160;<br/>document), the&#160;library,&#160;and module.&#160;Finally,&#160;select&#160;the&#160;desired macro in the&#160;<i>Library&#160;Name</i>&#160;list&#160;box.&#160;<br/>
610<br/>
<hr/>
<a name=614></a><i><b>&#160;18.2.&#160;Dialog&#160;and&#160;control&#160;paradigm<br/></b></i>To&#160;understand how&#160;controls&#160;work, it&#160;is&#160;important&#160;that&#160;you understand the&#160;difference&#160;between a&#160;model,&#160;a&#160;<br/>view,&#160;and a&#160;controller.&#160;The&#160;model-view-control&#160;paradigm,&#160;sometimes&#160;referred to&#160;as&#160;MVC, is&#160;very&#160;widely&#160;<br/>used and accepted&#160;in the&#160;computer science&#160;community.<br/>
The <i>model</i> describes a control’s appearance, data, and behavior. The model does not interact with a user and<br/>
it is not able to display itself. When an object supports the MVC paradigm, the changes should be made to <br/>
the object’s model and then these changes will automatically be propagated to the views by the controller. <br/>
Only one model can exist for an object.<br/>The <i>view</i> is what the user sees. Although there can be only one model for an object, multiple views may <br/>
exist to display an object.<br/>The <i>controller</i> is what interacts with the user. When the user tells the controller to perform some action, a <br/>
change is made to the model, and then the view is updated.<br/>
<b>Note</b><br/>
An&#160;OpenOffice.org&#160;document&#160;is&#160;distinguished&#160;from&#160;a&#160;non-document&#160;desktop component, such as the&#160;Basic&#160;<br/>
IDE&#160;or&#160;the&#160;Help&#160;window,&#160;by&#160;the&#160;fact&#160;that&#160;it&#160;has&#160;a&#160;data&#160;model. In&#160;other&#160;words, OOo&#160;uses the&#160;MVC&#160;paradigm&#160;<br/>for&#160;documents.<br/>
The&#160;controls&#160;that&#160;are&#160;displayed&#160;in&#160;dialogs&#160;generally&#160;contain&#160;access&#160;methods&#160;in&#160;the&#160;view&#160;portion&#160;that&#160;update&#160;<br/>and affect&#160;the&#160;model.&#160;I&#160;recommend that&#160;you use&#160;the&#160;model&#160;rather than the&#160;view&#160;methods&#160;unless&#160;you have&#160;a&#160;<br/>compelling reason to do otherwise;&#160;I&#160;am&#160;told that&#160;it&#160;can lead to&#160;some&#160;inconsistencies.&#160;Apparently&#160;this&#160;<br/>problem&#160;is&#160;more&#160;pronounced with&#160;controls&#160;embedded in&#160;forms&#160;than&#160;in dialogs, but&#160;I&#160;have&#160;never observed the<br/>inconsistencies&#160;directly.<br/>
<b>&#160;18.2.1.&#160;Dialog&#160;and&#160;control&#160;similarities<br/></b>In&#160;some&#160;respects, a&#160;dialog is&#160;also&#160;a&#160;control.&#160;Dialogs&#160;support&#160;the&#160;MVC paradigm&#160;and share&#160;many&#160;similarities&#160;<br/>with controls.&#160;For&#160;example, dialogs&#160;support&#160;the&#160;UnoControl&#160;service, which is&#160;common to&#160;all&#160;controls. UNO&#160;<br/>controls&#160;support&#160;the&#160;XComponent&#160;interface, which&#160;is&#160;also supported by&#160;numerous&#160;other objects&#160;in&#160;<br/>OpenOffice.org&#160;(see<a href="libremacros.html#614">&#160;Table&#160;257).</a><br/>
<i><b>Table&#160;257.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.lang.XComponent&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
dispose()<br/>
The&#160;object’s&#160;owner&#160;calls this&#160;method&#160;to free&#160;all&#160;the&#160;object’s&#160;<br/>
resources.&#160;You won’t&#160;usually&#160;call&#160;this&#160;method.<br/>
addEventListener(XEventListener)<br/>
Add an event&#160;listener&#160;to the&#160;object.<br/>
removeEventListener(XEventListener)<br/>
Remove&#160;an event&#160;listener&#160;from&#160;the&#160;object’s&#160;listener&#160;list.<br/>
The&#160;XControl&#160;interface&#160;identifies&#160;an object&#160;as&#160;a&#160;control.&#160;All&#160;objects&#160;that&#160;support&#160;the&#160;UnoControl&#160;service&#160;also&#160;<br/>support&#160;the&#160;XControl&#160;interface. For&#160;Basic&#160;programmers, the&#160;most&#160;interesting method&#160;is&#160;probably&#160;getModel()&#160;<br/>because&#160;it&#160;returns&#160;the&#160;control’s&#160;data&#160;model&#160;(see<a href="libremacros.html#615">&#160;Table&#160;258)</a>.<br/>
611<br/>
<hr/>
<a name=615></a><i><b>Table&#160;258.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.awt.XControl&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
setContext(XInterface)<br/>
Set&#160;the&#160;control’s&#160;context.<br/>
getContext()<br/>
Get&#160;the&#160;control’s&#160;context.<br/>
createPeer(XToolkit, XWindowPeer)<br/>
Create&#160;a&#160;child&#160;window.&#160;If&#160;the&#160;peer&#160;is&#160;null,&#160;the&#160;desktop&#160;is&#160;the&#160;parent.&#160;This&#160;<br/>
method&#160;is&#160;used&#160;to create&#160;a&#160;window&#160;to display&#160;a&#160;dialog&#160;that&#160;was created in&#160;a&#160;<br/>macro&#160;rather&#160;than&#160;in&#160;the&#160;IDE&#160;(see<a href="libremacros.html#655">&#160;Listing&#160;551)</a>.<br/>
getPeer()<br/>
Return the&#160;previously&#160;created or&#160;set&#160;peer&#160;XWindowPeer.<br/>
setModel(XControlModel)<br/>
Set&#160;the&#160;model’s&#160;control;&#160;return&#160;True&#160;if&#160;successful.<br/>
getModel()<br/>
Return the&#160;control’s&#160;XModel.<br/>
getView()<br/>
Return the&#160;control’s&#160;XView.<br/>
setDesignMode(Boolean)<br/>
Turn the&#160;design mode&#160;on&#160;and&#160;off.<br/>
isDesignMode()<br/>
Return&#160;True&#160;if&#160;the&#160;control&#160;is&#160;in&#160;design mode;&#160;otherwise&#160;return&#160;False.<br/>
isTransparent()<br/>
Return&#160;True&#160;if&#160;the&#160;control&#160;is&#160;transparent;&#160;otherwise&#160;return False.<br/>
When&#160;you&#160;set&#160;a&#160;position&#160;and a&#160;size&#160;by&#160;using a&#160;single&#160;method (see<a href="libremacros.html#615">&#160;Table&#160;260), t</a>he&#160;PosSize&#160;constant&#160;group is&#160;<br/>used to&#160;control&#160;which portions&#160;are&#160;actually&#160;updated (see<a href="libremacros.html#615">&#160;Table&#160;259)</a>.<br/>
<i><b>Table&#160;259.&#160;</b>Constants&#160;defined by&#160;the&#160;com.sun.star.awt.PosSize&#160;constant&#160;group.</i><br/>
<i><b>Constant</b></i><br/>
<i><b>Name</b></i><br/>
<i><b>Description</b></i><br/>
1<br/>
X&#160;<br/>
Flag&#160;the&#160;X&#160;coordinate.<br/>
2<br/>
Y&#160;<br/>
Flag&#160;the&#160;Y&#160;coordinate.<br/>
4<br/>
WIDTH&#160;<br/>
Flag&#160;the&#160;width.<br/>
8<br/>
HEIGHT&#160;<br/>
Flag&#160;the&#160;height.<br/>
3<br/>
POS&#160;<br/>
Flag&#160;the&#160;X&#160;and&#160;Y&#160;coordinates.<br/>
12<br/>
SIZE&#160;<br/>
Flag&#160;the&#160;width&#160;and&#160;height.<br/>
15<br/>
POSSIZE&#160;<br/>
Flag&#160;everything.<br/>
A&#160;window&#160;is&#160;a&#160;rectangular region on an output&#160;device&#160;defined&#160;primarily&#160;by&#160;its&#160;position and size.&#160;The&#160;<br/>constants&#160;in<a href="libremacros.html#615">&#160;Table&#160;259&#160;a</a>re&#160;used in the&#160;setPosSize() method&#160;shown i<a href="libremacros.html#615">n&#160;Table&#160;260&#160;t</a>o&#160;set&#160;the&#160;position and size.&#160;<br/>The&#160;XWindow&#160;interface&#160;defines&#160;the&#160;basic&#160;operations&#160;for a&#160;window&#160;component.&#160;The&#160;methods&#160;to get&#160;and set&#160;<br/>the&#160;position&#160;are&#160;demonstrated&#160;i<a href="libremacros.html#646">n&#160;Listing&#160;543.</a><br/>
<i><b>Table&#160;260.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.awt.XWindow interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
setPosSize&#160;(x, y,&#160;width, height, PosSize)<br/>
Set&#160;the&#160;window’s&#160;outer&#160;bounds (see<a href="libremacros.html#615">&#160;Table&#160;259)</a>.<br/>
getPosSize()<br/>
Return the&#160;window’s&#160;outer&#160;bounds as a&#160;rectangle.<br/>
setVisible(Boolean)<br/>
Show&#160;or&#160;hide&#160;the&#160;window.<br/>
setEnable(Boolean)<br/>
Enable&#160;or&#160;disable&#160;the&#160;window.<br/>
setFocus()<br/>
Focus this window.<br/>
addWindowListener(listener)<br/>
Add the&#160;XWindowListener.<br/>
612<br/>
<hr/>
<a name=616></a><i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
removeWindowListener(listener)<br/>
Remove&#160;the&#160;XWindowListener&#160;from&#160;the&#160;listener&#160;list.<br/>
addFocusListener(listener)<br/>
Add the&#160;XFocusListener.<br/>
removeFocusListener(listener)<br/>
Remove&#160;the&#160;XFocusListener&#160;from&#160;the&#160;listener&#160;list.<br/>
addKeyListener(listener)<br/>
Add the&#160;XKeyListener.<br/>
removeKeyListener(listener)<br/>
Remove&#160;the&#160;XKeyListener&#160;from&#160;the&#160;listener&#160;list.<br/>
addMouseListener(listener)<br/>
Add the&#160;XMouseListener.<br/>
removeMouseListener(listener)<br/>
Remove&#160;the&#160;XMouseListener&#160;from&#160;the&#160;listener&#160;list.<br/>
addMouseMotionListener(listener)<br/>
Add the&#160;XMouseMotionListener.<br/>
removeMouseMotionListener(listener)<br/>
Remove&#160;the&#160;XMouseMotionListener&#160;from&#160;the&#160;listener&#160;list.<br/>
addPaintListener(listener)<br/>
Add the&#160;XPaintListener.<br/>
removePaintListener(listener)<br/>
Remove&#160;the&#160;XPaintListener&#160;from&#160;the&#160;listener&#160;list.<br/>
The&#160;XView&#160;interface&#160;defines&#160;the&#160;methods&#160;required to&#160;display&#160;an object&#160;(see<a href="libremacros.html#616">&#160;Table&#160;261).&#160;</a>These&#160;methods&#160;are&#160;<br/>used primarily&#160;by&#160;advanced users&#160;and are&#160;included&#160;here&#160;only&#160;for completeness.<br/>
<i><b>Table&#160;261.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.awt.XView interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
setGraphics(XGraphics)<br/>
Set&#160;the&#160;output&#160;device.<br/>
getGraphics()<br/>
Return the&#160;XGraphics&#160;output&#160;device.<br/>
getSize()<br/>
Returns the&#160;size&#160;of&#160;the&#160;object&#160;in&#160;device&#160;units.<br/>
draw(x, y)<br/>
Draws the&#160;object&#160;at&#160;the&#160;specified position.<br/>
setZoom(x, y)<br/>
Set&#160;the&#160;zoom&#160;factor&#160;of&#160;the&#160;control’s&#160;contents.<br/>
<b>&#160;18.2.2.&#160;Dialog-specific&#160;methods<br/></b>The&#160;methods&#160;defined in<a href="libremacros.html#614">&#160;Table&#160;257&#160;t</a>hrou<a href="libremacros.html#616">gh&#160;Table&#160;261&#160;a</a>re&#160;common&#160;to&#160;all&#160;control&#160;types.&#160;As&#160;expected,&#160;<br/>however,&#160;dialogs&#160;support&#160;methods&#160;and properties&#160;that&#160;are&#160;specific&#160;to dialogs&#160;(see<a href="libremacros.html#616">&#160;Table&#160;262)</a>.<br/>
<i><b>Table&#160;262.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.awt.XDialog&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
setTitle()<br/>
Set&#160;the&#160;dialog’s&#160;title.<br/>
getTitle()<br/>
Get&#160;the&#160;dialog’s&#160;title.<br/>
execute()<br/>
Display&#160;the&#160;dialog.<br/>
endExecute()<br/>
Hide&#160;the&#160;dialog&#160;and&#160;cause&#160;the&#160;execute()&#160;method&#160;to return.<br/>
All&#160;controls&#160;act&#160;as&#160;a&#160;window:&#160;They&#160;are&#160;rectangular in&#160;shape, can receive&#160;focus, be&#160;enabled and disabled, and&#160;<br/>have&#160;listeners&#160;(see<a href="libremacros.html#615">&#160;Table&#160;260)</a>.&#160;Top-level&#160;windows&#160;add extra&#160;functionality&#160;because&#160;they&#160;are&#160;not&#160;contained&#160;in&#160;<br/>another window&#160;(see<a href="libremacros.html#617">&#160;Table&#160;263)</a>.<br/>
613<br/>
<hr/>
<a name=617></a><i><b>Table&#160;263.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.awt.XTopWindow interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
addTopWindowListener(XTopWindowListener)<br/>
Add&#160;a&#160;listener&#160;for&#160;this window.<br/>
removeTopWindowListener(XTopWindowListener)<br/>
Remove&#160;a&#160;listener&#160;so&#160;that&#160;it&#160;no longer&#160;receives&#160;<br/>events from&#160;this&#160;window.<br/>
toFront()<br/>
Move&#160;this window&#160;in front&#160;of&#160;all&#160;other&#160;windows.<br/>
toBack()<br/>
Move&#160;this window&#160;behind all&#160;other&#160;windows.<br/>
setMenuBar(XMenuBar)<br/>
Set&#160;a&#160;menu&#160;bar&#160;for&#160;this&#160;window.<br/>
The&#160;primary&#160;function&#160;of a&#160;dialog is&#160;to contain&#160;controls.&#160;The&#160;methods&#160;i<a href="libremacros.html#617">n&#160;Table&#160;264&#160;a</a>llow&#160;a&#160;dialog to&#160;add,&#160;<br/>remove,&#160;and get&#160;controls&#160;contained&#160;in a&#160;dialog. It&#160;is&#160;very&#160;common&#160;to extract&#160;a&#160;control&#160;from&#160;a&#160;dialog to read&#160;<br/>or set&#160;its&#160;value.<br/>
<i><b>Table&#160;264.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.awt.XControlContainer&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
setStatusText(String)<br/>
Set&#160;the&#160;text&#160;in&#160;the&#160;container’s&#160;status bar.<br/>
getControls()<br/>
Return all&#160;controls&#160;as&#160;an array&#160;of&#160;type&#160;XControl.<br/>
getControl(name)<br/>
Return the&#160;XControl&#160;with&#160;the&#160;specified&#160;name.<br/>
addControl(name, XControl)<br/>
Add&#160;the&#160;XControl&#160;to the&#160;container.<br/>
removeControl(XControl)<br/>
Remove&#160;the&#160;XControl&#160;from&#160;the&#160;container.<br/>
Controls&#160;are&#160;usually&#160;not&#160;added to&#160;or removed from&#160;the&#160;dialog. If&#160;you create&#160;a&#160;dialog using a&#160;macro, rather&#160;<br/>than designing the&#160;dialog in the&#160;IDE, you&#160;add control&#160;models&#160;to&#160;the&#160;dialog’s&#160;model, rather than adding&#160;<br/>controls&#160;directly&#160;to the&#160;dialog.&#160;As&#160;usual,&#160;the&#160;work is&#160;done&#160;in&#160;the&#160;model&#160;and the&#160;changes&#160;are&#160;reflected in&#160;the&#160;<br/>view.&#160;The&#160;most-used method in<a href="libremacros.html#617">&#160;Table&#160;264&#160;i</a>s&#160;getControl(name).<br/>
<b>&#160;18.2.3.&#160;The&#160;dialog&#160;model<br/></b>You can obtain&#160;a&#160;control’s&#160;model&#160;by&#160;using the&#160;method getModel() defined&#160;i<a href="libremacros.html#615">n&#160;Table&#160;258. D</a>ialogs&#160;support&#160;the&#160;<br/>UnoControlDialogModel&#160;service&#160;(see<a href="libremacros.html#617">&#160;Table&#160;265) t</a>hat&#160;defines&#160;many&#160;of the&#160;properties&#160;that&#160;you&#160;can set&#160;from&#160;<br/>the&#160;Basic&#160;IDE&#160;(see<a href="libremacros.html#609">&#160;Figure&#160;134).&#160;</a>You can set&#160;some&#160;properties&#160;directly&#160;from&#160;the&#160;dialog object—the&#160;setTitle()&#160;<br/>method&#160;i<a href="libremacros.html#616">n&#160;Table&#160;262, fo</a>r example—but&#160;it&#160;is&#160;better to modify&#160;the&#160;model&#160;directly.<br/>
<i><b>Table&#160;265.&#160;</b>Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.awt.UnoControlDialogModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BackgroundColor<br/>
Dialog’s&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
Closeable<br/>
If&#160;True, the&#160;dialog&#160;is closeable.<br/>
Enabled<br/>
If&#160;True, the&#160;dialog&#160;is enabled.<br/>
FontDescriptor<br/>
Structure&#160;that&#160;defines and describes&#160;the&#160;font&#160;for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption&#160;<br/>bar.<br/>
FontEmphasisMark<br/>
Constant&#160;that&#160;defines the&#160;type/position of&#160;the&#160;emphasis mark&#160;for&#160;text&#160;in dialog’s&#160;<br/>caption bar.<br/>
FontRelief<br/>
Constant&#160;that&#160;specifies if&#160;the&#160;dialog’s&#160;caption&#160;bar&#160;contains&#160;embossed or&#160;engraved&#160;<br/>text.<br/>
614<br/>
<hr/>
<a name=618></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
HelpText<br/>
Dialog’s&#160;help&#160;text&#160;as a&#160;String.<br/>
HelpURL<br/>
Dialog’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
Moveable<br/>
If&#160;True, the&#160;dialog&#160;is moveable.<br/>
Sizeable<br/>
If&#160;True, the&#160;dialog&#160;is sizeable.<br/>
TextColor<br/>
Dialog’s&#160;text&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
TextLineColor<br/>
Dialog’s&#160;text&#160;line&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
Title<br/>
Text&#160;string&#160;displayed in&#160;the&#160;dialog’s&#160;caption bar.<br/>
Controls&#160;that&#160;can be&#160;inserted into&#160;an UNO&#160;control&#160;dialog support&#160;the&#160;properties&#160;defined by&#160;the&#160;<br/>UnoControlDialogElement&#160;service&#160;(see<a href="libremacros.html#618">&#160;Table&#160;266)</a>.<br/>
<i><b>Table&#160;266.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlDialogElement&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Height&#160;<br/>
Control’s&#160;height.<br/>
Name&#160;<br/>
Control’s&#160;name.<br/>
PositionX&#160;<br/>
Control’s&#160;horizontal&#160;position.<br/>
PositionY&#160;<br/>
Control’s&#160;vertical&#160;position.<br/>
Step&#160;<br/>
Control’s&#160;step.<br/>
TabIndex&#160;<br/>
Control’s&#160;tab index.<br/>
Tag&#160;<br/>
Control’s&#160;tag.<br/>
Width&#160;<br/>
Control’s&#160;width.<br/>
It&#160;is&#160;possible&#160;to create&#160;controls&#160;and dialogs&#160;by&#160;using a&#160;macro rather than designing them&#160;in the&#160;Basic&#160;IDE.&#160;The<br/>dialog’s&#160;model&#160;supports&#160;the&#160;createInstance() method&#160;defined by&#160;the&#160;com.sun.star.lang.XMultiServiceFactory&#160;<br/>interface.&#160;When&#160;a&#160;macro creates&#160;a&#160;control&#160;to&#160;be&#160;inserted&#160;into&#160;a&#160;dialog, that&#160;control&#160;should be&#160;created&#160;by&#160;the&#160;<br/>dialog’s&#160;model.&#160;A&#160;control&#160;that&#160;is&#160;created from&#160;the&#160;global&#160;service&#160;manager will&#160;not&#160;have&#160;the&#160;properties&#160;shown&#160;<br/>i<a href="libremacros.html#618">n&#160;Table&#160;266. Cre</a>ating controls&#160;by&#160;using a&#160;macro is&#160;an advanced topic&#160;that&#160;is&#160;discussed later in&#160;this&#160;chapter.&#160;<br/>The&#160;macro i<a href="libremacros.html#618">n&#160;Listing&#160;527&#160;s</a>hows&#160;the&#160;objects&#160;that&#160;a&#160;dialog model&#160;can create&#160;(see<a href="libremacros.html#619">&#160;Figure&#160;138)</a>.<br/>
<i><b>Listing&#160;527.&#160;</b>What&#160;services&#160;can the&#160;dialog model&#160;create?</i><br/>
Sub&#160;ShowDialogServices<br/>&#160;&#160;Dim&#160;oLib&#160; &#160; &#160; &#160;&#160;'Library that contains the dialog<br/>&#160;&#160;Dim&#160;oLibDlg&#160; &#160; &#160;'Dialog as stored in the library<br/>
&#160;&#160;DialogLibraries.loadLibrary(&#34;OOME_30&#34;)<br/>&#160;&#160;oLib&#160;=&#160;DialogLibraries.getByName(&#34;OOME_30&#34;)<br/>&#160;&#160;oLibDlg&#160;=&#160;oLib.getByName(&#34;HelloDlg&#34;)<br/>&#160;&#160;oHelloDlg&#160;=&#160;CreateUnoDialog(oLibDlg)<br/>&#160;&#160;MsgBox&#160;Join(oHelloDlg.getModel().getAvailableServiceNames(),&#160;CHR$(10))<br/>End&#160;Sub&#160;<br/>
615<br/>
<hr/>
<a name=619></a><i><b>Figure&#160;138.&#160;</b>Services&#160;that&#160;the&#160;dialog&#160;model&#160;in&#160;AOO&#160;3.4.1 can create.</i><br/>
<i><b>&#160;18.3.&#160;Controls<br/></b></i>You can obtain&#160;a&#160;control&#160;directly&#160;from&#160;a&#160;dialog by&#160;calling the&#160;getControl() method.&#160;You can obtain&#160;a&#160;<br/>control’s&#160;model&#160;by&#160;calling the&#160;getModel() method on the&#160;control, or by&#160;calling&#160;getByName() on the&#160;model&#160;of<br/>the&#160;object&#160;in&#160;which it&#160;is&#160;contained.&#160;In&#160;other words, you&#160;can get&#160;a&#160;control’s&#160;model&#160;from&#160;the&#160;dialog’s&#160;model.&#160;<br/>The&#160;code&#160;in<a href="libremacros.html#619">&#160;Listing 528&#160;de</a>monstrates&#160;the&#160;options&#160;available.<br/>
<b>TIP</b><br/>
You can insert&#160;controls into dialogs and forms, but&#160;not&#160;all&#160;controls&#160;work&#160;in&#160;dialogs. Some&#160;controls&#160;require&#160;a<br/>
data&#160;source,&#160;but&#160;a&#160;dialog&#160;is&#160;not&#160;able&#160;to contain a&#160;data&#160;source.&#160;This chapter&#160;deals&#160;only&#160;with controls that&#160;can&#160;<br/>be&#160;inserted&#160;into&#160;a&#160;dialog.<br/>
<i><b>Listing&#160;528.&#160;</b>Get&#160;the&#160;button or&#160;the&#160;button’s&#160;model.<br/></i>oHelloDlg.getControl(&#34;OKButton&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Get the UnoControlButton<br/>oHelloDlg.getControl(&#34;OKButton&#34;).getModel()&#160; &#160;'Get the UnoControlButtonModel<br/>oHelloDlg.getModel().getByName(&#34;OKButton&#34;)&#160; &#160;&#160;'Get the UnoControlButtonModel<br/>
616<br/>
<hr/>
<a name=620></a>The&#160;control&#160;types&#160;that&#160;can be&#160;inserted&#160;into&#160;a&#160;dialog&#160;are&#160;defined in&#160;the&#160;com.sun.star.awt&#160;module&#160;(see<a href="libremacros.html#620">&#160;Table&#160;<br/>267&#160;a</a><a href="libremacros.html#619">nd&#160;Figure&#160;138)</a>. Notice&#160;the&#160;similarity&#160;between the&#160;service&#160;name&#160;of the&#160;control&#160;and the&#160;service&#160;name&#160;of&#160;<br/>the&#160;control’s&#160;model.<br/>
<i><b>Table&#160;267.&#160;</b>Controls&#160;and their&#160;models&#160;defined in the&#160;com.sun.star.awt&#160;module.</i><br/>
<i><b>Control</b></i><br/>
<i><b>Model</b></i><br/>
<i><b>Description</b></i><br/>
TreeControl<br/>
TreeControlModel<br/>
UnoControlButton<br/>
UnoControlButtonModel<br/>
Button<br/>
UnoControlCheckBox<br/>
UnoControlCheckBoxModel<br/>
Check box<br/>
UnoControlComboBox<br/>
UnoControlComboBoxModel<br/>
Combo&#160;box<br/>
UnoControlCurrencyField<br/>
UnoControlCurrencyFieldModel<br/>
Currency&#160;field<br/>
UnoControlDateField<br/>
UnoControlDateFieldModel<br/>
Date&#160;field<br/>
UnoControlDialog<br/>
UnoControlDialogModel<br/>
Dialog<br/>
UnoControlEdit<br/>
UnoControlEditModel<br/>
Text&#160;edit&#160;field<br/>
UnoControlFileControl<br/>
UnoControlFileControlModel<br/>
Select&#160;a&#160;file<br/>
UnoControlFixedLine<br/>
UnoControlFixedLineModel<br/>
Fixed&#160;line<br/>
UnoControlFixedText<br/>
UnoControlFixedTextModel<br/>
Display&#160;fixed<br/>
UnoControlFormattedField<br/>
UnoControlFormattedFieldModel<br/>
Formatted&#160;field<br/>
UnoControlGroupBox<br/>
UnoControlGroupBoxModel<br/>
Group&#160;box<br/>
UnoControlImageControl<br/>
UnoControlImageControlModel<br/>
Display&#160;an image<br/>
UnoControlListBox<br/>
UnoControlListBoxModel<br/>
List&#160;box<br/>
UnoControlNumericField<br/>
UnoControlNumericFieldModel<br/>
Numeric&#160;field<br/>
UnoControlPatternField<br/>
UnoControlPatternFieldModel<br/>
Pattern field<br/>
UnoControlProgressBar<br/>
UnoControlProgressBarModel<br/>
Progress bar<br/>
UnoControlRadioButton<br/>
UnoControlRadioButtonModel<br/>
Radio&#160;button<br/>
UnoControlRoadmap<br/>
UnoControlRoadmapModel<br/>
Roadmap&#160;control<br/>
UnoControlScrollBar<br/>
UnoControlScrollBarModel<br/>
Scroll&#160;bar<br/>
UnoControlTimeField<br/>
UnoControlTimeFieldModel<br/>
Time&#160;field<br/>
<b>Note</b><br/>
To&#160;assist&#160;in&#160;the&#160;demonstration of&#160;the&#160;different&#160;dialog controls, create&#160;a&#160;dialog&#160;called OOMESample.&#160;As&#160;the&#160;<br/>control&#160;types are&#160;discussed,&#160;I&#160;will&#160;direct&#160;you to add&#160;controls&#160;to the&#160;OOMESample&#160;dialog.&#160;See<a href="libremacros.html#646">&#160;Figure&#160;139&#160;</a><br/>
for&#160;the&#160;final&#160;dialog.&#160;Start&#160;by&#160;creating&#160;the&#160;OOMESample&#160;dialog and making&#160;it&#160;large&#160;enough to fill&#160;most&#160;of&#160;<br/>the&#160;screen. ??&#160;How&#160;BIG&#160;??<br/>
<b>&#160;18.3.1.&#160;Control&#160;button<br/></b>A&#160;control&#160;button&#160;is&#160;a&#160;standard button&#160;that&#160;causes&#160;something to&#160;happen when it&#160;is&#160;“pressed.”&#160;A&#160;button’s&#160;type&#160;is<br/>controlled&#160;by&#160;the&#160;PushButtonType&#160;property&#160;in a&#160;button’s&#160;model.&#160;A&#160;button&#160;can be&#160;set&#160;to&#160;automatically&#160;close&#160;or<br/>cancel&#160;a&#160;dialog without&#160;writing an event&#160;handler;&#160;a&#160;default&#160;event&#160;handler is&#160;provided automatically&#160;for these&#160;<br/>predefined actions&#160;(see<a href="libremacros.html#621">&#160;Table&#160;268)</a>.<br/>
617<br/>
<hr/>
<a name=621></a><i><b>Table&#160;268.&#160;</b>Values&#160;defined by&#160;the&#160;com.sun.star.awt.PushButtonType&#160;enumeration.</i><br/>
<i><b>Enumeration</b></i><br/>
<i><b>Description</b></i><br/>
STANDARD&#160;<br/>
The&#160;default&#160;value.&#160;You must&#160;write&#160;your&#160;own&#160;event&#160;handler.<br/>
OK&#160;<br/>
Act&#160;like&#160;an OK&#160;button by&#160;closing&#160;the&#160;dialog&#160;and&#160;returning&#160;1 from&#160;the&#160;execute()&#160;<br/>function.<br/>
CANCEL&#160;<br/>
Act&#160;like&#160;a&#160;Cancel&#160;button&#160;by&#160;closing&#160;the&#160;dialog&#160;and&#160;returning&#160;0&#160;from&#160;the&#160;execute()&#160;<br/>function.<br/>
HELP&#160;<br/>
Act&#160;like&#160;a&#160;Help button and open the&#160;help&#160;URL.<br/>
A&#160;control&#160;button&#160;can display&#160;a&#160;text&#160;label&#160;set&#160;by&#160;the&#160;Label&#160;property&#160;or a&#160;graphic&#160;image&#160;set&#160;by&#160;the&#160;ImageURL&#160;<br/>property.&#160;If&#160;the&#160;button&#160;displays&#160;an image&#160;rather than a&#160;label,&#160;the&#160;image&#160;is&#160;aligned based on a&#160;value&#160;defined by<br/>the&#160;ImageAlign constant&#160;group (see<a href="libremacros.html#621">&#160;Table&#160;269)</a>.<br/>
<i><b>Table&#160;269.&#160;</b>Constants&#160;defined by&#160;the&#160;com.sun.star.awt.ImageAlign constant&#160;group.</i><br/>
<i><b>Constant</b></i><br/>
<i><b>Name</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
LEFT&#160;<br/>
Align the&#160;image&#160;to the&#160;left.<br/>
1<br/>
TOP&#160;<br/>
Align the&#160;image&#160;to the&#160;top.<br/>
2<br/>
RIGHT&#160;<br/>
Align the&#160;image&#160;to the&#160;right.<br/>
3<br/>
BOTTOM&#160;<br/>
Align the&#160;image&#160;to the&#160;bottom.<br/>
<b>TIP</b><br/>
Although a&#160;button can&#160;contain&#160;an image,&#160;it&#160;crops the&#160;image&#160;to fit. Use&#160;an&#160;Image&#160;control,&#160;rather&#160;than a&#160;<br/>
button,&#160;if&#160;you&#160;need&#160;to scale&#160;the&#160;image.<br/>
The&#160;button&#160;model&#160;supports&#160;many&#160;of the&#160;same&#160;properties&#160;as&#160;the&#160;dialog model&#160;but&#160;it&#160;also supports&#160;some&#160;<br/>button-specific&#160;properties&#160;(see<a href="libremacros.html#621">&#160;Table&#160;270).</a><br/>
<i><b>Table&#160;270.&#160;</b>Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.awt.UnoControlButtonModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Align<br/>
Optional, specifies&#160;the&#160;horizontal&#160;alignment&#160;of&#160;the&#160;text&#160;in the&#160;ctonrol.<br/>
BackgroundColor<br/>
Dialog’s&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
DefaultButton<br/>
If&#160;True,&#160;this button&#160;is the&#160;default&#160;button.<br/>
Enabled<br/>
If&#160;True,&#160;the&#160;dialog is&#160;enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in the&#160;control.<br/>
FontEmphasisMark<br/>
FontEmphasis&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption&#160;bar.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
HelpText<br/>
Dialog’s&#160;help&#160;text&#160;as&#160;a&#160;String.<br/>
HelpURL<br/>
Dialog’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
ImageAlign<br/>
Specify&#160;how&#160;an&#160;image&#160;is aligned&#160;in the&#160;button (see<a href="libremacros.html#621">&#160;Table&#160;269)</a>.<br/>
ImageURL<br/>
URL&#160;of&#160;the&#160;image&#160;to display&#160;on the&#160;button. If&#160;the&#160;image&#160;is&#160;too&#160;large,&#160;it&#160;is&#160;<br/>cropped.<br/>
Label<br/>
String&#160;label&#160;displayed&#160;on&#160;the&#160;control.<br/>
618<br/>
<hr/>
<a name=622></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
MultiLine<br/>
Optional, specifies&#160;that&#160;the&#160;text&#160;may&#160;be&#160;displayed&#160;on more&#160;than&#160;one&#160;line.<br/>
Printable<br/>
If&#160;True,&#160;the&#160;button is printed&#160;when the&#160;document&#160;is printed.<br/>
PushButtonType<br/>
The&#160;default&#160;button action&#160;(see<a href="libremacros.html#621">&#160;Table&#160;268)</a>.<br/>
State<br/>
If&#160;1,&#160;the&#160;button is activated;&#160;otherwise, the&#160;state&#160;is&#160;0.<br/>
Tabstop<br/>
If&#160;True,&#160;the&#160;control&#160;can be&#160;reached&#160;by&#160;using&#160;the&#160;Tab&#160;key.<br/>
TextColor<br/>
Dialog’s&#160;text&#160;color&#160;as a&#160;Long Integer.<br/>
TextLineColor<br/>
Dialog’s&#160;text&#160;line&#160;color&#160;as a&#160;Long Integer.<br/>
Toggle<br/>
Optional, specifies&#160;if&#160;the&#160;button should toggle&#160;in a&#160;single&#160;operation.<br/>
VerticalAlign<br/>
Optional, specifies&#160;the&#160;vertical&#160;alignment&#160;of&#160;the&#160;text&#160;in&#160;the&#160;control. Supported&#160;<br/>
values are&#160;from&#160;com.sun.star.style.VerticalAlignment&#160;with supporting&#160;values&#160;of&#160;<br/>TOP,&#160;MIDDLE,&#160;or&#160;BOTTOM.<br/>
<b>Note</b><br/>
Add&#160;an OK&#160;button to close&#160;the&#160;OOMESample&#160;dialog.&#160;Add&#160;a&#160;second&#160;button, named&#160;ClickButton, that&#160;calls&#160;<br/>
OOMEDlgButton i<a href="libremacros.html#622">n&#160;Listing&#160;529.</a><br/>
Add two buttons&#160;to&#160;the&#160;OOMESample&#160;dialog. Set&#160;one&#160;button to&#160;close&#160;the&#160;dialog when it&#160;is&#160;selected;&#160;label&#160;the<br/>button&#160;“Close”&#160;and set&#160;the&#160;button&#160;type&#160;to OK.&#160;The&#160;close&#160;button&#160;will&#160;automatically&#160;close&#160;the&#160;dialog&#160;when it&#160;is&#160;<br/>selected. Name&#160;the&#160;second button&#160;ClickButton and set&#160;the&#160;label&#160;to “Click Here”. Enter the&#160;code&#160;in<a href="libremacros.html#622">&#160;Listing&#160;<br/>529&#160;a</a>nd set&#160;the&#160;“Execute&#160;action”&#160;event&#160;of the&#160;ClickButton&#160;to&#160;call&#160;the&#160;OOMEDlgButton&#160;subroutine.&#160;When&#160;<br/>the&#160;ClickButton&#160;is&#160;selected,&#160;its&#160;label&#160;is&#160;changed to&#160;indicate&#160;the&#160;number of times&#160;that&#160;the&#160;button&#160;has&#160;been&#160;<br/>clicked.<br/>
<i><b>Listing&#160;529.&#160;</b>Run the&#160;sample&#160;OOME&#160;Dialog.</i><br/>
Option&#160;Explicit<br/>
REM Global variables<br/>Dim&#160;oOOMEDlg&#160; &#160; &#160;'The run-time dialog that is created<br/>Dim&#160;nClickCount%&#160;'Number of times the button was clicked<br/>
Sub&#160;RunOOMEDlg<br/>&#160;&#160;REM Declare the primary variables<br/>&#160;&#160;Dim&#160;oLib&#160; &#160; &#160; &#160;&#160;'Library that contains the dialog<br/>&#160;&#160;Dim&#160;oLibDlg&#160; &#160; &#160;'Dialog as stored in the library<br/>
&#160;&#160;REM Load the library and the dialog<br/>&#160;&#160;DialogLibraries.loadLibrary(&#34;OOME_30&#34;)<br/>&#160;&#160;oLib&#160;=&#160;DialogLibraries.getByName(&#34;OOME_30&#34;)<br/>&#160;&#160;oLibDlg&#160;=&#160;oLib.getByName(&#34;OOMESample&#34;)<br/>&#160;&#160;oOOMEDlg&#160;=&#160;CreateUnoDialog(oLibDlg)<br/>&#160;&#160;<br/>&#160;&#160;REM Initial setup code here<br/>&#160;&#160;nClickCount&#160;=&#160;0<br/>&#160;&#160;oOOMEDlg.getModel.Title&#160;=&#160;&#34;OpenOffice.org Macros Explained Sample Dialog&#34;<br/>
&#160;&#160;REM This can be used with the check box to be added.<br/>
619<br/>
<hr/>
<a name=623></a>&#160;&#160;REM oOOMEDlg.getModel().getByName(&#34;CheckBox&#34;).TriState = True<br/>
&#160;&#160;REM Run the dialog<br/>&#160;&#160;oOOMEDlg.execute()<br/>End&#160;Sub<br/>
Sub&#160;OOMEDlgButton<br/>&#160;&#160;Dim&#160;oButtonModel<br/>&#160;&#160;nClickCount&#160;=&#160;nClickCount&#160;+&#160;1<br/>&#160;&#160;oButtonModel&#160;=&#160;oOOMEDlg.getModel().getByName(&#34;ClickButton&#34;)<br/>&#160;&#160;oButtonModel.Label&#160;=&#160;&#34;Click &#34;&#160;&amp;&#160;nClickCount<br/>End&#160;Sub<br/>
<b>&#160;18.3.2.&#160;Check&#160;box<br/></b>Although a&#160;check box&#160;is&#160;usually&#160;used to indicate&#160;a&#160;single&#160;state&#160;of yes&#160;or no, the&#160;check box&#160;in OOo can be&#160;<br/>used as&#160;a&#160;tristate&#160;check box.&#160;The&#160;default&#160;behavior&#160;is&#160;for a&#160;check box&#160;to support&#160;the&#160;states&#160;0 (not&#160;checked) and<br/>1 (checked);&#160;this&#160;is&#160;the&#160;State&#160;property&#160;in the&#160;model.&#160;If&#160;the&#160;TriState&#160;property&#160;is&#160;True, however,&#160;a&#160;third state&#160;of&#160;<br/>2 is&#160;allowed.&#160;The&#160;third state&#160;is&#160;displayed as&#160;checked, but&#160;the&#160;check box&#160;is&#160;dimmed.&#160;The&#160;properties&#160;i<a href="libremacros.html#623">n&#160;Table&#160;<br/>271&#160;a</a>re&#160;supported&#160;by&#160;the&#160;check box&#160;button model.<br/>
<i><b>Table&#160;271.&#160;</b>Properties&#160;defined&#160;by&#160;com.sun.star.awt.UnoControlCheckBoxModel.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Enabled<br/>
If&#160;True,&#160;the&#160;dialog is&#160;enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
FontEmphasisMark<br/>
FontEmphasis&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption&#160;bar.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
HelpText<br/>
Dialog’s&#160;help&#160;text&#160;as&#160;a&#160;String.<br/>
HelpURL<br/>
Dialog’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
Label<br/>
String&#160;label&#160;displayed&#160;on&#160;the&#160;control.<br/>
Printable<br/>
If&#160;True,&#160;the&#160;button is printed&#160;when the&#160;document&#160;is printed.<br/>
State<br/>
If&#160;0,&#160;the&#160;button is not&#160;checked;&#160;if&#160;1,&#160;the&#160;button&#160;is checked;&#160;2&#160;is the&#160;“don’t&#160;know”&#160;<br/>state.<br/>
Tabstop&#160;<br/>
If&#160;True,&#160;the&#160;control&#160;can be&#160;reached&#160;by&#160;using&#160;the&#160;Tab&#160;key.<br/>
TextColor<br/>
Dialog’s&#160;text&#160;color&#160;as a&#160;Long Integer.<br/>
TextLineColor<br/>
Dialog’s&#160;text&#160;line&#160;color&#160;as a&#160;Long Integer.<br/>
TriState&#160;<br/>
If&#160;True,&#160;the&#160;button supports&#160;the&#160;“don’t&#160;know”&#160;state&#160;of&#160;2.<br/>
<b>Note</b><br/>
Add&#160;a&#160;check box&#160;to the&#160;OOMESample&#160;dialog&#160;and&#160;name&#160;it&#160;CheckBox.&#160;The&#160;“When initiating”&#160;event&#160;will&#160;call<br/>
OOMEDlgCheckBox&#160;i<a href="libremacros.html#624">n&#160;Listing&#160;530.</a><br/>
Add a&#160;check box&#160;to the&#160;sample&#160;dialog and set&#160;the&#160;button&#160;name&#160;to CheckBox.&#160;In&#160;the&#160;RunOOMEDlg&#160;routine,&#160;<br/>add code&#160;to&#160;the&#160;initialization&#160;section to&#160;set&#160;the&#160;check box&#160;to&#160;be&#160;a&#160;tristate&#160;check box.&#160;The&#160;TriState&#160;property&#160;<br/>can also&#160;be&#160;enabled in&#160;the&#160;Properties&#160;dialog for the&#160;control&#160;in&#160;the&#160;Basic&#160;IDE.<br/>
&#160;&#160;oOOMEDlg.getModel().getByName(&#34;CheckBox&#34;).TriState&#160;=&#160;True<br/>
620<br/>
<hr/>
<a name=624></a>Add the&#160;code&#160;in<a href="libremacros.html#624">&#160;Listing 530&#160;a</a>nd then set&#160;the&#160;“When initiating”&#160;event&#160;to&#160;call&#160;the&#160;routine&#160;i<a href="libremacros.html#624">n&#160;Listing&#160;530.&#160;</a>When<br/>the&#160;check box&#160;is&#160;selected, its&#160;label&#160;is&#160;updated&#160;to show&#160;its&#160;state.<br/>
<i><b>Listing&#160;530.</b>&#160;Change&#160;the&#160;label&#160;on the&#160;checkbox&#160;to indicate&#160;state.<br/></i>Sub&#160;OOMEDlgCheckBox<br/>&#160;&#160;Dim&#160;oModel<br/>&#160;&#160;oModel&#160;=&#160;oOOMEDlg.getModel().getByName(&#34;CheckBox&#34;)<br/>&#160;&#160;oModel.Label&#160;=&#160;&#34;State &#34;&#160;&amp;&#160;oModel.state<br/>
' &#160;If oModel.state = 0 Then<br/>' &#160; &#160;oOOMEDlg.getModel().getByName(&#34;OBClear&#34;).state = 1<br/>' &#160;ElseIf oModel.state = 1 Then<br/>' &#160; &#160;oOOMEDlg.getModel().getByName(&#34;OBSet&#34;).state = 1<br/>' &#160;ElseIf oModel.state = 2 Then<br/>' &#160; &#160;oOOMEDlg.getModel().getByName(&#34;OBUnknown&#34;).state = 1<br/>' &#160;End If<br/>
End&#160;Sub<br/>
<b>&#160;18.3.3.&#160;Radio&#160;button<br/></b>Radio&#160;buttons&#160;are&#160;usually&#160;used to select&#160;one&#160;item&#160;from&#160;a&#160;small&#160;list.&#160;(For a&#160;large&#160;list, it’s&#160;common&#160;to use&#160;a&#160;<br/>combo box or a&#160;list&#160;box.) Radio&#160;buttons&#160;are&#160;always&#160;used in a&#160;group, and only&#160;one&#160;radio&#160;button in&#160;each group&#160;<br/>is&#160;active&#160;at&#160;a&#160;time.&#160;When a&#160;radio&#160;button&#160;is&#160;selected,&#160;OOo automatically&#160;marks&#160;all&#160;other radio buttons&#160;in&#160;the&#160;<br/>same&#160;group as&#160;not&#160;active.<br/>
Every&#160;control&#160;supports&#160;the&#160;UnoControlDialogElement&#160;service&#160;(see<a href="libremacros.html#618">&#160;Table&#160;266).&#160;</a>The&#160;TabIndex&#160;property&#160;<br/>specifies&#160;the&#160;order in&#160;which controls&#160;are&#160;visited while&#160;repeatedly&#160;pressing the&#160;Tab key.&#160;The&#160;TabIndex&#160;<br/>property&#160;is&#160;usually&#160;set&#160;in the&#160;IDE&#160;at&#160;design time&#160;by&#160;setting the&#160;control’s&#160;“order”&#160;property.&#160;Unfortunately,&#160;a&#160;<br/>different&#160;name&#160;is&#160;used in&#160;the&#160;IDE&#160;than in&#160;the&#160;defining service.<br/>
In&#160;OOo, a&#160;visual&#160;grouping that&#160;uses&#160;an UnoControlGroupBox has&#160;no effect&#160;other than to&#160;draw&#160;a&#160;frame&#160;<br/>around the&#160;controls. In&#160;other words, it&#160;provides&#160;a&#160;visual&#160;reminder that&#160;the&#160;radio&#160;buttons&#160;should be&#160;grouped,&#160;<br/>but&#160;it&#160;does&#160;not&#160;group them. Radio&#160;buttons&#160;are&#160;in&#160;the&#160;same&#160;group if (and only&#160;if) they&#160;have&#160;a&#160;sequential&#160;tab&#160;<br/>order;&#160;in&#160;Visual&#160;Basic, radio&#160;buttons&#160;are&#160;grouped based on the&#160;group box.&#160;Create&#160;all&#160;of the&#160;radio&#160;buttons&#160;that&#160;<br/>will&#160;exist&#160;in&#160;a&#160;single&#160;group in&#160;sequence. By&#160;creating the&#160;buttons&#160;sequentially,&#160;they&#160;will&#160;automatically&#160;have&#160;<br/>sequential&#160;tab stops&#160;and will&#160;therefore&#160;all&#160;be&#160;in&#160;the&#160;same&#160;group. If&#160;you then create&#160;a&#160;group box&#160;to place&#160;<br/>around the&#160;radio&#160;buttons,&#160;the&#160;group box&#160;will&#160;break the&#160;tab-stop&#160;sequence&#160;so that&#160;you&#160;can safely&#160;create&#160;a&#160;new&#160;<br/>sequence&#160;of radio buttons. See<a href="libremacros.html#624">&#160;Table&#160;272.</a><br/>
<i><b>Table&#160;272.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlRadioButtonModel.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Enabled<br/>
If&#160;True, the&#160;dialog&#160;is enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption bar.<br/>
FontEmphasisMark<br/>
FontEmphasis for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption bar.<br/>
HelpText<br/>
Dialog’s&#160;help&#160;text&#160;as a&#160;String.<br/>
HelpURL<br/>
Dialog’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
Label<br/>
String&#160;label&#160;displayed&#160;on the&#160;control.<br/>
Printable<br/>
If&#160;True, the&#160;button is&#160;printed&#160;when&#160;the&#160;document&#160;is&#160;printed.<br/>
621<br/>
<hr/>
<a name=625></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
State<br/>
If&#160;0, the&#160;button is&#160;not&#160;checked;&#160;if&#160;1,&#160;the&#160;button is&#160;checked.<br/>
Tabstop&#160;<br/>
If&#160;True, the&#160;control&#160;can be&#160;reached by&#160;using&#160;the&#160;Tab&#160;key.<br/>
TextColor<br/>
Dialog’s&#160;text&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
TextLineColor<br/>
Dialog’s&#160;text&#160;line&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
<b>Note</b><br/>
Add&#160;three&#160;radio&#160;buttons&#160;to the&#160;OOMESample&#160;dialog.<br/>
Add three&#160;radio&#160;buttons&#160;to&#160;the&#160;sample&#160;dialog&#160;and name&#160;them&#160;OBSet,&#160;OBClear,&#160;and OBUnknown.&#160;The&#160;three&#160;<br/>radio&#160;buttons&#160;will&#160;influence&#160;the&#160;state&#160;of the&#160;check box,&#160;so set&#160;an appropriate&#160;label&#160;as&#160;well&#160;(see<a href="libremacros.html#646">&#160;Figure&#160;139).&#160;<br/></a>In&#160;other words, the&#160;OBSet&#160;button&#160;will&#160;set&#160;the&#160;check box,&#160;the&#160;OBClear radio button will&#160;clear the&#160;check box,&#160;<br/>and the&#160;OBUnknown radio button&#160;will&#160;set&#160;the&#160;check box&#160;to&#160;the&#160;“don’t&#160;know”&#160;state&#160;of 3. Enter the&#160;macro i<a href="libremacros.html#625">n<br/>Listing 531<b>&#160;</b></a>and then set&#160;the&#160;“When initiating”&#160;event&#160;to&#160;call&#160;the&#160;OOMEDlgRadioButton&#160;routine&#160;for each of&#160;<br/>the&#160;three&#160;radio&#160;buttons. Each of the&#160;radio&#160;buttons&#160;is&#160;inspected&#160;to see&#160;which one&#160;is&#160;currently&#160;selected.<br/>
<i><b>Listing&#160;531.</b>&#160;Handle&#160;the&#160;sample&#160;radio&#160;buttons.</i><br/>
REM When a radio button is selected, set the state of the check box<br/>REM based on which radio button is selected. Set the check box<br/>REM label to indicate why the check box was set to that state.<br/>Sub&#160;OOMEDlgRadioButton<br/>&#160;&#160;Dim&#160;oModel<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;sBNames&#160;(0&#160;To&#160;2)&#160;As&#160;String<br/>&#160;&#160;REM These are ordered so that the button names are in the order<br/>&#160;&#160;REM that will set the check box state.<br/>&#160;&#160;sBNames(0)&#160;=&#160;&#34;OBClear&#34;&#160;:&#160;sBNames(1)&#160;=&#160;&#34;OBSet&#34;&#160;:&#160;sBNames(2)&#160;=&#160;&#34;OBUnknown&#34;<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;2<br/>&#160; &#160;&#160;oModel&#160;=&#160;oOOMEDlg.getModel().getByName(sbNames(i))<br/>&#160; &#160;&#160;If&#160;oModel.State&#160;=&#160;1&#160;Then<br/>&#160; &#160; &#160;&#160;oOOMEDlg.getModel().getByName(&#34;CheckBox&#34;).State&#160;=&#160;i<br/>&#160; &#160; &#160;&#160;oOOMEDlg.getModel().getByName(&#34;CheckBox&#34;).Label&#160;=&#160;&#34;Set by &#34;&#160;&amp;&#160;sBNames(i)<br/>&#160; &#160; &#160;&#160;REM oOOMEDlg.getModel().getByName(&#34;RBFrame&#34;).Label = sBNames(i)<br/>&#160; &#160; &#160;&#160;Exit&#160;For<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
Change&#160;the&#160;code&#160;for the&#160;checkbox&#160;as&#160;follows<br/>
<b>&#160;18.3.4.&#160;Group&#160;box<br/></b>The&#160;purpose&#160;of a&#160;group box&#160;is&#160;to&#160;draw&#160;a&#160;visual&#160;frame—a&#160;useful&#160;visual&#160;cue&#160;to the&#160;user that&#160;a&#160;group of&#160;<br/>controls&#160;are&#160;related&#160;in some&#160;way.&#160;The&#160;group box&#160;model&#160;supports&#160;the&#160;properties&#160;Enabled, FontDescriptor,&#160;<br/>FontEmphasisMark, FontRelief, HelpText,&#160;HelpURL,&#160;TextColor,&#160;TextLineColor,&#160;Label,&#160;and Printable.<br/>
<b>Note</b><br/>
Draw&#160;a&#160;group box around&#160;the&#160;three&#160;radio&#160;buttons in the&#160;OOMESample&#160;dialog.<br/>
622<br/>
<hr/>
<a name=626></a>Draw&#160;a&#160;group box around the&#160;three&#160;radio&#160;buttons&#160;and name&#160;the&#160;group box&#160;RBFrame.&#160;The&#160;macro i<a href="libremacros.html#625">n&#160;Listing&#160;<br/>531&#160;c</a>ontains&#160;one&#160;line&#160;of code&#160;that&#160;will&#160;set&#160;the&#160;frame&#160;label&#160;to&#160;the&#160;name&#160;of the&#160;currently&#160;selected radio button.&#160;<br/>Remove&#160;the&#160;comment&#160;mark (REM) from&#160;the&#160;front&#160;of this&#160;line&#160;or the&#160;frame&#160;label&#160;will&#160;not&#160;update.<br/>
<b>&#160;18.3.5.&#160;Fixed&#160;line&#160;control<br/></b>The&#160;fixed&#160;line&#160;control,&#160;like&#160;the&#160;group box&#160;control, provides&#160;a&#160;nice&#160;visual&#160;separator for the&#160;user.&#160;Its&#160;only&#160;<br/>purpose&#160;is&#160;to&#160;draw&#160;a&#160;separating&#160;line&#160;in&#160;the&#160;dialog.&#160;The&#160;only&#160;interesting property&#160;in&#160;the&#160;fixed-line-control&#160;<br/>model&#160;is&#160;the&#160;Orientation&#160;property,&#160;which specifies&#160;if the&#160;line&#160;is&#160;drawn horizontally&#160;(0) or vertically&#160;(1).<br/>
<b>&#160;18.3.6.&#160;Combo&#160;box<br/></b>A&#160;combo box,&#160;sometimes&#160;called&#160;a&#160;“drop-down”&#160;control, is&#160;an input&#160;field with&#160;an attached list&#160;box.&#160;The&#160;<br/>combo box control&#160;is&#160;used to&#160;select&#160;a&#160;single&#160;value.&#160;The&#160;attached list&#160;box facilitates&#160;selecting a&#160;value&#160;from&#160;a&#160;<br/>predefined list.&#160;The&#160;selected text&#160;is&#160;available&#160;from&#160;the&#160;Text&#160;property&#160;in&#160;the&#160;control’s&#160;model.&#160;See<a href="libremacros.html#626">&#160;Table&#160;273.</a><br/>
<i><b>Table&#160;273.&#160;</b>Properties&#160;defined&#160;by&#160;com.sun.star.awt.UnoControlComboBoxModel.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Autocomplete<br/>
If&#160;True,&#160;automatic&#160;completion of&#160;text&#160;is&#160;enabled.<br/>
Border<br/>
Specify&#160;no border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1),&#160;or&#160;a&#160;simple&#160;border&#160;(2)&#160;as&#160;an Integer.<br/>
Dropdown<br/>
If&#160;True,&#160;the&#160;control&#160;contains a&#160;drop-down button.<br/>
LineCount<br/>
Maximum&#160;line&#160;count&#160;displayed&#160;in the&#160;drop-down&#160;box.<br/>
MaxTextLen<br/>
Maximum&#160;character&#160;count. If&#160;0,&#160;the&#160;text&#160;length&#160;is unlimited.<br/>
Printable<br/>
If&#160;True,&#160;the&#160;button is printed&#160;when the&#160;document&#160;is printed.<br/>
ReadOnly<br/>
If&#160;True,&#160;the&#160;Text&#160;entry&#160;cannot&#160;be&#160;modified&#160;by&#160;the&#160;user.<br/>
StringItemList<br/>
Array&#160;of&#160;strings&#160;that&#160;identify&#160;the&#160;items&#160;in the&#160;list.<br/>
Tabstop<br/>
If&#160;True,&#160;the&#160;control&#160;can be&#160;reached&#160;by&#160;using&#160;the&#160;Tab&#160;key.<br/>
Text<br/>
Text&#160;that&#160;is&#160;displayed&#160;in&#160;the&#160;input&#160;field&#160;section of&#160;the&#160;box.<br/>
BackgroundColor<br/>
Dialog’s&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
Enabled<br/>
If&#160;True,&#160;the&#160;dialog is&#160;enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
FontEmphasisMark<br/>
FontEmphasis&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption&#160;bar.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
HelpText<br/>
Dialog’s&#160;help&#160;text&#160;as&#160;a&#160;String.<br/>
HelpURL<br/>
Dialog’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
TextColor<br/>
Dialog’s&#160;text&#160;color&#160;as a&#160;Long Integer.<br/>
TextLineColor<br/>
Dialog’s&#160;text&#160;line&#160;color&#160;as a&#160;Long Integer.<br/>
Although it&#160;is&#160;considered good practice&#160;to&#160;interact&#160;with&#160;a&#160;control&#160;through the&#160;control’s&#160;model,&#160;the&#160;combo&#160;<br/>box&#160;control&#160;contains&#160;some&#160;useful&#160;utility&#160;methods&#160;that&#160;are&#160;not&#160;directly&#160;available&#160;from&#160;the&#160;model.&#160;The&#160;methods<br/>listed in<a href="libremacros.html#627">&#160;Table&#160;274&#160;e</a>ssentially&#160;provide&#160;a&#160;shortcut&#160;to writing your own array&#160;utility&#160;functions&#160;to&#160;add and&#160;<br/>remove&#160;items&#160;from&#160;the&#160;StringItemList&#160;array&#160;in<a href="libremacros.html#626">&#160;Table&#160;273.</a><br/>
623<br/>
<hr/>
<a name=627></a><i><b>Table&#160;274.&#160;</b>Extra&#160;utility&#160;methods&#160;supported by&#160;the&#160;combo box&#160;control.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
addItem(String,&#160;position)<br/>
Add an item&#160;at&#160;the&#160;specified&#160;position.<br/>
addItems(StringArray,&#160;position)<br/>
Add multiple&#160;items at&#160;the&#160;specified&#160;position.<br/>
removeItems(position,&#160;count)<br/>
Remove&#160;a&#160;number&#160;of&#160;items&#160;at&#160;the&#160;specified position.<br/>
<b>Note</b><br/>
Add&#160;a&#160;combo&#160;box&#160;to the&#160;OOMESample&#160;dialog and name&#160;it&#160;ColorBox.<br/>
Add a&#160;combo box&#160;to the&#160;dialog&#160;with&#160;a&#160;name&#160;of “ColorBox”. Select&#160;the&#160;“List&#160;entries”&#160;property&#160;and enter the&#160;<br/>three&#160;values&#160;“Red”, “Green”, and “Blue”. In&#160;earlier versions&#160;of OO, you&#160;entered multiple&#160;values&#160;by&#160;<br/>separating them&#160;with Ctrl+Enter.&#160;In&#160;AOO&#160;3.4.1, use&#160;Shift+Enter.&#160;To&#160;place&#160;each entry&#160;on a&#160;separate&#160;line,&#160;type&#160;<br/>the&#160;word Red and press&#160;Shift+Enter,&#160;type&#160;the&#160;word Green and press&#160;Shift+Enter,&#160;and so on—it&#160;took&#160;me&#160;<br/>longer than it&#160;should&#160;have&#160;to&#160;figure&#160;out&#160;how&#160;to&#160;do this.&#160;It’s&#160;easy,&#160;of course, to&#160;simply&#160;set&#160;these&#160;values&#160;directly<br/>into&#160;the&#160;model&#160;by&#160;setting the&#160;StringItemList&#160;property&#160;shown in<a href="libremacros.html#626">&#160;Table&#160;273.</a><br/>
Enter the&#160;code&#160;shown in<a href="libremacros.html#627">&#160;Listing 532&#160;a</a>nd then set&#160;the&#160;“Text&#160;modified”&#160;event&#160;to call&#160;the&#160;OOMDDlgColorBox&#160;<br/>subroutine&#160;in<a href="libremacros.html#627">&#160;Listing 532.&#160;</a>The&#160;“Text&#160;modified”&#160;event&#160;causes&#160;the&#160;subroutine&#160;to&#160;be&#160;called every&#160;time&#160;that&#160;the&#160;<br/>text&#160;in&#160;the&#160;input&#160;line&#160;changes. In&#160;other words, while&#160;typing text, the&#160;subroutine&#160;is&#160;called with&#160;every&#160;<br/>keystroke. If&#160;the&#160;“Item&#160;status&#160;changed”&#160;event&#160;is&#160;used, then the&#160;subroutine&#160;is&#160;called when a&#160;new&#160;selection is&#160;<br/>chosen from&#160;the&#160;drop-down list.<br/>
The&#160;macro i<a href="libremacros.html#627">n&#160;Listing&#160;532&#160;c</a>hanges&#160;the&#160;background color of the&#160;drop-down list&#160;box&#160;based on the&#160;value&#160;of the&#160;<br/>entered text.&#160;The&#160;text&#160;comparison&#160;is&#160;case&#160;sensitive, so the&#160;text&#160;in the&#160;drop-down box must&#160;match exactly.<br/>
<i><b>Listing&#160;532.</b>&#160;Modify&#160;drop down&#160;list&#160;box&#160;background color.<br/></i>Sub&#160;OOMEDlgColorBox<br/>&#160;&#160;Dim&#160;oModel<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;oModel&#160;=&#160;oOOMEDlg.getModel().getByName(&#34;ColorBox&#34;)<br/>&#160;&#160;s&#160;=&#160;oModel.Text<br/>&#160;&#160;If&#160;s&#160;=&#160;&#34;Red&#34;&#160;Then<br/>&#160; &#160;&#160;REM Set to Red<br/>&#160; &#160;&#160;oModel.BackGroundColor&#160;=&#160;RGB(255,&#160;0,&#160;0)<br/>&#160;&#160;ElseIf&#160;s&#160;=&#160;&#34;Green&#34;&#160;Then<br/>&#160; &#160;&#160;REM Set to Green<br/>&#160; &#160;&#160;oModel.BackGroundColor&#160;=&#160;RGB(0,&#160;255,&#160;0)<br/>&#160;&#160;ElseIf&#160;s&#160;=&#160;&#34;Blue&#34;&#160;Then<br/>&#160; &#160;&#160;REM Set to Blue<br/>&#160; &#160;&#160;oModel.BackGroundColor&#160;=&#160;RGB(0,&#160;0,&#160;255)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;Rem set back to white<br/>&#160; &#160;&#160;oModel.BackGroundColor&#160;=&#160;RGB(255,&#160;255,&#160;255)<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
<b>&#160;18.3.7.&#160;Text&#160;edit&#160;controls<br/></b>The&#160;UnoControlEdit&#160;service&#160;is&#160;a&#160;basic&#160;edit&#160;field&#160;that&#160;acts&#160;as&#160;the&#160;base&#160;service&#160;for the&#160;other edit&#160;fields.&#160;An edit&#160;<br/>control&#160;is&#160;used to&#160;hold&#160;regular text.&#160;It&#160;is&#160;possible&#160;to limit&#160;the&#160;length&#160;of the&#160;text&#160;and to even add scroll&#160;bars.&#160;<br/>The&#160;edit&#160;control&#160;model&#160;supports&#160;the&#160;properties&#160;shown i<a href="libremacros.html#628">n&#160;Table&#160;275.</a><br/>
624<br/>
<hr/>
<a name=628></a><i><b>Table&#160;275.&#160;</b>Properties&#160;defined&#160;by&#160;the&#160;com.sun.star.awt.UnoControlEditModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Align<br/>
Specify&#160;that&#160;the&#160;text&#160;is&#160;aligned left&#160;(0),&#160;center&#160;(1), or&#160;right&#160;(2).<br/>
BackgroundColor<br/>
Dialog’s&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
Border<br/>
Specify&#160;no&#160;border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1), or&#160;a&#160;simple&#160;border&#160;(2).<br/>
EchoChar<br/>
A&#160;password&#160;field displays&#160;the&#160;character&#160;specified&#160;by&#160;this&#160;integer&#160;rather&#160;than the&#160;<br/>entered text.<br/>
Enabled<br/>
If&#160;True, the&#160;dialog&#160;is enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption bar.<br/>
FontEmphasisMark<br/>
FontEmphasis for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption bar.<br/>
HardLineBreaks<br/>
If&#160;True, hard line&#160;breaks are&#160;returned&#160;by&#160;the&#160;control’s&#160;getText()&#160;method.<br/>
HelpText<br/>
Dialog’s&#160;help&#160;text&#160;as a&#160;String.<br/>
HelpURL<br/>
Dialog’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
HScroll<br/>
If&#160;True, the&#160;text&#160;in the&#160;control&#160;can be&#160;scrolled&#160;in the&#160;horizontal&#160;direction.<br/>
MaxTextLen<br/>
Maximum&#160;number&#160;of&#160;characters the&#160;control&#160;may&#160;contain. If&#160;zero,&#160;the&#160;text&#160;length&#160;<br/>is&#160;not&#160;purposely&#160;limited.<br/>
MultiLine<br/>
If&#160;True, the&#160;text&#160;may&#160;use&#160;more&#160;than one&#160;line.<br/>
Printable<br/>
If&#160;True, the&#160;control&#160;is&#160;printed&#160;with the&#160;document.<br/>
ReadOnly<br/>
If&#160;True, the&#160;control’s&#160;content&#160;cannot&#160;be&#160;modified by&#160;the&#160;user.<br/>
Tabstop<br/>
If&#160;True, the&#160;control&#160;can be&#160;reached by&#160;using&#160;the&#160;Tab&#160;key.<br/>
Text<br/>
The&#160;text&#160;that&#160;is&#160;displayed in&#160;the&#160;control.<br/>
TextColor<br/>
Dialog’s&#160;text&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
TextLineColor<br/>
Dialog’s&#160;text&#160;line&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
VScroll<br/>
If&#160;True, the&#160;text&#160;in the&#160;control&#160;can be&#160;scrolled&#160;in the&#160;vertical&#160;direction.<br/>
Although I&#160;encourage&#160;you&#160;to&#160;use&#160;the&#160;model&#160;for most&#160;things, some&#160;features&#160;are&#160;not&#160;available&#160;without&#160;going&#160;<br/>directly&#160;to&#160;the&#160;control.&#160;For&#160;example, the&#160;control&#160;supplies&#160;the&#160;capability&#160;of selecting some&#160;or all&#160;of the&#160;text&#160;<br/>and determining which&#160;portion&#160;of the&#160;text&#160;is&#160;currently&#160;selected.&#160;In&#160;a&#160;regular document,&#160;the&#160;current&#160;controller&#160;<br/>provides&#160;this&#160;capability,&#160;but&#160;controls&#160;in dialogs&#160;combine&#160;the&#160;controller’s&#160;capabilities&#160;with the&#160;control&#160;itself.&#160;<br/>To&#160;obtain or set&#160;the&#160;selected&#160;range, use&#160;the&#160;Selection structure&#160;(see<a href="libremacros.html#628">&#160;Table&#160;276)</a>.<br/>
<i><b>Table&#160;276.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.Selection&#160;structure.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Min<br/>
Lower&#160;limit&#160;of&#160;the&#160;range&#160;as a&#160;Long&#160;Integer.<br/>
Max<br/>
Upper&#160;limit&#160;of&#160;the&#160;range&#160;as a&#160;Long&#160;Integer.<br/>
The&#160;control&#160;uses&#160;the&#160;Selection&#160;structure&#160;to&#160;get&#160;and set&#160;the&#160;current&#160;text&#160;selection range.&#160;The&#160;control&#160;is&#160;also&#160;<br/>able&#160;to&#160;directly&#160;return&#160;the&#160;text&#160;that&#160;is&#160;selected&#160;in a&#160;text&#160;control.&#160;The&#160;purpose&#160;is&#160;to&#160;allow&#160;a&#160;user to&#160;select&#160;only&#160;a&#160;<br/>portion&#160;of the&#160;text&#160;and to determine&#160;which&#160;portion&#160;is&#160;selecte<a href="libremacros.html#629">d.&#160;Table&#160;277&#160;c</a>ontains&#160;the&#160;standard text&#160;methods&#160;<br/>supported&#160;by&#160;text&#160;type&#160;controls.<br/>
625<br/>
<hr/>
<a name=629></a><i><b>Table&#160;277.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.awt.XTextComponent&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
addTextListener(XTextListener)<br/>
Add&#160;a&#160;text&#160;listener.<br/>
getMaxTextLen()<br/>
Get&#160;the&#160;model’s&#160;MaxTextLen property&#160;(see<a href="libremacros.html#628">&#160;Table&#160;275)</a>.<br/>
getSelectedText()<br/>
Return the&#160;currently&#160;selected&#160;text&#160;string.<br/>
getSelection()<br/>
Return a&#160;Selection&#160;object&#160;that&#160;identifies&#160;the&#160;selected&#160;text&#160;(see<a href="libremacros.html#627">&#160;Table&#160;274)</a>.<br/>
getText()<br/>
Get&#160;the&#160;model’s&#160;Text&#160;property&#160;(see<a href="libremacros.html#628">&#160;Table&#160;275)</a>.<br/>
insertText(Selection,&#160;string)<br/>
Insert&#160;the&#160;string&#160;at&#160;the&#160;specified&#160;Selection location.<br/>
isEditable()<br/>
Return the&#160;model’s&#160;ReadOnly&#160;flag&#160;(see<a href="libremacros.html#628">&#160;Table&#160;275)</a>.<br/>
removeTextListener(XTextListener)<br/>
Remove&#160;a&#160;text&#160;listener.<br/>
setEditable(boolean)<br/>
Set&#160;the&#160;model’s&#160;ReadOnly&#160;flag (see<a href="libremacros.html#628">&#160;Table&#160;275)</a>.<br/>
setMaxTextLen(len)<br/>
Set&#160;the&#160;model’s&#160;MaxTextLen property&#160;(see<a href="libremacros.html#628">&#160;Table&#160;275)</a>.<br/>
setSelection(Selection)<br/>
Set&#160;the&#160;text&#160;that&#160;is selected&#160;(see<a href="libremacros.html#627">&#160;Table&#160;274)</a>.<br/>
setText(string)<br/>
Set&#160;the&#160;model’s&#160;Text&#160;property&#160;(see<a href="libremacros.html#628">&#160;Table&#160;275)</a>.<br/>
<i><b>Currency&#160;control<br/></b></i>The&#160;currency&#160;control&#160;is&#160;used to&#160;input&#160;and edit&#160;monetary&#160;values.&#160;The&#160;currency&#160;control&#160;is&#160;defined by&#160;the&#160;<br/>UnoControlCurrencyField&#160;service, which also implements&#160;the&#160;standard edit&#160;control&#160;service<a href="libremacros.html#629">.&#160;Table&#160;278&#160;l</a>ists&#160;<br/>some&#160;properties&#160;that&#160;are&#160;unique&#160;to&#160;the&#160;currency&#160;model, all&#160;of which&#160;may&#160;also be&#160;set&#160;from&#160;the&#160;control’s&#160;<br/>property&#160;dialog in the&#160;IDE. Pay&#160;special&#160;attention to&#160;the&#160;default&#160;values,&#160;and notice&#160;that&#160;the&#160;property&#160;dialog&#160;<br/>uses&#160;Yes&#160;and No rather than&#160;True&#160;and False. Besides&#160;the&#160;specific&#160;properties&#160;i<a href="libremacros.html#629">n&#160;Table&#160;278, t</a>he&#160;currency&#160;<br/>control&#160;model&#160;also&#160;supports&#160;these&#160;properties:&#160;BackgroundColor,&#160;Border,&#160;Enabled,&#160;FontDescriptor,&#160;<br/>FontEmphasisMark, FontRelief, HelpText,&#160;HelpURL, Printable, ReadOnly,&#160;Tabstop,&#160;TextColor,&#160;and&#160;<br/>TextLineColor.&#160;<br/>
<i><b>Table&#160;278.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlCurrencyFieldModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
<i><b>Default</b></i><br/>
CurrencySymbol&#160;<br/>
Currency&#160;symbol&#160;as a&#160;String.<br/>
$<br/>
DecimalAccuracy&#160;<br/>
Decimal&#160;accuracy&#160;as an Integer.<br/>
2<br/>
PrependCurrencySymbol&#160;<br/>
If&#160;True,&#160;the&#160;currency&#160;symbol&#160;is prepended&#160;to the&#160;currency&#160;<br/>
No<br/>
amount.<br/>
ShowThousandsSeparator&#160;<br/>
If&#160;True,&#160;the&#160;thousands separator&#160;is&#160;displayed.<br/>
No<br/>
Spin&#160;<br/>
If&#160;True,&#160;the&#160;control&#160;has a&#160;spin button.<br/>
No<br/>
StrictFormat&#160;<br/>
If&#160;True,&#160;the&#160;entered&#160;text&#160;is checked during&#160;the&#160;user&#160;input.<br/>
No<br/>
Value&#160;<br/>
The&#160;value&#160;displayed&#160;in the&#160;control&#160;as&#160;a&#160;floating-point&#160;Double.<br/>
0<br/>
ValueMax&#160;<br/>
The&#160;maximum&#160;value&#160;as a&#160;floating-point&#160;Double.<br/>
1000000<br/>
ValueMin&#160;<br/>
The&#160;minimum&#160;value&#160;as&#160;a&#160;floating-point&#160;Double.<br/>
-1000000.00<br/>
ValueStep&#160;<br/>
The&#160;amount&#160;that&#160;the&#160;spin button changes the&#160;entered values as&#160;<br/>a&#160;Double.<br/>
1<br/>
<b>TIP</b><br/>
The&#160;default&#160;values&#160;shown&#160;in<a href="libremacros.html#629">&#160;Table&#160;278&#160;a</a>re&#160;for&#160;the&#160;United States. Local&#160;specific&#160;default&#160;<br/>
values are&#160;used.<br/>
626<br/>
<hr/>
<a name=630></a>The&#160;XCurrencyField&#160;interface&#160;implemented&#160;by&#160;the&#160;currency&#160;control&#160;defines&#160;methods&#160;to get&#160;and set&#160;the&#160;<br/>properties&#160;defined in<a href="libremacros.html#629">&#160;Table&#160;278.&#160;</a>The&#160;XSpinField&#160;interface, which is&#160;also&#160;supported by&#160;the&#160;currency&#160;control,&#160;<br/>defines&#160;methods&#160;to&#160;interact&#160;with the&#160;spin&#160;control&#160;(see<a href="libremacros.html#630">&#160;Table&#160;279)</a>.<br/>
<i><b>Table&#160;279.&#160;</b>Methods&#160;defined by&#160;the&#160;the&#160;com.sun.star.awt.XSpinField interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
addSpinListener(XSpinListener)<br/>
Add&#160;a&#160;spin listener.<br/>
down()<br/>
Decreases the&#160;value&#160;by&#160;ValueStep&#160;(see<a href="libremacros.html#629">&#160;Table&#160;278)</a>.<br/>
enableRepeat(boolean)<br/>
Enable/disable&#160;automatic&#160;repeat&#160;mode.<br/>
first()<br/>
Set&#160;the&#160;value&#160;to&#160;ValueMin (see<a href="libremacros.html#629">&#160;Table&#160;278)</a>.<br/>
last()<br/>
Set&#160;the&#160;value&#160;to&#160;ValueMax&#160;(see<a href="libremacros.html#629">&#160;Table&#160;278)</a>.<br/>
removeSpinListener(XSpinListener)<br/>
Remove&#160;a&#160;spin listener.<br/>
up()<br/>
Increases the&#160;value&#160;by&#160;ValueStep&#160;(see<a href="libremacros.html#629">&#160;Table&#160;278)</a>.<br/>
<b>TIP</b><br/>
All&#160;of&#160;the&#160;edit&#160;controls that&#160;support&#160;spin buttons also support&#160;the&#160;methods i<a href="libremacros.html#630">n&#160;Table&#160;279.</a><br/>
<i><b>Numeric&#160;control<br/></b></i>The&#160;numeric&#160;control&#160;is&#160;used to accept&#160;numeric&#160;input.&#160;The&#160;numeric&#160;control&#160;is&#160;almost&#160;identical&#160;to&#160;the&#160;currency&#160;<br/>control&#160;except&#160;that&#160;the&#160;numeric&#160;control&#160;does&#160;not&#160;support&#160;the&#160;properties&#160;CurrencySymbol&#160;or&#160;<br/>PrependCurrencySymbol—even the&#160;default&#160;values&#160;are&#160;the&#160;same.&#160;If&#160;you&#160;know&#160;how&#160;to use&#160;a&#160;currency&#160;control,&#160;<br/>you&#160;know&#160;how&#160;to&#160;use&#160;a&#160;numeric&#160;control.<br/>
<i><b>Date&#160;control<br/></b></i>The&#160;date&#160;control&#160;is&#160;a&#160;text-edit&#160;control&#160;that&#160;supports&#160;date&#160;input.&#160;The&#160;input&#160;formats&#160;supported by&#160;the&#160;date&#160;<br/>control&#160;are&#160;predefined&#160;and set&#160;based on a&#160;numeric&#160;constant&#160;(see<a href="libremacros.html#631">&#160;Table&#160;280)</a>.&#160;The&#160;descriptions&#160;show&#160;formats&#160;<br/>such as&#160;(DD/MM/YY), but&#160;in&#160;reality,&#160;the&#160;separator is&#160;locale&#160;specific. In&#160;other words, dates&#160;are&#160;shown and&#160;<br/>edited&#160;in a&#160;way&#160;that&#160;is&#160;appropriate&#160;for where&#160;you&#160;live.&#160;The&#160;last&#160;two formats&#160;are&#160;not&#160;locale&#160;specific&#160;because&#160;<br/>they&#160;are&#160;described by&#160;the&#160;ISO&#160;8601 standard.<br/>
The&#160;date&#160;control&#160;(see<a href="libremacros.html#631">&#160;Table&#160;281&#160;f</a>or its&#160;model&#160;properties) is&#160;similar to&#160;the&#160;currency&#160;control&#160;in&#160;that&#160;it&#160;supports&#160;<br/>a&#160;minimum&#160;value,&#160;a&#160;maximum&#160;value, and a&#160;spin control.&#160;The&#160;spin&#160;control&#160;works&#160;by&#160;incrementing or&#160;<br/>decrementing the&#160;portion of the&#160;date&#160;in which it&#160;resides.&#160;For&#160;example, if the&#160;cursor is&#160;in the&#160;month&#160;field,&#160;the&#160;<br/>spin control&#160;affects&#160;the&#160;month&#160;rather than&#160;the&#160;year or the&#160;day.<br/>
<b>TIP</b><br/>
The&#160;DropDown property&#160;allows&#160;for&#160;a&#160;drop-down calendar&#160;that&#160;greatly&#160;facilitates date&#160;entry.<br/>
627<br/>
<hr/>
<a name=631></a><i><b>Table&#160;280.&#160;</b>Date&#160;input&#160;formats&#160;supported by&#160;a Date&#160;control.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
Default&#160;system&#160;short&#160;format.<br/>
1<br/>
Default&#160;system&#160;short&#160;format&#160;with a&#160;two-digit&#160;year&#160;(YY).<br/>
2<br/>
Default&#160;system&#160;short&#160;format&#160;with a&#160;four-digit&#160;year&#160;(YYYY).<br/>
3<br/>
Default&#160;system&#160;long&#160;format.<br/>
4<br/>
Short&#160;format&#160;(DD/MM/YY).<br/>
5<br/>
Short&#160;format&#160;(MM/DD/YY).<br/>
6<br/>
Short&#160;format&#160;(YY/MM/DD).<br/>
7<br/>
Short&#160;format&#160;(DD/MM/YYYY).<br/>
8<br/>
Short&#160;format&#160;(MM/DD/YYYY).<br/>
9<br/>
Short&#160;format&#160;(YYYY/MM/DD).<br/>
10<br/>
Short&#160;format&#160;for&#160;ISO&#160;8601&#160;(YY-MM-DD).<br/>
11<br/>
Short&#160;format&#160;for&#160;ISO&#160;8601&#160;(YYYY-MM-DD).<br/>
<i><b>Table&#160;281.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlDateFieldModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Definition</b></i><br/>
BackgroundColor<br/>
Dialog’s&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
Border<br/>
Specify&#160;no border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1),&#160;or&#160;a&#160;simple&#160;border&#160;(2).<br/>
Date<br/>
The&#160;date:<br/>– as a&#160;Long Integer&#160;(AOO&#160;and&#160;old&#160;versions of&#160;LO)<br/>– as a&#160;structure&#160;com.sun.star.util.Date&#160;(LO&#160;new,&#160;see&#160;Table&#160;282).<br/>
DateFormat<br/>
Date&#160;format&#160;as&#160;an Integer&#160;(see<a href="libremacros.html#631">&#160;Table&#160;280)</a>.<br/>
DateMax<br/>
Maximum&#160;allowed&#160;date&#160;as a&#160;Long&#160;Integer.<br/>
DateMin<br/>
Minimum&#160;allowed date&#160;as a&#160;Long Integer.<br/>
DropDown<br/>
If&#160;True,&#160;a&#160;drop-down&#160;exists&#160;that&#160;shows&#160;a&#160;calendar&#160;for&#160;choosing&#160;a&#160;date.<br/>
Enabled<br/>
If&#160;True,&#160;the&#160;dialog is&#160;enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
FontEmphasisMark<br/>
FontEmphasis&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption&#160;bar.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
HelpText<br/>
Dialog’s&#160;help&#160;text&#160;as&#160;a&#160;String.<br/>
HelpURL<br/>
Dialog’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
Spin<br/>
If&#160;True,&#160;spin buttons are&#160;drawn.<br/>
StrictFormat<br/>
If&#160;True,&#160;the&#160;date&#160;is&#160;checked&#160;during&#160;the&#160;user&#160;input.<br/>
TextColor<br/>
Dialog’s&#160;text&#160;color&#160;as a&#160;Long Integer.<br/>
TextLineColor<br/>
Dialog’s&#160;text&#160;line&#160;color&#160;as a&#160;Long Integer.<br/>
<b>Note</b><br/>
Add&#160;a&#160;date&#160;input&#160;control&#160;to the&#160;OOMESample&#160;dialog and name&#160;it&#160;MyDateField.<br/>Use&#160;the&#160;code&#160;i<a href="libremacros.html#632">n&#160;Listing&#160;535&#160;t</a>o initialize&#160;the&#160;date&#160;control.<br/>
628<br/>
<hr/>
<a name=632></a>The&#160;Date&#160;data&#160;type&#160;that&#160;is&#160;used by&#160;Basic&#160;is&#160;not&#160;compatible&#160;with the&#160;Date&#160;property&#160;used in&#160;a&#160;date&#160;control. It&#160;<br/>depends&#160;from&#160;the&#160;OpenOffice&#160;application&#160;used which data&#160;format&#160;you&#160;have&#160;to choose&#160;for a&#160;date&#160;control.<br/>
In&#160;older versions&#160;of LO&#160;and in&#160;AOO&#160;(still&#160;at&#160;least&#160;in the&#160;latest&#160;version&#160;4.1.1) the&#160;date&#160;control&#160;uses&#160;a&#160;Long&#160;that<br/>represents&#160;the&#160;date&#160;in&#160;the&#160;form&#160;YYYYMMDD. For example,&#160;“February&#160;3, 2004”&#160;is&#160;represented&#160;as&#160;the&#160;long&#160;<br/>integer 20040203.&#160;The&#160;Basic&#160;function CDateToIso() converts&#160;a&#160;Basic&#160;Date&#160;variable&#160;to the&#160;required format.&#160;<br/>Add a&#160;date&#160;input&#160;control&#160;and name&#160;it&#160;MyDateField.&#160;The&#160;code&#160;in<a href="libremacros.html#632">&#160;Listing 533&#160;s</a>ets&#160;the&#160;date&#160;control&#160;to&#160;the&#160;<br/>current&#160;day&#160;using the&#160;old&#160;method.<br/>
<i><b>Listing&#160;533.&#160;</b>Initialize&#160;a date&#160;control&#160;to&#160;today’s&#160;date&#160;(AOO&#160;and old LO).<br/></i>&#160;&#160;REM Set the initial date to TODAY<br/>&#160;&#160;oOOMEDlg.getModel().getByName(&#34;MyDateField&#34;).Date&#160;=&#160;CdateToIso(Date())<br/>
LibreOffice&#160;made&#160;a&#160;change&#160;to&#160;use&#160;a&#160;structure, so the&#160;above&#160;code&#160;will&#160;fail&#160;on LO.&#160;You must&#160;instead&#160;create&#160;a&#160;<br/>com.sun.star.util.Date&#160;object&#160;(see<a href="libremacros.html#632">&#160;Table&#160;282)</a>&#160;and then&#160;set&#160;the&#160;date&#160;with&#160;the&#160;new&#160;object.<br/>
<i><b>Table&#160;282.&#160;</b>Properties&#160;in the&#160;com.sun.star.util.Date&#160;structure</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Day<br/>
Day&#160;of&#160;month. Integer&#160;(1-31 or&#160;0 for&#160;a&#160;void date).<br/>
Month<br/>
Month of&#160;year.&#160;Integer&#160;(1-12 or&#160;0 for&#160;a&#160;void date).<br/>
Year<br/>
Year.&#160;Integer.<br/>
<i><b>Listing&#160;534.&#160;</b>Initialize&#160;a date&#160;control&#160;to&#160;today’s&#160;date. (new/current&#160;versions&#160;of&#160;LO)</i><br/>
Dim&#160;x&#160;As Date<br/>Dim&#160;x2&#160;as&#160;New&#160;com.sun.star.util.Date&#160;&#160;<br/>....<br/>x&#160;=&#160;Date()&#160; &#160; &#160; &#160;'Start with a date, then populate the struct:<br/>x2.Year&#160;=&#160;&#160;Year(x)&#160; &#160; &#160;' Year<br/>x2.Month&#160;=&#160;Month(x)&#160; &#160; &#160;' Month<br/>x2.Day&#160;=&#160; &#160;Day(x)&#160; &#160; &#160;&#160;' Day<br/>oOOMEDlg.getModel().getByName(&#34;MyDateField&#34;).Date&#160;=&#160;x2&#160; &#160; &#160;'Set the model Date<br/>
Sadly&#160;there&#160;seems&#160;to&#160;be&#160;no workaround to&#160;work for both&#160;variations. If&#160;you need a&#160;date&#160;control&#160;in a&#160;macro&#160;<br/>that&#160;runs&#160;on&#160;AOO&#160;as&#160;well&#160;as&#160;on all&#160;LO&#160;versions&#160;you&#160;can control&#160;it&#160;by&#160;an error handler (see&#160;Listing 534). If&#160;<br/>you&#160;forgot&#160;how&#160;this&#160;works, recall&#160;secti<a href="libremacros.html#89">on&#160;3.10&#160;Error handling using On Error.&#160;</a>You can also call&#160;the&#160;<br/>GetProductName() macro in&#160;the&#160;Misc&#160;module&#160;in&#160;the&#160;Tools&#160;library,&#160;which is&#160;included with&#160;both&#160;AOO&#160;and&#160;<br/>LO.<br/>
<i><b>Listing&#160;535.&#160;</b>Initialize&#160;a date&#160;control&#160;to&#160;today’s&#160;date&#160;(works&#160;with all&#160;versions&#160;of&#160;AOO&#160;and LO).<br/></i>&#160;&#160;REM Initialize the date control.<br/>&#160;&#160;REM Set the initial date to TODAY.<br/>&#160;&#160;Dim&#160;tToday&#160;As&#160;Date<br/>&#160;&#160;tToday&#160;=&#160;Date()<br/>&#160;&#160;<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;LO<br/>&#160;&#160;REM Try to initialize the control with a Long Integer.<br/>&#160;&#160;REM This is the correct format for AOO and for older versions of LO.<br/>&#160;&#160;oOOMEDlg.getModel().getByName(&#34;MyDateField&#34;).Date&#160;=&#160;CdateToIso(tToday)<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;0&#160;&#160;'Clear the error handler.<br/>&#160;&#160;Goto&#160;GoOn<br/>
629<br/>
<hr/>
<a name=633></a>&#160;&#160;<br/>&#160;&#160;LO:<br/>&#160;&#160;REM On Error the control is initialized using a structure.<br/>&#160;&#160;REM &#160;This is the correct format for newer versions of LO.<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;0&#160;&#160;'Clear the error handler to prevent an infinite loop,<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'in case the macro runs into some other runtime error.<br/>&#160;&#160;Dim&#160;oToday&#160;As&#160;New&#160;com.sun.star.util.Date<br/>&#160;&#160;oToday.Year&#160;=&#160;&#160;Year(tToday)<br/>&#160;&#160;oToday.Month&#160;=&#160;Month(tToday)<br/>&#160;&#160;oToday.Day&#160;=&#160; &#160;Day(tToday)<br/>&#160;&#160;oOOMEDlg.getModel().getByName(&#34;MyDateField&#34;).Date&#160;=&#160;oToday<br/>&#160;&#160;<br/>&#160;&#160;GoOn:<br/>
Although the&#160;control&#160;implements&#160;methods&#160;that&#160;get&#160;and set&#160;properties&#160;in&#160;the&#160;model, the&#160;more&#160;interesting&#160;<br/>methods&#160;are&#160;related to&#160;the&#160;user interface.&#160;While&#160;using a&#160;date&#160;field, press&#160;the&#160;Page&#160;Up key&#160;to cause&#160;the&#160;control<br/>to jump&#160;to the&#160;“last”&#160;date. By&#160;default, the&#160;last&#160;date&#160;is&#160;the&#160;same&#160;as&#160;the&#160;DateMax&#160;property.&#160;The&#160;last&#160;date&#160;is&#160;set&#160;<br/>by&#160;the&#160;control&#160;and not&#160;by&#160;the&#160;model, and it&#160;may&#160;differ from&#160;the&#160;DateMax.&#160;Analogously,&#160;the&#160;pressing&#160;the&#160;Page<br/>Down key&#160;causes&#160;the&#160;control&#160;to jump&#160;to the&#160;“first”&#160;date.&#160;The&#160;first&#160;and last&#160;dates&#160;are&#160;set&#160;using the&#160;setFirst()&#160;<br/>and setLast() methods&#160;shown in<a href="libremacros.html#633">&#160;Table&#160;283. U</a>se&#160;the&#160;method isEmpty() to determine&#160;if the&#160;control&#160;contains&#160;no<br/>value, and use&#160;the&#160;method&#160;setEmpty() to&#160;cause&#160;the&#160;control&#160;to contain no value.<br/>
<i><b>Table&#160;283.&#160;</b>Methods&#160;in&#160;the&#160;com.sun.star.awt.UnoControlDateField&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
setDate(long)&#160;[LO&#160;old&#160;and&#160;AOO]<br/>
Set&#160;the&#160;model’s&#160;Date&#160;property.<br/>
setDate(com.sun.star.util.Date)&#160;[LO&#160;new]<br/>getDate()<br/>
Get&#160;the&#160;model’s&#160;Date&#160;property.<br/>
setMin(long)<br/>
Set&#160;the&#160;model’s&#160;DateMin property.<br/>
getMin(long)<br/>
Get&#160;the&#160;model’s&#160;DateMin property.<br/>
setMax(long)<br/>
Set&#160;the&#160;model’s&#160;DateMax&#160;property.<br/>
getMax(long)<br/>
Get&#160;the&#160;model’s&#160;DateMax&#160;property.<br/>
setFirst(long)<br/>
Set&#160;the&#160;date&#160;used for&#160;the&#160;Page&#160;Down&#160;key.<br/>
getFirst()<br/>
Get&#160;the&#160;date&#160;used&#160;for&#160;the&#160;Page&#160;Down&#160;key.&#160;&#160;<br/>
setLast(long)<br/>
Set&#160;the&#160;date&#160;used for&#160;the&#160;Page&#160;Up key.<br/>
getLast()<br/>
Get&#160;the&#160;date&#160;used&#160;for&#160;the&#160;Page&#160;Up key.<br/>
setLongFormat(boolean)<br/>
Set&#160;to use&#160;the&#160;long&#160;date&#160;format.<br/>
isLongFormat()<br/>
Return&#160;True&#160;if&#160;the&#160;long&#160;date&#160;format&#160;is&#160;used.<br/>
setEmpty()<br/>
Set&#160;the&#160;empty&#160;value.<br/>
isEmpty()<br/>
Return&#160;True&#160;if&#160;the&#160;current&#160;value&#160;is empty.<br/>
setStrictFormat(boolean)<br/>
Set&#160;the&#160;model’s&#160;StrictFormat&#160;property.<br/>
isStrictFormat()<br/>
Get&#160;the&#160;model’s&#160;StrictFormat&#160;property.<br/>
<i><b>Time&#160;control<br/></b></i>The&#160;time&#160;control&#160;is&#160;very&#160;similar to the&#160;date&#160;control.&#160;Time&#160;values&#160;may&#160;indicate&#160;either a&#160;time&#160;on a&#160;clock or a&#160;<br/>length&#160;of time&#160;(duration).&#160;The&#160;supported formats&#160;are&#160;shown in<a href="libremacros.html#634">&#160;Table&#160;284.</a><br/>
630<br/>
<hr/>
<a name=634></a><i><b>Table&#160;284.&#160;</b>Time&#160;input&#160;formats&#160;supported by&#160;a time&#160;control.</i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
Short&#160;24-hour&#160;format.<br/>
1<br/>
Long&#160;24-hour&#160;format.<br/>
2<br/>
Short&#160;12-hour&#160;format.<br/>
3<br/>
Long&#160;12-hour&#160;format.<br/>
4<br/>
Short&#160;time&#160;duration.<br/>
5<br/>
Long&#160;time&#160;duration.<br/>
The&#160;properties&#160;supported by&#160;the&#160;time-control&#160;model&#160;are&#160;shown in<a href="libremacros.html#634">&#160;Table&#160;285. M</a>odify<a href="libremacros.html#631">&#160;Table&#160;281&#160;b</a>y&#160;changing&#160;<br/>the&#160;word Date&#160;to&#160;Time, and by&#160;removing the&#160;DropDown property,&#160;a<a href="libremacros.html#631">nd&#160;Table&#160;281&#160;be</a>comes<a href="libremacros.html#634">&#160;Table&#160;285. I</a>n&#160;<br/>other words, the&#160;date&#160;and time&#160;models&#160;are&#160;almost&#160;identical.<br/>
<i><b>Table&#160;285.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlTimeFieldModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Definition</b></i><br/>
Time<br/>
The&#160;time&#160;displayed&#160;in&#160;the&#160;control:<br/>–&#160;as a&#160;Long&#160;Integer&#160;(LO&#160;old&#160;and&#160;AOO)<br/>–&#160;as a&#160;structure&#160;com.sun.star.util.Time&#160;(LO&#160;new,&#160;see&#160;Table&#160;286).<br/>
TimeFormat<br/>
Time&#160;format&#160;as an&#160;Integer&#160;(see<a href="libremacros.html#634">&#160;Table&#160;284)</a>.<br/>
TimeMax<br/>
Maximum&#160;allowed date&#160;as a&#160;Long&#160;Integer.<br/>
TimeMin<br/>
Minimum&#160;allowed&#160;date&#160;as&#160;a&#160;Long&#160;Integer.<br/>
Spin<br/>
If&#160;True, spin buttons are&#160;drawn.<br/>
StrictFormat<br/>
If&#160;True, the&#160;date&#160;is checked&#160;during&#160;the&#160;user&#160;input.<br/>
As&#160;expected, the&#160;methods&#160;supported by&#160;the&#160;date&#160;control&#160;are&#160;similar to&#160;the&#160;methods&#160;supported by&#160;the&#160;time&#160;<br/>control&#160;(see<a href="libremacros.html#633">&#160;Table&#160;283).&#160;</a>There&#160;are&#160;two differences:&#160;The&#160;time&#160;control&#160;has&#160;getTime() and setTime() rather than&#160;<br/>getDate() and setDate(), and the&#160;time&#160;control&#160;does&#160;not&#160;support&#160;the&#160;methods&#160;setLongFormat() and&#160;<br/>isLongFormat().<br/>
In&#160;older versions&#160;of LO&#160;and in&#160;AOO&#160;(still&#160;at&#160;least&#160;in the&#160;latest&#160;version&#160;4.1.1) the&#160;time&#160;control&#160;uses&#160;a&#160;Long&#160;<br/>Integer to store&#160;and return the&#160;entered value.&#160;The&#160;rightmost&#160;two digits&#160;represent&#160;fractions&#160;of a&#160;second, the&#160;<br/>next&#160;two digits&#160;represent&#160;seconds, the&#160;next&#160;two digits&#160;represent&#160;minutes, and the&#160;leftmost&#160;two digits&#160;<br/>represent&#160;hours. Leading zeros&#160;are, of course, not&#160;returned because&#160;the&#160;value&#160;is&#160;really&#160;a&#160;Long&#160;Integer.&#160;The&#160;<br/>good news, however,&#160;is&#160;that&#160;the&#160;values&#160;are&#160;easy&#160;to&#160;extract.&#160;Assuming that&#160;the&#160;dialog contains&#160;a&#160;time&#160;field&#160;<br/>named MyTimeField,&#160;the&#160;code&#160;i<a href="libremacros.html#634">n&#160;Listing&#160;536&#160;obt</a>ains&#160;the&#160;time&#160;value&#160;and extracts&#160;the&#160;hours, minutes,&#160;<br/>seconds, and portions&#160;of a&#160;second.<br/>
<i><b>Listing&#160;536.&#160;</b>Extracting values&#160;from&#160;a time&#160;control&#160;(AOO&#160;and old&#160;versions&#160;of&#160;LO).<br/></i>&#160;&#160;n&#160;=&#160;oOOMEDlg.getModel().getByName(&#34;MyTimeField&#34;).Time<br/>&#160;&#160;h&#160;=&#160;n&#160;/&#160;1000000&#160;MOD&#160;100&#160;REM Get the hours&#160;<br/>&#160;&#160;m&#160;=&#160;n&#160;/&#160;10000&#160;MOD&#160;100&#160; &#160;REM Get the minutes<br/>&#160;&#160;s&#160;=&#160;n&#160;/&#160;100&#160;MOD&#160;100&#160; &#160; &#160;REM Get the seconds<br/>&#160;&#160;ss&#160;=&#160;n&#160;MOD&#160;100&#160; &#160; &#160; &#160; &#160;&#160;REM portions of a second<br/>
The&#160;new&#160;versions&#160;of LO&#160;use&#160;the&#160;com.sun.star.util.Time&#160;structure&#160;for the&#160;time&#160;control,&#160;see<a href="libremacros.html#635">&#160;Table&#160;286.</a><br/>
631<br/>
<hr/>
<a name=635></a><i><b>Table&#160;286.&#160;</b>Properties&#160;in the&#160;com.sun.star.util.Time&#160;structure..</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Portions of&#160;a&#160;second:<br/>
HundredthSeconds [LO&#160;old&#160;and&#160;AOO]<br/>
Integer&#160;(0&#160;– 99)<br/>
NanoSeconds [LO&#160;new]<br/>
Long&#160;Integer&#160;(0&#160;– 999&#160;999&#160;999)<br/>
Seconds<br/>
Integer&#160;(0&#160;– 59).<br/>
Minutes<br/>
Integer&#160;(0&#160;– 59).<br/>
Hours<br/>
Integer&#160;(0&#160;– 23).<br/>
IsUTC&#160;[only&#160;LO&#160;new]<br/>
True:&#160;time&#160;zone&#160;is UTC,&#160;False:&#160;unknown time&#160;zone.<br/>
Reading a&#160;time&#160;value&#160;from&#160;a&#160;time&#160;control&#160;in newer versions&#160;of LO&#160;needs&#160;a&#160;variable&#160;of the&#160;<br/>com.sun.star.util.Time&#160;structure&#160;type, see<a href="libremacros.html#635">&#160;Listing 537.</a><br/>
<i><b>Listing&#160;537.&#160;</b>Extracting values&#160;from&#160;a time&#160;control&#160;(LO&#160;new).<br/></i>Dim&#160;oTime&#160;As&#160;New&#160;com.sun.star.util.Time<br/>oTime&#160;=&#160;oOOMEDlg.getModel().getByName(&#34;MyTimeField&#34;).Time<br/>h&#160;=&#160;oTime.Hours&#160; &#160; &#160; &#160; &#160;&#160;REM Get the hours.<br/>m&#160;=&#160;oTime.Minutes&#160; &#160; &#160; &#160;&#160;REM Get the minutes.<br/>s&#160;=&#160;oTime.Seconds&#160; &#160; &#160; &#160;&#160;REM Get the seconds.<br/>ss&#160;=&#160;oTime.NanoSeconds&#160; &#160;REM Get the portions of a second.<br/>
If&#160;you&#160;need a&#160;time&#160;control&#160;in a&#160;macro that&#160;runs&#160;with&#160;AOO&#160;as&#160;well&#160;as&#160;with&#160;all&#160;LO&#160;versions&#160;you&#160;can control&#160;it&#160;<br/>with an error handler like&#160;the&#160;one&#160;for the&#160;date&#160;control&#160;in<a href="libremacros.html#632">&#160;Listing 535.</a><br/>
<i><b>Formatted&#160;control<br/></b></i>The&#160;formatted control&#160;is&#160;a&#160;generic&#160;number input&#160;field. Numbers&#160;can be&#160;entered as&#160;a&#160;formatted&#160;number,&#160;<br/>percent, currency,&#160;date, time,&#160;scientific, fraction, or Boolean number.&#160;Unfortunately,&#160;this&#160;level&#160;of control&#160;<br/>comes&#160;with a&#160;price.&#160;The&#160;formatted control&#160;requires&#160;a&#160;numeric&#160;formatter provided by&#160;OpenOffice.org&#160;to&#160;<br/>function.&#160;The&#160;easiest&#160;method to&#160;associate&#160;a&#160;formatted control&#160;to a&#160;numeric&#160;format&#160;object&#160;is&#160;to&#160;use&#160;the&#160;<br/>Properties&#160;dialog in the&#160;IDE.&#160;To&#160;use&#160;a&#160;number formatter,&#160;the&#160;following&#160;sequence&#160;of events&#160;is&#160;likely&#160;to&#160;occur:<br/>
•<br/>
Choose&#160;a&#160;numeric&#160;format.&#160;<br/>
•<br/>
Use&#160;the&#160;methods&#160;in<a href="libremacros.html#637">&#160;Table&#160;289&#160;t</a>o search the&#160;FormatsSupplier (see&#160;Table&#160; 29) using the&#160;constants&#160;i<a href="libremacros.html#636">n<br/>Table&#160;288&#160;t</a>o find&#160;or create&#160;a&#160;suitable&#160;number formatter.<br/>
•<br/>
Set&#160;the&#160;FormatKey&#160;(see<a href="libremacros.html#635">&#160;Table&#160;287)</a>&#160;to&#160;reference&#160;the&#160;desired format&#160;contained&#160;in the&#160;FormatsSupplier.<br/>
<i><b>Table&#160;287.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlFormattedFieldModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Align<br/>
Specify&#160;that&#160;the&#160;text&#160;is&#160;aligned left&#160;(0),&#160;center&#160;(1), or&#160;right&#160;(2).<br/>
BackgroundColor<br/>
Dialog's background color&#160;as a&#160;Long&#160;Integer.<br/>
Border<br/>
Specify&#160;no&#160;border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1), or&#160;a&#160;simple&#160;border&#160;(2).<br/>
EffectiveDefault<br/>
The&#160;default&#160;value&#160;of&#160;the&#160;formatted&#160;field.&#160;This is a&#160;number&#160;or&#160;a&#160;string&#160;based&#160;on&#160;<br/>
TreatAsNumber.<br/>
EffectiveMax<br/>
The&#160;maximum&#160;value&#160;as a&#160;Double&#160;if&#160;TreatAsNumber&#160;is&#160;True.<br/>
632<br/>
<hr/>
<a name=636></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
EffectiveMin<br/>
The&#160;minimum&#160;value&#160;as a&#160;Double&#160;if&#160;TreatAsNumber&#160;is&#160;True.<br/>
EffectiveValue<br/>
The&#160;current&#160;value&#160;as&#160;a&#160;Double&#160;or&#160;a&#160;String&#160;based&#160;on the&#160;value&#160;of&#160;TreatAsNumber.<br/>
Enabled<br/>
If&#160;True, the&#160;dialog&#160;is enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption bar.<br/>
FontEmphasisMark<br/>
FontEmphasis for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption bar.<br/>
FormatKey<br/>
Long&#160;Integer&#160;that&#160;specifies&#160;the&#160;format&#160;for&#160;formatting.<br/>
FormatsSupplier<br/>
XNumberFormatsSupplier&#160;that&#160;supplies the&#160;formats used by&#160;this control.<br/>
HelpText<br/>
Dialog’s&#160;help&#160;text&#160;as a&#160;String.<br/>
HelpURL<br/>
Dialog’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
MaxTextLen<br/>
Maximum&#160;number&#160;of&#160;characters the&#160;control&#160;may&#160;contain. If&#160;zero,&#160;the&#160;text&#160;length&#160;<br/>
is&#160;not&#160;purposely&#160;limited.<br/>
Printable<br/>
If&#160;True, the&#160;control&#160;is&#160;printed&#160;with the&#160;document.<br/>
ReadOnly<br/>
If&#160;True, the&#160;control’s&#160;content&#160;cannot&#160;be&#160;modified by&#160;the&#160;user.<br/>
Spin<br/>
If&#160;True, a&#160;spin control&#160;is&#160;used.<br/>
StrictFormat<br/>
If&#160;True, the&#160;text&#160;is checked&#160;during&#160;the&#160;user&#160;input.<br/>
Tabstop<br/>
If&#160;True, the&#160;control&#160;can be&#160;reached by&#160;using&#160;the&#160;Tab&#160;key.<br/>
Text<br/>
The&#160;text&#160;that&#160;is&#160;displayed in&#160;the&#160;control.<br/>
TextColor<br/>
Dialog’s&#160;text&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
TextLineColor<br/>
Dialog’s&#160;text&#160;line&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
TreatAsNumber<br/>
If&#160;True, the&#160;text&#160;is treated&#160;as&#160;a&#160;number.&#160;This property&#160;controls&#160;how&#160;the&#160;other&#160;<br/>
values&#160;are&#160;treated.<br/>
The&#160;number formatter that&#160;controls&#160;the&#160;formatting in&#160;the&#160;input&#160;box must&#160;be&#160;created&#160;by&#160;the&#160;number format&#160;<br/>supplier in&#160;the&#160;FormatsSupplier property.&#160;In&#160;other words, you can’t&#160;simply&#160;take&#160;a&#160;number formatter created&#160;<br/>by&#160;the&#160;document&#160;or some&#160;other number formatter.&#160;When&#160;the&#160;formats&#160;supplier is&#160;searched to&#160;determine&#160;what&#160;<br/>numeric&#160;formats&#160;it&#160;contains, the&#160;constants&#160;in the&#160;NumberFormat&#160;constant&#160;group are&#160;used (see<a href="libremacros.html#636">&#160;Table&#160;288)</a>.<br/>
<i><b>Table&#160;288.&#160;</b>Constants&#160;in the&#160;com.sun.star.util.NumberFormat&#160;constant&#160;group.</i><br/>
<i><b>Constant</b></i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
0<br/>
ALL<br/>
All&#160;number&#160;formats.<br/>
1<br/>
DEFINED<br/>
User-defined&#160;number&#160;formats.<br/>
2<br/>
DATE<br/>
Date&#160;formats.<br/>
4<br/>
TIME<br/>
Time&#160;formats.<br/>
8<br/>
CURRENCY<br/>
Currency&#160;formats.<br/>
16<br/>
NUMBER<br/>
Decimal&#160;number&#160;formats.<br/>
32<br/>
SCIENTIFIC<br/>
Scientific&#160;number&#160;formats.<br/>
64<br/>
FRACTION<br/>
Number&#160;formats for&#160;fractions.<br/>
128<br/>
PERCENT<br/>
Percentage&#160;number&#160;formats.<br/>
633<br/>
<hr/>
<a name=637></a><i><b>Constant</b></i><br/>
<i><b>Value</b></i><br/>
<i><b>Description</b></i><br/>
256<br/>
TEXT<br/>
Text&#160;number&#160;formats.<br/>
6<br/>
DATETIME<br/>
Number&#160;formats that&#160;contain date&#160;and time.<br/>
1024<br/>
LOGICAL<br/>
Boolean number&#160;formats.<br/>
2048<br/>
UNDEFINED<br/>
Used&#160;if&#160;no&#160;number&#160;format&#160;exists.<br/>
The&#160;formatted control&#160;model&#160;contains&#160;a&#160;number format&#160;supplier in&#160;the&#160;FormatsSupplier property.&#160;The&#160;<br/>supplier identifies&#160;its&#160;contained numeric&#160;formats&#160;based on a&#160;numeric&#160;key.&#160;The&#160;FormatKey&#160;property&#160;in<a href="libremacros.html#635">&#160;Table&#160;<br/>287&#160;m</a>ust&#160;be&#160;set&#160;with the&#160;key&#160;obtained&#160;from&#160;the&#160;FormatsSupplier.&#160;Use&#160;the&#160;methods&#160;in<a href="libremacros.html#637">&#160;Table&#160;289&#160;t</a>o find&#160;or&#160;<br/>create&#160;the&#160;numeric&#160;format&#160;for the&#160;formatted control.&#160;<br/>
<i><b>Table&#160;289.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlFormattedFieldModel&#160;service.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
getByKey(key)<br/>
Return the&#160;com.sun.star.util.NumberFormatProperties&#160;based&#160;on&#160;the&#160;numeric&#160;key.<br/>
queryKeys(NumberFormat, Locale,&#160;<br/>
Return an array&#160;of&#160;Long&#160;Integer&#160;keys that&#160;identify&#160;numeric&#160;formats of&#160;the&#160;<br/>
boolean)<br/>
specified type&#160;(see<a href="libremacros.html#636">&#160;Table&#160;288)</a>&#160;for&#160;the&#160;specified&#160;locale.&#160;If&#160;the&#160;final&#160;Boolean&#160;<br/>parameter&#160;is&#160;True&#160;and&#160;if&#160;no formats&#160;exist, one&#160;will&#160;be&#160;created.<br/>
queryKey(format,&#160;Locale, boolean)<br/>
Return the&#160;Long Integer&#160;key&#160;for&#160;the&#160;specified&#160;format&#160;string.<br/>
addNew(format, Locale)<br/>
Add a&#160;number&#160;format&#160;and&#160;return the&#160;Long Integer&#160;key.<br/>
addNewConverted(format, Locale,&#160;<br/>
Add a&#160;number&#160;format,&#160;using&#160;a&#160;format&#160;string&#160;in a&#160;locale&#160;that&#160;is different&#160;than the&#160;<br/>
Locale)<br/>
desired&#160;locale.<br/>
removeByKey(key)<br/>
Remove&#160;a&#160;number&#160;format&#160;based&#160;on the&#160;Long&#160;Integer&#160;key.<br/>
generateFormat(key,&#160;Locale,&#160;<br/>
Return a&#160;format&#160;string&#160;based on the&#160;input&#160;values, but&#160;do&#160;not&#160;actually&#160;create&#160;the&#160;<br/>
bThousands,&#160;bRed,&#160;nDecimals,&#160;<br/>
number&#160;format.<br/>
nLeading)<br/>
<b>Note</b><br/>
Add&#160;a&#160;formatted&#160;control&#160;to the&#160;OOMESample&#160;dialog.<br/>
Although it&#160;is&#160;not&#160;overly&#160;difficult&#160;to use&#160;the&#160;methods&#160;in<a href="libremacros.html#637">&#160;Table&#160;289&#160;t</a>o find&#160;and create&#160;your own numeric&#160;<br/>formats,&#160;<br/>the&#160;easiest&#160;method to&#160;associate&#160;a&#160;formatted control&#160;to&#160;a&#160;numeric&#160;format&#160;object&#160;is&#160;to&#160;use&#160;the&#160;Properties&#160;dialog&#160;<br/>in the&#160;IDE.&#160;Add a&#160;formatted control&#160;to the&#160;dialog and name&#160;it&#160;MyFormattedField.&#160;The&#160;code&#160;in<a href="libremacros.html#637">&#160;Listing 538&#160;<br/></a>initializes&#160;the&#160;control&#160;to use&#160;the&#160;current&#160;date&#160;as&#160;its&#160;initial&#160;value&#160;and sets&#160;the&#160;desired date&#160;format.&#160;The&#160;date&#160;is&#160;<br/>formatted using the&#160;format&#160;“DD. MMM&#160;YYYY”.&#160;<br/>
<i><b>Listing&#160;538.&#160;</b>Set&#160;a formatted control&#160;to&#160;use&#160;a date&#160;as&#160;“DD. MMM YYYY”.<br/></i>&#160;&#160;&#160;&#160;REM Set the formatted field to a specific format.<br/>&#160; Dim&#160;oFormats&#160; &#160; &#160;&#160;'All of the format objects<br/>&#160; Dim&#160;oSupplier&#160; &#160; &#160;'All of the format objects<br/>&#160; Dim&#160;nKey&#160;As Long &#160;'Index of number format in the number formats<br/>&#160; Dim&#160;oLocale&#160;as new&#160;com.sun.star.lang.Locale<br/>&#160; Dim&#160;sFormat&#160;As String<br/>&#160;&#160;<br/>&#160;&#160;sFormat&#160;=&#160;&#34;DD. MMM YYYY&#34;<br/>&#160;&#160;oSupplier&#160;=oOOMEDlg.getModel().getByName(&#34;MyFormattedField&#34;).FormatsSupplier<br/>&#160;&#160;oFormats&#160; =oSupplier.getNumberFormats()<br/>
634<br/>
<hr/>
<a name=638></a>&#160;&#160;<br/>&#160;&#160;REM See if the number format exists by obtaining the key.<br/>&#160;&#160;nKey&#160;=&#160;oFormats.queryKey(sFormat,&#160;oLocale,&#160;True)<br/>&#160; &#160;<br/>&#160;&#160;REM If the number format does not exist, add it.<br/>&#160; If (nKey&#160;= -1) Then<br/>&#160; &#160;&#160;nKey&#160;=&#160;oFormats.addNew(sFormat,&#160;oLocale)<br/>&#160; &#160;&#160;REM If it failed to add, and it should not fail to add, then use zero.<br/>&#160; &#160; If (nKey&#160;= -1) Then&#160;nKey&#160;=&#160;0<br/>&#160; End If<br/>
&#160;&#160;REM I can set the date using a string or the date.<br/>&#160;&#160;REM ....EffectiveValue = &#34;12. Apr 2004&#34;<br/>&#160;&#160;REM ...EffectiveValue = Date() fails but this works.<br/>&#160;&#160;oOOMEDlg.getModel().getByName(&#34;MyFormattedField&#34;).EffectiveValue&#160;= CStr(Date())<br/>
&#160;&#160;REM Now, set the key for the desired date formatting.<br/>&#160;&#160;REM I set this to treat the value as a number.<br/>&#160;&#160;oOOMEDlg.getModel().getByName(&#34;MyFormattedField&#34;).FormatKey&#160;=&#160;nKey<br/>&#160;&#160;oOOMEDlg.getModel().getByName(&#34;MyFormattedField&#34;).TreatAsNumber&#160;=&#160;True<br/>
There&#160;are&#160;a&#160;couple&#160;of interesting things&#160;to&#160;notice&#160;in<a href="libremacros.html#637">&#160;Listing 538. F</a>irst, the&#160;EffectiveValue&#160;property&#160;is&#160;used&#160;<br/>rather than&#160;the&#160;Text&#160;property&#160;(which I&#160;can use).&#160;The&#160;TreatAsNumber property&#160;is&#160;set&#160;to&#160;True&#160;because&#160;the&#160;spin&#160;<br/>control&#160;does&#160;not&#160;properly&#160;increment&#160;an initial&#160;date&#160;if the&#160;TreatAsNumber property&#160;is&#160;set&#160;to False.&#160;Although it&#160;<br/>is&#160;not&#160;shown, the&#160;formatted control&#160;uses&#160;the&#160;same&#160;numeric&#160;values&#160;for dates&#160;as&#160;the&#160;Basic&#160;Date&#160;data&#160;type—<br/>unlike&#160;the&#160;Date&#160;control. Finally,&#160;the&#160;spin&#160;button in&#160;a&#160;formatted control&#160;always&#160;increments&#160;and decrements&#160;the<br/>value&#160;by&#160;1—unlike&#160;the&#160;Date&#160;control,&#160;which&#160;can independently&#160;increment&#160;and decrement&#160;each portion&#160;of the&#160;<br/>date.<br/>
<i><b>Pattern&#160;control<br/></b></i>Use&#160;a&#160;pattern control&#160;to enter formatted&#160;strings&#160;based on an edit&#160;mask and a&#160;literal&#160;mask.&#160;The&#160;literal&#160;mask is&#160;<br/>the&#160;string value&#160;that&#160;is&#160;initially&#160;displayed when the&#160;control&#160;starts.&#160;The&#160;user then&#160;edits&#160;the&#160;value&#160;in&#160;the&#160;control&#160;<br/>but&#160;is&#160;limited&#160;by&#160;the&#160;edit&#160;mask.&#160;The&#160;edit&#160;mask contains&#160;special&#160;characters&#160;that&#160;define&#160;what&#160;value&#160;can be&#160;<br/>entered at&#160;which&#160;location.&#160;For example, the&#160;character L&#160;(literal) indicates&#160;that&#160;the&#160;user cannot&#160;enter a&#160;value&#160;at<br/>the&#160;specified location,&#160;and the&#160;value&#160;N&#160;(number) indicates&#160;that&#160;the&#160;user can only&#160;enter the&#160;characters&#160;0&#160;<br/>through 9.<br/>
In&#160;the&#160;United&#160;States,&#160;each person is&#160;issued an identification&#160;number for tax&#160;purposes&#160;called a&#160;social&#160;security&#160;<br/>number.&#160;The&#160;social&#160;security&#160;number is&#160;composed of three&#160;numbers, a&#160;dash, two numbers, a&#160;dash, and four&#160;<br/>numbers.&#160;The&#160;edit&#160;mask is&#160;given as&#160;“NNNLNNLNNN”.&#160;This&#160;allows&#160;the&#160;user to&#160;enter numeric&#160;values&#160;at&#160;the&#160;<br/>appropriate&#160;locations,&#160;but&#160;prevents&#160;any&#160;modifications&#160;where&#160;the&#160;dashes&#160;are&#160;located.&#160;A&#160;literal&#160;mask of the&#160;<br/>form&#160;“___-__-___”&#160;provides&#160;the&#160;initial&#160;template&#160;for the&#160;user to&#160;see, as&#160;illustrated&#160;i<a href="libremacros.html#638">n&#160;Listing&#160;539.&#160;</a>The&#160;use&#160;of&#160;<br/>the&#160;character “_”&#160;is&#160;an arbitrary&#160;choice;&#160;you may&#160;use&#160;any&#160;value&#160;that&#160;you&#160;desire, such as&#160;a&#160;space&#160;character.<br/>
<i><b>Listing&#160;539.&#160;</b>Edit&#160;mask&#160;and literal&#160;mask&#160;for&#160;a social&#160;security&#160;number.</i><br/>
EditMask&#160; &#160;&#160;=&#160;&#34;NNNLNNLNNN&#34;<br/>LiteralMask&#160;=&#160;&#34;___-__-___&#34;<br/>
The&#160;number of characters&#160;that&#160;can be&#160;entered is&#160;determined by&#160;the&#160;length&#160;of the&#160;edit&#160;mask. It&#160;is&#160;considered an<br/>error if&#160;the&#160;edit&#160;mask and the&#160;literal&#160;mask are&#160;not&#160;the&#160;same&#160;lengt<a href="libremacros.html#639">h.&#160;Table&#160;290&#160;s</a>hows&#160;the&#160;edit&#160;mask characters&#160;<br/>supported&#160;by&#160;the&#160;pattern control.&#160;The&#160;pattern field&#160;supports&#160;the&#160;properties&#160;in<a href="libremacros.html#639">&#160;Table&#160;291.</a><br/>
635<br/>
<hr/>
<a name=639></a><i><b>Table&#160;290.&#160;</b>Edit&#160;mask&#160;characters&#160;supported by&#160;the&#160;pattern control.</i><br/>
<i><b>Character</b></i><br/>
<i><b>Description</b></i><br/>
L<br/>
A&#160;text&#160;constant&#160;that&#160;is&#160;displayed but&#160;cannot&#160;be&#160;edited.<br/>
a<br/>
The&#160;characters a–z&#160;and&#160;A–Z&#160;can be&#160;entered.<br/>
A<br/>
The&#160;characters a–z&#160;and&#160;A–Z&#160;are&#160;valid,&#160;but&#160;the&#160;letters a–z&#160;are&#160;converted&#160;to&#160;<br/>
uppercase.<br/>
c<br/>
The&#160;characters a–z,&#160;A–Z, and 0–9&#160;can be&#160;entered.<br/>
C<br/>
The&#160;characters a–z,&#160;A–Z, and 0–9&#160;are&#160;valid,&#160;but&#160;the&#160;letters&#160;a–z&#160;are&#160;converted&#160;to&#160;<br/>uppercase.<br/>
N<br/>
The&#160;characters 0–9 can&#160;be&#160;entered.<br/>
x<br/>
Any&#160;printable&#160;character&#160;can be&#160;entered.<br/>
X<br/>
Any&#160;printable&#160;character&#160;can be&#160;entered,&#160;but&#160;the&#160;letters a–z&#160;are&#160;converted to&#160;<br/>uppercase.<br/>
<i><b>Table&#160;291.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlPatternFieldModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BackgroundColor<br/>
Dialog’s&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
Border<br/>
Specify&#160;no&#160;border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1), or&#160;a&#160;simple&#160;border&#160;(2).<br/>
EditMask<br/>
The&#160;edit&#160;mask.&#160;&#160;<br/>
Enabled<br/>
If&#160;True, the&#160;dialog&#160;is enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption bar.<br/>
FontEmphasisMark<br/>
FontEmphasis for&#160;the&#160;text&#160;in the&#160;dialog’s&#160;caption bar.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in&#160;the&#160;dialog’s&#160;caption bar.<br/>
HelpText<br/>
Dialog’s&#160;help&#160;text&#160;as a&#160;String.<br/>
HelpURL<br/>
Dialog’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
LiteralMask<br/>
The&#160;literal&#160;mask. &#160;<br/>
MaxTextLen<br/>
Maximum&#160;number&#160;of&#160;characters the&#160;control&#160;may&#160;contain. If&#160;zero,&#160;the&#160;text&#160;length&#160;is&#160;not&#160;<br/>
purposely&#160;limited.<br/>
Printable<br/>
If&#160;True, the&#160;control&#160;is&#160;printed&#160;with the&#160;document.<br/>
ReadOnly<br/>
If&#160;True, the&#160;control’s&#160;content&#160;cannot&#160;be&#160;modified by&#160;the&#160;user.<br/>
StrictFormat<br/>
If&#160;True, the&#160;text&#160;is checked&#160;during&#160;the&#160;user&#160;input.&#160;<br/>
Tabstop<br/>
If&#160;True, the&#160;control&#160;can be&#160;reached by&#160;using&#160;the&#160;Tab&#160;key.<br/>
Text<br/>
The&#160;text&#160;that&#160;is&#160;displayed in&#160;the&#160;control.<br/>
TextColor<br/>
Dialog’s&#160;text&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
TextLineColor<br/>
Dialog’s&#160;text&#160;line&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
<b>TIP</b><br/>
If&#160;the&#160;StrictFormat&#160;property&#160;is False,&#160;the&#160;pattern control&#160;ignores the&#160;edit&#160;mask and the&#160;literal&#160;mask.<br/>
636<br/>
<hr/>
<a name=640></a><i><b>Fixed&#160;text&#160;control<br/></b></i>Use&#160;the&#160;fixed text&#160;control&#160;to&#160;label&#160;other controls&#160;and areas&#160;in a&#160;dialog. In&#160;the&#160;IDE, the&#160;fixed&#160;text&#160;control&#160;is&#160;<br/>called a&#160;“label&#160;field.”&#160;The&#160;fixed&#160;text&#160;control&#160;is&#160;a&#160;very&#160;simple&#160;text&#160;edit&#160;field.&#160;The&#160;model&#160;supports&#160;the&#160;<br/>properties&#160;i<a href="libremacros.html#640">n&#160;Table&#160;292.</a><br/>
<i><b>Table&#160;292.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlFixedTextFieldModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Align<br/>
Specify&#160;that&#160;the&#160;text&#160;is&#160;aligned left&#160;(0),&#160;center&#160;(1), or&#160;right&#160;(2).<br/>
BackgroundColor<br/>
Control’s&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
Border<br/>
Specify&#160;no&#160;border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1), or&#160;a&#160;simple&#160;border&#160;(2).<br/>
Enabled<br/>
If&#160;True, the&#160;control&#160;is&#160;enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in&#160;the&#160;control.<br/>
FontEmphasisMark<br/>
FontEmphasis for&#160;the&#160;text&#160;in the&#160;control.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in&#160;the&#160;control.<br/>
HelpText<br/>
Control’s&#160;help&#160;text&#160;as&#160;a&#160;String.<br/>
HelpURL<br/>
Control’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
Label<br/>
Text&#160;label&#160;displayed&#160;in&#160;the&#160;control.<br/>
MultiLine<br/>
If&#160;True, the&#160;text&#160;may&#160;use&#160;more&#160;than one&#160;line.<br/>
Printable<br/>
If&#160;True, the&#160;control&#160;is&#160;printed&#160;with the&#160;document.<br/>
TextColor<br/>
Control’s&#160;text&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
TextLineColor<br/>
Control’s&#160;text&#160;line&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
<i><b>File&#160;control<br/></b></i>The&#160;file&#160;control&#160;is&#160;a&#160;text&#160;edit&#160;control&#160;that&#160;contains&#160;a&#160;command button, which opens&#160;the&#160;File&#160;dialog.&#160;The&#160;<br/>initial&#160;directory&#160;that&#160;is&#160;used is&#160;set&#160;by&#160;the&#160;Text&#160;property.<a href="libremacros.html#640">&#160;Table&#160;293&#160;c</a>ontains&#160;the&#160;properties&#160;defined by&#160;the&#160;file&#160;<br/>control&#160;model.<br/>
<i><b>Table&#160;293.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlFileControlModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BackgroundColor<br/>
Control’s&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
Border<br/>
Specify&#160;no&#160;border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1), or&#160;a&#160;simple&#160;border&#160;(2).<br/>
Enabled<br/>
If&#160;True, the&#160;control&#160;is&#160;enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in&#160;the&#160;control.<br/>
FontEmphasisMark<br/>
FontEmphasis for&#160;the&#160;text&#160;in the&#160;control.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in&#160;the&#160;control.<br/>
HelpText<br/>
Control’s&#160;help&#160;text&#160;as&#160;a&#160;String.<br/>
HelpURL<br/>
Control’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
Printable<br/>
If&#160;True, the&#160;control&#160;is&#160;printed&#160;with the&#160;document.<br/>
Text<br/>
The&#160;text&#160;displayed&#160;in&#160;the&#160;control.<br/>
TextColor<br/>
Control’s&#160;text&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
TextLineColor<br/>
Control’s&#160;text&#160;line&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
637<br/>
<hr/>
<a name=641></a>The&#160;file&#160;control&#160;is&#160;easy&#160;to&#160;use, but&#160;unfortunately&#160;it&#160;doesn’t&#160;support&#160;using filters.&#160;A&#160;frequent&#160;solution for this&#160;<br/>is&#160;to&#160;add a&#160;text&#160;input&#160;box&#160;with&#160;a&#160;button&#160;next&#160;to&#160;it.&#160;When the&#160;button&#160;is&#160;selected,&#160;it&#160;opens&#160;a&#160;file&#160;selection&#160;dialog&#160;<br/>with the&#160;desired filters.&#160;When the&#160;dialog is&#160;closed, it&#160;adds&#160;the&#160;selected file&#160;to&#160;the&#160;text&#160;control.<br/>
<b>Note</b><br/>
Add&#160;a&#160;text&#160;field&#160;named&#160;FileTextField&#160;to the&#160;OOMESample&#160;dialog.&#160;Add&#160;a&#160;button next&#160;to&#160;the&#160;text&#160;field&#160;that&#160;<br/>
calls the&#160;macro in<a href="libremacros.html#641">&#160;Listing&#160;540.</a><br/>
Create&#160;a&#160;text&#160;field and name&#160;it&#160;FileTextField.&#160;Add a&#160;button&#160;next&#160;to the&#160;text&#160;field and set&#160;the&#160;“When&#160;<br/>initiating”&#160;event&#160;to&#160;call&#160;the&#160;macro i<a href="libremacros.html#641">n&#160;Listing&#160;540.&#160;</a>This&#160;macro opens&#160;a&#160;file&#160;selection dialog based on the&#160;<br/>directory&#160;or file&#160;stored in&#160;the&#160;FileTextfield.&#160;If&#160;the&#160;text&#160;field&#160;is&#160;empty,&#160;the&#160;macro checks&#160;the&#160;configuration&#160;<br/>information to&#160;determine&#160;the&#160;starting directory.&#160;The&#160;interesting thing about&#160;this&#160;example&#160;is&#160;that&#160;it&#160;uses&#160;<br/>multiple&#160;file&#160;filters—something that&#160;isn’t&#160;possible&#160;if a&#160;file&#160;control&#160;is&#160;used.<br/>
<i><b>Listing&#160;540.</b>&#160;Select&#160;a file.</i><br/>
Sub&#160;FileButtonSelected<br/>&#160;&#160;Dim&#160;oFileDlg&#160; &#160; &#160; &#160; &#160; &#160;'File selection dialog<br/>&#160;&#160;Dim&#160;oSettings&#160; &#160; &#160; &#160; &#160;&#160;'Settings object to get the path settings<br/>&#160;&#160;Dim&#160;sFile&#160;As&#160;String&#160; &#160;&#160;'File URL as a string<br/>&#160;&#160;Dim&#160;oFileAccess&#160; &#160; &#160; &#160;&#160;'Simple file access object<br/>&#160;&#160;Dim&#160;oFiles&#160; &#160; &#160; &#160; &#160; &#160; &#160;'The File dialog returns an array of selected files<br/>&#160;&#160;<br/>&#160;&#160;REM Start with the value in the text field<br/>&#160;&#160;sFile&#160;=&#160;oOOMEDlg.getModel().getByName(&#34;FileTextField&#34;).Text<br/>&#160;&#160;If&#160;sFile&#160;&lt;&gt;&#160;&#34;&#34;&#160;Then<br/>&#160; &#160;&#160;sFile&#160;=&#160;ConvertToURL(sFile)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;REM The text field is blank, so obtain the path settings<br/>&#160; &#160;&#160;oSettings&#160;=&#160;CreateUnoService(&#34;com.sun.star.util.PathSettings&#34;)<br/>&#160; &#160;&#160;sFile&#160;=&#160;oSettings.Work<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM Dialog to select a file<br/>&#160;&#160;oFileDlg&#160;=&#160;CreateUnoService(&#34;com.sun.star.ui.dialogs.FilePicker&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Set the supported filters<br/>&#160;&#160;oFileDlg.AppendFilter(&#160;&#34;All files (*.*)&#34;,&#160;&#34;*.*&#34;&#160;)<br/>&#160;&#160;oFileDlg.AppendFilter(&#160;&#34;JPG files (*.jpg)&#34;,&#160;&#34;*.jpg&#34;&#160;)<br/>&#160;&#160;oFileDlg.AppendFilter(&#160;&#34;OOo Writer (*.sxw)&#34;,&#160;&#34;*.sxw&#34;)<br/>&#160;&#160;oFileDlg.AppendFilter(&#160;&#34;OOo Calc (*.sxc)&#34;,&#160;&#34;*.sxc&#34;)<br/>&#160;&#160;oFileDlg.AppendFilter(&#160;&#34;OOo Draw (*.sxd)&#34;,&#160;&#34;*.sxd&#34;)<br/>&#160;&#160;oFileDlg.AppendFilter(&#160;&#34;OOo Impress (*.sxi)&#34;,&#160;&#34;*.sxi&#34;)<br/>&#160;&#160;oFileDlg.SetCurrentFilter(&#160;&#34;All files (*.*)&#34;&#160;)<br/>&#160;&#160;<br/>&#160;&#160;REM Determine if the &#34;file&#34; is a directory or a file!<br/>&#160;&#160;oFileAccess&#160;=&#160;CreateUnoService(&#34;com.sun.star.ucb.SimpleFileAccess&#34;)<br/>&#160;&#160;If&#160;oFileAccess.exists(sFile)&#160;Then<br/>&#160; &#160;&#160;REM I do not force the &#34;display directory&#34; to be a folder.<br/>&#160; &#160;&#160;REM I could do something fancy with this such as<br/>&#160; &#160;&#160;REM If NOT oFileAccess.isFolder(sFile) Then extract the folder...<br/>&#160; &#160;&#160;REM but I won't!<br/>&#160; &#160;&#160;oFileDlg.setDisplayDirectory(sFile)<br/>
638<br/>
<hr/>
<a name=642></a>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM Execute the File dialog.<br/>&#160;&#160;If&#160;oFileDlg.execute()&#160;Then<br/>&#160; &#160;&#160;oFiles&#160;=&#160;oFileDlg.getFiles()<br/>&#160; &#160;&#160;If&#160;UBound(oFiles)&#160;&gt;=&#160;0&#160;Then<br/>&#160; &#160; &#160;&#160;sFile&#160;=&#160;ConvertFromURL(oFiles(0))<br/>&#160; &#160; &#160;&#160;oOOMEDlg.getModel().getByName(&#34;FileTextField&#34;).Text&#160;=&#160;sFile<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
<b>&#160;18.3.8.&#160;Image&#160;control<br/></b>An image&#160;control&#160;is&#160;used to&#160;display&#160;a&#160;graphic&#160;image.&#160;The&#160;image&#160;control&#160;is&#160;able&#160;to automatically&#160;scale&#160;an&#160;<br/>image&#160;to&#160;fit&#160;inside&#160;the&#160;image&#160;control. Use&#160;the&#160;ImageURL&#160;property&#160;to specify&#160;the&#160;image&#160;to&#160;load and the&#160;<br/>ScaleImage&#160;property&#160;to&#160;tell&#160;the&#160;control&#160;to&#160;scale&#160;the&#160;image&#160;automatically&#160;(see<a href="libremacros.html#642">&#160;Table&#160;294)</a>.<br/>
<i><b>Table&#160;294.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlImageControlModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BackgroundColor<br/>
Control’s&#160;background color&#160;as&#160;a&#160;Long&#160;Integer.<br/>
Border<br/>
Specify&#160;no border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1),&#160;or&#160;a&#160;simple&#160;border&#160;(2).<br/>
Enabled<br/>
If&#160;True,&#160;the&#160;dialog is&#160;enabled.<br/>
HelpText<br/>
Control’s&#160;help text&#160;as a&#160;String.<br/>
HelpURL<br/>
Control’s&#160;help URL&#160;as&#160;a&#160;String.<br/>
ImageURL<br/>
URL&#160;of&#160;the&#160;image&#160;to load.<br/>
Printable<br/>
If&#160;True,&#160;the&#160;control&#160;is printed with&#160;the&#160;document.<br/>
ScaleImage<br/>
If&#160;True,&#160;the&#160;image&#160;is automatically&#160;scaled&#160;to the&#160;size&#160;of&#160;the&#160;control.<br/>
TabStop<br/>
If&#160;True,&#160;the&#160;Tab&#160;key&#160;can reach this&#160;control.<br/>
<b>&#160;18.3.9.&#160;Progress&#160;control<br/></b>A&#160;progress&#160;bar is&#160;a&#160;straight&#160;bar that&#160;fills&#160;in&#160;a&#160;solid&#160;color starting at&#160;the&#160;left&#160;and moving to the&#160;right.&#160;The&#160;idea&#160;<br/>is&#160;that&#160;at&#160;the&#160;start&#160;the&#160;progress&#160;bar is&#160;empty,&#160;and it&#160;fills&#160;as&#160;work is&#160;accomplished.&#160;A&#160;typical&#160;example&#160;is&#160;the&#160;<br/>“Saving document”&#160;progress&#160;bar at&#160;the&#160;bottom&#160;of OpenOffice&#160;when you click&#160;the&#160;Save&#160;icon to&#160;save&#160;an open&#160;<br/>document.<br/>
Use&#160;the&#160;ProgressValueMin and ProgressValueMax&#160;properties&#160;to tell&#160;the&#160;control&#160;the&#160;range&#160;of values&#160;that&#160;it&#160;<br/>will&#160;contain.&#160;When the&#160;ProgressValue&#160;property&#160;is&#160;at&#160;the&#160;minimum&#160;value,&#160;the&#160;control&#160;is&#160;empty—nothing is&#160;<br/>filled.&#160;When the&#160;ProgressValue&#160;is&#160;halfway&#160;between the&#160;minimum&#160;and the&#160;maximum&#160;values, the&#160;control&#160;is&#160;<br/>half filled. Finally,&#160;when the&#160;ProgressValue&#160;is&#160;at&#160;the&#160;maximum&#160;value, the&#160;control&#160;is&#160;completely&#160;filled.&#160;The&#160;<br/>progress&#160;bar is&#160;not&#160;limited to&#160;the&#160;values&#160;of empty,&#160;full,&#160;and half;&#160;these&#160;values&#160;are&#160;only&#160;examples<a href="libremacros.html#642">.&#160;Table&#160;295&#160;<br/></a>contains&#160;the&#160;properties&#160;supported by&#160;the&#160;progress&#160;control&#160;model.<br/>
<i><b>Table&#160;295.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlProgressBarModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BackgroundColor<br/>
Control’s&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
Border<br/>
Specify&#160;no&#160;border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1), or&#160;a&#160;simple&#160;border&#160;(2).<br/>
639<br/>
<hr/>
<a name=643></a><i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
Enabled<br/>
If&#160;True, the&#160;dialog&#160;is enabled.<br/>
FillColor<br/>
Color&#160;used&#160;to fill&#160;the&#160;progress&#160;bar.<br/>
HelpText<br/>
Control’s&#160;help&#160;text&#160;as&#160;a&#160;String.<br/>
HelpURL<br/>
Control’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
Printable<br/>
If&#160;True, the&#160;control&#160;is&#160;printed&#160;with the&#160;document.<br/>
ProgressValue<br/>
Current&#160;progress&#160;value&#160;as&#160;a&#160;Long&#160;Integer.<br/>
ProgressValueMax<br/>
Maximum&#160;progress value&#160;as a&#160;Long&#160;Integer.<br/>
ProgressValueMin<br/>
Minimum&#160;progress&#160;value&#160;as&#160;a&#160;Long&#160;Integer.<br/>
<b>TIP</b><br/>
You can set&#160;both&#160;BackgroundColor&#160;and FillColor.<br/>
<b>&#160;18.3.10.&#160;List&#160;box&#160;control<br/></b>A&#160;list&#160;box&#160;contains&#160;a&#160;list&#160;of items—one&#160;per line—from&#160;which&#160;the&#160;user may&#160;select&#160;zero or more&#160;items. In&#160;<br/>other words, a&#160;list&#160;box&#160;provides&#160;a&#160;mechanism&#160;to select&#160;multiple&#160;items&#160;from&#160;a&#160;list.&#160;The&#160;list&#160;box&#160;control&#160;<br/>automatically&#160;adds&#160;scroll&#160;bars&#160;if they&#160;are&#160;require<a href="libremacros.html#643">d.&#160;Table&#160;296&#160;c</a>ontains&#160;a&#160;list&#160;of properties&#160;supported by&#160;the&#160;<br/>list&#160;box&#160;model.<br/>
<i><b>Table&#160;296.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlListBoxModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BackgroundColor<br/>
Control’s&#160;background color&#160;as a&#160;Long&#160;Integer.<br/>
Border<br/>
Specify&#160;no&#160;border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1), or&#160;a&#160;simple&#160;border&#160;(2).<br/>
Dropdown<br/>
If&#160;True, the&#160;control&#160;has a&#160;drop-down&#160;button.<br/>
Enabled<br/>
If&#160;True, the&#160;control&#160;is&#160;enabled.<br/>
FontDescriptor<br/>
FontDescriptor&#160;structure&#160;for&#160;the&#160;text&#160;in&#160;the&#160;control.<br/>
FontEmphasisMark<br/>
FontEmphasis for&#160;the&#160;text&#160;in the&#160;control.<br/>
FontRelief<br/>
FontRelief&#160;for&#160;the&#160;text&#160;in&#160;the&#160;control.<br/>
HelpText<br/>
Control’s&#160;help&#160;text&#160;as&#160;a&#160;String.<br/>
HelpURL<br/>
Control’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
LineCount<br/>
The&#160;maximum&#160;line&#160;count&#160;displayed&#160;in&#160;the&#160;drop-down&#160;box.<br/>
MultiSelection<br/>
If&#160;True, more&#160;than one&#160;entry&#160;can&#160;be&#160;selected.<br/>
Printable<br/>
If&#160;True, the&#160;control&#160;is&#160;printed&#160;with the&#160;document.<br/>
ReadOnly<br/>
If&#160;True, the&#160;user&#160;cannot&#160;modify&#160;the&#160;data&#160;in the&#160;control.<br/>
SelectedItems<br/>
Array&#160;of&#160;Short&#160;Integers&#160;that&#160;represent&#160;the&#160;index of&#160;the&#160;selected items.<br/>
StringItemList<br/>
Array&#160;of&#160;strings that&#160;represent&#160;the&#160;items&#160;in&#160;the&#160;list&#160;box.<br/>
Tabstop<br/>
If&#160;True, the&#160;control&#160;can be&#160;reached by&#160;using&#160;the&#160;Tab&#160;key.<br/>
TextColor<br/>
Control’s&#160;text&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
TextLineColor<br/>
Control’s&#160;text&#160;line&#160;color&#160;as a&#160;Long&#160;Integer.<br/>
640<br/>
<hr/>
<a name=644></a>Although I&#160;recommend&#160;doing most&#160;manipulations&#160;through the&#160;model,&#160;many&#160;things&#160;are&#160;frequently&#160;done&#160;using<br/>methods&#160;defined for the&#160;control.&#160;The&#160;list&#160;box&#160;control&#160;supports&#160;the&#160;same&#160;special&#160;functions&#160;supported by&#160;the&#160;<br/>combo box control&#160;(see<a href="libremacros.html#627">&#160;Table&#160;274)</a>&#160;to&#160;add and remove&#160;items&#160;at&#160;specific&#160;locations.&#160;The&#160;list&#160;box&#160;control&#160;<br/>supports&#160;other useful&#160;methods&#160;that&#160;are&#160;primarily&#160;related to&#160;the&#160;user interaction&#160;(see<a href="libremacros.html#644">&#160;Table&#160;297)</a>.<br/>
<i><b>Table&#160;297.&#160;</b>Methods&#160;defined by&#160;the&#160;com.sun.star.awt.XListBox&#160;interface.</i><br/>
<i><b>Method</b></i><br/>
<i><b>Description</b></i><br/>
addItemListener(XItemListener)<br/>
Add a&#160;listener&#160;for&#160;item&#160;events.<br/>
removeItemListener(XItemListener)<br/>
Remove&#160;a&#160;listener&#160;for&#160;item&#160;events.<br/>
addActionListener(XActionListener)<br/>
Add a&#160;listener&#160;for&#160;action events.<br/>
removeActionListener(XActionListener)<br/>
Remove&#160;a&#160;listener&#160;for&#160;action events.<br/>
addItem(String,&#160;position)<br/>
Add an item&#160;at&#160;the&#160;specified&#160;position.<br/>
addItems(StringArray,&#160;position)<br/>
Add multiple&#160;items at&#160;the&#160;specified&#160;position.<br/>
removeItems(position,&#160;count)<br/>
Remove&#160;a&#160;number&#160;of&#160;items&#160;at&#160;the&#160;specified position.<br/>
getItemCount()<br/>
Get&#160;the&#160;number&#160;of&#160;items&#160;in&#160;the&#160;list&#160;box.<br/>
getItem(position)<br/>
Get&#160;the&#160;specified&#160;item.<br/>
getItems()<br/>
Return the&#160;StringItemList&#160;property&#160;(see<a href="libremacros.html#643">&#160;Table&#160;296)</a>.<br/>
getSelectedItemPos()<br/>
Return the&#160;position&#160;of&#160;one&#160;of&#160;the&#160;selected&#160;items.&#160;This is&#160;useful&#160;<br/>
if&#160;<br/>only&#160;one&#160;item&#160;can be&#160;selected.<br/>
getSelectedItemsPos()<br/>
Return the&#160;SelectedItems property&#160;(see<a href="libremacros.html#643">&#160;Table&#160;296)</a>.<br/>
getSelectedItem()<br/>
Return one&#160;of&#160;the&#160;selected&#160;items.&#160;This is&#160;useful&#160;if&#160;only&#160;one&#160;item<br/>can be&#160;selected.<br/>
getSelectedItems()<br/>
Return all&#160;selected&#160;items as an&#160;array&#160;of&#160;strings.<br/>
selectItemPos(position,&#160;boolean)<br/>
Select&#160;or&#160;deselect&#160;the&#160;item&#160;at&#160;the&#160;specified&#160;position.<br/>
selectItemsPos(positions, boolean)<br/>
Select&#160;or&#160;deselect&#160;multiple&#160;items at&#160;the&#160;positions specified&#160;by&#160;<br/>
the&#160;<br/>array&#160;of&#160;positions.<br/>
selectItem(item, boolean)<br/>
Select&#160;or&#160;deselect&#160;the&#160;specified&#160;item&#160;string.<br/>
isMutipleMode()<br/>
Get&#160;the&#160;MultiSelection&#160;property&#160;(see<a href="libremacros.html#643">&#160;Table&#160;296)</a>.<br/>
setMultipleMode(boolean)<br/>
Set&#160;the&#160;MultiSelection property&#160;(see<a href="libremacros.html#643">&#160;Table&#160;296)</a>.<br/>
getDropDownLineCount()<br/>
Get&#160;the&#160;LineCount&#160;property&#160;(see<a href="libremacros.html#643">&#160;Table&#160;296)</a>.<br/>
setDropDownLineCount(integer)<br/>
Set&#160;the&#160;LineCount&#160;property&#160;(see<a href="libremacros.html#643">&#160;Table&#160;296)</a>.<br/>
makeVisible(position)<br/>
Scroll&#160;the&#160;items&#160;in&#160;the&#160;list&#160;box so that&#160;the&#160;specified&#160;item&#160;is&#160;<br/>
visible.<br/>
<b>&#160;18.3.11.&#160;Scroll&#160;bar&#160;control<br/></b>The&#160;scroll&#160;bar control&#160;can be&#160;used to&#160;scroll&#160;a&#160;control&#160;or dialog that&#160;does&#160;not&#160;already&#160;contain&#160;or support&#160;a&#160;<br/>scroll&#160;bar.&#160;All&#160;of the&#160;work to control&#160;another object&#160;and synchronize&#160;the&#160;external&#160;object&#160;with&#160;the&#160;scroll&#160;bar&#160;<br/>must&#160;be&#160;done&#160;using a&#160;macro. In&#160;other words, the&#160;scroll&#160;bar control&#160;does&#160;not&#160;automatically&#160;connect&#160;to&#160;or&#160;<br/>control&#160;another object,&#160;but&#160;requires&#160;a&#160;macro to&#160;implement&#160;the&#160;connection.&#160;To&#160;use&#160;the&#160;scroll&#160;bar control, write<br/>a&#160;macro that&#160;responds&#160;to&#160;the&#160;control’s&#160;events&#160;and then manipulate&#160;another object&#160;based on what&#160;happens&#160;in&#160;<br/>the&#160;control.&#160;If&#160;you&#160;want&#160;the&#160;scroll&#160;bar to&#160;track changes&#160;in&#160;the&#160;controlled object, you must&#160;write&#160;handlers&#160;for&#160;<br/>
641<br/>
<hr/>
<a name=645></a>the&#160;other object&#160;to&#160;update&#160;the&#160;scroll&#160;bar.&#160;As&#160;an input&#160;or an output, the&#160;scroll&#160;bar serves&#160;to&#160;indicate&#160;a&#160;<br/>relationship in&#160;another object;&#160;the&#160;relationship&#160;displayed and the&#160;corresponding action&#160;depends&#160;on the&#160;<br/>programming of a&#160;macro. See<a href="libremacros.html#416">&#160;Table&#160;141.</a><br/>
<i><b>Table&#160;298.&#160;</b>Properties&#160;in the&#160;com.sun.star.awt.UnoControlScrollBarModel&#160;service.</i><br/>
<i><b>Property</b></i><br/>
<i><b>Description</b></i><br/>
BlockIncrement&#160;<br/>
Increment&#160;for&#160;a&#160;block move&#160;as&#160;a&#160;Long&#160;Integer.<br/>
Border<br/>
Specify&#160;no&#160;border&#160;(0),&#160;a&#160;3-D&#160;border&#160;(1), or&#160;a&#160;simple&#160;border&#160;(2).<br/>
Enabled<br/>
If&#160;True, the&#160;control&#160;is&#160;enabled.<br/>
HelpText<br/>
Control’s&#160;help&#160;text&#160;as&#160;a&#160;String.<br/>
HelpURL<br/>
Control’s&#160;help&#160;URL&#160;as a&#160;String.<br/>
LineIncrement&#160;<br/>
Increment&#160;for&#160;a&#160;single-line&#160;move&#160;as a&#160;Long Integer.<br/>
Orientation&#160;<br/>
Scroll&#160;bar&#160;orientation with&#160;values&#160;<br/>
com.sun.star.awt.ScrollBarOrientation.HORIZONTAL&#160;(0)&#160;and&#160;<br/>com.sun.star.awt.ScrollBarOrientation.VERTICAL&#160;(1).<br/>
Printable<br/>
If&#160;a&#160;scroll&#160;bar&#160;is embedded&#160;into&#160;a&#160;document, setting&#160;this to&#160;True&#160;causes the&#160;scroll&#160;<br/>bar&#160;to be&#160;printed when the&#160;document&#160;is printed.<br/>
ScrollValue&#160;<br/>
Current&#160;scroll&#160;value.<br/>
ScrollValueMax&#160;<br/>
Maximum&#160;scroll&#160;value&#160;of&#160;the&#160;control.<br/>
VisibleSize&#160;<br/>
Visible&#160;size&#160;of&#160;the&#160;scroll&#160;bar.<br/>
<b>Note</b><br/>
Add&#160;a&#160;horizontal&#160;scroll&#160;bar&#160;to the&#160;OOMESample&#160;dialog.&#160;Add&#160;the&#160;global&#160;variable&#160;oBPosSize&#160;<br/>to store&#160;a&#160;button’s&#160;original&#160;position and size&#160;(see<a href="libremacros.html#645">&#160;Listing&#160;541)</a>.<br/>
To&#160;illustrate&#160;how&#160;the&#160;scroll&#160;bar functions, add a&#160;horizontal&#160;scroll&#160;bar to&#160;the&#160;sample&#160;dialog&#160;and name&#160;it&#160;<br/>ButtonScrollBar.&#160;All&#160;of the&#160;work done&#160;by&#160;a&#160;scroll&#160;bar control&#160;is&#160;done&#160;by&#160;a&#160;macro.&#160;A&#160;scroll&#160;bar doesn’t&#160;know&#160;<br/>if something is&#160;horizontal&#160;or vertical, so it’s&#160;just&#160;as&#160;easy&#160;to use&#160;a&#160;vertical&#160;scroll&#160;bar as&#160;a&#160;horizontal&#160;scroll&#160;bar&#160;<br/>for the&#160;same&#160;application—a&#160;person using&#160;a&#160;vertical&#160;scroll&#160;bar to move&#160;something horizontally&#160;might&#160;face&#160;<br/>ridicule&#160;by&#160;his&#160;peers, but&#160;the&#160;control&#160;doesn’t&#160;care. I&#160;chose&#160;a&#160;horizontal&#160;scroll&#160;bar because&#160;I&#160;want&#160;to&#160;use&#160;it&#160;to&#160;<br/>move&#160;the&#160;Close&#160;button horizontally&#160;on the&#160;dialog.&#160;Add a&#160;global&#160;variable&#160;to store&#160;the&#160;initial&#160;position&#160;of the&#160;<br/>Close&#160;button&#160;(see<a href="libremacros.html#645">&#160;Listing 541)</a>.<br/>
<i><b>Listing&#160;541.&#160;</b>Global&#160;variables&#160;for&#160;the&#160;Close&#160;button’s&#160;initial&#160;position&#160;and size.<br/></i>Dim&#160;oBPosSize&#160; &#160;&#160;'Button original position and size<br/>
In&#160;my&#160;sample&#160;dialog, there&#160;is&#160;nothing between the&#160;Close&#160;button and the&#160;right&#160;edge&#160;of the&#160;dialog (see<a href="libremacros.html#646">&#160;Figure&#160;<br/>139)</a>. I&#160;want&#160;the&#160;scroll&#160;bar to cause&#160;the&#160;Close&#160;button&#160;to move&#160;right&#160;and left.&#160;<br/>
642<br/>
<hr/>
<a name=646></a><i><b>Figure&#160;139.&#160;</b>OOMESample&#160;dialog&#160;referred to throughout&#160;this&#160;chapter.</i><br/>
The&#160;maximum&#160;scroll&#160;bar value&#160;defaults&#160;to&#160;100.&#160;This&#160;is&#160;usually&#160;used as&#160;a&#160;percentage&#160;to scroll&#160;something. In&#160;<br/>the&#160;sample&#160;dialog, however,&#160;I&#160;calculate&#160;the&#160;maximum&#160;distance&#160;that&#160;I&#160;can move&#160;the&#160;Close&#160;button,&#160;and then I&#160;<br/>set&#160;the&#160;maximum&#160;value&#160;that&#160;the&#160;scroll&#160;bar can return as&#160;this&#160;number.&#160;This&#160;allows&#160;me&#160;to use&#160;the&#160;scroll&#160;value&#160;<br/>directly,&#160;rather than&#160;calculating a&#160;position&#160;based on a&#160;percentage, which&#160;is&#160;the&#160;usual&#160;case.<br/>
In&#160;the&#160;initialization&#160;section, add code&#160;that&#160;saves&#160;the&#160;Close&#160;button’s&#160;initial&#160;position&#160;and size&#160;(see<a href="libremacros.html#646">&#160;Listing 542);</a>&#160;<br/>this&#160;information is&#160;used later as&#160;a&#160;reference&#160;point.&#160;Next,&#160;calculate&#160;how&#160;far the&#160;button&#160;can be&#160;shifted&#160;to the&#160;<br/>right&#160;based on the&#160;size&#160;and position&#160;of the&#160;button&#160;and the&#160;size&#160;of the&#160;dialog that&#160;contains&#160;the&#160;button.<br/>
<i><b>Listing&#160;542.&#160;</b>Save&#160;the&#160;initial&#160;button&#160;position&#160;and set&#160;the&#160;scroll&#160;bar’s&#160;maximum&#160;value.<br/></i>&#160;&#160;REM Get the Close button's original position and size.<br/>&#160;&#160;REM Set the maximum value that the scroll bar can become<br/>&#160;&#160;REM based on the maximum distance that I can move the Close button.<br/>&#160;&#160;oBPosSize&#160;=&#160;oOOMEDlg.getControl(&#34;CloseButton&#34;).getPosSize()<br/>&#160;&#160;oOOMEDlg.getModel().getByName(&#34;ButtonScrollBar&#34;).ScrollValueMax&#160;=&#160;_<br/>&#160; &#160; &#160; &#160;oOOMEDlg.getPosSize.Width&#160;-&#160;oBPosSize.X&#160;-&#160;oBPosSize.Width&#160;-&#160;10<br/>
Set&#160;the&#160;scroll&#160;bar to call&#160;the&#160;ScrollButton&#160;method&#160;i<a href="libremacros.html#646">n&#160;Listing&#160;543&#160;fo</a>r the&#160;“While&#160;Adjusting”&#160;event.&#160;The&#160;<br/>ScrollButton&#160;method&#160;uses&#160;the&#160;scroll&#160;value&#160;to&#160;position&#160;the&#160;Close&#160;button.&#160;<br/>
<i><b>Listing&#160;543.&#160;</b>ScrollButton is&#160;in the&#160;DlgCode&#160;module.</i><br/>
Sub&#160;ScrollButton<br/>&#160;&#160;Dim&#160;oModel&#160; &#160; &#160; &#160;'Scroll bar model<br/>&#160;&#160;Dim&#160;oButton&#160; &#160; &#160;&#160;'Close button<br/>&#160;&#160;Dim&#160;newX&#160;As&#160;Long&#160;'New X location for the Close button<br/>&#160;&#160;<br/>&#160;&#160;oModel&#160;=&#160;oOOMEDlg.getModel().getByName(&#34;ButtonScrollBar&#34;)<br/>&#160;&#160;oButton&#160;=&#160;oOOMEDlg.getControl(&#34;CloseButton&#34;)<br/>
643<br/>
<hr/>
<a name=647></a>&#160;&#160;REM The scroll bar was set so that its maximum value is<br/>&#160;&#160;REM the maximum desired value.<br/>&#160;&#160;newX&#160;=&#160;oBPosSize.X&#160;+&#160;oModel.ScrollValue<br/>&#160;&#160;oButton.setPosSize(newX,&#160;0,&#160;0,&#160;0,&#160;com.sun.star.awt.PosSize.X)<br/>End&#160;Sub<br/>
Now&#160;you&#160;can move&#160;the&#160;Close&#160;button to&#160;the&#160;right&#160;and to the&#160;left&#160;by&#160;moving the&#160;scroll&#160;bar.<br/>
<i><b>&#160;18.4.&#160;Using&#160;the&#160;Step&#160;property&#160;for&#160;multi-page&#160;AutoPilot&#160;dialogs<br/></b></i>A&#160;multi-page&#160;dialog can display&#160;different&#160;sets&#160;of controls&#160;in&#160;the&#160;same&#160;dialog. Each set&#160;of controls&#160;is&#160;<br/>sometimes&#160;referred to&#160;as&#160;a&#160;“page.”&#160;OpenOffice.org&#160;frequently&#160;refers&#160;to&#160;multi-page&#160;dialogs&#160;as&#160;AutoPilot&#160;<br/>dialogs&#160;because&#160;they&#160;are&#160;frequently&#160;used to&#160;guide&#160;you through some&#160;process.&#160;At&#160;each step in&#160;the&#160;process, a&#160;<br/>different&#160;set&#160;of controls&#160;is&#160;displayed in the&#160;same&#160;dialog. For example,&#160;OOo comes&#160;with an ImportWizard&#160;<br/>macro library.&#160;The&#160;Main() subroutine&#160;in&#160;the&#160;Main&#160;module&#160;opens&#160;a&#160;dialog that&#160;assists&#160;in&#160;converting multiple&#160;<br/>documents.&#160;The&#160;first&#160;page&#160;(or step) allows&#160;you&#160;to&#160;select&#160;what&#160;document&#160;types&#160;will&#160;be&#160;imported.&#160;The&#160;second&#160;<br/>page&#160;(or step) allows&#160;you to select&#160;the&#160;directory&#160;that&#160;contains&#160;the&#160;documents&#160;to&#160;import.<br/>
The&#160;dialog model&#160;contains&#160;the&#160;Step property,&#160;which&#160;tells&#160;the&#160;dialog&#160;the&#160;current&#160;step in&#160;the&#160;process. If&#160;the&#160;<br/>dialog’s&#160;Step property&#160;is&#160;set&#160;to&#160;zero, the&#160;default&#160;value, then the&#160;dialog displays&#160;every&#160;control.&#160;The&#160;model&#160;for&#160;<br/>every&#160;control&#160;that&#160;the&#160;dialog contains,&#160;also supports&#160;the&#160;Step&#160;property.&#160;In&#160;a&#160;control, the&#160;Step property&#160;is&#160;used&#160;<br/>to determine&#160;at&#160;which step&#160;the&#160;control&#160;is&#160;displayed. If&#160;a&#160;control’s&#160;Step property&#160;is&#160;zero, the&#160;control&#160;is&#160;<br/>displayed for every&#160;step.&#160;A&#160;Cancel&#160;button is&#160;likely&#160;to be&#160;displayed at&#160;every&#160;step, for example.<br/>
<i><b>&#160;18.5.&#160;The&#160;object&#160;inspector&#160;example<br/></b></i>This&#160;section&#160;discusses&#160;an object&#160;inspector,&#160;that&#160;I&#160;use&#160;to&#160;inspect&#160;objects&#160;to&#160;understand what&#160;I&#160;can do with&#160;<br/>them.&#160;I&#160;am&#160;taking code&#160;that&#160;I&#160;have&#160;changed over the&#160;years&#160;to&#160;accomplish&#160;specific&#160;tasks, and significant&#160;<br/>improvements&#160;are&#160;possible;&#160;but&#160;this&#160;serves&#160;my&#160;needs.<br/>
The&#160;object&#160;inspector accepts&#160;an optional&#160;argument&#160;that&#160;identifies&#160;the&#160;object&#160;to&#160;inspect. If&#160;the&#160;object&#160;is&#160;a&#160;UNO<br/>object,&#160;then the&#160;object&#160;contains&#160;debug&#160;properties&#160;that&#160;list&#160;the&#160;supported properties, methods,&#160;services, and&#160;<br/>interfaces.<br/>
In&#160;this&#160;example,&#160;a&#160;dialog&#160;is&#160;created without&#160;using the&#160;Basic&#160;IDE.&#160;The&#160;inspection information&#160;is&#160;stored in&#160;a&#160;<br/>multi-line&#160;text&#160;edit&#160;control.&#160;I&#160;use&#160;a&#160;text&#160;edit&#160;control&#160;rather than&#160;a&#160;list&#160;box, because&#160;the&#160;text&#160;control&#160;allows&#160;me&#160;<br/>to copy&#160;the&#160;contained&#160;text&#160;to the&#160;clipboard and the&#160;list&#160;box&#160;control&#160;does&#160;not.&#160;I&#160;frequently&#160;inspect&#160;an object&#160;<br/>and then copy&#160;the&#160;supported properties, methods, and interfaces&#160;to&#160;the&#160;clipboard so that&#160;I&#160;can use&#160;them&#160;as&#160;a&#160;<br/>reference.<br/>
Radio&#160;buttons&#160;dictate&#160;what&#160;is&#160;displayed in&#160;the&#160;text&#160;control.&#160;The&#160;text&#160;control&#160;can display&#160;the&#160;supported&#160;<br/>properties,&#160;methods, interfaces&#160;and services, and general&#160;inspection information&#160;such as&#160;the&#160;object’s&#160;data&#160;<br/>type&#160;(see<a href="libremacros.html#665">&#160;Figure&#160;140)</a>.<br/>
<b>&#160;18.5.1.&#160;Utility&#160;subroutines&#160;and&#160;functions<br/></b>Numerous&#160;utility&#160;methods&#160;are&#160;required to generically&#160;inspect&#160;an object&#160;in&#160;OO.&#160;The&#160;utility&#160;methods&#160;do not&#160;<br/>control, access, or update&#160;the&#160;dialog or any&#160;controls&#160;so I&#160;have&#160;separated them&#160;from&#160;the&#160;common&#160;<br/>functionality.&#160;The&#160;techniques&#160;and methods&#160;used here&#160;should&#160;be&#160;somewhat&#160;familiar,&#160;so I&#160;haven’t&#160;discussed&#160;<br/>them&#160;in depth.&#160;All&#160;of the&#160;routines&#160;are&#160;contained in&#160;the&#160;Inspector module&#160;in&#160;this&#160;chapter’s&#160;source&#160;code.<br/>
644<br/>
<hr/>
<a name=648></a><i><b>Identifying&#160;and&#160;removing&#160;white&#160;space&#160;from&#160;a&#160;string<br/></b></i>A&#160;text&#160;character that&#160;appears&#160;as&#160;open space&#160;is&#160;called a&#160;“white&#160;space&#160;character.”&#160;For example, in&#160;this&#160;book&#160;<br/>there&#160;is&#160;a&#160;single&#160;space&#160;between each word.&#160;The&#160;new-line&#160;character can create&#160;white&#160;space&#160;between lines.&#160;<br/>While&#160;inspecting an object, the&#160;resulting strings&#160;frequently&#160;contain&#160;leading and trailing white&#160;space&#160;of&#160;<br/>different&#160;types&#160;that&#160;must&#160;be&#160;removed.&#160;The&#160;functions&#160;in<a href="libremacros.html#648">&#160;Listing 544&#160;i</a>dentify&#160;the&#160;different&#160;types&#160;of white&#160;space<br/>and remove&#160;them&#160;from&#160;a&#160;string.<br/>
<i><b>Listing&#160;544.&#160;</b>Identify&#160;and remove&#160;white&#160;space&#160;from&#160;a string.<br/></i>REM Utility Functions and Methods<br/>
'*************************************************************************<br/>'** Is the specified character whitespace? The answer is true if the<br/>'** character is a tab, CR, LF, space, or a non-breaking space character!<br/>'** These correspond to the ASCII values 9, 10, 13, 32, and 160<br/>'*************************************************************************<br/>Function&#160;IsWhiteSpace(iChar&#160;As&#160;Integer)&#160;As&#160;Boolean<br/>&#160;&#160;Select&#160;Case&#160;iChar<br/>&#160;&#160;Case&#160;9,&#160;10,&#160;13,&#160;32,&#160;160<br/>&#160; &#160;&#160;IsWhiteSpace&#160;=&#160;True<br/>&#160;&#160;Case&#160;Else<br/>&#160; &#160;&#160;IsWhiteSpace&#160;=&#160;False<br/>&#160;&#160;End&#160;Select&#160;&#160;<br/>End&#160;Function<br/>
'*************************************************************************<br/>'** Find the first character starting at location i% that is not whitespace.<br/>'** If there are none, then the return value will be greater than the&#160;<br/>'** length of the string.<br/>'*************************************************************************<br/>Function&#160;FirstNonWhiteSpace(ByVal&#160;i%,&#160;s$)&#160;As&#160;Integer<br/>&#160;&#160;If&#160;i&#160;&lt;=&#160;Len(s)&#160;Then<br/>&#160; &#160;&#160;Do&#160;While&#160;IsWhiteSpace(Asc(Mid$(s,&#160;i,&#160;1)))<br/>&#160; &#160; &#160;&#160;i&#160;=&#160;i&#160;+&#160;1<br/>&#160; &#160; &#160;&#160;If&#160;i&#160;&gt;&#160;Len(s)&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;Exit&#160;Do<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Loop<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;FirstNonWhiteSpace&#160;=&#160;i<br/>End&#160;Function<br/>
'*************************************************************************<br/>'** Remove white space text from both the front and the end of a string.<br/>'** This modifies the argument string and it returns the modified string.<br/>'** This removes all types of white space, not just a regular space.<br/>'*************************************************************************<br/>Function&#160;TrimWhite(s&#160;As&#160;String)&#160;As&#160;String<br/>&#160;&#160;s&#160;=&#160;Trim(s)<br/>&#160;&#160;Do&#160;While&#160;Len(s)&#160;&gt;&#160;0<br/>&#160; &#160;&#160;If&#160;Not&#160;IsWhiteSpace(ASC(s))&#160;Then&#160;Exit&#160;Do<br/>&#160; &#160;&#160;s&#160;=&#160;Right(s,&#160;Len(s)&#160;-&#160;1)<br/>&#160;&#160;Loop<br/>
645<br/>
<hr/>
<a name=649></a>&#160;&#160;Do&#160;While&#160;Len(s)&#160;&gt;&#160;0<br/>&#160; &#160;&#160;If&#160;Not&#160;IsWhiteSpace(ASC(Right(s,&#160;1)))&#160;Then&#160;Exit&#160;Do<br/>&#160; &#160;&#160;s&#160;=&#160;Left(s,&#160;Len(s)&#160;-&#160;1)<br/>&#160;&#160;Loop<br/>&#160;&#160;TrimWhite&#160;=&#160;s<br/>End&#160;Function<br/>
<i><b>Convert&#160;a&#160;simple&#160;object&#160;to&#160;a&#160;string<br/></b></i>The&#160;CStr() method&#160;converts&#160;most&#160;standard data&#160;types&#160;to a&#160;string. Not&#160;all&#160;variables&#160;are&#160;easily&#160;converted to&#160;a&#160;<br/>string using&#160;CStr(), so the&#160;ObjToString() method attempts&#160;to&#160;make&#160;an intelligent&#160;conversion.&#160;The&#160;most&#160;<br/>troublesome&#160;variable&#160;types&#160;are&#160;Object&#160;and&#160;Variant,&#160;which can contain&#160;the&#160;value&#160;Empty&#160;or Null—these&#160;two&#160;<br/>cases&#160;are&#160;identified&#160;and printed in<a href="libremacros.html#649">&#160;Listing 545.&#160;</a>Variables&#160;of type&#160;Object&#160;cannot&#160;be&#160;trivially&#160;converted to&#160;a&#160;<br/>String, so they&#160;are&#160;not.&#160;The&#160;standard types&#160;are&#160;converted&#160;to a&#160;String by<a href="libremacros.html#649">&#160;Listing&#160;545.&#160;</a>The&#160;ObjToString()&#160;<br/>method&#160;truncates&#160;the&#160;string at&#160;100 characters.<br/>
<i><b>Listing&#160;545.</b>&#160;String&#160;representation&#160;of&#160;an object.</i><br/>
Function&#160;ObjToString(oInsObj,&#160;optional&#160;arraySep$,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;Optional&#160;maxDepth%,&#160;Optional&#160;CRReplace&#160;As&#160;Boolean)&#160;As&#160;String<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;<br/>&#160;&#160;Dim&#160;iMaxDepth%&#160;' Maximum number of array elements to display<br/>&#160;&#160;Dim&#160;sArraySep$&#160;' Separator used for array elements<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160;' Contains the results.<br/>&#160;&#160;Dim&#160;bCRReplace&#160;As&#160;Boolean<br/>
&#160;&#160;' Optional arguments<br/>&#160;&#160;If&#160;IsMissing(CRReplace)&#160;Then<br/>&#160; &#160; bCRReplace&#160;=&#160;False<br/>&#160;&#160;Else<br/>&#160; &#160; bCRReplace&#160;=&#160;CRReplace<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;If&#160;IsArray(oInsObj)&#160;Then<br/>&#160; &#160;&#160;If&#160;IsMissing(arraySep)&#160;Then<br/>&#160; &#160; &#160; sArraySep&#160;=&#160;CHR$(10)<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160; sArraySep&#160;=&#160;arraySep<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;If&#160;IsMissing(maxDepth)&#160;THen<br/>&#160; &#160; &#160; iMaxDepth&#160;=&#160;100<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160; iMaxDepth&#160;=&#160;maxDepth<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;<br/>&#160; &#160; s&#160;=&#160;ObjArrayToString(oInsObj,&#160;sArraySep,&#160;iMaxDepth)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;' Not an array<br/>&#160; &#160;&#160;Select&#160;Case&#160;VarType(oInsObj)<br/>&#160; &#160; &#160;&#160;Case&#160;0<br/>&#160; &#160; &#160; &#160; s&#160;=&#160;&#34;Empty&#34;<br/>&#160; &#160; &#160;&#160;Case&#160;1<br/>&#160; &#160; &#160; &#160; s&#160;=&#160;&#34;Null&#34;<br/>
646<br/>
<hr/>
<a name=650></a>&#160; &#160; &#160;&#160;Case&#160;2,&#160;3,&#160;4,&#160;5,&#160;7,&#160;8,&#160;11,&#160;16&#160;To&#160;23,&#160;33&#160;To&#160;37<br/>&#160; &#160; &#160; &#160; s&#160;=&#160;CStr(oInsObj)<br/>&#160; &#160; &#160;&#160;Case&#160;Else<br/>&#160; &#160; &#160; &#160;&#160;If&#160;IsUnoStruct(oInsObj)&#160;Then<br/>&#160; &#160; &#160; &#160; &#160; s&#160;=&#160;&#34;[Cannot convert an UnoStruct to a string]&#34;<br/>&#160; &#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160; &#160;&#160;Dim&#160;sImplName$&#160;:&#160;sImplName&#160;=&#160;GetImplementationName(oInsObj)<br/>&#160; &#160; &#160; &#160; &#160;&#160;If&#160;sImplName&#160;=&#160;&#34;&#34;&#160;Then<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; s&#160;=&#160;&#34;[Cannot convert &#34;&#160;&amp;&#160;TypeName(oInsObj)&#160;&amp;&#160;&#34; to a string]&#34;<br/>&#160; &#160; &#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160; &#160; &#160; s&#160;=&#160;&#34;[Cannot convert &#34;&#160;&amp;&#160;TypeName(oInsObj)&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34; (&#34;&#160;&amp;&#160;sImplName&#160;&amp;&#160;&#34;) to a string]&#34;<br/>&#160; &#160; &#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;End&#160;Select<br/>&#160; &#160;&#160;If&#160;bCRReplace&#160;Then<br/>&#160; &#160; &#160; s&#160;=&#160;Replace(s,&#160;CHR$(10),&#160;&#34;|&#34;,&#160;1,&#160;-1,&#160;1)<br/>&#160; &#160; &#160; s&#160;=&#160;Replace(s,&#160;CHR$(13),&#160;&#34;|&#34;,&#160;1,&#160;-1,&#160;1)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;If&#160;Len(s)&#160;&gt;&#160;100&#160;Then&#160;s&#160;=&#160;Left(s,&#160;100)&#160;&amp;&#160;&#34;....&#34;<br/>&#160;&#160;End&#160;If<br/>&#160; ObjToString&#160;=&#160;s<br/>End&#160;Function<br/>
Arrays&#160;are&#160;identified and converted&#160;separately.&#160;One&#160;and two dimensional&#160;arrays&#160;are&#160;supported.<br/>
<i><b>Listing&#160;546.</b>&#160;Convert&#160;an array&#160;to a string.&#160;<br/></i>'*************************************************************************<br/>'** Convert an array of objects to a string if possible.<br/>'**<br/>'** oInsObj &#160; - Object to Inspect<br/>'** sArraySep - Separator character for arrays<br/>'** maxDepth &#160;- Maximum number of array elements to show<br/>'*************************************************************************<br/>Function&#160;ObjArrayToString(oInsObj,&#160;sArraySep$,&#160;Optional&#160;maxDepth%)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;iMaxDepth%<br/>&#160;&#160;Dim&#160;iDimensions%<br/>&#160;&#160;<br/>&#160;&#160;If&#160;IsMissing(maxDepth)&#160;THen<br/>&#160; &#160;&#160;iMaxDepth&#160;=&#160;100<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;iMaxDepth&#160;=&#160;maxDepth<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;iDimensions&#160;=&#160;NumArrayDimensions(oInsObj)<br/>&#160;&#160;If&#160;iDimensions&#160;=&#160;1&#160;Then<br/>&#160; &#160;&#160;ObjArrayToString&#160;=&#160;ObjArray_1_ToString(oInsObj,&#160;iMaxDepth%,&#160;sArraySep)<br/>&#160;&#160;ElseIf&#160;iDimensions&#160;=&#160;2&#160;Then<br/>&#160; &#160;&#160;ObjArrayToString&#160;=&#160;ObjArray_2_ToString(oInsObj,&#160;iMaxDepth%,&#160;sArraySep)<br/>&#160;&#160;Else&#160;<br/>&#160; &#160;&#160;ObjArrayToString&#160;=&#160;&#34;[Unable to convert array with dimension &#34;&#160;&amp;&#160;iDimensions&#160;&amp;&#160;&#34;]&#34;<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
647<br/>
<hr/>
<a name=651></a>'*************************************************************************<br/>'** Convert a 1-D array of objects to a string.<br/>'**<br/>'** oInsObj &#160; &#160;- Object to Inspect<br/>'** iMaxDepth &#160;- Maximum number of array elements to show<br/>'** sSep &#160; &#160; &#160; - Separator character for arrays<br/>'*************************************************************************<br/>Function&#160;ObjArray_1_ToString(oInsObj,&#160;iMaxDepth%,&#160;sSep$)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;iDim_1%<br/>&#160;&#160;Dim&#160;iMax_1%<br/>&#160;&#160;Dim&#160;iCounter%<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Dim&#160;sTempSep$<br/>&#160;&#160;<br/>&#160;&#160;sTempSep&#160;=&#160;&#34;&#34;<br/>&#160;&#160;iDim_1&#160;=&#160;LBound(oInsObj,&#160;1)&#160;<br/>&#160;&#160;iMax_1&#160;=&#160;UBound(oInsObj,&#160;1)<br/>&#160;&#160;Do&#160;While&#160;(iCounter&#160;&lt;&#160;iMaxDepth&#160;AND&#160;iDim_1&#160;&lt;=&#160;iMax_1)<br/>&#160; &#160;&#160;iCounter&#160;=&#160;iCounter&#160;+&#160;1<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sTempSep&#160;&amp;&#160;&#34;[&#34;&#160;&amp;&#160;iDim_1&#160;&amp;&#160;&#34;] &#34;&#160;_<br/>&#160; &#160; &#160; &#160; &#160;&#160;&amp;&#160;ObjToString(oInsObj(iDim_1),&#160;&#34;, &#34;)<br/>&#160; &#160;&#160;sTempSep&#160;=&#160;sSep<br/>&#160; &#160;&#160;iDim_1&#160;=&#160;iDim_1&#160;+&#160;1<br/>&#160;&#160;Loop<br/>&#160;&#160;ObjArray_1_ToString&#160;=&#160;s<br/>End&#160;Function<br/>
'*************************************************************************<br/>'** Convert a 2-D array of objects to a string.<br/>'**<br/>'** oInsObj &#160; &#160;- Object to Inspect<br/>'** iMaxDepth &#160;- Maximum number of array elements to show<br/>'** sSep &#160; &#160; &#160; - Separator character for arrays<br/>'*************************************************************************<br/>Function&#160;ObjArray_2_ToString(oInsObj,&#160;iMaxDepth%,&#160;sSep$)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;iDim_1%,&#160;iDim_2%<br/>&#160;&#160;Dim&#160;iMax_1%,&#160;iMax_2%<br/>&#160;&#160;Dim&#160;iCounter%<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;Dim&#160;sTempSep$<br/>&#160;&#160;<br/>&#160;&#160;sTempSep&#160;=&#160;&#34;&#34;<br/>&#160;&#160;iDim_1&#160;=&#160;LBound(oInsObj,&#160;1)<br/>&#160;&#160;iMax_1&#160;=&#160;UBound(oInsObj,&#160;1)<br/>&#160;&#160;iMax_2&#160;=&#160;UBound(oInsObj,&#160;2)<br/>&#160;&#160;Do&#160;While&#160;(iCounter&#160;&lt;&#160;iMaxDepth&#160;AND&#160;iDim_1&#160;&lt;=&#160;iMax_1)<br/>&#160; &#160;&#160;iCounter&#160;=&#160;iCounter&#160;+&#160;1<br/>&#160; &#160;&#160;iDim_2&#160;=&#160;LBound(oInsObj,&#160;2)<br/>&#160; &#160;&#160;Do&#160;While&#160;(iCounter&#160;&lt;&#160;iMaxDepth&#160;AND&#160;iDim_2&#160;&lt;=&#160;iMax_2)<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sTempSep&#160;&amp;&#160;&#34;[&#34;&#160;&amp;&#160;iDim_1&#160;&#160;&amp;&#160;&#34;, &#34;&#160;&amp;&#160;iDim_2&#160;&amp;&#160;&#34;] &#34;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;&amp;&#160;ObjToString(oInsObj(iDim_1,&#160;iDim_2),&#160;&#34;, &#34;)<br/>&#160; &#160; &#160;&#160;sTempSep&#160;=&#160;sSep<br/>&#160; &#160; &#160;&#160;iDim_2&#160;=&#160;iDim_2&#160;+&#160;1<br/>
648<br/>
<hr/>
<a name=652></a>&#160; &#160;&#160;Loop<br/>&#160; &#160;&#160;iDim_1&#160;=&#160;iDim_1&#160;+&#160;1<br/>&#160;&#160;Loop<br/>&#160;&#160;ObjArray_2_ToString&#160;=&#160;s<br/>End&#160;Function<br/>
'*************************************************************************<br/>'** Number of dimension for an array. a(4) returns 1 and a(3, 4) returns 2.<br/>'**<br/>'** oInsObj &#160; &#160;- Object to Inspect<br/>'*************************************************************************<br/>Function&#160;NumArrayDimensions(oInsObj)&#160;As&#160;Integer<br/>&#160;&#160;Dim&#160;i%&#160;&#160;:&#160;i&#160;=&#160;0<br/>&#160;&#160;If&#160;IsArray(oInsObj)&#160;Then<br/>&#160; &#160;&#160;On&#160;Local&#160;Error&#160;Goto&#160;DebugBoundsError:<br/>&#160; &#160;&#160;Do&#160;While&#160;(i%&#160;&gt;=&#160;0)<br/>&#160; &#160; &#160;&#160;LBound(oInsObj,&#160;i%&#160;+&#160;1)<br/>&#160; &#160; &#160;&#160;UBound(oInsObj,&#160;i%&#160;+&#160;1)<br/>&#160; &#160; &#160;&#160;i%&#160;=&#160;i%&#160;+&#160;1<br/>&#160; &#160;&#160;Loop<br/>&#160; &#160;&#160;DebugBoundsError:<br/>&#160; &#160;&#160;On&#160;Local&#160;Error&#160;Goto&#160;0<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;NumArrayDimensions&#160;=&#160;i<br/>End&#160;Function<br/>
The&#160;object&#160;implementation name&#160;is&#160;useful&#160;to have, and special&#160;care&#160;must&#160;be&#160;taken for objects&#160;that&#160;do not&#160;<br/>support&#160;the&#160;method.<br/>
<i><b>Listing&#160;547.</b>&#160;Get&#160;the&#160;object's&#160;implementation name&#160;(if&#160;it&#160;is&#160;an UNO&#160;Service).<br/></i>'*************************************************************************<br/>'** Get an objects implementation name if it exists.<br/>'**<br/>'** oInsObj &#160; &#160;- Object to Inspect<br/>'*************************************************************************<br/>Function&#160;GetImplementationName(oInsObj)&#160;As&#160;String<br/>&#160;&#160;On&#160;Local&#160;Error&#160;GoTo&#160;DebugNoSet<br/>&#160;&#160;Dim&#160;oTmpObj<br/>&#160;&#160;oTmpObj&#160;=&#160;oInsObj<br/>&#160;&#160;GetImplementationName&#160;=&#160;oTmpObj.getImplementationName()<br/>&#160;&#160;DebugNoSet:<br/>End&#160;Function&#160;<br/>
<i><b>Object&#160;inspection&#160;using&#160;Basic&#160;methods<br/></b></i>The&#160;ObjInfoString() method&#160;(shown in<a href="libremacros.html#652">&#160;Listing 548)</a>&#160;creates&#160;a&#160;string that&#160;describes&#160;an object.&#160;This&#160;string&#160;<br/>includes&#160;detailed&#160;information&#160;about&#160;the&#160;object&#160;type. If&#160;the&#160;object&#160;is&#160;an array,&#160;the&#160;array&#160;dimensions&#160;are&#160;listed.&#160;<br/>If&#160;possible, even the&#160;UNO&#160;implementation&#160;name&#160;is&#160;obtained. No other UNO-related&#160;information—such as&#160;<br/>supported&#160;properties&#160;or methods—is&#160;obtained.<br/>
<i><b>Listing&#160;548.</b>&#160;Get&#160;information about&#160;an object.</i><br/>
'*************************************************************************<br/>'** Return a string that contains useful information about an object.<br/>'** This includes detailed information about the object type. If the&#160;<br/>
649<br/>
<hr/>
<a name=653></a>'** object is an array, then the array dimensions are listed.<br/>'** If possible, even the UNO implementation name is obtained.<br/>'*************************************************************************<br/>Function&#160;ObjInfoString(oInsObj)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;<br/>&#160;&#160;REM We can always get the type name and variable type.<br/>&#160; s&#160;=&#160;&#34;TypeName = &#34;&#160;&amp;&#160;TypeName(oInsObj)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160;&#160;&#34;VarType = &#34;&#160;&amp;&#160;VarType(oInsObj)&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;<br/>&#160;&#160;REM Check for NULL and EMPTY<br/>&#160;&#160;If&#160;IsNull(oInsObj)&#160;Then<br/>&#160; &#160; s&#160;=&#160;s&#160;&amp;&#160;&#34;IsNull = True&#34;<br/>&#160;&#160;ElseIf&#160;IsEmpty(oInsObj)&#160;Then<br/>&#160; &#160; s&#160;=&#160;s&#160;&amp;&#160;&#34;IsEmpty = True&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;If&#160;IsObject(oInsObj)&#160;Then&#160;<br/>&#160; &#160; &#160; s&#160;=&#160;s&#160;&amp;&#160;&#34;Implementation Name = &#34;&#160;&amp;&#160;GetImplementationName(oInsObj)<br/>&#160; &#160; &#160; s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;IsObject = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;If&#160;IsUnoStruct(oInsObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsUnoStruct = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsDate(oInsObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsDate = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsNumeric(oInsObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsNumeric = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsArray(oInsObj)&#160;Then<br/>&#160; &#160; &#160;&#160;On&#160;Local&#160;Error&#160;Goto&#160;DebugBoundsError:<br/>&#160; &#160; &#160;&#160;Dim&#160;i%,&#160;sTemp$<br/>&#160; &#160; &#160; s&#160;=&#160;s&#160;&amp;&#160;&#34;IsArray = True&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;range = (&#34;<br/>&#160; &#160; &#160;&#160;Do&#160;While&#160;(i%&#160;&gt;=&#160;0)<br/>&#160; &#160; &#160; &#160; i%&#160;=&#160;i%&#160;+&#160;1<br/>&#160; &#160; &#160; &#160; sTemp$&#160;=&#160;LBound(oInsObj,&#160;i%)&#160;&amp;&#160;&#34; To &#34;&#160;&amp;&#160;UBound(oInsObj,&#160;i%)<br/>&#160; &#160; &#160; &#160;&#160;If&#160;i%&#160;&gt;&#160;1&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;, &#34;<br/>&#160; &#160; &#160; &#160; s&#160;=&#160;s&#160;&amp;&#160;sTemp$<br/>&#160; &#160; &#160;&#160;Loop<br/>&#160; &#160; &#160; DebugBoundsError:<br/>&#160; &#160; &#160;&#160;On&#160;Local&#160;Error&#160;Goto&#160;0<br/>&#160; &#160; &#160; s&#160;=&#160;s&#160;&amp;&#160;&#34;)&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;End&#160;If<br/>
&#160; s&#160;=&#160;s&#160;&amp;&#160;&#34;Value : &#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;ObjToString(oInsObj)&#160;&amp;&#160;CHR$(10)<br/>&#160; ObjInfoString&#160;=&#160;s<br/>End&#160;Function&#160;<br/>
<i><b>Sort&#160;an&#160;array<br/></b></i>Many&#160;objects&#160;contain so many&#160;properties&#160;and implement&#160;so many&#160;methods, that&#160;when they&#160;are&#160;displayed in&#160;<br/>the&#160;text&#160;box,&#160;it&#160;is&#160;difficult&#160;to&#160;find a&#160;specific&#160;entry.&#160;Sorting the&#160;output&#160;makes&#160;it&#160;easier to&#160;find individual&#160;<br/>entries.<br/>
Assume&#160;that&#160;I&#160;have&#160;two arrays.&#160;The&#160;first&#160;array&#160;contains&#160;a&#160;list&#160;of names&#160;and the&#160;second array&#160;contains&#160;a&#160;list&#160;of&#160;<br/>ages.&#160;The&#160;third item&#160;in&#160;the&#160;age&#160;array&#160;contains&#160;the&#160;age&#160;of the&#160;third item&#160;in&#160;the&#160;name&#160;array.&#160;In&#160;computer&#160;<br/>science, these&#160;are&#160;referred to&#160;as&#160;“parallel&#160;arrays.”&#160;Parallel&#160;arrays&#160;are&#160;used in the&#160;object&#160;browser.&#160;When&#160;<br/>
650<br/>
<hr/>
<a name=654></a>dealing&#160;with&#160;properties, the&#160;property&#160;type&#160;is&#160;stored in&#160;the&#160;first&#160;array,&#160;and the&#160;property&#160;name&#160;is&#160;stored in&#160;the&#160;<br/>second array.&#160;The&#160;same&#160;thing is&#160;done&#160;while&#160;dealing with&#160;the&#160;supported&#160;methods.<br/>
While&#160;creating the&#160;data&#160;for inspection,&#160;parallel&#160;arrays&#160;are&#160;created and maintained.&#160;I&#160;want&#160;to sort&#160;the&#160;<br/>information, but&#160;I&#160;can’t&#160;sort&#160;one&#160;array&#160;unless&#160;I&#160;sort&#160;all&#160;of the&#160;arrays.&#160;A&#160;typical&#160;solution&#160;to&#160;this&#160;problem&#160;is&#160;to&#160;<br/>create&#160;an index&#160;array&#160;that&#160;contains&#160;integers, which are&#160;used to&#160;index&#160;into the&#160;array.&#160;The&#160;index&#160;array&#160;is&#160;sorted&#160;<br/>rather than&#160;the&#160;actual&#160;data.&#160;For&#160;example, sort&#160;the&#160;array&#160;oItems()=(&#34;B&#34;, &#34;C&#34;, &#34;A&#34;).&#160;The&#160;sorted&#160;index&#160;array&#160;is&#160;<br/>(2, 0, 1), implying that&#160;oItems(2) is&#160;the&#160;first&#160;item, oItems(0) is&#160;the&#160;second item, and oItems(1) is&#160;the&#160;last&#160;<br/>item.&#160;The&#160;function&#160;SortMyArray()&#160;in<a href="libremacros.html#654">&#160;Listing 549&#160;s</a>orts&#160;an array&#160;by&#160;using an index&#160;array.<br/>
<i><b>Listing&#160;549.</b>&#160;Indirectly&#160;Sort&#160;an array&#160;by&#160;moving&#160;indexes.<br/></i>'*************************************************************************<br/>'** Sort the oItems() array by arranging the iIdx() array.<br/>'** If oItems() = (&#34;B&#34;, &#34;C&#34;, &#34;A&#34;) Then on output, iIdx() = (2, 0, 1)<br/>'** This means that the item that should come first is oItems(2), second<br/>'** is oItems(0), and finally, oItems(1)<br/>'*************************************************************************<br/>Sub&#160;SortMyArray(oItems(),&#160;iIdx()&#160;As&#160;Integer)<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160;&#160;'Outer index variable<br/>&#160;&#160;Dim&#160;j&#160;As&#160;Integer&#160; &#160; &#160; &#160;&#160;'Inner index variable<br/>&#160;&#160;Dim&#160;temp&#160;As&#160;Integer&#160; &#160; &#160;'Temporary variable to swap two values.<br/>&#160;&#160;Dim&#160;bChanged&#160;As&#160;Boolean&#160;'Becomes True when something changes<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(oItems())&#160;To&#160;UBound(oItems())&#160;-&#160;1<br/>&#160; &#160;&#160;bChanged&#160;=&#160;False<br/>&#160; &#160;&#160;For&#160;j&#160;=&#160;UBound(oItems())&#160;To&#160;i+1&#160;Step&#160;-1<br/>&#160; &#160; &#160;&#160;If&#160;oItems(iIdx(j))&#160;&lt;&#160;oItems(iIdx(j-1))&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;temp&#160;=&#160;iIdx(j)<br/>&#160; &#160; &#160; &#160;&#160;iIdx(j)&#160;=&#160;iIdx(j-1)<br/>&#160; &#160; &#160; &#160;&#160;iIdx(j-1)&#160;=&#160;temp<br/>&#160; &#160; &#160; &#160;&#160;bChanged&#160;=&#160;True<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Next<br/>&#160; &#160;&#160;If&#160;Not&#160;bChanged&#160;Then&#160;Exit&#160;For<br/>&#160;&#160;Next<br/>End&#160;Sub<br/>
<b>&#160;18.5.2.&#160;Creating&#160;a&#160;dialog&#160;at&#160;run&#160;time<br/></b>The&#160;Object&#160;Inspector uses&#160;Private&#160;variables&#160;for the&#160;dialog and frequently&#160;referenced objects.&#160;The&#160;dialog&#160;<br/>contains&#160;a&#160;progress&#160;bar that&#160;is&#160;updated&#160;while&#160;information is&#160;retrieved&#160;to fill&#160;the&#160;text&#160;control.&#160;The&#160;inspected&#160;<br/>object&#160;is&#160;also stored as&#160;a&#160;global&#160;variable&#160;because&#160;it&#160;is&#160;used in event&#160;handlers&#160;that&#160;have&#160;no other way&#160;to&#160;obtain&#160;<br/>the&#160;object.&#160;See<a href="libremacros.html#654">&#160;Listing 550.</a><br/>
<i><b>Listing&#160;550.&#160;</b>Global&#160;variables&#160;defined&#160;in the&#160;Inspector&#160;module.</i><br/>
Private&#160;oDlg&#160; &#160; &#160; &#160; &#160; 'Displayed dialog<br/>Private&#160;oProgress&#160; &#160; &#160;'Progress control model<br/>Private&#160;oTextEdit&#160; &#160; &#160;'Text edit control model that displays information<br/>Private&#160;oObjects(100)&#160;'Objects to inspect<br/>Private&#160;Titles(100)&#160; &#160;'Titles<br/>Private&#160;iDepth%&#160; &#160; &#160; &#160;'Which object / title to use<br/>
Unfortunately,&#160;dialogs&#160;created in&#160;the&#160;IDE&#160;can only&#160;be&#160;created&#160;and run from&#160;within&#160;Basic. It&#160;is&#160;possible,&#160;<br/>however,&#160;to create&#160;and use&#160;a&#160;dialog at&#160;run time&#160;in&#160;any&#160;programming&#160;language&#160;that&#160;can use&#160;the&#160;OOo UNO&#160;<br/>API.&#160;The&#160;dialog functionality&#160;is&#160;scheduled&#160;to be&#160;improved in OOo 2.0 so that&#160;you&#160;can design dialogs&#160;in an&#160;<br/>
651<br/>
<hr/>
<a name=655></a>IDE&#160;and display&#160;them&#160;using languages&#160;other than&#160;Basic.&#160;The&#160;Inspect() method&#160;i<a href="libremacros.html#655">n&#160;Listing&#160;551&#160;c</a>reates&#160;a&#160;dialog&#160;<br/>and all&#160;of its&#160;contained&#160;controls&#160;without&#160;using the&#160;IDE. Follow&#160;these&#160;steps&#160;to&#160;create&#160;and display&#160;the&#160;dialog:<br/>
1.&#160;Use CreateUnoService(&#34;com.sun.star.awt.UnoControlDialogModel&#34;) to create a dialog model and then <br/>
set the model’s properties.<br/>
2.&#160;Use the createInstance(name) method in the dialog model to create a model for each control that is <br/>
inserted into the dialog model. Set the properties on the control’s model and then use the <br/>
insertByName(name, oModel) method—defined by the dialog model—to insert the control’s model into<br/>
the dialog’s model. This step is important! To insert a control into a dialog, you must use the dialog <br/>
model to create a control model, which is then inserted into the dialog model. You don’t create or <br/>
manipulate controls, only models.<br/>
3.&#160;Use CreateUnoService(&#34;com.sun.star.awt.UnoControlDialog&#34;) to create a dialog.<br/>4.&#160;Use the setModel() method on the dialog to set the dialog’s model.<br/>5.&#160;Use CreateUnoListener(name) to create any desired listeners. Add the listener to the correct object; the <br/>
correct object is usually a control.<br/>
6.&#160;Use CreateUnoService(&#34;com.sun.star.awt.Toolkit&#34;) to create a window toolkit object.<br/>7.&#160;Use the createPeer(oWindow, null) method on the dialog to tell the dialog to create an appropriate <br/>
window to use.<br/>
8.&#160;Execute the dialog.<br/>
<i><b>Listing&#160;551.&#160;</b>Create&#160;the&#160;dialog,&#160;the&#160;controls, and the&#160;listeners.<br/></i>Sub&#160;Inspect(Optional&#160;oInsObj, Optional&#160;title$)<br/>&#160; Dim&#160;oDlgModel&#160; &#160; &#160; &#160; &#160; &#160;&#160;'The dialog's model<br/>&#160; Dim&#160;oModel&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Model for a control<br/>&#160; Dim&#160;oListener&#160; &#160; &#160; &#160; &#160; &#160;&#160;'A created listener object<br/>&#160; Dim&#160;oControl&#160; &#160; &#160; &#160; &#160; &#160; &#160;'References a control<br/>&#160; Dim&#160;iTabIndex&#160;As Integer&#160;'The current tab index while creating controls<br/>&#160; Dim&#160;iDlgHeight&#160;As Long &#160;&#160;'The dialog's height<br/>&#160; Dim&#160;iDlgWidth&#160;As Long &#160; &#160;'The dialog's width<br/>&#160; Dim&#160;sTitle$<br/>&#160;&#160;<br/>&#160;&#160;iDepth&#160;= LBound(oObjects)<br/>&#160;&#160;sTitle&#160;=&#160;&#34;&#34;<br/>&#160; If Not IsMissing(title) Then&#160;sTitle&#160;=&#160;title<br/>&#160;&#160;<br/>&#160;&#160;REM If no object is passed in, then use ThisComponent.<br/>&#160; If IsMissing(oInsObj) Then<br/>&#160; &#160;&#160;oObjects(iDepth) = ThisComponent<br/>&#160; &#160; If IsMissing(title) Then&#160;sTitle&#160;=&#160;&#34;ThisComponent&#34;<br/>&#160; Else<br/>&#160; &#160;&#160;oObjects(iDepth) =&#160;oInsObj<br/>&#160; &#160; If IsMissing(title) Then&#160;sTitle&#160;=&#160;&#34;Obj&#34;<br/>&#160; End If<br/>&#160;&#160;Titles(iDepth) =&#160;sTitle<br/>
&#160;&#160;iDlgHeight&#160;=&#160;300<br/>&#160;&#160;iDlgWidth&#160; =&#160;350<br/>
652<br/>
<hr/>
<a name=656></a>&#160;&#160;<br/>&#160;&#160;REM Create the dialog's model<br/>&#160;&#160;oDlgModel&#160;= CreateUnoService(&#34;com.sun.star.awt.UnoControlDialogModel&#34;)<br/>&#160;&#160;setProperties(oDlgModel, Array(&#34;PositionX&#34;,&#160;50,&#160;&#34;PositionY&#34;,&#160;50,_<br/>&#160; &#160; &#160;&#34;Width&#34;,&#160;iDlgWidth,&#160;&#34;Height&#34;,&#160;iDlgHeight,&#160;&#34;Title&#34;,&#160;sTitle))<br/>
&#160;&#160;createInsertControl(oDlgModel,&#160;iTabIndex,&#160;&#34;PropButton&#34;,_<br/>&#160; &#160; &#160;&#34;com.sun.star.awt.UnoControlRadioButtonModel&#34;,_<br/>&#160; &#160; &#160;Array(&#34;PositionX&#34;,&#160;10,&#160;&#34;PositionY&#34;,&#160;10,&#160;&#34;Width&#34;,&#160;50,&#160;&#34;Height&#34;,&#160;15,_<br/>&#160; &#160; &#160; &#160;&#34;Label&#34;,&#160;&#34;Properties&#34;))<br/>
&#160;&#160;createInsertControl(oDlgModel,&#160;iTabIndex,&#160;&#34;MethodButton&#34;,_<br/>&#160; &#160; &#160;&#34;com.sun.star.awt.UnoControlRadioButtonModel&#34;,_<br/>&#160; &#160; &#160;Array(&#34;PositionX&#34;,&#160;65,&#160;&#34;PositionY&#34;,&#160;10,&#160;&#34;Width&#34;,&#160;50,&#160;&#34;Height&#34;,&#160;15,_<br/>&#160; &#160; &#160; &#160;&#34;Label&#34;,&#160;&#34;Methods&#34;))<br/>
&#160;&#160;createInsertControl(oDlgModel,&#160;iTabIndex,&#160;&#34;ServiceButton&#34;,_<br/>&#160; &#160; &#160;&#34;com.sun.star.awt.UnoControlRadioButtonModel&#34;,_<br/>&#160; &#160; &#160;Array(&#34;PositionX&#34;,&#160;120,&#160;&#34;PositionY&#34;,&#160;10,&#160;&#34;Width&#34;,&#160;50,&#160;&#34;Height&#34;,&#160;15,_<br/>&#160; &#160; &#160; &#160;&#34;Label&#34;,&#160;&#34;Services&#34;))<br/>
&#160;&#160;createInsertControl(oDlgModel,&#160;iTabIndex,&#160;&#34;ObjectButton&#34;,_<br/>&#160; &#160; &#160;&#34;com.sun.star.awt.UnoControlRadioButtonModel&#34;,_<br/>&#160; &#160; &#160;Array(&#34;PositionX&#34;,&#160;175,&#160;&#34;PositionY&#34;,&#160;10,&#160;&#34;Width&#34;,&#160;50,&#160;&#34;Height&#34;,&#160;15,_<br/>&#160; &#160; &#160; &#160;&#34;Label&#34;,&#160;&#34;Object&#34;))<br/>
&#160;&#160;createInsertControl(oDlgModel,&#160;iTabIndex,&#160;&#34;EditControl&#34;,_<br/>&#160; &#160; &#160;&#34;com.sun.star.awt.UnoControlEditModel&#34;,_<br/>&#160; &#160; &#160;Array(&#34;PositionX&#34;,&#160;10,&#160;&#34;PositionY&#34;,&#160;25,&#160;&#34;Width&#34;,&#160;iDlgWidth&#160;-&#160;20,_<br/>&#160; &#160; &#160; &#160;&#34;Height&#34;, (iDlgHeight&#160;-&#160;75),&#160;&#34;HScroll&#34;,&#160;True,&#160;&#34;VScroll&#34;,&#160;True,_<br/>&#160; &#160; &#160; &#160;&#34;MultiLine&#34;,&#160;True,&#160;&#34;HardLineBreaks&#34;,&#160;True))<br/>&#160; &#160; &#160; &#160;<br/>&#160;&#160;REM Store the edit control's model in a global variable.<br/>&#160;&#160;oTextEdit&#160;=&#160;oDlgModel.getByName(&#34;EditControl&#34;)<br/>
&#160;&#160;createInsertControl(oDlgModel,&#160;iTabIndex,&#160;&#34;Progress&#34;,_<br/>&#160; &#160; &#160;&#34;com.sun.star.awt.UnoControlProgressBarModel&#34;,_<br/>&#160; &#160; &#160;Array(&#34;PositionX&#34;,&#160;10,&#160;&#34;PositionY&#34;, (iDlgHeight&#160;-&#160;45),_<br/>&#160; &#160; &#160; &#160;&#34;Width&#34;,&#160;iDlgWidth&#160;-&#160;20,&#160;&#34;Height&#34;,&#160;15,&#160;&#34;ProgressValueMin&#34;,&#160;0,_<br/>&#160; &#160; &#160; &#160;&#34;ProgressValueMax&#34;,&#160;100))<br/>
&#160;&#160;REM Store a reference to the progress bar<br/>&#160;&#160;oProgress&#160;=&#160;oDlgModel.getByName(&#34;Progress&#34;)<br/>
&#160;&#160;REM Notice that I set the type to OK so I do not require an action<br/>&#160;&#160;REM listener to close the dialog.<br/>&#160;&#160;createInsertControl(oDlgModel,&#160;iTabIndex,&#160;&#34;OKButton&#34;,_<br/>&#160; &#160; &#160;&#34;com.sun.star.awt.UnoControlButtonModel&#34;,_<br/>&#160; &#160; &#160;Array(&#34;PositionX&#34;, Clng(25),&#160;&#34;PositionY&#34;,&#160;iDlgHeight-20,_<br/>&#160; &#160; &#160; &#160;&#34;Width&#34;,&#160;50,&#160;&#34;Height&#34;,&#160;15,&#160;&#34;Label&#34;,&#160;&#34;Close&#34;,_<br/>&#160; &#160; &#160; &#160;&#34;PushButtonType&#34;,&#160;com.sun.star.awt.PushButtonType.OK))<br/>
&#160;&#160;createInsertControl(oDlgModel,&#160;iTabIndex,&#160;&#34;InspectButton&#34;,_<br/>
653<br/>
<hr/>
<a name=657></a>&#160; &#160; &#160;&#34;com.sun.star.awt.UnoControlButtonModel&#34;,_<br/>&#160; &#160; &#160;Array(&#34;PositionX&#34;, Clng(iDlgWidth&#160;/&#160;2&#160;-&#160;50),&#160;&#34;PositionY&#34;,&#160;iDlgHeight-20,_<br/>&#160; &#160; &#160; &#160;&#34;Width&#34;,&#160;50,&#160;&#34;Height&#34;,&#160;15,&#160;&#34;Label&#34;,&#160;&#34;Inspect Selected&#34;,_<br/>&#160; &#160; &#160; &#160;&#34;PushButtonType&#34;,&#160;com.sun.star.awt.PushButtonType.STANDARD))<br/>
&#160;&#160;createInsertControl(oDlgModel,&#160;iTabIndex,&#160;&#34;BackButton&#34;,_<br/>&#160; &#160; &#160;&#34;com.sun.star.awt.UnoControlButtonModel&#34;,_<br/>&#160; &#160; &#160;Array(&#34;PositionX&#34;, Clng(iDlgWidth&#160;/&#160;2&#160;+&#160;50),&#160;&#34;PositionY&#34;,&#160;iDlgHeight-20,_<br/>&#160; &#160; &#160; &#160;&#34;Width&#34;,&#160;50,&#160;&#34;Height&#34;,&#160;15,&#160;&#34;Label&#34;,&#160;&#34;Inspect Previous&#34;,_<br/>&#160; &#160; &#160; &#160;&#34;Enabled&#34;,&#160;False, _<br/>&#160; &#160; &#160; &#160;&#34;PushButtonType&#34;,&#160;com.sun.star.awt.PushButtonType.STANDARD))<br/>
&#160;&#160;REM Create the dialog and set the model<br/>&#160;&#160;oDlg&#160;= CreateUnoService(&#34;com.sun.star.awt.UnoControlDialog&#34;)<br/>&#160;&#160;oDlg.setModel(oDlgModel)<br/>&#160;&#160;<br/>&#160;&#160;REM the item listener for all of the radio buttons.<br/>&#160;&#160;oListener&#160;= CreateUnoListener(&#34;radio_&#34;,&#160;&#34;com.sun.star.awt.XItemListener&#34;)<br/>&#160;&#160;oControl&#160;=&#160;oDlg.getControl(&#34;PropButton&#34;)<br/>&#160;&#160;ocontrol.addItemListener(oListener)<br/>&#160;&#160;oControl&#160;=&#160;oDlg.getControl(&#34;MethodButton&#34;)<br/>&#160;&#160;ocontrol.addItemListener(oListener)<br/>&#160;&#160;oControl&#160;=&#160;oDlg.getControl(&#34;ServiceButton&#34;)<br/>&#160;&#160;ocontrol.addItemListener(oListener)<br/>&#160;&#160;oControl&#160;=&#160;oDlg.getControl(&#34;ObjectButton&#34;)<br/>&#160;&#160;ocontrol.addItemListener(oListener)<br/>&#160;&#160;oControl.getModel().State&#160;=&#160;1<br/>&#160;&#160;<br/>&#160;&#160;oListener&#160;= CreateUnoListener(&#34;ins_&#34;,&#160;&#34;com.sun.star.awt.XActionListener&#34;)<br/>&#160;&#160;oControl&#160;=&#160;oDlg.getControl(&#34;InspectButton&#34;)<br/>&#160;&#160;ocontrol.addActionListener(oListener)<br/>&#160;&#160;<br/>&#160;&#160;oListener&#160;= CreateUnoListener(&#34;back_&#34;,&#160;&#34;com.sun.star.awt.XActionListener&#34;)<br/>&#160;&#160;oControl&#160;=&#160;oDlg.getControl(&#34;BackButton&#34;)<br/>&#160;&#160;ocontrol.addActionListener(oListener)<br/>&#160;&#160;<br/>&#160;&#160;REM Now, set the dialog to contain the standard dialog information<br/>&#160;&#160;DisplayNewObject()<br/>&#160;&#160;<br/>&#160;&#160;REM Create a window and then tell the dialog to use the created window.<br/>&#160; Dim&#160;oWindow<br/>&#160;&#160;oWindow&#160;= CreateUnoService(&#34;com.sun.star.awt.Toolkit&#34;)<br/>&#160;&#160;oDlg.createPeer(oWindow,&#160;null)<br/>&#160;&#160;<br/>&#160;&#160;REM Finally, execute the dialog.<br/>&#160;&#160;oDlg.execute()<br/>End&#160;Sub<br/>
To&#160;shorten the&#160;code&#160;in<a href="libremacros.html#655">&#160;Listing 551, t</a>ry&#160;using two utility&#160;methods&#160;to set&#160;properties, create&#160;a&#160;control&#160;model,&#160;<br/>and insert&#160;the&#160;control&#160;model&#160;into the&#160;dialog&#160;model. Notice&#160;that&#160;the&#160;control&#160;itself&#160;is&#160;never created—only&#160;the&#160;<br/>model&#160;is&#160;created.<a href="libremacros.html#658">&#160;Listing 552&#160;c</a>ontains&#160;the&#160;methods&#160;to create&#160;the&#160;control&#160;models&#160;and to&#160;set&#160;the&#160;properties.&#160;<br/>
654<br/>
<hr/>
<a name=658></a>Although properties&#160;are&#160;set&#160;using the&#160;setPropertyValue&#160;method,&#160;in&#160;Basic&#160;you can set&#160;the&#160;properties&#160;directly&#160;if&#160;<br/>desired.&#160;<br/>
<i><b>Listing&#160;552.&#160;</b>Create&#160;a control&#160;model&#160;and insert&#160;it&#160;into the&#160;dialog’s&#160;model.<br/></i>'*************************************************************************<br/>'** Create a control of type sType with name sName, and insert it into<br/>'** oDlgModel.<br/>'**&#160;<br/>'** oDlgModel - Dialog model into which the control will be placed.<br/>'** index &#160; &#160; - Tab index, which is incremented each time.<br/>'** sName &#160; &#160; - Control name.<br/>'** sType &#160; &#160; - Full service name for the control model.<br/>'** props &#160; &#160; - Arry of property name / property value pairs.<br/>'*************************************************************************<br/>Sub&#160;createInsertControl(oDlgModel,&#160;index%,&#160;sName$,&#160;sType$,&#160;props())<br/>&#160;&#160;Dim&#160;oModel<br/>&#160;&#160;<br/>&#160;&#160;oModel&#160;=&#160;oDlgModel.createInstance(sType$)<br/>&#160;&#160;setProperties(oModel,&#160;props())<br/>&#160;&#160;setProperties(oModel,&#160;Array(&#34;Name&#34;,&#160;sName$,&#160;&#34;TabIndex&#34;,&#160;index%))<br/>&#160;&#160;oDlgModel.insertByName(sName$,&#160;oModel)<br/>&#160;&#160;<br/>&#160;&#160;REM This changes the value because it is not passed by value.<br/>&#160;&#160;index%&#160;=&#160;index%&#160;+&#160;1<br/>End&#160;Sub<br/>
The&#160;following&#160;macro is&#160;used to&#160;set&#160;many&#160;properties&#160;based on a&#160;single&#160;call.<br/>
<i><b>Listing&#160;553.</b>&#160;Set&#160;many&#160;properties&#160;at&#160;one&#160;time.<br/></i>REM Generically set properties based on an array of name/value pairs.<br/>Sub&#160;setProperties(oModel,&#160;props())<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer<br/>&#160;&#160;For&#160;i=LBound(props())&#160;To&#160;UBound(props())&#160;Step&#160;2<br/>&#160; &#160;&#160;oModel.setPropertyValue(props(i),&#160;props(i+1))<br/>&#160;&#160;Next<br/>End&#160;sub<br/>
<b>&#160;18.5.3.&#160;Listeners</b><br/>
<i><b>Radio&#160;buttons<br/></b></i>Each time&#160;a&#160;new&#160;radio button is&#160;selected, the&#160;method radio_itemStateChanged() is&#160;called (the&#160;listener is&#160;set&#160;<br/>up i<a href="libremacros.html#655">n&#160;Listing&#160;551).&#160;</a>The&#160;event&#160;handler calls&#160;the&#160;DisplayNewObject() subroutine, which handles&#160;the&#160;actual&#160;<br/>work when a&#160;new&#160;property&#160;type&#160;is&#160;requested.&#160;See<a href="libremacros.html#658"><b>&#160;</b>Listing&#160;554. I</a>&#160;wrote&#160;a&#160;separate&#160;routine&#160;so that&#160;it&#160;can be&#160;<br/>used apart&#160;from&#160;the&#160;event&#160;handler.&#160;For example,&#160;it&#160;calls&#160;DisplayNewObject() before&#160;the&#160;dialog is&#160;displayed&#160;<br/>so that&#160;the&#160;dialog contains&#160;useful&#160;information&#160;when it&#160;first&#160;appears.<br/>
<i><b>Listing&#160;554.&#160;</b>The&#160;event&#160;handler&#160;is&#160;very&#160;simple; it&#160;calls&#160;DisplayNewObject().<br/></i>REM This method is to support the com.sun.star.awt.XItemListener interface<br/>REM for the radio button listener. This method is called when a radio button<br/>REM is selected.<br/>Sub&#160;radio_itemStateChanged(oItemEvent)<br/>&#160;&#160;DisplayNewObject()<br/>End&#160;Sub<br/>
655<br/>
<hr/>
<a name=659></a>Sub&#160;DisplayNewObject()<br/>&#160;&#160;REM Reset the progress bar!<br/>&#160;&#160;oProgress.ProgressValue&#160;=&#160;0<br/>&#160;&#160;oTextEdit.Text&#160;=&#160;&#34;&#34;<br/>
&#160;&#160;On&#160;Local&#160;Error&#160;GoTo&#160;IgnoreError:<br/>&#160;&#160;If&#160;IsNull(oObjects(iDepth))&#160;OR&#160;IsEmpty(oObjects(iDepth))&#160;Then<br/>&#160; &#160;&#160;oTextEdit.Text&#160;=&#160;ObjInfoString(oObjects(iDepth))<br/>&#160;&#160;ElseIf&#160;oDlg.getModel().getByName(&#34;PropButton&#34;).State&#160;=&#160;1&#160;Then<br/>&#160; &#160;&#160;processStateChange(oObjects(iDepth),&#160;&#34;p&#34;)<br/>&#160;&#160;ElseIf&#160;oDlg.getModel().getByName(&#34;MethodButton&#34;).State&#160;=&#160;1&#160;Then<br/>&#160; &#160;&#160;processStateChange(oObjects(iDepth),&#160;&#34;m&#34;)<br/>&#160;&#160;ElseIf&#160;oDlg.getModel().getByName(&#34;ServiceButton&#34;).State&#160;=&#160;1&#160;Then<br/>&#160; &#160;&#160;processStateChange(oObjects(iDepth),&#160;&#34;s&#34;)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oTextEdit.Text&#160;=&#160;ObjInfoString(oObjects(iDepth))<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;oProgress.ProgressValue&#160;=&#160;100<br/>
&#160;&#160;IgnoreError:<br/>End&#160;Sub&#160;<br/>
<i><b>Inspect&#160;selected<br/></b></i>The&#160;handler for the&#160;Inspect&#160;Selected button looks&#160;at&#160;the&#160;text&#160;that&#160;is&#160;selected and then based on the&#160;selected&#160;<br/>text,&#160;attempts&#160;to inspect&#160;a&#160;new&#160;object.&#160;I&#160;considered making the&#160;processing more&#160;user friendly,&#160;but&#160;it&#160;meets&#160;<br/>my&#160;needs. If&#160;you&#160;select&#160;text,&#160;a&#160;property&#160;with the&#160;selected name&#160;is&#160;inspected. If&#160;you&#160;select&#160;a&#160;number,&#160;the&#160;<br/>current&#160;object&#160;is&#160;assumed to&#160;be&#160;an array,&#160;and the&#160;object&#160;at&#160;the&#160;specified index&#160;is&#160;inspected.<br/>
<i><b>Listing&#160;555.</b>&#160;Inspect&#160;a new&#160;item.</i><br/>
Sub&#160;Ins_actionPerformed(oActionEvent)<br/>&#160;&#160;Dim&#160;oControl<br/>&#160;&#160;Dim&#160;oSel<br/>&#160;&#160;Dim&#160;sText$<br/>&#160;&#160;Dim&#160;v<br/>&#160;&#160;Dim&#160;oOldObj<br/>&#160;&#160;Dim&#160;sOldTitle$<br/>&#160;&#160;Dim&#160;sNewTitle$<br/>&#160;&#160;<br/>&#160;&#160;If&#160;iDepth&#160;=&#160;UBound(oObjects)&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;Sorry, already nested too deeply&#34;<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;oControl&#160;=&#160;oDlg.getControl(&#34;EditControl&#34;)<br/>&#160;&#160;sText&#160;=&#160;oControl.getSelectedText()<br/>&#160;&#160;sOldTitle&#160;=&#160;oDlg.Title<br/>&#160;&#160;sNewTitle&#160;=&#160;sOldTitle&#160;&amp;&#160;&#34;/&#34;&#160;&amp;&#160;sText<br/>&#160;&#160;<br/>&#160;&#160;If&#160;IsNumeric(sText)&#160;Then<br/>&#160; &#160;&#160;' oDlg.getModel().getByName(&#34;ObjButton&#34;).State = 1<br/>&#160; &#160;&#160;If&#160;NumArrayDimensions(oObjects(iDepth))&#160;&lt;&gt;&#160;1&#160;Then<br/>
656<br/>
<hr/>
<a name=660></a>&#160; &#160; &#160;&#160;Print&#160;&#34;You can only select a number with a one dimensional array.&#34;<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;oOldObj&#160;=&#160;oObjects(iDepth)<br/>&#160; &#160; &#160;&#160;iDepth&#160;=&#160;iDepth&#160;+&#160;1<br/>&#160; &#160; &#160;&#160;oDlg.getControl(&#34;BackButton&#34;).GetModel().Enabled&#160;=&#160;True<br/>&#160; &#160; &#160;&#160;oObjects(iDepth)&#160;=&#160;oOldObj(sText)<br/>&#160; &#160; &#160;&#160;oDlg.Title&#160;=&#160;sNewTitle<br/>&#160; &#160; &#160;&#160;Titles(iDepth)&#160;=&#160;sNewTitle<br/>&#160; &#160; &#160;&#160;DisplayNewObject()<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;v&#160;=&#160;&#160;RunFromLib(GlobalScope.BasicLibraries,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;xyzzylib&#34;,&#160;&#34;TestMod&#34;,&#160;oObjects(iDepth),&#160;sText,&#160;False,&#160;False)<br/>&#160; &#160;&#160;If&#160;IsNull(v)&#160;OR&#160;IsEmpty(v)&#160;Then<br/>&#160; &#160; &#160;&#160;'<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;iDepth&#160;=&#160;iDepth&#160;+&#160;1<br/>&#160; &#160; &#160;&#160;oDlg.getControl(&#34;BackButton&#34;).GetModel().Enabled&#160;=&#160;True<br/>&#160; &#160; &#160;&#160;oObjects(iDepth)&#160;=&#160;v<br/>&#160; &#160; &#160;&#160;oDlg.Title&#160;=&#160;sNewTitle<br/>&#160; &#160; &#160;&#160;Titles(iDepth)&#160;=&#160;sNewTitle<br/>&#160; &#160; &#160;&#160;DisplayNewObject()<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;'oSel = oControl.getSelection ()<br/>&#160;&#160;'Print &#34;Min: &#34; &amp; oSel.Min &amp; &#34; Max: &#34; &amp; oSel.Max<br/>&#160;&#160;'sText = oControl.getText()<br/>&#160;&#160;'Inspect oControl<br/>End&#160;Sub<br/>
<i><b>Inspect&#160;previous<br/></b></i>A&#160;stack of inspected objects&#160;is&#160;maintained.&#160;The&#160;“previous&#160;item”&#160;means&#160;the&#160;last&#160;item&#160;on the&#160;stack.<br/>
<i><b>Listing&#160;556.</b>&#160;Inspect&#160;a previous&#160;item.<br/></i>Sub&#160;back_actionPerformed(oActionEvent)<br/>&#160;&#160;If&#160;iDepth&#160;&lt;=&#160;LBound(oObjects)&#160;Then<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;iDepth&#160;=&#160;iDepth&#160;-&#160;1<br/>&#160;&#160;If&#160;iDepth&#160;=&#160;LBound(oObjects)&#160;Then<br/>&#160; &#160; &#160;oDlg.getControl(&#34;BackButton&#34;).GetModel().Enabled&#160;=&#160;False<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;oDlg.Title&#160;=&#160;Titles(iDepth)<br/>&#160;&#160;DisplayNewObject()<br/>End&#160;Sub<br/>
<b>&#160;18.5.4.&#160;Obtaining&#160;the&#160;debug&#160;information<br/></b>In<a href="libremacros.html#658">&#160;Listing 554, not</a>ice&#160;that&#160;if the&#160;properties, methods,&#160;or services&#160;are&#160;requested, then&#160;the&#160;<br/>processStateChange() subroutine&#160;(see<a href="libremacros.html#661">&#160;Listing 557)</a>&#160;is&#160;called. If&#160;properties, methods,&#160;or services&#160;are&#160;not&#160;<br/>requested, simple&#160;object&#160;information&#160;is&#160;added to the&#160;text&#160;control.<br/>
657<br/>
<hr/>
<a name=661></a>Again, the&#160;processStateChange() subroutine&#160;contains&#160;very&#160;little&#160;logic.&#160;The&#160;primary&#160;purpose<a href="libremacros.html#661">&#160;of&#160;Listing 557&#160;i</a>s&#160;<br/>to add the&#160;supported services&#160;to the&#160;end of the&#160;text&#160;control&#160;after the&#160;interfaces&#160;are&#160;obtained from&#160;the&#160;<br/>dbg_SupportedInterfaces&#160;property.<br/>
<i><b>Listing&#160;557.</b>&#160;Build the&#160;text&#160;string that&#160;is&#160;displayed about&#160;the&#160;object.<br/></i>'*************************************************************************<br/>'** Set the text. For a service, show the interfaces and services in<br/>'** Separate sections so that they are easier to find.<br/>'*************************************************************************<br/>Sub&#160;processStateChange(oInsObj,&#160;sPropType$)<br/>&#160;&#160;Dim&#160;oItems()<br/>&#160;&#160;BuildItemArray(oInsObj,&#160;sPropType$,&#160;oItems())<br/>&#160;&#160;If&#160;sPropType$&#160;=&#160;&#34;s&#34;&#160;Then<br/>&#160; &#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160; &#160;&#160;On&#160;Local&#160;Error&#160;Resume&#160;Next<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;** INTERFACES **&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;Join(oItems,&#160;CHR$(10))<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;** SERVICES **&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;Join(oInsObj.getSupportedServiceNames(),&#160;CHR$(10))<br/>&#160; &#160;&#160;oTextEdit.Text&#160;=&#160;s<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;oTextEdit.Text&#160;=&#160;Join(oItems,&#160;CHR$(10))<br/>&#160;&#160;End&#160;If<br/>End&#160;Sub<br/>
The&#160;BuildItemArray()&#160;subroutine&#160;contains&#160;the&#160;majority&#160;of the&#160;important&#160;code&#160;for this&#160;dialog. First,&#160;the&#160;code&#160;<br/>inspects&#160;the&#160;dbg_ properties&#160;to&#160;obtain&#160;the&#160;list&#160;of properties, methods, or interfaces&#160;as&#160;a&#160;single&#160;string. It&#160;then&#160;<br/>separates&#160;the&#160;individual&#160;items&#160;from&#160;the&#160;single&#160;string and sorts&#160;them.&#160;If&#160;properties&#160;are&#160;displayed, the&#160;property&#160;<br/>set&#160;information object&#160;is&#160;used to&#160;obtain&#160;the&#160;value&#160;of each supported property.&#160;This&#160;allows&#160;you to see&#160;both the&#160;<br/>property&#160;name&#160;and its&#160;value.&#160;Although the&#160;property&#160;set&#160;information object&#160;does&#160;not&#160;support&#160;all&#160;of the&#160;<br/>properties&#160;returned by&#160;the&#160;property&#160; dbg_properties, it&#160;supports&#160;most&#160;of them.&#160;The&#160;individual&#160;data&#160;is&#160;returned<br/>as&#160;an array&#160;of strings&#160;in&#160;the&#160;oItems() array.&#160;See<a href="libremacros.html#661">&#160;Error:&#160;Reference&#160;source&#160;not&#160;found&#160;f</a>or an example.<br/>
<i><b>Listing&#160;558.&#160;</b>Build an array&#160;of&#160;properties,&#160;methods, or&#160;services.</i><br/>
'*************************************************************************<br/>'** This routine parses the strings returned from the dbg_Methods,<br/>'** dbg_Properties, and Dbg_SupportedInterfaces calls. The interesting<br/>'** data starts after the first colon.<br/>'**&#160;<br/>'** Because of this, all data before the first colon is discarded<br/>'** and then the string is separated into pieces based on the<br/>'** separator string that is passed in.<br/>'**&#160;<br/>'** All instances of the string Sbx are removed. If this string<br/>'** is valid and exists in a method name, it will still be removed so perhaps<br/>'** it is not the safest thing to do, but I have never seen this case and it<br/>'** makes the output easier to read.<br/>'**<br/>'** the oItems() contains all of the parsed sections on output.<br/>'*************************************************************************<br/>Sub&#160;BuildItemArray(oInsObj,&#160;sType$,&#160;oItems())<br/>&#160;&#160;On&#160;Error&#160;Goto&#160;BadErrorHere<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160;'Primary list to parse<br/>&#160;&#160;Dim&#160;sSep&#160;As&#160;String&#160; &#160; &#160; &#160;&#160;'Separates the items in the string<br/>
658<br/>
<hr/>
<a name=662></a>&#160;&#160;Dim&#160;iCount%&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'<br/>&#160;&#160;Dim&#160;iPos%&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'<br/>&#160;&#160;Dim&#160;sNew$&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'<br/>&#160;&#160;Dim&#160;j%&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'<br/>&#160;&#160;Dim&#160;sFront()&#160;As&#160;String&#160; &#160;&#160;'When each piece is parsed, this is the front<br/>&#160;&#160;Dim&#160;sMid()&#160;As&#160;String&#160; &#160; &#160;&#160;'When each piece is parsed, this is the middle<br/>&#160;&#160;Dim&#160;iIdx()&#160;As&#160;Integer&#160; &#160; &#160;'Used to sort parallel arrays.<br/>&#160;&#160;Dim&#160;nFrontMax&#160;As&#160;Integer&#160;&#160;'Maximum length of front section<br/>&#160;&#160;Dim&#160;sArraySep$&#160; &#160; &#160; &#160; &#160; &#160;&#160;:&#160;sArraySep&#160;=&#160;&#34;, &#34;<br/>&#160;&#160;Dim&#160;iArrayMaxDepth%&#160; &#160; &#160; &#160;:&#160;iArrayMaxDepth&#160;=&#160;10<br/>
&#160;&#160;nFrontMax&#160;=&#160;0<br/>&#160;&#160;<br/>&#160;&#160;REM First, see what should be inspected.<br/>&#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160;&#160;On&#160;Local&#160;Error&#160;Resume&#160;Next<br/>&#160;&#160;If&#160;sType$&#160;=&#160;&#34;s&#34;&#160;Then<br/>&#160; &#160;&#160;REM Dbg_SupportedInterfaces returns interfaces and<br/>&#160; &#160;&#160;REM getSupportedServiceNames() returns services.<br/>&#160; &#160;&#160;s&#160;=&#160;oInsObj.Dbg_SupportedInterfaces<br/>&#160; &#160;&#160;'s = s &amp; Join(oInsObj.getSupportedServiceNames(), CHR$(10))<br/>&#160; &#160;&#160;sSep&#160;=&#160;CHR$(10)<br/>&#160;&#160;ElseIf&#160;sType$&#160;=&#160;&#34;m&#34;&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;oInsObj.DBG_Methods<br/>&#160; &#160;&#160;sSep&#160;=&#160;&#34;;&#34;<br/>&#160;&#160;ElseIf&#160;sType$&#160;=&#160;&#34;p&#34;&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;oInsObj.DBG_Properties<br/>&#160; &#160;&#160;sSep&#160;=&#160;&#34;;&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160;&#160;sSep&#160;=&#160;&#34;&#34;<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;REM The dbg_ variables have some introductory information that<br/>&#160;&#160;REM we do not want so remove it.<br/>&#160;&#160;REM We only care about what is after the colon.<br/>&#160;&#160;iPos&#160;=&#160;InStr(1,&#160;s,&#160;&#34;:&#34;)&#160;+&#160;1<br/>&#160;&#160;If&#160;iPos&#160;&gt;&#160;0&#160;Then&#160;s&#160;=&#160;TrimWhite(Right(s,&#160;Len(s)&#160;-&#160;iPos))<br/>
&#160;&#160;REM All data types are prefixed with the text Sbx.<br/>&#160;&#160;REM Remove all of the &#34;SbX&#34; charcters<br/>&#160;&#160;s&#160;=&#160;Join(Split(s,&#160;&#34;Sbx&#34;),&#160;&#34;&#34;)<br/>
&#160;&#160;REM If the separator is NOT CHR$(10), then remove<br/>&#160;&#160;REM all instances of CHR$(10)<br/>&#160;&#160;If&#160;ASC(sSep)&#160;&lt;&gt;&#160;10&#160;Then&#160;s&#160;=&#160;Join(Split(s,&#160;CHR$(10)),&#160;&#34;&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM split on the separator character and update the progress bar.<br/>&#160;&#160;oItems()&#160;=&#160;Split(s,&#160;sSep)<br/>&#160;&#160;oProgress.ProgressValue&#160;=&#160;20<br/>
&#160;&#160;Rem Create arrays to hold the different portions of the text.<br/>
659<br/>
<hr/>
<a name=663></a>&#160;&#160;Rem the string usually contains text similar to &#34;SbxString getName()&#34;<br/>&#160;&#160;Rem sFront() holds the data type if it exists and &#34;&#34; if it does not.<br/>&#160;&#160;Rem sMid() holds the rest<br/>&#160;&#160;ReDim&#160;sFront(UBound(oItems))&#160;As&#160;String<br/>&#160;&#160;ReDim&#160;sMid(UBound(oItems))&#160; &#160;As&#160;String<br/>&#160;&#160;ReDim&#160;iIdx(UBound(oItems))&#160; &#160;As&#160;Integer<br/>
&#160;&#160;REM Initialize the index array and remove leading and trailing<br/>&#160;&#160;REM spaces from each string.&#160;<br/>&#160;&#160;For&#160;i=LBound(oItems())&#160;To&#160;UBound(oItems())<br/>&#160; &#160;&#160;oItems(i)&#160;=&#160;Trim(oItems(i))<br/>&#160; &#160;&#160;iIdx(i)&#160;=&#160;i<br/>&#160; &#160;&#160;j&#160;=&#160;InStr(1,&#160;oItems(i),&#160;&#34; &#34;)<br/>&#160; &#160;&#160;If&#160;(j&#160;&gt;&#160;0)&#160;Then<br/>&#160; &#160; &#160;&#160;REM If the string contains more than one word, the first word is stored<br/>&#160; &#160; &#160;&#160;REM in sFront() and the rest of the string is stored in sMid().<br/>&#160; &#160; &#160;&#160;sFront(i)&#160;=&#160;Mid$(oItems(i),&#160;1,&#160;j)<br/>&#160; &#160; &#160;&#160;sMid(i)&#160;=&#160;Mid$(oItems(i),&#160;j+1)<br/>&#160; &#160; &#160;&#160;If&#160;j&#160;&gt;&#160;nFrontMax&#160;Then&#160;nFrontMax&#160;=&#160;j<br/>&#160; &#160;&#160;Else<br/>&#160; &#160; &#160;&#160;REM If the string contains only one word, sFront() is empty<br/>&#160; &#160; &#160;&#160;REM and the string is stored in sMid().<br/>&#160; &#160; &#160;&#160;sFront(i)&#160;=&#160;&#34;&#34;<br/>&#160; &#160; &#160;&#160;sMid(i)&#160;=&#160;oItems(i)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>
&#160;&#160;oProgress.ProgressValue&#160;=&#160;40<br/>&#160;&#160;Rem Sort the primary names. The array is left unchanged, but the<br/>&#160;&#160;Rem iIdx() array contains index values that allow a sorted traversal<br/>&#160;&#160;SortMyArray(sMid(),&#160;iIdx())<br/>&#160;&#160;oProgress.ProgressValue&#160;=&#160;50<br/>
&#160;&#160;REM Dealing with properties so attempt to find the value<br/>&#160;&#160;REM of each property.<br/>&#160;&#160;If&#160;sType$&#160;=&#160;&#34;p&#34;&#160;Then<br/>&#160; &#160;&#160;Dim&#160;oPropInfo&#160;&#160;'PropertySetInfo object<br/>&#160; &#160;&#160;Dim&#160;oProps&#160; &#160; &#160;'Array of properties<br/>&#160; &#160;&#160;Dim&#160;oProp&#160; &#160; &#160;&#160;'com.sun.star.beans.Property<br/>&#160; &#160;&#160;Dim&#160;v&#160; &#160; &#160; &#160; &#160;&#160;'Value of a single property<br/>&#160; &#160;&#160;Dim&#160;bHasPI&#160;As&#160;Boolean<br/>&#160; &#160;&#160;Dim&#160;bUsePI&#160;As&#160;Boolean<br/>&#160; &#160;&#160;Dim&#160;bConvertReturns&#160;As&#160;Boolean<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;bConvertReturns&#160;=&#160;True<br/>&#160; &#160;&#160;bHasPI&#160;=&#160;False<br/>&#160; &#160;&#160;bUsePI&#160;=&#160;False<br/>&#160; &#160;&#160;On&#160;Error&#160;Goto&#160;NoPropertySetInfo<br/>&#160; &#160;&#160;oPropInfo&#160;=&#160;oInsObj.getPropertySetInfo()<br/>&#160; &#160;&#160;bHasPI&#160;=&#160;True<br/>&#160; &#160;&#160;NoPropertySetInfo:<br/>&#160; &#160;&#160;<br/>&#160; &#160;&#160;On&#160;Error&#160;Goto&#160;BadErrorHere:<br/>
660<br/>
<hr/>
<a name=664></a>&#160; &#160;&#160;<br/>&#160; &#160;&#160;For&#160;i=LBound(sMid())&#160;To&#160;UBound(sMid())<br/>&#160; &#160; &#160;&#160;If&#160;bHasPI&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;bUsePI&#160;=&#160;oPropInfo.hasPropertyByName(sMid(i))<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160;&#160;<br/>&#160; &#160; &#160;&#160;If&#160;bUsePI&#160;Then<br/>&#160; &#160; &#160; &#160;&#160;v&#160;=&#160;oInsObj.getPropertyValue(sMid(i))<br/>&#160; &#160; &#160;&#160;Else<br/>&#160; &#160; &#160; &#160;&#160;v&#160;=&#160;&#160;RunFromLib(GlobalScope.BasicLibraries,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#34;xyzzylib&#34;,&#160;&#34;TestMod&#34;,&#160;oInsObj,&#160;sMid(i),&#160;False,&#160;False)<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160; &#160;&#160;sMid(i)&#160;=&#160;sMid(i)&#160;&amp;&#160;&#34; = &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;ObjToString(v,&#160;sArraySep,&#160;iArrayMaxDepth,&#160;bConvertReturns)<br/>&#160; &#160;&#160;Next<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;oProgress.ProgressValue&#160;=&#160;60<br/>
&#160;&#160;nFrontMax&#160;=&#160;nFrontMax&#160;+&#160;1<br/>&#160;&#160;iCount&#160;=&#160;LBound(oItems())<br/>&#160;&#160;REM Now build the array of the items in sorted order<br/>&#160;&#160;REM Sometimes, a service is listed more than once.<br/>&#160;&#160;REM this routine removes multiple instances of the same service.&#160;<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(oItems())&#160;To&#160;UBound(oItems())<br/>&#160; &#160;&#160;sNew&#160;=&#160;sFront(iIdx(i))&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;sMid(iIdx(i))<br/>&#160; &#160;&#160;'Uncomment these lines if you want to add uniform space<br/>&#160; &#160;&#160;'between front and mid. This is only useful if the font is fixed in width.<br/>&#160; &#160;&#160;'sNew = sFront(iIdx(i))<br/>&#160; &#160;&#160;'sNew = sNew &amp; Space(nFrontMax - Len(sNew)) &amp; sMid(iIdx(i))<br/>&#160; &#160;&#160;If&#160;i&#160;=&#160;LBound(oItems())&#160;Then<br/>&#160; &#160; &#160;&#160;oItems(iCount)&#160;=&#160;sNew<br/>&#160; &#160;&#160;ElseIf&#160;oItems(iCount)&#160;&lt;&gt;&#160;sNew&#160;Then<br/>&#160; &#160; &#160;&#160;iCount&#160;=&#160;iCount&#160;+&#160;1<br/>&#160; &#160; &#160;&#160;oItems(iCount)&#160;=&#160;sNew<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>&#160;&#160;oProgress.ProgressValue&#160;=&#160;75<br/>&#160;&#160;ReDim&#160;Preserve&#160;oItems(iCount)<br/>&#160;&#160;Exit&#160;Sub<br/>BadErrorHere:<br/>&#160;&#160;MsgBox&#160;&#34;Error &#34;&#160;&amp;&#160;err&#160;&amp;&#160;&#34;: &#34;&#160;&amp;&#160;error$&#160;+&#160;chr(13)&#160;+&#160;&#34;In line : &#34;&#160;+&#160;Erl<br/>End&#160;Sub<br/>
The&#160;object&#160;inspector is&#160;shown below.&#160;ThisComponent&#160;was&#160;inspected, I&#160;viewed properties,&#160;selected&#160;<br/>“ChapterNumberingRules”, and then I&#160;clicked&#160;<b>Inspect Selected</b>.&#160;The&#160;path&#160;is&#160;shown in&#160;the&#160;dialog title.<br/>
661<br/>
<hr/>
<a name=665></a><i><b>Figure&#160;140.&#160;</b>The&#160;Object&#160;Inspector&#160;dialog.</i><br/>
You can use&#160;the&#160;object&#160;inspector to investigate&#160;objects&#160;when you&#160;aren’t&#160;certain exactly&#160;what&#160;you can do with&#160;<br/>them.&#160;You might&#160;want&#160;to copy&#160;this&#160;to an application-level&#160;library&#160;so that&#160;you&#160;can access&#160;the&#160;macro from&#160;all&#160;<br/>of your&#160;other macros.<br/>
<b>&#160;18.5.5.&#160;Getting&#160;property&#160;values<br/></b>Most&#160;UNO&#160;objects&#160;have&#160;a&#160;PropertySetInfo object,&#160;which allows&#160;you&#160;to&#160;see&#160;what&#160;properties&#160;exist,&#160;get&#160;the&#160;<br/>properties,&#160;and set&#160;the&#160;properties. Oddly,&#160;not&#160;all&#160;of the&#160;properties&#160;are&#160;available&#160;through this&#160;interface, but&#160;<br/>they&#160;are&#160;available&#160;from&#160;the&#160;Dbg_Properties&#160;property.&#160;When the&#160;PropertySetInfo object&#160;is&#160;unable&#160;to get&#160;a&#160;<br/>property&#160;value, the&#160;RunFromLib method is&#160;used.<br/>
The&#160;following&#160;macro creates&#160;a&#160;library,&#160;module,&#160;and function&#160;and then calls&#160;it.&#160;The&#160;library&#160;and module&#160;name&#160;<br/>are&#160;provided.&#160;The&#160;module&#160;is&#160;deleted&#160;if it&#160;exists,&#160;and replaced with&#160;a&#160;single&#160;function.&#160;The&#160;primary&#160;reason is&#160;to&#160;<br/>access&#160;a&#160;named&#160;property&#160;and return the&#160;value&#160;of the&#160;named&#160;property.<br/>
<i><b>Listing&#160;559.</b>&#160;Create&#160;a library,&#160;module,&#160;and function, then&#160;call&#160;it.<br/></i>'*************************************************************************<br/>'** Create a module that contains a function that returns the value from a&#160;<br/>
662<br/>
<hr/>
<a name=666></a>'** property or makes a method call on an object.<br/>'**<br/>'** Not all properties are available from the PropertySetInfo object, and<br/>'** I am not aware of any other way to make a method call.<br/>'**&#160;<br/>'** oLibs &#160;- Library container to use<br/>'** sLName - Library name<br/>'** sMName - Module name<br/>'** oObj &#160; - Object of interest<br/>'** sCall &#160;- Method or property name to call<br/>'** bClean - If true, remove the module. Library is only removed if created.<br/>'** bIsMthd- If true, create as a method rather than a property.<br/>'** x &#160; &#160; &#160;- If exists, then used as parameter for the method call.<br/>'** y &#160; &#160; &#160;- If exists, then used as parameter for the method call.<br/>'**&#160;<br/>'*************************************************************************<br/>Function&#160;RunFromLib(oLibs,&#160;sLName$,&#160;sMName$,&#160;oObj,&#160;sCall$,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;bClean&#160;As&#160;Boolean,&#160;bIsMthd&#160;As&#160;Boolean,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;Optional&#160;x,&#160;optional&#160;y)<br/>&#160;&#160;Dim&#160;oLib&#160; &#160; &#160;'The library to use to run the new function.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160;'Generic string variable.<br/>&#160;&#160;Dim&#160;bAddedLib&#160;As&#160;Boolean<br/>
&#160;&#160;REM If the library does not exist, then create it.<br/>&#160;&#160;bAddedLib&#160;=&#160;False<br/>&#160;&#160;If&#160;NOT&#160;oLibs.hasByName(sLName)&#160;Then<br/>&#160; &#160;&#160;bAddedLib&#160;=&#160;True<br/>&#160; &#160;&#160;oLibs.createLibrary(sLName)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;oLibs.loadLibrary(sLName)<br/>&#160;&#160;oLib&#160;=&#160;oLibs.getByName(sLName)<br/>
&#160;&#160;If&#160;oLib.hasByName(sMName)&#160;Then<br/>&#160; &#160;&#160;oLib.removeByName(sMName)<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;s&#160;=&#160;&#34;Option Explicit&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;Function MyInsertedFunc(ByRef oObj&#34;<br/>&#160; &#160; &#160;&#160;<br/>&#160;&#160;If&#160;NOT&#160;IsMissing(x)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;, x&#34;<br/>&#160;&#160;If&#160;NOT&#160;IsMissing(y)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;, y&#34;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;)&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;On Local Error Resume Next&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;MyInsertedFunc = oObj.&#34;&#160;&amp;&#160;sCall<br/>
&#160;&#160;If&#160;bIsMthd&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;(&#34;<br/>&#160; &#160;&#160;If&#160;NOT&#160;IsMissing(x)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;x&#34;<br/>&#160; &#160;&#160;If&#160;NOT&#160;IsMissing(y)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;, y&#34;<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;)&#34;<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;End Function&#34;<br/>
663<br/>
<hr/>
<a name=667></a>&#160;&#160;oLib.insertByName(sMName,&#160;s)<br/>
&#160;&#160;If&#160;IsMissing(x)&#160;Then<br/>&#160; &#160;&#160;RunFromLib&#160;=&#160;MyInsertedFunc(oObj)<br/>&#160;&#160;ElseIf&#160;IsMissing(y)&#160;Then<br/>&#160; &#160;&#160;RunFromLib&#160;=&#160;MyInsertedFunc(oObj,&#160;x)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;RunFromLib&#160;=&#160;MyInsertedFunc(oObj,&#160;x,&#160;y)<br/>&#160;&#160;End&#160;If<br/>
&#160;&#160;If&#160;bClean&#160;Then<br/>&#160; &#160;&#160;oLib.removeByName(sMName)<br/>&#160; &#160;&#160;If&#160;bAddedLib&#160;Then<br/>&#160; &#160; &#160;&#160;oLibs.removeLibrary(sLName)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;End&#160;If<br/>End&#160;Function&#160;<br/>
<b>Warn</b><br/>
While&#160;debugging&#160;the&#160;code&#160;used to&#160;inspect&#160;objects,&#160;the&#160;system&#160;was&#160;left&#160;in&#160;a&#160;strange&#160;state,&#160;and&#160;removing&#160;the&#160;<br/>
existing&#160;module&#160;failed.&#160;I&#160;believe&#160;that&#160;this was related to&#160;calling&#160;a&#160;handler&#160;containing&#160;breakpoints and then&#160;<br/>killing&#160;the&#160;dialog while&#160;the&#160;breakpoints were&#160;active.&#160;The&#160;important&#160;thing&#160;to note,&#160;however,&#160;is&#160;that&#160;if&#160;the&#160;<br/>
module&#160;cannot&#160;be&#160;deleted,&#160;stop&#160;the&#160;object&#160;inspector&#160;and&#160;then remove&#160;the&#160;library&#160;named&#160;“xyzzylib”&#160;using&#160;<br/>the&#160;macro&#160;organizer.<br/>
<i><b>&#160;18.6.&#160;Conclusion<br/></b></i>The&#160;methods&#160;outlined in&#160;this&#160;chapter should&#160;get&#160;you&#160;started&#160;in using&#160;dialogs&#160;and controls.&#160;The&#160;methods&#160;to&#160;<br/>access&#160;and use&#160;controls&#160;in&#160;dialogs&#160;are&#160;very&#160;similar to&#160;accessing controls&#160;in&#160;forms,&#160;so you’re&#160;well&#160;on your&#160;way<br/>to using forms&#160;as&#160;well.&#160;When&#160;a&#160;control&#160;is&#160;stored in&#160;a&#160;document&#160;rather than a&#160;dialog, the&#160;control&#160;is&#160;stored in&#160;a&#160;<br/>form.<br/>
664<br/>
<hr/>
<a name=668></a><b>&#160;19.&#160;Sources&#160;of&#160;Information<br/></b>The&#160;internals&#160;of OpenOffice.org&#160;are&#160;very&#160;extensive, not&#160;completely&#160;documented,&#160;and in a&#160;state&#160;of change&#160;due<br/>to ongoing feature&#160;development&#160;and bug fixes.&#160;This&#160;chapter introduces&#160;sources&#160;of information that&#160;can assist<br/>you&#160;in&#160;finding&#160;your&#160;own solutions.<br/>
While&#160;solving any&#160;problem, it&#160;is&#160;most&#160;important&#160;to have&#160;a&#160;basic&#160;understanding of the&#160;problem, and to&#160;know&#160;<br/>how&#160;to&#160;find the&#160;relevant&#160;information&#160;that&#160;you&#160;don’t&#160;know&#160;about&#160;the&#160;problem&#160;and possible&#160;solutions.&#160;You&#160;<br/>might&#160;produce&#160;faster and more&#160;reliable&#160;code&#160;if you knew&#160;everything&#160;about&#160;OpenOffice.org, but&#160;this&#160;simply&#160;<br/>isn’t&#160;possible&#160;because&#160;of the&#160;broad scope&#160;of the&#160;product. Even if&#160;you&#160;could know&#160;it&#160;all,&#160;and keep up with&#160;the&#160;<br/>changes&#160;of successive&#160;releases&#160;of OOo, it&#160;is&#160;probably&#160;more&#160;productive&#160;to&#160;use&#160;some&#160;of that&#160;mental&#160;energy&#160;to&#160;<br/>remember the&#160;phone&#160;numbers&#160;of your&#160;closest&#160;friends, your wedding anniversary,&#160;or funny&#160;stories&#160;about&#160;your&#160;<br/>parents—or to remember how&#160;to order extra&#160;copies&#160;of this&#160;book as&#160;gifts&#160;for your&#160;friends, spouse, and&#160;<br/>parents!<br/>
There&#160;are&#160;many&#160;excellent&#160;sources&#160;of information on OOo, each addressing different&#160;needs. Knowing&#160;which&#160;<br/>information is&#160;available&#160;at&#160;which&#160;location can save&#160; a&#160;lot&#160;of time&#160;and effort&#160;in&#160;solving&#160;problems.<br/>
<i><b>&#160;19.1.&#160;Help&#160;pages&#160;included&#160;with&#160;OpenOffice.org<br/></b></i>Do not&#160;neglect&#160;the&#160;excellent&#160;help that&#160;is&#160;included with&#160;OOo (see<a href="libremacros.html#668">&#160;Figure&#160;141)</a>.&#160;Although it&#160;may&#160;seem&#160;like&#160;I’m&#160;<br/>frequently&#160;complaining about&#160;inaccurate&#160;or missing items&#160;in&#160;the&#160;help&#160;pages, in&#160;reality&#160;those&#160;are&#160;few&#160;and far&#160;<br/>between. I&#160;mention&#160;this&#160;simply&#160;because&#160;it’s&#160;important&#160;to&#160;note&#160;when there&#160;are&#160;deficiencies,&#160;so you can be&#160;<br/>prepared to&#160;deal&#160;with&#160;some&#160;of the&#160;inevitable&#160;rough spots. (Hey,&#160;if&#160;I&#160;didn’t&#160;offer something of original&#160;value,&#160;<br/>what&#160;would&#160;be&#160;the&#160;point&#160;in&#160;writing this&#160;book?&#160;After all, I&#160;have&#160;a&#160;day&#160;job&#160;that&#160;keeps&#160;me&#160;busy—I&#160;don’t&#160;want&#160;<br/>this&#160;book to be&#160;a&#160;waste&#160;of time&#160;for either of us!)&#160;<br/>
The&#160;help pages&#160;cover each of the&#160;components&#160;in OOo:&#160;Writer,&#160;Calc, Basic,&#160;Draw,&#160;Math,&#160;and Impress.&#160;The&#160;<br/>upper-left&#160;corner of the&#160;help page&#160;contains&#160;a&#160;drop-down list&#160;that&#160;determines&#160;which&#160;help&#160;set&#160;is&#160;displayed.&#160;To&#160;<br/>view&#160;the&#160;help for Basic, the&#160;drop-down must&#160;display&#160;“Help&#160;about&#160;OpenOffice.org&#160;Basic.”&#160;If&#160;you open the&#160;<br/>help window&#160;from&#160;the&#160;Basic&#160;IDE, this&#160;is&#160;the&#160;default.&#160;The&#160;included help&#160;contains&#160;a&#160;lot&#160;of current&#160;information&#160;<br/>on OOo Basic&#160;syntax&#160;and routines.<br/>
<i><b>Figure&#160;141.&#160;</b>The&#160;included help is&#160;very&#160;good.</i><br/>
<i><b>&#160;19.2.&#160;Macros&#160;included&#160;with&#160;OpenOffice.org<br/></b></i>Many&#160;macros&#160;are&#160;included with&#160;OOo in libraries. Spend some&#160;time&#160;investigating these&#160;macros. Many&#160;<br/>wonderful&#160;examples&#160;are&#160;included. For example,&#160;the&#160;Gimmicks&#160;library&#160;contains&#160;a&#160;ReadDir module&#160;that&#160;reads&#160;<br/>an entire&#160;directory&#160;and creates&#160;a&#160;draw&#160;page&#160;with&#160;the&#160;information&#160;displayed in a&#160;tree&#160;structure.&#160;The&#160;Tools&#160;<br/>
665<br/>
<hr/>
<a name=669></a>library&#160;also&#160;contains&#160;numerous&#160;excellent&#160;examples.&#160;The&#160;Debug&#160;module&#160;in&#160;the&#160;Tools&#160;library&#160;contains&#160;some&#160;<br/>useful&#160;macros, such as&#160;WriteDbgInfo and PrintDbgInfo—check them&#160;out.&#160;<br/>
If&#160;you&#160;don’t&#160;know&#160;how&#160;to solve&#160;a&#160;problem,&#160;you&#160;should&#160;always&#160;try&#160;to&#160;find the&#160;answer first,&#160;rather than&#160;writing&#160;<br/>a&#160;completely&#160;new&#160;solution.&#160;The&#160;macros&#160;included&#160;with OOo are&#160;a&#160;good place&#160;to start.&#160;I&#160;once&#160;posted&#160;a&#160;request&#160;<br/>for help to&#160;determine&#160;the&#160;size&#160;of a&#160;control&#160;in&#160;a&#160;dialog.&#160;The&#160;response, which&#160;included&#160;the&#160;solution,&#160;indicated&#160;<br/>that&#160;I&#160;should look&#160;in&#160;the&#160;ModuleControls&#160;module&#160;in&#160;the&#160;Tools&#160;library&#160;that&#160;is&#160;included&#160;with OOo. In&#160;other&#160;<br/>words, the&#160;macros&#160;included with&#160;OOo contained the&#160;solution to&#160;my&#160;problem.<br/>
<b>TIP</b><br/>
You can see&#160;the&#160;libraries and&#160;modules included&#160;with OOo by&#160;selecting&#160;<b>Tools |&#160;Macros&#160;|&#160;Organize&#160;Macros<br/></b>to open&#160;the&#160;Macro&#160;dialog.&#160;The&#160;macros&#160;available&#160;at&#160;the&#160;application&#160;level&#160;are&#160;in&#160;the&#160;OpenOffice&#160;library&#160;<br/>container.<br/>
<i><b>&#160;19.3.&#160;Web&#160;sites<br/></b></i>On more&#160;than&#160;one&#160;occasion, I&#160;knew&#160;what&#160;I&#160;needed to&#160;use&#160;to&#160;solve&#160;a&#160;problem, but&#160;I&#160;just&#160;couldn’t&#160;figure&#160;out&#160;the<br/>details.&#160;This&#160;is&#160;where&#160;a&#160;working&#160;example&#160;is&#160;invaluable.&#160;There&#160;are&#160;numerous&#160;sources&#160;for help on the&#160;Internet;&#160;<br/>more&#160;become&#160;available&#160;all&#160;the&#160;time.&#160;Here&#160;is&#160;a&#160;list&#160;of sites&#160;that&#160;may&#160;help&#160;you:<br/>
<b>TIP</b><br/>
Although I&#160;have&#160;attempted&#160;to provide&#160;accurate&#160;links and descriptions, the&#160;OpenOffice&#160;Web&#160;sites are&#160;<br/>constantly&#160;changing&#160;and&#160;improving.<br/>
<b>&#160;19.3.1.&#160;Reference&#160;material<br/></b>http://www.openoffice.org/api/ is the site where I spend most of my time. This site lists most interfaces <br/>
and services and contains the primary Developer’s Guide. The guide has a reputation for being difficult to <br/>
understand, but the authors are working to make the content more accessible to less technical readers.<br/>http://www.odfauthors.org/ Documentation and books.<br/>http://wiki.openoffice.org/wiki/Documentation: Apache documentation project.<br/>
<b>&#160;19.3.2.&#160;Macro&#160;examples<br/></b>http://www.pitonyak.org/oo.php is my personal Web site, created before I decided to write a book. This <br/>
site contains numerous documents and links. “AndrewMacro” contains numerous examples. The direct link <br/>to my macro document is http://www.pitonyak.org/AndrewMacro.odt.  <br/>http://kienlein.com/pages/oo.html contains some excellent macros, with short descriptions of the macros <br/>
in German.<br/>http://www.darwinwars.com/lunatic/bugs/oo_macros.html is a good first stop when looking for Writer <br/>
macros. The author of this site is a professional writer who uses the macros—so they work!<br/>
<b>&#160;19.3.3.&#160;Miscellaneous<br/></b>http://www.openoffice.org/ is the main OOo link. This site contains a lot of information, such as links to <br/>
mailing lists that you can search, and the OOo bug­tracking system IssueZilla. You can join the site (it’s <br/>
free) to gain more capabilities, such as entering bug reports and subscribing to mailing lists.<br/>http://www.openoffice.org/development/index.html is the developer project link from the main OOo Web<br/>
666<br/>
<hr/>
<a name=670></a>page. Numerous links and resources are available from this page.<br/>http://forum.openoffice.org/ The official OpenOffice forum.<br/>http://www.oooforum.org/ contains numerous help forums. This site includes help for the different <br/>components of OOo—including macro programming. <br/>http://ooodocs.sourceforge.net/ contains many help files separated into categories, including a section on <br/>macro programming.<br/>http://www.openoffice.org/documentation/ is the home page for the documentation project. This site <br/>contains documentation on numerous topics. The How­To link references a document that discusses how to <br/>
embed controls that call macros into documents. This is an excellent interactive document.<br/>
http://documentation.openoffice.org/HOW_TO/various_topics/How_to_use_basic_macros.sxw<br/>http://sourceforge.net/project/showfiles.php?group_id=43716 contains numerous  templates and <br/>examples.<br/>
<i><b>&#160;19.4.<a href="http://www.openoffice.org/api/">&#160;http://www.openoffice.org/api/&#160;</a></b></i><i><b>or<a href="http://api.libreoffice.org/">&#160;http://api.libreoffice.org&#160;<br/></a></b></i>For&#160;the&#160;serious&#160;macro writer,&#160;the&#160;site&#160;<b>http://www.openoffice.org/api/</b>&#160;is&#160;very&#160;important. I&#160;spend most&#160;of my&#160;<br/>time&#160;here&#160;while&#160;investigating how&#160;to&#160;solve&#160;problems.&#160;The&#160;first&#160;accessible&#160;programming document&#160;for&#160;<br/>StarOffice&#160;version 5.x is&#160;available&#160;from&#160;this&#160;site.&#160;The&#160;document,&#160;<br/><b>www.openoffice.org/api/basic/man/tutorial/tutorial.pdf</b>, may&#160;be&#160;old,&#160;but&#160;it&#160;contains&#160;some&#160;nice&#160;examples<br/>—and it&#160;is&#160;very&#160;accessible.<br/>
<b>http://wiki.openoffice.org/wiki/Documentation/DevGuide/OpenOffice.org_Developers_Guide</b>&#160;contains&#160;<br/>the&#160;Developer’s&#160;Guide, which&#160;is&#160;kept&#160;up-to-date.&#160;The&#160;target&#160;audience&#160;for this&#160;document&#160;is&#160;the&#160;professional&#160;<br/>developer.&#160;A&#160;lot&#160;of information is&#160;here, and it&#160;requires&#160;some&#160;talent&#160;to find&#160;what&#160;you need.&#160;This&#160;is&#160;only&#160;<br/>because&#160;so much information is&#160;available.&#160;Basic&#160;programming&#160;is&#160;only&#160;a&#160;small&#160;portion&#160;of this&#160;document’s&#160;<br/>coverage.&#160;When&#160;you&#160;require&#160;the&#160;complete&#160;story,&#160;or at&#160;least&#160;the&#160;most&#160;complete&#160;story&#160;available, look&#160;in the&#160;<br/>Developer’s&#160;Guide.&#160;(But,&#160;be&#160;prepared for the&#160;<i>complete</i>&#160;story...)<br/>
I&#160;spend most&#160;of my&#160;time&#160;in the&#160;portion&#160;investigating the&#160;individual&#160;modules, which&#160;list&#160;the&#160;interfaces&#160;and&#160;<br/>services&#160;available.&#160;A&#160;good starting point&#160;is<br/>
&#160;<b>http://www.openoffice.org/api/docs/common/ref/module-ix.html</b>&#160;<br/>
because&#160;it&#160;contains&#160;all&#160;of the&#160;main&#160;modules. Notice&#160;that&#160;the&#160;name&#160;of the&#160;Web&#160;page&#160;is&#160;“module-ix.html”.&#160;If&#160;<br/>you&#160;are&#160;looking&#160;at&#160;a&#160;Web page&#160;for a&#160;service&#160;or interface, you can usually&#160;remove&#160;the&#160;name&#160;of the&#160;Web&#160;page&#160;<br/>and substitute&#160;the&#160;name&#160;“module-ix.html”.&#160;For&#160;example, assume&#160;that&#160;you&#160;are&#160;looking at&#160;the&#160;TextCursor&#160;<br/>service&#160;at&#160;<b>http://www.openoffice.org/api/docs/common/ref/com/sun/star/text/TextCursor.html</b>&#160;and you&#160;<br/>want&#160;to see&#160;the&#160;services. Change&#160;“TextCursor.html”&#160;to “module-ix.html”&#160;and you&#160;can see&#160;all&#160;of the&#160;<br/>definitions, services, contained modules, constants, and interfaces&#160;in the&#160;com.sun.star.text&#160;module.<br/>
You should&#160;start&#160;investigating the&#160;different&#160;modules&#160;at&#160;the&#160;main Sun module,&#160;<br/><b>http://www.openoffice.org/api/docs/common/ref/com/sun/star/module-ix.html</b>, which&#160;will&#160;provide&#160;a&#160;feel<br/>for the&#160;different&#160;modules&#160;and their purposes. Because&#160;the&#160;modules&#160;group related&#160;functionality,&#160;I&#160;sometimes&#160;<br/>look here&#160;when I&#160;need to find a&#160;service&#160;that&#160;solves&#160;a&#160;specific&#160;problem&#160;but&#160;I&#160;don’t&#160;know&#160;what&#160;the&#160;service&#160;is.<br/>
667<br/>
<hr/>
<a name=671></a><i><b>&#160;19.5.&#160;Mailing&#160;lists&#160;and&#160;newsgroups<br/></b></i>Numerous&#160;mailing lists&#160;are&#160;available&#160;for OpenOffice&#160;users. Information on each mailing list&#160;is&#160;available&#160;<br/>from&#160;the&#160;lists-related&#160;Web&#160;site.&#160;<br/>
•<br/>
<a href="http://www.openoffice.org/mail_list.html">http://www.openoffice.org/mail_list.html&#160;</a><br/>
•<br/>
<a href="http://www.libreoffice.org/get-help/mailing-lists/">http://www.libreoffice.org/get-help/mailing-lists/&#160;</a><br/>
When&#160;you&#160;ask a&#160;question on a&#160;mailing list,&#160;the&#160;answers&#160;go to&#160;the&#160;mailing list&#160;rather than directly&#160;to you.&#160;You&#160;<br/>must&#160;subscribe&#160;to&#160;the&#160;mailing list&#160;so that&#160;you&#160;can receive&#160;the&#160;answers. Instructions&#160;are&#160;provided&#160;to subscribe&#160;<br/>to each of the&#160;mailing lists.&#160;Although developers&#160;read the&#160;mailing&#160;lists&#160;and answer questions,&#160;this&#160;is&#160;not&#160;a&#160;<br/>support&#160;forum&#160;in the&#160;sense&#160;of guaranteed&#160;help.&#160; If&#160;other users&#160;or developers&#160;have&#160;a&#160;solution&#160;or an idea&#160;for a&#160;<br/>solution, they&#160;will&#160;post&#160;an answer.&#160;Answers&#160;requiring&#160;a&#160;lot&#160;of work or time&#160;are&#160;not&#160;likely&#160;to&#160;be&#160;answered.&#160;The<br/>LO&#160;development&#160;mailing list&#160;is&#160;expected to&#160;be&#160;used by&#160;people&#160;developing&#160;the&#160;LO&#160;software&#160;so you may&#160;not&#160;<br/>have&#160;much&#160;luck asking macro related questions&#160;on that&#160;mailing list.<br/>
A&#160;good first&#160;step before&#160;asking a&#160;question&#160;is&#160;to&#160;subscribe&#160;to&#160;the&#160;mailing list.&#160;Remember,&#160;the&#160;people&#160;<br/>answering your questions&#160;are&#160;not&#160;paid to&#160;do so. It&#160;is&#160;appreciated&#160;if you&#160;answer other people’s&#160;questions&#160;if&#160;<br/>you&#160;know&#160;the&#160;answer.&#160;Here&#160;are&#160;some&#160;hints&#160;to&#160;ensure&#160;that&#160;you&#160;receive&#160;answers&#160;on the&#160;mailing lists.<br/>
Before asking a question, try to find the answer yourself. Search the Web, search the mailing­list archives, <br/>
search the Developer’s Guide, search Google, read a FAQ. Inspect returned objects. The user community <br/>
members prefer to help people who can help themselves and give back to the community.<br/>Choose a meaningful message header. I receive hundreds of e­mails every day so I am likely to skip a <br/>
message that is titled “Please Help,” “Urgent,” or “Macro Problem.” A better title is “How do I run a macro <br/>
from the command line?” or “Searching macro fails to find attributes.” I can then look at questions that I am<br/>
likely to already understand or that interest me. We all get more e­mail than we need. Vague or misleading <br/>
subject lines often inspire liberal use of the Delete feature.<br/>Carefully word your question so that you ask the right question. “My macro has a run­time error” is rather <br/>
vague. Including a little code certainly helps. Including the run­time error in your message also helps. The <br/>
fact that your sort macro does not sort as it should might be specific, but I need more information and <br/>
perhaps some code before I can comment. State the problem precisely, and include how you tried to solve <br/>
the problem. Specific error messages—and anything you know about the circumstances or likely causes of <br/>
the problem—are welcome.<br/>Do not expect someone else to do your work for you. “My client is paying me $2000 to convert this macro; <br/>
will you do it for free?” is not likely to receive a response. I have translated macros from other systems <br/>
because they were interesting and of broad scope, and I was allowed to then release them to the user <br/>
community. If you are really in a bind, someone on the list might be willing to do your work for a fee.<br/>Do not directly ask a single individual, even if they are knowledgeable. Many people can answer your <br/>
question using pooled knowledge, and you will often receive a better solution. In other words, ask the <br/>
question on the list rather than directly to an individual, unless you have a good reason for doing so. The last<br/>
question that I helped answer on the list generated roughly 10 messages from four different people.<br/>It’s considered bad form to request an answer to be e­mailed to you at a different address. If you don’t care <br/>
enough to check the mailing list for the answer, why should someone else care enough to spend time <br/>
answering your question in the first place? Again, remember that these folks are volunteers! Also, the <br/>
answer to your question—an online discussion leading to the understanding of your circumstances and <br/>
668<br/>
<hr/>
<a name=672></a>eventual solution—may be of value to others in the community. In this way, the shared pool of knowledge <br/>
grows larger and better over time.<br/>When you do have a solution, post it to help others. A polite “thank you” is also appropriate. Again, <br/>
courtesy and sharing are important to the development of a functioning community that benefits you and all <br/>
the other members as well. (I feel like a public service announcement when I say these things, just in case <br/>
you were wondering.)<br/>
<i><b>&#160;19.6.&#160;How&#160;to&#160;find&#160;answers<br/></b></i>When&#160;I&#160;want&#160;to know&#160;about&#160;a&#160;specific&#160;issue, I&#160;usually&#160;search the&#160;Developer’s&#160;Guide&#160;and the&#160;old&#160;StarOffice&#160;<br/>tutorial,&#160;and finally&#160;I&#160;perform&#160;a&#160;Google&#160;search such as&#160;“cursor OpenOffice”.&#160;When I&#160;want&#160;to&#160;narrow&#160;the&#160;<br/>search to the&#160;api.openoffice.org&#160;site,&#160;I&#160;use&#160;“site:www.openoffice.org/api&#160;cursor”;&#160;the&#160;results&#160;usually&#160;include&#160;<br/>an interface&#160;or a&#160;service&#160;that&#160;I&#160;can inspect, such as:<br/>
MsgBox&#160;&#160;vObj.dbg_methods<br/>MsgBox&#160;&#160;vObj.dbg_supportedInterfaces<br/>MsgBox&#160;&#160;vObj.dbg_properties<br/>
If&#160;you&#160;aren’t&#160;certain what&#160;to&#160;do with an object,&#160;inspect&#160;it.&#160;For&#160;example, print&#160;the&#160;properties&#160;dbg_methods,&#160;<br/>dbg_supportedInterfaces, and dbg_properties. If&#160;you&#160;are&#160;still&#160;at&#160;a&#160;loss, you&#160;can search the&#160;Internet&#160;or other&#160;<br/>documents&#160;for the&#160;services, methods, or properties&#160;that&#160;are&#160;implemented.<br/>
<b>TIP</b><br/>
I&#160;don't&#160;really&#160;print&#160;the&#160;methods and properties,&#160;I&#160;use&#160;the&#160;object&#160;inspector&#160;or&#160;X-Ray&#160;(see&#160;secti<a href="libremacros.html#647">on&#160;18.5&#160;The&#160;</a><br/>
<a href="libremacros.html#647">object&#160;inspector&#160;example)</a>.<br/>
Quickly&#160;search for examples&#160;that&#160;might&#160;solve&#160;the&#160;same&#160;problem&#160;that&#160;you&#160;face.&#160;This&#160;is&#160;an ideal&#160;situation&#160;<br/>because&#160;it&#160;requires&#160;less&#160;work on your&#160;part.&#160;As&#160;a&#160;last&#160;resort, post&#160;a&#160;message&#160;on a&#160;mailing list&#160;and ask for help.<br/>
<i><b>&#160;19.7.&#160;Conclusion<br/></b></i>Many&#160;excellent&#160;sources&#160;of information&#160;discuss&#160;how&#160;to&#160;write&#160;code&#160;that&#160;directs&#160;OpenOffice.org. Becoming&#160;<br/>familiar with&#160;these&#160;sources&#160;can save&#160;you a&#160;lot&#160;of time,&#160;and regularly&#160;browsing the&#160;mailing lists&#160;also keeps&#160;<br/>you&#160;in&#160;touch with&#160;how&#160;things&#160;are&#160;changing. Participation in&#160;the&#160;community&#160;of a&#160;mailing list&#160;or newsgroup&#160;<br/>offers&#160;opportunity&#160;to gain solutions&#160;and to allow&#160;others&#160;to&#160;benefit&#160;from&#160;your&#160;experience&#160;as&#160;well.<br/>
669<br/>
<hr/>
<a name="outline"></a><h1>Document Outline</h1>
<ul>
<li><a href="libremacros.html#3">General Information</a></li>
<li><a href="libremacros.html#4">Table of Contents</a></li>
<li><a href="libremacros.html#16">1. Introduction and housekeeping</a>
<ul>
<li><a href="libremacros.html#16">1.1. Comments from the author</a></li>
<li><a href="libremacros.html#16">1.2. Environment and comments</a></li>
</ul>
</li>
<li><a href="libremacros.html#17">2. Getting Started</a>
<ul>
<li><a href="libremacros.html#17">2.1. Macro storage</a>
<ul>
<li><a href="libremacros.html#17">2.1.1. Library container</a></li>
<li><a href="libremacros.html#18">2.1.2. Libraries</a></li>
<li><a href="libremacros.html#19">2.1.3. Modules and dialogs</a></li>
<li><a href="libremacros.html#19">2.1.4. Key points</a></li>
</ul>
</li>
<li><a href="libremacros.html#19">2.2. Creating new modules and libraries</a></li>
<li><a href="libremacros.html#21">2.3. Macro language</a></li>
<li><a href="libremacros.html#21">2.4. Create a module in a document</a></li>
<li><a href="libremacros.html#24">2.5. Integrated Debugging Environment</a></li>
<li><a href="libremacros.html#27">2.6. Enter the macro</a></li>
<li><a href="libremacros.html#28">2.7. Run a macro</a></li>
<li><a href="libremacros.html#28">2.8. Macro security</a></li>
<li><a href="libremacros.html#31">2.9. Using breakpoints</a></li>
<li><a href="libremacros.html#31">2.10. How libraries are stored</a></li>
<li><a href="libremacros.html#32">2.11. How documents are stored</a></li>
<li><a href="libremacros.html#33">2.12. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#34">3. Language Constructs</a>
<ul>
<li><a href="libremacros.html#35">3.1. Compatibility with Visual Basic</a></li>
<li><a href="libremacros.html#36">3.2. Compiler options and directives</a></li>
<li><a href="libremacros.html#36">3.3. Variables</a>
<ul>
<li><a href="libremacros.html#36">3.3.1. Constant, subroutine, function, label, and variable names</a></li>
<li><a href="libremacros.html#37">3.3.2. Declaring variables</a></li>
<li><a href="libremacros.html#39">3.3.3. Assigning values to variables</a></li>
<li><a href="libremacros.html#39">3.3.4. Boolean variables are True or False</a></li>
<li><a href="libremacros.html#40">3.3.5. Numeric variables</a>
<ul>
<li><a href="libremacros.html#41">Integer variables</a></li>
<li><a href="libremacros.html#42">Long Integer variables</a></li>
<li><a href="libremacros.html#42">Currency variables</a></li>
<li><a href="libremacros.html#43">Single variables</a></li>
<li><a href="libremacros.html#43">Double variables</a></li>
</ul>
</li>
<li><a href="libremacros.html#43">3.3.6. String variables contain text</a></li>
<li><a href="libremacros.html#44">3.3.7. Date variables</a></li>
<li><a href="libremacros.html#45">3.3.8. Create your own data types</a></li>
<li><a href="libremacros.html#46">3.3.9. Declare variables with special types</a></li>
<li><a href="libremacros.html#47">3.3.10. Object variables</a></li>
<li><a href="libremacros.html#47">3.3.11. Variant variables</a></li>
<li><a href="libremacros.html#48">3.3.12. Constants</a></li>
</ul>
</li>
<li><a href="libremacros.html#49">3.4. The With statement</a></li>
<li><a href="libremacros.html#50">3.5. Arrays</a>
<ul>
<li><a href="libremacros.html#52">3.5.1. Changing the dimension of an array</a></li>
<li><a href="libremacros.html#54">3.5.2. The unexpected behavior of arrays</a></li>
</ul>
</li>
<li><a href="libremacros.html#56">3.6. Subroutines and functions</a>
<ul>
<li><a href="libremacros.html#57">3.6.1. Arguments</a>
<ul>
<li><a href="libremacros.html#57">Pass by reference or by value</a></li>
<li><a href="libremacros.html#60">Optional arguments</a></li>
<li><a href="libremacros.html#61">Default argument values</a></li>
</ul>
</li>
<li><a href="libremacros.html#61">3.6.2. Recursive routines</a></li>
</ul>
</li>
<li><a href="libremacros.html#62">3.7. Scope of variables, subroutines, and functions</a>
<ul>
<li><a href="libremacros.html#63">3.7.1. Local variables defined in a subroutine or function</a></li>
<li><a href="libremacros.html#63">3.7.2. Variables defined in a module</a>
<ul>
<li><a href="libremacros.html#64">Global</a></li>
<li><a href="libremacros.html#64">Public</a></li>
<li><a href="libremacros.html#65">Private or Dim</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="libremacros.html#65">3.8. Operators</a>
<ul>
<li><a href="libremacros.html#66">3.8.1. Mathematical and string operators</a>
<ul>
<li><a href="libremacros.html#67">Unary plus (+) and minus (-)</a></li>
<li><a href="libremacros.html#67">Exponentiation (^)</a></li>
<li><a href="libremacros.html#68">Multiplication (*) and Division (/)</a></li>
<li><a href="libremacros.html#68">Remainder after division (MOD)</a></li>
<li><a href="libremacros.html#69">Integer division ()</a></li>
<li><a href="libremacros.html#70">Addition (+), subtraction (-), and string concatenation (&amp; and +)</a></li>
</ul>
</li>
<li><a href="libremacros.html#70">3.8.2. Logical and bit-wise operators</a>
<ul>
<li><a href="libremacros.html#73">AND</a></li>
<li><a href="libremacros.html#73">OR</a></li>
<li><a href="libremacros.html#74">XOR</a></li>
<li><a href="libremacros.html#74">EQV</a></li>
<li><a href="libremacros.html#75">IMP</a></li>
<li><a href="libremacros.html#76">NOT</a></li>
</ul>
</li>
<li><a href="libremacros.html#76">3.8.3. Comparison operators</a></li>
</ul>
</li>
<li><a href="libremacros.html#77">3.9. Flow control</a>
<ul>
<li><a href="libremacros.html#77">3.9.1. Define a label as a jump target</a></li>
<li><a href="libremacros.html#77">3.9.2. GoSub</a></li>
<li><a href="libremacros.html#78">3.9.3. GoTo</a></li>
<li><a href="libremacros.html#78">3.9.4. On GoTo and On GoSub</a></li>
<li><a href="libremacros.html#79">3.9.5. If Then Else</a></li>
<li><a href="libremacros.html#80">3.9.6. IIf</a></li>
<li><a href="libremacros.html#80">3.9.7. Choose</a></li>
<li><a href="libremacros.html#81">3.9.8. Select Case</a>
<ul>
<li><a href="libremacros.html#81">Case expressions</a></li>
<li><a href="libremacros.html#82">If Case statements are easy, why are they frequently incorrect?</a></li>
<li><a href="libremacros.html#83">Writing correct Case expressions</a></li>
</ul>
</li>
<li><a href="libremacros.html#85">3.9.9. While ... Wend</a></li>
<li><a href="libremacros.html#85">3.9.10. Do ... Loop</a>
<ul>
<li><a href="libremacros.html#86">Exit the Do Loop</a></li>
<li><a href="libremacros.html#86">Which Do Loop should I use?</a></li>
</ul>
</li>
<li><a href="libremacros.html#87">3.9.11. For ... Next</a></li>
<li><a href="libremacros.html#88">3.9.12. Exit Sub and Exit Function</a></li>
</ul>
</li>
<li><a href="libremacros.html#89">3.10. Error handling using On Error</a>
<ul>
<li><a href="libremacros.html#90">3.10.1. CVErr</a></li>
<li><a href="libremacros.html#91">3.10.2. Ignore errors with On Error Resume Next</a></li>
<li><a href="libremacros.html#91">3.10.3. Clear an error handler with On Error GoTo 0</a></li>
<li><a href="libremacros.html#92">3.10.4. Specify your own error handler with On Error GoTo Label</a></li>
<li><a href="libremacros.html#94">3.10.5. Error handlers — why use them?</a></li>
</ul>
</li>
<li><a href="libremacros.html#96">3.11. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#97">4. Numerical Routines</a>
<ul>
<li><a href="libremacros.html#98">4.1. Trigonometric functions</a></li>
<li><a href="libremacros.html#100">4.2. Rounding errors and precision</a></li>
<li><a href="libremacros.html#103">4.3. Mathematical functions</a></li>
<li><a href="libremacros.html#104">4.4. Numeric conversions</a></li>
<li><a href="libremacros.html#110">4.5. Number to string conversions</a></li>
<li><a href="libremacros.html#110">4.6. Simple formatting</a></li>
<li><a href="libremacros.html#111">4.7. Other number bases, hexadecimal, octal, and binary</a></li>
<li><a href="libremacros.html#114">4.8. Random numbers</a></li>
<li><a href="libremacros.html#115">4.9. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#116">5. Array Routines</a>
<ul>
<li><a href="libremacros.html#117">5.1. Array() quickly builds a one-dimensional array with data</a></li>
<li><a href="libremacros.html#119">5.2. DimArray creates empty multi-dimensional arrays</a></li>
<li><a href="libremacros.html#120">5.3. Change the dimension of an array</a></li>
<li><a href="libremacros.html#121">5.4. Array to String and back again</a></li>
<li><a href="libremacros.html#122">5.5. Array inspection functions</a></li>
<li><a href="libremacros.html#125">5.6. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#126">6. Date Routines</a>
<ul>
<li><a href="libremacros.html#127">6.1. Compatibility issues</a></li>
<li><a href="libremacros.html#127">6.2. Retrieve the current date and time</a></li>
<li><a href="libremacros.html#127">6.3. Dates, numbers, and strings</a></li>
<li><a href="libremacros.html#129">6.4. Locale formatted dates</a></li>
<li><a href="libremacros.html#129">6.5. ISO 8601 dates</a></li>
<li><a href="libremacros.html#130">6.6. Problems with dates</a></li>
<li><a href="libremacros.html#134">6.7. Extract each part of a date</a></li>
<li><a href="libremacros.html#138">6.8. Date arithmetic</a></li>
<li><a href="libremacros.html#139">6.9. Assembling dates from components</a></li>
<li><a href="libremacros.html#140">6.10. Measuring elapsed time over short intervals</a></li>
<li><a href="libremacros.html#142">6.11. How fast does this run? A real-world example!</a></li>
<li><a href="libremacros.html#145">6.12. Long time intervals and special dates</a></li>
<li><a href="libremacros.html#146">6.13. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#147">7. String Routines</a>
<ul>
<li><a href="libremacros.html#149">7.1. ASCII and Unicode values</a></li>
<li><a href="libremacros.html#152">7.2. Standard string functions</a></li>
<li><a href="libremacros.html#156">7.3. Locale and strings</a></li>
<li><a href="libremacros.html#156">7.4. Substrings</a></li>
<li><a href="libremacros.html#157">7.5. Replace</a></li>
<li><a href="libremacros.html#158">7.6. Aligning strings with LSet and RSet</a></li>
<li><a href="libremacros.html#160">7.7. Fancy formatting with Format</a></li>
<li><a href="libremacros.html#165">7.8. Converting data to a string</a></li>
<li><a href="libremacros.html#166">7.9. Advanced searching</a></li>
<li><a href="libremacros.html#167">7.10. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#169">8. File Routines</a>
<ul>
<li><a href="libremacros.html#170">8.1. Using URL notation to specify a file</a></li>
<li><a href="libremacros.html#171">8.2. Directory manipulation functions</a></li>
<li><a href="libremacros.html#172">8.3. File manipulation functions</a></li>
<li><a href="libremacros.html#175">8.4. File attributes, bitmasks, and binary numbers</a></li>
<li><a href="libremacros.html#177">8.5. Obtaining a directory listing</a></li>
<li><a href="libremacros.html#178">8.6. Open a file</a></li>
<li><a href="libremacros.html#180">8.7. Information about open files</a></li>
<li><a href="libremacros.html#183">8.8. Reading and writing data</a></li>
<li><a href="libremacros.html#189">8.9. File and directory related services</a>
<ul>
<li><a href="libremacros.html#189">8.9.1. Path Settings</a></li>
<li><a href="libremacros.html#193">8.9.2. Path Substitution</a></li>
<li><a href="libremacros.html#195">8.9.3. Simple File Access</a></li>
<li><a href="libremacros.html#195">8.9.4. Streams</a></li>
<li><a href="libremacros.html#199">8.9.5. Pipes</a></li>
</ul>
</li>
<li><a href="libremacros.html#200">8.10. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#201">9. Miscellaneous Routines</a>
<ul>
<li><a href="libremacros.html#201">9.1. Display and color</a>
<ul>
<li><a href="libremacros.html#201">9.1.1. Determine the GUI type</a></li>
<li><a href="libremacros.html#202">9.1.2. Determine pixel size (in twips)</a></li>
<li><a href="libremacros.html#203">9.1.3. Use color functions</a></li>
</ul>
</li>
<li><a href="libremacros.html#205">9.2. Flow control</a>
<ul>
<li><a href="libremacros.html#206">9.2.1. Return an argument</a></li>
<li><a href="libremacros.html#207">9.2.2. Pause or end the macro</a></li>
<li><a href="libremacros.html#208">9.2.3. Dynamic Link Libraries</a></li>
<li><a href="libremacros.html#209">9.2.4. Calling external applications</a></li>
<li><a href="libremacros.html#210">9.2.5. Dynamic Data Exchange</a></li>
</ul>
</li>
<li><a href="libremacros.html#211">9.3. User input and output</a>
<ul>
<li><a href="libremacros.html#212">9.3.1. Simple output</a></li>
<li><a href="libremacros.html#213">9.3.2. Multi-line output</a></li>
<li><a href="libremacros.html#215">9.3.3. Prompting for input</a></li>
</ul>
</li>
<li><a href="libremacros.html#217">9.4. Error-related routines</a></li>
<li><a href="libremacros.html#218">9.5. Miscellaneous routines</a></li>
<li><a href="libremacros.html#221">9.6. Partition</a></li>
<li><a href="libremacros.html#223">9.7. Inspection and identification of variables</a></li>
<li><a href="libremacros.html#228">9.8. Routines you should not use and other curiosities</a></li>
<li><a href="libremacros.html#229">9.9. Routines I do not understand</a></li>
<li><a href="libremacros.html#230">9.10. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#231">10. Universal Network Objects</a>
<ul>
<li><a href="libremacros.html#232">10.1. Base types and structures</a></li>
<li><a href="libremacros.html#234">10.2. UNO interface</a></li>
<li><a href="libremacros.html#235">10.3. UNO service</a>
<ul>
<li><a href="libremacros.html#239">10.3.1. Setting a Read-Only Value</a></li>
</ul>
</li>
<li><a href="libremacros.html#240">10.4. Context</a></li>
<li><a href="libremacros.html#240">10.5. Inspecting Universal Network Objects</a></li>
<li><a href="libremacros.html#245">10.6. Using the type description manager</a></li>
<li><a href="libremacros.html#248">10.7. Use Object or Variant</a></li>
<li><a href="libremacros.html#249">10.8. Comparing UNO variables</a></li>
<li><a href="libremacros.html#250">10.9. Built-in global UNO variables</a></li>
<li><a href="libremacros.html#253">10.10. Creating UNO values for OOo internals</a></li>
<li><a href="libremacros.html#254">10.11. Finding objects and properties</a></li>
<li><a href="libremacros.html#255">10.12. UNO listeners</a>
<ul>
<li><a href="libremacros.html#256">10.12.1. Your first listener</a></li>
<li><a href="libremacros.html#257">10.12.2. A complete listener: selection change listener</a></li>
</ul>
</li>
<li><a href="libremacros.html#259">10.13. Creating a UNO dialog</a></li>
<li><a href="libremacros.html#263">10.14. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#264">11. The Dispatcher</a>
<ul>
<li><a href="libremacros.html#264">11.1. The environment</a>
<ul>
<li><a href="libremacros.html#264">11.1.1. Two different methods to control OOo</a></li>
<li><a href="libremacros.html#266">11.1.2. Finding dispatch commands</a>
<ul>
<li><a href="libremacros.html#266">Use the WIKI</a></li>
<li><a href="libremacros.html#266">Probe the interface</a></li>
<li><a href="libremacros.html#269">Read source code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="libremacros.html#269">11.2. Writing a macro using the dispatcher</a></li>
<li><a href="libremacros.html#269">11.3. Dispatch failure – an advanced clipboard example</a></li>
<li><a href="libremacros.html#270">11.4. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#271">12. StarDesktop</a>
<ul>
<li><a href="libremacros.html#271">12.1. The Frame service</a>
<ul>
<li><a href="libremacros.html#272">12.1.1. The XIndexAccess interface</a></li>
<li><a href="libremacros.html#272">12.1.2. Find frames with FrameSearchFlag constants</a></li>
</ul>
</li>
<li><a href="libremacros.html#274">12.2. The XEventBroadcaster interface</a></li>
<li><a href="libremacros.html#274">12.3. The XDesktop interface</a>
<ul>
<li><a href="libremacros.html#274">12.3.1. Closing the desktop and contained components</a></li>
<li><a href="libremacros.html#275">12.3.2. Enumerating components using XEnumerationAccess</a></li>
<li><a href="libremacros.html#276">12.3.3. Current component</a></li>
<li><a href="libremacros.html#277">12.3.4. Current component (again)</a></li>
<li><a href="libremacros.html#277">12.3.5. Current frame</a></li>
</ul>
</li>
<li><a href="libremacros.html#278">12.4. Load a document</a>
<ul>
<li><a href="libremacros.html#282">12.4.1. Named arguments</a></li>
<li><a href="libremacros.html#284">12.4.2. Loading a template</a></li>
<li><a href="libremacros.html#285">12.4.3. Enabling macros while loading a document</a></li>
<li><a href="libremacros.html#286">12.4.4. Importing and exporting</a></li>
<li><a href="libremacros.html#286">12.4.5. Filter names</a></li>
<li><a href="libremacros.html#292">12.4.6. Loading and saving documents</a></li>
<li><a href="libremacros.html#294">12.4.7. Error handling while loading a document</a></li>
</ul>
</li>
<li><a href="libremacros.html#294">12.5. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#295">13. Generic Document Methods</a>
<ul>
<li><a href="libremacros.html#295">13.1. Service Manager</a></li>
<li><a href="libremacros.html#296">13.2. Services and interfaces</a></li>
<li><a href="libremacros.html#297">13.3. Getting and setting properties</a></li>
<li><a href="libremacros.html#299">13.4. Document properties</a>
<ul>
<li><a href="libremacros.html#301">13.4.1. Document properties from a closed document</a></li>
<li><a href="libremacros.html#301">13.4.2. Custom properties</a></li>
<li><a href="libremacros.html#302">13.4.3. Deprecated document information object</a></li>
</ul>
</li>
<li><a href="libremacros.html#303">13.5. List events</a>
<ul>
<li><a href="libremacros.html#304">13.5.1. Registering your own listener</a></li>
<li><a href="libremacros.html#305">13.5.2. Intercepting dispatch commands</a></li>
</ul>
</li>
<li><a href="libremacros.html#307">13.6. Link targets</a></li>
<li><a href="libremacros.html#309">13.7. Accessing view data: XViewDataSupplier</a></li>
<li><a href="libremacros.html#310">13.8. Close a document: XCloseable</a></li>
<li><a href="libremacros.html#311">13.9. Draw Pages: XDrawPagesSupplier</a>
<ul>
<li><a href="libremacros.html#311">13.9.1. Draw and Impress</a></li>
<li><a href="libremacros.html#314">13.9.2. Draw lines with arrows in Calc</a></li>
<li><a href="libremacros.html#315">13.9.3. Writer</a></li>
</ul>
</li>
<li><a href="libremacros.html#316">13.10. The model</a>
<ul>
<li><a href="libremacros.html#317">13.10.1. Document arguments</a></li>
</ul>
</li>
<li><a href="libremacros.html#319">13.11. Saving a document</a></li>
<li><a href="libremacros.html#322">13.12. Manipulating styles</a>
<ul>
<li><a href="libremacros.html#327">13.12.1. Style utilities</a></li>
</ul>
</li>
<li><a href="libremacros.html#332">13.13. Dealing with locale</a></li>
<li><a href="libremacros.html#340">13.14. Enumerating printers</a></li>
<li><a href="libremacros.html#340">13.15. Printing documents</a>
<ul>
<li><a href="libremacros.html#344">13.15.1. Printing Writer documents</a></li>
<li><a href="libremacros.html#346">13.15.2. Printing Calc documents</a></li>
<li><a href="libremacros.html#347">13.15.3. A Calc example with a Print listener</a></li>
<li><a href="libremacros.html#349">13.15.4. Print examples by Vincent Van Houtte</a></li>
</ul>
</li>
<li><a href="libremacros.html#359">13.16. Creating services</a></li>
<li><a href="libremacros.html#360">13.17. Document settings</a></li>
<li><a href="libremacros.html#362">13.18. The coolest trick I know</a></li>
<li><a href="libremacros.html#362">13.19. Converting to a URL in other languages</a></li>
<li><a href="libremacros.html#362">13.20. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#363">14. Writer Documents</a>
<ul>
<li><a href="libremacros.html#364">14.1. Basic building blocks</a>
<ul>
<li><a href="libremacros.html#364">14.1.1. Primary text content: the XText interface</a></li>
<li><a href="libremacros.html#365">14.1.2. Text ranges: the XTextRange interface</a></li>
<li><a href="libremacros.html#367">14.1.3. Inserting simple text</a></li>
<li><a href="libremacros.html#367">14.1.4. Text content: the TextContent service</a></li>
</ul>
</li>
<li><a href="libremacros.html#369">14.2. Enumerating paragraphs</a>
<ul>
<li><a href="libremacros.html#369">14.2.1. Paragraph properties</a>
<ul>
<li><a href="libremacros.html#373">Insert a page break</a></li>
<li><a href="libremacros.html#374">Set the paragraph style</a></li>
</ul>
</li>
<li><a href="libremacros.html#374">14.2.2. Character properties</a></li>
<li><a href="libremacros.html#379">14.2.3. Enumerating text sections (paragraph portions)</a></li>
</ul>
</li>
<li><a href="libremacros.html#381">14.3. Graphics</a></li>
<li><a href="libremacros.html#384">14.4. Paste HTML then embed linked graphics</a></li>
<li><a href="libremacros.html#386">14.5. Cursors</a>
<ul>
<li><a href="libremacros.html#386">14.5.1. View cursors</a></li>
<li><a href="libremacros.html#388">14.5.2. Text (non-view) cursors</a></li>
<li><a href="libremacros.html#389">14.5.3. Using cursors to traverse text</a>
<ul>
<li><a href="libremacros.html#391">Keep the view cursor and text cursor in sync</a></li>
</ul>
</li>
<li><a href="libremacros.html#392">14.5.4. Accessing content using cursors</a></li>
</ul>
</li>
<li><a href="libremacros.html#394">14.6. Selected text</a>
<ul>
<li><a href="libremacros.html#395">14.6.1. Is text selected?</a></li>
<li><a href="libremacros.html#396">14.6.2. Selected text: Which end is which?</a></li>
<li><a href="libremacros.html#397">14.6.3. Selected text framework</a></li>
<li><a href="libremacros.html#399">14.6.4. Remove empty spaces and lines: A larger example</a>
<ul>
<li><a href="libremacros.html#399">What is white space?</a></li>
<li><a href="libremacros.html#400">Rank characters for deletion</a></li>
<li><a href="libremacros.html#401">Use the standard framework</a></li>
<li><a href="libremacros.html#401">The worker macro</a></li>
</ul>
</li>
<li><a href="libremacros.html#403">14.6.5. Selected text, closing thoughts</a></li>
</ul>
</li>
<li><a href="libremacros.html#403">14.7. Search and replace</a>
<ul>
<li><a href="libremacros.html#404">14.7.1. Searching selected text or a specified range</a></li>
<li><a href="libremacros.html#405">Searching for all occurrences</a></li>
<li><a href="libremacros.html#406">14.7.2. Searching and replacing</a></li>
<li><a href="libremacros.html#406">14.7.3. Advanced search and replace</a></li>
</ul>
</li>
<li><a href="libremacros.html#409">14.8. Text content</a></li>
<li><a href="libremacros.html#410">14.9. Text tables</a>
<ul>
<li><a href="libremacros.html#412">14.9.1. Using the correct text object</a></li>
<li><a href="libremacros.html#413">14.9.2. Methods and properties</a></li>
<li><a href="libremacros.html#415">14.9.3. Simple and complex tables</a></li>
<li><a href="libremacros.html#418">14.9.4. Tables contain cells</a></li>
<li><a href="libremacros.html#420">14.9.5. Using a table cursor</a></li>
<li><a href="libremacros.html#423">14.9.6. Formatting a text table</a></li>
</ul>
</li>
<li><a href="libremacros.html#424">14.10. Text fields</a>
<ul>
<li><a href="libremacros.html#433">14.10.1. Text master fields</a></li>
<li><a href="libremacros.html#435">14.10.2. Creating and adding text fields</a></li>
</ul>
</li>
<li><a href="libremacros.html#438">14.11. Bookmarks</a></li>
<li><a href="libremacros.html#439">14.12. Sequence fields, references, and formatting</a>
<ul>
<li><a href="libremacros.html#439">14.12.1. Formatting numbers and dates</a>
<ul>
<li><a href="libremacros.html#440">List formats known to the current document</a></li>
<li><a href="libremacros.html#440">Find or create a numeric format.</a></li>
<li><a href="libremacros.html#441">Default formats</a></li>
</ul>
</li>
<li><a href="libremacros.html#442">14.12.2. Create a field master</a></li>
<li><a href="libremacros.html#442">14.12.3. Insert a sequence field</a></li>
<li><a href="libremacros.html#443">14.12.4. Replace text with a sequence field</a></li>
<li><a href="libremacros.html#444">14.12.5. Create a GetReference field</a></li>
<li><a href="libremacros.html#445">14.12.6. Replace text with a GetReference field</a></li>
<li><a href="libremacros.html#447">14.12.7. The worker that ties it all together</a></li>
</ul>
</li>
<li><a href="libremacros.html#448">14.13. Table of contents</a></li>
<li><a href="libremacros.html#454">14.14. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#455">15. Calc Documents</a>
<ul>
<li><a href="libremacros.html#456">15.1. Accessing sheets</a></li>
<li><a href="libremacros.html#458">15.2. Sheet cells contain the data</a>
<ul>
<li><a href="libremacros.html#459">15.2.1. Cell address</a></li>
<li><a href="libremacros.html#459">15.2.2. Cell data</a></li>
<li><a href="libremacros.html#461">15.2.3. Cell properties</a></li>
<li><a href="libremacros.html#466">15.2.4. Cell annotations</a></li>
</ul>
</li>
<li><a href="libremacros.html#467">15.3. Uninterpreted XML Attributes</a></li>
<li><a href="libremacros.html#469">15.4. Sheet cell ranges</a>
<ul>
<li><a href="libremacros.html#469">15.4.1. Sheet cell range properties</a>
<ul>
<li><a href="libremacros.html#470">Validation settings</a></li>
<li><a href="libremacros.html#473">Conditional formatting</a></li>
</ul>
</li>
<li><a href="libremacros.html#473">15.4.2. Sheet cell range services</a>
<ul>
<li><a href="libremacros.html#473">Retrieving cells and ranges</a></li>
<li><a href="libremacros.html#474">Querying cells</a></li>
<li><a href="libremacros.html#475">Finding non-empty cells in a range</a></li>
<li><a href="libremacros.html#476">Using complex queries</a>
<ul>
<li><a href="libremacros.html#477">Query Precedents and Dependents</a></li>
<li><a href="libremacros.html#478">Query Column Differences</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="libremacros.html#478">15.4.3. Searching and replacing</a></li>
<li><a href="libremacros.html#479">15.4.4. Merging cells</a></li>
<li><a href="libremacros.html#479">15.4.5. Retrieving, inserting, and deleting columns and rows</a></li>
<li><a href="libremacros.html#481">15.4.6. Retrieving and setting data as an array</a></li>
<li><a href="libremacros.html#482">15.4.7. Computing functions on a range</a></li>
<li><a href="libremacros.html#483">15.4.8. Clearing cells and cell ranges</a></li>
<li><a href="libremacros.html#483">15.4.9. Automatic data fill</a></li>
<li><a href="libremacros.html#484">15.4.10. Array formulas</a></li>
<li><a href="libremacros.html#486">15.4.11. Computing multiple functions on a range</a></li>
<li><a href="libremacros.html#488">15.4.12. Cells with the same formatting</a></li>
<li><a href="libremacros.html#490">15.4.13. Sorting</a></li>
</ul>
</li>
<li><a href="libremacros.html#493">15.5. Sheets</a>
<ul>
<li><a href="libremacros.html#494">15.5.1. Linking to an external spreadsheet</a></li>
<li><a href="libremacros.html#496">15.5.2. Finding dependencies by using auditing functions</a></li>
<li><a href="libremacros.html#498">15.5.3. Outlines</a></li>
<li><a href="libremacros.html#498">15.5.4. Copying, moving, and inserting cells</a></li>
<li><a href="libremacros.html#500">15.5.5. Copy data between documents</a>
<ul>
<li><a href="libremacros.html#500">Data functions</a></li>
<li><a href="libremacros.html#500">Clipboard</a></li>
<li><a href="libremacros.html#501">Transferable content</a></li>
</ul>
</li>
<li><a href="libremacros.html#501">15.5.6. Data pilot and pivot tables</a>
<ul>
<li><a href="libremacros.html#501">A data pilot example</a>
<ul>
<li><a href="libremacros.html#502">Generating the data</a></li>
<li><a href="libremacros.html#503">Creating the data pilot table</a></li>
</ul>
</li>
<li><a href="libremacros.html#505">Manipulating data pilot tables</a>
<ul>
<li><a href="libremacros.html#505">Data pilot fields</a></li>
<li><a href="libremacros.html#506">Filtering data pilot fields</a></li>
<li><a href="libremacros.html#507">Tables</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="libremacros.html#507">15.5.7. Sheet cursors</a></li>
</ul>
</li>
<li><a href="libremacros.html#509">15.6. Calc documents</a>
<ul>
<li><a href="libremacros.html#510">15.6.1. Named range</a></li>
<li><a href="libremacros.html#512">15.6.2. Database range</a></li>
<li><a href="libremacros.html#513">15.6.3. Filters</a></li>
<li><a href="libremacros.html#516">15.6.4. Protecting documents and sheets</a></li>
<li><a href="libremacros.html#516">15.6.5. Controlling recalculation</a></li>
<li><a href="libremacros.html#516">15.6.6. Using Goal Seek</a></li>
</ul>
</li>
<li><a href="libremacros.html#517">15.7. Write your own Calc functions</a></li>
<li><a href="libremacros.html#519">15.8. Using the current controller</a>
<ul>
<li><a href="libremacros.html#519">15.8.1. Selected cells</a>
<ul>
<li><a href="libremacros.html#520">Enumerating the selected cells</a></li>
<li><a href="libremacros.html#521">Selecting text</a></li>
<li><a href="libremacros.html#521">The active cell</a></li>
</ul>
</li>
<li><a href="libremacros.html#522">15.8.2. General functionality</a></li>
</ul>
</li>
<li><a href="libremacros.html#524">15.9. Control Calc from Microsoft Office</a></li>
<li><a href="libremacros.html#525">15.10. Accessing Calc functions</a></li>
<li><a href="libremacros.html#525">15.11. Finding URLs in Calc</a></li>
<li><a href="libremacros.html#526">15.12. Importing and Exporting XML Files Using Calc</a>
<ul>
<li><a href="libremacros.html#526">15.12.1. Read an XML file</a></li>
<li><a href="libremacros.html#534">15.12.2. Write XML File</a></li>
</ul>
</li>
<li><a href="libremacros.html#544">15.13. Charts</a></li>
<li><a href="libremacros.html#550">15.14. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#551">16. Draw and Impress Documents</a>
<ul>
<li><a href="libremacros.html#552">16.1. Draw pages</a>
<ul>
<li><a href="libremacros.html#553">16.1.1. Generic draw page</a></li>
<li><a href="libremacros.html#555">16.1.2. Combining shapes</a></li>
</ul>
</li>
<li><a href="libremacros.html#557">16.2. Shapes</a>
<ul>
<li><a href="libremacros.html#560">16.2.1. Common attributes</a>
<ul>
<li><a href="libremacros.html#566">Drawing text service</a></li>
<li><a href="libremacros.html#568">MeasureShape</a></li>
<li><a href="libremacros.html#569">Drawing line properties</a></li>
<li><a href="libremacros.html#570">Filling space with a ClosedBezierShape</a></li>
<li><a href="libremacros.html#573">Shadows and a RectangleShape</a></li>
<li><a href="libremacros.html#574">Rotation and shearing</a></li>
</ul>
</li>
<li><a href="libremacros.html#575">16.2.2. Shape types</a>
<ul>
<li><a href="libremacros.html#575">Simple lines</a></li>
<li><a href="libremacros.html#576">PolyLineShape</a></li>
<li><a href="libremacros.html#578">PolyPolygonShape</a></li>
<li><a href="libremacros.html#578">RectangleShape and TextShape</a></li>
<li><a href="libremacros.html#579">EllipseShape</a></li>
<li><a href="libremacros.html#581">Bezier curves</a></li>
<li><a href="libremacros.html#584">ConnectorShape</a>
<ul>
<li><a href="libremacros.html#587">Creating your own glue points</a></li>
<li><a href="libremacros.html#587">Adding arrows by using styles</a></li>
</ul>
</li>
<li><a href="libremacros.html#589">Insert a TableShape</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="libremacros.html#590">16.3. Forms</a></li>
<li><a href="libremacros.html#592">16.4. Presentations</a>
<ul>
<li><a href="libremacros.html#594">16.4.1. Presentation draw pages</a></li>
<li><a href="libremacros.html#595">16.4.2. Presentation shapes</a></li>
</ul>
</li>
<li><a href="libremacros.html#597">16.5. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#598">17. Library Management</a>
<ul>
<li><a href="libremacros.html#598">17.1. Accessing libraries using OOo Basic</a></li>
<li><a href="libremacros.html#602">17.2. Libraries contained in a document</a></li>
<li><a href="libremacros.html#602">17.3. Writing an installer</a></li>
<li><a href="libremacros.html#604">17.4. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#605">18. Dialogs and Controls</a>
<ul>
<li><a href="libremacros.html#605">18.1. My first dialog</a>
<ul>
<li><a href="libremacros.html#608">18.1.1. The Properties dialog</a></li>
<li><a href="libremacros.html#610">18.1.2. Starting a dialog from a macro</a></li>
<li><a href="libremacros.html#611">18.1.3. Assign an event handler</a></li>
</ul>
</li>
<li><a href="libremacros.html#614">18.2. Dialog and control paradigm</a>
<ul>
<li><a href="libremacros.html#614">18.2.1. Dialog and control similarities</a></li>
<li><a href="libremacros.html#616">18.2.2. Dialog-specific methods</a></li>
<li><a href="libremacros.html#617">18.2.3. The dialog model</a></li>
</ul>
</li>
<li><a href="libremacros.html#619">18.3. Controls</a>
<ul>
<li><a href="libremacros.html#620">18.3.1. Control button</a></li>
<li><a href="libremacros.html#623">18.3.2. Check box</a></li>
<li><a href="libremacros.html#624">18.3.3. Radio button</a></li>
<li><a href="libremacros.html#625">18.3.4. Group box</a></li>
<li><a href="libremacros.html#626">18.3.5. Fixed line control</a></li>
<li><a href="libremacros.html#626">18.3.6. Combo box</a></li>
<li><a href="libremacros.html#627">18.3.7. Text edit controls</a>
<ul>
<li><a href="libremacros.html#629">Currency control</a></li>
<li><a href="libremacros.html#630">Numeric control</a></li>
<li><a href="libremacros.html#630">Date control</a></li>
<li><a href="libremacros.html#633">Time control</a></li>
<li><a href="libremacros.html#635">Formatted control</a></li>
<li><a href="libremacros.html#638">Pattern control</a></li>
<li><a href="libremacros.html#640">Fixed text control</a></li>
<li><a href="libremacros.html#640">File control</a></li>
</ul>
</li>
<li><a href="libremacros.html#642">18.3.8. Image control</a></li>
<li><a href="libremacros.html#642">18.3.9. Progress control</a></li>
<li><a href="libremacros.html#643">18.3.10. List box control</a></li>
<li><a href="libremacros.html#644">18.3.11. Scroll bar control</a></li>
</ul>
</li>
<li><a href="libremacros.html#647">18.4. Using the Step property for multi-page AutoPilot dialogs</a></li>
<li><a href="libremacros.html#647">18.5. The object inspector example</a>
<ul>
<li><a href="libremacros.html#647">18.5.1. Utility subroutines and functions</a>
<ul>
<li><a href="libremacros.html#648">Identifying and removing white space from a string</a></li>
<li><a href="libremacros.html#649">Convert a simple object to a string</a></li>
<li><a href="libremacros.html#652">Object inspection using Basic methods</a></li>
<li><a href="libremacros.html#653">Sort an array</a></li>
</ul>
</li>
<li><a href="libremacros.html#654">18.5.2. Creating a dialog at run time</a></li>
<li><a href="libremacros.html#658">18.5.3. Listeners</a>
<ul>
<li><a href="libremacros.html#658">Radio buttons</a></li>
<li><a href="libremacros.html#659">Inspect selected</a></li>
<li><a href="libremacros.html#660">Inspect previous</a></li>
</ul>
</li>
<li><a href="libremacros.html#660">18.5.4. Obtaining the debug information</a></li>
<li><a href="libremacros.html#665">18.5.5. Getting property values</a></li>
</ul>
</li>
<li><a href="libremacros.html#667">18.6. Conclusion</a></li>
</ul>
</li>
<li><a href="libremacros.html#668">19. Sources of Information</a>
<ul>
<li><a href="libremacros.html#668">19.1. Help pages included with OpenOffice.org</a></li>
<li><a href="libremacros.html#668">19.2. Macros included with OpenOffice.org</a></li>
<li><a href="libremacros.html#669">19.3. Web sites</a>
<ul>
<li><a href="libremacros.html#669">19.3.1. Reference material</a></li>
<li><a href="libremacros.html#669">19.3.2. Macro examples</a></li>
<li><a href="libremacros.html#669">19.3.3. Miscellaneous</a></li>
</ul>
</li>
<li><a href="libremacros.html#670">19.4. http://www.openoffice.org/api/ or http://api.libreoffice.org</a></li>
<li><a href="libremacros.html#671">19.5. Mailing lists and newsgroups</a></li>
<li><a href="libremacros.html#672">19.6. How to find answers</a></li>
<li><a href="libremacros.html#672">19.7. Conclusion</a></li>
</ul>
</li>
</ul>
<hr/>
</body>
</html>
