<!DOCTYPE html><html>
<head>
<title></title>
<style type="text/css">
<!--
.xflip {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    filter: fliph;
}
.yflip {
    -moz-transform: scaleY(-1);
    -webkit-transform: scaleY(-1);
    -o-transform: scaleY(-1);
    transform: scaleY(-1);
    filter: flipv;
}
.xyflip {
    -moz-transform: scaleX(-1) scaleY(-1);
    -webkit-transform: scaleX(-1) scaleY(-1);
    -o-transform: scaleX(-1) scaleY(-1);
    transform: scaleX(-1) scaleY(-1);
    filter: fliph + flipv;
}
-->
</style>
</head>
<body>
<a name=1></a>&#160;10. Universal&#160;Network&#160;Objects<br/>The internals&#160;of OpenOffice.org&#160;are based on Universal Network Objects&#160;(UNO).&#160;This chapter introduces&#160;<br/>the subroutines and functions&#160;supported by&#160;OpenOffice.org&#160;Basic&#160;that are related to&#160;UNO.&#160;This chapter&#160;<br/>covers methods&#160;that&#160;create&#160;and inspect&#160;objects that&#160;are vital to the&#160;internals&#160;of OpenOffice.org.<br/>
Up to&#160;this&#160;point,&#160;I&#160;have&#160;mostly&#160;dealt&#160;with simple&#160;single&#160;value things such as string and integer.&#160;An object,&#160;&#160;<br/>however,&#160;usually&#160;contains many&#160;values and it&#160;also has methods;&#160;for example, you can access&#160;a document&#160;as&#160;<br/>a variable&#160;and access information&#160;about&#160;the&#160;document&#160;(data or properties), and call&#160;methods&#160;that manipulate&#160;<br/>the document.<br/>
In&#160;this chapter,&#160;I&#160;begin to&#160;discuss&#160;things related&#160;to the&#160;actual&#160;implementation&#160;of OOo&#160;— things that&#160;allow&#160;<br/>you&#160;to&#160;exploit&#160;the internal capabilities of OOo.&#160;You’ll&#160;also begin to&#160;see&#160;more details about&#160;how OOo is&#160;<br/>implemented&#160;— which you&#160;need to&#160;build&#160;the really&#160;cool&#160;stuff.<br/>
Are you&#160;a programmer or a highly&#160;technical&#160;person?&#160;If&#160;not,&#160;skip this paragraph and go&#160;directly&#160;to the&#160;tip.&#160;<br/>Still reading?&#160;Great, so UNO&#160;is:<br/>
•<br/>
The interface based component model&#160;for OOo.&#160;<br/>
•<br/>
Enables interoperability&#160;between programming&#160;languages, object models and hardware architectures,<br/>either in&#160;process&#160;or over process boundaries, as well&#160;as in the&#160;intranet&#160;or the&#160;Internet.<br/>
•<br/>
New&#160;languages are supported&#160;by&#160;adding&#160;a language binding.&#160;This is also&#160;stated as adding a “bridge”&#160;<br/>or “adapter”.&#160;This&#160;paradigm&#160;makes it&#160;easier to support multiple languages.<br/>
•<br/>
UNO components&#160;may&#160;be implemented&#160;in, and accessed from, any&#160;programming language with a&#160;<br/>complete language binding.<br/>
TIP<br/>
You can write powerful macros without fully&#160;understand Universal Network Objects. Just&#160;think&#160;of&#160;a&#160;UNO&#160;<br/>
as any&#160;object&#160;that is used&#160;internally&#160;by&#160;OOo.<br/>
Stated&#160;more&#160;simply:&#160;The internal parts&#160;of OOo are used as Universal&#160;Network Objects. By&#160;using UNOs, it is&#160;<br/>possible to&#160;access&#160;an instance&#160;of OOo running&#160;on a different&#160;computer and operating system.&#160;A&#160;vague&#160;<br/>understanding of Universal&#160;Network Objects&#160;is important&#160;because most&#160;of the internals&#160;of OpenOffice.org&#160;<br/>are implemented using UNO.&#160;<br/>
Table&#160;88 lists the&#160;OOo Basic&#160;functions used to deal&#160;with&#160;UNO.<br/>
228<br/>
<hr/>
<a name=2></a>Table&#160;88.&#160;Functions related to&#160;Universal&#160;Network Objects in&#160;OOo Basic.<br/>
Function<br/>
Description<br/>
BasicLibraries<br/>
Access Basic&#160;libraries stored&#160;in a&#160;document.<br/>
CreateObject(obj_type)<br/>
Able&#160;to create&#160;any&#160;standard&#160;type,&#160;more&#160;flexible&#160;than&#160;<br/>CreateUnoStruct&#160;and&#160;CreateUnoService.<br/>
CreateUnoDialog()<br/>
Create an existing&#160;dialog.<br/>
CreateUnoListener()<br/>
Create a&#160;listener.<br/>
CreateUnoService()&#160;<br/>
Create a&#160;Universal&#160;Network&#160;Object Service.<br/>
CreateUnoStruct()<br/>
Create a&#160;Universal&#160;Network&#160;Object Structure.<br/>
CreateUnoValue()<br/>
Create a&#160;Universal&#160;Network&#160;Object value.<br/>
DialogLibraries<br/>
Access dialog&#160;libraries stored in&#160;a&#160;document.<br/>
EqualUNOObjects()<br/>
Determine if&#160;two UNO&#160;objects&#160;reference&#160;the&#160;same&#160;<br/>instance.<br/>
FindObject()<br/>
Find&#160;a named&#160;object;&#160;do&#160;not use.<br/>
FindPropertyObject()<br/>
Find&#160;object&#160;property&#160;based&#160;on&#160;name;&#160;do&#160;not use.<br/>
GetDefaultContext()<br/>
Get a&#160;copy&#160;of&#160;the&#160;default&#160;context.<br/>
GetProcessServiceManager()<br/>
Get service&#160;manager.<br/>
GlobalScope<br/>
Application-level libraries.<br/>
HasUnoInterfaces()<br/>
Does an object support specified&#160;interfaces?<br/>
IsUnoStruct()<br/>
Is&#160;this variable&#160;a&#160;Universal Network Object?<br/>
StarDesktop<br/>
Special variable&#160;representing&#160;the&#160;desktop object.<br/>
ThisComponent<br/>
Special variable&#160;representing&#160;the&#160;current&#160;document.<br/>
&#160;10.1.&#160;Base&#160;types and structures<br/>Most&#160;of the internal data used by&#160;OOo is based on standard types such as strings and numbers.&#160;These types&#160;<br/>are combined&#160;into&#160;structures (called&#160;structs), which act&#160;like&#160;user-defined&#160;data types.&#160;The structures are&#160;<br/>combined&#160;to form&#160;more complex&#160;UNO&#160;objects.&#160;A&#160;struct&#160;supports properties but&#160;not&#160;methods.&#160;<br/>
A&#160;structure provides&#160;a&#160;method of placing more than one&#160;value into a single&#160;variable.&#160;You access&#160;the&#160;values&#160;in<br/>a structure based on a name&#160;that&#160;is decided when the&#160;struct&#160;type is designed by&#160;a&#160;programmer.&#160;A&#160;commonly&#160;<br/>used struct is the&#160;PropertyValue, whose primary&#160;purpose is to&#160;hold a string name&#160;and a&#160;variant value.&#160;The&#160;<br/>following&#160;listing&#160;demonstrates creating a PropertyValue structure and then setting the&#160;name&#160;and the value.&#160;<br/>The contained properties are accessed by&#160;placing a period&#160;between the&#160;variable&#160;and the property&#160;name.&#160;<br/>
Listing&#160;203.&#160;Use Dim&#160;As New to&#160;create&#160;a UNO structure.<br/>
Dim&#160;aProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>aProp.Name&#160;=&#160;&#34;FirstName&#34;&#160; &#160; &#160; &#160;'Set the Name property<br/>aProp.Value&#160;=&#160;&#34;Paterton&#34;&#160; &#160; &#160; &#160;'Set the Value property<br/>
TIP<br/>
OOo objects have&#160;long&#160;names such&#160;as&#160;com.sun.star.beans.PropertyValue; in the&#160;text&#160;I&#160;usually&#160;abbreviate&#160;the<br/>name&#160;and&#160;simply&#160;write&#160;PropertyValue,&#160;but your&#160;macros must use&#160;the&#160;full name.<br/>
229<br/>
<hr/>
<a name=3></a>You must&#160;create&#160;(or obtain) a UNO&#160;structure before you&#160;can use it.&#160;The most&#160;common method to&#160;create&#160;a&#160;<br/>UNO structure is to&#160;use Dim&#160;As New (see&#160;Listing 203).&#160;You can also use Dim&#160;to&#160;create&#160;an array&#160;of&#160;<br/>structures.<br/>
Listing&#160;204.&#160;Use Dim&#160;As New to&#160;create&#160;an array of&#160;UNO structures.<br/>Dim&#160;aProp(4)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>aProp(0).Name&#160;&#160;=&#160;&#34;FirstName&#34;&#160; &#160;'Set the Name property<br/>aProp(0).Value&#160;=&#160;&#34;Clyde&#34;&#160; &#160; &#160; &#160;'Set the Value property<br/>
Use the CreateUnoStruct&#160;function&#160;to&#160;create a&#160;UNO structure when it&#160;is&#160;needed rather than&#160;declare&#160;it&#160;ahead of<br/>time. Dynamically&#160;creating&#160;a UNO&#160;structure allows the&#160;name of the structure to be provided at&#160;run time&#160;<br/>rather than&#160;compile&#160;time.&#160;Providing&#160;a name at&#160;run time&#160;is shown in&#160;Listing&#160;205 and Listing&#160;208. Providing a&#160;<br/>name at&#160;compile&#160;time is&#160;shown in&#160;Listing 203.<br/>
Listing&#160;205.&#160;Use CreateUnoStruct&#160;to create a UNO structure.<br/>Dim&#160;aProp<br/>aProp&#160;=&#160;CreateUnoStruct(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>aProp.Name&#160;=&#160;&#34;FirstName&#34;&#160; &#160; &#160; &#160;'Set the Name property<br/>aProp.Value&#160;=&#160;&#34;Andrew&#34; &#160;&#160; &#160; &#160; &#160;'Set the Value property<br/>
The&#160;With&#160;statement&#160;simplifies the&#160;process&#160;of setting&#160;the&#160;properties&#160;of a structure.<br/>
Listing&#160;206.&#160;Use With to&#160;simplify&#160;setting properties on structures.<br/>
Dim&#160;aProp(4)&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>With&#160;aProp(0)<br/>&#160;&#160;.Name&#160;=&#160;&#34;FirstName&#34;&#160; &#160; &#160; &#160;'Set the Name property<br/>&#160;&#160;.Value&#160;=&#160;&#34;Paterton&#34;&#160; &#160; &#160; &#160;'Set the Value property<br/>End&#160;With<br/>
The function CreateUnoStruct&#160;used to&#160;be the only&#160;method&#160;to&#160;create&#160;a UNO structure. It&#160;is used less since&#160;the&#160;<br/>introduction&#160;of the&#160;“Dim&#160;As New” syntax.&#160;The CreateObject&#160;function&#160;is a more general&#160;function&#160;than&#160;<br/>CreateUnoStruct.&#160;It&#160;is able to&#160;create instances of all types supported&#160;by&#160;the Basic&#160;internal factory&#160;<br/>mechanism.&#160;This includes&#160;user-defined&#160;types.<br/>
Listing&#160;207.&#160;Create&#160;a user-defined&#160;type&#160;with&#160;CreateObject&#160;or Dim&#160;As.<br/>
Type&#160;PersonType<br/>&#160;&#160;FirstName&#160;As&#160;String<br/>&#160;&#160;LastName&#160;As&#160;String<br/>End&#160;Type<br/>
Sub&#160;ExampleCreateNewType<br/>&#160;&#160;Dim&#160;Person&#160;As&#160;PersonType<br/>&#160;&#160;Person.FirstName&#160;=&#160;&#34;Andrew&#34;<br/>&#160;&#160;Person.LastName&#160;&#160;=&#160;&#34;Pitonyak&#34;<br/>&#160;&#160;PrintPerson(Person)<br/>&#160;&#160;Dim&#160;Me&#160;As&#160;Object<br/>&#160;&#160;Me&#160;=&#160;CreateObject(&#34;PersonType&#34;)<br/>&#160;&#160;Me.FirstName&#160;=&#160;&#34;Andy&#34;<br/>&#160;&#160;Me.LastName&#160;&#160;=&#160;&#34;Pitonyak&#34;<br/>&#160;&#160;PrintPerson(Me)<br/>End&#160;Sub<br/>
Sub&#160;PrintPerson(x)<br/>&#160;&#160;Print&#160;&#34;Person = &#34;&#160;&amp;&#160;x.FirstName&#160;&amp;&#160;&#34; &#34;&#160;&amp;&#160;x.LastName<br/>End&#160;Sub<br/>
230<br/>
<hr/>
<a name=4></a>TIP<br/>
For&#160;a&#160;user-defined type,&#160;“Dim&#160;As&#160;New”&#160;and&#160;“Dim&#160;As”&#160;both work. For&#160;a&#160;UNO&#160;struct, however,&#160;you&#160;must&#160;<br/>
use&#160;“Dim&#160;As&#160;New”.<br/>
The CreateObject&#160;function&#160;accepts the&#160;same&#160;arguments as CreateUnoStruct,&#160;but&#160;it&#160;works for all&#160;supported&#160;<br/>types, whereas CreateUnoStruct&#160;works only&#160;for UNO structures.&#160;Therefore, there is&#160;no reason to use&#160;<br/>CreateUnoStruct&#160;rather than&#160;CreateObject.<br/>
Listing&#160;208.&#160;Use CreateObject&#160;to create a UNO structure.<br/>
Dim&#160;aProp<br/>aProp&#160;=&#160;CreateObject(&#34;com.sun.star.beans.PropertyValue&#34;)<br/>aProp.Name&#160;=&#160;&#34;FirstName&#34;&#160; &#160; &#160; &#160;'Set the Name property<br/>aProp.Value&#160;=&#160;&#34;Paterton&#34;&#160; &#160; &#160; &#160;'Set the Value property<br/>
TIP<br/>
CreateObject offers more&#160;flexibility&#160;than CreateUnoStruct to dynamically&#160;create&#160;objects based&#160;on a&#160;name.<br/>
I&#160;wrote a&#160;small&#160;test&#160;program that created 20000 structs. CreateUnoStruct&#160;and CreateObject&#160;took about the&#160;<br/>same&#160;amount&#160;of time.&#160;Using Dim&#160;As New,&#160;however,&#160;used 500 clock ticks less, which&#160;is useful&#160;if you want&#160;to<br/>make&#160;a macro run as fast&#160;as possible.<br/>
The&#160;TypeName function indicates that&#160;a UNO&#160;structure is&#160;an object. Use the&#160;IsUnoStruct&#160;function to&#160;<br/>determine&#160;if a variable&#160;is a UNO&#160;structure.<br/>
Listing&#160;209.&#160;Use IsUnoStruct&#160;to&#160;check&#160;if&#160;an object&#160;is&#160;an UNO Struct.<br/>Dim&#160;aProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>Print&#160;TypeName(aProp)&#160; &#160; &#160;'Object<br/>Print&#160;IsUnoStruct(aProp)&#160;&#160;'True<br/>
&#160;10.2.&#160;UNO&#160;interface<br/>An interface defines how something interacts&#160;with its environment.&#160;A&#160;UNO&#160;interface resembles a group of&#160;<br/>subroutine and function&#160;declarations;&#160;arguments and return&#160;types are specified along with functionality.&#160;<br/>
You can use the&#160;interface to&#160;retrieve&#160;data from&#160;an object, set&#160;data&#160;in an object,&#160;or tell&#160;an object&#160;to do&#160;<br/>something.&#160;The interface&#160;indicates how&#160;an object&#160;can be used, but&#160;it&#160;says&#160;nothing about&#160;the&#160;implementation.&#160;<br/>For&#160;example, if an interface contains the&#160;method&#160;GetHeight&#160;that returns an integer,&#160;it’s&#160;natural&#160;to&#160;assume&#160;that<br/>the object&#160;contains&#160;an integer property&#160;named&#160;Height.&#160;It’s&#160;possible,&#160;however,&#160;that&#160;the&#160;height&#160;is derived&#160;or&#160;<br/>calculated&#160;from&#160;other properties.&#160;The interface does not&#160;specify&#160;how the&#160;height is&#160;obtained, just&#160;that&#160;it&#160;is&#160;<br/>available.&#160;A&#160;UNO structure, however,&#160;contains properties that are accessed directly;&#160;the internal&#160;<br/>representation&#160;is not&#160;hidden.<br/>
TIP<br/>
UNO&#160;interface&#160;names start with&#160;the capital letter&#160;X.<br/>When&#160;you want&#160;to&#160;know&#160;what methods are&#160;supported&#160;by&#160;an object,&#160;check&#160;the&#160;interfaces.<br/>
UNO interface names&#160;start&#160;with&#160;the capital letter X, which makes it&#160;easy&#160;to&#160;recognize&#160;an interface;&#160;for&#160;<br/>example,&#160;the interface com.sun.star.text.XTextRange specifies a section of text&#160;with&#160;both a start&#160;and end&#160;<br/>position. Objects that&#160;support the&#160;XTextRange interface are also used to identify&#160;an object’s&#160;position in&#160;text&#160;<br/>document.&#160;The start and end positions&#160;may&#160;be the&#160;same.&#160;The XTextRange interface&#160;defines the methods in<br/>Table&#160;89.<br/>
231<br/>
<hr/>
<a name=5></a>Table&#160;89.&#160;Methods defined by&#160;the com.sun.star.text.XTextRange interface.<br/>
Method<br/>
Description<br/>
getText()<br/>
Return the&#160;com.sun.star.text.XText interface&#160;that contains&#160;this&#160;XTextRange.<br/>
getStart()<br/>
Return a&#160;com.sun.star.text.XTextRange&#160;that references only&#160;the&#160;start position.<br/>
getEnd()<br/>
Return a&#160;com.sun.star.text.XTextRange&#160;that references only&#160;the&#160;end&#160;position.<br/>
getString()<br/>
Return a&#160;string&#160;that includes the&#160;text&#160;inside&#160;this&#160;text&#160;range.<br/>
setString(str)<br/>
Set&#160;the&#160;string&#160;for&#160;this&#160;text&#160;range,&#160;replacing&#160;existing&#160;text and clearing&#160;all&#160;styles.<br/>
TIP<br/>
A&#160;UNO interface&#160;may&#160;be&#160;derived from&#160;another.&#160;Every&#160;UNO interface&#160;is required&#160;to be&#160;derived&#160;from&#160;<br/>
com.sun.star.uno.XInterface.<br/>
A&#160;new UNO&#160;interface may&#160;be derived from&#160;another.&#160;This is not&#160;something that&#160;you do, but&#160;rather it’s&#160;<br/>something that&#160;is done by&#160;the designer of the interface.&#160;The derived interface supports&#160;all&#160;of the&#160;methods&#160;<br/>defined&#160;in the&#160;interface&#160;from&#160;which&#160;it&#160;is derived. For example,&#160;the com.sun.star.text.XTextCursor extends&#160;<br/>the XTextRange interface&#160;to&#160;allow it&#160;to&#160;change the&#160;range, which makes sense if you&#160;think about what you&#160;do&#160;<br/>with a cursor.&#160;Any&#160;object&#160;that&#160;implements&#160;the XTextCursor interface, supports the&#160;methods&#160;in&#160;Table 89 and&#160;<br/>the new methods introduced by&#160;the XTextCursor interface.&#160;<br/>
The main&#160;points&#160;regarding interfaces (so far) are:<br/>
1)&#160;An interface&#160;defines methods.&#160;In&#160;other words, an interface defines what&#160;an object&#160;can do;&#160;including&#160;<br/>
getting&#160;and setting&#160;internal&#160;properties.<br/>
2)&#160;An interface&#160;may&#160;be derived&#160;from&#160;another interface.<br/>
3)&#160;The last portion&#160;of an interface name begins with&#160;an X.<br/>
In&#160;UNO, objects&#160;are accessed by&#160;their&#160;interface. Many&#160;of the programming languages, such as Java&#160;and C++,<br/>force&#160;you&#160;to&#160;perform&#160;a little UNO magic and extract&#160;the&#160;correct interface before you can call the&#160;methods&#160;<br/>defined&#160;in the&#160;interface. OOo Basic hides these details&#160;for you&#160;so that&#160;you&#160;can directly&#160;call&#160;methods and&#160;<br/>access properties directly.<br/>
TIP<br/>
OOo Basic&#160;hides many&#160;of&#160;the&#160;complicated&#160;details,&#160;so, for&#160;most things, it is easier&#160;to write an OOo&#160;Basic&#160;<br/>program&#160;than to write a&#160;Java&#160;script.<br/>
&#160;10.3.&#160;UNO&#160;service<br/>A&#160;service&#160;abstractly&#160;defines an object&#160;by&#160;combining&#160;interfaces and properties to&#160;encapsulate some useful&#160;<br/>functionality.&#160;A&#160;UNO&#160;interface defines&#160;how an object&#160;interacts with&#160;the outside world;&#160;a UNO&#160;structure&#160;<br/>defines a collection&#160;of data;&#160;and a&#160;UNO&#160;service&#160;combines them&#160;together.&#160;Like a&#160;UNO&#160;interface, a&#160;UNO&#160;<br/>service&#160;does not specify&#160;the&#160;implementation. It&#160;only&#160;specifies how to&#160;interact&#160;with the&#160;object.&#160;<br/>
Almost&#160;every&#160;UNO object&#160;is&#160;defined&#160;by&#160;a service, so UNO&#160;objects&#160;are called&#160;services. Strictly&#160;speaking,&#160;<br/>however,&#160;“a service”&#160;is&#160;the object&#160;definition.&#160;The UNO object&#160;is&#160;the actual object&#160;created as defined by&#160;the&#160;<br/>service.&#160;A&#160;service&#160;may&#160;include&#160;multiple&#160;services and interfaces.&#160;An interface&#160;usually&#160;defines a single&#160;aspect&#160;<br/>of a service&#160;and therefore is&#160;usually&#160;smaller in scope.<br/>
Many&#160;services have a&#160;name&#160;similar to&#160;an interface&#160;name;&#160;for example, one&#160;of the&#160;interfaces exported by&#160;the&#160;<br/>TextCursor service&#160;is the&#160;XTextCursor interface.&#160;An interface or property&#160;may&#160;be declared as optional for a&#160;<br/>service.&#160;The XWordCursor interface&#160;is&#160;marked as optional&#160;for the&#160;TextCursor service.&#160;The implication&#160;is that<br/>
232<br/>
<hr/>
<a name=6></a>not&#160;all text&#160;cursors support&#160;the&#160;word cursor interface. In&#160;practice, you learn which text&#160;cursors support&#160;which<br/>interfaces and then simply&#160;use them.<br/>
There are two typical methods for obtaining a&#160;service.&#160;<br/>
•&#160;Get a&#160;reference&#160;to&#160;an existing object;&#160;for example, retrieving the first text&#160;table in&#160;the current&#160;<br/>
document.<br/>
•&#160;Ask a service&#160;factory&#160;to&#160;create&#160;an instance&#160;of an object;&#160;for example, if I&#160;want&#160;to&#160;insert&#160;a new text&#160;<br/>
table&#160;into&#160;a document, I&#160;ask the&#160;document&#160;to&#160;give me&#160;a&#160;new empty&#160;table,&#160;which&#160;I&#160;then configure and&#160;<br/>insert&#160;into the&#160;document.<br/>
A&#160;service&#160;factory&#160;returns objects based on the name.&#160;The process&#160;service&#160;manager is&#160;the main object factory&#160;<br/>for OpenOffice.org.&#160;The factory&#160;is given the&#160;service&#160;name,&#160;and the&#160;factory&#160;decides what&#160;to&#160;return.&#160;A&#160;factory&#160;<br/>may&#160;return a brand new instance&#160;of an object, or,&#160;it&#160;may&#160;return&#160;an existing instance. Use&#160;<br/>GetProcessServiceManager() to&#160;obtain&#160;a reference to&#160;the&#160;process&#160;service&#160;manager.&#160;Use CreateInstance&#160;to&#160;<br/>create&#160;a service&#160;from the&#160;process service&#160;manager as shown in&#160;Listing 210.&#160;<br/>
Listing&#160;210.&#160;Use process service&#160;manager to&#160;create a service.<br/>Sub&#160;ManagerCreatesAService<br/>&#160;&#160;Dim&#160;vFileAccess<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dim&#160;vManager<br/>&#160;&#160;vManager&#160;=&#160;GetProcessServiceManager()<br/>&#160;&#160;vFileAccess&#160;=&#160;vManager.CreateInstance(&#34;com.sun.star.ucb.SimpleFileAccess&#34;)<br/>&#160;&#160;s&#160;=&#160;vFileAccess.getContentType(&#34;http://www.pitonyak.org/AndrewMacro.odt&#34;)<br/>&#160;&#160;Print&#160;s<br/>End&#160;Sub<br/>
The code in&#160;Listing 210 obtains&#160;the process&#160;service&#160;manager,&#160;creates an instance&#160;of the SimpleFileAccess&#160;<br/>service, and then uses the created&#160;service.&#160;The CreateUnoService&#160;function is&#160;a shortcut&#160;for creating a UNO&#160;<br/>service&#160;(see&#160;Listing&#160;211).&#160;The purpose of Listing 211&#160;is&#160;to demonstrate the CreateUnoService&#160;function,&#160;<br/>showing&#160;that&#160;it’s&#160;simpler than creating a service&#160;manager.&#160;Listing 211&#160;also demonstrates some&#160;useful&#160;<br/>functionality,&#160;using&#160;a dialog to&#160;choose a file.<br/>
Listing&#160;211.&#160; Select&#160;a file&#160;on disk.<br/>Function&#160;ChooseAFileName()&#160;As&#160;String<br/>&#160;&#160;Dim&#160;vFileDialog&#160; &#160; &#160; &#160; &#160;'FilePicker service instance<br/>&#160;&#160;Dim&#160;vFileAccess&#160; &#160; &#160; &#160; &#160;'SimpleFileAccess service&#160;instance<br/>&#160;&#160;Dim&#160;iAccept&#160;as&#160;Integer&#160;&#160;'Response to the FilePicker<br/>&#160;&#160;Dim&#160;sInitPath&#160;as&#160;String&#160;'Hold the initial path<br/>&#160;&#160;'Note: The following services MUST be called in the following order<br/>&#160;&#160;'or Basic will not remove&#160;the FileDialog Service<br/>&#160;&#160;vFileDialog&#160;=&#160;CreateUnoService(&#34;com.sun.star.ui.dialogs.FilePicker&#34;)<br/>&#160;&#160;vFileAccess&#160;=&#160;CreateUnoService(&#34;com.sun.star.ucb.SimpleFileAccess&#34;)<br/>&#160;&#160;'Set the initial path here!<br/>&#160;&#160;sInitPath&#160;=&#160;ConvertToUrl(CurDir)<br/>&#160;&#160;If&#160;vFileAccess.Exists(sInitPath)&#160;Then<br/>&#160; &#160;&#160;vFileDialog.SetDisplayDirectory(sInitPath)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;iAccept&#160;=&#160;vFileDialog.Execute()&#160; &#160; &#160; &#160;'Run the file chooser dialog<br/>&#160;&#160;If&#160;iAccept&#160;=&#160;1&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'What was the return value?<br/>&#160; &#160;&#160;ChooseAFileName&#160;=&#160;vFileDialog.Files(0)&#160;'Set file name if it was not canceled<br/>
233<br/>
<hr/>
<a name=7></a>&#160;&#160;End&#160;If<br/>&#160;&#160;vFileDialog.Dispose()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Dispose of the dialog<br/>End&#160;Function<br/>
A&#160;directory&#160;can be chosen similarly.<br/>
Listing&#160;212.&#160; Select&#160;a directory.<br/>REM sInPath specifies the&#160;initial directory. If the initial directory<br/>REM is not specified, then&#160;the user's default work directory is used.<br/>REM The selected directory&#160;is returned as a URL.<br/>Function&#160;ChooseADirectory(Optional&#160;sInPath$)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;oDialog&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;oSFA&#160;As&#160;Object<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;Dim&#160;&#160;oPathSettings<br/>
&#160;&#160;oDialog&#160;=&#160;CreateUnoService(&#34;com.sun.star.ui.dialogs.FolderPicker&#34;)<br/>&#160;&#160;'oDialog = CreateUnoService(&#34;com.sun.star.ui.dialogs.OfficeFolderPicker&#34;)<br/>&#160;&#160;oSFA&#160;=&#160;createUnoService(&#34;com.sun.star.ucb.SimpleFileAccess&#34;)<br/>&#160;<br/>&#160;&#160;If&#160;IsMissing(sInPath)&#160;Then<br/>&#160;&#160;oPathSettings&#160;=&#160;CreateUnoService(&#34;com.sun.star.util.PathSettings&#34;)<br/>&#160; &#160;&#160;oDialog.setDisplayDirectory(oPathSettings.Work)<br/>&#160;&#160;ElseIf&#160;oSFA.Exists(sInPath)&#160;Then<br/>&#160; &#160;&#160;oDialog.setDisplayDirectory(sInPath)<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;Directory '&#34;&#160;&amp;&#160;sInPath&#160;&amp;&#160;&#34;' Does not exist&#34;<br/>&#160; &#160;&#160;If&#160;MsgBox(s,&#160;33,&#160;&#34;Error&#34;)&#160;=&#160;2&#160;Then&#160;Exit&#160;Function<br/>&#160;&#160;End&#160;If<br/>&#160;<br/>&#160;&#160;If&#160;oDialog.Execute()&#160;=&#160;1&#160;Then<br/>&#160; &#160;&#160;ChooseADirectory()&#160;=&#160;oDialog.getDirectory()<br/>&#160;&#160;End&#160;If<br/>End&#160;Function<br/>
TIP<br/>
The&#160;file&#160;picker&#160;and folder&#160;picker&#160;dialogs can use&#160;either&#160;the&#160;operating&#160;system&#160;supplied&#160;default dialogs,&#160;or&#160;<br/>
OOo specific&#160;dialogs.&#160;The&#160;operating&#160;system&#160;specific&#160;dialogs provide&#160;less functionality; for&#160;example,&#160;you&#160;<br/>cannot set the&#160;initial displayed&#160;directory.&#160;Use&#160;Tools &gt; Options &gt; OpenOffice.org&#160;&gt;&#160;General&#160;and place&#160;a&#160;<br/>
check&#160;next to &#34;Use&#160;OpenOffice.org&#160;dialogs&#34;.<br/>
The code in&#160;Listing 211&#160;creates two UNO services by&#160;using&#160;the function CreateUnoService.&#160;There&#160;are times,<br/>however,&#160;when the service&#160;manager is required. For&#160;example, the&#160;service&#160;manager has methods&#160;to create&#160;a&#160;<br/>service&#160;with&#160;arguments, CreateInstanceWithArguments, and to obtain a&#160;list&#160;of all supported services,&#160;<br/>getAvailableServiceNames().&#160;The code in&#160;Listing&#160;213 obtains a list&#160;of the supported service&#160;names; there&#160;are<br/>1003 services on my&#160;computer using OOo version 3.2.1;&#160;up from&#160;562 with OOo version&#160;1.<br/>
Listing&#160;213.&#160;Service&#160;manager supports services.<br/>
Sub&#160;HowManyServicesSupported<br/>&#160;&#160;Dim&#160;oDoc&#160; &#160; &#160; &#160; &#160;&#160;' Document created to hold&#160;the service names.<br/>&#160;&#160;Dim&#160;oText&#160; &#160; &#160; &#160; &#160;' Document text object.<br/>&#160;&#160;Dim&#160;oSD&#160; &#160; &#160; &#160; &#160; &#160;' SortDescriptor created for the document.<br/>&#160;&#160;Dim&#160;oCursor&#160; &#160; &#160; &#160;' Text cursor used for sorting.<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160; &#160;&#160;' Index Variable.<br/>&#160;&#160;Dim&#160;sServices<br/>
234<br/>
<hr/>
<a name=8></a>&#160;&#160;sServices&#160;=&#160;GetProcessServiceManager().getAvailableServiceNames()<br/>&#160;&#160;Print&#160;&#34;Service manager supports&#160;&#34;;UBound(sServices);&#34; services&#34;<br/>&#160;&#160;' Create a Writer document.<br/>
&#160;&#160;oDoc&#160;=&#160;StarDesktop.loadComponentFromURL(&#160;&#34;private:factory/swriter&#34;,&#160;&#34;_blank&#34;,&#160;0,&#160;Array()&#160;)<br/>&#160;&#160;oText&#160;=&#160;oDoc.getText()<br/>&#160; &#160;<br/>&#160;&#160;' Print the service names&#160;into a Writer document.<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(&#160;sServices&#160;)&#160;To&#160;UBound(&#160;sServices&#160;)<br/>&#160; &#160;&#160;oText.insertString(&#160;oText.getEnd(),&#160;sServices(i),&#160;False&#160;)<br/>&#160; &#160;&#160;' Do not insert a blank line at the end.<br/>&#160; &#160;&#160;oText.insertControlCharacter(&#160;oText.getEnd(),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#160;com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK,&#160;False&#160;)<br/>&#160;&#160;Next<br/>&#160;&#160;<br/>&#160;&#160;oCursor&#160;=&#160;oDoc.Text.CreateTextCursorByRange(oDoc.Text)<br/>&#160;&#160;oSD&#160;=&#160;oCursor.createSortDescriptor()<br/>&#160;&#160;oCursor.sort(oSD)<br/>&#160;&#160;<br/>&#160;&#160;oText.insertString(&#160;oText.getStart(),&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160;&#34;Service manager supports&#160;&#34;&amp;UBound(sServices)&amp;&#34; services&#34;,&#160;False&#160;)<br/>End&#160;Sub<br/>
It&#160;is useful&#160;to look&#160;at&#160;the&#160;list of supported&#160;services.&#160;This provides insight&#160;into&#160;available&#160;functionality&#160;that&#160;you<br/>can explore.&#160;A&#160;great example&#160;of this is&#160;shown&#160;Listing 214.&#160;An object&#160;inserted into a document&#160;must&#160;be&#160;<br/>created by&#160;that document. Using the methods of&#160;Listing 213, you&#160;can check to&#160;see&#160;what types of objects&#160;the&#160;<br/>document&#160;can create.&#160;<br/>
Listing&#160;214.&#160;What&#160;objects can a document&#160;create.<br/>REM Print the object / service types that a document can&#160;create.<br/>REM If the document (oDoc)&#160;is missing, the current document is used.<br/>REM If nameFilter is included, then service names that contain<br/>REM the string are printed; based on a case insensitive compare.<br/>REM The service names are&#160;stored in a newly created Write&#160;document.<br/>Sub&#160;TypesDocCanCreate(Optional&#160;oDoc, Optional&#160;nameFilter$)<br/>&#160; Dim&#160;allNames&#160; &#160;' List of all the names.<br/>&#160; Dim&#160;oWriteDoc&#160;&#160;' Newly created Write document to contain the names.<br/>&#160; Dim&#160;oText&#160; &#160; &#160;&#160;' Document text object.<br/>&#160; Dim&#160;s&#160;:&#160;s&#160;=&#160;&#34;private:factory/swriter&#34;<br/>
&#160;&#160;' Find out what this document can create. &#160;<br/>&#160; If IsMissing(oDoc) Then<br/>&#160; &#160;&#160;allNames&#160;= ThisComponent.getAvailableServiceNames()<br/>&#160; Else<br/>&#160; &#160;&#160;allNames&#160;=&#160;oDoc.getAvailableServiceNames()<br/>&#160; End If<br/>
&#160;&#160;' Create a new Write document to contain the list.<br/>&#160;&#160;oWriteDoc&#160;= StarDesktop.loadComponentFromURL(s,&#160;&#34;_blank&#34;,&#160;0, Array())<br/>&#160;&#160;oText&#160;=&#160;oWriteDoc.getText()<br/>&#160; If IsMissing(nameFilter) Then<br/>&#160; &#160;&#160;oText.insertString&#160;(&#160;oText.End, Join(allNames, CHR$(13)),&#160;False&#160;)<br/>
235<br/>
<hr/>
<a name=9></a>&#160; Else<br/>&#160; &#160; Dim&#160;i%<br/>&#160; &#160; For&#160;i&#160;= LBound(allNames) To UBound(allNames)<br/>&#160; &#160; &#160; If (InStr(allNames(i),&#160;nameFilter) &gt;&#160;0) Then<br/>&#160; &#160; &#160; &#160;&#160;' Insert the text.<br/>&#160; &#160; &#160; &#160;&#160;oText.insertString&#160;(&#160;oText.End,&#160;allNames(i),&#160;False&#160;)<br/>&#160; &#160; &#160; &#160;&#160;<br/>&#160; &#160; &#160; &#160;&#160;' Insert a new paragraph.<br/>&#160; &#160; &#160; &#160;&#160;oText.InsertControlCharacter(oText.getEnd(),_<br/>&#160; &#160; &#160; &#160; &#160; &#160;com.sun.star.text.ControlCharacter.APPEND_PARAGRAPH,&#160;False)<br/>&#160; &#160; &#160; End If<br/>&#160; &#160; Next<br/>&#160; End If<br/>End Sub&#160;<br/>
&#160;10.3.1.&#160;Setting&#160;a Read-Only&#160;Value<br/>Some&#160;values can be set only&#160;once, so changing&#160;the&#160;value&#160;requires creating a new object.&#160;As an example,&#160;<br/>consdier:<br/>
•<br/>
A&#160;Calc&#160;sheet&#160;with combox&#160;controls (com.sun.star.awt.UnoControlComboBoxModel).<br/>
•<br/>
The controls are anchored to&#160;cells.<br/>
•<br/>
Each control&#160;bound to&#160;a cell.<br/>
•<br/>
Write&#160;a&#160;macro that&#160;finds each combobox&#160;and bind&#160;it&#160;to the&#160;cell&#160;in which it&#160;is&#160;anchored.<br/>
The obvious way&#160;to change the bound cell&#160;is to&#160;access and change the bound cell&#160;doing something&#160;like the&#160;<br/>following&#160;code&#160;that fails because&#160;ValueBinding&#160;is&#160;read-only:<br/>
' BoundCell is a struct, so copy the value out, change it&#160;and write it back.<br/>oBoundCell&#160;=&#160;oControlDataModel.ValueBinding.BoundCell<br/>oBoundCell.Column&#160;=&#160;6<br/>oBoundCell.Row&#160;=&#160;6<br/>oBoundCell.Sheet&#160;=&#160;0<br/>oControlDataModel.ValueBinding.BoundCell&#160;=&#160;oBoundCell<br/>
If&#160;you&#160;create&#160;a new value&#160;binding object&#160;and try&#160;to set&#160;the BoundCell&#160;property,&#160;this still&#160;fails.&#160;The value&#160;<br/>binding object must&#160;be initialized&#160;with the&#160;bound cell&#160;value,&#160;and it&#160;cannot be changed again:<br/>
Dim&#160;arg(0)&#160;as&#160;new&#160;com.sun.star.beans.NamedValue&#160;'not a PropertyValue, a Named Value.<br/>Dim&#160;oCellAddress&#160;As&#160;new&#160;com.sun.star.table.CellAddress<br/>oCellAddress.Column&#160;=&#160;6<br/>oCellAddress.Row=13<br/>oCellAddress.Sheet=0<br/>arg(0).Name&#160;=&#160;&#34;BoundCell&#34;<br/>arg(0).Value&#160;=&#160;oCellAddress<br/>oService&#160;=&#160;oDoc.createInstanceWithArguments(&#34;com.sun.star.table.CellValueBinding&#34;,&#160;arg)<br/>oControlDataModel.ValueBinding&#160;=&#160;oService<br/>
Using&#160;CreateInstanceWithArguments allows&#160;the&#160;service&#160;to&#160;be created&#160;and values&#160;be set when the object&#160;is&#160;<br/>initialized.&#160;You can accomplish the&#160;same&#160;thing in two steps (instead of one) by&#160;creating the instance without&#160;<br/>arguments and calling&#160;the&#160;initialize&#160;method&#160;after creating&#160;the&#160;object.<br/>
236<br/>
<hr/>
<a name=10></a>&#160;10.4.&#160;Context<br/>OpenOffice&#160;has “things” that&#160;are&#160;available&#160;by&#160;name. For example,&#160;the type description&#160;manager and the&#160;<br/>service&#160;manager.&#160;A&#160;context&#160;is&#160;a collection of name-value&#160;pairs that&#160;you&#160;can use to&#160;get&#160;these “things” by&#160;<br/>name. OOo maintains&#160;a&#160;default context&#160;that&#160;is available with&#160;the function&#160;GetDefaultContext.&#160;Although a&#160;<br/>context&#160;is required when a&#160;service&#160;is created,&#160;OOo Basic automatically&#160;uses the&#160;default&#160;context&#160;when calling&#160;<br/>CreateUnoService;&#160;yet&#160;another reason why&#160;OOo Basic is easier to use than other languages.&#160;<br/>
Listing&#160;215.&#160;View context&#160;element&#160;names.<br/>MsgBox&#160;Join(GetDefaultContext().getElementNames(),&#160;CHR$(10))&#160;<br/>
&#160;10.5.&#160;Inspecting&#160;Universal&#160;Network&#160;Objects<br/>While&#160;writing&#160;an OOo Basic macro, I&#160;don’t&#160;always&#160;understand the&#160;values returned from&#160;internal OOo&#160;<br/>functions&#160;— for example, inspecting the&#160;value returned by&#160;GetDefaultContext.&#160;I&#160;write test&#160;code to examine&#160;<br/>the return values so that&#160;I&#160;can make&#160;appropriate decisions.&#160;I&#160;then frequently&#160;add more test&#160;code&#160;to&#160;further&#160;<br/>inspect&#160;the&#160;returned object.&#160;The initial&#160;inspection&#160;uses routines that&#160;you probably&#160;know (see&#160;Table&#160;90).<br/>
Table&#160;90.&#160;Initial&#160;inspection routines.<br/>
Routine<br/>
Comment<br/>
IsMissing(obj)<br/>
Use&#160;this&#160;for&#160;optional&#160;arguments to see&#160;if&#160;they&#160;are&#160;missing.<br/>
IsNull(obj)<br/>
You cannot inspect a&#160;null&#160;object,&#160;but you know&#160;that&#160;it is&#160;null.<br/>
IsEmpty(obj)<br/>
You cannot inspect an empty&#160;object, but&#160;you&#160;know&#160;that it&#160;is empty.<br/>
IsArray(obj)<br/>
Use&#160;array-inspection methods to learn more&#160;about the&#160;array.<br/>
TypeName(obj)<br/>
Determine&#160;if&#160;this&#160;is&#160;a&#160;simple type&#160;such&#160;as a&#160;String&#160;or&#160;an&#160;Integer.&#160;If&#160;this is&#160;an&#160;<br/>
Object, it&#160;is probably&#160;a&#160;UNO structure&#160;or&#160;a&#160;UNO service.<br/>
IsUnoStruct(obj)<br/>
Determine&#160;if&#160;this&#160;is&#160;a&#160;UNO structure.<br/>
The code in&#160;Listing 216 demonstrates an initial&#160;use of the functions&#160;in&#160;Table 90.&#160;<br/>
Listing&#160;216.&#160;Inspect&#160;the&#160;TextTables&#160;object&#160;on the&#160;current&#160;document.<br/>Dim&#160;v<br/>v&#160;=&#160;Thiscomponent.getTextTables()<br/>Print&#160;IsObject(v)&#160; &#160; &#160;&#160;'True<br/>Print&#160;IsNull(v)&#160; &#160; &#160; &#160;&#160;'False<br/>Print&#160;IsEmpty(v)&#160; &#160; &#160; &#160;'False<br/>Print&#160;IsArray(v)&#160; &#160; &#160; &#160;'False<br/>Print&#160;IsUnoStruct(v)&#160; &#160;'False<br/>Print&#160;TypeName(v)&#160; &#160; &#160;&#160;'Object<br/>MsgBox&#160;v.dbg_methods&#160; &#160;'This property is discussed later<br/>
If&#160;the returned object&#160;has a type&#160;name&#160;of Object&#160;and it isn’t&#160;a&#160;UNO structure, it&#160;is probably&#160;a UNO&#160;service.&#160;<br/>Use the HasUnoInterfaces function to&#160;determine&#160;if a UNO object supports a set of interfaces.&#160;The first&#160;<br/>argument&#160;is the&#160;object to&#160;test.&#160;The arguments&#160;following&#160;the&#160;first&#160;are a&#160;list&#160;of interface names. If&#160;all&#160;of the&#160;<br/>listed interfaces are supported,&#160;the function&#160;returns&#160;True, otherwise it&#160;returns False. More than one&#160;interface&#160;<br/>may&#160;be checked at&#160;the&#160;same time.<br/>
HasUnoInterfaces(obj,&#160;interface1)<br/>HasUnoInterfaces(obj,&#160;interface1[,&#160;interface2[,&#160;interface3[,&#160;...]]])<br/>
To&#160;distinguish between a&#160;UNO structure, an arbitrary&#160;object,&#160;and a&#160;UNO service, first check to see&#160;if the&#160;<br/>variable&#160;is an object.&#160;This is&#160;easily&#160;done using the&#160;TypeName function.&#160;If&#160;the&#160;TypeName&#160;contains the&#160;word&#160;<br/>
237<br/>
<hr/>
<a name=11></a>Object,&#160;then you know it’s&#160;an object of some sort.&#160;The next&#160;step is&#160;to see if the object&#160;is&#160;a&#160;UNO structure, by&#160;<br/>using the function&#160;IsUnoStruct. Finally,&#160;if the&#160;object&#160;supports an interface (any&#160;interface will&#160;do), you&#160;know&#160;<br/>it’s&#160;a UNO&#160;service.&#160;Every&#160;interface&#160;is&#160;derived from&#160;com.sun.star.uno.XInterface, so it&#160;suffices to&#160;see&#160;if the&#160;<br/>object&#160;supports the&#160;XInterface interface.&#160;The code in&#160;Listing 217 uses the&#160;OOo Basic&#160;variable&#160;<br/>ThisComponent,&#160;which&#160;represents the&#160;current&#160;document.<br/>
Listing&#160;217.&#160;Use HasUnoInterfaces and IsUnoStruct&#160;to determine&#160;the&#160;UNO type.<br/>Dim&#160;aProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>Print&#160;IsUnoStruct(aProp)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'True<br/>Print&#160;HasUnoInterfaces(aProp,&#160;&#34;com.sun.star.uno.XInterface&#34;)&#160; &#160; &#160; &#160; &#160;&#160;'False<br/>Print&#160;IsUnoStruct(ThisComponent)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160; &#160; &#160; &#160; &#160;&#160;'False<br/>Print&#160;HasUnoInterfaces(ThisComponent,&#160;&#34;com.sun.star.uno.XInterface&#34;)&#160;&#160;'True<br/>
TIP<br/>
If&#160;the&#160;first argument to the&#160;function HasUnoInterfaces is not&#160;an object,&#160;a&#160;run-time&#160;error&#160;occurs.&#160;The&#160;object&#160;<br/>
may&#160;be&#160;null, but it&#160;must be&#160;an&#160;object.&#160;If&#160;the&#160;argument&#160;is a&#160;variant,&#160;it must contain an object; it cannot&#160;be&#160;<br/>empty.<br/>
Most&#160;UNO&#160;services also&#160;support&#160;the com.sun.star.lang.XServiceInfo interface, which allows you&#160;to&#160;ask the&#160;<br/>object&#160;what&#160;services it&#160;supports&#160;(see Table&#160;91).<br/>
Table&#160;91.&#160;XServiceInfo methods.<br/>
Method<br/>
Description<br/>
getImplementationName()<br/>
Returns a&#160;string&#160;that uniquely&#160;identifies the&#160;implementation of the&#160;service.&#160;For&#160;<br/>
example,&#160;SwXTextDocument is the&#160;name&#160;of&#160;a&#160;Writer&#160;text&#160;document.<br/>
getSupportedServiceNames()<br/>
Return a&#160;string&#160;array&#160;of&#160;services&#160;that&#160;the&#160;object supports.<br/>
supportsService(serviceName)<br/>
Return&#160;True&#160;if&#160;the&#160;object supports&#160;the&#160;service&#160;name.<br/>
OOo supports different types of documents, such as&#160;Writer&#160;(word processing) and Calc (spreadsheet).&#160;Each&#160;<br/>document&#160;type&#160;supports at&#160;least one&#160;service&#160;that&#160;is&#160;supported&#160;only&#160;by&#160;that&#160;document type (see&#160;Table&#160;92).&#160;You&#160;<br/>can determine the&#160;document&#160;type by&#160;checking&#160;if&#160;it&#160;supports&#160;one of these services.&#160;You can also&#160;use the&#160;<br/>method&#160;getImplementationName(), as shown in&#160;Table 91.<br/>
The code in&#160;Listing 218 demonstrates how&#160;to verify&#160;that&#160;a variable references a&#160;Writer&#160;document. If&#160;the&#160;<br/>argument&#160;vDoc does not&#160;support&#160;the XServiceInfo interface, however,&#160;a run-time error occurs because the&#160;<br/>SupportsService&#160;method&#160;is not&#160;implemented. Use appropriate error handling&#160;if&#160;this&#160;is required, as shown in<br/>Listing 219; this is&#160;used in&#160;Listing 227. If&#160;the argument is missing, the&#160;current&#160;document is used. If&#160;an error&#160;<br/>occurs or a recognized&#160;service&#160;is not&#160;supported,&#160;the text&#160;“unknown” is&#160;returned.<br/>
Table&#160;92.&#160;Unique&#160;service&#160;names based on document&#160;type.<br/>
Document&#160;Type<br/>
Service<br/>
Drawing<br/>
com.sun.star.drawing.DrawDocument<br/>
Writer<br/>
com.sun.star.text.TextDocument<br/>
Writer&#160;HTML<br/>
com.sun.star.text.WebDocument<br/>
Calc<br/>
com.sun.star.sheet.SpreadsheetDocument<br/>
Math<br/>
com.sun.star.formula.FormulaProperties<br/>
Presentation<br/>
com.sun.star.presentation.PresentationDocument<br/>
Base<br/>
com.sun.star.sdb.OfficeDatabaseDocument<br/>
Base&#160;Table<br/>
com.sun.star.sdb.DataSourceBrowser<br/>
238<br/>
<hr/>
<a name=12></a>Document&#160;Type<br/>
Service<br/>
Basic&#160;IDE<br/>
com.sun.star.script.BasicIDE<br/>
Listing&#160;218.&#160;Verify that&#160;the&#160;document&#160;is&#160;a Writer document.<br/>Sub&#160;DoSomethingToWriteDocument(vDoc)<br/>&#160;&#160;If&#160;NOT&#160;vDoc.supportsService(&#34;com.sun.star.text.TextDocument&#34;)&#160;Then<br/>&#160; &#160;&#160;MsgBox&#160;&#34;A Writer document is required&#34;,&#160;48,&#160;&#34;Error&#34;<br/>&#160; &#160;&#160;Exit&#160;Sub<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;REM rest of the subroutine&#160;starts here<br/>End&#160;Sub<br/>
Listing&#160;219.&#160;Determine&#160;a document's&#160;type.<br/>Function&#160;getDocType(Optional&#160;vDoc)&#160;As&#160;String<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;Oops<br/>&#160;&#160;If&#160;IsMissing(vDoc)&#160;Then&#160;vDoc&#160;=&#160;ThisComponent<br/>&#160;&#160;If&#160;vDoc.SupportsService(&#34;com.sun.star.sheet.SpreadsheetDocument&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;calc&#34;<br/>&#160;&#160;ElseIf&#160;vDoc.SupportsService(&#34;com.sun.star.text.TextDocument&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;writer&#34;<br/>&#160;&#160;ElseIf&#160;vDoc.SupportsService(&#34;com.sun.star.drawing.DrawingDocument&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;draw&#34;<br/>&#160;&#160;ElseIf&#160;vDoc.SupportsService(_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#34;com.sun.star.presentation.PresentationDocuments&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;presentation&#34;<br/>&#160;&#160;ElseIf&#160;vDoc.SupportsService(&#34;com.sun.star.formula.FormulaProperties&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;math&#34;<br/>&#160;&#160;ElseIf&#160;vDoc.SupportsService(&#34;com.sun.star.sdb.OfficeDatabaseDocument&#34;)&#160;Then<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;base&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;getDocType&#160;=&#160;&#34;unknown&#34;<br/>&#160;&#160;End&#160;If<br/>Oops:<br/>&#160;&#160;If&#160;Err&#160;&lt;&gt;&#160;0&#160;Then&#160;getDocType&#160;=&#160;&#34;unknown&#34;<br/>&#160;&#160;On&#160;Error&#160;GoTo&#160;0&#160; &#160;'Turn off error handling AFTER checking for an error<br/>End&#160;Function<br/>
Some&#160;document&#160;types cannot be easily&#160;distinguished; for example, an XForms document and a Master&#160;<br/>document&#160;both support the&#160;same&#160;services as a regular text&#160;document.&#160;All&#160;of the&#160;Write based documents&#160;<br/>support&#160;the service&#160;com.sun.star.text.GenericTextDocument,&#160;and all&#160;of the&#160;office&#160;type documents support&#160;the<br/>service&#160;com.sun.star.document.OfficeDocument.<br/>
When&#160;I&#160;want to know about&#160;an interface or service, the&#160;first&#160;place that I&#160;look&#160;is online for the&#160;official&#160;<br/>documentation.&#160;Unfortunately,&#160;only&#160;a partial picture is easily&#160;produced (for the&#160;TextCursor service, see&#160;<br/>http://api.openoffice.org/docs/common/ref/com/sun/star/text/TextCursor.html).&#160;There are some&#160;issues:<br/>
1)&#160;The documentation does not present&#160;a unified picture, you&#160;must&#160;follow many&#160;links to&#160;determine what<br/>
the&#160;object&#160;can do.&#160;All&#160;supported and optional interfaces are listed,&#160;but&#160;you must&#160;inspect&#160;each&#160;<br/>interface to know what each one does.&#160;<br/>
2)&#160;Each interface has its own page. If&#160;an interface&#160;is&#160;derived from&#160;another,&#160;you must&#160;look at&#160;another&#160;<br/>
page to see the definition&#160;of the parent&#160;interface.<br/>
239<br/>
<hr/>
<a name=13></a>3)&#160;You don’t&#160;know if the optional&#160;items are supported for a&#160;specific&#160;object&#160;instance without&#160;inspecting&#160;<br/>
the&#160;object.&#160;<br/>
TIP<br/>
Use&#160;Google&#160;to search for&#160;“site:api.openoffice.org&#160;TextCursor”&#160;to&#160;quickly&#160;find the&#160;documentation for&#160;the&#160;<br/>
TextCursor&#160;service.<br/>
TIP<br/>
http://api.openoffice.org/docs/common/ref/com/sun/star/text/module-ix.html&#160;lists all&#160;of&#160;the&#160;services&#160;and&#160;<br/>interfaces at&#160;the&#160;com.sun.star.text&#160;level.<br/>
Most&#160;UNO&#160;services contain the&#160;properties dbg_properties, dbg_methods,&#160;and dbg_supportedInterfaces. Each<br/>of these properties is&#160;a&#160;string that&#160;contains a list&#160;of the&#160;supported&#160;properties, methods, or supported&#160;<br/>interfaces. Each string&#160;starts&#160;with text&#160;similar to&#160;“Properties of Object&#160;&#34;ThisComponent&#34;:”.&#160;The individual&#160;<br/>items are separated&#160;by&#160;the&#160;delimiter&#160;as shown in&#160;Table&#160;93. Sometimes&#160;there&#160;are extra spaces following&#160;the&#160;<br/>delimiter and sometimes there&#160;are extra new-line characters&#160;— CHR$(10).<br/>
Table&#160;93.&#160;UNO&#160;“dbg_”&#160;properties.<br/>
Property<br/>
Delimiter<br/>
Description<br/>
dbg_properties<br/>
“;”<br/>
All properties supported&#160;by&#160;the&#160;object.<br/>
dbg_methods<br/>
“;”<br/>
All methods supported&#160;by&#160;the&#160;object.<br/>
dbg_supportedInterfaces<br/>
Chr$(10)<br/>
All interfaces&#160;supported&#160;by&#160;the&#160;object.<br/>
The code in&#160;Listing 220 provides&#160;an easy&#160;method to&#160;see&#160;what an object supports. Sometimes, however,&#160;too&#160;<br/>many&#160;items are displayed and portions&#160;of the&#160;dialog&#160;do not&#160;fit&#160;on the screen.&#160;To&#160;avoid&#160;this&#160;problem, the&#160;code&#160;<br/>in&#160;Listing&#160;221 splits&#160;the list&#160;into&#160;smaller,&#160;easily&#160;managed chunks.&#160;Figure 74 is&#160;only&#160;one of the many&#160;dialogs&#160;<br/>that are displayed by&#160;the&#160;macro in&#160;Listing&#160;221. Be&#160;warned, the dialogs will&#160;not&#160;fit&#160;on the screen, so, just&#160;<br/>press enter to close each dialog.<br/>
Listing&#160;220.&#160;The “dbg_” properties&#160;return useful&#160;information.<br/>MsgBox&#160;vObj.dbg_properties<br/>MsgBox&#160;vObj.dbg_methods<br/>MsgBox&#160;vObj.dbg_supportedInterfaces<br/>
Listing&#160;221.&#160;Display&#160;information&#160;from one of the&#160;debug properties.<br/>Sub&#160;ExampleDisplayDbgInfoStr()<br/>&#160;&#160;Dim&#160;vObj<br/>&#160;&#160;vObj&#160;=&#160;ThisComponent<br/>&#160;&#160;DisplayDbgInfoStr(vObj.dbg_properties,&#160;&#34;;&#34;,&#160;40,&#160;&#34;Properties&#34;)<br/>&#160;&#160;DisplayDbgInfoStr(vObj.dbg_methods,&#160;&#34;;&#34;,&#160;40,&#160;&#34;Methods&#34;)<br/>&#160;&#160;DisplayDbgInfoStr(vObj.dbg_supportedInterfaces,&#160;CHR$(10),&#160;40,&#160;&#34;Interfaces&#34;)<br/>End&#160;Sub<br/>
Sub&#160;DisplayDbgInfoStr(sInfo$,&#160;sSep$,&#160;nChunks,&#160;sHeading$)<br/>&#160;&#160;Dim&#160;aInfo()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Array to hold each string<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;j&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Junk integer variable for&#160;temporary values<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'holds the portion that is&#160;not completed<br/>&#160;&#160;s&#160;=&#160;sInfo$<br/>&#160;&#160;j&#160;=&#160;InStr(s,&#160;&#34;:&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Initial colon<br/>&#160;&#160;If&#160;j&#160;&gt;&#160;0&#160;Then&#160;Mid(s,&#160;1,&#160;j,&#160;&#34;&#34;)&#160;&#160;'Remove portion up to the&#160;initial colon<br/>&#160;&#160;Do<br/>
240<br/>
<hr/>
<a name=14></a>&#160; &#160;&#160;aInfo()&#160;=&#160;Split(s,&#160;sSep$,&#160;nChunks)&#160; &#160; &#160; &#160;&#160;'Split string based on delimiter.<br/>&#160; &#160;&#160;s&#160;=&#160;aInfo(UBound(aInfo()))&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Grab the last piece. Contains<br/>&#160; &#160;&#160;If&#160;InStr(s,&#160;sSep$)&#160;&lt;&#160;1&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'the rest if there were too many.<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160; &#160; &#160;&#160;'If there were not, then clear s.<br/>&#160; &#160;&#160;Else&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160; &#160; &#160; &#160; &#160;&#160;'If there was a delimiter&#160;then<br/>&#160; &#160; &#160;&#160;ReDim&#160;Preserve&#160;aInfo(nChunks&#160;-&#160;2)&#160; &#160; &#160; &#160;'change array dimension to<br/>&#160; &#160;&#160;End&#160;If&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160; &#160; &#160; &#160;&#160;'remove the extra last piece.<br/>&#160; &#160;&#160;For&#160;i&#160;=&#160;LBound(aInfo())&#160;To&#160;UBound(aInfo())'Look at each piece to remove<br/>&#160; &#160; &#160;&#160;aInfo(i)&#160;=&#160;Trim(aInfo(i))&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'leading and trailing spaces.<br/>&#160; &#160; &#160;&#160;j&#160;=&#160;InStr(aInfo(i),&#160;CHR$(10))&#160; &#160; &#160; &#160; &#160; &#160;'Some have an extra<br/>&#160; &#160; &#160;&#160;If&#160;j&#160;&gt;&#160;0&#160;&#160;Then&#160;Mid(aInfo(i),&#160;j,&#160;1,&#160;&#34;&#34;)&#160;&#160;'new line that should be removed.<br/>&#160; &#160;&#160;Next<br/>&#160; &#160;&#160;MsgBox&#160;Join(aInfo(),&#160;CHR$(10)),&#160;0,&#160;sHeading$<br/>&#160;&#160;Loop&#160;Until&#160;Len(s)&#160;=&#160;0<br/>End&#160;Sub<br/>
When&#160;a&#160;type is&#160;included in&#160;one of the&#160;“dbg_” properties, it&#160;is&#160;preceded by&#160;the text&#160;“Sbx”, as shown in&#160;Figure<br/>74.&#160;These names starting with Sbx&#160;correspond to&#160;the&#160;internal names used by&#160;OOo Basic.<br/>
TIP<br/>
A&#160;complete&#160;object&#160;browser&#160;is&#160;presented&#160;later&#160;that demonstrates&#160;all of these&#160;concepts (see&#160;section&#160;18.5&#160;The&#160;<br/>
object inspector&#160;example).<br/>
TIP<br/>
A&#160;popular&#160;object browser,&#160;called&#160;Xray&#160;described at&#160;the&#160;following&#160;link:&#160;<br/>http://wiki.openoffice.org/wiki/Extensions_development_basic&#160;<br/>
241<br/>
<hr/>
<a name=15></a>Figure&#160;74.&#160;A&#160;few&#160;properties in&#160;a Writer&#160;document; one dialog&#160;of many displayed.<br/>
&#160;10.6.&#160;Using&#160;the type&#160;description&#160;manager&#160;<br/>The&#160;TypeDescriptionManager manages type&#160;descriptions&#160;and acts&#160;as a central&#160;access&#160;point&#160;for every&#160;type&#160;<br/>description.&#160;This&#160;object&#160;is available from&#160;the default&#160;context&#160;as a singleton. Creating the object&#160;directly&#160;does&#160;<br/>not&#160;provide a&#160;usable object&#160;<br/>
CreateUnoService(&#34;com.sun.star.reflection.TypeDescriptionManager&#34;)<br/>
I&#160;created a usable object&#160;using the&#160;accepted method (shown shortly), and even when using&#160;that&#160;type directly,&#160;<br/>it&#160;too&#160;failed.<br/>
CreateUnoService(&#34;com.sun.star.comp.stoc.TypeDescriptionManager&#34;)<br/>
Get the&#160;type description&#160;manager from&#160;the default&#160;context;&#160;see section&#160;10.4 Context, which&#160;also shows&#160;how&#160;<br/>to enumerate all of the singleton&#160;objects available.<br/>
Function&#160;GetTypeDescriptionManager()<br/>&#160;&#160;Dim&#160;sTDMName$&#160;&#160;' Name of the type description manager.<br/>&#160;&#160;sTDMName&#160;=&#160;&#34;/singletons/com.sun.star.reflection.theTypeDescriptionManager&#34;<br/>&#160;&#160;GetTypeDescriptionManager()&#160;=&#160;GetDefaultContext().getValueByName(sTDMName)&#160;<br/>End&#160;Function<br/>
The following&#160;method enumerates all “things” in the&#160;com.sun.star.awt&#160;module.<br/>
242<br/>
<hr/>
<a name=16></a>Listing&#160;222.&#160;Enumerate&#160;types in&#160;a module.<br/>Sub&#160;EnumerateTypesTest<br/>&#160;&#160;Dim&#160;oTDM&#160; &#160; &#160;&#160;' Type Description Manager.<br/>&#160;&#160;Dim&#160;oTDE&#160; &#160; &#160;&#160;' Type Description Enumerations.<br/>&#160;&#160;Dim&#160;oTD&#160; &#160; &#160; &#160;' One Type Description.<br/>&#160;&#160;Dim&#160;typeArray&#160;' Types for which descriptions are returned.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160;&#160;' Utility string variable.<br/>&#160;&#160;<br/>&#160;&#160;REM All supported types.<br/>&#160;&#160;typeArray&#160;=&#160;Array(com.sun.star.uno.TypeClass.VOID,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.CHAR,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.BOOLEAN,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.BYTE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.SHORT,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.UNSIGNED_SHORT,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.LONG,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.UNSIGNED_LONG,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.HYPER,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.UNSIGNED_HYPER,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.FLOAT,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.DOUBLE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.STRING,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.TYPE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.ANY,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.ENUM,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.TYPEDEF,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.STRUCT,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.UNION,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.EXCEPTION,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.SEQUENCE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.ARRAY,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.INTERFACE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.SERVICE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.MODULE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.INTERFACE_METHOD,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.INTERFACE_ATTRIBUTE,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.UNKNOWN,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.PROPERTY,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.CONSTANT,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.CONSTANTS,&#160;_<br/>&#160; &#160; &#160;com.sun.star.uno.TypeClass.SINGLETON)<br/>
&#160;&#160;oTDM&#160;=&#160;GetTypeDescriptionManager()<br/>
&#160;&#160;Dim&#160;sBaseName$&#160;:&#160;sBaseName&#160;=&#160;&#34;com.sun.star.awt&#34;<br/>&#160;&#160;<br/>&#160;&#160;' Change com.sun.star.reflection.TypeDescriptionSearchDepth.ONE<br/>&#160;&#160;' to com.sun.star.reflection.TypeDescriptionSearchDepth.INFINITE<br/>&#160;&#160;' to traverse more than a&#160;single level.<br/>&#160;&#160;oTDE&#160;=&#160;oTDM.createTypeDescriptionEnumeration(sBaseName,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;typeArray,&#160;_<br/>&#160; &#160; &#160; &#160; &#160; &#160; &#160;com.sun.star.reflection.TypeDescriptionSearchDepth.ONE)<br/>&#160;&#160;<br/>
243<br/>
<hr/>
<a name=17></a>&#160;&#160;While&#160;oTDE.hasMoreElements()<br/>&#160; &#160;&#160;oTD&#160;=&#160;oTDE.nextTypeDescription()<br/>&#160; &#160;&#160;s$&#160;=&#160;s&#160;&amp;&#160;oTD.Name&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Wend<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
To&#160;get the information on a specific fully&#160;qualified type, use the following macro (adapted from&#160;an example&#160;<br/>by&#160;Bernard Marcelly):<br/>
Listing&#160;223.&#160;Get&#160;object&#160;description from a fully&#160;qualified name.<br/>
Function&#160;GetOOoConst(constString)<br/>&#160;&#160;Dim&#160;sTDMName$<br/>&#160;&#160;Dim&#160;oTDM<br/>&#160;&#160;<br/>&#160;&#160;sTDMName&#160;=&#160;&#34;/singletons/com.sun.star.reflection.theTypeDescriptionManager&#34;<br/>&#160;&#160;oTDM&#160;=&#160;GetDefaultContext().getValueByName(sTDMName)&#160;<br/>&#160;&#160;<br/>&#160;&#160;If&#160;oTDM.hasByHierarchicalName(constString)&#160;Then&#160;<br/>&#160; &#160;&#160;GetOOoConst&#160;=&#160;oTDM.getByHierarchicalName(constString)&#160;<br/>&#160;&#160;Else&#160;<br/>&#160; &#160;&#160;MsgBox&#160;&#34;Unrecognized name : &#34;&#160;&amp;&#160;constString,&#160;16,&#160;&#34;OOo API constant or enum&#34;&#160;<br/>&#160;&#160;End&#160;If&#160;<br/>End&#160;Function<br/>
The method&#160;is usable to&#160;obtain&#160;constant&#160;and enumeration&#160;values from&#160;a text&#160;string<br/>
Print&#160;GetOOoConst(&#34;com.sun.star.awt.FontSlant.ITALIC&#34;)<br/>
This can also return an object&#160;that&#160;describes&#160;the type.&#160;This can be used to&#160;enumerate&#160;the values and the&#160;<br/>strings.<br/>
Listing&#160;224.&#160;Inspect&#160;enumerations.<br/>
Sub&#160;EnumerateEnumerations(sName$)<br/>&#160; Dim&#160;oTD&#160; &#160; &#160; &#160;' One Type Description.<br/>&#160; Dim&#160;oTDE&#160; &#160; &#160;&#160;' Element enumeration<br/>&#160; Dim&#160;s$ &#160; &#160; &#160; &#160;' Utility string variable.<br/>&#160; Dim&#160;sNames<br/>&#160; Dim&#160;lValues<br/>&#160; Dim&#160;i&#160;As Long<br/>&#160; Dim&#160;iCount&#160;As Integer<br/>&#160;&#160;<br/>
&#160;&#160;oTD&#160;=&#160;GetOOoConst(sName)<br/>&#160; If IsNull(oTD) OR&#160;IsEmpty(oTD) Then<br/>&#160; &#160; Exit Sub<br/>&#160; End If<br/>&#160;&#160;<br/>&#160;&#160;<br/>&#160; If HasUnoInterfaces(oTD,&#160;&#34;com.sun.star.reflection.XEnumTypeDescription&#34;) Then<br/>&#160;&#160;<br/>&#160; &#160;&#160;'MsgBox Join( oTD.getEnumNames(), CHR$(10))<br/>&#160; &#160;&#160;sNames&#160;=&#160;oTD.getEnumNames()<br/>&#160; &#160;&#160;lValues&#160;=&#160;otd.getEnumValues()<br/>&#160; &#160; For&#160;i&#160;= LBound(sNames) To UBound(sNames)<br/>
244<br/>
<hr/>
<a name=18></a>&#160; &#160; &#160;&#160;iCount&#160;=&#160;iCount&#160;+&#160;1<br/>&#160; &#160; &#160; If (iCount&#160;&gt;&#160;40) Then<br/>&#160; &#160; &#160; &#160; MsgBox(s)<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160; &#160; End If<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;lValues(i) &amp; CHR$(9) &amp;&#160;sNames(i) &amp; CHR$(10)<br/>&#160; &#160; Next<br/>&#160; ElseIf HasUnoInterfaces(oTD,&#160;&#34;com.sun.star.reflection.XConstantsTypeDescription&#34;) Then<br/>&#160; &#160;&#160;lValues&#160;=&#160;oTD.getConstants()<br/>&#160; &#160; For&#160;i&#160;= LBound(lValues) To UBound(lValues)<br/>&#160; &#160; &#160;&#160;iCount&#160;=&#160;iCount&#160;+&#160;1<br/>&#160; &#160; &#160; If (iCount&#160;&gt;&#160;40) Then<br/>&#160; &#160; &#160; &#160; MsgBox(s)<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160; &#160; End If<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;lValues(i).getConstantValue() &amp; CHR$(9) &amp;&#160;lValues(i).getName() &amp; CHR$(10)<br/>&#160; &#160; Next<br/>&#160; Else<br/>&#160; &#160;&#160;'Inspect oTD<br/>&#160; &#160; MsgBox&#160;&#34;Unsupported type &#34;&#160;&amp;&#160;sName<br/>&#160; &#160; Exit Sub<br/>&#160; End If<br/>&#160;&#160;MsgBox&#160;s<br/>End&#160;Sub<br/>
This can be&#160;used to&#160;see enumerations.<br/>
EnumerateEnumerations(&#34;com.sun.star.awt.FontSlant&#34;) &#160;<br/>
This can be&#160;used to&#160;see constant&#160;groups.<br/>
EnumerateEnumerations(&#34;com.sun.star.awt.FontWeight&#34;) &#160;<br/>
&#160;10.7.&#160;Use&#160;Object&#160;or&#160;Variant<br/>It&#160;is almost always&#160;safe to&#160;use Object&#160;variables&#160;to hold&#160;UNO services. It&#160;is so safe, apparently,&#160;that&#160;even the&#160;<br/>macro recorder uses Object&#160;variables to&#160;hold&#160;UNO services. Unfortunately,&#160;it&#160;is&#160;not&#160;always&#160;safe.&#160;The OOo&#160;<br/>Developer’s&#160;Guide&#160;specifically&#160;states that&#160;Variant&#160;variables should&#160;be used instead of Object&#160;variables.&#160;<br/>Always&#160;use the type&#160;Variant&#160;to&#160;declare variables for UNO&#160;services, not the&#160;type&#160;Object.&#160;The OOo Basic type&#160;<br/>Object&#160;is tailored for pure OOo Basic objects&#160;— in other words, objects&#160;that&#160;can be&#160;created&#160;with the&#160;Dim&#160;As&#160;<br/>New syntax.&#160;The&#160;Variant variables are best&#160;for UNO&#160;services to avoid&#160;problems that&#160;can result&#160;from&#160;the OOo<br/>Basic specific behavior of the&#160;type Object.&#160;I&#160;asked&#160;Andreas Bregas (one of the primary&#160;developers for the&#160;<br/>OOo Basic infrastructure) about&#160;this, and he said&#160;that in&#160;most&#160;cases, both work.&#160;The OOo Developer’s&#160;Guide<br/>prefers&#160;Variant&#160;because there&#160;are some odd situations in&#160;which the&#160;usage of type&#160;Object leads to an error due&#160;<br/>to the&#160;old Basic&#160;Object&#160;type semantics. But&#160;if a Basic&#160;program&#160;uses type Object, it&#160;will&#160;almost&#160;always&#160;run&#160;<br/>correctly&#160;and there&#160;should&#160;be no problems. It&#160;is sufficiently&#160;rare, however,&#160;that&#160;he could not&#160;remember an&#160;<br/>example&#160;where it was a problem.&#160;On the&#160;other hand, with&#160;OOo version&#160;1, I&#160;experienced a&#160;problem&#160;that&#160;<br/>corrected&#160;itself, when I&#160;changed the&#160;variable&#160;type from&#160;Variant&#160;to Object.<br/>
245<br/>
<hr/>
<a name=19></a>&#160;10.8.&#160;Comparing&#160;UNO&#160;variables<br/>Use the EqualUnoObjects function&#160;to determine&#160;if two UNO objects are the&#160;same&#160;object.&#160;UNO structures are<br/>copied by&#160;value&#160;but&#160;UNO&#160;services are copied by&#160;reference.&#160;This means that&#160;EqualUnoObjects should&#160;always<br/>return False for two variables&#160;that&#160;contain a structure, and it&#160;might return&#160;True for UNO services.<br/>
&#160;&#160;Dim&#160;vObj<br/>&#160;&#160;vObj&#160;=&#160;ThisComponent<br/>&#160;&#160;Print&#160;EqualUnoObjects(vObj,&#160;ThisComponent)&#160; &#160; &#160; &#160; &#160;'True<br/>&#160;&#160;<br/>&#160;&#160;Dim&#160;aProp&#160;As&#160;New&#160;com.sun.star.beans.PropertyValue<br/>&#160;&#160;vObj&#160;=&#160;aProp<br/>&#160;&#160;Print&#160;EqualUnoObjects(vObj,&#160;aProp)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'False<br/>
After using OOo for many&#160;years, I&#160;finally&#160;found a&#160;use for EqualUnoObjects. Be&#160;warned that this&#160;is an&#160;<br/>advance topic and makes use of constructs not&#160;widely&#160;known.&#160;The problem as posed is:&#160;“When&#160;a button&#160;is&#160;<br/>pressed in a Calc&#160;document, I&#160;want&#160;to&#160;know which cell&#160;contains&#160;the button.” Here&#160;are some bits of&#160;<br/>information to&#160;help understand&#160;the problem:<br/>
•<br/>
Each document&#160;has at&#160;least&#160;one “draw page”&#160;that contains graphical&#160;things such as images imbedded&#160;<br/>in the&#160;document.<br/>
•<br/>
You can embed controls such as a&#160;button&#160;in a&#160;document.&#160;When the&#160;button&#160;is pressed, and a macro is&#160;<br/>called, it&#160;is trivial&#160;to get a&#160;reference&#160;to&#160;the control&#160;“data&#160;model”.<br/>
•<br/>
Each control&#160;has a shape&#160;embedded in&#160;the draw page.<br/>
•<br/>
Each control&#160;also has a “data&#160;model”&#160;that contains properties and other similar things.<br/>
•<br/>
From&#160;a control data&#160;model&#160;I&#160;cannot easily&#160;obtain&#160;the shape&#160;or the&#160;cell&#160;containing the control.<br/>
•<br/>
From&#160;a shape&#160;in&#160;a Calc document,&#160;I&#160;can easily&#160;find the cell – if the&#160;control is&#160;anchored to a cell.<br/>
My&#160;solution&#160;was to find the&#160;shape&#160;associated with&#160;a control. It&#160;is easy&#160;to&#160;find the control name, but,&#160;a control<br/>name need not&#160;be unique. I&#160;opted to&#160;look at every&#160;shape on the draw page and then check to see&#160;if the&#160;<br/>control&#160;associated with&#160;that&#160;shape is&#160;the same object&#160;as the control&#160;in question.<br/>
Listing&#160;225.&#160;Find&#160;the control&#160;shape for a specific&#160;control.<br/>Function&#160;FindCellWithControl(oDrawPage,&#160;oControl)<br/>&#160; Dim&#160;oShape<br/>&#160; Dim&#160;oAnchor<br/>&#160;&#160;oShape&#160;=&#160;FindShapeForControl(oDrawPage,&#160;oControl)<br/>&#160; If Not&#160;IsEmpty(oShape) Then<br/>&#160; &#160; If&#160;oShape.getAnchor().supportsService(&#34;com.sun.star.sheet.SheetCell&#34;) Then<br/>&#160; &#160; &#160;&#160;FindCellWithControl&#160;=&#160;oShape.getAnchor()<br/>&#160; &#160; End If<br/>&#160; End If<br/>End Function<br/>
Function&#160;FindShapeForControl(oDrawPage,&#160;oControl)<br/>&#160;&#160;Dim&#160;i<br/>&#160;&#160;Dim&#160;oShape<br/>&#160;&#160;For&#160;i&#160;=&#160;0&#160;To&#160;oDrawPage.getCount()<br/>&#160; &#160;&#160;oShape&#160;=&#160;oDrawPage.getByIndex(i)<br/>&#160; &#160;&#160;If&#160;oShape.supportsService(&#34;com.sun.star.drawing.ControlShape&#34;)&#160;Then<br/>&#160; &#160; &#160;&#160;If&#160;EqualUNOObjects(oControl,&#160;oShape.Control)&#160;Then<br/>
246<br/>
<hr/>
<a name=20></a>&#160; &#160; &#160; &#160;&#160;FindShapeForControl&#160;=&#160;oShape<br/>&#160; &#160; &#160; &#160;&#160;Exit&#160;Function<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;Next<br/>End&#160;Function<br/>
What&#160;does the&#160;event&#160;handler called&#160;by&#160;the&#160;button&#160;look like?<br/>
Sub&#160;ButtonHandler(oEvent)<br/>&#160;&#160;Dim&#160;oControlModel<br/>&#160;&#160;Dim&#160;oParent<br/>&#160;&#160;Dim&#160;oCell<br/>&#160;&#160;<br/>&#160;&#160;'Print oEvent.Source.Model.getName()<br/>&#160;&#160;oControlModel&#160;=&#160;oEvent.Source.Model<br/>&#160;&#160;<br/>&#160;&#160;oParent&#160;=&#160;oControlModel.getParent()<br/>&#160;&#160;Do&#160;While&#160;NOT&#160;oParent.supportsService(&#34;com.sun.star.sheet.SpreadsheetDocument&#34;)&#160;<br/>&#160; &#160;&#160;oParent&#160;=&#160;oParent.getParent()<br/>&#160;&#160;Loop&#160;<br/>&#160;&#160;<br/>&#160;&#160;oCell&#160;=&#160;FindCellWithControl(oParent.getCurrentController().getActiveSheet().getDrawPage(),&#160;<br/>oControlModel)<br/>&#160;&#160;If&#160;NOT&#160;IsEmpty(oCell)&#160;Then<br/>&#160; &#160;&#160;Print&#160;&#34;Control is in cell &#34;&#160;&amp;&#160;oCell.AbsoluteName<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;Print&#160;&#34;Unable to find cell with&#160;control&#34;<br/>&#160;&#160;ENd&#160;If<br/>End&#160;Sub&#160;<br/>
&#160;10.9.&#160;Built-in&#160;global&#160;UNO&#160;variables<br/>OOo Basic contains built-in global&#160;variables that&#160;provide quick&#160;access to&#160;frequently&#160;used components&#160;in&#160;<br/>OOo.&#160;The most&#160;commonly&#160;used variable is&#160;ThisComponent,&#160;which&#160;refers to&#160;the currently&#160;active document.&#160;<br/>To&#160;demonstrate using the&#160;variable&#160;ThisComponent, the&#160;macro in&#160;Listing&#160;226 displays&#160;all of the styles in&#160;the&#160;<br/>current&#160;document.&#160;Figure 75 is only&#160;one of the many&#160;dialogs that&#160;are&#160;displayed while the macro runs.&#160;The&#160;<br/>fact&#160;that&#160;a&#160;style exists in&#160;a document&#160;does not&#160;imply&#160;that&#160;the style is actually&#160;used in&#160;the&#160;document.<br/>
Listing&#160;226.&#160;Display&#160;all&#160;styles&#160;known&#160;by this&#160;document.<br/>Sub&#160;DisplayAllStyles<br/>&#160;&#160;Dim&#160;vFamilies&#160;As&#160;Variant&#160;'All the style types<br/>&#160;&#160;Dim&#160;vFamNames&#160;As&#160;Variant&#160;'Array with names of the style types<br/>&#160;&#160;Dim&#160;vStyles&#160;As&#160;Variant&#160; &#160;'One style type such as Number or Page Styles<br/>&#160;&#160;Dim&#160;vStlNames&#160;As&#160;Variant&#160;'Array with names of specific styles<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160;&#160;'Message to display<br/>&#160;&#160;Dim&#160;n&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160;'Iterate through the style&#160;types<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160;'Iterate through the styles<br/>&#160;&#160;<br/>&#160;&#160;vFamilies&#160;=&#160;ThisComponent.StyleFamilies&#160; &#160; &#160; &#160; &#160; &#160;'Get the styles<br/>&#160;&#160;vFamNames&#160;=&#160;vFamilies.getElementNames()&#160; &#160; &#160; &#160; &#160; &#160;'What type of styles?<br/>&#160;&#160;For&#160;n&#160;=&#160;LBound(vFamNames)&#160;To&#160;UBound(vFamNames)&#160; &#160;&#160;'Look at all style types<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;&#34;<br/>&#160; &#160;&#160;vStyles&#160;=&#160;vFamilies.getByName(vFamNames(n))&#160; &#160; &#160;'Get styles of a type<br/>
247<br/>
<hr/>
<a name=21></a>&#160; &#160;&#160;vStlNames&#160;=&#160;vStyles.getElementNames()&#160; &#160; &#160; &#160; &#160; &#160;'names of styles for type<br/>&#160; &#160;&#160;For&#160;i&#160;=&#160;LBound(vStlNames)&#160;To&#160;UBound&#160;(vStlNames)&#160;'for all styles of a type<br/>&#160; &#160; &#160;&#160;s=s&#160;&amp;&#160;i&#160;&amp;&#160;&#34; : &#34;&#160;&amp;&#160;vStlNames(i)&#160;&amp;&#160;Chr$(13)&#160; &#160; &#160;'Build a display string<br/>&#160; &#160; &#160;&#160;If&#160;((i&#160;+&#160;1)&#160;Mod&#160;35&#160;=&#160;0)&#160;Then&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Display 35 at a time<br/>&#160; &#160; &#160; &#160;&#160;MsgBox&#160;s,0,vFamNames(n)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Display them<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;&#34;&#34;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Clear string, start over<br/>&#160; &#160; &#160;&#160;End&#160;If<br/>&#160; &#160;&#160;Next&#160;i&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Next style<br/>&#160; &#160;&#160;If&#160;Len(s)&#160;&gt;&#160;0&#160;Then&#160;MsgBox&#160;s,0,vFamNames(n)&#160; &#160; &#160;&#160;'Leftover styles for type<br/>&#160;&#160;Next&#160;n&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Next style type<br/>End&#160;Sub<br/>
Figure 75.&#160;Frame styles known by the current&#160;document.<br/>
OpenOffice&#160;is&#160;based on the&#160;same&#160;code as StarOffice, which had a desktop.&#160;All of the individual&#160;windows&#160;<br/>were contained in&#160;this&#160;desktop.&#160;The desktop&#160;paradigm&#160;is now&#160;gone, but&#160;for legacy&#160;reasons a desktop&#160;object&#160;<br/>still&#160;acts as the&#160;global&#160;application&#160;that ties all of the documents together.&#160;Although I&#160;frequently&#160;see&#160;code&#160;that&#160;<br/>creates a desktop&#160;service&#160; by&#160;using the&#160;function&#160;CreateUnoService, this is&#160;not&#160;required in OOo Basic. OOo&#160;<br/>Basic provides the&#160;variable StarDesktop, which accesses the&#160;primary&#160;desktop&#160;service&#160;in&#160;OOo.&#160;The macro in<br/>Listing 227 demonstrates the&#160;use of the StarDesktop&#160;by&#160;traversing all&#160;of the currently&#160;open documents.&#160;The&#160;<br/>getDocType method&#160;is defined in&#160;Listing 219.<br/>
Listing&#160;227.&#160;Inspect&#160;each open component.<br/>Sub&#160;IterateThroughAllDocs<br/>&#160;&#160;On&#160;Error&#160;Resume&#160;Next&#160; &#160; &#160;&#160;'Ignore the non-document components<br/>&#160;&#160;Dim&#160;vComponents&#160;As&#160;Object&#160;'All of the components<br/>&#160;&#160;Dim&#160;vDocs&#160;As&#160;Object&#160; &#160; &#160; &#160;'Enumeration of the documents<br/>&#160;&#160;Dim&#160;vDoc&#160;As&#160;Object&#160; &#160; &#160; &#160;&#160;'A single document<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;GlobalScope.BasicLibraries.LoadLibrary(&#34;Tools&#34;)'Contains FileNameOutOfPath<br/>&#160;&#160;vComponents&#160;=&#160;StarDesktop.getComponents()&#160; &#160; &#160;&#160;'Get all the components<br/>&#160;&#160;vDocs&#160;=&#160;vComponents.createEnumeration()&#160; &#160; &#160; &#160;&#160;'Enumerate them<br/>&#160;&#160;Do&#160;While&#160;vDocs.hasMoreElements()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'While there are more<br/>&#160; &#160;&#160;vDoc&#160;=&#160;vDocs.nextElement()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Get the next component<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;getDocType(vDoc)&#160;&amp;&#160;&#34; &#160; &#34;&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Add the document type<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;FileNameOutOfPath(vDoc.getURL())&#160; &#160; &#160;'Add the file name<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160;'Add a new line<br/>&#160;&#160;Loop<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Currently Open Components&#34;<br/>
248<br/>
<hr/>
<a name=22></a>End&#160;Sub<br/>
TIP<br/>
The&#160;primary&#160;visible&#160;windows&#160;in OOo&#160;are&#160;called “components.”&#160;Every&#160;open&#160;document is a&#160;component,&#160;as is<br/>
the&#160;Basic&#160;IDE&#160;and&#160;the&#160;Help&#160;window.&#160;In&#160;OOo, the&#160;word&#160;“component”&#160;almost&#160;always means&#160;an open&#160;<br/>document.<br/>
While&#160;iterating through the&#160;open documents (components), you&#160;may&#160;find some&#160;unexpected documents.&#160;<br/>These are component&#160;windows&#160;such as the&#160;Basic IDE&#160;and the Help window.&#160;The macro in&#160;Listing&#160;227 uses&#160;<br/>the function&#160;FileNameOutOfPath.&#160;This is&#160;another macro and is not&#160;a function that&#160;is&#160;built&#160;into&#160;OOo Basic.&#160;<br/>This function&#160;is stored in&#160;the Strings module&#160;of the&#160;application-level&#160;Tools&#160;library.&#160;If&#160;a library&#160;is&#160;not&#160;<br/>currently&#160;loaded, you cannot&#160;call&#160;the methods that&#160;it contains.&#160;<br/>
The GlobalScope&#160;variable references the application-level&#160;libraries and is used to load&#160;the&#160;Tools&#160;library.&#160;<br/>Loading a library&#160;loads all&#160;of the modules in&#160;the specified library.&#160;OOo contains libraries and modules that&#160;<br/>are not built&#160;into&#160;OOo Basic.&#160;Use the LoadLibrary&#160;method before you use the&#160;routines in&#160;the libraries.<br/>
GlobalScope.BasicLibraries.LoadLibrary(&#34;Tools&#34;)<br/>
To&#160;access&#160;the&#160;Basic libraries in&#160;the current&#160;document, either use the&#160;BasicLibraries&#160;global&#160;variable&#160;or access&#160;<br/>the BasicLibraries property&#160;in&#160;the current&#160;document.<br/>
Print&#160;EqualUnoObjects(vObj.BasicLibraries,&#160;BasicLibraries)&#160;&#160;'True<br/>
Use the DialogLibraries variable to&#160;access the&#160;dialog libraries in&#160;the current&#160;document. Unlike&#160;<br/>BasicLibraries,&#160;an individual&#160;document does not&#160;contain a property&#160;called&#160;DialogLibaries to&#160;directly&#160;obtain&#160;<br/>the dialog libraries for a&#160;specific document.&#160;You can easily&#160;obtain the&#160;dialog and Basic&#160;libraries for a specific<br/>document&#160;through a&#160;less direct&#160;route.&#160;Each document&#160;has a LibraryContainer property.&#160;<br/>
ThisComponent.LibraryContainer.getByName(&#34;OOME_30&#34;).getModuleContainer()<br/>ThisComponent.LibraryContainer.getByName(&#34;OOME_30&#34;).getDialogContainer()<br/>
The getByName() method on the&#160;LibraryContainer returns the&#160;named library.&#160;The getModuleContainer()&#160;<br/>method&#160;returns the&#160;Basic container for the&#160;specified&#160;library,&#160;and the getDialogContainer() method&#160;returns the<br/>Dialog container for the&#160;specified&#160;library.&#160;The code in&#160;Listing 228, however,&#160;uses the&#160;variables&#160;<br/>DialogLibraries&#160;and BasicLibraries to&#160;list the&#160;number of dialogs and modules&#160;in each library&#160;in&#160;the current&#160;<br/>document.&#160;Figure 76 shows&#160;the results.<br/>
Listing&#160;228.&#160;View the&#160;libraries&#160;and dialogs&#160;stored in the&#160;current&#160;document.<br/>
Sub&#160;ExamineDocumentLibraries<br/>&#160;&#160;Dim&#160;vLibs&#160; &#160; &#160; &#160; &#160; &#160;'Hold the library names<br/>&#160;&#160;Dim&#160;vMod&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Hold the modules/dialogs&#160;object<br/>&#160;&#160;Dim&#160;nNumMods%&#160; &#160; &#160; &#160;'Number of modules or dialogs in a library<br/>&#160;&#160;Dim&#160;i%&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Scrap index variable<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Scrap string variable<br/>&#160;&#160;s&#160;=&#160;&#34;*** Dialog Libs In Document&#34;&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160; &#160; &#160;'Initialize s<br/>&#160;&#160;vLibs&#160;=&#160;DialogLibraries.getElementNames()&#160; &#160; &#160; &#160; &#160; &#160;&#160;'Library names<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(vLibs)&#160;To&#160;UBound(vLibs)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Look at each name<br/>&#160; &#160;&#160;vMod&#160;=&#160;DialogLibraries.getByName(vLibs(i))&#160; &#160; &#160; &#160; &#160;'Get the dialog library<br/>&#160; &#160;&#160;nNumMods&#160;=&#160;UBound(vMod.getElementNames())&#160;+&#160;1&#160; &#160; &#160;&#160;'How many dialogs<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vLibs(i)&#160;&amp;&#160;&#34; has &#34;&#160;&amp;&#160;nNumMods&#160;&amp;&#160;&#34; dialogs&#34;&#160;'Build string<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next&#160;i<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;*** Basic Libs In Document&#34;&#160;&amp;&#160;CHR$(10)&#160; &#160; &#160;&#160;'Ready for code libs<br/>&#160;&#160;vLibs&#160;=&#160;BasicLibraries.getElementNames()&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Library names<br/>
249<br/>
<hr/>
<a name=23></a>&#160;&#160;For&#160;i&#160;=&#160;LBound(vLibs)&#160;To&#160;UBound(vLibs)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Look at each name<br/>&#160; &#160;&#160;vMod&#160;=&#160;BasicLibraries.getByName(vLibs(i))&#160; &#160; &#160; &#160; &#160;&#160;'Get the code library<br/>&#160; &#160;&#160;nNumMods&#160;=&#160;UBound(vMod.getElementNames())&#160;+&#160;1&#160; &#160; &#160;&#160;'Number of modules<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;vLibs(i)&#160;&amp;&#160;&#34; has &#34;&#160;&amp;&#160;nNumMods&#160;&amp;&#160;&#34; modules&#34;&#160;'Build the string<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;Next&#160;i<br/>&#160;&#160;MsgBox&#160;s,&#160;0,&#160;&#34;Libraries&#34;<br/>End&#160;Sub<br/>
Figure 76.&#160;Dialog&#160;and Basic&#160;libraries in&#160;the current&#160;document.<br/>
To&#160;view the&#160;libraries in&#160;the&#160;application-level library&#160;container,&#160;modify&#160;the&#160;code in&#160;Listing 228.&#160;Add&#160;<br/>GlobalScope&#160;before each occurrence of BasicLibraries and DialogLibraries.&#160;<br/>
&#160;10.10.&#160;Creating&#160;UNO&#160;values&#160;for&#160;OOo&#160;internals<br/>OOo Basic does an excellent&#160;job&#160;of converting between the&#160;native&#160;Basic&#160;types and the types required&#160;<br/>internally&#160;by&#160;OOo. However,&#160;if you call&#160;a&#160;method on a Universal&#160;Network Object&#160;and OOo Basic&#160;doesn’t&#160;<br/>know what the&#160;type should&#160;be, it&#160;may&#160;not&#160;properly&#160;convert&#160;the&#160;type. For example, the&#160;setPropertyValue&#160;<br/>method&#160;in the&#160;XPropertySet&#160;interface accepts two arguments&#160;— a string name of the property&#160;to&#160;set and the&#160;<br/>value to&#160;set.&#160;The type of the value to&#160;set depends on which property&#160;is&#160;set.&#160;Use the function&#160;CreateUnoValue&#160;<br/>(shown in&#160;Listing&#160;229) to create a&#160;reference to a Universal&#160;Network Object&#160;that&#160;contains the&#160;appropriate type<br/>if there&#160;is a problem creating the correct&#160;type. I&#160;have&#160;never seen this happen, so don’t fret&#160;that&#160;much&#160;about&#160;<br/>your arguments;&#160;you&#160;can almost&#160;always&#160;trust&#160;OOo Basic&#160;to do the&#160;correct thing.<br/>
Listing&#160;229.&#160;Use CreateUnoValue&#160;to&#160;create&#160;a reference&#160;to&#160;an internal&#160;UNO value.<br/>
Dim&#160;v<br/>v&#160;=&#160;CreateUnoValue(&#34;unsigned long&#34;,&#160;10)<br/>v&#160;=&#160;CreateUnoValue(&#34;string&#34;,&#160;&#34;hello&#34;)<br/>v&#160;=&#160;CreateUnoValue(&#34;byte&#34;,&#160;10)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'A byte is from 0 through&#160;255<br/>v&#160;=&#160;CreateUnoValue(&#34;[]byte&#34;,&#160;Array(3,&#160;2,&#160;1))&#160;'You can even create arrays<br/>'v = CreateUnoValue(&#34;Byte&#34;, 10) &#160; &#160; &#160; &#160; &#160; &#160; &#160;'No such element exception<br/>'v = CreateUnoValue(&#34;byte&#34;, 1000) &#160; &#160; &#160; &#160; &#160; &#160;'Out of range exception<br/>'v = CreateUnoValue(&#34;uint64&#34;, 10) &#160; &#160; &#160; &#160; &#160; &#160;'No such element exception<br/>
The first&#160;argument to CreateUnoValue is the&#160;data type that&#160;should be&#160;created.&#160;The supported&#160;data types are&#160;<br/>void, char,&#160;boolean, byte, short,&#160;unsigned short,&#160;long, unsigned long, hyper,&#160;unsigned hyper,&#160;float, double,&#160;<br/>string, type, and any.&#160;The names are&#160;case sensitive&#160;and may&#160;be preceded by&#160;square brackets&#160;to indicate&#160;an&#160;<br/>array.&#160;The value&#160;returned by&#160;CreateUNOValue is not&#160;usable&#160;by&#160;OOo Basic;&#160;it&#160;is only&#160;useful&#160;to&#160;the&#160;internals&#160;<br/>of OOo. In&#160;other words, do not&#160;create a&#160;“byte” type and then expect&#160;to use it&#160;as a&#160;number.<br/>
250<br/>
<hr/>
<a name=24></a>Listing&#160;230.&#160;Test types supported by CreateUnoValue.<br/>Sub&#160;TestCreateUnoValues<br/>&#160;&#160;Dim&#160;typeNames<br/>&#160;&#160;Dim&#160;v<br/>&#160;&#160;Dim&#160;i%<br/>
&#160;&#160;typeNames&#160;=&#160;Array(&#34;void&#34;,&#160;&#34;boolean&#34;,&#160;&#34;char&#34;,&#160;&#34;byte&#34;,&#160;&#34;string&#34;,&#160;_<br/>&#160; &#160; &#160;&#160;&#34;short&#34;,&#160;&#34;unsigned short&#34;,&#160;&#34;long&#34;,&#160;&#34;unsigned long&#34;,&#160;_<br/>&#160; &#160; &#160;&#160;&#34;hyper&#34;,&#160;&#34;unsigned hyper&#34;,&#160;&#34;float&#34;,&#160;&#34;double&#34;,&#160;&#34;any&#34;)<br/>&#160; &#160; &#160;&#160;<br/>&#160;&#160;' I took the list of names&#160;from<br/>&#160;&#160;' cppu/source/typelib/typelib.cxx<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(typeNames)&#160;To&#160;UBound(typeNames)<br/>&#160; &#160;&#160;v&#160;=&#160;CreateUnoValue(typeNames(i),&#160;65)<br/>&#160; &#160;&#160;' You cannot directly use&#160;the value because it is an UNO&#160;type,<br/>&#160; &#160;&#160;' which is only good for passing back into UNO.<br/>&#160; &#160;&#160;' Things like &#34;Print v&#34; or&#160;&#34;CStr(v)&#34; will fail.<br/>&#160;&#160;Next<br/>End&#160;Sub&#160;<br/>
&#160;10.11.&#160;Finding&#160;objects and properties<br/>OOo Basic has functions&#160;to find&#160;variables&#160;and their properties based on their names.&#160;This functionality&#160;was&#160;<br/>initially&#160;described to&#160;me as poorly&#160;documented,&#160;possibly&#160;deprecated, and buggy&#160;— and I&#160;cannot disagree.&#160;<br/>Use FindObject to obtain a reference to a variable with&#160;a given name, and FindPropertyObject to&#160;obtain&#160;a&#160;<br/>reference to a named property&#160;of an object.&#160;The macro in&#160;Listing&#160;231 demonstrates some of the&#160;<br/>idiosyncrasies&#160;of the FindObject and FindPropertyObject&#160;functions.<br/>
TIP<br/>
Do not use&#160;the&#160;functions FindObject and FindPropertyObject — they&#160;are&#160;poorly&#160;documented,&#160;buggy,&#160;and&#160;<br/>likely&#160;to&#160;be&#160;deprecated. I&#160;only&#160;mention the&#160;methods to&#160;be&#160;complete.<br/>
Listing&#160;231.&#160;Test the&#160;FindObject method.<br/>Sub&#160;TestFindObject<br/>&#160;&#160;Dim&#160;oTst<br/>&#160;&#160;Dim&#160;oDoc &#160;'Initial value is EMPTY, whis ic not null.<br/>&#160;&#160;Dim&#160;oLib &#160;'Gimmicks library.<br/>&#160;&#160;Dim&#160;oMod &#160;'UserFields module in the&#160;Gimmicks library.<br/>&#160;&#160;Dim&#160;s$<br/>&#160;&#160;<br/>&#160; oTst&#160;=&#160;FindObject(&#34;oDoc&#34;)<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;&#34;oTst = FindObject(&#34;&#34;oDoc&#34;&#34;), &#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;IsNull(oTst) = &#34;&#160;&amp;&#160;IsNull(oTst)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34; and (oTst IS oDoc) = &#34;&#160;&amp;&#160;(oTst&#160;IS&#160;oDoc)<br/>&#160; &#160; &#160;&#160;<br/>&#160;&#160;Rem Test against the current document<br/>&#160; oDoc&#160;=&#160;ThisComponent<br/>&#160; oTst&#160;=&#160;FindObject(&#34;oDoc&#34;)<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;s&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oDoc = ThisComponent&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oTst = FindObject(&#34;&#34;oDoc&#34;&#34;)&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>
251<br/>
<hr/>
<a name=25></a>&#160; &#160; &#160;&#160;&#34;oDoc IS ThisComponent = &#34;&#160;&amp;&#160;(oDoc&#160;IS&#160;ThisComponent)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oTst IS oDoc = &#34;&#160;&amp;&#160;(oTst&#160;IS&#160;oDoc)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oTst IS ThisComponent = &#34;&#160;&amp;&#160;(oTst&#160;IS&#160;ThisComponent)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;CHR$(10)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oTst = FindObject(&#34;&#34;ThisComponent&#34;&#34;)&#34;&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;REM Do it again, but do search for ThisComponent<br/>&#160; oTst&#160;=&#160;FindObject(&#34;ThisComponent&#34;)<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;s&#160;&amp;&#160;&#34;oTst IS oDoc&#34;&#160;&amp;&#160;(oTst&#160;IS&#160;oDoc)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oTst IS ThisComponent = &#34;&#160;&amp;&#160;(oTst&#160;IS&#160;ThisComponent)&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oDoc IS ThisComponent = &#34;&#160;&amp;&#160;(&#160;oDoc&#160;IS&#160;ThisComponent)&#160;&amp;&#160;CHR$(10)<br/>
&#160;&#160;REM ThisComponent has a DocumentInfo property<br/>&#160; oTst&#160;=&#160;FindPropertyObject(ThisComponent,&#160;&#34;DocumentInfo&#34;)<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;s&#160;&amp;&#160;&#34;IsNull(FindPropertyObject(ThisComponent, &#34;&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;&#34;&#34;DocumentInfo&#34;&#34;))&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;returns &#34;&#160;&amp;&#160;IsNull(oTst)<br/>&#160; &#160; &#160;&#160;<br/>&#160;&#160;MsgBox&#160;s<br/>&#160;&#160;<br/>&#160;&#160;<br/>&#160;&#160;REM Load the Gimmicks library<br/>&#160;&#160;GlobalScope.BasicLibraries.LoadLibrary(&#34;Gimmicks&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM Find the library even&#160;though it is not a variable<br/>&#160; oLib&#160;=&#160;FindObject(&#34;Gimmicks&#34;)<br/>&#160;&#160;<br/>&#160;&#160;REM userfields is a module&#160;in the Gimmicks library<br/>&#160; oMod&#160;=&#160;FindPropertyObject(oLib,&#160;&#34;Userfields&#34;)<br/>&#160;&#160;<br/>&#160; s&#160;=&#160;&#34;And now for something different.&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;Find the loaded Gimmicks&#160;library&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;_<br/>&#160; &#160; &#160;&#160;&#34;oMod Is Gimmicks.Userfields = &#34;&#160;&amp;&#160;(oMod&#160;Is&#160;Gimmicks.Userfields)<br/>&#160; &#160; &#160;&#160;<br/>&#160; &#160;MsgBox&#160;s<br/>
&#160;&#160;'The StartChangesUserfields function is in the module Userfields<br/>&#160;&#160;'Call the routine<br/>&#160;&#160;Print&#160;&#34;Call 'StartChangesUserfields' directly&#34;<br/>&#160; oLib.Userfields.StartChangesUserfields<br/>&#160;&#160;Print&#160;&#34;Call 'StartChangesUserfields' using oMod&#34;<br/>&#160; oMod.StartChangesUserfields<br/>End&#160;Sub<br/>
If&#160;these functions serve your purposes, use them.&#160;I&#160;tried to&#160;use these to write an object&#160;inspector,&#160;but&#160;the&#160;<br/>FindPropertyObject&#160;function did&#160;not&#160;work as I&#160;expected.<br/>
&#160;10.12.&#160;UNO&#160;listeners<br/>OOo uses listeners to inform&#160;other objects what it&#160;is&#160;doing. Consider a hospital&#160;worker as an analogy:&#160;Before<br/>I&#160;(the hospital&#160;worker) do anything interesting to treat&#160;patient Paolo,&#160;I&#160;am&#160;required first&#160;to&#160;call his&#160;parents.&#160;<br/>
252<br/>
<hr/>
<a name=26></a>For&#160;some&#160;things the&#160;parents may&#160;say&#160;“no, you&#160;cannot&#160;do that”, and for others the&#160;parents are only&#160;informed&#160;<br/>(status updates).&#160;This&#160;is very&#160;similar&#160;to UNO&#160;listeners.&#160;The code that&#160;you write&#160;is called&#160;the listener,&#160;and the&#160;<br/>thing to which you listen is called the broadcaster.&#160;In&#160;the&#160;previous example, the&#160;hospital&#160;worker is&#160;the&#160;<br/>broadcaster and Paolo’s&#160;parents&#160;are the listeners.<br/>
You can listen to&#160;the OOo objects&#160;that&#160;act as a broadcaster.&#160;The routines required to&#160;listen to&#160;a specific&#160;OOo&#160;<br/>interface are specific&#160;to that interface. In&#160;other words, the&#160;set&#160;of subroutines and functions that&#160;can act&#160;as a&#160;<br/>listener to printing&#160;events is&#160;different than the&#160;set of subroutines and functions that&#160;can listen to&#160;keystroke&#160;<br/>events.<br/>
TIP<br/>
If&#160;you&#160;do&#160;not implement a&#160;required&#160;method&#160;specified&#160;for&#160;the&#160;listener&#160;interface,&#160;the&#160;listener&#160;may&#160;crash OOo.<br/>
&#160;10.12.1.&#160;Your&#160;first&#160;listener<br/>This listener is&#160;presented with&#160;details&#160;that&#160;are explained&#160;in the&#160;next&#160;section,&#160;so, follow the&#160;easy&#160;process and&#160;<br/>then find out&#160;why.&#160;A&#160;print listener is&#160;demonstrated in&#160;section&#160;13.15.3 A&#160;Calc example&#160;with a Print listener.<br/>
All&#160;listeners must&#160;implement&#160;the methods&#160;in the&#160;com.sun.star.lang.XEventListener interface, which defines a<br/>one subroutine;&#160;disposing(EventObject).&#160;The disposing&#160;method is&#160;called when the broadcaster is about&#160;to&#160;<br/>become&#160;unavailable.&#160;In&#160;other words, the&#160;broadcaster will&#160;no longer exist&#160;and you&#160;should&#160;not&#160;use it.&#160;For&#160;<br/>example,&#160;a&#160;print&#160;job&#160;is finished&#160;so it&#160;is no longer required or a&#160;document is&#160;closing.&#160;Listing&#160;232 demonstrates<br/>the most&#160;basic&#160;listener possible,&#160;XEventListener;&#160; Notice&#160;the&#160;string prefix&#160;“first_listen_” before the required&#160;<br/>name “disposing”; I&#160;chose “first_listen_”&#160;because it&#160;is descriptive.<br/>
Listing&#160;232.&#160;Simple listener that&#160;does nothing.<br/>
Sub&#160;first_listen_disposing(&#160;vArgument&#160;)<br/>&#160; &#160;&#160;MsgBox&#160;&#34;Disposing In First Listener&#34;<br/>End&#160;Sub<br/>
Listing 232 is all that&#160;is&#160;required for this simple&#160;listener.&#160;Use the&#160;CreateUNOListener to create&#160;a UNO&#160;<br/>listener that is associated with&#160;the macro in&#160;Listing&#160;232.&#160;The first argument is the&#160;string prefix&#160;and the&#160;<br/>second argument&#160;is the&#160;name of the service&#160;to&#160;create.<br/>
The routine&#160;in&#160;Listing 233 creates the UNO listener and associates it&#160;with&#160;the routine&#160;in&#160;Listing&#160;232.&#160;When&#160;<br/>the disposing method&#160;is called&#160;on vListener,&#160;it&#160;calls&#160;the routine&#160;in&#160;Listing&#160;232.<br/>
TIP<br/>
The&#160;code&#160;in&#160;Listing&#160;233&#160;creates a&#160;listener&#160;and then calls the&#160;objects disposing&#160;method.&#160;The&#160;listener&#160;is&#160;<br/>implemented&#160;in&#160;Listing&#160;232,&#160;so,&#160;this ultimately&#160;calls first_listen_disposing&#160;in&#160;Listing&#160;232.<br/>
Listing&#160;233.&#160;Create&#160;a listener and then&#160;call&#160;the disposing&#160;method.<br/>Sub&#160;MyFirstListener<br/>&#160;&#160;Dim&#160;vListener<br/>&#160;&#160;Dim&#160;vEventObj&#160;As&#160;New&#160;com.sun.star.lang.EventObject<br/>&#160;&#160;Dim&#160;sPrefix$<br/>&#160;&#160;Dim&#160;sService$<br/>&#160;&#160;sPrefix&#160;=&#160;&#34;first_listen_&#34;<br/>&#160;&#160;sService&#160;=&#160;&#34;com.sun.star.lang.XEventListener&#34;<br/>&#160;&#160;vListener&#160;=&#160;CreateUnoListener(sPrefix,&#160;sService)<br/>&#160;&#160;vListener.disposing(vEventObj)<br/>End&#160;Sub<br/>
253<br/>
<hr/>
<a name=27></a>&#160;10.12.2.&#160;A&#160;complete&#160;listener:&#160;selection&#160;change&#160;listener<br/>The two most&#160;difficult&#160;parts&#160;of creating a listener are determining&#160;which broadcaster and which&#160;listener&#160;<br/>interface to&#160;use.&#160;The rest&#160;of the steps are easier.<br/>
1)&#160;Determine&#160;the broadcaster to use.<br/>
2)&#160;Determine&#160;the listener interface&#160;to&#160;implement.<br/>
3)&#160;Create global&#160;variables for the&#160;listener and maybe the broadcaster.&#160;Test your&#160;understanding and ask&#160;<br/>
yourself why&#160;the variable must&#160;be global&#160;before reading&#160;the tip below.<br/>
4)&#160;Determine&#160;the prefix&#160;that&#160;you&#160;will&#160;use;&#160;make&#160;it&#160;descriptive.<br/>
5)&#160;Write all&#160;of the subroutines and functions that&#160;implement&#160;the listener.<br/>
6)&#160;Create the&#160;UNO listener and save it&#160;in&#160;the global&#160;variable.<br/>
7)&#160;Register the&#160;listener with the broadcaster.<br/>
8)&#160;When finished, remove the&#160;listener from&#160;the&#160;broadcaster.<br/>
TIP<br/>
Why&#160;store&#160;the&#160;listener&#160;in a&#160;global variable?&#160;There&#160;is usually&#160;a&#160;subroutine&#160;to create&#160;and&#160;register&#160;the&#160;listener&#160;<br/>
with the&#160;broadcaster&#160;and&#160;then the&#160;macro ends.&#160;The&#160;listener&#160;must exist&#160;when the&#160;macro&#160;stops running.&#160;The&#160;<br/>only&#160;way&#160;to&#160;do&#160;this&#160;in&#160;Basic&#160;is to use&#160;a&#160;Global&#160;variable.&#160;Another&#160;macro,&#160;run later,&#160;removes the&#160;listener&#160;from<br/>
the&#160;broadcaster.&#160;The&#160;latter&#160;macro&#160;must be&#160;able&#160;to access the&#160;listener.<br/>
Knowing which&#160;broadcaster to use is not&#160;always an easy&#160;task. It&#160;requires understanding&#160;how OOo is&#160;<br/>designed;&#160;this comes with&#160;experience.&#160;There is&#160;usually&#160;an obvious place&#160;to&#160;start&#160;looking&#160;— the current&#160;<br/>document,&#160;available&#160;from&#160;the&#160;variable&#160;ThisComponent,&#160;contains the&#160;document&#160;data.&#160;For&#160;example, the&#160;<br/>document&#160;accepts an XPrintJobListener to&#160;monitor how printing is progressing. Most&#160;tasks related&#160;to user&#160;<br/>interactions — such as selecting text,&#160;moving the mouse,&#160;and entering keystrokes&#160;— all go&#160;through the&#160;<br/>document’s&#160;controller.<br/>
After selecting the broadcaster check the&#160;broadcaster for methods with&#160;names like “add listener”. I&#160;was&#160;<br/>asked how to prevent&#160;a dialog from&#160;closing when the&#160;user clicks on the&#160;little&#160;X&#160;icon in&#160;the upper-right&#160;corner<br/>of a dialog. I&#160;reasoned that the dialog is&#160;probably&#160;the correct&#160;broadcaster to&#160;use, so I&#160;created a&#160;dialog and&#160;<br/>inspected the&#160;“dbg_methods” property&#160;to see which&#160;listeners it&#160;supports (each supported listener has “set”&#160;<br/>and “remove”&#160;methods).&#160;Another option&#160;is to&#160;determine&#160;the event&#160;type that is produced and then&#160;search for&#160;<br/>broadcasters supporting this&#160;event type. I&#160;usually&#160;do this by&#160;searching the OOo Developer’s&#160;Guide&#160;and the&#160;<br/>Internet; I&#160;discuss&#160;effective methods for finding information in&#160;Chapter&#160;19, Sources of Information.<br/>
To&#160;listen&#160;for a selection&#160;change event, implement&#160;an XSelectionChangeListener and register it&#160;with the&#160;<br/>current&#160;controller.&#160;The XSelectionChangeListener interface defines only&#160;one subroutine that must&#160;be&#160;<br/>implemented&#160;— selectionChanged(ObjectEvent).&#160;All listeners are derived from&#160;the XEventListener so the&#160;<br/>disposing(ObjectEvent) method must also&#160;be implemented.&#160;The fastest way&#160;to&#160;determine which subroutines&#160;<br/>and functions must&#160;be implemented is&#160;to create&#160;an instance of the&#160;listener by&#160;using the&#160;function&#160;<br/>CreateUNOListener and then inspect&#160;the dbg_methods&#160;property&#160;(see Listing 234 and Figure 77).<br/>
Listing&#160;234.&#160;See the&#160;methods supported by a specific listener.<br/>
Sub&#160;InspectListenerMethods<br/>&#160;&#160;Dim&#160;sPrefix$<br/>&#160;&#160;Dim&#160;sService$<br/>&#160;&#160;Dim&#160;vService<br/>&#160;&#160;sPrefix&#160;=&#160;&#34;sel_change_&#34;<br/>
254<br/>
<hr/>
<a name=28></a>&#160;&#160;sService&#160;=&#160;&#34;com.sun.star.view.XSelectionChangeListener&#34;<br/>&#160;&#160;vService&#160;=&#160;CreateUnoListener(sPrefix,&#160;sService)<br/>&#160;&#160;DisplayDbgInfoStr(vService.dbg_methods,&#160;&#34;;&#34;,&#160;35,&#160;&#34;Methods&#34;)<br/>End&#160;Sub<br/>
Figure&#160;77.&#160;Ignore&#160;the&#160;queryInterface&#160;method.<br/>
The queryInterface method&#160;is from&#160;the interface com.sun.star.uno.XInterface, which is&#160;inherited&#160;from&#160;the&#160;<br/>XEventListener.&#160;You can ignore this&#160;method.&#160;However,&#160;you&#160;must&#160;implement the rest&#160;of the routines. Choose&#160;<br/>a descriptive prefix&#160;so that&#160;the code can contain more than&#160;one listener.&#160;See&#160;Listing 235.<br/>
Listing&#160;235.&#160;Disposing&#160;and selection&#160;changed.<br/>
'All listeners must support this event<br/>Sub&#160;sel_change_disposing(vEvent)<br/>&#160;&#160;msgbox&#160;&#34;disposing the selection change listener&#34;<br/>End&#160;Sub<br/>
Sub&#160;sel_change_selectionChanged(vEvent)<br/>&#160;&#160;Dim&#160;vCurrentSelection&#160;As&#160;Object<br/>&#160; &#160;vCurrentSelection&#160;=&#160;&#160;vEvent.source<br/>&#160; &#160;Print&#160;&#34;Number of selected areas&#160;= &#34;&#160;&amp;_<br/>&#160; &#160; &#160; &#160; &#160;&#160;vCurrentSelection.getSelection().getCount()<br/>End&#160;Sub<br/>
The routine&#160;in&#160;Listing 236 creates a listener by&#160;calling the&#160;function CreateUnoListener.&#160;When&#160;I&#160;tested&#160;this&#160;<br/>listener,&#160;I&#160;ran the&#160;macro and then&#160;the macro stopped running.&#160;The listener is still&#160;active&#160;and called by&#160;the&#160;<br/>broadcaster even though the macro is no longer running. In&#160;other words, the routine&#160;in&#160;Listing 236 registers&#160;<br/>a listener,&#160;and then&#160;it&#160;is finished.&#160;The broadcaster calls&#160;the listener when things occur.&#160;The listener must&#160;be&#160;<br/>stored in a global&#160;variable&#160;so that&#160;it’s&#160;available later&#160;— for example,&#160;when it’s&#160;time&#160;to&#160;remove the&#160;listener&#160;<br/>from&#160;the object&#160;or when one of the methods is&#160;called.<br/>
Listing&#160;236.&#160;Start&#160;listening&#160;for selection change&#160;events.<br/>
Global&#160;vSelChangeListener&#160; &#160;'Must be global<br/>Global&#160;vSelChangeBroadCast<br/>
'Run this macro to start event intercepting<br/>Sub&#160;StartListeningToSelChangeEvents<br/>&#160;&#160;Dim&#160;sPrefix$<br/>&#160;&#160;Dim&#160;sService$<br/>&#160;&#160;sPrefix&#160;=&#160;&#34;sel_change_&#34;<br/>&#160;&#160;sService&#160;=&#160;&#34;com.sun.star.view.XSelectionChangeListener&#34;<br/>&#160;&#160;<br/>&#160;&#160;REM to register for a selection change, you must register&#160;with the<br/>&#160;&#160;REM current controller<br/>&#160;&#160;vSelChangeBroadCast&#160;=&#160;ThisComponent.getCurrentController<br/>&#160; &#160;&#160;<br/>&#160;&#160;'Create a listener to intercept the selection change events<br/>
255<br/>
<hr/>
<a name=29></a>&#160;&#160;vSelChangeListener&#160;=&#160;CreateUnoListener(sPrefix,&#160;sService)<br/>&#160; &#160;&#160;<br/>&#160;&#160;'Register the listener to&#160;the document controller<br/>&#160;&#160;vSelChangeBroadCast.addSelectionChangeListener(vSelChangeListener)<br/>End&#160;Sub<br/>
The behavior&#160;of the&#160;code in&#160;Listing 235 is annoying. Every&#160;time&#160;a new selection is&#160;made, the code is called&#160;<br/>and it&#160;opens a dialog on the screen.&#160;This interferes with selecting text.&#160;To&#160;remove the&#160;listener,&#160;use the&#160;code in<br/>Listing 237.<br/>
Listing&#160;237.&#160;Stop listening for&#160;selection&#160;change events.<br/>Sub&#160;StopListeningToSelChangeEvents<br/>&#160;&#160;' removes the listener<br/>&#160;&#160;vSelChangeBroadCast.removeSelectionChangeListener(vSelChangeListener)<br/>End&#160;Sub<br/>
To&#160;test&#160;the&#160;listener:<br/>
1)&#160;Start&#160;listening.<br/>
2)&#160;Make very&#160;simple&#160;selection&#160;changes such as:&#160;Click someplace. Shift+Click&#160;to select&#160;more.&#160;<br/>
Ctrl+Click to&#160;make&#160;a second selection.<br/>
3)&#160;Stop listening.<br/>
Save&#160;all&#160;open documents while testing listeners, a simple error is likely&#160;to&#160;cause OOo to&#160;crash.<br/>
&#160;10.13.&#160;Creating&#160;a UNO&#160;dialog<br/>Use CreateUnoDialog&#160;to&#160;create an existing dialog.&#160;This&#160;section introduces the&#160;function CreateUnoDialog, it&#160;<br/>does not&#160;discuss&#160;how to&#160;create&#160;dialogs. CreateUnoDialog&#160;accepts a single argument, the&#160;full&#160;path&#160;to the&#160;<br/>dialog definition.&#160;<br/>
CreateUnoDialog(GlobalScope.BasicLibraries.LibName.DialogName)<br/>
The variable GlobalScope provides access&#160;to the&#160;application-level&#160;libraries.&#160;The&#160;Tools&#160;library&#160;contains&#160;the<br/>dialog named&#160;DlgOverwriteAll;&#160;you must&#160;load the&#160;library&#160;containing&#160;the&#160;dialog before you can use the&#160;<br/>dialog.&#160;You can manually&#160;load the library,&#160;or do it&#160;directly&#160;from&#160;the macro. Use&#160;Tools&#160;&gt;&#160;Macros &gt; Organize<br/>Dialogs&#160;to&#160;open the Basic&#160;Macros Organizer dialog, which can be&#160;used&#160;To&#160;manually&#160;load libraries. Use the&#160;<br/>LoadLibrary&#160;command to&#160;load a&#160;library&#160;using a&#160;macro.<br/>
GlobalScope.BasicLibraries.LoadLibrary(&#34;Tools&#34;)<br/>CreateUnoDialog(GlobalScope.BasicLibraries.Tools.DlgOverwriteAll)<br/>
If&#160;the dialog is defined inside&#160;a document, use the&#160;BasicLibraries variable.<br/>
CreateUnoDialog(BasicLibraries.LibName.DialogName)<br/>
TIP<br/>
An&#160;event means that something&#160;happened.&#160;When&#160;certain things happen,&#160;an&#160;event&#160;object&#160;is created that&#160;<br/>
describes something&#160;about what happened.&#160;The&#160;event object is&#160;sent to a&#160;listener,&#160;or&#160;what&#160;ever&#160;routine&#160;is&#160;<br/>configured&#160;to be&#160;called&#160;when&#160;the&#160;event occurs.&#160;You can write&#160;an “event”&#160;routine&#160;that is called&#160;when&#160;<br/>
something&#160;happens; for&#160;example,&#160;when&#160;a&#160;button&#160;is pressed.<br/>
When&#160;you&#160;create a&#160;dialog, you&#160;usually&#160;write&#160;event handlers as subroutines in&#160;Basic;&#160;for example,&#160;a&#160;button&#160;in&#160;<br/>a dialog&#160;does nothing unless events are mapped to&#160;subroutines or functions that&#160;you write.&#160;You can add a&#160;<br/>close button&#160;to&#160;a&#160;dialog and map the&#160;button's “Execute action” event&#160;to&#160;a macro that&#160;closes the&#160;dialog. If&#160;a&#160;<br/>macro called from&#160;an event handler accesses a running dialog, then the&#160;dialog&#160;must&#160;be stored in&#160;a&#160;variable&#160;<br/>
256<br/>
<hr/>
<a name=30></a>that the macro can access. I&#160;generally&#160;choose to&#160;create&#160;a private&#160;variable&#160;that&#160;holds this type of data.&#160;See<br/>Listing 238.<br/>
Listing&#160;238.&#160;Display&#160;information&#160;about&#160;an object&#160;using a dialog.<br/>Private&#160;MySampleDialog<br/>Sub&#160;DisplayObjectInformation(Optional&#160;vOptionalObj)<br/>&#160;&#160;Dim&#160;vControl&#160;&#160;'Access the text control in the dialog.<br/>&#160;&#160;Dim&#160;s$&#160; &#160; &#160; &#160;&#160;'Temporary string variable.<br/>&#160;&#160;Dim&#160;vObj&#160; &#160; &#160;&#160;'Object about which to display information.<br/>&#160;&#160;<br/>&#160;&#160;REM If vOptionalObj object&#160;is not provided, use the current document.<br/>&#160;&#160;If&#160;IsMissing(vOptionalObj)&#160;Then&#160;<br/>&#160; &#160;&#160;vObj&#160;=&#160;ThisComponent<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;vObj&#160;=&#160;vOptionalObj<br/>&#160;&#160;End&#160;If<br/>&#160; &#160;&#160;<br/>&#160;&#160;REM Create the dialog and&#160;set the title<br/>&#160;&#160;MySampleDialog&#160;=&#160;CreateUnoDialog(DialogLibraries.OOME_30.MyFirstDialog)<br/>&#160;&#160;MySampleDialog.setTitle(&#34;Variable Type &#34;&#160;&amp;&#160;TypeName(vObj))<br/>&#160;&#160;<br/>&#160;&#160;REM Get the text field from the dialog&#160;<br/>&#160;&#160;REM I added this text manually<br/>&#160;&#160;vControl&#160;=&#160;MySampleDialog.getControl(&#34;TextField1&#34;)<br/>&#160;&#160;<br/>&#160;&#160;If&#160;InStr(TypeName(vObj),&#160;&#34;Object&#34;)&#160;&lt;&#160;1&#160;Then<br/>&#160; &#160;&#160;REM If this is NOT an object, simply display simple information<br/>&#160; &#160;&#160;vControl.setText(Dlg_GetObjTypeInfo(vObj))<br/>&#160; &#160;&#160;<br/>&#160;&#160;ElseIf&#160;NOT&#160;HasUnoInterfaces(vObj,&#160;&#34;com.sun.star.uno.XInterface&#34;)&#160;Then<br/>&#160; &#160;&#160;REM It is an object but it&#160;is not a UNO object.<br/>&#160; &#160;&#160;REM Cannot call HasUnoInterfaces if it is not an UNO object.<br/>&#160; &#160;&#160;vControl.setText(Dlg_GetObjTypeInfo(vObj))<br/>&#160; &#160;&#160;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;REM This is a UNO object so attempt to access the &#34;dbg_&#34;&#160;properties<br/>&#160; &#160;&#160;MySampleDialog.setTitle(&#34;Variable Type &#34;&#160;&amp;&#160;vObj.getImplementationName())<br/>&#160; &#160;&#160;s&#160;=&#160;&#34;*************** Methods **************&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;Dlg_DisplayDbgInfoStr(vObj.dbg_methods,&#160;&#34;;&#34;)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34;*************** Properties **************&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;Dlg_DisplayDbgInfoStr(vObj.dbg_properties,&#160;&#34;;&#34;)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;&#34;*************** Services&#160;**************&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160; &#160; &#160;&#160;Dlg_DisplayDbgInfoStr(vObj.dbg_supportedInterfaces,&#160;CHR$(10))<br/>&#160; &#160;&#160;vControl.setText(s)<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;<br/>&#160;&#160;REM tell the dialog to start itself<br/>&#160;&#160;MySampleDialog.execute()<br/>End&#160;Sub&#160;<br/>
257<br/>
<hr/>
<a name=31></a>TIP<br/>
Store&#160;the&#160;dialog&#160;in&#160;a&#160;private&#160;variable&#160;declared&#160;as type&#160;Object.&#160;Use&#160;a&#160;private&#160;variable so that it&#160;doesn’t&#160;<br/>
needlessly&#160;affect other&#160;modules. On at&#160;least one occasion, a&#160;dialog&#160;that I&#160;created&#160;worked when it was held&#160;<br/>in a&#160;variable&#160;declared&#160;as an Object,&#160;but failed&#160;when held&#160;in&#160;a&#160;variable&#160;declared&#160;as a&#160;Variant; so much&#160;for&#160;my<br/>
recommendation to usually&#160;a&#160;variant rather&#160;than an Object.<br/>
The macro in&#160;Listing&#160;238 displays&#160;a dialog that displays&#160;information about the object&#160;that&#160;was passed in&#160;as&#160;<br/>an argument. I&#160;use the&#160;HasUnoInterfaces function&#160;to see if this&#160;is a UNO&#160;service.&#160;I&#160;first&#160;check to&#160;see if&#160;the&#160;<br/>object’s&#160;TypeName contains the&#160;text&#160;“Object”;&#160;this tells&#160;me if the&#160;object&#160;is really&#160;an object.<br/>
If&#160;InStr(TypeName(vObj),&#160;&#34;Object&#34;)&#160;&lt;&#160;1&#160;Then<br/>
If&#160;the object&#160;is not&#160;an object&#160;that&#160;supports a UNO&#160;interface, the object&#160;is inspected&#160;and information&#160;about&#160;it&#160;<br/>displayed. Listing 239 shows&#160;the text&#160;string to do this.&#160;Figure 78 shows the&#160;results.<br/>
Listing&#160;239.&#160;Return type information&#160;as a string.<br/>
Function&#160;Dlg_GetObjTypeInfo(vObj)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String<br/>&#160;&#160;s&#160;=&#160;&#34;TypeName = &#34;&#160;&amp;&#160;TypeName(vObj)&#160;&amp;&#160;CHR$(10)&#160;&amp;_<br/>&#160; &#160;&#160;&#34;VarType = &#34;&#160;&amp;&#160;VarType(vObj)&#160;&amp;&#160;CHR$(10)<br/>&#160;&#160;If&#160;IsNull(vObj)&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsNull = True&#34;<br/>&#160;&#160;ElseIf&#160;IsEmpty(vObj)&#160;Then<br/>&#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsEmpty = True&#34;<br/>&#160;&#160;Else<br/>&#160; &#160;&#160;If&#160;IsObject(vObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsObject = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsUnoStruct(vObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsUnoStruct = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsDate(vObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsDate = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsNumeric(vObj)&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsNumeric = True&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;If&#160;IsArray(vObj)&#160;Then<br/>&#160; &#160; &#160;&#160;On&#160;Local&#160;Error&#160;Goto&#160;DebugBoundsError:<br/>&#160; &#160; &#160;&#160;Dim&#160;i%,&#160;sTemp$<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;IsArray = True&#34;&#160;&amp;&#160;CHR$(10)&#160;&amp;&#160;&#34;range = (&#34;<br/>&#160; &#160; &#160;&#160;Do&#160;While&#160;(i%&#160;&gt;=&#160;0)<br/>&#160; &#160; &#160; &#160;&#160;i%&#160;=&#160;i%&#160;+&#160;1<br/>&#160; &#160; &#160; &#160;&#160;sTemp$&#160;=&#160;LBound(vObj,&#160;i%)&#160;&amp;&#160;&#34; To &#34;&#160;&amp;&#160;UBound(vObj,&#160;i%)<br/>&#160; &#160; &#160; &#160;&#160;If&#160;i%&#160;&gt;&#160;1&#160;Then&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;, &#34;<br/>&#160; &#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;sTemp$<br/>&#160; &#160; &#160;&#160;Loop<br/>&#160; &#160; &#160;&#160;DebugBoundsError:<br/>&#160; &#160; &#160;&#160;On&#160;Local&#160;Error&#160;Goto&#160;0<br/>&#160; &#160; &#160;&#160;s&#160;=&#160;s&#160;&amp;&#160;&#34;)&#34;&#160;&amp;&#160;CHR$(10)<br/>&#160; &#160;&#160;End&#160;If<br/>&#160;&#160;End&#160;If<br/>&#160;&#160;Dlg_GetObjTypeInfo&#160;=&#160;s<br/>End&#160;Function<br/>
Figure 78.&#160;The variable&#160;is an array of&#160;strings<br/>
258<br/>
<hr/>
<a name=32></a>If&#160;the first argument supports&#160;a UNO interface, the&#160;“dbg_” properties are used to display&#160;all&#160;of the&#160;methods,&#160;<br/>properties,&#160;and services supported by&#160;this&#160;object&#160;(see&#160;Listing 240 and Figure 79). &#160;This&#160;is very&#160;similar to&#160;the&#160;<br/>code in&#160;Listing 221, except&#160;that&#160;it&#160;returns a&#160;string rather than&#160;displaying&#160;a series of simple dialogs.&#160;This is&#160;an&#160;<br/>excellent way&#160;to quickly&#160;see&#160;what methods,&#160;properties, and interfaces an object supports. Notice also that the<br/>variable&#160;type is displayed in&#160;the upper-left&#160;corner of the dialog.<br/>
Listing&#160;240.&#160;Convert the&#160;debug string into one string&#160;with&#160;new&#160;line&#160;characters.<br/>Function&#160;Dlg_DisplayDbgInfoStr(sInfo$,&#160;sSep$)&#160;As&#160;String<br/>&#160;&#160;Dim&#160;aInfo()&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Array to hold each string<br/>&#160;&#160;Dim&#160;i&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Index variable<br/>&#160;&#160;Dim&#160;j&#160;As&#160;Integer&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;'Junk integer variable for&#160;temporary values<br/>&#160;&#160;Dim&#160;s&#160;As&#160;String&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'holds the portion that is&#160;not completed<br/>&#160;&#160;s&#160;=&#160;sInfo$<br/>&#160;&#160;j&#160;=&#160;InStr(s,&#160;&#34;:&#34;)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Initial colon<br/>&#160;&#160;If&#160;j&#160;&gt;&#160;0&#160;Then&#160;Mid(s,&#160;1,&#160;j,&#160;&#34;&#34;)&#160;&#160;'Remove portion up to the&#160;initial colon<br/>&#160;&#160;aInfo()&#160;=&#160;Split(s,&#160;sSep$)&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'Split string based on delimiter<br/>&#160;&#160;For&#160;i&#160;=&#160;LBound(aInfo())&#160;To&#160;Ubound(aInfo())&#160;&#160;'Look at each piece to remove<br/>&#160; &#160;&#160;aInfo(i)&#160;=&#160;Trim(aInfo(i))&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'leading and trailing spaces<br/>&#160; &#160;&#160;j&#160;=&#160;InStr(aInfo(i),&#160;CHR$(10))&#160; &#160; &#160; &#160; &#160; &#160; &#160;'Some have an extra&#160;<br/>&#160; &#160;&#160;If&#160;j&#160;&gt;&#160;0&#160;&#160;Then&#160;Mid(aInfo(i),&#160;j,&#160;1,&#160;&#34;&#34;)&#160; &#160;&#160;'new line that should be removed<br/>&#160;&#160;Next<br/>&#160;&#160;Dlg_DisplayDbgInfoStr&#160;=&#160;Join(aInfo(),&#160;CHR$(10))<br/>End&#160;Function&#160;<br/>
Figure 79.&#160;The variable&#160;is a Writer document.<br/>
259<br/>
<hr/>
<a name=33></a>&#160;10.14.&#160;Conclusion<br/>The subroutines and functions supplied with&#160;OOo Basic&#160;support&#160;a&#160;wide&#160;range of operations that&#160;are required&#160;<br/>to access&#160;the&#160;internals of OOo. Use the methods presented in&#160;this chapter to inspect&#160;and use the&#160;UNO&#160;<br/>services.&#160;This chapter examined&#160;the fundamentals&#160;for creating UNO listeners. UNO listeners provide&#160;basic&#160;<br/>system functionality,&#160;and new UNO&#160;listeners extend this functionality&#160;to&#160;give&#160;the programmer a&#160;great deal&#160;of<br/>control&#160;over system&#160;applications and behavior.&#160;Any&#160;UNO listener listens&#160;to one or more broadcasters,&#160;<br/>providing&#160;the&#160;capability&#160;to&#160;respond to system&#160;events that&#160;are&#160;communicated across&#160;applications.<br/>
260<br/>
<hr/>
</body>
</html>
