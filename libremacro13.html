<p>
    13. Generic Document Methods
</p>
<p>
    OpenOffice.org supports six primary document types: text, spreadsheet, drawing, math, database, and presentation.
    The different document types share significant functionality and interfaces, such as accessing the document model,
    printing, and saving. This chapter introduces common tasks across all of the document types.
</p>
<p>
    Every document contains data that can be manipulated and printed. For example, the primary data in a Writer document
    is text, but it can also contain tables and graphics. The data model consists of this underlying data that can be
    manipulated independently of how it is displayed. To manipulate the data by means of a macro, you manipulate the
    data model directly. Although you can use the dispatcher to indirectly manipulate the data, the changes are still
    made directly to the model. A typical usage of the dispatcher is to paste the clipboard contents into the document
    (see Chapter 11 The Dispatcher).
</p>
<p>
    The data model contains a Controller object, which manipulates the visual presentation of the data. The controller
    doesn’t change the data; it only controls how the document is presented. The controller interacts directly with the
    user interface to control the location of the displayed cursor, to control which page is displayed, and to select
    portions of the document. Use the controller to determine display-related information such as the current page or
    the currently selected text.
</p>
<blockquote>
    <p>
        TIP OOo supports a mode called “headless,” which has no startup screen, no default document, no user interface,
        and supports no user interaction. (Use “soffice -?” to see a list of supported modes.) If OOo is started in
        headless mode, there is no display component. Therefore, a controller is not required and may not exist. If it’s
        possible for your macro to run on OOo in headless mode, you must check the controller to see if it is null
        before using it.
    </p>
</blockquote>
<h1 id="service-manager">
    13.1. Service Manager
</h1>
<p>
    OpenOffice.org has a general global service manager, which is used to create and obtain instances of general UNO
    services. A service manager accepts a string that identifies a type of object, and it returns an instance of that
    object. The global service manager is made available in OOo Basic through the function
</p>
<p>
    createUnoService(String). The global service manager returns general objects such as a dispatch helper or an object
    for simple file access. Listing 272. Use the global service manager.
</p>
<p>
    oDispatcher = createUnoService("com.sun.star.frame.DispatchHelper") oSimpleFileAccess =
    createUnoService("com.sun.star.ucb.SimpleFileAccess")
</p>
<p>
    Documents are a service manager to create objects that they contain (or that are directly related to the document);
    for example, a Writer document is able to create a text table or text field that can be inserted into the document.
    In general, objects that were not created by a document cannot be inserted into the document. A Writer document is
    unable to return global objects, and the global service manager is unable to return objects that are then inserted
    into a document. Listing 273. Use a document as a service manager.
</p>
<p>
    REM Let the document create the text table. oTable = oDoc.createInstance( "com.sun.star.text.TextTable" )
    oTable.initialize(3, 2) 'Three rows, two columns
</p>
<p>
    REM Now insert the text table at the end of the document.
</p>
<p>
    oDoc.Text.insertTextContent(oDoc.Text.getEnd(), oTable, False)
</p>
<h1 id="services-and-interfaces">
    13.2. Services and interfaces
</h1>
<p>
    Think of an OOo component as a window owned by the desktop. Use the Desktop object to enumerate the components,
    including documents, the Basic IDE and the help window along with the actual documents. If a component supports the
    com.sun.star.frame.XModel interface, the component is a document (rather than the Basic IDE or the help window).
    Every document supports the XModel interface and each document type has a unique service that it supports (see Table
    101). Use HasUnoInterfaces to determine if an object supports the XModel interface; then use the object method
    supportsService to determine the document type.
</p>
<blockquote>
    <p>
        TIP The method supportsService() is defined by the com.sun.star.lang.XServiceInfo interface. This interface also
        defines the method getImplementationName(), which returns a unique string identifying the object type.
    </p>
</blockquote>
<p>
    Table 101. Unique services that identify the document’s type.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Service
            </td>
            <td>
                Document Type
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.TextDocument
            </td>
            <td>
                Writer text document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.SpreadsheetDocument
            </td>
            <td>
                Calc spreadsheet document.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.drawing.DrawingDocument
            </td>
            <td>
                Draw drawing document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.presentation.PresentationDocument
            </td>
            <td>
                Impress presentation document.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.formula.FormulaProperties
            </td>
            <td>
                Math formula document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.comp.dba.ODatabaseDocument
            </td>
            <td>
                Base Document
            </td>
        </tr>
    </tbody>
</table>
<p>
    OOo contains numerous interfaces that are used by many (if not all) of the document types. Consider this partial
    list of common interfaces.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Interface
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.beans.XPropertySet
            </td>
            <td>
                Get and set object properties.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.container.XChild
            </td>
            <td>
                For objects with a single parent, get and set that parent.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.datatransfer.XTransferable
            </td>
            <td>
                Get data for data transfer; like copying to the clipboard.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.document.XDocumentPropertiesSupplier
            </td>
            <td>
                Access a documents properties; for example, author and creation date.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.document.XDocumentEventBroadcaster
            </td>
            <td>
                Register to be notified when events occur.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.document.XEventsSupplier
            </td>
            <td>
                Get a list of events supported by this object.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.document.XLinkTargetSupplier
            </td>
            <td>
                Get the list of link targets in a document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.document.XViewDataSupplier
            </td>
            <td>
                Get properties describing a document's open views.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.drawing.XDrawPagesSupplier
            </td>
            <td>
                Get draw pages for documents that support multiple draw pages; for example, a drawing or a presentation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.frame.XLoadable
            </td>
            <td>
                Functionality to load documents.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.frame.XModel
            </td>
            <td>
                Representation of a resource (document) in the sense that it was created/loaded from a resource; off
                hand, I am not aware of any document that does not implement XModel. This interface also provides access
                to the model's components.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.frame.XStorable
            </td>
            <td>
                Methods to store a document.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.lang.XComponent
            </td>
            <td>
                Allows an object to own and dispose (free) an object; for example, a text table.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.lang.XEventListener
            </td>
            <td>
                Base interface for all listeners; provides a disposing method.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.lang.XMultiServiceFactory
            </td>
            <td>
                Implemented by factories to create objects and determine what objects the factor can create.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.lang.XServiceInfo
            </td>
            <td>
                Determine which services an object supports.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.lang.XTypeProvider
            </td>
            <td>
                Determine the types (interfaces) an object supports.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.script.XStarBasicAccess
            </td>
            <td>
                Deprecated, but provides access to libraries.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.style.XStyleFamiliesSupplier
            </td>
            <td>
                Get style families supported by a document; for example, paragraph styles.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.util.XCloseBroadcaster
            </td>
            <td>
                Allows an object to veto a close request.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.util.XCloseable
            </td>
            <td>
                Ask a document to close; this is preferred to dispose.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.util.XModifiable
            </td>
            <td>
                Determine if a document has been modified.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.util.XModifyBroadcaster
            </td>
            <td>
                Register and be notified when a document is modified.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.util.XNumberFormatsSupplier
            </td>
            <td>
                Get the document's number formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.view.XPrintJobBroadcaster
            </td>
            <td>
                Register and be notified about print progress.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.view.XPrintable
            </td>
            <td>
                Document print functionality.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.view.XRenderable
            </td>
            <td>
                Functionality to render a document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Ironically, searching is not supported by all document types. This is because searching functionality is very
    specific to the document. For example, searching a text document is very different than searching a spreadsheet (in
    terms of desired options). In Calc, searching is provided by the each sheet rather than by the document.
</p>
<p>
    A Calc document is composed of multiple spreadsheets. A significant portion of the functionality, therefore, exists
    in the spreadsheet objects rather than in the parent Calc document. For example, searching text or obtaining draw
    pages both exist in spreadsheet objects — draw pages are discussed in depth in Chapter 16 Draw and Impress
    Documents.
</p>
<p>
    The OpenOffice.org API Web site contains extensive, detailed help on most of the services and interfaces. The page
    is built by starting with the Web address “http://api.openoffice.org/docs/common/ref/” and then using the interface
    name to build the rest of the address. For example, the com.sun.star.beans.XPropertySet interface has an Internet
    address as follows: <em>http://api.openoffice.org/docs/common/ref/com/sun/star/beans/XPropertySet.html</em>
</p>
<h1 id="getting-and-setting-properties">
    13.3. Getting and setting properties
</h1>
<p>
    The dbg_properties property is a string containing a list of properties supported the object containing the
    property; you should read that last sentence again.
</p>
<p>
    OOo Basic automatically makes these properties available for direct access; other languages may not. The
    com.sun.star.beans.XPropertySet interface provides methods to get, set, and enumerate the object’s properties, as
    shown in Table 102.
</p>
<p>
    Table 102. Object methods defined by the interface XPropertySet.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Object Method
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                getPropertySetInfo()
            </td>
            <td>
                <p>
                    Return an object supporting the
                </p>
                <p>
                    com.sun.star.beans.XPropertySetInfo interface. This object describes the object’s properties but may
                    be null.
                </p>
            </td>
        </tr>
        <tr class="odd">
            <td>
                setPropertyValue(name, value)
            </td>
            <td>
                Set the value of the named property. A listener may veto this change.
            </td>
        </tr>
        <tr class="even">
            <td>
                getPropertyValue(name)
            </td>
            <td>
                Return the value of the named property.
            </td>
        </tr>
        <tr class="odd">
            <td>
                addPropertyChangeListener(name, listener)
            </td>
            <td>
                Add an XPropertyChangeListener for the named property. An empty name listens for all properties.
            </td>
        </tr>
        <tr class="even">
            <td>
                removePropertyChangeListener(name, listener)
            </td>
            <td>
                Remove an XPropertyChangeListener.
            </td>
        </tr>
        <tr class="odd">
            <td>
                addVetoableChangeListener(name, listener)
            </td>
            <td>
                Add an XVetoableChangeListener for the named property. An empty name listens for all properties.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeVetoableChangeListener(name, listener)
            </td>
            <td>
                Removes an XVetoableChangeListener.
            </td>
        </tr>
    </tbody>
</table>
<p>
    In OOo Basic, properties are usually accessed directly. Listing 274 demonstrates two ways to obtain the CharFontName
    property from a Writer document — these methods return the name of the font style. Listing 274. Two methods to
    obtain the name of the font style.
</p>
<p>
    Print ThisComponent.CharFontName
</p>
<p>
    Print CStr(ThisComponent.getPropertyValue("CharFontName"))
</p>
<p>
    Accessing the property directly is the most expedient method while using OOo Basic, but there are advantages to
    using the methods defined by the XPropertySetInfo interface. Some properties are defined as optional, so not every
    document contains every property. The XPropertySetInfo interface defines the object method hasPropertyByName(),
    which can be used to test for the existence of a property before use; errors can still be avoided by using
    error-handling routines. Another use is to generically enumerate all of the contained properties and possibly their
    values as shown in Listing 275. Figure 82 shows some properties of a Writer document using the macro in Listing 275.
    Listing 275. Display general document properties.
</p>
<p>
    Sub getPropertyValues
</p>
<p>
    Dim vPropInfo 'PropertySetInfo object
</p>
<p>
    Dim vProps 'Array of properties
</p>
<p>
    Dim vProp 'com.sun.star.beans.Property
</p>
<p>
    Dim v 'Value of a single property
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
    Dim s$ 'General message string
</p>
<p>
    Dim nCount%
</p>
<p>
</p>
<p>
    REM Object implements interface com.sun.star.beans.XPropertySetInfo vPropInfo = ThisComponent.getPropertySetInfo()
    REM sequence&lt; Property &gt; vPropInfo.getProperties()
</p>
<p>
    REM Property vPropInfo.getPropertyByName(name)
</p>
<p>
    REM boolean vPropInfo.hasPropertyByName(name)
</p>
<p>
    vProps = vPropInfo.getProperties()
</p>
<p>
    For i = 0 To UBound(vProps) If nCount = 30 Then nCount = 0
</p>
<p>
    MsgBox s, 0, "Properties" s = ""
</p>
<p>
    End If
</p>
<p>
    nCount = nCount + 1
</p>
<p>
    vProp = vProps(i) 'com.sun.star.beans.Property s = S &amp; vProp.Name &amp; " = "
</p>
<p>
    v = ThisComponent.getPropertyValue(vProp.Name)
</p>
<p>
    If IsNull(v) Then s = S &amp; "Null" ElseIf IsEmpty(v) Then s = S &amp; "Empty"
</p>
<p>
    ElseIf VarType(v) &lt; 9 Then s = S &amp; CStr(v) Else
</p>
<p>
    s = S &amp; "Object or Array" End If
</p>
<p>
    s = S &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Properties"
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image1.png" style="width:2.43333in;height:2.04667in" />
    </p>
</blockquote>
<p>
    Figure 82. The first 10 properties of ThisComponent.
</p>
<blockquote>
    <p>
        TIP In case you missed the implications of the macro in Listing 275, it allows you to generically inspect any
        object that supports the XPropertySet interface. The ability to inspect an object is invaluable when you aren’t
        certain what you can do with an object.
    </p>
</blockquote>
<p>
    After getting a property set information object,
</p>
<ul>
    <li>
        Use getProperties() to get an array of Property objects.
    </li>
    <li>
        Use hasProperty(name) to determine if a property exists.
    </li>
    <li>
        Use getPropertyByName(name) to get a specific property.
    </li>
</ul>
<h1 id="document-properties">
    13.4. Document properties
</h1>
<p>
    Document properties contain information related to the document such as the author and creation time; as opposed to
    the properties discussed in the previous section that are related to the document contents such as the current font.
</p>
<p>
    Previous methods for obtaining document properties have been deprecated; for example, using getDocumentInfo to
    obtain and modify user fields. Use File | Properties to open the document properties dialog. Use
    getDocumentProperties to obtain the DocumentProperties object. Listing 276. Use the DocumentProperties object.
</p>
<p>
    ' com.sun.star.document.DocumentProperties
</p>
<p>
    printDocProperties(ThisComponent.getDocumentProperties()) End Sub
</p>
<p>
    Sub printDocProperties(oDocProps)
</p>
<p>
    Dim s$
</p>
<p>
    Dim oData
</p>
<p>
    s = "Author : " &amp; oDocProps.Author &amp; CHR$(10) &amp; _
</p>
<p>
    "AutoloadSecs : " &amp; oDocProps.AutoloadSecs &amp; CHR$(10) &amp; _
</p>
<p>
    "AutoloadURL : " &amp; oDocProps.AutoloadURL &amp; CHR$(10) &amp; _
</p>
<p>
    "DefaultTarget : " &amp; oDocProps.DefaultTarget &amp; CHR$(10) &amp; _
</p>
<p>
    "Description : " &amp; oDocProps.Description &amp; CHR$(10) &amp; _
</p>
<p>
    "EditingCycles : " &amp; oDocProps.EditingCycles &amp; CHR$(10) &amp; _
</p>
<p>
    "EditingDuration : " &amp; _
</p>
<p>
    secondsAsPrettyTime(oDocProps.EditingDuration) &amp; CHR$(10) &amp; _
</p>
<p>
    "Generator : " &amp; oDocProps.Generator &amp; CHR$(10) &amp; _
</p>
<p>
    "ModifiedBy : " &amp; oDocProps.ModifiedBy &amp; CHR$(10) &amp; _
</p>
<p>
    "Title : " &amp; oDocProps.Title &amp; CHR$(10) &amp; _
</p>
<p>
    "Language : " &amp; oDocProps.Language.Country &amp; ":" &amp; _ oDocProps.Language.Language &amp; CHR$(10) &amp; _
</p>
<p>
    "ModificationDate : " &amp; oDocProps.ModificationDate.Day &amp; "/" &amp; _ oDocProps.ModificationDate.Month &amp;
    "/" &amp; _ oDocProps.ModificationDate.Year &amp; " " &amp; _ oDocProps.ModificationDate.Hours &amp; ":" &amp; _
    oDocProps.ModificationDate.Minutes &amp; ":" &amp; _ oDocProps.ModificationDate.Seconds &amp; "." &amp; _
</p>
<p>
    oDocProps.ModificationDate.HundredthSeconds &amp; CHR$(10) &amp; _
</p>
<p>
    "PrintDate : " &amp; oDocProps.PrintDate.Month &amp; "/" &amp; _ oDocProps.PrintDate.Day &amp; "/" &amp; _
    oDocProps.PrintDate.Year &amp; " " &amp; _ oDocProps.PrintDate.Hours &amp; ":" &amp; _ oDocProps.PrintDate.Minutes
    &amp; ":" &amp; _ oDocProps.PrintDate.Seconds &amp; "." &amp; _
</p>
<p>
    oDocProps.PrintDate.HundredthSeconds &amp; CHR$(10) &amp; _
</p>
<p>
    "PrintedBy : " &amp; oDocProps.PrintedBy &amp; CHR$(10) &amp; _
</p>
<p>
    "Subject : " &amp; oDocProps.Subject &amp; CHR$(10) &amp; _
</p>
<p>
    "TemplateDate : " &amp; oDocProps.TemplateDate.Month &amp; "/" &amp; _ oDocProps.TemplateDate.Day &amp; "/" &amp; _
    oDocProps.TemplateDate.Year &amp; " " &amp; _ oDocProps.TemplateDate.Hours &amp; ":" &amp; _
    oDocProps.TemplateDate.Minutes &amp; ":" &amp; _ oDocProps.TemplateDate.Seconds &amp; "." &amp; _
</p>
<p>
    oDocProps.TemplateDate.HundredthSeconds &amp; CHR$(10) &amp; _
</p>
<p>
    "TemplateName : " &amp; oDocProps.TemplateName &amp; CHR$(10) &amp; _
</p>
<p>
    "TemplateURL : " &amp; oDocProps.TemplateURL &amp; CHR$(10) &amp; _
</p>
<p>
    "Title : " &amp; oDocProps.Title &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Document Properties"
</p>
<p>
    Dim i%
</p>
<p>
    oData = oDocProps.DocumentStatistics s = ""
</p>
<p>
    For i = LBound(oData) To UBound(oData)
</p>
<p>
    s = s &amp; oData(i).Name &amp; " : " &amp; oData(i).Value &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Document Statistics"
</p>
<p>
    oData = oDocProps.Keywords s = ""
</p>
<p>
    For i = LBound(oData) To UBound(oData) s = s &amp; oData(i) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Keywords"
</p>
<p>
    'I have little experience with this object.
</p>
<p>
    'Seems that the user defined properties are available here.
</p>
<p>
    'com.sun.star.comp.comphelper.OPropertyBag oData = oDocProps.UserDefinedProperties End Sub
</p>
<h2 id="document-properties-from-a-closed-document">
    13.4.1. Document properties from a closed document
</h2>
<p>
    It is easy to access the document properties from a document that is not open. Listing 277. Read the document
    properties from a document that is not open.
</p>
<p>
    Sub loadExternalProperties
</p>
<p>
    Dim sPath$
</p>
<p>
    Dim sPathUrl Dim oDocProps
</p>
<p>
    sPath = ConvertToUrl("/andrew0/home/andy/MoveFigsFromFrames.odt") oDocProps =
    CreateUnoService("com.sun.star.document.DocumentProperties") oDocProps.loadFromMedium(sPath, Array())
</p>
<p>
    printDocProperties(oDocProps) End Sub
</p>
<h2 id="custom-properties">
    13.4.2. Custom properties
</h2>
<p>
    You can create and remove your own custom document properties. Use the PropertyAttribute constants shown in Table
    103 while creating an attribute to control the behavior of created properties.
</p>
<p>
    Table 103. com.sun.star.beans.PropertyAttribute constants.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Constant
            </td>
            <td>
                Value
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                MAYBEVOID
            </td>
            <td>
                1
            </td>
            <td>
                The property value can be void.
            </td>
        </tr>
        <tr class="odd">
            <td>
                BOUND
            </td>
            <td>
                2
            </td>
            <td>
                A PropertyChangeEvent will be fired to all registered property change listeners when the value of this
                property changes.
            </td>
        </tr>
        <tr class="even">
            <td>
                CONSTRAINED
            </td>
            <td>
                4
            </td>
            <td>
                A PropertyChangeEvent will be fired to all registered vetoable change listeners when the value of this
                property changes.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TRANSIENT
            </td>
            <td>
                8
            </td>
            <td>
                The property value is not saved with the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                READONLY
            </td>
            <td>
                16
            </td>
            <td>
                The property value is read-only.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MAYBEAMBIGUOUS
            </td>
            <td>
                32
            </td>
            <td>
                The property value may be ambiguous.
            </td>
        </tr>
        <tr class="even">
            <td>
                MAYBEDEFAULT
            </td>
            <td>
                64
            </td>
            <td>
                The property can be set to default.
            </td>
        </tr>
        <tr class="odd">
            <td>
                REMOVEABLE
            </td>
            <td>
                128
            </td>
            <td>
                The property can be removed. This used to be called REMOVABLE.
            </td>
        </tr>
        <tr class="even">
            <td>
                OPTIONAL
            </td>
            <td>
                256
            </td>
            <td>
                The property is optional.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use addProperty(name, attributes, default_value) to create a new property and removeProperty(name) to remove a
    property from the document properties. When a property is created, that property is added to the document's
    properties, so you can use the property set information object Listing 278. Add a new document property.
</p>
<p>
    Sub AddNewDocumentProperty Dim oUDP
</p>
<p>
    oUDP = ThisComponent.getDocumentProperties().UserDefinedProperties If NOT
    oUDP.getPropertySetInfo().hasPropertyByName("AuthorLastName") Then oUDP.addProperty("AuthorLastName", _
</p>
<p>
    com.sun.star.beans.PropertyAttribute.MAYBEVOID + _ com.sun.star.beans.PropertyAttribute.REMOVEABLE + _
    com.sun.star.beans.PropertyAttribute.MAYBEDEFAULT, _
</p>
<p>
    "Default Last Name")
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<h2 id="deprecated-document-information-object">
    13.4.3. Deprecated document information object
</h2>
<p>
    The deprecated method getDocumentInfo was the previous method for obtaining and modifying user data.
</p>
<p>
    The macro in Listing 279 sets the value of a user field and then displays its value.
</p>
<p>
    TIP DocumentInfo and StandaloneDocumentInfo are deprecated and replaced by DocumentProperties.
</p>
<p>
    Listing 279. Deprecated method for getting and setting user information data.
</p>
<p>
    Sub GetUserInfoFields
</p>
<p>
    Dim vDocInfo 'Document Information Object
</p>
<p>
    Dim s$ 'General string to print Dim i% 'Index variable
</p>
<p>
    vDocInfo = ThisComponent.getDocumentInfo()
</p>
<p>
    vDocInfo.setUserFieldValue(1, "My special user value")
</p>
<p>
    For i% = 0 To vDocInfo().getUserFieldCount()-1 s$ = s$ &amp; vDocInfo.getUserFieldName(i) &amp; " = " &amp;_
    CStr(vDocInfo.getUserFieldValue(i)) &amp; CHR$(10) Next
</p>
<blockquote>
    <p>
        MsgBox s$, 0, "Info Fields" End Sub
    </p>
</blockquote>
<h1 id="list-events">
    13.5. List events
</h1>
<p>
    As OOo operates, it generates events to inform listeners that something has occurred. The event listener/supplier
    framework allows a macro to be called or a listener to be notified when a specific event occurs — for example, when
    a document is loaded or modified, or when text selection changes. Each document type supports the two interfaces
    com.sun.star.document.XEventBroadcaster and
</p>
<p>
    com.sun.star.document.XEventsSupplier, allowing them to support event-related activities — for example, broadcasting
    events to listeners and providing a list of supported events.
</p>
<p>
    The macro in Listing 280 lists the event listeners registered with the current document and for OOo. Another use for
    this macro is to list the events supported by the document. Although there are no registered listeners, this macro
    provides a nice list of the supported event types. Listing 280. List the document's events.
</p>
<p>
    Sub DisplayAvailableEvents
</p>
<p>
    Dim oGEB ' GlobalEventBroadcaster
</p>
<p>
    Dim oDoc
</p>
<p>
    Dim s$
</p>
<p>
    Dim oText
</p>
<p>
</p>
<p>
    oDoc = StarDesktop.LoadComponentFromUrl("private:factory/swriter", "_blank", 0, Array()) oGEB =
    createUnoservice("com.sun.star.frame.GlobalEventBroadcaster") s = Join(oGEB.Events.getElementNames(), CHR$(10))
    oText = oDoc.Text
</p>
<p>
    oText.InsertString(oText.End, "===Global Events" &amp; CHR$(10), False) oText.InsertString(oText.End, s, False)
</p>
<p>
    s = Join(oDoc.Events.getElementNames(), CHR$(10))
</p>
<p>
    oText.InsertString(oText.End, CHR$(10) &amp; CHR$(10) &amp; "===Writer Events" &amp; CHR$(10), False)
    oText.InsertString(oText.End, s, False) End Sub
</p>
<p>
    Here is a list of events:
</p>
<ol type="1">
    <li>
        OnStartApp
    </li>
    <li>
        OnCloseApp
    </li>
    <li>
        OnCreate
    </li>
    <li>
        OnNew
    </li>
    <li>
        OnLoadFinished
    </li>
    <li>
        OnLoad
    </li>
    <li>
        OnPrepareUnload
    </li>
    <li>
        OnUnload
    </li>
    <li>
        OnSave
    </li>
    <li>
        OnSaveDone
    </li>
    <li>
        OnSaveFailed
    </li>
    <li>
        OnSaveAs
    </li>
    <li>
        OnSaveAsDone
    </li>
    <li>
        OnSaveAsFailed
    </li>
    <li>
        OnCopyTo
    </li>
    <li>
        OnCopyToDone
    </li>
    <li>
        OnCopyToFailed
    </li>
    <li>
        OnFocus
    </li>
    <li>
        OnUnfocus
    </li>
    <li>
        OnPrint
    </li>
    <li>
        OnViewCreated
    </li>
    <li>
        OnPrepareViewClosing
    </li>
    <li>
        OnViewClosed
    </li>
    <li>
        OnModifyChanged
    </li>
    <li>
        OnTitleChanged
    </li>
    <li>
        OnVisAreaChanged
    </li>
    <li>
        OnModeChanged
    </li>
    <li>
        OnStorageChanged
    </li>
    <li>
        OnPageCountChange
    </li>
    <li>
        OnMailMerge
    </li>
    <li>
        OnMailMergeFinished
    </li>
    <li>
        OnFieldMerge
    </li>
    <li>
        OnFieldMergeFinished
    </li>
    <li>
        OnLayoutFinished
    </li>
</ol>
<blockquote>
    <p>
        TIP Many objects besides documents support event listeners. For example, you can listen to an individual cell in
        a Calc document.
    </p>
</blockquote>
<h2 id="registering-your-own-listener">
    13.5.1. Registering your own listener
</h2>
<p>
    The macro in Listing 280 uses the GlobalEventBroadcaster to access event listeners at the OOo level. The macro in
    Listing 281 replaces the documents OnSave listener with a macro named MySave, in Module1, in the Standard library
    for My Macros. When the document is saved, MySave is automatically called. The association is maintained even after
    closing and opening the document. Listing 281. Register your own listener.
</p>
<p>
    Sub StealAnEvent
</p>
<p>
    Dim mEventProps(1) as new com.sun.star.beans.PropertyValue
</p>
<blockquote>
    <p>
        mEventProps(0).Name = "EventType"
    </p>
</blockquote>
<p>
    mEventProps(0).Value = "StarBasic" mEventProps(1).Name = "Script"
</p>
<p>
    mEventProps(1).Value = "macro:///Standard.Module1.MySave()"
</p>
<p>
    'oGlobalEventBroadcaster = createUnoservice("com.sun.star.frame.GlobalEventBroadcaster")
</p>
<p>
    'oGlobalEventBroadcaster.Events.ReplaceByName("OnStartApp", mEventProps())
    ThisComponent.Events.ReplaceByName("OnSave", mEventProps())
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        Warn Use the location “macro://hello/Standard.Module1.MySave()” to specify a macro in the document named
        “hello.odt”. Although this works fine, the association is not lost when the document is closed.
    </p>
</blockquote>
<p>
    An event can just as easily be stored at the OOo level by using the GlobalEventBroadcaster.
</p>
<p>
    Do not mistake the value location for the same URL type syntax used to associate a form control to a macro:
</p>
<p>
    "vnd.sun.star.script:Standard.Module1.LocalMySave?language=Basic&amp;location=document"
</p>
<h2 id="intercepting-dispatch-commands">
    13.5.2. Intercepting dispatch commands
</h2>
<p>
    Replacing a listener event is not the same as intercepting the File &gt; Save dispatch, this is merely a listener
    used after the command has been executed. Intercepting a dispatch will look more like this code provided by Paolo
    Montavoni. One of the problems with this is that a status listener is not used, so, if a command is disabled, the
    menu will not show the command as disabled.
</p>
<blockquote>
    <p>
        Warn Be very careful while writing listeners and intercepting dispatches. Assume that something will change, or
        that you did something wrong and that OOo will crash; you have been warned.
    </p>
</blockquote>
<p>
    Listing 282. Replace a few menu commands.
</p>
<p>
    Global oDispatchInterceptor
</p>
<p>
    Global oSlaveDispatchProvider
</p>
<p>
    Global oMasterDispatchProvider
</p>
<p>
    Global oFrame
</p>
<p>
    Global bDebug As Boolean
</p>
<p>
    Dim oCopyDispatch
</p>
<p>
    Sub RegisterInterceptor
</p>
<p>
    oFrame = ThisComponent.currentController.Frame
</p>
<p>
    oDispatchInterceptor = CreateUnoListener("ThisFrame_", _
</p>
<p>
    "com.sun.star.frame.XDispatchProviderInterceptor")
</p>
<p>
    oFrame.registerDispatchProviderInterceptor(oDispatchInterceptor)
</p>
<p>
    End Sub
</p>
<p>
    Sub ReleaseInterceptor() On Error Resume Next
</p>
<p>
    oFrame.releaseDispatchProviderInterceptor(oDispatchInterceptor) End Sub
</p>
<p>
    Function ThisFrame_queryDispatch ( oUrl, _
</p>
<p>
    sTargetFrameName As String, lSearchFlags As Long ) As Variant
</p>
<p>
    Dim oDisp
</p>
<p>
    Dim sUrl As String
</p>
<p>
    'slot protocol causes OOo crash... if oUrl.Protocol = "slot:" Then
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    If bDebug Then
</p>
<p>
    Print oUrl.complete
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    'do your dispatch management here:
</p>
<p>
    Select Case oUrl.complete
</p>
<p>
</p>
<p>
    Case ".uno:Copy"
</p>
<p>
    oDisp = GetCopyDispatch 'replace the original dispatch Case ".uno:Paste"
</p>
<p>
    oDisp = GetCopyDispatch 'replace the original dispatch Case ".uno:Save"
</p>
<p>
    oDisp = GetCopyDispatch 'replace the original dispatch Case ".uno:Undo"
</p>
<p>
    oDisp = GetCopyDispatch 'replace the original dispatch
</p>
<p>
    'Case ".uno:blabla"
</p>
<p>
    'do something Case Else oDisp = _
</p>
<p>
    oSlaveDispatchProvider.queryDispatch( oUrl, sTargetFrameName, lSearchFlags )
</p>
<p>
    End Select
</p>
<p>
</p>
<p>
    ThisFrame_queryDispatch = oDisp
</p>
<p>
    End Function
</p>
<blockquote>
    <p>
        Function ThisFrame_queryDispatches ( mDispatches ) As Variant 'ThisFrame_queryDispatches = mDispatches()
    </p>
</blockquote>
<p>
    End Function
</p>
<p>
    Function ThisFrame_getSlaveDispatchProvider ( ) As Variant
</p>
<p>
    ThisFrame_getSlaveDispatchProvider = oSlaveDispatchProvider
</p>
<p>
    End Function
</p>
<p>
    Sub ThisFrame_setSlaveDispatchProvider ( oSDP ) oSlaveDispatchProvider = oSDP
</p>
<p>
    End Sub
</p>
<p>
    Function ThisFrame_getMasterDispatchProvider ( ) As Variant
</p>
<p>
    ThisFrame_getMasterDispatchProvider = oMasterDispatchProvider End Function
</p>
<p>
    Sub ThisFrame_setMasterDispatchProvider ( oMDP )
</p>
<blockquote>
    <p>
        oMasterDispatchProvider = oMDP
    </p>
</blockquote>
<p>
    End Sub
</p>
<p>
    Sub toggleDebug bDebug = Not bDebug
</p>
<p>
    End Sub
</p>
<p>
    Function GetCopyDispatch()
</p>
<p>
    If Not IsNull(oCopyDispatch) Then oCopyDispatch = _
</p>
<p>
    CreateUnoListener("MyCustom_", "com.sun.star.frame.XDispatch")
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    GetCopyDispatch = oCopyDispatch
</p>
<p>
    End Function
</p>
<p>
    Sub MyCustom_dispatch(URL, Arguments)
</p>
<p>
    Select Case URL.complete Case ".uno:Copy"
</p>
<p>
    MsgBox "Sorry, the original " &amp; URL.complete &amp; _
</p>
<p>
    " dispatch was stolen from Paolo M.", 48
</p>
<p>
</p>
<p>
    Case ".uno:Paste"
</p>
<p>
    ThisComponent.CurrentSelection(0).String = _
</p>
<p>
    "**** ARBITRARY CLIPBOARD CONTENT PROVIDED BY PAOLO M. ****" Case ".uno:Save"
</p>
<p>
    MsgBox "Sorry, the original " &amp; URL.complete &amp; _
</p>
<p>
    " dispatch was stolen from Paolo M.", 48
</p>
<p>
</p>
<p>
    Case ".uno:Undo"
</p>
<p>
    MsgBox "Undo What????!!!???", 16
</p>
<p>
    Case Else
</p>
<p>
    End Select
</p>
<p>
    End Sub
</p>
<p>
    Sub MyCustom_addStatusListener(Control, URL) End Sub
</p>
<p>
    Sub MyCustom_removeStatusListener (Control, URL) End Sub
</p>
<p>
    A similar method has been used to intercept context menus using a XContextMenuInterceptor.
</p>
<h1 id="link-targets">
    13.6. Link targets
</h1>
<p>
    Link targets, also called “jump marks,” can be used to jump directly to a specific location. The document navigator
    contains a list of link targets. The object method getLinks(), defined by the
</p>
<p>
    com.sun.star.document.XLinkTargetSupplier interface, provides access to the link targets. The getLinks() method
    returns an object that supports the XNameAccess interface. In other words, you can access the links using the
    methods getByName(), getElementNames(), hasByName(), and hasElements().
</p>
<p>
    The object returned by the getLinks() method does not access the links directly, but rather it provides access to
    other objects that can. To access all of the individual links, first use the getLinks() method to access the master
    list of links. Use this returned object to access each “family” of links based on the family name. For example, to
    obtain an object that can access all of the table links, use: oDoc.getLinks().getByName("Tables")
</p>
<p>
    After obtaining a family of links, you can also obtain the individual links by name. At this final step, you have
    access to both the name of the link and the object that is linked. The macro in Listing 283 obtains all of the link
    families and the links that they contain, and then displays the link’s name in a newly created Write document.
    Listing 283. Get jump targets for the current document.
</p>
<p>
    Sub GetJumpTargets
</p>
<p>
    Dim sLinkNames 'Tables, Text Frames, Headings, Bookmarks, etc...
</p>
<p>
    Dim vOneLink 'One link type
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
    Dim s$ 'General string
</p>
<p>
    Dim vtemp
</p>
<p>
    Dim oNewDoc
</p>
<p>
    Dim noArgs() 'An empty array for the arguments
</p>
<p>
    Dim vComp 'The loaded component
</p>
<p>
    Dim sURLs() 'URLs of the new document types to load
</p>
<p>
    Dim sURL As String 'URL of the document to load
</p>
<p>
    Dim oText
</p>
<p>
    sURL = "private:factory/swriter"
</p>
<p>
    vComp = StarDesktop.LoadComponentFromUrl(sURL, "_blank", 0, noArgs()) oText = vComp.Text
</p>
<p>
    oText.insertString(oText.End, "LINK TYPES" &amp; CHR$(10), False) sLinkNames =
    ThisComponent.getLinks().getElementNames() oText.insertString(oText.End, Join(sLinkNames, Chr$(10)), False)
    oText.insertString(oText.End, _
</p>
<p>
    CHR$(10) &amp; CHR$(10) &amp; "JUMP TARGETS" &amp; CHR$(10), _
</p>
<p>
    False)
</p>
<p>
    For i = 0 To UBound(sLinkNames)
</p>
<p>
    vOneLink = ThisComponent.getLinks().getByName(sLinkNames(i)) s = s &amp; sLinkNames(i) &amp; " = "
</p>
<p>
    If IsEmpty(vOneLink) Then s = s &amp; "Empty" Else
</p>
<p>
    s = s &amp; sLinkNames(i) &amp; " : " &amp; _
</p>
<p>
    Join(vOneLink.getElementNames(), CHR$(10) &amp; sLinkNames(i) &amp; " : " )
</p>
<p>
    REM To obtain the actual link object, such as a
</p>
<p>
    REM text table or a graphics object, use the following
</p>
<p>
    REM vtemp = vOneLink.getElementNames() REM vObj = vOneLink.getByName(vtemp(0))
</p>
<p>
    End If
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    'MsgBox s, 0, "Jump Targets"
</p>
<p>
    oText.insertString(oText.End, s, False) End Sub
</p>
<p>
    You can use jump marks (link targets) to jump directly to a specific location when a document is loaded. Use jump
    marks to focus the cursor at a specific location when a document is opened, as shown in Listing 284. The JumpMark
    attribute sets the name from the values shown in the created document (if you run the macro above); for example,
    “Table1|table” jumps to the specified table. Listing 284. Use the JumpMark property to jump to a link target.
</p>
<p>
    Dim Props(0)
</p>
<p>
    Props(0).Name = "JumpMark" Props(0).Value = "Table1|table" sUrl = "file://c:/docs/Special_doc.odt"
</p>
<p>
    vDoc = StarDesktop.LoadComponentFromUrl(sUrl, "_blank", 0, Props())
</p>
<p>
    You can also use the jump mark as part of the URL (see Listing 285) by placing it at the end of the URL separated by
    an octothorpe character (#). If the jump mark contains any special characters, such as spaces, they must be encoded
    using standard URL notation. For example, a space is encoded as %20. Listing 285. Use the JumpMark property to jump
    to a link target.
</p>
<p>
    sUrl = "file://c:/docs/Special_doc.odt#Table1|table" vDoc = StarDesktop.LoadComponentFromUrl(sUrl, "_blank", 0,
    Props())
</p>
<blockquote>
    <p>
        TIP The character “#” has many names, including: number sign, pound sign, hash, sharp, crunch, hex, grid,
        pigpen, tic-tac-toe, splat, crosshatch, and octothorpe, to name a few.
    </p>
</blockquote>
<h1 id="accessing-view-data-xviewdatasupplier">
    13.7. Accessing view data: XViewDataSupplier
</h1>
<p>
    Using OOo, open a document, edit it or change something (for example, move to another page or change the zoom
    factor), close the document, and open the document again. When you do this, the document opens at the same screen
    location, at the same size, with the same zoom factor as was active when it was last saved. This information is
    stored with the document and is available through the interface com.sun.star.document.XViewDataSupplier. This
    interface provides one object method, getViewData(). Listing 286 displays the view data for ThisComponent (see
    Figure 83).
</p>
<p>
    Listing 286. GetViewData is found in the
</p>
<p>
    Sub GetViewData
</p>
<p>
    Dim vViewData 'View data object
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
    Dim j% 'Index variable
</p>
<p>
    Dim s$ 'General string
</p>
<p>
    Dim vtemp 'View data for one object vViewData = ThisComponent.getViewData() REM For each view of the data For i = 0
    To vViewData.getCount() - 1 vtemp = vViewData.getByIndex(i)
</p>
<p>
    For j = 0 To UBound(vtemp)
</p>
<p>
    s = s &amp; vtemp(j).Name &amp; " = " &amp; CStr(vtemp(j).Value) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "View Data"
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image2.jpg" style="width:1.54142in;height:2.0264in" />
    </p>
</blockquote>
<p>
    Figure 83. View data for a document.
</p>
<h1 id="close-a-document-xcloseable">
    13.8. Close a document: XCloseable
</h1>
<p>
    As of OOo 1.1.0, each document type supports the com.sun.star.util.XCloseable interface. To close these objects,
    call the object method close(bForce). If bForce is True, the object must close. In other words, it may not refuse to
    close. If, however, bForce is False, the object may refuse to close.
</p>
<p>
    Before a document is closed, a message is sent to all registered listeners, giving them an opportunity to prevent
    the closure. If the close request is not vetoed by any listener, a message is sent to each registered listener,
    advising them that the document will close. The XCloseBroadcaster interface provides methods to add and remove a
    close listener (see Table 104).
</p>
<p>
    Table 104. Object methods defined by the interface XCloseBroadcaster.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Object Method
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                addCloseListener(XCloseListener)
            </td>
            <td>
                Add listener to receive or have a veto for “close” events.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeCloseListener(XCloseListener)
            </td>
            <td>
                Remove an object registered as a close listener using addCloseListener().
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in Listing 287 demonstrates the safe way to close a document using the object’s close() method. For
    versions of OOo prior to 1.1.0, the close() method is not available, so you must use the dispose() method instead.
    The dispose() method is unconditional and is not the preferred method to close a document (by document I really mean
    any object that supports both close and dispose) because it doesn’t allow a registered user who might be using the
    document to veto the close and finish what he or she is doing. Listing 287. The safe way to close a document.
</p>
<p>
    If HasUnoInterfaces(oDoc, "com.sun.star.util.XCloseable") Then oDoc.close(true) Else
</p>
<p>
    oDoc.dispose() End If
</p>
<blockquote>
    <p>
        TIP Do not use dispose to close a document, it is there for legacy purposes. Assume, for example, that you start
        printing a document and then immediately dispose() the document. The document that is being used for printing is
        suddenly gone and OOo crashes.
    </p>
</blockquote>
<h1 id="draw-pages-xdrawpagessupplier">
    13.9. Draw Pages: XDrawPagesSupplier
</h1>
<h2 id="draw-and-impress">
    13.9.1. Draw and Impress
</h2>
<p>
    Draw and Impress are almost identical in the interfaces that they support. Draw is specifically designed to handle
    independent graphic objects, whereas Impress is designed for business effects and presentations. The drawing
    functionality of Draw and Impress is identical, however. The graphic objects are drawn and displayed on “draw
    pages.” By their design, both Draw and Impress support multiple draw pages. The functionality to retrieve a DrawPage
    object is defined by the com.sun.star.drawing.XDrawPagesSupplier interface. The interface
    com.sun.star.drawing.XDrawPages defines methods to retrieve, insert, and remove individual pages (see Table 105).
</p>
<p>
    Table 105. Object methods defined by the interface XDrawPages.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Object Method
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                InsertNewByIndex(index)
            </td>
            <td>
                Create and insert a new draw page or master page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                remove(XDrawPage)
            </td>
            <td>
                Remove a draw page or master page.
            </td>
        </tr>
        <tr class="even">
            <td>
                getCount()
            </td>
            <td>
                Return the number of draw pages.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getByIndex(index)
            </td>
            <td>
                Return a specific draw page.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasElements()
            </td>
            <td>
                Return True if there are documents.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in Listing 288 demonstrates how to iterate through each of the draw pages. Each draw page is exported to a
    JPG file. The export type is specified by the MediaType property. Listing 288. Export each graphics page to a JPG.
</p>
<p>
    oFilter=CreateUnoService("com.sun.star.drawing.GraphicExportFilter")
</p>
<p>
    Dim args(1) as new com.sun.star.beans.PropertyValue For i=0 to oDoc.getDrawPages().getcount()-1 oPage =
    oDoc.getDrawPages().getByIndex(i) name = oPage.name
</p>
<p>
    oFilter.setSourceDocument(opage) args(0).Name = "URL"
</p>
<p>
    args(0).Value = "file:///c|/"&amp;oPage.name&amp;".JPG" args(1).Name = "MediaType" args(1).Value = "image/jpeg"
    oFilter.filter(args()) Next
</p>
<blockquote>
    <p>
        TIP The index used to access draw pages is zero based. This means that the first draw page is at location 0. If
        a document contains four draw pages, they are numbered 0 through 3. This is why the For loop in Listing 288 is
        from 0 To oDoc.getDrawPages().getcount()-1.
    </p>
</blockquote>
<p>
    The macro in Listing 289 creates a new Impress document and then adds a graphic image to the first draw page. The
    draw image is sized to retain the aspect ratio. Listing 289. Add a proportionally sized graphic to a draw page.
</p>
<p>
    Sub AddProportionalGraphic
</p>
<p>
    Dim oDoc 'Newly created Impress document
</p>
<p>
    Dim oDrawPage 'The draw page that will contain the graphic image
</p>
<p>
    Dim oGraph 'The created graphic image
</p>
<p>
</p>
<p>
    REM Create an Impress presentation document! oDoc = StarDesktop.loadComponentFromURL("private:factory/simpress",_
</p>
<p>
    "_default", 0, Array())
</p>
<p>
</p>
<p>
    REM Insert a second draw page if desired, REM leaving the first draw page untouched!
</p>
<p>
    REM Could use the property DrawPages
</p>
<p>
    REM oDrawPage = oDoc.DrawPages.insertNewByIndex(1)
</p>
<p>
    REM oDrawPage = oDoc.getDrawPages().insertNewByIndex(1)
</p>
<p>
    REM In this case, simply use the first draw page! oDrawPage = oDoc.getDrawPages().getByIndex(0)
</p>
<p>
</p>
<p>
    REM Create a graphics object that can be inserted into the document oGraph =
    oDoc.createInstance("com.sun.star.drawing.GraphicObjectShape")
</p>
<p>
</p>
<p>
    REM Set the URL of the image so that it can be added to the document oGraph.GraphicURL =
    "http://www.openoffice.org/images/AOO_logos/orb.jpg" oDrawPage.add(oGraph)
</p>
<p>
</p>
<p>
    REM If I stop here, there will be a very small graphic image in the REM upper-left corner of the document. This is
    pretty much useless.
</p>
<p>
    REM Although I could simply size the graphic to the same size as the bitmap
</p>
<p>
    REM size, I choose instead to size this so that it is as large as possible REM without changing the aspect ratio.
</p>
<p>
    REM Determine the ratio of the height to the width for the image and
</p>
<p>
    REM also for the draw page.
</p>
<p>
</p>
<p>
    Dim oNewSize As New com.sun.star.awt.Size 'New Image size
</p>
<p>
    Dim oBitmapSize As New com.sun.star.awt.Size 'Bitmap size
</p>
<p>
    Dim dImageRatio As Double 'Ratio of the height to width
</p>
<p>
    Dim dPageRatio As Double 'Ratio of the height to width
</p>
<p>
</p>
<p>
    oBitmapSize = oGraph.GraphicObjectFillBitmap.GetSize dImageRatio = CDbl(oBitmapSize.Height) /
    CDbl(oBitmapSize.Width) dPageRatio = CDbl(oDrawPage.Height) / CDbl(oDrawPage.Width)
</p>
<p>
</p>
<blockquote>
    <p>
        REM Compare the ratios to see which is wider, relatively speaking If dPageRatio &gt; dImageRatio Then
        oNewSize.Width = oDrawPage.Width
    </p>
</blockquote>
<p>
    oNewSize.Height = CLng(CDbl(oDrawPage.Width) * dImageRatio) Else
</p>
<p>
    oNewSize.Width = CLng(CDbl(oDrawPage.Height) / dImageRatio)
</p>
<p>
    oNewSize.Height = oDrawPage.Height
</p>
<p>
    End If
</p>
<p>
    REM Center the image on the Impress page! Dim oPosition as new com.sun.star.awt.Point oPosition.X = (oDrawPage.Width
    - oNewSize.Width)/2 oPosition.Y = (oDrawPage.Height - oNewSize.Height)/2
</p>
<p>
</p>
<p>
    oGraph.SetSize(oNewSize) oGraph.SetPosition(oPosition) End Sub
</p>
<p>
    As already stated, Impress and Draw documents are very similar in the API that they support. The macro in Listing
    290 draws lines in a Draw document (see Figure 84). Listing 290. Draw lines in a new graphic document.
</p>
<p>
    Sub DrawLinesInDrawDocument
</p>
<p>
    Dim oDoc 'Newly created Draw document
</p>
<p>
    Dim oDrawPage 'The draw page that will contain the graphics image
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    REM Create a new Draw document! oDoc = StarDesktop.loadComponentFromURL("private:factory/sdraw",_
</p>
<p>
    "_default", 0, Array())
</p>
<p>
</p>
<p>
    REM Use the first draw page
</p>
<p>
    oDrawPage = oDoc.getDrawPages().getByIndex(0)
</p>
<p>
</p>
<p>
    Dim i As Long
</p>
<p>
    Dim oPos as new com.sun.star.awt.Point
</p>
<p>
    Dim oSize as new com.sun.star.awt.Size Dim dStepSize As Double
</p>
<p>
    dStepSize = CDbl(oDrawPage.Height) / 10
</p>
<p>
</p>
<p>
    For i = 0 To 10
</p>
<p>
    oShape = oDoc.createInstance("com.sun.star.drawing.LineShape") oShape.LineColor = rgb(0, 255 - 20 * i, 20 * i)
    oShape.LineWidth = 250
</p>
<p>
    oPos.X = 0
</p>
<p>
    oPos.Y = CLng(CDbl(i) * dStepSize) oShape.setPosition(oPos)
</p>
<p>
</p>
<p>
    oSize.width = oDrawPage.Width
</p>
<p>
    oSize.height= oDrawPage.Height - 2 * oPos.Y oShape.setSize(oSize) oDrawPage.add(oShape)
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image3.jpg" style="width:1.46712in;height:1.78729in" />
    </p>
</blockquote>
<p>
    Figure 84. These lines drawn in a Draw document overlap.
</p>
<h2 id="draw-lines-with-arrows-in-calc">
    13.9.2. Draw lines with arrows in Calc
</h2>
<p>
    Each Calc document contains a single draw page for each sheet In Calc, each sheet is like a transparent layer
    containing drawing data on top of the standard document data. The following macro demonstrates a couple of useful
    things:
</p>
<ul>
    <li>
        Each cell has a position on the draw page. This macro draws a line between specific cells by using the Position
        attribute on a cell. The line is draw from the upper left corner of cell B2 to the upper left corner of cell D4.
    </li>
    <li>
        A LineShape is created by the document.
    </li>
    <li>
        After creation, attributes are set on the LineShape; for example, position, size, and color.
    </li>
    <li>
        The LineShape is added to the draw page.
    </li>
    <li>
        Arrows, and other line endings, are added after the LineShape has been added to the draw page – at least this is
        required in OOo version 3.3.0.
    </li>
</ul>
<p>
    Arrow line endings are set by setting the LineEndName and LineStartName. I was not able to find a list of supported
    arrow names, so, I used the GUI to find the names mentioned in the GUI, and the few that I tried worked. Next, I
    searched the source code and I found filter/source/msfilter/escherex.cx and svx/source/dialog/sdstring.src, which
    contains the following names:
</p>
<ul>
    <li>
        Arrow
    </li>
    <li>
        Arrow concave
    </li>
    <li>
        Circle
    </li>
    <li>
        Dimension Lines
    </li>
    <li>
        Double Arrow
    </li>
    <li>
        Line Arrow
    </li>
    <li>
        Rounded large Arrow
    </li>
    <li>
        Rounded short Arrow
    </li>
    <li>
        Small Arrow
    </li>
    <li>
        Square
    </li>
    <li>
        Square 45
    </li>
    <li>
        Symmetric Arrow
    </li>
</ul>
<p>
    In testing, the en-US names worked in other locales. Locale specific names work, but the value that is stored is
    based on the en-US locale name. In other words, using "Double flèche" with a French locale sets the property to
    “Double Arrow”. Listing 291. Draw lines in a Calc document.
</p>
<p>
    Sub InsertLineInCalcDocument
</p>
<p>
    Dim oLine
</p>
<p>
    Dim oCell1
</p>
<p>
    Dim oCell2
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oPos as new com.sun.star.awt.Point
</p>
<p>
    Dim oSize as new com.sun.star.awt.Size Dim oPage
</p>
<p>
    oSheet = ThisComponent.Sheets(0) oCell1 = oSheet.getCellByPosition(1, 1) oCell2 = oSheet.getCellByPosition(3, 3)
</p>
<p>
    oLine = ThisComponent.createInstance("com.sun.star.drawing.LineShape")
</p>
<p>
</p>
<p>
    oPos.x = oCell1.Position.X oPos.y = oCell1.Position.Y oLine.Position = oPos
</p>
<p>
    oSize.Width = oCell2.Position.X - oCell1.Position.X oSize.Height = oCell2.Position.Y - oCell1.Position.Y oLine.Size
    = oSize
</p>
<p>
</p>
<p>
    oLine.LineWidth = 4
</p>
<p>
    oLine.LineColor = RGB(128, 0, 0) oPage = oSheet.getDrawPage()
</p>
<p>
    oPage.add(oLine)
</p>
<p>
</p>
<p>
    REM You must do this AFTER inserting the line into the page. oLine.LineEndName = "Arrow" oLine.LineStartName =
    "Double Arrow"
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image4.jpg" style="width:3.45434in;height:0.84028in" />
    </p>
</blockquote>
<p>
    Figure 85. Draw a line in a Calc document.
</p>
<h2 id="writer">
    13.9.3. Writer
</h2>
<p>
    Each Writer document contains a single draw page for the entire document. In Writer, the page is like a transparent
    layer containing drawing data on top of the standard document data.
</p>
<p>
    Writer documents do not support the XDrawPagesSupplier interface, because they only contain a single draw page. They
    do, however, support the XDrawPageSupplier interface, which defines the single object method getDrawPage().
</p>
<p>
    The macro in Listing 290 uses optional draw page properties — namely height and width. The draw page from a Writer
    document does not contain these properties. The draw page in a Writer document has other peculiarities, however. For
    example, adding lines to the draw page — as done in Listing 290 — adds them as characters at the cursor position
    rather than interpreting the positions as specific locations in the document.
</p>
<p>
    The macro in Listing 292 draws lines to demonstrate this behavior (also see Figure 86). Listing 292. Draw lines in a
    Write document.
</p>
<p>
    Sub DrawLinesInWriteDocument
</p>
<p>
    Dim oDoc 'Newly created Writer document
</p>
<p>
    Dim oDrawPage 'The draw page that will contain the graphics image
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    REM Create a new Writer document! oDoc = StarDesktop.loadComponentFromURL("private:factory/swriter",_
</p>
<p>
    "_default", 0, Array())
</p>
<p>
</p>
<p>
    oDrawPage = oDoc.getDrawPage()
</p>
<p>
</p>
<p>
    Dim i As Long
</p>
<p>
    Dim oSize as new com.sun.star.awt.Size
</p>
<p>
    Dim dStepSize As Double dStepSize = 800
</p>
<p>
</p>
<p>
    For i = 0 To 10
</p>
<p>
    oShape = oDoc.createInstance("com.sun.star.drawing.LineShape") oShape.LineColor = rgb(255, 255 - 20 * i, 20 * i)
    oShape.LineWidth = 50
</p>
<p>
</p>
<p>
    oSize.width = dStepSize - CLng(CDbl(i) * dStepSize / 10)/2 oSize.width = CLng(dStepSize/5 * i - dStepSize)
    oSize.height= dStepSize oShape.setSize(oSize) oDrawPage.add(oShape)
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image5.png" style="width:3.41333in;height:2.24667in" />
    </p>
</blockquote>
<p>
    Figure 86. These lines drawn in a Writer document are treated as characters.
</p>
<h1 id="the-model">
    13.10. The model
</h1>
<p>
    XModel is the primary interface that distinguishes a component as a document, as opposed to the OOo Basic IDE or the
    included help pages. Objects that implement the interface com.sun.star.frame.XModel represent a component created
    from a URL. OOo document objects may be controlled by a controller, which is also considered a view of the document.
    The XModel interface defines the object methods in Table 106.
</p>
<p>
    Table 106. Object methods defined by the interface com.sun.star.frame.XModel.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Object Method
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                getURL()
            </td>
            <td>
                URL of the document returned as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getArgs()
            </td>
            <td>
                Return a copy of the com.sun.star.document.MediaDescriptor for this model (document).
            </td>
        </tr>
        <tr class="even">
            <td>
                lockControllers()
            </td>
            <td>
                Prevent some display updates — macros may run faster. Be sure to unlock the controllers when you are
                finished.
            </td>
        </tr>
        <tr class="odd">
            <td>
                unlockControllers()
            </td>
            <td>
                Call this once for each call to lockControllers().
            </td>
        </tr>
        <tr class="even">
            <td>
                hasControllersLocked()
            </td>
            <td>
                Is there at least one lock remaining?
            </td>
        </tr>
        <tr class="odd">
            <td>
                getCurrentController()
            </td>
            <td>
                The controller that currently controls this model.
            </td>
        </tr>
        <tr class="even">
            <td>
                getCurrentSelection()
            </td>
            <td>
                Current selection on the current controller.
            </td>
        </tr>
    </tbody>
</table>
<h2 id="document-arguments">
    13.10.1. Document arguments
</h2>
<p>
    Arguments passed to the document loader control how the document is loaded; for example, opening a document as
    read-only. Use getArgs() to obtain the documents media descriptor, which details how the document was loaded. The
    MediaDescriptor service can be accessed as a series of optional properties or as an array of properties (see Listing
    293 and Figure 87). Listing 293. Print the document media descriptor.
</p>
<p>
    Sub printDocumentArgs()
</p>
<p>
    REM This says to ignore any lines that cause an error.
</p>
<p>
    REM Obtaining a value may cause an error, but that is
</p>
<p>
    REM not a problem. It just prevents a value from being printed.
</p>
<p>
    On Error Resume Next
</p>
<p>
</p>
<p>
    Dim vArgs 'Media descriptor as an array of com.sun.star.beans.PropertyValue
</p>
<p>
    Dim s$ 'Display string
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
</p>
<p>
    REM Obtain the media descriptor. It turns out that this REM can be represented as an array of PropertyValue
    services.
</p>
<p>
    vArgs = ThisComponent.getArgs()
</p>
<p>
</p>
<p>
    For i = 0 To UBound(vArgs) 'For each property
</p>
<p>
    s = s &amp; vArgs(i).Name &amp; " = " 'Add the property name and an equals sign s = s &amp; vArgs(i).Value
    'Obtaining the value may fail!
</p>
<p>
    s = s &amp; CHR$(10) 'Add a new-line character
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Args"
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image6.png" style="width:4.74667in;height:2.54in" />
    </p>
</blockquote>
<p>
    Figure 87. Properties returned by the getArgs() object method.
</p>
<p>
    A text file is not a standard OOo Writer file, but rather, a simple file that has typically been created by a simple
    editor such as Notepad. Text files contain no information that identify the character set that was used, or how
    lines are terminated. Text files usually use the file extension TXT. When a text file is opened, OOo displays a
    dialog and asks questions about the file so that it knows how the text file is encoded. I was asked how to load a
    text file using a macro, avoiding the dialog and explicitly specifying the import values. Although I was able to
    correctly determine the import filter name, I had no idea how to specify the required filter options. I had no idea,
    that is, until I found the getArgs() object method.
</p>
<blockquote>
    <p>
        TIP If you know how to open a document using the GUI, but are uncertain how the arguments must be set to load
        the document using loadComponentFromURL, then first load the document using the GUI, then inspect the document's
        media descriptor. Hint: look at FilterOptions.
    </p>
</blockquote>
<p>
    Figure 87 shows the arguments for an imported text file. The FilterName property indicates the name of the import
    filter, and the FilterOptions property indicates the filter options that were used to open the file. Using these
    properties with the desktop object method LoadComponentFromUrl(), the file is correctly imported and the dialog is
    not displayed. Table 107 contains a list of the properties that may be returned from the getArgs() object method.
    The OOo API Web site contains a few more properties, but they are obscure or deprecated.
</p>
<p>
    Table 107. Object properties defined by the service MediaDescriptor.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                Aborted
            </td>
            <td>
                May be set if document load is aborted while entering a password.
            </td>
        </tr>
        <tr class="odd">
            <td>
                AsTemplate
            </td>
            <td>
                Document was loaded as a template.
            </td>
        </tr>
        <tr class="even">
            <td>
                Author
            </td>
            <td>
                Author of this document version; this is for versioning.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharacterSet
            </td>
            <td>
                Document character set for single-byte characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                Comment
            </td>
            <td>
                Comment on the current document version; this is for versioning.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DocumentTitle
            </td>
            <td>
                If the document title is specified, it is included here.
            </td>
        </tr>
        <tr class="even">
            <td>
                FilterName
            </td>
            <td>
                Filter used to import or save this document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FilterOptions
            </td>
            <td>
                Filter used to import this document.
            </td>
        </tr>
        <tr class="even">
            <td>
                FilterData
            </td>
            <td>
                Additional import properties if the FilterOptions string is not sufficient.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                Hidden
            </td>
            <td>
                If the Hidden argument is specified during load, it is included here.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HierarchicalDocumentName
            </td>
            <td>
                The hierarchical path to the embedded document from topmost container.
            </td>
        </tr>
        <tr class="even">
            <td>
                InputStream
            </td>
            <td>
                If the InputStream is specified during load, it is included here.
            </td>
        </tr>
        <tr class="odd">
            <td>
                InteractionHandler
            </td>
            <td>
                Exception handler if an error occurs during import.
            </td>
        </tr>
        <tr class="even">
            <td>
                JumpMark
            </td>
            <td>
                Jump to this marked position after loading the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MediaType
            </td>
            <td>
                MIME type of this document.
            </td>
        </tr>
        <tr class="even">
            <td>
                OpenNewView
            </td>
            <td>
                Opens a new view for an already loaded document, rather than just opening the document twice. In other
                words, request two views of the same data.
            </td>
        </tr>
        <tr class="odd">
            <td>
                OutputStream
            </td>
            <td>
                Stream to use while writing the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                Overwrite
            </td>
            <td>
                Overwrite any existing file on save.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Password
            </td>
            <td>
                Password for loading or storing the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                Preview
            </td>
            <td>
                Document loaded in preview mode; optimizes for preview-only use.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ReadOnly
            </td>
            <td>
                Document opened as read-only; controller will not change the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                Referer
            </td>
            <td>
                URL of document referrer — for example, if opened by clicking an HTTP link.
            </td>
        </tr>
        <tr class="odd">
            <td>
                RepairPackage
            </td>
            <td>
                Open the document in repair mode.
            </td>
        </tr>
        <tr class="even">
            <td>
                StartPresentation
            </td>
            <td>
                Immediately after loading an Impress document, start the presentation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                StatusIndicator
            </td>
            <td>
                If a status indicator was specified when the document was loaded, it is included here.
            </td>
        </tr>
        <tr class="even">
            <td>
                Unpacked
            </td>
            <td>
                If True, an OOo document is stored as a folder rather than a ZIP file.
            </td>
        </tr>
        <tr class="odd">
            <td>
                URL
            </td>
            <td>
                URL of the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                Version
            </td>
            <td>
                Current document version, if versioning is supported.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ViewData
            </td>
            <td>
                The view data to use.
            </td>
        </tr>
        <tr class="even">
            <td>
                ViewId
            </td>
            <td>
                The ID of the initial view.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MacroExecutionMode
            </td>
            <td>
                Specifies how macros are treated when the document is loaded.
            </td>
        </tr>
    </tbody>
</table>
<h1 id="saving-a-document">
    13.11. Saving a document
</h1>
<p>
    The location where a document is saved is called its Uniform Resource Locator (URL) — in other words, its file name.
    A file URL usually contains the complete path to the file. When the file name is referred to as the URL, it has a
    form similar to “file:///c:/myfile.sxw” rather than “c:\myfile.sxw”. A URL is a general way of writing a storage
    location, one that can be extended conveniently to include a wide range of storage location types in a
    manufacturer-independent and computer-independent manner. OOo Basic supports the functions ConvertToURL and
    ConvertFromURL to convert between the two notations. The XStorable interface defines object methods to save a
    document to a URL (see Table 108).
</p>
<p>
    Table 108. Object methods defined by the service com.sun.star.frame.XStorable.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Object Method
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                hasLocation()
            </td>
            <td>
                True if the document has a storage location and False if this is a new blank document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getLocation()
            </td>
            <td>
                Return the URL where the object was stored after calling storeAsURL().
            </td>
        </tr>
        <tr class="even">
            <td>
                isReadonly()
            </td>
            <td>
                You cannot call store() if the file was called from a read-only location.
            </td>
        </tr>
        <tr class="odd">
            <td>
                store()
            </td>
            <td>
                Stores the data to the current URL.
            </td>
        </tr>
        <tr class="even">
            <td>
                storeAsURL(URL, args)
            </td>
            <td>
                Stores the document to the specified URL, which becomes the current URL.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Object Method
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                storeToURL(URL, args)
            </td>
            <td>
                Stores the document to the specified URL, but the current URL does not change.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the object method hasLocation() to determine if a document knows where to save itself, and use the method
    store() to save it to the current URL. The macro in Listing 294 uses methods defined by both XStorable and
    XModifiable to save a document to disk. The document is stored only if it knows where to store itself, it has
    changed, and it is not read-only. Listing 294. Proper method to save a document.
</p>
<p>
    If (ThisComponent.isModified()) Then
</p>
<p>
    If (ThisComponent.hasLocation() AND (Not ThisComponent.isReadOnly())) Then ThisComponent.store()
</p>
<p>
    Else
</p>
<p>
    REM Either the document does not have a location or you cannot
</p>
<p>
    REM save the document because the location is read-only. setModified(False)
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    A document does not have a storage location immediately after it is created. A document loaded from disk, however,
    has a known location. Use the object method storeAsURL() or storeToURL() to save a document to a specified location.
    The difference between the methods is that storeAsURL() sets the current location (URL) and storeToURL() does not.
    The sequence of actions in Table 109 helps clarify the difference.
</p>
<p>
    Table 109. Difference between storeToURL and storeAsURL.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Step
            </td>
            <td>
                Action
            </td>
            <td>
                Comment
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                Create document
            </td>
            <td>
                Cannot use the store() method because the document has no location.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                Use storeToURL
            </td>
            <td>
                Document saved, but cannot use the store() methodbecause it has no location.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                Use storeAsURL
            </td>
            <td>
                Can use the store() method because now the document has a location.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                Use storeToURL
            </td>
            <td>
                Document saved, but the location is the same as set in step 3.
            </td>
        </tr>
    </tbody>
</table>
<blockquote>
    <p>
        TIP The method storeAsURL() is similar to the menu option File | Save As, which changes the current location.
        The method storeToURL() is usually used to export a document so that the file URL does not change and contain a
        non-OOo document extension.
    </p>
</blockquote>
<p>
    The two object methods for storing a document, storeAsURL() and storeToURL(), accept the same arguments; learn to
    use one and you’ll know how to use the other.
</p>
<p>
    ThisComponent.storeAsURL(url, args())
</p>
<p>
    ThisComponent.storeToURL(url, args())
</p>
<p>
    The second argument is an array of property values (see Table 107) that direct how the document is saved (see
    Listing 295). The files can just as easily be stored with no arguments (see Listing 296). Listing 295. Save a
    document to a new location.
</p>
<p>
    Dim args(0) As New com.sun.star.beans.PropertyValue Dim sUrl As String
</p>
<p>
    sUrl = "file:///c:/My%20Documents/test_file.sxw"
</p>
<p>
    args(0).Name = "Overwrite" 'This property is defined in Table 107 args(0).Value = False 'Do not overwrite an
    existing document.
</p>
<p>
    ThisComponent.storeAsURL(sUrl, args())
</p>
<p>
    TIP The com.sun.star.frame.XComponentLoader interface defines the object method
</p>
<blockquote>
    <p>
        LoadComponentFromUrl(), which is used to load a file. The different document types do not implement this
        interface, but the document frame and the desktop both implement the interface. The method
        LoadComponentFromUrl() also uses the values in Table 107 to direct how the file is loaded.
    </p>
</blockquote>
<p>
    Listing 296. Save the document with an inappropriate file extension.
</p>
<p>
    ThisComponent.storeToURL("file:///c:/two.xls", Array())
</p>
<blockquote>
    <p>
        TIP The macro in Listing 296 uses the file extension “xls”, which is typically used by Microsoft Excel. This
        does not cause the file to be stored using the Microsoft Excel format. The file is saved using the standard OOo
        file format if an export filter is not explicitly stated.
    </p>
</blockquote>
<p>
    When you open a file, OOo checks to see if the file is in a standard OOo file format. If not, the file type is
    determined based on the file extension. I cannot even count the number of times that I have been asked why OOo is
    not able to open a comma-delimited text file. The usual answer is that a comma-delimited file must have the file
    extension CSV or OOo cannot recognize the file. Although the file extension is important while loading a file from
    the GUI, it is not important while saving. If you want to save a file in a non-
</p>
<p>
    OpenOffice.org native format, you must explicitly tell OOo to save in a different file format (see Listing 297).
    Listing 297. Export a document to the specified Microsoft Excel file format.
</p>
<p>
    Dim args(0) as new com.sun.star.beans.PropertyValue args(0).Name = "FilterName" 'I am so excited, which filter will
    we use? args(0).Value = "MS Excel 97" 'Oh, the Excel 97 format!
</p>
<p>
    ThisComponent.storeToURL("file:///c:/one.xls",args())
</p>
<blockquote>
    <p>
        TIP Although the export filter names are the same as the import filter names, not every import filter can export
        and not every export filter can import.
    </p>
</blockquote>
<p>
    Impress and Draw, used to edit graphical content, support multiple draw pages. To export a draw page to a specific
    graphics format requires the use of a graphics export filter (see Listing 298). The media type must be specified or
    the export will fail. Listing 298. Export the first draw page to a JPG file.
</p>
<p>
    Dim oFilter
</p>
<p>
    Dim args(1) as new com.sun.star.beans.PropertyValue
</p>
<p>
    oFilter=CreateUnoService("com.sun.star.drawing.GraphicExportFilter")
    oFilter.setSourceDocument(ThisComponent.drawPages(0))
</p>
<p>
    args(0).Name = "URL" 'Where the file will be saved args(0).Value = "file:///c:/one.JPG" 'The destination URL
    args(1).Name = "MediaType" 'What type of file args(1).Value = "image/jpeg" 'The file type oFilter.filter(args())
</p>
<h1 id="manipulating-styles">
    13.12. Manipulating styles
</h1>
<p>
    Styles provide a method of grouping formatting information. For example, a paragraph style defines the font,
    character size, margins, and many other formatting options. Changing a style changes every object using the style.
    The interface com.sun.star.style.XStyleFamiliesSupplier provides access to the styles used by a document. The macro
    in Listing 299 displays the names of all styles in the current document; Figure 88 shows the results for one of my
    documents. Listing 299. Display styles used in a document.
</p>
<p>
    Sub DisplayAllStyles
</p>
<p>
    Dim oFamilies 'Families is interface com.sun.star.container.XNameAccess
</p>
<p>
    Dim oFamilyNames 'Names of family types. Array of string
</p>
<p>
    Dim oStyleNames 'Names of styles. Array of string
</p>
<p>
    Dim oStyles 'Styles is interface com.sun.star.container.XNameAccess
</p>
<p>
    Dim oStyle 'An individual style
</p>
<p>
    Dim s As String 'Utility string variable
</p>
<p>
    Dim n As Integer 'Index variable
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
</p>
<p>
    oFamilies = ThisComponent.StyleFamilies oFamilyNames = oFamilies.getElementNames()
</p>
<p>
</p>
<p>
    REM First, display the style types and the number
</p>
<p>
    REM of each style type.
</p>
<p>
    For n = LBound(oFamilyNames) To UBound(oFamilyNames) oStyles = oFamilies.getByName(oFamilyNames(n))
</p>
<p>
    s = s &amp; oStyles.getCount() &amp; " " &amp; oFamilyNames(n) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Style Families"
</p>
<p>
    REM Now, display all of the different style names For n = LBound(oFamilyNames) To UBound(oFamilyNames) s = ""
</p>
<p>
    oStyles = oFamilies.getByName(oFamilyNames(n)) oStyleNames = oStyles.getElementNames()
</p>
<p>
    For i = LBound(oStyleNames) To UBound (oStyleNames) s=s + i + " : " + oStyleNames(i) + CHR$(10)
</p>
<p>
    If ((i + 1) Mod 30 = 0) Then MsgBox s,0,oFamilyNames(n) s = "" End If
</p>
<p>
    Next i
</p>
<p>
    If Len(s) &lt;&gt; 0 Then MsgBox s,0,oFamilyNames(n)
</p>
<p>
    Next n
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image7.png" style="width:1.72in;height:1.48in" />
    </p>
</blockquote>
<p>
    Figure 88. The style families in one of my Writer documents.
</p>
<p>
    The different document types contain different types of styles. Figure 88 shows the style families in a Writer
    document. Calc documents contain the style families CellStyles and PageStyles; Impress documents contain the style
    families Graphics and Default; Draw documents contain the style family Graphic. Although each style type is
    different, they do have similarities. For example, each style implements both the com.sun.star.style.Style service
    and the com.sun.star.style.XStyle interface. The common methods and properties provide very rudimentary
    functionality (see Table 110). Table 110. Object methods defined in the com.sun.star.style.Style service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Method or Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                isUserDefined()
            </td>
            <td>
                Is this style user-defined? If not, it is included with OOo.
            </td>
        </tr>
        <tr class="odd">
            <td>
                isInUse()
            </td>
            <td>
                Is this style used in the document?
            </td>
        </tr>
        <tr class="even">
            <td>
                getParentStyle()
            </td>
            <td>
                What is the parent style?
            </td>
        </tr>
        <tr class="odd">
            <td>
                setParentStyle(name)
            </td>
            <td>
                Set the parent style.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsPhysical
            </td>
            <td>
                Is the style physically created?
            </td>
        </tr>
        <tr class="odd">
            <td>
                FollowStyle
            </td>
            <td>
                Style name applied to the next paragraph. For example, while using a heading style I might want the next
                paragraph to be regular text.
            </td>
        </tr>
        <tr class="even">
            <td>
                DisplayName
            </td>
            <td>
                Name of the style as displayed in the user interface.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsAutoUpdate
            </td>
            <td>
                If the properties of an object using this style are changed (for example, if I change the font), are
                these changes automatically updated to the style?
            </td>
        </tr>
    </tbody>
</table>
<p>
    Table 110 shows methods and properties that can be used to answer the common question, “How do I obtain a list of
    styles that are currently used by a document?” See Listing 300 and Figure 89.
</p>
<blockquote>
    <p>
        TIP Listing 299 accesses styles by name; Listing 300 accesses styles by index. Notice that when getCount()
        returns 10, there are 10 items present, indexed 0 through 9.
    </p>
</blockquote>
<p>
    Listing 300. Display all used paragraph styles.
</p>
<p>
    Sub DisplayAllUsedParagraphStyles
</p>
<p>
    Dim oStyles 'Styles is interface com.sun.star.container.XNameAccess
</p>
<p>
    Dim oStyle 'An individual style
</p>
<p>
    Dim s As String 'Utility string variable
</p>
<blockquote>
    <p>
        Dim i As Integer 'Index variable oStyles = ThisComponent.StyleFamilies.getByName("ParagraphStyles") REM If
        getCount() says that there are 10 styles, this means from 0 to 9 For i = 1 To oStyles.getCount() oStyle =
        oStyles.getByIndex(i-1)
    </p>
</blockquote>
<p>
    If oStyle.isInUse() Then s = s &amp; oStyle.DisplayName &amp; CHR$(10)
</p>
<p>
    Next MsgBox s,0,"Paragraph Styles In Use"
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image8.png" style="width:1.89667in;height:1.78333in" />
    </p>
</blockquote>
<p>
    Figure 89. Paragraph styles used in a Writer document.
</p>
<p>
    Initially, I was confused by the results shown in Figure 89 because it included paragraph styles that I thought I
    wasn’t using. I assumed that I had made a mistake while writing my document, so I started looking for these
    accidentally used styles. To find the incorrectly styled text, I started with the Find &amp; Replace dialog (Edit |
    Find &amp; Replace). If you check the box labeled “Search for Styles,” all of the styles used in the document become
    available in the “Search for” drop-down box. I used this method to search for the style “Text body” (shown in Figure
    89), but it was not found in the document. After some moments of confusion — in this case, roughly five minutes — I
    realized that I had not found a bug in OpenOffice.org, but rather I had uncovered an interesting behavior of which I
    had not been previously aware. When a style is used in a document, the parent style is listed as used even if it is
    not directly used. For example, in my document, the style “Table Contents” uses “Text body” as the parent style.
</p>
<p>
    The different style types contain methods and properties appropriate for their type. See
</p>
<p>
    http://api.openoffice.org/docs/common/ref/com/sun/star/style/module-ix.html for the common services, interfaces,
    structs, and constants related to styles. The types shown in the style module are the base on which the other styles
    are built. For example, the two services com.sun.star.text.TextPageStyle and
</p>
<p>
    com.sun.star.sheet.TablePageStyle both have the service com.sun.star.style.PageStyle in common. To get a feel for a
    style it is frequently expedient to start by inspecting the object.
</p>
<p>
    MsgBox vObj.dbg_methods
</p>
<p>
    MsgBox vObj.dbg_supportedInterfaces
</p>
<p>
    MsgBox vObj.dbg_properties
</p>
<p>
    The style objects, like many other objects, implement the XPropertySet interface. The macro in Listing 301 uses this
    interface to display a list of properties contained in the “_body text” paragraph style. Listing 301 does not
    display the value of each property; it only displays the name of each property. It is an interesting exercise to
    modify Listing 301 to also display the value of each property that is a standard data type — a property may be a
    complex object. Listing 301. Display Properties for a paragraph style.
</p>
<p>
    Sub StyleProperties
</p>
<p>
    Dim oStyles 'Styles is interface com.sun.star.container.XNameAccess
</p>
<p>
    Dim s As String 'Utility string variable
</p>
<blockquote>
    <p>
        Dim i As Integer 'Index variable
    </p>
</blockquote>
<blockquote>
    <p>
        Dim Props 'Array of properties
    </p>
</blockquote>
<p>
</p>
<p>
    REM Each style supports the com.sun.star.beans.XPropertySet interface REM This supports the method
    getPropertySetInfo(), which allows
</p>
<p>
    REM an enumeration of the contained properties.
</p>
<p>
    REM Get properties returns an array of com.sun.star.beans.Property oStyles =
    ThisComponent.StyleFamilies.getByName("ParagraphStyles") Props = oStyles.getByName("_body
    text").getPropertySetInfo().getProperties()
</p>
<p>
    For i = 0 To UBound(Props) 'For each property
</p>
<p>
    s = s &amp; Props(i).Name &amp; CHR$(10) 'Include the property name and new line
</p>
<p>
    If (i+1) MOD 30 = 0 Then 'If the string becomes too large MsgBox s,0,"Style Properties" 'display the current string
</p>
<p>
    s = "" 'Reset the list
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    REM In case the entire list was not printed.
</p>
<p>
    If Len(s) &lt;&gt; 0 Then MsgBox s,0,"Style Properties" End Sub
</p>
<p>
    In my experience, it’s rare to access and inspect styles. It’s even less common to modify a style from a macro.
    There are times, however, when this is done. For example, the page size is defined by the current page style. Use
    the current controller to determine the current page style, and then use that to determine the page dimensions.
    Listing 302 displays the size of the page, the margins, and the current cursor position on the page. Figure 90 shows
    the results.
</p>
<blockquote>
    <p>
        TIP The most common reason that I have seen for modifying a page style is to add a header or footer to the
        current page style.
    </p>
</blockquote>
<p>
    Portions of this code are speculative and have changed since I originally created the code. The current controller
    returns the current cursor position based on the leftmost corner of the first page in the document. On page 200,
    therefore, the Y coordinate may be very large. The following code attempts to compensate for this, but, it does so
    poorly – where poorly means that I believe the answer is incorrect with respect to the top and the bottom of the
    page.
</p>
<p>
    Listing 302. PrintPageInformation
</p>
<p>
    Sub PrintPageInformation
</p>
<p>
    Dim oViewCursor 'Current view cursor
</p>
<p>
    Dim oStyle 'Current page style
</p>
<p>
    Dim lHeight As Long 'Page height from Page Style in 1/100 mm
</p>
<p>
    Dim lWidth As Long 'Page width from Page Style in 1/100 mm
</p>
<p>
    Dim s As String 'Temporary string variable
</p>
<p>
    REM The current controller interfaces with the human — that's you!
</p>
<p>
    REM Well, we hope you are human anyway.
</p>
<p>
    REM Obtain the current view cursor from the controller. It is REM the thing that knows where the current cursor is,
    after all. oViewCursor = ThisComponent.CurrentController.getViewCursor()
</p>
<p>
</p>
<p>
    REM That view cursor knows a lot of things, including the
</p>
<p>
    REM current page style. Use the page style name to get
</p>
<blockquote>
    <p>
        REM a reference to the current page style. s = oViewCursor.PageStyleName
    </p>
</blockquote>
<blockquote>
    <p>
        oStyle = ThisComponent.StyleFamilies.getByName("PageStyles").getByName(s) s = "Page Style = " &amp; s &amp;
        CHR$(10)
    </p>
</blockquote>
<p>
    lHeight = oStyle.Height 'Page height in 1/100 mm lWidth = oStyle.Width 'Page width in 1/100 mm
</p>
<p>
</p>
<p>
    REM Page dimensions in mm, inches, and picas. s = s &amp; "Page size is " &amp; CHR$(10) &amp;_
</p>
<p>
    " " &amp; CStr(lWidth / 100.0) &amp; " mm By " &amp;_
</p>
<p>
    " " &amp; CStr(lHeight / 100.0) &amp; " mm" &amp; CHR$(10) &amp;_
</p>
<p>
    " " &amp; CStr(lWidth / 2540.0) &amp; " inches By " &amp;_
</p>
<p>
    " " &amp; CStr(lHeight / 2540.0) &amp; " inches" &amp; CHR$(10) &amp;_
</p>
<p>
    " " &amp; CStr(lWidth *72.0 / 2540.0) &amp; " picas By " &amp;_
</p>
<p>
    " " &amp; CStr(lHeight *72.0 / 2540.0) &amp; " picas" &amp; CHR$(10)
</p>
<p>
    Dim dCharHeight As Double 'Character height in inches
</p>
<p>
    Dim iCurPage As Integer 'Current page
</p>
<p>
</p>
<p>
    Dim dXCursor As Double 'Distance from cursor to left in inches
</p>
<p>
    Dim dYCursor As Double 'Distance from cursor to top in inches
</p>
<p>
    Dim dXRight As Double 'Distance from cursor to right in inches Dim dYBottom As Double 'Distance from cursor to
    bottom in inches
</p>
<p>
    Dim dBottom As Double 'Bottom margin in inches
</p>
<p>
    Dim dLeft As Double 'Left margin in inches
</p>
<p>
    Dim dRight As Double 'Right margin in inches
</p>
<p>
    Dim dTop As Double 'Top margin in inches
</p>
<p>
</p>
<p>
    dCharHeight = oViewCursor.CharHeight / 72.0 'Convert points to inches iCurPage = oViewCursor.getPage() 'Page number
    s = s &amp; "Current page = " &amp; iCurPage &amp; CHR$(10)
</p>
<p>
</p>
<p>
    dBottom = oStyle.BottomMargin / 2540.0 : dLeft = oStyle.LeftMargin / 2540.0 dRight = oStyle.RightMargin / 2540.0 :
    dTop = oStyle.TopMargin / 2540.0 s = s &amp; "Margin (inches): Left= " &amp; dLeft &amp; " Right= " &amp; dRight
    &amp; CHR$(10) s = s &amp; "Margin (inches): Top= " &amp; dTop &amp; " Bottom= " &amp; dBottom &amp; CHR$(10)
</p>
<p>
</p>
<p>
    Dim v
</p>
<blockquote>
    <p>
        REM Cursor's coordinates relative to the top left position of the page
    </p>
</blockquote>
<p>
    REM Return type is com.sun.star.awt.Point REM Units are in twips. Convert them to inches.
</p>
<p>
    v = oViewCursor.getPosition()
</p>
<p>
</p>
<p>
    REM Page number from the view cursor includes "phantom" pages because
</p>
<p>
    REM two pages in a row must both be on say a right side.
</p>
<p>
    REM v.Y does not include this. Dim realPageNumber As Long realPageNumber = Fix(v.Y / lHeight)
</p>
<p>
</p>
<p>
    Dim realY : realY = v.Y - realPageNumber * lHeight
</p>
<p>
</p>
<p>
    REM Place the cursor as the distance to the margin and then add the margin.
</p>
<blockquote>
    <p>
        REM For the vertical height add half the character height. I should REM probably do this for the character width
        as well for horizontal. dYCursor = realY/2540.0 + dTop + dCharHeight / 2 dYBottom = (lHeight - realY)/2540.0 -
        dTop - dCharHeight / 2
    </p>
</blockquote>
<p>
    dXCursor = v.X/2540.0 + dLeft
</p>
<p>
    dXRight = (lWidth - v.X)/2540.0 - dLeft
</p>
<p>
</p>
<p>
    s=s &amp;"Cursor is "&amp;Format(dXCursor, "0.##") &amp; " inches from left "&amp;CHR$(10) s=s &amp;"Cursor is
    "&amp;Format(dXRight, "0.##") &amp; " inches from right "&amp;CHR$(10) s=s &amp;"Cursor is "&amp;Format(dYCursor,
    "0.##") &amp; " inches from top "&amp;CHR$(10) s=s &amp;"Cursor is "&amp;Format(dYBottom, "0.##") &amp; " inches
    from bottom "&amp;CHR$(10) s=s &amp;"Char height = " &amp; Format(dCharHeight, "0.####") &amp; "
    inches"&amp;CHR$(10) MsgBox s, 0, "Page information"
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image9.png" style="width:2.92in;height:2.23333in" />
    </p>
</blockquote>
<p>
    Figure 90. Information from the page style.
</p>
<p>
    Calc documents are composed of spreadsheets. Each sheet can use a different page style. The macro in Listing 302
    obtains the current page style using the view cursor. To obtain the style from a Calc document, use the active
    sheet.
</p>
<p>
    REM Use the currently active sheet to obtain the page style.
</p>
<p>
    REM In a Calc document, the current controller knows which sheet
</p>
<p>
    REM is active.
</p>
<p>
    Print "Style = " &amp; ThisComponent.CurrentController.getActiveSheet().PageStyle
</p>
<h2 id="style-utilities">
    13.12.1. Style utilities
</h2>
<p>
    Although modifying styles using macros is easy, small details can cause big problems; for example, specifying a
    paragraph style is not available on the current computer. Listing 303. Check a document for a paragraph style.
</p>
<p>
    Function DocHasParStyle(oDoc, sName$) As Boolean Dim oStyles
</p>
<p>
    oStyles = oDoc.StyleFamilies.getByName("ParagraphStyles")
</p>
<p>
    DocHasParStyle() = oStyles.hasByName(sName) End Function
</p>
<p>
    Checking for the character style is equally trivial. Listing 304. Check a document for a character style.
</p>
<blockquote>
    <p>
        Function DocHasCharStyle(oDoc, sName$) As Boolean Dim oStyles
    </p>
</blockquote>
<blockquote>
    <p>
        oStyles = oDoc.StyleFamilies.getByName("CharacterStyles")
    </p>
</blockquote>
<blockquote>
    <p>
        DocHasCharStyle() = oStyles.hasByName(sName) End Function
    </p>
</blockquote>
<p>
    To determine if a document supports a specific font, check the font descriptors available from the container window.
    Listing 305. Check a document for a font.
</p>
<p>
    Function DocHasFontName(oDoc, sName$) As Boolean
</p>
<p>
    Dim oWindow
</p>
<p>
    Dim oFonts()
</p>
<p>
    Dim i%
</p>
<p>
    oWindow = oDoc.getCurrentController().getFrame().getContainerWindow() oFonts() = oWindow.getFontDescriptors()
</p>
<p>
    For i = LBound(oFonts()) To UBound(oFonts())
</p>
<p>
    If oFonts(i).Name = sName Then
</p>
<p>
    DocHasFontName() = True
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    DocHasFontName() = False
</p>
<p>
    End Function
</p>
<p>
    A property is a structure with a name and a value. The following macro accepts a name and a value and returns a
    property with the name and value. Listing 306. Create a property with the specified name and value.
</p>
<p>
    '****************************************************************
</p>
<p>
    '** Create and return a PropertyValue structure.
</p>
<p>
    '****************************************************************
</p>
<p>
    Function CreateProperty( Optional cName As String, Optional uValue ) As com.sun.star.beans.PropertyValue
</p>
<p>
    Dim oPropertyValue As New com.sun.star.beans.PropertyValue If Not IsMissing( cName ) Then oPropertyValue.Name =
    cName
</p>
<p>
    EndIf
</p>
<p>
    If Not IsMissing( uValue ) Then oPropertyValue.Value = uValue
</p>
<p>
    EndIf
</p>
<p>
    CreateProperty() = oPropertyValue End Function
</p>
<p>
    Listing 306 allows properties to be created directly in an array. Listing 307. Creating properties used to create a
    character style.
</p>
<p>
    REM Base style for all.
</p>
<p>
    REM computer code that is not color coded and used in regular text
</p>
<p>
    REM uses this style. oProps() = Array(CreateProperty("CharFontName", sFontName), _
</p>
<p>
    CreateProperty("CharColor", RGB(0, 0, 0)), _
</p>
<p>
    CreateProperty("CharNoHyphenation", True) )
</p>
<p>
    CreateCharacterStyle("OOoComputerCode", oProps())
</p>
<p>
</p>
<blockquote>
    <p>
        REM Base style for normal listings. oProps() = Array(CreateProperty("ParentStyle", "OOoComputerCode"))
        CreateCharacterStyle("_OOoComputerBase", oProps())
    </p>
</blockquote>
<p>
    The difficult part is determining what properties to set and what properties to not set. It is a useful exercise to
    inspect a manually created style containing the values of interest. A property that is not specifically set inherits
    its value from the parent style or existing format; for example, setting a character style to bold but not
    specifying the font or font size, produces a character style that will not affect font or font size and only set the
    font to be bold. Listing 308. Character styles used to format code examples.
</p>
<p>
    '**************************************************************** '** Create character styles for StarBasic using
    the same colors
</p>
<p>
    '** as the OOo IDE.
</p>
<p>
    '****************************************************************
</p>
<p>
    Function CreateStarBasicCharStyles()
</p>
<p>
    Dim oProps()
</p>
<p>
    REM If you do not want something to have a language, which prevents
</p>
<p>
    REM a spell check, set CharLocale to noLocale. Dim noLocale As New com.sun.star.lang.Locale noLocale.Country = ""
    noLocale.Language = "zxx"
</p>
<p>
    If NOT CreateBaseCharStyles() Then CreateStarBasicCharStyles() = False
</p>
<p>
    Exit Function End If
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "_OOoComputerBase"), _
</p>
<p>
    CreateProperty("CharColor", RGB(76, 76, 76)))
</p>
<p>
    CreateCharacterStyle("_OOoComputerComment", oProps())
</p>
<p>
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "_OOoComputerBase"), _
</p>
<p>
    CreateProperty("CharColor", RGB(255, 0, 0)))
</p>
<p>
    CreateCharacterStyle("_OOoComputerLiteral", oProps())
</p>
<p>
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "_OOoComputerBase"), _
</p>
<p>
    CreateProperty("CharLocale", noLocale), _
</p>
<p>
    CreateProperty("CharColor", RGB(0, 0, 128)))
</p>
<p>
    CreateCharacterStyle("_OOoComputerKeyWord", oProps())
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "_OOoComputerBase"), _
</p>
<p>
    CreateProperty("CharColor", RGB(0, 128, 0)))
</p>
<p>
    CreateCharacterStyle("_OOoComputerIdent", oProps())
</p>
<p>
    CreateStarBasicCharStyles() = True End Function
</p>
<p>
    The following macro creates a character style if it does not exist. A special check is performed to verify that the
    parent style exists; the parent style must be created before the child style. Listing 309. Create a character style
    if it does not exist.
</p>
<p>
    Sub CreateCharacterStyle(sStyleName$, oProps())
</p>
<p>
    Dim i%
</p>
<p>
    Dim oFamilies
</p>
<blockquote>
    <p>
        Dim oStyle
    </p>
</blockquote>
<p>
    Dim oStyles
</p>
<p>
</p>
<p>
    oFamilies = ThisComponent.StyleFamilies oStyles = oFamilies.getByName("CharacterStyles")
</p>
<p>
    If oStyles.HasByName(sStyleName) Then
</p>
<p>
    'PrintColor(oStyles.getByName(sStyleName).CharColor)
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    oStyle = ThisComponent.createInstance("com.sun.star.style.CharacterStyle")
</p>
<p>
    For i=LBound(oProps) To UBound(oProps)
</p>
<p>
    If oProps(i).Name = "ParentStyle" Then
</p>
<p>
</p>
<p>
    If oStyles.HasByName(oProps(i).Value) Then oStyle.ParentStyle = oProps(i).Value
</p>
<p>
    Else
</p>
<p>
    Print "Parent character style (" &amp; oProps(i).Value &amp; _
</p>
<p>
    ") does not exist, ignoring parent." End If
</p>
<p>
    oStyle.ParentStyle = oProps(i).Value Else
</p>
<p>
    oStyle.setPropertyValue(oProps(i).Name, oProps(i).Value)
</p>
<p>
    End If Next
</p>
<p>
    oStyles.insertByName(sStyleName, oStyle) End Sub
</p>
<p>
    A paragraph style is a bit more complicated because a few elements require special consideration; for example,
    setting tab stops. Listing 310. Create a paragraph style if it does not exist.
</p>
<p>
    Sub CreateParStyle(sStyleName$, oProps())
</p>
<p>
    Dim i%, j%
</p>
<p>
    Dim oFamilies
</p>
<p>
    Dim oStyle
</p>
<p>
    Dim oStyles
</p>
<p>
    Dim tabStops%
</p>
<p>
</p>
<p>
    oFamilies = ThisComponent.StyleFamilies oStyles = oFamilies.getByName("ParagraphStyles")
</p>
<p>
    If oStyles.HasByName(sStyleName) Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    oStyle = ThisComponent.createInstance("com.sun.star.style.ParagraphStyle")
</p>
<p>
    For i=LBound(oProps) To UBound(oProps)
</p>
<p>
    If oProps(i).Name = "ParentStyle" Then
</p>
<p>
    If oStyles.HasByName(oProps(i).Value) Then oStyle.ParentStyle = oProps(i).Value
</p>
<p>
    Else
</p>
<p>
    Print "Parent paragraph style (" &amp; oProps(i).Value &amp; _
</p>
<p>
    ") does not exist, ignoring parent"
</p>
<p>
    End If
</p>
<p>
    ElseIf oProps(i).Name = "ParaTabStops" Then
</p>
<p>
    tabStops = oProps(i).Value
</p>
<p>
    Dim tab(0 To 19) As New com.sun.star.style.TabStop For j =LBound(tab) To UBound(tab)
</p>
<p>
    tab(j).Alignment = com.sun.star.style.TabAlign.LEFT tab(j).DecimalChar = ASC(".") tab(j).FillChar = 32
</p>
<p>
    tab(j).Position = (j+1) * tabStops Next
</p>
<p>
    oStyle.ParaTabStops = tab
</p>
<p>
    ElseIf oProps(i).Name = "FollowStyle" Then
</p>
<p>
    If oStyles.HasByName(oProps(i).Value) OR oProps(i).Value = sStyleName Then oStyle.setPropertyValue(oProps(i).Name,
    oProps(i).Value)
</p>
<p>
    Else
</p>
<p>
    Print "Next paragraph style (" &amp; oProps(i).Value &amp; _
</p>
<p>
    ") does not exist, ignoring for style " &amp; sStyleName
</p>
<p>
    End If Else
</p>
<p>
    oStyle.setPropertyValue(oProps(i).Name, oProps(i).Value)
</p>
<p>
    End If Next
</p>
<p>
    oStyles.insertByName(sStyleName, oStyle) End Sub
</p>
<p>
    This code creates the primary paragraph styles used to format code styles in this document. Listing 311. Properties
    to create a paragraph style.
</p>
<p>
    REM Tab stops are set in the paragraph style
</p>
<p>
    ' 1/4 of an inch tabStopLoc% = 2540 / 4
</p>
<p>
    oProps() = Array(CreateProperty("ParaTopMargin", CLng(0)), _ CreateProperty("ParaBottomMargin", CLng(2540 * 0.03)),
    _
</p>
<p>
    CreateProperty("ParaLeftMargin", CLng(2540 * 0.20)), _
</p>
<p>
    CreateProperty("ParaRightMargin", CLng(0)), _
</p>
<p>
    CreateProperty("ParaFirstLineIndent", CLng(0)), _
</p>
<p>
    CreateProperty("CharFontName",sFontName), _
</p>
<p>
    CreateProperty("ParaTabStops", tabStopLoc), _
</p>
<p>
    CreateProperty("ParaLineNumberCount", False), _
</p>
<p>
    CreateProperty("WritingMode", com.sun.star.text.WritingMode.LR_TB), _
</p>
<p>
    CreateProperty("CharAutoKerning", False), _
</p>
<p>
    CreateProperty("CharHeight", fParNormalCharHeight) ) CreateParStyle("_OOoComputerCode", oProps())
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "_OOoComputerCode"), _
</p>
<p>
    CreateProperty("ParaTopMargin", CLng(0)), _
</p>
<p>
    CreateProperty("ParaBottomMargin", CLng(2540 * 0.10)), _
</p>
<p>
    CreateProperty("ParaLeftMargin", CLng(2540 * 0.20)), _
</p>
<p>
    CreateProperty("ParaRightMargin", CLng(0)), _
</p>
<p>
    CreateProperty("ParaFirstLineIndent", CLng(0)), _
</p>
<p>
    CreateProperty("CharFontName",sFontName), _
</p>
<p>
    CreateProperty("ParaTabStops", tabStopLoc), _
</p>
<p>
    CreateProperty("ParaLineNumberCount", False), _
</p>
<p>
    CreateProperty("WritingMode", com.sun.star.text.WritingMode.LR_TB), _
</p>
<p>
    CreateProperty("CharAutoKerning", False), _
</p>
<p>
    CreateProperty("CharHeight", fParNormalCharHeight), _ CreateProperty("FollowStyle", sNextStyle) )
</p>
<p>
    CreateParStyle("_OOoComputerCodeLastLine", oProps())
</p>
<h1 id="dealing-with-locale">
    13.13. Dealing with locale
</h1>
<p>
    A locale represents a specific geographical, political, or cultural region. Numbers and dates are considered
    locale-sensitive, so number formats are associated with a locale. Use Tools | Options | Language Settings |
    Languages to see which locale is used for your computer. Creating a locale is very easy.
</p>
<p>
    Dim aLocale As New com.sun.star.lang.Locale aLocale.Language = "fr" aLocale.Country = "FR"
</p>
<p>
    TIP OOo may not support every possible locale, but it will attempt to use the best possible match.
</p>
<p>
    The locale depends upon both the language and the country. Some countries use multiple languages and some languages
    are used in multiple countries. Table 111 contains the two-character code that identifies each language, and Table
    112 contains the two-character code that identifies each country.
</p>
<blockquote>
    <p>
        TIP Although the locale codes are not case sensitive, they are typically written in lowercase for the language
        and uppercase for the country.
    </p>
</blockquote>
<p>
    Table 111. Locale language codes, alphabetized by code.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Code
            </td>
            <td>
                Language
            </td>
            <td>
                Code
            </td>
            <td>
                Language
            </td>
            <td>
                Code
            </td>
            <td>
                Language
            </td>
        </tr>
        <tr class="even">
            <td>
                aa
            </td>
            <td>
                Afar
            </td>
            <td>
                ab
            </td>
            <td>
                Abkhazian
            </td>
            <td>
                af
            </td>
            <td>
                Afrikaans
            </td>
        </tr>
        <tr class="odd">
            <td>
                am
            </td>
            <td>
                Amharic
            </td>
            <td>
                ar
            </td>
            <td>
                Arabic
            </td>
            <td>
                as
            </td>
            <td>
                Assamese
            </td>
        </tr>
        <tr class="even">
            <td>
                ay
            </td>
            <td>
                Aymara
            </td>
            <td>
                az
            </td>
            <td>
                Azerbaijani
            </td>
            <td>
                ba
            </td>
            <td>
                Bashkir
            </td>
        </tr>
        <tr class="odd">
            <td>
                be
            </td>
            <td>
                Byelorussian
            </td>
            <td>
                bg
            </td>
            <td>
                Bulgarian
            </td>
            <td>
                bh
            </td>
            <td>
                Bihari
            </td>
        </tr>
        <tr class="even">
            <td>
                bi
            </td>
            <td>
                Bislama
            </td>
            <td>
                bn
            </td>
            <td>
                Bengali; Bangla
            </td>
            <td>
                bo
            </td>
            <td>
                Tibetan
            </td>
        </tr>
        <tr class="odd">
            <td>
                br
            </td>
            <td>
                Breton
            </td>
            <td>
                ca
            </td>
            <td>
                Catalan
            </td>
            <td>
                co
            </td>
            <td>
                Corsican
            </td>
        </tr>
        <tr class="even">
            <td>
                cs
            </td>
            <td>
                Czech
            </td>
            <td>
                cy
            </td>
            <td>
                Welsh
            </td>
            <td>
                da
            </td>
            <td>
                Danish
            </td>
        </tr>
        <tr class="odd">
            <td>
                de
            </td>
            <td>
                German
            </td>
            <td>
                dz
            </td>
            <td>
                Bhutani
            </td>
            <td>
                el
            </td>
            <td>
                Greek
            </td>
        </tr>
        <tr class="even">
            <td>
                en
            </td>
            <td>
                English
            </td>
            <td>
                eo
            </td>
            <td>
                Esperanto
            </td>
            <td>
                es
            </td>
            <td>
                Spanish
            </td>
        </tr>
        <tr class="odd">
            <td>
                et
            </td>
            <td>
                Estonian
            </td>
            <td>
                eu
            </td>
            <td>
                Basque
            </td>
            <td>
                fa
            </td>
            <td>
                Persian
            </td>
        </tr>
        <tr class="even">
            <td>
                fi
            </td>
            <td>
                Finnish
            </td>
            <td>
                fj
            </td>
            <td>
                Fiji
            </td>
            <td>
                fo
            </td>
            <td>
                Faroese
            </td>
        </tr>
        <tr class="odd">
            <td>
                fr
            </td>
            <td>
                French
            </td>
            <td>
                fy
            </td>
            <td>
                Frisian
            </td>
            <td>
                ga
            </td>
            <td>
                Irish
            </td>
        </tr>
        <tr class="even">
            <td>
                gd
            </td>
            <td>
                Scots Gaelic
            </td>
            <td>
                gl
            </td>
            <td>
                Galician
            </td>
            <td>
                gn
            </td>
            <td>
                Guarani
            </td>
        </tr>
        <tr class="odd">
            <td>
                gu
            </td>
            <td>
                Gujarati
            </td>
            <td>
                ha
            </td>
            <td>
                Hausa
            </td>
            <td>
                he
            </td>
            <td>
                Hebrew (formerly iw)
            </td>
        </tr>
        <tr class="even">
            <td>
                hi
            </td>
            <td>
                Hindi
            </td>
            <td>
                hr
            </td>
            <td>
                Croatian
            </td>
            <td>
                hu
            </td>
            <td>
                Hungarian
            </td>
        </tr>
        <tr class="odd">
            <td>
                hy
            </td>
            <td>
                Armenian
            </td>
            <td>
                ia
            </td>
            <td>
                Interlingua
            </td>
            <td>
                id
            </td>
            <td>
                Indonesian (formerly in)
            </td>
        </tr>
        <tr class="even">
            <td>
                ie
            </td>
            <td>
                Interlingue
            </td>
            <td>
                ik
            </td>
            <td>
                Inupiak
            </td>
            <td>
                is
            </td>
            <td>
                Icelandic
            </td>
        </tr>
        <tr class="odd">
            <td>
                it
            </td>
            <td>
                Italian
            </td>
            <td>
                iu
            </td>
            <td>
                Inuktitut
            </td>
            <td>
                ja
            </td>
            <td>
                Japanese
            </td>
        </tr>
        <tr class="even">
            <td>
                jw
            </td>
            <td>
                Javanese
            </td>
            <td>
                ka
            </td>
            <td>
                Georgian
            </td>
            <td>
                kk
            </td>
            <td>
                Kazakh
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Code
            </td>
            <td>
                Language
            </td>
            <td>
                Code
            </td>
            <td>
                Language
            </td>
            <td>
                Code
            </td>
            <td>
                Language
            </td>
        </tr>
        <tr class="even">
            <td>
                kl
            </td>
            <td>
                Greenlandic
            </td>
            <td>
                km
            </td>
            <td>
                Cambodian
            </td>
            <td>
                kn
            </td>
            <td>
                Kannada
            </td>
        </tr>
        <tr class="odd">
            <td>
                ko
            </td>
            <td>
                Korean
            </td>
            <td>
                ks
            </td>
            <td>
                Kashmiri
            </td>
            <td>
                ku
            </td>
            <td>
                Kurdish
            </td>
        </tr>
        <tr class="even">
            <td>
                ky
            </td>
            <td>
                Kirghiz
            </td>
            <td>
                la
            </td>
            <td>
                Latin
            </td>
            <td>
                ln
            </td>
            <td>
                Lingala
            </td>
        </tr>
        <tr class="odd">
            <td>
                lo
            </td>
            <td>
                Laothian
            </td>
            <td>
                lt
            </td>
            <td>
                Lithuanian
            </td>
            <td>
                lv
            </td>
            <td>
                Latvian, Lettish
            </td>
        </tr>
        <tr class="even">
            <td>
                mg
            </td>
            <td>
                Malagasy
            </td>
            <td>
                mi
            </td>
            <td>
                Maori
            </td>
            <td>
                mk
            </td>
            <td>
                Macedonian
            </td>
        </tr>
        <tr class="odd">
            <td>
                ml
            </td>
            <td>
                Malayalam
            </td>
            <td>
                mn
            </td>
            <td>
                Mongolian
            </td>
            <td>
                mo
            </td>
            <td>
                Moldavian
            </td>
        </tr>
        <tr class="even">
            <td>
                mr
            </td>
            <td>
                Marathi
            </td>
            <td>
                ms
            </td>
            <td>
                Malay
            </td>
            <td>
                mt
            </td>
            <td>
                Maltese
            </td>
        </tr>
        <tr class="odd">
            <td>
                my
            </td>
            <td>
                Burmese
            </td>
            <td>
                na
            </td>
            <td>
                Nauru
            </td>
            <td>
                ne
            </td>
            <td>
                Nepali
            </td>
        </tr>
        <tr class="even">
            <td>
                nl
            </td>
            <td>
                Dutch
            </td>
            <td>
                no
            </td>
            <td>
                Norwegian
            </td>
            <td>
                oc
            </td>
            <td>
                Occitan
            </td>
        </tr>
        <tr class="odd">
            <td>
                om
            </td>
            <td>
                (Afan) Oromo
            </td>
            <td>
                or
            </td>
            <td>
                Oriya
            </td>
            <td>
                pa
            </td>
            <td>
                Punjabi
            </td>
        </tr>
        <tr class="even">
            <td>
                pl
            </td>
            <td>
                Polish
            </td>
            <td>
                ps
            </td>
            <td>
                Pashto, Pushto
            </td>
            <td>
                pt
            </td>
            <td>
                Portuguese
            </td>
        </tr>
        <tr class="odd">
            <td>
                qu
            </td>
            <td>
                Quechua
            </td>
            <td>
                rm
            </td>
            <td>
                Rhaeto-Romance
            </td>
            <td>
                rn
            </td>
            <td>
                Kirundi
            </td>
        </tr>
        <tr class="even">
            <td>
                ro
            </td>
            <td>
                Romanian
            </td>
            <td>
                ru
            </td>
            <td>
                Russian
            </td>
            <td>
                rw
            </td>
            <td>
                Kinyarwanda
            </td>
        </tr>
        <tr class="odd">
            <td>
                sa
            </td>
            <td>
                Sanskrit
            </td>
            <td>
                sd
            </td>
            <td>
                Sindhi
            </td>
            <td>
                sg
            </td>
            <td>
                Sangho
            </td>
        </tr>
        <tr class="even">
            <td>
                sh
            </td>
            <td>
                Serbo-Croatian
            </td>
            <td>
                si
            </td>
            <td>
                Sinhalese
            </td>
            <td>
                sk
            </td>
            <td>
                Slovak
            </td>
        </tr>
        <tr class="odd">
            <td>
                sl
            </td>
            <td>
                Slovenian
            </td>
            <td>
                sm
            </td>
            <td>
                Samoan
            </td>
            <td>
                sn
            </td>
            <td>
                Shona
            </td>
        </tr>
        <tr class="even">
            <td>
                so
            </td>
            <td>
                Somali
            </td>
            <td>
                sq
            </td>
            <td>
                Albanian
            </td>
            <td>
                su
            </td>
            <td>
                Sundanese
            </td>
        </tr>
        <tr class="odd">
            <td>
                ss
            </td>
            <td>
                Siswati
            </td>
            <td>
                st
            </td>
            <td>
                Sesotho
            </td>
            <td>
                sv
            </td>
            <td>
                Swedish
            </td>
        </tr>
        <tr class="even">
            <td>
                sw
            </td>
            <td>
                Swahili
            </td>
            <td>
                ta
            </td>
            <td>
                Tamil
            </td>
            <td>
                te
            </td>
            <td>
                Telugu
            </td>
        </tr>
        <tr class="odd">
            <td>
                tg
            </td>
            <td>
                Tajik
            </td>
            <td>
                th
            </td>
            <td>
                Thai
            </td>
            <td>
                ti
            </td>
            <td>
                Tigrinya
            </td>
        </tr>
        <tr class="even">
            <td>
                tk
            </td>
            <td>
                Turkmen
            </td>
            <td>
                tl
            </td>
            <td>
                Tagalog
            </td>
            <td>
                tn
            </td>
            <td>
                Setswana
            </td>
        </tr>
        <tr class="odd">
            <td>
                to
            </td>
            <td>
                Tonga
            </td>
            <td>
                tr
            </td>
            <td>
                Turkish
            </td>
            <td>
                ts
            </td>
            <td>
                Tsonga
            </td>
        </tr>
        <tr class="even">
            <td>
                tt
            </td>
            <td>
                Tatar
            </td>
            <td>
                tw
            </td>
            <td>
                Twi
            </td>
            <td>
                ug
            </td>
            <td>
                Uighur
            </td>
        </tr>
        <tr class="odd">
            <td>
                uk
            </td>
            <td>
                Ukrainian
            </td>
            <td>
                ur
            </td>
            <td>
                Urdu
            </td>
            <td>
                uz
            </td>
            <td>
                Uzbek
            </td>
        </tr>
        <tr class="even">
            <td>
                vi
            </td>
            <td>
                Vietnamese
            </td>
            <td>
                vo
            </td>
            <td>
                Volapuk
            </td>
            <td>
                wo
            </td>
            <td>
                Wolof
            </td>
        </tr>
        <tr class="odd">
            <td>
                xh
            </td>
            <td>
                Xhosa
            </td>
            <td>
                yi
            </td>
            <td>
                Yiddish (formerly ji)
            </td>
            <td>
                yo
            </td>
            <td>
                Yoruba
            </td>
        </tr>
        <tr class="even">
            <td>
                za
            </td>
            <td>
                Zhuang
            </td>
            <td>
                zh
            </td>
            <td>
                Chinese
            </td>
            <td>
                zu
            </td>
            <td>
                Zulu
            </td>
        </tr>
    </tbody>
</table>
<p>
    Table 112. Locale country codes, capitalized by country.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Code
            </td>
            <td>
                Country
            </td>
            <td>
                Code
            </td>
            <td>
                Country
            </td>
        </tr>
        <tr class="even">
            <td>
                AF
            </td>
            <td>
                Afghanistan
            </td>
            <td>
                AL
            </td>
            <td>
                Albania
            </td>
        </tr>
        <tr class="odd">
            <td>
                DZ
            </td>
            <td>
                Algeria
            </td>
            <td>
                AS
            </td>
            <td>
                American Samoa
            </td>
        </tr>
        <tr class="even">
            <td>
                AD
            </td>
            <td>
                Andorra
            </td>
            <td>
                AO
            </td>
            <td>
                Angola
            </td>
        </tr>
        <tr class="odd">
            <td>
                AI
            </td>
            <td>
                Anguilla
            </td>
            <td>
                AQ
            </td>
            <td>
                Antarctica
            </td>
        </tr>
        <tr class="even">
            <td>
                AG
            </td>
            <td>
                Antigua and Barbuda
            </td>
            <td>
                AR
            </td>
            <td>
                Argentina
            </td>
        </tr>
        <tr class="odd">
            <td>
                AM
            </td>
            <td>
                Armenia
            </td>
            <td>
                AW
            </td>
            <td>
                Aruba
            </td>
        </tr>
        <tr class="even">
            <td>
                AU
            </td>
            <td>
                Australia
            </td>
            <td>
                AT
            </td>
            <td>
                Austria
            </td>
        </tr>
        <tr class="odd">
            <td>
                AZ
            </td>
            <td>
                Azerbaijan
            </td>
            <td>
                BS
            </td>
            <td>
                Bahamas
            </td>
        </tr>
        <tr class="even">
            <td>
                BH
            </td>
            <td>
                Bahrain
            </td>
            <td>
                BD
            </td>
            <td>
                Bangladesh
            </td>
        </tr>
        <tr class="odd">
            <td>
                BB
            </td>
            <td>
                Barbados
            </td>
            <td>
                BY
            </td>
            <td>
                Belarus
            </td>
        </tr>
        <tr class="even">
            <td>
                BE
            </td>
            <td>
                Belgium
            </td>
            <td>
                BZ
            </td>
            <td>
                Belize
            </td>
        </tr>
        <tr class="odd">
            <td>
                BJ
            </td>
            <td>
                Benin
            </td>
            <td>
                BM
            </td>
            <td>
                Bermuda
            </td>
        </tr>
        <tr class="even">
            <td>
                BT
            </td>
            <td>
                Bhutan
            </td>
            <td>
                BO
            </td>
            <td>
                Bolivia
            </td>
        </tr>
        <tr class="odd">
            <td>
                BA
            </td>
            <td>
                Bosnia and Herzegowina
            </td>
            <td>
                BW
            </td>
            <td>
                Botswana
            </td>
        </tr>
        <tr class="even">
            <td>
                BV
            </td>
            <td>
                Bouvet Island
            </td>
            <td>
                BR
            </td>
            <td>
                Brazil
            </td>
        </tr>
        <tr class="odd">
            <td>
                IO
            </td>
            <td>
                British Indian Ocean Territory
            </td>
            <td>
                BN
            </td>
            <td>
                Brunei Darussalam
            </td>
        </tr>
        <tr class="even">
            <td>
                BG
            </td>
            <td>
                Bulgaria
            </td>
            <td>
                BF
            </td>
            <td>
                Burkina Faso
            </td>
        </tr>
        <tr class="odd">
            <td>
                BI
            </td>
            <td>
                Burundi
            </td>
            <td>
                KH
            </td>
            <td>
                Cambodia
            </td>
        </tr>
        <tr class="even">
            <td>
                CM
            </td>
            <td>
                Cameroon
            </td>
            <td>
                CA
            </td>
            <td>
                Canada
            </td>
        </tr>
        <tr class="odd">
            <td>
                CV
            </td>
            <td>
                Cape Verde
            </td>
            <td>
                KY
            </td>
            <td>
                Cayman Islands
            </td>
        </tr>
        <tr class="even">
            <td>
                CF
            </td>
            <td>
                Central African Republic
            </td>
            <td>
                TD
            </td>
            <td>
                Chad
            </td>
        </tr>
        <tr class="odd">
            <td>
                CL
            </td>
            <td>
                Chile
            </td>
            <td>
                CN
            </td>
            <td>
                China
            </td>
        </tr>
        <tr class="even">
            <td>
                CX
            </td>
            <td>
                Christmas Island
            </td>
            <td>
                CC
            </td>
            <td>
                Cocos (Keeling) Islands
            </td>
        </tr>
        <tr class="odd">
            <td>
                CO
            </td>
            <td>
                Colombia
            </td>
            <td>
                KM
            </td>
            <td>
                Comoros
            </td>
        </tr>
        <tr class="even">
            <td>
                CD
            </td>
            <td>
                Congo, Democratic Republic of (was Zaire)
            </td>
            <td>
                CG
            </td>
            <td>
                Congo, People’s Republic of
            </td>
        </tr>
        <tr class="odd">
            <td>
                CK
            </td>
            <td>
                Cook Islands
            </td>
            <td>
                CR
            </td>
            <td>
                Costa Rica
            </td>
        </tr>
        <tr class="even">
            <td>
                CI
            </td>
            <td>
                Cote D’Ivoire
            </td>
            <td>
                HR
            </td>
            <td>
                Croatia (local name: Hrvatska)
            </td>
        </tr>
        <tr class="odd">
            <td>
                CU
            </td>
            <td>
                Cuba
            </td>
            <td>
                CY
            </td>
            <td>
                Cyprus
            </td>
        </tr>
        <tr class="even">
            <td>
                CZ
            </td>
            <td>
                Czech Republic
            </td>
            <td>
                DK
            </td>
            <td>
                Denmark
            </td>
        </tr>
        <tr class="odd">
            <td>
                DJ
            </td>
            <td>
                Djibouti
            </td>
            <td>
                DM
            </td>
            <td>
                Dominica
            </td>
        </tr>
        <tr class="even">
            <td>
                DO
            </td>
            <td>
                Dominican Republic
            </td>
            <td>
                TL
            </td>
            <td>
                East Timor
            </td>
        </tr>
        <tr class="odd">
            <td>
                EC
            </td>
            <td>
                Ecuador
            </td>
            <td>
                EG
            </td>
            <td>
                Egypt
            </td>
        </tr>
        <tr class="even">
            <td>
                SV
            </td>
            <td>
                El Salvador
            </td>
            <td>
                GQ
            </td>
            <td>
                Equatorial Guinea
            </td>
        </tr>
        <tr class="odd">
            <td>
                ER
            </td>
            <td>
                Eritrea
            </td>
            <td>
                EE
            </td>
            <td>
                Estonia
            </td>
        </tr>
        <tr class="even">
            <td>
                ET
            </td>
            <td>
                Ethiopia
            </td>
            <td>
                FK
            </td>
            <td>
                Falkland Islands (Malvinas)
            </td>
        </tr>
        <tr class="odd">
            <td>
                FO
            </td>
            <td>
                Faroe Islands
            </td>
            <td>
                FJ
            </td>
            <td>
                Fiji
            </td>
        </tr>
        <tr class="even">
            <td>
                FI
            </td>
            <td>
                Finland
            </td>
            <td>
                FR
            </td>
            <td>
                France
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Code
            </td>
            <td>
                Country
            </td>
            <td>
                Code
            </td>
            <td>
                Country
            </td>
        </tr>
        <tr class="even">
            <td>
                FX
            </td>
            <td>
                France, Metropolitan
            </td>
            <td>
                GF
            </td>
            <td>
                French Guiana
            </td>
        </tr>
        <tr class="odd">
            <td>
                PF
            </td>
            <td>
                French Polynesia
            </td>
            <td>
                TF
            </td>
            <td>
                French Southern Territories
            </td>
        </tr>
        <tr class="even">
            <td>
                GA
            </td>
            <td>
                Gabon
            </td>
            <td>
                GM
            </td>
            <td>
                Gambia
            </td>
        </tr>
        <tr class="odd">
            <td>
                GE
            </td>
            <td>
                Georgia
            </td>
            <td>
                DE
            </td>
            <td>
                Germany
            </td>
        </tr>
        <tr class="even">
            <td>
                GH
            </td>
            <td>
                Ghana
            </td>
            <td>
                GI
            </td>
            <td>
                Gibraltar
            </td>
        </tr>
        <tr class="odd">
            <td>
                GR
            </td>
            <td>
                Greece
            </td>
            <td>
                GL
            </td>
            <td>
                Greenland
            </td>
        </tr>
        <tr class="even">
            <td>
                GD
            </td>
            <td>
                Grenada
            </td>
            <td>
                GP
            </td>
            <td>
                Guadeloupe
            </td>
        </tr>
        <tr class="odd">
            <td>
                GU
            </td>
            <td>
                Guam
            </td>
            <td>
                GT
            </td>
            <td>
                Guatemala
            </td>
        </tr>
        <tr class="even">
            <td>
                GN
            </td>
            <td>
                Guinea
            </td>
            <td>
                GW
            </td>
            <td>
                Guinea-Bissau
            </td>
        </tr>
        <tr class="odd">
            <td>
                GY
            </td>
            <td>
                Guyana
            </td>
            <td>
                HT
            </td>
            <td>
                Haiti
            </td>
        </tr>
        <tr class="even">
            <td>
                HM
            </td>
            <td>
                Heard and Mc Donald Islands
            </td>
            <td>
                HN
            </td>
            <td>
                Honduras
            </td>
        </tr>
        <tr class="odd">
            <td>
                HK
            </td>
            <td>
                Hong Kong
            </td>
            <td>
                HU
            </td>
            <td>
                Hungary
            </td>
        </tr>
        <tr class="even">
            <td>
                IS
            </td>
            <td>
                Iceland
            </td>
            <td>
                IN
            </td>
            <td>
                India
            </td>
        </tr>
        <tr class="odd">
            <td>
                ID
            </td>
            <td>
                Indonesia
            </td>
            <td>
                IR
            </td>
            <td>
                Iran (Islamic Republic Of)
            </td>
        </tr>
        <tr class="even">
            <td>
                IQ
            </td>
            <td>
                Iraq
            </td>
            <td>
                IE
            </td>
            <td>
                Ireland
            </td>
        </tr>
        <tr class="odd">
            <td>
                IL
            </td>
            <td>
                Israel
            </td>
            <td>
                IT
            </td>
            <td>
                Italy
            </td>
        </tr>
        <tr class="even">
            <td>
                JM
            </td>
            <td>
                Jamaica
            </td>
            <td>
                JP
            </td>
            <td>
                Japan
            </td>
        </tr>
        <tr class="odd">
            <td>
                JO
            </td>
            <td>
                Jordan
            </td>
            <td>
                KZ
            </td>
            <td>
                Kazakhstan
            </td>
        </tr>
        <tr class="even">
            <td>
                KE
            </td>
            <td>
                Kenya
            </td>
            <td>
                KI
            </td>
            <td>
                Kiribati
            </td>
        </tr>
        <tr class="odd">
            <td>
                KP
            </td>
            <td>
                Korea, Democratic People’s Republic Of
            </td>
            <td>
                KR
            </td>
            <td>
                Korea, Republic Of
            </td>
        </tr>
        <tr class="even">
            <td>
                KW
            </td>
            <td>
                Kuwait
            </td>
            <td>
                KG
            </td>
            <td>
                Kyrgyzstan
            </td>
        </tr>
        <tr class="odd">
            <td>
                LA
            </td>
            <td>
                Lao People’s Democratic Republic
            </td>
            <td>
                LV
            </td>
            <td>
                Latvia
            </td>
        </tr>
        <tr class="even">
            <td>
                LB
            </td>
            <td>
                Lebanon
            </td>
            <td>
                LS
            </td>
            <td>
                Lesotho
            </td>
        </tr>
        <tr class="odd">
            <td>
                LR
            </td>
            <td>
                Liberia
            </td>
            <td>
                LY
            </td>
            <td>
                Libyan Arab Jamahiriya
            </td>
        </tr>
        <tr class="even">
            <td>
                LI
            </td>
            <td>
                Liechtenstein
            </td>
            <td>
                LT
            </td>
            <td>
                Lithuania
            </td>
        </tr>
        <tr class="odd">
            <td>
                LU
            </td>
            <td>
                Luxembourg
            </td>
            <td>
                MK
            </td>
            <td>
                Macedonia, The Former Yugoslav Republic Of
            </td>
        </tr>
        <tr class="even">
            <td>
                MG
            </td>
            <td>
                Madagascar
            </td>
            <td>
                MW
            </td>
            <td>
                Malawi
            </td>
        </tr>
        <tr class="odd">
            <td>
                MY
            </td>
            <td>
                Malaysia
            </td>
            <td>
                MV
            </td>
            <td>
                Maldives
            </td>
        </tr>
        <tr class="even">
            <td>
                ML
            </td>
            <td>
                Mali
            </td>
            <td>
                MT
            </td>
            <td>
                Malta
            </td>
        </tr>
        <tr class="odd">
            <td>
                MH
            </td>
            <td>
                Marshall Islands
            </td>
            <td>
                MQ
            </td>
            <td>
                Martinique
            </td>
        </tr>
        <tr class="even">
            <td>
                MR
            </td>
            <td>
                Mauritania
            </td>
            <td>
                MU
            </td>
            <td>
                Mauritius
            </td>
        </tr>
        <tr class="odd">
            <td>
                YT
            </td>
            <td>
                Mayotte
            </td>
            <td>
                MX
            </td>
            <td>
                Mexico
            </td>
        </tr>
        <tr class="even">
            <td>
                FM
            </td>
            <td>
                Micronesia, Federated States Of
            </td>
            <td>
                MD
            </td>
            <td>
                Moldova, Republic Of
            </td>
        </tr>
        <tr class="odd">
            <td>
                MC
            </td>
            <td>
                Monaco
            </td>
            <td>
                MN
            </td>
            <td>
                Mongolia
            </td>
        </tr>
        <tr class="even">
            <td>
                MS
            </td>
            <td>
                Montserrat
            </td>
            <td>
                MA
            </td>
            <td>
                Morocco
            </td>
        </tr>
        <tr class="odd">
            <td>
                MZ
            </td>
            <td>
                Mozambique
            </td>
            <td>
                MM
            </td>
            <td>
                Myanmar
            </td>
        </tr>
        <tr class="even">
            <td>
                NA
            </td>
            <td>
                Namibia
            </td>
            <td>
                NR
            </td>
            <td>
                Nauru
            </td>
        </tr>
        <tr class="odd">
            <td>
                NP
            </td>
            <td>
                Nepal
            </td>
            <td>
                NL
            </td>
            <td>
                Netherlands
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Code
            </td>
            <td>
                Country
            </td>
            <td>
                Code
            </td>
            <td>
                Country
            </td>
        </tr>
        <tr class="even">
            <td>
                AN
            </td>
            <td>
                Netherlands Antilles
            </td>
            <td>
                NC
            </td>
            <td>
                New Caledonia
            </td>
        </tr>
        <tr class="odd">
            <td>
                NZ
            </td>
            <td>
                New Zealand
            </td>
            <td>
                NI
            </td>
            <td>
                Nicaragua
            </td>
        </tr>
        <tr class="even">
            <td>
                NE
            </td>
            <td>
                Niger
            </td>
            <td>
                NG
            </td>
            <td>
                Nigeria
            </td>
        </tr>
        <tr class="odd">
            <td>
                NU
            </td>
            <td>
                Niue
            </td>
            <td>
                NF
            </td>
            <td>
                Norfolk Island
            </td>
        </tr>
        <tr class="even">
            <td>
                MP
            </td>
            <td>
                Northern Mariana Islands
            </td>
            <td>
                NO
            </td>
            <td>
                Norway
            </td>
        </tr>
        <tr class="odd">
            <td>
                OM
            </td>
            <td>
                Oman
            </td>
            <td>
                PK
            </td>
            <td>
                Pakistan
            </td>
        </tr>
        <tr class="even">
            <td>
                PW
            </td>
            <td>
                Palau
            </td>
            <td>
                PS
            </td>
            <td>
                Palestinian Territory, Occupied
            </td>
        </tr>
        <tr class="odd">
            <td>
                PA
            </td>
            <td>
                Panama
            </td>
            <td>
                PG
            </td>
            <td>
                Papua New Guinea
            </td>
        </tr>
        <tr class="even">
            <td>
                PY
            </td>
            <td>
                Paraguay
            </td>
            <td>
                PE
            </td>
            <td>
                Peru
            </td>
        </tr>
        <tr class="odd">
            <td>
                PH
            </td>
            <td>
                Philippines
            </td>
            <td>
                PN
            </td>
            <td>
                Pitcairn
            </td>
        </tr>
        <tr class="even">
            <td>
                PL
            </td>
            <td>
                Poland
            </td>
            <td>
                PT
            </td>
            <td>
                Portugal
            </td>
        </tr>
        <tr class="odd">
            <td>
                PR
            </td>
            <td>
                Puerto Rico
            </td>
            <td>
                QA
            </td>
            <td>
                Qatar
            </td>
        </tr>
        <tr class="even">
            <td>
                RE
            </td>
            <td>
                Reunion
            </td>
            <td>
                RO
            </td>
            <td>
                Romania
            </td>
        </tr>
        <tr class="odd">
            <td>
                RU
            </td>
            <td>
                Russian Federation
            </td>
            <td>
                RW
            </td>
            <td>
                Rwanda
            </td>
        </tr>
        <tr class="even">
            <td>
                KN
            </td>
            <td>
                Saint Kitts And Nevis
            </td>
            <td>
                LC
            </td>
            <td>
                Saint Lucia
            </td>
        </tr>
        <tr class="odd">
            <td>
                VC
            </td>
            <td>
                Saint Vincent and The Grenadines
            </td>
            <td>
                WS
            </td>
            <td>
                Samoa
            </td>
        </tr>
        <tr class="even">
            <td>
                SM
            </td>
            <td>
                San Marino
            </td>
            <td>
                ST
            </td>
            <td>
                Sao Tome and Principe
            </td>
        </tr>
        <tr class="odd">
            <td>
                SA
            </td>
            <td>
                Saudi Arabia
            </td>
            <td>
                SN
            </td>
            <td>
                Senegal
            </td>
        </tr>
        <tr class="even">
            <td>
                SC
            </td>
            <td>
                Seychelles
            </td>
            <td>
                SL
            </td>
            <td>
                Sierra Leone
            </td>
        </tr>
        <tr class="odd">
            <td>
                SG
            </td>
            <td>
                Singapore
            </td>
            <td>
                SK
            </td>
            <td>
                Slovakia (Slovak Republic)
            </td>
        </tr>
        <tr class="even">
            <td>
                SI
            </td>
            <td>
                Slovenia
            </td>
            <td>
                SB
            </td>
            <td>
                Solomon Islands
            </td>
        </tr>
        <tr class="odd">
            <td>
                SO
            </td>
            <td>
                Somalia
            </td>
            <td>
                ZA
            </td>
            <td>
                South Africa
            </td>
        </tr>
        <tr class="even">
            <td>
                GS
            </td>
            <td>
                South Georgia and The South Sandwich Islands
            </td>
            <td>
                ES
            </td>
            <td>
                Spain
            </td>
        </tr>
        <tr class="odd">
            <td>
                LK
            </td>
            <td>
                Sri Lanka
            </td>
            <td>
                SH
            </td>
            <td>
                St. Helena
            </td>
        </tr>
        <tr class="even">
            <td>
                PM
            </td>
            <td>
                St. Pierre And Miquelon
            </td>
            <td>
                SD
            </td>
            <td>
                Sudan
            </td>
        </tr>
        <tr class="odd">
            <td>
                SR
            </td>
            <td>
                Suriname
            </td>
            <td>
                SJ
            </td>
            <td>
                Svalbard And Jan Mayen Islands
            </td>
        </tr>
        <tr class="even">
            <td>
                SZ
            </td>
            <td>
                Swaziland
            </td>
            <td>
                SE
            </td>
            <td>
                Sweden
            </td>
        </tr>
        <tr class="odd">
            <td>
                CH
            </td>
            <td>
                Switzerland
            </td>
            <td>
                SY
            </td>
            <td>
                Syrian Arab Republic
            </td>
        </tr>
        <tr class="even">
            <td>
                TW
            </td>
            <td>
                Taiwan
            </td>
            <td>
                TJ
            </td>
            <td>
                Tajikistan
            </td>
        </tr>
        <tr class="odd">
            <td>
                TZ
            </td>
            <td>
                Tanzania, United Republic Of
            </td>
            <td>
                TH
            </td>
            <td>
                Thailand
            </td>
        </tr>
        <tr class="even">
            <td>
                TG
            </td>
            <td>
                Togo
            </td>
            <td>
                TK
            </td>
            <td>
                Tokelau
            </td>
        </tr>
        <tr class="odd">
            <td>
                TO
            </td>
            <td>
                Tonga
            </td>
            <td>
                TT
            </td>
            <td>
                Trinidad and tobago
            </td>
        </tr>
        <tr class="even">
            <td>
                TN
            </td>
            <td>
                Tunisia
            </td>
            <td>
                TR
            </td>
            <td>
                Turkey
            </td>
        </tr>
        <tr class="odd">
            <td>
                TM
            </td>
            <td>
                Turkmenistan
            </td>
            <td>
                TC
            </td>
            <td>
                Turks And Caicos Islands
            </td>
        </tr>
        <tr class="even">
            <td>
                TV
            </td>
            <td>
                Tuvalu
            </td>
            <td>
                UG
            </td>
            <td>
                Uganda
            </td>
        </tr>
        <tr class="odd">
            <td>
                UA
            </td>
            <td>
                Ukraine
            </td>
            <td>
                AE
            </td>
            <td>
                United Arab Emirates
            </td>
        </tr>
        <tr class="even">
            <td>
                GB
            </td>
            <td>
                United Kingdom
            </td>
            <td>
                US
            </td>
            <td>
                United States
            </td>
        </tr>
        <tr class="odd">
            <td>
                Code
            </td>
            <td>
                Country
            </td>
            <td>
                Code
            </td>
            <td>
                Country
            </td>
        </tr>
        <tr class="even">
            <td>
                UM
            </td>
            <td>
                United States Minor Outlying Islands
            </td>
            <td>
                UY
            </td>
            <td>
                Uruguay
            </td>
        </tr>
        <tr class="odd">
            <td>
                UZ
            </td>
            <td>
                Uzbekistan
            </td>
            <td>
                VU
            </td>
            <td>
                Vanuatu
            </td>
        </tr>
        <tr class="even">
            <td>
                VA
            </td>
            <td>
                Vatican City State (Holy See)
            </td>
            <td>
                VE
            </td>
            <td>
                Venezuela
            </td>
        </tr>
        <tr class="odd">
            <td>
                VN
            </td>
            <td>
                Viet Nam
            </td>
            <td>
                VG
            </td>
            <td>
                Virgin Islands (British)
            </td>
        </tr>
        <tr class="even">
            <td>
                VI
            </td>
            <td>
                Virgin Islands (U.S.)
            </td>
            <td>
                WF
            </td>
            <td>
                Wallis and Futuna Islands
            </td>
        </tr>
        <tr class="odd">
            <td>
                EH
            </td>
            <td>
                Western Sahara
            </td>
            <td>
                YE
            </td>
            <td>
                Yemen
            </td>
        </tr>
        <tr class="even">
            <td>
                YU
            </td>
            <td>
                Yugoslavia
            </td>
            <td>
                ZM
            </td>
            <td>
                Zambia
            </td>
        </tr>
        <tr class="odd">
            <td>
                ZW
            </td>
            <td>
                Zimbabwe
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<p>
    I make extensive use of styles in the OOo documents that I write. I use a specific paragraph style to format my code
    samples. Each paragraph style allows you to set the default character attributes to use in the paragraph. In OOo,
    characters specify the locale so I set the locale for this paragraph style to unknown; this prevents the
    spell-checker from checking my code samples.
</p>
<p>
    To tell OOo that a word is French, and should be checked as French, set the locale of the characters to
</p>
<p>
    French. The code in Listing 312 traverses the paragraphs in a document and sets the locale on each one. Listing 312.
    Set a simple Writer document to use a French locale.
</p>
<p>
    Sub SetDocumentLocale
</p>
<p>
    Dim aLocale As New com.sun.star.lang.Locale
</p>
<p>
    aLocale.Language = "fr" 'Set the Locale to use the French language aLocale.Country = "FR" 'Set the Locale to use
    France as the country
</p>
<p>
    Dim oCursor 'Cursor used to traverse the document. Dim oText 'The document text object
</p>
<p>
    oText = ThisComponent.Text 'Writer documents have a Text object oCursor = oText.createTextCursor() 'Create a text
    cursor
</p>
<p>
    REM Move cursor to the start of the document and do not select text.
</p>
<p>
    oCursor.GoToStart(False)
</p>
<p>
    REM Move to the end of the paragraph, selecting the entire paragraph.
</p>
<p>
    REM gotoNextParagraph() returns False if it fails. Do While oCursor.gotoNextParagraph(True)
</p>
<p>
    oCursor.CharLocale = aLocale 'This can fail for some paragraph types
</p>
<p>
    oCursor.goRight(0, False) 'Deselect all text
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<p>
    The spell-checker, hyphenation, and thesaurus all require a locale to function. They will not function, however, if
    they aren’t properly configured. Use Tools | Options | Language Settings | Writing Aids to configure these in OOo.
    The macro in Listing 313 obtains a SpellChecker, Hyphenator, and Thesaurus, all of which require a Locale object.
    Listing 313. Spell Check, Hyphenate, and Thesaurus.
</p>
<p>
    Sub SpellCheckExample
</p>
<p>
    Dim s() 'Contains the words to check
</p>
<p>
    Dim vReturn 'Value returned from SpellChecker, Hyphenator, and Thesaurus
</p>
<p>
    Dim i As Integer 'Utility index variable
</p>
<p>
    Dim msg$ 'Message string
</p>
<p>
</p>
<p>
    REM Although I create an empty argument array, I could also
</p>
<p>
    REM use Array() to return an empty array. Dim emptyArgs() as new com.sun.star.beans.PropertyValue
</p>
<p>
</p>
<p>
    Dim aLocale As New com.sun.star.lang.Locale aLocale.Language = "en" 'Use the English language
</p>
<p>
    aLocale.Country = "US" 'Use the United States as the country
</p>
<p>
</p>
<p>
    REM Words to check for spelling, hyphenation, and thesaurus s = Array("hello", "anesthesiologist",_
</p>
<p>
    "PNEUMONOULTRAMICROSCOPICSILICOVOLCANOCONIOSIS",_
</p>
<p>
    "Pitonyak", "misspell")
</p>
<p>
</p>
<p>
    REM *********Spell Check Example! Dim vSpeller As Variant
</p>
<p>
    vSpeller = createUnoService("com.sun.star.linguistic2.SpellChecker") 'Use vReturn = vSpeller.spell(s, aLocale,
    emptyArgs()) if you want options! For i = LBound(s()) To UBound(s())
</p>
<p>
    vReturn = vSpeller.isValid(s(i), aLocale, emptyArgs()) msg = msg &amp; vReturn &amp; " for " &amp; s(i) &amp;
    CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox msg, 0, "Spell Check Words" msg = ""
</p>
<p>
</p>
<p>
    '******Hyphenation Example! Dim vHyphen As Variant
</p>
<p>
    vHyphen = createUnoService("com.sun.star.linguistic2.Hyphenator")
</p>
<p>
    For i = LBound(s()) To UBound(s())
</p>
<p>
    'vReturn = vHyphen.hyphenate(s(i), aLocale, 0, emptyArgs()) vReturn = vHyphen.createPossibleHyphens(s(i), aLocale,
    emptyArgs())
</p>
<p>
    If IsNull(vReturn) Then
</p>
<p>
    'hyphenation is probablly off in the configuration msg = msg &amp; " null for " &amp; s(i) &amp; CHR$(10) Else
</p>
<blockquote>
    <p>
        msg = msg &amp; vReturn.getPossibleHyphens() &amp; " for " &amp; s(i) &amp; CHR$(10) End If
    </p>
</blockquote>
<p>
    Next
</p>
<p>
    MsgBox msg, 0, "Hyphenate Words" msg = ""
</p>
<p>
</p>
<p>
    '******Thesaurus Example!
</p>
<p>
    Dim vThesaurus As Variant Dim j As Integer, k As Integer
</p>
<p>
    vThesaurus = createUnoService("com.sun.star.linguistic2.Thesaurus") s = Array("hello", "stamp", "cool") For i =
    LBound(s()) To UBound(s())
</p>
<p>
    vReturn = vThesaurus.queryMeanings(s(i), aLocale, emptyArgs())
</p>
<p>
    If UBound(vReturn) &lt; 0 Then
</p>
<p>
    Print "Thesaurus found nothing for " &amp; s(i) Else
</p>
<p>
    msg = "Word " &amp; s(i) &amp; " has the following meanings:" &amp; CHR$(10)
</p>
<p>
    For j = LBound(vReturn) To UBound(vReturn)
</p>
<p>
    msg=msg &amp; CHR$(10) &amp; "Meaning = " &amp; vReturn(j).getMeaning() &amp; CHR$(10) msg = msg &amp;
    Join(vReturn(j).querySynonyms(), " ") &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox msg, 0, "Althernate Meanings"
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    It is possible to obtain the default locale that is configured for OOo. Laurent Godard, an active
</p>
<p>
    OpenOffice.org volunteer, wrote the macro in Listing 314, which obtains OOo’s currently configured locale. Listing
    314. Currently configured language (Locale).
</p>
<p>
    Sub OOoLang()
</p>
<p>
    'Retreives the running OOO version
</p>
<p>
    'Author : Laurent Godard
</p>
<p>
    'e-mail : listes.godard@laposte.net
</p>
<p>
    '
</p>
<p>
    Dim aSettings, aConfigProvider
</p>
<p>
    Dim aParams2(0) As new com.sun.star.beans.PropertyValue Dim sProvider$, sAccess$
</p>
<p>
    sProvider = "com.sun.star.configuration.ConfigurationProvider" sAccess =
    "com.sun.star.configuration.ConfigurationAccess" aConfigProvider = createUnoService(sProvider) aParams2(0).Name =
    "nodepath"
</p>
<p>
    aParams2(0).Value = "/org.openoffice.Setup/L10N" aSettings = aConfigProvider.createInstanceWithArguments(sAccess,
    aParams2())
</p>
<p>
    Dim OOLangue as string
</p>
<p>
    OOLangue= aSettings.getbyname("ooLocale") 'en-US
</p>
<p>
    MsgBox "OOo is configured with Locale " &amp; OOLangue, 0, "OOo Locale" End Sub
</p>
<p>
    The above macro is reputed to fail on AOO, but, the following should work correctly. The macro does function
    correctly with LO. The macro shown below should work for both AOO and LO. Listing 315. You can use the tools library
    to get the current locale as a string.
</p>
<p>
    GlobalScope.BasicLibraries.loadLibrary( "Tools" )
</p>
<p>
    Print GetRegistryKeyContent("org.openoffice.Setup/L10N",FALSE).getByName("ooLocale")
</p>
<h1 id="enumerating-printers">
    13.14. Enumerating printers
</h1>
<p>
    The ability to enumerate printers has long been lacking in OOo. To obtain a printer list in OOo version 1.x or 2.x I
    used the .uno:print dispatch to open the print dialog, and then I directly access the dialog to extract the list of
    available printers.
</p>
<p>
    The PrinterServer service was introduced, but it was not properly constructed, so the methods in the XPrinterServer
    interface are not directly available; according to Ariel Constenla-Haile this is slated to be ready in OOo 3.5.
    Thankfully, Niklas Nebel provided a working solution. The solution is a bit tricky, but it demonstrates how to work
    around the problem. Listing 316. Display available printers.
</p>
<p>
    Sub PrintAllPrinterNames()
</p>
<p>
    Dim oPrintServer ' The print server service.
</p>
<p>
    Dim oCore ' Get classes and other objects by name.
</p>
<p>
    Dim oClass ' XPrinterServer class object.
</p>
<p>
    Dim oMethod ' getPrinterNames method from the XPrinterServer class. Dim aNames ' List of printer names.
</p>
<p>
</p>
<p>
    ' Create the object that will not be directly usable until OOo 3.5. oPrintServer =
    CreateUnoService("com.sun.star.awt.PrinterServer") oCore =
    CreateUnoService("com.sun.star.reflection.CoreReflection")
</p>
<p>
    ' Get the class object for the XPrinterServer interface. oClass = oCore.forName("com.sun.star.awt.XPrinterServer")
</p>
<p>
</p>
<p>
    ' Get the getPrinterNames method for the XPrinterServer class. oMethod = oClass.getMethod("getPrinterNames")
</p>
<p>
</p>
<p>
    ' Call the getPrinterNames method on the PrinterServer object. aNames = oMethod.invoke(oPrintServer, Array())
</p>
<p>
    MsgBox Join(aNames, CHR$(10))
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        TIP If OOo does not recognize your printer by it's name, surround the printer name with angle brackets
        “&lt;printer_name&gt;”, in the past some printers required this.
    </p>
</blockquote>
<p>
    Prior to OOo 3.5, the PrinterServer cannot be used from Basic, because XTypeProvider is not declared to be inherited
    by that class; although it is implemented in the class. Basic cannot, therefore, recognize the methods supported by
    the object. The code in Listing 316 demonstrates how to call the method directly.
</p>
<h1 id="printing-documents">
    13.15. Printing documents
</h1>
<p>
    The primary printing functionality is common to all OOo document types. The interface com.sun.star.view.XPrintable
    defines three methods (see Table 113).
</p>
<p>
    Table 113. Object methods defined by com.sun.star.view.XPrintable.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Object Method
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                getPrinter()
            </td>
            <td>
                Default printer as an array of properties (com.sun.star.view.PrinterDescriptor).
            </td>
        </tr>
        <tr class="odd">
            <td>
                setPrinter(properties)
            </td>
            <td>
                Assign a new printer to the object (com.sun.star.view.PrinterDescriptor).
            </td>
        </tr>
        <tr class="even">
            <td>
                print(properties)
            </td>
            <td>
                Print the document (com.sun.star.view.PrintOptions).
            </td>
        </tr>
    </tbody>
</table>
<p>
    The object method getPrinter() returns an array of properties that describe the printer (see Figure 91). The macro
    in Listing 317 demonstrates how to access and interpret each of the properties (see Table 114 for supported
    properties). Listing 317. Display printer properties.
</p>
<p>
    Sub DisplayPrinterProperties
</p>
<p>
    Dim Props 'Array of com.sun.star.beans.PropertyValue
</p>
<p>
    Dim i% 'Index variable of type Integer
</p>
<p>
    Dim s$ 'Display string
</p>
<p>
    Dim v '
</p>
<p>
    Dim sName$ '
</p>
<p>
    On Error Resume Next
</p>
<p>
    Props = ThisComponent.getPrinter()
</p>
<p>
    For i = 0 To UBound(Props) sName = props(i).Name v = props(i).Value s = s &amp; sName &amp; " = "
</p>
<p>
    If sName = "PaperOrientation" Then
</p>
<p>
    REM com.sun.star.view.PaperOrientation.LANDSCAPE also supported s = s &amp;
    IIf(v=com.sun.star.view.PaperOrientation.PORTRAIT,_
</p>
<p>
    "Portrait", "Landscape") &amp; " = " &amp; CStr(v)
</p>
<p>
    ElseIf sName = "PaperFormat" Then
</p>
<p>
    Select Case v
</p>
<p>
    Case com.sun.star.view.PaperFormat.A3 s = s &amp; "A3"
</p>
<p>
    Case com.sun.star.view.PaperFormat.A4 s = s &amp; "A4"
</p>
<p>
    Case com.sun.star.view.PaperFormat.A5 s = s &amp; "A5"
</p>
<p>
    Case com.sun.star.view.PaperFormat.B4 s = s &amp; "B4"
</p>
<p>
    Case com.sun.star.view.PaperFormat.B5 s = s &amp; "B5"
</p>
<p>
    Case com.sun.star.view.PaperFormat.LETTER s = s &amp; "LETTER"
</p>
<p>
    Case com.sun.star.view.PaperFormat.LEGAL s = s &amp; "LEGAL"
</p>
<p>
    Case com.sun.star.view.PaperFormat.TABLOID s = s &amp; "TABLOID"
</p>
<p>
    Case com.sun.star.view.PaperFormat.USER
</p>
<p>
    s = s &amp; "USER"
</p>
<p>
    Case Else
</p>
<p>
    s = s &amp; "Unknown value" End Select
</p>
<p>
    s = s &amp; " = " &amp; CStr(v) ElseIf sName = "PaperSize" Then
</p>
<p>
    REM type is com.sun.star.awt.Size
</p>
<p>
    REM The size is in TWIPS and there are 1440 twips per inch
</p>
<p>
    s=s &amp; CDbl(v.Width)/1440.0 &amp; "x" &amp; CDbl(v.Height)/1440.0 &amp; " (inches)" Else
</p>
<p>
    s = s &amp; CStr(v)
</p>
<p>
    End If
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Printer Properties"
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image10.png" style="width:2.47in;height:1.93667in" />
    </p>
</blockquote>
<p>
    Figure 91. Properties of the default printer.
</p>
<p>
    Table 114. Properties defined by the service com.sun.star.view.PrinterDescriptor.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                Name
            </td>
            <td>
                Name of the printer queue.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PaperOrientation
            </td>
            <td>
                Paper orientation (com.sun.star.view.PaperOrientation).
            </td>
        </tr>
        <tr class="even">
            <td>
                PaperFormat
            </td>
            <td>
                Predefined paper sizes (com.sun.star.view.PaperFormat).
            </td>
        </tr>
        <tr class="odd">
            <td>
                PaperSize
            </td>
            <td>
                Paper size in twips (com.sun.star.awt.Size).
            </td>
        </tr>
        <tr class="even">
            <td>
                IsBusy
            </td>
            <td>
                Is the printer busy?
            </td>
        </tr>
        <tr class="odd">
            <td>
                CanSetPaperOrientation
            </td>
            <td>
                Can the paper orientation be set?
            </td>
        </tr>
        <tr class="even">
            <td>
                CanSetPaperFormat
            </td>
            <td>
                Are other paper formats supported?
            </td>
        </tr>
        <tr class="odd">
            <td>
                CanSetPaperSize
            </td>
            <td>
                Can the paper size be set?
            </td>
        </tr>
    </tbody>
</table>
<p>
    Call the print() method with no properties to print a single copy of the document to the current printer. All of the
    document types support the properties in Table 115. The Pages property supports the standard format used in the
    Print dialog. The format string “1, 3, 4-7, 9-” prints pages 1, 3, 4 through 7, and 9 through the last page.
</p>
<p>
    Table 115. Properties defined by com.sun.star.view.PrintOptions.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                Collate
            </td>
            <td>
                Collate the printed pages (set to True or False).
            </td>
        </tr>
        <tr class="odd">
            <td>
                CopyCount
            </td>
            <td>
                Number of copies to print.
            </td>
        </tr>
        <tr class="even">
            <td>
                DuplexMode
            </td>
            <td>
                <p>
                    Use the com.sun.star.view.DuplexMode constants to set duplex mode. Supported values include UNKNOWN
                    (0), OFF (1), LONGEDGE (2), and SHORTEDGE
                </p>
                <p>
                    (3).
                </p>
            </td>
        </tr>
        <tr class="odd">
            <td>
                FileName
            </td>
            <td>
                Send the output to a file rather than to the printer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Pages
            </td>
            <td>
                Specifies pages and page ranges to print.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Wait
            </td>
            <td>
                If TRUE, the print request is synchronous; wait for the job to finish before returning.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Listing 318. Print pages 30 and 31 of the current document.
</p>
<p>
    Dim Props(1) As New com.sun.star.beans.PropertyValue
</p>
<p>
    Props(0).Name = "Pages" : Props(0).Value = "30-31" ThisComponent.print(Props())
</p>
<p>
    When a document is printed, control returns to the caller before the printing is complete. If you close the document
    before printing is done, OpenOffice is likely to crash because the OO internals are still using the document. It’s
    possible to set up an event listener that watches for the print job to finish, but there’s an easier way that isn’t
    currently documented. The print() method accepts an array of properties that direct the printing. The “wait”
    argument with a Boolean value of True instructs the print() method to not return until after printing is complete.
    As of May 17, 2011 with OOo 3.3, the wait argument does not work; print listener is demonstrated in section 13.15.3
    A Calc example with a Print listener.
</p>
<blockquote>
    <p>
        TIP Closing a document while OpenOffice.org is printing the document can cause OpenOffice.org to crash. Use the
        “wait” property to avoid this problem.
    </p>
</blockquote>
<p>
    On Unix-type computers, printers are configured to work with OpenOffice.org using the “spadmin” utility. After a
    printer has been configured for OOo, it is available for use by name. You can still use printers that have not been
    configured for OOo, but you must enclose the printer name between the characters “&lt;” and “&gt;”. To print with a
    printer other than the default, use code similar to the following:
</p>
<p>
    Public oProps(0) as New com.sun.star.beans.PropertyValue
</p>
<p>
    Public oOpts(1) as New com.sun.star.beans.PropertyValue
</p>
<p>
    Dim oDoc 'Document to print.
</p>
<p>
    Dim oPrinter 'Array of properties that define the printer.
</p>
<p>
    Dim sUrl$ 'URL of the document to load and print. Dim sPrinter$ 'Name of the printer.
</p>
<p>
    REM Set the name of the printer as known by the system. sPrinter = "HP-Color-LaserJet-4650DN"
</p>
<p>
    REM Load the document in hidden mode so it is not visible
</p>
<p>
    REM on the screen.
</p>
<p>
    oProps(0).Name = "Hidden" oProps(0).Value = True
</p>
<p>
    REM Now load the document.
</p>
<p>
    sUrl = "file:///c:/test_doc.sxw" oDoc = oDesk.LoadComponentFromUrl(sUrl, "_blank", 63, oProps())
</p>
<p>
    REM Obtain the current printer object from the document.
</p>
<p>
    REM This is really an array of property values.
</p>
<p>
    REM Change the name of the object to reference the printer that REM you want to use. Notice that the printer name is
    the system name. oPrinter = oDoc.getPrinter()
</p>
<p>
    For i = LBound(oPrinter) to UBound(oPrinter)
</p>
<p>
    If oPrinter(i).Name = "Name" Then oPrinter(i).Value = sPrinter
</p>
<p>
    End If
</p>
<p>
    Next i
</p>
<p>
    REM Set the printer back into the document. The only thing
</p>
<p>
    REM that has changed is the printer name. oDoc.setPrinter(oPrinter)
</p>
<p>
    REM Now, set up the print options for actual printing.
</p>
<p>
    REM Notice that the printer name is surrounded by the characters &lt; and &gt;. REM Also notice that the print()
    method is set to not return until
</p>
<p>
    REM after printing is completed. oOpts(0).Name = "Name"
</p>
<p>
    oOpts(0).Value = "&lt;" &amp; sPrinter &amp; "&gt;" oOpts(1).Name = "Wait" oOpts(1).Value = True oDoc.Print(oOpts())
</p>
<blockquote>
    <p>
        TIP Historically, it has been experimentally determined that you must set the destination printer in the
        document before trying to print to a printer other than the default.
    </p>
</blockquote>
<h2 id="printing-writer-documents">
    13.15.1. Printing Writer documents
</h2>
<p>
    Different document types support extra options for printing. Text documents support the interface
    com.sun.star.text.XPagePrintable (see Table 116). The XPagePrintable interface implements an alternate method of
    printing the document that provides more control of the output. The primary advantage is that you can print multiple
    pages from the document on a single output page.
</p>
<p>
    Table 116. Methods defined by the com.sun.star.text.XPagePrintable interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Object Methods
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                getPagePrintSettings()
            </td>
            <td>
                Returns an array of properties (see Table 117).
            </td>
        </tr>
        <tr class="odd">
            <td>
                setPagePrintSettings(properties)
            </td>
            <td>
                Change the settings (see Table 117).
            </td>
        </tr>
        <tr class="even">
            <td>
                printPages(properties)
            </td>
            <td>
                Print using properties in Table 115.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The object method printPages() accepts the same properties as the print() method (see Table 115). The methods to get
    and set the page print properties are outlined in Table 117. The macro in Listing 319 obtains and prints the current
    page print properties, shown in Figure 92.
</p>
<p>
    Table 117. Properties used by the com.sun.star.text.XPagePrintable interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                PageRows
            </td>
            <td>
                Number of rows of pages on each printed page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PageColumns
            </td>
            <td>
                Number of columns of pages on each printed page.
            </td>
        </tr>
        <tr class="even">
            <td>
                LeftMargin
            </td>
            <td>
                Left margin.
            </td>
        </tr>
        <tr class="odd">
            <td>
                RightMargin
            </td>
            <td>
                Right margin.
            </td>
        </tr>
        <tr class="even">
            <td>
                TopMargin
            </td>
            <td>
                Top margin.
            </td>
        </tr>
        <tr class="odd">
            <td>
                BottomMargin
            </td>
            <td>
                Bottom margin.
            </td>
        </tr>
        <tr class="even">
            <td>
                HoriMargin
            </td>
            <td>
                Margin between rows of pages.
            </td>
        </tr>
        <tr class="odd">
            <td>
                VertMargin
            </td>
            <td>
                Margin between columns of pages.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsLandscape
            </td>
            <td>
                True or False; print in landscape format.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Listing 319. Display Page Print Properties.
</p>
<p>
    Sub DisplayPagePrintProperties
</p>
<p>
    Dim Props 'Array of com.sun.star.beans.PropertyValue
</p>
<p>
    Dim i% 'Index variable of type Integer
</p>
<p>
    Dim s$ 'Display string
</p>
<p>
    If HasUnoInterfaces(ThisComponent, "com.sun.star.text.XPagePrintable") Then Props =
    ThisComponent.getPagePrintSettings()
</p>
<p>
    For i = 0 To UBound(Props)
</p>
<p>
    s = s &amp; props(i).Name &amp; " = " &amp; CStr(props(i).Value) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Page Print Properties"
</p>
<p>
    Else
</p>
<p>
    Print "Sorry, this document does not support the XPagePrintable interface" End If
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image11.png" style="width:1.94667in;height:1.83667in" />
    </p>
</blockquote>
<p>
    Figure 92. Page print properties of a Writer document.
</p>
<p>
    The macro in Listing 320 attempts to print a document with two pages on each printed page in landscape mode. With my
    latest testing in OOo version 3.3, the document is printed normally, which is an improvement over the previous
    behavior of crashing OOo. Listing 320. Print Two Per Page.
</p>
<p>
    Sub PrintTwoPerPage
</p>
<p>
    Dim Props(0 To 1) As New com.sun.star.beans.PropertyValue
</p>
<p>
    Props(0).Name = "PageColumns" : Props(0).Value = 2
</p>
<p>
    Props(1).Name = "IsLandscape" : Props(1).Value = True If HasUnoInterfaces(ThisComponent,
    "com.sun.star.text.XPagePrintable") Then
</p>
<p>
    ThisComponent.setPagePrintSettings(Props()) '
</p>
<p>
    ThisComponent.printPages(Array()) 'Use default properties Else
</p>
<p>
    Print "Sorry, this document does not support the XPagePrintable interface" End If
</p>
<p>
    End Sub
</p>
<p>
    Although the macro in Listing 320 stopped working with OOo 1.1.1, a small modification allows the macro to run. The
    new macro still causes OOo to crash under Linux and to close the document under Windows, but it does manage to print
    the document. As with Listing 320, the document is printed in portrait mode rather than landscape mode — this is an
    OOo bug.
</p>
<h2 id="printing-calc-documents">
    13.15.2. Printing Calc documents
</h2>
<p>
    To perform special printing functions with a Writer document, a special object method is called. To perform special
    printing functions with Calc documents, you must modify the document properties and page-style properties and then
    use the standard print() method. For example, it is common for a Calc sheet to be too large to fit on a single sheet
    of paper. To scale the sheet to fit on a specified number of pages, set the ScaleToPages property to contain the
    number of pages that should contain the sheet. To simply scale the page based on a percentage, use the PageScale
    property (see Listing 321). Listing 321. Print a spreadsheet at 25 percent; this is very small!
</p>
<p>
    Sub PrintScaledSpreadsheet
</p>
<p>
    Dim s$ 'Style name
</p>
<p>
    Dim oStyle 'The current page style
</p>
<p>
    REM Use the currently active sheet to obtain the page style.
</p>
<p>
    REM In a Calc document, the current controller knows which sheet
</p>
<p>
    REM is active. s = ThisComponent.CurrentController.getActiveSheet().PageStyle
</p>
<p>
    oStyle = ThisComponent.StyleFamilies.getByName("PageStyles").getByName(s)
</p>
<p>
    REM oStyle.PageScale = 100 Default value is 100 (as in 100%) REM oStyle.ScaleToPages = 0 Default value is 0, as in
    don't scale oStyle.PageScale = 25 'Scale document to 25% (very very very small) ThisComponent.Print(Array()) 'Print
    the document End Sub
</p>
<p>
    The second aspect to printing Calc documents involves setting the area to print along with the column and row titles
    (see Table 118).
</p>
<p>
    Table 118. Properties used by the com.sun.star.sheet.XPrintAreas interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Object Method
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                getPrintAreas()
            </td>
            <td>
                Return array of type com.sun.star.table.CellRangeAddress.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setPrintAreas(ranges)
            </td>
            <td>
                Set print areas for the sheet with array of type CellRangeAddress. Print everything if nothing is set.
            </td>
        </tr>
        <tr class="even">
            <td>
                getPrintTitleColumns()
            </td>
            <td>
                Return True if title columns are repeated to the right.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setPrintTitleColumns(boolean)
            </td>
            <td>
                Set True if title columns are repeated on all print pages to the right.
            </td>
        </tr>
        <tr class="even">
            <td>
                getTitleColumns()
            </td>
            <td>
                Array of type com.sun.star.table.CellRangeAddress.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setTitleColumns(ranges)
            </td>
            <td>
                Set columns to use as titles. Rows are ignored; only columns matter.
            </td>
        </tr>
        <tr class="even">
            <td>
                getPrintTitleRows()
            </td>
            <td>
                Return True if title rows are repeated on all print pages.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setPrintTitleRows(boolean)
            </td>
            <td>
                Set to True if row titles are repeated on all print pages to the bottom.
            </td>
        </tr>
        <tr class="even">
            <td>
                getTitleRows()
            </td>
            <td>
                Return array of type com.sun.star.table.CellRangeAddress.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setTitleRows(ranges)
            </td>
            <td>
                Set rows to use as titles. Columns are ignored; only rows matter.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The methods in Table 118 are based on sheets in a Calc document; as opposed to the entire Calc document. The macro
    in Listing 322 sets two print ranges and then prints the document. Each print range is printed on a new page.
    Listing 322. Set and print multiple ranges in a Calc document.
</p>
<p>
    Sub PrintSpreadsheetAreas
</p>
<p>
    Dim oRanges(1) As New com.sun.star.table.CellRangeAddress
</p>
<p>
    oRanges(0).Sheet = 0
</p>
<p>
    oRanges(0).StartColumn = 0 : oRanges(0).StartRow = 0 'A1 oRanges(0).EndColumn = 3 : oRanges(0).EndRow = 4 'D5
</p>
<p>
</p>
<p>
    oRanges(1).Sheet = 0
</p>
<p>
    oRanges(1).StartColumn = 0 : oRanges(1).StartRow = 8 'A9 oRanges(1).EndColumn = 3 : oRanges(1).EndRow = 10 'D11
</p>
<p>
</p>
<p>
    ThisComponent.CurrentController.getActiveSheet().setPrintAreas(oRanges()) ThisComponent.Print(Array()) End Sub
</p>
<h2 id="a-calc-example-with-a-print-listener">
    13.15.3. A Calc example with a Print listener
</h2>
<p>
    Sheet1 in a Calc document contains a button that prints Sheet2 and leaves Sheet1 as the active sheet. To print
    Sheet2, it must be made the active sheet. The code was structured as follows:
</p>
<ol type="1">
    <li>
        Set Sheet2 active.
    </li>
    <li>
        Call the document level print method.
    </li>
    <li>
        Set Sheet1 active.
    </li>
</ol>
<p>
    The print method returns immediately and the document is printed in the background. Sheet1, therefore, becomes the
    active sheet before printing begins, so Sheet1 is printed rather than Sheet2. The correct solution is to register a
    print listener that sets Sheet1 active after printing is complete.
</p>
<p>
    A listener is stored in a Global variable so that is lives after the macro is finished running. Be warned, however,
    that if you edit any macro the global variable will be erased but the listener will still be registered; and you
    will have no way to unregister it without closing the document. So, first, create the variables to reference the
    listener. The document is also stored, but I could have referenced ThisComponent instead. Listing 323. Global
    variables that reference the listener and the document.
</p>
<p>
    Global oPrintListener
</p>
<p>
    Global oPrintJobListnerDoc
</p>
<p>
    The current active sheet is set as part of the real world macro, so it is also shown here. Listing 324. Utility
    routine to set a Calc document's active sheet.
</p>
<p>
    REM *******************************
</p>
<p>
    REM ** oDoc - Calc sheet on which to operate. No error checking is performed REM ** sSheetName - Sheet name to make
    active. The sheet is verified to exist.
</p>
<p>
    REM *******************************
</p>
<p>
    Sub set_active_sheet(oDoc, sSheetName) Dim oSheets
</p>
<p>
    oSheets = oDoc.Sheets
</p>
<p>
    If oSheets.hasByName(sSheetName) Then
</p>
<p>
    oDoc.currentController.setActiveSheet(oSheets.getByName(sSheetName)) End If
</p>
<p>
    End Sub
</p>
<p>
    An event is sent to the listener if the listener is being disposed. The text “print_listener_” prefixes the routines
    used to implement the listener.
</p>
<p>
    Listing 325. Print listener disposing method.
</p>
<p>
    REM *******************************
</p>
<p>
    REM ** The print job is disposing, so, remove it.
</p>
<p>
    REM *******************************
</p>
<p>
    Sub print_listener_disposing(oEvent)
</p>
<p>
    On Error Resume Next
</p>
<p>
    Dim emptyObj
</p>
<p>
    If NOT IsNull(oPrintJobListnerDoc) AND NOT IsEMpty(oPrintJobListnerDoc) Then
    oPrintJobListnerDoc.removePrintJobListener(oPrintListener)
</p>
<p>
    oPrintJobListnerDoc = emptyObj
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    The listener is called every time the print job changes state. Listing 326. Print listener status changed event.
</p>
<p>
    REM *******************************
</p>
<p>
    REM ** Called everytime the state of the print job changes.
</p>
<p>
    REM ** Error messages are printed if they occur.
</p>
<p>
    REM ** If the event announces an error or that the job is finished,
</p>
<p>
    REM ** the print job listener is removed and the "Input Data" sheet is set to active.
</p>
<p>
    REM *******************************
</p>
<p>
    Sub print_listener_printJobEvent(oPrintJobEvent)
</p>
<p>
    Dim bCleanup As Boolean ' Set to true if the listener should be removed. Dim sMessage$ ' If not empty, a message is
    printed.
</p>
<p>
    REM All supported event state changes are shown.
</p>
<p>
    Select Case oPrintJobEvent.State
</p>
<p>
    Case com.sun.star.view.PrintableState.JOB_STARTED
</p>
<p>
    ' Rendering the document to print. bCleanup = False Case com.sun.star.view.PrintableState.JOB_COMPLETED
</p>
<p>
    ' Rendering is finished, start spooling. bCleanup = False Case com.sun.star.view.PrintableState.JOB_SPOOLED
</p>
<p>
    ' Success!
</p>
<p>
    'sMessage = "Print job spooled to the printer." bCleanup = True
</p>
<p>
    Case com.sun.star.view.PrintableState.JOB_ABORTED sMessage = "Printing was aborted."
</p>
<p>
    bCleanup = True
</p>
<p>
    Case com.sun.star.view.PrintableState.JOB_FAILED sMessage = "Error printing."
</p>
<p>
    bCleanup = True
</p>
<p>
    Case com.sun.star.view.PrintableState.JOB_SPOOLING_FAILED sMessage = "Document failed to print or spool to the
    print." bCleanup = True Case Else
</p>
<p>
    sMessage = "Unknown unexpected print state."
</p>
<p>
    bCleanup = True
</p>
<p>
    End Select
</p>
<p>
    REM Remove the listener if printing is finished, then call a worker macro
</p>
<p>
    REM to set Sheet1 as active.
</p>
<p>
    If bCleanup AND NOT IsNull(oPrintJobListnerDoc) AND NOT IsEMpty(oPrintJobListnerDoc) Then On Error Resume Next Dim
    emptyObj
</p>
<p>
    oPrintJobListnerDoc.removePrintJobListener(oPrintListener)
</p>
<p>
    Call set_active_sheet(oPrintJobListnerDoc, "Sheet1")
</p>
<p>
    oPrintJobListnerDoc = emptyObj
</p>
<p>
    End If
</p>
<p>
    If sMessage &lt;&gt; "" Then
</p>
<p>
    MsgBox sMessage
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    If the sheet name exists, the desired sheet is set to be active, the print job listener is created and registered,
    and then document printing is requested. Listing 327. Print the specified sheet.
</p>
<p>
    Sub PrintSheet(oDoc, sSheetToPrint)
</p>
<p>
    Dim sPrefix$ ' Prefix used to identify the print listener routines. Dim sService$ ' Print listener service name.
</p>
<p>
    sPrefix = "print_listener_" sService = "com.sun.star.view.XPrintJobListener"
</p>
<p>
    If NOT oDoc.sheets().hasByName(sSheetToPrint) Then
</p>
<p>
    MsgBox "Document does not contain a sheet named " &amp; sSheetToPrint
</p>
<p>
    Exit sub
</p>
<p>
    End If
</p>
<p>
    Call set_active_sheet(oDoc, sSheetToPrint)
</p>
<p>
</p>
<p>
    oPrintListener = CreateUnoListener(sPrefix, sService) oDoc.addPrintJobListener(oPrintListener) oPrintJobListnerDoc =
    oDoc oDoc.Print(Array()) End Sub
</p>
<h2 id="print-examples-by-vincent-van-houtte">
    13.15.4. Print examples by Vincent Van Houtte
</h2>
<p>
    I found some very nice examples by Vincent Van Houtte, that he has graciously allowed me to reproduce here. Some
    highlights of the contained macros:
</p>
<ul>
    <li>
        printDoc – Print a document with specific paper size, with specific paper trays, and with (or without) a page
        background image. Numerous stub methods are included to call this one routine. Note that the method directly
        specifies the destination printer.
    </li>
    <li>
        printPage – Same as printDoc, but prints a single page.
    </li>
    <li>
        closeDocument – Close the specified document.
    </li>
    <li>
        ExportAsPdfAndSendEmail – Export as a PDF document and send an email.
    </li>
</ul>
<p>
    TIP The very popular routine FindCreateNumberFormatStyle (see Listing 391) is used by Listing 328.
</p>
<p>
    Listing 328. Print examples by Vincent Van Houtte.
</p>
<p>
    Sub PrintWithCopyStamp()
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro inserts a 'COPY'-stamp and prints the document
</p>
<p>
    ' without the background(-image) to tray1.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    REM Insert timestamp of sending Dim sActionText AS String sActionText = "KOPIE" InsertDTstamp(sActionText)
</p>
<p>
    REM Print the page
</p>
<p>
    PrintDocWithoutBgToTray1()
</p>
<p>
</p>
<p>
    REM Remove the copystamp-frame
</p>
<p>
    RemoveDTstamp()
</p>
<p>
    End Sub
</p>
<p>
    Sub InsertDTstamp(sActionText)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro inserts a 'DATE/TIME'-stamp with sActionText 'Printed' or 'Sent'
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2011)
</p>
<p>
    ' ----------------------------- DIM oCursor, oText, oDoc AS Object oDoc = ThisComponent oText = oDoc.getText()
    oCursor = oText.createTextCursor() oCursor.goToStart(FALSE)
</p>
<p>
    REM Create the date and time objects DIM oDate, oTime AS Object
</p>
<p>
    oDate = oDoc.createInstance("com.sun.star.text.TextField.DateTime") oDate.IsFixed = TRUE oDate.IsDate = TRUE
</p>
<p>
    oDate.NumberFormat = FindCreateNumberFormatStyle("D MMMM JJJJ", oDoc)
</p>
<p>
</p>
<p>
    oTime = oDoc.createInstance("com.sun.star.text.TextField.DateTime") oTime.IsFixed = True oTime.IsDate = False
    oTime.NumberFormat = FindCreateNumberFormatStyle("UU:MM", oDoc)
</p>
<p>
    REM Create the frame DIM oFrameDT AS Object
</p>
<p>
    oFrameDT = oDoc.createInstance("com.sun.star.text.TextFrame")
</p>
<p>
    With oFrameDT
</p>
<p>
    .setName("FrameDT")
</p>
<p>
    .AnchorType = com.sun.star.text.TextContentAnchorType.AT_PAGE
</p>
<blockquote>
    <p>
        .HoriOrient = com.sun.star.text.HoriOrientation.NONE
    </p>
</blockquote>
<blockquote>
    <p>
        .VertOrient = com.sun.star.text.VertOrientation.NONE
    </p>
</blockquote>
<blockquote>
    <p>
        .HoriOrientPosition = -4900
    </p>
</blockquote>
<blockquote>
    <p>
        .VertOrientPosition = -1600
    </p>
</blockquote>
<blockquote>
    <p>
        .width = 4000
    </p>
</blockquote>
<blockquote>
    <p>
        .height = 1500
    </p>
</blockquote>
<blockquote>
    <p>
        .BorderDistance = 100
    </p>
</blockquote>
<blockquote>
    <p>
        End With
    </p>
</blockquote>
<blockquote>
    <p>
        REM Insert the frame into the text document oText.insertTextContent( oCursor, oFrameDT, True )
    </p>
</blockquote>
<p>
    REM Write the text inside the frame DIM oCursor2 AS Object
</p>
<p>
    oCursor2 = oFrameDT.createTextCursor()
</p>
<p>
    With oCursor2
</p>
<p>
    .charHeight = 16
</p>
<p>
    .charWeight = com.sun.star.awt.FontWeight.BOLD
</p>
<p>
    .paraAdjust = com.sun.star.style.ParagraphAdjust.CENTER End With oFrameDT.insertString( oCursor2, sActionText, False
    )
</p>
<p>
    With oCursor2
</p>
<p>
    .charHeight = 9
</p>
<p>
    .charWeight = com.sun.star.awt.FontWeight.NORMAL .paraAdjust = com.sun.star.style.ParagraphAdjust.CENTER End With
</p>
<p>
    oFrameDT.insertControlCharacter( oCursor2, com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK, False )
    oFrameDT.insertTextContent( oCursor2, oDate, False )
</p>
<p>
    oFrameDT.insertControlCharacter( oCursor2, com.sun.star.text.ControlCharacter.LINE_BREAK, False )
</p>
<p>
    oFrameDT.insertTextContent( oCursor2, oTime, False )
</p>
<p>
    End Sub
</p>
<p>
    Sub RemoveDTstamp()
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro removes the 'DATE/TIME'-stamp created with the previous macro '
</p>
<p>
    ' Written by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM oDoc, oTextFrames, oFrameDT AS Object oDoc = ThisComponent
</p>
<p>
    REM Look for the datetimestamp-frame and remove it oTextFrames = oDoc.getTextFrames If
    oTextFrames.hasByName("FrameDT") Then oFrameDT = oTextFrames.getByName("FrameDT") oFrameDT.dispose()
</p>
<blockquote>
    <p>
        EndIf
    </p>
</blockquote>
<p>
    End Sub
</p>
<p>
    Sub PrintDocWithBgToTray1
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the document with the background(-image) to the
</p>
<p>
    ' first papertray. This is only used to save on stationary, if you
</p>
<p>
    ' have run out on stationary or if the second printertray is jammed ;)
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM sTray1 AS String
</p>
<p>
    DIM sTray2 AS String
</p>
<p>
    DIM bBg1 AS Boolean
</p>
<p>
    DIM bBg2 AS Boolean DIM wait AS Boolean sTray1 = "Tray1" sTray2 = "Tray1" bBg1 = True bBg2 = False wait = True
</p>
<p>
    printDoc(sTray1, sTray2, bBg1, bBg2, wait) End Sub
</p>
<p>
    Sub PrintDocWithoutBgToTray1
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the document without the background(-image) to the ' first papertray. This is useful for copies
    of the letters you sent out.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM sTray1 AS String
</p>
<p>
    DIM sTray2 AS String
</p>
<p>
    DIM bBg1 AS Boolean
</p>
<p>
    DIM bBg2 AS Boolean DIM wait AS Boolean sTray1 = "Tray1" sTray2 = "Tray1"
</p>
<blockquote>
    <p>
        bBg1 = False bBg2 = False wait = True
    </p>
</blockquote>
<p>
    printDoc(sTray1, sTray2, bBg1, bBg2, wait) End Sub
</p>
<p>
    Sub PrintDocWithoutBgToTray2_old ' ------------------------------
</p>
<p>
    ' This macro prints the document without the background(-image) to the ' second papertray. This is useful when you
    have pre-printed stationary: ' you can set an image as a background, that you don't want to print,
</p>
<p>
    ' but that you want to show up when converted to PDF.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<blockquote>
    <p>
        ' -----------------------------DIM sTray1 AS String
    </p>
</blockquote>
<blockquote>
    <p>
        DIM sTray2 AS String
    </p>
</blockquote>
<blockquote>
    <p>
        DIM bBg1 AS Boolean
    </p>
</blockquote>
<blockquote>
    <p>
        DIM bBg2 AS Boolean DIM wait AS Boolean sTray1 = "Tray2" sTray2 = "Tray1" bBg1 = False bBg2 = False wait = True
    </p>
</blockquote>
<p>
    printDoc(sTray1, sTray2, bBg1, bBg2, wait) End Sub
</p>
<p>
    Sub PrintDocWithoutBgToTray2
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the first page (without the backgroundimage) to the
</p>
<p>
    ' second papertray and all other pages (without the backgroundimage) to the
</p>
<p>
    ' first papertray.
</p>
<p>
    ' This is useful when you have pre-printed stationary, but want to save on it
</p>
<p>
    ' by only printing the first page on expensive stationary
</p>
<p>
    ' you can set an image as a background, that you don't want to print,
</p>
<p>
    ' but that you want to show up when converted to PDF.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM oDoc AS Object
</p>
<p>
    DIM iPageCount, n AS Integer DIM sPage AS String oDoc = ThisComponent
</p>
<p>
    REM Count the amount of pages iPageCount = oDoc.getCurrentController().getPropertyValue("PageCount")
</p>
<p>
    REM Loop over every page n = 1
</p>
<p>
    Do Until n &gt; iPageCount
</p>
<p>
</p>
<blockquote>
    <p>
        REM Print every page to the right tray
    </p>
</blockquote>
<p>
    If n = 1 Then
</p>
<p>
    Print_stat(n)
</p>
<p>
    Else
</p>
<p>
    Print_plain(n) End If n = n + 1
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<p>
    Sub Print_stat(sPageNr AS String)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the first page without the background(-image) to the ' second papertray. This is useful when you
    have pre-printed stationary:
</p>
<p>
    ' you can set an image as a background, that you don't want to print,
</p>
<p>
    ' but that you want to show up when converted to PDF.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM sTray1 AS String
</p>
<p>
    DIM sTray2 AS String
</p>
<p>
    DIM bBg1 AS Boolean
</p>
<p>
    DIM bBg2 AS Boolean DIM wait AS Boolean sTray1 = "Tray2" sTray2 = "Tray1" bBg1 = False bBg2 = False wait = True
</p>
<p>
    printPage(sTray1, sTray2, bBg1, bBg2, wait, sPageNr)
</p>
<p>
    End Sub
</p>
<p>
    Sub Print_plain(sPageNr AS String)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the next page without the background(-image) to the
</p>
<p>
    ' first papertray. This is useful when you want to saveon your pre-printed stationary: ' you can set an image as a
    background, that you don't want to print,
</p>
<p>
    ' but that you want to show up when converted to PDF.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM sTray1 AS String
</p>
<p>
    DIM sTray2 AS String
</p>
<p>
    DIM bBg1 AS Boolean
</p>
<p>
    DIM bBg2 AS Boolean DIM wait AS Boolean sTray1 = "Tray1" sTray2 = "Tray1" bBg1 = False bBg2 = False wait = True
</p>
<p>
    printPage(sTray1, sTray2, bBg1, bBg2, wait, sPageNr) End Sub
</p>
<p>
    Sub printDoc(sTray1, sTray2, bBg1, bBg2, wait)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the document given the chosen arguments
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ----------------------------- DIM oDoc AS Object oDoc = ThisComponent
</p>
<p>
    REM Set backgroundImage-option in DocumentSettings to False DIM oSettings AS Object
</p>
<p>
    oSettings = oDoc.createInstance("com.sun.star.text.DocumentSettings")
</p>
<p>
    oSettings.PrintPageBackground = bBg1
</p>
<blockquote>
    <p>
        REM choose a certain printer
    </p>
</blockquote>
<blockquote>
    <p>
        DIM mPrinterOpts(2) AS NEW com.sun.star.beans.PropertyValue mPrinterOpts(0).Name = "Name" mPrinterOpts(0).Value
        = "MFC8880DN" mPrinterOpts(1).Name = "PaperFormat"
    </p>
</blockquote>
<blockquote>
    <p>
        mPrinterOpts(1).Value = com.sun.star.view.PaperFormat.A4 mPrinterOpts(2).Name = "PaperOrientation"
    </p>
</blockquote>
<blockquote>
    <p>
        mPrinterOpts(2).Value = com.sun.star.view.PaperOrientation.PORTRAIT oDoc.Printer = mPrinterOpts()
    </p>
</blockquote>
<p>
    REM set Papertray in Styles DIM oStyle AS Object DIM sPageStyle AS String
</p>
<p>
    sPageStyle = oDoc.CurrentController.getViewCursor().PageStyleName ostyle =
    oDoc.StyleFamilies.getByName("PageStyles").getByName(sPageStyle) oStyle.PrinterPaperTray = sTray1
</p>
<p>
    REM Set printOptions
</p>
<p>
    DIM mPrintOpts(2) AS NEW com.sun.star.beans.PropertyValue mPrintOpts(0).Name = "CopyCount" mPrintOpts(0).Value = 1
    mPrintOpts(1).Name = "Collate" mPrintOpts(1).Value = True mPrintOpts(2).Name = "Wait" mPrintOpts(2).Value = True
</p>
<p>
    REM Print oDoc.Print(mPrintOpts())
</p>
<p>
    REM RESET OPTIONS
</p>
<p>
    REM Reset backgroundImage-option in DocumentSettings
</p>
<p>
    oSettings.PrintPageBackground = bBg2 REM Reset Papertray in Styles oStyle.PrinterPaperTray = sTray2
</p>
<p>
    REM Do a 0-print to complete the reset
</p>
<p>
    DIM mPrintOpts2(0) AS NEW com.sun.star.beans.PropertyValue mPrintOpts2(0).Name = "CopyCount" mPrintOpts2(0).Value =
    0
</p>
<p>
    oDoc.Print(mPrintOpts2()) End Sub
</p>
<p>
    Sub printPage(sTray1, sTray2, bBg1, bBg2, wait, sPageNr)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the document given the chosen arguments
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ----------------------------- DIM oDoc AS Object oDoc = ThisComponent
</p>
<p>
    REM Set backgroundImage-option in DocumentSettings to False
</p>
<p>
    DIM oSettings AS Object
</p>
<p>
    oSettings = oDoc.createInstance("com.sun.star.text.DocumentSettings") oSettings.PrintPageBackground = bBg1
</p>
<p>
    REM choose a certain printer
</p>
<p>
    DIM mPrinterOpts(3) AS NEW com.sun.star.beans.PropertyValue mPrinterOpts(0).Name = "Name" mPrinterOpts(0).Value =
    "MFC8880DN" mPrinterOpts(1).Name = "PaperFormat"
</p>
<p>
    mPrinterOpts(1).Value = com.sun.star.view.PaperFormat.A4 mPrinterOpts(2).Name = "PaperOrientation"
</p>
<p>
    mPrinterOpts(2).Value = com.sun.star.view.PaperOrientation.PORTRAIT oDoc.Printer = mPrinterOpts()
</p>
<p>
    REM set Papertray in Styles
</p>
<p>
    DIM oStyle AS Object DIM sPageStyle AS String
</p>
<p>
    sPageStyle = oDoc.CurrentController.getViewCursor().PageStyleName ostyle =
    oDoc.StyleFamilies.getByName("PageStyles").getByName(sPageStyle) oStyle.PrinterPaperTray = sTray1
</p>
<p>
    REM Set printOptions
</p>
<p>
    DIM mPrintOpts(3) AS NEW com.sun.star.beans.PropertyValue mPrintOpts(0).Name = "CopyCount" mPrintOpts(0).Value = 1
    mPrintOpts(1).Name = "Collate" mPrintOpts(1).Value = True mPrintOpts(2).Name = "Pages" mPrintOpts(2).Value = sPageNr
    mPrintOpts(3).Name = "Wait" mPrintOpts(3).Value = True
</p>
<p>
    REM Print oDoc.Print(mPrintOpts())
</p>
<p>
    REM RESET OPTIONS
</p>
<p>
    REM Reset backgroundImage-option in DocumentSettings oSettings.PrintPageBackground = bBg2
</p>
<blockquote>
    <p>
        REM Reset Papertray in Styles oStyle.PrinterPaperTray = sTray2
    </p>
</blockquote>
<p>
    REM Do a 0-print to complete the reset
</p>
<p>
    DIM mPrintOpts2(0) AS NEW com.sun.star.beans.PropertyValue mPrintOpts2(0).Name = "CopyCount" mPrintOpts2(0).Value =
    0 oDoc.Print(mPrintOpts2())
</p>
<p>
    End Sub
</p>
<p>
    Sub closeDocument(oDoc AS Object)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro closes the current document
</p>
<p>
    '
</p>
<p>
    ' Written by Andrew Pitonyak (2010)
</p>
<p>
    ' Adapted by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    REM Check if the document exists
</p>
<p>
    If IsNull(oDoc) Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    REM Store the document if it was modified
</p>
<p>
    If (oDoc.isModified) Then
</p>
<p>
    If (oDoc.hasLocation AND (Not oDoc.isReadOnly)) Then oDoc.store() Else
</p>
<p>
    oDoc.setModified(False)
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM Close the document oDoc.close(true) End Sub
</p>
<p>
    Sub ExportAsPdfAndSendEmail
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro converts the active document to PDF and then adds the PDF
</p>
<p>
    ' to a new emailmessage. The recipientaddress and subject are ' generated automagically from a textfield inside the
    document
</p>
<p>
    '
</p>
<p>
    ' This macro assumes the default email application is set ' in Tools -&gt; Options -&gt; OpenOffice.org -&gt;
    External Programs.
</p>
<p>
    '
</p>
<p>
    ' This macro uses SimpleCommandMail, which might not work in windows
</p>
<p>
    ' Try SimpleSystemMail instead
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM oDoc, MailClient, MailAgent, MailMessage AS Object DIM sDocURL, sPDFURL, sTo, sSubject AS String
</p>
<p>
    REM Get location of the doc oDoc = ThisComponent
</p>
<p>
    If (Not oDoc.hasLocation()) Then oDoc.store()
</p>
<p>
    End if
</p>
<p>
    REM Insert timestamp of sending Dim sActionText AS String sActionText = "VERZONDEN" InsertDTstamp(sActionText)
</p>
<p>
    REM Print the page
</p>
<p>
    PrintDocWithoutBgToTray1()
</p>
<p>
    REM Replace .odt with .pdf
</p>
<p>
    sDocURL = oDoc.getURL() sPDFURL = Left$(sDocURL,Len(sDocURL)-4) + ".pdf"
</p>
<p>
    REM Save as PDF
</p>
<p>
    DIM args(0) AS NEW com.sun.star.beans.PropertyValue args(0).Name = "FilterName" args(0).Value = "writer_pdf_Export"
    oDoc.storeToURL(sPDFURL,args())
</p>
<p>
    REM Remove the Date/time-stamp
</p>
<p>
    RemoveDTstamp()
</p>
<p>
    REM Get the values of the textfields inside the document to form the subject line
</p>
<p>
    DIM enuTF, aTextField AS Object
</p>
<p>
    DIM sDosName, sDosNum, sDosUref AS String enuTF = oDoc.TextFields.createEnumeration Do While enuTF.hasMoreElements
    aTextField = enuTF.nextElement
</p>
<p>
    if aTextField.supportsService("com.sun.star.text.TextField.Input") then Select Case
    aTextField.getPropertyValue("Hint")
</p>
<p>
    Case "DOS_NAAM":
</p>
<p>
    sDosName = aTextField.getPropertyValue("Content")
</p>
<p>
    Case "DOS_NUM":
</p>
<p>
    sDosNum = aTextField.getPropertyValue("Content")
</p>
<p>
    Case "REF_O":
</p>
<p>
    sDosNum = aTextField.getPropertyValue("Content")
</p>
<p>
    Case "UREF": sDosUref = aTextField.getPropertyValue("Content")
</p>
<p>
    Case "EMAIL_ADDR": sTo = aTextField.getPropertyValue("Content")
</p>
<p>
    End Select end if Loop sSubject = sDosName + " - " + sDosUref + " - " + sDosNum
</p>
<p>
    REM Send the PDF as an attachment
</p>
<blockquote>
    <p>
        MailAgent = CreateUnoService("com.sun.star.system.SimpleCommandMail") MailClient =
        MailAgent.querySimpleMailClient()
    </p>
</blockquote>
<p>
    MailMessage=MailClient.createSimpleMailMessage()
</p>
<p>
    MailMessage.setRecipient(sTo)
</p>
<p>
    MailMessage.setSubject(sSubject)
</p>
<p>
    MailMessage.setAttachement(array(sPDFURL)) MailClient.sendSimpleMailMessage(MailMessage, 0)
</p>
<p>
    REM Save and close the document closeDocument(oDoc)
</p>
<p>
    End Sub
</p>
<h1 id="creating-services">
    13.16. Creating services
</h1>
<p>
    An object that supports the XMultiServiceFactory interface may create services. An object is usually created by the
    object that will own it. As an example, a text table is created by the text document that will contain the text
    table. Similarly, the DocumentSettings object is created by the document of interest. The function CreateUnoService
    creates services in the scope of the OOo application.
</p>
<p>
    The oSettings object in Listing 329 supports the service com.sun.star.text.DocumentSettings. The oSettings object is
    related to ThisComponent in that it reflects the settings for ThisComponent — the current document — but not for any
    other document. Listing 329. Create an object that supports the DocumentSettings service.
    oSettings=ThisComponent.createInstance("com.sun.star.text.DocumentSettings")
</p>
<p>
    The createInstance() method returns an object that supports the requested service if it can; if it cannot, it
    returns NULL. The returned object may support other services as well (see Listing 318 and Figure 93). Listing 330.
    Inspect a text document settings object.
</p>
<p>
    Sub WriteDocumentSettings
</p>
<p>
    Dim oSettings 'Settings object to create
</p>
<p>
    Dim s$ 'Utility string
</p>
<p>
    Dim i% 'Uitlity index variable
</p>
<p>
    Dim v 'This will contain an array of service names
</p>
<p>
    REM Create an object that supports the DocumentSettings service
</p>
<p>
    oSettings=ThisComponent.createInstance("com.sun.star.text.DocumentSettings")
</p>
<p>
    v = oSettings.getSupportedServiceNames()
</p>
<p>
    s = "**** Specified Supported Services ****" &amp; CHR$(10) &amp; Join(v, CHR$(10)) s = s &amp; CHR$(10) &amp;
    CHR$(10) &amp; "**** Tested Services ****" &amp; CHR$(10)
</p>
<p>
    REM Now check to see if this created object supports any other services. v =
    Array("com.sun.star.comp.Writer.DocumentSettings",_
</p>
<p>
    "com.sun.star.text.PrintSettings")
</p>
<p>
</p>
<p>
    For i = 0 To UBound(v)
</p>
<p>
    If oSettings.supportsService(v(i)) Then s = s &amp; "Supports service " &amp; v(i) &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Some services for " &amp; oSettings.getImplementationName()
</p>
<p>
    REM What is the status of the PrintControls property? Print oSettings.PrintControls
</p>
<p>
</p>
<p>
    REM I could set this to True or False
</p>
<p>
    'oSettings.Printcontrols = True
</p>
<p>
    End Sub
</p>
<blockquote>
    <p>
        <img src="media/image12.jpg" style="width:4.96468in;height:2.06693in" />
    </p>
</blockquote>
<p>
    Figure 93. Some Writer document settings.
</p>
<p>
    A careful inspection of Listing 330 and Figure 93 demonstrate that the object supports multiple services.
</p>
<p>
    The method getSupportedServiceNames() lists the services supported by the object.
</p>
<p>
    The method getImplementationName() returns the service that uniquely identifies the returned service
    (com.sun.star.comp.Writer.DocumentSettings). The unique service name is not in the list of supported service names.
</p>
<p>
    Although not shown in Listing 330, the two “Tested Services” in Figure 93 cannot be created using the
    createInstance() object method. I discovered the PrintSettings service entirely by accident. I inspected the
    dbg_properties property, which contained PrintControls. I then searched Google for “site:api.openoffice.org
    PrintSettings”. The important things to notice are as follows:
</p>
<ol type="1">
    <li>
        There are different methods of inspecting an object; use all of them.
    </li>
    <li>
        The documentation is not complete. You must manually inspect an object to see what it supports. However,
        undocumented methods and properties may be deprecated and removed later — so do this carefully.
    </li>
    <li>
        You can search the Internet for services and properties.
    </li>
</ol>
<h1 id="document-settings">
    13.17. Document settings
</h1>
<p>
    OOo contains numerous document options; these are available in the Tools | Options dialog. For example, Text
    Document contains a Print tab, which allows graphics to be printed, or not. The typical method for modifying
    properties in a document involves using either “get” and “set” methods, or directly accessing object properties. To
    access advanced document settings, however, you must use a completely different method. First the document has to
    create an object that supports the document settings. Every document type, except for the Math type, has the ability
    to create a service using the createInstance() method. Table 119 contains a list of the properties common to all of
    the document setting types; there are more.
</p>
<p>
    Table 119. Common document properties in com.sun.star.document.Settings.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                ForbiddenCharacters
            </td>
            <td>
                Allow access to otherwise forbidden characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LinkUpdateMode
            </td>
            <td>
                The update mode for links when loading text documents.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrinterName
            </td>
            <td>
                Printer used by the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                PrinterSetup
            </td>
            <td>
                Platform- and driver-dependent printer setup data.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsKernAsianPunctuation
            </td>
            <td>
                Is kerning applied to Asian punctuation?
            </td>
        </tr>
        <tr class="even">
            <td>
                CharacterCompressionType
            </td>
            <td>
                Compression (character spacing) used for Asian characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ApplyUserData
            </td>
            <td>
                Should user-specific settings saved in a document be loaded again?
            </td>
        </tr>
        <tr class="even">
            <td>
                SaveVersionOnClose
            </td>
            <td>
                Is a new version created when a modified document is closed?
            </td>
        </tr>
        <tr class="odd">
            <td>
                UpdateFromTemplate
            </td>
            <td>
                Should a document be updated when its creation template changes?
            </td>
        </tr>
        <tr class="even">
            <td>
                FieldAutoUpdate
            </td>
            <td>
                Are text document fields automatically updated?
            </td>
        </tr>
        <tr class="odd">
            <td>
                CurrentDatabaseDataSource
            </td>
            <td>
                Name of the data source from which the current data is taken.
            </td>
        </tr>
        <tr class="even">
            <td>
                CurrentDatabaseCommand
            </td>
            <td>
                Displayed object’s name (or the SQL statement used).
            </td>
        </tr>
        <tr class="odd">
            <td>
                CurrentDatabaseCommandType
            </td>
            <td>
                Specifies how to interpret the DataTableName property.
            </td>
        </tr>
        <tr class="even">
            <td>
                DefaultTabStop
            </td>
            <td>
                Default tab width.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsPrintBooklet
            </td>
            <td>
                Is the document printed as a booklet (brochure)?
            </td>
        </tr>
        <tr class="even">
            <td>
                IsPrintBookletFront
            </td>
            <td>
                If True, only the front pages of a booklet are printed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsPrintBookletBack
            </td>
            <td>
                If True, only the back pages of a booklet are printed.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintQuality
            </td>
            <td>
                Quality to use when printing.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ColorTableURL
            </td>
            <td>
                URL of the color table (SOC file) showing a palette in dialogs that use colors.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrinterIndependentLayout
            </td>
            <td>
                If true, do not use printer metrics for layout.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Specific document settings services exist for Writer, Calc, Draw, and Impress documents (see Table 120). Although
    each of these services implements the Settings service as shown in Table 119, all of the properties except for
    PrinterName and PrinterSetup are optional.
</p>
<p>
    Table 120. Specific document settings service types.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Document Settings Service
            </td>
            <td>
                Document Type
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.DocumentSettings
            </td>
            <td>
                Writer
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.DocumentSettings
            </td>
            <td>
                Calc
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.drawing.DocumentSettings
            </td>
            <td>
                Draw
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.presentation.DocumentSettings
            </td>
            <td>
                Impress
            </td>
        </tr>
    </tbody>
</table>
<p>
    As shown in Listing 330 and Figure 93, the Writer document settings support the PrintSettings service (see Table
    121). The Draw and Impress document settings services each contain special settings that apply only to their
    respective document types.
</p>
<p>
    Table 121. Properties defined by the com.sun.star.text.PrintSettings service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintGraphics
            </td>
            <td>
                If True, print graphic object.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintTables
            </td>
            <td>
                If True, print text tables.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintDrawings
            </td>
            <td>
                If True, print shapes.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintLeftPages
            </td>
            <td>
                If True, print left pages.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintRightPages
            </td>
            <td>
                If True, print right pages.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintControls
            </td>
            <td>
                If True, print control contained in the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintReversed
            </td>
            <td>
                If True, print the pages in reverse order, starting with the last page.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintPaperFromSetup
            </td>
            <td>
                If True, use the paper tray specified for the system printer. If False, use the paper tray specified by
                the page style.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintFaxName
            </td>
            <td>
                Name of the fax.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintAnnotationMode
            </td>
            <td>
                Specify how notes are printed. Uses com.sun.star.text.NotePrintMode enumerated value. Possible values
                include NOT, ONLY, DOC_END, or PAGE_END.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintProspect
            </td>
            <td>
                If True, prospect printing is used; however, I cannot find a definition for prospect printing.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintPageBackground
            </td>
            <td>
                If True, the background color and/or background graphic is printed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintBlackFonts
            </td>
            <td>
                If True, characters are always printed in black.
            </td>
        </tr>
    </tbody>
</table>
<h1 id="the-coolest-trick-i-know">
    13.18. The coolest trick I know
</h1>
<p>
    Sadly, this only works in LibreOffice, and not in OOo. While editing a document:
</p>
<ol type="1">
    <li>
        Use File &gt; Open to open the Open dialog.
    </li>
    <li>
        Enter “vnd.sun.star.tdoc:/” for the file name and click Open.
    </li>
    <li>
        Currently open documents are shown for selection. Select a document; and click open.
    </li>
</ol>
<p>
    You are looking at the document's internal structures. You can even open an image embedded in a document. A document
    containing pictures is a good example to try.
</p>
<h1 id="converting-to-a-url-in-other-languages">
    13.19. Converting to a URL in other languages
</h1>
<p>
    Basic provides the methods ConvertToURL and ConvertFromURL, other languages do not. Some URI schemes leave
    unspecified important aspects of how to interpret URIs of those schemes. For example, it is unspecified for “file”
    URLs how to map the byte sequences that constitute the path segments of a “file” URL to filenames on a given
    platform: The UNO environment always assumes that path segments of “file” URLs represent UTF-8–encoded strings
    (which have to be mapped to filenames in a platform-specific way), while other applications typically assume that
    path segments of “file” URLs directly represent a platform's bytesequence filenames. The
    ExternalUriReferenceTranslator offers methods to translate between such internal URIs (e.g., UTF-8–encoded “file”
    URLs used within the UNO environment) and external URIs (e.g., bytesequence–oriented “file” URLs used by other
    applications). Typically, only “file” URLs are affected by this translation.
</p>
<p>
    x = CreateUnoService("com.sun.star.uri.ExternalUriReferenceTranslator")
</p>
<p>
    Print x.translateToExternal("file:///c:/MyDoc.oot")
</p>
<p>
    Print x.translateToInternal("file:/c:/MyDoc.oot")
</p>
<h1 id="conclusion">
    13.20. Conclusion
</h1>
<p>
    The interfaces and services introduced in this chapter provide a good introduction to the capabilities of OOo that
    are not directly related to a specific document type. OOo contains numerous other capabilities that I could have
    included in this chapter, but it isn’t possible to exhaustively cover every subject. Use these topics and methods as
    a starting point to investigate the other capabilities of OpenOffice.org.
</p>