<ol start="10" type="1">
	<li>
		<p>
		Universal Network Objects 
		</p>
	</li>
</ol>
<blockquote>
	<p>
	The internals of OpenOffice.org are based on Universal Network Objects (UNO). This chapter introduces the subroutines and functions supported by OpenOffice.org Basic that are related to UNO. This chapter covers methods that create and inspect objects that are vital to the internals of OpenOffice.org.  
	</p>
	<p>
	Up to this point, I have mostly dealt with simple single value things such as string and integer. An object, however, usually contains many values and it also has methods; for example, you can access a document as a variable and access information about the document (data or properties), and call methods that manipulate the document.  
	</p>
	<p>
	In this chapter, I begin to discuss things related to the actual implementation of OOo — things that allow you to exploit the internal capabilities of OOo. You’ll also begin to see more details about how OOo is implemented — which you need to build the really cool stuff.  
	</p>
	<p>
	Are you a programmer or a highly technical person? If not, skip this paragraph and go directly to the tip. Still reading? Great, so UNO is: 
	</p>
</blockquote>
<ul>
	<li>
		<p>
		The interface based component model for OOo.  
		</p>
	</li>
	<li>
		<p>
		Enables interoperability between programming languages, object models and hardware architectures, either in process or over process boundaries, as well as in the intranet or the Internet.  
		</p>
	</li>
	<li>
		<p>
		New languages are supported by adding a language binding. This is also stated as adding a “bridge” or “adapter”. This paradigm makes it easier to support multiple languages.  
		</p>
	</li>
	<li>
		<p>
		UNO components may be implemented in, and accessed from, any programming language with a complete language binding.  
		</p>
	</li>
</ul>
<blockquote>
	<p>
	<strong>TIP</strong> You can write powerful macros without fully understand Universal Network Objects. Just think of a UNO as any object that is used internally by OOo.  
	</p>
	<p>
	Stated more simply: The internal parts of OOo are used as Universal Network Objects. By using UNOs, it is possible to access an instance of OOo running on a different computer and operating system. A vague understanding of Universal Network Objects is important because most of the internals of OpenOffice.org are implemented using UNO.  
	</p>
	<p>
	Table 88 lists the OOo Basic functions used to deal with UNO.  
	</p>
	<p>
	<em> <strong>Table 88.</strong> Functions related to Universal Network Objects in OOo Basic.</em> 
	</p>
</blockquote>
<table border="1">
	<colgroup> <col style="width: 50%" /> <col style="width: 49%" /> </colgroup> 
	<thead>
		<tr class="header">
			<th>
				<blockquote>
					<p>
					<em> <strong>Function</strong> </em> 
					</p>
				</blockquote>
			</th>
			<th>
				<blockquote>
					<p>
					<em> <strong>Description</strong> </em> 
					</p>
				</blockquote>
			</th>
		</tr>
	</thead> <tbody> 
		<tr class="odd">
			<td>
				BasicLibraries 
			</td>
			<td>
				<blockquote>
					<p>
					Access Basic libraries stored in a document.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				CreateObject(obj_type) 
			</td>
			<td>
				<blockquote>
					<p>
					Able to create any standard type, more flexible than CreateUnoStruct and CreateUnoService.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				CreateUnoDialog() 
			</td>
			<td>
				<blockquote>
					<p>
					Create an existing dialog.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				CreateUnoListener() 
			</td>
			<td>
				<blockquote>
					<p>
					Create a listener.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				CreateUnoService() 
			</td>
			<td>
				<blockquote>
					<p>
					Create a Universal Network Object Service.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				CreateUnoStruct() 
			</td>
			<td>
				<blockquote>
					<p>
					Create a Universal Network Object Structure.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				CreateUnoValue() 
			</td>
			<td>
				<blockquote>
					<p>
					Create a Universal Network Object value.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				DialogLibraries 
			</td>
			<td>
				<blockquote>
					<p>
					Access dialog libraries stored in a document.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				EqualUNOObjects() 
			</td>
			<td>
				<blockquote>
					<p>
					Determine if two UNO objects reference the same instance.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				<em>FindObject()</em> 
			</td>
			<td>
				<blockquote>
					<p>
					<em>Find a named object; do not use.</em> 
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				<em>FindPropertyObject()</em> 
			</td>
			<td>
				<blockquote>
					<p>
					<em>Find object property based on name; do not use.</em> 
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				GetDefaultContext() 
			</td>
			<td>
				<blockquote>
					<p>
					Get a copy of the default context.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				GetProcessServiceManager() 
			</td>
			<td>
				<blockquote>
					<p>
					Get service manager.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				GlobalScope 
			</td>
			<td>
				<blockquote>
					<p>
					Application-level libraries.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				HasUnoInterfaces() 
			</td>
			<td>
				<blockquote>
					<p>
					Does an object support specified interfaces?  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				IsUnoStruct() 
			</td>
			<td>
				<blockquote>
					<p>
					Is this variable a Universal Network Object?  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				StarDesktop 
			</td>
			<td>
				<blockquote>
					<p>
					Special variable representing the desktop object.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				ThisComponent 
			</td>
			<td>
				<blockquote>
					<p>
					Special variable representing the current document.  
					</p>
				</blockquote>
			</td>
		</tr>
	</tbody> 
</table>
<h2 id="base-types-and-structures">
	<em>Base types and structures</em> 
</h2>
<blockquote>
	<p>
	Most of the internal data used by OOo is based on standard types such as strings and numbers. These types are combined into structures (called structs), which act like user-defined data types. The structures are combined to form more complex UNO objects. A struct supports properties but not methods.  
	</p>
	<p>
	A structure provides a method of placing more than one value into a single variable. You access the values in a structure based on a name that is decided when the struct type is designed by a programmer. A commonly used struct is the PropertyValue, whose primary purpose is to hold a string name and a variant value. The following listing demonstrates creating a PropertyValue structure and then setting the name and the value.  
	</p>
	<p>
	The contained properties are accessed by placing a period between the variable and the property name.  
	</p>
	<p>
	<em> <strong>Listing 203.</strong> Use Dim As New to create a UNO structure.</em> 
	</p>
	<p>
	Dim aProp As New com.sun.star.beans.PropertyValue aProp.Name = "FirstName" 'Set the Name property aProp.Value = "Paterton" 'Set the Value property 
	</p>
	<p>
	<strong>TIP</strong> OOo objects have long names such as com.sun.star.beans.PropertyValue; in the text I usually abbreviate the name and simply write PropertyValue, but your macros must use the full name.  
	</p>
	<p>
	You must create (or obtain) a UNO structure before you can use it.  The most common method to create a UNO structure is to use Dim As New (see Listing 203). You can also use Dim to create an array of structures.  
	</p>
	<p>
	<em> <strong>Listing 204.</strong> Use Dim As New to create an array of UNO structures.</em> 
	</p>
	<p>
	Dim aProp(4) As New com.sun.star.beans.PropertyValue aProp(0).Name = "FirstName" 'Set the Name property aProp(0).Value = "Clyde" 'Set the Value property 
	</p>
	<p>
	Use the CreateUnoStruct function to create a UNO structure when it is needed rather than declare it ahead of time. Dynamically creating a UNO structure allows the name of the structure to be provided at run time rather than compile time. Providing a name at run time is shown in Listing 205 and Listing 208. Providing a name at compile time is shown in Listing 203.  
	</p>
	<p>
	<em> <strong>Listing 205.</strong> Use CreateUnoStruct to create a UNO structure.</em> 
	</p>
	<p>
	Dim aProp 
	</p>
	<p>
	aProp = CreateUnoStruct("com.sun.star.beans.PropertyValue") aProp.Name = "FirstName" 'Set the Name property aProp.Value = "Andrew" 'Set the Value property 
	</p>
	<p>
	The With statement simplifies the process of setting the properties of a structure.  
	</p>
	<p>
	<em> <strong>Listing 206.</strong> Use With to simplify setting properties on structures.</em> 
	</p>
	<p>
	Dim aProp(4) As New com.sun.star.beans.PropertyValue With aProp(0) 
	</p>
	<p>
	.Name = "FirstName" 'Set the Name property 
	</p>
	<p>
	.Value = "Paterton" 'Set the Value property End With 
	</p>
	<p>
	The function CreateUnoStruct used to be the only method to create a UNO structure. It is used less since the introduction of the “Dim As New” syntax. The CreateObject function is a more general function than CreateUnoStruct. It is able to create instances of all types supported by the Basic internal factory mechanism. This includes user-defined types.  
	</p>
	<p>
	<em> <strong>Listing 207.</strong> Create a user-defined type with CreateObject or Dim As.</em> 
	</p>
	<p>
	Type PersonType FirstName As String LastName As String 
	</p>
	<p>
	End Type 
	</p>
	<p>
	Sub ExampleCreateNewType Dim Person As PersonType 
	</p>
	<p>
	Person.FirstName = "Andrew" Person.LastName = "Pitonyak" PrintPerson(Person) 
	</p>
	<p>
	Dim Me As Object 
	</p>
	<p>
	Me = CreateObject("PersonType") Me.FirstName = "Andy" Me.LastName = "Pitonyak" PrintPerson(Me) 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	Sub PrintPerson(x) 
	</p>
	<p>
	Print "Person = " &amp; x.FirstName &amp; " " &amp; x.LastName End Sub 
	</p>
	<p>
	<strong>TIP</strong> For a user-defined type, “Dim As New” and “Dim As” both work. For a UNO struct, however, you must use “Dim As New”.  
	</p>
	<p>
	The CreateObject function accepts the same arguments as CreateUnoStruct, but it works for all supported types, whereas CreateUnoStruct works only for UNO structures. Therefore, there is no reason to use CreateUnoStruct rather than CreateObject.  
	</p>
	<p>
	<em> <strong>Listing 208.</strong> Use CreateObject to create a UNO structure.</em> 
	</p>
	<p>
	Dim aProp 
	</p>
	<p>
	aProp = CreateObject("com.sun.star.beans.PropertyValue") aProp.Name = "FirstName" 'Set the Name property aProp.Value = "Paterton" 'Set the Value property 
	</p>
	<p>
	<strong>TIP</strong> CreateObject offers more flexibility than CreateUnoStruct to dynamically create objects based on a name.  
	</p>
	<p>
	I wrote a small test program that created 20000 structs.  CreateUnoStruct and CreateObject took about the same amount of time.  Using Dim As New, however, used 500 clock ticks less, which is useful if you want to make a macro run as fast as possible.  
	</p>
	<p>
	The TypeName function indicates that a UNO structure is an object.  Use the IsUnoStruct function to determine if a variable is a UNO structure.  
	</p>
	<p>
	<em> <strong>Listing 209.</strong> Use IsUnoStruct to check if an object is an UNO Struct.</em> 
	</p>
	<p>
	Dim aProp As New com.sun.star.beans.PropertyValue Print TypeName(aProp) 'Object 
	</p>
	<p>
	Print IsUnoStruct(aProp) 'True 
	</p>
</blockquote>
<h2 id="uno-interface">
	<em>UNO interface</em> 
</h2>
<blockquote>
	<p>
	An interface defines how something interacts with its environment. A UNO interface resembles a group of subroutine and function declarations; arguments and return types are specified along with functionality.  
	</p>
	<p>
	You can use the interface to retrieve data from an object, set data in an object, or tell an object to do something. The interface indicates how an object can be used, but it says nothing about the implementation.  For example, if an interface contains the method GetHeight that returns an integer, it’s natural to assume that the object contains an integer property named Height. It’s possible, however, that the height is derived or calculated from other properties. The interface does not specify how the height is obtained, just that it is available. A UNO structure, however, contains properties that are accessed directly; the internal representation is not hidden.  
	</p>
	<p>
	<strong>TIP</strong> UNO interface names start with the capital letter X.  
	</p>
	<p>
	When you want to know what methods are supported by an object, check the interfaces.  
	</p>
	<p>
	UNO interface names start with the capital letter X, which makes it easy to recognize an interface; for example, the interface com.sun.star.text.XTextRange specifies a section of text with both a start and end position. Objects that support the XTextRange interface are also used to identify an object’s position in text document. The start and end positions may be the same. The XTextRange interface defines the methods in Table 89.  
	</p>
	<p>
	<em> <strong>Table 89.</strong> Methods defined by the com.sun.star.text.XTextRange interface.</em> 
	</p>
</blockquote>
<table border="1">
	<colgroup> <col style="width: 24%" /> <col style="width: 75%" /> </colgroup> 
	<thead>
		<tr class="header">
			<th>
				<blockquote>
					<p>
					<em> <strong>Method</strong> </em> 
					</p>
				</blockquote>
			</th>
			<th>
				<blockquote>
					<p>
					<em> <strong>Description</strong> </em> 
					</p>
				</blockquote>
			</th>
		</tr>
	</thead> <tbody> 
		<tr class="odd">
			<td>
				getText() 
			</td>
			<td>
				<blockquote>
					<p>
					Return the com.sun.star.text.XText interface that contains this XTextRange.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				getStart() 
			</td>
			<td>
				<blockquote>
					<p>
					Return a com.sun.star.text.XTextRange that references only the start position.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				getEnd() 
			</td>
			<td>
				<blockquote>
					<p>
					Return a com.sun.star.text.XTextRange that references only the end position.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				getString() 
			</td>
			<td>
				<blockquote>
					<p>
					Return a string that includes the text inside this text range.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				setString(str) 
			</td>
			<td>
				<blockquote>
					<p>
					Set the string for this text range, replacing existing text and clearing all styles.  
					</p>
				</blockquote>
			</td>
		</tr>
	</tbody> 
</table>
<blockquote>
	<p>
	<strong>TIP</strong> A UNO interface may be derived from another.  Every UNO interface is required to be derived from com.sun.star.uno.XInterface.  
	</p>
	<p>
	A new UNO interface may be derived from another. This is not something that you do, but rather it’s something that is done by the designer of the interface. The derived interface supports all of the methods defined in the interface from which it is derived. For example, the com.sun.star.text.XTextCursor extends the XTextRange interface to allow it to change the range, which makes sense if you think about what you do with a cursor. Any object that implements the XTextCursor interface, supports the methods in Table 89 and the new methods introduced by the XTextCursor interface.  
	</p>
	<p>
	The main points regarding interfaces (so far) are: 
	</p>
</blockquote>
<ol type="1">
	<li>
		<p>
		An interface defines methods. In other words, an interface defines what an object can do; including getting and setting internal properties.  
		</p>
	</li>
	<li>
		<p>
		An interface may be derived from another interface.  
		</p>
	</li>
	<li>
		<p>
		The last portion of an interface name begins with an X.  
		</p>
	</li>
</ol>
<blockquote>
	<p>
	In UNO, objects are accessed by their interface. Many of the programming languages, such as Java and C++, force you to perform a little UNO magic and extract the correct interface before you can call the methods defined in the interface. OOo Basic hides these details for you so that you can directly call methods and access properties directly.  
	</p>
	<p>
	<strong>TIP</strong> OOo Basic hides many of the complicated details, so, for most things, it is easier to write an OOo Basic program than to write a Java script.  
	</p>
</blockquote>
<h2 id="uno-service">
	<em>UNO service</em> 
</h2>
<blockquote>
	<p>
	A service abstractly defines an object by combining interfaces and properties to encapsulate some useful functionality. A UNO interface defines how an object interacts with the outside world; a UNO structure defines a collection of data; and a UNO service combines them together.  Like a UNO interface, a UNO service does not specify the implementation.  It only specifies how to interact with the object.  
	</p>
	<p>
	Almost every UNO object is defined by a service, so UNO objects are called services. Strictly speaking, however, “a service” is the object definition. The UNO object is the actual object created as defined by the service. A service may include multiple services and interfaces. An interface usually defines a single aspect of a service and therefore is usually smaller in scope.  
	</p>
	<p>
	Many services have a name similar to an interface name; for example, one of the interfaces exported by the TextCursor service is the XTextCursor interface. An interface or property may be declared as optional for a service. The XWordCursor interface is marked as optional for the TextCursor service. The implication is that 
	</p>
	<p>
	not all text cursors support the word cursor interface. In practice, you learn which text cursors support which interfaces and then simply use them.  
	</p>
	<p>
	There are two typical methods for obtaining a service.  
	</p>
</blockquote>
<ul>
	<li>
		<p>
		Get a reference to an existing object; for example, retrieving the first text table in the current document.  
		</p>
	</li>
	<li>
		<p>
		Ask a service factory to create an instance of an object; for example, if I want to insert a new text table into a document, I ask the document to give me a new empty table, which I then configure and insert into the document.  
		</p>
	</li>
</ul>
<blockquote>
	<p>
	A service factory returns objects based on the name. The process service manager is the main object factory for OpenOffice.org. The factory is given the service name, and the factory decides what to return. A factory may return a brand new instance of an object, or, it may return an existing instance. Use GetProcessServiceManager() to obtain a reference to the process service manager. Use CreateInstance to create a service from the process service manager as shown in Listing 210.  
	</p>
	<p>
	<em> <strong>Listing 210.</strong> Use process service manager to create a service.</em> 
	</p>
	<p>
	Sub ManagerCreatesAService Dim vFileAccess 
	</p>
	<p>
	Dim s As String Dim vManager 
	</p>
	<p>
	vManager = GetProcessServiceManager() 
	</p>
	<p>
	vFileAccess = vManager.CreateInstance("com.sun.star.ucb.SimpleFileAccess") s = vFileAccess.getContentType(<a href="http://www.pitonyak.org/AndrewMacro.odt">"http://www.pitonyak.org/AndrewMacro.odt"</a>) Print s 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	The code in Listing 210 obtains the process service manager, creates an instance of the SimpleFileAccess service, and then uses the created service. The CreateUnoService function is a shortcut for creating a UNO service (see Listing 211). The purpose of Listing 211 is to demonstrate the CreateUnoService function, showing that it’s simpler than creating a service manager. Listing 211 also demonstrates some useful functionality, using a dialog to choose a file.  
	</p>
	<p>
	<em> <strong>Listing 211.</strong> Select a file on disk.</em> 
	</p>
	<p>
	Function ChooseAFileName() As String 
	</p>
	<p>
	Dim vFileDialog 'FilePicker service instance 
	</p>
	<p>
	Dim vFileAccess 'SimpleFileAccess service instance Dim iAccept as Integer 'Response to the FilePicker 
	</p>
	<p>
	Dim sInitPath as String 'Hold the initial path 
	</p>
	<p>
	'Note: The following services MUST be called in the following order 'or Basic will not remove the FileDialog Service 
	</p>
	<p>
	vFileDialog = CreateUnoService("com.sun.star.ui.dialogs.FilePicker") vFileAccess = CreateUnoService("com.sun.star.ucb.SimpleFileAccess") 'Set the initial path here!  
	</p>
	<p>
	sInitPath = ConvertToUrl(CurDir) 
	</p>
	<p>
	If vFileAccess.Exists(sInitPath) Then vFileDialog.SetDisplayDirectory(sInitPath) 
	</p>
	<p>
	End If 
	</p>
	<p>
	iAccept = vFileDialog.Execute() 'Run the file chooser dialog If iAccept = 1 Then 'What was the return value?  
	</p>
	<p>
	ChooseAFileName = vFileDialog.Files(0) 'Set file name if it was not canceled 
	</p>
	<p>
	End If 
	</p>
	<p>
	vFileDialog.Dispose() 'Dispose of the dialog End Function 
	</p>
	<p>
	A directory can be chosen similarly.  
	</p>
	<p>
	<em> <strong>Listing 212.</strong> Select a directory.</em> 
	</p>
	<p>
	REM sInPath specifies the initial directory. If the initial directory REM is not specified, then the user's default work directory is used.  REM The selected directory is returned as a URL.  
	</p>
	<p>
	Function ChooseADirectory(Optional sInPath$) As String Dim oDialog As Object 
	</p>
	<p>
	Dim oSFA As Object Dim s As String Dim oPathSettings 
	</p>
	<p>
	oDialog = CreateUnoService("com.sun.star.ui.dialogs.FolderPicker") 'oDialog = CreateUnoService("com.sun.star.ui.dialogs.OfficeFolderPicker") oSFA = createUnoService("com.sun.star.ucb.SimpleFileAccess") 
	</p>
	<p>
	If IsMissing(sInPath) Then 
	</p>
	<p>
	oPathSettings = CreateUnoService("com.sun.star.util.PathSettings") oDialog.setDisplayDirectory(oPathSettings.Work) 
	</p>
	<p>
	ElseIf oSFA.Exists(sInPath) Then oDialog.setDisplayDirectory(sInPath) 
	</p>
	<p>
	Else 
	</p>
	<p>
	s = "Directory '" &amp; sInPath &amp; "' Does not exist" If MsgBox(s, 33, "Error") = 2 Then Exit Function 
	</p>
	<p>
	End If 
	</p>
	<p>
	If oDialog.Execute() = 1 Then ChooseADirectory() = oDialog.getDirectory() 
	</p>
	<p>
	End If 
	</p>
	<p>
	End Function 
	</p>
	<p>
	<strong>TIP</strong> The file picker and folder picker dialogs can use either the operating system supplied default dialogs, or OOo specific dialogs. The operating system specific dialogs provide less functionality; for example, you cannot set the initial displayed directory. Use <strong>Tools &gt; Options &gt; OpenOffice.org &gt; General</strong> and place a 
	</p>
	<p>
	check next to "Use OpenOffice.org dialogs".  
	</p>
	<p>
	The code in Listing 211 creates two UNO services by using the function CreateUnoService. There are times, however, when the service manager is required. For example, the service manager has methods to create a service with arguments, CreateInstanceWithArguments, and to obtain a list of all supported services, getAvailableServiceNames(). The code in Listing 213 obtains a list of the supported service names; there are 1003 services on my computer using OOo version 3.2.1; up from 562 with OOo version 1.  
	</p>
	<p>
	<em> <strong>Listing 213.</strong> Service manager supports services.</em> 
	</p>
	<p>
	Sub HowManyServicesSupported 
	</p>
	<p>
	Dim oDoc ' Document created to hold the service names. Dim oText ' Document text object.  
	</p>
	<p>
	Dim oSD ' SortDescriptor created for the document. Dim oCursor ' Text cursor used for sorting.  
	</p>
	<p>
	Dim i% ' Index Variable. Dim sServices 
	</p>
	<p>
	sServices = GetProcessServiceManager().getAvailableServiceNames() Print "Service manager supports ";UBound(sServices);" services" ' Create a Writer document.  
	</p>
	<p>
	oDoc = StarDesktop.loadComponentFromURL( "private:factory/swriter", "_blank", 0, Array() ) oText = oDoc.getText() 
	</p>
	<p>
	' Print the service names into a Writer document. For i = LBound( sServices ) To UBound( sServices ) 
	</p>
	<p>
	oText.insertString( oText.getEnd(), sServices(i), False ) ' Do not insert a blank line at the end. oText.insertControlCharacter( oText.getEnd(), _ 
	</p>
	<p>
	com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK, False ) 
	</p>
	<p>
	Next 
	</p>
	<p>
	oCursor = oDoc.Text.CreateTextCursorByRange(oDoc.Text) oSD = oCursor.createSortDescriptor() 
	</p>
	<p>
	oCursor.sort(oSD) 
	</p>
	<p>
	oText.insertString( oText.getStart(), _ 
	</p>
	<p>
	"Service manager supports "&amp;UBound(sServices)&amp;" services", False ) 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	It is useful to look at the list of supported services. This provides insight into available functionality that you can explore. A great example of this is shown Listing 214. An object inserted into a document must be created by that document. Using the methods of Listing 213, you can check to see what types of objects the document can create.  
	</p>
	<p>
	<em> <strong>Listing 214.</strong> What objects can a document create.</em> 
	</p>
	<p>
	REM Print the object / service types that a document can create.  
	</p>
	<p>
	REM If the document (oDoc) is missing, the current document is used.  REM If nameFilter is included, then service names that contain 
	</p>
	<p>
	REM the string are printed; based on a case insensitive compare. REM The service names are stored in a newly created Write document. Sub TypesDocCanCreate(Optional oDoc, Optional nameFilter$) 
	</p>
	<p>
	Dim allNames ' List of all the names.  
	</p>
	<p>
	Dim oWriteDoc ' Newly created Write document to contain the names.  Dim oText ' Document text object.  
	</p>
	<p>
	Dim s : s = "private:factory/swriter" 
	</p>
	<p>
	' Find out what this document can create.  
	</p>
	<p>
	If IsMissing(oDoc) Then 
	</p>
	<p>
	allNames = ThisComponent.getAvailableServiceNames() 
	</p>
	<p>
	Else 
	</p>
	<p>
	allNames = oDoc.getAvailableServiceNames() 
	</p>
	<p>
	End If 
	</p>
	<p>
	' Create a new Write document to contain the list.  
	</p>
	<p>
	oWriteDoc = StarDesktop.loadComponentFromURL(s, "_blank", 0, Array()) oText = oWriteDoc.getText() 
	</p>
	<p>
	If IsMissing(nameFilter) Then 
	</p>
	<p>
	oText.insertString ( oText.End, Join(allNames, CHR$(13)), False ) 
	</p>
	<p>
	Else 
	</p>
	<p>
	Dim i% 
	</p>
	<p>
	For i = LBound(allNames) To UBound(allNames) 
	</p>
	<p>
	If (InStr(allNames(i), nameFilter) &gt; 0) Then ' Insert the text.  
	</p>
	<p>
	oText.insertString ( oText.End, allNames(i), False ) 
	</p>
	<p>
	' Insert a new paragraph.  oText.InsertControlCharacter(oText.getEnd(),_ 
	</p>
	<p>
	com.sun.star.text.ControlCharacter.APPEND_PARAGRAPH, False) End If 
	</p>
	<p>
	Next End If 
	</p>
	<p>
	End Sub 
	</p>
</blockquote>
<h1 id="setting-a-read-only-value">
	Setting a Read-Only Value 
</h1>
<blockquote>
	<p>
	Some values can be set only once, so changing the value requires creating a new object. As an example, consdier: 
	</p>
</blockquote>
<ul>
	<li>
		<p>
		A Calc sheet with combox controls (com.sun.star.awt.UnoControlComboBoxModel).  
		</p>
	</li>
	<li>
		<p>
		The controls are anchored to cells.  
		</p>
	</li>
	<li>
		<p>
		Each control bound to a cell.  
		</p>
	</li>
	<li>
		<p>
		Write a macro that finds each combobox and bind it to the cell in which it is anchored.  
		</p>
	</li>
</ul>
<blockquote>
	<p>
	The obvious way to change the bound cell is to access and change the bound cell doing something like the following code that fails because ValueBinding is read-only: 
	</p>
	<p>
	' BoundCell is a struct, so copy the value out, change it and write it back. oBoundCell = oControlDataModel.ValueBinding.BoundCell 
	</p>
	<p>
	oBoundCell.Column = 6 
	</p>
	<p>
	oBoundCell.Row = 6 
	</p>
	<p>
	oBoundCell.Sheet = 0 oControlDataModel.ValueBinding.BoundCell = oBoundCell 
	</p>
	<p>
	If you create a new value binding object and try to set the BoundCell property, this still fails. The value binding object must be initialized with the bound cell value, and it cannot be changed again: 
	</p>
	<p>
	Dim arg(0) as new com.sun.star.beans.NamedValue 'not a PropertyValue, a Named Value.  
	</p>
	<p>
	Dim oCellAddress As new com.sun.star.table.CellAddress oCellAddress.Column = 6 
	</p>
	<p>
	oCellAddress.Row=13 oCellAddress.Sheet=0 arg(0).Name = "BoundCell" arg(0).Value = oCellAddress 
	</p>
	<p>
	oService = oDoc.createInstanceWithArguments("com.sun.star.table.CellValueBinding", arg) oControlDataModel.ValueBinding = oService 
	</p>
	<p>
	Using CreateInstanceWithArguments allows the service to be created and values be set when the object is initialized. You can accomplish the same thing in two steps (instead of one) by creating the instance without arguments and calling the initialize method after creating the object.  
	</p>
</blockquote>
<h2 id="context">
	<em>Context</em> 
</h2>
<blockquote>
	<p>
	OpenOffice has “things” that are available by name. For example, the type description manager and the service manager. A context is a collection of name-value pairs that you can use to get these “things” by name. OOo maintains a default context that is available with the function GetDefaultContext. Although a context is required when a service is created, OOo Basic automatically uses the default context when calling CreateUnoService; yet another reason why OOo Basic is easier to use than other languages.  
	</p>
	<p>
	<em> <strong>Listing 215.</strong> View context element names.</em> 
	</p>
	<p>
	MsgBox Join(GetDefaultContext().getElementNames(), CHR$(10)) 
	</p>
</blockquote>
<h2 id="inspecting-universal-network-objects">
	<em>Inspecting Universal Network Objects</em> 
</h2>
<blockquote>
	<p>
	While writing an OOo Basic macro, I don’t always understand the values returned from internal OOo functions — for example, inspecting the value returned by GetDefaultContext. I write test code to examine the return values so that I can make appropriate decisions. I then frequently add more test code to further inspect the returned object.  The initial inspection uses routines that you probably know (see Table 90).  
	</p>
	<p>
	<em> <strong>Table 90.</strong> Initial inspection routines.</em> 
	</p>
</blockquote>
<table border="1">
	<colgroup> <col style="width: 24%" /> <col style="width: 75%" /> </colgroup> 
	<thead>
		<tr class="header">
			<th>
				<blockquote>
					<p>
					<em> <strong>Routine</strong> </em> 
					</p>
				</blockquote>
			</th>
			<th>
				<blockquote>
					<p>
					<em> <strong>Comment</strong> </em> 
					</p>
				</blockquote>
			</th>
		</tr>
	</thead> <tbody> 
		<tr class="odd">
			<td>
				IsMissing(obj) 
			</td>
			<td>
				Use this for optional arguments to see if they are missing.  
			</td>
		</tr>
		<tr class="even">
			<td>
				IsNull(obj) 
			</td>
			<td>
				You cannot inspect a null object, but you know that it is null.  
			</td>
		</tr>
		<tr class="odd">
			<td>
				IsEmpty(obj) 
			</td>
			<td>
				You cannot inspect an empty object, but you know that it is empty.  
			</td>
		</tr>
		<tr class="even">
			<td>
				IsArray(obj) 
			</td>
			<td>
				Use array-inspection methods to learn more about the array.  
			</td>
		</tr>
		<tr class="odd">
			<td>
				TypeName(obj) 
			</td>
			<td>
				Determine if this is a simple type such as a String or an Integer.  If this is an Object, it is probably a UNO structure or a UNO service.  
			</td>
		</tr>
		<tr class="even">
			<td>
				IsUnoStruct(obj) 
			</td>
			<td>
				Determine if this is a UNO structure.  
			</td>
		</tr>
	</tbody> 
</table>
<blockquote>
	<p>
	The code in Listing 216 demonstrates an initial use of the functions in Table 90.  
	</p>
	<p>
	<em> <strong>Listing 216.</strong> Inspect the TextTables object on the current document.</em> 
	</p>
	<p>
	Dim v 
	</p>
	<p>
	v = Thiscomponent.getTextTables() Print IsObject(v) 'True 
	</p>
	<p>
	Print IsNull(v) 'False 
	</p>
	<p>
	Print IsEmpty(v) 'False 
	</p>
	<p>
	Print IsArray(v) 'False Print IsUnoStruct(v) 'False Print TypeName(v) 'Object 
	</p>
	<p>
	MsgBox v.dbg_methods 'This property is discussed later 
	</p>
	<p>
	If the returned object has a type name of Object and it isn’t a UNO structure, it is probably a UNO service. Use the HasUnoInterfaces function to determine if a UNO object supports a set of interfaces. The first argument is the object to test. The arguments following the first are a list of interface names. If all of the listed interfaces are supported, the function returns True, otherwise it returns False. More than one interface may be checked at the same time.  
	</p>
	<p>
	HasUnoInterfaces(obj, interface1) 
	</p>
	<p>
	HasUnoInterfaces(obj, interface1[, interface2[, interface3[, ...]]]) 
	</p>
	<p>
	To distinguish between a UNO structure, an arbitrary object, and a UNO service, first check to see if the variable is an object. This is easily done using the TypeName function. If the TypeName contains the word 
	</p>
	<p>
	Object, then you know it’s an object of some sort. The next step is to see if the object is a UNO structure, by using the function IsUnoStruct. Finally, if the object supports an interface (any interface will do), you know it’s a UNO service. Every interface is derived from com.sun.star.uno.XInterface, so it suffices to see if the object supports the XInterface interface. The code in Listing 217 uses the OOo Basic variable ThisComponent, which represents the current document.  
	</p>
	<p>
	<em> <strong>Listing 217.</strong> Use HasUnoInterfaces and IsUnoStruct to determine the UNO type.</em> 
	</p>
	<p>
	Dim aProp As New com.sun.star.beans.PropertyValue 
	</p>
	<p>
	Print IsUnoStruct(aProp) 'True 
	</p>
	<p>
	Print HasUnoInterfaces(aProp, "com.sun.star.uno.XInterface") 'False Print IsUnoStruct(ThisComponent) 'False Print HasUnoInterfaces(ThisComponent, "com.sun.star.uno.XInterface") 'True 
	</p>
	<p>
	<strong>TIP</strong> If the first argument to the function HasUnoInterfaces is not an object, a run-time error occurs. The object may be null, but it must be an object. If the argument is a variant, it must contain an object; it cannot be empty.  
	</p>
	<p>
	Most UNO services also support the com.sun.star.lang.XServiceInfo interface, which allows you to ask the object what services it supports (see Table 91).  
	</p>
	<p>
	<em> <strong>Table 91.</strong> XServiceInfo methods.</em> 
	</p>
</blockquote>
<table border="1">
	<colgroup> <col style="width: 32%" /> <col style="width: 67%" /> </colgroup> 
	<thead>
		<tr class="header">
			<th>
				<blockquote>
					<p>
					<em> <strong>Method</strong> </em> 
					</p>
				</blockquote>
			</th>
			<th>
				<blockquote>
					<p>
					<em> <strong>Description</strong> </em> 
					</p>
				</blockquote>
			</th>
		</tr>
	</thead> <tbody> 
		<tr class="odd">
			<td>
				<blockquote>
					<p>
					getImplementationName() 
					</p>
				</blockquote>
			</td>
			<td>
				Returns a string that uniquely identifies the implementation of the service. For example, SwXTextDocument is the name of a Writer text document.  
			</td>
		</tr>
		<tr class="even">
			<td>
				<blockquote>
					<p>
					getSupportedServiceNames() 
					</p>
				</blockquote>
			</td>
			<td>
				Return a string array of services that the object supports.  
			</td>
		</tr>
		<tr class="odd">
			<td>
				<blockquote>
					<p>
					supportsService(serviceName) 
					</p>
				</blockquote>
			</td>
			<td>
				Return True if the object supports the service name.  
			</td>
		</tr>
	</tbody> 
</table>
<blockquote>
	<p>
	OOo supports different types of documents, such as Writer (word processing) and Calc (spreadsheet). Each document type supports at least one service that is supported only by that document type (see Table 92).  You can determine the document type by checking if it supports one of these services. You can also use the method getImplementationName(), as shown in Table 91.  
	</p>
	<p>
	The code in Listing 218 demonstrates how to verify that a variable references a Writer document. If the argument vDoc does not support the XServiceInfo interface, however, a run-time error occurs because the SupportsService method is not implemented. Use appropriate error handling if this is required, as shown in Listing 219; this is used in Listing 227. If the argument is missing, the current document is used.  If an error occurs or a recognized service is not supported, the text “unknown” is returned.  
	</p>
	<p>
	<em> <strong>Table 92.</strong> Unique service names based on document type.</em> 
	</p>
</blockquote>
<table border="1">
	<colgroup> <col style="width: 31%" /> <col style="width: 68%" /> </colgroup> 
	<thead>
		<tr class="header">
			<th>
				<blockquote>
					<p>
					<em> <strong>Document Type</strong> </em> 
					</p>
				</blockquote>
			</th>
			<th>
				<blockquote>
					<p>
					<em> <strong>Service</strong> </em> 
					</p>
				</blockquote>
			</th>
		</tr>
	</thead> <tbody> 
		<tr class="odd">
			<td>
				Drawing 
			</td>
			<td>
				<blockquote>
					<p>
					com.sun.star.drawing.DrawDocument 
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				Writer 
			</td>
			<td>
				<blockquote>
					<p>
					com.sun.star.text.TextDocument 
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				Writer HTML 
			</td>
			<td>
				<blockquote>
					<p>
					com.sun.star.text.WebDocument 
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				Calc 
			</td>
			<td>
				<blockquote>
					<p>
					com.sun.star.sheet.SpreadsheetDocument 
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				Math 
			</td>
			<td>
				<blockquote>
					<p>
					com.sun.star.formula.FormulaProperties 
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				Presentation 
			</td>
			<td>
				<blockquote>
					<p>
					com.sun.star.presentation.PresentationDocument 
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				Base 
			</td>
			<td>
				<blockquote>
					<p>
					com.sun.star.sdb.OfficeDatabaseDocument 
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				Base Table 
			</td>
			<td>
				<blockquote>
					<p>
					com.sun.star.sdb.DataSourceBrowser 
					</p>
				</blockquote>
			</td>
		</tr>
	</tbody> 
</table>
<table border="1">
	<colgroup> <col style="width: 31%" /> <col style="width: 68%" /> </colgroup> 
	<thead>
		<tr class="header">
			<th>
				<blockquote>
					<p>
					<em> <strong>Document Type</strong> </em> 
					</p>
				</blockquote>
			</th>
			<th>
				<blockquote>
					<p>
					<em> <strong>Service</strong> </em> 
					</p>
				</blockquote>
			</th>
		</tr>
	</thead> <tbody> 
		<tr class="odd">
			<td>
				Basic IDE 
			</td>
			<td>
				<blockquote>
					<p>
					com.sun.star.script.BasicIDE 
					</p>
				</blockquote>
			</td>
		</tr>
	</tbody> 
</table>
<blockquote>
	<p>
	<em> <strong>Listing 218.</strong> Verify that the document is a Writer document.</em> 
	</p>
	<p>
	Sub DoSomethingToWriteDocument(vDoc) 
	</p>
	<p>
	If NOT vDoc.supportsService("com.sun.star.text.TextDocument") Then MsgBox "A Writer document is required", 48, "Error" 
	</p>
	<p>
	Exit Sub End If 
	</p>
	<p>
	REM rest of the subroutine starts here End Sub 
	</p>
	<p>
	<em> <strong>Listing 219.</strong> Determine a document's type.</em> 
	</p>
	<p>
	Function getDocType(Optional vDoc) As String On Error GoTo Oops 
	</p>
	<p>
	If IsMissing(vDoc) Then vDoc = ThisComponent 
	</p>
	<p>
	If vDoc.SupportsService("com.sun.star.sheet.SpreadsheetDocument") Then getDocType = "calc" 
	</p>
	<p>
	ElseIf vDoc.SupportsService("com.sun.star.text.TextDocument") Then getDocType = "writer" 
	</p>
	<p>
	ElseIf vDoc.SupportsService("com.sun.star.drawing.DrawingDocument") Then getDocType = "draw" 
	</p>
	<p>
	ElseIf vDoc.SupportsService(_ 
	</p>
	<p>
	"com.sun.star.presentation.PresentationDocuments") Then getDocType = "presentation" 
	</p>
	<p>
	ElseIf vDoc.SupportsService("com.sun.star.formula.FormulaProperties") Then getDocType = "math" 
	</p>
	<p>
	ElseIf vDoc.SupportsService("com.sun.star.sdb.OfficeDatabaseDocument") Then getDocType = "base" 
	</p>
	<p>
	Else 
	</p>
	<p>
	getDocType = "unknown" End If 
	</p>
	<p>
	Oops: 
	</p>
	<p>
	If Err &lt;&gt; 0 Then getDocType = "unknown" 
	</p>
	<p>
	On Error GoTo 0 'Turn off error handling AFTER checking for an error End Function 
	</p>
	<p>
	Some document types cannot be easily distinguished; for example, an XForms document and a Master document both support the same services as a regular text document. All of the Write based documents support the service com.sun.star.text.GenericTextDocument, and all of the office type documents support the service com.sun.star.document.OfficeDocument.  
	</p>
	<p>
	When I want to know about an interface or service, the first place that I look is online for the official documentation. Unfortunately, only a partial picture is easily produced (for the TextCursor service, see <a href="http://api.openoffice.org/docs/common/ref/com/sun/star/text/TextCursor.html)"> <u>http://api.openoffice.org/docs/common/ref/com/sun/star/text/TextCursor.html</u>).</a> There are some issues: 
	</p>
</blockquote>
<ol type="1">
	<li>
		<p>
		The documentation does not present a unified picture, you must follow many links to determine what the object can do. All supported and optional interfaces are listed, but you must inspect each interface to know what each one does.  
		</p>
	</li>
	<li>
		<p>
		Each interface has its own page. If an interface is derived from another, you must look at another page to see the definition of the parent interface.  
		</p>
	</li>
	<li>
		<p>
		You don’t know if the optional items are supported for a specific object instance without inspecting the object.  
		</p>
	</li>
</ol>
<blockquote>
	<p>
	<strong>TIP</strong> Use Google to search for “site:api.openoffice.org TextCursor” to quickly find the documentation for the TextCursor service.  
	</p>
	<p>
	<strong>TIP</strong> <a href="http://api.openoffice.org/docs/common/ref/com/sun/star/text/module-ix.html"> <u>http://api.openoffice.org/docs/common/ref/com/sun/star/text/module-ix.html</u> </a> lists all of the services and interfaces at the com.sun.star.text level.  
	</p>
	<p>
	Most UNO services contain the properties dbg_properties, dbg_methods, and dbg_supportedInterfaces. Each of these properties is a string that contains a list of the supported properties, methods, or supported interfaces. Each string starts with text similar to “Properties of Object "ThisComponent":”. The individual items are separated by the delimiter as shown in Table 93. Sometimes there are extra spaces following the delimiter and sometimes there are extra new-line characters — CHR$(10).  
	</p>
	<p>
	<em> <strong>Table 93.</strong> UNO “dbg_” properties.</em> 
	</p>
</blockquote>
<table border="1">
	<colgroup> <col style="width: 28%" /> <col style="width: 20%" /> <col style="width: 50%" /> </colgroup> 
	<thead>
		<tr class="header">
			<th>
				<blockquote>
					<p>
					<em> <strong>Property</strong> </em> 
					</p>
				</blockquote>
			</th>
			<th>
				<blockquote>
					<p>
					<em> <strong>Delimiter</strong> </em> 
					</p>
				</blockquote>
			</th>
			<th>
				<blockquote>
					<p>
					<em> <strong>Description</strong> </em> 
					</p>
				</blockquote>
			</th>
		</tr>
	</thead> <tbody> 
		<tr class="odd">
			<td>
				dbg_properties 
			</td>
			<td>
				<blockquote>
					<p>
					“;” 
					</p>
				</blockquote>
			</td>
			<td>
				<blockquote>
					<p>
					All properties supported by the object.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="even">
			<td>
				dbg_methods 
			</td>
			<td>
				<blockquote>
					<p>
					“;” 
					</p>
				</blockquote>
			</td>
			<td>
				<blockquote>
					<p>
					All methods supported by the object.  
					</p>
				</blockquote>
			</td>
		</tr>
		<tr class="odd">
			<td>
				dbg_supportedInterfaces 
			</td>
			<td>
				<blockquote>
					<p>
					Chr$(10) 
					</p>
				</blockquote>
			</td>
			<td>
				<blockquote>
					<p>
					All interfaces supported by the object.  
					</p>
				</blockquote>
			</td>
		</tr>
	</tbody> 
</table>
<blockquote>
	<p>
	The code in Listing 220 provides an easy method to see what an object supports. Sometimes, however, too many items are displayed and portions of the dialog do not fit on the screen. To avoid this problem, the code in Listing 221 splits the list into smaller, easily managed chunks.  Figure 74 is only one of the many dialogs that are displayed by the macro in Listing 221. Be warned, the dialogs will not fit on the screen, so, just press enter to close each dialog.  
	</p>
	<p>
	<em> <strong>Listing 220.</strong> The “dbg_” properties return useful information.</em> 
	</p>
	<p>
	MsgBox vObj.dbg_properties MsgBox vObj.dbg_methods 
	</p>
	<p>
	MsgBox vObj.dbg_supportedInterfaces 
	</p>
	<p>
	<em> <strong>Listing 221.</strong> Display information from one of the debug properties.</em> 
	</p>
	<p>
	Sub ExampleDisplayDbgInfoStr() 
	</p>
	<p>
	Dim vObj 
	</p>
	<p>
	vObj = ThisComponent 
	</p>
	<p>
	DisplayDbgInfoStr(vObj.dbg_properties, ";", 40, "Properties") DisplayDbgInfoStr(vObj.dbg_methods, ";", 40, "Methods") DisplayDbgInfoStr(vObj.dbg_supportedInterfaces, CHR$(10), 40, "Interfaces") 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	Sub DisplayDbgInfoStr(sInfo$, sSep$, nChunks, sHeading$) 
	</p>
	<p>
	Dim aInfo() 'Array to hold each string 
	</p>
	<p>
	Dim i As Integer 'Index variable 
	</p>
	<p>
	Dim j As Integer 'Junk integer variable for temporary values 
	</p>
	<p>
	Dim s As String 'holds the portion that is not completed s = sInfo$ 
	</p>
	<p>
	j = InStr(s, ":") 'Initial colon 
	</p>
	<p>
	If j &gt; 0 Then Mid(s, 1, j, "") 'Remove portion up to the initial colon Do 
	</p>
	<p>
	aInfo() = Split(s, sSep$, nChunks) 'Split string based on delimiter.  s = aInfo(UBound(aInfo())) 'Grab the last piece. Contains 
	</p>
	<p>
	If InStr(s, sSep$) &lt; 1 Then 'the rest if there were too many. s = "" 'If there were not, then clear s.  
	</p>
	<p>
	Else 'If there was a delimiter then 
	</p>
	<p>
	ReDim Preserve aInfo(nChunks - 2) 'change array dimension to End If 'remove the extra last piece.  
	</p>
	<p>
	For i = LBound(aInfo()) To UBound(aInfo())'Look at each piece to remove aInfo(i) = Trim(aInfo(i)) 'leading and trailing spaces. j = InStr(aInfo(i), CHR$(10)) 'Some have an extra 
	</p>
	<p>
	If j &gt; 0 Then Mid(aInfo(i), j, 1, "") 'new line that should be removed.  
	</p>
	<p>
	Next 
	</p>
	<p>
	MsgBox Join(aInfo(), CHR$(10)), 0, sHeading$ Loop Until Len(s) = 0 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	When a type is included in one of the “dbg_” properties, it is preceded by the text “Sbx”, as shown in Figure 
	</p>
	<p>
	74. These names starting with Sbx correspond to the internal names used by OOo Basic.  
	</p>
	<p>
	<strong>TIP</strong> A complete object browser is presented later that demonstrates all of these concepts (see section 18.5 The object inspector example).  
	</p>
	<p>
	<strong>TIP</strong> A popular object browser, called Xray described at the following link: <a href="http://wiki.openoffice.org/wiki/Extensions_development_basic"> <u>http://wiki.openoffice.org/wiki/Extensions_development_basic</u> </a> 
	</p>
	<p>
	<img src="media/image1.png" style="width:2.67325in;height:4.65802in" /> 
	</p>
	<p>
	<em> <strong>Figure 74.</strong> A few properties in a Writer document; one dialog of many displayed.</em> 
	</p>
</blockquote>
<h2 id="using-the-type-description-manager">
	<em>Using the type description manager</em> 
</h2>
<blockquote>
	<p>
	The TypeDescriptionManager manages type descriptions and acts as a central access point for every type description. This object is available from the default context as a singleton. Creating the object directly does not provide a usable object 
	</p>
	<p>
	CreateUnoService("com.sun.star.reflection.TypeDescriptionManager") 
	</p>
	<p>
	I created a usable object using the accepted method (shown shortly), and even when using that type directly, it too failed.  
	</p>
	<p>
	CreateUnoService("com.sun.star.comp.stoc.TypeDescriptionManager") 
	</p>
	<p>
	Get the type description manager from the default context; see section 10.4 Context, which also shows how to enumerate all of the singleton objects available.  
	</p>
	<p>
	Function GetTypeDescriptionManager() 
	</p>
	<p>
	Dim sTDMName$ ' Name of the type description manager.  
	</p>
	<p>
	sTDMName = "/singletons/com.sun.star.reflection.theTypeDescriptionManager" GetTypeDescriptionManager() = GetDefaultContext().getValueByName(sTDMName) 
	</p>
	<p>
	End Function 
	</p>
	<p>
	The following method enumerates all “things” in the com.sun.star.awt module.  
	</p>
	<p>
	<em> <strong>Listing 222.</strong> Enumerate types in a module.</em> 
	</p>
	<p>
	Sub EnumerateTypesTest 
	</p>
	<p>
	Dim oTDM ' Type Description Manager.  
	</p>
	<p>
	Dim oTDE ' Type Description Enumerations. Dim oTD ' One Type Description.  
	</p>
	<p>
	Dim typeArray ' Types for which descriptions are returned. Dim s$ ' Utility string variable.  
	</p>
	<p>
	REM All supported types.  
	</p>
	<p>
	typeArray = Array(com.sun.star.uno.TypeClass.VOID, _ com.sun.star.uno.TypeClass.CHAR, _ com.sun.star.uno.TypeClass.BOOLEAN, _ com.sun.star.uno.TypeClass.BYTE, _ com.sun.star.uno.TypeClass.SHORT, _ com.sun.star.uno.TypeClass.UNSIGNED_SHORT, _ com.sun.star.uno.TypeClass.LONG, _ com.sun.star.uno.TypeClass.UNSIGNED_LONG, _ com.sun.star.uno.TypeClass.HYPER, _ com.sun.star.uno.TypeClass.UNSIGNED_HYPER, _ com.sun.star.uno.TypeClass.FLOAT, _ com.sun.star.uno.TypeClass.DOUBLE, _ com.sun.star.uno.TypeClass.STRING, _ com.sun.star.uno.TypeClass.TYPE, _ com.sun.star.uno.TypeClass.ANY, _ com.sun.star.uno.TypeClass.ENUM, _ com.sun.star.uno.TypeClass.TYPEDEF, _ com.sun.star.uno.TypeClass.STRUCT, _ com.sun.star.uno.TypeClass.UNION, _ com.sun.star.uno.TypeClass.EXCEPTION, _ com.sun.star.uno.TypeClass.SEQUENCE, _ com.sun.star.uno.TypeClass.ARRAY, _ com.sun.star.uno.TypeClass.INTERFACE, _ com.sun.star.uno.TypeClass.SERVICE, _ com.sun.star.uno.TypeClass.MODULE, _ com.sun.star.uno.TypeClass.INTERFACE_METHOD, _ com.sun.star.uno.TypeClass.INTERFACE_ATTRIBUTE, _ com.sun.star.uno.TypeClass.UNKNOWN, _ com.sun.star.uno.TypeClass.PROPERTY, _ com.sun.star.uno.TypeClass.CONSTANT, _ com.sun.star.uno.TypeClass.CONSTANTS, _ com.sun.star.uno.TypeClass.SINGLETON) 
	</p>
	<p>
	oTDM = GetTypeDescriptionManager() 
	</p>
	<p>
	Dim sBaseName$ : sBaseName = "com.sun.star.awt" 
	</p>
	<p>
	' Change com.sun.star.reflection.TypeDescriptionSearchDepth.ONE ' to com.sun.star.reflection.TypeDescriptionSearchDepth.INFINITE ' to traverse more than a single level.  
	</p>
	<p>
	oTDE = oTDM.createTypeDescriptionEnumeration(sBaseName, _ typeArray, _ com.sun.star.reflection.TypeDescriptionSearchDepth.ONE) 
	</p>
	<p>
	While oTDE.hasMoreElements() 
	</p>
	<p>
	oTD = oTDE.nextTypeDescription() s$ = s &amp; oTD.Name &amp; CHR$(10) 
	</p>
	<p>
	Wend MsgBox s 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	To get the information on a specific fully qualified type, use the following macro (adapted from an example by Bernard Marcelly): 
	</p>
	<p>
	<em> <strong>Listing 223.</strong> Get object description from a fully qualified name.</em> 
	</p>
	<p>
	Function GetOOoConst(constString) Dim sTDMName$ 
	</p>
	<p>
	Dim oTDM 
	</p>
	<p>
	sTDMName = "/singletons/com.sun.star.reflection.theTypeDescriptionManager" oTDM = GetDefaultContext().getValueByName(sTDMName) 
	</p>
	<p>
	If oTDM.hasByHierarchicalName(constString) Then GetOOoConst = oTDM.getByHierarchicalName(constString) 
	</p>
	<p>
	Else 
	</p>
	<p>
	MsgBox "Unrecognized name : " &amp; constString, 16, "OOo API constant or enum" End If 
	</p>
	<p>
	End Function 
	</p>
	<p>
	The method is usable to obtain constant and enumeration values from a text string 
	</p>
	<p>
	Print GetOOoConst("com.sun.star.awt.FontSlant.ITALIC") 
	</p>
	<p>
	This can also return an object that describes the type. This can be used to enumerate the values and the strings.  
	</p>
	<p>
	<em> <strong>Listing 224.</strong> Inspect enumerations.</em> 
	</p>
	<p>
	Sub EnumerateEnumerations(sName$) 
	</p>
	<p>
	Dim oTD ' One Type Description. Dim oTDE ' Element enumeration 
	</p>
	<p>
	Dim s$ ' Utility string variable. Dim sNames 
	</p>
	<p>
	Dim lValues Dim i As Long 
	</p>
	<p>
	Dim iCount As Integer 
	</p>
	<p>
	oTD = GetOOoConst(sName) 
	</p>
	<p>
	If IsNull(oTD) OR IsEmpty(oTD) Then Exit Sub 
	</p>
	<p>
	End If 
	</p>
	<p>
	If HasUnoInterfaces(oTD, "com.sun.star.reflection.XEnumTypeDescription") Then 'MsgBox Join( oTD.getEnumNames(), CHR$(10)) 
	</p>
	<p>
	sNames = oTD.getEnumNames() lValues = otd.getEnumValues() 
	</p>
	<p>
	For i = LBound(sNames) To UBound(sNames) 
	</p>
	<p>
	iCount = iCount + 1 If (iCount &gt; 40) Then 
	</p>
	<p>
	MsgBox(s) s = "" 
	</p>
	<p>
	End If 
	</p>
	<p>
	s = s &amp; lValues(i) &amp; CHR$(9) &amp; sNames(i) &amp; CHR$(10) Next 
	</p>
	<p>
	ElseIf HasUnoInterfaces(oTD, "com.sun.star.reflection.XConstantsTypeDescription") Then lValues = oTD.getConstants() 
	</p>
	<p>
	For i = LBound(lValues) To UBound(lValues) iCount = iCount + 1 
	</p>
	<p>
	If (iCount &gt; 40) Then MsgBox(s) 
	</p>
	<p>
	s = "" 
	</p>
	<p>
	End If 
	</p>
	<p>
	s = s &amp; lValues(i).getConstantValue() &amp; CHR$(9) &amp; lValues(i).getName() &amp; CHR$(10) Next 
	</p>
	<p>
	Else 
	</p>
	<p>
	'Inspect oTD 
	</p>
	<p>
	MsgBox "Unsupported type " &amp; sName Exit Sub 
	</p>
	<p>
	End If MsgBox s 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	This can be used to see enumerations.  
	</p>
	<p>
	EnumerateEnumerations("com.sun.star.awt.FontSlant") 
	</p>
	<p>
	This can be used to see constant groups.  
	</p>
	<p>
	EnumerateEnumerations("com.sun.star.awt.FontWeight") 
	</p>
</blockquote>
<h2 id="use-object-or-variant">
	<em>Use Object or Variant</em> 
</h2>
<blockquote>
	<p>
	It is almost always safe to use Object variables to hold UNO services. It is so safe, apparently, that even the macro recorder uses Object variables to hold UNO services. Unfortunately, it is not always safe. The OOo Developer’s Guide specifically states that Variant variables should be used instead of Object variables.  
	</p>
	<p>
	Always use the type Variant to declare variables for UNO services, not the type Object. The OOo Basic type Object is tailored for pure OOo Basic objects — in other words, objects that can be created with the Dim As New syntax. The Variant variables are best for UNO services to avoid problems that can result from the OOo Basic specific behavior of the type Object. I asked Andreas Bregas (one of the primary developers for the OOo Basic infrastructure) about this, and he said that in most cases, both work. The OOo Developer’s Guide prefers Variant because there are some odd situations in which the usage of type Object leads to an error due to the old Basic Object type semantics. But if a Basic program uses type Object, it will almost always run correctly and there should be no problems. It is sufficiently rare, however, that he could not remember an example where it was a problem. On the other hand, with OOo version 1, I experienced a problem that corrected itself, when I changed the variable type from Variant to Object.  
	</p>
</blockquote>
<h2 id="comparing-uno-variables">
	<em>Comparing UNO variables</em> 
</h2>
<blockquote>
	<p>
	Use the EqualUnoObjects function to determine if two UNO objects are the same object. UNO structures are copied by value but UNO services are copied by reference. This means that EqualUnoObjects should always return False for two variables that contain a structure, and it might return True for UNO services.  
	</p>
	<p>
	Dim vObj 
	</p>
	<p>
	vObj = ThisComponent 
	</p>
	<p>
	Print EqualUnoObjects(vObj, ThisComponent) 'True 
	</p>
	<p>
	Dim aProp As New com.sun.star.beans.PropertyValue vObj = aProp 
	</p>
	<p>
	Print EqualUnoObjects(vObj, aProp) 'False 
	</p>
	<p>
	After using OOo for many years, I finally found a use for EqualUnoObjects. Be warned that this is an advance topic and makes use of constructs not widely known. The problem as posed is: “When a button is pressed in a Calc document, I want to know which cell contains the button.” Here are some bits of information to help understand the problem: 
	</p>
</blockquote>
<ul>
	<li>
		<p>
		Each document has at least one “draw page” that contains graphical things such as images imbedded in the document.  
		</p>
	</li>
	<li>
		<p>
		You can embed controls such as a button in a document. When the button is pressed, and a macro is called, it is trivial to get a reference to the control “data model”.  
		</p>
	</li>
	<li>
		<p>
		Each control has a shape embedded in the draw page.  
		</p>
	</li>
	<li>
		<p>
		Each control also has a “data model” that contains properties and other similar things.  
		</p>
	</li>
	<li>
		<p>
		From a control data model I cannot easily obtain the shape or the cell containing the control.  
		</p>
	</li>
	<li>
		<p>
		From a shape in a Calc document, I can easily find the cell – if the control is anchored to a cell.  
		</p>
	</li>
</ul>
<blockquote>
	<p>
	My solution was to find the shape associated with a control. It is easy to find the control name, but, a control name need not be unique. I opted to look at every shape on the draw page and then check to see if the control associated with that shape is the same object as the control in question.  
	</p>
	<p>
	<em> <strong>Listing 225.</strong> Find the control shape for a specific control.</em> 
	</p>
	<p>
	Function FindCellWithControl(oDrawPage, oControl) Dim oShape 
	</p>
	<p>
	Dim oAnchor 
	</p>
	<p>
	oShape = FindShapeForControl(oDrawPage, oControl) If Not IsEmpty(oShape) Then 
	</p>
	<p>
	If oShape.getAnchor().supportsService("com.sun.star.sheet.SheetCell") Then FindCellWithControl = oShape.getAnchor() 
	</p>
	<p>
	End If End If 
	</p>
	<p>
	End Function 
	</p>
	<p>
	Function FindShapeForControl(oDrawPage, oControl) Dim i 
	</p>
	<p>
	Dim oShape 
	</p>
	<p>
	For i = 0 To oDrawPage.getCount() oShape = oDrawPage.getByIndex(i) 
	</p>
	<p>
	If oShape.supportsService("com.sun.star.drawing.ControlShape") Then If EqualUNOObjects(oControl, oShape.Control) Then 
	</p>
	<p>
	FindShapeForControl = oShape Exit Function 
	</p>
	<p>
	End If End If 
	</p>
	<p>
	Next 
	</p>
	<p>
	End Function 
	</p>
	<p>
	What does the event handler called by the button look like?  
	</p>
	<p>
	Sub ButtonHandler(oEvent) Dim oControlModel 
	</p>
	<p>
	Dim oParent Dim oCell 
	</p>
	<p>
	'Print oEvent.Source.Model.getName() oControlModel = oEvent.Source.Model 
	</p>
	<p>
	oParent = oControlModel.getParent() 
	</p>
	<p>
	Do While NOT oParent.supportsService("com.sun.star.sheet.SpreadsheetDocument") oParent = oParent.getParent() 
	</p>
	<p>
	Loop 
	</p>
	<p>
	oCell = FindCellWithControl(oParent.getCurrentController().getActiveSheet().getDrawPage(), oControlModel) 
	</p>
	<p>
	If NOT IsEmpty(oCell) Then 
	</p>
	<p>
	Print "Control is in cell " &amp; oCell.AbsoluteName Else 
	</p>
	<p>
	Print "Unable to find cell with control" ENd If 
	</p>
	<p>
	End Sub 
	</p>
</blockquote>
<h2 id="built-in-global-uno-variables">
	<em>Built-in global UNO variables</em> 
</h2>
<blockquote>
	<p>
	OOo Basic contains built-in global variables that provide quick access to frequently used components in OOo. The most commonly used variable is ThisComponent, which refers to the currently active document. To demonstrate using the variable ThisComponent, the macro in Listing 226 displays all of the styles in the current document. Figure 75 is only one of the many dialogs that are displayed while the macro runs. The fact that a style exists in a document does not imply that the style is actually used in the document.  
	</p>
	<p>
	<em> <strong>Listing 226.</strong> Display all styles known by this document.</em> 
	</p>
	<p>
	Sub DisplayAllStyles 
	</p>
	<p>
	Dim vFamilies As Variant 'All the style types 
	</p>
	<p>
	Dim vFamNames As Variant 'Array with names of the style types 
	</p>
	<p>
	Dim vStyles As Variant 'One style type such as Number or Page Styles Dim vStlNames As Variant 'Array with names of specific styles 
	</p>
	<p>
	Dim s As String 'Message to display 
	</p>
	<p>
	Dim n As Integer 'Iterate through the style types Dim i As Integer 'Iterate through the styles 
	</p>
	<p>
	vFamilies = ThisComponent.StyleFamilies 'Get the styles vFamNames = vFamilies.getElementNames() 'What type of styles?  
	</p>
	<p>
	For n = LBound(vFamNames) To UBound(vFamNames) 'Look at all style types s = "" 
	</p>
	<p>
	vStyles = vFamilies.getByName(vFamNames(n)) 'Get styles of a type 
	</p>
	<p>
	vStlNames = vStyles.getElementNames() 'names of styles for type For i = LBound(vStlNames) To UBound (vStlNames) 'for all styles of a type s=s &amp; i &amp; " : " &amp; vStlNames(i) &amp; Chr$(13) 'Build a display string 
	</p>
	<p>
	If ((i + 1) Mod 35 = 0) Then 'Display 35 at a time MsgBox s,0,vFamNames(n) 'Display them 
	</p>
	<p>
	s = "" 'Clear string, start over 
	</p>
	<p>
	End If 
	</p>
	<p>
	Next i 'Next style 
	</p>
	<p>
	If Len(s) &gt; 0 Then MsgBox s,0,vFamNames(n) 'Leftover styles for type Next n 'Next style type 
	</p>
	<p>
	End Sub 
	</p>
</blockquote>
<p>
<img src="media/image2.png" style="width:1.98134in;height:2.38458in" /> 
</p>
<blockquote>
	<p>
	<em> <strong>Figure 75.</strong> Frame styles known by the current document.</em> 
	</p>
	<p>
	OpenOffice is based on the same code as StarOffice, which had a desktop. All of the individual windows were contained in this desktop.  The desktop paradigm is now gone, but for legacy reasons a desktop object still acts as the global application that ties all of the documents together. Although I frequently see code that creates a desktop service by using the function CreateUnoService, this is not required in OOo Basic. OOo Basic provides the variable StarDesktop, which accesses the primary desktop service in OOo. The macro in Listing 227 demonstrates the use of the StarDesktop by traversing all of the currently open documents. The getDocType method is defined in Listing 219.  
	</p>
	<p>
	<em> <strong>Listing 227.</strong> Inspect each open component.</em> 
	</p>
	<p>
	Sub IterateThroughAllDocs 
	</p>
	<p>
	On Error Resume Next 'Ignore the non-document components Dim vComponents As Object 'All of the components 
	</p>
	<p>
	Dim vDocs As Object 'Enumeration of the documents Dim vDoc As Object 'A single document 
	</p>
	<p>
	Dim s As String 
	</p>
	<p>
	GlobalScope.BasicLibraries.LoadLibrary("Tools")'Contains FileNameOutOfPath vComponents = StarDesktop.getComponents() 'Get all the components vDocs = vComponents.createEnumeration() 'Enumerate them 
	</p>
	<p>
	Do While vDocs.hasMoreElements() 'While there are more vDoc = vDocs.nextElement() 'Get the next component s = s &amp; getDocType(vDoc) &amp; " " 'Add the document type s = s &amp; FileNameOutOfPath(vDoc.getURL()) 'Add the file name 
	</p>
	<p>
	s = s &amp; CHR$(10) 'Add a new line Loop 
	</p>
	<p>
	MsgBox s, 0, "Currently Open Components" 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	<strong>TIP</strong> The primary visible windows in OOo are called “components.” Every open document is a component, as is the Basic IDE and the Help window. In OOo, the word “component” almost always means an open document.  
	</p>
	<p>
	While iterating through the open documents (components), you may find some unexpected documents. These are component windows such as the Basic IDE and the Help window. The macro in Listing 227 uses the function FileNameOutOfPath. This is another macro and is not a function that is built into OOo Basic. This function is stored in the Strings module of the application-level Tools library. If a library is not currently loaded, you cannot call the methods that it contains.  
	</p>
	<p>
	The GlobalScope variable references the application-level libraries and is used to load the Tools library. Loading a library loads all of the modules in the specified library. OOo contains libraries and modules that are not built into OOo Basic. Use the LoadLibrary method before you use the routines in the libraries.  
	</p>
	<p>
	GlobalScope.BasicLibraries.LoadLibrary("Tools") 
	</p>
	<p>
	To access the Basic libraries in the current document, either use the BasicLibraries global variable or access the BasicLibraries property in the current document.  
	</p>
	<p>
	Print EqualUnoObjects(vObj.BasicLibraries, BasicLibraries) 'True 
	</p>
	<p>
	Use the DialogLibraries variable to access the dialog libraries in the current document. Unlike BasicLibraries, an individual document does not contain a property called DialogLibaries to directly obtain the dialog libraries for a specific document. You can easily obtain the dialog and Basic libraries for a specific document through a less direct route. Each document has a LibraryContainer property.  
	</p>
	<p>
	ThisComponent.LibraryContainer.getByName("OOME_30").getModuleContainer() ThisComponent.LibraryContainer.getByName("OOME_30").getDialogContainer() 
	</p>
	<p>
	The getByName() method on the LibraryContainer returns the named library. The getModuleContainer() method returns the Basic container for the specified library, and the getDialogContainer() method returns the Dialog container for the specified library. The code in Listing 228, however, uses the variables DialogLibraries and BasicLibraries to list the number of dialogs and modules in each library in the current document. Figure 76 shows the results.  
	</p>
	<p>
	<em> <strong>Listing 228.</strong> View the libraries and dialogs stored in the current document.</em> 
	</p>
	<p>
	Sub ExamineDocumentLibraries 
	</p>
	<p>
	Dim vLibs 'Hold the library names 
	</p>
	<p>
	Dim vMod 'Hold the modules/dialogs object 
	</p>
	<p>
	Dim nNumMods% 'Number of modules or dialogs in a library Dim i% 'Scrap index variable 
	</p>
	<p>
	Dim s$ 'Scrap string variable 
	</p>
	<p>
	s = "*** Dialog Libs In Document" &amp; CHR$(10) 'Initialize s vLibs = DialogLibraries.getElementNames() 'Library names 
	</p>
	<p>
	For i = LBound(vLibs) To UBound(vLibs) 'Look at each name 
	</p>
	<p>
	vMod = DialogLibraries.getByName(vLibs(i)) 'Get the dialog library nNumMods = UBound(vMod.getElementNames()) + 1 'How many dialogs 
	</p>
	<p>
	s = s &amp; vLibs(i) &amp; " has " &amp; nNumMods &amp; " dialogs" 'Build string s = s &amp; CHR$(10) 
	</p>
	<p>
	Next i 
	</p>
	<p>
	s = s &amp; CHR$(10) 
	</p>
	<p>
	s = s &amp; "*** Basic Libs In Document" &amp; CHR$(10) 'Ready for code libs vLibs = BasicLibraries.getElementNames() 'Library names 
	</p>
	<p>
	For i = LBound(vLibs) To UBound(vLibs) 'Look at each name vMod = BasicLibraries.getByName(vLibs(i)) 'Get the code library nNumMods = UBound(vMod.getElementNames()) + 1 'Number of modules 
	</p>
	<p>
	s = s &amp; vLibs(i) &amp; " has " &amp; nNumMods &amp; " modules" 'Build the string s = s &amp; CHR$(10) 
	</p>
	<p>
	Next i 
	</p>
	<p>
	MsgBox s, 0, "Libraries" End Sub 
	</p>
</blockquote>
<p>
<img src="media/image3.png" style="width:2.10167in;height:1.77833in" /> 
</p>
<blockquote>
	<p>
	<em> <strong>Figure 76.</strong> Dialog and Basic libraries in the current document.</em> 
	</p>
	<p>
	To view the libraries in the application-level library container, modify the code in Listing 228. Add GlobalScope before each occurrence of BasicLibraries and DialogLibraries.  
	</p>
</blockquote>
<h2 id="creating-uno-values-for-ooo-internals">
	<em>Creating UNO values for OOo internals</em> 
</h2>
<blockquote>
	<p>
	OOo Basic does an excellent job of converting between the native Basic types and the types required internally by OOo. However, if you call a method on a Universal Network Object and OOo Basic doesn’t know what the type should be, it may not properly convert the type. For example, the setPropertyValue method in the XPropertySet interface accepts two arguments — a string name of the property to set and the value to set. The type of the value to set depends on which property is set. Use the function CreateUnoValue (shown in Listing 229) to create a reference to a Universal Network Object that contains the appropriate type if there is a problem creating the correct type. I have never seen this happen, so don’t fret that much about your arguments; you can almost always trust OOo Basic to do the correct thing.  
	</p>
	<p>
	<em> <strong>Listing 229.</strong> Use CreateUnoValue to create a reference to an internal UNO value.</em> 
	</p>
	<p>
	Dim v 
	</p>
	<p>
	v = CreateUnoValue("unsigned long", 10) v = CreateUnoValue("string", "hello") 
	</p>
	<p>
	v = CreateUnoValue("byte", 10) 'A byte is from 0 through 255 v = CreateUnoValue("[]byte", Array(3, 2, 1)) 'You can even create arrays 'v = CreateUnoValue("Byte", 10) 'No such element exception 'v = CreateUnoValue("byte", 1000) 'Out of range exception 
	</p>
	<p>
	'v = CreateUnoValue("uint64", 10) 'No such element exception 
	</p>
	<p>
	The first argument to CreateUnoValue is the data type that should be created. The supported data types are void, char, boolean, byte, short, unsigned short, long, unsigned long, hyper, unsigned hyper, float, double, string, type, and any. The names are case sensitive and may be preceded by square brackets to indicate an array. The value returned by CreateUNOValue is not usable by OOo Basic; it is only useful to the internals of OOo. In other words, do not create a “byte” type and then expect to use it as a number.  
	</p>
	<p>
	<em> <strong>Listing 230.</strong> Test types supported by CreateUnoValue.</em> 
	</p>
	<p>
	Sub TestCreateUnoValues Dim typeNames 
	</p>
	<p>
	Dim v Dim i% 
	</p>
	<p>
	typeNames = Array("void", "boolean", "char", "byte", "string", _ "short", "unsigned short", "long", "unsigned long", _ "hyper", "unsigned hyper", "float", "double", "any") 
	</p>
	<p>
	' I took the list of names from 
	</p>
	<p>
	' cppu/source/typelib/typelib.cxx 
	</p>
	<p>
	For i = LBound(typeNames) To UBound(typeNames) v = CreateUnoValue(typeNames(i), 65) 
	</p>
	<p>
	' You cannot directly use the value because it is an UNO type, ' which is only good for passing back into UNO.  
	</p>
	<p>
	' Things like "Print v" or "CStr(v)" will fail.  
	</p>
	<p>
	Next End Sub 
	</p>
</blockquote>
<h2 id="finding-objects-and-properties">
	<em>Finding objects and properties</em> 
</h2>
<blockquote>
	<p>
	OOo Basic has functions to find variables and their properties based on their names. This functionality was initially described to me as poorly documented, possibly deprecated, and buggy — and I cannot disagree. Use FindObject to obtain a reference to a variable with a given name, and FindPropertyObject to obtain a reference to a named property of an object. The macro in Listing 231 demonstrates some of the idiosyncrasies of the FindObject and FindPropertyObject functions.  
	</p>
	<p>
	<strong>TIP</strong> Do not use the functions FindObject and FindPropertyObject — they are poorly documented, buggy, and likely to be deprecated. I only mention the methods to be complete.  
	</p>
	<p>
	<em> <strong>Listing 231.</strong> Test the FindObject method.</em> 
	</p>
	<p>
	Sub TestFindObject Dim oTst 
	</p>
	<p>
	Dim oDoc 'Initial value is EMPTY, whis ic not null. Dim oLib 'Gimmicks library.  
	</p>
	<p>
	Dim oMod 'UserFields module in the Gimmicks library.  
	</p>
	<p>
	Dim s$ 
	</p>
	<p>
	oTst = FindObject("oDoc") 
	</p>
	<p>
	s = "oTst = FindObject(""oDoc""), " &amp; CHR$(10) &amp; _ "IsNull(oTst) = " &amp; IsNull(oTst) &amp; _ 
	</p>
	<p>
	" and (oTst IS oDoc) = " &amp; (oTst IS oDoc) 
	</p>
	<p>
	Rem Test against the current document oDoc = ThisComponent 
	</p>
	<p>
	oTst = FindObject("oDoc") 
	</p>
	<p>
	s = s &amp; CHR$(10) &amp; CHR$(10) &amp; _ 
	</p>
	<p>
	"oDoc = ThisComponent" &amp; CHR$(10) &amp; _ 
	</p>
	<p>
	"oTst = FindObject(""oDoc"")" &amp; CHR$(10) &amp; _ 
	</p>
	<p>
	"oDoc IS ThisComponent = " &amp; (oDoc IS ThisComponent) &amp; CHR$(10) &amp; _ "oTst IS oDoc = " &amp; (oTst IS oDoc) &amp; CHR$(10) &amp; _ 
	</p>
	<p>
	"oTst IS ThisComponent = " &amp; (oTst IS ThisComponent) &amp; _ CHR$(10) &amp; CHR$(10) &amp; _ 
	</p>
	<p>
	"oTst = FindObject(""ThisComponent"")" &amp; CHR$(10) 
	</p>
	<p>
	REM Do it again, but do search for ThisComponent oTst = FindObject("ThisComponent") 
	</p>
	<p>
	s = s &amp; "oTst IS oDoc" &amp; (oTst IS oDoc) &amp; CHR$(10) &amp; _ 
	</p>
	<p>
	"oTst IS ThisComponent = " &amp; (oTst IS ThisComponent) &amp; CHR$(10) &amp; _ "oDoc IS ThisComponent = " &amp; ( oDoc IS ThisComponent) &amp; CHR$(10) 
	</p>
	<p>
	REM ThisComponent has a DocumentInfo property 
	</p>
	<p>
	oTst = FindPropertyObject(ThisComponent, "DocumentInfo") 
	</p>
	<p>
	s = s &amp; "IsNull(FindPropertyObject(ThisComponent, " &amp; _ """DocumentInfo""))" &amp; CHR$(10) &amp; _ 
	</p>
	<p>
	"returns " &amp; IsNull(oTst) MsgBox s 
	</p>
	<p>
	REM Load the Gimmicks library GlobalScope.BasicLibraries.LoadLibrary("Gimmicks") 
	</p>
	<p>
	REM Find the library even though it is not a variable oLib = FindObject("Gimmicks") 
	</p>
	<p>
	REM userfields is a module in the Gimmicks library oMod = FindPropertyObject(oLib, "Userfields") 
	</p>
	<p>
	s = "And now for something different." &amp; CHR$(10) &amp; _ "Find the loaded Gimmicks library" &amp; CHR$(10) &amp; _ 
	</p>
	<p>
	"oMod Is Gimmicks.Userfields = " &amp; (oMod Is Gimmicks.Userfields) 
	</p>
	<p>
	MsgBox s 
	</p>
	<p>
	'The StartChangesUserfields function is in the module Userfields 'Call the routine 
	</p>
	<p>
	Print "Call 'StartChangesUserfields' directly" oLib.Userfields.StartChangesUserfields 
	</p>
	<p>
	Print "Call 'StartChangesUserfields' using oMod" oMod.StartChangesUserfields 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	If these functions serve your purposes, use them. I tried to use these to write an object inspector, but the FindPropertyObject function did not work as I expected.  
	</p>
</blockquote>
<h2 id="uno-listeners">
	<em>UNO listeners</em> 
</h2>
<blockquote>
	<p>
	OOo uses listeners to inform other objects what it is doing. Consider a hospital worker as an analogy: Before I (the hospital worker) do anything interesting to treat patient Paolo, I am required first to call his parents.  
	</p>
	<p>
	For some things the parents may say “no, you cannot do that”, and for others the parents are only informed (status updates). This is very similar to UNO listeners. The code that you write is called the listener, and the thing to which you listen is called the broadcaster.  In the previous example, the hospital worker is the broadcaster and Paolo’s parents are the listeners.  
	</p>
	<p>
	You can listen to the OOo objects that act as a broadcaster. The routines required to listen to a specific OOo interface are specific to that interface. In other words, the set of subroutines and functions that can act as a listener to printing events is different than the set of subroutines and functions that can listen to keystroke events.  
	</p>
	<p>
	<strong>TIP</strong> If you do not implement a required method specified for the listener interface, the listener may crash OOo.  
	</p>
</blockquote>
<h1 id="your-first-listener">
	Your first listener 
</h1>
<blockquote>
	<p>
	This listener is presented with details that are explained in the next section, so, follow the easy process and then find out why. A print listener is demonstrated in section 13.15.3 A Calc example with a Print listener.  
	</p>
	<p>
	All listeners must implement the methods in the com.sun.star.lang.XEventListener interface, which defines a one subroutine; disposing(EventObject). The disposing method is called when the broadcaster is about to become unavailable. In other words, the broadcaster will no longer exist and you should not use it. For example, a print job is finished so it is no longer required or a document is closing. Listing 232 demonstrates the most basic listener possible, XEventListener; Notice the string prefix “first_listen_” before the required name “disposing”; I chose “first_listen_” because it is descriptive.  
	</p>
	<p>
	<em> <strong>Listing 232.</strong> Simple listener that does nothing.</em> 
	</p>
	<p>
	Sub first_listen_disposing( vArgument ) MsgBox "Disposing In First Listener" 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	Listing 232 is all that is required for this simple listener. Use the CreateUNOListener to create a UNO listener that is associated with the macro in Listing 232. The first argument is the string prefix and the second argument is the name of the service to create.  
	</p>
	<p>
	The routine in Listing 233 creates the UNO listener and associates it with the routine in Listing 232. When the disposing method is called on vListener, it calls the routine in Listing 232.  
	</p>
	<p>
	<strong>TIP</strong> The code in Listing 233 creates a listener and then calls the objects disposing method. The listener is implemented in Listing 232, so, this ultimately calls first_listen_disposing in Listing 232.  
	</p>
	<p>
	<em> <strong>Listing 233.</strong> Create a listener and then call the disposing method.</em> 
	</p>
	<p>
	Sub MyFirstListener Dim vListener 
	</p>
	<p>
	Dim vEventObj As New com.sun.star.lang.EventObject Dim sPrefix$ 
	</p>
	<p>
	Dim sService$ 
	</p>
	<p>
	sPrefix = "first_listen_" 
	</p>
	<p>
	sService = "com.sun.star.lang.XEventListener" vListener = CreateUnoListener(sPrefix, sService) vListener.disposing(vEventObj) 
	</p>
	<p>
	End Sub 
	</p>
</blockquote>
<h1 id="a-complete-listener-selection-change-listener">
	A complete listener: selection change listener 
</h1>
<blockquote>
	<p>
	The two most difficult parts of creating a listener are determining which broadcaster and which listener interface to use. The rest of the steps are easier.  
	</p>
</blockquote>
<ol type="1">
	<li>
		<p>
		Determine the broadcaster to use.  
		</p>
	</li>
	<li>
		<p>
		Determine the listener interface to implement.  
		</p>
	</li>
	<li>
		<p>
		Create global variables for the listener and maybe the broadcaster. Test your understanding and ask yourself why the variable must be global before reading the tip below.  
		</p>
	</li>
	<li>
		<p>
		Determine the prefix that you will use; make it descriptive.  
		</p>
	</li>
	<li>
		<p>
		Write all of the subroutines and functions that implement the listener.  
		</p>
	</li>
	<li>
		<p>
		Create the UNO listener and save it in the global variable.  
		</p>
	</li>
	<li>
		<p>
		Register the listener with the broadcaster.  
		</p>
	</li>
	<li>
		<p>
		When finished, remove the listener from the broadcaster.  
		</p>
	</li>
</ol>
<blockquote>
	<p>
	<strong>TIP</strong> Why store the listener in a global variable?  There is usually a subroutine to create and register the listener with the broadcaster and then the macro ends. The listener must exist when the macro stops running. The 
	</p>
	<p>
	only way to do this in Basic is to use a Global variable. Another macro, run later, removes the listener from the broadcaster. The latter macro must be able to access the listener.  
	</p>
	<p>
	Knowing which broadcaster to use is not always an easy task. It requires understanding how OOo is designed; this comes with experience.  There is usually an obvious place to start looking — the current document, available from the variable ThisComponent, contains the document data. For example, the document accepts an XPrintJobListener to monitor how printing is progressing. Most tasks related to user interactions — such as selecting text, moving the mouse, and entering keystrokes — all go through the document’s controller.  
	</p>
	<p>
	After selecting the broadcaster check the broadcaster for methods with names like “add listener”. I was asked how to prevent a dialog from closing when the user clicks on the little X icon in the upper-right corner of a dialog. I reasoned that the dialog is probably the correct broadcaster to use, so I created a dialog and inspected the “dbg_methods” property to see which listeners it supports (each supported listener has “set” and “remove” methods). Another option is to determine the event type that is produced and then search for broadcasters supporting this event type. I usually do this by searching the OOo Developer’s Guide and the Internet; I discuss effective methods for finding information in Chapter 19, Sources of Information.  
	</p>
	<p>
	To listen for a selection change event, implement an XSelectionChangeListener and register it with the current controller.  The XSelectionChangeListener interface defines only one subroutine that must be implemented — selectionChanged(ObjectEvent). All listeners are derived from the XEventListener so the disposing(ObjectEvent) method must also be implemented. The fastest way to determine which subroutines and functions must be implemented is to create an instance of the listener by using the function CreateUNOListener and then inspect the dbg_methods property (see Listing 234 and Figure 77).  
	</p>
	<p>
	<em> <strong>Listing 234.</strong> See the methods supported by a specific listener.</em> 
	</p>
	<p>
	Sub InspectListenerMethods Dim sPrefix$ 
	</p>
	<p>
	Dim sService$ Dim vService 
	</p>
	<p>
	sPrefix = "sel_change_" 
	</p>
	<p>
	sService = "com.sun.star.view.XSelectionChangeListener" vService = CreateUnoListener(sPrefix, sService) DisplayDbgInfoStr(vService.dbg_methods, ";", 35, "Methods") 
	</p>
	<p>
	End Sub 
	</p>
</blockquote>
<p>
<img src="media/image4.png" style="width:3.01662in;height:1.16198in" /> 
</p>
<blockquote>
	<p>
	<em> <strong>Figure 77.</strong> Ignore the queryInterface method.</em> 
	</p>
	<p>
	The queryInterface method is from the interface com.sun.star.uno.XInterface, which is inherited from the XEventListener.  You can ignore this method. However, you must implement the rest of the routines. Choose a descriptive prefix so that the code can contain more than one listener. See Listing 235.  
	</p>
	<p>
	<em> <strong>Listing 235.</strong> Disposing and selection changed.</em> 
	</p>
	<p>
	'All listeners must support this event Sub sel_change_disposing(vEvent) 
	</p>
	<p>
	msgbox "disposing the selection change listener" End Sub 
	</p>
	<p>
	Sub sel_change_selectionChanged(vEvent) 
	</p>
	<p>
	Dim vCurrentSelection As Object vCurrentSelection = vEvent.source Print "Number of selected areas = " &amp;_ 
	</p>
	<p>
	vCurrentSelection.getSelection().getCount() 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	The routine in Listing 236 creates a listener by calling the function CreateUnoListener. When I tested this listener, I ran the macro and then the macro stopped running. The listener is still active and called by the broadcaster even though the macro is no longer running. In other words, the routine in Listing 236 registers a listener, and then it is finished. The broadcaster calls the listener when things occur. The listener must be stored in a global variable so that it’s available later — for example, when it’s time to remove the listener from the object or when one of the methods is called.  
	</p>
	<p>
	<em> <strong>Listing 236.</strong> Start listening for selection change events.</em> 
	</p>
	<p>
	Global vSelChangeListener 'Must be global Global vSelChangeBroadCast 
	</p>
	<p>
	'Run this macro to start event intercepting Sub StartListeningToSelChangeEvents 
	</p>
	<p>
	Dim sPrefix$ Dim sService$ 
	</p>
	<p>
	sPrefix = "sel_change_" 
	</p>
	<p>
	sService = "com.sun.star.view.XSelectionChangeListener" 
	</p>
	<p>
	REM to register for a selection change, you must register with the REM current controller 
	</p>
	<p>
	vSelChangeBroadCast = ThisComponent.getCurrentController 'Create a listener to intercept the selection change events 
	</p>
	<p>
	vSelChangeListener = CreateUnoListener(sPrefix, sService) 
	</p>
	<p>
	'Register the listener to the document controller vSelChangeBroadCast.addSelectionChangeListener(vSelChangeListener) 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	The behavior of the code in Listing 235 is annoying. Every time a new selection is made, the code is called and it opens a dialog on the screen. This interferes with selecting text. To remove the listener, use the code in Listing 237.  
	</p>
	<p>
	<em> <strong>Listing 237.</strong> Stop listening for selection change events.</em> 
	</p>
	<p>
	Sub StopListeningToSelChangeEvents ' removes the listener 
	</p>
	<p>
	vSelChangeBroadCast.removeSelectionChangeListener(vSelChangeListener) End Sub 
	</p>
	<p>
	To test the listener: 
	</p>
</blockquote>
<ol type="1">
	<li>
		<p>
		Start listening.  
		</p>
	</li>
	<li>
		<p>
		Make very simple selection changes such as: Click someplace.  Shift+Click to select more. Ctrl+Click to make a second selection.  
		</p>
	</li>
	<li>
		<p>
		Stop listening.  
		</p>
	</li>
</ol>
<blockquote>
	<p>
	Save all open documents while testing listeners, a simple error is likely to cause OOo to crash.  
	</p>
</blockquote>
<h2 id="creating-a-uno-dialog">
	<em>Creating a UNO dialog</em> 
</h2>
<blockquote>
	<p>
	Use CreateUnoDialog to create an existing dialog. This section introduces the function CreateUnoDialog, it does not discuss how to create dialogs. CreateUnoDialog accepts a single argument, the full path to the dialog definition.  
	</p>
	<p>
	CreateUnoDialog(GlobalScope.BasicLibraries.LibName.DialogName) 
	</p>
	<p>
	The variable GlobalScope provides access to the application-level libraries. The Tools library contains the dialog named DlgOverwriteAll; you must load the library containing the dialog before you can use the dialog. You can manually load the library, or do it directly from the macro. Use <strong>Tools &gt; Macros &gt; Organize Dialogs</strong> to open the Basic Macros Organizer dialog, which can be used To manually load libraries. Use the LoadLibrary command to load a library using a macro.  
	</p>
	<p>
	GlobalScope.BasicLibraries.LoadLibrary("Tools") CreateUnoDialog(GlobalScope.BasicLibraries.Tools.DlgOverwriteAll) 
	</p>
	<p>
	If the dialog is defined inside a document, use the BasicLibraries variable.  
	</p>
	<p>
	CreateUnoDialog(BasicLibraries.LibName.DialogName) 
	</p>
	<p>
	<strong>TIP</strong> An event means that something happened. When certain things happen, an event object is created that describes something about what happened. The event object is sent to a listener, or what ever routine is configured to be called when the event occurs.  You can write an “event” routine that is called when 
	</p>
	<p>
	something happens; for example, when a button is pressed.  
	</p>
	<p>
	When you create a dialog, you usually write event handlers as subroutines in Basic; for example, a button in a dialog does nothing unless events are mapped to subroutines or functions that you write. You can add a close button to a dialog and map the button's “Execute action” event to a macro that closes the dialog. If a macro called from an event handler accesses a running dialog, then the dialog must be stored in a variable 
	</p>
	<p>
	that the macro can access. I generally choose to create a private variable that holds this type of data. See Listing 238.  
	</p>
	<p>
	<em> <strong>Listing 238.</strong> Display information about an object using a dialog.</em> 
	</p>
	<p>
	Private MySampleDialog 
	</p>
	<p>
	Sub DisplayObjectInformation(Optional vOptionalObj) 
	</p>
	<p>
	Dim vControl 'Access the text control in the dialog. Dim s$ 'Temporary string variable.  
	</p>
	<p>
	Dim vObj 'Object about which to display information.  
	</p>
	<p>
	REM If vOptionalObj object is not provided, use the current document.  
	</p>
	<p>
	If IsMissing(vOptionalObj) Then vObj = ThisComponent 
	</p>
	<p>
	Else 
	</p>
	<p>
	vObj = vOptionalObj End If 
	</p>
	<p>
	REM Create the dialog and set the title 
	</p>
	<p>
	MySampleDialog = CreateUnoDialog(DialogLibraries.OOME_30.MyFirstDialog) MySampleDialog.setTitle("Variable Type " &amp; TypeName(vObj)) 
	</p>
	<p>
	REM Get the text field from the dialog REM I added this text manually 
	</p>
	<p>
	vControl = MySampleDialog.getControl("TextField1") 
	</p>
	<p>
	If InStr(TypeName(vObj), "Object") &lt; 1 Then 
	</p>
	<p>
	REM If this is NOT an object, simply display simple information vControl.setText(Dlg_GetObjTypeInfo(vObj)) 
	</p>
	<p>
	ElseIf NOT HasUnoInterfaces(vObj, "com.sun.star.uno.XInterface") Then REM It is an object but it is not a UNO object.  
	</p>
	<p>
	REM Cannot call HasUnoInterfaces if it is not an UNO object.  vControl.setText(Dlg_GetObjTypeInfo(vObj)) 
	</p>
	<p>
	Else 
	</p>
	<p>
	REM This is a UNO object so attempt to access the "dbg_" properties MySampleDialog.setTitle("Variable Type " &amp; vObj.getImplementationName()) s = "*************** Methods **************" &amp; CHR$(10) &amp;_ 
	</p>
	<p>
	Dlg_DisplayDbgInfoStr(vObj.dbg_methods, ";") &amp; CHR$(10) &amp;_ "*************** Properties **************" &amp; CHR$(10) &amp;_ Dlg_DisplayDbgInfoStr(vObj.dbg_properties, ";") &amp; CHR$(10) &amp;_ "*************** Services **************" &amp; CHR$(10) &amp;_ Dlg_DisplayDbgInfoStr(vObj.dbg_supportedInterfaces, CHR$(10)) 
	</p>
	<p>
	vControl.setText(s) End If 
	</p>
	<p>
	REM tell the dialog to start itself MySampleDialog.execute() 
	</p>
	<p>
	End Sub 
	</p>
	<p>
	<strong>TIP</strong> Store the dialog in a private variable declared as type Object. Use a private variable so that it doesn’t needlessly affect other modules. On at least one occasion, a dialog that I created worked when it was held in a variable declared as an Object, but failed when held in a variable declared as a Variant; so much for my 
	</p>
	<p>
	recommendation to usually a variant rather than an Object.  
	</p>
	<p>
	The macro in Listing 238 displays a dialog that displays information about the object that was passed in as an argument. I use the HasUnoInterfaces function to see if this is a UNO service. I first check to see if the object’s TypeName contains the text “Object”; this tells me if the object is really an object.  
	</p>
	<p>
	If InStr(TypeName(vObj), "Object") &lt; 1 Then 
	</p>
	<p>
	If the object is not an object that supports a UNO interface, the object is inspected and information about it displayed. Listing 239 shows the text string to do this. Figure 78 shows the results.  
	</p>
	<p>
	<em> <strong>Listing 239.</strong> Return type information as a string.</em> 
	</p>
	<p>
	Function Dlg_GetObjTypeInfo(vObj) As String Dim s As String 
	</p>
	<p>
	s = "TypeName = " &amp; TypeName(vObj) &amp; CHR$(10) &amp;_ "VarType = " &amp; VarType(vObj) &amp; CHR$(10) 
	</p>
	<p>
	If IsNull(vObj) Then 
	</p>
	<p>
	s = s &amp; "IsNull = True" 
	</p>
	<p>
	ElseIf IsEmpty(vObj) Then s = s &amp; "IsEmpty = True" 
	</p>
	<p>
	Else 
	</p>
	<p>
	If IsObject(vObj) Then s = s &amp; "IsObject = True" &amp; CHR$(10) 
	</p>
	<p>
	If IsUnoStruct(vObj) Then s = s &amp; "IsUnoStruct = True" &amp; CHR$(10) If IsDate(vObj) Then s = s &amp; "IsDate = True" &amp; CHR$(10) 
	</p>
	<p>
	If IsNumeric(vObj) Then s = s &amp; "IsNumeric = True" &amp; CHR$(10) If IsArray(vObj) Then 
	</p>
	<p>
	On Local Error Goto DebugBoundsError: 
	</p>
	<p>
	Dim i%, sTemp$ 
	</p>
	<p>
	s = s &amp; "IsArray = True" &amp; CHR$(10) &amp; "range = (" Do While (i% &gt;= 0) 
	</p>
	<p>
	i% = i% + 1 
	</p>
	<p>
	sTemp$ = LBound(vObj, i%) &amp; " To " &amp; UBound(vObj, i%) If i% &gt; 1 Then s = s &amp; ", " 
	</p>
	<p>
	s = s &amp; sTemp$ Loop DebugBoundsError: 
	</p>
	<p>
	On Local Error Goto 0 s = s &amp; ")" &amp; CHR$(10) 
	</p>
	<p>
	End If End If 
	</p>
	<p>
	Dlg_GetObjTypeInfo = s End Function 
	</p>
</blockquote>
<p>
<img src="media/image5.png" style="width:3.01548in;height:1.03062in" /> 
</p>
<blockquote>
	<p>
	<em> <strong>Figure 78.</strong> The variable is an array of strings</em> 
	</p>
	<p>
	If the first argument supports a UNO interface, the “dbg_” properties are used to display all of the methods, properties, and services supported by this object (see Listing 240 and Figure 79). This is very similar to the code in Listing 221, except that it returns a string rather than displaying a series of simple dialogs. This is an excellent way to quickly see what methods, properties, and interfaces an object supports. Notice also that the variable type is displayed in the upper-left corner of the dialog.  
	</p>
	<p>
	<em> <strong>Listing 240.</strong> Convert the debug string into one string with new line characters.</em> 
	</p>
	<p>
	Function Dlg_DisplayDbgInfoStr(sInfo$, sSep$) As String 
	</p>
	<p>
	Dim aInfo() 'Array to hold each string 
	</p>
	<p>
	Dim i As Integer 'Index variable 
	</p>
	<p>
	Dim j As Integer 'Junk integer variable for temporary values 
	</p>
	<p>
	Dim s As String 'holds the portion that is not completed s = sInfo$ 
	</p>
	<p>
	j = InStr(s, ":") 'Initial colon 
	</p>
	<p>
	If j &gt; 0 Then Mid(s, 1, j, "") 'Remove portion up to the initial colon aInfo() = Split(s, sSep$) 'Split string based on delimiter For i = LBound(aInfo()) To Ubound(aInfo()) 'Look at each piece to remove 
	</p>
	<p>
	aInfo(i) = Trim(aInfo(i)) 'leading and trailing spaces 
	</p>
	<p>
	j = InStr(aInfo(i), CHR$(10)) 'Some have an extra 
	</p>
	<p>
	If j &gt; 0 Then Mid(aInfo(i), j, 1, "") 'new line that should be removed Next 
	</p>
	<p>
	Dlg_DisplayDbgInfoStr = Join(aInfo(), CHR$(10)) End Function 
	</p>
</blockquote>
<p>
<img src="media/image6.png" style="width:6.52974in;height:4.15281in" /> 
</p>
<blockquote>
	<p>
	<em> <strong>Figure 79.</strong> The variable is a Writer document.</em> 
	</p>
</blockquote>
<h2 id="conclusion">
	<em>Conclusion</em> 
</h2>
<blockquote>
	<p>
	The subroutines and functions supplied with OOo Basic support a wide range of operations that are required to access the internals of OOo.  Use the methods presented in this chapter to inspect and use the UNO services. This chapter examined the fundamentals for creating UNO listeners. UNO listeners provide basic system functionality, and new UNO listeners extend this functionality to give the programmer a great deal of control over system applications and behavior. Any UNO listener listens to one or more broadcasters, providing the capability to respond to system events that are communicated across applications.  
	</p>
</blockquote>
