<p>
    <img src="Pictures/10000000000003520000044CC565B2FF.png" style="width:8in;height:9.3201in" />
</p>
<p>
    <span id="Last Modified"></span>Last Modified
</p>
<p>
    at
</p>
<p>
    Document Revision:
</p>
<h1 id="general-information">
    <span id="anchor"></span>General Information
</h1>
<p>
    The contents of this document is Copyright 2011 - 2014 by Andrew D. Pitonyak. I will make a final license decision
    when I am finished.
</p>
<p>
    I created a second edition that was never released, which is why I refer to this book as the third edition.
</p>
<p>
    I have been repeatedly asked about the cover page so.... I am neither an artist nor a designer, the cover was
    created by Amanda Barham (see <a href="http://www.amandabarham.com/">http://www.amandabarham.com</a>). She did an
    awesome job.
</p>
<p>
    Many people contributed to this document in one form or another. Feedback from community members helps greatly. For
    reasons I don't understand, my wife allows me to take time away from my family to work on this document, so, I
    suppose that the person to really thank is her (send her enough money that she can get a fully body massage and she
    may force me to work on this document).
</p>
<p>
    While taking this document to the latest version, many errors, corrections, and suggestions were provided by Volker
    Lenhardt who is providing a full translation into German. This document has been greatly improved based on his work.
</p>
<p>
    Thank you Volker Lenhardt (<a
        href="https://www.uni-due.de/~abi070/ooo.html">https://www.uni-due.de/~abi070/ooo.html</a>).
</p>
<h1 id="table-of-contents">
    <span id="anchor-1"></span>Table of Contents
</h1>
<ol type="1">
    <li>
        <h1 id="introduction-and-housekeeping">
            <span id="anchor-2"></span>Introduction and housekeeping
        </h1>
    </li>
</ol>
<p>
    First, there was the first edition of OpenOffice.org Macros Explained (OOME). A few years later I produced the
    second edition, updated to match OpenOffice.org (OOo) version 2.x, but the second edition was never released. Now, I
    feel that it is time for a third edition.
</p>
<p>
    Most of the content from previous editions is still here. The initial chapters dealing with language syntax are
    mostly unchanged except for new features added to the language.
</p>
<p>
    The number of services supported by OOo has more than doubled since I last published, and there is significant new
    capability. There is, unfortunately, more capability than I have time or room to document. Unfortunately, as
    extensive as this book is, much is missing. You should use this book, therefore, as a reference with numerous
    examples, but, always remember that OOo is constantly changing and supporting more features.
</p>
<p>
    The document contains buttons that trigger the macros in the text. This is fabulous while reading the original
    source, but it provides for undesirable artifacts in printed form; sorry about that.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="comments-from-the-author">
                    <span id="anchor-3"></span>Comments from the author
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    I am the primary author of this document. I do not make a living working with OOo, and nothing in here is related to
    my primary day job. In other words, I am simply another member of the OOo community who does this without
    remuneration.
</p>
<p>
    I receive numerous requests for help because I am highly visible in the OOo community. Unfortunately, I am
    over-time-committed, and it is difficult to provide personal help to all. I enjoy helping people in my non-existent
    spare time, but, be certain to use existing material, mailing lists, and forums if possible. I occasionally provide
    solutions on a commission basis, but I lack the time for large tasks.
</p>
<p>
    I appreciate comments and bug reports. If you have something interesting that you think should be included, let me
    know. If you want to write an entire section or chapter, do so. I will likely highly edit what you produce. Please,
    provide feedback and suggestions by sending an email to <a
        href="mailto:andrew@pitonyak.org">andrew@pitonyak.org</a>.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="environment-and-comments">
                    <span id="anchor-4"></span>Environment and comments
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    My primary work is performed using 64-bit Fedora Linux with the en-US locale. Gnome is my desktop environment, which
    affects screen shots. Little to no testing has been done by me in other environments. I use both LibreOffice (LO)
    and Apache OpenOffice (AOO) and I use the term OpenOffice, OO, or OOo to generically refer to either product.
</p>
<p>
    AOO and LO are changing independently, and as time passes, the APIs, features, and user interfaces become less
    similar. The result is a macro that works in LO may fail in AOO, and vice versa. Also, rapid development means that
    changes occur faster than time permits me to produce documentation; I receive no renumeration for my time spent on
    this document.
</p>
<p>
    The best way to find out what works on your chosen platform is testing and inspection. By inspection, I mean that
    you should inspect object instances to determine the supported properties, methods, constants, enumerations,
    structures, services, and interfaces.
</p>
<ol type="1">
    <li>
        <h1 id="getting-started">
            <span id="anchor-5"></span>Getting Started
        </h1>
    </li>
</ol>
<p>
    In OpenOffice.org (OOo), macros and dialogs are stored in documents and libraries. The included integrated
    development environment (IDE) is used to create and debug macros and dialogs. This chapter introduces the basic
    concepts of starting the IDE and creating macros by showing the steps to produce a simple macro, which displays the
    text “Hello World” on the screen.
</p>
<p>
    A macro is a saved sequence of commands or keystrokes stored for later use. An example of a simple macro is one that
    “types” your address. Macros support commands that allow a variety of advanced functions, such as making decisions
    (for example, if the balance is less than zero, color it red; if not, color it black), looping (while the balance is
    greater than zero, subtract 10), and even interacting with a person (asking the user for a number). Some of these
    commands are based on the BASIC programming language. (BASIC is an acronym for Beginner’s All-purpose Symbolic
    Instruction Code.) It is common to assign a macro to a keystroke or toolbar icon so that it can be quickly started.
</p>
<p>
    A dialog – or dialog box – is a type of window used to have a “dialog” with a user. The dialog may present
    information to the user, or obtain input from the user. You can create your own dialogs and store them in a module
    with your macros.
</p>
<p>
    The OpenOffice.org macro language is very flexible, allowing automation of both simple and complex tasks. Although
    writing macros and learning about the inner workings of OpenOffice.org can be a lot of fun, it is not always the
    best approach. Macros are especially useful when you have to do a task the same way over and over again, or when you
    want to press a single button to do something that normally takes several steps. Once in a while, you might write a
    macro to do something you can’t otherwise do in OpenOffice.org, but in that case you should investigate thoroughly
    to be sure OOo cannot do it. For instance, a common request on some of the OpenOffice.org mailing lists is for a
    macro that removes empty paragraphs. This functionality is provided with AutoFormat (select Tools &gt; AutoCorrect
    Options &gt; Options tab and check <em>Remove blank paragraphs</em>). It is also possible to use regular expressions
    to search for and replace empty space. There is a time and a purpose for macros, and a time for other solutions.
    This chapter will prepare you for the times when a macro is the solution of choice.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="macro-storage">
                    <span id="anchor-6"></span>Macro storage
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    In OpenOffice.org, routines that are logically related are stored in a module. For example, a module might contain
    routines for finding common mistakes that require editing. Logically related modules are stored in a library, and
    libraries are stored in library containers. The OpenOffice.org application can act as a library container, as can
    any OOo document. Simply stated, the OpenOffice.org application and every OpenOffice.org document can contain
    libraries, modules, and macros.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Container
            </td>
            <td>
                A library container contains zero or more libraries.
            </td>
        </tr>
        <tr class="even">
            <td>
                Library
            </td>
            <td>
                A library contains zero or more modules and dialogs.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Module
            </td>
            <td>
                A module contains zero or more subroutines or functions.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="library-container">
                            <span id="anchor-7"></span>Library container
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    An OOo document is a library container, as is the application itself. If a specific document requires a macro, it is
    useful to store that macro in the document. The advantage is that the macro stays with the document. This is also an
    easy way to send macros to others.
</p>
<p>
    If several documents use the same macros, however, then every document will have a copy, and, if you change the
    macro, then you must change it in every document that contains the macro. Macros contained in a document are visible
    only to that document. It is not easy, therefore, to call a macro in a document from outside of that document.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Do not (except in rare exceptions) store macros that will be called from outside a document in a
                document; because macros contained in a document are visible only to that document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The application library container has two primary components, macros distributed with OOo, and macros that you
    create. The OOo macro dialog shows your macros in a container named “My Macros”, and those distributed as
    “OpenOffice.org Macros” (see ). OpenOffice.org Macros are stored in a directory with the application, and My Macros
    are stored in your user directories.
</p>
<p>
    Use Tools &gt; Macros &gt; Organize Macros &gt; OpenOffice.org Basic to open the OOo Basic Macros dialog (see ). The
    library containers are the highest level objects shown in the “Macro from” area.
</p>
<p>
    <img src="Pictures/10000000000002C6000001352A8EC9D4.png" style="width:7in;height:3.0402in" />
</p>
<p>
    <strong>Figure .</strong> Use the OOo Macros dialog to create new macros and organize libraries.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="libraries">
                            <span id="anchor-8"></span>Libraries
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A <em>library container</em> contains one or more libraries, and a <em>library</em> contains one or more modules and
    dialogs. Double-click on a library container in to see the contained libraries. Double-click on a library to load
    the library and see the contained modules and dialogs.
</p>
<p>
    The OOo Macros dialog uses a different icon to distinguish loaded libraries; in , Standard and XrayDyn are loaded,
    the other libraries are not.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The icons and colors that you see on your computer may be different than those shown in the screen
                shots. Different versions of OOo may use different icons and colors. and more than one icon set is
                supported. Use Tools &gt; Options &gt; OpenOffice.org &gt; View to change the icon size and style.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <img src="Pictures/10000000000002C600000135BDF539AC.png" style="width:7in;height:3.0402in" />
</p>
<p>
    <strong>Figure .</strong> Loaded libraries are shown differently.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="modules-and-dialogs">
                            <span id="anchor-9"></span>Modules and dialogs
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A module is typically used to group similar functionality at a lower level than a library. The macros are stored in
    the modules. To create a new module, select a library and click New.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="key-points">
                            <span id="anchor-10"></span>Key points
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Things to consider:
</p>
<ul>
    <li>
        You can import libraries from one library container to another.
    </li>
    <li>
        Import a module by importing the library that contains the module. It is not possible to simply import a single
        module using the GUI.
    </li>
    <li>
        Use descriptive names for libraries, modules, and macros. Descriptive names reduce the likelihood of a name
        collision, which hampers library import.
    </li>
    <li>
        The Standard library is special; it is automatically loaded so the contained macros are always available.
    </li>
    <li>
        The Standard library is automatically created by OOo and cannot be imported.
    </li>
    <li>
        Macros contained in a library are not available until after the library is loaded.
    </li>
    <li>
        The Macro organizer dialog allows you to create new modules, but not new libraries.
    </li>
</ul>
<p>
    The key points listed above have certain consequences; for example, I rarely store macros in the Standard library
    because I cannot import the library to another location. My usual usage for the standard library is for macros
    called from buttons in a document. The macros in the standard library then load the actual work macros in other
    libraries, and call them.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="creating-new-modules-and-libraries">
                    <span id="anchor-11"></span>Creating new modules and libraries
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The New button on the Macros dialog always creates a new subroutine in the selected library (see and ). A new module
    is created if the library does not yet contain a module.
</p>
<p>
    From the Macros dialog, click the Organizer button to open the OOo Macro Organizer dialog (see ). The Modules and
    Dialogs tabs are almost identical. Use the Modules or Dialogs tab to create, delete, and rename modules or dialogs.
</p>
<p>
    <img src="Pictures/10000000000002180000012D1B64AEFC.png" style="width:5.5835in;height:3.1354in" />
</p>
<p>
    <strong>Figure .</strong> Modules tab of the OOo Macro Organizer dialog.
</p>
<p>
    Use the Libraries tab (see ) to create, delete, rename, import, and export libraries.
</p>
<p>
    <img src="Pictures/10000000000002180000012D1BAA71CD.png" style="width:5.5835in;height:3.1354in" />
</p>
<p>
    <strong>Figure .</strong> Libraries tab of the OOo Macro Organizer dialog.
</p>
<p>
    The first step is to select the desired library container from the Location drop-down. To rename a library, double
    click on the library and then edit the name in place.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                <p>
                    I find renaming modules and libraries in the Macro Organizer dialogs to be frustrating. For renaming
                    libraries, double or triple click on the library name then wait a few seconds. Try again. Try one
                    more time. Click on another library. Double or triple click on the library name; you get the idea.
                </p>
                <p>
                    The easiest method to change a module name is to right click on the module name in the tabs at the
                    bottom of the IDE and choose rename (see).
                </p>
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="macro-language">
                    <span id="anchor-12"></span>Macro language
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The OpenOffice.org macro language is based on the BASIC programming language. The standard macro language is
    officially titled StarBasic, but, it is also referred to as OOo Basic, or Basic. Many different programming
    languages can be used to automate OOo. OOo provides easy support for macros written in Basic, JavaScript, Python,
    and BeanShell. In this document, my primary concern is Basic.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="create-a-module-in-a-document">
                    <span id="anchor-13"></span>Create a module in a document
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Each OOo document is a library container able to contain macros and dialogs. When a document contains the macros
    that it uses, possession of the document implies possession of the macros. This is a convenient distribution and
    storage method. Send the document to another person or location, and the macros are still available and usable.
</p>
<ol type="1">
    <li>
        To add a macro to any OOo document, the document must be open for editing. Start by opening a new text document,
        which will be named “Untitled 1” <em><em>— </em></em>assuming that no other untitled document is currently open.
    </li>
    <li>
        Use Tools &gt; Macros &gt; Organize Macros &gt; OpenOffice.org Basic to open the OOo Basic Macros dialog (see ).
    </li>
    <li>
        Click the Organizer button to open the OOo Macro Organizer dialog, then click on the Libraries tab (see ).
    </li>
    <li>
        Select “Untitled 1” from the location drop-down.
    </li>
</ol>
<p>
    <img src="Pictures/10000000000002180000012DFDDDD495.png" style="width:5.5835in;height:3.1354in" />
</p>
<p>
    <strong>Figure .</strong> Libraries tab of the OOo Macro Organizer dialog.
</p>
<ol type="1">
    <li>
        Click New to open the New Library dialog.
    </li>
</ol>
<p>
    <img src="Pictures/100000000000018C0000006713262669.png" style="width:4.1252in;height:1.0728in" />
</p>
<p>
    <strong>Figure .</strong> New library dialog.
</p>
<ol type="1">
    <li>
        The default name is Library1, which is not very descriptive. Choose a descriptive name and click OK. The new
        library is shown in the list. For this example, I named the library “HelloWorld”.
    </li>
</ol>
<p>
    <img src="Pictures/10000000000002180000012D86B02753.png" style="width:5.5835in;height:3.1354in" />
</p>
<p>
    <strong>Figure .</strong> The new library is shown in the list.
</p>
<ol type="1">
    <li>
        In the Modules tab, select the HelloWorld library. OOo created the module named “Module1” when the library was
        created.
    </li>
</ol>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                Although Module1 is created when the library is created, a bug in OOo 3.2 may prevent the module from
                displaying without closing and re-opening the dialog.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <img src="Pictures/10000000000002180000012D35ABD52C.png" style="width:5.5835in;height:3.1354in" />
</p>
<p>
    <strong>Figure .</strong> The new library is shown in the list.
</p>
<ol type="1">
    <li>
        Click New to open the New Module dialog. The default name is Module2, because Module1 already exists.
    </li>
</ol>
<p>
    <img src="Pictures/100000000000018C000000674AC1751E.png" style="width:4.1252in;height:1.0728in" />
</p>
<p>
    <strong>Figure .</strong> New module dialog.
</p>
<ol type="1">
    <li>
        Use a descriptive name and click OK. Module1 is finally displayed (bug in 3.2.0), as is the newly created
        module.
    </li>
</ol>
<p>
    <img src="Pictures/10000000000002180000012D20A7973A.png" style="width:5.5835in;height:3.1354in" />
</p>
<p>
    <strong>Figure .</strong> The new module is shown in the list.
</p>
<ol type="1">
    <li>
        Select HelloModule and click Edit.
    </li>
    <li>
        At this point, I saved the document and named it “DelMeDoc” because I intended to delete the document when I was
        finished with the example. Select a name that works well for you. If you reopen the dialog shown in , the
        document name will be shown rather than “Untitled 1”.
    </li>
</ol>
<p>
    At this point, the Integrated Debugging Environment (IDE) is opened to edit the macro.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="integrated-debugging-environment">
                    <span id="anchor-14"></span>Integrated Debugging Environment
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the Basic Integrated Debugging Environment (IDE) to create and run macros (see ). The IDE places significant
    functionality in a little space. The toolbar icons are described in . The top left corner just above the editing
    window <img src="Pictures/10000000000000FD0000001818BE27CC.png" style="width:2.6354in;height:0.25in" /> contains a
    drop-down list that shows the current library. The portion in the square brackets identifies the library container,
    and the portion following identifies the library. This provides a quick method to choose a library.
</p>
<p>
    <img src="Pictures/10000000000002CA000001AD7860F73A.png" style="width:7in;height:4.2098in" />
</p>
<p>
    <strong>Figure .</strong> Basic Integrated Debugging Environment.
</p>
<p>
    Rest your mouse cursor on a toolbar icon for a few seconds to read the text that appears; this provides a hint at
    what that icon does.
</p>
<p>
    <strong>Table .</strong> Toolbar icons in the Basic IDE.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                <img src="Pictures/10000000000000160000001CDB7BF47B.png" style="width:0.2291in;height:0.2917in" />
            </td>
            <td>
                Ctrl+N
            </td>
            <td>
                Create a new OOo document.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001A0000001C31C00834.png" style="width:0.2709in;height:0.2917in" />
            </td>
            <td>
                Ctrl+O
            </td>
            <td>
                Open an existing OOo document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/10000000000000180000001C07CA2300.png" style="width:0.25in;height:0.2917in" />
            </td>
            <td>
                Ctrl+S
            </td>
            <td>
                Save the current library. If the library is in a document, then the document is saved.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001E0000001C1C8A712B.png" style="width:0.3126in;height:0.2917in" />
            </td>
            <td>
                Ctrl+P
            </td>
            <td>
                Print the macro to the printer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000001C0000001C7D923886.png" style="width:0.2917in;height:0.2917in" />
            </td>
            <td>
                Ctrl+V
            </td>
            <td>
                Paste the clipboard.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001B0000001CF8BCA9BD.png" style="width:0.2811in;height:0.2917in" />
            </td>
            <td>
                Ctrl+Z
            </td>
            <td>
                Undo the last operation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/1000000000000018000000171D773069.png" style="width:0.25in;height:0.2398in" />
            </td>
            <td>
                Ctrl+Y
            </td>
            <td>
                Redo the last operation that was undone.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001E00000018A84C15BF.png" style="width:0.3126in;height:0.25in" />
            </td>
            <td>
            </td>
            <td>
                Open the Object catalog (see ). Select the macro and double-click on the macro.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000001800000018801A0DF3.png" style="width:0.25in;height:0.25in" />
            </td>
            <td>
            </td>
            <td>
                Open the OOo Macros dialog (see ). Select a macro and click edit or run. This is a short-cut for Tools
                &gt; Macros &gt; Organize Macros &gt; OpenOffice.org Basic.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001B00000018ECA4B079.png" style="width:0.2811in;height:0.25in" />
            </td>
            <td>
            </td>
            <td>
                Select a module. This opens the OOo Macro Organizer dialog with the Modules tab selected (see ). Select
                a module and click Edit.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000001D0000001847686D04.png" style="width:0.302in;height:0.25in" />
            </td>
            <td>
            </td>
            <td>
                Open the OOo help, which contains numerous useful examples for Basic.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001C000000191867695B.png" style="width:0.2917in;height:0.2602in" />
            </td>
            <td>
            </td>
            <td>
                Click the Compile icon to check the macro for syntax errors. No message is displayed unless an error is
                found. The Compile icon compiles only the current module.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000001A00000019F440E46E.png" style="width:0.2709in;height:0.2602in" />
            </td>
            <td>
                F5
            </td>
            <td>
                Run the first macro in the current module. While stopped (from a breakpoint, or single stepping, this
                continues the execution). To run a specific macro, use <img
                    src="Pictures/100000000000001800000018801A0DF3.png" style="width:0.25in;height:0.25in" /> to open
                the OOo Basic Macros dialog, select the desired macro, and click Run.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/10000000000000140000001501B2B7F8.png" style="width:0.2083in;height:0.2189in" />
            </td>
            <td>
                Shift+F5
            </td>
            <td>
                Stop the currently running macro.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/1000000000000017000000173E30856B.png" style="width:0.2398in;height:0.2398in" />
            </td>
            <td>
                Shift+F8
            </td>
            <td>
                Step over the current statement. When a macro stops at a breakpoint, this executes the current
                statement. Can also be used to start a macro running in single step mode.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001700000017A272D70F.png" style="width:0.2398in;height:0.2398in" />
            </td>
            <td>
                F8
            </td>
            <td>
                Step into. This is the same as Step over except if the current statement calls another macro, it single
                steps into that macro so that you can watch that macro execute.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/10000000000000190000001706004458.png" style="width:0.2602in;height:0.2398in" />
            </td>
            <td>
            </td>
            <td>
                Step out runs the macro to the end of the current subroutine or function.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/1000000000000018000000171E26A1A2.png" style="width:0.25in;height:0.2398in" />
            </td>
            <td>
                Shift+F9
            </td>
            <td>
                Toggles a breakpoint on / off at the current cursor position in the IDE. An icon (<img
                    src="Pictures/100000000000001100000013BB063C9A.png" style="width:0.1772in;height:0.198in" />) is
                displayed to the left of the line to show that a breakpoint is set for that line. You can also
                double-click in the breakpoint area to toggle a breakpoint on / off.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/10000000000000170000001763D25C0B.png" style="width:0.2398in;height:0.2398in" />
            </td>
            <td>
            </td>
            <td>
                Open the manage breakpoints dialog (see ), which allows you to selectively turn breakpoints on or off,
                and also, to prevent a breakpoint from triggering until it has been reached a certain number of times.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001800000017C141D6FA.png" style="width:0.25in;height:0.2398in" />
            </td>
            <td>
                F7
            </td>
            <td>
                Select a variable and click the Watch icon to add the variable to the watch window. You can also enter
                the variable name into the Watch input line and press enter.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000001B00000017DF3BECD2.png" style="width:0.2811in;height:0.2398in" />
            </td>
            <td>
            </td>
            <td>
                Find parentheses.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001D00000017DCEA4D34.png" style="width:0.302in;height:0.2398in" />
            </td>
            <td>
            </td>
            <td>
                Insert Basic source. Open a dialog to select a previously saved basic file and insert it.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000001B00000017D04560C4.png" style="width:0.2811in;height:0.2398in" />
            </td>
            <td>
            </td>
            <td>
                Save the current module as a text file on disk. OOo stores modules on disk in a special encoded format.
                Files saved using this method are standard text files. This is an excellent way to create a backup of a
                macro or to create a text file that can be easily sent to another person. This is different from the
                Disk icon, which is used to save the entire library or document that contains the module.
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001E00000017F29BDEB5.png" style="width:0.3126in;height:0.2398in" />
            </td>
            <td>
            </td>
            <td>
                Import a dialog from another module.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Module names are listed along the bottom of the IDE. Module navigation buttons <img
        src="Pictures/100000000000003C0000000EF3B18082.png" style="width:0.6252in;height:0.1457in" /> are to the left of
    the module names. The buttons display the first, previous, next, and last module in the current library. Right click
    on a module name to:
</p>
<ul>
    <li>
        Insert a new module or dialog.
    </li>
    <li>
        Delete a module or dialog.
    </li>
    <li>
        Rename a module; this is the easiest way that I know to rename a module or dialog.
    </li>
    <li>
        Hide a module or dialog.
    </li>
    <li>
        Open the OOo Basic Organization dialog.
    </li>
</ul>
<p>
    Use <img src="Pictures/100000000000001E00000018A84C15BF.png" style="width:0.3126in;height:0.25in" /> to open the
    Objects catalog (see), select a macro and double-click on the macro to edit that macro.
</p>
<p>
    <img src="Pictures/10000000000001D900000150C6581DED.png" style="width:4.9272in;height:3.5in" />
</p>
<p>
    <strong>Figure .</strong> Objects catalog.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="enter-the-macro">
                    <span id="anchor-15"></span>Enter the macro
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Change the text in the IDE to read as shown in . Click the run icon.
</p>
<p>
    <strong>Listing .</strong> Hello World macro
</p>
<p>
    REM ***** BASIC *****
</p>
<p>
    Option Explicit
</p>
<p>
    Sub Main
</p>
<p>
    Print "Hello World"
</p>
<p>
    End Sub
</p>
<p>
    <strong>Table .</strong> Line by line description of .
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                REM ***** BASIC *****
            </td>
            <td>
                Basic comment, this line is ignored. A comment may also begin with a single quote character.
            </td>
        </tr>
        <tr class="even">
            <td>
                Option Explicit
            </td>
            <td>
                Tells the basic interpreter that it is an error to use a variable that is not explicitly defined.
                Misspelled variables are likely to be caught as an error at compile time.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Sub Main
            </td>
            <td>
                Indicates that this is the beginning of the definition of a subroutine named Main.
            </td>
        </tr>
        <tr class="even">
            <td>
                Print "Hello World"
            </td>
            <td>
                The Print command.
            </td>
        </tr>
        <tr class="odd">
            <td>
                End Sub
            </td>
            <td>
                End the Main subroutine.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in is text that a human can read. The computer must translate macro text into something that the computer
    can use. The process of converting the human readable macro into something that the computer can read is called
    compiling. In other words, a macro is written as lines of text that are compiled to prepare a runnable program.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="run-a-macro">
                    <span id="anchor-16"></span>Run a macro
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The Run icon always runs the first macro in the current module. As a result, a different approach is required if
    more than one macro is in a module. The following options can be used:
</p>
<ul>
    <li>
        Place the macro first in the module, and click the Run icon.
    </li>
    <li>
        Use the first macro to call the desired macro. I like this method during development. I keep a main macro as the
        first thing that does nothing. During development, I change the main macro to call the macro of interest. For
        general use, I let the main macro at the top call the most frequently run macro.
    </li>
    <li>
        Use the Macro dialog (see ) to run any routine in the module.
    </li>
    <li>
        Add a button to your a document or toolbar that calls the macro.
    </li>
    <li>
        Assign the macro to a keystroke. Use Tools &gt; Customize to open the Customize dialog. Select the Keyboard tab.
        Macro libraries are at the bottom of the Category list. This is also available with Tools &gt; Macros &gt;
        Organize Macros &gt; OpenOffice.org Basic, select the macro, and click the Assign button to launch the Customize
        dialog. Various tabs in this dialog allow you to assign the macro to execute as a menu item, from a toolbar
        icon, or a system event.
    </li>
</ul>
<p>
    To use the Macro dialog to run any subroutine in a module, follow these steps:
</p>
<ol type="1">
    <li>
        Select Tools &gt; Macros &gt; Organize Macros &gt; OpenOffice.org Basic to open the Macro dialog (see ).
    </li>
    <li>
        Find the document that contains the module in the “Macro from” list.
    </li>
    <li>
        Double-click a library to toggle the display of the contained modules.
    </li>
    <li>
        Select the module to display the contained subroutines and functions in the “Existing macros in: &lt;selected
        module name&gt;” list.
    </li>
    <li>
        Select the desired subroutine or function to run <em><em>— for example</em></em>, HelloWorld.
    </li>
    <li>
        Click the Run button to run the subroutine or function.
    </li>
</ol>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="macro-security">
                    <span id="anchor-17"></span>Macro security
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Depending on how OOo is configured, you may not be able to run macros in a document. When I open a document
    containing a macro, the warning in is displayed. If you do not expect a macro or do not trust the source, then
    choose to disable macros. Remember, I am able to write a macro that destroys your computer.
</p>
<p>
    <img src="Pictures/1000000000000221000000BD15340F4C.png" style="width:5.6772in;height:1.9689in" />
</p>
<p>
    <strong>Figure .</strong> The opened document contains a macro.
</p>
<p>
    Use Tools &gt; Options &gt; OpenOffice.org &gt; Security to open the Security tab of the Options dialog.
</p>
<p>
    <img src="Pictures/10000000000003940000019EA3BC3890.png" style="width:7in;height:3.1701in" />
</p>
<p>
    <strong>Figure .</strong> Options dialog, security tab.
</p>
<p>
    Click the Macro Security button to open the Macro Security dialog. Choose a level that fits your comfort level.
    Medium security uses the confirmation dialog in , which is relatively quick and unobtrusive.
</p>
<p>
    <img src="Pictures/100000000000028E0000019DE835A3F1.png" style="width:6in;height:3.7902in" />
</p>
<p>
    <strong>Figure .</strong> Macro Security dialog, Security Level tab.
</p>
<p>
    You can set trusted locations and certificates that allow documents to load without confirmation based on either
    where they are stored, or the certificate used to sign a document.
</p>
<p>
    <img src="Pictures/100000000000028E0000019DF1490F35.png" style="width:6in;height:3.7902in" />
</p>
<p>
    <strong>Figure .</strong> Macro Security dialog, Trusted Sources tab.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="using-breakpoints">
                    <span id="anchor-18"></span>Using breakpoints
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    If you set a breakpoint in the code, the macro stops running at that point. You can then inspect variables, continue
    running the macro, or single-step the macro. If a macro fails and you don’t know why, single-stepping (running one
    statement at a time) allows you to watch a macro in action. When the macro fails, you’ll know how it got there. If a
    large number of statements run before the problem occurs, it may not be feasible to run one statement at a time, so
    you can set a breakpoint at or near the line that causes the problem. The program stops running at that point, and
    you can single-step the macro and watch the behavior.
</p>
<p>
    The breakpoint On/Off icon sets a breakpoint at the statement containing the cursor. A red stop sign marks the line
    in the breakpoint column. Double-click in the breakpoint column to toggle a breakpoint at that statement.
    Right-click a breakpoint in the Break-point column to activate or deactivate it.
</p>
<p>
    Use the Manage Breakpoints icon <img src="Pictures/10000000000000170000001763D25C0B.png"
        style="width:0.2398in;height:0.2398in" /> to load the Manage Breakpoints dialog. All of the active breakpoints
    in the current module are listed by line number. To add a breakpoint, enter a line number in the entry field and
    click New. To delete a breakpoint, select a breakpoint in the list and click the Delete button. Clear the Active
    check box to disable the highlighted breakpoint without deleting it. The Pass Count input box indicates the number
    of times a breakpoint must be reached before it is considered active. If the pass count is four (4), then the fourth
    time that the statement containing the breakpoint is to be run, it will stop rather than run. This is extremely
    useful when a portion of the macro does not fail until it has been called multiple times.
</p>
<p>
    <img src="Pictures/10000000000001B9000000DA8D393E91.png" style="width:4.5937in;height:2.2709in" />
</p>
<p>
    <strong>Figure .</strong> Manage Breakpoints dialog.
</p>
<p>
    There are two things that cause a breakpoint to be ignored: a pass count that is not zero, and explicitly marking
    the breakpoint as “not active” in the Manage breakpoints dialog. Every breakpoint has a pass count that is
    decremented toward zero when it is reached. If the result of decrementing is zero, the breakpoint becomes active and
    stays active because the pass count stays at zero thereafter. The pass count is not restored to its original value
    when the macro is finished or restarted.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="how-libraries-are-stored">
                    <span id="anchor-19"></span>How libraries are stored
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Macro libraries are stored as XML files that are easily editable using any text editor. In other words, it is easy
    for you to poke around and damage your files. This is advanced material that you may want to ignore. If you do not
    understand XML and why the file contains &amp;gt; rather than &gt;, perhaps you should not edit the files. Although
    manually editing your external libraries is generally considered foolish, I have had at least one instance where
    this was required, because OOo was unable to load a module that contained a syntax error.
</p>
<p>
    Each library is stored in a single directory, and each module and dialog is contained in a single file. The global
    libraries that are included with OpenOffice.org are stored in a shared basic directory under the directory in which
    OOo is installed. Examples:
</p>
<p>
    C:\Program Files\OpenOffice3.2\share\basic 'A Windows installation
</p>
<p>
    /opt/openoffice.org/basis3.2/share/basic 'A Linux installation
</p>
<p>
    OpenOffice.org stores user-specific data in a directory under the user’s home directory. The location is operating
    system specific. Use Tools &gt; Options &gt; OpenOffice.org &gt; Paths to view where other configuration data is
    stored. Here are some examples where my basic macros are stored:
</p>
<p>
    C:\Documents and Settings\andy\Application Data\OpenOffice.org\3\user\basic 'Windows XP
</p>
<p>
    C:\Users\pitonyaka\AppData\Roaming\OpenOffice.org\3\user\basic 'Windows 7
</p>
<p>
    /home/andy/OpenOffice.org/3/user/basic 'Linux
</p>
<p>
    User macros are stored in OpenOffice.org\3\user\basic. Each library is stored in its own directory off the basic
    directory. The user directory contains two files and one directory for each library (see).
</p>
<p>
    <strong>Table .</strong> Files and some directories in my user/basic directory.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                dialog.xlc
            </td>
            <td>
                XML file that references every dialog file known to this user in OpenOffice.org.
            </td>
        </tr>
        <tr class="even">
            <td>
                script.xlc
            </td>
            <td>
                XML file that references every library file known to this user in OpenOffice.org.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Standard
            </td>
            <td>
                Directory containing the Standard library.
            </td>
        </tr>
        <tr class="even">
            <td>
                Pitonyak
            </td>
            <td>
                Directory containing a the library named Pitonyak.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PitonyakDialogs
            </td>
            <td>
                Directory containing the library named PitonyakDialogs.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The files dialog.xlc and script.xlc contain a reference to all of the dialogs and libraries known to OOo. If these
    two files are overwritten, OOo will not know about your personal libraries even if they exist. You can, however,
    either manually edit the files, or, even easier, use the OOo Macro Organizer dialog to import the libraries (because
    you can import a library based on the directory).
</p>
<p>
    The directory containing a library contains a single file for each module and dialog in the library. The directory
    also contains the files dialog.xlb and script.xlb, which references the modules.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="how-documents-are-stored">
                    <span id="anchor-20"></span>How documents are stored
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The standard OOo formats use a standard ZIP file to store all of the components. Any program that can view and
    extract ZIP files can be used to inspect an OOo document<em><em> — </em></em>however, some programs will require you
    to change the file extension to end with ZIP.
</p>
<p>
    After unzipping an OOo document, you will find files that contain the primary content, styles, and settings. The
    extracted document also contains three directories. The META-INF directory references all of the other files,
    embedded pictures, code libraries, and dialogs. The Dialogs directory contains all of the embedded dialogs, and the
    Basic directory contains all of the embedded libraries.
</p>
<p>
    The point to all this is that in an emergency, you can manually inspect a document’s XML and potentially fix
    problems.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion">
                    <span id="anchor-21"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Macros and dialogs are stored in modules, modules are stored in libraries, and libraries are stored in library
    containers. The application is a library container, as is every document. The IDE is used to create and debug macros
    and dialogs.
</p>
<p>
    You have just completed one of the most difficult steps in writing macros for OpenOffice.org: writing your first
    macro! You are now ready to explore, try other macro examples, and create a few of your own.
</p>
<ol type="1">
    <li>
        <h1 id="language-constructs">
            <span id="anchor-22"></span>Language Constructs
        </h1>
    </li>
</ol>
<p>
    The OpenOffice.org macro language is similar to the one in Microsoft Office because they are both based on BASIC.
    Both macro languages access the underlying implementation structures, which differ significantly and are therefore
    incompatible. This chapter emphasizes the portions of the language that do not access the underlying implementation.
</p>
<p>
    This chapter shows how to assemble different components to produce an OOo macro that will compile and run. In a
    word: syntax. Correct syntax does not imply that the macro does what you want, only that the pieces are put together
    in a correct way. The phrases “Can I drive?” and “May I drive?” are both syntactically correct. The first phrase is
    about ability, and the second phrase is about permission. In speech, these two questions may be understood to have
    the same meaning. The computer, on the other hand, does exactly what you ask, rather than what you mean.
</p>
<p>
    The primary components that syntactically constitute an OpenOffice.org macro are statements, variables, subroutines,
    and functions, and flow-control constructs. A statement is a small, runnable portion of code that is usually written
    as a single line of text. Variables are containers that hold values that can change during macro execution.
    Subroutines and functions separate a macro into functional named groups of statements, allowing for better
    organization. Flow control directs which statements run and how many times.
</p>
<p>
    OOo runs one line of a macro at a time. Each line of a macro is delimited exactly the way it sounds; by a new line
    (see ).
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Two line macro
</p>
<p>
    Print "This is line one"
</p>
<p>
    Print "This is line two"
</p>
<p>
    Lines that are too long may use more than one line by appending an underscore (_) to the end of the line (see ). The
    underscore must be the last character on the line for it to act as a line-continuation character. The underscore has
    no special meaning when it isn’t the last character of a line, allowing it to be used inside strings and in variable
    names. When used as a continuation character, spaces may precede the underscore and are in some cases required to
    separate the underscore from what precedes it. For example, splitting the line “a+b+c” after the b requires a space
    between the b and the underscore, or the underscore is considered part of the variable name. Spaces that
    inadvertently follow a continuation character may cause a compile-time error. Unfortunately, the error does not
    state that something follows the underscore, but that the next line is invalid.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Append an underscore to the end of a
    line to continue on the next line.
</p>
<p>
    Print "Strings are concatenated together " &amp; _
</p>
<p>
    "with the ampersand character"
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                When anything follows a line-continuation character, the next line is not taken as its continuation.
                Sometimes, when I copy code listings from web sites and paste them into the IDE, an extra space is added
                at the end of a line, which breaks line continuation.
            </td>
        </tr>
    </tbody>
</table>
<p>
    You can place multiple statements on a single line by separating them with colons. This is usually done for improved
    code readability. Each of the combined statements act as a single line of code while debugging the macro in the
    Integrated Development Environment (IDE). , therefore, acts like three separate statements while using the IDE to
    single-step through the macro.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Set the variables x, y, and z to zero.
</p>
<p>
    x = 0 : y = 0 : z = 0
</p>
<p>
    You should liberally add remarks, which are also called comments, to all of the macros that you write. While writing
    a macro, remember that what is clear today may not be clear tomorrow, as time passes and new projects arise and
    memory fades all too quickly. You can start a comment with either the single quotation character, or the keyword
    REM. All text on the same line following a comment indicator is ignored. Comments are not considered runnable
    statements; they are ignored while single-stepping a macro.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Add comments to all of the macros that
    you write.
</p>
<p>
    REM Comments may start with the keyword REM.
</p>
<p>
    ReM It is not case-sensitive so this is also a comment.
</p>
<p>
    ' All text following the start of the comment is ignored
</p>
<p>
    X = 0 ' A comment may also start with a
</p>
<p>
    ' single quote
</p>
<p>
    z = 0 REM All text following the start of the comment is ignored
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                <p>
                    Keywords, variables, and routine names in OOo Basic are not case-sensitive.
                </p>
                <p>
                    Therefore, REM, Rem, and rEm all start a comment.
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    Nothing can follow a line-continuation character, and this includes comments. All text following a comment indicator
    is ignored<em><em> — </em></em>even the continuation character. The logical result from these two rules is that a
    line-continuation character can never occur on the same line as a comment.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="compatibility-with-visual-basic">
                    <span id="anchor-23"></span>Compatibility with Visual Basic
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    With respect to syntax and BASIC functionality, OOo Basic is very similar to Visual Basic. The two Basic dialects
    are nothing alike when it comes to manipulating documents, but the general command set is very similar. Steps were
    taken to improve the general compatibility between the two dialects. Many enhancements were released with OOo 2.0.
    Many of the changes are not backward compatible with existing behavior. To help resolve these conflicts, a new
    compiler option and a new run-time mode were introduced to specify the new compatible behavior.
</p>
<p>
    The compiler option “Option Compatible” directs some features. This option affects only the module in which it is
    contained. Because a macro calls different modules during its execution, both the old and new behavior may be used,
    depending upon the existence of “Option Compatible” in each called module. Setting the option in one module and then
    calling another module has no effect in the called module.
</p>
<p>
    A run-time function, CompatibilityMode( True/False ), allows the behavior of run-time functions to be modified
    during the execution of a macro. This provides the flexibility to enable the new run-time behavior, perform some
    operations, and then disable the new run-time behavior. CompatibilityMode(False) overrides Option Compatible for the
    new runtime behavior. Hopefully, some method of probing the current mode will be provided.
</p>
<p>
    Visual basic allows any Latin-1 (ISO 8859-1) character as a valid variable name, OOo does not. Setting “Option
    Compatible” allows “ä” to be considered a valid variable name. This is just one of many changes that use “Option
    Compatible.” The CompatibilityMode() function neither enables nor disables the new extended identifier names because
    CompatibilityMode() is not called until run time and variable names are recognized at compile time.
</p>
<p>
    Both Visual Basic and OOo Basic support the rmdir() command to remove a directory. VBA can remove only empty
    directories, but OOo Basic can recursively remove an entire directory tree. If CompatibilityMode(True) is called
    prior to calling rmdir(), OOo Basic will act like VBA and generate an error if the specified directory is not empty.
    This is just one of many changes that use CompatibilityMode().
</p>
<p>
    StarBasic is much more forgiving than VBA. It is easier, therefore, to convert simple macros from VBA to OOo Basic.
    A few examples, in OOo Basic, “set” is optional during assignment. Therefore, “set x = 5” works in both VBA and OOo
    Basic, but “x = 5” fails in VBA and works with OOo Basic.
</p>
<p>
    Another example is that array methods are far more stable and forgiving in OOo than in VBA; for example, the
    functions to determine array bounds (LBound and UBound) work fine with empty arrays, whereas VBA crashes.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="compiler-options-and-directives">
                    <span id="anchor-24"></span>Compiler options and directives
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    A compiler converts a macro into something that the computer is able to run. Compiler behavior can be controlled
    through commands such as “Option Explicit” at the top of a module before all variables, subroutines, and functions.
    A compiler option controls the compilers behavior for the module containing the option.
</p>
<p>
    <strong>Table .</strong> Compiler options and directives.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Def
            </td>
            <td>
                Give a default type to undeclared variables based on the variables name.
            </td>
        </tr>
        <tr class="even">
            <td>
                Option Base
            </td>
            <td>
                Control whether the first array index is 0 or 1; assuming it is not specified.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Option Compatible
            </td>
            <td>
                Cause Star Basic to act more like VB.
            </td>
        </tr>
        <tr class="even">
            <td>
                Option Explicit
            </td>
            <td>
                Force all variables to be defined. While the macro runs, if a variable that has not yet been defined is
                used, an error occurs.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="variables">
                    <span id="anchor-25"></span>Variables
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Variables are containers that hold values. OpenOffice.org supports different types of variables designed to hold
    different types of values. This section shows how to create, name, and use variables. Although OOo Basic does not
    force you to declare variables, you should declare every variable that you use. The reasons for this are developed
    throughout this section.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="constant-subroutine-function-label-and-variable-names">
                            <span id="anchor-26"></span>Constant, subroutine, function, label, and variable names
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Always choose meaningful names for your variables. Although the variable name “var1” requires little thought during
    creation, “FirstName” is more meaningful. Some variable names are not particularly descriptive but are commonly used
    by programmers anyway. For example, “i” is commonly used as a shortened version of “index,”<em> </em>for a variable
    that is used to count the number of times a repetitive task is executed in a loop. OOo Basic imposes restrictions on
    variable names, including the following:
</p>
<ul>
    <li>
        A variable name cannot exceed 255 characters in length. Well, <em>officially</em> a variable name cannot exceed
        255 characters. I tested names with more than 300 characters with no problems, but I don’t recommend this!
    </li>
    <li>
        The first character of a variable name must be a letter: A-Z or a-z. If Option Compatible is used, then all
        characters defined as letters in the Latin-1 (ISO 8859-1) character set are accepted as part of an identifier
        name.
    </li>
    <li>
        The numbers 0-9 and the underscore character (_) may be used in a variable name, but not as the first character.
        If a variable name ends with an underscore, it won’t be mistaken for a line-continuation character.
    </li>
    <li>
        Variable names are not case sensitive, so “FirstName” and “firstNAME” both refer to the same variable.
    </li>
    <li>
        Variable names may contain spaces but must be enclosed in square brackets if they do. For example, [First Name].
        Although this is allowed, it is considered poor programming practice.
    </li>
</ul>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                These restrictions also apply to constant, subroutine, function, and label names.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="declaring-variables">
                            <span id="anchor-27"></span>Declaring variables
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Some programming languages require that you explicitly list all variables used. This process is called “declaring
    variables.” OOo Basic does not require this. You are free to use variables without declaring them.
</p>
<p>
    Although it is convenient to use variables without declaring them, it is error-prone. If you mistype a variable
    name, it becomes a new variable rather than raising an error. Place the keywords “Option Explicit” before any
    runnable code in every module to cause OOo Basic to treat undeclared variables as run-time errors. Comments may
    precede Option Explicit because they are not runnable. Although it would be even better if this became a
    compile-time error, OOo Basic does not resolve all variables and routines until run time.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Use Option Explicit before the first
    runnable line in a module.
</p>
<p>
    REM ***** BASIC *****
</p>
<p>
    Option Explicit
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Use “Option Explicit” at the top of every module that you write; it will save you a lot of time
                searching for errors in your code. When I am asked to debug a macro, the first thing I do is add “Option
                Explicit” at the top of each module.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The scope for options is the module which contains the option. In other words, setting option explicit in one
    module, then calling another module, will not cause undeclared variables in the called module to cause a runtime
    error; unless the called module also has “option explicit”.
</p>
<p>
    You can declare a variable with or without a type. A variable without an explicit type becomes a Variant, which is
    able to take on any type. This means that you can use a Variant to hold a numeric value and then, in the next line
    of code, overwrite the number with text. shows the variable types supported by OOo Basic, the value that each type
    of variable contains immediately after declaration (“initial value”), and the number of bytes that each type uses.
    In OOo Basic, a variable's type can be declared by appending a special character to the end of the name when it is
    declared. The Post column in contains the supported characters that can be post-fixed to a variable's name when the
    variable is declared.
</p>
<p>
    <strong>Table .</strong> Supported variable types and their initial values.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Boolean
            </td>
            <td>
            </td>
            <td>
                False
            </td>
            <td>
                1
            </td>
            <td>
                CBool
            </td>
            <td>
                True or False
            </td>
        </tr>
        <tr class="even">
            <td>
                Currency
            </td>
            <td>
                @
            </td>
            <td>
                0.0000
            </td>
            <td>
                8
            </td>
            <td>
                CCur
            </td>
            <td>
                Currency with 4 decimal places
            </td>
        </tr>
        <tr class="odd">
            <td>
                Date
            </td>
            <td>
            </td>
            <td>
                00:00:00
            </td>
            <td>
                8
            </td>
            <td>
                CDate
            </td>
            <td>
                Dates and times
            </td>
        </tr>
        <tr class="even">
            <td>
                Double
            </td>
            <td>
                #
            </td>
            <td>
                0.0
            </td>
            <td>
                8
            </td>
            <td>
                CDbl
            </td>
            <td>
                Decimal numbers in the range of<br /> +/-1.79769313486232 x 10E308
            </td>
        </tr>
        <tr class="odd">
            <td>
                Integer
            </td>
            <td>
                %
            </td>
            <td>
                0
            </td>
            <td>
                2
            </td>
            <td>
                CInt
            </td>
            <td>
                Integer from -32,768 through 32,767
            </td>
        </tr>
        <tr class="even">
            <td>
                Long
            </td>
            <td>
                &amp;
            </td>
            <td>
                0
            </td>
            <td>
                4
            </td>
            <td>
                CLng
            </td>
            <td>
                Integer from -2147483648 through 2147483647
            </td>
        </tr>
        <tr class="odd">
            <td>
                Object
            </td>
            <td>
            </td>
            <td>
                Null
            </td>
            <td>
                varies
            </td>
            <td>
            </td>
            <td>
                Object
            </td>
        </tr>
        <tr class="even">
            <td>
                Single
            </td>
            <td>
                !
            </td>
            <td>
                0.0
            </td>
            <td>
                4
            </td>
            <td>
                CSng
            </td>
            <td>
                Decimal numbers in the range of<br /> +/-3.402823 x 10E38
            </td>
        </tr>
        <tr class="odd">
            <td>
                String
            </td>
            <td>
                $
            </td>
            <td>
                ""
            </td>
            <td>
                varies
            </td>
            <td>
                CStr
            </td>
            <td>
                Text with up to 65536 characters
            </td>
        </tr>
        <tr class="even">
            <td>
                Variant
            </td>
            <td>
            </td>
            <td>
                Empty
            </td>
            <td>
                varies
            </td>
            <td>
                CVar
            </td>
            <td>
                May contain any data type
            </td>
        </tr>
    </tbody>
</table>
<p>
    Although OOo Basic supports a Byte variable type, you can’t directly declare and use one. The function CByte, as
    discussed later, returns a Byte value that may be assigned to a variable of type Variant. With OOo version 2.0, you
    can declare a variable of type Byte, but the variable is assumed to be an externally defined object of type Byte
    rather than an internally defined Byte variable.
</p>
<p>
    Use the DIM keyword to explicitly declare a variable before use (see). You can declare multiple variables on a
    single line, and you can give each variable a type when it is declared. Variables with no declared type default to
    type Variant.
</p>
<p>
    <strong>Table .</strong> Declaring simple variables.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Dim Name
            </td>
            <td>
                Name is type Variant because no type is stated.
            </td>
        </tr>
        <tr class="even">
            <td>
                Dim Name As String
            </td>
            <td>
                Name is type String because the type is explicitly stated.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Dim Name$
            </td>
            <td>
                Name$ is type String because Name$ ends with a $.
            </td>
        </tr>
        <tr class="even">
            <td>
                Dim Name As String, Weight As Single
            </td>
            <td>
                Name is type String and Weight is type Single.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Dim Width, Length
            </td>
            <td>
                Width and Length are type Variant.
            </td>
        </tr>
        <tr class="even">
            <td>
                Dim Weight, Height As Single
            </td>
            <td>
                Weight is type Variant and Height is type Single.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                <p>
                    When multiple variables are declared in a single line, the type for each variable must be
                </p>
                <p>
                    listed separately. In the last line of Table 5, Weight is a Variant, even though it looks like it
                    may be of type Single.
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    Much of the available literature on OOo macro programming uses a variable naming scheme based on Hungarian notation.
    With Hungarian notation, you can determine a variable’s type from its name. In practice, everyone does this
    differently and with differing levels of adherence. This is a stylistic decision that some people love and some
    people hate.
</p>
<p>
    OOo Basic uses Def&lt;type&gt; statements to facilitate the use of Hungarian notion. The Def statements, which are
    local to each module that uses them, provide a default type for an undeclared variable based on its name. Normally,
    all undeclared variables are of type Variant.
</p>
<p>
    The Def statement is followed by a comma-separated list of character ranges that specify the starting characters
    (see ).
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Declare untyped variables starting
    with i, j, k, or n to be of type Integer.
</p>
<p>
    DefInt i-k,n
</p>
<p>
    contains an example of each supported Def statement. Def statements, like Option statements, are placed in the
    module before any runnable line or variable declaration. The Def statement does not force a variable with a specific
    first letter to be of a certain type, but rather provides a default type other than Variant for variables that are
    used but not declared. I have never seen the Def statement used and I recommend that you do not use the Def
    statement.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                If you use “Option Explicit,” and you should, you must declare all variables. This renders the
                Def&lt;type&gt; statements useless because they affect only undeclared variables.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Examples of supported Def statements in
    OpenOffice.org.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                DefBool b
            </td>
            <td>
                Boolean
            </td>
        </tr>
        <tr class="even">
            <td>
                DefDate t
            </td>
            <td>
                Date
            </td>
        </tr>
        <tr class="odd">
            <td>
                DebDbl d
            </td>
            <td>
                Double
            </td>
        </tr>
        <tr class="even">
            <td>
                DefInt i
            </td>
            <td>
                Integer
            </td>
        </tr>
        <tr class="odd">
            <td>
                DefLng l
            </td>
            <td>
                Long
            </td>
        </tr>
        <tr class="even">
            <td>
                DefObj o
            </td>
            <td>
                Object
            </td>
        </tr>
        <tr class="odd">
            <td>
                DefVar v
            </td>
            <td>
                Variant
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="assigning-values-to-variables">
                            <span id="anchor-28"></span>Assigning values to variables
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The purpose of a variable is to hold values. To assign a value to a variable, type the name of the variable,
    optional spaces, an equals sign, optional spaces, and the value to assign to the variable, like so:
</p>
<p>
    X = 3.141592654
</p>
<p>
    y = 6
</p>
<p>
    The optional keyword Let may precede the variable name but serves no purpose other than readability. A similar
    optional keyword, Set, meant for Object variables, serves no purpose other than readability. These keywords are
    rarely used.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="boolean-variables-are-true-or-false">
                            <span id="anchor-29"></span>Boolean variables are True or False
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Boolean variables have two valid values: True or False. They are internally represented by the Integer values -1 and
    0, respectively. Any numeric value assigned to a Boolean that does not precisely evaluate to 0 is converted to True.
    The macro in introduces a few new concepts. A string variable, s, accumulates the results of the calculations, which
    are displayed in a dialog (see ). Adding CHR$(10) to the string causes a new line to be printed in the dialog.
    Unfortunately, accumulating the results in a string provides a more complicated macro than using simple statements
    such as “Print CBool(5=3)”, but the results are easier to understand (see ). In the OOo version of the document, a
    button is frequently available that allows you to run the macro immediately.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Demonstrate conversion to type
    boolean.
</p>
<p>
    Sub ExampleBooleanType
</p>
<p>
    Dim b as Boolean
</p>
<p>
    Dim s as String
</p>
<p>
    b = True
</p>
<p>
    b = False
</p>
<p>
    b = (5 = 3) REM Set to False
</p>
<p>
    s = "(5 = 3) =&gt; " &amp; b
</p>
<p>
    b = (5 &lt; 7) REM Set to True
</p>
<p>
    s = s &amp; CHR$(10) &amp; "(5 &lt; 7) =&gt; " &amp; b
</p>
<p>
    b = 7 REM Set to True because 7 is not 0
</p>
<p>
    s = s &amp; CHR$(10) &amp; "(7) =&gt; " &amp; b
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000A20000007424CFFF0E.png" style="width:1.6874in;height:1.2083in" />
</p>
<p>
    <strong>Figure .</strong> The dialog displayed by .
</p>
<p>
    The internal binary representation of True as -1 has all of the bits set to 1. The internal binary representation of
    False as 0 has all of the bits set to 0.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="numeric-variables">
                            <span id="anchor-30"></span>Numeric variables
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Numeric variables contain numbers. OOo Basic supports integers, floating-point, and currency numbers. Integers may
    be expressed as hexadecimal (base 16), octal (base 8), or the default decimal numbers (base 10). In common practice,
    OOo users almost always use decimal numbers, but the other types are presented here as well, for completeness.
</p>
<p>
    A discussion of other number bases is important because internally, computers represent their data in binary format.
    It is easy to convert between the binary, hexadecimal, and octal number bases; and for humans it may be easier to
    visualize binary numbers when represented in other number bases.
</p>
<p>
    Decimal numbers, base 10, are composed of the 10 digits 0, 1, 2, 3, 4, 5, 6, 7, 8, and 9. Add 1 to 9 in decimal and
    the result is 10. Binary (base 2), octal (base 8), and hexadecimal (base 16) numbers are also commonly used in
    computing. Octal numbers are composed of the numbers 0, 1, 2, 3, 4, 5, 6, and 7. In octal, add 1 to 7 and the result
    is 10 (base 8). Hexadecimal numbers are composed of the 16 digits 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, A, B, C, D, E, and
    F. Binary numbers are composed of the two digits 0 and 1. <strong> </strong>contains the numbers from 0 through 18
    in decimal, and their corresponding values in binary, octal, and hexadecimal bases.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Numbers in different bases.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                0
            </td>
            <td>
                0
            </td>
            <td>
                0
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                1
            </td>
            <td>
                1
            </td>
            <td>
                1
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                10
            </td>
            <td>
                2
            </td>
            <td>
                2
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                11
            </td>
            <td>
                3
            </td>
            <td>
                3
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                100
            </td>
            <td>
                4
            </td>
            <td>
                4
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                101
            </td>
            <td>
                5
            </td>
            <td>
                5
            </td>
        </tr>
        <tr class="odd">
            <td>
                6
            </td>
            <td>
                110
            </td>
            <td>
                6
            </td>
            <td>
                6
            </td>
        </tr>
        <tr class="even">
            <td>
                7
            </td>
            <td>
                111
            </td>
            <td>
                7
            </td>
            <td>
                7
            </td>
        </tr>
        <tr class="odd">
            <td>
                8
            </td>
            <td>
                1000
            </td>
            <td>
                10
            </td>
            <td>
                8
            </td>
        </tr>
        <tr class="even">
            <td>
                9
            </td>
            <td>
                1001
            </td>
            <td>
                11
            </td>
            <td>
                9
            </td>
        </tr>
        <tr class="odd">
            <td>
                10
            </td>
            <td>
                1010
            </td>
            <td>
                12
            </td>
            <td>
                A
            </td>
        </tr>
        <tr class="even">
            <td>
                11
            </td>
            <td>
                1011
            </td>
            <td>
                13
            </td>
            <td>
                B
            </td>
        </tr>
        <tr class="odd">
            <td>
                12
            </td>
            <td>
                1100
            </td>
            <td>
                14
            </td>
            <td>
                C
            </td>
        </tr>
        <tr class="even">
            <td>
                13
            </td>
            <td>
                1101
            </td>
            <td>
                15
            </td>
            <td>
                D
            </td>
        </tr>
        <tr class="odd">
            <td>
                14
            </td>
            <td>
                1110
            </td>
            <td>
                16
            </td>
            <td>
                E
            </td>
        </tr>
        <tr class="even">
            <td>
                15
            </td>
            <td>
                1111
            </td>
            <td>
                17
            </td>
            <td>
                F
            </td>
        </tr>
        <tr class="odd">
            <td>
                16
            </td>
            <td>
                10000
            </td>
            <td>
                20
            </td>
            <td>
                10
            </td>
        </tr>
        <tr class="even">
            <td>
                17
            </td>
            <td>
                10001
            </td>
            <td>
                21
            </td>
            <td>
                11
            </td>
        </tr>
        <tr class="odd">
            <td>
                18
            </td>
            <td>
                10010
            </td>
            <td>
                22
            </td>
            <td>
                12
            </td>
        </tr>
    </tbody>
</table>
<p>
    Integers are assumed to be expressed as decimal numbers. Commas are not allowed. Hexadecimal numbers are preceded by
    “&amp;H” and octal numbers are preceded by “&amp;O” (letter O, not a zero). Unfortunately, there is no easy method
    to enter binary numbers. presents a few simple guidelines for entering numbers.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> A few guidelines for entering numbers in
    OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Use 1000 not 1,000
            </td>
            <td>
                Write numbers without a thousands separator; do not use commas.
            </td>
        </tr>
        <tr class="even">
            <td>
                + 1000
            </td>
            <td>
                A space is permitted between a leading plus or minus sign and the number.
            </td>
        </tr>
        <tr class="odd">
            <td>
                &amp;HFE is the same as 254
            </td>
            <td>
                Precede a hexadecimal number with &amp;H.
            </td>
        </tr>
        <tr class="even">
            <td>
                &amp;O11 is the same as 9
            </td>
            <td>
                Precede an octal number with &amp;O.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Use 3.1415 not 3,1415
            </td>
            <td>
                Do not use commas for the decimal.
            </td>
        </tr>
        <tr class="even">
            <td>
                6.022E23
            </td>
            <td>
                In scientific notation, the “e” can be uppercase or lowercase.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Use 6.6e-34 not 6.6e -34
            </td>
            <td>
                Spaces are not allowed in a number. With the space, this evaluates as 6.6 - 34 = -27.4.
            </td>
        </tr>
        <tr class="even">
            <td>
                6.022e+23
            </td>
            <td>
                The exponent may contain a leading plus or minus sign.
            </td>
        </tr>
        <tr class="odd">
            <td>
                1.1e2.2 evaluates as 1.1e2
            </td>
            <td>
                The exponent must be an integer. The fractional portion is ignored.
            </td>
        </tr>
    </tbody>
</table>
<p>
    In general, assigning a String to a numeric variable sets the variable to zero and does not generate an error. If
    the first characters in the string represent a number, however, then the string is converted to a number and the
    non-numeric portion of the string is ignored — numeric overflow is possible.
</p>
<h4 id="integer-variables">
    <span id="anchor-31"></span>Integer variables
</h4>
<p>
    An integer is a whole number that may be positive, negative, or equal to zero. Integer variables are a good choice
    for numbers representing non-fractional quantities, such as age or number of children. In OOo Basic, Integer
    variables are 16-bit numbers supporting a range from -32768 through 32767. Floating-point numbers assigned to an
    integer are rounded to the nearest Integer value. Appending a variable name with “%” when it is declared is a
    shortcut to declaring it as type Integer.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Demonstrate integer variables.
</p>
<p>
    Sub ExampleIntegerType
</p>
<p>
    Dim i1 As Integer, i2% REM i1 and i2 are both Integer variables
</p>
<p>
    Dim f2 As Double
</p>
<p>
    Dim s$
</p>
<p>
    f2= 3.5
</p>
<p>
    i1= f2 REM i1 is rounded to 4
</p>
<p>
    s = "3.50 =&gt; " &amp; i1
</p>
<p>
    f2= 3.49
</p>
<p>
    i2= f2 REM i2 is rounded to 3
</p>
<p>
    s = s &amp; CHR$(10) &amp; "3.49 =&gt; " &amp; i2
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000A2000000659BD8A89F.png" style="width:1.6874in;height:1.052in" />
</p>
<p>
    <strong>Figure .</strong> Demonstrating integer variables in .
</p>
<h4 id="long-integer-variables">
    <span id="anchor-32"></span>Long Integer variables
</h4>
<p>
    “Long” is an integer type that has a greater range than type Integer. Long variables are 32-bit numbers supporting a
    range from -2,147,483,648 through 2,147,483,647. Long variables use twice as much memory as Integer variables but
    they can hold numbers that are <em>much</em> larger in magnitude. Floating-point numbers assigned to type Long are
    rounded to the nearest Long value. Appending a variable name with “&amp;” when it is declared is a shortcut to
    declaring it as type Long. The output from is the same as (see ).
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Demonstrate long variables.
</p>
<p>
    Sub ExampleLongType
</p>
<p>
    Dim NumberOfDogs&amp;, NumberOfCats As Long ' Both variables are Long
</p>
<p>
    Dim f2 As Double
</p>
<p>
    Dim s$
</p>
<p>
    f2= 3.5
</p>
<p>
    NumberOfDogs = f2 REM round to 4
</p>
<p>
    s = "3.50 =&gt; " &amp; NumberOfDogs
</p>
<p>
    f2= 3.49
</p>
<p>
    NumberOfCats = f2 REM round to 3
</p>
<p>
    s = s &amp; CHR$(10) &amp; "3.49 =&gt; " &amp; NumberOfCats
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<h4 id="currency-variables">
    <span id="anchor-33"></span>Currency variables
</h4>
<p>
    Currency variables, as the name implies, are designed to hold financial information. The Currency type was
    originally introduced to avoid the rounding behavior of the floating-point types Single and Double. Visual Basic
    .NET removed the Currency type in favor of the Decimal type.
</p>
<p>
    Currency variables are 64-bit, fixed-precision numbers. Calculations are performed to four decimal places and 15
    non-decimal digits accuracy. This yields a range from -922,337,203,658,477.5808 through +922,337,203,658,477.5807.
    Appending a variable name with “@” when it is declared is a shortcut to declaring it as type Currency.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Demonstrate currency variables.
</p>
<p>
    Sub ExampleCurrencyType
</p>
<p>
    Dim Income@, CostPerDog As Currency
</p>
<p>
    Income@ = 22134.37
</p>
<p>
    CostPerDog = 100.0 / 3.0
</p>
<p>
    REM Prints as 22134.3700
</p>
<p>
    Print "Income = " &amp; Income@
</p>
<p>
    REM Prints as 33.3333
</p>
<p>
    Print "Cost Per dog = " &amp; CostPerDog
</p>
<p>
    End Sub
</p>
<h4 id="single-variables">
    <span id="anchor-34"></span>Single variables
</h4>
<p>
    Single variables, unlike Integer variables, can have a fractional portion. They are called “floating-point numbers”
    because, unlike Currency variables, the number of decimals allowed is not fixed. Single variables are 32-bit numbers
    that are accurate to about seven displayed digits, making them suitable for mathematical operations of average
    precision. They support positive or negative values from 3.402823 x 10E38 to 1.401298 x 10E-45. Any number smaller
    in magnitude than 1.401298 x 10E-45 becomes zero. Appending a variable name with “!” when it is declared is a
    shortcut to declaring it as type Single.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Demonstrate single variables.
</p>
<p>
    <img src="Pictures/10000000000000C6000000563977DFB4.png" style="width:2.0626in;height:0.8957in" />Sub
    ExampleSingleType
</p>
<p>
    Dim GallonsUsed As Single, Miles As Single, mpg!
</p>
<p>
    GallonsUsed = 17.3
</p>
<p>
    Miles = 542.9
</p>
<p>
    mpg! = Miles / GallonsUsed
</p>
<p>
    Print "Fuel efficiency = " &amp; mpg!
</p>
<p>
    End Sub
</p>
<h4 id="double-variables">
    <span id="anchor-35"></span>Double variables
</h4>
<p>
    Double variables are similar to Single variables except that they use 64 bits and have about 15 significant digits.
    They are suitable for high-precision mathematical operations. Double variables support positive or negative values
    from 1.79769313486232 x 10E308 to 4.94065645841247 x 10E-324. Any number smaller in magnitude than
    4.94065645841247 x 10E-324 becomes zero. Appending a variable with “#” when it is declared is a shortcut to
    declaring it as type Double.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Demonstrate double variables.
</p>
<p>
    Sub ExampleDoubleType
</p>
<p>
    Dim GallonsUsed As Double, Miles As Double, mpg#
</p>
<p>
    <img src="Pictures/100000000000010600000055D161774B.png" style="width:2.7291in;height:0.8854in" /> GallonsUsed =
    17.3
</p>
<p>
    Miles = 542.9
</p>
<p>
    mpg# = Miles / GallonsUsed
</p>
<p>
    Print "Fuel efficiency = " &amp; mpg#
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="string-variables-contain-text">
                            <span id="anchor-36"></span>String variables contain text
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    String variables are used to hold text. In OOo, text is stored as Unicode version 2.0 values, which provides good
    support for multiple languages. Each String variable can hold up to 65,535 characters. Appending a variable with “$”
    when it is declared is a shortcut to declaring it as type String.
</p>
<p>
    <strong>Listing .</strong> Demonstrate string variables.
</p>
<p>
    Sub ExampleStringType
</p>
<p>
    Dim FirstName As String, LastName$
</p>
<p>
    FirstName = "Andrew"
</p>
<p>
    LastName$ = "Pitonyak"
</p>
<p>
    Print "Hello " &amp; FirstName &amp; " " &amp; LastName$
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000AC00000056D286EB04.png" style="width:1.7917in;height:0.8957in" />
</p>
<p>
    <strong>Figure .</strong> Demonstrating string variables in .
</p>
<p>
    Always remember that strings are limited to 65,535 characters. A macro counted the number of characters in a text
    document by converting the document to a string and then taking the length. The macro worked until the document
    contained more than 65,535 characters. In Visual Basic .NET, String variables may contain approximately 2 billion
    Unicode characters.
</p>
<p>
    Place two double quote characters in a row to insert a double quotation character into a string.
</p>
<p>
    S = "She said ""Hello""" REM She said "Hello"
</p>
<p>
    Visual Basic string constants are available when using “Option Compatible” (see ). You must use Option Compatible
    for the module rather than using CompatibilityMode(True) because the string constant is recognized at compile time
    rather than run time.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Visual Basic-compatible string
    constants.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                vbCr
            </td>
            <td>
                CHR$(13)
            </td>
            <td>
                Carriage return
            </td>
        </tr>
        <tr class="even">
            <td>
                vbCrLf
            </td>
            <td>
                CHR$(13) &amp; CHR$(10)
            </td>
            <td>
                Carriage return/linefeed combination
            </td>
        </tr>
        <tr class="odd">
            <td>
                vbFormFeed
            </td>
            <td>
                CHR$(12)
            </td>
            <td>
                Form feed
            </td>
        </tr>
        <tr class="even">
            <td>
                vbLf
            </td>
            <td>
                CHR$(10)
            </td>
            <td>
                Line feed
            </td>
        </tr>
        <tr class="odd">
            <td>
                vbNewLine
            </td>
            <td>
                CHR$(13) &amp; CHR$(10) or CHR$(10)
            </td>
            <td>
                Platform-specific newline character<em><em> — </em></em>whatever is appropriate
            </td>
        </tr>
        <tr class="even">
            <td>
                vbNullChar
            </td>
            <td>
                CHR$(0)
            </td>
            <td>
                Character with ASCII value 0
            </td>
        </tr>
        <tr class="odd">
            <td>
                vbNullString
            </td>
            <td>
                ""
            </td>
            <td>
                Empty string. This is a string with a terminating null.
            </td>
        </tr>
        <tr class="even">
            <td>
                vbTab
            </td>
            <td>
                CHR$(9)
            </td>
            <td>
                Horizontal tab
            </td>
        </tr>
        <tr class="odd">
            <td>
                vbVerticalTab
            </td>
            <td>
                CHR$(11)
            </td>
            <td>
                Vertical tab
            </td>
        </tr>
    </tbody>
</table>
<p>
    The string constants in allow you to define constant strings with special characters. Previously, you had to define
    the string by using code that called the CHR$() function.
</p>
<p>
    Option Compatible
</p>
<p>
    Const sGreeting As String = "Hello" &amp; vbCr &amp; "Johnny" ' This contains a CR.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="date-variables">
                            <span id="anchor-37"></span>Date variables
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Date variables contain date and time values. OOo Basic stores dates internally as a Double. Dates, like all
    numerical types, are initialized to zero, which corresponds to December 30, 1899 at 00:00:00. Adding or subtracting
    1 to/from a date corresponds to adding or subtracting a day. One hour, one minute, and one second correspond to the
    numbers 1/24, 1/(24 * 60), and 1/(24 * 60 * 60), respectively. The date functions supported by OOo Basic are
    introduced in <strong> </strong>and fully discussed later.
</p>
<p>
    <strong>Listing .</strong> Demonstrate date variables.
</p>
<p>
    Sub ExampleDateType
</p>
<p>
    Dim tNow As Date, tToday As Date
</p>
<p>
    Dim tBirthDay As Date
</p>
<p>
    tNow = Now()
</p>
<p>
    tToday = Date()
</p>
<p>
    tBirthDay = DateSerial(1776, 7, 4)
</p>
<p>
    Print "Today = " &amp; tToday
</p>
<p>
    Print "Now = " &amp; tNow
</p>
<p>
    Print "A total of " &amp; (tToday - tBirthDay) &amp;_
</p>
<p>
    " days have passed since " &amp; tBirthDay
</p>
<p>
    End Sub
</p>
<p>
    Negative numbers are valid and correspond to dates before December 30, 1899. January 1, 0001, corresponds to the
    floating-point number -693,595. Continuing backward produces dates that are B.C. (Before Christ, sometimes also
    referred to as B.C.E., meaning Before the Christian Era, or Before the Common Era) rather than A.D. (Anno Domini). A
    thorough discussion of date handling is presented later.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Functions and subroutines related to
    dates and times.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CDate(expression)
            </td>
            <td>
                Date
            </td>
            <td>
                Convert a number or string to a date.
            </td>
        </tr>
        <tr class="even">
            <td>
                CDateFromIso(string)
            </td>
            <td>
                Date
            </td>
            <td>
                Convert to a date from an ISO 8601 date representation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CDateToIso(date)
            </td>
            <td>
                String
            </td>
            <td>
                Convert a date to an ISO 8601 date representation.
            </td>
        </tr>
        <tr class="even">
            <td>
                Date()
            </td>
            <td>
                String
            </td>
            <td>
                Return the current date as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DateSerial(yr, mnth, day)
            </td>
            <td>
                Date
            </td>
            <td>
                Create a date from component pieces: Year, Month, Day.
            </td>
        </tr>
        <tr class="even">
            <td>
                DateValue(date)
            </td>
            <td>
                Date
            </td>
            <td>
                Extract the date from a date/time value by truncating the decimal portion.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Day(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the day of the month as an Integer from a Date value.
            </td>
        </tr>
        <tr class="even">
            <td>
                GetSystemTicks()
            </td>
            <td>
                Long
            </td>
            <td>
                Return the number of system ticks as a Long.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Hour(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the hour as an Integer from a Date value.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsDate(value)
            </td>
            <td>
                Boolean
            </td>
            <td>
                Is this a date?
            </td>
        </tr>
        <tr class="odd">
            <td>
                Minute(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the minute as an Integer from a Date value.
            </td>
        </tr>
        <tr class="even">
            <td>
                Month(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the month as an Integer from a Date value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Now()
            </td>
            <td>
                Date
            </td>
            <td>
                Return the current date and time as a Date object.
            </td>
        </tr>
        <tr class="even">
            <td>
                Second(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the seconds as an Integer from a Date value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Time()
            </td>
            <td>
                String
            </td>
            <td>
                Return the time as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                Timer()
            </td>
            <td>
                Date
            </td>
            <td>
                Return the number of seconds since midnight as a Date. Convert to a Long.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TimeSerial(hour, min, sec)
            </td>
            <td>
                Date
            </td>
            <td>
                Create a date from component pieces: Hours, Minutes, Seconds.
            </td>
        </tr>
        <tr class="even">
            <td>
                WeekDay(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the integer 1 through 7, corresponding to Sunday through Saturday.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Year(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the year as an Integer from a Date value.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="create-your-own-data-types">
                            <span id="anchor-38"></span>Create your own data types
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    In most implementations of the BASIC programming language, you can create your own data types. OOo Basic allows you
    to define and use your own data types.
</p>
<p>
    <strong>Listing .</strong> Demonstrate user defined types.
</p>
<p>
    Type PersonType
</p>
<p>
    FirstName As String
</p>
<p>
    LastName As String
</p>
<p>
    End Type
</p>
<p>
    Sub ExampleCreateNewType
</p>
<p>
    Dim Person As PersonType
</p>
<p>
    Person.FirstName = "Andrew"
</p>
<p>
    Person.LastName = "Pitonyak"
</p>
<p>
    PrintPerson(Person)
</p>
<p>
    End Sub
</p>
<p>
    Sub PrintPerson(x)
</p>
<p>
    Print "Person = " &amp; x.FirstName &amp; " " &amp; x.LastName
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Although user-defined types cannot directly contain an array, you can manage them in a variant type.
            </td>
        </tr>
    </tbody>
</table>
<p>
    In OOo version 3.2, there are three ways that you can instantiate an instance of a user defined type. In the
    following example, the colon (:) is used to place two statements on the same line.
</p>
<p>
    Dim x As New PersonType ' The original way to do it.
</p>
<p>
    Dim y As PersonType ' New is no longer required.
</p>
<p>
    Dim z : z = CreateObject("PersonType") ' Create the object when desired.
</p>
<p>
    When you create your own type, you create a structure (frequently called a struct). OOo has many predefined internal
    structures. A commonly used structure is “com.sun.star.beans.PropertyValue”. The internal OOo structures can be
    created in the same way as user defined types, and also using CreateUnoStruct (see <a href="#anchor-39">10</a><a
        href="#anchor-39">Universal Network Objects</a> on page <a href="#anchor-39">228</a>).
</p>
<p>
    Dim a As New com.sun.star.beans.PropertyValue
</p>
<p>
    Dim b As New com.sun.star.beans.PropertyValue
</p>
<p>
    Dim c : c = CreateObject("com.sun.star.beans.PropertyValue")
</p>
<p>
    Dim d : d = CreateUnoStruct("com.sun.star.beans.PropertyValue")
</p>
<p>
    Although the structure's type is “com.sun.star.beans.PropertyValue”, it is common to abbreviate the type name as the
    last portion of the name<em><em> — </em></em>in this case, “PropertyValue”. Many of the objects in OOo have similar,
    long, cumbersome names, which are similarly abbreviated in this book.
</p>
<p>
    Most variables copy by value. This means that when I assign one variable to another, the value from one is placed
    into the other. They do not reference the same data; they contain their own copy of the data. This is also true of
    user-defined types and internal OOo structures. Variables that can be defined in this way are copied by value. Other
    types used internally by OOo, called Universal Network Objects, are copied by reference. Although these are
    discussed later, it is important to start thinking about what happens when one variable is assigned to another. If I
    assign one variable to another and it is copied by reference, then both variables refer to the same data. If two
    variables refer to the same data, and if I change one variable, then I change both.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="declare-variables-with-special-types">
                            <span id="anchor-40"></span>Declare variables with special types
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    You can use the keywords “As New” to define a variable as a known UNO struct. The word “struct” is an abbreviated
    form of the word “structure” that is frequently used by computer programmers. A struct has one or more data members,
    each of which may have different types. Structs are used to group associated data together.
</p>
<p>
    Option Compatible provides a new syntax to define variables of known and unknown types. A simple example is
    declaring a variable of a specific type even if the type is not known to OOo Basic.
</p>
<p>
    Option Compatible 'Supported in OOo 2.0
</p>
<p>
    Sub Main
</p>
<p>
    Dim oVar1 As Object
</p>
<p>
    Dim oVar2 As MyType
</p>
<p>
    Set oVar1 = New MyType 'Supported in OOo 2.0
</p>
<p>
    Set oVar2 = New MyType 'Supported in OOo 2.0
</p>
<p>
    Set oVar2 = New YourType 'Error, declared as MyType not YourType.
</p>
<p>
    A new OLE object factory was introduced with OOo 2.0, which allows new types to be created. The new functionality
    allows OOo Basic to manipulate Microsoft Word documents on Microsoft Windows operating systems if Microsoft Office
    is also installed on the computer.
</p>
<p>
    Sub Main
</p>
<p>
    Dim W As Word.Application
</p>
<p>
    Set W = New Word.Application
</p>
<p>
    REM Dim W As New Word.Application 'This works in OOo 2.0
</p>
<p>
    REM W = CreateObject("Word.Application") 'This works in OOo 2.0
</p>
<p>
    W.Visible = True
</p>
<p>
    End Sub
</p>
<p>
    The use of CreateObject() does not rely on “Option Compatible” because this functionality is provided by the new OLE
    object factory released with OOo 2.0.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="object-variables">
                            <span id="anchor-41"></span>Object variables
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    An Object is a complex data type that can contain more than a single piece of data. The code in <strong>
    </strong>shows an example of a complex data type. In OpenOffice.org, Object variables are intended to hold complex
    data types created and defined by OOo Basic. When a variable of type Object is first declared, it contains the
    special value Null, which indicates that no valid value is present.
</p>
<p>
    Use the Variant type, not Object, to refer to OpenOffice.org internals. This is discussed later.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="variant-variables">
                            <span id="anchor-42"></span>Variant variables
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Variant variables are able to hold any data type. They take on the type of whatever is assigned to them. When a
    variable of type Variant is first declared, it contains the special value Empty, which indicates that no value has
    been assigned to the variable. A Variant may be assigned an integer in one statement and then assigned text in the
    next. No typecasting occurs when assigning data to a Variant; it simply becomes the appropriate type.
</p>
<p>
    The chameleon-like behavior of Variant variables allows them to be used as any other variable type. However, this
    flexibility comes with a cost: time. One final problem is that it isn’t always obvious what type a Variant will
    become after making some assignments.
</p>
<p>
    <strong>Listing .</strong> Demonstrate variant types.
</p>
<p>
    Sub ExampleTestVariants
</p>
<p>
    DIM s As String
</p>
<p>
    DIM v As Variant
</p>
<p>
    REM v starts Empty
</p>
<p>
    s = s &amp; "1 : TypeName = " &amp; TypeName(v) &amp; " Value = " &amp; v &amp; CHR$(10)
</p>
<p>
    v = "ab217" : REM v becomes a String
</p>
<p>
    s = s &amp; "2 : TypeName = " &amp; TypeName(v) &amp; " Value = " &amp; v &amp; CHR$(10)
</p>
<p>
    v = True : REM v becomes a Boolean
</p>
<p>
    s = s &amp; "3 : TypeName = " &amp; TypeName(v) &amp; " Value = " &amp; v &amp; CHR$(10)
</p>
<p>
    v = (5=5) : REM v becomes an Integer rather than a Boolean
</p>
<p>
    s = s &amp; "4 : TypeName = " &amp; TypeName(v) &amp; " Value = " &amp; v &amp; CHR$(10)
</p>
<p>
    v = 123.456 : REM Double
</p>
<p>
    s = s &amp; "5 : TypeName = " &amp; TypeName(v) &amp; " Value = " &amp; v &amp; CHR$(10)
</p>
<p>
    v =123 : REM Integer
</p>
<p>
    s = s &amp; "6 : TypeName = " &amp; TypeName(v) &amp; " Value = " &amp; v &amp; CHR$(10)
</p>
<p>
    v = 1217568942 : REM This could be a Long but it turns into a Double
</p>
<p>
    s = s &amp; "7 : TypeName = " &amp; TypeName(v) &amp; " Value = " &amp; v &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "The Variant Takes Many Types"
</p>
<p>
    End Sub
</p>
<p>
    Visual Basic .NET does not support type Variant. Undeclared variables are of type Object.
</p>
<p>
    <img src="Pictures/1000000000000144000000B064F9FECF.png" style="width:3.3752in;height:1.8335in" />
</p>
<p>
    <strong>Figure .</strong> Variant takes the assigned type.
</p>
<p>
    When data is assigned to a Variant, the data is not converted to an appropriate type, but rather the Variant becomes
    the type of the data. In line 6 of , the Variant is an Integer. In line 7, the number is too large to be an Integer,
    but it is small enough to be a Long. OOo Basic chooses to convert whole numbers larger than an integer and all
    floating-point numbers into a Double, even if they can be expressed as a Single or a Long.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="constants">
                            <span id="anchor-43"></span>Constants
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A constant is a variable with no type, and that cannot change value. The variable is defined to be a placeholder
    that is substituted by the expression that defines the constant. Constants are defined with the keyword Const. The
    constant name can be any valid variable name.
</p>
<p>
    Const ConstName=Expression
</p>
<p>
    Constants improve macros in many ways. Consider a Gravity constant frequently used in physics. Physics scholars will
    recognize this as the acceleration due to gravity in meters per second squared.
</p>
<p>
    Const Gravity = 9.81
</p>
<p>
    Here are some specific benefits of using constants:
</p>
<ul>
    <li>
        Constants improve the readability of a macro. The word Gravity is easier to recognize than the value 9.81.
    </li>
    <li>
        Constants are easy to manage. If I require greater precision or if the gravitational pull changes, I have to
        change the value in only one location.
    </li>
    <li>
        Constants help prevent difficult-to-find errors by changing run-time errors into compile-time errors. Typing
        “Grevity” rather than “Gravity” is a compile-time error, while mistyping “9.81” as “9.18” is not.
    </li>
    <li>
        While a value like 9.81 may be obvious to you, it may not be as obvious to others reading your code later. It
        becomes what programmers call a “magic number,” and experienced programmers try to avoid magic numbers at all
        costs. Their unexplained meanings make for difficulties in maintaining code later, when the original programmer
        is not available to explain<em><em> — </em></em>or has forgotten the details entirely.
    </li>
</ul>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                OpenOffice.org defines the constant Pi. This is a mathematical constant with a value of approximately
                3.1415926535897932385.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="the-with-statement">
                    <span id="anchor-44"></span>The With statement
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The With statement is used to simplify accessing complex data types. defines a data type that contains two different
    variables: FirstName and LastName. You can access these variables by placing a period between the variable name and
    the data item.
</p>
<p>
    Sub ExampleCreateNewType
</p>
<p>
    Dim Person As PersonType
</p>
<p>
    Person.FirstName = "Andrew"
</p>
<p>
    Person.LastName = "Pitonyak"
</p>
<p>
    ...
</p>
<p>
    End Sub
</p>
<p>
    Or... the With statement provides a shortcut for accessing multiple data elements from the same variable.
</p>
<p>
    Sub ExampleCreateNewType
</p>
<p>
    Dim Person As PersonType
</p>
<p>
    With Person
</p>
<p>
    .FirstName = "Andrew"
</p>
<p>
    .LastName = "Pitonyak"
</p>
<p>
    End With
</p>
<p>
    ...
</p>
<p>
    End Sub
</p>
<p>
    Similarly:
</p>
<p>
    Dim oProp As New com.sun.star.beans.PropertyValue
</p>
<p>
    oProp.Name = "Person" 'Set Name Property
</p>
<p>
    oProp.Value = "Boy Bill" 'Set Value Property
</p>
<p>
    Using With:
</p>
<p>
    Dim oProp As New com.sun.star.beans.PropertyValue
</p>
<p>
    With oProp
</p>
<p>
    .Name = "Person" 'Set Name Property
</p>
<p>
    .Value = "Boy Bill" 'Set Value Property
</p>
<p>
    End With
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="arrays">
                    <span id="anchor-45"></span>Arrays
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    An array is a data structure in which similar elements of data are arranged in an indexed structure<em><em> —
        </em></em>for example, a column of names or a table of numbers. See . An array allows you to store many
    different values in a single variable, and uses parentheses to define and access array elements. OOo Basic does not
    support the use of square brackets as used by other languages such as C and Java.
</p>
<p>
    Array variables are declared using the Dim statement. Think of a one-dimensional array as a column of values and a
    two-dimensional array as a table of values. Higher dimensions are supported but difficult to visualize. An array
    index may be any Integer value from -32,768 through 32,767.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Declaring an array is easy!
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Dim a(5) As Integer
            </td>
            <td>
                6
            </td>
            <td>
                From 0 through 5 inclusive.
            </td>
        </tr>
        <tr class="even">
            <td>
                Dim b(5 To 10) As String
            </td>
            <td>
                6
            </td>
            <td>
                From 5 through 10 inclusive.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Dim c(-5 To 5) As String
            </td>
            <td>
                11
            </td>
            <td>
                From -5 through 5 inclusive.
            </td>
        </tr>
        <tr class="even">
            <td>
                Dim d(5, 1 To 6) As Integer
            </td>
            <td>
                36
            </td>
            <td>
                Six rows with six columns from 0 through 5 and 1 through 6.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Dim e(5 To 10, 20 To 25) As Long
            </td>
            <td>
                36
            </td>
            <td>
                Six rows with six columns from 5 through 10 and 20 through 25.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                You must declare array variables before using them, even if you don’t use “Option Explicit.”
            </td>
        </tr>
    </tbody>
</table>
<p>
    If the lower dimension of an array is not specified, the default lower bound of an array is zero. (Programmers call
    these arrays “zero-based.”) Thus, an array with five elements will have elements numbered a(0) through a(4). Use the
    keywords “Option Base 1” to change the default lower bound of an array to start at 1 rather than 0. This must be
    done before any other executable statement in the program.
</p>
<p>
    Option Base { 0 | 1 }
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Specify the lower bound of an array rather than relying on the default behavior. This is more portable
                and it will not change when the Option Base statement is used.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Dim a(3) allows for four elements: a(0), a(1), a(2), and a(3). Option Base does not change the number of elements
    that an array can store; it changes only how they are indexed. Using Option Base 1, the same statement still allows
    for four elements: a(1), a(2), a(3), and a(4). I consider this behavior unintuitive and recommend against using
    Option Base. If you want specific array bounds, the preferred option is to explicitly declare the array bounds. For
    example, Dim a(1 To 4). Option Base has risks in terms of communicating clear documentation and ensuring
    portability.
</p>
<p>
    Visual Basic handles Option Base 1 differently from OOo Basic; VB changes the lower bound to 1 but does not change
    the upper bound. Visual Basic .NET no longer supports Option Base. With “Option Compatible,” “Option Base 1” does
    not increase the upper bound by 1. In other words, OOo Basic acts like VB.
</p>
<p>
    Accessing and changing the values in an array is easy. Initializing an array this way is tedious.
</p>
<p>
    <strong>Listing .</strong> Demonstrate simple array.
</p>
<p>
    Sub ExampleSimpleArray1
</p>
<p>
    Dim a(2) As Integer, b(-2 To 1) As Long
</p>
<p>
    Dim m(1 To 2, 3 To 4)
</p>
<p>
</p>
<p>
    REM Did you know that multiple statements can be placed
</p>
<p>
    REM on a single line if separated by a colon?
</p>
<p>
    a(0) = 0 : a(1) = 1 : a(2) = 2
</p>
<p>
    b(-2) = -2 : b(-1) = -1 : b(0) = 0 : b(1) = 1
</p>
<p>
    m(1, 3) = 3 : m(1, 4) = 4
</p>
<p>
    m(2, 3) = 6 : m(2, 4) = 8
</p>
<p>
    Print "m(2,3) = " &amp; m(2,3)
</p>
<p>
    Print "b(-2) = " &amp; b(-2)
</p>
<p>
    End Sub
</p>
<p>
    To quickly fill a Variant array, use the Array function (see ), which returns a Variant array with the included
    data. The functions LBound and Ubound return the lower bound and upper bound of an array. Routines supported by OOo
    Basic are summarized in ,<strong> </strong>and discussed thoroughly later.
</p>
<p>
    <strong>Listing .</strong> Use Array() to quickly fill an array.
</p>
<p>
    Sub ExampleArrayFunction
</p>
<p>
    Dim a, i%, s$
</p>
<p>
    a = Array("Zero", 1, Pi, Now)
</p>
<p>
    Rem String, Integer, Double, Date
</p>
<p>
    For i = LBound(a) To UBound(a)
</p>
<p>
    s$ = s$ &amp; i &amp; " : " &amp; TypeName(a(i)) &amp; " : " &amp; a(i) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s$, 0, "Example of the Array Function"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000011300000082986D5938.png" style="width:2.8646in;height:1.3543in" />
</p>
<p>
    <strong>Figure .</strong> Different variable types in the same array.
</p>
<p>
    A variable defined as an array but not dimensioned, such as Dim a(), is called an empty array. Test for an empty
    array by comparing the upper bound of the array to the lower bound. If the upper bound is less than the lower bound,
    the array is empty and no dimensions have been set. An array that has been dimensioned, such as Dim a(5), is not
    empty.
</p>
<p>
    The behavior for LBound and UBound has changed over time. Some releases of OOo produce an error for UBound(b) and
    some do not. All versions should work correctly with UBound(b()). At the time of this writing, the upper and lower
    array bounds for c (in ) fails because c is an empty object.
</p>
<p>
    <strong>Listing .</strong> Parentheses are not always required but are always allowed.
</p>
<p>
    Sub ArrayDimensionError
</p>
<p>
    On Error Goto ErrorHandler
</p>
<p>
    Dim a(), b(1 To 2), c
</p>
<p>
    Dim iLine As Integer
</p>
<p>
    Dim s$
</p>
<p>
    REM Valid constructs
</p>
<p>
    iLine = 1 : s = "a = (" &amp; LBound(a()) &amp; ", "
</p>
<p>
    iLine = 2 : s = s &amp; UBound(a) &amp; ")"d
</p>
<p>
    iLine = 3 : s = s &amp; CHR$(10) &amp; "b = (" &amp; LBound(b()) &amp; ", "
</p>
<p>
    iLine = 4 : s = s &amp; UBound(b) &amp; ")"
</p>
<p>
    iLine = 5 : s = s &amp; CHR$(10) &amp; "c = (" &amp; LBound(c()) &amp; ", "
</p>
<p>
    iLine = 6 : s = s &amp; UBound(c) &amp; ")"
</p>
<p>
    MsgBox s, 0, "LBound and UBound"
</p>
<p>
    Exit Sub
</p>
<p>
    ErrorHandler:
</p>
<p>
    s = s &amp; CHR$(10) &amp; "Error " &amp; Err &amp; ": " &amp; Error$ &amp; " (line : " &amp; iLine &amp; ")"
</p>
<p>
    Resume Next
</p>
<p>
    End Sub
</p>
<p>
    <strong>Table .</strong> Summary of subroutines and functions related to arrays.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Array(args)
            </td>
            <td>
                Return a Variant array that contains the arguments.
            </td>
        </tr>
        <tr class="even">
            <td>
                DimArray(args)
            </td>
            <td>
                Return an empty Variant array. The arguments specify the dimension.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsArray(var)
            </td>
            <td>
                Return True if this variable is an array, False otherwise.
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    Join(array)
                </p>
                <p>
                    Join(array, delimiter)
                </p>
            </td>
            <td>
                Concatenate the array elements separated by the optional string delimiter and return as a String. The
                default delimiter is a single space.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    LBound(array)
                </p>
                <p>
                    LBound(array, dimension)
                </p>
            </td>
            <td>
                Return the lower bound of the array argument. The optional dimension specifies which dimension to check.
                The first dimension is 1.
            </td>
        </tr>
        <tr class="even">
            <td>
                ReDim var(args) As Type
            </td>
            <td>
                Change the dimension of an array using the same syntax as the DIM statement. The keyword Preserve keeps
                existing data intact — ReDim Preserve x(1 To 4) As Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    Split(str)
                </p>
                <p>
                    Split(str, delimiter)
                </p>
                <p>
                    Split(str, delimiter, n)
                </p>
            </td>
            <td>
                Split the string argument into an array of strings. The default delimiter is a space. The optional
                argument “n” limits the number of strings returned.
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    UBound(array)
                </p>
                <p>
                    UBound(array, dimension)
                </p>
            </td>
            <td>
                Return the upper bound of the array argument. The optional dimension specifies which dimension to check.
                The first dimension is 1.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="changing-the-dimension-of-an-array">
                            <span id="anchor-46"></span>Changing the dimension of an array
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The desired dimension of an array is not always known ahead of time. Sometimes, the dimension is known; but it
    changes periodically, and the code must be changed. An array variable can be declared with or without specifying the
    dimensions. OOo Basic provides a few different methods to set or change the dimensions of an array.
</p>
<p>
    The Array function generates a Variant array that contains data. This is a quick way to initialize an array. You are
    not required to set the dimension of the array, but, if you do, it will change to become the array returned by the
    Array function.
</p>
<p>
    Dim a()
</p>
<p>
    a = Array(3.141592654, "PI", 9.81, "Gravity")
</p>
<p>
    The arguments passed to the Array function become data in the returned Variant array. The DimArray function, on the
    other hand, interprets the arguments as the dimensions of an array to create (see ). The arguments can be
    expressions, so a variable can be used to set the dimension.
</p>
<p>
    <strong>Listing .</strong> Redimension array.
</p>
<p>
    Sub ExampleDimArray
</p>
<p>
    Dim a(), i%
</p>
<p>
    Dim s$
</p>
<p>
    a = Array(10, 11, 12)
</p>
<p>
    s = "" &amp; LBound(a()) &amp; " " &amp; UBound(a()) Rem 0 2
</p>
<p>
    a() = DimArray(3) REM the same as Dim a(3)
</p>
<p>
    a() = DimArray(2, 1) REM the same as Dim a(2,1)
</p>
<p>
    i = 4
</p>
<p>
    a = DimArray(3, i) Rem the same as Dim a(3,4)
</p>
<p>
    s = s &amp; CHR$(10) &amp; LBound(a(),1) &amp; " " &amp; UBound(a(),1) Rem 0, 3
</p>
<p>
    s = s &amp; CHR$(10) &amp; LBound(a(),2) &amp; " " &amp; UBound(a(),2) Rem 0, 4
</p>
<p>
    a() = DimArray() REM an empty array
</p>
<p>
    MsgBox s, 0, "Example Dim Array"
</p>
<p>
    End Sub
</p>
<p>
    The Array and DimArray functions both return an array of Variants. The ReDim statement changes the dimension of an
    existing array. This can change both individual dimensions and the number of dimensions. The arguments can be
    expressions because the ReDim statement is evaluated at run time.
</p>
<p>
    Dim e() As Integer, i As Integer
</p>
<p>
    i = 4
</p>
<p>
    ReDim e(5) As Integer REM Dimension is 1, a size of 0 To 5 is valid.
</p>
<p>
    ReDim e(3 To 10) As Integer REM Dimension is 1, a size of 3 To 10 is valid.
</p>
<p>
    ReDim e(3, i) As Integer REM Dimension is 2, a size of (0 To 3, 0 To 4) is valid.
</p>
<p>
    Some tips regarding arrays:
</p>
<ul>
    <li>
        LBound and UBound work with empty arrays.
    </li>
    <li>
        An empty array has one dimension. The lower bound is zero and the upper bound is -1.
    </li>
    <li>
        Use ReDim to cause an existing array to become empty.
    </li>
</ul>
<p>
    The ReDim statement supports the keyword Preserve. This attempts to save the data when the dimensions of an array
    are changed. Increasing the dimension of an array preserves all of the data, but decreasing the dimension causes
    data to be lost by truncation. Data can be truncated at either end. If an element in the new array existed in the
    old array, the value is unchanged. Unlike some variants of BASIC, OOo Basic allows all dimensions of an array to be
    changed while still preserving data.
</p>
<p>
    Dim a() As Integer
</p>
<p>
    ReDim a(3, 3, 3) As Integer
</p>
<p>
    a(1,1,1) = 1 : a(1, 1, 2) = 2 : a(2, 1, 1) = 3
</p>
<p>
    ReDim preserve a(-1 To 4, 4, 4) As Integer
</p>
<p>
    Print "(" &amp; a(1,1,1) &amp; ", " &amp; a(1, 1, 2) &amp; ", " &amp; a(2, 1, 1) &amp; ")"
</p>
<p>
    ReDim specifies both the dimensions and an optional type. If the type is included, it must match the type specified
    when the variable is declared or OOo generates a compile-time error.
</p>
<p>
    is a utility function that accepts a simple array and returns a string with all of the elements in the array. The
    ReDim example code, also in , uses ArrayToString.
</p>
<p>
    <strong>Listing .</strong> Utility function array to string.
</p>
<p>
    REM ArrayToString accepts a simple array and places the value
</p>
<p>
    REM of each element in the array into a string.
</p>
<p>
    Function ArrayToString(a() As Variant) As String
</p>
<p>
    Dim i%, s$
</p>
<p>
    For i% = LBound(a()) To UBound(a())
</p>
<p>
    s$ = s$ &amp; i% &amp; " : " &amp; a(i%) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    ArrayToString = s$
</p>
<p>
    End Function
</p>
<p>
    Sub ExampleReDimPreserve
</p>
<p>
    Dim a(5) As Integer, b(), c() As Integer
</p>
<p>
    a(0) = 0 : a(1) = 1 : a(2) = 2 : a(3) = 3 : a(4) = 4 : a(5) = 5
</p>
<p>
    Rem a is dimensioned from 0 to 5 where a(i) = i
</p>
<p>
    MsgBox ArrayToString(a()), 0 , "a() at start"
</p>
<p>
    Rem a is re-dimensioned from 1 to 3 where a(i) = i
</p>
<p>
    ReDim Preserve a(1 To 3) As Integer
</p>
<p>
    MsgBox ArrayToString(a()), 0 , "a() after ReDim"
</p>
<p>
    Rem Array() returns a Variant type
</p>
<p>
    Rem b is dimensioned from 0 to 9 where b(i) = i+1
</p>
<p>
    b = Array(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
</p>
<p>
    MsgBox ArrayToString(b()), 0 , "b() at initial assignment"
</p>
<p>
    Rem b is dimensioned from 1 to 3 where b(i) = i+1
</p>
<p>
    ReDim Preserve b(1 To 3)
</p>
<p>
    MsgBox ArrayToString(b()), 0 , "b() after ReDim"
</p>
<p>
    Rem The following is NOT valid because the array is already dimensioned
</p>
<p>
    Rem to a different size
</p>
<p>
    Rem a = Array(0, 1, 2, 3, 4, 5)
</p>
<p>
</p>
<p>
    Rem c is dimensioned from 0 to 5 where c(i) = i
</p>
<p>
    Rem If "ReDim" had been done on c, then this would NOT work
</p>
<p>
    c = Array(0, 1, 2, "three", 4, 5)
</p>
<p>
    MsgBox ArrayToString(c()), 0 , "Integer array c() Assigned to a Variant"
</p>
<p>
    Rem Ironically, this is allowed but c will contain no data!
</p>
<p>
    ReDim Preserve c(1 To 3) As Integer
</p>
<p>
    MsgBox ArrayToString(c()), 0 , "ReDim Integer c() after assigned Variant"
</p>
<p>
    End Sub
</p>
<p>
    Visual Basic has different rules for changing the dimensions of an array, and these rules change between versions of
    Visual Basic. As a general rule, OOo Basic is more flexible.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="the-unexpected-behavior-of-arrays">
                            <span id="anchor-47"></span>The unexpected behavior of arrays
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Assigning one Integer variable to another copies the value, and the variables are not related in any other way. In
    other words, if you change the first variable’s value, the second variable’s value does not change. This is not true
    for array variables. Assigning one array variable to another makes a reference to the first array rather than
    copying the data. All changes made to either are automatically seen by the other. It doesn’t matter which one is
    changed; they are both affected. This is the difference between “pass by <em>value</em>” (integers) and “pass by
    <em>reference</em>” (arrays).
</p>
<p>
    <strong>Listing .</strong> Arrays copy as references.
</p>
<p>
    Sub ExampleArrayCopyIsRef
</p>
<p>
    Dim a(5) As Integer, c(4) As Integer, s$
</p>
<p>
    c(0) = 4 : c(1) = 3 : c(2) = 2 : c(3) = 1 : c(4) = 0
</p>
<p>
    a() = c()
</p>
<p>
    a(1) = 7
</p>
<p>
    c(2) = 10
</p>
<p>
    s$ = "**** a() *****" &amp; CHR$(10) &amp; ArrayToString(a()) &amp; CHR$(10) &amp;_
</p>
<p>
    CHR$(10) &amp; "**** c() *****" &amp; CHR$(10) &amp; ArrayToString(c())
</p>
<p>
    MsgBox s$, 0 , "Change One, Change Both"
</p>
<p>
    End Sub
</p>
<p>
    To illustrate that arrays are assigned by reference, create three arrays<em><em> — </em></em>a(), b(), and
    c()<em><em> — </em></em>as shown in . Internally, OOo Basic creates three arrays that are referenced by a(), b(),
    and c().
</p>
<p>
    <img src="Pictures/1000000000000244000000831A334AB3.png" style="width:6.0362in;height:1.3516in" />
</p>
<p>
    <strong>Figure .</strong> Assigning an array assigns a reference.
</p>
<p>
    Assign array a() to array b(), and both a() and b() reference the same data. The variable a() does not reference the
    variable b(), it references the same data referenced by b() (see ). Therefore, changing a() also changes b(). The
    original array referenced by a() is no longer referenced.
</p>
<p>
    <img src="Pictures/1000000000000244000000839DBCFD2D.png" style="width:6.0362in;height:1.3516in" />
</p>
<p>
    <strong>Figure .</strong> Assigning an array assigns a reference.
</p>
<p>
    Assign array b() to array c(), and both b() and c() reference the same data. The variable a() remains unchanged, as
    shown in .
</p>
<p>
    <img src="Pictures/10000000000002440000008306C0D3C0.png" style="width:6.0362in;height:1.3516in" />
</p>
<p>
    <strong>Figure .</strong> Assigning an array assigns a reference.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Type checking is not performed when an array is assigned to another array. Do not assign arrays of
                different types to each other.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <span id="anchor-48"></span>Because no type checking is performed when an array is assigned to another array,
    unexpected and obscure problems can occur. The Array function returns a Variant array, and is the quickest method to
    assign multiple values to an array variable. An obvious problem is that an Integer array may contain String values
    if it references a Variant array. A less obvious problem is that the ReDim statement works based on the declared
    type. The statement “ReDim Preserve” on an Integer array assigned to a Variant array fails to preserve the data.
</p>
<p>
    Dim a() As Integer REM Declare a() as an Integer()
</p>
<p>
    a() = Array(0, 1, 2, 3, 4, 5, 6) REM Assign a Variant() to an Integer()
</p>
<p>
    ReDim Preserve a(1 To 3) As Integer REM This wipes the array
</p>
<p>
    To safely assign arrays while maintaining the correct data type, another method is required. Copy each element in
    the array individually. This also prevents two array variables from referencing the same array.
</p>
<p>
    <strong>Listing .</strong> More complex array example.
</p>
<p>
    Sub ExampleSetIntArray
</p>
<p>
    Dim iA() As Integer
</p>
<p>
    SetIntArray(iA, Array(9, 8, "7", "six"))
</p>
<p>
    MsgBox ArrayToString(iA), 0, "Assign a Variant to an Integer"
</p>
<p>
    End Sub
</p>
<p>
    REM Dimension the first array to have the same dimensions as the second.
</p>
<p>
    REM Perform an element-by-element copy of the array.
</p>
<p>
    Sub SetIntArray(iArray() As Integer, v() As Variant)
</p>
<p>
    Dim i As Long
</p>
<p>
    ReDim iArray(LBound(v()) To UBound(v())) As Integer
</p>
<p>
    For i = LBound(v) To UBound(v)
</p>
<p>
    iArray(i) = v(i)
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="subroutines-and-functions">
                    <span id="anchor-49"></span>Subroutines and functions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Subroutines are used to group lines of code into meaningful pieces of work. A function is a subroutine that returns
    a value. The use of subroutines and functions facilitates testing, code reuse, and readability. This in turn reduces
    errors.
</p>
<p>
    The keyword Sub defines the beginning of a subroutine, and End Sub defines the end of a subroutine.
</p>
<p>
    Sub FirstSub
</p>
<p>
    Print "Running FirstSub"
</p>
<p>
    End Sub
</p>
<p>
    To use a subroutine, place the name of the subroutine that you want to call on a line. The name can optionally be
    preceded by the keyword Call.
</p>
<p>
    Sub Main
</p>
<p>
    Call FirstSub ' Call Sub FirstSub
</p>
<p>
    FirstSub ' Call Sub FirstSub again
</p>
<p>
    End Sub
</p>
<p>
    Subroutine and function names must be unique in a module. They are subject to the same naming conventions as
    variables, including the use of spaces in their names.
</p>
<p>
    Sub One
</p>
<p>
    [name with space]
</p>
<p>
    End Sub
</p>
<p>
    Sub [name with space]
</p>
<p>
    Print "I am here"
</p>
<p>
    End Sub
</p>
<p>
    Visual Basic allows a subroutine to be preceded by optional keywords such as Public or Private. Starting with OOo
    2.0, you can define a routine as public or private, but the routine is always public unless CompatibilityMode(True)
    is used first.
</p>
<p>
    Declare a subroutine as private by preceding Sub with the keyword Private.
</p>
<p>
    Private Sub PrivSub
</p>
<p>
    Print "In Private Sub"
</p>
<p>
    bbxx = 4
</p>
<p>
    End Sub
</p>
<p>
    Using Option Compatibile is not sufficient to enable Private scope, CompatibilityMode(True) must be used.
</p>
<p>
    Sub TestPrivateSub
</p>
<p>
    CompatibilityMode(False) 'Required only if CompatibilityMode(True) already used.
</p>
<p>
    Call PrivSub() 'This call works.
</p>
<p>
    CompatibilityMode(True) 'This is required, even if Option Compatible is used
</p>
<p>
    Call PrivSub() 'Runtime error (if PrivSub is in a different module).
</p>
<p>
    End Sub
</p>
<p>
    The keyword Function is used to declare a function which, like a variable, can define the type it returns. If the
    type is not declared, the return type defaults to Variant. You can assign the return value at any point and as many
    times as you want before the function ends. The last value assigned is returned.
</p>
<p>
    Sub test
</p>
<p>
    Print "The function returns " &amp; TestFunc
</p>
<p>
    End Sub
</p>
<p>
    Function TestFunc As String
</p>
<p>
    TestFunc = "hello"
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="arguments">
                            <span id="anchor-50"></span>Arguments
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A variable that is passed to a routine is called an argument. Arguments must be declared. The same rules for
    declaring variable types apply to declaring argument types.
</p>
<p>
    A routine name can optionally be followed by parentheses, both when it is defined and when it is called. A routine
    that accepts arguments can optionally enclose the argument list in parentheses. The argument list follows the
    routine name on the same line. Blank space is allowed between the name of the routine and the argument list.
</p>
<p>
    <strong>Listing .</strong> Simple argument testing.
</p>
<p>
    Sub ExampleParamTest1()
</p>
<p>
    Call ParamTest1(2, "Two")
</p>
<p>
    Call ParamTest1 1, "One"
</p>
<p>
    End Sub
</p>
<p>
    Sub ParamTest1(i As Integer, s$)
</p>
<p>
    Print "Integer = " &amp; i &amp; " String = " &amp; s$
</p>
<p>
    End Sub
</p>
<h4 id="pass-by-reference-or-by-value">
    <span id="anchor-51"></span>Pass by reference or by value
</h4>
<p>
    By default, arguments are passed by reference rather than by value. In other words, when the called subroutine
    modifies an argument, the caller sees the change. You can override this behavior by using the ByVal keyword. This
    causes a copy of the argument (rather than a reference to the argument) to be sent (see and ).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Constants passed as arguments by reference cause unexpected behavior if their value is modified in the
                called routine. The value may arbitrarily change back inside the called routine. For example, I had a
                subroutine that was supposed to decrement an Integer argument in a loop until it was zero; the argument
                never became zero.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Arguments by reference and by value.
</p>
<p>
    Sub ExampleArgumentValAndRef()
</p>
<p>
    Dim i1%, i2%
</p>
<p>
    i1 = 1 : i2 = 1
</p>
<p>
    ArgumentValAndRef(i1, i2)
</p>
<p>
    MsgBox "Argument passed by reference was 1 and is now " &amp; i1 &amp; CHR$(10) &amp;_
</p>
<p>
    "Argument passed by value was 1 and is still " &amp; i2 &amp; CHR$(10)
</p>
<p>
    End Sub
</p>
<p>
    Sub ArgumentValAndRef(iRef%, ByVal iVal)
</p>
<p>
    iRef = iRef + 1 ' This will affect the caller
</p>
<p>
    iVal = iVal - 1 ' This will not affect the caller
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001600000006525AB628E.png" style="width:3.6665in;height:1.052in" />
</p>
<p>
    <strong>Figure .</strong> Pass by reference allows changes to be passed back to the caller.
</p>
<p>
    Visual Basic supports the optional keyword ByRef. This keyword was introduced into OOo Basic starting with OOo 2.0.
    Note that pass by reference is the default behavior.
</p>
<p>
    A variable cannot be passed by value if the type does not match. The macros in and differ in the type used to
    declare the argument.
</p>
<p>
    <strong>Listing .</strong> Simple swap with a string argument.
</p>
<p>
    Sub sSwap( sDatum As String )
</p>
<p>
    Dim asDatum(1 to 3) As String
</p>
<p>
    Dim sDummy As String
</p>
<p>
    asDatum=Split(sDatum, ".")
</p>
<p>
    sDummy=asDatum(0)
</p>
<p>
    asDatum(0)=asDatum(2)
</p>
<p>
    asDatum(2)=sDummy
</p>
<p>
    sDatum=Join(asDatum,"-")
</p>
<p>
    End Sub
</p>
<p>
    <strong>Listing .</strong> Simple swap with a variant argument.
</p>
<p>
    Sub vSwap( vDatum As Variant )
</p>
<p>
    Dim asDatum(1 to 3) As String
</p>
<p>
    Dim sDummy As String
</p>
<p>
    asDatum=Split(vDatum, ".")
</p>
<p>
    sDummy=asDatum(0)
</p>
<p>
    asDatum(0)=asDatum(2)
</p>
<p>
    asDatum(2)=sDummy
</p>
<p>
    vDatum=Join(asDatum,"-")
</p>
<p>
    End Sub
</p>
<p>
    The following macro uses a variant and a string to call a macro that accepts a variant, and the macro that accepts
    the string. Passing a variant to a method that accepts a string argument basses the value by reference. The
    unexpected thing is that passing a string to the method that accepts a variant, passes the value by reference.
</p>
<p>
    <strong>Listing .</strong> Test reference by argument type.
</p>
<p>
    Sub passByReferenceTester
</p>
<p>
    Dim vVar As Variant
</p>
<p>
    Dim sVar As string
</p>
<p>
    Dim s As String
</p>
<p>
    vVar="01.02.2011"
</p>
<p>
    sVar="01.02.2011"
</p>
<p>
    s = vVar &amp; " sSwap( variant var string param ) ==&gt; "
</p>
<p>
    sSwap(vVar)
</p>
<p>
    s = s &amp; vVar &amp; CHR$(10)
</p>
<p>
    s = s &amp; sVar &amp; " sSwap( string var string param ) ==&gt; "
</p>
<p>
    sSwap(sVar)
</p>
<p>
    s = s &amp; sVar &amp; CHR$(10)
</p>
<p>
    vVar="01.02.2011"
</p>
<p>
    sVar="01.02.2011"
</p>
<p>
    s = s &amp; vVar &amp; " vSwap( variant var variant param ) ==&gt; "
</p>
<p>
    vSwap(vVar)
</p>
<p>
    s = s &amp; vVar &amp; CHR$(10)
</p>
<p>
    s = s &amp; sVar &amp; " vSwap( string var variant param ) ==&gt; "
</p>
<p>
    vSwap(sVar)
</p>
<p>
    s = s &amp; sVar &amp; CHR$(10)
</p>
<p>
    MsgBox(s)
</p>
<p>
    End Sub
</p>
<p>
    It is important that you understand when a variable is passed to a method as a reference or a value. It is equally
    important to understand when the value contained in a variable is copied by value or copied by reference.
</p>
<ul>
    <li>
        Variables with simple types copy by value; for example, assigning one integer variable to another.
    </li>
    <li>
        Arrays always copy by reference. If you assign one array to another, both variables reference and modify the
        same array.
    </li>
    <li>
        UNO Services copy by reference. This means that you can do things such as oDoc = ThisComponent, and both
        variables reference the same object.
    </li>
    <li>
        Structs copy by value. This frustrates many people when they first encounter the behavior, but there is a very
        good reason for it. First, the problem; oBorder.TopLine.OuterLineWidth = 2 fails because TopLine is a struct and
        the value is returned as a copy rather than a reference. The code as shown changes the outer line width on a
        copy of the struct rather than the struct associated with the border object. The correct way to change the
        border is (v = oBorder.TopLine : v.OuterLineWidth = 2 : oBorder.TopLine = v).
    </li>
</ul>
<p>
    A lead developer claimed that one or two services and strutcs do not assign / copy as expected, but he could not
    remember which. I have not encountered the objects that violate the guidelines, but, I try to remember the problem
    so that I am not taken unaware.
</p>
<h4 id="optional-arguments">
    <span id="anchor-52"></span>Optional arguments
</h4>
<p>
    You can declare arguments as optional by preceding them with the keyword Optional. All of the arguments following an
    optional argument must also be optional. Use the IsMissing function to determine if an optional argument is missing.
</p>
<p>
    <strong>Listing .</strong> Optional arguments.
</p>
<p>
    REM Make test calls with optional arguments.
</p>
<p>
    REM Calls with Integer and Variant arguments should yield the same result.
</p>
<p>
    REM Unfortunately, they do not.
</p>
<p>
    Sub ExampleArgOptional()
</p>
<p>
    Dim s$
</p>
<p>
    s = "Variant Arguments () =&gt; " &amp; TestOpt() &amp; CHR$(10) &amp;_
</p>
<p>
    "Integer Arguments () =&gt; " &amp; TestOptI() &amp; CHR$(10) &amp;_
</p>
<p>
    "---------------------------------------------" &amp; CHR$(10) &amp;_
</p>
<p>
    "Variant Arguments (,,) =&gt; " &amp; TestOpt(,,) &amp; CHR$(10) &amp;_
</p>
<p>
    "Integer Arguments (,,) =&gt; " &amp; TestOptI(,,) &amp; CHR$(10) &amp;_
</p>
<p>
    "---------------------------------------------" &amp; CHR$(10) &amp;_
</p>
<p>
    "Variant Arguments (1) =&gt; " &amp; TestOpt(1) &amp; CHR$(10) &amp;_
</p>
<p>
    "Integer Arguments (1) =&gt; " &amp; TestOptI(1) &amp; CHR$(10) &amp;_
</p>
<p>
    "---------------------------------------------" &amp; CHR$(10) &amp;_
</p>
<p>
    "Variant Arguments (,2) =&gt; " &amp; TestOpt(,2) &amp; CHR$(10) &amp;_
</p>
<p>
    "Integer Arguments (,2) =&gt; " &amp; TestOptI(,2) &amp; CHR$(10) &amp;_
</p>
<p>
    "---------------------------------------------" &amp; CHR$(10) &amp;_
</p>
<p>
    "Variant Arguments (1,2) =&gt; " &amp; TestOpt(1,2) &amp; CHR$(10) &amp;_
</p>
<p>
    "Integer Arguments (1,2) =&gt; " &amp; TestOptI(1,2) &amp; CHR$(10) &amp;_
</p>
<p>
    "---------------------------------------------" &amp; CHR$(10) &amp;_
</p>
<p>
    "Variant Arguments (1,,3) =&gt; " &amp; TestOpt(1,,3) &amp; CHR$(10) &amp;_
</p>
<p>
    "Integer Arguments (1,,3) =&gt; " &amp; TestOptI(1,,3) &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Optional Arguments of Type Variant or Integer"
</p>
<p>
    End Sub
</p>
<p>
    REM Return a string that contains each argument. If the argument
</p>
<p>
    REM is missing, then an M is used in its place.
</p>
<p>
    Function TestOpt(Optional v1, Optional v2, Optional v3) As String
</p>
<p>
    TestOpt = "" &amp; IIF(IsMissing(v1), "M", Str(v1)) &amp;_
</p>
<p>
    IIF(IsMissing(v2), "M", Str(v2)) &amp;_
</p>
<p>
    IIF(IsMissing(v3), "M", Str(v3))
</p>
<p>
    End Function
</p>
<p>
    REM Return a string that contains each argument. If the argument
</p>
<p>
    REM is missing, then an M is used in its place.
</p>
<p>
    Function TestOptI(Optional i1%, Optional i2%, Optional i3%) As String
</p>
<p>
    TestOptI = "" &amp; IIF(IsMissing(i1), "M", Str(i1)) &amp;_
</p>
<p>
    IIF(IsMissing(i2), "M", Str(i2)) &amp;_
</p>
<p>
    IIF(IsMissing(i3), "M", Str(i3))
</p>
<p>
    End Function
</p>
<p>
    You can omit any optional arguments. demonstrates two functions that accept optional arguments. The functions are
    the same except for the argument types. Each function returns a string containing the argument values concatenated
    together. Missing arguments are represented by the letter “M” in the string. Although the return values from TestOpt
    and TestOpt1 should be the same for the same argument lists, they are not (see ). This is a bug.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The IsMissing function returns incorrect results for variables that are not of type Variant when the
                missing argument is followed by a comma.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <img src="Pictures/100000000000016F0000012B554847F9.png" style="width:3.8228in;height:3.1146in" />
</p>
<p>
    <strong>Figure .</strong> In rare cases, non-Variant optional arguments fail.
</p>
<h4 id="default-argument-values">
    <span id="anchor-53"></span>Default argument values
</h4>
<p>
    OOo version 2.0 introduced default values for missing arguments. This allows a default value to be specified if an
    optional argument is missing. You must use the keywords “Option Compatible” for default values to work.
</p>
<p>
    Option Compatible
</p>
<p>
    Sub DefaultExample(Optional n as Integer=100)
</p>
<p>
    REM If IsMissing(n) Then n = 100 'I will not have to do this anymore!
</p>
<p>
    Print n
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="recursive-routines">
                            <span id="anchor-54"></span>Recursive routines
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A recursive routine calls itself. Consider calculating the mathematical function Factorial for positive integers.
    The usual definition is recursive.
</p>
<p>
    <strong>Listing .</strong> Recursively generate factorial.
</p>
<p>
    Sub DoFactorial
</p>
<p>
    Print "Recursive Factorial = " &amp; RecursiveFactorial(4)
</p>
<p>
    Print "Iterative Factorial = " &amp; IterativeFactorial(4)
</p>
<p>
    End Sub
</p>
<p>
    Function IterativeFactorial(ByVal n As Long) As Long
</p>
<p>
    Dim answer As Long
</p>
<p>
    answer = 1
</p>
<p>
    Do While n &gt; 1
</p>
<p>
    answer = answer * n
</p>
<p>
    n = n - 1
</p>
<p>
    Loop
</p>
<p>
    IterativeFactorial = answer
</p>
<p>
    End Function
</p>
<p>
    ' This finally works in version 1.1
</p>
<p>
    Function RecursiveFactorial(ByVal n As Long) As Long
</p>
<p>
    RecursiveFactorial = 1
</p>
<p>
    If n &gt; 1 Then RecursiveFactorial = n * RecursiveFactorial(n-1)
</p>
<p>
    End Function
</p>
<p>
    Computers use a data structure called a stack. At home, I have a stack of books that I want to read. When I receive
    a new book, I place it on top of the stack. When I have time to read, I take the top book from the stack. This is
    similar to the data structure that a computer uses: a section of memory in a computer for temporary storage in which
    the last item stored is the first retrieved. Stacks are usually used when a computer calls a routine and passes
    arguments. A typical procedure follows:
</p>
<ol type="1">
    <li>
        Push the current run location onto the stack.
    </li>
    <li>
        Push each argument onto the stack.
    </li>
    <li>
        Call the desired function or subroutine.
    </li>
    <li>
        The called routine uses the arguments from the stack.
    </li>
    <li>
        The called routine frequently uses the stack to store its own variables.
    </li>
    <li>
        The called routine removes the arguments from the stack.
    </li>
    <li>
        The called routine removes and saves the caller’s location from the stack.
    </li>
    <li>
        If the called routine is a function, the return value is placed on the stack.
    </li>
    <li>
        The called routine returns to the caller from the saved location on the stack.
    </li>
    <li>
        If the called routine is a function, the return value is taken from the stack.
    </li>
</ol>
<p>
    Although various optimizations are used, there is always some overhead associated with calling subroutines and
    functions. There is overhead in running time and in the memory required. The recursive version of Factorial
    continually calls itself. While calculating the factorial of four, there is one point at which the stack contains
    information for calls for 4, 3, 2, and 1. For some functions<em><em> — </em></em>the Fibonacci series, for
    example<em><em> — </em></em>this call behavior may be prohibitive, and a non-recursive algorithm should be used
    instead.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="scope-of-variables-subroutines-and-functions">
                    <span id="anchor-55"></span>Scope of variables, subroutines, and functions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The idea of scope deals with the lifetime and visibility of a variable, subroutine, or function in OOo Basic. The
    scope depends on the location of the declaration, and the keywords Public, Private, Static, and Global. Dim is
    equivalent to Private, but variables are Private only if CompatibilityMode(True) is used.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="local-variables-defined-in-a-subroutine-or-function">
                            <span id="anchor-56"></span>Local variables defined in a subroutine or function
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Variables declared inside a subroutine or function are called local variables. It is also commonly said that a
    variable is local to a routine if the variable is declared inside that routine.
</p>
<p>
    You can declare a variable inside a subroutine or function by using the Dim keyword. Variables defined inside a
    routine are visible only inside that routine. It is not possible to directly access a variable defined inside a
    routine from outside the routine. However, it is possible to access a variable defined outside any routine<em><em> —
        </em></em>for example, in a module header<em><em> — </em></em>from inside a routine. When a variable or routine
    name is encountered inside a routine, OOo Basic starts looking for the variable or routine in the following order:
    current routine, module, library, and other open libraries. In other words, it starts inside and works its way out.
</p>
<p>
    Variables defined in a routine are created and initialized each time the routine is entered. The variables are
    destroyed every time the routine is exited because the routine is finished. Leaving the routine to call another
    routine does not cause the variables to be reinitialized.
</p>
<p>
    Use the keyword Static to change a variable’s creation and destruction times to the calling macro’s start and finish
    times, respectively. Although the variable is visible only in the routine containing the variable, the variable is
    initialized once when the macro starts running, and the variable's values are retained through multiple calls to the
    same routine. In other words, you start with no macro running. The first time that a subroutine or function that
    contains a static variable is called, the static variables contain initial values based on their types. The static
    variables retain their values between calls as long as the macro as a whole did not stop running. The keyword Static
    uses the same syntax as the keyword Dim, and is valid only inside a subroutine or function. calls a routine that
    uses a static variable.
</p>
<p>
    <strong>Listing .</strong> Static example.
</p>
<p>
    Sub ExampleStatic
</p>
<p>
    ExampleStaticWorker()
</p>
<p>
    ExampleStaticWorker()
</p>
<p>
    End Sub
</p>
<p>
    Sub ExampleStaticWorker
</p>
<p>
    Static iStatic1 As Integer
</p>
<p>
    Dim iNonStatic As Integer
</p>
<p>
</p>
<p>
    iNonStatic = iNonStatic + 1
</p>
<p>
    iStatic1 = iStatic1 + 1
</p>
<p>
    Msgbox "iNonStatic = " &amp; iNonStatic &amp; CHR$(10) &amp;_
</p>
<p>
    "iStatic1 = " &amp; iStatic1
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="variables-defined-in-a-module">
                            <span id="anchor-57"></span>Variables defined in a module
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The Dim, Global, Public, or Private statements are used to declare variables in a module header. Global, Public, and
    Private use the same syntax as the Dim statement, but they can’t declare variables inside a subroutine or function.
    Each variable type has a different life cycle, as summarized in .
</p>
<p>
    The keywords Static, Public, Private, and Global are not used as modifiers to the keyword Dim; they are used instead
    of the keyword Dim.
</p>
<p>
    Although it is sometimes necessary to define a variable in a module header, you should avoid it if possible.
    Variables defined in the header can be seen in other modules that don’t expect them. It’s difficult to determine why
    the compiler claims that a variable is already defined if it is defined in another library or module. Even worse,
    two working libraries may stop working because of naming conflicts.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Life cycle of a variable defined in a
    module header.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Global
            </td>
            <td>
                Compile time
            </td>
            <td>
                Compile time
            </td>
            <td>
                All modules and libraries.
            </td>
        </tr>
        <tr class="even">
            <td>
                Public
            </td>
            <td>
                Macro start
            </td>
            <td>
                Macro finish
            </td>
            <td>
                Declaring library container.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Dim
            </td>
            <td>
                Macro start
            </td>
            <td>
                Macro finish
            </td>
            <td>
                Declaring library container.
            </td>
        </tr>
        <tr class="even">
            <td>
                Private
            </td>
            <td>
                Macro start
            </td>
            <td>
                Macro finish
            </td>
            <td>
                Declaring module.
            </td>
        </tr>
    </tbody>
</table>
<h4 id="global">
    <span id="anchor-58"></span>Global
</h4>
<p>
    Use Global to declare a variable that is available to every module in every library. The library containing the
    Global variable must be loaded for the variable to be visible.
</p>
<p>
    When a library is loaded, it is automatically compiled and made ready for use; this is when a Global variable is
    initialized. Changes made to a Global variable are seen by every module and are persisted even after the macro is
    finished. Global variables are reset when the containing library is compiled. Exiting and restarting OpenOffice.org
    causes all libraries to be compiled and all Global variables to be initialized. Modifying the module containing the
    Global definition also forces the module to be recompiled.
</p>
<p>
    Global iNumberOfTimesRun
</p>
<p>
    Variables declared Global are similar to variables declared Static, but Static works only for local variables, and
    Global works only for variables declared in the header.
</p>
<h4 id="public">
    <span id="anchor-59"></span>Public
</h4>
<p>
    Use Public to declare a variable that is visible to all modules in the declaring library container. Outside the
    declaring library container, the public variables aren’t visible. Public variables are initialized every time a
    macro runs.
</p>
<p>
    An application library is a library that is declared in the “OpenOffice.org” library container. This is available
    when OOo is running, is stored in its own directory, and every document can view it. Document-level libraries are
    stored in OOo documents. The libraries are saved as part of the document and are not visible outside the document.
</p>
<p>
    Public variables declared in an application library are visible in every OOo document-level library. Public
    variables declared in a library contained in an OOo document are not visible in application-level libraries.
    Declaring a Public variable in a document library effectively hides a Public variable declared in an application
    library. Simply stated (see ), if you declare a Public variable in a document, it is visible only in the document
    and it will hide a Public variable with the same name declared outside the document. A Public variable declared in
    the application is visible everywhere <em><em>— </em></em>unless a variable declaration with more local scope takes
    priority over the declaration with more global scope.
</p>
<p>
    Public oDialog As Object
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> The scope of a Public variable depends
    on where it is declared.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Application
            </td>
            <td>
                Visible everywhere.
            </td>
        </tr>
        <tr class="even">
            <td>
                Document
            </td>
            <td>
                Visible only in the declaring document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Application and Document
            </td>
            <td>
                Macros in the document are unable to see the application-level variable.
            </td>
        </tr>
    </tbody>
</table>
<h4 id="private-or-dim">
    <span id="anchor-60"></span>Private or Dim
</h4>
<p>
    Use Private or Dim to declare a variable in a module that should not be visible in another module. Private
    variables, like Public variables, are initialized every time a macro runs. A single variable name may be used by two
    different modules as their own variable if the variable is declared Private.
</p>
<p>
    Private oDialog As Variant
</p>
<ul>
    <li>
        Declaring a variable using Dim is equivalent to declaring a variable as Private.
    </li>
    <li>
        Private variables are only private, however, only with CompatibilityMode(True).
    </li>
    <li>
        Option Compatible has no affect on private variables.
    </li>
</ul>
<p>
    A Private variable is visible outside the declaring module unless CompatibilityMode(True) is used. To see for
    yourself, create two modules<em><em> — </em></em>Module1 and Module2<em><em> — </em></em>in the same library. In
    Module1, add the declaration “Private priv_var As Integer”. Macros in Module2 can use the variable “priv_var”. Even
    if Module2 is located in a different library in the same document, the variable “priv_var” is visible and usable. If
    CompatibilityMode(True) is used, however, then the private variable is no longer visible outside of the declaring
    module.
</p>
<p>
    In Module1, declare a variable “Private priv_var As Double”. A variable of the same name is declared in Module2, but
    it is an Integer variable. Each module sees its own Private variable. Changing these two variables to have Public
    scope rather than Private introduces an ugly situation; only one of these is visible and usable, but you don’t know
    which one it is without performing a test. Assign the value 4.7 to the variable, and see if it is an Integer or a
    Double.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="operators">
                    <span id="anchor-61"></span>Operators
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    An operator is a symbol that denotes or performs a mathematical or logical operation. An operator, like a function,
    returns a result. For example, the + operator adds two numbers. The arguments to the operator are called operands.
    Operators are assigned a precedence. An operator with a precedence of 1 is said to have a high precedence level; it
    is, after all, number 1!
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                While typesetting mathematical equations, the minus sign (−) is represented using the Unicode character
                U+2212. With OOo Basic, however, ASCII code 45 (-) must be used instead.
            </td>
        </tr>
    </tbody>
</table>
<p>
    In OOo Basic (see ), operators are evaluated from left to right with the restriction that an operator with a higher
    precedence is used before an operator with a lower precedence. For example, 1 + 2 * 3 evaluates to 7 because
    multiplication has higher precedence than addition. Parentheses may be used to modify the order of evaluation. For
    example, (1+2) * 3 evaluates to 9 because the expression inside the parentheses is evaluated first.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Operators supported by OpenOffice.org
    Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                NOT
            </td>
            <td>
                Unary
            </td>
            <td>
                Logical or bit-wise NOT
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                -
            </td>
            <td>
                Unary
            </td>
            <td>
                Leading minus sign, negation
            </td>
        </tr>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                +
            </td>
            <td>
                Unary
            </td>
            <td>
                Leading plus sign
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                ^
            </td>
            <td>
                Binary
            </td>
            <td>
                Numerical exponentiation. Standard mathematical precedence would have exponentiation higher than
                negation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
                *
            </td>
            <td>
                Binary
            </td>
            <td>
                Numerical multiplication
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                /
            </td>
            <td>
                Binary
            </td>
            <td>
                Numerical division
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                MOD
            </td>
            <td>
                Binary
            </td>
            <td>
                Numerical remainder after division
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                \
            </td>
            <td>
                Binary
            </td>
            <td>
                Integer division
            </td>
        </tr>
        <tr class="odd">
            <td>
                6
            </td>
            <td>
                -
            </td>
            <td>
                Binary
            </td>
            <td>
                Numerical subtraction
            </td>
        </tr>
        <tr class="even">
            <td>
                6
            </td>
            <td>
                +
            </td>
            <td>
                Binary
            </td>
            <td>
                Numerical addition and string concatenation
            </td>
        </tr>
        <tr class="odd">
            <td>
                7
            </td>
            <td>
                &amp;
            </td>
            <td>
                Binary
            </td>
            <td>
                String concatenation
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                IS
            </td>
            <td>
                Binary
            </td>
            <td>
                Do both operands reference the same object?
            </td>
        </tr>
        <tr class="odd">
            <td>
                8
            </td>
            <td>
                =
            </td>
            <td>
                Binary
            </td>
            <td>
                Equals
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                &lt;
            </td>
            <td>
                Binary
            </td>
            <td>
                Less than
            </td>
        </tr>
        <tr class="odd">
            <td>
                8
            </td>
            <td>
                &gt;
            </td>
            <td>
                Binary
            </td>
            <td>
                Greater than
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                &lt;=
            </td>
            <td>
                Binary
            </td>
            <td>
                Less than or equal to
            </td>
        </tr>
        <tr class="odd">
            <td>
                8
            </td>
            <td>
                &gt;=
            </td>
            <td>
                Binary
            </td>
            <td>
                Greater than or equal to
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                &lt;&gt;
            </td>
            <td>
                Binary
            </td>
            <td>
                Not equal
            </td>
        </tr>
        <tr class="odd">
            <td>
                9
            </td>
            <td>
                AND
            </td>
            <td>
                Binary
            </td>
            <td>
                Bit-wise for numerics and logical for Boolean
            </td>
        </tr>
        <tr class="even">
            <td>
                9
            </td>
            <td>
                OR
            </td>
            <td>
                Binary
            </td>
            <td>
                Bit-wise for numerics and logical for Boolean
            </td>
        </tr>
        <tr class="odd">
            <td>
                9
            </td>
            <td>
                XOR
            </td>
            <td>
                Binary
            </td>
            <td>
                Exclusive OR, bit-wise for numerics and logical for Boolean
            </td>
        </tr>
        <tr class="even">
            <td>
                9
            </td>
            <td>
                EQV
            </td>
            <td>
                Binary
            </td>
            <td>
                Equivalence, bit-wise for numerics and logical for Boolean
            </td>
        </tr>
        <tr class="odd">
            <td>
                9
            </td>
            <td>
                IMP
            </td>
            <td>
                Binary
            </td>
            <td>
                Implication bit-wise for numerics and logical for Boolean.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                OOo Precedence does not follow standard mathematical rules; for example, negation should have a lower
                precedence than exponentiation so -1^2 should be -1, not 1.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Visual Basic uses a different precedence for operators <em><em>— for example, numerical exponentiation and negation
            are switched, as are integer division and remainder after division.</em></em>
</p>
<p>
    The word “binary” means something made of or based on two things. “Unary” means something made of or based on one
    thing. A binary operator, not to be confused with a binary number, is placed between two operands. For example, the
    addition operator uses two operands with 1+2. In OOo Basic, binary operators are always evaluated from left to right
    based on operator precedence. A unary operator requires one operand that is placed directly to the right of the
    operator. For example, - (1 + 3). By necessity, a series of unary operators are evaluated right to left. For
    example, + - (1+3) must evaluate the rightmost negation operator first.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="mathematical-and-string-operators">
                            <span id="anchor-62"></span>Mathematical and string operators
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Mathematical operators can be used with all numerical data types. When operands of different types are mixed, a
    conversion is made to minimize the loss of precision. For example, 1 + 3.443 causes a conversion to a floating-point
    number rather than a conversion to an Integer. If the first operand is a number and the second operand is a string,
    the string is converted to a number. If the string does not contain a valid numerical value, a zero is returned and
    no error is generated. Assigning a string directly to a numeric variable, however, always assigns the value zero and
    no errors are generated.
</p>
<p>
    <strong>Listing .</strong> Strings are automatically converted to numbers when required.
</p>
<p>
    Dim i As Integer
</p>
<p>
    i = "abc" 'Assigning a string with no numbers yields zero not an error
</p>
<p>
    Print i '0
</p>
<p>
    i = "3abc" 'Assigns 3, automatically converts as it can.
</p>
<p>
    Print i '3
</p>
<p>
    Print 4 + "abc" '4
</p>
<p>
    OOo Basic tries to automatically convert types. No errors are generated when a string is used where a number is
    required. This is discussed in depth later.
</p>
<h4 id="unary-plus-and-minus--">
    <span id="anchor-63"></span>Unary plus (+) and minus (-)
</h4>
<p>
    OOo Basic allows unary operators to have spaces between the operator and the operand (see ). Unary operators also
    have the highest precedence and are evaluated from right to left. A leading plus sign is arguably useless<em><em> —
        </em></em>it emphasizes that a constant is not negative but is otherwise effectively ignored. A leading minus
    sign indicates numeric negation.
</p>
<h4 id="exponentiation">
    <span id="anchor-64"></span>Exponentiation (^)
</h4>
<p>
    Numerical exponentiation supports integer and floating-point exponents. The exponentiation operator can operate on a
    negative number only if the exponent is an integer.
</p>
<p>
    result = number^exponent
</p>
<p>
    A positive integer exponent has a conceptually simple representation. The number is multiplied by itself exponent
    times. For example, 2^4 = 2 * 2 * 2 * 2.
</p>
<ol type="1">
    <li>
        OOo does not follow standard mathematical rules for exponentiation:
    </li>
    <li>
        Exponentiation has a lower precedence than negation, so -1^2 incorrectly evaluates to 1.<br /> OOo Basic
        evaluates multiple exponents (2^3^4) left to right ((2^3)^4), while standard mathematical precedence evaluates
        right to left. (2^(3^4)).
    </li>
</ol>
<p>
    <strong>Listing .</strong> Demonstrate exponentiation.
</p>
<p>
    Sub ExampleExponent
</p>
<p>
    Dim s$
</p>
<p>
    s = "2^3 = " &amp; 2^3 REM 2*2*2 = 8
</p>
<p>
    s = s &amp; CHR$(10) &amp; "3^2 = " &amp; 3^2 REM 3 *3 = 9
</p>
<p>
    s = s &amp; CHR$(10) &amp; "-3^2 = " &amp; -3^2 REM (-3) * (-3) = 9
</p>
<p>
    s = s &amp; CHR$(10) &amp; "2^3^2 = " &amp; 2^3^2 REM 2^3^2 = 8^2 = 64
</p>
<p>
    s = s &amp; CHR$(10) &amp; "4^0.5 = " &amp; 4^.5 REM 2
</p>
<p>
    s = s &amp; CHR$(10) &amp; "4^-0.5 = " &amp; 4^-.5 REM .5
</p>
<p>
    s = s &amp; CHR$(10) &amp; "-1^2 = " &amp; -1^2 REM 1
</p>
<p>
    s = s &amp; CHR$(10) &amp; "-(1^2) = " &amp; -(1^2) REM -1
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/1000000000000096000000A4DEBE59E8.png" style="width:1.5626in;height:1.7083in" />
</p>
<p>
    <strong>Figure .</strong> Using the exponentiation operator.
</p>
<h4 id="multiplication-and-division">
    <span id="anchor-65"></span>Multiplication (*) and Division (/)
</h4>
<p>
    Multiplication and division have the same precedence.
</p>
<p>
    <strong>Listing .</strong> Demonstrate multiplication and division.
</p>
<p>
    Sub ExampleMultDiv
</p>
<p>
    Print "2*3 = " &amp; 2*3 REM 6
</p>
<p>
    Print "4/2.0 = " &amp; 4/2.0 REM 2
</p>
<p>
    Print "-3/2 = " &amp; -3/2 REM -1.5
</p>
<p>
    Print "4*3/2 = " &amp; 4*3/2 REM 6
</p>
<p>
    End Sub
</p>
<h4 id="remainder-after-division-mod">
    <span id="anchor-66"></span>Remainder after division (MOD)
</h4>
<p>
    The MOD operator is also called “remainder after division.” For example, 5 MOD 2 is 1 because 5 divided by 2 is 2
    with a remainder of 1. All operands are rounded to Integer values before the operation is performed.
</p>
<p>
    <strong>Listing .</strong> Definition of the MOD operator for integer operands x and y.
</p>
<p>
    x MOD y = x - (y * (x\y))
</p>
<p>
    <strong>Listing .</strong> Demonstrate mod operator.
</p>
<p>
    REM x MOD y can also be written as
</p>
<p>
    REM CInt(x) - (CInt(y) * (CInt(x)\CInt(y)))
</p>
<p>
    REM CInt is used because the numbers must be rounded
</p>
<p>
    REM before the operations are performed.
</p>
<p>
    Sub ExampleMOD
</p>
<p>
    Dim x(), y(), s$, i%
</p>
<p>
    x() = Array (4, 15, 6, 6.4, 6.5, -15, 15, -15)
</p>
<p>
    y() = Array (15, 6, 3, 3, 3, 8, -8, -8)
</p>
<p>
    For i = LBound(x()) To UBound(x())
</p>
<p>
    s = s &amp; x(i) &amp; " MOD " &amp; y(i) &amp; " = " &amp; (x(i) MOD y(i)) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "MOD operator"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000009C000000A4F7DED2E7.png" style="width:1.6252in;height:1.7083in" />
</p>
<p>
    <strong>Figure .</strong> Using the MOD operator.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The operands for MOD are rounded to Integer values before the division is done.
            </td>
        </tr>
    </tbody>
</table>
<h4 id="integer-division">
    <span id="anchor-67"></span>Integer division (\)
</h4>
<p>
    Regular division expects to divide a Double by a Double, and it returns a Double as an answer. For example, 7.0 /
    4.0 is 1.75. Integer division, on the other hand, expects to divide two Integers, and it returns an Integer as an
    answer. For example, 7.2 \ 4.3 converts the operands to 7 \ 4 and then returns 1. The numeric constant operands used
    with the Integer division operator are truncated to Integer values, and then Integer division is performed. The
    result is a truncated result, not a rounded result. compares the difference between Integer division and regular
    division.
</p>
<p>
    <strong>Listing .</strong> Demonstrate integer division.
</p>
<p>
    Sub ExampleIntDiv
</p>
<p>
    Dim f As Double
</p>
<p>
    Dim s$
</p>
<p>
    f = 5.9
</p>
<p>
    s = "5/2 = " &amp; 5/2 REM 2.5
</p>
<p>
    s = s &amp; CHR$(10) &amp; "5\2 = " &amp; 5\2 REM 2
</p>
<p>
    s = s &amp; CHR$(10) &amp; "5/3 = " &amp; 5/3 REM 1.666666667
</p>
<p>
    s = s &amp; CHR$(10) &amp; "5\3 = " &amp; 5\3 REM 1
</p>
<p>
    s = s &amp; CHR$(10) &amp; "5/4 = " &amp; 5/4 REM 1.25
</p>
<p>
    s = s &amp; CHR$(10) &amp; "5\4 = " &amp; 5\4 REM 1
</p>
<p>
    s = s &amp; CHR$(10) &amp; "-5/2 = " &amp; -5/2 REM -2.5
</p>
<p>
    s = s &amp; CHR$(10) &amp; "-5\2 = " &amp; -5\2 REM -2
</p>
<p>
    s = s &amp; CHR$(10) &amp; "-5/3 = " &amp; -5/3 REM -1.666666667
</p>
<p>
    s = s &amp; CHR$(10) &amp; "-5\3 = " &amp; -5\3 REM -1
</p>
<p>
    s = s &amp; CHR$(10) &amp; "-5/4 = " &amp; -5/4 REM -1.25
</p>
<p>
    s = s &amp; CHR$(10) &amp; "-5\4 = " &amp; -5\4 REM -1
</p>
<p>
    s = s &amp; CHR$(10) &amp; "17/6 = " &amp; 17/6 REM 2.83333333333333
</p>
<p>
    s = s &amp; CHR$(10) &amp; "17\6 = " &amp; 17\6 REM 2
</p>
<p>
    s = s &amp; CHR$(10) &amp; "17/5.9 = " &amp; 17/5.9 REM 2.88135593220339
</p>
<p>
    s = s &amp; CHR$(10) &amp; "17\5 = " &amp; 17\5 REM 3
</p>
<p>
    s = s &amp; CHR$(10) &amp; "17\5.9 = " &amp; 17\5.9 REM 3 because 5.9 was truncated to 5.
</p>
<p>
    s = s &amp; CHR$(10) &amp; "17\f = " &amp; 17\f REM 2 because f was rounded up to 6.
</p>
<p>
    s = s &amp; CHR$(10) &amp; "17\(11.9/2) = " &amp; 17\(11.9/2) REM 3 because 11.9/2 truncated to 5.
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000CF00000164E0B69F86.png" style="width:2.1563in;height:3.7083in" />
</p>
<p>
    <strong>Figure .</strong> Integer division.
</p>
<p>
    With integer division, constant numeric operands are truncated to Integer values before the division is done. When
    variables are part of an operand, the operand's result is rounded, otherwise truncated.
</p>
<h4 id="addition-subtraction---and-string-concatenation-and">
    <span id="anchor-68"></span>Addition (+), subtraction (-), and string concatenation (&amp; and +)
</h4>
<p>
    Addition and subtraction have the same precedence, which is higher than the string concatenation operator. Care must
    be taken while adding numerical values because the plus operator can also signify string concatenation. When the
    first operand for the plus operator is a number, and the second is a string; the string is converted to a number.
    When the first operand for the plus operator is a string, and the second is a number; the number is converted to a
    string.
</p>
<p>
    Print 123 + "3" REM 126 (Numeric)
</p>
<p>
    Print "123" + 3 REM 1233 (String)
</p>
<p>
    The string operator tries to convert the operands to strings if at least one operand is a string.
</p>
<p>
    Print 123 &amp; "3" REM 1233 (String)
</p>
<p>
    Print "123" &amp; 3 REM 1233 (String)
</p>
<p>
    Print 123 &amp; 3 REM Use at least one string or it will not work!
</p>
<p>
    Mixing string manipulations and numerical manipulations may lead to confusing results, especially because string
    concatenation with the &amp; operator has lower precedence than the + operator.
</p>
<p>
    Print 123 + "3" &amp; 4 '1264 Do addition then convert to String
</p>
<p>
    Print 123 &amp; "3" + 4 '12334 Do addition first but first operand is String
</p>
<p>
    Print 123 &amp; 3 + "4" '1237 Do addition first but first operand is Integer
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="logical-and-bit-wise-operators">
                            <span id="anchor-69"></span>Logical and bit-wise operators
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Each logical operator asks a simple question and provides a True or False answer. For example, is it true that (you
    have money) AND (you want to purchase my book)? These types of operations are simple and are frequently used in OOo
    Basic. Less frequently used, and provided for completeness to keep the computing professionals happy, are the
    bit-wise operators. Bit-wise operators are not difficult, but if you don’t understand them, it isn’t likely to
    affect your usage of OOo Basic.
</p>
<p>
    A logical operator is usually thought to operate on True and False values. In OOo Basic, logical operators also
    perform bit-wise operations on Integer values. This means that each bit of the first operand is compared to the
    corresponding bit in the second operand to form the corresponding bit in the result. For example, the binary
    operands 01 and 10 use the 0 from 01 and the 1 from 10 to produce the first bit of the result.
</p>
<p>
    The unusual thing about logical and bit-wise binary operators in OOo Basic is that their precedence is the same. In
    other languages, AND typically has greater precedence than OR.
</p>
<p>
    illustrates the logical and bit-wise operators supported by OOo. True and False represent logical values, and 0 and
    1 represent bit values.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Truth table for logical and bit-wise
    operators.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                True
            </td>
            <td>
                True
            </td>
            <td>
                True
            </td>
            <td>
                True
            </td>
            <td>
                False
            </td>
            <td>
                True
            </td>
            <td>
                True
            </td>
        </tr>
        <tr class="even">
            <td>
                True
            </td>
            <td>
                False
            </td>
            <td>
                False
            </td>
            <td>
                True
            </td>
            <td>
                True
            </td>
            <td>
                False
            </td>
            <td>
                False
            </td>
        </tr>
        <tr class="odd">
            <td>
                False
            </td>
            <td>
                True
            </td>
            <td>
                False
            </td>
            <td>
                True
            </td>
            <td>
                True
            </td>
            <td>
                False
            </td>
            <td>
                True
            </td>
        </tr>
        <tr class="even">
            <td>
                False
            </td>
            <td>
                False
            </td>
            <td>
                False
            </td>
            <td>
                False
            </td>
            <td>
                False
            </td>
            <td>
                True
            </td>
            <td>
                True
            </td>
        </tr>
        <tr class="odd">
            <td>
                1100
            </td>
            <td>
                1010
            </td>
            <td>
                1000
            </td>
            <td>
                1110
            </td>
            <td>
                0110
            </td>
            <td>
                1001
            </td>
            <td>
                1011
            </td>
        </tr>
    </tbody>
</table>
<p>
    Internally, the logical operators cast their operands to type Long. An unexpected side effect is that a
    floating-point operand is converted to a Long, which might cause numerical overflow. The conversion from a
    floating-point number to a long integer number is done by rounding the value, not by truncating. The values chosen
    for True (-1) and False (0) allow this to work, but the return type with two Boolean operands is still sometimes of
    type Long.
</p>
<p>
    <strong>Listing .</strong> Logical operands are of type long integer.
</p>
<p>
    Sub LogicalOperandsAreLongs
</p>
<p>
    Dim v, b1 As Boolean, b2 As Boolean
</p>
<p>
    b1 = True : b2 = False
</p>
<p>
    v = (b1 OR b2)
</p>
<p>
    Print TypeName(v) REM Long because operands are converted to Long.
</p>
<p>
    Print v REM -1 because the return type is Long.
</p>
<p>
    Print (b2 OR "-1") REM -1 because "-1" is converted to a Long.
</p>
<p>
    End Sub
</p>
<p>
    For some logical expressions, not all operands need to be evaluated. For example, the expression (False AND True) is
    known to be False by looking at the first operand and the operator AND. This is known as “short-circuit evaluation.”
    Sadly, this isn’t available in OOo Basic; instead, all operands are evaluated.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                OOo Basic does not support short-circuit evaluation, so (x &lt;&gt; 0 AND y/x &gt; 3) causes a
                division-by-zero error when x is zero.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The bit-wise operators are all illustrated the same way. Two arrays are filled with Boolean values and two integers
    are given an Integer value.
</p>
<p>
    xi% = 12 : yi% = 10
</p>
<p>
    x() = Array(True, True, False, False)
</p>
<p>
    y() = Array(True, False, True, False)
</p>
<p>
    The decimal number 12 is represented in base 2 as 1100, which corresponds to the values in x(). The decimal number
    10 is represented in base 2 as 1010, which corresponds to the value in y(). The operator is then applied to “x(0) op
    y(0)”, “x(1) op y(1)”, “x(2) op y(2)”, “x(3) op y(3)”, and “xi op yi”. The result is displayed in a message box. The
    integers are displayed as base 2 to emphasize that a bit-wise operation is performed. <strong> </strong>demonstrates
    how an integer is converted to a stream of bits. This uses many techniques that are discussed later in this chapter.
</p>
<p>
    <strong>Listing .</strong> Convert an integer to binary.
</p>
<p>
    Sub TestIntoToBinary
</p>
<p>
    Dim s$
</p>
<p>
    Dim n%
</p>
<p>
    Dim x%
</p>
<p>
    x = InputBox("Enter an integer")
</p>
<p>
    If x &lt;&gt; 0 Then
</p>
<p>
    n = Log(Abs(x)) / Log(2) + 1
</p>
<p>
    If (x &lt; 0) Then
</p>
<p>
    n = n + 4
</p>
<p>
    End If
</p>
<p>
    Else
</p>
<p>
    n = 1
</p>
<p>
    End If
</p>
<p>
    print "s = " &amp; IntToBinaryString(x, n)
</p>
<p>
    End Sub
</p>
<p>
    REM Convert an Integer value to a string of bits
</p>
<p>
    REM x is the integer to convert
</p>
<p>
    REM n is the number of bits to convert
</p>
<p>
    REM This would be easier if I could shift out the lowest while
</p>
<p>
    REM retaining the sign bit of the number, but I cannot.
</p>
<p>
    REM I emulate this by dividing by two, but this fails for negative
</p>
<p>
    REM numbers. To avoid this problem, if the number is negative
</p>
<p>
    REM I flip all of the bits, which makes it a positive number and
</p>
<p>
    REM then I build an inverted answer
</p>
<p>
    Function IntToBinaryString(ByVal x%, ByVal n%) As String
</p>
<p>
    Dim b0$ 'Bit 0 (the right most bit) for positive numbers.
</p>
<p>
    Dim b1$ 'Bit 1 for positive numbers.
</p>
<p>
    If (x &gt;= 0) Then 'Not negative so the algorithm will work.
</p>
<p>
    b1 = "1" : b0 = "0" 'Use the standard bit values.
</p>
<p>
    Else 'A negative number so
</p>
<p>
    x = NOT x 'flip all of the bits.
</p>
<p>
    b1 = "0" : b0 = "1" 'Invert bit 0 and invert bit 1.
</p>
<p>
    End If
</p>
<p>
    Dim s$ 'Accumulate bits as a string in s$.
</p>
<p>
    Do While n &gt; 0 'n is the number of bits to return.
</p>
<p>
    If (x AND 1) = 1 Then 'AND with 1 to find bit 0 (the right most bit).
</p>
<p>
    s = b1$ &amp; s 'Bit 1 set so add a 1 (if x was negative add 0).
</p>
<p>
    Else
</p>
<p>
    s = b0$ &amp; s 'Bit 1 clear so add a 0 (if x was negative add 1).
</p>
<p>
    End If
</p>
<p>
    x = x\2 'Integer division by 2.
</p>
<p>
    n = n - 1 'Decrement n by 1, just finished a bit.
</p>
<p>
    Loop 'Back to the top of the While.
</p>
<p>
    IntToBinaryString = s 'Assign the return value to the Function.
</p>
<p>
    End Function
</p>
<h4 id="and">
    <span id="anchor-70"></span>AND
</h4>
<p>
    Perform a logical AND operation on Boolean values, and a bit-wise AND on numerical values. Consider the phrase, “You
    can go to the movie if you have money AND if you have transportation.” Both conditions must be true before you are
    able to go to the movie. If both operands are True, then the result is True; otherwise the result is False.
</p>
<p>
    <strong>Listing .</strong> Operator AND.
</p>
<p>
    Sub ExampleOpAND
</p>
<p>
    Dim s$, x(), y(), i%, xi%, yi%
</p>
<p>
    xi% = 12 : yi% = 10
</p>
<p>
    x() = Array(True, True, False, False)
</p>
<p>
    y() = Array(True, False, True, False)
</p>
<p>
    For i = LBound(x()) To UBound(x())
</p>
<p>
    s = s &amp; x(i) &amp; " AND " &amp; y(i) &amp; " = " &amp; CBool(x(i) AND y(i)) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    s = s &amp; IntToBinaryString(xi, 4) &amp; " AND " &amp; IntToBinaryString(yi, 4) &amp;_
</p>
<p>
    " = " &amp; IntToBinaryString(xi AND yi, 4) &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Operator AND example"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000003990000027D929CBB48.png" style="width:1.9717in;height:1.2598in" />
</p>
<p>
    <strong>Figure .</strong> Using the AND operator.
</p>
<h4 id="or">
    <span id="anchor-71"></span>OR
</h4>
<p>
    Perform a logical OR operation on Boolean values, and a bit-wise OR on numerical values. Consider the phrase, “You
    can purchase that if you have cash OR your friend has cash.” It does not matter who has cash. If either operand is
    True, then the result is True; otherwise the result is False.
</p>
<p>
    <strong>Listing .</strong> Operator OR.
</p>
<p>
    Sub ExampleOpOR
</p>
<p>
    Dim s$, x(), y(), i%, xi%, yi%
</p>
<p>
    xi% = 12 : yi% = 10
</p>
<p>
    x() = Array(True, True, False, False)
</p>
<p>
    y() = Array(True, False, True, False)
</p>
<p>
    For i = LBound(x()) To UBound(x())
</p>
<p>
    s = s &amp; x(i) &amp; " OR " &amp; y(i) &amp; " = " &amp; CBool(x(i) OR y(i)) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    s = s &amp; IntToBinaryString(xi, 4) &amp; " OR " &amp; IntToBinaryString(yi, 4) &amp;_
</p>
<p>
    " = " &amp; IntToBinaryString(xi OR yi, 4) &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Operator OR example"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000003730000027EFDEB226E.png" style="width:2.0016in;height:1.3425in" />
</p>
<p>
    <strong>Figure .</strong> Using the OR operator.
</p>
<h4 id="xor">
    <span id="anchor-72"></span>XOR
</h4>
<p>
    The XOR operator is called “exclusive or”; this is a question of non-equivalence. The result is True if the operands
    have different values. The result is False if both operands have the same value. A logical XOR operation is
    performed on Boolean values, and a bit-wise XOR is performed on numerical values.
</p>
<p>
    <strong>Listing .</strong> Operator XOR.
</p>
<p>
    Sub ExampleOpXOR
</p>
<p>
    Dim s$, x(), y(), i%, xi%, yi%
</p>
<p>
    xi% = 12 : yi% = 10
</p>
<p>
    x() = Array(True, True, False, False)
</p>
<p>
    y() = Array(True, False, True, False)
</p>
<p>
    For i = LBound(x()) To UBound(x())
</p>
<p>
    s = s &amp; x(i) &amp; " XOR " &amp; y(i) &amp; " = " &amp; CBool(x(i) XOR y(i)) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    s = s &amp; IntToBinaryString(xi, 4) &amp; " XOR " &amp; IntToBinaryString(yi, 4) &amp;_
</p>
<p>
    " = " &amp; IntToBinaryString(xi XOR yi, 4) &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Operator XOR example"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000003990000027EFDFF298C.png" style="width:1.9835in;height:1.2728in" />
</p>
<p>
    <strong>Figure .</strong> Using the XOR operator.
</p>
<h4 id="eqv">
    <span id="anchor-73"></span>EQV
</h4>
<p>
    The EQV operator is a question of equivalence: Are the two operands the same? A logical EQV operation is performed
    for Boolean values, and a bit-wise EQV on numbers. If both operands have the same value, the result is True. If the
    operands don’t have the same value, the result is False.
</p>
<p>
    <strong>Listing .</strong> Operator EQV.
</p>
<p>
    Sub ExampleOpEQV
</p>
<p>
    Dim s$, x(), y(), i%, xi%, yi%
</p>
<p>
    xi% = 12 : yi% = 10
</p>
<p>
    x() = Array(True, True, False, False)
</p>
<p>
    y() = Array(True, False, True, False)
</p>
<p>
    For i = LBound(x()) To UBound(x())
</p>
<p>
    s = s &amp; x(i) &amp; " EQV " &amp; y(i) &amp; " = " &amp; CBool(x(i) EQV y(i)) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    s = s &amp; IntToBinaryString(xi, 4) &amp; " EQV " &amp; IntToBinaryString(yi, 4) &amp;_
</p>
<p>
    " = " &amp; IntToBinaryString(xi EQV yi, 4) &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Operator EQV example"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000003910000027E3A421B57.png" style="width:2.0063in;height:1.178in" />
</p>
<p>
    <strong>Figure .</strong> Using the EQV operator.
</p>
<h4 id="imp">
    <span id="anchor-74"></span>IMP
</h4>
<p>
    The IMP operator performs a logical implication. A logical IMP operation is performed on Boolean values, and a
    bit-wise IMP on numbers. As the name implies, “x IMP y” asks if the statement that “x implies y” is a true
    statement. To help understand logical implication, define x and y as follows:
</p>
<p>
    x = The sky is cloudy
</p>
<p>
    y = The sun is not visible
</p>
<p>
    If x Then y
</p>
<p>
    If both x and y are true<em><em> — </em></em>the sky is cloudy and the sun is not visible<em><em> — </em></em>the
    statement can be considered true. This statement makes no claim about y if x is not true. In other words, if the sky
    is not cloudy, this statement does not imply that the sun is, or is not, visible. For example, it might be a clear
    night, or (like a good computer geek) you might be inside a room without any windows. This explains why the entire
    statement is always considered valid when x is false. Finally, if x is true and y is not, the entire statement is
    considered false. If the sky is cloudy, and the sun is visible, the statement cannot possibly be correct; a cloudy
    day could not imply that the sun is visible.
</p>
<p>
    <strong>Listing .</strong> Operator IMP.
</p>
<p>
    Sub ExampleOpIMP
</p>
<p>
    Dim s$, x(), y(), i%, xi%, yi%
</p>
<p>
    xi% = 12 : yi% = 10
</p>
<p>
    x() = Array(True, True, False, False)
</p>
<p>
    y() = Array(True, False, True, False)
</p>
<p>
    For i = LBound(x()) To UBound(x())
</p>
<p>
    s = s &amp; x(i) &amp; " IMP " &amp; y(i) &amp; " = " &amp; CBool(x(i) IMP y(i)) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    s = s &amp; IntToBinaryString(xi, 4) &amp; " IMP " &amp; IntToBinaryString(yi, 4) &amp;_
</p>
<p>
    " = " &amp; IntToBinaryString(xi IMP yi, 4) &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Operator IMP example"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000038C0000027E72F619CF.png" style="width:1.9929in;height:1.2992in" />
</p>
<p>
    <strong>Figure .</strong> Using the IMP operator.
</p>
<h4 id="not">
    <span id="anchor-75"></span>NOT
</h4>
<p>
    The NOT operator performs a logical NOT operation on Boolean values, and a bit-wise NOT on numerical values. This
    means that “Not True” is False and “Not False” is True. For bit-wise operations, a 1 becomes a 0 and a 0 becomes a
    1.
</p>
<p>
    Print NOT True REM 0, which is False
</p>
<p>
    Print NOT False REM -1, which is True
</p>
<p>
    Print NOT 2 REM -3, which took the bits 0010 to 1101
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="comparison-operators">
                            <span id="anchor-76"></span>Comparison operators
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The comparison operators work with numerical, Date, Boolean, and String data types.
</p>
<p>
    Print 2 = 8/4 AND 0 &lt; 1/3 AND 2 &gt; 1 '-1=True
</p>
<p>
    Print 4 &lt;= 4.0 AND 1 &gt;= 0 AND 1 &lt;&gt; 0 '-1=True
</p>
<p>
    String comparisons are based on their internal representations as numbers and are case sensitive. The letter “A” is
    less than the letter “B”. The uppercase characters are less than the lowercase letters.
</p>
<p>
    Dim a$, b$, c$
</p>
<p>
    a$ = "A" : b$ = "B" : c$ = "B"
</p>
<p>
    Print a$ &lt; b$ 'True
</p>
<p>
    Print b$ = c$ 'True
</p>
<p>
    Print c$ &lt;= a$ 'False
</p>
<p>
    Strange problems occur when all of the operands are string constants. If at least one operand is a variable, the
    expected results are achieved. This is likely related to how the operands are recognized and converted for use.
</p>
<p>
    Print "A" &lt; "B" '0=False, this is not correct
</p>
<p>
    Print "B" &lt; "A" '-1=True, this is not correct
</p>
<p>
    Print 3 = "3" 'False, but this changes if a variable is used
</p>
<p>
    When variables are used rather than string constants, the numerical values are converted to string types for the
    comparison.
</p>
<p>
    Dim a$, i%, t$
</p>
<p>
    a$ = "A" : t$ = "3" : i% = 3
</p>
<p>
    Print a$ &lt; "B" 'True, String compare
</p>
<p>
    Print "B" &lt; a$ 'False, String compare
</p>
<p>
    Print i% = "3" 'True, String compare
</p>
<p>
    Print i% = "+3" 'False, String compare
</p>
<p>
    Print 3 = t$ 'True, String compare
</p>
<p>
    Print i% &lt; "2" 'False, String compare
</p>
<p>
    Print i% &gt; "22" 'True, String compare
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                When comparing operands of different types, especially when mixing numeric and string types, it is safer
                to explicitly perform a type conversion. Either convert the string to a number, or the number to a
                string. The functions to do this are discussed later.
            </td>
        </tr>
    </tbody>
</table>
<p>
    OOo recognizes the Visual Basic statement Option Compare { Binary | Text}, but as of OOo version 3.20, the statement
    still does nothing. The current behavior is a binary comparison of strings.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="flow-control">
                    <span id="anchor-77"></span>Flow control
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Flow control is about deciding which line of code runs next. Calling a subroutine or function is a simple form of
    unconditional flow control. More complicated flow control involves branching and looping. Flow control allows macros
    to have complicated behavior that changes based on the current data.
</p>
<p>
    Branching statements cause the program flow to change. Calling a subroutine or function is an unconditional branch.
    OOo Basic supports conditional branching statements such as “if x, then do y”. Looping statements cause the program
    to repeat sections of code. Looping statements allow for a section to be repeated a specific number of times or
    until a specific “exit” condition has been achieved.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="define-a-label-as-a-jump-target">
                            <span id="anchor-78"></span>Define a label as a jump target
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Some flow control statements, such as GoSub, GoTo, and On Error, require a label to mark a point in the code. Label
    names are subject to the same rules as variable names. Label names are immediately followed by a colon. Remember
    that a colon is also used as a statement separator that allows multiple statements to occupy the same line. Space
    between the label name and the colon causes the colon to be used as a statement separator, which means the label
    won’t be defined. The following lines all represent valid OOo Basic code.
</p>
<p>
    &lt;statements&gt;
</p>
<p>
    i% = 5 : z = q + 4.77
</p>
<p>
    MyCoolLabel:
</p>
<p>
    &lt;more statements&gt;
</p>
<p>
    JumpTarget: &lt;more statements&gt; REM no space between label and colon
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Inserting a space between a label and the colon causes the colon to be used as a statement separator,
                and the label is not defined.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="gosub">
                            <span id="anchor-79"></span>GoSub
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The GoSub statement causes execution to jump to a defined label in the current routine. It isn’t possible to jump
    outside of the current routine. When the Return statement is reached, execution continues from the point of the
    original call. A Return statement with no previous GoSub produces a run-time error. In other words, Return is not a
    substitute for Exit Sub or Exit Function. It is generally assumed that functions and subroutines produce more
    understandable code than GoSub and GoTo.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                <p>
                    GoSub is a persistent remnant from old BASIC dialects, retained for compatibility. GoSub
                </p>
                <p>
                    is strongly discouraged because it tends to produce unreadable code. Use a subroutine or
                </p>
                <p>
                    function instead. In fact, Visual Basic .NET no longer supports the GoSub keyword.
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Example GoSub.
</p>
<p>
    Sub ExampleGoSub
</p>
<p>
    Dim i As Integer
</p>
<p>
    GoSub Line2 REM Jump to line 2 then return, i is 1
</p>
<p>
    GoSub [Line 1] REM Jump to line 1 then return, i is 2
</p>
<p>
    MsgBox "i = " + i, 0, "GoSub Example" REM i is now 2
</p>
<p>
    Exit Sub REM Leave the current subroutine.
</p>
<p>
    [Line 1]: REM this label has a space in it
</p>
<p>
    i = i + 1 REM Add one to i
</p>
<p>
    Return REM return to the calling location
</p>
<p>
    Line2: REM this label is more typical, no spaces
</p>
<p>
    i = 1 REM Set i to 1
</p>
<p>
    Return REM return to the calling location
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="goto">
                            <span id="anchor-80"></span>GoTo
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The GoTo statement causes execution to jump to a defined label in the current routine. It isn’t possible to jump
    outside of the current routine. Unlike the GoSub statement, the GoTo statement doesn’t know from where it came. GoTo
    is a persistent remnant from old BASIC dialects, retained for compatibility. GoTo is strongly discouraged because it
    tends to produce unreadable code. Use a subroutine or function instead.
</p>
<p>
    <strong>Listing .</strong> Example GoTo.
</p>
<p>
    Sub ExampleGoTo
</p>
<p>
    Dim i As Integer
</p>
<p>
    GoTo Line2 REM Okay, this looks easy enough
</p>
<p>
    Line1: REM but I am becoming confused
</p>
<p>
    i = i + 1 REM I wish that GoTo was not used
</p>
<p>
    GoTo TheEnd REM This is crazy, makes me think of spaghetti,
</p>
<p>
    Line2: REM Tangled strands going in and out; spaghetti code.
</p>
<p>
    i = 1 REM If you have to do it, you probably
</p>
<p>
    GoTo Line1 REM did something poorly.
</p>
<p>
    TheEnd: REM Do not use GoTo.
</p>
<p>
    MsgBox "i = " + i, 0, "GoTo Example"
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="on-goto-and-on-gosub">
                            <span id="anchor-81"></span>On GoTo and On GoSub
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    These statements cause the execution to branch to a label based on a numeric expression N. If N is zero, no
    branching occurs. The numeric expression N must be in the range of 0 through 255. This is sometimes called a
    “computed goto,” because a computation is used to direct the program flow. It isn’t possible to jump outside of the
    current subroutine.
</p>
<p>
    <em><strong>Syntax:</strong></em> On N GoSub Label1[, Label2[, Label3[,...]]]
</p>
<p>
    <em><strong>Syntax:</strong></em> On N GoTo Label1[, Label2[, Label3[,...]]]
</p>
<p>
    To reiterate how this works, if N = 1 then branch to Label 1, if N = 2 then branch to Label 2... If N is less than 1
    or if N is greater than the number of labels, then the branch is not taken; it is simply ignored.
</p>
<p>
    <strong>Listing .</strong> Example On GoTo.
</p>
<p>
    Sub ExampleOnGoTo
</p>
<p>
    Dim i As Integer
</p>
<p>
    Dim s As String
</p>
<p>
    i = 1
</p>
<p>
    On i+1 GoSub Sub1, Sub2
</p>
<p>
    s = s &amp; Chr(13)
</p>
<p>
    On i GoTo Line1, Line2
</p>
<p>
    REM The exit causes us to exit if we do not continue execution
</p>
<p>
    Exit Sub
</p>
<p>
    Sub1:
</p>
<p>
    s = s &amp; "In Sub 1" : Return
</p>
<p>
    Sub2:
</p>
<p>
    s = s &amp; "In Sub 2" : Return
</p>
<p>
    Line1:
</p>
<p>
    s = s &amp; "At Label 1" : GoTo TheEnd
</p>
<p>
    Line2:
</p>
<p>
    s = s &amp; "At Label 2"
</p>
<p>
    TheEnd:
</p>
<p>
    MsgBox s, 0, "On GoTo Example"
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="if-then-else">
                            <span id="anchor-82"></span>If Then Else
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The If construct is used to execute a block of code based on an expression. Although you can use GoTo or GoSub to
    jump out of an If block, you cannot jump into an If block. The simplest If statement has the following form:
</p>
<p>
    If Condition Then Statement
</p>
<p>
    The condition can be any expression that either evaluates to<em><em> — </em></em>or is convertible to<em><em> —
        </em></em>True or False. Use a slightly more complicated version to control more than a single statement.
</p>
<p>
    If Condition Then
</p>
<p>
    Statementblock
</p>
<p>
    [ElseIf Condition Then]
</p>
<p>
    Statementblock
</p>
<p>
    [Else]
</p>
<p>
    Statementblock
</p>
<p>
    End If
</p>
<p>
    If the first condition evaluates to True, the first block runs. The ElseIf statement allows multiple If statements
    to be tested in sequence. The statement block for the first true condition runs. The Else statement block runs if no
    other condition evaluates to True.
</p>
<p>
    <strong>Listing .</strong> Example If.
</p>
<p>
    Sub ExampleIf
</p>
<p>
    Dim i%
</p>
<p>
    i% = 4
</p>
<p>
    If i = 4 Then Print "i is four"
</p>
<p>
    If i &lt;&gt; 3 Then
</p>
<p>
    Print "i is not three"
</p>
<p>
    End If
</p>
<p>
    If i &lt; 1 Then
</p>
<p>
    Print "i is less than 1"
</p>
<p>
    elseif i = 1 Then
</p>
<p>
    Print "i is 1"
</p>
<p>
    elseif i = 2 Then
</p>
<p>
    Print "i is 2"
</p>
<p>
    else
</p>
<p>
    Print "i is greater than 2"
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    If statements can be nested.
</p>
<p>
    If i &lt;&gt; 3 THEN
</p>
<p>
    If k = 4 Then Print "k is four"
</p>
<p>
    If j = 7 Then
</p>
<p>
    Print "j is seven"
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="iif">
                            <span id="anchor-83"></span>IIf
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The IIf (“Immediate If”) function returns one of two values based on a conditional expression.
</p>
<p>
    <em><strong>Syntax:</strong></em> object = IIf (Condition, TrueExpression, FalseExpression)
</p>
<p>
    This is very similar to the following code:
</p>
<p>
    If Condition Then
</p>
<p>
    object = TrueExpression
</p>
<p>
    Else
</p>
<p>
    object = FalseExpression
</p>
<p>
    End If
</p>
<p>
    This works as a great single-line If-Then-Else statement.
</p>
<p>
    max_age = IIf(johns_age &gt; bills_age, johns_age, bills_age)
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="choose">
                            <span id="anchor-84"></span>Choose
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The Choose statement selects from a list of values based on an index.
</p>
<p>
    <em><strong>Syntax:</strong></em> obj = Choose (expression, Select_1[, Select_2, ... [,Select_n]])
</p>
<p>
    The Choose statement returns a null if the expression is less than 1 or greater than the number of selection
    arguments. Choose returns “select_1” if the expression evaluates to 1, and “select_2” if the expression evaluates to
    2. The result is similar to storing the selections in an array with a lower bound of 1 and then indexing into the
    array.
</p>
<p>
    <strong>Listing .</strong> A division-by-zero error occurs even though 1/(i-2) should be returned.
</p>
<p>
    i% = 3
</p>
<p>
    Print Choose (i%, 1/(i+1), 1/(i-1), 1/(i-2), 1/(i-3))
</p>
<p>
    Selections can be expressions and they can contain function calls. Every function is called and every expression is
    evaluated in the argument list for the call to the Choose statement. The code in causes a division-by-zero error
    because every argument is evaluated, not just the argument that will be returned. calls the functions Choose1,
    Choose2, and Choose3.
</p>
<p>
    <strong>Listing .</strong> Example Choose statement.
</p>
<p>
    Sub ExampleChoose
</p>
<p>
    Print Choose(2, "One", "Two", "Three") 'Two
</p>
<p>
    Print Choose(2, Choose1(), Choose2(), Choose3()) 'Two
</p>
<p>
    End Sub
</p>
<p>
    Function Choose1$()
</p>
<p>
    Print "I am in Choose1"
</p>
<p>
    Choose1 = "One"
</p>
<p>
    End Function
</p>
<p>
    Function Choose2$()
</p>
<p>
    Print "I am in Choose2"
</p>
<p>
    Choose2 = "Two"
</p>
<p>
    End Function
</p>
<p>
    Function Choose3$()
</p>
<p>
    Print "I am in Choose3"
</p>
<p>
    Choose3 = "Three"
</p>
<p>
    End Function
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                All arguments in a Choose statement are evaluated. If functions are used in the arguments for Choose,
                they are all called.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="select-case">
                            <span id="anchor-85"></span>Select Case
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The Select Case statement is similar to an If statement with multiple Else If blocks. A single-condition expression
    is specified and this is compared against multiple values for a match as follows:
</p>
<p>
    Select Case condition_expression
</p>
<p>
    Case case_expression1
</p>
<p>
    StatementBlock1
</p>
<p>
    Case case_expression2
</p>
<p>
    StatementBlock2
</p>
<p>
    Case Else
</p>
<p>
    StatementBlock3
</p>
<p>
    End Select
</p>
<p>
    The condition_expression is compared in each Case statement. The first statement block to match is executed. The
    optional Case Else block runs if no condition matches. It is not an error if nothing matches and no Case Else block
    is present.
</p>
<h4 id="case-expressions">
    <span id="anchor-86"></span>Case expressions
</h4>
<p>
    The conditional expression is evaluated once and then it is compared to each case expression until a match is found.
    A case expression is usually a constant, such as “Case 4” or “Case "hello"”.
</p>
<p>
    Select Case 2
</p>
<p>
    Case 1
</p>
<p>
    Print "One"
</p>
<p>
    Case 3
</p>
<p>
    Print "Three"
</p>
<p>
    End Select
</p>
<p>
    You can specify multiple values by separating them with commas: “Case 3, 5, 7”. The keyword To checks a range of
    values <em><em>— </em></em>for example, “Case 5 To 10”. Open-ended ranges are checked as “Case &lt; 10” or as “Case
    IS &lt; 10”.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The Case IS statement is different than the IS operator that decides if two objects are the same.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Every Case statement written “Case op expression” is shorthand for writing “Case IS op expression”. The form “Case
    expression” is shorthand for “Case IS = expression”. For example, “Case &gt;= 5” is equivalent to “Case IS &gt;= 5”,
    and “Case 1+3” is equivalent to “Case IS = 1+3”.
</p>
<p>
    Select Case i
</p>
<p>
    Case 1, 3, 5
</p>
<p>
    Print "i is one, three, or five"
</p>
<p>
    Case 6 To 10
</p>
<p>
    Print "i is a value from 6 through 10"
</p>
<p>
    Case &lt; -10
</p>
<p>
    Print "i is less than -10"
</p>
<p>
    Case IS &gt; 10
</p>
<p>
    Print "i is greater than 10"
</p>
<p>
    Case Else
</p>
<p>
    Print "No idea what i is"
</p>
<p>
    End Select
</p>
<p>
    A Case statement can contain a list of expressions separated by commas. Each expression can include an open-ended
    range. Each expression can use the statement Case IS (see ).
</p>
<p>
    <strong>Listing .</strong> The keyword IS is optional.
</p>
<p>
    Select Case i%
</p>
<p>
    Case 6, Is = 7, Is = 8, Is &gt; 15, Is &lt; 0
</p>
<p>
    Print "" &amp; i &amp; " matched"
</p>
<p>
    Case Else
</p>
<p>
    Print "" &amp; i &amp; " is out of range"
</p>
<p>
    End Select
</p>
<h4 id="if-case-statements-are-easy-why-are-they-frequently-incorrect">
    <span id="anchor-87"></span>If Case statements are easy, why are they frequently incorrect?
</h4>
<p>
    I frequently see incorrect examples of Case statements. It’s instructive to see what is repeatedly done incorrectly.
    Consider the simple examples in . The last examples are written correctly in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Case statements are frequently written
    incorrectly.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Select Case i<br /> Case 2
            </td>
            <td>
                Correct
            </td>
            <td>
                The Case expression 2 is evaluated as two. Two is compared to i.
            </td>
        </tr>
        <tr class="even">
            <td>
                Select Case i<br /> Case Is = 2
            </td>
            <td>
                Correct
            </td>
            <td>
                The Case expression 2 is evaluated as two. Two is compared to i.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Select Case i<br /> Case Is &gt; 7
            </td>
            <td>
                Correct
            </td>
            <td>
                The expression 7 is evaluated as seven. Seven is compared to i.
            </td>
        </tr>
        <tr class="even">
            <td>
                Select Case i<br /> Case 4, 7, 9
            </td>
            <td>
                Correct
            </td>
            <td>
                The conditional expression i is compared individually to 4, 7, and 9.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    Select Case x
                </p>
                <p>
                    Case 1.3 TO 5.7
                </p>
            </td>
            <td>
                Correct
            </td>
            <td>
                You can specify a range and use floating-point numbers.
            </td>
        </tr>
        <tr class="even">
            <td>
                Select Case i<br /> Case i = 2
            </td>
            <td>
                Incorrect
            </td>
            <td>
                The Case expression (i=2) is evaluated as True or False. True or False is compared to i. This is reduced
                to “IS = (i=2)”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Select Case i<br /> Case i&lt;2 OR i&gt;9
            </td>
            <td>
                Incorrect
            </td>
            <td>
                The Case expression (i&lt;2 OR 9&lt;i) is evaluated as True or False. True or False is compared to i.
                This is reduced to “IS = (i&lt;2 OR 9&lt;i)”.
            </td>
        </tr>
        <tr class="even">
            <td>
                Select Case i%<br /> Case i%&gt;2 AND i%&lt;10
            </td>
            <td>
                Incorrect
            </td>
            <td>
                The Case expression (i&gt;2 AND i &lt; 10) is evaluated as True or False. True or False is compared to
                i. This is reduced to “IS = (i&gt;2 AND i&lt;10)”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Select Case i%<br /> Case IS&gt;8 And i&lt;11
            </td>
            <td>
                Incorrect
            </td>
            <td>
                Again, True and False are compared to i. This is reduced to “IS &gt; (8 AND i&lt;11)”. The precedence
                rules cause this to be reduced to “IS &gt; (8 AND (i&lt;11))”. This is usually not what’s intended.
            </td>
        </tr>
        <tr class="even">
            <td>
                Select Case i%<br /> Case IS&gt;8 And IS&lt;11
            </td>
            <td>
                Incorrect
            </td>
            <td>
                Compile error. The keyword IS must immediately follow Case.
            </td>
        </tr>
    </tbody>
</table>
<p>
    I have seen OOo examples with incorrect examples such as “Case i &gt; 2 AND i &lt; 10”. This fails. Don’t believe it
    even though you see it in print. Understand why this fails and you have mastered Case statements.
</p>
<p>
    The next to the last incorrect example in demonstrates the most common error that I see with Case expressions.
    considers the case when i is less than 11, and the case when i is greater than or equal to 11. To put it simply,
    IS&gt;8 AND i&lt;11 has the Case statement comparing the value of i to the result of a Boolean expression, which can
    be only 0 or -1. The big difficulty with Case statements is that they look like If statements, which are looking for
    a True or False, but Case statements are looking for a particular value against which to match the conditional, and
    0 or -1 is not helpful.
</p>
<p>
    Consider the second case in , i &gt;= 11. The operator &lt; has higher precedence than the operator AND, so it is
    evaluated first. The expression i&lt;11 evaluates to False (because I assumed that i&gt;=11). False is internally
    represented as 0. Zero has no bits set, so 8 AND 0 evaluates to zero. For values of i greater than or equal to 11,
    the entire expression is equivalent to “IS &gt; 0”. In other words, for i = 45, this Case statement is incorrectly
    accepted.
</p>
<p>
    A similar argument for values of i less than 11, left as an exercise for the reader, demonstrates that the Case
    statement is equivalent to “Case IS &gt; 8”. Therefore, values of i less than 11 are correctly evaluated, but values
    of i greater than or equal to 11 are not.
</p>
<p>
    <strong>Listing .</strong> “Case IS &gt; 8 AND i &lt; 11” reduces incorrectly.
</p>
<p>
    IS &gt; (8 AND i &lt; 11) =&gt; IS &gt; (8 AND -1) =&gt; IS &gt; 8 'Assume i &lt; 11 is correct.
</p>
<p>
    IS &gt; (8 AND i &lt; 11) =&gt; IS &gt; (8 AND 0) =&gt; IS &gt; 0 'Assume i &gt;= 11 is unwanted.
</p>
<h4 id="writing-correct-case-expressions">
    <span id="anchor-88"></span>Writing correct Case expressions
</h4>
<p>
    After you learn a few simple examples, it’s easy to write correct Case expressions. abstractly enumerates the
    varieties, and concretely demonstrates the varieties.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Simple Case varieties.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Case IS operator expression
            </td>
            <td>
                This is both the simplest case and the most difficult case. If the expression is a constant, it is easy
                to understand. If the expression is more complicated, the only difficult part is building the
                expression.
            </td>
        </tr>
        <tr class="even">
            <td>
                Case expression
            </td>
            <td>
                This is a reduction of “Case IS operator expression” when the operator checks for equality.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Case expression TO expression
            </td>
            <td>
                Check an inclusive range. This is usually done correctly.
            </td>
        </tr>
        <tr class="even">
            <td>
                Case expression, expression,
            </td>
            <td>
                Each expression is compared. This is usually done correctly.
            </td>
        </tr>
    </tbody>
</table>
<p>
    For the difficult cases, it suffices to produce an expression that evaluates to the Case condition expression if it
    is correct, and anything else if it is not. In other words, for Select Case 4, the expression must evaluate to 4 for
    the statement block to run.
</p>
<p>
    <strong>Listing .</strong> If x is a String value, this will work for any Boolean expression.
</p>
<p>
    Select Case x
</p>
<p>
    Case IIF(Boolean expression, x, x&amp;"1") ' Assumes that x is a string
</p>
<p>
    In , x is returned if the Boolean expression is True. The expression x=x is True, so the Case statement passes. If
    the Boolean expression is False, x&amp;"1" is returned. This is not the same string as x, so the Case statement will
    not pass. A similar method is used for numerical values.
</p>
<p>
    <strong>Listing .</strong> If x is a numerical value, this will work for any Boolean expression.
</p>
<p>
    Select Case x
</p>
<p>
    Case IIF(Boolean expression, x, x+1) ' Assumes that x is numeric
</p>
<p>
    In , x is returned if the Boolean expression is True. The expression x=x is True, so the Case statement passes. If
    the Boolean expression is False, x+1 is returned. For numerical values, x=x+1 is not True, so the Case statement
    will not pass. There is a possibility of numerical overflow, but in general this works. A brilliant and more elegant
    solution for numerical values is provided by Bernard Marcelly, a member of the OOo French translation project.
</p>
<p>
    Case x XOR NOT (Boolean Expression)
</p>
<p>
    This assumes that the Boolean expression returns True (-1) if it should pass and False (0) if it should not.
</p>
<p>
    <strong>Listing .</strong> This code uses XOR and NOT in a Case statement.
</p>
<p>
    x XOR NOT(True) = x XOR NOT(-1) = x XOR 0 = x
</p>
<p>
    x XOR NOT(False) = x XOR NOT( 0) = x XOR -1 &lt;&gt; x
</p>
<p>
    After my initial confusion, I realized how brilliant this really is. There are no problems with overflow and it
    works for all Integer values of x. Do not simplify this to the incorrect reduction “x AND (Boolean expression)”
    because it fails if x is 0.
</p>
<p>
    <strong>Listing .</strong> Select Case example.
</p>
<p>
    Sub ExampleSelectCase
</p>
<p>
    Dim i%
</p>
<p>
    i = Int((20 * Rnd) -2) 'Rnd generates a random number between zero and one
</p>
<p>
    Select Case i%
</p>
<p>
    Case 0
</p>
<p>
    Print "" &amp; i &amp; " is Zero"
</p>
<p>
    Case 1 To 5
</p>
<p>
    Print "" &amp; i &amp; " is a number from 1 through 5"
</p>
<p>
    Case 6, 7, 8
</p>
<p>
    Print "" &amp; i &amp; " is the number 6, 7, or 8"
</p>
<p>
    Case IIf(i &gt; 8 And i &lt; 11, i, i+1)
</p>
<p>
    Print "" &amp; i &amp; " is greater than 8 and less than 11"
</p>
<p>
    Case i% XOR NOT(i% &gt; 10 AND i% &lt; 16)
</p>
<p>
    Print "" &amp; i &amp; " is greater than 10 and less than 16"
</p>
<p>
    Case Else
</p>
<p>
    Print "" &amp; i &amp; " is out of range 0 to 15"
</p>
<p>
    End Select
</p>
<p>
    End Sub
</p>
<p>
    ExampleSelectCase in generates a random integer from -2 through 18 each time it runs. Run this repeatedly to see
    each Case statement used. Each of the cases could have used the IIF construct.
</p>
<p>
    Now that I’ve explained the different methods to deal with ranges, it’s time to reevaluate the incorrect cases in .
    The solutions in are not the only possible solutions, but they use some of the solutions presented.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong> </strong>Incorrect examples from <em><em> —
            now</em></em> corrected.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Select Case i<br /> Case i = 2
            </td>
            <td>
                Select Case i<br /> Case 2
            </td>
            <td>
                The variable i is compared to 2.
            </td>
        </tr>
        <tr class="even">
            <td>
                Select Case i<br /> Case i = 2
            </td>
            <td>
                Select Case i<br /> Case IS = 2
            </td>
            <td>
                The variable i is compared to 2.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Select Case i<br /> Case i&lt;2 OR i&gt;9
            </td>
            <td>
                <p>
                    Select Case i
                </p>
                <p>
                    Case IIf(i&lt;2 OR i&gt;9, i, i+1)
                </p>
            </td>
            <td>
                This works even if i is not an integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Select Case i%<br /> Case i%&gt;2 AND i%&lt;10
            </td>
            <td>
                Select Case i%<br /> Case 3 TO 9
            </td>
            <td>
                i% is an integer so the range is from 3 through 9.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Select Case i%<br /> Case IS&gt;8 And i&lt;11
            </td>
            <td>
                Select Case i%<br /> Case i XOR NOT(i&gt;8 AND i&lt; 11)
            </td>
            <td>
                This works because i% is an integer.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="while-...-wend">
                            <span id="anchor-89"></span>While ... Wend
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the While ...Wend statement to repeat a block of statements while a condition is true. This construct has
    limitations that do not exist with the Do While ... Loop construct and offers no particular benefits. The While ...
    Wend statement does not support an Exit statement. You cannot use GoTo to exit a While ... Wend statement.
</p>
<p>
    While Condition
</p>
<p>
    StatementBlock
</p>
<p>
    Wend
</p>
<p>
    Visual Basic .NET does not support the keyword Wend. This is another reason to use the Do While ... Loop instead.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="do-...-loop">
                            <span id="anchor-90"></span>Do ... Loop
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The Loop construct has different forms and is used to continue executing a block of code while, or until, a
    condition is true. The most common form checks the condition before the loop starts, and repeatedly executes a block
    of code as long as the condition is true. If the initial condition is false, the loop is never executed.
</p>
<p>
    Do While condition
</p>
<p>
    Block
</p>
<p>
    [Exit Do]
</p>
<p>
    Block
</p>
<p>
    Loop
</p>
<p>
    A similar, but much less common form, repeatedly executes the code as long as the condition is false. In other
    words, the code is executed until the condition becomes true. If the condition evaluates to true immediately, the
    loop never runs.
</p>
<p>
    Do Until condition
</p>
<p>
    Block
</p>
<p>
    [Exit Do]
</p>
<p>
    Block
</p>
<p>
    Loop
</p>
<p>
    You can place the check at the end of the loop, in which case the block of code is executed at least once. With the
    following construct, the loop runs at least once and then repeatedly runs as long as the condition is true:
</p>
<p>
    Do
</p>
<p>
    Block
</p>
<p>
    [Exit Do]
</p>
<p>
    Block
</p>
<p>
    Loop While condition
</p>
<p>
    To execute the loop at least once and then continue as long as the condition is false, use the following construct:
</p>
<p>
    Do
</p>
<p>
    Block
</p>
<p>
    [Exit Do]
</p>
<p>
    Block
</p>
<p>
    Loop Until condition
</p>
<h4 id="exit-the-do-loop">
    <span id="anchor-91"></span>Exit the Do Loop
</h4>
<p>
    The Exit Do statement causes an immediate exit from the loop. The Exit Do statement is valid only within a Do ...
    Loop. Program execution continues with the statement that follows the innermost Loop statement. The subroutine
    ExampleDo in demonstrates a Do While Loop by searching an array for a number.
</p>
<p>
    <strong>Listing .</strong> Do Loop example.
</p>
<p>
    Sub ExampleDo
</p>
<p>
    Dim a(), i%, x%
</p>
<p>
    a() = Array(2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30)
</p>
<p>
    x = Int(32 * Rnd) REM random integer between 0 and 32
</p>
<p>
    i = LBound(a()) REM i is the lower bound of the array.
</p>
<p>
    Do While a(i) &lt;&gt; x REM while a(i) is not equal to x
</p>
<p>
    i = i + 1 REM Increment i
</p>
<p>
    If i &gt; UBound(a()) Then Exit Do REM If i is too large, then exit
</p>
<p>
    Loop REM Loop back to the Do While
</p>
<p>
    If i &lt;= UBound(a()) Then REM If i is not too large then found x
</p>
<p>
    MsgBox "Found " &amp; x &amp; " at location " &amp; i, 0, "Example Do"
</p>
<p>
    Else
</p>
<p>
    MsgBox "Could not find " &amp; x &amp; " in the array", 0, "Example Do"
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<h4 id="which-do-loop-should-i-use">
    <span id="anchor-92"></span>Which Do Loop should I use?
</h4>
<p>
    OOo Basic supports four variants of the Do Loop construct. Each variant has a particular purpose and time for use.
    The most common problem is that the loop runs one time too few or one time too many because the conditional
    expression was incorrectly placed at the wrong location.
</p>
<p>
    When deciding where to place the conditional expression of a Do Loop, ask yourself this question: “Must the loop
    always run at least once?” If the answer is no, the conditional expression must be at the top. This will prevent the
    code in the loop from running if the conditional expression fails. Consider, for example, printing all of the
    elements in an array of unknown size. The array might contain no elements at all, in which case the code in the loop
    shouldn’t run (see ).
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> While and Until loops are very similar.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                <p>
                    i% = LBound(a())
                </p>
                <p>
                    Do While i% &lt;= UBound(a())
                </p>
                <p>
                    Print a(i%)
                </p>
                <p>
                    i% = i% + 1
                </p>
                <p>
                    Loop
                </p>
            </td>
            <td>
                <p>
                    i% = LBound(a())
                </p>
                <p>
                    Do Until i% &gt; UBound(a())
                </p>
                <p>
                    Print a(i%)
                </p>
                <p>
                    i% = i% + 1
                </p>
                <p>
                    Loop
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    In each case in , if the array is empty, the loop never runs. Before the condition is evaluated, i% is set to the
    lower bound of the array. In each case, the loop continues to run while i% is not larger than the upper bound.
</p>
<p>
    Consider the difference between a While loop and an Until loop with a simple example. While the car has gas, you may
    drive it. Until the car does not have gas, you may drive it. The primary difference between the While and the Until
    is the word NOT. Tending more toward OOo Basic, I can write “Until NOT (the car has gas).” The choice between While
    and Until is usually based on which one you can write without the NOT.
</p>
<p>
    If the loop should run at least once, move the conditional expression to the end of the Do Loop. Consider requesting
    user input until a valid value has been entered. The most natural choice is to place the conditional expression at
    the end.
</p>
<p>
    Dim s$, x As Double
</p>
<p>
    Do
</p>
<p>
    s$ = InputBox("Enter a number from 1 through 5")
</p>
<p>
    x = CDbl(s$) 'Convert the string to a Double
</p>
<p>
    Loop Until x &gt;= 1 AND x &lt;= 5
</p>
<p>
    The loop must run at least once so that at least one number is entered. The loop repeats until a valid value is
    entered. As an exercise, consider how to write this as a While loop.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="for-...-next">
                            <span id="anchor-93"></span>For ... Next
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The For ... Next statement repeats a block of statements a specified number of times.
</p>
<p>
    For counter=start To end [Step stepValue]
</p>
<p>
    statement block1
</p>
<p>
    [Exit For]
</p>
<p>
    statement block2
</p>
<p>
    Next [counter]
</p>
<p>
    The numeric “counter” is initially assigned the “start” value. When the program reaches the Next statement, the
    counter is incremented by the “step” value, or incremented by one if a “step” value is not specified. If the
    “counter” is still less than or equal to the “end” value, the statement blocks run. An equivalent Do While Loop
    follows:
</p>
<p>
    counter = start
</p>
<p>
    Do While counter &lt;= end
</p>
<p>
    statement block1
</p>
<p>
    [Exit Do]
</p>
<p>
    statement block2
</p>
<p>
    counter = counter + step
</p>
<p>
    Loop
</p>
<p>
    The “counter” is optional on the “Next” statement, and it automatically refers to the most recent “For” statement.
</p>
<p>
    For i = 1 To 4 Step 2
</p>
<p>
    Print i ' Prints 1 then 3
</p>
<p>
    Next i ' The i in this statement is optional.
</p>
<p>
    The Exit For statement leaves the For statement immediately. The most recent For statement is exited. demonstrates
    this with a sorting routine. An array is filled with random integers, and then sorted using two nested loops. This
    technique is called a “modified bubble sort.”
</p>
<p>
    First, iOuter is set to the last number in the array. The inner loop, using iInner, compares every number to the one
    after it. If the first number is larger than the second number, the two numbers are swapped. The second number is
    then compared to the third number. After the inner loop is finished, the largest number is guaranteed to be at the
    last position in the array.
</p>
<p>
    Next, iOuter is decremented by 1. The inner loop this time ignores the last number in the array, and compares every
    number to the one after it. At the end of the inner loop, the second-highest number is second from the end.
</p>
<p>
    With each iteration, one more number is moved into position. If no numbers are exchanged, the list is sorted.
</p>
<p>
    <strong>Listing .</strong> Modified bubble sort.
</p>
<p>
    Sub ExampleForNextSort
</p>
<p>
    Dim iEntry(10) As Integer
</p>
<p>
    Dim iOuter As Integer, iInner As Integer, iTemp As Integer
</p>
<p>
    Dim bSomethingChanged As Boolean
</p>
<p>
    ' Fill the array with integers between -10 and 10
</p>
<p>
    For iOuter = LBound(iEntry()) To Ubound(iEntry())
</p>
<p>
    iEntry(iOuter) = Int((20 * Rnd) -10)
</p>
<p>
    Next iOuter
</p>
<p>
    ' iOuter runs from the highest item to the lowest
</p>
<p>
    For iOuter = UBound(iEntry()) To LBound(iEntry()) Step -1
</p>
<p>
    'Assume that the array is already sorted and see if this is incorrect
</p>
<p>
    bSomethingChanged = False
</p>
<p>
    For iInner = LBound(iEntry()) To iOuter-1
</p>
<p>
    If iEntry(iInner) &gt; iEntry(iInner+1) Then
</p>
<p>
    iTemp = iEntry(iInner)
</p>
<p>
    iEntry(iInner) = iEntry(iInner+1)
</p>
<p>
    iEntry(iInner+1) = iTemp
</p>
<p>
    bSomethingChanged = True
</p>
<p>
    End If
</p>
<p>
    Next iInner
</p>
<p>
    'If the array is already sorted then stop looping!
</p>
<p>
    If Not bSomethingChanged Then Exit For
</p>
<p>
    Next iOuter
</p>
<p>
    Dim s$
</p>
<p>
    For iOuter = LBound(iEntry()) To Ubound(iEntry())
</p>
<p>
    s = s &amp; iOuter &amp; " : " &amp; iEntry(iOuter) &amp; CHR$(10)
</p>
<p>
    Next iOuter
</p>
<p>
    MsgBox s, 0, "Sorted Array"
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="exit-sub-and-exit-function">
                            <span id="anchor-94"></span>Exit Sub and Exit Function
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The Exit Sub statement exits a subroutine, and the Exit Function statement exits a function. The routine is exited
    immediately. The macro continues running at the statement following the statement that called the current routine.
    These statements work only to exit the currently running routine, and they are valid only in their respective types.
    For example, you can’t use Exit Sub in a function.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="error-handling-using-on-error">
                    <span id="anchor-95"></span>Error handling using On Error
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Errors are usually placed into three “categories”<em><em> — </em></em>compile time, run time, and logic.
    Compile-time errors are typically syntax errors such as missing double quotation marks that prevent your macro from
    compiling. Compile-time errors are the easiest to deal with because they are found immediately and the IDE shows you
    which line caused the problem. Run-time errors compile properly but cause an error when the macro runs. For example,
    dividing by a variable that at some point evaluates to zero will cause a run-time error. The third type, logic
    errors, are mistakes in the business logic of the program: They compile and run okay, but generate the wrong
    answers. They’re the worst kind because you have to find them yourself <em><em>— </em></em>the computer won’t help
    you at all. This section is about run-time errors: how to deal with them and how to correct them.
</p>
<p>
    An error handler is a piece of code that runs when an error occurs. The default error handler displays an error
    message and stops the macro. OOo Basic provides a mechanism to modify this behavior (see ). The first form, On Error
    Resume Next, tells OOo to ignore all errors: No matter what happens, keep running and pretend everything is fine.
    The second form, On Error GoTo 0, tells OOo to stop using the current error handler. Ignoring error handler scope
    issues, as explained later, think of On Error GoTo 0 as restoring the default method of handling errors: Stop
    running and display an error message. The final form, On Error GoTo LabelName, allows you to define code to handle
    errors the way that you want. This is called “setting up an error handler.”
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Supported On Error forms.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                On Error Resume Next
            </td>
            <td>
                Ignore errors and continue running at the next line in the macro.
            </td>
        </tr>
        <tr class="even">
            <td>
                On Error GoTo 0
            </td>
            <td>
                Cancel the current error handler.
            </td>
        </tr>
        <tr class="odd">
            <td>
                On Error GoTo LabelName
            </td>
            <td>
                Transfer control to the specified label.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When an error occurs, the code that was running stops running, and control is transferred to the current error
    handler. The error handlers use the functions in to determine the cause and location of the error. Visual Basic uses
    an Error object and does not support the functions in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Error-related variables and functions.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CVErr
            </td>
            <td>
                Convert an expression to an error object.
            </td>
        </tr>
        <tr class="even">
            <td>
                Erl
            </td>
            <td>
                Integer line number of the last error.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Err
            </td>
            <td>
                Integer error number of the last error.
            </td>
        </tr>
        <tr class="even">
            <td>
                Error
            </td>
            <td>
                Error message of the last error.
            </td>
        </tr>
    </tbody>
</table>
<p>
    All error handlers must be declared in a routine and are local to the containing subroutine or function. When an
    error occurs, OOo Basic starts working backward through the call stack until it finds an error handler. If it
    doesn’t find an error handler, it uses the default handler. The default handler prints an error message and halts
    the program. The error information, such as Erl, indicates the line number in the current routine that caused the
    error. For example, if the current routine calls the function b() at line 34 and an error occurs in b(), the error
    is reported as occurring at line 34. contains an example of this, and shows the call stack. Another example is shown
    in .
</p>
<p>
    <strong>Listing .</strong> Use Erl to get the line number.
</p>
<p>
    x = x + 1 'Assume that this is line 33
</p>
<p>
    Call b() 'Error in b() or something b() calls (line 34)
</p>
<p>
    Exit Sub 'Leave the subroutine
</p>
<p>
    ErrorHandler: 'No other handlers between here and the error
</p>
<p>
    Print "error at " &amp; Erl 'Prints line 34
</p>
<p>
    <img src="Pictures/10000000000002C700000186B78753E1.png" style="width:4.3701in;height:2.2299in" />
</p>
<p>
    <strong>Figure .</strong> Walk the call stack to find a handler.
</p>
<p>
    You cannot catch errors that occur in a DLL. Check the return code from the called DLL instead.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="cverr">
                            <span id="anchor-96"></span>CVErr
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use CVErr (as mentioned in ) to create an OOo specific internal data type that represents an error. I have never
    seen this done, but it can be useful for a very robust function.
</p>
<p>
    CVErr returns an internal OOo type that should be assigned to a variant variable. Why?
</p>
<ol type="1">
    <li>
        Use VarType to check the type of the returned value. A VarType of 10 means that an error object was returned
        (see ).
    </li>
    <li>
        CVErr accepts an integer, which represents the internal error code that occurred. The internal error object
        casts to an integer and returns that internal error code.
    </li>
</ol>
<p>
    The following example demonstrates CVErr.
</p>
<p>
    <strong>Listing .</strong> Using CVErr
</p>
<p>
    Sub CallNotZero
</p>
<p>
    Dim xVar As Variant
</p>
<p>
    Dim xInt As Integer
</p>
<p>
    Dim i As Integer
</p>
<p>
    Dim s As String
</p>
<p>
    For i = -1 To 1
</p>
<p>
    xInt = NotZero(i)
</p>
<p>
    xVar = NotZero(i)
</p>
<p>
    s = s &amp; "NotZero(" &amp; i &amp; ") = [" &amp; xInt &amp; "] when assigned to an Integer"
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    s = s &amp; "NotZero(" &amp; i &amp; ") = [" &amp; xVar &amp; "] VarType=" &amp; VarType(xVar)
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    Function NotZero(x As Integer)
</p>
<p>
    If x &lt;&gt; 0 Then
</p>
<p>
    NotZero = x
</p>
<p>
    Else
</p>
<p>
    ' 7 is an arbitrary number meaning nothing.
</p>
<p>
    NotZero = CVErr(7)
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<p>
    <img src="Pictures/1000000000000151000000AD6BAB5546.png" style="width:3.5102in;height:1.802in" />
</p>
<p>
    <strong>Figure .</strong> Return values using CVErr.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="ignore-errors-with-on-error-resume-next">
                            <span id="anchor-97"></span>Ignore errors with On Error Resume Next
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Error handling, in some cases, means ignoring errors. The On Error Resume statement tells OOo Basic that if a
    standard error occurs, it should ignore the error and resume running the code at the next line in the macro (see ).
    The error information is cleared, so it isn’t possible to check if an error occurred following the statement.
</p>
<p>
    <strong>Listing .</strong> The error is cleared by the Resume Next statement.
</p>
<p>
    Private zero%
</p>
<p>
    sub ExampleErrorResumeNext
</p>
<p>
    On Error Resume Next
</p>
<p>
    Print 1/Zero%
</p>
<p>
    If Err &lt;&gt; 0 Then Print Error$ &amp; " at line " &amp; Erl 'Err was cleared
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="clear-an-error-handler-with-on-error-goto-0">
                            <span id="anchor-98"></span>Clear an error handler with On Error GoTo 0
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the statement On Error GoTo 0 to clear an installed error handler. This is usually done inside an error handler
    or after the code that used one. If an error occurs inside an error handler, it isn’t handled and the macro stops.
</p>
<p>
    <strong>Listing .</strong> The error handler is cleared with the statement On Error GoTo 0.
</p>
<p>
    Private zero%
</p>
<p>
    sub ExampleErrorResumeNext
</p>
<p>
    On Error Resume Next
</p>
<p>
    Print 1/Zero%
</p>
<p>
    On Error GoTo 0
</p>
<p>
    ...
</p>
<p>
    End Sub
</p>
<p>
    Some versions of Visual Basic also support On Error GoTo -1, which is equivalent to On Error GoTo 0.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="specify-your-own-error-handler-with-on-error-goto-label">
                            <span id="anchor-99"></span>Specify your own error handler with On Error GoTo Label
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    To specify your own error handler, use On Error GoTo Label. To define a label in OOo Basic, type some text on a line
    by itself and follow it with a colon. Line labels are no longer required to be unique; they must be unique only
    within each routine. This allows for consistency in naming error-handling routines rather than creating a unique
    name for every error handler (see and ). When an error occurs, execution is transferred to the label.
</p>
<p>
    <strong>Listing .</strong> Error Handling.
</p>
<p>
    Private zero%
</p>
<p>
    Private error_s$
</p>
<p>
    Sub ExampleJumpErrorHandler
</p>
<p>
    On Error GoTo ExErrorHandler
</p>
<p>
    JumpError1
</p>
<p>
    JumpError2
</p>
<p>
    Print 1/Zero%
</p>
<p>
    MsgBox error_s, 0, "Jump Error Handler"
</p>
<p>
    Exit Sub
</p>
<p>
    ExErrorHandler:
</p>
<p>
    error_s = error_s &amp; "Error in MainJumpErrorHandler at line " &amp; Erl() &amp;_
</p>
<p>
    " : " &amp; Error() &amp; CHR$(10)
</p>
<p>
    Resume Next
</p>
<p>
    End Sub
</p>
<p>
    Sub JumpError1
</p>
<p>
    REM Causes a jump to the handler in ExampleJumpErrorHandler.
</p>
<p>
    REM The main error handler indicates that the error location is
</p>
<p>
    REM at the call to JumpError1 and not in JumpError1.
</p>
<p>
    Print 1/zero%
</p>
<p>
    error_s = error_s &amp; "Hey, I am in JumpError1" &amp; CHR$(10)
</p>
<p>
    End Sub
</p>
<p>
    Sub JumpError2
</p>
<p>
    On Error GoTo ExErrorHandler
</p>
<p>
    Print 1/zero%
</p>
<p>
    Exit Sub
</p>
<p>
    ExErrorHandler:
</p>
<p>
    error_s = error_s &amp; "Error in JumpError2 at line " &amp; Erl() &amp;_
</p>
<p>
    " : " &amp; Error() &amp; CHR$(10)
</p>
<p>
    Resume Next
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000005CB000001F89AEE7C9E.png" style="width:3.5075in;height:1.102in" />
</p>
<p>
    <strong>Figure .</strong> The last error handler declared is used.
</p>
<p>
    A routine can contain several On Error statements. Each On Error statement can treat errors differently. The error
    handlers in all used Resume Next to ignore the error and continue execution at the line following the error. Using
    multiple error handlers, it is possible to skip sections of code when an error occurs (see ).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The OOo version 3.20 help still incorrectly states that error handling must occur at the start of a
                routine.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Skip sections of code when an error occurs.
</p>
<p>
    On Error GoTo PropertiesDone 'Ignore any errors in this section.
</p>
<p>
    a() = getProperties() 'If unable to get properties then
</p>
<p>
    DisplayStuff(a(), "Properties") 'an error will prevent getting here.
</p>
<p>
    PropertiesDone:
</p>
<p>
    On Error GoTo MethodsDone 'Ignore any errors in this section.
</p>
<p>
    a() = getMethods()
</p>
<p>
    DisplayStuff(a(), "Methods")
</p>
<p>
    MethodsDone:
</p>
<p>
    On Error Goto 0 'Turn off current error handlers.
</p>
<p>
    When you write an error handler, you must decide how to handle errors. The functions in are used to diagnose errors
    and to display or log error messages. There is also the question of flow control. Here are some error-handling
    guidelines:
</p>
<p>
    Exit the subroutine or function using Exit Sub or Exit Function.
</p>
<p>
    Let the macro continue to run and ignore the error (see ).
</p>
<p>
    Use Resume Next to continue running the macro at the line following the error (see and ).
</p>
<p>
    Use Resume to run the same statement again. If the problem is not fixed, the error will occur again.<br /> This will
    cause an infinite loop.
</p>
<p>
    Use Resume LabelName to continue running at some specified location.
</p>
<p>
    <strong>Listing .</strong> Resume next error handler.
</p>
<p>
    Sub ExampleResumeHandler
</p>
<p>
    Dim s$, z%
</p>
<p>
    On Error GoTo Handler1 'Add a message, then resume to Spot1
</p>
<p>
    s = "(0) 1/z = " &amp; 1/z &amp; CHR$(10) 'Divide by zero, so jump to Handler1
</p>
<p>
    Spot1: 'Got here from Handler1
</p>
<p>
    On Error GoTo Handler2 'Handler2 uses resume
</p>
<p>
    s = s &amp; "(1) 1/z = "&amp;1/z &amp; CHR$(10) 'Fail the first time, work the second
</p>
<p>
    On Error GoTo Handler3 'Handler3 resumes the next line
</p>
<p>
    z = 0 'Allow for division by zero again
</p>
<p>
    s = s &amp; "(2) 1/z = "&amp;1/z &amp; CHR$(10) 'Fail and call Handler3
</p>
<p>
    MsgBox s, 0, "Resume Handler"
</p>
<p>
    Exit Sub
</p>
<p>
    Handler1:
</p>
<p>
    s = s &amp; "Handler1 called from line " &amp; Erl() &amp; CHR$(10)
</p>
<p>
    Resume Spot1
</p>
<p>
    Handler2:
</p>
<p>
    s = s &amp; "Handler2 called from line " &amp; Erl() &amp; CHR$(10)
</p>
<p>
    z = 1 'Fix the error then do the line again
</p>
<p>
    Resume
</p>
<p>
    Handler3:
</p>
<p>
    s = s &amp; "Handler3 called from line " &amp; Erl() &amp; CHR$(10)
</p>
<p>
    Resume Next
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000002F20000023B0E5DD86B.png" style="width:1.9953in;height:1.402in" />
</p>
<p>
    <strong>Figure .</strong> The last error handler declared is used.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Errors that occur in an error handler are not handled; the macro just stops running.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="error-handlers-why-use-them">
                            <span id="anchor-100"></span>Error handlers<em><em> — </em></em>why use them?
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    When I run a macro and it crashes, I usually understand the sometimes cryptic error messages and recognize how to
    deal with them. When others run my macros and an error occurs, I usually hear about it because they don’t know how
    to handle it. This is a good indicator that I have not used proper error handling.
</p>
<p>
    You do not have to write an error handler for each routine. If the current routine doesn’t have an error handler,
    but the routine that called it does, the caller’s error handler is called. For example, imagine that sub1 has an
    error handler and it calls sub2 that does not. If an error occurs in sub2, the error handler in sub1 is called.
</p>
<p>
    When you use an error handler, you control how and when a user is notified of an error. Error handlers have uses
    other than controlling when a user is informed of an error. A properly used error handler can reduce the size of
    your macro. Consider, for example, the mathematical operations. It is cumbersome to check every mathematical
    operation before it is used.
</p>
<p>
    If x &lt;&gt; 0 Then y = z / x
</p>
<p>
    If x &gt; 0 Then y = Log(x)
</p>
<p>
    If i% &lt; 32767 Then i% = i% + 1
</p>
<p>
    Even with my paranoid code checking the arguments, I might still have a numeric overflow. Even worse, nothing is
    done if an error occurs, and processing continues as normal. Sometimes you can’t check anything to avoid the error.
    For example, prior to OOo version 2.0, the DimArray function returned an invalid empty array. The LBound and UBound
    functions generate exceptions with these invalid empty arrays. Error handling was used to safely generate the LBound
    and UBound even if an error occured. Consider the following cases:
</p>
<ul>
    <li>
        The argument is not an array.
    </li>
    <li>
        In an empty array, UBound &lt; LBound; -1 and 0, for example.
    </li>
    <li>
        There are no problems if the array is not an invalid empty array.
    </li>
    <li>
        Should the optional dimension be considered?
    </li>
</ul>
<p>
    The code in demonstrates a simple error handler that is able to simply ignore errors. The function returns True if
    the lower bound is less than or equal to the upper bound<em><em> — </em></em>in other words, if the array contains
    data. If an error occurs, either because the argument is not an array or because this is an invalid empty array, the
    line does not finish running so the assignment never takes place. If the assignment never takes place, the original
    default Boolean value of False is used. This is the correct answer. Writing a safe upper-bound or lower-bound
    routine is left as an exercise for the reader<em><em> — the safe versions are not required with the fixed UBound and
            LBound functions released with OOo 2.0</em></em>.
</p>
<p>
    <strong>Listing .</strong> Determine if an array has stuff.
</p>
<p>
    Sub ExampleArrayHasStuff
</p>
<p>
    Dim a(), b(3), v
</p>
<p>
    Print ArrayHasStuff(a()) 'False, because empty
</p>
<p>
    Print ArrayHasStuff(v) 'False, not an array, so use error handler
</p>
<p>
    Print ArrayHasStuff(DimArray()) 'False, bad array, so error handler called
</p>
<p>
    Print ArrayHasStuff(DimArray(3))'True, this is not empty
</p>
<p>
    Print ArrayHasStuff(b()) 'True, this is not empty
</p>
<p>
    End Sub
</p>
<p>
    Function ArrayHasStuff(v) As Boolean
</p>
<p>
    REM default value for a Boolean is False, so the default answer is False
</p>
<p>
    REM If an error occurs, then the statement never completes!
</p>
<p>
    REM This is a good time to use On Error Resume Next
</p>
<p>
    On Error Resume Next
</p>
<p>
    ArrayHasStuff = CBool(LBound(v) &lt;= UBound(v))
</p>
<p>
    End Function
</p>
<p>
    An error handler can even be interactive. The code in attempts to copy a file that doesn’t exist to a location that
    doesn’t exist. Needless to say, an error is generated. An error message is displayed and the user is asked if the
    copy should be tried again. The user is given an opportunity to correct any errors and continue.
</p>
<p>
    <strong>Listing .</strong> Copy a file.
</p>
<p>
    Sub ExampleCopyAFile()
</p>
<p>
    CopyAFile("/I/do/not/exist.txt", "/neither/do/I.txt")
</p>
<p>
    End Sub
</p>
<p>
    Sub CopyAFile(Src$, Dest$)
</p>
<p>
    On Error GoTo BadCopy: 'Set up the error handler
</p>
<p>
    TryAgain:
</p>
<p>
    FileCopy(Src$, Dest$) 'Generate the error
</p>
<p>
</p>
<p>
    AllDone: 'If no error, then continue here
</p>
<p>
    Exit Sub 'Resume to the AllDone label from the handler
</p>
<p>
</p>
<p>
    BadCopy: 'Display an error dialog
</p>
<p>
    Dim rc% 'Ask if should try again
</p>
<p>
    rc% = MsgBox("Failed to copy from " &amp; Src$ &amp; " to " &amp; Dest$ &amp; " because: "&amp;_
</p>
<p>
    CHR$(10) &amp; Error() &amp; " at line " &amp; Erl &amp; CHR$(10) &amp;_
</p>
<p>
    "Try again?", (4 OR 32), "Error Copying")
</p>
<p>
    If rc% = 6 Then 'Yes, try the command again
</p>
<p>
    Resume
</p>
<p>
    End If
</p>
<p>
    If rc% = 7 Then 'No
</p>
<p>
    Resume AllDone 'Go to the AllDone label
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-1">
                    <span id="anchor-101"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Building any significant OOo macro requires understanding the syntax of OOo Basic. This chapter covered the key
    elements:
</p>
<ul>
    <li>
        The syntax of a macro determines valid and invalid constructs.
    </li>
    <li>
        The logic of a macro determines what the macro does.
    </li>
    <li>
        Flow control directs the macro as it runs.
    </li>
    <li>
        Error handling directs the macro when it does something unexpected.
    </li>
</ul>
<p>
    A complete, well-constructed macro that accomplishes any significant function will most likely use all of these
    characteristics of OOo programming. The specific elements within OOo that one uses to build a specific program
    depend on the application, the desired logical behavior of the program, and the best judgment of the programmer. One
    major part of successful programming is developing the experience to apply the ideas of this chapter in the most
    effective way.
</p>
<ol type="1">
    <li>
        <h1 id="numerical-routines">
            <span id="anchor-102"></span>Numerical Routines
        </h1>
    </li>
</ol>
<p>
    This chapter introduces the subroutines and functions supported by OpenOffice.org Basic that are related to numbers
    — including mathematical functions, conversion routines, formatting numbers as a string, and random numbers. This
    chapter also discusses alternate number bases.
</p>
<p>
    Numerical subroutines and functions are routines that perform mathematical operations. If you use spreadsheets, you
    may already be familiar with mathematical functions such as Sum, which adds groups of numbers together, or even IRR,
    which calculates the internal rate of return of an investment. The numerical routines supported by OOo Basic (see )
    are simpler in nature, typically operating on only one or two arguments rather than an entire group of numbers.
</p>
<p>
    <strong>Table .</strong> Subroutines and functions related to numbers and numerical operations.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                ABS(number)
            </td>
            <td>
                The absolute value of a specified number.
            </td>
        </tr>
        <tr class="even">
            <td>
                ATN(number)
            </td>
            <td>
                The angle, in radians, whose tangent is the specified number in the range of -Pi/2 through Pi/2.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CByte(expression)
            </td>
            <td>
                Round the String or numeric expression to a Byte.
            </td>
        </tr>
        <tr class="even">
            <td>
                CCur(expression)
            </td>
            <td>
                Convert the expression to a Currency type.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CDbl(expression)
            </td>
            <td>
                Convert a String or numeric expression to a Double.
            </td>
        </tr>
        <tr class="even">
            <td>
                CDec(expression)
            </td>
            <td>
                Generate a Decimal type; implemented only on Windows.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CInt(expression)
            </td>
            <td>
                Round the String or numeric expression to the nearest Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                CLng(expression)
            </td>
            <td>
                Round the String or numeric expression to the nearest Long.
            </td>
        </tr>
        <tr class="odd">
            <td>
                COS(number)
            </td>
            <td>
                The cosine of the specified angle.
            </td>
        </tr>
        <tr class="even">
            <td>
                CSng(expression)
            </td>
            <td>
                Convert a String or numeric expression to a Single.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Exp(number)
            </td>
            <td>
                The base of natural logarithms raised to a power.
            </td>
        </tr>
        <tr class="even">
            <td>
                Fix(number)
            </td>
            <td>
                Chop off the decimal portion.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Format(obj, format)
            </td>
            <td>
                Fancy formatting, discussed in Chapter 6, “String Routines.”
            </td>
        </tr>
        <tr class="even">
            <td>
                Hex(n)
            </td>
            <td>
                Return the hexadecimal representation of a number as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Int(number)
            </td>
            <td>
                Round the number toward negative infinity.
            </td>
        </tr>
        <tr class="even">
            <td>
                Log(number)
            </td>
            <td>
                The logarithm of a number. In Visual Basic .NET this method can be overloaded to return either the
                natural (base e) logarithm or the logarithm of a specified base.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Oct(number)
            </td>
            <td>
                Return the octal representation of a number as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                Randomize(num)
            </td>
            <td>
                Initialize the random number generator. If num is ommitted, uses the system timer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Rnd
            </td>
            <td>
                Return a random number as a Double from 0 through 1.
            </td>
        </tr>
        <tr class="even">
            <td>
                Sgn(number)
            </td>
            <td>
                Integer value indicating the sign of a number.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SIN(number)
            </td>
            <td>
                The sine of an angle.
            </td>
        </tr>
        <tr class="even">
            <td>
                Sqr(number)
            </td>
            <td>
                The square root of a number.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Str(number)
            </td>
            <td>
                Convert a number to a String with no localization.
            </td>
        </tr>
        <tr class="even">
            <td>
                TAN(number)
            </td>
            <td>
                The tangent of an angle.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Val(str)
            </td>
            <td>
                Convert a String to a Double. This is very tolerant to non-numeric text.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The mathematical functions presented in this chapter are well-known and understood by mathematicians, engineers, and
    others who look for excuses to use calculus in everyday life. If that is not you <em><em>— </em></em>if, perhaps,
    you do <em>not</em> consider the slide rule to be the coolest thing since sliced bread <em><em>— </em></em>don’t
    panic when the coverage starts to become mathematical in nature. I have tried to make the information accessible
    while still providing the in-depth information for those who require it. The routines are topically grouped into
    sections so you can skip sections that you know that you won’t use.
</p>
<p>
    The numerical routines perform operations on numerical data. OOo Basic tries to convert arguments to an appropriate
    type before performing an operation. It is safer to explicitly convert data types using conversion functions, as
    presented in this chapter, than to rely on the default behavior. When an Integer argument is required and a
    floating-point number is provided, the default behavior is to round the number. For example, “16.8 MOD 7” rounds
    16.8 to 17 before performing the operation. The Integer division operator, however, truncates the operands. For
    example,<br /> “Print 4 \ 0.999” truncates 0.999 to 0, causing a division-by-zero error.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                contains subroutines and functions, not operators such as MOD, +, and \.<br /> Operators were covered in
                Chapter <a href="#anchor-22">3</a>, <a href="#anchor-22">Language Constructs</a>.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="trigonometric-functions">
                    <span id="anchor-103"></span>Trigonometric functions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Trigonometry is the study of the properties of triangles and trigonometric functions and of their applications.
    Discussions of trigonometric functions usually refer to right triangles, which have one angle of 90 degrees (see ).
    There is a set of defined relationships among the trigonometric functions, the lengths of the sides of a right
    triangle, and the corresponding angles in the triangle. When you know these relationships, you can use the
    trigonometric functions to solve trigonometric problems.
</p>
<p>
    A practical problem that uses trigonometry is to estimate one’s distance from a pole or tower of known height. By
    measuring the observed angle from the ground to the top of the pole, and knowing the height of the pole, your
    distance from that pole is the height of the pole divided by the tangent of the measured angle. This principle can
    be applied to golf, sailing, or hiking, to estimate distance from a fixed point of interest (the golf flag, for
    example, or a radio transmission tower).
</p>
<p>
    The principal trigonometric functions are sine, cosine, and tangent. Each is defined as the ratio between two sides
    of a right triangle. The values of these functions for any value of the angle, x, correspond to the ratios of the
    lengths of the sides of the right triangle containing that angle, x. For a given angle, the trigonometric functions
    fix the lengths of the sides of the right triangle. Likewise, knowing the lengths of any two sides of the right
    triangle allows one to compute the value of the angle using one of the inverse trigonometric functions.
</p>
<p>
    OOo Basic uses radians as the unit of measure for angles; however, most non-scientists think in degrees. An angle
    that is 90 degrees, such as the corner of a square, is Pi/2 radians.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The built-in constant Pi is approximately 3.1415926535897932385. Pi is a fundamental constant widely
                used in scientific calculations, and is defined as the ratio of the circumference of a circle to its
                diameter. The sum of the angles in any triangle — including a right triangle — is 180 degrees, or Pi
                radians. A tremendous amount of elegant and practical mathematical methods result from this connection
                between a triangle and a circle. All descriptions of periodic motion build on this foundation, making
                trigonometry a fundamental and very useful set of mathematical tools.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Using the relationship between degrees and radians, it is easy to convert between radians and degree measurements of
    angles.
</p>
<p>
    degrees = (radians * 180) / Pi
</p>
<p>
    radians = (degrees * Pi) / 180
</p>
<p>
    To calculate the sine of a 45-degree angle, you must first convert the angle from degrees to radians. Here’s the
    conversion:
</p>
<p>
    radians = (45° * Pi) / 180 = Pi / 4 = 3.141592654 / 4 = 0.785398163398
</p>
<p>
    You can use this value directly in the trigonometric function SIN.
</p>
<p>
    Print SIN(0.785398163398) ' .707106781188
</p>
<p>
    To determine the angle whose tangent is 0.577350269189, use the arctangent function. The returned value is in
    radians, so this value must be converted back to degrees.
</p>
<p>
    Print ATN(0.577350269189) * 180 / Pi '29.9999999999731
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Rounding errors, as discussed later, affect these examples. With infinite precision, the previous
                example would result in an answer of 30 degrees rather than 29.9999999999731.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The answer is roughly 30 degrees. The triangle in is used to help explain the trigonometric functions.
</p>
<p>
    <img src="Pictures/100000000000029F0000026E813CACD7.png" style="width:2.9937in;height:2.478in" />
</p>
<p>
    <strong>Figure .</strong> A right triangle has one angle at 90 degrees.
</p>
<p>
    <strong>Table .</strong> Trigonometric functions supported by OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                ATN
            </td>
            <td>
                ATN
            </td>
            <td>
                Math.Atan
            </td>
            <td>
                The angle, in radians, whose tangent is the specified number in the range of -Pi/2 through Pi/2.
            </td>
        </tr>
        <tr class="even">
            <td>
                COS
            </td>
            <td>
                COS
            </td>
            <td>
                Math.Cos
            </td>
            <td>
                The cosine of the specified angle.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SIN
            </td>
            <td>
                SIN
            </td>
            <td>
                Math.Sin
            </td>
            <td>
                The sine of an angle.
            </td>
        </tr>
        <tr class="even">
            <td>
                TAN
            </td>
            <td>
                TAN
            </td>
            <td>
                Math.Tan
            </td>
            <td>
                The tangent of an angle.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The trigonometric functions supported by OOo Basic are shown in and illustrated using the right triangle in . The
    single argument expression is converted to a double-precision number before the function is performed.
</p>
<p>
    COS(x) = Adjacent Leg / Hypotenuse
</p>
<p>
    SIN(x) = Opposite Leg / Hypotenuse
</p>
<p>
    TAN(x) = Opposite Leg / Adjacent Leg = SIN(x) / COS(x)
</p>
<p>
    ATN(Opposite Leg / Adjacent Leg) = x
</p>
<p>
    The code in <strong> </strong>solves a series of geometry problems using the trigonometric functions. The code
    assumes a right triangle, as shown in , with an opposite leg of length 3, and an adjacent leg of length 4. The
    tangent is easily calculated as 3/4 and the ATN function is used to determine the angle. A few other calculations
    are performed, such as determining the length of the hypotenuse using both the SIN and the COS functions. Also see .
</p>
<p>
    <strong>Listing .</strong> ExampleTrigonometric
</p>
<p>
    Sub ExampleTrigonometric
</p>
<p>
    Dim OppositeLeg As Double
</p>
<p>
    Dim AdjacentLeg As Double
</p>
<p>
    Dim Hypotenuse As Double
</p>
<p>
    Dim AngleInRadians As Double
</p>
<p>
    Dim AngleInDegrees As Double
</p>
<p>
    Dim s As String
</p>
<p>
    OppositeLeg = 3
</p>
<p>
    AdjacentLeg = 4
</p>
<p>
    AngleInRadians = ATN(3/4)
</p>
<p>
    AngleInDegrees = AngleInRadians * 180 / Pi
</p>
<p>
    s = "Opposite Leg = " &amp; OppositeLeg &amp; CHR$(10) &amp;_
</p>
<p>
    "Adjacent Leg = " &amp; AdjacentLeg &amp; CHR$(10) &amp;_
</p>
<p>
    "Angle in degrees from ATN = " &amp; AngleInDegrees &amp; CHR$(10) &amp;_
</p>
<p>
    "Hypotenuse from COS = " &amp; AdjacentLeg/COS(AngleInRadians) &amp; CHR$(10) &amp;_
</p>
<p>
    "Hypotenuse from SIN = " &amp; OppositeLeg/SIN(AngleInRadians) &amp; CHR$(10) &amp;_
</p>
<p>
    "Opposite Leg from TAN = " &amp; AdjacentLeg * TAN(AngleInRadians)
</p>
<p>
    MsgBox s, 0, "Trigonometric Functions"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/1000000000000166000000CB31FF8F2E.png" style="width:2.7571in;height:1.4689in" />
</p>
<p>
    <strong>Figure .</strong> Use the trigonometric functions to solve problems with triangles.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="rounding-errors-and-precision">
                    <span id="anchor-104"></span>Rounding errors and precision
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Numerical calculations performed on either a computer or calculator are performed with only a finite number of
    digits; this introduces rounding errors. This isn’t a problem with integer numbers. The number 1/3 is represented in
    decimal form as 0.33333333, but there needs to be an infinite number of threes following the decimal point. With
    four digits of precision, this is written as 0.3333. This introduces inaccuracies in the representation and the
    resulting calculations.
</p>
<p>
    1/3 + 1/3 + 1/3 = 3/3 = 1 'The exact answer is 1
</p>
<p>
    0.3333 + 0.3333 + 0.3333 = 0.9999 'The finite precision answer, off a bit
</p>
<p>
    The simple macro in <strong> </strong>demonstrates this problem. The value 0.2 is repeatedly added to the variable
    <em>num</em> until the value is equal to 5. If infinite precision were used, or if the number 0.2 were exactly
    represented inside the computer, the loop would stop with the variable <em>num</em> containing the value 5. The
    variable never precisely equals the value 5, however, so the loop never stops. The value 5 is printed, but this is
    only because the Print statement rounds 4.9999999 to the value 5 when it prints the number.
</p>
<p>
    <strong>Listing .</strong> Rounding errors and finite precision prevent this from stopping.
</p>
<p>
    Dim num As Single
</p>
<p>
    Do
</p>
<p>
    num = num + 0.2
</p>
<p>
    If num &gt; 4.5 Then Print num 'prints 4.6, 4.8, 5, 5.199999...
</p>
<p>
    Loop Until num = 5.0
</p>
<p>
    Print num
</p>
<p>
    Computers use complex rounding algorithms in an attempt to reduce the impact of finite precision<em><em> —
        </em></em>finite precision means that a finite number of digits and storage are used to represent a number.
    Although this helps, clearly demonstrates that the internal complex rounding algorithms do not solve the problem.
    When you compare two floating-point numbers to see if they are equal, it is safer to compare them to a range of
    values. The code in <strong> </strong>stops when the variable is greater than or equal to 5.
</p>
<p>
    <strong>Listing .</strong> Avoid rounding errors by using &gt;= (greater than or equal to).
</p>
<p>
    Dim num As Single
</p>
<p>
    Do
</p>
<p>
    num = num + 0.2
</p>
<p>
    Loop Until num &gt;= 5.0
</p>
<p>
    Print num '5.199999
</p>
<p>
    The code in works to some extent, but you probably want the loop to exit when the variable <em>num</em> is 4.9999999
    rather than when it is 5.199999. You can do this by checking to see if two numbers are close rather than equal. The
    big question is, How close must two numbers be before they are considered equal? You can usually make a simple guess
    based on what you know about the problem. Single-precision variables can represent about eight digits of precision.
    Double-precision variables can represent about 16 digits of precision. Don’t try to demand more precision from the
    variables than they support. The code in uses single-precision variables so you can expect roughly seven digits of
    precision. The code in prints the difference between 5 and <em>num <em>— </em></em>notice that about six digits are
    correct.
</p>
<p>
    <strong>Listing .</strong> Compare the variable to a range.
</p>
<p>
    Dim num As Single
</p>
<p>
    Do
</p>
<p>
    num = num + 0.2
</p>
<p>
    Loop Until 4.99999 &lt; num AND num &lt; 5.00001
</p>
<p>
    Print 5 - num '4.76837158203125E-07 = 0.000000476837158203125
</p>
<p>
    The ABS function returns the absolute value of a number. You can use it to simplify the process of checking to see
    how close one number is to another.
</p>
<p>
    If ABS(num - 5) &lt; 0.00001 Then
</p>
<p>
    Using ABS and subtraction indicates how close two numbers are to each other, but it may not be sufficient. For
    example, light travels at about 299,792,458 meters each second. This number contains nine digits. A single-precision
    number is accurate to about seven digits. See .
</p>
<p>
    <strong>Listing .</strong> Single-precision variables have only seven or eight digits of accuracy.
</p>
<p>
    Dim c1 As Single 'Scientists usually use the letter c to represent
</p>
<p>
    Dim c2 As Single 'the speed of light.
</p>
<p>
    c1 = 299792458 'Speed of light in meters per second to nine digits
</p>
<p>
    c2 = c1 + 16 'Add 16 to the speed of light
</p>
<p>
    If c1 = c2 Then 'These are equal because only the first seven
</p>
<p>
    Print "Equal" 'or eight digits are significant
</p>
<p>
    End If
</p>
<p>
    The code in adds 16 to the speed of light, but this does not change the value. This is because only the first seven
    or eight digits are significant. The code in uses a number that is smaller in magnitude but uses the same number of
    digits. Adding 1 to the number would change a significant digit, but adding a smaller number still leaves the
    numbers equal.
</p>
<p>
    <strong>Listing .</strong> Single-precision variables have only seven or eight digits of accuracy.
</p>
<p>
    Dim c1 As Single 'Scientists usually use the letter c to represent
</p>
<p>
    Dim c2 As Single 'the speed of light.
</p>
<p>
    c1 = 299.792458 'This is nine digits but it is not the speed of light
</p>
<p>
    c2 = c1 + .0000016 'Must add a smaller number for them to still be equal
</p>
<p>
    If c1 = c2 Then 'These are equal because only the first seven
</p>
<p>
    Print "Equal" 'or eight digits are significant
</p>
<p>
    End If
</p>
<p>
    Floating-point numbers can have different magnitudes<em><em> — </em></em>magnitude refers to the size of the
    number<em><em> — </em></em>and it doesn’t significantly affect the number of digits that are relevant. To check if
    two numbers are about the same value, large numbers can differ by a greater amount than small numbers. The greatest
    allowed difference is dependent upon the magnitude (size) of the numbers; a mathematician calls this the “relative
    error.” See .
</p>
<p>
    <strong>Listing .</strong> Compare two numbers.
</p>
<p>
    REM This uses n1 as the primary number of interest
</p>
<p>
    REM n2 is compared to n1 in a relative way
</p>
<p>
    REM rel_diff is the desired relative difference
</p>
<p>
    REM rel_diff is assumed non-negative
</p>
<p>
    Function AreSameNumber(n1, n2, rel_diff) As Boolean
</p>
<p>
    AreSameNumber = False 'Assume that they are different
</p>
<p>
    If n1 &lt;&gt; 0 Then 'Cannot divide by n1 if it is zero
</p>
<p>
    If ABS((n1-n2)/n1) &lt;= rel_diff Then 'Divide difference by n1 for relative
</p>
<p>
    AreSameNumber = True 'comparison.
</p>
<p>
    End If 'If n1, the number of interest, is
</p>
<p>
    ElseIf ABS(n2) &lt;= rel_diff Then 'zero, then compare n2 for size.
</p>
<p>
    AreSameNumber = True
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<p>
    The code in divides the difference of two numbers by one of the numbers. The code in checks numbers of different
    sizes to see if they are the same number.
</p>
<p>
    <strong>Listing .</strong> Test if same number.
</p>
<p>
    Sub CheckSameNumber
</p>
<p>
    Dim s1 As Single
</p>
<p>
    Dim s2 As Single
</p>
<p>
    Print AreSameNumber(299792458, 299790000, 1e-5) 'True: five digits same
</p>
<p>
    Print AreSameNumber(299792458, 299700000, 1e-5) 'False: four digits same
</p>
<p>
    s1 = 299792458 's1 assigned different value
</p>
<p>
    s2 = 299792448 'than s2 but same number.
</p>
<p>
    Print AreSameNumber(s1, s2, 0.0) 'True: Same number in single precision.
</p>
<p>
    Print AreSameNumber(299.792458, 299.790000, 1e-5)'True: five digits same
</p>
<p>
    Print AreSameNumber(2.99792458, 2.99700000, 1e-5)'False: four digits same
</p>
<p>
    End Sub
</p>
<p>
    A large quantity of literature and research is available on the negative issues associated with floating-point
    numbers. A complete discussion is therefore well beyond the scope of this book. In general usage, the problems
    typically aren’t that troublesome, but, when they arise, they can be most perplexing if you aren’t aware of the
    issues.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="mathematical-functions">
                    <span id="anchor-105"></span>Mathematical functions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The mathematical functions in OOo Basic take a numeric argument. All of the standard types are converted to a Double
    before they are used. Strings may include hexadecimal and octal numbers. The functions are the same as those
    available in Visual Basic (see ).
</p>
<p>
    <strong>Table .</strong> Mathematical functions supported by OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                ABS
            </td>
            <td>
                ABS
            </td>
            <td>
                Math.Abs
            </td>
            <td>
                The absolute value of a specified number.
            </td>
        </tr>
        <tr class="even">
            <td>
                Exp
            </td>
            <td>
                Exp
            </td>
            <td>
                Math.Exp
            </td>
            <td>
                The base of natural logarithms raised to a power.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Log
            </td>
            <td>
                Log
            </td>
            <td>
                Math.Log
            </td>
            <td>
                The logarithm of a number. In VB .NET you can overload this method to return either the natural (base e)
                logarithm or that of a specified base.
            </td>
        </tr>
        <tr class="even">
            <td>
                Sgn
            </td>
            <td>
                Sgn
            </td>
            <td>
                Math.Sign
            </td>
            <td>
                Integer value indicating the sign of a number.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Sqr
            </td>
            <td>
                Sqr
            </td>
            <td>
                Math.Sqrt
            </td>
            <td>
                The square root of a number.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the ABS function to determine the absolute value of a number, which you can think of as simply throwing away the
    leading + or - sign from the front of the number. The geometrical definition of ABS(x) is the distance from x to 0
    along a straight line.
</p>
<p>
    ABS(23.33) = 23.33
</p>
<p>
    ABS(-3) = 3
</p>
<p>
    ABS("-1") = 1 'Notice that the string value "-1" is converted to a Double
</p>
<p>
    Use the Sgn function to determine the sign of a number. An integer with the value -1, 0, or 1 is returned if the
    number is negative, zero, or positive.
</p>
<p>
    Sgn(-37.4) = -1
</p>
<p>
    Sgn(0) = 0
</p>
<p>
    Sgn("4") = 1
</p>
<p>
    The square root of 9 is 3, because 3 multiplied by 3 is 9. Use the Sqr function to get the square root of a number.
    The Sqr function can’t calculate the square root of a negative number<em><em> — </em></em>attempting to do so causes
    a run-time error.
</p>
<p>
    Sqr(100) = 10
</p>
<p>
    Sqr(16) = 4
</p>
<p>
    Sqr(2) = 1.414213562371
</p>
<p>
    Logarithms were devised by John Napier, who lived from 1550 through 1617. Napier devised logarithms to simplify
    arithmetic calculations, by substituting addition and subtraction for multiplication and division. Logarithms have
    the following properties:
</p>
<p>
    Log(x*y) = Log(x) + Log(y)
</p>
<p>
    Log(x/y) = Log(x) - Log(y)
</p>
<p>
    Log(x^y) = y * Log(x)
</p>
<p>
    The Exp function is the inverse of the Log function. For example, Exp(Log(4)) = 4 and Log(Exp(2)) = 2. By design,
    logarithms turn multiplication problems into addition problems. This allows the use of logarithms as they were
    originally designed.
</p>
<p>
    Print Exp(Log(12) + Log(3)) '36 = 12 * 3
</p>
<p>
    Print Exp(Log(12) - Log(3)) ' 4 = 12 / 3
</p>
<p>
    Logarithms are defined by the equation y=b^x. It is then said that the logarithm, base b, of y is x. For example,
    the logarithm base 10, 10^2 = 100 so the logarithm, base 10, of 100 is 2. The natural logarithm, with a base
    approximated by e=2.71828182845904523536, is frequently used because it has some nice mathematical properties. This
    is called the “natural logarithm” and is used in OOo Basic. Visual Basic .NET allows you to calculate logarithms of
    other bases. This is easily done using the formula that the logarithm base b is given by Log(x)/Log(b), regardless
    of the base of the logarithm that is used.
</p>
<p>
    Logarithms are not as useful as a general shortcut for calculations today, when lots of computing power is
    available. However, the logarithmic relationship describes the behavior of many natural phenomena. For example, the
    growth of populations is often described using logarithms, because geometric growth expressed on a logarithmic graph
    displays as a straight line. Exponentials and logarithms are also used extensively in engineering computations that
    describe the dynamic behavior of electrical, mechanical, and chemical systems.
</p>
<p>
    The macro in calculates the logarithm of the number x (first argument) to the specified base b (second argument).
    For example, use LogBase(8, 2) to calculate the log, base 2, of 8 (the answer is 3).
</p>
<p>
    <strong>Listing .</strong> LogBase.
</p>
<p>
    Function LogBase(x, b) As Double
</p>
<p>
    LogBase = Log(x) / Log(b)
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="numeric-conversions">
                    <span id="anchor-106"></span>Numeric conversions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic tries to convert arguments to an appropriate type before performing an operation. However, it is safer to
    explicitly convert data types using conversion functions, as presented in this chapter, than to rely on the default
    behavior, which may not be what you want. When an Integer argument is required and a floating-point number is
    provided, the default behavior is to round the number. For example, 16.8 MOD 7 rounds 16.8 to 17 before performing
    the operation. The Integer division operator, however, truncates the operands. For example, “Print 4 \ 0.999”
    truncates 0.999 to 0, causing a division-by-zero error.
</p>
<p>
    There are many different methods and functions to convert to numeric types. The primary conversion functions convert
    numbers represented as strings based on the computer’s locale. The conversion functions in convert any string or
    numeric expression to a number. String expressions containing hexadecimal or octal numbers must represent them using
    the standard OOo Basic notation. For example, the hexadecimal number 2A must be represented as “&amp;H2A”.
</p>
<p>
    <strong>Table .</strong> Convert to a numerical type.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CByte(expression)
            </td>
            <td>
                Byte
            </td>
            <td>
                Round the String or numeric expression to a Byte.
            </td>
        </tr>
        <tr class="even">
            <td>
                CCur(expression)
            </td>
            <td>
                Currency
            </td>
            <td>
                Convert the String or numeric expression to a Currency. The locale settings are used for decimal
                separators and currency symbols.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CDec(expression)
            </td>
            <td>
                Decimal
            </td>
            <td>
                Generate a Decimal type; implemented only on Windows.
            </td>
        </tr>
        <tr class="even">
            <td>
                CInt(expression)
            </td>
            <td>
                Integer
            </td>
            <td>
                Round the String or numeric expression to the nearest Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CLng(expression)
            </td>
            <td>
                Long
            </td>
            <td>
                Round the String or numeric expression to the nearest Long.
            </td>
        </tr>
        <tr class="even">
            <td>
                CDbl(expression)
            </td>
            <td>
                Double
            </td>
            <td>
                Convert a String or numeric expression to a Double.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CSng(expression)
            </td>
            <td>
                Single
            </td>
            <td>
                Convert a String or numeric expression to a Single.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The functions that return a whole number all have similar behavior. Numeric expressions are rounded rather than
    truncated. A string expression that does not contain a number evaluates to zero. Only the portion of the string that
    contains a number is evaluated, as shown in .
</p>
<p>
    <strong>Listing .</strong> CInt and CLng ignore non-numeric values.
</p>
<p>
    Print CInt(12.2) ' 12
</p>
<p>
    Print CLng("12.5") ' 13
</p>
<p>
    Print CInt("xxyy") ' 0
</p>
<p>
    Print CLng("12.1xx") ' 12
</p>
<p>
    Print CInt(-12.2) '-12
</p>
<p>
    Print CInt("-12.5") '-13
</p>
<p>
    Print CLng("-12.5xx") '-13
</p>
<p>
    CLng and CInt have similar, but not identical, behavior for different types of overflow conditions. Decimal numbers
    in strings that are too large cause a run-time error. For example, CInt("40000") and CLng("999999999999") cause a
    run-time error, but CLng("40000") does not. CLng never causes an overflow if a hexadecimal or octal number is too
    large; it silently returns zero without complaint. CInt, however, interprets hexadecimal and octal numbers as a Long
    and then converts them to an Integer. The result is that a valid Long generates a run-time error when it is
    converted to an Integer. A hexadecimal value that is too large to be valid returns zero with no complaints and then
    is cast to an Integer (see ).
</p>
<p>
    <strong>Listing .</strong> CInt interprets the number as a Long, then converts to an Integer.
</p>
<p>
    Print CLng("&amp;HFFFFFFFFFFE") '0 Overflow on a Long
</p>
<p>
    Print CInt("&amp;HFFFFFFFFFFE") '0 Overflow on a Long then convert to Integer
</p>
<p>
    Print CLng("&amp;HFFFFE") '1048574
</p>
<p>
    Print CInt("&amp;HFFFFE") 'Run-time error, convert to Long then overflow
</p>
<p>
    The code in converts numerous hexadecimal numbers to a Long using CLng. See for an explanation of the output in .
</p>
<p>
    <strong>Listing .</strong> ExampleCLngWithHex.
</p>
<p>
    Sub ExampleCLngWithHex
</p>
<p>
    On Error Resume Next
</p>
<p>
    Dim s$, i%
</p>
<p>
    Dim v()
</p>
<p>
    v() = Array("&amp;HF", "&amp;HFF", "&amp;HFFF", "&amp;HFFFF",_
</p>
<p>
    "&amp;HFFFFF", "&amp;HFFFFFF", "&amp;HFFFFFFF", "&amp;HFFFFFFFF",_
</p>
<p>
    "&amp;HFFFFFFFFF",_
</p>
<p>
    "&amp;HE", "&amp;HFE", "&amp;HFFE", "&amp;HFFFE",_
</p>
<p>
    "&amp;HFFFFE", "&amp;HFFFFFE", "&amp;HFFFFFFE", "&amp;HFFFFFFFE",_
</p>
<p>
    "&amp;HFFFFFFFFE")
</p>
<p>
    For i = LBound(v()) To UBound(v())
</p>
<p>
    s = s &amp; i &amp; " CLng(" &amp; v(i) &amp; ") = "
</p>
<p>
    s = s &amp; CLng(v(i))
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Output from with explanatory text.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                F
            </td>
            <td>
                15
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="even">
            <td>
                FF
            </td>
            <td>
                255
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFF
            </td>
            <td>
                4095
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFFF
            </td>
            <td>
                65535
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFFFF
            </td>
            <td>
                1048575
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFFFFF
            </td>
            <td>
                16777215
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFFFFFF
            </td>
            <td>
                268435455
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFFFFFFF
            </td>
            <td>
                ??
            </td>
            <td>
                Should return -1, but may cause a run time error on 64-bit versions.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFFFFFFFF
            </td>
            <td>
                0
            </td>
            <td>
                Overflow returns zero; this is nine hexadecimal digits.
            </td>
        </tr>
        <tr class="even">
            <td>
                E
            </td>
            <td>
                14
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FE
            </td>
            <td>
                254
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFE
            </td>
            <td>
                4094
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFFE
            </td>
            <td>
                65534
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFFFE
            </td>
            <td>
                1048574
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFFFFE
            </td>
            <td>
                16777214
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFFFFFE
            </td>
            <td>
                268435454
            </td>
            <td>
                Correct hexadecimal value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFFFFFFE
            </td>
            <td>
                ERROR
            </td>
            <td>
                Run time error, used to return -2.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFFFFFFFE
            </td>
            <td>
                0
            </td>
            <td>
                Overflow returns zero; this is nine hexadecimal digits.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When writing numbers, you don’t need to include leading zeros. For example, 3 and 003 are the same number. A Long
    Integer can contain eight hexadecimal digits. If only four digits are written, you can assume there are leading
    zeros. When the hexadecimal number is too large for a Long, a zero is returned. The negative numbers are just as
    easily explained. The computer’s internal binary representation of a negative number has the first bit set. The
    hexadecimal digits 8, 9, A, B, C, D, E, and F all have the high bit set when represented as a binary number. If the
    first hexadecimal digit has the high bit set, the returned Long is negative. A hexadecimal number is positive if it
    contains fewer than eight hexadecimal digits, and it is negative if it contains eight hexadecimal digits and the
    first digit is 8, 9, A, B, C, D, E, or F. Well, this used to be true.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                <p>
                    In 64-bit versions of OOo, CLng generate an error for negative numbers represented as Hexadecimal!
                    Hopefully this will be fixed. Here are two tests that I expect to print -1. Note: I last tested with
                    OOo version 3.3.0 and LO 4.0.1.2.
                </p>
                <p>
                    print &amp;HFFFFFFFF
                </p>
                <p>
                    print CLng("&amp;HFFFFFFFF") ' Generates an error
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    The CByte function has the same behavior as CInt and CLng, albeit with a few caveats. The return type, Byte, is
    interpreted as a character unless it is explicitly converted to a number. A Byte is a Short Integer that uses only
    eight bits rather than the 16 used by an Integer.
</p>
<p>
    Print CByte("65") 'A has ASCII value 65
</p>
<p>
    Print CInt(CByte("65xx")) '65 directly converted to a number.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                <p>
                    An integer in VB .NET is equivalent to an OOo Basic Long.
                </p>
                <p>
                    VB uses different rounding rules. Numbers are rounded to the nearest even number when the decimal
                    point is exactly 0.5; this is called IEEE rounding.
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    The functions that return a floating-point number all have similar behavior. Numeric expressions are converted to
    the closest representable value. Strings that contain non-numeric components generate a run-time error. For example,
    CDbl(“13.4e2xx”) causes a run-time error. CDbl and CSng both generate a run-time error for hexadecimal and octal
    numbers that are too large.
</p>
<p>
    <strong>Listing .</strong> CSng and CDbl handle string input.
</p>
<p>
    Print CDbl(12.2) ' 12.2
</p>
<p>
    Print CSng("12.55e1") ' 125.5
</p>
<p>
    Print CDbl("-12.2e-1")'-1.22
</p>
<p>
    Print CSng("-12.5") '-12.5
</p>
<p>
    Print CDbl("xxyy") ' run-time error
</p>
<p>
    Print CSng("12.1xx") ' run-time error
</p>
<p>
    The functions CDbl and CSng both fail for string input that contains non-numeric data; the Val function does not.
    Use the Val function to convert a string to a Double that may contain other characters. The Val function looks at
    each character in the string, ignoring spaces, tabs, and new lines, stopping at the first character that isn’t part
    of a number. Symbols and characters often considered to be parts of numeric values, such as dollar signs and commas,
    are not recognized. The function does, however, recognize octal and hexadecimal numbers prefixed by &amp;O (for
    octal) and &amp;H (for hexadecimal).
</p>
<p>
    The Val function treats spaces differently than other functions treat spaces; for example, Val(“ 12 34”) returns the
    number 1234; CDbl and CSng generate a run-time error, and CInt returns 12 for the same input.
</p>
<p>
    <strong>Listing .</strong> Treatment of spaces is different.
</p>
<p>
    Sub NumsAreDifferent
</p>
<p>
    On Error GoTo ErrorHandler:
</p>
<p>
    Dim s$
</p>
<p>
    s = "Val("" 12 34"") = "
</p>
<p>
    s = s &amp; Val(" 12 34")
</p>
<p>
    s = s &amp; CHR$(10) &amp; "CInt("" 12 34"") = "
</p>
<p>
    s = s &amp; CInt(" 12 34")
</p>
<p>
    s = s &amp; CHR$(10) &amp; "CLng("" 12 34"") = "
</p>
<p>
    s = s &amp; CLng(" 12 34")
</p>
<p>
    s = s &amp; CHR$(10) &amp; "CSng("" 12 34"") = "
</p>
<p>
    s = s &amp; CSng(" 12 34")
</p>
<p>
    s = s &amp; CHR$(10) &amp; "CDbl("" 12 34"") = "
</p>
<p>
    s = s &amp; CDbl(" 12 34")
</p>
<p>
    MsgBox s
</p>
<p>
    Exit Sub
</p>
<p>
    ErrorHandler:
</p>
<p>
    s = s &amp; " Error: " &amp; Error
</p>
<p>
    Resume Next
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The Val function does not use localization while converting a number so the only recognized decimal
                separator is the period; the comma can be used as a group separator but is not valid to the right of the
                decimal. Use CDbl or CLng to convert numbers based on the current locale. In case you forgot, the locale
                is another way to refer to the settings that affect formatting based on a specific country. See .
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> The Val function is the inverse of the Str function.
</p>
<p>
    Sub ExampleVal
</p>
<p>
    Print Val(" 12 34") '1234
</p>
<p>
    Print Val("12 + 34") '12
</p>
<p>
    Print Val("-1.23e4") '-12300
</p>
<p>
    Print Val(" &amp;FF") '0
</p>
<p>
    Print Val(" &amp;HFF") '255
</p>
<p>
    Print Val("&amp;HFFFF") '-1
</p>
<p>
    Print Val("&amp;HFFFE") '-2
</p>
<p>
    Print Val("&amp;H3FFFE") '-2, yes, it really converts this to -2
</p>
<p>
    Print Val("&amp;HFFFFFFFFFFFFF") '-1
</p>
<p>
    End Sub
</p>
<p>
    As of version 1.1.1, the behavior of the Val function while recognizing hexadecimal or octal numbers is strange
    enough that I call it a bug. Internally, hexadecimal and octal numbers are converted to a 32-bit Long Integer and
    then the least significant 16 bits are converted to an Integer. This explains why in the number H3FFFE is converted
    to -2, because only the least significant 16 bits are recognized <em><em>— </em></em>in case you forgot, this means
    the rightmost four hexadecimal digits. This strange behavior is demonstrated in . The output is explained in .
</p>
<p>
    <strong>Listing .</strong> ExampleValWithHex.
</p>
<p>
    Sub ExampleValWithHex
</p>
<p>
    Dim s$, i%
</p>
<p>
    Dim l As Long
</p>
<p>
    Dim v()
</p>
<p>
    v() = Array("&amp;HF", "&amp;HFF", "&amp;HFFF", "&amp;HFFFF",_
</p>
<p>
    "&amp;HFFFFF", "&amp;HFFFFFF", "&amp;HFFFFFFF", "&amp;HFFFFFFFF",_
</p>
<p>
    "&amp;HFFFFFFFFF",_
</p>
<p>
    "&amp;HE", "&amp;HFE", "&amp;HFFE", "&amp;HFFFE",_
</p>
<p>
    "&amp;HFFFFE", "&amp;HFFFFFE", "&amp;HFFFFFFE", "&amp;HFFFFFFFE",_
</p>
<p>
    "&amp;HFFFFFFFFE", "&amp;H111111111", "&amp;H1111")
</p>
<p>
    For i = LBound(v()) To UBound(v())
</p>
<p>
    s = s &amp; "Val(" &amp; v(i) &amp; ") = " &amp; Val(v(i)) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    'This worked in OOo 2.x, but, it
</p>
<p>
    ' fails in OOo 3.2.1
</p>
<p>
    'l = "&amp;H" &amp; Hex(-2)
</p>
<p>
    s = s &amp; CHR$(10) &amp; "Hex(-1) = " &amp; Hex(-1) &amp; CHR$(10)
</p>
<p>
    s = s &amp; "Hex(-2) = " &amp; Hex(-2) &amp; CHR$(10)
</p>
<p>
    's = s &amp; "l = &amp;H" &amp; Hex(-2) &amp; " ==&gt; " &amp; l &amp; CHR$(10)
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <strong>Table .</strong> Output from with explanatory text.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                F
            </td>
            <td>
                15
            </td>
            <td>
                Hexadecimal F is 15.
            </td>
        </tr>
        <tr class="even">
            <td>
                FF
            </td>
            <td>
                255
            </td>
            <td>
                Hexadecimal FF is 255.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFF
            </td>
            <td>
                4095
            </td>
            <td>
                Hexadecimal FFF is 4095.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFFF
            </td>
            <td>
                -1
            </td>
            <td>
                Hexadecimal FFFF is -1 for a 16-bit (two-byte) integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFFFF
            </td>
            <td>
                -1
            </td>
            <td>
                Only the rightmost two bytes (four characters) are recognized.
            </td>
        </tr>
        <tr class="even">
            <td>
                E
            </td>
            <td>
                14
            </td>
            <td>
                Hexadecimal E is 14.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FE
            </td>
            <td>
                254
            </td>
            <td>
                Hexadecimal FE is 254.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFE
            </td>
            <td>
                4094
            </td>
            <td>
                Hexadecimal FFE is 4094.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFFE
            </td>
            <td>
                -2
            </td>
            <td>
                Hexadecimal FFFE is -2 for a 16-bit (two-byte) integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFFFE
            </td>
            <td>
                -2
            </td>
            <td>
                Only the rightmost two bytes are recognized.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFFFFE
            </td>
            <td>
                -2
            </td>
            <td>
                Only the rightmost two bytes are recognized.
            </td>
        </tr>
        <tr class="even">
            <td>
                FFFFFFE
            </td>
            <td>
                -2
            </td>
            <td>
                Only the rightmost two bytes are recognized.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FFFFFFFE
            </td>
            <td>
                -2
            </td>
            <td>
                Only the rightmost two bytes are recognized.
            </td>
        </tr>
        <tr class="even">
            <td>
                HFFFFFFFFE
            </td>
            <td>
                -2
            </td>
            <td>
                Only the rightmost two bytes are recognized.
            </td>
        </tr>
        <tr class="odd">
            <td>
                111111111
            </td>
            <td>
                4639
            </td>
            <td>
                Correct value, right most two bytes only.
            </td>
        </tr>
        <tr class="even">
            <td>
                1111
            </td>
            <td>
                4639
            </td>
            <td>
                Correct value
            </td>
        </tr>
    </tbody>
</table>
<p>
    Val converts hexadecimal numbers, but, it only uses the rightmost two bytes.
</p>
<p>
    Use the functions CByte, CInt, CLng, CSng, and CDbl to convert a number, string, or expression to a specific numeric
    type. Use the functions Int and Fix to remove the decimal portion and return a Double. A string expression that does
    not contain a number evaluates to zero. Only the portion of the string that contains a number is evaluated. See .
</p>
<p>
    <strong>Table .</strong> Remove the decimal portion of a floating-point number.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Int
            </td>
            <td>
                Double
            </td>
            <td>
                Round the number toward negative infinity.
            </td>
        </tr>
        <tr class="even">
            <td>
                Fix
            </td>
            <td>
                Double
            </td>
            <td>
                Chop off the decimal portion.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The functions Int and Fix differ only in their treatment of negative numbers. Fix always discards the decimal, which
    is equivalent to rounding toward zero. Int, on the other hand, rounds toward negative infinity. In other words,
    “Int(12.3)” is 12 and “Int(-12.3)” is -13.
</p>
<p>
    Print Int(12.2) ' 12
</p>
<p>
    Print Fix(12.2) ' 12
</p>
<p>
    Print Int("12.5") ' 12
</p>
<p>
    Print Fix("12.5") ' 12
</p>
<p>
    Print Int("xxyy") ' 0
</p>
<p>
    Print Fix("xxyy") ' 0
</p>
<p>
    Print Int(-12.4) '-13
</p>
<p>
    Print Fix(-12.4) '-12
</p>
<p>
    Print Fix("-12.1xx")'-12
</p>
<p>
    Print Int("-12.1xx")'-13
</p>
<p>
    The CCur function converts a numerical expression to a currency object. Visual Basic .NET removed support for the
    CCur function as well as the Currency data type. OOo Basic still supports the Currency data type.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="number-to-string-conversions">
                    <span id="anchor-107"></span>Number to string conversions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    String conversion functions, shown in , change non-string data into strings. In OOo, text is stored as Unicode
    version 2.0 values, providing good support for multiple languages. Each String variable can hold up to 65,535
    characters.
</p>
<p>
    <strong>Table .</strong> String conversion functions.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Str
            </td>
            <td>
                Convert from a number to a String with no localization.
            </td>
        </tr>
        <tr class="even">
            <td>
                CStr
            </td>
            <td>
                Convert anything to a String. Numbers and dates are formatted based on locale.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Hex
            </td>
            <td>
                Return the hexadecimal representation of a number as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                Oct
            </td>
            <td>
                Return the octal representation of a number as a String.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="simple-formatting">
                    <span id="anchor-108"></span>Simple formatting
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the CStr function to generally convert any type to a String. The returned value is dependent upon the input data
    type. Boolean values convert to the text “True” or “False.” Dates convert to the short date format used by the
    system. Numbers are converted to a string representation of the number. See .
</p>
<p>
    <strong>Listing .</strong> Output from CStr is locale specific; this is English (USA).
</p>
<p>
    Dim n As Long, d As Double, b As Boolean
</p>
<p>
    n = 999999999 : d = EXP(1.0) : b = False
</p>
<p>
    Print "X" &amp; CStr(b) 'XFalse
</p>
<p>
    Print "X" &amp; CStr(n) 'X999999999
</p>
<p>
    Print "X" &amp; CStr(d) 'X2.71828182845904
</p>
<p>
    Print "X" &amp; CStr(Now)'X06/09/2010 20:24:24 (almost exactly 7 years after 1<sup>st</sup> edition)
</p>
<p>
    The CStr function performs simple number formatting with knowledge of the current locale. Simple conversion of a
    number to a string is done with Str. Although the Str function is designed to deal specifically with numeric values,
    the output is very similar to CStr. When the Str function converts a number to a string, a leading space is always
    included for the sign of the number. A negative number includes the minus sign, and no leading empty space is
    present. A non-negative number, on the other hand, includes a leading empty space. The output of Str is not locale
    specific; a period is always used as the decimal separator. See .
</p>
<p>
    <strong>Listing .</strong> Output from Str is not dependent upon locale.
</p>
<p>
    Dim n As Long, d As Double, b As Boolean
</p>
<p>
    n = 999999999 : d = EXP(1.0) : b = False
</p>
<p>
    Print "X" &amp; Str(b) 'XFalse
</p>
<p>
    Print "X" &amp; Str(n) 'X 999999999
</p>
<p>
    Print "X" &amp; Str(d) 'X 2.71828182845904
</p>
<p>
    Print "X" &amp; Str(Now)'X06/09/2010 20:28:48 (almost exactly 7 years after 1<sup>st</sup> edition)
</p>
<p>
    The output from the code in and is the same except for a leading space in front of the non-negative numbers. If you
    run the code using a different locale, such as Germany, the output changes for but not .
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                There is little reason to use Str rather than CStr. Str may run a bit faster, but CStr knows about your
                current locale.
            </td>
        </tr>
    </tbody>
</table>
<p>
    To demonstrate that CStr is locale specific, I changed my locale to German (Germany) and then ran the code in again.
    shows that the decimal is now expressed as a comma and that the date is now expressed as MM.DD.YYYY.
</p>
<p>
    <strong>Listing .</strong> Output from CStr is locale specific; this is German (Germany).
</p>
<p>
    Dim n As Long, d As Double, b As Boolean
</p>
<p>
    n = 999999999 : d = EXP(1.0) : b = False
</p>
<p>
    Print "X" &amp; CStr(b) 'XFalse
</p>
<p>
    Print "X" &amp; CStr(n) 'X999999999
</p>
<p>
    Print "X" &amp; CStr(d) 'X2,71828182845904
</p>
<p>
    Print "X" &amp; CStr(Now)'X14.08.2010 20:39:49
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="other-number-bases-hexadecimal-octal-and-binary">
                    <span id="anchor-109"></span>Other number bases, hexadecimal, octal, and binary
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic provides the functions Hex and Oct to convert a number to hexadecimal and octal. No native support is
    provided for a conversion to and from binary. You can’t directly use the output from Hex and Oct to convert the
    string back to a number because it is missing the leading “&amp;H” and “&amp;O”.
</p>
<p>
    Print Hex(447) '1BF
</p>
<p>
    Print CInt("&amp;H" &amp; Hex(747)) '747
</p>
<p>
    Print Oct(877) '1555
</p>
<p>
    Print CInt("&amp;O" &amp; Oct(213)) '213
</p>
<p>
    The source code for Chapter 2 contains the function IntToBinaryString, which converts an integer to a binary number
    in the Operators module in the source code file SC02.sxw. The function is very flexible but it isn’t particularly
    fast. A faster routine using the Hex function is shown in .
</p>
<p>
    <strong>Listing .</strong> IntToBinaryString.
</p>
<p>
    Function IntToBinaryString(ByVal x As Long) As String
</p>
<p>
    Dim sHex As String
</p>
<p>
    Dim sBin As String
</p>
<p>
    Dim i As Integer
</p>
<p>
    sHex = Hex(x)
</p>
<p>
    For i=1 To Len(sHex)
</p>
<p>
    Select Case Mid(sHex, i, 1)
</p>
<p>
    Case "0"
</p>
<p>
    sBin = sBin &amp; "0000"
</p>
<p>
    Case "1"
</p>
<p>
    sBin = sBin &amp; "0001"
</p>
<p>
    Case "2"
</p>
<p>
    sBin = sBin &amp; "0010"
</p>
<p>
    Case "3"
</p>
<p>
    sBin = sBin &amp; "0011"
</p>
<p>
    Case "4"
</p>
<p>
    sBin = sBin &amp; "0100"
</p>
<p>
    Case "5"
</p>
<p>
    sBin = sBin &amp; "0101"
</p>
<p>
    Case "6"
</p>
<p>
    sBin = sBin &amp; "0110"
</p>
<p>
    Case "7"
</p>
<p>
    sBin = sBin &amp; "0111"
</p>
<p>
    Case "8"
</p>
<p>
    sBin = sBin &amp; "1000"
</p>
<p>
    Case "9"
</p>
<p>
    sBin = sBin &amp; "1001"
</p>
<p>
    Case "A"
</p>
<p>
    sBin = sBin &amp; "1010"
</p>
<p>
    Case "B"
</p>
<p>
    sBin = sBin &amp; "1011"
</p>
<p>
    Case "C"
</p>
<p>
    sBin = sBin &amp; "1100"
</p>
<p>
    Case "D"
</p>
<p>
    sBin = sBin &amp; "1101"
</p>
<p>
    Case "E"
</p>
<p>
    sBin = sBin &amp; "1110"
</p>
<p>
    Case "F"
</p>
<p>
    sBin = sBin &amp; "1111"
</p>
<p>
    End Select
</p>
<p>
    Next
</p>
<p>
    IntToBinaryString = sBin
</p>
<p>
    End Function
</p>
<p>
    The code in may be long, but it’s very simple. There is a correlation between hexadecimal digits and binary digits;
    each hexadecimal digit is composed of four binary digits. This relationship does not exist for base 10 numbers. The
    number is converted to a hexadecimal number using the Hex function. Each hexadecimal digit is converted to the
    corresponding binary digits. To convert a binary number in String form back to an Integer, use the code in .
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                This routine fails with negative numbers because CLng() OOo 3.3.0 fails with Hex numbers representing
                negative long values.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> BinaryStringToLong.
</p>
<p>
    Function BinaryStringToLong(s$) As Long
</p>
<p>
    Dim sHex As String
</p>
<p>
    Dim sBin As String
</p>
<p>
    Dim i As Integer
</p>
<p>
    Dim nLeftOver As Integer
</p>
<p>
    Dim n As Integer
</p>
<p>
</p>
<p>
    n = Len(s$)
</p>
<p>
    nLeftOver = n MOD 4
</p>
<p>
    If nLeftOver &gt; 0 Then
</p>
<p>
    sHex = SmallBinToHex(Left(s$, nLeftOver))
</p>
<p>
    End If
</p>
<p>
    For i=nLeftOver + 1 To n Step 4
</p>
<p>
    sHex = sHex &amp; SmallBinToHex(Mid(s$, i, 4))
</p>
<p>
    Next
</p>
<p>
    BinaryStringToLong = CLng("&amp;H" &amp; sHex)
</p>
<p>
    End Function
</p>
<p>
    Function SmallBinToHex(s$) As String
</p>
<p>
    If Len(s$) &lt; 4 Then s$ = String(4-Len(s$), "0") &amp; s$
</p>
<p>
    Select Case s$
</p>
<p>
    Case "0000"
</p>
<p>
    SmallBinToHex = "0"
</p>
<p>
    Case "0001"
</p>
<p>
    SmallBinToHex = "1"
</p>
<p>
    Case "0010"
</p>
<p>
    SmallBinToHex = "2"
</p>
<p>
    Case "0011"
</p>
<p>
    SmallBinToHex = "3"
</p>
<p>
    Case "0100"
</p>
<p>
    SmallBinToHex = "4"
</p>
<p>
    Case "0101"
</p>
<p>
    SmallBinToHex = "5"
</p>
<p>
    Case "0110"
</p>
<p>
    SmallBinToHex = "6"
</p>
<p>
    Case "0111"
</p>
<p>
    SmallBinToHex = "7"
</p>
<p>
    Case "1000"
</p>
<p>
    SmallBinToHex = "8"
</p>
<p>
    Case "1001"
</p>
<p>
    SmallBinToHex = "9"
</p>
<p>
    Case "1010"
</p>
<p>
    SmallBinToHex = "A"
</p>
<p>
    Case "1011"
</p>
<p>
    SmallBinToHex = "B"
</p>
<p>
    Case "1100"
</p>
<p>
    SmallBinToHex = "C"
</p>
<p>
    Case "1101"
</p>
<p>
    SmallBinToHex = "D"
</p>
<p>
    Case "1110"
</p>
<p>
    SmallBinToHex = "E"
</p>
<p>
    Case "1111"
</p>
<p>
    SmallBinToHex = "F"
</p>
<p>
    End Select
</p>
<p>
    End Function
</p>
<p>
    To convert a binary string to an Integer, the number is first converted to a hexadecimal number. A set of four
    binary digits correspond to a single hexadecimal digit. The number is padded on the left with zeros so that the
    string can be broken up into blocks of four binary digits. Each block of four binary digits is converted to a single
    hexadecimal digit. The CLng function is then used to convert the hexadecimal number to decimal form. The routine in
    demonstrates the use of these functions; also see .
</p>
<p>
    <strong>Listing .</strong> ExampleWholeNumberConversions.
</p>
<p>
    Sub ExampleWholeNumberConversions
</p>
<p>
    Dim s As String
</p>
<p>
    Dim n As Long
</p>
<p>
    Dim nAsHex$, nAsOct$, nAsBin$
</p>
<p>
    s = InputBox("Number to convert:", "Long To Other", "1389")
</p>
<p>
    If IsNull(s) Then Exit Sub
</p>
<p>
    If Len(Trim(s)) = 0 Then Exit Sub
</p>
<p>
    n = CLng(Trim(s)) 'Trim removes leading and trailing spaces
</p>
<p>
    nAsHex = Hex(n)
</p>
<p>
    nAsOct = Oct(n)
</p>
<p>
    nAsBin = IntToBinaryString(n)
</p>
<p>
    s = "Original number = " &amp; CStr(n) &amp; CHR$(10) &amp;_
</p>
<p>
    "Hex(" &amp; CStr(n) &amp; ") = " &amp; nAsHex &amp; CHR$(10) &amp;_
</p>
<p>
    "Oct(" &amp; CStr(n) &amp; ") = " &amp; nAsOct &amp; CHR$(10) &amp;_
</p>
<p>
    "Binary(" &amp; CStr(n) &amp; ") = " &amp; nAsBin &amp;_
</p>
<p>
    " ==&gt; " &amp; BinaryStringToLong(nAsBin)
</p>
<p>
    MsgBox(s, 0, "Whole Number Conversions")
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000042F0000023BED56B6B0.png" style="width:2.4925in;height:1.2311in" />
</p>
<p>
    <strong>Figure .</strong> Convert a whole number to hexadecimal, octal, and binary.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="random-numbers">
                    <span id="anchor-110"></span>Random numbers
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic generates floating-point random numbers ranging from 0 through 1. Random numbers generated by computers
    aren’t, in general, random. An algorithm is used that generates “random numbers” based on a previous random number.
    The first number on which all other random numbers are based is called the “seed.” You use the Randomize function to
    specify the seed value. If a value is omitted, the Randomize function uses a value obtained from the system timer.
    Specifying the starting seed allows you to test programs and generate the same sequence of random numbers each time.
</p>
<p>
    The Rnd function is used to generate the random numbers between 0 and 1. The OOo help claims that the Rnd function
    accepts an argument; I checked the source code for the Rnd function, which has not changed from version 1.x through
    3.2.1, and the argument is ignored.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The included help files incorrectly claim that the Rnd function accepts an argument that affects the
                behavior. The argument is, and always has been, ignored.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Print Rnd() 'Some number from 0 through 1
</p>
<p>
    Print Rnd() 'Another number from 0 through 1
</p>
<p>
    The random number generated is some number from 0 through 1. To obtain a different range, perform a few mathematical
    operations. For example, multiplying a number between 0 and 1 by 10 yields a number between 0 and 10. To use a range
    that does not start at 0, add an appropriate offset. See .
</p>
<p>
    <strong>Listing .</strong> Return a random number in a range.
</p>
<p>
    Function RndRange(lowerBound As Double, upperBound As Double) As Double
</p>
<p>
    RndRange = lowerBound + Rnd() * (upperBound - lowerBound)
</p>
<p>
    End Function
</p>
<p>
    Use an appropriate function, such as CInt or CLng, if you want a whole number rather than a floating-point number.
</p>
<p>
    CLng(lowerBound + Rnd() * (upperBound - lowerBound))
</p>
<p>
    I had two functions that solved the same problem<em><em> — </em></em>determining the GCD (Greatest Common Divisor)
    of two integers<em><em> — </em></em>and I wanted to know which was faster. I generated random integers and called
    each routine a few thousand times. While performing timing tests, it’s important to use the same data for each
    trial. I was able to use random numbers because the Randomize statement allows me to generate the same random
    numbers every time.
</p>
<p>
    Randomize(2) 'reset the random number generator to a known state
</p>
<p>
    t1 = getSystemTicks()
</p>
<p>
    For i = 0 To 30000
</p>
<p>
    n1 = CLng(10000 * Rnd())
</p>
<p>
    n2 = CLng(10000 * Rnd())
</p>
<p>
    call gcd1(n1, n2)
</p>
<p>
    Next
</p>
<p>
    total_time_1 = getSystemTicks() - t1
</p>
<p>
    Randomize(2) 'reset the random number generator to a known state
</p>
<p>
    t1 = getSystemTicks()
</p>
<p>
    For i = 0 To 30000
</p>
<p>
    n1 = CLng(10000 * Rnd())
</p>
<p>
    n2 = CLng(10000 * Rnd())
</p>
<p>
    call gcd2(n1, n2)
</p>
<p>
    Next
</p>
<p>
    total_time_2 = getSystemTicks() - t1
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-2">
                    <span id="anchor-111"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The standard mathematical functions in OpenOffice.org Basic contain few surprises. The conversion functions work
    well, with some idiosyncrasies while converting strings to numbers. Be certain to choose a function that can handle
    the format and the ranges used. Rounding is another issue that requires special attention. Although the rounding
    behavior is documented and consistent, different functions and operators cause rounding to occur differently.
</p>
<ol type="1">
    <li>
        <h1 id="array-routines">
            <span id="anchor-112"></span>Array Routines
        </h1>
    </li>
</ol>
<p>
    This chapter introduces the subroutines and functions supported by OOo Basic that are used to manipulate arrays. It
    covers methods for manipulating arrays, creating arrays with data, creating arrays with no data, and changing the
    dimension of arrays. This chapter also presents methods to inspect array variables.
</p>
<p>
    An array is a data structure in which similar elements of data are arranged in an indexed structure — for example, a
    column of names or a table of numbers. OOo Basic has subroutines and functions that change array dimensions, inspect
    existing arrays, and convert between arrays and scalar (non-array) data types.
</p>
<p>
    The majority of the routines listed in require an array variable as the first argument. Array variables used as
    arguments to routines can be written with trailing parentheses. Parentheses after the variable are optional, but
    they used to be required (see ).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                There is no way to determine if a() refers to an array or a function while reading code; you must find
                where the item in question is declared.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Parentheses are not always required but are always allowed.
</p>
<p>
    Sub AreArrayParensRequired
</p>
<p>
    Dim a(1 To 2) 'a() is declared with specified dimensions
</p>
<p>
    Dim b() 'b() is declared as an array without specified dimensions
</p>
<p>
    Dim c 'c is a variant and may reference an array.
</p>
<p>
    c = Array(1, 2) 'c references a Variant array
</p>
<p>
    Print IsArray(a()) 'True
</p>
<p>
    Print IsArray(b()) 'True
</p>
<p>
    Print IsArray(c()) 'True
</p>
<p>
    Print IsArray(a) 'True
</p>
<p>
    Print IsArray(b) 'True
</p>
<p>
    Print IsArray(c) 'True
</p>
<p>
    End Sub
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Summary of subroutines and functions
    related to arrays.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Array(args)
            </td>
            <td>
                Return a Variant array that contains the arguments.
            </td>
        </tr>
        <tr class="even">
            <td>
                DimArray(args)
            </td>
            <td>
                Return an empty Variant array. The arguments specify the dimension(s).
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsArray(var)
            </td>
            <td>
                Return True if this variable is an array, False otherwise.
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    Join(array)
                </p>
                <p>
                    Join(array, delimiter)
                </p>
            </td>
            <td>
                Concatenate the array elements separated by the optional string delimiter and return as a String. The
                default delimiter is a single space.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    LBound(array)
                </p>
                <p>
                    LBound(array, dimension)
                </p>
            </td>
            <td>
                Return the lower bound of the array argument. The optional dimension specifies which dimension to check.
                The first dimension is 1.
            </td>
        </tr>
        <tr class="even">
            <td>
                ReDim [Preserve] var(args) [As Type]
            </td>
            <td>
                Change the dimension of an array using the same syntax as the DIM statement. The keyword Preserve keeps
                existing data intact. “As Type” is optional.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    Split(str)
                </p>
                <p>
                    Split(str, delimiter)
                </p>
                <p>
                    Split(str, delimiter, n)
                </p>
            </td>
            <td>
                Split the string argument into an array of strings. The default delimiter is a space. The optional
                argument n limits the number of strings returned.
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    UBound(array)
                </p>
                <p>
                    UBound(array, dimension)
                </p>
            </td>
            <td>
                Return the upper bound of the array argument. The optional dimension specifies which dimension to check.
                The first dimension is 1.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The word “dimension” is used to refer to arrays similarly to the way that “dimensions” is used to refer to spatial
    dimensions. For example, an array with one dimension is like a line; you can set boxes along the line that represent
    data. An array with two dimensions is like a grid with rows and columns of data.
</p>
<p>
    Dim a(3) As Integer 'One-dimensional array
</p>
<p>
    Dim b(3 To 5) As String 'One-dimensional array
</p>
<p>
    Dim c(5, 4) As Integer 'Two-dimensional array
</p>
<p>
    Dim d(1 To 5, 4) As Integer 'Two-dimensional array
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="array-quickly-builds-a-one-dimensional-array-with-data">
                    <span id="anchor-113"></span>Array() quickly builds a one-dimensional array with data
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the Array function to quickly build a Variant array with data. The Array function returns a Variant array that
    contains the arguments to the function. See . This is an efficient method to create a Variant array containing a
    predefined set of values. One entry in the array is created for each argument.
</p>
<p>
    Use the Array function to quickly generate an array that already has data. The following code creates an array with
    five elements, zero through four, and then individually initializes each element.
</p>
<p>
    Dim v(4)
</p>
<p>
    v(0) = 2 : v(1) = "help": v(2) = Now : v(3) = True : v(4) = 3.5
</p>
<p>
    This can be done in a much simpler manner. Constants can be used as arguments to functions. You aren’t always forced
    to assign a value to a variable so that you can call a function.
</p>
<p>
    Dim v()
</p>
<p>
    Dim FirstName$ : FirstName = "Bob"
</p>
<p>
    v() = Array(0, "help", Now, True, 3.5)
</p>
<p>
    Print Join(Array("help", 3, "Joe", Firstname))
</p>
<p>
    The argument list is a comma-separated list of expressions, which can be of any type because each element in the
    returned array is a variant.
</p>
<p>
    <strong>Listing .</strong> The Array function returns a Variant array.
</p>
<p>
    Dim vFirstNames 'A Variant can reference an array
</p>
<p>
    Dim vAges() 'A Variant array can reference an array
</p>
<p>
    vFirstNames = Array("Tom", "Rob") 'Array contains strings
</p>
<p>
    vAges = Array(18, "Ten") 'Array contains a number and a string
</p>
<p>
    Print vAges(0) 'First element has the value 18
</p>
<p>
    Variant variables can contain any type, including an array. I frequently use variant variables when I retrieve
    values from methods when I’m not certain of the return type. I then inspect the type and use it appropriately. This
    is a convenient use of the Variant variable type. Because a Variant variable can contain any type<em><em> —
        </em></em>including an array<em><em> — </em></em>each element in a Variant array can also contain an array. The
    code in demonstrates placing an array inside another array. The code in each column is roughly equivalent.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Although user defined structures cannot contain arrays, they can contain a variant, which can contain an
                array.
            </td>
        </tr>
    </tbody>
</table>
<p>
    One advantage of Variant arrays is that it’s possible to easily build collections of information of different types.
    For example, the item description (String), stock-tracking ID (Integer), and invoice amount (Double or Currency) can
    readily be stored as rows in an array, with each type of data stored in a single row for each customer. This allows
    array rows to behave more like rows in a database. Older programming languages required use of separately declared
    arrays for each data type, with added programming overhead of managing the use of multiple, related arrays of data.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> A Variant can contain an array, so these
    accomplish the same thing.
</p>
<table border="1">
    <tbody> </tbody>
</table>
<p>
    In OOo version 1.x, to address an array containing an array, you had to first extract the contained array, and then
    subscript the contained array. Much of my existing code was written based on this.
</p>
<p>
    <strong>Listing .</strong> Cumbersome method to subscript an array in an array.
</p>
<p>
    v = Array(Array(1, 2, 3), Array("one", "two", "three"))
</p>
<p>
    x = v(0) 'This is very cumbersome.
</p>
<p>
    Print x(1) 'Prints 2
</p>
<p>
    Somewhere between version 2.x and 3.x, the obvious solution was introduced; you can directly access the contained
    array. This is particularly useful while using data arrays returned by Calc containing cell data.
</p>
<p>
    <strong>Listing .</strong> In OOo 3.x, you no longer need to extract the contained array to use it.
</p>
<p>
    Sub ArrayInArray
</p>
<p>
    Dim v() : v = Array(Array(1, 2, 3), Array("one", "two", "three"))
</p>
<p>
    Print v(0)(1)
</p>
<p>
    End Sub
</p>
<p>
    Although it’s easy to create an array inside of an array, it’s typically easier to use an array with multiple
    dimensions, as shown in . The “array of arrays” construction is sometimes useful, if there is an obvious
    relationship with the natural organization of the data. Generally, it is best to select a way to organize the data
    that has the most direct, natural, and memorable relationship to how it is produced, used, and manipulated.
</p>
<p>
    <strong>Listing .</strong> It is easier to use multi-dimensioned arrays than arrays inside of arrays.
</p>
<p>
    Dim v(0 To 1, 0 To 2)
</p>
<p>
    v(0, 0) = 1 : v(0, 1) = 2 : v(0, 2) = 3
</p>
<p>
    v(1, 0) = "one" : v(1, 1) = "two" : v(1, 2) = "three"
</p>
<p>
    Print v(0, 1) 'prints 2
</p>
<p>
    A Variant array can be assigned to any other array, regardless of its declared type. Assigning one array to another
    causes one array to reference the other; they become the same array. As mentioned earlier, this is a bad idea. This
    is considered a bug and it may not be allowed in later versions of OOo Basic. Use the Array function and enjoy the
    flexibility, but assign the returned Variant array to either a Variant or a Variant array.
</p>
<p>
    <strong>Listing .</strong> Assign an string array to an integer array.
</p>
<p>
    Sub BadArrayTypes
</p>
<p>
    Dim a(0 To 1) As Integer
</p>
<p>
    Dim b(0 To 1) As String
</p>
<p>
    b(0) = "zero": b(1) = "one"
</p>
<p>
    a() = b()
</p>
<p>
    Print a(0)
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                <p>
                    Assigning a Variant array to variables declared as a non-Variant array is ill-advised. For example,
                    after an Integer array has been assigned to reference a Variant array, it’s possible to assign
                    non-integer values to elements in the array. References to the array won’t return the expected
                    values due to the mismatch between Integer and Variant data types.
                </p>
                <p>
                    Dim a(0 To 4) As Integer ' Create an array of Integers.
                </p>
                <p>
                    a(2) = "Tom" ' Assign a string to an Integer variable.
                </p>
                <p>
                    Print a(2) ' 0, because the string is converted to zero.
                </p>
                <p>
                    a() = Array(4, "Bob", 7) ' Array always returns a variant array.
                </p>
                <p>
                    a(2) = "Tom" ' a() is now a variant.
                </p>
                <p>
                    Print a(2) ' Tom
                </p>
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="dimarray-creates-empty-multi-dimensional-arrays">
                    <span id="anchor-114"></span>DimArray creates empty multi-dimensional arrays
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The DimArray function creates and returns a dimensioned Variant array. This allows the dimensions of the array to be
    determined at run time. The arguments specify the dimensions of the array; each argument specifies one dimension. If
    no arguments are present, an empty array is created.
</p>
<p>
    The primary use of the DimArray statement is to create an empty, dimensioned Variant array. If you know the size of
    the array that you will need, you can declare it when you declare the variable. If you don’t know the size, and if a
    Variant array is acceptable, then you can create the empty, dimensioned array at run time.
</p>
<p>
    <strong>Listing .</strong> DimArray returns a dimensioned Variant array that contains no data.
</p>
<p>
    i% = 7
</p>
<p>
    v = DimArray(3*i%) 'Same as Dim v(0 To 21)
</p>
<p>
    v = DimArray(i%, 4) 'Same as Dim v(0 To 7, 0 To 4)
</p>
<p>
    The code in does not show how the variable v is declared. This works equally well if v is declared as a Variant, or
    a Variant array. The argument list is a comma-separated list of expressions. Each expression is rounded to an
    integer and used to set the range of one dimension of the returned array.
</p>
<p>
    Dim a As Variant
</p>
<p>
    Dim v()
</p>
<p>
    Dim i As Integer
</p>
<p>
    i = 2
</p>
<p>
    a = DimArray(3) 'Same as Dim a(0 To 3)
</p>
<p>
    a = DimArray(1+i, 2*i) 'Same as Dim a(0 To 3, 0 To 4)
</p>
<p>
    v() = DimArray(1) 'Same as Dim v(0 To 1)
</p>
<p>
    v(0) = Array(1, 2, 3) 'Oh no, not this again!
</p>
<p>
    v(1) = Array("one", "two", "three") 'You can do it, but yuck!
</p>
<p>
    v = DimArray(1, 2) 'Now that makes more sense!
</p>
<p>
    v(0, 0) = 1 : v(0, 1) = 2 : v(0, 2) = 3
</p>
<p>
    v(1, 0) = "one" : v(1, 1) = "two" : v(1, 2) = "three"
</p>
<p>
    Print v(0, 1) 'prints 2
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Option Base 1 has no effect on the dimensions of the array returned by the DimArray function. For each
                dimension, the lower bound of the range is always zero and the upper bound is the rounded integer value
                of the relevant expression.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="change-the-dimension-of-an-array">
                    <span id="anchor-115"></span>Change the dimension of an array
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use ReDim to change the dimensions of an existing array by using the same syntax as the DIM statement. Increasing
    the dimension of an array while using the keyword Preserve preserves all of the data, but decreasing the dimension
    causes data to be lost by truncation. Unlike some variants of BASIC, OOo Basic allows all dimensions of an array to
    be changed while also preserving data.
</p>
<p>
    The primary use of the ReDim statement is to change the dimension of an existing array. If you know the size of the
    array that you will need, you can declare it when you declare the variable. If you don’t know the size ahead of
    time, you can declare the array with any size, including as an empty array, and then change the dimension when you
    know it.
</p>
<p>
    Dim v() As Integer
</p>
<p>
    Dim x(4) As Integer
</p>
<p>
    i% = 7
</p>
<p>
    ReDim v(3*i%) As Integer 'Same as Dim v(0 To 21) As Integer.
</p>
<p>
    ReDim x(i%, 1 To 4) As Integer 'Same as Dim x(0 To 7, 1 To 4).
</p>
<p>
    The ReDim statement changes the dimension of an existing array, even an empty one. ReDim specifies both the
    dimensions and the type. The type specified with the ReDim statement must match the type specified when the variable
    is declared. If the types differ, you’ll see the compile-time error “Variable already defined.”
</p>
<p>
    Dim a() As Integer 'Empty Integer Array.
</p>
<p>
    Dim v(8) 'Variant array with nine entries.
</p>
<p>
    ReDim v() 'v() is a valid empty array.
</p>
<p>
    ReDim a(2 To 4, 5) As Integer 'a() is a two-dimensional array.
</p>
<p>
    The DimArray function creates and returns a dimensioned Variant array that contains no data. This is not useful if
    you require an array of a specific type, or if you simply need to change the dimensions of an existing array while
    preserving data. The ReDim statement changes the dimensions of an existing array with the option of preserving
    existing data. You can use the ReDim statement to change a dimensioned array to an empty array.
</p>
<p>
    The subroutine in contains many examples of the ReDim statement using the keyword Preserve. shows the results of
    these commands.
</p>
<p>
    <strong>Listing .</strong> Use ReDim with Preserve to change dimension and preserve data.
</p>
<p>
    Sub ExampleReDimPreserve
</p>
<p>
    Dim a(5) As Integer 'A dimensioned array, 0 To 5
</p>
<p>
    Dim b() 'An empty array of type Variant
</p>
<p>
    Dim c() As Integer 'An empty array of type Integer
</p>
<p>
    Dim s$ 'The string that accumulates the output text
</p>
<p>
    REM a is dimensioned from 0 to 5 where a(i) = i
</p>
<p>
    a(0) = 0 : a(1) = 1 : a(2) = 2 : a(3) = 3 : a(4) = 4 : a(5) = 5
</p>
<p>
    s$ = "a() at start = " &amp; Join(a()) &amp; CHR$(10)
</p>
<p>
    REM a is dimensioned from 1 to 3 where a(i) = i
</p>
<p>
    ReDim Preserve a(1 To 3) As Integer
</p>
<p>
    s$ = s$ &amp; "ReDim Preserve a(1 To 3) = " &amp; Join(a()) &amp; CHR$(10)
</p>
<p>
</p>
<p>
    ReDim a() As Integer
</p>
<p>
    s$ = s$ &amp; "ReDim a() has LBound = " &amp;_
</p>
<p>
    LBound(a()) &amp; " UBound = " &amp; UBound(a()) &amp; CHR$(10)
</p>
<p>
    REM Array() returns a Variant type
</p>
<p>
    Rem b is dimensioned from 0 to 9 where b(i) = i+1
</p>
<p>
    b = Array(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
</p>
<p>
    s$ = s &amp; CHR$(10) &amp; "b() at start = " &amp; Join(b()) &amp; CHR$(10)
</p>
<p>
    REM b is dimensioned from 1 to 3 where b(i) = i+1
</p>
<p>
    Dim il%, iu%
</p>
<p>
    il = 1 : iu = 3
</p>
<p>
    ReDim Preserve b(il To iu)
</p>
<p>
    s$ = s$ &amp; "ReDim Preserve b(1 To 3) = " &amp; Join(b()) &amp; CHR$(10)
</p>
<p>
</p>
<p>
    ReDim b(-5 To 5)
</p>
<p>
    s$ = s$ &amp; "ReDim b(-5 To 5) = " &amp; Join(b()) &amp; CHR$(10)
</p>
<p>
    s$ = s$ &amp; "ReDim b(-5 To 5) has LBound = " &amp;_
</p>
<p>
    LBound(b()) &amp; " UBound = " &amp; UBound(b()) &amp; CHR$(10) &amp; CHR$(10)
</p>
<p>
</p>
<p>
    ReDim b(-5 To 5, 2 To 4)
</p>
<p>
    s$ = s$ &amp; "ReDim b(-5 To 5, 2 To 4) has dimension 1 LBound = " &amp;_
</p>
<p>
    LBound(b()) &amp; " UBound = " &amp; UBound(b()) &amp; CHR$(10)
</p>
<p>
    s$ = s$ &amp; "ReDim b(-5 To 5, 2 To 4) has dimension 2 LBound = " &amp;_
</p>
<p>
    LBound(b(), 2) &amp; " UBound = " &amp; UBound(b(), 2) &amp; CHR$(10)
</p>
<p>
</p>
<p>
    MsgBox s$, 0, "ReDim Examples"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000006A00000040D9AFBF635.png" style="width:3.9772in;height:2.2516in" />
</p>
<p>
    <strong>Figure .</strong> Use ReDim to change the dimensions of an array.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="array-to-string-and-back-again">
                    <span id="anchor-116"></span>Array to String and back again
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Just as it’s common to convert an array of values into a single string for display, it is also common to split a
    string into multiple pieces. OOo Basic provides these abilities with the functions Join and Split.
</p>
<p>
    The first argument to the Join function is a one-dimensional array. Any other dimension causes a run-time error. The
    elements in the array are concatenated with an optional delimiter string between each element. The default delimiter
    is a single space.
</p>
<p>
    Join(Array(1, 2, 3)) '1 2 3 using the default delimiter
</p>
<p>
    Join(Array(1, 2, 3), "X") '1X2X3 specifying a delimiter
</p>
<p>
    Join(Array(1, 2, 3), "") '123 specifying an empty delimiter
</p>
<p>
    The Split function returns a Variant array of strings, created by breaking a string into multiple strings based on a
    delimiter. In other words, it parses a string into pieces with one command. The delimiter separates portions of the
    string. For example, the delimiter “XY” splits “12XY11XY22” into the strings (“12”, “11”, “22”). The delimiter
    defaults to a space but can be any string expression with length greater than zero.
</p>
<p>
    Split("1 2 3") 'return Array("1", "2", "3") split on " "
</p>
<p>
    Split("1, 2, 3", ", ") 'return Array("1", "2", "3") split on ", "
</p>
<p>
    The optional third argument is used to limit the size of the returned array. This is used only to limit the returned
    size and has no effect if the returned size is less than the limit. For example, the 4 in Split(“1X2X3”, “X”, 4) has
    no effect because the returned array has only three elements. If the size is limited, however, the last element in
    the array contains the remainder of the unparsed string.
</p>
<p>
    Split("1, 2, 3", ", ", 2) 'return Array("1", "2, 3") split on ", "
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The second argument to Split is a string, so, OOo automatically converts it to a string. The statement
                Split(“0 1 2 3”, 2) converts the 2 to a string and uses it as the delimiter. The returned array contains
                two elements, “0 1 ” and “ 3”. You must specify the delimiter if you want to specify the number of
                strings returned. The correct format is Split(“0 1 2 3”, “ ”, 2).
            </td>
        </tr>
    </tbody>
</table>
<p>
    The Split function assumes that a string comes before and after each delimiter, even if the string has length zero.
</p>
<p>
    Split("X1XX2X", "X") = ("", "1", "", "2", "")
</p>
<p>
    The first returned string is empty because the first argument contains a leading delimiter. Two consecutive
    delimiters produce an empty string between the “1” and the the “2”. Finally, the trailing string is empty because
    there is a trailing delimiter.
</p>
<p>
    The Split function is almost the inverse of the Join function. The Join function can use a zero-length string as the
    delimiter, but the Split function cannot. If the joined string contains the delimiter, splitting the string will
    produce a different set of strings. For example, joining “a b” and “c” with a space produces “a b c”. Splitting this
    with a space produces (“a”, “b”, “c”), which is not the original set of strings.
</p>
<p>
    I spent a lot of time writing and debugging a macro to parse through a string to remove all occurrences of the text
    “Sbx”. Using Split and Join is significantly smaller and faster:
</p>
<p>
    Join(Split(s, "Sbx"), "")
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="array-inspection-functions">
                    <span id="anchor-117"></span>Array inspection functions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The most fundamental thing to ask about an array is whether or not it really is an array. The IsArray function
    returns True if the argument is an array, and False otherwise. Use the LBound and UBound functions to determine the
    lower and upper bounds of an array. An array is empty if the upper bound is less than the lower bound.
</p>
<p>
    The first argument to LBound and UBound is the array to check. The second optional argument is an integer expression
    specifying which dimension is returned. The default value is 1, which returns the lower bound of the first
    dimension.
</p>
<p>
    Dim a()
</p>
<p>
    Dim b(2 to 3, -5 To 5)
</p>
<p>
    Print LBound(a()) ' 0
</p>
<p>
    Print UBound(a()) '-1 because the array is empty
</p>
<p>
    Print LBound(b()) ' 2 no optional second argument so defaults to 1
</p>
<p>
    Print LBound(b(),1) ' 2 optional second argument specifies first dimension
</p>
<p>
    Print UBound(b(),2) ' 5
</p>
<p>
    If the value of the second argument doesn’t contain a valid value, if it’s greater than the number of dimensions, or
    if it’s less than 1, a run-time error occurs.
</p>
<p>
    <strong>Listing .</strong> SafeUBound will not generate an error.
</p>
<p>
    Function SafeUBound(v, Optional n) As Integer
</p>
<p>
    SafeUBound = -1 'If an error occurs, this is already set
</p>
<p>
    On Error GoTo BadArrayFound 'On error skip to the end
</p>
<p>
    If IsMissing(n) Then 'Was the optional argument used?
</p>
<p>
    SafeUBound = UBound(v)
</p>
<p>
    Else
</p>
<p>
    SafeUBound = UBound(v, n) 'Optional argument is present
</p>
<p>
    End If
</p>
<p>
    BadArrayFound: 'Jump here on error
</p>
<p>
    On Error GoTo 0 'Turn off this error handler
</p>
<p>
    End Function
</p>
<p>
    The macro in properly returns -1 if an error occurs. The proper value is returned for invalid empty arrays, but it
    also returns -1 if the first argument isn’t an array or if the second argument is simply too large. The ArrayInfo
    function in uses a similar technique to return array information about a variable. Also see .
</p>
<p>
    <strong>Listing .</strong> Print information about an array.
</p>
<p>
    REM If the first argument is an array, the dimensions are determined.
</p>
<p>
    REM Special care is given to an empty array that was created using DimArray
</p>
<p>
    REM or Array.
</p>
<p>
    REM a : Variable to check
</p>
<p>
    REM sName : Name of the variable for a better looking string
</p>
<p>
    Function arrayInfo(a, sName$) As String
</p>
<p>
    REM First, verify that:
</p>
<p>
    REM the variable is not NULL, an empty Object
</p>
<p>
    REM the variable is not EMPTY, an uninitialized Variant
</p>
<p>
    REM the variable is an array.
</p>
<p>
    If IsNull(a) Then
</p>
<p>
    arrayInfo = "Variable " &amp; sName &amp; " is Null"
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    If IsEmpty(a) Then
</p>
<p>
    arrayInfo = "Variable " &amp; sName &amp; " is Empty"
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    If Not IsArray(a) Then
</p>
<p>
    arrayInfo = "Variable " &amp; sName &amp; " is not an array"
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    REM The variable is an array, so get ready to work
</p>
<p>
    Dim s As String 'Build the return value in s
</p>
<p>
    Dim iCurDim As Integer 'Current dimension
</p>
<p>
    Dim i%, j% 'Hold the LBound and UBound values
</p>
<p>
    On Error GoTo BadDimension 'Set up the error handler
</p>
<p>
    iCurDim = 1 'Ready to check the first dimension
</p>
<p>
    REM Initial pretty return string
</p>
<p>
    s = "Array dimensioned as " &amp; sName$ &amp; "("
</p>
<p>
</p>
<p>
    Do While True 'Loop forever
</p>
<p>
</p>
<p>
    i = LBound(a(), iCurDim) 'Error if dimension is too large or
</p>
<p>
    j = UBound(a(), iCurDim) 'if invalid empty array
</p>
<p>
</p>
<p>
    If i &gt; j Then Exit Do 'If empty array then get out
</p>
<p>
</p>
<p>
    If iCurDim &gt; 1 Then s = s &amp; ", " 'Separate dimensions with a comma
</p>
<p>
    s = s &amp; i &amp; " To " &amp; j 'Add in the current dimensions
</p>
<p>
    iCurDim = iCurDim + 1 'Check the next dimension
</p>
<p>
    Loop
</p>
<p>
</p>
<p>
    REM Only arrive here if the array is a valid empty array.
</p>
<p>
    REM Otherwise, an error occurs when the dimension is too
</p>
<p>
    REM large and a jump is made to the error handler
</p>
<p>
    REM Include the type as returned from the TypeName function.
</p>
<p>
    REM The type name includes a trailing "()" so remove this
</p>
<p>
    s = s &amp; ") As " &amp; Left(TypeName(a), LEN(TypeName(a))-2)
</p>
<p>
    arrayInfo = s
</p>
<p>
    Exit Function
</p>
<p>
</p>
<p>
    BadDimension:
</p>
<p>
    REM Turn off the error handler
</p>
<p>
    On Error GoTo 0
</p>
<p>
</p>
<p>
    REM Include the type as returned from the TypeName function.
</p>
<p>
    REM The type name includes a trailing "()" so remove this
</p>
<p>
    s = s &amp; ") As " &amp; Left(TypeName(a), LEN(TypeName(a))-2)
</p>
<p>
</p>
<p>
    REM If errored out on the first dimension then this must
</p>
<p>
    REM be an invalid empty array.
</p>
<p>
    If iCurDim = 1 Then s = s &amp; " *** INVALID Empty Array"
</p>
<p>
    arrayInfo = s
</p>
<p>
    End Function
</p>
<p>
    Sub UseArrayInfo
</p>
<p>
    Dim i As Integer, v
</p>
<p>
    Dim ia(1 To 3) As Integer
</p>
<p>
    Dim sa() As Single
</p>
<p>
    Dim m(3, 4, -4 To -1)
</p>
<p>
</p>
<p>
    Dim s As String
</p>
<p>
    s = s &amp; arrayInfo(i, "i") &amp; CHR$(10) 'Not an array
</p>
<p>
    s = s &amp; arrayInfo(v, "v") &amp; CHR$(10) 'Empty variant
</p>
<p>
    s = s &amp; arrayInfo(sa(), "sa") &amp; CHR$(10) 'Empty array
</p>
<p>
    s = s &amp; arrayInfo(Array(), "Array") &amp; CHR$(10) 'BAD empty array
</p>
<p>
    s = s &amp; arrayInfo(ia(), "ia") &amp; CHR$(10)
</p>
<p>
    s = s &amp; arrayInfo(m(), "m") &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Array Info"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/1000000000000693000002C0069E64D4.png" style="width:3.989in;height:1.5339in" />
</p>
<p>
    <strong>Figure .</strong> Use proper error handling to determine the dimension of the array.
</p>
<p>
    An array with one dimension may have an upper bound that is less than the lower bound. This indicates that the array
    has no allocated spots for data. This is different than an array that has data locations allocated but no data has
    been saved in them. For most data types, such as Integer, if space is allocated for an integer, then it has a value.
</p>
<p>
    Dim a(3) As Integer 'This array has four integer values, they are all zero
</p>
<p>
    Dim b(3) 'This array has four Variants, they are all Empty
</p>
<p>
    Dim c() 'This array has one dimension and no space Ubound &lt; Lbound
</p>
<p>
    v = Array() 'This array has zero dimensions.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-3">
                    <span id="anchor-118"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Array handling in OOo Basic is very flexible. You have the ability to inspect arrays and to change their dimensions.
    Using the Variant type in OOo Basic provides a great deal of flexibility for creating collections of related data of
    different types. Strings and arrays are related; string arrays can be processed with Join and Split functions,
    permitting the creation of compact code that is very powerful for processing string information.
</p>
<ol type="1">
    <li>
        <h1 id="date-routines">
            <span id="anchor-119"></span>Date Routines
        </h1>
    </li>
</ol>
<p>
    This chapter introduces the subroutines and functions supported by OpenOffice.org Basic that are related to
    dates<em><em> — </em></em>including functions to retrieve the current date and time, manipulate dates and times, and
    perform timing functions. It also discusses some potentially unexpected behavior around October 4, 1582, and again
    around December 30, 1899.
</p>
<p>
    Date variables contain both a date and a time value. OOo Basic stores dates internally as a floating-point Double.
    The portion of the number to the left of the decimal contains the date, and the fractional portion to the right of
    the decimal contains the time. For example, adding 1 to a date value adds one day to the date. Adding 1/24 to a date
    value adds one hour to a date value; remember that there are 24 hours in a day. The date and time functions
    supported by OpenOffice.org are listed in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Functions and subroutines related to
    dates and times.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CDate(expression)
            </td>
            <td>
                Date
            </td>
            <td>
                Convert a number or string to a date.
            </td>
        </tr>
        <tr class="even">
            <td>
                CDateFromIso(string)
            </td>
            <td>
                Date
            </td>
            <td>
                Convert to a date from an ISO 8601 date representation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CDateToIso(date)
            </td>
            <td>
                String
            </td>
            <td>
                Convert a date to an ISO 8601 date representation.
            </td>
        </tr>
        <tr class="even">
            <td>
                Date()
            </td>
            <td>
                String
            </td>
            <td>
                Return the current date as a string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DateAdd
            </td>
            <td>
                Date
            </td>
            <td>
                Add an interval to a date.
            </td>
        </tr>
        <tr class="even">
            <td>
                DateDiff
            </td>
            <td>
                Integer
            </td>
            <td>
                Returns the number of intervals between two dates.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DatePart
            </td>
            <td>
                Variant
            </td>
            <td>
                Obtain a specific part of a date value.
            </td>
        </tr>
        <tr class="even">
            <td>
                DateSerial(yr, mnth, day)
            </td>
            <td>
                Date
            </td>
            <td>
                Create a date from component pieces: Year, Month, Day.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DateValue(date)
            </td>
            <td>
                Date
            </td>
            <td>
                Extract the date from a date/time value by truncating the decimal portion.
            </td>
        </tr>
        <tr class="even">
            <td>
                Day(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the day of the month as an Integer from a Date value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FormatDateTime
            </td>
            <td>
                String
            </td>
            <td>
                Format the date and time as a string. Requires OptionCompatible.
            </td>
        </tr>
        <tr class="even">
            <td>
                GetSystemTicks()
            </td>
            <td>
                Long
            </td>
            <td>
                Return the number of system ticks as a Long.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Hour(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the hour as an Integer from a Date value.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsDate(value)
            </td>
            <td>
                Boolean
            </td>
            <td>
                Is this (value, converted to a string) a date?
            </td>
        </tr>
        <tr class="odd">
            <td>
                Minute(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the minute as an Integer from a Date value.
            </td>
        </tr>
        <tr class="even">
            <td>
                Month(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the month as an Integer from a Date value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MonthName
            </td>
            <td>
                String
            </td>
            <td>
                Return the name of the month based on an integer argument (1-12).
            </td>
        </tr>
        <tr class="even">
            <td>
                Now()
            </td>
            <td>
                Date
            </td>
            <td>
                Return the current date and time as a Date object.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Second(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the seconds as an Integer from a Date value.
            </td>
        </tr>
        <tr class="even">
            <td>
                Time()
            </td>
            <td>
                Date
            </td>
            <td>
                Return the time as a String in the format HH:MM:SS.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Timer()
            </td>
            <td>
                Date
            </td>
            <td>
                Return the number of seconds since midnight as a Date. Cast this to a Long.
            </td>
        </tr>
        <tr class="even">
            <td>
                TimeSerial(hour, min, sec)
            </td>
            <td>
                Date
            </td>
            <td>
                Create a date from component pieces: Hours, Minutes, Seconds.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TimeValue(“HH:MM:SS”)
            </td>
            <td>
                Date
            </td>
            <td>
                Extract the time value from a date; a pure time value between 0 and 1.
            </td>
        </tr>
        <tr class="even">
            <td>
                WeekDay(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the integer 1 through 7 corresponding to Sunday through Saturday.
            </td>
        </tr>
        <tr class="odd">
            <td>
                WeekdayName
            </td>
            <td>
                String
            </td>
            <td>
                Return the day of the week based on an integer argument (1-7).
            </td>
        </tr>
        <tr class="even">
            <td>
                Year(date)
            </td>
            <td>
                Integer
            </td>
            <td>
                Return the year as an Integer from a Date value.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="compatibility-issues">
                    <span id="anchor-120"></span>Compatibility issues
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    When OOo added a number and a date, the result was always a date. LibreOffice changed this behavior to always return
    a number. After breaking existing macros, LibreOffice changed the code so that some combinations involving a date
    and a number return a date. If existing code fails, explicitly cast the result to a date:
</p>
<p>
    CDate(2 + Now)
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="retrieve-the-current-date-and-time">
                    <span id="anchor-121"></span>Retrieve the current date and time
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic has functions to determine the current date and time: Date, Time, and Now (described in ). The Date and
    Time functions return a string with the current date and time, respectively. The strings are formatted based on the
    current locale (Tools | Options | Language Settings | Languages; and then set the locale). The Now command returns a
    Date object that contains both the current date and the current time.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Now returns a Date object, which internally is stored as a Double. The functions Date and Time both
                return a String.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong> </strong>Date and time functions in OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Date
            </td>
            <td>
                Return the current date as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                Now
            </td>
            <td>
                Return the current date and time as a Date object.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Time
            </td>
            <td>
                Return the current time as a String.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Printing the date and time is easy.
</p>
<p>
    Print Date
</p>
<p>
    Print Time
</p>
<p>
    Print Now
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="dates-numbers-and-strings">
                    <span id="anchor-122"></span>Dates, numbers, and strings
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic recognizes dates in two different string formats. The obvious format is set by the locale. A less obvious
    format is the ISO 8601 date format. String formats are always assumed to be in a locale-specific format except for
    routines specific to the ISO 8601 format. Arguments passed to the date and time functions are converted to an
    appropriate type if possible. As a result, most of the functions in accept string, numeric, and date arguments.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Date and string conversion functions
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CDate
            </td>
            <td>
                Convert a number or string to a date.
            </td>
        </tr>
        <tr class="even">
            <td>
                DateValue
            </td>
            <td>
                Convert a formatted string from December 1, 1582 through December 31, 9999 to a Date value that contains
                no time.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CDateFromIso
            </td>
            <td>
                Convert to a date from an ISO 8601 date representation.
            </td>
        </tr>
        <tr class="even">
            <td>
                CDateToIso
            </td>
            <td>
                Convert a date to an ISO 8601 date representation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsDate
            </td>
            <td>
                Is this string a properly formatted date?
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the IsDate function to test if a string contains a valid date. The argument is always converted to a string
    before it is used, so a numeric argument will return False. The IsDate function tests more than just syntax<em><em>
            — </em></em>it checks to see if the string contains a valid date. For example, “02/29/2003” fails because
    February 2003 contains only 28 days. The same validity check is not performed on the time component of the string
    (see and ).
</p>
<p>
    <strong>Listing .</strong> IsDate verifies that a string contains a valid date.
</p>
<p>
    Print IsDate("December 1, 1582 2:13:42") 'True
</p>
<p>
    Print IsDate("2:13:42") 'True
</p>
<p>
    Print IsDate("12/1/1582") 'True
</p>
<p>
    Print IsDate(Now) 'True
</p>
<p>
    Print IsDate("26:61:112") 'True: 112 seconds and 61 minutes!!!
</p>
<p>
    Print IsDate(True) 'False: Converts to string first
</p>
<p>
    Print IsDate(32686.22332) 'False: Converts to string first
</p>
<p>
    Print IsDate("02/29/2003") 'False: Only 28 days in February 03
</p>
<p>
    The apparent inconsistency with the IsDate function is that “02/29/2003” is an invalid date but “26:61:112” is
    valid. With time values, if a section of the time is too large, it is simply added to the next section. For example,
    61 minutes is one hour and one minute. Again, 112 seconds adds one minute and 52 seconds to the final computed time
    value. This is demonstrated in and shown in . Notice that, in line two, 30 hours becomes six hours and the day is
    incremented by one.
</p>
<p>
    <strong>Listing .</strong> Converting time is strange.
</p>
<p>
    Sub ExampleTimeConversions
</p>
<p>
    On Error GoTo Oops:
</p>
<p>
    Dim Dates()
</p>
<p>
    Dim i As Integer
</p>
<p>
    Dim s As String
</p>
<p>
    Dates() = Array("1/1/1 00:00:00 ", "1/1/1 22:40:00 ", "1/1/1 30:40:00 ",_
</p>
<p>
    "1/1/1 30:100:00 ", "1/1/1 30:100:100")
</p>
<p>
    For i = LBound(Dates()) To UBound(Dates())
</p>
<p>
    s = s &amp; CStr(i) &amp; " " &amp; Dates(i) &amp; " =&gt; "
</p>
<p>
    s = s &amp; CDate(Dates(i))
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Strange Time Values"
</p>
<p>
    Exit Sub
</p>
<p>
    Oops:
</p>
<p>
    s = s &amp; " Error"
</p>
<p>
    Resume Next
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000013A00000092279003F6.png" style="width:3.2709in;height:1.5209in" />
</p>
<p>
    <strong>Figure .</strong> What appear to be invalid times are valid.
</p>
<p>
    Apart from the strange behavior with respect to time, dates and times are converted with no problems except for
    invalid dates during the skip from the Julian to the Gregorian calendar.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="locale-formatted-dates">
                    <span id="anchor-123"></span>Locale formatted dates
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the CDate function to convert a string or number to a date. The CDate function performs a locale-specific
    conversion including the time component. The DateValue function removes the time portion by removing the fractional
    portion of the underlying Double. This causes unexpected results with some date values. See .
</p>
<p>
    <strong>Listing .</strong> CDate returns a date and a time; DateValue removes the time.
</p>
<p>
    Print Now 'for example, 08/16/2003 16:05:53
</p>
<p>
    Print DateValue(Now) 'for example, 08/16/2003
</p>
<p>
    The default language on the computers that I use is “English USA.” To use a different locale, select Tools | Options
    | Language Settings | Languages to open the Languages tab on the Options dialog. Then choose a locale.
</p>
<p>
    To test different locales, use the code in .
</p>
<p>
    <strong>Listing .</strong> Print date-related information dependent on current locale.
</p>
<p>
    Dim d As Date
</p>
<p>
    d = CDate("1/2/3") 'You can use 1.2.3 or 1/2/3 regardless of locale
</p>
<p>
    Print d 'Prints locale specific
</p>
<p>
    Print Year(d)
</p>
<p>
    Print Month(d)
</p>
<p>
    Print Day(d)
</p>
<p>
    I ran the code in using four different locales: English USA, English UK, French France, and German Germany. The
    results are shown in . The format used to print a date is locale-specific, as you can see in the Germany column. The
    CDate function accepts dates formatted using the period as a separator, even for the USA locale. Initializing d
    using CDate("1.2.3") rather than CDate("1/2/3") does not change the output in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Locale affects the date.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Print d
            </td>
            <td>
                “01/02/2003”
            </td>
            <td>
                “01/02/2003”
            </td>
            <td>
                “01/02/2003”
            </td>
            <td>
                “01.02.2003”
            </td>
        </tr>
        <tr class="even">
            <td>
                Print Year(d)
            </td>
            <td>
                2003
            </td>
            <td>
                2003
            </td>
            <td>
                2003
            </td>
            <td>
                2003
            </td>
        </tr>
        <tr class="odd">
            <td>
                Print Month(d)
            </td>
            <td>
                1
            </td>
            <td>
                2
            </td>
            <td>
                2
            </td>
            <td>
                2
            </td>
        </tr>
        <tr class="even">
            <td>
                Print Day(d)
            </td>
            <td>
                2
            </td>
            <td>
                1
            </td>
            <td>
                1
            </td>
            <td>
                1
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="iso-8601-dates">
                    <span id="anchor-124"></span>ISO 8601 dates
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The International Standard ISO 8601 specifies the numeric representations of date and time. This standard notation
    helps to avoid confusion in international communication caused by numerous different notations, and increases the
    portability of computer user interfaces. In addition, these formats have several important advantages for computer
    usage compared to other traditional date and time notations.
</p>
<p>
    The international standard date notation is YYYY-MM-DD, which is a four-digit year followed by a two-digit month and
    a two-digit day. The year is based on the usual Gregorian calendar. For example, March 8, 2003 is written as
    2003-03-08. The separators are optional, so you could also express the date as 20030308; this is the format returned
    by CDateToISO. See . Other components of the date format are beyond the scope of this book. The ISO format has
    several advantages:
</p>
<ul>
    <li>
        ISO 8601 is easily comparable and sortable with a string comparison. This is why I prefer this format when
        appending dates to file names.
    </li>
    <li>
        ISO 8601 is easily readable and writable by software because no translation to and from month names is required.
    </li>
    <li>
        ISO 8601 is language and locale independent.
    </li>
</ul>
<p>
    There is no ambiguity compared to other date formats. For example, in other formats, there’s often a question as to
    whether the month or the day is listed first. The convention in Europe, for example, would express the fifth day of
    June in 2003 as 5/6/03, while in the United States<em><em> — </em></em>and North and South America,
    generally<em><em> — </em></em>the same date would commonly be expressed as 6/5/03. The opportunity for confusion is
    great, especially around the time bills are due near the beginning of each month! This is illustrated by the Month
    and Day row entries shown in . Converts the same data to the appropriate ISO 8601 string .
</p>
<p>
    <strong>Listing .</strong> Convert to ISO 8601.
</p>
<p>
    Sub ExampleCDateToISO
</p>
<p>
    Print CDateToISO("12/30/1899") '18991230
</p>
<p>
    Print CDateToISO(Now) '20100816
</p>
<p>
    Print CDateFromISO("20030313") '03/13/2003
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="problems-with-dates">
                    <span id="anchor-125"></span>Problems with dates
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Date and time information usually requires little thought. Just use the date and time functions and the correct
    expected results are produced. Unfortunately, this falls apart as your dates start moving back in time. Three
    specific dates and times are of interest for each function:
</p>
<ul>
    <li>
        December 30, 1899 at 00:00:00, when the internal Date representation is a numerical zero. Any pure time value
        (without a date component) appears to occur on December 30, 1899.
    </li>
    <li>
        October 4, 1582, when the Julian calendar was dropped.
    </li>
    <li>
        October 15,1582, when the Gregorian calendar begins.
    </li>
</ul>
<p>
    Various calendar systems have been used at different times and places around the world. The Gregorian calendar, on
    which OOo Basic is based, is used almost universally. The predecessor to the Gregorian calendar is the Julian
    calendar. The two calendars are almost identical, differing only in how they handle leap years. The Julian calendar
    has a leap year every fourth year, while the Gregorian calendar has a leap year every fourth year except century
    years that aren’t exactly divisible by 400.
</p>
<p>
    The change from the Julian calendar to the Gregorian calendar occurred in October of 1582, based on a scheme
    instituted by Pope Gregory XIII. The Julian calendar was used through October 4, 1582, at which point 10 days were
    skipped and it became October 15, 1582. Typically, for dates on or before 4 October 1582, the Julian calendar is
    used; for dates on or after 15 October 1582, the Gregorian calendar is used. Thus, there is a 10-day gap in calendar
    dates, but no discontinuity in Julian dates or days of the week. Astronomers, however, typically use Julian dates
    because they don’t have a 10-day gap; discontinuous dates do not typically work well in numerical calculations. As
    seen in , Dates are printed based on the Gregorian calendar, but when the component parts are extracted, they are
    based on the Julian date.
</p>
<p>
    The ISO 8601 standard, introduced to standardize the exchange of date and time-related data, introduces a
    complication. The standard states that every date must be consecutive, so changing to the Julian calendar violates
    the standard (because at the switchover date, the dates would not be consecutive).
</p>
<p>
    The following examples demonstrate converting a date / time with CDate, DateValue, and CDateToISO. The DateValue
    operates on the value returned from CDate. The standard values work as expected (see ). January 1, 2001 is 36892
    days after December 30, 1899, and January 1, 1900 is 2 days after December 30, 1899.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Dates after January 1, 1900 work fine.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                01/01/1900 12:00 AM
            </td>
            <td>
                2
            </td>
            <td>
                2
            </td>
            <td>
                19000101
            </td>
        </tr>
        <tr class="even">
            <td>
                01/01/1900 06:00 AM
            </td>
            <td>
                2
            </td>
            <td>
                2.25
            </td>
            <td>
                19000101
            </td>
        </tr>
        <tr class="odd">
            <td>
                01/02/1900 12:00 AM
            </td>
            <td>
                3
            </td>
            <td>
                3
            </td>
            <td>
                19000102
            </td>
        </tr>
        <tr class="even">
            <td>
                01/02/1900 06:00 AM
            </td>
            <td>
                3
            </td>
            <td>
                3.25
            </td>
            <td>
                19000102
            </td>
        </tr>
        <tr class="odd">
            <td>
                01/01/2001 12:00 AM
            </td>
            <td>
                36892
            </td>
            <td>
                36892
            </td>
            <td>
                20010101
            </td>
        </tr>
        <tr class="even">
            <td>
                01/01/2001 06:00 AM
            </td>
            <td>
                36892
            </td>
            <td>
                36892.25
            </td>
            <td>
                20010101
            </td>
        </tr>
        <tr class="odd">
            <td>
                01/01/2001 12:00 PM
            </td>
            <td>
                36892
            </td>
            <td>
                36892.5
            </td>
            <td>
                20010101
            </td>
        </tr>
    </tbody>
</table>
<p>
    Values near December 30, 1899 reveals some bugs.
</p>
<ol type="1">
    <li>
        DateValue generates an error on December 30, 1899. This may be intentional so that DateValue generates an error
        on a pure time value, which cannot be distinguished from a date/time on December 30, 1899.
    </li>
    <li>
        DateValue returns an incorrect answer for all dates before December 30, 1899 for all time values other than
        midnight.
    </li>
    <li>
        CDateToISO returns an incorrect answer for all dates before January 1, 1900 for all time values other than
        midnight.
    </li>
    <li>
        CDateToISO has an exceptional failure on on December 31, 1899 for times after midnight.
    </li>
</ol>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Dates near December 30, 1899 are a
    problem.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                12/28/1899 12:00 AM
            </td>
            <td>
                -2
            </td>
            <td>
                -2
            </td>
            <td>
                18991228
            </td>
        </tr>
        <tr class="even">
            <td>
                12/28/1899 06:00 AM
            </td>
            <td>
                -1
            </td>
            <td>
                -1.75
            </td>
            <td>
                18991229
            </td>
        </tr>
        <tr class="odd">
            <td>
                12/29/1899 12:00 AM
            </td>
            <td>
                -1
            </td>
            <td>
                -1
            </td>
            <td>
                18991229
            </td>
        </tr>
        <tr class="even">
            <td>
                12/29/1899 06:00 AM
            </td>
            <td>
                Error
            </td>
            <td>
                -0.75
            </td>
            <td>
                18991230
            </td>
        </tr>
        <tr class="odd">
            <td>
                12/30/1899 12:00 AM
            </td>
            <td>
                Error
            </td>
            <td>
                0
            </td>
            <td>
                18991230
            </td>
        </tr>
        <tr class="even">
            <td>
                12/30/1899 06:00 AM
            </td>
            <td>
                Error
            </td>
            <td>
                0.25
            </td>
            <td>
                18991231
            </td>
        </tr>
        <tr class="odd">
            <td>
                12/31/1899 12:00 AM
            </td>
            <td>
                1
            </td>
            <td>
                1
            </td>
            <td>
                18991231
            </td>
        </tr>
        <tr class="even">
            <td>
                12/31/1899 06:00 AM
            </td>
            <td>
                1
            </td>
            <td>
                1.25
            </td>
            <td>
                18991201
            </td>
        </tr>
    </tbody>
</table>
<p>
    Purely invalid dates generate an error as they should; for example, dates between the end of the Julian calendar and
    the start of the Gregorian calendar. Issues with DateValue and CdateToISO continue when the time is not midnight.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Nothing special about dates near the
    Julian / Gregorian calendar change.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                10/04/1582 12:00 AM
            </td>
            <td>
                -115859
            </td>
            <td>
                -115859
            </td>
            <td>
                15821014
            </td>
        </tr>
        <tr class="even">
            <td>
                10/04/1582 06:00 AM
            </td>
            <td>
                -115858
            </td>
            <td>
                -115858.75
            </td>
            <td>
                15821015
            </td>
        </tr>
        <tr class="odd">
            <td>
                10/05/1582 00:00:00
            </td>
            <td>
                Error
            </td>
            <td>
                Error
            </td>
            <td>
                Error
            </td>
        </tr>
        <tr class="even">
            <td>
                10/05/1582 06:00:00
            </td>
            <td>
                Error
            </td>
            <td>
                Error
            </td>
            <td>
                Error
            </td>
        </tr>
        <tr class="odd">
            <td>
                10/15/1582 12:00 AM
            </td>
            <td>
                -115858
            </td>
            <td>
                -115858
            </td>
            <td>
                15821015
            </td>
        </tr>
        <tr class="even">
            <td>
                10/15/1582 06:00 AM
            </td>
            <td>
                -115857
            </td>
            <td>
                -115857.75
            </td>
            <td>
                15821016
            </td>
        </tr>
    </tbody>
</table>
<p>
    Demonstrates the issues converting to date / time values.
</p>
<p>
    <strong>Listing .</strong> Demonstrate odd date behavior.
</p>
<p>
    Sub OddDateTimeBehavior
</p>
<p>
    On Error GoTo Oops:
</p>
<p>
    Dim Dates()
</p>
<p>
    Dim i As Integer
</p>
<p>
    Dim s As String
</p>
<p>
    Dates() = Array("10/04/1582 00:00:00", "10/04/1582 06:00:00", _
</p>
<p>
    "10/05/1582 00:00:00", "10/05/1582 06:00:00", _
</p>
<p>
    "10/15/1582 00:00:00", "10/15/1582 06:00:00", _
</p>
<p>
    "12/28/1899 00:00:00", "12/28/1899 06:00:00", _
</p>
<p>
    "12/29/1899 00:00:00", "12/29/1899 06:00:00", _
</p>
<p>
    "12/30/1899 00:00:00", "12/30/1899 06:00:00", _
</p>
<p>
    "12/31/1899 00:00:00", "12/31/1899 06:00:00", _
</p>
<p>
    "01/01/1900 00:00:00", "01/01/1900 06:00:00", _
</p>
<p>
    "01/02/1900 00:00:00", "01/02/1900 06:00:00", _
</p>
<p>
    "1/1/1 00:00:00", "1/1/1 06:00:00", "1/1/1 12:00:00" _
</p>
<p>
    )
</p>
<p>
    For i = LBound(Dates()) To UBound(Dates())
</p>
<p>
    s = s &amp; CStr(i) &amp; " " &amp; Dates(i) &amp; " =&gt; "
</p>
<p>
    s = s &amp; CDbl(DateValue(CDate(Dates(i))))
</p>
<p>
    s = s &amp; " =&gt; "
</p>
<p>
    s = s &amp; CDbl(CDate(Dates(i))) &amp; " =&gt; " &amp; CDateToISO(Dates(i))
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Strange Time Values"
</p>
<p>
    Exit Sub
</p>
<p>
    Oops:
</p>
<p>
    s = s &amp; " Error"
</p>
<p>
    Resume Next
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001C800000182007F0B83.png" style="width:4.75in;height:4.0209in" />
</p>
<p>
    <strong>Figure .</strong> Some Date values convert poorly.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                DateValue fails with a run-time error for dates with a zero day component, such as
                DateValue(CDate("12/30/1899 06:00:00")). Dates before this return an incorrect value. I might also argue
                that dates and times that use the same data type is a bug, because it isn’t possible to distinguish
                between a time and a date value for the day 12/30/1899.
            </td>
        </tr>
    </tbody>
</table>
<p>
    DateValue truncates the decimal portion of the number to determine the date. The Int function, however, always
    rounds toward negative infinity, which produces the correct result. See . Remember that the Int function rounds
    towards negative infinity and returns a double.
</p>
<p>
    <strong>Listing .</strong> Round toward negative infinity and convert it to a Date.
</p>
<p>
    Function SafeDateValue(v) Date
</p>
<p>
    SafeDateValue = CDate(Int(CDate(v)))
</p>
<p>
    End Function
</p>
<p>
    SafeDateValue in corrects the wrong behavior. repeats using SafeDateValue, so now the correct values are obtained.
</p>
<p>
    <strong>Listing .</strong> Round toward negative infinity and convert it to a Date.
</p>
<p>
    Sub SafeDateTimeBehavior
</p>
<p>
    On Error GoTo Oops:
</p>
<p>
    Dim Dates()
</p>
<p>
    Dim i As Integer
</p>
<p>
    Dim s As String
</p>
<p>
    Dates() = Array("10/04/1582 00:00:00", "10/04/1582 06:00:00", _
</p>
<p>
    "10/05/1582 00:00:00", "10/05/1582 06:00:00", _
</p>
<p>
    "10/15/1582 00:00:00", "10/15/1582 06:00:00", _
</p>
<p>
    "12/28/1899 00:00:00", "12/28/1899 06:00:00", _
</p>
<p>
    "12/29/1899 00:00:00", "12/29/1899 06:00:00", _
</p>
<p>
    "12/30/1899 00:00:00", "12/30/1899 06:00:00", _
</p>
<p>
    "12/31/1899 00:00:00", "12/31/1899 06:00:00", _
</p>
<p>
    "01/01/1900 00:00:00", "01/01/1900 06:00:00", _
</p>
<p>
    "01/02/1900 00:00:00", "01/02/1900 06:00:00", _
</p>
<p>
    "1/1/1 00:00:00", "1/1/1 06:00:00", "1/1/1 12:00:00" _
</p>
<p>
    )
</p>
<p>
    For i = LBound(Dates()) To UBound(Dates())
</p>
<p>
    s = s &amp; CStr(i) &amp; " " &amp; Dates(i) &amp; " =&gt; "
</p>
<p>
    s = s &amp; CDbl(SafeDateValue(CDate(Dates(i))))
</p>
<p>
    s = s &amp; " =&gt; "
</p>
<p>
    s = s &amp; CDbl(CDate(Dates(i))) &amp; " =&gt; " &amp; CDateToISO(SafeDateValue(Dates(i)))
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Strange Time Values"
</p>
<p>
    Exit Sub
</p>
<p>
    Oops:
</p>
<p>
    s = s &amp; " Error"
</p>
<p>
    Resume Next
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="extract-each-part-of-a-date">
                    <span id="anchor-126"></span>Extract each part of a date
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Date objects are based on floating-point Double numbers so mathematical operations and comparisons can be used with
    Date objects. The Date and Time functions, however, return strings, so they can’t be used in this capacity. OOo
    Basic provides functions to retrieve the individual pieces of a date (see ).
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Date component extraction functions in
    OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Year(date)
            </td>
            <td>
                Return the year portion of a Date value as an Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Month(date)
            </td>
            <td>
                Return the month portion of a Date value as an Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Day(date)
            </td>
            <td>
                Return the day portion of a Date value as an Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Hour(date)
            </td>
            <td>
                Return the hour portion of a Date value as an Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Minute(date)
            </td>
            <td>
                Return the minutes portion of a Date value as an Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Second(date)
            </td>
            <td>
                Return the seconds portion of a Date value as an Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                WeekDay(date)
            </td>
            <td>
                Return an integer value from 1 through 7, corresponding to the day of the week, Sunday through Saturday.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The functions in <strong> </strong>all expect a Date object, which is internally based on a Double. OOo Basic
    automatically converts the argument to the appropriate type if possible. The Date function returns a string with no
    time information (everything to the right of the decimal is zero) so there is no time information for the Hour,
    Minute, and Second functions to return. Similarly, the Time function returns a string with no date information
    (everything to the left of the decimal is zero), which corresponds to December 30, 1899.
</p>
<p>
    Print "Year = " &amp; Year(0.223) '1899, 0 for date means December 30, 1899
</p>
<p>
    Print "Year = " &amp; Year(Time) '1899, No date information from Time()
</p>
<p>
    Print "Month = " &amp; Month(Date) 'Current month
</p>
<p>
    Print "Day = " &amp; Day(Now) 'Now contains date and time information
</p>
<p>
    Print "Hour = " &amp; Hour(Date) '0, No time information from Date()
</p>
<p>
    Print "Minutes = " &amp; Minute(Now) 'Current minutes
</p>
<p>
    Print "Seconds = " &amp; Second(Time) 'Current seconds
</p>
<p>
    Use the WeekDay function to determine the day of the week. Some calendars start on Monday and some start on Sunday;
    OOo Basic assumes that Sunday is the first day of the week. See .
</p>
<p>
    <strong>Listing .</strong> Determine the day of the week.
</p>
<p>
    Sub ExampleWeekDayText
</p>
<p>
    Print "Today is " &amp; WeekDayText(Date)
</p>
<p>
    End Sub
</p>
<p>
    Function WeekDayText(d) As String
</p>
<p>
    Select Case WeekDay(d)
</p>
<p>
    case 1
</p>
<p>
    WeekDayText="Sunday"
</p>
<p>
    case 2
</p>
<p>
    WeekDayText="Monday"
</p>
<p>
    case 3
</p>
<p>
    WeekDayText="Tuesday"
</p>
<p>
    case 4
</p>
<p>
    WeekDayText="Wednesday"
</p>
<p>
    case 5
</p>
<p>
    WeekDayText="Thursday"
</p>
<p>
    case 6
</p>
<p>
    WeekDayText="Friday"
</p>
<p>
    case 7
</p>
<p>
    WeekDayText="Saturday"
</p>
<p>
    End Select
</p>
<p>
    End Function
</p>
<p>
    The DatePart function allows you to pass a string expression that determines the part of the date of interest; as
    expressed as a string as the first argument. Running DatePart with September 15, 2010 at 19:13:20 yields the results
    shown in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> DatePart string specifier.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                yyyy
            </td>
            <td>
                Four-digit year
            </td>
            <td>
                2010
            </td>
        </tr>
        <tr class="even">
            <td>
                q
            </td>
            <td>
                Quarter
            </td>
            <td>
                3
            </td>
        </tr>
        <tr class="odd">
            <td>
                m
            </td>
            <td>
                Month
            </td>
            <td>
                9
            </td>
        </tr>
        <tr class="even">
            <td>
                y
            </td>
            <td>
                Day of year
            </td>
            <td>
                258
            </td>
        </tr>
        <tr class="odd">
            <td>
                w
            </td>
            <td>
                Weekday
            </td>
            <td>
                4
            </td>
        </tr>
        <tr class="even">
            <td>
                ww
            </td>
            <td>
                Week of year
            </td>
            <td>
                38
            </td>
        </tr>
        <tr class="odd">
            <td>
                d
            </td>
            <td>
                Day of Month
            </td>
            <td>
                15
            </td>
        </tr>
        <tr class="even">
            <td>
                h
            </td>
            <td>
                Hour
            </td>
            <td>
                19
            </td>
        </tr>
        <tr class="odd">
            <td>
                n
            </td>
            <td>
                Minute
            </td>
            <td>
                13
            </td>
        </tr>
        <tr class="even">
            <td>
                s
            </td>
            <td>
                Second
            </td>
            <td>
                20
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Use DatePart to extract components of a date.
</p>
<p>
    Sub ExampleDatePart
</p>
<p>
    Dim TheDate As Date
</p>
<p>
    Dim f
</p>
<p>
    Dim i As Integer
</p>
<p>
    Dim s$
</p>
<p>
    TheDate = Now
</p>
<p>
    f = Array("yyyy", "q", "m", "y", "w", "ww", "d", "h", "n", "s")
</p>
<p>
    s = "Now = " &amp; TheDate &amp; CHR$(10)
</p>
<p>
    For i = LBound(f) To UBound(f)
</p>
<p>
    s = s &amp; "DatePart(" &amp; f(i) &amp; ", " &amp; TheDate &amp; ") = " &amp; _
</p>
<p>
    DatePart(f(i), TheDate) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                A German user claimed that DatePart failed if it were not run with CompatibilityMode(True).
            </td>
        </tr>
    </tbody>
</table>
<p>
    DatePart supports an optional third argument that specifies when a week is assumed to start (see ). The optional
    fourth argument, specifies when the year is assumed to start. The third and fourth arguments affect things such as
    the week of the year, but will not affect other values such as the day of the year.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> DatePart week start and year start
    values.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                Use system default value.
            </td>
            <td>
                Use system default value.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                Sunday (default)
            </td>
            <td>
                Week 1 is the week with January first (default).
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                Monday
            </td>
            <td>
                Week 1 is the first week containing four or more days of that year.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                Tuesday
            </td>
            <td>
                Week 1 is the first week containing only days of the new year.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                Wednesday
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                Thursday
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                6
            </td>
            <td>
                Friday
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                7
            </td>
            <td>
                Saturday
            </td>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<p>
    After extracting portions of the date, it is useful to print the values in an easy to read format. Use MonthName to
    convert the month number to the month name. Setting the optional second argument to True causes the name to be
    abbreviated.
</p>
<p>
    <strong>Listing .</strong> Print the Month as a string.
</p>
<p>
    Sub ExampleMonthName
</p>
<p>
    Dim i%
</p>
<p>
    Dim s$
</p>
<p>
    For i = 1 To 12
</p>
<p>
    s = s &amp; i &amp; " = " &amp; MonthName(i, True) &amp; " = " &amp; MonthName(i) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "MonthName"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000AC000000FBB8CC04FE.png" style="width:1.7917in;height:2.6146in" /> <img
        src="Pictures/10000000000000B4000000B0618ED71A.png" style="width:1.8752in;height:1.8335in" />
</p>
<p>
    <strong>Figure .</strong> Use MonthName and WeekDayName to convert an integer into the name.
</p>
<p>
    WeekDayName, similar to Monthname, returns the day of the week as a string. Oddly, WeekDayName only works if
    compatibility mode is on. WeekDayName also supports a third argument, which specifies the day that the week begins
    (see ).
</p>
<p>
    <strong>Listing .</strong> Print the day of the week as a string.
</p>
<p>
    Sub ExampleWeekDayName
</p>
<p>
    Dim i%
</p>
<p>
    Dim s$
</p>
<p>
    CompatibilityMode(True)
</p>
<p>
    For i = 1 To 7
</p>
<p>
    s = s &amp; i &amp; " = " &amp; WeekDayName(i, True) &amp; " = " &amp; WeekDayName(i) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "WeekDayName"
</p>
<p>
    End Sub
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Third argument for WeekDayName to
    specify the first day of the week.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                Use National Language Support API setting.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                Sunday (default)
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                Monday
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                Tuesday
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                Wednesday
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                Thursday
            </td>
        </tr>
        <tr class="odd">
            <td>
                6
            </td>
            <td>
                Friday
            </td>
        </tr>
        <tr class="even">
            <td>
                7
            </td>
            <td>
                Saturday
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the WeekDay function to extract the day of the week based on a date. The optional second argument specifies the
    day on which the week starts; the values are the same as for WeekDayName (see ) except that 0 corresponds to the
    system default setting.
</p>
<p>
    Print WeekDay(Now)
</p>
<p>
    Use FormatDateTime to display the date and time in a common format. The first argument is the date. The second
    argument is optional and specifies how the date should be formatted (see ).
</p>
<p>
    <strong>Listing .</strong> Format a date/time string.
</p>
<p>
    Sub ExampleFormatDateTime
</p>
<p>
    Dim s$, i%
</p>
<p>
    Dim d As Date
</p>
<p>
    d = Now
</p>
<p>
    CompatibilityMode(True)
</p>
<p>
    s = "FormatDateTime(d) = " &amp; FormatDateTime(d) &amp; CHR$(10)
</p>
<p>
    For i=0 To 4
</p>
<p>
    s = s &amp; "FormatDateTime(d, " &amp; i &amp; ") = " &amp; FormatDateTime(d, i) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "FormatDateTime"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/1000000000000192000000A1DDCE0072.png" style="width:4.1874in;height:1.6772in" />
</p>
<p>
    <strong>Figure .</strong> Format a date and time with FormatDateTime.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Second argument to FormatDateTime
    specify format.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                Default format with a short date and and a long time.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                Long date format with no time.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                Short date format.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                Time in the computer's regional settings.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                24 hour hours and minutes as hh:mm.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="date-arithmetic">
                    <span id="anchor-127"></span>Date arithmetic
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Internally, a date is represented as a floating point number. The decimal portion represents the time, and the
    integer portion represents the date. The representation allows mathematical manipulation, but, it requires a bit of
    thought; for example, add:
</p>
<ul>
    <li>
        1 Add one day Now + 1
    </li>
    <li>
        1/24 Add one hour Now + 1/24
    </li>
    <li>
        365 Add one year, but leap years are a problem.
    </li>
</ul>
<p>
    Use DateAdd to simplify the process. The third argument is the date. The first argument (see ) determines how the
    value in the second argument is interpreted. I can repeat the list above as:
</p>
<p>
    Print DateAdd("d", 1, Now) 'Add one day.
</p>
<p>
    Print DateAdd("h", 1, Now) 'Add one hour.
</p>
<p>
    Print DateAdd("yyy", 1, Now) 'Add one year.
</p>
<p>
    Use DateDiff to determine the number of “intervals” between two dates; for example, the number weeks between two
    dates. The first argument specifies the interval to use (see ). The second argument is the first date, and the third
    argument is the second date. The optional fourth and fifth arguments specify the first day of the week and the first
    week of the year (see ).
</p>
<p>
    Print DateDiff("yyyy", "03/13/1965", Date(Now)) 'Years from March 13, 1965 to now
</p>
<p>
    Print DateDiff("d", "03/13/1965", Date(Now)) 'Days from March 13, 1965 to now
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="assembling-dates-from-components">
                    <span id="anchor-128"></span>Assembling dates from components
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The functions Hour, Minute, Second, Year, Month, and Day are used to break a date into parts. The functions
    DateSerial and TimeSerial are used to put the dates back together again. The function DateSerial creates a Date
    object from the year, month, and day. The function TimeSerial creates a Date object from the hours, minutes, and
    seconds.
</p>
<p>
    Print DateSerial(2003, 10, 1) '10/01/2003
</p>
<p>
    Print TimeSerial(13, 4, 45) '13:04:45
</p>
<p>
    The first argument to the DateSerial function is the year, the second argument is the month, and the final argument
    is the day. If the month or day aren’t valid values, a run-time error occurs. Year values greater than 100 are used
    directly. Year values less than 100, however, have 1900 added to them. Two-digit years are mapped to the years 1900
    and later (see ).
</p>
<p>
    <strong>Listing .</strong> DateSerial adds 1900 to years earlier than 100.
</p>
<p>
    Sub ExampleDateSerial
</p>
<p>
    On Error Goto OOPS
</p>
<p>
    Dim x
</p>
<p>
    Dim i%
</p>
<p>
    Dim s$
</p>
<p>
    x = Array(2003, 10, 1, _
</p>
<p>
    1899, 12, 31, _
</p>
<p>
    1899, 12, 30, _
</p>
<p>
    1899, 12, 29, _
</p>
<p>
    1899, 12, 28, _
</p>
<p>
    99, 10, 1, _
</p>
<p>
    3, 10, 1, _
</p>
<p>
    0, 1, 1, _
</p>
<p>
    -3, 10, 1, _
</p>
<p>
    -99, 10, 1, _
</p>
<p>
    -100, 10, 1, _
</p>
<p>
    -1800, 10, 1, _
</p>
<p>
    -1801, 10, 1)
</p>
<p>
    i = LBound(x)
</p>
<p>
    Do While i &lt; UBound(x)
</p>
<p>
    s = s &amp; DateSerial(x(i), x(i+1), x(i+2))
</p>
<p>
    s = s &amp; " &lt;= (" &amp; ToStrWithLen(x(i), 4) &amp; ","
</p>
<p>
    s = s &amp; ToStrWithLen(x(i+1), 3) &amp; ","
</p>
<p>
    s = s &amp; ToStrWithLen(x(i+2), 3) &amp; ")"
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    i = i + 3
</p>
<p>
    Loop
</p>
<p>
    MsgBox s
</p>
<p>
    Exit Sub
</p>
<p>
    OOPS:
</p>
<p>
    s = s &amp; ERROR
</p>
<p>
    Resume Next
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001210000010AE74A3E80.png" style="width:3.0102in;height:2.7709in" />
</p>
<p>
    <strong>Figure .</strong> DateSerial creates a date from a year, month, and day value.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                DateSerial adds 1900 to years earlier than 100, including negative years. An error is generated if the
                resulting year is still lower than 100. This allows years from -1800 through -1, which should probably
                be an error. The Date type is able to handle dates prior to 1/1/00, but obviously, DateSerial cannot.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Dates are printed based on the Gregorian calendar, but when the component parts are extracted, they are based on the
    Julian date.
</p>
<p>
    <strong>Listing .</strong> DateSerial accepts Gregorian dates before 10/15/1582.
</p>
<p>
    Print DateSerial(1582, 10, 15) '10/15/1582
</p>
<p>
    Print DateSerial(1582, 10, 14) '10/04/1582
</p>
<p>
    Print Day(DateSerial(1582, 10, 14)) '14
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="measuring-elapsed-time-over-short-intervals">
                    <span id="anchor-129"></span>Measuring elapsed time over short intervals
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    You can obtain simple elapsed time by subtracting two date values. For example, CLng(Now - CDate("1/1/2000"))
    determines the number of days elapsed since January 1, 2000. OOo Basic supports returning elapsed time as the number
    of seconds (Timer) and as the number of system ticks (GetSystemTicks). See . Internally, computers have a system
    timer that advances at a certain rate; the rate is hardware dependent. On Intel-based computers this value is
    1/17<sup>th</sup> of a second. Each time that the timer advances by 1, it’s called a “system tick.” The number
    returned by GetSystemTicks is always based on milliseconds, even if it relies on a less accurate clock.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Elapsed time functions in OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                GetSystemTicks
            </td>
            <td>
                Return the number of system ticks as a Long. The reported time is always in milliseconds, even if the
                underlying timer is less accurate.
            </td>
        </tr>
        <tr class="even">
            <td>
                Timer
            </td>
            <td>
                Return the number of seconds since midnight as a Date. Cast this to a Long.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use GetSystemTicks to get the system-dependent number of system timer ticks. This value is typically used to time
    internal operations because it has higher precision than the internal time and date functions (see and ). The return
    value is a Long.
</p>
<p>
    <strong>Listing .</strong> Measuring elapsed time.
</p>
<p>
    Sub ExampleElapsedTime
</p>
<p>
    Dim StartTicks As Long
</p>
<p>
    Dim EndTicks As Long
</p>
<p>
    Dim StartTime As Date
</p>
<p>
    Dim EndTime As Date
</p>
<p>
    StartTicks = GetSystemTicks()
</p>
<p>
    StartTime = Timer
</p>
<p>
    Wait(200) 'Pause execution for 0.2 seconds
</p>
<p>
    EndTicks = GetSystemTicks()
</p>
<p>
    EndTime = Timer
</p>
<p>
    MsgBox "After waiting 200 ms (0.2 seconds), " &amp; CHR$(10) &amp;_
</p>
<p>
    "System ticks = " &amp; CStr(EndTicks - StartTicks) &amp; CHR$(10) &amp;_
</p>
<p>
    "Time elapsed = " &amp; CStr((EndTime - StartTime)) &amp;_
</p>
<p>
    " seconds" &amp; CHR$(10), 0, "Elapsed Time"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000010300000074C7F5DB28.png" style="width:2.4917in;height:1.2189in" />
</p>
<p>
    <strong>Figure .</strong> GetSystemTicks has better resolution than Now.
</p>
<p>
    Run the macro in a few times. Sometimes it shows 0 seconds, and sometimes it shows 1 second. The resolution is too
    large for short duration items.
</p>
<p>
    The Timer function returns the number of seconds since midnight as a Date object. The problem with this is that at
    10 seconds past midnight, the return value is 10. The Date object, however, interprets 10 to mean “10 days”. Cast
    the returned type directly to a numerical type using CLng or CDbl to obtain the number of elapsed seconds.
</p>
<p>
    Dim nSeconds As Long
</p>
<p>
    nSeconds = Timer
</p>
<p>
    Print "Number of seconds = " &amp; nSeconds
</p>
<p>
    Print "Number of seconds = " &amp; Clng(Timer)
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The Timer function returns the number of seconds since midnight. Using Timer to determine elapsed time
                for spans that start before midnight and end after midnight produces useless results.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="how-fast-does-this-run-a-real-world-example">
                    <span id="anchor-130"></span>How fast does this run? A real-world example!
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The greatest common divisor (GCD) of two integers is the largest integer that divides both integers with no
    remainder. For example, the GCD of 6 and 9 is 3. The numbers 1 and 3 both divide the numbers 6 and 9 (see ). The
    greatest of these is 3.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Dividing 6 and 9 by integers.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                6
            </td>
            <td>
                9
            </td>
            <td>
                Yes
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                3
            </td>
            <td>
                4 remainder 1
            </td>
            <td>
                No
            </td>
        </tr>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
                2
            </td>
            <td>
                3
            </td>
            <td>
                Yes
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                1 remainder 2
            </td>
            <td>
                2 remainder 1
            </td>
            <td>
                No
            </td>
        </tr>
        <tr class="odd">
            <td>
                5
            </td>
            <td>
                1 remainder 1
            </td>
            <td>
                1 remainder 4
            </td>
            <td>
                No
            </td>
        </tr>
        <tr class="even">
            <td>
                6
            </td>
            <td>
                1
            </td>
            <td>
                1 remainder 3
            </td>
            <td>
                No
            </td>
        </tr>
        <tr class="odd">
            <td>
                7
            </td>
            <td>
                0 remainder 6
            </td>
            <td>
                1 remainder 2
            </td>
            <td>
                No
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                0 remainder 6
            </td>
            <td>
                1 remainder 1
            </td>
            <td>
                No
            </td>
        </tr>
        <tr class="odd">
            <td>
                9
            </td>
            <td>
                0 remainder 6
            </td>
            <td>
                1
            </td>
            <td>
                No
            </td>
        </tr>
    </tbody>
</table>
<p>
    This example begins around the year 300 B.C. with a guy living in ancient Greece named Euclid. Euclid was a pretty
    smart guy who wrote numerous books, including <em>Data</em>, concerning the solution of problems through geometric
    analysis, <em>On Divisions (of Figures)</em>, the <em>Optics</em>, the <em>Phenomena</em>, a paper on spherical
    geometry for astronomers, the <em>Elements</em>, a 13-volume textbook on geometry, and several lost works on higher
    geometry. His impact on society was huge. One of his most well-known contributions is an extremely efficient
    algorithm to solve the GCD problem. Now jump ahead a few thousand years to Olivier Bietzer, who noticed that I had
    an impractically slow algorithm for solving the GCD problem. Olivier, who certainly knows a lot about these things,
    wrote the macro in that solves the GCD problem using Euclid’s algorithm, and sent it to me.
</p>
<p>
    <strong>Listing .</strong> Calculate the GCD.
</p>
<p>
    'Author: Olivier Bietzer
</p>
<p>
    'e-mail: <a href="mailto:olivier.bietzer@laposte.net">olivier.bietzer@laposte.net</a>
</p>
<p>
    'This uses Euclid's algorithm and it is very fast!
</p>
<p>
    Function GCD_1(ByVal x As Long, ByVal y As Long) As Long
</p>
<p>
    Dim pgcd As Long, test As Long
</p>
<p>
    ' We must have x &gt;= y and positive values
</p>
<p>
    x=abs(x) : y=abs(y)
</p>
<p>
    If (x &lt; y) Then
</p>
<p>
    test = x : x = y : y = test
</p>
<p>
    End If
</p>
<p>
    If y = 0 Then Exit Function
</p>
<p>
    ' Euclid says ....
</p>
<p>
    pgcd = y ' by definition, PGCD is the smallest
</p>
<p>
    test = x MOD y ' remainder after division
</p>
<p>
    Do While (test) ' While not 0
</p>
<p>
    pgcd = test ' pgcd is the remainder
</p>
<p>
    x = y ' x,y and current pgcd permutation
</p>
<p>
    y = pgcd
</p>
<p>
    test = x MOD y ' test again
</p>
<p>
    Loop
</p>
<p>
    GCD_1 = pgcd ' pgcd is the last non 0 rest ! Magic ...
</p>
<p>
    End Function
</p>
<p>
    In general, the best way to speed up a solution to a computational problem is by using a better algorithm. The
    algorithm in runs roughly 1000 times faster than the routine that I had. If a faster algorithm is not available, you
    can look for other ways to improve performance. (Sometimes it’s possible to invent a wholly new and improved
    algorithm; but that is quite a trick! If you succeed in developing a new, faster algorithm for a widely known
    problem, you may have great career potential as a professional mathematics or computer science professor.) The code
    in is already pretty lean. There isn’t a whole lot to remove, but I thought that I could reduce the number of
    assignments (see ).
</p>
<p>
    <strong>Listing .</strong> Calculate the GCD (another way).
</p>
<p>
    Function GCD_2(ByVal x As Long, ByVal y As Long) As Long
</p>
<p>
    Dim pgcd As Long, test As Long
</p>
<p>
    ' We must have x &gt;= y and positive values
</p>
<p>
    x=abs(x) : y=abs(y)
</p>
<p>
    If (x &lt; y) Then
</p>
<p>
    test = x : x = y : y = test
</p>
<p>
    End If
</p>
<p>
    If y = 0 Then Exit Function
</p>
<p>
    Do While (y) ' While not 0
</p>
<p>
    pgcd = y ' pgcd is the remainder
</p>
<p>
    y = x MOD pgcd ' test again
</p>
<p>
    x = pgcd ' x,y and current pgcd permutation
</p>
<p>
    Loop
</p>
<p>
    GCD_2 = pgcd ' pgcd is the last non 0 remainder ! Magic ...
</p>
<p>
    End Function
</p>
<p>
    Now the question is, which function is faster? If you use a stopwatch to see how quickly I can blink, the results
    aren’t likely to be very accurate because of measurement errors. It’s much easier to tell me to blink as many times
    as I can in four seconds or to time how quickly I can blink 50 times. The code in does something similar. It sits in
    a tight loop and calls each GCD implementation 5000 times. I want to know how long it takes to call the GCD function
    5000 times, but I’m actually timing how long it takes to loop 5000 times, generate 10,000 random numbers, and call
    the GCD function 5000 times. To compensate for this, the amount of time required to loop 5000 times and generate
    10,000 random numbers is measured.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The test program takes a few seconds to run, so, be patient.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Time the two different GCD methods.
</p>
<p>
    Sub testGCD
</p>
<p>
    Dim nStartTicks As Long 'When I started timing
</p>
<p>
    Dim nEndTicks As Long 'When I stopped timing
</p>
<p>
    Dim nLoopTicks As Long 'Ticks to do only the loop
</p>
<p>
    Dim nGCD_1_Ticks As Long 'Ticks for GCD_1
</p>
<p>
    Dim nGCD_2_Ticks As Long 'Ticks for GCD_2
</p>
<p>
    Dim nMinIts As Long 'Number of iterations
</p>
<p>
    Dim x&amp;, y&amp;, i&amp;, n&amp; 'Temporary long numbers
</p>
<p>
    Dim s$ 'Hold the output string
</p>
<p>
    nMinIts = 5000 'Set the number of iterations
</p>
<p>
    Randomize(2) 'Set to a known state
</p>
<p>
    nStartTicks = GetSystemTicks() 'Start ticks
</p>
<p>
    For i&amp; = 1 To nMinIts 'Control the number of iterations
</p>
<p>
    x = 10000 * Rnd() 'Generate the random data
</p>
<p>
    y = 10000 * Rnd() 'Generate the random data
</p>
<p>
    Next
</p>
<p>
    nEndTicks = GetSystemTicks()
</p>
<p>
    nLoopTicks = nEndTicks - nStartTicks
</p>
<p>
    Randomize(2) 'Set to a known state
</p>
<p>
    nStartTicks = GetSystemTicks() 'Start ticks
</p>
<p>
    For i&amp; = 1 To nMinIts 'Control the number of iterations
</p>
<p>
    x = 10000 * Rnd() 'Generate the random data
</p>
<p>
    y = 10000 * Rnd() 'Generate the random data
</p>
<p>
    GCD_1(x, y) 'Do the work we really care about
</p>
<p>
    Next
</p>
<p>
    nEndTicks = GetSystemTicks()
</p>
<p>
    nGCD_1_Ticks = nEndTicks - nStartTicks - nLoopTicks
</p>
<p>
    Randomize(2) 'Set to a known state
</p>
<p>
    nStartTicks = GetSystemTicks() 'Start ticks
</p>
<p>
    For i&amp; = 1 To nMinIts 'Control the number of iterations
</p>
<p>
    x = 10000 * Rnd() 'Generate the random data
</p>
<p>
    y = 10000 * Rnd() 'Generate the random data
</p>
<p>
    GCD_2(x, y) 'Do the work we really care about
</p>
<p>
    Next
</p>
<p>
    nEndTicks = GetSystemTicks()
</p>
<p>
    nGCD_2_Ticks = nEndTicks - nStartTicks - nLoopTicks
</p>
<p>
</p>
<p>
    s = "Looping " &amp; nMinIts &amp; " iterations takes " &amp; nLoopTicks &amp;_
</p>
<p>
    " ticks" &amp; CHR$(10) &amp;_
</p>
<p>
    "Calling GCD_1 takes " &amp; nGCD_1_Ticks &amp; " ticks or " &amp;_
</p>
<p>
    Format(nMinIts * 100 /nGCD_1_Ticks, "#####00.00") &amp;_
</p>
<p>
    " Iterations per second" &amp; CHR$(10) &amp;_
</p>
<p>
    "Calling GCD_2 takes " &amp; nGCD_2_Ticks &amp; " ticks or " &amp;_
</p>
<p>
    Format(nMinIts * 100 /nGCD_2_Ticks, "#####00.00") &amp;_
</p>
<p>
    " Iterations per second"
</p>
<p>
    MsgBox s, 0, "Compare GCD"
</p>
<p>
    End Sub
</p>
<p>
    One problem in writing timing routines is determining how many iterations to do. I frequently use computers of
    different speeds. The results in are based on my home computer running the macro in . The macro in makes a specific
    number of iterations. Sometimes I use a solution that limits the iterations based on time rather than number of
    iterations. This complicates the measurement of overhead and is left as an interesting, but not overly difficult,
    problem for the reader.
</p>
<p>
    <img src="Pictures/10000000000001B200000074458D7A9E.png" style="width:4.5201in;height:1.2098in" />
</p>
<p>
    <strong>Figure .</strong> The improvement is about 10 percent.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="long-time-intervals-and-special-dates">
                    <span id="anchor-131"></span>Long time intervals and special dates
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    It’s easy to obtain elapsed time over long intervals by subtracting date values. To determine precise dates and
    intervals, you can creatively use the component pieces. For example, given the date, what is the first day of the
    month? This is easy because the first day of every month is day 1. Use the functions Year and Month to extract the
    year and month, and then reassemble the date using DateSerial and set the day to 1. The sample macro also calls
    WeekDayText shown in .
</p>
<p>
    <strong>Listing .</strong> First day of the month.
</p>
<p>
    Function FirstDayOfMonth(d As Date) As Date
</p>
<p>
    FirstDayOfMonth() = DateSerial(Year(d), Month(d), 1)
</p>
<p>
    End Function
</p>
<p>
    Sub FirstDayOfThisMonth()
</p>
<p>
    Dim d As Date
</p>
<p>
    d = FirstDayOfMonth(Now())
</p>
<p>
    MsgBox "First day of this month (" &amp; d &amp; ") is a " &amp; WeekDayText(d)
</p>
<p>
    End Sub
</p>
<p>
    To find the last day of a month, find the first day of the next month and then subtract 1 from the number. If the
    current month is December, set the month to January and increment the year by 1.
</p>
<p>
    <strong>Listing .</strong> Last day of the month.
</p>
<p>
    Function LastDayOfMonth(d As Date) As Date
</p>
<p>
    Dim nYear As Integer
</p>
<p>
    Dim nMonth As Integer
</p>
<p>
    nYear = Year(d) 'Current year
</p>
<p>
    nMonth = Month(d) + 1 'Next month, unless it was December.
</p>
<p>
    If nMonth &gt; 12 Then 'If it is December then nMonth is now 13
</p>
<p>
    nMonth = 1 'Roll the month back to 1
</p>
<p>
    nYear = nYear + 1 'but increment the year
</p>
<p>
    End If
</p>
<p>
    LastDayOfMonth = CDate(DateSerial(nYear, nMonth, 1)-1)
</p>
<p>
    End Function
</p>
<p>
    Sub LastDayOfThisMonth()
</p>
<p>
    Dim d As Date
</p>
<p>
    d = LastDayOfMonth(Now())
</p>
<p>
    MsgBox "Last day of this month (" &amp; d &amp; ") is a " &amp; WeekDayText(d)
</p>
<p>
    End Sub
</p>
<p>
    It’s easy to find the first day of the year for any given date; it’s always January 1 of that year. Use the Year
    function to obtain the current year and then set the day and month each equal to 1. Finding the last day of the year
    for any given date is only marginally more difficult. First, find the first day of the next year by incrementing the
    year by 1 and setting the month and day equal to 1. Subtracting 1 from the first day of next year provides the last
    day of this year.
</p>
<p>
    d = Now
</p>
<p>
    Print DateSerial(Year(d), 1, 1) '01/01/2003
</p>
<p>
    Print CDate(DateSerial(Year(d)+1, 1, 1)-1) '12/31/2003
</p>
<p>
    Use the WeekDay function to find the first and last days of a week. Subtract the day of the week and add 1 to take
    the date to Sunday at the beginning of the current week.
</p>
<p>
    d = Date
</p>
<p>
    Print CDate(CDbl(d) - WeekDay(d) + 1) '8/10/2003 is a Sunday
</p>
<p>
    Print CDate(CDbl(d) - WeekDay(d) + 7) '8/16/2003 is a Saturday
</p>
<p>
    You can use similar date manipulations to solve other date-related problems, such as determining the work week, how
    many days until your anniversary, or the age of a person in years, months, and days.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-4">
                    <span id="anchor-132"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Although dates in OpenOffice.org Basic are straightforward and easy to use, you must take care with dates prior to
    October 15, 1582. The jump from the Gregorian and Julian calendar also may potentially cause unexpected problems.
    Also take care when the underlying implementation, a Double, becomes a negative number; this happens around December
    30, 1899. This chapter also discussed methods of timing routines and determining specific dates.
</p>
<ol type="1">
    <li>
        <h1 id="string-routines">
            <span id="anchor-133"></span>String Routines
        </h1>
    </li>
</ol>
<p>
    This chapter introduces the subroutines and functions supported by OpenOffice.org Basic that are related to strings.
    This includes functions to manipulate strings, convert other data types to strings, and to perform special
    formatting.
</p>
<p>
    Text data is stored in strings as a sequence of 16-bit unsigned integer Unicode version 2.0 values. The Unicode
    Worldwide Character Standard is a set of binary codes representing textual or script characters designed because
    ASCII, the original standard, can handle only 256 distinct characters. The first 128 characters (numbered 0 through
    127) correspond to the letters and symbols on a standard U.S. keyboard. The next 128 characters (numbered 128
    through 255) consist of special characters such as accent marks, Latin-based characters, and a few symbols. The
    remaining 65,280 values<em><em> — </em></em>of which only about 34,000 are currently used<em><em> — </em></em>are
    used for a wide variety of worldwide text characters, mathematical symbols, accent marks (diacritics), and technical
    symbols.
</p>
<p>
    OpenOffice.org has a large number of functions that allow you to manipulate strings. These string-manipulation
    operations range from converting uppercase to lowercase (or vice versa) to selecting substrings out of a longer
    string. The functions listed in are the string functions covered in this chapter. The functions listed in are
    related to strings as well as either numerical or array manipulations; these are covered in other chapters.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> These string-related functions are
    covered in this section.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                ASC(str)
            </td>
            <td>
                Return the integer ASCII value of the first character in the string. This supports 16-bit Unicode values
                as well.
            </td>
        </tr>
        <tr class="even">
            <td>
                CHR(n)
            </td>
            <td>
                Convert an ASCII number to a character.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CStr(obj)
            </td>
            <td>
                Convert standard types to a string.
            </td>
        </tr>
        <tr class="even">
            <td>
                Format(obj, format)
            </td>
            <td>
                Fancy formatting; works only for strings.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Hex(n)
            </td>
            <td>
                Return the hexadecimal representation of a number as a string.
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    InStr(str, str)
                </p>
                <p>
                    InStr(start, str, str)
                </p>
                <p>
                    InStr(start, str, str, mode)
                </p>
            </td>
            <td>
                Attempt to find string 2 in string 1. Returns 0 if not found and starting location if it is found. The
                optional start argument indicates where to start looking. The default value for mode is 1
                (case-insensitive comparison). Setting mode to 0 performs a case-sensitive comparison.
            </td>
        </tr>
        <tr class="odd">
            <td>
                InStrRev(str, find, start, mode)
            </td>
            <td>
                Return the position of the first occurrence of one string within another, starting from the right side
                of the string. Only available with “Option VBASupport 1”. Start and mode are optional.
            </td>
        </tr>
        <tr class="even">
            <td>
                Join(s())<br /> Join(s(), str)
            </td>
            <td>
                Concatenate the array elements, separated by the optional string delimiter, and return the value as a
                string. The default delimiter is a single space. Inverse of the Split function.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LCase(str)
            </td>
            <td>
                Return a lowercase copy of the string.
            </td>
        </tr>
        <tr class="even">
            <td>
                Left(str, n)
            </td>
            <td>
                Return the leftmost n characters from the string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Len(str)
            </td>
            <td>
                Return the length of the string.
            </td>
        </tr>
        <tr class="even">
            <td>
                LSet str1 = str2
            </td>
            <td>
                Left-justify a string into the space taken by another string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LTrim(str)
            </td>
            <td>
                Return a copy of the string with all leading spaces removed.
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    Mid(str, start)
                </p>
                <p>
                    Mid(str, start, len)
                </p>
                <p>
                    Mid(str, start, len, str)
                </p>
            </td>
            <td>
                Return the substring, starting at start. If the length is omitted, the entire end of the string is
                returned. If the final string argument is included, this replaces the specified portion of the first
                string with the last string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Oct(n)
            </td>
            <td>
                Return the octal representation of a number as a string.
            </td>
        </tr>
        <tr class="even">
            <td>
                Replace(str, find, rpl, start, count, mode)
            </td>
            <td>
                Search str for find and replace it with rpl. Optionally, specify the start, count, and mode.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Right(str, n)
            </td>
            <td>
                Return the rightmost n characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                RSet str1 = str2
            </td>
            <td>
                Right-justify a string into the space taken by another string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                RTrim(str)
            </td>
            <td>
                Return a copy of the string with all trailing spaces removed.
            </td>
        </tr>
        <tr class="even">
            <td>
                Space(n)
            </td>
            <td>
                Return a string with the number of specified spaces.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    Split(str)
                </p>
                <p>
                    Split(str, str)
                </p>
            </td>
            <td>
                Split a string into an array based on an optional delimiter. Inverse of the Join function.
            </td>
        </tr>
        <tr class="even">
            <td>
                Str(n)
            </td>
            <td>
                Convert a number to a string with no localization.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    StrComp(s1, s2)
                </p>
                <p>
                    StrComp(s1, s2, mode)
                </p>
            </td>
            <td>
                Compare two strings returning -1, 0, or 1 if the first string is less than, equal to, or greater than
                the second in alphabetical order. Set the optional third argument to zero for a case-insensitive
                comparison. The default is 1 for a case-sensitive comparison.
            </td>
        </tr>
        <tr class="even">
            <td>
                StrConv(str, mode[, local])
            </td>
            <td>
                Converts a string based on the mode: 1=upper, 2=lower, 4=wide, 8=narrow, 16=Katakana, 32=Hiragana, 64=to
                unicode, 128=from unicode.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    String(n, char)
                </p>
                <p>
                    String(n, ascii)
                </p>
            </td>
            <td>
                Return a string with a single character repeated multiple times. The first argument is the number of
                times to repeat; the second argument is the character or ASCII value.
            </td>
        </tr>
        <tr class="even">
            <td>
                StrReverse
            </td>
            <td>
                Reverse a string. Must use “Option VBASupport 1”, or precede it with CompatibiltyMode(True).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Trim(str)
            </td>
            <td>
                Return a copy of the string with all leading and trailing spaces removed.
            </td>
        </tr>
        <tr class="even">
            <td>
                UCase(str)
            </td>
            <td>
                Return an uppercase copy of the string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Val(str)
            </td>
            <td>
                Convert a string to a double. This is very tolerant to non-numeric text.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The subroutines and functions related to string handling in OOo Basic are listed in . Some of these functions (see )
    have in-depth coverage in other chapters, because they are directly related to the content in those chapters. They
    are covered briefly near the end of this chapter, in the section titled “Converting data to a string.”
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> These string-related functions are
    covered in other chapters.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Join(s())<br /> Join(s(), str)
            </td>
            <td>
                <a href="#anchor-112">5</a><a href="#anchor-112">Array Routines</a>
            </td>
            <td>
                Concatenate the array elements, separated by the optional string delimiter, and return the value as a
                string.
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    Split(str)
                </p>
                <p>
                    Split(str, str)
                </p>
            </td>
            <td>
                <a href="#anchor-112">5</a><a href="#anchor-112">Array Routines</a>
            </td>
            <td>
                Split a string into an array based on an optional delimiter.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CStr(obj)
            </td>
            <td>
                <a href="#anchor-102">4</a><a href="#anchor-102">Numerical Routines</a>
            </td>
            <td>
                Convert standard types to a string.
            </td>
        </tr>
        <tr class="even">
            <td>
                Str(n)
            </td>
            <td>
                <a href="#anchor-102">4</a><a href="#anchor-102">Numerical Routines</a>
            </td>
            <td>
                Convert a number to a string with no localization.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Hex(n)
            </td>
            <td>
                <a href="#anchor-102">4</a><a href="#anchor-102">Numerical Routines</a>
            </td>
            <td>
                Return the hexadecimal representation of a number as a string.
            </td>
        </tr>
        <tr class="even">
            <td>
                Oct(n)
            </td>
            <td>
                <a href="#anchor-102">4</a><a href="#anchor-102">Numerical Routines</a>
            </td>
            <td>
                Return the octal representation of a number as a string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Val(str)
            </td>
            <td>
                <a href="#anchor-102">4</a><a href="#anchor-102">Numerical Routines</a>
            </td>
            <td>
                Convert a string to a double. This is very tolerant to non-numeric text.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="ascii-and-unicode-values">
                    <span id="anchor-134"></span>ASCII and Unicode values
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    In the early days of computers there were different types of data-processing equipment, and there was no common
    method of representing text. To alleviate this problem, the American National Standards Institute (ANSI) proposed
    the American Standard Code for Information Interchange (ASCII) in 1963. The standard was finalized in 1968 as a
    mapping of 128 characters, numbers, punctuation, and control codes to the numbers from 0 to 127 (see ). The
    computer-minded reader may notice that this requires 7 bits and does not use an entire byte.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> The original 128 ASCII characters.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                NUL
            </td>
            <td>
                SOH
            </td>
            <td>
                STX
            </td>
            <td>
                ETX
            </td>
            <td>
                EOT
            </td>
            <td>
                ENQ
            </td>
            <td>
                ACK
            </td>
            <td>
                BEL
            </td>
            <td>
                BS
            </td>
            <td>
                HT
            </td>
            <td>
                LF
            </td>
            <td>
                VT
            </td>
            <td>
                FF
            </td>
            <td>
                CR
            </td>
            <td>
                SO
            </td>
            <td>
                SI
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                DLE
            </td>
            <td>
                DC1
            </td>
            <td>
                DC2
            </td>
            <td>
                DC3
            </td>
            <td>
                DC4
            </td>
            <td>
                NAK
            </td>
            <td>
                SYN
            </td>
            <td>
                ETB
            </td>
            <td>
                CAN
            </td>
            <td>
                EM
            </td>
            <td>
                SUB
            </td>
            <td>
                ESC
            </td>
            <td>
                FS
            </td>
            <td>
                GS
            </td>
            <td>
                RS
            </td>
            <td>
                US
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                SP
            </td>
            <td>
                !
            </td>
            <td>
                “
            </td>
            <td>
                #
            </td>
            <td>
                $
            </td>
            <td>
                %
            </td>
            <td>
                &amp;
            </td>
            <td>
                '
            </td>
            <td>
                (
            </td>
            <td>
                )
            </td>
            <td>
                *
            </td>
            <td>
                +
            </td>
            <td>
                ,
            </td>
            <td>
                -
            </td>
            <td>
                .
            </td>
            <td>
                /
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                0
            </td>
            <td>
                1
            </td>
            <td>
                2
            </td>
            <td>
                3
            </td>
            <td>
                4
            </td>
            <td>
                5
            </td>
            <td>
                6
            </td>
            <td>
                7
            </td>
            <td>
                8
            </td>
            <td>
                9
            </td>
            <td>
                :
            </td>
            <td>
                ;
            </td>
            <td>
                &lt;
            </td>
            <td>
                =
            </td>
            <td>
                &gt;
            </td>
            <td>
                ?
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                @
            </td>
            <td>
                A
            </td>
            <td>
                B
            </td>
            <td>
                C
            </td>
            <td>
                D
            </td>
            <td>
                E
            </td>
            <td>
                F
            </td>
            <td>
                G
            </td>
            <td>
                H
            </td>
            <td>
                I
            </td>
            <td>
                J
            </td>
            <td>
                K
            </td>
            <td>
                L
            </td>
            <td>
                M
            </td>
            <td>
                N
            </td>
            <td>
                O
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                P
            </td>
            <td>
                Q
            </td>
            <td>
                R
            </td>
            <td>
                S
            </td>
            <td>
                T
            </td>
            <td>
                U
            </td>
            <td>
                V
            </td>
            <td>
                W
            </td>
            <td>
                X
            </td>
            <td>
                Y
            </td>
            <td>
                z
            </td>
            <td>
                [
            </td>
            <td>
                \
            </td>
            <td>
                ]
            </td>
            <td>
                ^
            </td>
            <td>
                _
            </td>
        </tr>
        <tr class="odd">
            <td>
                6
            </td>
            <td>
                `
            </td>
            <td>
                a
            </td>
            <td>
                b
            </td>
            <td>
                c
            </td>
            <td>
                d
            </td>
            <td>
                e
            </td>
            <td>
                f
            </td>
            <td>
                g
            </td>
            <td>
                h
            </td>
            <td>
                i
            </td>
            <td>
                j
            </td>
            <td>
                k
            </td>
            <td>
                l
            </td>
            <td>
                m
            </td>
            <td>
                n
            </td>
            <td>
                o
            </td>
        </tr>
        <tr class="even">
            <td>
                7
            </td>
            <td>
                p
            </td>
            <td>
                q
            </td>
            <td>
                r
            </td>
            <td>
                s
            </td>
            <td>
                t
            </td>
            <td>
                u
            </td>
            <td>
                v
            </td>
            <td>
                w
            </td>
            <td>
                x
            </td>
            <td>
                y
            </td>
            <td>
                z
            </td>
            <td>
                {
            </td>
            <td>
                |
            </td>
            <td>
                }
            </td>
            <td>
                ~
            </td>
            <td>
                DEL
            </td>
        </tr>
    </tbody>
</table>
<p>
    lists the original 127 ASCII characters. The top row and the left column are used to identify the hexadecimal ASCII
    value. For example, the capital letter A has an ASCII value of 41 in hexadecimal format, and z has an ASCII value of
    5A. If more than one letter occupies a box, that value represents a special command character (see ). Some of these
    special commands are designed for communications, some for file formats, and some are even available on the
    keyboard.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Non-printable ASCII characters.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                00
            </td>
            <td>
                0
            </td>
            <td>
                NUL
            </td>
            <td>
                Null, usually signifying nothing
            </td>
        </tr>
        <tr class="even">
            <td>
                01
            </td>
            <td>
                1
            </td>
            <td>
                SOH
            </td>
            <td>
                Start of heading
            </td>
        </tr>
        <tr class="odd">
            <td>
                02
            </td>
            <td>
                2
            </td>
            <td>
                STX
            </td>
            <td>
                Start of text
            </td>
        </tr>
        <tr class="even">
            <td>
                03
            </td>
            <td>
                3
            </td>
            <td>
                ETX
            </td>
            <td>
                End of text
            </td>
        </tr>
        <tr class="odd">
            <td>
                04
            </td>
            <td>
                4
            </td>
            <td>
                EOT
            </td>
            <td>
                End of transmission<em><em> — </em></em>not the same as ETB
            </td>
        </tr>
        <tr class="even">
            <td>
                05
            </td>
            <td>
                5
            </td>
            <td>
                ENQ
            </td>
            <td>
                Enquiry
            </td>
        </tr>
        <tr class="odd">
            <td>
                06
            </td>
            <td>
                6
            </td>
            <td>
                ACK
            </td>
            <td>
                Acknowledge<em><em> — </em></em>I am here or data successfully received
            </td>
        </tr>
        <tr class="even">
            <td>
                07
            </td>
            <td>
                7
            </td>
            <td>
                BEL
            </td>
            <td>
                Bell<em><em> — </em></em>Causes teletype machines and many terminals to ring a bell
            </td>
        </tr>
        <tr class="odd">
            <td>
                08
            </td>
            <td>
                8
            </td>
            <td>
                BS
            </td>
            <td>
                Backspace<em><em> — </em></em>Moves the cursor or print head backward (left) one space
            </td>
        </tr>
        <tr class="even">
            <td>
                09
            </td>
            <td>
                9
            </td>
            <td>
                TAB
            </td>
            <td>
                Horizontal tab<em><em> — </em></em>Moves the cursor (or print head) right to the next tab stop
            </td>
        </tr>
        <tr class="odd">
            <td>
                0A
            </td>
            <td>
                10
            </td>
            <td>
                LF
            </td>
            <td>
                Line feed or new line<em><em> — </em></em>Moves the cursor (or print head) to a new line
            </td>
        </tr>
        <tr class="even">
            <td>
                0B
            </td>
            <td>
                11
            </td>
            <td>
                VT
            </td>
            <td>
                Vertical tab
            </td>
        </tr>
        <tr class="odd">
            <td>
                0C
            </td>
            <td>
                12
            </td>
            <td>
                FF
            </td>
            <td>
                Form feed<em><em> — </em></em>Advances paper to the top of the next page
            </td>
        </tr>
        <tr class="even">
            <td>
                0D
            </td>
            <td>
                13
            </td>
            <td>
                CR
            </td>
            <td>
                Carriage return<em><em> — </em></em>Moves the cursor (or print head) to the left margin
            </td>
        </tr>
        <tr class="odd">
            <td>
                0E
            </td>
            <td>
                14
            </td>
            <td>
                SO
            </td>
            <td>
                Shift out<em><em> — </em></em>Switches the output device to an alternate character set
            </td>
        </tr>
        <tr class="even">
            <td>
                0F
            </td>
            <td>
                15
            </td>
            <td>
                SI
            </td>
            <td>
                Shift in<em><em> — </em></em>Switches the output device back to the default character set
            </td>
        </tr>
        <tr class="odd">
            <td>
                10
            </td>
            <td>
                16
            </td>
            <td>
                DLE
            </td>
            <td>
                Data link escape
            </td>
        </tr>
        <tr class="even">
            <td>
                11
            </td>
            <td>
                17
            </td>
            <td>
                DC1
            </td>
            <td>
                Device control 1
            </td>
        </tr>
        <tr class="odd">
            <td>
                12
            </td>
            <td>
                18
            </td>
            <td>
                DC2
            </td>
            <td>
                Device control 2
            </td>
        </tr>
        <tr class="even">
            <td>
                13
            </td>
            <td>
                19
            </td>
            <td>
                DC3
            </td>
            <td>
                Device control 3
            </td>
        </tr>
        <tr class="odd">
            <td>
                14
            </td>
            <td>
                20
            </td>
            <td>
                DC4
            </td>
            <td>
                Device control 4
            </td>
        </tr>
        <tr class="even">
            <td>
                15
            </td>
            <td>
                21
            </td>
            <td>
                NAK
            </td>
            <td>
                Negative acknowledge
            </td>
        </tr>
        <tr class="odd">
            <td>
                16
            </td>
            <td>
                22
            </td>
            <td>
                SYN
            </td>
            <td>
                Synchronous idle
            </td>
        </tr>
        <tr class="even">
            <td>
                17
            </td>
            <td>
                23
            </td>
            <td>
                ETB
            </td>
            <td>
                End of transmission block<em><em> — </em></em>not the same as EOT
            </td>
        </tr>
        <tr class="odd">
            <td>
                18
            </td>
            <td>
                24
            </td>
            <td>
                CAN
            </td>
            <td>
                Cancel
            </td>
        </tr>
        <tr class="even">
            <td>
                19
            </td>
            <td>
                25
            </td>
            <td>
                EM
            </td>
            <td>
                End of medium
            </td>
        </tr>
        <tr class="odd">
            <td>
                1A
            </td>
            <td>
                26
            </td>
            <td>
                SUB
            </td>
            <td>
                Substitute
            </td>
        </tr>
        <tr class="even">
            <td>
                1B
            </td>
            <td>
                27
            </td>
            <td>
                ESC
            </td>
            <td>
                Escape<em><em> — </em></em>This is the Esc key on your keyboard
            </td>
        </tr>
        <tr class="odd">
            <td>
                1C
            </td>
            <td>
                28
            </td>
            <td>
                FS
            </td>
            <td>
                File separator
            </td>
        </tr>
        <tr class="even">
            <td>
                1D
            </td>
            <td>
                29
            </td>
            <td>
                GS
            </td>
            <td>
                Group separator
            </td>
        </tr>
        <tr class="odd">
            <td>
                1E
            </td>
            <td>
                30
            </td>
            <td>
                RS
            </td>
            <td>
                Record separator
            </td>
        </tr>
        <tr class="even">
            <td>
                1F
            </td>
            <td>
                31
            </td>
            <td>
                US
            </td>
            <td>
                Unit separator
            </td>
        </tr>
        <tr class="odd">
            <td>
                7F
            </td>
            <td>
                127
            </td>
            <td>
                DEL
            </td>
            <td>
                Delete<em><em> — </em></em>This is the Del key on your keyboard
            </td>
        </tr>
    </tbody>
</table>
<p>
    For most computers, the smallest easily stored and retrieved piece of data is a byte, which is composed of 8 bits.
    The characters in require only 7 bits. To avoid wasting space, the Extended ASCII characters were introduced; these
    used the numbers 128 through 255. Although these characters introduce special, mathematical, graphic, and foreign
    characters, it just wasn’t enough to satisfy international use. Around 1986, Xerox started working to extend the
    character set to work with Asian characters. This work eventually led to the current Unicode set, which uses 16-bit
    integers and allows for 65,536 unique characters.
</p>
<p>
    OOo stores characters as 16-bit unsigned integer Unicode values. The ASC and CHR functions convert between the
    integer value and the character value, for example, between 65 and A. Use the ASC function to determine the
    numerical ASCII value of the first character in a string. The return value is a 16-bit integer allowing for Unicode
    values. Only the first character in the string is used; the rest of the characters are ignored. A run-time error
    occurs if the string has zero length. This is essentially the inverse of the CHR$ function, which converts the
    number back into a character.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The CHR function is frequently written as CHR$. In Visual Basic, CHR$ returns a string and can’t handle
                null input values, and CHR returns a variant that’s able to accept and propagate null values. In OOo
                Basic, they are the same; they both return strings and they both generate a run-time error with a null
                input value.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the CHR function to convert a 16-bit ASCII value to the character that it represents. This is useful when you
    want to insert special characters into a string. For example, CHR(10) is the new-line character. The CHR function is
    the inverse of the ASC function. Although the ASC function returns the Unicode numbers, these numbers are frequently
    generically referred to as “the ASCII value.” Strictly speaking, this is incorrect, but it’s a widely used slang
    expression. The numbers correspond directly to the ASCII values for the numbers 0 through 255, and having used the
    terminology for years, programmers aren’t likely to stop. So, when you see the term “ASCII value” in this book,
    think “Unicode value.”
</p>
<p>
    <strong>Listing .</strong> Demonstrate new line.
</p>
<p>
    Sub ShowChrAsc
</p>
<p>
    Dim s$
</p>
<p>
    Print CHR$(65) 'A
</p>
<p>
    Print ASC("Andrew") '65
</p>
<p>
    s = "1" &amp; CHR$(10) &amp; "2" 'New line between 1 and 2
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Use the MsgBox statement to print strings that contain CHR$(10) or CHR$(13) — they both cause OOo Basic
                to print a new line. The Print statement displays a new dialog for each new line. MsgBox, however,
                properly displays new lines in a single dialog.
            </td>
        </tr>
    </tbody>
</table>
<p>
    While attempting to decipher the internal functions of OpenOffice.org, I frequently find strings that contain
    characters that aren’t immediately visible, such as trailing spaces, new lines, and carriage returns. Converting the
    string to a sequence of ASCII characters simplifies the process of recognizing the true contents of the string. See
    and .
</p>
<p>
    <strong>Listing .</strong> Convert a string to ASCII.
</p>
<p>
    Sub ExampleStringToASCII
</p>
<p>
    Dim s As String
</p>
<p>
    s = "AB"""" """"BA"
</p>
<p>
    MsgBox s &amp; CHR$(10) &amp; StringToASCII(s), 0, "String To ASCII"
</p>
<p>
    End Sub
</p>
<p>
    Function StringToASCII(sInput$) As String
</p>
<p>
    Dim s As String
</p>
<p>
    Dim i As Integer
</p>
<p>
    For i = 1 To Len(sInput$)
</p>
<p>
    s = s &amp; CStr(ASC(Mid(sInput$, i, 1))) &amp; " "
</p>
<p>
    Next
</p>
<p>
    StringToASCII = s
</p>
<p>
    End Function
</p>
<p>
    <strong>Figure .</strong> A string followed by its corresponding ASCII values: A=65, B=66, "=34, and so on ...
</p>
<p>
    On more than one occasion, I needed to know exactly how OOo stored data in a text document. One common example is
    trying to manipulate new lines and new paragraphs in a manner not easily supported by regular expressions. The
    subroutine in displays the currently selected text as a string of ASCII values. The important thing to learn in this
    chapter is how to view the ASCII values associated with the text. This will show the characters used between
    paragraphs, for example. The methods to properly retrieve and manipulate selected text are covered later. To test
    this macro, select run the macro.
</p>
<p>
    <strong>Listing .</strong> Display the selected text as ASCII characters.
</p>
<p>
    Sub SelectedTextAsASCII()
</p>
<p>
    Dim vSelections 'Multiple disjointed selections
</p>
<p>
    Dim vSel 'A single selection
</p>
<p>
    Dim vCursor 'OOo document cursor
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
    Dim s As String 'Temporary utility string variable
</p>
<p>
    Dim bIsSelected As Boolean 'Is any text selected?
</p>
<p>
    bIsSelected = True 'Assume that text is selected
</p>
<p>
</p>
<p>
    'The current selection in the current controller.
</p>
<p>
    'If there is no current controller, it returns NULL.
</p>
<p>
    'Thiscomponent refers to the current document
</p>
<p>
    vSelections = ThisComponent.getCurrentSelection()
</p>
<p>
    If IsNull(vSelections) OR IsEmpty(vSelections) Then
</p>
<p>
    bIsSelected = False
</p>
<p>
    ElseIf vSelections.getCount() = 0 Then
</p>
<p>
    bIsSelected = False
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    If NOT bIsSelected Then 'If nothing is selected then say so
</p>
<p>
    Print "Nothing is selected" 'and then exit the subroutine
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    'The selections are numbered from zero
</p>
<p>
    'Print the ASCII values of each
</p>
<p>
    For i = 0 To vSelections.getCount() - 1
</p>
<p>
    vSel = vSelections.getByIndex(i)
</p>
<p>
    vCursor = ThisComponent.Text.CreateTextCursorByRange(vSel)
</p>
<p>
    s = vCursor.getString()
</p>
<p>
    If Len(s) &gt; 0 Then
</p>
<p>
    MsgBox StringToASCII(vCursor.getString()), 0, "ASCII of Selection " &amp; i
</p>
<p>
    ElseIf vSelections.getCount() = 1 Then
</p>
<p>
    Print "Nothing is selected"
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="standard-string-functions">
                    <span id="anchor-135"></span>Standard string functions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The comparison operators (=, &lt;, &lt;=, &gt;, &gt;=, and &lt;&gt;) work with strings and numbers performing a
    case-sensitive comparisons. This means that the strings “a” and “A” are not equal. The built-in StrComp function can
    compare strings with and without case sensitivity. The StrComp function, which defaults to a case-sensitive
    comparison, returns -1, 0, or 1 if the first string argument is less than, equal to, or greater than the second
    string argument. Set the optional third argument to zero for a case-insensitive comparison.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Use StrComp(string1, string2, 0) to alphabetize strings using a locale based case-sensitive compare.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The following pseudo code shows a simplified version of how StrComp could work for a case-sensitive comparison. A
    case-insensitive comparison would convert both strings to all uppercase before performing the comparison; I have no
    idea if StrComp is locale specific.
</p>
<p>
    Let s1 = string1
</p>
<p>
    Let s2 = string2
</p>
<p>
    Let min_len = minimum(Len(s1), Len(s2))
</p>
<p>
    For i = 1 To min_len
</p>
<p>
    If ASC(Mid(s1, i, 1)) &lt; ASC(Mid(s2, i, 1)) Then
</p>
<p>
    set return value to -1
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    If ASC(Mid(s1, i, 1)) &gt; ASC(Mid(s2, i, 1)) Then
</p>
<p>
    set return value to 1
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    If Len(s1) &lt; Len(s2) Then
</p>
<p>
    set return value to -1
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    If Len(s1) &gt; Len(s2) Then
</p>
<p>
    set return value to 1
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    set return value to 0
</p>
<p>
    Exit Function
</p>
<p>
    The numerical Unicode value of the first character in the first string is compared to the numerical Unicode value of
    the first character in the second string. If the first character is numerically less than the second character, -1
    is returned. If the first character is numerically greater than the second character, 1 is returned. If the first
    character in each string is the same, the second character in each string is compared. If the corresponding
    numerical Unicode value of each character is the same and the strings are the same length, 0 is returned. If
    corresponding characters all match, but the strings are of different lengths, the shorter string is considered less
    than the longer string.
</p>
<p>
    <strong>Listing .</strong> Demonstrate StrComp.
</p>
<p>
    Print StrComp( "A", "AA") '-1 because "A" &lt; "AA"
</p>
<p>
    Print StrComp("AA", "AA") ' 0 because "AA" = "AA"
</p>
<p>
    Print StrComp("AA", "A") ' 1 because "AA" &gt; "A"
</p>
<p>
    Print StrComp( "a", "A") ' 1 because "a" &gt; "A"
</p>
<p>
    Print StrComp( "a", "A", 1)' 1 because "a" &gt; "A"
</p>
<p>
    Print StrComp( "a", "A", 0)' 0 because "a" = "A" if case is ignored
</p>
<p>
    Use the UCase and LCase functions to return a copy of the string with all characters in uppercase or lowercase.
</p>
<p>
    <strong>Listing .</strong> Demonstrate UCase and LCase.
</p>
<p>
    S$ = "Las Vegas"
</p>
<p>
    Print LCase(s) REM Returns "las vegas"
</p>
<p>
    Print UCase(s) REM Returns "LAS VEGAS"
</p>
<p>
    If numerous comparisons will be made, using LCase or UCase is sometimes faster than performing a case-insensitive
    comparison each time. And sometimes, it is simply easier to use.
</p>
<p>
    If LCase(Right(sFileName, 3)) = "odt" Then
</p>
<p>
    Use StrConv(string, mode, locale_id) to convert a string with more flexibility than the individual methods UCase and
    LCase. The supported modes (shown in ) are bit values that can be used together; for example, 1+64=65 causes all
    characters to be converted to uppercase and to Unicode. The final argument, locale_id, is an optional integer locale
    identifier that is not currently supported (as of OOo version 3.2.1)
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Modes supported by the StrConv
    statement.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                No change.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                Convert all characters to uppercase.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                Convert all characters to lowercase.
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                Convert narrow (half-width) characters in the string to wide (full-width) characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                8
            </td>
            <td>
                Convert wide (full-width) characters in the string to narrow (half-width) characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                16
            </td>
            <td>
                Convert Hiragana characters in the string to Katakana characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                32
            </td>
            <td>
                Convert Katakana characters in the string to Hiragana characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                64
            </td>
            <td>
                Converst all characters to Unicode.
            </td>
        </tr>
        <tr class="odd">
            <td>
                128
            </td>
            <td>
                Convert all characters from Unicode.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the LTrim, RTrim, and Trim functions to return copies of a string with leading, trailing, or both leading and
    trailing spaces removed. I usually do this with data retrieved from files and databases, and directly from users.
    The original string is unchanged, as are all internal spaces. Some trim routines in other programming languages trim
    all sorts of invisible characters, such as carriage returns, new-line characters, and tabs. In OOo Basic, only the
    space character with an ASCII value of 32 is trimmed.
</p>
<p>
    <strong>Listing .</strong> Demonstrate LTrim and RTrim.
</p>
<p>
    s = " hello world "
</p>
<p>
    Print "(" &amp; LTrim(s) &amp; ")" '(hello world )
</p>
<p>
    Print "(" &amp; RTrim(s) &amp; ")" '( hello world)
</p>
<p>
    Print "(" &amp; Trim(s) &amp; ")" '(hello world)
</p>
<p>
    Use the Len function to return the number of characters in the string. If the argument is not a string, it is
    converted to a string first. It’s probably safer to use CStr to convert nonstring arguments to strings, rather than
    to rely on the automatic behavior. For example, types such as Byte will not convert automatically as expected. The
    value held in the Byte data type is treated as an ASCII value and converted to a single character. The CStr function
    avoids this problem.
</p>
<p>
    <strong>Listing .</strong> Demonstrate Len.
</p>
<p>
    Print Len("") '0
</p>
<p>
    Print Len("1") '1
</p>
<p>
    Print Len("123") '3
</p>
<p>
    Print Len(12) '2 the number is converted to a string
</p>
<p>
    To create a string with a single character repeated multiple times, use the String function. The first argument is
    an integer indicating how many times the character is repeated. Zero is a valid value for the first argument,
    returning an empty string. The second argument is the character to repeat. Just like the ASC function, the String
    function uses the first character from the string and ignores the rest. If the second argument is a number, it’s
    treated as an ASCII value and the character is created from the number.
</p>
<p>
    <strong>Listing .</strong> Demonstrate String.
</p>
<p>
    Print String(2, 65) 'AA 65 is ASCII for A
</p>
<p>
    Print String(2, "AB") 'AA Only the first character is used
</p>
<p>
    Print ASC(String(2)) '0 Bug: Created string with two ASCII 0 characters
</p>
<p>
    Print Len(Space(4)) '4 Four spaces
</p>
<p>
    Use the function InStr to find where (and if) one string is contained inside another. The InStr function can take
    four arguments. The first argument is an optional integer that indicates the first character to check. This defaults
    to 1, the first character, if it is not included. InStr then searches the second argument to see if it contains the
    third argument. The fourth optional argument determines if the comparison is case sensitive (0) or case insensitive
    (1). The default search is case insensitive. You can’t use the fourth argument unless you also use the first
    argument.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The StrComp function uses a 0 to indicate a case-insensitive comparison and a 1 — the default — to
                indicate a case-sensitive comparison. The InStr function, however, uses a 0 to indicate a case-sensitive
                comparison and a 1 — the default — to indicate a case-insensitive comparison. The only similarity is
                that the value 1 is the default.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Demonstrate InStr.
</p>
<p>
    Print InStr("CBAABC", "abc") '4 default to case insensitive
</p>
<p>
    Print InStr(1, "CBAABC", "b") '2 first argument is 1 by default
</p>
<p>
    Print InStr(2, "CBAABC", "b") '2 start with second character
</p>
<p>
    Print InStr(3, "CBAABC", "b") '5 start with third character
</p>
<p>
    Print InStr(1, "CBAABC", "b", 0) '0 case-sensitive comparison
</p>
<p>
    Print InStr(1, "CBAABC", "b", 1) '2 case-insensitive comparison
</p>
<p>
    Print InStr(1, "CBAABC", "B", 0) '2 case-sensitive comparison
</p>
<p>
    InStrRev is only available while VB compatibility mode is true. The start location is argument 3, as opposed to the
    first argument in InStr. A start location of -1 means start at the right most character; I wish that -2 was the
    second character from the right, but it causes a run-time exception.
</p>
<p>
    <strong>Listing .</strong> Demonstrate InStrRev.
</p>
<p>
    Sub ExampleInStrRev
</p>
<p>
    CompatibilityMode(True)
</p>
<p>
    Print InStrRev("CBAABC", "ABC") '4 default to case sensitive
</p>
<p>
    Print InStrRev("CBAABC", "abc") '0 default to case sensitive
</p>
<p>
    Print InStrRev("CBAABC", "abc", -1, 1) '4 force case insensitive
</p>
<p>
    Print InStrRev("CBAABC", "B", 1) '0 start with first character
</p>
<p>
    Print InStrRev("CBAABC", "B", 2) '2 start with second character
</p>
<p>
    Print InStrRev("CBAABC", "B", -1) '5 start with last character
</p>
<p>
    Print InStrRev("CBAABC", "B", 5) '5 start with fifth character
</p>
<p>
    Print InStrRev("CBAABC", "B", 4) '2 start with fourth character
</p>
<p>
    Print InStrRev("CBAABC", "b", -1, 0) '0 case-sensitive comparison
</p>
<p>
    Print InStrRev("CBAABC", "b", -1, 1) '5 case-insensitive comparison
</p>
<p>
    Print InStrRev("CBAABC", "B", -1, 0) '5 case-sensitive comparison
</p>
<p>
    End Sub
</p>
<p>
    Prior to OOo 2.0, the return value from InStr is an integer, which is limited to values from -32,768 through 32,767.
    A string can be up to 65,535 characters in length, which causes problems when InStr searches large strings. Starting
    with OOo 2.0, however, the return type is a long.
</p>
<p>
    <strong>Listing .</strong> Demonstrate InStr and a long string.
</p>
<p>
    Dim s1 As String
</p>
<p>
    s1 = String(44000, "*") &amp; "XX" 'This string has 44002 characters.
</p>
<p>
    Print InStr(s1, "XX") '44001 in OOo 2.0 and -21535 in OOo 1.1.1.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="locale-and-strings">
                    <span id="anchor-136"></span>Locale and strings
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use Tools | Options | Language Settings | Languages to view the Locale used by OO. My Locale setting is “Default –
    English (USA)”. After changing the Locale, you must exit and restart for the changes to be used. The following macro
    returns different results based on the configured locale. Notice the difference when run as English – US and Turkish
    locales.
</p>
<p>
    <strong>Listing .</strong> Some string functions use Locale.
</p>
<p>
    Sub LocaleStringTests
</p>
<p>
    Dim s$
</p>
<p>
    ' compare Turkish dotless i with upper case i
</p>
<p>
    ' Turkish Locale returns 0, English returns -1
</p>
<p>
    s = "Compare dotless i with upper case i : " &amp; StrComp("ı", "I", 0) &amp; CHR$(10)
</p>
<p>
</p>
<p>
    ' compare lower case i to upper case i
</p>
<p>
    ' English Locale returns 0, Turkish Locale returns 1.
</p>
<p>
    s = s &amp; "Compare i with upper case i : " &amp; StrComp("i", "I", 0) &amp; CHR$(10)
</p>
<p>
</p>
<p>
    s = s &amp; "Lower Case I = " &amp; LCase("I") &amp; CHR$(10)
</p>
<p>
    s = s &amp; "Upper Case i = " &amp; UCase("i")
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/1000020100000115000000AE8E89AFAD.png" style="width:2.8854in;height:1.8126in" /> <img
        src="Pictures/100002010000010F000000AE15B6289C.png" style="width:2.8228in;height:1.8126in" />
</p>
<p>
    <strong>Figure .</strong> English – US Locale on the Left, Turkish Locale on the Right.
</p>
<p>
    I did not explore other areas that may also rely on Locale specific settings.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="substrings">
                    <span id="anchor-137"></span>Substrings
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the Left function to retrieve a portion of the string from the start. The first argument is the string from
    which to extract the characters, and the second argument indicates how many characters to return. Analogously, the
    Right function returns strings from the end of a string. If the requested length is zero, an empty string is
    returned. If the requested length is too large, the entire string is returned.
</p>
<p>
    Print Left("12345", 2) '12
</p>
<p>
    Print Left("12345", 8) '12345
</p>
<p>
    Print Right("12345", 2) '45
</p>
<p>
    The length argument for the Left and Right functions is a long, correctly handling strings, which can contain up to
    65,535 characters (see ).
</p>
<p>
    <strong>Listing .</strong> Strings can contain up to 65,535 characters.
</p>
<p>
    Dim s1 As String
</p>
<p>
    s1 = String(44002, "*") 'This string has 44002 characters
</p>
<p>
    Print Len(s1) '44002
</p>
<p>
    Print Len(Left(s1, 44000)) '44000 (fixed in OOo 2.0)
</p>
<p>
    Print Len(Right(s1, 44000)) '44000
</p>
<p>
    Use the Mid function to extract arbitrary substrings and to replace substrings in an existing string. In general,
    the string functions return a new string rather than modifying the existing string. For example, the Trim function
    returns a new string with leading and trailing spaces removed, rather than removing leading and trailing spaces from
    the existing string. The Mid function, however, can be used to modify the string rather than simply returning a new
    one. In its simplest form, the Mid function has functionality to the Right function. The first argument is a string,
    and the second argument is a starting position. The optional third argument indicates the length of the string to
    return.
</p>
<p>
    <strong>Listing .</strong> Demonstrate Mid.
</p>
<p>
    Print Mid("123456", 3) '3456
</p>
<p>
    Print Mid("123456", 3, 2) '34
</p>
<p>
    s1 = String(44000, "*")&amp;"XX"
</p>
<p>
    Print Mid(s1, 44000) '*XX No problem with large arguments
</p>
<p>
    Print Len(Mid(s1, 2, 40000)) '40000 No problem with large arguments
</p>
<p>
    The Mid function can provide the same functionality as the Left function.
</p>
<p>
    Left(s, n) = Mid(s, 1, n)
</p>
<p>
    The Mid function takes an optional fourth argument, a string, that replaces the specified substring in the first
    argument. In other words, if four arguments are present, the first three arguments specify a substring in the string
    and the fourth argument replaces the substring. This may shorten the length of a string, but in OOo Basic this will
    never cause the string to become longer. If the final argument is longer than the specified substring, only the
    first characters are used from the final argument to replace the substring.
</p>
<p>
    <strong>Listing .</strong> Demonstrate Mid to replace strings.
</p>
<p>
    s = "123456789"
</p>
<p>
    Mid(s, 3, 5, "") 'Replace five characters with nothing
</p>
<p>
    Print s '1289
</p>
<p>
    s = "123456789"
</p>
<p>
    Mid(s, 3, 5, "XX") 'Replace five characters with two
</p>
<p>
    Print s '12XX89
</p>
<p>
    s = "123456789"
</p>
<p>
    Mid(s, 3, 5, "ABCDEFG") 'Cannot add more than you replace from the middle
</p>
<p>
    Print s '12ABCDE89
</p>
<p>
    s = "123456789"
</p>
<p>
    Mid(s, 7, 12, "ABCDEFG")'You can add more than you remove from the end
</p>
<p>
    Print s '123456ABCDEFG
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="replace">
                    <span id="anchor-138"></span>Replace
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The ReplaceInString function (see ) emulates the Mid function, with two exceptions: It puts the entire new string in
    place, even if it’s longer than the substring that it replaces, and it doesn’t modify the original string.
</p>
<p>
    <strong>Listing .</strong> A general replace string method.
</p>
<p>
    REM This function is similar to Mid with four arguments.
</p>
<p>
    REM This function does not modify the original string.
</p>
<p>
    REM This function handles replacement text larger than n.
</p>
<p>
    Function ReplaceInString(s$, i&amp;, n&amp;, sNew$) As String
</p>
<p>
    If i &lt;= 1 Then
</p>
<p>
    'Place the string in front.
</p>
<p>
    'The only question is how much string must be removed.
</p>
<p>
</p>
<p>
    If n &lt; 1 Then 'Remove nothing
</p>
<p>
    ReplaceInString = sNew &amp; s
</p>
<p>
    ElseIf n &gt;= Len(s) Then 'Remove everything
</p>
<p>
    ReplaceInString = sNew
</p>
<p>
    Else 'Remove a portion from the left
</p>
<p>
    ReplaceInString = sNew &amp; Right(s, Len(s) - n)
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    ElseIf i + n &gt; Len(s) Then
</p>
<p>
    'Replacing past the end, then extract the leftmost parts
</p>
<p>
    'Mid works to find if the length argument is larger than the
</p>
<p>
    'string, so this is fine! Append the new text to the end.
</p>
<p>
</p>
<p>
    ReplaceInString = Mid(s, 1, i - 1) &amp; sNew
</p>
<p>
</p>
<p>
    Else
</p>
<p>
    'Replace somewhere in the middle of the string.
</p>
<p>
    'First, obtain the leftmost text.
</p>
<p>
    'Second, insert the new text, if any.
</p>
<p>
    'Finally, obtain the rightmost text.
</p>
<p>
</p>
<p>
    ReplaceInString = Mid(s, 1, i - 1) &amp; sNew &amp; Right(s, Len(s) - i - n + 1)
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<p>
    But wait, there is an undocumented statement Replace(strng, find, rpl, start, Count, mode), which finds all
    occurrences of find and replaces them with rpl. The last three arguments are optional.
</p>
<p>
    The start value indicates what part of the string to return, not where to start replace. A value of one for the
    start value returns all of the characters. A start value of three ignores the first two characters in the return
    string.
</p>
<p>
    The count indicates the maximum number of times to replace the found text. A value of -1 replaces all values.
</p>
<p>
    A mode value of 1, the default, indicates a case-insensitive compare is used to find matching text. A mode value of
    0 causes a case-sensitive compare.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="aligning-strings-with-lset-and-rset">
                    <span id="anchor-139"></span>Aligning strings with LSet and RSet
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the LSet and RSet statements to left-justify and right-justify strings into the space taken by another string.
    This is useful, for example, to create column headings that are left or right justified with leading or trailing
    spaces. The RSet and LSet functions use the same syntax.
</p>
<p>
    LSet string_1 = expression
</p>
<p>
    RSet string_1 = expression
</p>
<p>
    The string on the left-hand side can contain any data as long as it is the length that you want. The right-hand side
    must evaluate to a string; that string will be displayed in the space defined by the length of the left-hand string.
    Unlike the behavior for many functions in OOo Basic, the expression is not automatically converted to a string.
</p>
<p>
    <strong>Listing .</strong> RSet.
</p>
<p>
    Dim s As String 'String variable to contain the result
</p>
<p>
    s = String(10, "*") 'The result is 10 characters wide
</p>
<p>
    RSet s = CStr(1.23) 'The number is not automatically converted to a string
</p>
<p>
    Print "$" &amp; s '$ 1.23
</p>
<p>
    The important thing about the string on the left is its length<em><em> — </em></em>the width of the field in which
    the value of interest will be displayed. The easiest way to get a string of a specified length is to use the String
    function. The character that you use is not important because all of the extra characters in the final result are
    replaced with spaces.
</p>
<p>
    <strong>Listing .</strong> LSet.
</p>
<p>
    Dim s As String 'String variable to contain the result
</p>
<p>
    s = String(10, "X") 'The result is 10 characters wide
</p>
<p>
    LSet s = CStr(1.23) 'The number is not automatically converted to a string
</p>
<p>
    Print s &amp; "%" '1.23 %
</p>
<p>
    If the string on the left is shorter than the string expression on the right, the expression is truncated to fit.
    Both LSet and RSet chop characters from the end of the expression to make it fit within the defined string length.
</p>
<p>
    <strong>Listing .</strong> LSet and RSet truncate.
</p>
<p>
    Dim s As String 'String variable to contain the result
</p>
<p>
    s = String(4, "X") 'The result will be four characters wide
</p>
<p>
    LSet s = CStr(21.23)'Truncated on the right
</p>
<p>
    Print "$" &amp; s &amp; "%" '$21.2%
</p>
<p>
    RSet s = CStr(21.23)'Truncated on the right
</p>
<p>
    Print "$" &amp; s &amp; "%" '$21.2%
</p>
<p>
    The code in <strong> </strong>demonstrates the behavior of the LSet and RSet commands. The results are displayed in
    .
</p>
<p>
    <strong>Listing .</strong> Complete LSet and RSet example.
</p>
<p>
    Sub ExampleLSetAndRSet
</p>
<p>
    Dim s As String
</p>
<p>
    Dim sVar As String
</p>
<p>
    Dim sTmp As String
</p>
<p>
</p>
<p>
    sTmp = "12345"
</p>
<p>
    sVar = String(10,"*")
</p>
<p>
    LSet sVar = sTmp
</p>
<p>
    s = "LSet " &amp; String(10, "*") &amp; " = " &amp; STmp &amp;_
</p>
<p>
    " == &gt;" &amp; sVar &amp; "&lt;" &amp; CHR$(10)
</p>
<p>
    sVar = String(10,"*")
</p>
<p>
    RSet sVar = sTmp
</p>
<p>
    s = s &amp; "RSet " &amp; String(10, "*") &amp; " = " &amp; STmp &amp;_
</p>
<p>
    " == &gt;" &amp; sVar &amp; "&lt;" &amp; CHR$(10) &amp; CHR$(10)
</p>
<p>
    sVar = String(2,"*")
</p>
<p>
    LSet sVar = sTmp
</p>
<p>
    s = s &amp; "LSet " &amp; String(2, "*") &amp; " = " &amp; STmp &amp;_
</p>
<p>
    " == &gt;" &amp; sVar &amp; "&lt;" &amp; CHR$(10)
</p>
<p>
    sVar = String(2,"*")
</p>
<p>
    RSet sVar = sTmp
</p>
<p>
    s = s &amp; "RSet " &amp; String(2, "*") &amp; " = " &amp; STmp &amp;_
</p>
<p>
    " == &gt;" &amp; sVar &amp; "&lt;" &amp; CHR$(10)
</p>
<p>
</p>
<p>
    MsgBox s, 0, "RSet and LSet"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000012B000000922C50E3FE.png" style="width:3.1146in;height:1.5209in" />
</p>
<p>
    <strong>Figure </strong>. RSet and LSet justify strings.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                In Visual Basic, LSet allows you to overlay data from one user-defined type with data from another,
                overlaying all the bytes from one data structure on top of the other; ignoring the underlying structure.
                In OOo Basic, LSet only manipulates strings.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="fancy-formatting-with-format">
                    <span id="anchor-140"></span>Fancy formatting with Format
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    You can convert a number to a string formatted according to the optional format string. And you can include multiple
    formats in a single format string. See . The current locale influences the returned formatted string. Set the locale
    using Tools | Options | Language Settings | Languages. If the format string is omitted, Format produces output
    similar to the CStr function.
</p>
<p>
    <strong>Listing .</strong> Simple Format statement.
</p>
<p>
    Print Format(1223, "00.00") '1223.00
</p>
<p>
    Print Format(1234.56789, "###00.00") '1234.57
</p>
<p>
    Each individual format is separated by a semicolon (;). The first format is used for positive numbers, the second
    for negative numbers, and the third for zero. If only one format code is present, it applies to all numbers.
</p>
<p>
    <strong>Listing .</strong> Format string may specify formatting for positive , negative, and zero numbers.
</p>
<p>
    Dim s As String
</p>
<p>
    s = "P 00000.000;N ####.00;Z 0.0"
</p>
<p>
    Print Format(-12.3, s) 'N 12.30
</p>
<p>
    Print Format(0, s) 'Z 0.0
</p>
<p>
    Print Format(12.3, s) 'P 000012.300
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Numeric Format specifiers.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                If the number has a digit at the position of the 0 in the format code, the digit is displayed; otherwise
                a zero appears. This means that leading and trailing zeros are displayed, leading digits are not
                truncated, and trailing decimals are rounded.
            </td>
        </tr>
        <tr class="even">
            <td>
                #
            </td>
            <td>
                This works like the 0, but leading and trailing zeros are not displayed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                .
            </td>
            <td>
                The decimal placeholder determines the number of decimal places to the left and right of the decimal
                separator. Although the period is used in the format string regardless of locale, the output correctly
                uses the locale-specific decimal separator.
            </td>
        </tr>
        <tr class="even">
            <td>
                %
            </td>
            <td>
                Multiply the number by 100 and insert the percent sign (%) where it appears in the format code.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    E-
                </p>
                <p>
                    E+
                </p>
                <p>
                    e-
                </p>
                <p>
                    e+
                </p>
            </td>
            <td>
                If the format code contains at least one numerical digit placeholder (0 or #) to the right of the
                symbol, the number is formatted in the scientific notation. The letter E or e is inserted between the
                number and the exponent. The number of placeholders for digits to the right of the symbol determines the
                number of digits in the exponent. If the exponent is negative, a minus sign (-) is displayed directly
                before an exponent. If the exponent is positive, a plus sign (+) is only displayed before exponents with
                E+ or e+.
            </td>
        </tr>
        <tr class="even">
            <td>
                ,
            </td>
            <td>
                The comma is a placeholder for the thousands separator. It separates thousands from hundreds in a number
                with at least four digits. The thousands delimiter is displayed if the format code contains the
                placeholder surrounded by digit placeholders (0 or #).
            </td>
        </tr>
        <tr class="odd">
            <td>
                - + $ ( ) space
            </td>
            <td>
                Plus signs (+), minus signs (-), dollar signs ($), spaces, or brackets entered directly in the format
                code are displayed as the literal character.
            </td>
        </tr>
        <tr class="even">
            <td>
                \
            </td>
            <td>
                The backslash displays the next character in the format code. In other words, it prevents the next
                character from being seen as a special character. The backslash is not displayed unless you enter a
                double backslash (\\) in the format code. Characters that must be preceded by a backslash in the format
                code in order to be displayed as literal characters are the date- and time-formatting characters (a, c,
                d, h, m, n, p, q, s, t, w, y, /, :), numeric-formatting characters (#, 0, %, E, e, comma, period), and
                string-formatting characters (&lt;, &gt;). You may also enclose characters in double quotation marks.
            </td>
        </tr>
        <tr class="odd">
            <td>
                General Number
            </td>
            <td>
                Numbers are displayed as entered.
            </td>
        </tr>
        <tr class="even">
            <td>
                Currency
            </td>
            <td>
                A currency symbol is placed in front of the number, and negative numbers are in brackets.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Fixed
            </td>
            <td>
                At least one digit is displayed in front of the decimal separator. Two decimals are displayed.
            </td>
        </tr>
        <tr class="even">
            <td>
                Percent
            </td>
            <td>
                Multiply the number by 100 and append a percent sign (%).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Standard
            </td>
            <td>
                Displays numbers with a locale-specific thousands separator. Two decimals are displayed.
            </td>
        </tr>
        <tr class="even">
            <td>
                Scientific
            </td>
            <td>
                Displays numbers in scientific notation. Two decimals are displayed.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The format function has been dramatically improved over the years and most of the bugs have been fixed. Format
    specifiers related to numbers are shown in .
</p>
<p>
    <strong>Listing .</strong> Demonstrate numeric format specifiers.
</p>
<p>
    Sub ExampleFormat
</p>
<p>
    MsgBox Format(6328.2, "##,##0.00") REM 6,328.20
</p>
<p>
    MsgBox Format(123456789.5555, "##,##0.00") REM 123,456,789.56
</p>
<p>
    MsgBox Format(0.555, ".##") REM .56
</p>
<p>
    MsgBox Format(123.555, "#.##") REM 123.56
</p>
<p>
    MsgBox Format(123.555, ".##") REM 123.56
</p>
<p>
    MsgBox Format(0.555, "0.##") REM 0.56
</p>
<p>
    MsgBox Format(0.1255555, "%#.##") REM %12.56
</p>
<p>
    MsgBox Format(123.45678, "##E-####") REM 12E1
</p>
<p>
    MsgBox Format(.0012345678, "0.0E-####") REM 1.2E-003
</p>
<p>
    MsgBox Format(123.45678, "#.e-###") REM 1.e002
</p>
<p>
    MsgBox Format(.0012345678, "#.e-###") REM 1.e-003
</p>
<p>
    MsgBox Format(123.456789, "#.## is ###") REM 123.46
</p>
<p>
    MsgBox Format(8123.456789, "General Number") REM 8123.456789
</p>
<p>
    MsgBox Format(8123.456789, "Fixed") REM 8123.46
</p>
<p>
    MsgBox Format(8123.456789, "Currency") REM 8,123.46 $ (broken)
</p>
<p>
    MsgBox Format(8123.456789, "Standard") REM 8,123.46
</p>
<p>
    MsgBox Format(8123.456789, "Scientific") REM 8.12E+03
</p>
<p>
    MsgBox Format(0.00123456789, "Scientific") REM 1.23E-03
</p>
<p>
    MsgBox Format(0.00123456789, "Percent") REM 0.12%
</p>
<p>
    End Sub
</p>
<p>
    Format specifiers related to date and time formatting are shown in . For reasons that I do not understand, they are
    not included with the standard documentation.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Date and time format specifiers.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                q
            </td>
            <td>
                The quarter of the year (1 through 4).
            </td>
        </tr>
        <tr class="even">
            <td>
                qq
            </td>
            <td>
                The quarter of the year as 1st quarter through 4th quarter
            </td>
        </tr>
        <tr class="odd">
            <td>
                y
            </td>
            <td>
                The day in the year (1 through 365).
            </td>
        </tr>
        <tr class="even">
            <td>
                yy
            </td>
            <td>
                Two-digit year.
            </td>
        </tr>
        <tr class="odd">
            <td>
                yyyy
            </td>
            <td>
                Complete four-digit year.
            </td>
        </tr>
        <tr class="even">
            <td>
                m
            </td>
            <td>
                Month number with no leading zero.
            </td>
        </tr>
        <tr class="odd">
            <td>
                mm
            </td>
            <td>
                Two-digit month number; leading zeros are added as required.
            </td>
        </tr>
        <tr class="even">
            <td>
                mmm
            </td>
            <td>
                Month name abbreviated to three letters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                mmmm
            </td>
            <td>
                Full month name as text.
            </td>
        </tr>
        <tr class="even">
            <td>
                mmmmm
            </td>
            <td>
                First letter of month name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                d
            </td>
            <td>
                Day of the month with no leading zero.
            </td>
        </tr>
        <tr class="even">
            <td>
                dd
            </td>
            <td>
                Day of the month; leading zeros are added as required.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ddd
            </td>
            <td>
                Day as text abbreviated to three letters (Sun, Mon, Tue, Wed, Thu, Fri, Sat).
            </td>
        </tr>
        <tr class="even">
            <td>
                dddd
            </td>
            <td>
                Day as text (Sunday through Saturday).
            </td>
        </tr>
        <tr class="odd">
            <td>
                ddddd
            </td>
            <td>
                Full date in a short date format.
            </td>
        </tr>
        <tr class="even">
            <td>
                dddddd
            </td>
            <td>
                Full date in a long format.
            </td>
        </tr>
        <tr class="odd">
            <td>
                w
            </td>
            <td>
                Day of the week as returned by WeekDay (1 through 7).
            </td>
        </tr>
        <tr class="even">
            <td>
                ww
            </td>
            <td>
                Week in the year (1 though 52).
            </td>
        </tr>
        <tr class="odd">
            <td>
                h
            </td>
            <td>
                Hour with no leading zero.
            </td>
        </tr>
        <tr class="even">
            <td>
                hh
            </td>
            <td>
                Two-digit hour; leading zeros are added as required.
            </td>
        </tr>
        <tr class="odd">
            <td>
                n
            </td>
            <td>
                Minute with no leading zero.
            </td>
        </tr>
        <tr class="even">
            <td>
                nn
            </td>
            <td>
                Two-digit minute; leading zeros are added as required.
            </td>
        </tr>
        <tr class="odd">
            <td>
                s
            </td>
            <td>
                Second with no leading zero.
            </td>
        </tr>
        <tr class="even">
            <td>
                ss
            </td>
            <td>
                Two-digit second; leading zeros are added as required.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ttttt
            </td>
            <td>
                Display complete time in a long time format.
            </td>
        </tr>
        <tr class="even">
            <td>
                c
            </td>
            <td>
                Display a complete date and time.
            </td>
        </tr>
        <tr class="odd">
            <td>
                /
            </td>
            <td>
                Date separator. A locale-specific value is used.
            </td>
        </tr>
        <tr class="even">
            <td>
                :
            </td>
            <td>
                Time separator. A locale-specific value is used.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The date and time format specifiers are now implemented. I am aware of at least one bug that is demonstrated in with
    the format string “d/mmmm/yyyy h:nn:ss”; shows that “nn” does not expand properly on the last line.
</p>
<p>
    <strong>Listing .</strong> Demonstrate date and time format specifiers.
</p>
<p>
    Sub FormatDateTimeStrings
</p>
<p>
    Dim i%
</p>
<p>
    Dim d As Date
</p>
<p>
    d = now()
</p>
<p>
    Dim s$
</p>
<p>
    Dim formats
</p>
<p>
    formats = Array("q", "qq", "y", "yy", "yyyy", _
</p>
<p>
    "m", "mm", "mmm", "mmmm", "mmmmm", _
</p>
<p>
    "d", "dd", "ddd", "dddd", "ddddd", "dddddd", _
</p>
<p>
    "w", "ww", "h", "hh", "n", "nn", "nnn", "s", "ss", _
</p>
<p>
    "ttttt", "c", "d/mmmm/yyyy h:nn:ss")
</p>
<p>
    For i = LBound(formats) To UBound(formats)
</p>
<p>
    s = s &amp; formats(i) &amp; " =&gt; " &amp; Format(d, formats(i)) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001750000025CC28F0951.png" style="width:3.8854in;height:6.2917in" />
</p>
<p>
    <strong>Figure </strong>. Date and time format specifiers.
</p>
<p>
    Format specifiers related to strings are shown in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> String format specifiers.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                &lt;
            </td>
            <td>
                String in lowercase.
            </td>
        </tr>
        <tr class="even">
            <td>
                &gt;
            </td>
            <td>
                String in uppercase.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Other string format specifiers used to be documented, but have never been implemented (see ). I include them because
    the specifiers in and used to be documented but not implemented; now they are implemented but not documented.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> String format specifiers.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                @
            </td>
            <td>
                Character placeholder. If the input character is empty, place a space in the output string. For example,
                “(@@@)” formats to “( )” with an empty string.
            </td>
        </tr>
        <tr class="even">
            <td>
                &amp;
            </td>
            <td>
                Character placeholder. If the input character is empty, place nothing in the output string. For example,
                “(&amp;&amp;&amp;)” formats to “()” with an empty string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                !
            </td>
            <td>
                Normally, character placeholders are filled right to left; the ! forces the placeholders to be filled
                left to right.
            </td>
        </tr>
    </tbody>
</table>
<p>
    As of this writing with OOo version 3.2.1, only the upper / lower case string format specifiers are implemented.
</p>
<p>
    <strong>Listing .</strong> String format specifiers.
</p>
<p>
    Sub FormatStrings
</p>
<p>
    Dim i%
</p>
<p>
    Dim s$
</p>
<p>
    Dim formats
</p>
<p>
    formats = Array("&lt;", "&gt;", _
</p>
<p>
    "@@", "(@@@)", "[@@@@]", _
</p>
<p>
    "&amp;&amp;", "(&amp;&amp;&amp;)", "[&amp;&amp;&amp;&amp;]", _
</p>
<p>
    )
</p>
<p>
    For i = LBound(formats) To UBound(formats)
</p>
<p>
    s = s &amp; formats(i) &amp; " =&gt; (" &amp; Format("On", formats(i)) &amp; ")" &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="converting-data-to-a-string">
                    <span id="anchor-141"></span>Converting data to a string
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic contains functions that convert other data types to a string. Although the Format function is the most
    versatile method of converting a number to a string, that level of control is typically not required. The Str
    function converts a number to a string with no localization, and the Val function converts it back to a number.
</p>
<p>
    The Hex and Oct functions convert a Long to its corresponding hexadecimal or octal notation. The leading “&amp;H”
    and “&amp;O” are not included. To convert back to a number, these strings must be manually prepended to the string.
</p>
<p>
    The CStr function is able to intelligently convert almost any data type to a string in a locale-specific way (see ).
    The Str function is limited to numbers and does not perform a locale-specific conversion.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Converting data types with CStr.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Boolean
            </td>
            <td>
                True or False
            </td>
        </tr>
        <tr class="even">
            <td>
                Date
            </td>
            <td>
                Formatted date string such as 06/08/2010
            </td>
        </tr>
        <tr class="odd">
            <td>
                Null, uninitialized object
            </td>
            <td>
                Run-time error
            </td>
        </tr>
        <tr class="even">
            <td>
                Empty, uninitialized variant
            </td>
            <td>
                Zero-length string
            </td>
        </tr>
        <tr class="odd">
            <td>
                any numeric value
            </td>
            <td>
                Number as a string
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> CStr with a few data types.
</p>
<p>
    Sub ExampleCStr
</p>
<p>
    On Error Goto Handler
</p>
<p>
    Dim b As Boolean
</p>
<p>
    Dim o As Object
</p>
<p>
    Dim v As Variant ' This is empty
</p>
<p>
    Dim d As Double : d = PI()
</p>
<p>
</p>
<p>
    Print "Boolean (" &amp; CStr(b) &amp; ")"
</p>
<p>
    Print "Date (" &amp; CStr(Now) &amp; ")"
</p>
<p>
    Print "Empty Variant (" &amp; CStr(v) &amp; ")"
</p>
<p>
    Print "Double (" &amp; CStr(d) &amp; ")"
</p>
<p>
    Print "Null object (" &amp; CStr(o) &amp; ")"
</p>
<p>
    Exit Sub
</p>
<p>
    Handler:
</p>
<p>
    Print "Encountered error: " &amp; Error
</p>
<p>
    Resume Next
</p>
<p>
    End Sub
</p>
<p>
    The CStr function is useful when you need to explicitly convert a value to a string to avoid incorrect default
    conversions to other types. For example, the first operand to the addition operator determines if the result is a
    string or a number. This is also an argument against the use of the addition operator (+) for string concatenation
    rather than the operator specifically designed for string concatenation (&amp;).
</p>
<p>
    Print 3 + "4" '7
</p>
<p>
    Print CStr(3) + "4" '34
</p>
<p>
    The Join function concatenates all of the elements in a one-dimensional array into a single string. If no delimiter
    is specified, a space separates each element.
</p>
<p>
    Print Join(Array(3, 4, 5)) '3 4 5
</p>
<p>
    Print Join(Array(3, 4, 5), "X") '3X4X5
</p>
<p>
    The Split function is used to split a string into pieces based on an optional delimiter. This is essentially the
    opposite of the Join function and is the fastest method to parse a string into a series of substrings based on a
    delimiter.
</p>
<p>
    Split("3 4 5") 'returns the array (3, 4, 5)
</p>
<p>
    Split("3X4X5", "X") 'returns the array (3, 4, 5)
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="advanced-searching">
                    <span id="anchor-142"></span>Advanced searching
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The usual search methods are StrComp (), InStr (), and InStrRev (). Advanced searching can be done using the
    TextSearch service. Searching can be done using ABSOLUTE, REGEXP, or APPROXIMATE mode. I will not take the time to
    pursue the TextSearch service in depth; for example, to investigate replacing text.
</p>
<p>
    <strong>Listing .</strong> using the TextSearch service.
</p>
<p>
    Sub StringTextSearch
</p>
<p>
    Dim oTextSearch ' TextSearch service.
</p>
<p>
    Dim sStrToSearch As String ' String to search.
</p>
<p>
    Dim sMatchString As String ' String that was found.
</p>
<p>
    Dim aSearchResult ' com.sun.star.util.SearchResult
</p>
<p>
    Dim rank As Long
</p>
<p>
    Dim iMatchStartPos As Long
</p>
<p>
    Dim iMatchLen As Long
</p>
<p>
    Dim aSrcOpt As New com.sun.star.util.SearchOptions
</p>
<p>
    Dim s$
</p>
<p>
    Dim enLocale As New com.sun.star.lang.Locale
</p>
<p>
</p>
<p>
    enLocale.Language = "en"
</p>
<p>
    enLocale.Country = "US"
</p>
<p>
</p>
<p>
    oTextSearch = CreateUnoService("com.sun.star.util.TextSearch")
</p>
<p>
    s = ""
</p>
<p>
    With aSrcOpt
</p>
<p>
    'http://api.openoffice.org/docs/common/ref/com/sun/star/util/SearchFlags.html
</p>
<p>
    .searchFlag = com.sun.star.util.SearchFlags.REG_EXTENDED
</p>
<p>
    .Locale = enLocale
</p>
<p>
    'Supports ABSOLUTE, REGEXP, and APPROXIMATE
</p>
<p>
    .algorithmType = com.sun.star.util.SearchAlgorithms.REGEXP
</p>
<p>
    .searchString = "a+"
</p>
<p>
</p>
<p>
    'This does not work.
</p>
<p>
    '.transliterateFlags = com.sun.star.i18n.TransliterationModulesNew.IGNORE_CASE
</p>
<p>
</p>
<p>
    'This works
</p>
<p>
    .transliterateFlags = com.sun.star.i18n.TransliterationModulesNew.UPPERCASE_LOWERCASE
</p>
<p>
    End With
</p>
<p>
    oTextSearch.setOptions(aSrcOpt)
</p>
<p>
    sStrToSearch = "aaa hello AAA"
</p>
<p>
    aSearchResult = oTextSearch.searchForward(sStrToSearch, 0,Len(sStrToSearch)-1 )
</p>
<p>
    'Print aSearchResult.subRegExpressions
</p>
<p>
    REM subRegExpressions has value zero if no match...
</p>
<p>
    Do While aSearchResult.subRegExpressions &gt; 0
</p>
<p>
    'Print "" + LBound(aSearchResult.startOffset) + ":" + UBound(aSearchResult.startOffset)
</p>
<p>
    rank = aSearchResult.subRegExpressions - 1
</p>
<p>
    iMatchStartPos = aSearchResult.startOffset(rank) + 1
</p>
<p>
    iMatchLen = aSearchResult.endOffset(rank) - aSearchResult.startOffset(rank)
</p>
<p>
    sMatchString = Mid(sStrToSearch, iMatchStartPos, iMatchLen)
</p>
<p>
    s = s &amp; "(" + LBound(aSearchResult.startOffset) &amp; ":" &amp; _
</p>
<p>
    UBound(aSearchResult.startOffset)&amp; ") =&gt; " &amp; sMatchString &amp; CHR$(10)
</p>
<p>
    aSearchResult = oTextSearch.searchForward(sStrToSearch, _
</p>
<p>
    aSearchResult.endOffset(rank)+1,Len(sStrToSearch)-1 )
</p>
<p>
    Loop
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-5">
                    <span id="anchor-143"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    It pays to know the different functions supported by OOo Basic. Before I was aware of the Split function, I spent a
    lot of time writing a macro that parsed a string into pieces. I rewrote my code using the Split function and the
    macro was significantly faster. It’s also important to know the limitations of strings. I saw a macro that counted
    words in a document by first converting the entire document into a single string. This technique worked well, and it
    was very fast, but it failed when the number of characters in the document exceeded 65,535.
</p>
<p>
    There are a lot of very powerful capabilities for formatting text in OOo Basic. Among other things, the use of the
    Unicode character set allows processing of nearly any language in the world. There are also a number of good
    functions for joining, splitting, and formatting text strings.
</p>
<ol type="1">
    <li>
        <h1 id="file-routines">
            <span id="anchor-144"></span>File Routines
        </h1>
    </li>
</ol>
<p>
    This chapter introduces the subroutines and functions supported by OpenOffice.org Basic that are related to files
    and directories. After reading this chapter you’ll be able to create, delete, rename, and move files and
    directories. You’ll learn methods that inspect files, both open and closed, and directories. This chapter also
    explains the idiosyncrasies and bugs related to reading and writing files, along with differences between operating
    systems.
</p>
<p>
    OOo Basic includes functions that allow you to interact with the file system (see ). You can perform simple and
    complex tasks such as creating and deleting directories, or even opening and parsing files. In this chapter I’ll
    spend a fair amount of time on directories, file attributes, and the different file types. I will examine how files
    are organized and manipulated, how the different file types are structured, and which functions read and write data
    for those different file types. I was happy with how easily I was able to write macros to move and rename files. On
    the other hand, the functions to manipulate binary and random files feel rough around the edges.
</p>
<p>
    <strong>Table .</strong> File functions in OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                ChDir(path)
            </td>
            <td>
                Change the currently logged directory or drive. Deprecated; do not use.
            </td>
        </tr>
        <tr class="even">
            <td>
                ChDrive(path)
            </td>
            <td>
                Change the currently logged drive. Deprecated; do not use.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Close #n
            </td>
            <td>
                Close a previously opened file or files. Separate file numbers with a comma.
            </td>
        </tr>
        <tr class="even">
            <td>
                ConvertFromURL(str)
            </td>
            <td>
                Convert a path expressed as a URL to a system-specific path.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ConvertToURL(str)
            </td>
            <td>
                Convert a system-specific path to a URL.
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    CurDir
                </p>
                <p>
                    CurDir(drive)
                </p>
            </td>
            <td>
                Return the current directory as a system-specific path. If the optional drive is specified, the current
                directory for the specified drive is returned.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    Dir(path)
                </p>
                <p>
                    Dir(path, attr)
                </p>
            </td>
            <td>
                Return a listing of files based on an included path. The path may contain a file specification<em><em> —
                    </em></em>for example, “/home/andy/*.txt”. Optional attributes determine if a listing of files or
                directories is returned.
            </td>
        </tr>
        <tr class="even">
            <td>
                EOF(number)
            </td>
            <td>
                Return True if the file denoted by “number” is at the end of the file.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FileAttr(number, 1)
            </td>
            <td>
                Return the mode used to open the file given by “number”. The second argument specifies if the
                file-access or the operating-system mode is desired, but only the file mode is currently supported.
            </td>
        </tr>
        <tr class="even">
            <td>
                FileCopy(src, dest)
            </td>
            <td>
                Copy a file from source to destination.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FileDateTime(path)
            </td>
            <td>
                Return the date and time of the specified file as a string.
            </td>
        </tr>
        <tr class="even">
            <td>
                FileExists(path)
            </td>
            <td>
                Return True if the specified file or directory exists.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FileLen(path)
            </td>
            <td>
                Return the length of the specified file as a long.
            </td>
        </tr>
        <tr class="even">
            <td>
                FreeFile()
            </td>
            <td>
                Return the next available file number for use.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    Get #number, variable
                </p>
                <p>
                    Get #number, pos, variable
                </p>
            </td>
            <td>
                Read a record from a relative file, or a sequence of bytes from a binary file, into a variable. If the
                position argument is omitted, data is read from the current position in the file. For files opened in
                binary mode, the position is the byte position in the file.
            </td>
        </tr>
        <tr class="even">
            <td>
                GetAttr(path)
            </td>
            <td>
                Return a bit pattern identifying the file type.
            </td>
        </tr>
        <tr class="odd">
            <td>
                GetPathSeparator()
            </td>
            <td>
                Return the system-specific path separator.
            </td>
        </tr>
        <tr class="even">
            <td>
                Input #number, var
            </td>
            <td>
                Sequentially read numeric or string records from an open file and assign the data to one or more
                variables. The carriage return (ASC=13), line feed (ASC=10), and comma act as delimiters. Input cannot
                read commas or quotation marks (") because they delimit the text. Use the Line Input statement if you
                must do this.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Kill(path)
            </td>
            <td>
                Delete a file from disk.
            </td>
        </tr>
        <tr class="even">
            <td>
                Line Input #number, var
            </td>
            <td>
                Sequentially read strings to a variable line-by-line up to the first carriage return (ASC=13) or line
                feed (ASC=10). Line end marks are not returned.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Loc(number)
            </td>
            <td>
                Return the current position in an open file.
            </td>
        </tr>
        <tr class="even">
            <td>
                LOF(number)
            </td>
            <td>
                Return the size of an open file, in bytes.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MkDir(path)
            </td>
            <td>
                Create the directory.
            </td>
        </tr>
        <tr class="even">
            <td>
                Name src As dest
            </td>
            <td>
                Rename a file or directory.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Open path For Mode As #n
            </td>
            <td>
                Open a data channel (file) for Mode (Input = read, Output = write)
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    Put #n, var
                </p>
                <p>
                    Put #n, pos, var
                </p>
            </td>
            <td>
                Write a record to a relative file or a sequence of bytes to a binary file.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Reset
            </td>
            <td>
                Close all open files and flush all files to disk.
            </td>
        </tr>
        <tr class="even">
            <td>
                RmDir(path)
            </td>
            <td>
                Remove a directory.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Seek #n, pos
            </td>
            <td>
                Set the position for the next writing or reading in a file.
            </td>
        </tr>
        <tr class="even">
            <td>
                SetAttr(path, attr)
            </td>
            <td>
                Set file attributes.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Write #n, string
            </td>
            <td>
                Write data to a file.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="using-url-notation-to-specify-a-file">
                    <span id="anchor-145"></span>Using URL notation to specify a file
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Many of the functions in specify a file or path. These functions accept both system-specific names and Uniform
    Resource Locator (URL) notation. This is the same notation used by your Web browser. shows examples.
</p>
<p>
    <strong>Table .</strong> URL examples.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Windows
            </td>
            <td>
                c:\Temp\help.txt
            </td>
            <td>
                file:///c:/Temp/help.txt
            </td>
        </tr>
        <tr class="even">
            <td>
                Windows
            </td>
            <td>
                c:\My Documents
            </td>
            <td>
                file:///c:/My%20Documents
            </td>
        </tr>
        <tr class="odd">
            <td>
                Unix
            </td>
            <td>
                /home/andy/Temp/help.txt
            </td>
            <td>
                file:///home/andy/Temp/help.txt
            </td>
        </tr>
        <tr class="even">
            <td>
                Unix
            </td>
            <td>
                /home/andy/My Documents
            </td>
            <td>
                file:///home/andy/My%20Documents
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The statement “Shell("C:\Prog Files\calc.exe",2)” failed because there is a space in the path. The Shell
                statement passes the string to the command shell, which interprets the portion of the path before the
                space as the program to run. URL notation avoids this problem.
            </td>
        </tr>
    </tbody>
</table>
<p>
    One advantage of URL notation is that special characters are encoded. Arguments that are passed to a shell, for
    example, frequently have problems with paths that contain a space. In URL notation, spaces are encoded as “%20” (see
    ). Use the functions ConvertToURL to convert a system-specific path to URL notation and ConvertFromURL to convert to
    a system-specific path.
</p>
<p>
    <strong>Listing .</strong> Converting to and from a URL.
</p>
<p>
    Sub ToFromURL
</p>
<p>
    Print ConvertToURL("/home/andy/logo.miff")
</p>
<p>
    Print ConvertFromURL("file:///home/andy/logo.miff") 'This requires UNIX
</p>
<p>
    Print ConvertToURL("c:\My Documents") 'This requires Windows
</p>
<p>
    Print ConvertFromURL("file:///c:/My%20Documents") 'This requires windows
</p>
<p>
    End Sub
</p>
<p>
    Special characters, such as the space, are encoded with a percent sign (%) followed by the ASCII value of the
    character encoded as a two-digit hexadecimal number. The space character has an ASCII value of 32, which is 20 in
    hexadecimal format. This is why a space is encoded as %20.
</p>
<p>
    <strong>Listing .</strong> Special URL characters.
</p>
<p>
    Sub URLSpecialEncoding
</p>
<p>
    Print ConvertFromURL("file:///%41%42%43/%61%62%63") '/ABC/abc (UNIX)
</p>
<p>
    Print ConvertFromURL("file://c:/%41%42%43/%61%62%63")'/ABC/abc (Windows)
</p>
<p>
    End Sub
</p>
<p>
    URL notation is system independent, so URL paths work as well on an Apple computer as they do on a Windows computer.
    To create a system-specific path, use the function GetPathSeparator to obtain the system-specific path separator.
    demonstrates how to use GetPathSeparator to build a complete path. Windows-based computers use “\” as the path
    separator, and Unix-based computers use “/” as the path separator. URL notation uses “/” as the separator regardless
    of the operating system.
</p>
<p>
    <strong>Listing .</strong> Use GetPathSeparator() rather than “\” or “/”.
</p>
<p>
    sPathToFile = "C:\temp"
</p>
<p>
    sBookName = "OOME.odt"
</p>
<p>
    sPathToBook = sPathToFile &amp; GetPathSeparator() &amp; sBookName
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Visual Basic for Applications (VBA) does not support the function GetPathSeparator, but it does have the
                property Application.PathSeparator, which always returns a backslash, even on a Macintosh computer. VBA
                also does not support ConvertToURL or ConvertFromURL.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="directory-manipulation-functions">
                    <span id="anchor-146"></span>Directory manipulation functions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Some functions apply equally well to directories as well as files. This section is concerned with those that apply
    only to directories.
</p>
<p>
    The function CurDir, with a drive specifier as the argument, returns the current directory for the specified drive.
    See and . If the argument is omitted, the current directory for the current drive is returned. The drive specifier
    is ignored on Unix systems. The initial value of the current directory is system dependent and may change depending
    upon how OOo is started. If you start OOo from a command-line prompt, you’ll likely have a different current
    directory than if you start OOo from a menu or another application. For some operating systems, using File | Open to
    open an existing document sets the current directory to the directory containing the opened document (I have seen
    this in Windows). In some operating systems, such as Linux, this does not affect the current directory. Do not rely
    on this behavior!
</p>
<p>
    <strong>Listing .</strong> Print the current directory.
</p>
<p>
    Sub ExampleCurDir
</p>
<p>
    MsgBox "Current directory on this computer is " &amp;_
</p>
<p>
    CurDir, 0, "Current Directory Example"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000004EE0000017384E13BD9.png" style="width:3.0508in;height:0.8307in" />
</p>
<p>
    <strong>Figure .</strong> CurDir returns the current directory.
</p>
<p>
    The functions ChDir and ChDrive, although present in OOo Basic, do nothing and will likely be removed from the
    language. Their original purpose was to change the current drive and directory, but this was a system wide change,
    which is dangerous in multitasking environments like we use today. The initial current directory is dependent upon
    the operating system and how OOo was opened. The initial values, therefore, cannot be assumed.
</p>
<p>
    Use the MkDir function to create a directory, and RmDir to remove a directory. In , a directory path is created from
    the argument to MkDir. If an absolute path is not provided, the created directory is relative to the current
    directory as obtained with the function CurDir. The function RmDir removes the directory, all directories below it,
    and all files contained in the directories. This macro calls OOMEWorkDir in .
</p>
<p>
    <strong>Listing .</strong> Create and then remove directories in the OOME Work Directory.
</p>
<p>
    Sub ExampleCreateRmDirs
</p>
<p>
    If NOT CreateOOMEWorkDir() Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    Dim sWorkDir$
</p>
<p>
    Dim sPath$
</p>
<p>
    sWorkDir = OOMEWorkDir()
</p>
<p>
    sPath = sWorkDir &amp; "a" &amp; GetPathSeparator() &amp; "b"
</p>
<p>
    MkDir sPath
</p>
<p>
    Print "Created " &amp; sPath
</p>
<p>
    RmOOMEWorkDir()
</p>
<p>
    Print "Removed " &amp; sWorkDir
</p>
<p>
    End Sub
</p>
<p>
    The code in uses absolute paths. It’s possible to use relative paths, but I strongly discourage it. The behavior of
    the current directory is operating-system dependent.
</p>
<p>
    File-related functions that also work with directories include Dir, FileDateTime, FileExists, FileLen, GetAttr, and
    Name. These are discussed later.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="file-manipulation-functions">
                    <span id="anchor-147"></span>File manipulation functions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    This section explores functions that deal with inspecting and manipulating entire files, rather than the contents of
    those files. Some of these functions have a dual purpose, acting on both files and directories. In each case, the
    function accepts at least one argument that identifies a file or directory. The following things are true about
    arguments that identify files or directories:
</p>
<p>
    If the path is not present, the current directory<em><em> — </em></em>as returned by CurDir<em><em> — </em></em>is
    used.
</p>
<p>
    The system representation and the URL notation are both allowed. For example, “C:\tmp\foo.txt” and
    “file:///c:/tmp/foo.txt” refer to the same file.
</p>
<p>
    Unless it is explicitly stated, a single file or directory must be uniquely identified. The only function that
    accepts a file specification is Dir, which returns a listing of files matching the file specification.
</p>
<p>
    Each file and directory has attributes (see ). Each attribute represents a single bit in a number, allowing each
    item in a path to have multiple attributes set at the same time. Some attributes have been deprecated to be more
    system dependent. Not all systems support hidden or system files, for example. Use GetAttr to return the attributes.
</p>
<p>
    <strong>Table .</strong> File and directory attributes.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                No
            </td>
            <td>
                0
            </td>
            <td>
                Normal; no bits set
            </td>
        </tr>
        <tr class="even">
            <td>
                No
            </td>
            <td>
                1
            </td>
            <td>
                Read-Only
            </td>
        </tr>
        <tr class="odd">
            <td>
                Yes
            </td>
            <td>
                2
            </td>
            <td>
                Hidden
            </td>
        </tr>
        <tr class="even">
            <td>
                Yes
            </td>
            <td>
                4
            </td>
            <td>
                System
            </td>
        </tr>
        <tr class="odd">
            <td>
                No
            </td>
            <td>
                8
            </td>
            <td>
                Volume
            </td>
        </tr>
        <tr class="even">
            <td>
                No
            </td>
            <td>
                16
            </td>
            <td>
                Directory
            </td>
        </tr>
        <tr class="odd">
            <td>
                No
            </td>
            <td>
                32
            </td>
            <td>
                Archive bit (file changed since last backed up)
            </td>
        </tr>
    </tbody>
</table>
<p>
    The function in accepts an attribute from the GetAttr function and returns an easy-to-understand string. If no bits
    are set, the attributes indicate a normal file.
</p>
<p>
    <strong>Listing .</strong> Print attributes as a string.
</p>
<p>
    REM uses bitwise comparison to read the attributes
</p>
<p>
    Function FileAttributeString(x As Integer) As String
</p>
<p>
    Dim s As String
</p>
<p>
    If (x = 0) Then
</p>
<p>
    s = "Normal"
</p>
<p>
    Else
</p>
<p>
    If (x AND 16) &lt;&gt; 0 Then s = "Directory" 'Directory bit 00010000 set
</p>
<p>
    If (x AND 1) &lt;&gt; 0 Then s = s &amp; " Read-Only" 'read-only bit 00000001 set
</p>
<p>
    If (x AND 2) &lt;&gt; 0 Then s = s &amp; " Hidden" 'Deprecated
</p>
<p>
    If (x AND 4) &lt;&gt; 0 Then s = s &amp; " System" 'Deprecated
</p>
<p>
    If (x AND 8) &lt;&gt; 0 Then s = s &amp; " Volume" 'Volume bit 00001000 set
</p>
<p>
    If (x AND 32) &lt;&gt; 0 Then s = s &amp; " Archive" 'Archive bit 00100000 set
</p>
<p>
    End If
</p>
<p>
    FileAttributeString = s
</p>
<p>
    End Function
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                performs bit operations (explained later) to determine which attributes are set.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the GetAttr function to get the attributes of a file, and use SetAttr to set the attributes. The first argument
    to the function SetAttr is the name of the file<em><em> — </em></em>relative or absolute<em><em> — </em></em>and the
    second argument is a number representing the attributes to set or clear. In other words, after calling SetAttr(name,
    n), the function GetAttr(name) should return the integer n. For example, calling SetAttr with the attribute set to
    32 sets the archive bit and clears all the others so GetAttr returns 32. To set more than one bit at the same time,
    use the OR operator to combine attributes. Use SetAttr(fileName, 1 OR 32) to set both the archive bit and the
    read-only bit. SetAttr works on directories as well as files.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Attributes favor the Windows environment. On Unix-based operating systems such as Linux and Sun, setting
                attributes affects the user, group, and world settings. Setting the attribute to 0 (not read-only)
                corresponds to “rwxrwxrwx”. Setting the attribute to 1 (read-only) corresponds to “r r r”.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the FileLen function to determine the length of a file. The return value is a long. The function in obtains the
    file length and then creates a pretty string to display the length. The file length is returned in bytes — K, MB, G,
    or T — depending on the length. This produces a more easily understood result than a simple number.
</p>
<p>
    <strong>Listing .</strong> Display a number in a nice readable form such as 2K rather than 2048.
</p>
<p>
    Function PrettyFileLen(path$) As String
</p>
<p>
    PrettyFileLen = nPrettyFileLen(FileLen(path))
</p>
<p>
    End Function
</p>
<p>
    Function nPrettyFileLen(ByVal n As Double) As String
</p>
<p>
    Dim i As Integer 'Count number of iterations
</p>
<p>
    Dim v() As Variant 'Holds abbreviations for Kilobytes, Megabytes, ...
</p>
<p>
    v() = Array("bytes", "K", "MB", "G", "T") 'Abbreviations
</p>
<p>
</p>
<p>
    REM Every time that the number is reduced by 1 kilobyte,
</p>
<p>
    REM the counter is increased by 1.
</p>
<p>
    REM Do not decrease the size to less than 1 kilobyte.
</p>
<p>
    REM Do not increase the counter by more than the size of the array.
</p>
<p>
    Do While n &gt; 1024 AND i+1 &lt; UBound(v())
</p>
<p>
    n = Fix(n / 1024) 'Truncate after the division
</p>
<p>
    i = i + 1 'Started at i=0 (bytes) increment to next abbreviation
</p>
<p>
    Loop
</p>
<p>
    nPrettyFileLen = CStr(n) &amp; v(i)
</p>
<p>
    End Function
</p>
<p>
    Use the FileExists function to determine if a file or directory exists. Use FileDateTime to return a string with the
    date and time that a file was created or last modified. The returned string is in a system-dependent format. On my
    computer, the format is “MM/DD/YYYY HH:MM:SS”. The returned string can be passed directly to the function CDate. The
    GetFileInfo macro in uses all of the file and directory inspection functions to return information in an
    easy-to-read format. Also see .
</p>
<p>
    <strong>Listing .</strong> Get information about a file.
</p>
<p>
    Function GetFileInfo(path) As String
</p>
<p>
    Dim s As String
</p>
<p>
    Dim iAttr As Integer
</p>
<p>
    s = "The path """ &amp; path &amp; """"
</p>
<p>
    If Not FileExists(path) Then
</p>
<p>
    GetFileInfo = s &amp; " does not exist"
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    s = s &amp; " exists" &amp; CHR$(10)
</p>
<p>
    s = s &amp; "Date and Time = " &amp; FileDateTime(path) &amp; CHR$(10)
</p>
<p>
    iAttr = GetAttr(path)
</p>
<p>
    REM The length of a directory is always zero
</p>
<p>
    If (iAttr AND 16) = 0 Then
</p>
<p>
    s = s &amp; "File length = " &amp; PrettyFileLen(path) &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    s = s &amp; "Attributes = " &amp; FileAttributeString(iAttr) &amp; CHR$(10)
</p>
<p>
    GetFileInfo = s
</p>
<p>
    End Function
</p>
<p>
    <img src="Pictures/100000000000063C0000023B6229EFF4.png" style="width:3.7681in;height:1.2398in" />
</p>
<p>
    <strong>Figure .</strong> You can learn a lot about a file by using the file-inspection functions.
</p>
<p>
    Use the Kill statement to delete a file from the disk. A run-time error occurs if the file does not exist.
</p>
<p>
    Kill("C:\temp\BadFile.txt")
</p>
<p>
    Use the FileCopy function to copy files. The first argument is the file to copy and the second argument is the
    destination file. See . The FileCopy function is able to recursively copy entire directories, but it can’t handle
    file specifications. Surprisingly, if the first argument is a file, the second argument must also be a file<em><em>
            — </em></em>I expected that I could copy a file to a directory with FileCopy("C:\auto.bat", "C:\bak\").
</p>
<p>
    <strong>Table .</strong> Arguments to FileCopy.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Yes
            </td>
            <td>
                File
            </td>
            <td>
                File
            </td>
            <td>
                Copy the file. The names do not have to be the same.
            </td>
        </tr>
        <tr class="even">
            <td>
                Yes
            </td>
            <td>
                Directory
            </td>
            <td>
                Directory
            </td>
            <td>
                Recursively copy all files and directories contained in one directory to another directory.
            </td>
        </tr>
        <tr class="odd">
            <td>
                No
            </td>
            <td>
                file spec
            </td>
            <td>
            </td>
            <td>
                File specifications (wildcards, for example, *.*) are not allowed.
            </td>
        </tr>
        <tr class="even">
            <td>
                No
            </td>
            <td>
                File
            </td>
            <td>
                Directory
            </td>
            <td>
                If the source is a file, the destination must also be a file.
            </td>
        </tr>
    </tbody>
</table>
<p>
    FileCopy("C:\auto.bat", "C:\auto.bak") 'Copy file
</p>
<p>
    FileCopy("C:\auto.bat", "C:\tmp\auto.bat") 'Copy file
</p>
<p>
    FileCopy("C:\logs", "C:\bak") 'Copy directory
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Do not recursively copy a directory into itself — this creates an infinite loop. For example,
                FileCopy("C:\logs", "C:\logs\bak") will never finish because the “bak” subdirectory immediately becomes
                part of the contents of “logs”, which then has to be copied as well. Bad idea.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the Name statement to rename a file or directory. This statement has an unusual syntax: It places the keyword As
    between the source and destination names.
</p>
<p>
    Name "C:\Joe.txt" As "C:\bill.txt" 'Rename a file
</p>
<p>
    Name "C:\logs" As "C:\oldlogs" 'Rename a directory
</p>
<p>
    Name "C:\Joe.txt" As "C:\tmp\joe.txt" 'Move the file to the tmp directory
</p>
<p>
    Name "C:\logs" As "C:\bak\logs" 'Move the logs directory
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                A common power-user trick is to use the Name command to move a file or directory from one location to
                another.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="file-attributes-bitmasks-and-binary-numbers">
                    <span id="anchor-148"></span>File attributes, bitmasks, and binary numbers
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    It isn’t necessary to understand binary numbers and bitmasks to use either file attributes or bitmasks in OOo Basic,
    so don’t panic; simply skip the parts that make your head spin. Understanding this material, however, makes it
    simpler to understand what is happening with file attributes and how to use them.
</p>
<p>
    The file and directory attributes in were strategically chosen to have a nice property when written in base 2 (see
    )<em><em> — </em></em>each attribute has only one bit set. Zero is a special case<em><em> — </em></em>it has no bits
    set.
</p>
<p>
    <strong>Table .</strong> File and directory attributes.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                00
            </td>
            <td>
                0000 0000
            </td>
            <td>
                Normal
            </td>
            <td>
                No bits set
            </td>
        </tr>
        <tr class="even">
            <td>
                01
            </td>
            <td>
                0000 0001
            </td>
            <td>
                Read-Only
            </td>
            <td>
                Bit 1 set
            </td>
        </tr>
        <tr class="odd">
            <td>
                02
            </td>
            <td>
                0000 0010
            </td>
            <td>
                Hidden
            </td>
            <td>
                Bit 2 set
            </td>
        </tr>
        <tr class="even">
            <td>
                04
            </td>
            <td>
                0000 0100
            </td>
            <td>
                System
            </td>
            <td>
                Bit 3 set
            </td>
        </tr>
        <tr class="odd">
            <td>
                08
            </td>
            <td>
                0000 1000
            </td>
            <td>
                Volume
            </td>
            <td>
                Bit 4 set
            </td>
        </tr>
        <tr class="even">
            <td>
                16
            </td>
            <td>
                0001 0000
            </td>
            <td>
                Directory
            </td>
            <td>
                Bit 5 set
            </td>
        </tr>
        <tr class="odd">
            <td>
                32
            </td>
            <td>
                0010 0000
            </td>
            <td>
                Archive
            </td>
            <td>
                Bit 6 set
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use GetAttr to obtain the attributes of a file or path. If the file or path is a directory, then bit 5 is set. If
    the file or path is read-only, then bit 1 is set. A returned attribute of 0 means that no bits are set and that this
    is a normal file. Consider an attribute value of 33, which in binary is 0010 0001. Bit 1 is set, so this is
    read-only. Bit 6 is set, so this file has changed since it was last archived. You can see that you don’t need to
    know how to convert a decimal number into a binary number. However, you do need to know how to write a macro to
    determine which bits are set and which bits are not set. Use the AND operator to determine which bits are set. With
    AND, two things must both be true for the answer to be true. For example, my flashlight works if it has a light bulb
    AND it has batteries.
</p>
<p>
    The AND operator works with numbers by performing this logical operation on each of the bits. For example, “3 AND 5”
    represented as base 2 is “0011 AND 0101 = 0001”. Bit 1<em><em> — </em></em>the bit in the rightmost position<em><em>
            — </em></em>in each number is equal to 1, so bit 1 in the result is also 1. All of the other bits do not
    have corresponding 1s in the same position, so all of the other bits in the result equal zero.
</p>
<p>
    Now I’ll apply this idea to the problem at hand. If the numeric value of an attribute is not zero, then at least one
    property is set. Given this, you can then check each attribute as illustrated by the example in .
</p>
<p>
    <strong>Table .</strong> Check attribute value 33 (100001) for each file property.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                <p>
                    10 0001
                </p>
                <p>
                    AND 00 0001
                </p>
                <p>
                    (1) 00 0001
                </p>
            </td>
            <td>
                <p>
                    10 0001
                </p>
                <p>
                    AND 00 0010
                </p>
                <p>
                    (0) 00 0000
                </p>
            </td>
            <td>
                <p>
                    10 0001
                </p>
                <p>
                    AND 00 0100
                </p>
                <p>
                    (0) 00 0000
                </p>
            </td>
            <td>
                <p>
                    10 0001
                </p>
                <p>
                    AND 00 1000
                </p>
                <p>
                    (0) 00 0000
                </p>
            </td>
            <td>
                <p>
                    10 0001
                </p>
                <p>
                    AND 01 0000
                </p>
                <p>
                    (0) 00 0000
                </p>
            </td>
            <td>
                <p>
                    10 0001
                </p>
                <p>
                    AND 10 0000
                </p>
                <p>
                    (32)10 0000
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    To do this in OOo Basic, use code similar to the following:
</p>
<p>
    If TheAttribute = 0 Then
</p>
<p>
    REM No attributes set
</p>
<p>
    Else
</p>
<p>
    If (TheAttribute AND 1) = 1 Then ... 'Read-Only file: bit 1 is set
</p>
<p>
    If (TheAttribute AND 16) = 16 Then ... 'Directory: bit 5 is set.
</p>
<p>
    If (TheAttribute AND 4) &lt;&gt; 0 Then ... 'Another way to code the same logic.
</p>
<p>
    End If
</p>
<p>
    Each file and directory has an attribute defined as these bit patterns. If a bit in the attribute that corresponds
    to a particular property is set, then the file has that property. Performing the AND operator with the individual
    bit positions determines if the file has that property. The function FileAttributeString in uses this method.
</p>
<p>
    To set the archive bit and read-only bit on a file, combine the bits and call the function once. Use the OR operator
    to combine bit patterns. With the OR operator, if either bit is set, the resulting bit is a 1. To set the read-only
    and the archive bits, use “1 OR 32”. If you set the attributes to 1, then all of the other attributes will be
    cleared and only the read-only bit will be set.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="obtaining-a-directory-listing">
                    <span id="anchor-149"></span>Obtaining a directory listing
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the Dir function to obtain a directory listing. The first argument is a file specification. Although a file or
    directory may be uniquely identified, file specs (also called wildcards) are allowed. For example, the command
    Dir("C:\temp\*.txt") returns a list of all files that have the extension TXT. The second argument specifies
    attributes, for which there are two valid values: 0 (the default) returns files; set the second argument to 16 to
    retrieve a list of directories.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Most operating systems contain two special directory names, represented by a single period (.) and a
                double period (..). A single period references the current directory, and two periods reference the
                parent directory. These special directories are included in the directory list as returned by the Dir
                function. If you write a macro that looks at each directory recursively but you don’t take these two
                into consideration, your macro will erroneously run forever.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The first call to Dir starts reading a directory and returns the first file that matches. Each additional call,
    which takes no arguments, returns the next file that matches.
</p>
<p>
    sFileName = Dir(path, attribute) 'Get the first one
</p>
<p>
    Do While (sFileName &lt;&gt; "") 'While something found
</p>
<p>
    sFileName = Dir() 'Get the next one
</p>
<p>
    Loop
</p>
<p>
    If the path uniquely identifies a file or directory, only one entry is returned. For example, the command
    Dir("C:\tmp\autoexec.bat") returns the single file “autoexec.bat”. Less obviously, the command Dir("C:\tmp") returns
    the single directory “tmp”. To determine what a directory contains, the path must either contain a file specifier
    (C:\tmp\*.*) or the path must contain a trailing path separator (C:\tmp\). The code in <strong> </strong>performs a
    simple listing of the current directory; it uses the function GetPathSeparator to obtain the path separator in an
    operating-system-independent way.
</p>
<p>
    <strong>Listing .</strong> List the files in the current directory.
</p>
<p>
    Sub ExampleDir
</p>
<p>
    Dim s As String 'Temporary string
</p>
<p>
    Dim sFileName As String 'Last name returned from DIR
</p>
<p>
    Dim i As Integer 'Count number of dirs and files
</p>
<p>
    Dim sPath 'Current path with path separator at end
</p>
<p>
    sPath = CurDir &amp; GetPathSeparator() 'With no separator, DIR returns the
</p>
<p>
    sFileName = Dir(sPath, 16) 'directory rather than what it contains
</p>
<p>
    i = 0 'Initialize the variable
</p>
<p>
    Do While (sFileName &lt;&gt; "") 'While something returned
</p>
<p>
    i = i + 1 'Count the directories
</p>
<p>
    s = s &amp; "Dir " &amp; CStr(i) &amp;_
</p>
<p>
    " = " &amp; sFileName &amp; CHR$(10) 'Store in string for later printing
</p>
<p>
    sFileName = Dir() 'Get the next directory name
</p>
<p>
    Loop
</p>
<p>
    i = 0 'Start counting over for files
</p>
<p>
    sFileName = Dir(sPath, 0) 'Get files this time!
</p>
<p>
    Do While (sFileName &lt;&gt; "")
</p>
<p>
    i = i + 1
</p>
<p>
    s = s &amp; "File " &amp; CStr(i) &amp; " = " &amp; sFileName &amp; " " &amp;_
</p>
<p>
    PrettyFileLen(sPath &amp; sFileName) &amp; CHR$(10)
</p>
<p>
    sFileName = Dir()
</p>
<p>
    Loop
</p>
<p>
    MsgBox s, 0, ConvertToURL(sPath)
</p>
<p>
    End Sub
</p>
<p>
    Sample output from is shown in . First, the directories are listed. The first two directories, “.” and “..”,
    represent the following:
</p>
<p>
    file:///home/andy/My%20Documents/OpenOffice/
</p>
<p>
    file:///home/andy/My%20Documents/
</p>
<p>
    The inclusion of “.” and “..” is a common source of problems. A listing of directories contains these two
    directories, which should usually be ignored.
</p>
<p>
    <img src="Pictures/10000000000006B40000055BE13C5550.png" style="width:3.9717in;height:2.9417in" />
</p>
<p>
    <strong>Figure .</strong> Directory listing of the current directory.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="open-a-file">
                    <span id="anchor-150"></span>Open a file
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OpenOffice.org uses low-level, system-specific methods to manipulate files. The operating system maintains a list of
    the open files and identifies them with a number, which is called a “file handle.” In the world of Basic, this is
    usually called the “file number” or “data channel.”
</p>
<p>
    To open a file, you must tell it what file number (file handle) to use. Use the FreeFile function to obtain an
    unused file number, which will be used when opening a file, referencing the open file, and when closing the file.
    The Open statement is used to open a file before it is usable for reading or writing. The Open statement requires a
    file number, which should always be obtained from the FreeFile function. Use the Close statement when you are
    finished with the file. You can close multiple files in a single statement by providing a comma-separated list of
    numbers after the Close statement. Use the Reset function to close all of the open files at one time without having
    to explicitly list the file numbers. All open file numbers are closed and their data is flushed to disk.
</p>
<p>
    n = FreeFile()
</p>
<p>
    Open FileName For Mode [Access ioMode] [Lock Mode] As #n [Len=Datalen]
</p>
<p>
    Close #n
</p>
<p>
    “FileName” is the name of the file that you want to open. If the file name does not include the path, the current
    directory is assumed. “For Mode” specifies the state of the file when it is opened and how you intend to use the
    file (see ).
</p>
<p>
    <strong>Table .</strong> Valid “For Mode” values and the resulting configuration if Access is not used.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                For Append
            </td>
            <td>
                end
            </td>
            <td>
                Open
            </td>
            <td>
                Create
            </td>
            <td>
                Yes
            </td>
            <td>
                Yes
            </td>
            <td>
                Sequential access
            </td>
        </tr>
        <tr class="even">
            <td>
                For Input
            </td>
            <td>
                start
            </td>
            <td>
                Open
            </td>
            <td>
                error
            </td>
            <td>
                Yes
            </td>
            <td>
                No
            </td>
            <td>
                Sequential access
            </td>
        </tr>
        <tr class="odd">
            <td>
                For Output
            </td>
            <td>
                start
            </td>
            <td>
                Delete
            </td>
            <td>
                Create
            </td>
            <td>
                Yes
            </td>
            <td>
                Yes
            </td>
            <td>
                Sequential access
            </td>
        </tr>
        <tr class="even">
            <td>
                For Binary
            </td>
            <td>
                start
            </td>
            <td>
                Delete
            </td>
            <td>
                Create
            </td>
            <td>
                Yes
            </td>
            <td>
                Yes
            </td>
            <td>
                Random access
            </td>
        </tr>
        <tr class="odd">
            <td>
                For Random
            </td>
            <td>
                start
            </td>
            <td>
                Delete
            </td>
            <td>
                Create
            </td>
            <td>
                Yes
            </td>
            <td>
                Yes
            </td>
            <td>
                Random access
            </td>
        </tr>
    </tbody>
</table>
<p>
    Each mode has its own set of behaviors as shown in . Consider the row For Input, this can be read to say: When a
    file is opened “For Input”:
</p>
<ol type="1">
    <li>
        The file pointer is positioned at the start of the file.
    </li>
    <li>
        If the file exists, it is opened (and not deleted).
    </li>
    <li>
        If the file does not exist, an error is generated.
    </li>
    <li>
        The file is opened with read access, but not write access (assuming that Access is not explicitly provided).
    </li>
    <li>
        Sequential access is used for reading the file.
    </li>
</ol>
<p>
    Unfortunately, the precise implementation is dependent on the operating system and even the compiler used to create
    your version of OOo; for example, on some systems, you can write to a file opened for Input.
</p>
<p>
    When a file is open, a pointer into the file is maintained. This pointer identifies where the next read or write
    operation will occur. For example, if the file pointer is at the start of the file, the next “read” command will
    read the first thing in the file. If the file pointer is at the end of the file, the next “write” command will
    append data to the end of the file. You have some control over the initial position of the file pointer when the
    file is opened, and you can move this file pointer around when the file is open. All of the “For” modes, except “For
    Append,” position the file pointer at the start of the file.
</p>
<p>
    You can access a file sequentially or randomly. A sequential file is similar to a video tape. Although you can fast
    forward and rewind the tape to a specific location on the tape, the entire tape moves past the read/write head. You
    then press Play or Record and the data is either sequentially read from or written to the tape. A random file is
    similar to a music CD. Although you can play the CD sequentially, it isn’t required; you can quickly jump to any
    song and play it. To make the analogy more accurate, however, each song on the CD must be the same size. This is the
    disadvantage to the “For Random” mode.
</p>
<p>
    Consider storing names of different lengths in a file on the disk. Storing one name per line in the file is
    efficient with respect to space. You can use a new-line character between each name. To find a specific name in the
    file, you start at the beginning and read until you find the person’s name. On the other hand, if you know that the
    longest name is 100 characters, you can store each name on the disk, and store enough spaces after the name to use a
    total of 100 characters for each name. This wastes space, but it allows you to quickly move between names on the
    disk, because of the regular file structure. To read or write the 1000th name in the file, you simply move directly
    to that record. You have wasted space in this design, but you have gained speed performance. All of the “For”
    modes,” except “For Binary” and “For Random,” specify sequential file access. Random files use this ability to fix
    the record length to the maximum size of interest in order to permit very rapid file access and retrieval.
</p>
<p>
    The access modes in affect the default treatment of a file when it is opened. When an access mode is specified, it
    also verifies that you have access to either read or write the file. If you do not have write access to a file
    opened with “Access Write,” a run-time error occurs. The access mode affects every open “For” mode except “For
    Append”<em><em> — </em></em>which never deletes an existing file when it is opened.
</p>
<p>
    <strong>Table .</strong> Valid Access ioModes.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Access Read
            </td>
            <td>
                Do not delete an existing file. Verify that you have read access.
            </td>
        </tr>
        <tr class="even">
            <td>
                Access Write
            </td>
            <td>
                Delete an existing file. Verify that you have write access.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Access Read Write
            </td>
            <td>
                Delete an existing file. Verify that you have read and write access.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Using “Access Write” while opening a file “For Input” allows you to write to the file after it is opened; first the
    file is erased and then a new file is created. After the file is open, different operating systems enforce the
    access rights differently. As of OOo version 1.1.1, opening a binary or random file with “Access Read” allows you to
    write to the file when using Windows, but not on Linux. It is always safe to open a file “For Append” and then move
    the file pointer to the start of the file manually.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The only safe way to open a file for both reading and writing without erasing the contents of the file
                is to open the file “For Append,” and then move the file pointer to the start of the file.
            </td>
        </tr>
    </tbody>
</table>
<p>
    To limit access to a file while it’s open, use the “Lock” modes (see). This prevents others from reading and/or
    writing to the file while you have it open. This is primarily used in multi-user environments because you can’t
    control what others might try to do while you are using the file.
</p>
<p>
    <strong>Table .</strong> Valid protected keywords.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Lock Read
            </td>
            <td>
                Others cannot read the file while it’s open, but they can write to it.
            </td>
        </tr>
        <tr class="even">
            <td>
                Lock Write
            </td>
            <td>
                Others cannot write the file while it’s open, but they can read from it.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Lock Read Write
            </td>
            <td>
                Others cannot read or write the file while it is open.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the Len keywords to specify the size of each record when the file is opened “For Random” (discussed later).
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="information-about-open-files">
                    <span id="anchor-151"></span>Information about open files
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic has functions that return file information by using the file name (see ). It is also possible to obtain
    information about open files from the file number. The FileAttr function returns how the file associated with the
    given file number was opened. lists the return values and their meanings.
</p>
<p>
    FileAttr(n, 1) 'How the file was opened in BASIC using Open For ...
</p>
<p>
    <strong>Table .</strong> Description of FileAttr() return values.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                Open For Input
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                Open For Output
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                Open For Random
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                Open for Append
            </td>
        </tr>
        <tr class="odd">
            <td>
                16
            </td>
            <td>
                Open For Binary
            </td>
        </tr>
        <tr class="even">
            <td>
                32
            </td>
            <td>
                Documentation incorrectly states that this is for open for binary.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                FileAttr is incorrectly documented. FileAttr(n, 2) does not return a system file handle, if the second
                argument is not 1, the return value is always 0. Another problem is that the included help incorrectly
                states that Binary has a return value of 32.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the EOF function to determine if the end of the file has been reached. A typical use is to read all of the data
    until “End Of File.”
</p>
<p>
    n = FreeFile 'Always find the next free file number
</p>
<p>
    Open FileName For Input As #n 'Open the file for input
</p>
<p>
    Do While NOT EOF(n) 'While NOT End Of File
</p>
<p>
    Input #n, s 'Read some data!
</p>
<p>
    REM Process the input here!
</p>
<p>
    Loop
</p>
<p>
    Use the LOF function to determine the length of an open file. This number is always in bytes.
</p>
<p>
    LOF(n)
</p>
<p>
    Use the Loc function to obtain the current location of the file pointer. This number is not always accurate and the
    return value has a different meaning depending on how the file was opened. Loc returns the actual byte position for
    files opened in Binary mode. For Random files, Loc returns the record number of the last record read or written. For
    sequential files opened with Input, Output, or Append, however, the number returned by Loc is the current byte
    position divided by 128. This is done to maintain compatibility with other versions of BASIC.
</p>
<p>
    Loc(n)
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                If a file is opened in a mode other than Random, and OOo Basic considers the file a text file, Loc
                returns the line number that will be read next. I cannot decide if this is a bug or just incomplete
                documentation. Sometimes the return values from Loc are just wrong. For example, if you open a file for
                output and then write some text, Loc returns 0.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The Seek function, when used with only one argument, returns the next position that will be read or written. This is
    similar to the Loc function except that for sequential files, the absolute byte position is always returned. If you
    want to save the position in a file and return to it later, use the Seek function to obtain the current file
    pointer; then you can use the Seek function to return the file pointer to the original location.
</p>
<p>
    position = Seek(n) 'Obtain and save the current position.
</p>
<p>
    statements 'Do arbitrary stuff.
</p>
<p>
    Seek(n, position) 'Move the file pointer back to the original position.
</p>
<p>
    The argument for setting the file pointer using the Seek function is the same as the value returned by the Seek
    function. For Random files, the position is the number of the object to read, not the byte position. For sequential
    files, the position is the byte position in the file. The macro in returns information about an open file from the
    file number, including the open mode, file length, and file pointer location. uses , and the result is shown in .
</p>
<p>
    <strong>Listing .</strong> Return information about an open file as a string.
</p>
<p>
    Function GetOpenFileInfo(n As Integer) As String
</p>
<p>
    Dim s As String
</p>
<p>
    Dim iAttr As Integer
</p>
<p>
    On Error GoTo BadFileNumber
</p>
<p>
    iAttr = FileAttr(n, 1)
</p>
<p>
    If iAttr = 0 Then
</p>
<p>
    s = "File handle " &amp; CStr(n) &amp; " is not currently open" &amp; CHR$(10)
</p>
<p>
    Else
</p>
<p>
    s = "File handle " &amp; CStr(n) &amp; " was opened in mode:"
</p>
<p>
    If (iAttr AND 1) = 1 Then s = s &amp; " Input"
</p>
<p>
    If (iAttr AND 2) = 2 Then s = s &amp; " Output"
</p>
<p>
    If (iAttr AND 4) = 4 Then s = s &amp; " Random"
</p>
<p>
    If (iAttr AND 8) = 8 Then s = s &amp; " Append"
</p>
<p>
    If (iAttr AND 16) = 16 Then s = s &amp; " Binary"
</p>
<p>
    iAttr = iAttr AND NOT (1 OR 2 OR 4 OR 8 OR 16)
</p>
<p>
    If iAttr AND NOT (1 OR 2 OR 4 OR 8 OR 16) &lt;&gt; 0 Then
</p>
<p>
    s = s &amp; " unsupported attribute " &amp; CStr(iAttr)
</p>
<p>
    End If
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    s = s &amp; "File length = " &amp; nPrettyFileLen(LOF(n)) &amp; CHR$(10)
</p>
<p>
    s = s &amp; "File location = " &amp; CStr(LOC(n)) &amp; CHR$(10)
</p>
<p>
    s = s &amp; "Seek = " &amp; CStr(Seek(n)) &amp; CHR$(10)
</p>
<p>
    s = s &amp; "End Of File = " &amp; CStr(EOF(n)) &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    AllDone:
</p>
<p>
    On Error GoTo 0
</p>
<p>
    GetOpenFileInfo = s
</p>
<p>
    Exit Function
</p>
<p>
    BadFileNumber:
</p>
<p>
    s = s &amp; "Error with file handle " &amp; CStr(n) &amp; CHR$(10) &amp;_
</p>
<p>
    "The file is probably not open" &amp; CHR$(10) &amp; Error()
</p>
<p>
    Resume AllDone
</p>
<p>
    End Function
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The position argument passed to the Seek function is one-based, not zero-based. This means that the
                first byte or record is 1, not 0. For example, Seek(n, 1) positions the file pointer to the first byte
                or record in the file.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in opens a file for output. A large amount of data is written to the file to give it some size. At this
    point, the Loc function returns 0 and EOF returns True. The Seek function is used to move the file pointer to a
    position in the file that allows some data to be read. The Loc function still returns 0. One hundred pieces of data
    are read from the file in order to advance the value returned by the Loc function. Finally, the file is deleted from
    the disk. shows information based on a file number.
</p>
<p>
    <strong>Listing .</strong> Create delme.txt in the current directory and print file information.
</p>
<p>
    Sub WriteExampleGetOpenFileInfo
</p>
<p>
    Dim FileName As String 'Holds the file name
</p>
<p>
    Dim n As Integer 'Holds the file number
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
    Dim s As String 'Temporary string for input
</p>
<p>
    FileName = ConvertToURL(CurDir) &amp; "/delme.txt"
</p>
<p>
    n = FreeFile() 'Next free file number
</p>
<p>
    Open FileName For Output Access Read Write As #n 'Open for read/write
</p>
<p>
    For i = 1 To 15032 'Write a lot of data
</p>
<p>
    Write #n, "This is line ",CStr(i),"or",i 'Write some text
</p>
<p>
    Next
</p>
<p>
    Seek #n, 1022 'Move the file pointer to location 1022
</p>
<p>
    For i = 1 To 100 'Read 100 pieces of data; this will set Loc
</p>
<p>
    Input #n, s 'Read one piece of data into the variable s
</p>
<p>
    Next
</p>
<p>
    MsgBox GetOpenFileInfo(n), 0, FileName
</p>
<p>
    Close #n
</p>
<p>
    Kill(FileName) 'Delete this file, I do not want it
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000013B00000092FBF097CE.png" style="width:3.2811in;height:1.5209in" />
</p>
<p>
    <strong>Figure .</strong> Information based on a file number.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="reading-and-writing-data">
                    <span id="anchor-152"></span>Reading and writing data
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Files opened for Random and Binary data use the statements Put and Get for writing and reading data. Files opened in
    any other mode use the Line Input, Input, Print, and Write statements for reading and writing. If no expressions are
    entered, a blank line is written to the file. The Write statement accepts multiple arguments to print to the file
    and it automatically adds delimiters as it writes. In the created file, each expression is separated by a comma.
    Strings are enclosed in double quotation marks, numbers are not enclosed in anything, and dates and Boolean values
    are enclosed between octothorpe (#) characters.
</p>
<p>
    Write #n, expression1, expression2, expression3, ...
</p>
<p>
    Print #n, expression1, expression2, expression3, ...
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The character “#” has many names, including number sign, pound sign, hash, sharp, crunch, hex, grid,
                pigpen, tic-tac-toe, splat, crosshatch, and octothorpe, to name a few.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The Print statement does not write any useful delimiters. Instead, it writes spaces between each expression. Numbers
    typically use 13 spaces.
</p>
<p>
    Write #n, i, "the time # is", Now, CDbl(1.221), CBool(0)
</p>
<p>
    Print #n, i, "the time # is", Now, CDbl(1.221), Cbool(0)
</p>
<p>
    The code above produces the text below.
</p>
<p>
    0,"the time # is",#07/01/2010 21:05:49#,1.221,#False#
</p>
<p>
    0 the time # is 07/01/2010 21:05:49 1.221 False
</p>
<p>
    demonstrates the difference between Write and Print.
</p>
<p>
    <strong>Listing .</strong> Demonstrate Write versus Print.
</p>
<p>
    Sub ExampleWriteOrPrint
</p>
<p>
    Dim FileName As String 'Holds the file name
</p>
<p>
    Dim n As Integer 'Holds the file number
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
    Dim s As String 'Temporary string for input
</p>
<p>
    Dim sTemp$
</p>
<p>
    FileName = ConvertToURL(CurDir) &amp; "/delme.txt"
</p>
<p>
    n = FreeFile() 'Next free file number
</p>
<p>
    Open FileName For Output Access Read Write As #n 'Open for read/write
</p>
<p>
    Write #n, i, "the time # is", Now, CDbl(1.221), CBool(0)
</p>
<p>
    Print #n, i, "the time # is", Now, CDbl(1.221), CBool(0)
</p>
<p>
</p>
<p>
    Seek #n, 1 'Move the file pointer to location 1
</p>
<p>
    Line Input #n, s
</p>
<p>
    Line Input #n, sTemp
</p>
<p>
    s = s &amp; CHR$(10) &amp; sTemp
</p>
<p>
    MsgBox s
</p>
<p>
    Close #n
</p>
<p>
    Kill(FileName) 'Delete this file, I do not want it
</p>
<p>
    End Sub
</p>
<p>
    As its name implies, the Line Input statement reads an entire line of text (see ), but it does not return the
    delimiter. Each line is delimited by either a carriage return (ASCII value 13) or a line-feed character (ASCII value
    10). These two delimiters work to read lines on every operating system supported by OpenOffice.org.
</p>
<p>
    Line Input #n, stringVar 'Read an entire line but not the delimiter.
</p>
<p>
    The Input statement reads text based on the following delimiters: comma, carriage return, or line-feed characters.
    The Input statement can read multiple variables of differing types in a single command. Changing Line Input to Input
    in causes only the first two items to be read rather than two lines.
</p>
<p>
    Input #n, var1, var2, var3, ...
</p>
<p>
    The Write command adds appropriate delimiters automatically so that you can read string and numeric data into the
    appropriate variable types. The Input command automatically removes commas and double quotation marks from the input
    when these characters are used as the delimiters. See and for input examples.
</p>
<p>
    <strong>Listing .</strong> Use Input to read text written with Write.
</p>
<p>
    Sub ExampleInput
</p>
<p>
    Dim sFileName As String
</p>
<p>
    Dim n As Integer
</p>
<p>
    Dim t As String, d As Double, s As String
</p>
<p>
    sFileName = ConvertToURL(CurDir) &amp; "/delme.txt"
</p>
<p>
    n = FreeFile()
</p>
<p>
    Open sFileName For Output Access Read Write As #n
</p>
<p>
    Write #n, 1.33, Now, "I am a string"
</p>
<p>
    Seek(n, 1)
</p>
<p>
    Input #n, d, t, s
</p>
<p>
    close #n
</p>
<p>
    Kill(sFileName)
</p>
<p>
    s = "string (" &amp; s &amp; ")" &amp; CHR$(10) &amp;_
</p>
<p>
    "number (" &amp; d &amp; ")" &amp; CHR$(10) &amp;_
</p>
<p>
    "time (" &amp; t &amp; ") &lt;== read as a string" &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Example Input"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000017400000074A0E57CBC.png" style="width:3.8752in;height:1.2083in" />
</p>
<p>
    <strong>Figure .</strong> Input cannot read time delimited with “#”.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                A friend in Germany had different results, because the number 1.33 is written as 1,33. While reading the
                values, the comma is seen as a delimiter rather than as part of the number.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Unfortunately, the delimiters produced by the Write statement are not supported by the Input statement. Numbers and
    simple strings read with no problems. Date and Boolean values delimited with the # character, however, fail. These
    values must be read into string variables and then parsed.
</p>
<p>
    Do not use the Input statement if you do not have a lot of control over the input text file. Double-quotation marks
    and commas in text strings are assumed to be text delimiters. The end result is that the text is not properly parsed
    when it is read. If your input data may contain these characters, use the Line Input command and then manually parse
    the text. If you must read the carriage return or line-feed characters, the file should be read as a binary file.
</p>
<p>
    A binary file is a random file with a block length of zero. Use the Put statement to write random and binary files.
    The simplest case involves putting a simple variable directly to the file.
</p>
<p>
    int_var = 4 : long_var = 2
</p>
<p>
    Put #n,,int_var '04 00 (two bytes written)
</p>
<p>
    Put #n,,long_var '02 00 00 00 (four bytes written)
</p>
<p>
    The first argument is the file number and the third argument is the variable or data to write. The second argument
    is the position in the file where the date should be written. If you omit the position, as shown in the example, you
    must still include the comma.
</p>
<p>
    Put #n,,variable 'Write to the next record or byte position
</p>
<p>
    Put #n, position, variable 'Specify the next record or byte position
</p>
<p>
    Random files assume that the position identifies a record number. Binary files assume that the position identifies
    an absolute byte position. If the position is not specified, the data is written at the current file pointer, which
    is advanced with the data that is written.
</p>
<p>
    If the data variable is a Variant, an integer identifying the data type precedes the data. This integer is the same
    integer returned by the VarType function, to be detailed later.
</p>
<p>
    v = 4 'A Variant variable
</p>
<p>
    Put #n,,v '02 00 04 00 (first two bytes says type is 2)
</p>
<p>
    Put #n,,4 '02 00 04 00 (first two bytes says type is 2)
</p>
<p>
    Put #n,,CInt(4) '02 00 04 00 (first two bytes says type is 2)
</p>
<p>
    A string stored as a Variant includes the VarType if it is “Put” to a file that was opened as any type other than
    Binary. When an array is Put to a file, each element of the array is written. If the array contains a String
    Variant, it includes the VarType even if the file type is Binary. When Put places a string as a Variant, it actually
    writes the VarType, the string length, and then the string.
</p>
<p>
    v() = Array("ABCD") 'ASCII in hexadecimal is 41 42 43 44
</p>
<p>
    Put #n,,v() '08 00 04 00 41 42 43 44 (08 00 = type)(04 00 = length)
</p>
<p>
    When data is Put to a file, the current file pointer is saved and then all of the data is written. If a non-zero
    block length is used, the file pointer is positioned one block length past the saved file position regardless of how
    much data was written. For example, if the block length is 32 and the current file position is 64, the file pointer
    is positioned to byte 96 after the data is written. If more than 32 bytes are written, part of the next record is
    overwritten. If fewer than 32 bytes are written, then the previous data is left unchanged. Because of this, some
    people initialize every record that will be written when the file is created. Numeric values are usually initialized
    to zero, and string values are usually initialized to spaces.
</p>
<p>
    On the other hand, even though I don’t recommend it, you can use the Put statement with a file opened in a
    sequential mode. Likewise, you can use the Write, Line Input, and Input statements for files opened in Binary or
    Random mode. The actual bytes written for writing methods used for files of the “wrong” file structure are not
    documented, and I had difficulty understanding the output. I finally read the source code to determine what is
    written in each case, but undocumented behavior determined in this way should not be assumed to be stable, reliable
    behavior for OOo Basic. If you want to use these methods for other file structures than those documented, I
    recommend that you test the output for your specific data. When a piece of data is written to a file, the specific
    context is used to determine what to write. See .
</p>
<p>
    <strong>Table .</strong> Summary of what the Put statement writes.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Boolean
            </td>
            <td>
                1
            </td>
            <td>
                OOo Basic stores a Boolean in an integer. The True value has all of the bits set, which incorrectly cast
                down to one byte, causing a run-time error. False writes with no problem.
            </td>
        </tr>
        <tr class="even">
            <td>
                Byte
            </td>
            <td>
                3
            </td>
            <td>
                Although the byte variable uses only one byte when writing the data, byte variables are supported only
                when stored in a Variant, so the data is preceded by two bytes of type information.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Currency
            </td>
            <td>
                8
            </td>
            <td>
                Internally stored as a Double.
            </td>
        </tr>
        <tr class="even">
            <td>
                Date
            </td>
            <td>
                8
            </td>
            <td>
                Internally stored as a Double.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Double
            </td>
            <td>
                8
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                Integer
            </td>
            <td>
                2
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                Long
            </td>
            <td>
                4
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                Object
            </td>
            <td>
                Error
            </td>
            <td>
                Run-time error: Only the basic types are supported.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Single
            </td>
            <td>
                4
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                String
            </td>
            <td>
                Len(s)
            </td>
            <td>
                Each character is one byte. Characters with an ASCII value larger than 255 are written with incomplete
                data. In Binary mode, the Put statement will not write characters with an ASCII value of zero. This is
                written fine in Random mode and the string is preceded by the string length.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Variant
            </td>
            <td>
                Varies
            </td>
            <td>
                Two bytes of type information are written, followed by the data. A string also includes the length of
                the string in two bytes.
            </td>
        </tr>
        <tr class="even">
            <td>
                Empty
            </td>
            <td>
                4
            </td>
            <td>
                An empty Variant variable writes two bytes of type information indicating an integer value, and then it
                writes two bytes with zeros.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Null
            </td>
            <td>
                Error
            </td>
            <td>
                Only an object can contain the value Null, and the Put statement does not work with objects.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                OOo Basic only supports using Get and Put with the standard data types.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Numbers written to binary files are written in reverse byte order.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The Put statement cannot write a Boolean with a True value, and it doesn’t properly write strings with
                Unicode values greater than 255; writing then trying to read the value causes OOo to crash.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The Get statement fails for binary files if the position is not provided.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use Get to read Binary data and Random files. The syntax for the Get statement is similar to the Put statement.
</p>
<p>
    Get #n,,variable 'Read from next record or byte position
</p>
<p>
    Get #n, position, variable 'Specify the next record or byte position
</p>
<p>
    If the argument to the Get statement is a Variant, the type information is always read, regardless of the context.
    When a string is read, it is assumed to be preceded by an integer that contains the length of the string. This
    required string length is not written automatically to binary files but it is to random files. shows an example of
    reading and writing a binary file. Also see .
</p>
<p>
    <strong>Listing .</strong> Create and then read a binary file.
</p>
<p>
    Sub ExampleReadWriteBinaryFile
</p>
<p>
    Dim sFileName As String 'File name from which to read and write
</p>
<p>
    Dim n As Integer 'File number to use
</p>
<p>
    Dim i As Integer 'Scrap Integer variable
</p>
<p>
    Dim l As Long 'Scrap Long variable
</p>
<p>
    Dim s As String 'Scrap String variable
</p>
<p>
    Dim s2 As String 'Another scrap String variable
</p>
<p>
    Dim v 'Scrap Variant variable
</p>
<p>
    sFileName = ConvertToURL(CurDir) &amp; "/delme.txt"
</p>
<p>
    If FileExists (sFileName) Then
</p>
<p>
    Kill(sFileName)
</p>
<p>
    End If
</p>
<p>
    n = FreeFile()
</p>
<p>
    Open sFileName For Binary As #n
</p>
<p>
    i = 10 : Put #n,,i '0A 00
</p>
<p>
    i = 255 : Put #n,,i 'FF 00
</p>
<p>
    i = -2 : Put #n,,i 'FE FF
</p>
<p>
    l = 10 : Put #n,,l '0A 00 00 00
</p>
<p>
    l = 255 : Put #n,,l 'FF 00 00 00
</p>
<p>
    l = -2 : Put #n,,l 'FE FF FF FF
</p>
<p>
</p>
<p>
    REM Put string data, precede it with a length
</p>
<p>
    i = 8 : Put #n,,i '08 00 (about to put eight characters to the file)
</p>
<p>
    s = "ABCD"
</p>
<p>
    Put #n,,s '41 42 43 44 (ASCII for ABCD)
</p>
<p>
    Put #n,,s '41 42 43 44 (ASCII for ABCD)
</p>
<p>
</p>
<p>
    REM Put data contained in a Variant
</p>
<p>
    Put #n,,CInt(10) '02 00 0A 00
</p>
<p>
    i = -2 : Put #n,,CInt(i) '02 00 FE FF (Functions return a Variant)
</p>
<p>
    Put #n,,CLng(255) '03 00 FF 00 00 00 (Functions return a Variant)
</p>
<p>
    v = 255 : Put #n,,v '02 00 FF 00 (This IS a Variant)
</p>
<p>
    v = "ABCD" : Put #n,,v '41 42 43 44 (Not in an array)
</p>
<p>
    v = Array(255, "ABCDE") 'The string contains type information and length
</p>
<p>
    Put #n,,v() '02 00 FF 00 08 00 05 00 41 42 43 44 45
</p>
<p>
    close #n
</p>
<p>
</p>
<p>
    REM now, read the file.
</p>
<p>
    s = ""
</p>
<p>
    n = FreeFile()
</p>
<p>
    Open sFileName For Binary Access Read As #n
</p>
<p>
    Get #n, 1, i : s = s &amp; "Read Integer " &amp; i &amp; CHR$(10)
</p>
<p>
    Get #n, 3, i : s = s &amp; "Read Integer " &amp; i &amp; CHR$(10)
</p>
<p>
    Get #n, 5, i : s = s &amp; "Read Integer " &amp; i &amp; CHR$(10)
</p>
<p>
    Get #n, 7, l : s = s &amp; "Read Long " &amp; l &amp; CHR$(10)
</p>
<p>
    Get #n, 11, l : s = s &amp; "Read Long " &amp; l &amp; CHR$(10)
</p>
<p>
    Get #n, 15, l : s = s &amp; "Read Long " &amp; l &amp; CHR$(10)
</p>
<p>
    Get #n, 19, s2 : s = s &amp; "Read String " &amp; s2 &amp; CHR$(10)
</p>
<p>
    close #n
</p>
<p>
    MsgBox s, 0, "Read Write Binary File"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000DF000000B02245E1ED.png" style="width:2.3228in;height:1.8335in" />
</p>
<p>
    <strong>Figure .</strong> Use Get and Put to read and write binary files.
</p>
<p>
    Random files are usually used to store a user-defined data type, but this is not supported in OOo Basic; use “Open
    FileName For Random” to open a file for random access. The code in writes numerous types and sizes of data to the
    file with a block length of 8. If the Put statement had no bugs, then after writing the first block, the file
    pointer would be positioned to the second block for writing. It is instead positioned to the end of the file. To
    avoid this bug, explicitly include the position to write in the statement. If the position points to a position
    beyond the end of the file, the file pointer is moved to the end of the file. This is the primary reason why the
    code in initializes the file to all zeros before starting; the file is initialized with locations for the subsequent
    operations. Notice that the string includes the string length before the text when it is Put to the file. The output
    is essentially the same as shown in .
</p>
<p>
    <strong>Listing .</strong> Write and then read a random access file.
</p>
<p>
    Sub ExampleReadWriteRandomFile
</p>
<p>
    Dim sFileName As String 'File name from which to read and write
</p>
<p>
    Dim n As Integer 'File number to use
</p>
<p>
    Dim i As Integer 'Scrap Integer variable
</p>
<p>
    Dim l As Long 'Scrap Long variable
</p>
<p>
    Dim s As String 'Scrap String variable
</p>
<p>
    Dim s2 As String 'Another scrap String variable
</p>
<p>
    sFileName = ConvertToURL(CurDir) &amp; "/delme.txt"
</p>
<p>
</p>
<p>
    REM Now the file is initialized so it can be used!
</p>
<p>
    REM Must use Access Read so that the file is not created new
</p>
<p>
    REM I cannot write this as a binary file because then ASCII
</p>
<p>
    REM zeros are not written.
</p>
<p>
    n = FreeFile()
</p>
<p>
    Open sFileName For Random As #n Len = 8
</p>
<p>
    REM First, create a file with all zeros with enough room
</p>
<p>
    REM for 20 8-byte records.
</p>
<p>
    s = String(8 * 20-2, 0) 'String has 158 characters with ASCII value 0
</p>
<p>
    Put #n,1,s 'Written as Random so Len(s) is written first
</p>
<p>
    i = 0 : Put #n,1,i 'Write over the length with zeros.
</p>
<p>
</p>
<p>
    REM Now write the data
</p>
<p>
    i = 10 : Put #n,1,i '0A 00
</p>
<p>
    i = 255 : Put #n,2,i 'FF 00
</p>
<p>
    i = -2 : Put #n,3,i 'FE FF
</p>
<p>
    l = 10 : Put #n,4,l '0A 00 00 00
</p>
<p>
    l = 255 : Put #n,5,l 'FF 00 00 00
</p>
<p>
    l = -2 : Put #n,6,l 'FE FF FF FF
</p>
<p>
</p>
<p>
    REM Put string data, precede it with a length (integer value) automatically
</p>
<p>
    s = "ABCD" : Put #n,7,s '04 00 41 42 43 44 (Length, then ASCII for ABCD)
</p>
<p>
    close #n
</p>
<p>
</p>
<p>
    REM Now read the file.
</p>
<p>
    s = ""
</p>
<p>
    n = FreeFile()
</p>
<p>
    Open sFileName For Random Access Read As #n Len=8
</p>
<p>
    Get #n, 1, i : s = s &amp; "Read Integer " &amp; i &amp; CHR$(10)
</p>
<p>
    Get #n, 2, i : s = s &amp; "Read Integer " &amp; i &amp; CHR$(10)
</p>
<p>
    Get #n, 3, i : s = s &amp; "Read Integer " &amp; i &amp; CHR$(10)
</p>
<p>
    Get #n, 4, l : s = s &amp; "Read Long " &amp; l &amp; CHR$(10)
</p>
<p>
    Get #n, 5, l : s = s &amp; "Read Long " &amp; l &amp; CHR$(10)
</p>
<p>
    Get #n, 6, l : s = s &amp; "Read Long " &amp; l &amp; CHR$(10)
</p>
<p>
    Get #n, 7, s2 : s = s &amp; "Read String " &amp; s2 &amp; CHR$(10)
</p>
<p>
    close #n
</p>
<p>
    MsgBox s, 0, "Read Write Random File"
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="file-and-directory-related-services">
                    <span id="anchor-153"></span>File and directory related services
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Some of the OO methods for file manipulation are buggy and unreliable. You may want to consider some of the built-in
    OO services; services are discussed later.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="path-settings">
                            <span id="anchor-154"></span>Path Settings
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Most of the macros in this chapter use the CurDir function to choose a place to store files. The PathSettings
    service provides read/write access (and the ability to register a listener) for the paths properties used by OOo.
    Although the documentation is not clear on this, my examples indicate that the path is returned as a URL. On the
    other hand, the PathSettings service uses the PathSubstitution service, which specifically states that it returns
    URLS. OOMEWorkDir in demonstrates obtaining the Work directory.
</p>
<p>
    <strong>Listing .</strong> Determine the work directory to use.
</p>
<p>
    Function OOMEWorkDir() As String
</p>
<p>
    Dim s$
</p>
<p>
    Dim oPathSettings
</p>
<p>
    oPathSettings = CreateUnoService("com.sun.star.util.PathSettings")
</p>
<p>
    s$ = oPathSettings.Work
</p>
<p>
    If s = "" Then
</p>
<p>
    s = GetPathSeparator()
</p>
<p>
    ElseIf Right(s,1) &lt;&gt; "/" AND Right(s,1) &lt;&gt; "\\" Then
</p>
<p>
    If Left(s, 5) = "file:" Then
</p>
<p>
    s = s &amp; "/"
</p>
<p>
    Else
</p>
<p>
    s = s &amp; GetPathSeparator()
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    OOMEWorkDir() = s &amp; "OOMEWork" &amp; GetPathSeparator()
</p>
<p>
    End Function
</p>
<p>
    A macro that creates temporary files or directories for example purposes will use to create and remove the working
    directory.
</p>
<p>
    <strong>Listing .</strong> Create and remove the OOME work directory.
</p>
<p>
    Function CreateOOMEWorkDir() As Boolean
</p>
<p>
    CreateOOMEWorkDir() = False
</p>
<p>
    Dim s$
</p>
<p>
    s = OOMEWorkDir()
</p>
<p>
    If NOT FileExists(s) Then
</p>
<p>
    MkDir s
</p>
<p>
    End If
</p>
<p>
    CreateOOMEWorkDir() = FileExists(s)
</p>
<p>
    End Function
</p>
<p>
    Function RmOOMEWorkDir() As Boolean
</p>
<p>
    RmOOMEWorkDir() = False
</p>
<p>
    Dim s$
</p>
<p>
    s = OOMEWorkDir()
</p>
<p>
    If FileExists(s) Then
</p>
<p>
    RmDir s
</p>
<p>
    End If
</p>
<p>
    RmOOMEWorkDir() = NOT FileExists(s)
</p>
<p>
    End Function
</p>
<p>
    The documentation lists properties that are supported. By inspecting the object, I found more properties than those
    that are documented.
</p>
<p>
    <strong>Table .</strong> Documented PathSettings properties.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Addin
            </td>
            <td>
                Single
            </td>
            <td>
                Contains spreadsheet add-ins that use the old add-in API.
            </td>
        </tr>
        <tr class="even">
            <td>
                AutoCorrect
            </td>
            <td>
                Multiple
            </td>
            <td>
                Contains the settings for the AutoCorrect dialog.
            </td>
        </tr>
        <tr class="odd">
            <td>
                AutoText
            </td>
            <td>
                Multiple
            </td>
            <td>
                Contains the AutoText modules.
            </td>
        </tr>
        <tr class="even">
            <td>
                Backup
            </td>
            <td>
                Single
            </td>
            <td>
                Where automatic document backups are stored.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Basic
            </td>
            <td>
                Multiple
            </td>
            <td>
                Contains Basic files used by the AutoPilots.
            </td>
        </tr>
        <tr class="even">
            <td>
                Bitmap
            </td>
            <td>
                Single
            </td>
            <td>
                Contains the external icons for the toolbars.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Config
            </td>
            <td>
                Single
            </td>
            <td>
                Contains configuration files. This property is not visible in the path options dialog and cannot be
                modified.
            </td>
        </tr>
        <tr class="even">
            <td>
                Dictionary
            </td>
            <td>
                Single
            </td>
            <td>
                Contains the OpenOffice.org dictionaries.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Favorite
            </td>
            <td>
                Single
            </td>
            <td>
                Contains the saved folder bookmarks.
            </td>
        </tr>
        <tr class="even">
            <td>
                Filter
            </td>
            <td>
                Single
            </td>
            <td>
                Where the filters are stored.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Gallery
            </td>
            <td>
                Multiple
            </td>
            <td>
                Contains the Gallery database and multimedia files.
            </td>
        </tr>
        <tr class="even">
            <td>
                Graphic
            </td>
            <td>
                Single
            </td>
            <td>
                Displayed when the dialog for opening a graphic or saving a new graphic is used.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Help
            </td>
            <td>
                Single
            </td>
            <td>
                Contains the OOo help files.
            </td>
        </tr>
        <tr class="even">
            <td>
                Linguistic
            </td>
            <td>
                Single
            </td>
            <td>
                Contains the OOo spellcheck files.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Module
            </td>
            <td>
                Single
            </td>
            <td>
                Contains the OOo modules.
            </td>
        </tr>
        <tr class="even">
            <td>
                Palette
            </td>
            <td>
                Single
            </td>
            <td>
                Contains the palette files that contain user-defined colors and patterns (*.SOB and *.SOF).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Plugin
            </td>
            <td>
                Multiple
            </td>
            <td>
                Contains the Plugins.
            </td>
        </tr>
        <tr class="even">
            <td>
                Storage
            </td>
            <td>
                Single
            </td>
            <td>
                Where information about mail, news, and FTP servers is stored.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Temp
            </td>
            <td>
                Single
            </td>
            <td>
                Contains the OOo temp-files.
            </td>
        </tr>
        <tr class="even">
            <td>
                Template
            </td>
            <td>
                Multiple
            </td>
            <td>
                Contains the OOo document templates.
            </td>
        </tr>
        <tr class="odd">
            <td>
                UIConfig
            </td>
            <td>
                Multiple
            </td>
            <td>
                Global directories for user interface configuration files. The user interface configuration is merged
                with the user settings stored in the directory specified by UserConfig.
            </td>
        </tr>
        <tr class="even">
            <td>
                UserConfig
            </td>
            <td>
                Single
            </td>
            <td>
                Contains the user settings, including the user interface configuration files for menus, toolbars,
                accelerators and status bars.
            </td>
        </tr>
        <tr class="odd">
            <td>
                UserDictionary
            </td>
            <td>
                Single
            </td>
            <td>
                Contains the custom dictionaries.
            </td>
        </tr>
        <tr class="even">
            <td>
                Work
            </td>
            <td>
                Single
            </td>
            <td>
                The work folder. This path can be modified according to the user's needs and can be seen in the Open or
                Save dialog.
            </td>
        </tr>
    </tbody>
</table>
<p>
    To see the path settings on your computer, run the macro in . On my computer, I find numerous extra paths such as
    Work_internal, Work_user, Work_writable. DisplayPathSettings demonstrates numerous advanced techniques that are not
    explained in this chapter.
</p>
<ul>
    <li>
        Creating and using an OOo service.
    </li>
    <li>
        Creating a new document.
    </li>
    <li>
        Inserting text into a document.
    </li>
    <li>
        Setting paragraph style.
    </li>
    <li>
        Inserting paragraph breaks into a text object.
    </li>
</ul>
<p>
    The following macro was originally written by Danny Brewer, who did much to advance the knowledge of OOo macros
    before he went on to other things. I modified the macro so that it declares all variables and handles property types
    returned as array values.
</p>
<p>
    <strong>Listing .</strong> Display the PathSettings in a new text document.
</p>
<p>
    Sub DisplayPathSettings
</p>
<p>
    Dim oPathSettings ' PathSettings service.
</p>
<p>
    Dim oPropertySetInfo ' Access the service properties.
</p>
<p>
    Dim aProperties ' Contains all of the service properties.
</p>
<p>
    Dim oDoc ' Reference a newly created document.
</p>
<p>
    Dim oText ' Document's text object.
</p>
<p>
    Dim oCursor ' Cursor in the text object.
</p>
<p>
    Dim oProperty ' A property of the service.
</p>
<p>
    Dim cPropertyName$ ' Property name.
</p>
<p>
    Dim cPropertyValue ' Property value may be an array or multiple strings.
</p>
<p>
    Dim aPaths ' The paths as an array.
</p>
<p>
    Dim cPath$ ' A single path from the array.
</p>
<p>
    Dim j As Integer ' Index variable.
</p>
<p>
    Dim i As Integer ' Index variable.
</p>
<p>
</p>
<p>
    oPathSettings = CreateUnoService( "com.sun.star.util.PathSettings")
</p>
<p>
    ' Example of how to get a single property you are after.
</p>
<p>
    'oPathSettings.Work
</p>
<p>
    ' Get information about the properties of the path settings.
</p>
<p>
    oPropertySetInfo = oPathSettings.getPropertySetInfo()
</p>
<p>
</p>
<p>
    ' Get an array of the properties.
</p>
<p>
    aProperties = oPropertySetInfo.getProperties()
</p>
<p>
</p>
<p>
    ' Create an output document.
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL( "private:factory/swriter", _
</p>
<p>
    "_blank", 0, Array() )
</p>
<p>
    oText = oDoc.getText()
</p>
<p>
    oCursor = oText.createTextCursor()
</p>
<p>
</p>
<p>
    oText.insertString( oCursor, "Path Settings", False )
</p>
<p>
    oCursor.ParaStyleName = "Heading 1"
</p>
<p>
    oText.insertControlCharacter( oCursor, _
</p>
<p>
    com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK, False )
</p>
<p>
    ' Iterate over the array of properties,
</p>
<p>
    ' and write information about each property to the output.
</p>
<p>
    For i = LBound( aProperties ) To UBound( aProperties )
</p>
<p>
    oProperty = aProperties( i )
</p>
<p>
    cPropertyName = oProperty.Name
</p>
<p>
    cPropertyValue = oPathSettings.getPropertyValue( cPropertyName )
</p>
<p>
</p>
<p>
    oText.insertString( oCursor, cPropertyName, False )
</p>
<p>
    oCursor.ParaStyleName = "Heading 3"
</p>
<p>
    oText.insertControlCharacter( oCursor, _
</p>
<p>
    com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK, False )
</p>
<p>
    If IsArray(cPropertyValue) Then
</p>
<p>
    ' Multiple URLs are somtimes returned as an array.
</p>
<p>
    aPaths = cPropertyValue
</p>
<p>
    ElseIf Len( cPropertyValue ) &gt; 0 Then
</p>
<p>
    ' Multiple URLs are somtimes separated by a semicolon.
</p>
<p>
    ' Split them up into an array of strings.
</p>
<p>
    aPaths = Split( cPropertyValue, ";" )
</p>
<p>
    Else
</p>
<p>
    aPaths = Array()
</p>
<p>
    End If
</p>
<p>
    For j = LBound( aPaths ) To UBound( aPaths )
</p>
<p>
    cPath = aPaths( j )
</p>
<p>
    oText.insertString( oCursor, cPath, False )
</p>
<p>
    oText.insertControlCharacter( oCursor, _
</p>
<p>
    com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK, False )
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    oText.insertControlCharacter( oCursor, _
</p>
<p>
    com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK, False )
</p>
<p>
    Next i
</p>
<p>
    End Sub
</p>
<p>
    Setting a path value is trivially done using either direct assignment, or by using the property set information
    object. OOo requires these values to be correct, so, if you write bad values, it will negatively affect OOo.
</p>
<p>
    oPathSettings.Work = ConvertToUrl("C:\MyWorkDir")
</p>
<p>
    oPathSettings.setPropertyValue("Work", "C:\MyWorkDir")
</p>
<p>
    The properties supported by the PathSetting service are stored, at least on my computer, in the file:
    openoffice.org/basis3.2/share/registry/schema/org/openoffice/Office/Common.xcs. The documentation still references
    the old filename Common.xml, which caused me some level of consternation.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="path-substitution">
                            <span id="anchor-155"></span>Path Substitution
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    My file Common.xcs contains entries such as $(userpath)/store and $(work), which are very different from what is
    returned by the PathSettings service. This is because the path setting service changes shortcuts such as $(userpath)
    to the real value before returning a string. Analogously, it substitutes the shortcuts back into the string before
    storing the value. You can call the PathSubstitution service directly to make your own substitutions.
</p>
<p>
    <strong>Table .</strong> Path substitution variables.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                $(inst)
            </td>
            <td>
                Installation path of the OOo Basis layer.
            </td>
        </tr>
        <tr class="even">
            <td>
                $(prog)
            </td>
            <td>
                Program path of the OOo Basis layer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                $(brandbaseurl)
            </td>
            <td>
                Installation path of the the OOo Brand layer.
            </td>
        </tr>
        <tr class="even">
            <td>
                $(user)
            </td>
            <td>
                The user installation directory.
            </td>
        </tr>
        <tr class="odd">
            <td>
                $(work)
            </td>
            <td>
                The work directory of the user;"MyDocuments" for Windows, the user's home-directory for Linux.
            </td>
        </tr>
        <tr class="even">
            <td>
                $(home)
            </td>
            <td>
                The user's home directory; Documents and Settings for Windows, the user's home-directory for Linux.
            </td>
        </tr>
        <tr class="odd">
            <td>
                $(temp)
            </td>
            <td>
                The current temporary directory.
            </td>
        </tr>
        <tr class="even">
            <td>
                $(path)
            </td>
            <td>
                The value of PATH environment variable.
            </td>
        </tr>
        <tr class="odd">
            <td>
                $(lang)
            </td>
            <td>
                The country code used by OOo; 01=english.
            </td>
        </tr>
        <tr class="even">
            <td>
                $(langid)
            </td>
            <td>
                The language code used by OOo; 1033=english us.
            </td>
        </tr>
        <tr class="odd">
            <td>
                $(vlang)
            </td>
            <td>
                The language used by OOo as a string. Like "en-US" for a US English OOo.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use getSubstituteVariableValue to convert one name at a time. If the name is not known, a run-time error occurs.
</p>
<p>
    <strong>Listing .</strong> Substitute one variable with PathSubstitution.
</p>
<p>
    Sub UsePathSubstitution()
</p>
<p>
    Dim oPathSub ' PathSubstitution service.
</p>
<p>
    Dim names ' List of names to substitute.
</p>
<p>
    Dim subName$ ' Single name to check.
</p>
<p>
    Dim i As Integer ' Index variable.
</p>
<p>
    Dim s$ ' Accumulate the value to print.
</p>
<p>
</p>
<p>
    names = Array("inst", "prog", "brandbaseurl", "user", _
</p>
<p>
    "work", "home", "temp", "path", _
</p>
<p>
    "lang", "langid", "vlang")
</p>
<p>
</p>
<p>
    oPathSub = CreateUnoService( "com.sun.star.util.PathSubstitution")
</p>
<p>
</p>
<p>
    ' Use getSubstituteVariableValue with a single variable.
</p>
<p>
    ' Runtime error if the name is not know.
</p>
<p>
</p>
<p>
    'Print oPathSub.getSubstituteVariableValue("$(inst)")
</p>
<p>
    For i = LBound(names) To UBound(names)
</p>
<p>
    subName = "$(" &amp; names(i) &amp; ")"
</p>
<p>
    s = s &amp; names(i) &amp; " = "
</p>
<p>
    s = s &amp; oPathSub.getSubstituteVariableValue(subName) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Supported Names"
</p>
<p>
    End Sub
</p>
<p>
    Use substituteVariables to substitute multiple values at the same time. Use reSubstituteVariables to place the
    variable names back into a regular string.
</p>
<p>
    <strong>Listing .</strong> ReSubstitute variables.
</p>
<p>
    Sub UsePathReSubstitution()
</p>
<p>
    Dim oPathSub ' PathSubstitution service.
</p>
<p>
    Dim s$ ' Accumulate the value to print.
</p>
<p>
    Dim sTemp$
</p>
<p>
</p>
<p>
    oPathSub = CreateUnoService( "com.sun.star.util.PathSubstitution")
</p>
<p>
    ' There are two variables to substitute.
</p>
<p>
    ' False means do not generate an error
</p>
<p>
    ' if an unknown variable is used.
</p>
<p>
    s = "$(temp)/OOME/ or $(work)"
</p>
<p>
    sTemp = oPathSub.substituteVariables(s, False)
</p>
<p>
    s = s &amp; " = " &amp; sTemp &amp; CHR$(10)
</p>
<p>
</p>
<p>
    ' This direction encodes the entire thing as though it were a single
</p>
<p>
    ' path. This means that spaces are encoded in URL notation.
</p>
<p>
    s = s &amp; sTemp &amp; " = " &amp; oPathSub.reSubstituteVariables(sTemp) &amp; CHR$(10)
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001BF000000832DEFF470.png" style="width:4.6563in;height:1.3646in" />
</p>
<p>
    <strong>Figure .</strong> PathSubstitution service.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="simple-file-access">
                            <span id="anchor-156"></span>Simple File Access
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo uses the SimpleFileAccess service, rather than the file methods used by Basic, for file operations. The methods
    supported by the SimpleFileAccess service are shown in the following table.
</p>
<p>
    <strong>Table .</strong> Methods supported by SimpleFileAccess.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                copy(fromURL, toURL)
            </td>
            <td>
                Copy a file.
            </td>
        </tr>
        <tr class="even">
            <td>
                move(fromURL, toURL)
            </td>
            <td>
                Move a file.
            </td>
        </tr>
        <tr class="odd">
            <td>
                kill(url)
            </td>
            <td>
                Delete a file or directory, even if the folder is not empty.
            </td>
        </tr>
        <tr class="even">
            <td>
                isFolder(url)
            </td>
            <td>
                Return true if the URL represents a folder.
            </td>
        </tr>
        <tr class="odd">
            <td>
                isReadOnly(url)
            </td>
            <td>
                Return true if the file is read-only.
            </td>
        </tr>
        <tr class="even">
            <td>
                setReadOnly(url, bool)
            </td>
            <td>
                Set file as read-only if the boolean argument is true, otherwise, clear the read-only flag.
            </td>
        </tr>
        <tr class="odd">
            <td>
                createFolder(url)
            </td>
            <td>
                Creates a new Folder.
            </td>
        </tr>
        <tr class="even">
            <td>
                getSize(url)
            </td>
            <td>
                Returns the size of a file as a long integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getContentType(url)
            </td>
            <td>
                Return the content type of a file as a string. On my computer, an odt file has type
                application/vnd.sun.staroffice.fsys-file.
            </td>
        </tr>
        <tr class="even">
            <td>
                getDateTimeModified(url)
            </td>
            <td>
                Return the last modified date for the file as a com.sun.star.util.DateTime structure, which supports the
                properties: HundredthSeconds, Seconds, Minutes, Hours, Day, Month, and Year.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getFolderContents(url, bool)
            </td>
            <td>
                Returns the contents of a folder as an array of strings. Each string is the full path as a URL. If the
                bool is True, then files and directories are listed. If the bool is False, then only files are returned.
            </td>
        </tr>
        <tr class="even">
            <td>
                exists(url)
            </td>
            <td>
                Return true if a file or directory exists.
            </td>
        </tr>
        <tr class="odd">
            <td>
                openFileRead(url)
            </td>
            <td>
                Open file to read, return an input stream.
            </td>
        </tr>
        <tr class="even">
            <td>
                openFileWrite(url)
            </td>
            <td>
                Open file to write, return an output stream.
            </td>
        </tr>
        <tr class="odd">
            <td>
                openFileReadWrite(url)
            </td>
            <td>
                Open file to read and write, return a stream.
            </td>
        </tr>
        <tr class="even">
            <td>
                setInteractionHandler(handler)
            </td>
            <td>
                Set an interaction handler to be used for further operations. This is a more advanced topic and I will
                not discuss this here.
            </td>
        </tr>
        <tr class="odd">
            <td>
                writeFile(toUrl, inputStream)
            </td>
            <td>
                Overwrite the file content with the given data.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="streams">
                            <span id="anchor-157"></span>Streams
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A stream supports reading and writing data from some input source to some output source that may go beyond a file
    system. As an example, I use streams to transfer entire files between the regular file system and a field in a
    database. In other words, streams are powerful and worth knowing and understanding. This section does not cover all
    of the stream capabilities and does not even touch on Markable streams and Object streams. Streams support all sorts
    of fancy things such as listeners that are automatically called when specific events occur. A motivated reader will
    read the streams document:
</p>
<ul>
    <li>
        <a
            href="http://www.openoffice.org/udk/common/man/concept/streams.html">http://www.openoffice.org/udk/common/man/concept/streams.html</a>
    </li>
    <li>
        <a
            href="http://www.openoffice.org/api/docs/common/ref/com/sun/star/io/module-ix.html">http://www.openoffice.org/api/docs/common/ref/com/sun/star/io/module-ix.html</a>
    </li>
    <li>
        <a
            href="http://api.libreoffice.org/docs/common/ref/com/sun/star/io/module-ix.html">http://api.libreoffice.org/docs/common/ref/com/sun/star/io/module-ix.html</a>
    </li>
</ul>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The readLine() method does not remove the end of line character if the end of file is reached.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table .</strong> Stream methods.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                available()
            </td>
            <td>
                InputStream
            </td>
            <td>
                Returns the number of available bytes as a long.
            </td>
        </tr>
        <tr class="even">
            <td>
                closeInput()
            </td>
            <td>
                InputStream
            </td>
            <td>
                Close the input stream.
            </td>
        </tr>
        <tr class="odd">
            <td>
                closeOutput()
            </td>
            <td>
                OutputStream
            </td>
            <td>
                Close the stream.
            </td>
        </tr>
        <tr class="even">
            <td>
                flush()
            </td>
            <td>
                OutputStream
            </td>
            <td>
                Flush buffers.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getLength()
            </td>
            <td>
                XSeekable
            </td>
            <td>
                Get length of the stream.
            </td>
        </tr>
        <tr class="even">
            <td>
                getPosition()
            </td>
            <td>
                XSeekable
            </td>
            <td>
                Return the stream offset as a 64-bit integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                isEOF()
            </td>
            <td>
                TextInputStream
            </td>
            <td>
                Returns true if the end of file has been reached.
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    readBoolean()
                </p>
            </td>
            <td>
                DataInputStream
            </td>
            <td>
                Read an 8 bit value and return a byte. 0 means FALSE; all other values mean TRUE.
            </td>
        </tr>
        <tr class="odd">
            <td>
                readByte()
            </td>
            <td>
                DataInputStream
            </td>
            <td>
                Read and return an 8 bit value and return a byte.
            </td>
        </tr>
        <tr class="even">
            <td>
                readBytes(byteArray, long)
            </td>
            <td>
                InputStream
            </td>
            <td>
                Read the specified number of bytes and return the number of bytes read. If the number of bytes requested
                was not read, then the end of file has been reached.
            </td>
        </tr>
        <tr class="odd">
            <td>
                readChar()
            </td>
            <td>
                DataInputStream
            </td>
            <td>
                Read and return a 16-bit Unicode character.
            </td>
        </tr>
        <tr class="even">
            <td>
                readDouble()
            </td>
            <td>
                DataInputStream
            </td>
            <td>
                Read and return a 64-bit IEEE double.
            </td>
        </tr>
        <tr class="odd">
            <td>
                readFloat()
            </td>
            <td>
                DataInputStream
            </td>
            <td>
                Read and return a 32-bit IEEE float.
            </td>
        </tr>
        <tr class="even">
            <td>
                readHyper()
            </td>
            <td>
                DataInputStream
            </td>
            <td>
                Read and return a 64-bit big endian integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                readLine()
            </td>
            <td>
                TextInputStream
            </td>
            <td>
                Read text until a line break (CR, LF, or CR/LF) or EOF is found and returns it as string (without CR,
                LF).
            </td>
        </tr>
        <tr class="even">
            <td>
                readLong()
            </td>
            <td>
                DataInputStream
            </td>
            <td>
                Read and return a 32-bit big endian integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                readShort()
            </td>
            <td>
                DataInputStream
            </td>
            <td>
                Read and return a 16-bit big endian integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                readSomeBytes(byteArray, long)
            </td>
            <td>
                InputStream
            </td>
            <td>
                Read up to the specified number of bytes and return the number of bytes read. If the number of bytes
                read is zero, then the end of file has been reached.
            </td>
        </tr>
        <tr class="odd">
            <td>
                readString(charArray, boolean)
            </td>
            <td>
                TextInputStream
            </td>
            <td>
                Read text until one of the given delimiter characters or EOF is found and returns it as string. The
                boolean argument determines if the delimiter is returned (false) or removed (true).
            </td>
        </tr>
        <tr class="even">
            <td>
                readUTF()
            </td>
            <td>
                DataInputStream
            </td>
            <td>
                Read and return a string of UTF encoded characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                seek ( INT64 )
            </td>
            <td>
                XSeekable
            </td>
            <td>
                Change the stream pointer to the specified location.
            </td>
        </tr>
        <tr class="even">
            <td>
                setEncoding(string)
            </td>
            <td>
                TextInputStream
            </td>
            <td>
                Set the character encoding (see <a
                    href="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets</a>).
            </td>
        </tr>
        <tr class="odd">
            <td>
                skipBytes(long)
            </td>
            <td>
                InputStream
            </td>
            <td>
                Skips the specified number of bytes.
            </td>
        </tr>
        <tr class="even">
            <td>
                truncate()
            </td>
            <td>
                XTruncate
            </td>
            <td>
                Set the size of the file to zero.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    writeBoolean(boolean)
                </p>
            </td>
            <td>
                DataOutputStream
            </td>
            <td>
                Write a boolean as an 8 bit value. 0 means FALSE; all other values mean TRUE.
            </td>
        </tr>
        <tr class="even">
            <td>
                writeByte(byte)
            </td>
            <td>
                DataOutputStream
            </td>
            <td>
                Write an 8 bit value and return a byte.
            </td>
        </tr>
        <tr class="odd">
            <td>
                writeBytes(byteArray())
            </td>
            <td>
                OutputStream
            </td>
            <td>
                Write all bytes to the stream.
            </td>
        </tr>
        <tr class="even">
            <td>
                writeChar(char)
            </td>
            <td>
                DataOutputStream
            </td>
            <td>
                Write a 16-bit Unicode character.
            </td>
        </tr>
        <tr class="odd">
            <td>
                writeDouble(double)
            </td>
            <td>
                DataOutputStream
            </td>
            <td>
                Write a 64-bit IEEE double.
            </td>
        </tr>
        <tr class="even">
            <td>
                writeFloat(float)
            </td>
            <td>
                DataOutputStream
            </td>
            <td>
                Write a 32-bit IEEE float.
            </td>
        </tr>
        <tr class="odd">
            <td>
                writeHyper(INT64)
            </td>
            <td>
                DataOutputStream
            </td>
            <td>
                Write a 64-bit big endian integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                writeLong(long)
            </td>
            <td>
                DataOutputStream
            </td>
            <td>
                Write a 32-bit big endian integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                writeShort(short)
            </td>
            <td>
                DataOutputStream
            </td>
            <td>
                Write a 16-bit big endian integer.
            </td>
        </tr>
    </tbody>
</table>
<p>
    There are many different types of stream services and interfaces (see). A simple stream returned by SimpleFileAccess
    only supports reading and writing raw bytes and you must convert the data to an array of bytes. It is more common to
    manually create an appropriate stream (such as DataOutputStream or TextInputStream) and use that to wrap the simple
    stream returned by SimpleFileAccess.
</p>
<p>
    <strong>Listing .</strong> Using SimpleFileAccess to read and write text files.
</p>
<p>
    Sub ExampleSimpleFileAccess
</p>
<p>
    Dim oSFA ' SimpleFileAccess service.
</p>
<p>
    Dim sFileName$ ' Name of file to open.
</p>
<p>
    Dim oStream ' Stream returned from SimpleFileAccess.
</p>
<p>
    Dim oTextStream ' TextStream service.
</p>
<p>
    Dim sStrings ' Strings to test write / read.
</p>
<p>
    Dim sInput$ ' The string that is read.
</p>
<p>
    Dim s$ ' Accumulate result to print.
</p>
<p>
    Dim i% ' Index variable.
</p>
<p>
</p>
<p>
    sStrings = Array("One", "UTF:Āā", "1@3")
</p>
<p>
    ' File to use.
</p>
<p>
    sFileName = CurDir() &amp; "/delme.out"
</p>
<p>
    ' Create the SimpleFileAccess service.
</p>
<p>
    oSFA = CreateUnoService("com.sun.star.ucb.SimpleFileAccess")
</p>
<p>
</p>
<p>
    'Create the Specialized stream.
</p>
<p>
    oTextStream = CreateUnoService("com.sun.star.io.TextOutputStream")
</p>
<p>
</p>
<p>
    'If the file already exists, delete it.
</p>
<p>
    If oSFA.exists(sFileName) Then
</p>
<p>
    oSFA.kill(sFileName)
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    ' Open the file for writing.
</p>
<p>
    oStream = oSFA.openFileWrite(sFileName)
</p>
<p>
</p>
<p>
    ' Attach the simple stream to the text stream.
</p>
<p>
    ' The text stream will use the simple stream.
</p>
<p>
    oTextStream.setOutputStream(oStream)
</p>
<p>
</p>
<p>
    ' Write the strings.
</p>
<p>
    For i = LBound(sStrings) To UBound(sStrings)
</p>
<p>
    oTextStream.writeString(sStrings(i) &amp; CHR$(10))
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    ' Close the stream.
</p>
<p>
    oTextStream.closeOutput()
</p>
<p>
    oTextStream = CreateUnoService("com.sun.star.io.TextInputStream")
</p>
<p>
    oStream = oSFA.openFileRead(sFileName)
</p>
<p>
    oTextStream.setInputStream(oStream)
</p>
<p>
    For i = LBound(sStrings) To UBound(sStrings)
</p>
<p>
    sInput = oTextStream.readLine()
</p>
<p>
    s = s &amp; CStr(i)
</p>
<p>
</p>
<p>
    ' If the EOF is reached then the new line delimiters are
</p>
<p>
    ' not removed. I consider this a bug.
</p>
<p>
    If oTextStream.isEOF() Then
</p>
<p>
    If Right(sInput, 1) = CHR$(10) Then
</p>
<p>
    sInput = Left(sInput, Len(sInput) - 1)
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    ' Verify that the read string is the same as the written string.
</p>
<p>
    If sInput &lt;&gt; sStrings(i) Then
</p>
<p>
    s = s &amp; " : BAD "
</p>
<p>
    Else
</p>
<p>
    s = s &amp; " : OK "
</p>
<p>
    End If
</p>
<p>
    s = s &amp; "(" &amp; sStrings(i) &amp; ")"
</p>
<p>
    s = s &amp; "(" &amp; sInput &amp; ")" &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    oTextStream.closeInput()
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000B30000007494277B8B.png" style="width:1.8646in;height:1.2083in" />
</p>
<p>
    <strong>Figure .</strong> Text files with SimpleFileAccess.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="pipes">
                            <span id="anchor-158"></span>Pipes
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A pipe is an output stream and an input stream. Data written to the outputstream is buffered until it is read from
    the input stream. The Pipe service allows an outputstream to be converted into an input stream at the cost of an
    additional buffer. It is simple to create and close a pipe. Although CreatePipe in creates data streams, a very
    simple change would use a text stream instead.
</p>
<p>
    <strong>Listing .</strong> Create and close a pipe.
</p>
<p>
    Function CreatePipe() As Object
</p>
<p>
    Dim oPipe ' Pipe Service.
</p>
<p>
    Dim oDataInp ' DataInputStream Service.
</p>
<p>
    Dim oDataOut ' DataOutputStream Service.
</p>
<p>
    oPipe = createUNOService ("com.sun.star.io.Pipe")
</p>
<p>
    oDataInp = createUNOService ("com.sun.star.io.DataInputStream")
</p>
<p>
    oDataOut = createUNOService ("com.sun.star.io.DataOutputStream")
</p>
<p>
    oDataInp.setInputStream(oPipe)
</p>
<p>
    oDataOut.setOutputStream(oPipe)
</p>
<p>
    CreatePipe = oPipe
</p>
<p>
    End Function
</p>
<p>
    Sub ClosePipe(oPipe)
</p>
<p>
    oPipe.Successor.closeInput
</p>
<p>
    oPipe.Predecessor.closeOutput
</p>
<p>
    oPipe.closeInput
</p>
<p>
    oPipe.closeOutput
</p>
<p>
    End Sub
</p>
<p>
    TestPipes in uses a pipe to convert a byte array to a double and a double to a byte array.
</p>
<p>
    <strong>Listing .</strong> Convert a byte array to a double and a double to a binary array.
</p>
<p>
    Sub TestPipes
</p>
<p>
    Dim oPipe ' Pipe service.
</p>
<p>
    Dim d As Double
</p>
<p>
    Dim i As Integer
</p>
<p>
    Dim s$
</p>
<p>
    oPipe = CreatePipe()
</p>
<p>
</p>
<p>
    ' First, write a series of bytes that represents 3.1415
</p>
<p>
    oPipe.Predecessor.writeBytes(Array(64, 9, 33, -7, -16, 27, -122, 110))
</p>
<p>
    d = 2.6 '4004CCCCCCCCCCCD
</p>
<p>
    oPipe.Predecessor.writeDouble(d)
</p>
<p>
</p>
<p>
    ' Now, read the pipe.
</p>
<p>
    d = oPipe.Successor.readDouble()
</p>
<p>
    s = "Read the array of bytes as: " &amp; CStr(d) &amp; CHR$(10) &amp; CHR$(10)
</p>
<p>
    ' Now read the double that was written as a series of bytes.
</p>
<p>
    s = s &amp; "2.6 = "
</p>
<p>
    Do While oPipe.Successor.available() &gt; 0
</p>
<p>
    i = oPipe.Successor.readByte()
</p>
<p>
    REM In case the byte was negative
</p>
<p>
    i = i AND 255
</p>
<p>
    If i &lt; 16 Then s = s &amp; "0"
</p>
<p>
    s = s &amp; Hex(i) &amp; " "
</p>
<p>
    Loop
</p>
<p>
    ClosePipe(oPipe)
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-6">
                    <span id="anchor-159"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The file and directory functions in OOo Basic are able to manipulate directories and files. With the exception of
    reading and writing binary and random files, the directory and file manipulation functions work with few surprises.
    On the other hand, some of the functions are broken and have been broken for years; you may need to use more
    advanced methods, such as Streams and SimpleFileAccess for anything other than simple file reading and writing.
</p>
<ol type="1">
    <li>
        <h1 id="miscellaneous-routines">
            <span id="anchor-160"></span>Miscellaneous Routines
        </h1>
    </li>
</ol>
<p>
    This chapter introduces the subroutines and functions supported by OpenOffice.org Basic that do not easily fit into
    another larger category<em><em> — </em></em>for example, routines related to flow control, user input, user output,
    error handling, inspecting variables, color, and display<em><em><strong> — </strong></em></em><strong>as well
        as</strong> a few routines that you should not use.
</p>
<p>
    I was tempted to call this chapter “Leftovers” because it contains the routines that were left over after I grouped
    the others into chapters. Although the word “leftovers” frequently has a negative connotation, this is certainly not
    the case for the routines discussed in this chapter. The eclectic mix of routines includes some of the more
    interesting and useful routines that are varied enough to prevent boredom from lulling you off to sleep.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="display-and-color">
                    <span id="anchor-161"></span>Display and color
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The OOo Basic functions related to color manipulations and determining screen metrics are shown in . The screen
    metrics provide the size of each pixel so that you can write macros to create objects at a given size and position
    objects more precisely.
</p>
<p>
    <strong>Table .</strong> Display- and color-related functions in OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Blue(color)
            </td>
            <td>
                Get the blue component
            </td>
        </tr>
        <tr class="even">
            <td>
                GetGuiType
            </td>
            <td>
                Get the GUI type: Mac, Windows, Unix
            </td>
        </tr>
        <tr class="odd">
            <td>
                Green(color)
            </td>
            <td>
                Get the green component
            </td>
        </tr>
        <tr class="even">
            <td>
                QBColor(dos_color)
            </td>
            <td>
                Return RGB for standard color
            </td>
        </tr>
        <tr class="odd">
            <td>
                Red(color)
            </td>
            <td>
                Get the red component
            </td>
        </tr>
        <tr class="even">
            <td>
                RGB(red, green, blue)
            </td>
            <td>
                RGB to colorNumber
            </td>
        </tr>
        <tr class="odd">
            <td>
                TwipsPerPixelX
            </td>
            <td>
                Width of each pixel in twips
            </td>
        </tr>
        <tr class="even">
            <td>
                TwipsPerPixelY
            </td>
            <td>
                Height of each pixel in twips
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="determine-the-gui-type">
                            <span id="anchor-162"></span>Determine the GUI type
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The GetGuiType function returns an integer corresponding to the graphical user interface (GUI). In other words, you
    can find out what type of computer is running the macro ... well, sort of. This function only mentions the GUI type,
    not the operating system<em><em> — </em></em>for example, just Windows, not Windows 98 or Windows XP. The function
    GetGuiType is only included for backward compatibility with previous versions of OOo Basic.
</p>
<p>
    One of my associates runs OpenOffice.org as a server on his computer at home. He then connects to his home computer
    from work as a client. The value returned by GetGuiType is not defined while OOo is running in a client/server
    environment.
</p>
<p>
    shows the return values, as documented by the OOo help and seen in the source code as of version 3.2.1.
</p>
<p>
    <strong>Table .</strong> Return values from GetGuiType.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                Windows
            </td>
            <td>
                Windows (sometimes OS/2, which runs Windows)
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                Not mentioned
            </td>
            <td>
                OS/2
            </td>
        </tr>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
                Not mentioned
            </td>
            <td>
                Used to be Mac, not returned.
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                Unix
            </td>
            <td>
                Unix
            </td>
        </tr>
        <tr class="odd">
            <td>
                -1
            </td>
            <td>
                Mentioned as an undefined value
            </td>
            <td>
                Unsupported OS
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in demonstrates the GetGuiType function.
</p>
<p>
    <strong>Listing .</strong> Display the GUI type as a string.
</p>
<p>
    Sub DisplayGUIType()
</p>
<p>
    Dim s As String
</p>
<p>
    Select Case GetGUIType()
</p>
<p>
    Case 1
</p>
<p>
    s = "Windows"
</p>
<p>
    Case 2
</p>
<p>
    s = "OS/2" ' Set in the source code, but no longer documented.
</p>
<p>
    Case 3
</p>
<p>
    s = "Mac OS" ' Used to be documented, never supported, I expect Mac to return 4.
</p>
<p>
    Case 4
</p>
<p>
    s = "UNIX"
</p>
<p>
    Case Else
</p>
<p>
    s = "Unknown value " &amp; CStr(GetGUIType()) &amp; CHR$(10) &amp;_
</p>
<p>
    "Probably running in Client/Server mode"
</p>
<p>
    End Select
</p>
<p>
    MsgBox "GUI type is " &amp; s, 0, "GetGUIType()"
</p>
<p>
    End Sub
</p>
<p>
    The value -1 is returned if the type is not known, but that is not specifically documented. This probably means that
    you are running in a client / server mode, but, I have not checked that.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="determine-pixel-size-in-twips">
                            <span id="anchor-163"></span>Determine pixel size (in twips)
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic has two functions to determine the size of each display pixel (dot) in twips: TwipsPerPixelX and
    TwipsPerPixelY. The word “twip” is short for “twentieth of a PostScript point.” There are 72 PostScript points in an
    inch, thus 1440 twips in an inch.
</p>
<p>
    In 1886, the American Typefounders Association proposed a unit of measure for typesetting called the “American
    Printer’s Point.” There are approximately 72.27000072 Printer’s Points in an inch. Years later while developing the
    PostScript page description language for Adobe Systems, Jim Warnock and Charles Geschke defined the PostScript point
    as exactly 72 points to an inch. When dot-matrix printers were released, they could print at either 10 or 12
    characters per inch. Twips were created as a unit of measure that worked well for both dot-matrix printers and
    PostScript points.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                There are 1440 twips in an inch. This number is important because OOo uses twips for many measurements.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Twips are the standard on which all Microsoft Windows graphics routines are based. Twips are used in the Rich Text
    Format, printer drivers, screen drivers, and many other products and platforms<em><em> — </em></em>including
    OpenOffice.org. The macro in obtains the number of twips per pixel in both the X and Y direction (horizontal and
    vertical) and displays the number of pixels per inch.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Determine how many pixels per inch.
</p>
<p>
    Sub DisplayPixelSize
</p>
<p>
    Dim s As String
</p>
<p>
    s = s &amp; TwipsPerPixelX() &amp; " Twips per X-Pixel or " &amp;_
</p>
<p>
    CStr(1440 \ TwipsPerPixelX()) &amp; " X-Pixels per Inch" &amp; CHR$(10)
</p>
<p>
    s = s &amp; TwipsPerPixelY() &amp; " Twips per Y-Pixel or " &amp;_
</p>
<p>
    CStr(1440 \ TwipsPerPixelY()) &amp; " Y-Pixels per Inch"
</p>
<p>
    MsgBox s, 0, "Pixel Size"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000013300000065F308AFDF.png" style="width:3.198in;height:1.052in" />
</p>
<p>
    <strong>Figure .</strong> Number of pixels per inch on my computer.
</p>
<p>
    Unfortunately, it is not clear to me what is returned when there are multiple monitors with different values. The
    source code returns values from the “Default Device”.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="use-color-functions">
                            <span id="anchor-164"></span>Use color functions
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Colors on computer monitors, digital cameras, scanners<em><em> — </em></em>and those seen by the human eye<em><em> —
        </em></em>are produced by adding the three primary colors of light: red, green, and blue (RGB). When printing or
    painting, color is produced by absorbing some colors and reflecting others. Color printing uses a different set of
    colors, called primary pigments: cyan, magenta, yellow, and black (CMYK). These two different systems are based on
    real physical models. The RGB model is based on how light combines to form colors. The CMYK model is based on what
    happens when you mix paint of different colors.
</p>
<p>
    OOo Basic uses the RGB model, allowing for 256 different shades of each of the primary colors. This number is stored
    as a Long Integer. Use the functions Red, Green, and Blue to extract the red, green, and blue components from a
    color in OOo. Use the RGB function to combine the individual color components and obtain the long integer used by
    OOo. The RGB function accepts three arguments, each representing one of the primary colors. Each of the color
    components must be a value from 0 through 255. The RGB function performs no validity checking, so consider the
    results undefined if you break the rules. In summary, OOo Basic represents RGB colors as a single integer; the
    functions Red, Green, and Blue extract the red, green and blue components; and the function RGB accepts the red,
    green, and blue components and returns the OOo Basic representation of the RGB color.
</p>
<p>
    Dim nRed As Integer 'Can only be 0 through 255
</p>
<p>
    Dim nGreen As Integer 'Can only be 0 through 255
</p>
<p>
    Dim nBlue As Integer 'Can only be 0 through 255
</p>
<p>
    Dim nOOoColor As Long 'Can only be 0 through 16,581,375
</p>
<p>
    nOOoColor = RGB(128, 3, 101) '8,389,477
</p>
<p>
    nRed = Red(nOOoColor) '128
</p>
<p>
    nGreen = Green(nOOoColor) '3
</p>
<p>
    nBlue = Blue(nOOoColor) '101
</p>
<p>
    In the old days of DOS, BASIC supported 16 colors. In , which shows the color name and the DOS the number used by
    DOS to represent the color. The OOo Color column contains the corresponding number as represented by OOo. The Red,
    Green, and Blue columns contain the values returned by the corresponding OOo Basic functions. The QBColor function
    is designed to accept the DOS Color as an argument and return the corresponding OOo Color.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Demonstrate QBColor values.
</p>
<p>
    Sub DisplayQBColor
</p>
<p>
    Dim i%
</p>
<p>
    Dim s$
</p>
<p>
    For i = 0 To 15
</p>
<p>
    s = s &amp; i &amp; " = " &amp; QBColor(i) &amp; " = ("
</p>
<p>
    s = s &amp; Red(QBColor(i)) &amp; ", "
</p>
<p>
    s = s &amp; Green(QBColor(i)) &amp; ", "
</p>
<p>
    s = s &amp; Blue(QBColor(i)) &amp; ")"
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000F000000137DA8E06DA.png" style="width:2.5in;height:3.2398in" />
</p>
<p>
    <strong>Figure .</strong> Results from QGColor.
</p>
<p>
    <strong>Table .</strong> Color representation in OpenOffice.org.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                0
            </td>
            <td>
                0
            </td>
            <td>
                0
            </td>
            <td>
                0
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                128
            </td>
            <td>
                0
            </td>
            <td>
                0
            </td>
            <td>
                128
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                32768
            </td>
            <td>
                0
            </td>
            <td>
                128
            </td>
            <td>
                0
            </td>
        </tr>
        <tr class="even">
            <td>
                6
            </td>
            <td>
                32896
            </td>
            <td>
                0
            </td>
            <td>
                128
            </td>
            <td>
                128
            </td>
        </tr>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                8388608
            </td>
            <td>
                128
            </td>
            <td>
                0
            </td>
            <td>
                0
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                8388736
            </td>
            <td>
                128
            </td>
            <td>
                0
            </td>
            <td>
                128
            </td>
        </tr>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
                8421376
            </td>
            <td>
                128
            </td>
            <td>
                128
            </td>
            <td>
                0
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                8421504
            </td>
            <td>
                128
            </td>
            <td>
                128
            </td>
            <td>
                128
            </td>
        </tr>
        <tr class="odd">
            <td>
                7
            </td>
            <td>
                12632256
            </td>
            <td>
                192
            </td>
            <td>
                192
            </td>
            <td>
                192
            </td>
        </tr>
        <tr class="even">
            <td>
                12
            </td>
            <td>
                255
            </td>
            <td>
                0
            </td>
            <td>
                0
            </td>
            <td>
                255
            </td>
        </tr>
        <tr class="odd">
            <td>
                10
            </td>
            <td>
                65280
            </td>
            <td>
                0
            </td>
            <td>
                255
            </td>
            <td>
                0
            </td>
        </tr>
        <tr class="even">
            <td>
                14
            </td>
            <td>
                65535
            </td>
            <td>
                0
            </td>
            <td>
                255
            </td>
            <td>
                255
            </td>
        </tr>
        <tr class="odd">
            <td>
                9
            </td>
            <td>
                16711680
            </td>
            <td>
                255
            </td>
            <td>
                0
            </td>
            <td>
                0
            </td>
        </tr>
        <tr class="even">
            <td>
                13
            </td>
            <td>
                16711935
            </td>
            <td>
                255
            </td>
            <td>
                0
            </td>
            <td>
                255
            </td>
        </tr>
        <tr class="odd">
            <td>
                11
            </td>
            <td>
                16776960
            </td>
            <td>
                255
            </td>
            <td>
                255
            </td>
            <td>
                0
            </td>
        </tr>
        <tr class="even">
            <td>
                15
            </td>
            <td>
                16777215
            </td>
            <td>
                255
            </td>
            <td>
                255
            </td>
            <td>
                255
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="flow-control-1">
                    <span id="anchor-165"></span>Flow control
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The flow-control functions listed in either direct flow or provide functionality similar to flow control. For
    example, the IIF (immediate if) function provides functionality that would otherwise require an If-Then-Else
    statement.
</p>
<p>
    <strong>Table .</strong> OOo Basic functions related to flow control.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Choose(number, argument_list)
            </td>
            <td>
                Flow control
            </td>
        </tr>
        <tr class="even">
            <td>
                IIF(condition, TrueExpression, FalseExpression)
            </td>
            <td>
                Flow control
            </td>
        </tr>
        <tr class="odd">
            <td>
                Stop
            </td>
            <td>
                Stop execution now
            </td>
        </tr>
        <tr class="even">
            <td>
                Wait(milliseconds)
            </td>
            <td>
                Pause the macro for a short time
            </td>
        </tr>
        <tr class="odd">
            <td>
                WaitUntil(aTime)
            </td>
            <td>
                Wait until a time has been reached.
            </td>
        </tr>
        <tr class="even">
            <td>
                Declare
            </td>
            <td>
                Declare a DLL that you want to call
            </td>
        </tr>
        <tr class="odd">
            <td>
                DDEExecute(nDDEChannel, command)
            </td>
            <td>
                Execute a DDE command
            </td>
        </tr>
        <tr class="even">
            <td>
                DDEInitiate(Server, Topic)
            </td>
            <td>
                Open a DDE channel
            </td>
        </tr>
        <tr class="odd">
            <td>
                DDEPoke(nDDEChannel, item, data)
            </td>
            <td>
                Set data on the DDE server through the channel
            </td>
        </tr>
        <tr class="even">
            <td>
                DDERequest(nDDEChannel, item)
            </td>
            <td>
                Post a DDE request over an open channel
            </td>
        </tr>
        <tr class="odd">
            <td>
                DDETerminateAll()
            </td>
            <td>
                Close all DDE connections
            </td>
        </tr>
        <tr class="even">
            <td>
                FreeLibrary
            </td>
            <td>
                Free a DLL library
            </td>
        </tr>
        <tr class="odd">
            <td>
                Shell
            </td>
            <td>
                Run a command through the command shell
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="return-an-argument">
                            <span id="anchor-166"></span>Return an argument
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The IIF function (Immediate If) and the Choose function both return an argument based on the value of the first
    argument. The IIF function returns one of two values based on a conditional expression. This works as a great
    one-line If-Then-Else statement.
</p>
<p>
    max_age = IIF(johns_age &gt; bills_age, johns_age, bills_age)
</p>
<p>
    The IIF function takes three arguments. The first argument is a Boolean value, which determines what argument to
    return; one of the next two arguments is returned. shows how you can write the IIF function yourself.
</p>
<p>
    <strong>Listing .</strong> The IIF function, if you wrote it yourself.
</p>
<p>
    Function myIIF(conditional, true_arg, false_arg) As Variant
</p>
<p>
    If CBool(conditional) Then
</p>
<p>
    myIIF = true_arg
</p>
<p>
    Else
</p>
<p>
    myIIF = false_arg
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<p>
    All arguments to a routine are evaluated before the routine is called. Because IIF is a function, all arguments are
    evaluated when the function runs. With an If statement, the conditional code runs only if necessary. See .
</p>
<p>
    <strong>Listing .</strong> If the denominator is zero, the division does not occur.
</p>
<p>
    If denominator &lt;&gt; 0 Then
</p>
<p>
    result = numerator / denominator
</p>
<p>
    else
</p>
<p>
    result = 0
</p>
<p>
    End If
</p>
<p>
    In , if the denominator is zero, the division is not done and zero is returned instead. In case your mathematical
    skills are a little rusty, it is not valid to divide a number by zero; a run-time error occurs. On the other hand,
    if your mathematical skills are not rusty, you know that returning zero when the denominator is zero isn’t really
    correct, either. The macro in demonstrates that the functions f1 and f2 are both called, even though only the value
    from f2 is returned. In other words, IIF(x &lt;&gt; 0, 1/x, 0) causes a division-by-zero error if x is zero.
</p>
<p>
    <strong>Listing .</strong> All IIF arguments are called.
</p>
<p>
    Sub ExampleIIF
</p>
<p>
    REM This demonstrates that ALL expressions are evaluated
</p>
<p>
    REM This prints
</p>
<p>
    REM "I am in function f1"
</p>
<p>
    REM "I am in function f2"
</p>
<p>
    REM "f2"
</p>
<p>
    Print IIF(1&gt;2, f1(), f2())
</p>
<p>
    End Sub
</p>
<p>
    Function f1$
</p>
<p>
    Print "I am in function f1"
</p>
<p>
    f1 = "f1"
</p>
<p>
    End Function
</p>
<p>
    Function f2$
</p>
<p>
    Print "I am in function f2"
</p>
<p>
    f2 = "f2"
</p>
<p>
    End Function
</p>
<p>
    The Choose function is similar to the IIF function in that it returns an argument based on the value in the first
    argument. However, it differs because it can have more than two possible return values, and the first argument is an
    integer, rather than a Boolean, that indicates which of those possibly many arguments to return.
</p>
<p>
    Choose (expression, Select_1[, Select_2, ... [,Select_n]])
</p>
<p>
    The Choose statement returns a null if the expression is less than 1 or greater than the number of selection
    arguments. Choose returns Select_1 if the expression evaluates to 1 and Select_2 if the expression evaluates to 2.
    The result is similar to storing the selections in an array with a lower bound of 1 and then indexing into the
    array. Each argument is evaluated regardless of which one is returned. See .
</p>
<p>
    <strong>Listing .</strong> Demonstrate the Choose statement.
</p>
<p>
    Sub ExampleChoose
</p>
<p>
    Dim i%, v
</p>
<p>
    i% = CStr(InputBox("Enter an integer 1–4 (negative number is an error)"))
</p>
<p>
    v = Choose(i, "one", "two", "three", "four")
</p>
<p>
    If IsNull(v) Then
</p>
<p>
    Print "V is null"
</p>
<p>
    Else
</p>
<p>
    Print CStr(v)
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="pause-or-end-the-macro">
                            <span id="anchor-167"></span>Pause or end the macro
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The Stop command causes the macro to stop running. That’s it, it is done, finished! You must start again. The Wait
    statement, on the other hand, only pauses macro execution (see ). After the specified number of milliseconds, the
    macro starts running again. A run-time error occurs if the number of milliseconds to wait is negative.
</p>
<p>
    <strong>Listing .</strong> Demonstrate the wait function.
</p>
<p>
    Sub ExampleWait
</p>
<p>
    On Error Goto BadInput
</p>
<p>
    Dim nMillis As Long
</p>
<p>
    Dim nStart As Long
</p>
<p>
    Dim nEnd As Long
</p>
<p>
    Dim nElapsed As Long
</p>
<p>
    nMillis = CLng(InputBox("How many milliseconds to wait?"))
</p>
<p>
    nStart = GetSystemTicks()
</p>
<p>
    Wait(nMillis)
</p>
<p>
    nEnd = GetSystemTicks()
</p>
<p>
    nElapsed = nEnd - nStart
</p>
<p>
    MsgBox "You requested to wait for " &amp; nMillis &amp; " milliseconds" &amp;_
</p>
<p>
    CHR$(10) &amp; "Waited for " &amp; nElapsed &amp; " milliseconds", 0, "Example Wait"
</p>
<p>
    BadInput:
</p>
<p>
    If Err &lt;&gt; 0 Then
</p>
<p>
    Print Error() &amp; " at line " &amp; Erl
</p>
<p>
    End If
</p>
<p>
    On Error Goto 0
</p>
<p>
    End Sub
</p>
<p>
    In all of my experiments, the Wait statement has been accurate. The macro waits and then starts when it should. In
    previous versions of OOo, the Wait statement was inefficient and it used a lot of CPU time while running. This
    problem has been fixed in the current versions of OOo.
</p>
<p>
    WaitUntil is new and provides more compatibility with VB. The following code waits two seconds.
</p>
<p>
    WaitUntil Now + TimeValue("00:00:02")
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="dynamic-link-libraries">
                            <span id="anchor-168"></span>Dynamic Link Libraries
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    While a macro runs, it may directly call numerous subroutines and functions. A macro can also call routines and
    applications that are not related to OpenOffice.org. A Dynamic Link Library (DLL) is a collection of routines, or
    programs, that can be called when required. Each DLL is packaged into a single file with the extension DLL<em><em> —
        </em></em>the file does not always have the suffix “.dll”, but it usually does. There are two very nice things
    about DLL files: Many programs can share a single DLL, and they are not usually loaded into memory until they are
    needed. The usage of DLLs promotes code reuse and does not waste memory. To tell OOo Basic about a routine in a DLL,
    use the Declare statement.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                DLLs are not supported on Linux.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Declare Sub Name Lib "LibName" (arguments)
</p>
<p>
    Declare Function Name Lib "LibName" (arguments) As Type
</p>
<p>
    LibName is the name of the DLL that contains the routine named Name. It is common to use a DLL that you did not
    write, so you often have no control over the name of the routine that you call. Naming can be a problem if your
    macro already contains a routine with the same name or if you call another routine by the same name in another DLL.
    As a result, the Declare statement supports the Alias keyword, which you can use to overcome this hurdle. In this
    case, the RealName is the name used by the DLL, and myName is the name used by your macro.
</p>
<p>
    Declare Sub myName Lib "LibName" Alias "RealName" (arguments)
</p>
<p>
    Declare Function myName Lib "Libname" Alias "RealName" (arguments) As Type
</p>
<p>
    For functions, the type declaration should use the standard types. You must, of course, know the type so that you
    can declare it. The argument list contains the arguments that are passed to the external routine. You must use the
    keyword ByVal if an argument is passed by value rather than by reference. calls a DLL.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                By default OOo Basic passes arguments by reference. This means that if the called subroutine changes the
                argument, it is also changed in the calling program. The ByVal keyword causes an argument to be passed
                by value rather than by reference.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Call a DLL. This will only work on windows (and if the DLL is present).
</p>
<p>
    Declare Sub MyMessageBeep Lib "user32.dll" Alias "MessageBeep" ( Long)
</p>
<p>
    Declare Function CharUpper Lib "user32.dll" Alias "CharUpperA"_
</p>
<p>
    (ByVal lpsz As String) As String
</p>
<p>
    Sub ExampleCallDLL
</p>
<p>
    REM Convert a string to uppercase
</p>
<p>
    Dim strIn As String
</p>
<p>
    Dim strOut As String
</p>
<p>
    strIn = "i Have Upper and Lower"
</p>
<p>
    strOut = CharUpper(strIn)
</p>
<p>
    MsgBox "Converted:" &amp; CHR$(10) &amp; strIn &amp; CHR$(10) &amp;_
</p>
<p>
    "To:" &amp; CHR$(10) &amp; strOut, 0, "Call a DLL Function"
</p>
<p>
    REM On my computer, this plays a system sound
</p>
<p>
    Dim nBeepLen As Long
</p>
<p>
    nBeepLen = 5000
</p>
<p>
    MyMessageBeep(nBeepLen)
</p>
<p>
    FreeLibrary("user32.dll" )
</p>
<p>
    End Sub
</p>
<p>
    A DLL is not loaded until a routine in the DLL is called. To remove the DLL from memory, use the FreeLibrary
    statement. The FreeLibrary statement accepts one argument: the name of the DLL to unload.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="calling-external-applications">
                            <span id="anchor-169"></span>Calling external applications
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the Shell statement to run an external application. The Shell command is disabled for users connecting by a
    virtual portal unless they happen to be the same user that started OOo in the first place. This statement does not
    obtain any information from an application; it simply runs another application or command.
</p>
<p>
    Shell(Pathname, Windowstyle, Param, bSync)
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The Shell command is a potential security hole.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The only required argument is the first; the rest are optional. The first argument is the full path name of the
    external application. The application path may be in URL notation, but need not be. The Shell statement has problems
    if the path or application name contains a space. You can solve this problem the same way that your Web browser
    solves it: Substitute “%20” for each space. The ASCII value of a space is 32, which is 20 in hexadecimal. This
    technique can also be used to substitute other characters if they cause you problems.
</p>
<p>
    Shell("file:///C|/Andy/My%20Documents/oo/tmp/h.bat",2) 'URL notation uses /
</p>
<p>
    Shell("C:\Andy\My%20Documents\oo\tmp\h.bat",2) 'Windows notation uses \
</p>
<p>
    The second argument (optional) indicates the window style of the started application. lists valid values for the
    Shell window style argument.
</p>
<p>
    <strong>Table .</strong> Window styles for the Shell statement.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                Focus is on the hidden program window.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                Focus is on the program window in standard size.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                Focus is on the minimized program window.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                Focus is on the maximized program window.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                Standard size program window, without focus.
            </td>
        </tr>
        <tr class="even">
            <td>
                6
            </td>
            <td>
                Minimized program window, but focus remains on the active window.
            </td>
        </tr>
        <tr class="odd">
            <td>
                10
            </td>
            <td>
                Full-screen display.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The third argument (optional) is a string that is passed to the application. Each space in the argument string is
    read by the called application as delimiting a separate argument. To pass an argument with an embedded space, place
    an extra set of double quotation marks around the arguments.
</p>
<p>
    Shell("/home/andy/foo.ksh", 10, """one argument"" another") ' two arguments
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The string """one argument"" another" is correct and as intended; think about it!
            </td>
        </tr>
    </tbody>
</table>
<p>
    The final optional argument determines if the Shell command returns immediately while the application is running
    (the default behavior) or if it waits until the application is finished. Setting the final argument to True causes
    the Shell statement to wait.
</p>
<p>
    Sub ExampleShell
</p>
<p>
    Dim rc As Long
</p>
<p>
    rc = Shell("C:\andy\TSEProWin\g32.exe", 2, "c:\Macro.txt")
</p>
<p>
    Print "I just returned and the returned code is " &amp; rc ' rc = 0
</p>
<p>
    Rem These two have spaces in their names
</p>
<p>
    Shell("file:///C|/Andy/My%20Documents/oo/tmp/h.bat",2)
</p>
<p>
    Shell("C:\Andy\My%20Documents\oo\tmp\h.bat",2)
</p>
<p>
    End Sub
</p>
<p>
    The Shell function returns a long with the value zero. If the program does not exist, a run-time error occurs and
    nothing is returned. When some applications run, they return a value that can be used to indicate an error. This
    value is not available from the Shell command. Intuitively, it isn’t possible to obtain the final return value from
    an application when the Shell function returns before the application is finished running.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                In Visual Basic, the arguments for the Shell function are different: Shell(path, window_style, bsync,
                Timeout). The Timeout value indicates how long to wait for the external application to finish. Arguments
                follow the application name as part of the same string, delimited by spaces.
            </td>
        </tr>
    </tbody>
</table>
<p>
    VB does not use a separate argument to specify the arguments to send to the application launched by the Shell
    command. Instead, the arguments follow the name of the application, separated by spaces, inside the same quotation
    marks that contain the function path and name. This method also works with OOo Basic, as an alternative way to
    specify the Shell command arguments. If only function, arguments, and window style are required, this alternative
    way to write the Shell command allows you to have identical statements for VB or OOo routines. If you want to
    specify bsync or Timeout arguments, the VB and OOo environments are not compatible.
</p>
<p>
    Shell("/home/andy/foo.ksh hello you") ' two arguments, "hello" and "you"
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="dynamic-data-exchange">
                            <span id="anchor-170"></span>Dynamic Data Exchange
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Dynamic Data Exchange (DDE) is a mechanism that allows information to be shared between programs. Data may be
    updated in real time or it may work as a request response.
</p>
<p>
    Although the DDE commands accepted by a DDE server are specific to the individual server, the general syntax is the
    same. Most DDE commands require a Server, Topic, and Item. The Server is the DDE name for the application that
    contains the data. The Topic, usually a file name, contains the location of the referenced Item. The example in uses
    the DDE function in a Calc spreadsheet to extract data in cell A1 from an Excel spreadsheet.
</p>
<p>
    <strong>Listing .</strong> Use DDE as a Calc function to extract cell A1 from a document.
</p>
<p>
    =DDE("soffice";"/home/andy/tstdoc.xls";"a1") 'DDE in Calc to obtain a cell
</p>
<p>
    ='file:///home/andy/TST.sxc'#$sheet1.A1 'Direct reference to a cell
</p>
<p>
    The second line shows how a cell can be directly referenced in another Calc spreadsheet without using DDE. OOo Basic
    supports DDE commands directly (see ).
</p>
<p>
    <strong>Table .</strong> DDE commands supported by OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                DDEExecute(nDDEChannel, command)
            </td>
            <td>
                Execute a DDE command.
            </td>
        </tr>
        <tr class="even">
            <td>
                DDEInitiate(Server, Topic)
            </td>
            <td>
                Open a DDE channel and return the channel number.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DDEPoke(nDDEChannel, item, data)
            </td>
            <td>
                Set data on the DDE server.
            </td>
        </tr>
        <tr class="even">
            <td>
                DDERequest(nDDEChannel, item)
            </td>
            <td>
                Post a DDE request over an open channel.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DDETerminateAll()
            </td>
            <td>
                Close all DDE connections.
            </td>
        </tr>
    </tbody>
</table>
<p>
    First, the DDEInitiate function makes a connection to the DDE server. The first argument is the name of the
    server<em><em> — </em></em>for example, “soffice” or “excel”. The second argument specifies the channel to use. A
    common value for a channel is a file name. The opened channel is identified by an integer, which is returned by the
    DDEInitiate command. A channel number of 0 indicates that the channel was not opened. Attempting to establish a DDE
    connection to OOo for a file that is not currently open returns 0 for the channel. See .
</p>
<p>
    <strong>Listing .</strong> Use DDE to access a Calc document.
</p>
<p>
    Sub ExampleDDE
</p>
<p>
    Dim nDDEChannel As Integer
</p>
<p>
    Dim s As String
</p>
<p>
    REM OOo must have the file open or the channel will not be opened
</p>
<p>
    nDDEChannel = DDEInitiate("soffice", "c:\TST.sxc")
</p>
<p>
    If nDDEChannel = 0 Then
</p>
<p>
    Print "Sorry, failed to open a DDE channel"
</p>
<p>
    Else
</p>
<p>
    Print "Using channel " &amp; nDDEChannel &amp; " to request cell A1"
</p>
<p>
    s = DDERequest(nDDEChannel, "A1")
</p>
<p>
    Print "Returned " &amp; s
</p>
<p>
    DDETerminate(nDDEChannel)
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    The usable commands and syntax for each server are server dependent, so a complete coverage of DDE is beyond the
    scope of this book.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                runs and returns a value, but it crashes OOo when I run it.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="user-input-and-output">
                    <span id="anchor-171"></span>User input and output
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic provides a very simple mechanism for presenting information to the user and obtaining information from the
    user at run time (see ). These routines aren’t used to access files; they’re used strictly for user input from the
    keyboard and output to the screen.
</p>
<p>
    <strong>Table .</strong> User input and output functions.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                InputBox(Msg, Title, Default, x_pos, y_pos)
            </td>
            <td>
                Request user input as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                MsgBox (Message, Type, Title)
            </td>
            <td>
                Display a message in a nice dialog.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Print expression1; expression2, expression3;...
            </td>
            <td>
                Print expressions.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="simple-output">
                            <span id="anchor-172"></span>Simple output
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the Print statement for simple, single-line output. A list of expressions follows the Print statement. If two
    expressions are separated by a semicolon, the expressions are printed adjacent to each other. If two expressions are
    separated by a comma, the expressions are printed with a tab between them; you cannot change the size of the tabs.
</p>
<p>
    Print expression1, expression2, ... ' Print with tabs between expressions
</p>
<p>
    Print expression1; expression2; ... ' Print with nothing between expressions
</p>
<p>
    Print 1,Now;"hello","again";34.3 ' Mixing semicolons and commas is fine
</p>
<p>
    Arguments are converted to a locale-specific string representation before they are printed. In other words, dates
    and numbers appear as you expect based on the locale set in your configuration (Tools | Options | Language Settings
    | Languages). Boolean values, however, always print the text True or False.
</p>
<p>
    The help included with OOo lists two special expressions that work with the Print statement: Spc and Tab. In OOo
    Basic, the Spc function works the same as the Space function. It accepts one numeric argument and returns a string
    composed completely of spaces. The Tab function, although documented, does not exist. See for a Print example.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Although the Tab function has been documented since OOo version 1, as of version 3.2, the Tab function
                still does not exist and it is still documented.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Demonstrate the Spc() function.
</p>
<p>
    Sub ExamplePrint
</p>
<p>
    Print "It is now";Spc(12);Now()
</p>
<p>
    End Sub
</p>
<p>
    The Print statement is usually used for simple, single-line output while debugging, because it allows you to stop a
    macro from running by clicking the Cancel button (see ). This is a great tool for debugging. Place a Print statement
    before or after lines that may cause a problem. If the values don’t appear to be correct, you can click the Cancel
    button to stop the macro.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The print statement is nice because you can cause a macro to stop running by clicking Cancel. An
                advantage, and a disadvantage, however, is that it leaves the user in the IDE at the print statement.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <img src="Pictures/10000000000001030000005667EA8463.png" style="width:2.698in;height:0.8957in" />
</p>
<p>
    <strong>Figure .</strong> The Spc function returns a string with spaces.
</p>
<p>
    When using many Print statements for debugging purposes, print explanatory information with the data to remind
    yourself what it is.
</p>
<p>
    Print "Before the loop, x= ";x
</p>
<p>
    For i=0 To 10
</p>
<p>
    Print "In the loop, i = ";i;" and x = ";x
</p>
<p>
    When you print a string that contains a new-line character (ASCII 10 or 13), a new dialog is displayed for each new
    line. The code in displays three consecutive dialogs with text that reads “one”, “two”, and “three”. The Print
    dialog is able to print using more than one line. If a single line of text becomes too long, the line wraps and
    appears on more than one line. In other words, although Print will wrap by itself, the user has no way to force a
    new line in the dialog.
</p>
<p>
    <strong>Listing .</strong> New lines print in their own dialog.
</p>
<p>
    Print "one" &amp; CHR$(10) &amp; "two" &amp; CHR$(13) &amp; "three" ' Displays three dialogs
</p>
<p>
    The Print statement uses a simple, defined protocol for numeric formatting. Positive numeric expressions contain a
    leading space. Negative numeric expressions contain a leading minus sign. Numbers with a decimal are printed in
    exponential notation if they become too large.
</p>
<p>
    The Print statement displays a print dialog each time, unless the statement ends with either a semicolon or a comma.
    In this case it stores the text from each Print statement and adds to it until it encounters a Print statement that
    doesn’t end with a semicolon or a comma.
</p>
<p>
    Print "one", 'Do not print yet, ends with a comma
</p>
<p>
    Print "two" 'Print "one two"
</p>
<p>
    Print "three",'Do not print yet, ends with a comma
</p>
<p>
    Print "four"; 'Do not print yet, ends with a semicolon
</p>
<p>
    Print 'Print "three four"
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="multi-line-output">
                            <span id="anchor-173"></span>Multi-line output
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The MsgBox statement provides more control over the dialog that is displayed than does the Print statement, but can
    print only one string expression at a time. String expressions that contain a new-line character (ASCII 10 or 13)
    are printed in the same dialog. Each new-line character starts a new line in the dialog.
</p>
<p>
    <strong>Listing .</strong> Display a simple message box with a new line.
</p>
<p>
    Sub ExampleMsgBoxWithReturn
</p>
<p>
    MsgBox "one" &amp; CHR$(10) &amp; "two"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/1000000000000292000001B5F60BA21C.png" style="width:1.5299in;height:0.9417in" />
</p>
<p>
    <strong>Figure .</strong> This simple MsgBox dialog contains only an OK button.
</p>
<p>
    The dialog in is very simple. The MsgBox function accepts two new arguments, as shown in . The DialogTitle is
    displayed as the title line of the dialog. Valid values for DialogType are shown in . The DialogType determines
    which buttons are displayed in the dialog, which button is the default button, and which icon is displayed on the
    dialog.
</p>
<p>
    <strong>Listing .</strong> The MsgBox function can accept a type and a dialog title.
</p>
<p>
    MsgBox(Message)
</p>
<p>
    MsgBox(Message, DialogType)
</p>
<p>
    MsgBox(Message, DialogType, DialogTitle)
</p>
<p>
    <strong>Table .</strong> Valid values for DialogType.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                Display OK button only.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                Display OK and Cancel buttons.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                Display Abort, Retry and Ignore buttons.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                Display Yes, No, and Cancel buttons.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                Display Yes and No buttons.
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                Display Retry and Cancel buttons.
            </td>
        </tr>
        <tr class="odd">
            <td>
                16
            </td>
            <td>
                Add the Stop icon to the dialog.
            </td>
        </tr>
        <tr class="even">
            <td>
                32
            </td>
            <td>
                Add the Question icon to the dialog.
            </td>
        </tr>
        <tr class="odd">
            <td>
                48
            </td>
            <td>
                Add the Exclamation Point icon to the dialog.
            </td>
        </tr>
        <tr class="even">
            <td>
                64
            </td>
            <td>
                Add the Information icon to the dialog.
            </td>
        </tr>
        <tr class="odd">
            <td>
                128
            </td>
            <td>
                First button in the dialog is the default button. This is the default behavior.
            </td>
        </tr>
        <tr class="even">
            <td>
                256
            </td>
            <td>
                Second button in the dialog is the default button.
            </td>
        </tr>
        <tr class="odd">
            <td>
                512
            </td>
            <td>
                Third button in the dialog is the default button.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Demonstrate the MsgBox type behavior.
</p>
<p>
    Sub MsgBoxExamples()
</p>
<p>
    Dim i%
</p>
<p>
    Dim values
</p>
<p>
    values = Array(0, 1, 2, 3, 4, 5)
</p>
<p>
    For i = LBound(values) To UBound(values)
</p>
<p>
    MsgBox ("Dialog Type: " + values(i), values(i))
</p>
<p>
    Next
</p>
<p>
    values = Array(16, 32, 48, 64, 128, 256, 512)
</p>
<p>
    For i = LBound(values) To UBound(values)
</p>
<p>
    MsgBox ("Yes, No, Cancel, with Type: " + values(i), values(i) + 3)
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    You can use more than one DialogType at the same time to achieve your desired buttons, icon, and default behavior.
    The display choices are encoded in the first four bits (values 0-15 are binary 0000-1111); the icons and default
    behavior are encoded in higher bits (for example, 64 is 01000000 in binary). To combine attributes, use OR or add
    the values together. (This is similar to the behavior described for file attributes.)
</p>
<p>
    Although you can display a dialog with a Cancel button, this won’t cause the macro to stop running, as happens with
    the Print statement. Instead, the MsgBox function returns an integer that identifies the selected button (see ).
    Clicking the Cancel button returns the value 2, and the Abort button returns a 3, which can then be tested by your
    code; then you (in your code) can decide whether or not you really want to cancel the macro.
</p>
<p>
    <strong>Table .</strong> Return values from MsgBox.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                OK
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                Cancel
            </td>
        </tr>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
                Abort
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                Retry
            </td>
        </tr>
        <tr class="odd">
            <td>
                5
            </td>
            <td>
                Ignore
            </td>
        </tr>
        <tr class="even">
            <td>
                6
            </td>
            <td>
                Yes
            </td>
        </tr>
        <tr class="odd">
            <td>
                7
            </td>
            <td>
                No
            </td>
        </tr>
    </tbody>
</table>
<p>
    In other words, if you want the macro to stop when a user clicks the Cancel button, you must check the return value,
    as demonstrated in . The message contains a new-line character so the message contains two lines of text. The dialog
    type requests three buttons and an icon, and sets the second button to be default (see ). The macro does different
    things based on the selected button.
</p>
<p>
    <strong>Listing .</strong> Demonstrate how MsgBox works.
</p>
<p>
    Sub ExampleMsgBox
</p>
<p>
    Dim nReturnCode As Integer
</p>
<p>
    Dim nDialogType As Integer
</p>
<p>
    Dim sMessage As String
</p>
<p>
    sMessage = "An error occurred!" &amp; CHR$(10) &amp; "Do the important work anyway?"
</p>
<p>
    REM 3 means Yes, No, Cancel
</p>
<p>
    REM 48 displays an Exclamation Point icon
</p>
<p>
    REM 256 second button is default.
</p>
<p>
    nDialogType = 3 OR 48 OR 256
</p>
<p>
    nReturnCode = MsgBox(sMessage, nDialogType, "My Title")
</p>
<p>
    If nReturnCode = 2 Then
</p>
<p>
    Print "Stopping the macro now!"
</p>
<p>
    Stop
</p>
<p>
    ElseIf nReturnCode = 6 Then
</p>
<p>
    Print "You chose Yes"
</p>
<p>
    ElseIf nReturnCode = 7 Then
</p>
<p>
    Print "You chose No"
</p>
<p>
    Else
</p>
<p>
    Print "I will never get here!",nReturnCode
</p>
<p>
    End If
</p>
<p>
    Print "Ready to exit the subroutine"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000003CF00000180B7C4091A.gif" style="width:2.4984in;height:0.9839in" />
</p>
<p>
    <strong>Figure .</strong> Fancy MsgBox with an icon and multiple buttons.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="prompting-for-input">
                            <span id="anchor-174"></span>Prompting for input
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the InputBox function to prompt users for input. You can specify the dialog title. If a Default value is
    provided, it’s displayed in the input box. The displayed dialog contains a text-input box, an OK button, and a
    Cancel button. The InputBox function returns a string to the calling statement. Clicking Cancel returns a
    zero-length string.
</p>
<p>
    InputBox(Message)
</p>
<p>
    InputBox(Message, Title)
</p>
<p>
    InputBox(Message, Title, Default)
</p>
<p>
    InputBox(Message, Title, Default, x_pos, y_pos)
</p>
<p>
    The position arguments are in twips and are relative to the upper-left corner of the current window; one inch is
    1440 twips. If the position is not specified, the dialog is centered both horizontally and vertically over the
    current window. The example in displays the input box two inches from the left edge of the window and four inches
    from the top. The size of the InputBox is defined automatically from the Message and buttons; OOo configures the
    layout of this box, as it does for the other basic input and output dialogs.
</p>
<p>
    <strong>Listing .</strong> Demonstrate InputBox.
</p>
<p>
    Sub ExampleInputBox
</p>
<p>
    Dim sReturn As String 'Return value
</p>
<p>
    Dim sMsg As String 'Holds the prompt
</p>
<p>
    Dim sTitle As String 'Window title
</p>
<p>
    Dim sDefault As String 'Default value
</p>
<p>
    Dim nXPos As Integer 'Twips from left edge
</p>
<p>
    Dim nYPos As Integer 'Twips from top edge
</p>
<p>
    nXPos = 1440 * 2 'Two inches from left edge of the window
</p>
<p>
    nYPos = 1440 * 4 'Four inches from top of the window
</p>
<p>
    sMsg = "Please enter some meaningful text"
</p>
<p>
    sTitle = "Meaningful Title"
</p>
<p>
    sDefault = "Hello"
</p>
<p>
    sReturn = InputBox(sMsg, sTitle, sDefault, nXPos, nYPos)
</p>
<p>
    If sReturn &lt;&gt; "" Then
</p>
<p>
    REM Print the entered string surrounded by double quotes
</p>
<p>
    Print "You entered """;sReturn;""""
</p>
<p>
    Else
</p>
<p>
    Print "You either entered an empty string or chose Cancel"
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    shows the dialog when it is first displayed. Pressing any key replaces the default text, because this text is
    highlighted when the dialog first opens. The macro in inspects the return value and checks for a zero-length string.
    A zero-length string could mean that the Cancel button was used to close the dialog, or it could mean that the user
    entered a zero-length string and then used the OK button to close the dialog. These two cases are not
    distinguishable from each other.
</p>
<p>
    <img src="Pictures/1000000000000627000001DB38CBBA2D.png" style="width:5.478in;height:1.5201in" />
</p>
<p>
    <strong>Figure .</strong> InputBox with default text selected.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="error-related-routines">
                    <span id="anchor-175"></span>Error-related routines
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The error-related routines (see ) in OOo Basic return information related to the last error. These routines are used
    to determine what happened and where. The error information is reset when the error handler is cleared, so save the
    error information if your macro program will require it later.
</p>
<p>
    <strong>Table .</strong> Error functions in OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CVErr
            </td>
            <td>
                Convert an expression to an error object.
            </td>
        </tr>
        <tr class="even">
            <td>
                Erl
            </td>
            <td>
                Line number of last error.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Err
            </td>
            <td>
                Error number of last error.
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    Error
                </p>
                <p>
                    Error(error_number)
                </p>
            </td>
            <td>
                Get error message either for the last error or for the specified error message.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in checks for an error before the error handler is reset. Error information is then saved. Although the
    macro in does not save the error message, the Error function accepts an error number as an optional argument for
    which the error message is returned. Also see .
</p>
<p>
    <strong>Listing .</strong> Demonstrate error related statements.
</p>
<p>
    Sub ExampleError
</p>
<p>
    On Error Goto BadError 'Set up the error handler
</p>
<p>
    Print 1/ CInt(0.2) 'Do a division by zero
</p>
<p>
    BadError: 'Error handler starts here
</p>
<p>
    Dim s As String 'Accumulate the message
</p>
<p>
    Dim oldError As Integer 'Save the error number
</p>
<p>
    Dim lineNum As Integer 'Save the line number
</p>
<p>
    If Err &lt;&gt; 0 Then 'If an error occurred
</p>
<p>
    oldError = Err 'Save the error number
</p>
<p>
    lineNum = Erl 'Save the error line number
</p>
<p>
    s = "Before clearing the error handler" &amp; CHR$(10) &amp;_
</p>
<p>
    "Error number " &amp; Err &amp; " Occurred at line number " &amp; Erl &amp; CHR$(10) &amp;_
</p>
<p>
    "Err message: " &amp; Error() &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    On Error Goto 0 'Reset the error handler
</p>
<p>
</p>
<p>
    REM There is now no information to print
</p>
<p>
    s = s &amp; CHR$(10) &amp; "After clearing handler:" &amp; CHR$(10) &amp;_
</p>
<p>
    "Error number " &amp; Err &amp; " Occurred at line number " &amp; Erl &amp; CHR$(10)
</p>
<p>
</p>
<p>
    REM Use the saved information
</p>
<p>
    s = s &amp; CHR$(10) &amp; "Error info was saved so:" &amp; CHR$(10) &amp;_
</p>
<p>
    "Error number " &amp; oldError &amp; " Occurred at line number " &amp;_
</p>
<p>
    lineNum &amp; CHR$(10) &amp; "Err message: " &amp; Error(oldError)
</p>
<p>
    MsgBox s, 0, "Error Handling"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000013E000000DD49789375.png" style="width:3.3126in;height:2.302in" />
</p>
<p>
    <strong>Figure .</strong> Error information must be saved if it is used after resetting the error handler.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="miscellaneous-routines-1">
                    <span id="anchor-176"></span>Miscellaneous routines
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The miscellaneous routines described in this section are general-purpose routines that aren’t necessarily related to
    each other (see ).
</p>
<p>
    <strong>Table .</strong> Miscellaneous functions in OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Beep
            </td>
            <td>
                Make a system-dependent beep.
            </td>
        </tr>
        <tr class="even">
            <td>
                CBool(expression)
            </td>
            <td>
                Convert an integer or string to Boolean.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Environ(string)
            </td>
            <td>
                Return an environment variable.
            </td>
        </tr>
        <tr class="even">
            <td>
                GetSolarVersion
            </td>
            <td>
                Internal running version.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CreateObject(obj_type)
            </td>
            <td>
                Dynamic version of “Dim As New”.
            </td>
        </tr>
        <tr class="even">
            <td>
                Erase(obj)
            </td>
            <td>
                Free an objects memory.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The Beep statement generates a system-dependent beep. You can’t change the pitch or the length of the generated
    beep. On some systems, this plays a configurable sound file through the built-in speaker, and on others it generates
    a system event that plays a system-defined sound through low-level internal hardware.
</p>
<p>
    Beep 'Generate a noise
</p>
<p>
    Wait(500) 'Wait 1/2 second
</p>
<p>
    Beep 'Generate a noise
</p>
<p>
    Use the CBool function to convert a string or a number to a Boolean value. Any numeric expression that evaluates to
    0 returns False. Numeric expressions that are not 0 return True. String expressions that evaluate to “True” or
    “False” return True or False respectively; case does not matter. A string that does not evaluate exactly to True or
    False is evaluated as a number. If the string doesn’t contain a number or the text “true” or “false”, a run-time
    error occurs.
</p>
<p>
    Print CBool(False) 'False
</p>
<p>
    Print CBool(13) 'True
</p>
<p>
    Print CBool("13") 'True
</p>
<p>
    Print CBool("trUe") 'True
</p>
<p>
    Print CBool("&amp;h1") 'True
</p>
<p>
    Print CBool("13xx") 'run-time error
</p>
<p>
    Print Cbool("Truee") 'run-time error
</p>
<p>
    Use the Environ function to retrieve environment variables. If the environment variable does not exist, an empty
    string is returned. No method is provided to set or change environment variables.
</p>
<p>
    Print Environ("PATH")
</p>
<p>
    Print Environ("TEMP")
</p>
<p>
    Use getSolarVersion to obtain the integer internal build number of OOo. You can write your macro to work around
    known issues, based on release documentation or discovered bugs for different versions of OOo.
</p>
<p>
    Print GetSolarVersion
</p>
<p>
    The CreateObject function allows objects to be created dynamically. If an object can be created using “Dim v As
    New”, it can be created with the CreateObject function. In other words, if an object can be created as a
    user-defined type, CreateObject can create one. The OOo underlying special data objects, which are covered in depth
    later, are called Universal Network Objects (UNO). These objects cannot be created using CreateObject. OOo does
    define structures that are not UNO objects that can be created using Dim As New and CreateObject (see ).
</p>
<p>
    <strong>Listing .</strong> Create an object using CreateObject or Dim As New.
</p>
<p>
    Dim oProp As New com.sun.star.beans.PropertyValue
</p>
<p>
    Dim o As Object
</p>
<p>
    o = CreateObject("com.sun.star.beans.PropertyValue")
</p>
<p>
    demonstrates creating a variable type defined by OOo that is like a user-defined type. The actual type name of the
    object is “com.sun.star.beans.PropertyValue”. Many of the objects in OOo have similarly long and cumbersome names.
    While writing about or discussing variable types such as this, it’s common to abbreviate the type name as the last
    portion of the name. For example, set the Name property of the PropertyValue variable (see ). Objects of type
    PropertyValue have two properties: Name as a String and Value as a Variant.
</p>
<p>
    <strong>Listing .</strong> Dim a PropertyValue and use CreateObject to create a new one.
</p>
<p>
    Dim aProp As New com.sun.star.beans.PropertyValue
</p>
<p>
    aProp.Name = "FirstName" 'Set the Name property
</p>
<p>
    aProp.Value = "Paterton" 'Set the Value property
</p>
<p>
    Erase aProp
</p>
<p>
    Print IsNull(aProp) 'True
</p>
<p>
    REM Create a new one!
</p>
<p>
    Dim aPropr
</p>
<p>
    aPropr = CreateObject("com.sun.star.beans.PropertyValue")
</p>
<p>
    Erase aProp
</p>
<p>
    Print IsNull(aProp) 'True
</p>
<p>
    Print IsEmpty(aProp) 'False
</p>
<p>
    Dim a
</p>
<p>
    a = array("hello", 2)
</p>
<p>
    Erase a
</p>
<p>
    Print IsNull(a) 'False
</p>
<p>
    Print IsEmpty(a) 'True
</p>
<p>
    Dim b() As String
</p>
<p>
    ReDim b(0 To 1) As String
</p>
<p>
    b(0) = "Hello" : b(1) = "You"
</p>
<p>
    'b() = "hello" 'Runtime error, variable not set (Expected)
</p>
<p>
    'Print b() 'Runtime error, variable not set (Expected)
</p>
<p>
    'Erase b() 'Syntax Error, not too surprised
</p>
<p>
    Erase b 'I did not expect this to work.
</p>
<p>
    Print IsNull(b()) 'False
</p>
<p>
    Print IsEmpty(b()) 'False
</p>
<p>
    Print IsArray(b()) 'False, This is probably bad.
</p>
<p>
    'Print LBound(b()) 'Error, variable not set.
</p>
<p>
    b() = "hello" 'Odd, now I can treat b() as a string variable
</p>
<p>
    Print b() 'hello
</p>
<p>
    demonstrates the Erase statement, introduced with OOo version 2.0. Use the Erase statement to free memory that will
    no longer be used. Do not use Erase unless you are finished with the variable.
</p>
<p>
    Use the CreateObject function to create an object dynamically — in other words, when you don’t want to create the
    object when it’s declared. You can use CreateObject to create only one object at a time. Use the Dim As New
    construction to create an array of a particular type (see ). You can even change the dimension of the array and
    preserve the data. It is more cumbersome to declare an array and then fill it with the appropriate values
    individually (see ).
</p>
<p>
    <strong>Listing .</strong> Demonstrate ReDim with Preserve
</p>
<p>
    Sub ExampleReDimPreserveProp
</p>
<p>
    REM this is easy to create this way
</p>
<p>
    Dim oProps(2) As New com.sun.star.beans.PropertyValue
</p>
<p>
    oProps(0).Name = "FirstName" : oProps(0).Value = "Joe"
</p>
<p>
    oProps(1).Name = "LastName" : oProps(1).Value = "Blather"
</p>
<p>
    oProps(2).Name = "Age" : oProps(1).Value = 53
</p>
<p>
    ReDim Preserve oProps(3) As New com.sun.star.beans.PropertyValue
</p>
<p>
    oProps(3).Name = "Weight" : oProps(3).value = 97
</p>
<p>
    Print oProps(2).Name 'Age
</p>
<p>
    End Sub
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> You can add PropertyValue variables to
    a declared array.
</p>
<p>
    REM This is more cumbersome, but you can still do it...
</p>
<p>
    Dim oProps(2)
</p>
<p>
    oProps(0) = CreateObject("com.sun.star.beans.PropertyValue")
</p>
<p>
    oProps(1) = CreateObject("com.sun.star.beans.PropertyValue")
</p>
<p>
    oProps(2) = CreateObject("com.sun.star.beans.PropertyValue")
</p>
<p>
    oProps(0).Name = "FirstName" : oProps(0).Value = "Joe"
</p>
<p>
    oProps(1).Name = "LastName" : oProps(1).Value = "Blather"
</p>
<p>
    oProps(2).Name = "Age" : oProps(1).Value = 53
</p>
<p>
    Assigning one array to another assigns a reference so that both arrays reference the same array object. With
    variable types such as Integer and PropertyValue, assignment makes a copy. Failure to understand which types copy by
    value and which types copy by reference is a common source of errors. Structures and integral types (such as Integer
    and String) copy as a value, but arrays and UNO variables, as will be discussed later, copy as a reference. Copying
    by value is demonstrated in an obvious way in .
</p>
<p>
    <strong>Listing .</strong> Properties copy by value.
</p>
<p>
    Sub ExampleCopyAsValue
</p>
<p>
    Dim aProp1
</p>
<p>
    Dim aProp2
</p>
<p>
    aProp1 = CreateObject("com.sun.star.beans.PropertyValue")
</p>
<p>
    aProp1.Name = "Age" 'Set Name Property on one
</p>
<p>
    aProp1.Value = 27 'Set Value Property on one
</p>
<p>
    aProp2 = aProp1 'Make a copy
</p>
<p>
    aProp2.Name = "Weight"'Set Name Property on two
</p>
<p>
    aProp2.Value = 97 'Set Value Property on two
</p>
<p>
    Print aProp1.Name, aProp2.Name 'Age Weight
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Standard object variables copy by value, and UNO variables copy by reference.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When one integer variable is assigned to another, it is understood that the value was copied and nothing more. The
    two variables are still independent of each other. This is also true for structures. Text cursors, discussed later,
    contain a property called CharLocale, which specifies the country and language for the text selected by the text
    cursor. The common, incorrect method to set the locale is to access the variable directly. This sets the language
    and country on a copy of the CharLocale property rather than on the copy used by the text cursor. I see this type of
    error often.
</p>
<p>
    oCursor.CharLocale.Language = "fr" 'set language to French on a copy
</p>
<p>
    oCursor.CharLocale.Country = "CH" 'set country to Switzerland on a copy
</p>
<p>
    One correct method to set the locale is to create a new Locale structure, modify the new structure, and copy the new
    structure to the text cursor.
</p>
<p>
    Dim aLocale As New com.sun.star.lang.Locale
</p>
<p>
    aLocale.Language = "fr" 'Set Locale to use the French language
</p>
<p>
    aLocale.Country = "CH" 'Set Locale to use Switzerland as the country
</p>
<p>
    oCursor.CharLocale = aLocale 'Assign the value back
</p>
<p>
    You can also obtain a copy of the structure, modify the copied structure, and copy the modified structure to the
    text cursor.
</p>
<p>
    Dim aLocale
</p>
<p>
    aLocale = oCursor.CharLocale 'Or use a copy
</p>
<p>
    aLocale.Language = "fr" 'Set Locale to use the French language
</p>
<p>
    aLocale.Country = "CH" 'Set Locale to use Switzerland as the country
</p>
<p>
    oCursor.CharLocale = aLocale 'Assign the value back
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="partition">
                    <span id="anchor-177"></span>Partition
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Partition is not documented and was likely added for VB compatibility. Partition return a Variant (String)
    indicating where a number occurs in a calculated series of ranges.
</p>
<p>
    Partition(number, start_value, stop_value, interval)
</p>
<p>
    Consider the following values:
</p>
<p>
    start_value = 0
</p>
<p>
    stop_value = 17
</p>
<p>
    interval = 5
</p>
<p>
    The following “partitions” are assumed:
</p>
<ol type="1">
    <li>
        “ :-1” Everything before 0
    </li>
    <li>
        “0:4” Five numbers from 0 to 4.
    </li>
    <li>
        “5:9” Five numbers from 5 to 9.
    </li>
    <li>
        “10:14” Five numbers from 10 to 14.
    </li>
    <li>
        “15:17” Three numbers from 15 to 17.
    </li>
    <li>
        “18: ” Everything after 17.
    </li>
</ol>
<p>
    The example in tests numbers before and after the interval. As expected, values before the first interval run from “
    :-1”. Values that fall into an interval are nicely identified. The only tricky part is that the final interval
    claims to include values from “15:19” even though 18 and 19 are not in the interval.
</p>
<p>
    <strong>Listing .</strong> Run partition through a series of values.
</p>
<p>
    Sub ExamplePartition
</p>
<p>
    Dim i%
</p>
<p>
    Dim s$
</p>
<p>
    For i = -2 To 20
</p>
<p>
    s = s &amp; "Partition(" &amp; i &amp; ", 0, 17, 5) = " &amp; _
</p>
<p>
    Partition(i, 0, 17, 5) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000D8000001A0A556B3F2.png" style="width:2.25in;height:4.3335in" />
</p>
<p>
    <strong>Figure .</strong> Partition shows the interval containing a number.
</p>
<p>
    The values returned by Partition are carefully formatted. The lower value and upper value have the same number of
    characters, which means that they will sort properly if you choose to do so. This also helps if you want to parse
    the returned values.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="inspection-and-identification-of-variables">
                    <span id="anchor-178"></span>Inspection and identification of variables
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic contains numerous functions to inspect and identify variables (see ). These routines are frequently used
    when you call a function and aren’t certain of the return type. These routines are also useful for debugging. For
    example, you could use these functions to verify that a return type is valid.
</p>
<p>
    <strong>Table .</strong> Variable inspection functions in OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                IsArray
            </td>
            <td>
                Is the variable an array?
            </td>
        </tr>
        <tr class="even">
            <td>
                IsDate
            </td>
            <td>
                Does the string contain a valid date?
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsEmpty
            </td>
            <td>
                Is the variable an empty Variant variable?
            </td>
        </tr>
        <tr class="even">
            <td>
                IsMissing
            </td>
            <td>
                Is the variable a missing argument?
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsNull
            </td>
            <td>
                Is the variable an unassigned object?
            </td>
        </tr>
        <tr class="even">
            <td>
                IsNumeric
            </td>
            <td>
                Does the string contain a valid number?
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsObject
            </td>
            <td>
                Is the variable an object?
            </td>
        </tr>
        <tr class="even">
            <td>
                IsUnoStruct
            </td>
            <td>
                Is the variable a UNO structure?
            </td>
        </tr>
        <tr class="odd">
            <td>
                TypeLen
            </td>
            <td>
                Space used by the variable type.
            </td>
        </tr>
        <tr class="even">
            <td>
                TypeName
            </td>
            <td>
                Return the type name of the object as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                VarType
            </td>
            <td>
                Return the variable type as an Integer.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use IsArray to see if a variable is an array (see ). If IsArray returns True, it does not imply that the variable
    has data or even that it is dimensioned<em><em> — </em></em>merely that it exists and is defined as an array. The
    UBound and LBound functions, as already discussed, return the upper and lower bounds of the array.
</p>
<p>
    <strong>Listing .</strong> Use IsArray to see if a variable is an array.
</p>
<p>
    Dim n As Long 'This is NOT an array
</p>
<p>
    Dim a() As String 'This is an array
</p>
<p>
    Dim b(5) 'This is an array
</p>
<p>
    Dim v As Variant 'This is not an array yet
</p>
<p>
    Print IsArray(v) 'False
</p>
<p>
    Print IsArray(n) 'False
</p>
<p>
    Print IsArray(a) 'True
</p>
<p>
    Print IsArray(b()) 'True
</p>
<p>
    ReDim v(3) 'It is an array now!
</p>
<p>
    Print IsArray(v()) 'True
</p>
<p>
    Use the IsDate function to test if a string contains a valid date (see ). The arguments are converted to a string
    before they are used, so numeric arguments return False. The IsDate function tests more than just syntax; it checks
    to see if the string contains a valid date. The same check is not made on the time component of the string.
</p>
<p>
    <strong>Listing .</strong> IsDate verifies that a string contains a valid date.
</p>
<p>
    Print IsDate("December 1, 1582 2:13:42") 'True
</p>
<p>
    Print IsDate("2:13:42") 'True
</p>
<p>
    Print IsDate("12/1/1582") 'True
</p>
<p>
    Print IsDate(Now) 'True
</p>
<p>
    Print IsDate("26:61:112") 'True
</p>
<p>
    Print IsDate(True) 'False converts to string first
</p>
<p>
    Print IsDate(32686.22332) 'False converts to string first
</p>
<p>
    Print IsDate("02/29/2003") 'False, only 28 days in February 2003
</p>
<p>
    Like the IsDate function, the IsNumeric function looks at strings (see ). If the argument is not entirely a solitary
    valid number, except for leading or trailing spaces and enclosing quotation marks, it returns False.
</p>
<p>
    <strong>Listing .</strong> IsNumeric is very picky about what it accepts.
</p>
<p>
    Print IsNumeric(" 123") 'True
</p>
<p>
    Print IsNumeric(" 12 3") 'False
</p>
<p>
    Print IsNumeric(1.23) 'True
</p>
<p>
    Print IsNumeric(1,23) 'True
</p>
<p>
    Print IsNumeric("123abc") 'False
</p>
<p>
    Print IsNumeric(True) 'False
</p>
<p>
    Print IsNumeric(Now) 'False
</p>
<p>
    Variant variables start with no value at all; they are initially empty. Object variables are initialized with the
    value null. Use the functions IsEmpty and IsNull to test these conditions. Use the IsObject function to determine if
    a variable is an object.
</p>
<p>
    Dim v As Variant 'Starts as not initialized, Empty
</p>
<p>
    Dim o As Object 'Initialized to null
</p>
<p>
    Print IsObject(v) 'False No, a Variant is not an Object
</p>
<p>
    Print IsObject(o) 'True Yes, this is an Object
</p>
<p>
    Print IsEmpty(v) 'True Variants start as Empty, not initialized
</p>
<p>
    Print IsNull(v) 'False To be null, a Variant must contain something
</p>
<p>
    Print IsEmpty(o) 'False Variants start as Empty, not Objects
</p>
<p>
    Print IsNull(o) 'True Objects start as null
</p>
<p>
    v = o
</p>
<p>
    Print IsObject(v) 'True The variant just became an Object.
</p>
<p>
    Print IsEmpty(v) 'False Variant now contains a value (an Object)
</p>
<p>
    Print IsNull(v) 'True Variant contains a null Object
</p>
<p>
    Use the IsMissing function to determine if an optional argument is missing. Usually, some default value is used if
    an argument is missing.
</p>
<p>
    Sub TestOptional
</p>
<p>
    Print "Arg is ";ExampleOptional() 'Arg is missing
</p>
<p>
    Print "Arg is ";ExampleOptional("hello") 'Arg is hello
</p>
<p>
    End Sub
</p>
<p>
    Function ExampleOptional(Optional x) As String
</p>
<p>
    ExampleOptional = IIF(IsMissing(x), "Missing", CStr(x))
</p>
<p>
    End Function
</p>
<p>
    Use the function IsUnoStruct to determine if a variable contains a structure defined by OpenOffice.org.
</p>
<p>
    Dim v
</p>
<p>
    Print IsUnoStruct(v) 'False
</p>
<p>
    v = CreateUnoStruct("com.sun.star.beans.Property") 'Create a UNO
</p>
<p>
    Print IsUnoStruct(v) 'True
</p>
<p>
    Use the TypeName function for a string representation of the variable’s type. The VarType function returns an
    integer corresponding to the variable type. contains a list of the possible types. The first column, labeled BASIC,
    indicates if the type is common to BASIC and therefore likely to be seen. The other values represent types that are
    internal to OOo. OOo Basic typically maps internal types to standard OOo Basic types, so you aren’t likely to see
    these other types. They are, however, contained in the source code and they are included for completeness.
</p>
<p>
    <strong>Table .</strong> Variable types and names.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                yes
            </td>
            <td>
                0
            </td>
            <td>
                Empty
            </td>
            <td>
                0
            </td>
            <td>
                Variant variable is not initialized
            </td>
        </tr>
        <tr class="even">
            <td>
                yes
            </td>
            <td>
                1
            </td>
            <td>
                Null
            </td>
            <td>
                0
            </td>
            <td>
                No valid data in an Object variable
            </td>
        </tr>
        <tr class="odd">
            <td>
                yes
            </td>
            <td>
                2
            </td>
            <td>
                Integer
            </td>
            <td>
                2
            </td>
            <td>
                Integer variable
            </td>
        </tr>
        <tr class="even">
            <td>
                yes
            </td>
            <td>
                3
            </td>
            <td>
                Long
            </td>
            <td>
                4
            </td>
            <td>
                Long Integer variable
            </td>
        </tr>
        <tr class="odd">
            <td>
                yes
            </td>
            <td>
                4
            </td>
            <td>
                Single
            </td>
            <td>
                4
            </td>
            <td>
                Single floating-point variable
            </td>
        </tr>
        <tr class="even">
            <td>
                yes
            </td>
            <td>
                5
            </td>
            <td>
                Double
            </td>
            <td>
                8
            </td>
            <td>
                Double floating-point variable
            </td>
        </tr>
        <tr class="odd">
            <td>
                yes
            </td>
            <td>
                6
            </td>
            <td>
                Currency
            </td>
            <td>
                8
            </td>
            <td>
                Currency variable
            </td>
        </tr>
        <tr class="even">
            <td>
                yes
            </td>
            <td>
                7
            </td>
            <td>
                Date
            </td>
            <td>
                8
            </td>
            <td>
                Date variable
            </td>
        </tr>
        <tr class="odd">
            <td>
                yes
            </td>
            <td>
                8
            </td>
            <td>
                String
            </td>
            <td>
                strlen
            </td>
            <td>
                String variable
            </td>
        </tr>
        <tr class="even">
            <td>
                yes
            </td>
            <td>
                9
            </td>
            <td>
                Object
            </td>
            <td>
                0
            </td>
            <td>
                Object variable
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                10
            </td>
            <td>
                Error
            </td>
            <td>
                2
            </td>
            <td>
                Internal OOo type
            </td>
        </tr>
        <tr class="even">
            <td>
                yes
            </td>
            <td>
                11
            </td>
            <td>
                Boolean
            </td>
            <td>
                1
            </td>
            <td>
                Boolean variable
            </td>
        </tr>
        <tr class="odd">
            <td>
                yes
            </td>
            <td>
                12
            </td>
            <td>
                Variant
            </td>
            <td>
                0
            </td>
            <td>
                Variant variables act like any type
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                13
            </td>
            <td>
                DataObject
            </td>
            <td>
                0
            </td>
            <td>
                Internal OOo type
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                14
            </td>
            <td>
                Unknown Type
            </td>
            <td>
                0
            </td>
            <td>
                Internal OOo type
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                15
            </td>
            <td>
                Unknown Type
            </td>
            <td>
                0
            </td>
            <td>
                Internal OOo type
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                16
            </td>
            <td>
                Char
            </td>
            <td>
                1
            </td>
            <td>
                Internal OOo type, a single text character
            </td>
        </tr>
        <tr class="even">
            <td>
                yes
            </td>
            <td>
                17
            </td>
            <td>
                Byte
            </td>
            <td>
                1
            </td>
            <td>
                Internal OOo type, but you can use CByte to create one
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                18
            </td>
            <td>
                UShort
            </td>
            <td>
                2
            </td>
            <td>
                Internal OOo type, unsigned short integer (16 bits)
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                19
            </td>
            <td>
                ULong
            </td>
            <td>
                4
            </td>
            <td>
                Internal OOo type, unsigned long (32 bits)
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                20
            </td>
            <td>
                Long64
            </td>
            <td>
                8
            </td>
            <td>
                Internal OOo type, long (64 bits)
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                21
            </td>
            <td>
                ULong64
            </td>
            <td>
                8
            </td>
            <td>
                Internal OOo type, unsigned long (64 bits)
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                22
            </td>
            <td>
                Int
            </td>
            <td>
                2
            </td>
            <td>
                Internal OOo type, integer (16 bits)
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                23
            </td>
            <td>
                UInt
            </td>
            <td>
                2
            </td>
            <td>
                Internal OOo type, unsigned integer (16 bits)
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                24
            </td>
            <td>
                Void
            </td>
            <td>
                0
            </td>
            <td>
                Internal OOo type, no value
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                25
            </td>
            <td>
                HResult
            </td>
            <td>
                0
            </td>
            <td>
                Internal OOo type
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                26
            </td>
            <td>
                Pointer
            </td>
            <td>
                0
            </td>
            <td>
                Internal OOo type, pointer to something
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                27
            </td>
            <td>
                DimArray
            </td>
            <td>
                0
            </td>
            <td>
                Internal OOo type
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                28
            </td>
            <td>
                CArray
            </td>
            <td>
                0
            </td>
            <td>
                Internal OOo type
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                29
            </td>
            <td>
                Userdef
            </td>
            <td>
                0
            </td>
            <td>
                Internal OOo type, user-defined
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                30
            </td>
            <td>
                Lpstr
            </td>
            <td>
                strlen
            </td>
            <td>
                Internal OOo type, long pointer to a string
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                31
            </td>
            <td>
                Lpwstr
            </td>
            <td>
                strlen
            </td>
            <td>
                Internal OOo type, long pointer to a “Wide” Unicode string
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                32
            </td>
            <td>
                Unknown Type
            </td>
            <td>
                0
            </td>
            <td>
                Internal core string type
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                33
            </td>
            <td>
                WString
            </td>
            <td>
                strlen
            </td>
            <td>
                Internal OOo type, “Wide” Unicode string
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                34
            </td>
            <td>
                WChar
            </td>
            <td>
                2
            </td>
            <td>
                Internal OOo type, “Wide” Unicode character
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                35
            </td>
            <td>
                Int64
            </td>
            <td>
                8
            </td>
            <td>
                Internal OOo type, integer (64 bits)
            </td>
        </tr>
        <tr class="odd">
            <td>
                no
            </td>
            <td>
                36
            </td>
            <td>
                UInt64
            </td>
            <td>
                8
            </td>
            <td>
                Internal OOo type, unsigned integer (64 bits)
            </td>
        </tr>
        <tr class="even">
            <td>
                no
            </td>
            <td>
                37
            </td>
            <td>
                Decimal
            </td>
            <td>
            </td>
            <td>
                OLE Automation type available in VB.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the TypeLen function to determine how many bytes a variable uses. The returned value is hard coded for every
    value except for the strings, which return the length of the string. Array variables always return a length of zero.
    The macro in generates all of the standard BASIC types, places them into an array, and builds a string containing
    the type, length, and type name, as shown in .
</p>
<p>
    <strong>Listing .</strong> Show type information for standard types.
</p>
<p>
    Sub ExampleTypes
</p>
<p>
    Dim b As Boolean
</p>
<p>
    Dim c As Currency
</p>
<p>
    Dim t As Date
</p>
<p>
    Dim d As Double
</p>
<p>
    Dim i As Integer
</p>
<p>
    Dim l As Long
</p>
<p>
    Dim o As Object
</p>
<p>
    Dim f As Single
</p>
<p>
    Dim s As String
</p>
<p>
    Dim v As Variant
</p>
<p>
    Dim n As Variant
</p>
<p>
    Dim ta()
</p>
<p>
    Dim ss$
</p>
<p>
    n = null
</p>
<p>
    ta() = Array(v, n, i, l, f, d, c, t, s, o, b, CByte(3) _
</p>
<p>
    CreateUnoValue("unsigned long", 10)))
</p>
<p>
    For i = LBound(ta()) To UBound(ta())
</p>
<p>
    ss = ss &amp; ADPTypeString(ta(i))
</p>
<p>
    Next
</p>
<p>
    MsgBox ss, 0, "Type, Length, and Name"
</p>
<p>
    End Sub
</p>
<p>
    Function ADPTypeString(v) As String
</p>
<p>
    Dim s As String 'Hold the return string
</p>
<p>
    Dim i As Integer 'Dummy integer value
</p>
<p>
    s = s &amp; "Type = " 'Leading type string
</p>
<p>
    i = VarType(v) 'Get the type
</p>
<p>
    If i &lt; 10 Then s = S &amp; "0" 'Leading zero if required
</p>
<p>
    s = s &amp; CStr(i) 'Add the type number
</p>
<p>
    If IsArray(v) Then
</p>
<p>
    s = s &amp; " ("
</p>
<p>
    i = i AND NOT 8192
</p>
<p>
    If i &lt; 10 Then s = S &amp; "0" 'Leading zero if required
</p>
<p>
    s = s &amp; CStr(i) &amp; ")" 'Add the type number
</p>
<p>
    Else
</p>
<p>
    s = s &amp; " Len = " 'Leading length string
</p>
<p>
    i = TypeLen(v) 'What is the length
</p>
<p>
    If i &lt; 10 Then s = S &amp; "0" 'Leading zero if required
</p>
<p>
    s = s &amp; CStr(i) 'Add in the length
</p>
<p>
    End If
</p>
<p>
    s = s &amp; " Name = " 'Leading Name string
</p>
<p>
    s = s &amp; TypeName(v)&amp; CHR$(10)'Add in the name and a new-line character
</p>
<p>
    ADPTypeString = s 'Return value for the function
</p>
<p>
    End Function
</p>
<p>
    <img src="Pictures/100000000000011D0000010A89F435E4.png" style="width:2.9689in;height:2.7709in" />
</p>
<p>
    <strong>Figure .</strong> Variable types, lengths, and names.
</p>
<p>
    The function ADPTypeString does the work of generating the display string. It gives special handling to arrays,
    because the returned type numbers for arrays are completely different than the type numbers for the standard
    variables. At least they seem that way until you start looking very closely at the numbers. If the thought of
    twiddling bits makes you tremble, skip the rest of this paragraph. The value returned by VarType for an array always
    has bit 14 set<em><em> — </em></em>a 1 followed by 13 zeros in binary. This is 8192 in decimal and 2000 in
    hexadecimal. The IsArray function is implemented by checking bit 14 of the VarType. If you clear bit 14, the number
    that remains tells you what numeric type is used for the array. The NOT operator clears every bit that is set and
    sets every bit that is clear, so NOT 8192 provides the number with every bit set except for bit 14. If you AND this
    with the type, it clears bit 14, leaving the rest of the bits intact.
</p>
<p>
    i = i AND NOT 8192
</p>
<p>
    The length of an array is always returned as zero, so I didn’t include this by VarType in . The code in is similar
    to but the types are arrays. Notice that the type name for array types contains parentheses “()” following the name
    (see ).
</p>
<p>
    <strong>Listing .</strong> Show type information for arrays.
</p>
<p>
    Sub ExampleTypesArray
</p>
<p>
    Dim b() As Boolean
</p>
<p>
    Dim c() As Currency
</p>
<p>
    Dim t() As Date
</p>
<p>
    Dim d() As Double
</p>
<p>
    Dim i() As Integer
</p>
<p>
    Dim l() As Long
</p>
<p>
    Dim o() As Object
</p>
<p>
    Dim f() As Single
</p>
<p>
    Dim s() As String
</p>
<p>
    Dim v() As Variant
</p>
<p>
    Dim ta(), j%
</p>
<p>
    Dim ss$
</p>
<p>
    ta() = Array(i, l, f, d, c, t, s, o, b, v)
</p>
<p>
    For j% = LBound(ta()) To UBound(ta())
</p>
<p>
    ss = ss &amp; ADPTypeString(ta(j%))
</p>
<p>
    Next
</p>
<p>
    MsgBox ss, 0, "Type, Length, and Name"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000010F000000DD6A0EE5A1.png" style="width:2.8228in;height:2.302in" />
</p>
<p>
    <strong>Figure .</strong> Types, lengths, and names for array variables.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="routines-you-should-not-use-and-other-curiosities">
                    <span id="anchor-179"></span>Routines you should not use and other curiosities
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    I first heard my good friend Manfred say that “the book that is forbidden to read turns one reader into three.” Do
    not apply this logic to the routines outlined in this section. These routines are not officially documented; even if
    they work now, they may stop working in the near future. Deprecated routines may still exist and they may work. They
    may also be removed at any time. Empty stubs exist, compile, and run, but do nothing. You may find older code that
    uses these legacy functions (see ). I include CDec in the list because it is only listed on the Windows platform,
    which is just plain silly.
</p>
<p>
    <strong>Table .</strong> Deprecated and questionable routines.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                AboutStarBasic
            </td>
            <td>
                Deprecated empty stub that used to be an information dialog.
            </td>
        </tr>
        <tr class="even">
            <td>
                SendKeys
            </td>
            <td>
                Deprecated, generates an error.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DumpAllObjects(path, bool)
            </td>
            <td>
                Internal debugging routine; no typical use known.
            </td>
        </tr>
        <tr class="even">
            <td>
                Load(Object)
            </td>
            <td>
                Deprecated.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Unload(Object)
            </td>
            <td>
                Deprecated.
            </td>
        </tr>
        <tr class="even">
            <td>
                LoadPicture(path)
            </td>
            <td>
                Deprecated. Loads an image file.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SavePicture(obj, path)
            </td>
            <td>
                Deprecated. Fails to save an image file.
            </td>
        </tr>
        <tr class="even">
            <td>
                CreatePropertySet(object)
            </td>
            <td>
                Deprecated. Early UNO support function.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CDec(expression)
            </td>
            <td>
                Generate a Decimal type; only implemented on Windows.
            </td>
        </tr>
        <tr class="even">
            <td>
                GetGUIVersion()
            </td>
            <td>
                Deprecated, returns -1.
            </td>
        </tr>
    </tbody>
</table>
<p>
    DumpAllObjects is an internal debugging routine that accepts two arguments. The first argument is a file name that
    will contain the text output. The second argument is a Boolean value that determines if each object should be fully
    loaded before it is dumped. For performance reasons, some properties are not created until they are accessed for the
    first time. This is true, even for BASIC objects that wrap UNO objects.
</p>
<p>
    DumpAllObjects("C:\foo.txt", true) 'Fully load all objects before dumping
</p>
<p>
    The LoadPicture and SavePicture routines refer to the old BASIC dialogs that are not implemented using UNO. The
    object returned by LoadPicture was used to set a picture on an image control. There is now an image control that
    uses the UNO API to set the picture.
</p>
<p>
    Dim v
</p>
<p>
    v = LoadPicture("C:\test1.jpg") 'This seems to load the picture
</p>
<p>
    SavePicture(v, "C:\test2.jpg") 'This writes a zero length file
</p>
<p>
    The CreatePropertySet function accepts an object as an argument and returns a property set. The property set is
    empty and not very useful. This function was created when the UNO functionality was first introduced, and will be
    removed from the source code in the future. If you find code that uses this function, I recommend that you change
    it.
</p>
<p>
    v = CreatePropertySet(ThisComponent.Text)
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="routines-i-do-not-understand">
                    <span id="anchor-180"></span>Routines I do not understand
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    I find functions by reading the source code, some I understand and some I do not. This section contains the
    functions that I have not been able to satisfactorily document.
</p>
<p>
    <strong>Table .</strong> Functions I do not fully understand.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                EnableReschedule(bool)
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                Me
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                RTL
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                GetDialogZoomFactorX()
            </td>
            <td>
                The factor by which a dialog is scaled in the X direction. Used while determining how to scale an image
                for preview.
            </td>
        </tr>
        <tr class="odd">
            <td>
                GetDialogZoomFactorY()
            </td>
            <td>
                The factor by which a dialog is scaled in the Y direction.
            </td>
        </tr>
    </tbody>
</table>
<p>
    EnableReschedule accepts a boolean argument. I have found neither usage nor documentation for this method, so, I
    have only speculation as to its purpose. I speculate that OOo sometimes reschedules things, perhaps events, and that
    sometimes rescheduling should not be allowed; say during a callback. Use EnableReschedule to enable, or disable, the
    internal reschedule flag. It is problematic that there is no method to determine the current state, so you cannot
    set it and then restore it. It appears, however, that the default state is enabled.
</p>
<p>
    Me is available in the .Net world to reference the class or structure in which the code is executing. It is not
    clear to me how to generate a valid call using Me at this point. If Me is not used in the correct context, an error
    occurs.
</p>
<p>
    RTL appears to return a reference of the run time library, but, I am not clear on this point. My guess is that if I
    could use this, then I might be able to do things such as access methods of the RTL and call them; but that is a
    wild guess.
</p>
<p>
    GetDialogZoomFactorX and GetDialogZoomFactorY appear to be used to determine the scale factor to use so that a
    preview image will be properly displayed. In the very few examples that I have found, I always see code similar to
    the following:
</p>
<p>
    widthToUse = GetDialogZoomFactorX(imageWidth) * imageWidth
</p>
<p>
    heightToUse = GetDialogZoomFactorY(imageHeight) * imageHeight
</p>
<p>
    Brush up on your German and then read this: <a
        href="http://www.herger.net/staroffice/sbinteam/os/preview2.htm">http://www.herger.net/staroffice/sbinteam/os/preview2.htm</a>.
    It is my opinion that you probably do not require these methods, but, I could be wrong.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-7">
                    <span id="anchor-181"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    This chapter contains a lot of subtle information. If you are using OOo Basic for the first time, consider reading
    the chapter again after you have more experience. The routines for inspecting variables are useful while evaluating
    returned objects. Knowledge of twips is required while trying to determine spacing and image sizes. Be certain to
    watch for deprecated routines so that can avoid using them.
</p>
<ol type="1">
    <li>
        <h1 id="universal-network-objects">
            <span id="anchor-182"></span><span id="anchor-39"></span>Universal Network Objects
        </h1>
    </li>
</ol>
<p>
    The internals of OpenOffice.org are based on Universal Network Objects (UNO). This chapter introduces the
    subroutines and functions supported by OpenOffice.org Basic that are related to UNO. This chapter covers methods
    that create and inspect objects that are vital to the internals of OpenOffice.org.
</p>
<p>
    Up to this point, I have mostly dealt with simple single value things such as string and integer. An object,
    however, usually contains many values and it also has methods; for example, you can access a document as a variable
    and access information about the document (data or properties), and call methods that manipulate the document.
</p>
<p>
    In this chapter, I begin to discuss things related to the actual implementation of OOo<em><em> — </em></em>things
    that allow you to exploit the internal capabilities of OOo. You’ll also begin to see more details about how OOo is
    implemented<em><em> — </em></em>which you need to build the really cool stuff.
</p>
<p>
    Are you a programmer or a highly technical person? If not, skip this paragraph and go directly to the tip. Still
    reading? Great, so UNO is:
</p>
<ul>
    <li>
        The interface based component model for OOo.
    </li>
    <li>
        Enables interoperability between programming languages, object models and hardware architectures, either in
        process or over process boundaries, as well as in the intranet or the Internet.
    </li>
    <li>
        New languages are supported by adding a language binding. This is also stated as adding a “bridge” or “adapter”.
        This paradigm makes it easier to support multiple languages.
    </li>
    <li>
        UNO components may be implemented in, and accessed from, any programming language with a complete language
        binding.
    </li>
</ul>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                You can write powerful macros without fully understand Universal Network Objects. Just think of a UNO as
                any object that is used internally by OOo.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Stated more simply: The internal parts of OOo are used as Universal Network Objects. By using UNOs, it is possible
    to access an instance of OOo running on a different computer and operating system. A vague understanding of
    Universal Network Objects is important because most of the internals of OpenOffice.org are implemented using UNO.
</p>
<p>
    lists the OOo Basic functions used to deal with UNO.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Functions related to Universal Network
    Objects in OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BasicLibraries
            </td>
            <td>
                Access Basic libraries stored in a document.
            </td>
        </tr>
        <tr class="even">
            <td>
                CreateObject(obj_type)
            </td>
            <td>
                Able to create any standard type, more flexible than CreateUnoStruct and CreateUnoService.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CreateUnoDialog()
            </td>
            <td>
                Create an existing dialog.
            </td>
        </tr>
        <tr class="even">
            <td>
                CreateUnoListener()
            </td>
            <td>
                Create a listener.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CreateUnoService()
            </td>
            <td>
                Create a Universal Network Object Service.
            </td>
        </tr>
        <tr class="even">
            <td>
                CreateUnoStruct()
            </td>
            <td>
                Create a Universal Network Object Structure.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CreateUnoValue()
            </td>
            <td>
                Create a Universal Network Object value.
            </td>
        </tr>
        <tr class="even">
            <td>
                DialogLibraries
            </td>
            <td>
                Access dialog libraries stored in a document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                EqualUNOObjects()
            </td>
            <td>
                Determine if two UNO objects reference the same instance.
            </td>
        </tr>
        <tr class="even">
            <td>
                <em>FindObject()</em>
            </td>
            <td>
                <em>Find a named object; do not use.</em>
            </td>
        </tr>
        <tr class="odd">
            <td>
                <em>FindPropertyObject()</em>
            </td>
            <td>
                <em>Find object property based on name; do not use.</em>
            </td>
        </tr>
        <tr class="even">
            <td>
                GetDefaultContext()
            </td>
            <td>
                Get a copy of the default context.
            </td>
        </tr>
        <tr class="odd">
            <td>
                GetProcessServiceManager()
            </td>
            <td>
                Get service manager.
            </td>
        </tr>
        <tr class="even">
            <td>
                GlobalScope
            </td>
            <td>
                Application-level libraries.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HasUnoInterfaces()
            </td>
            <td>
                Does an object support specified interfaces?
            </td>
        </tr>
        <tr class="even">
            <td>
                IsUnoStruct()
            </td>
            <td>
                Is this variable a Universal Network Object?
            </td>
        </tr>
        <tr class="odd">
            <td>
                StarDesktop
            </td>
            <td>
                Special variable representing the desktop object.
            </td>
        </tr>
        <tr class="even">
            <td>
                ThisComponent
            </td>
            <td>
                Special variable representing the current document.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="base-types-and-structures">
                    <span id="anchor-183"></span>Base types and structures
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Most of the internal data used by OOo is based on standard types such as strings and numbers. These types are
    combined into structures (called structs), which act like user-defined data types. The structures are combined to
    form more complex UNO objects. A struct supports properties but not methods.
</p>
<p>
    A structure provides a method of placing more than one value into a single variable. You access the values in a
    structure based on a name that is decided when the struct type is designed by a programmer. A commonly used struct
    is the PropertyValue, whose primary purpose is to hold a string name and a variant value. The following listing
    demonstrates creating a PropertyValue structure and then setting the name and the value. The contained properties
    are accessed by placing a period between the variable and the property name.
</p>
<p>
    <strong>Listing .</strong> Use Dim As New to create a UNO structure.
</p>
<p>
    Dim aProp As New com.sun.star.beans.PropertyValue
</p>
<p>
    aProp.Name = "FirstName" 'Set the Name property
</p>
<p>
    aProp.Value = "Paterton" 'Set the Value property
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                OOo objects have long names such as com.sun.star.beans.PropertyValue; in the text I usually abbreviate
                the name and simply write PropertyValue, but your macros must use the full name.
            </td>
        </tr>
    </tbody>
</table>
<p>
    You must create (or obtain) a UNO structure before you can use it. The most common method to create a UNO structure
    is to use Dim As New (see ). You can also use Dim to create an array of structures.
</p>
<p>
    <strong>Listing .</strong> Use Dim As New to create an array of UNO structures.
</p>
<p>
    Dim aProp(4) As New com.sun.star.beans.PropertyValue
</p>
<p>
    aProp(0).Name = "FirstName" 'Set the Name property
</p>
<p>
    aProp(0).Value = "Clyde" 'Set the Value property
</p>
<p>
    Use the CreateUnoStruct function to create a UNO structure when it is needed rather than declare it ahead of time.
    Dynamically creating a UNO structure allows the name of the structure to be provided at run time rather than compile
    time. Providing a name at run time is shown in and . Providing a name at compile time is shown in .
</p>
<p>
    <strong>Listing .</strong> Use CreateUnoStruct to create a UNO structure.
</p>
<p>
    Dim aProp
</p>
<p>
    aProp = CreateUnoStruct("com.sun.star.beans.PropertyValue")
</p>
<p>
    aProp.Name = "FirstName" 'Set the Name property
</p>
<p>
    aProp.Value = "Andrew" 'Set the Value property
</p>
<p>
    The With statement simplifies the process of setting the properties of a structure.
</p>
<p>
    <strong>Listing .</strong> Use With to simplify setting properties on structures.
</p>
<p>
    Dim aProp(4) As New com.sun.star.beans.PropertyValue
</p>
<p>
    With aProp(0)
</p>
<p>
    .Name = "FirstName" 'Set the Name property
</p>
<p>
    .Value = "Paterton" 'Set the Value property
</p>
<p>
    End With
</p>
<p>
    The function CreateUnoStruct used to be the only method to create a UNO structure. It is used less since the
    introduction of the “Dim As New” syntax. The CreateObject function is a more general function than CreateUnoStruct.
    It is able to create instances of all types supported by the Basic internal factory mechanism. This includes
    user-defined types.
</p>
<p>
    <strong>Listing .</strong> Create a user-defined type with CreateObject or Dim As.
</p>
<p>
    Type PersonType
</p>
<p>
    FirstName As String
</p>
<p>
    LastName As String
</p>
<p>
    End Type
</p>
<p>
    Sub ExampleCreateNewType
</p>
<p>
    Dim Person As PersonType
</p>
<p>
    Person.FirstName = "Andrew"
</p>
<p>
    Person.LastName = "Pitonyak"
</p>
<p>
    PrintPerson(Person)
</p>
<p>
    Dim Me As Object
</p>
<p>
    Me = CreateObject("PersonType")
</p>
<p>
    Me.FirstName = "Andy"
</p>
<p>
    Me.LastName = "Pitonyak"
</p>
<p>
    PrintPerson(Me)
</p>
<p>
    End Sub
</p>
<p>
    Sub PrintPerson(x)
</p>
<p>
    Print "Person = " &amp; x.FirstName &amp; " " &amp; x.LastName
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                For a user-defined type, “Dim As New” and “Dim As” both work. For a UNO struct, however, you must use
                “Dim As New”.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The CreateObject function accepts the same arguments as CreateUnoStruct, but it works for all supported types,
    whereas CreateUnoStruct works only for UNO structures. Therefore, there is no reason to use CreateUnoStruct rather
    than CreateObject.
</p>
<p>
    <strong>Listing .</strong> Use CreateObject to create a UNO structure.
</p>
<p>
    Dim aProp
</p>
<p>
    aProp = CreateObject("com.sun.star.beans.PropertyValue")
</p>
<p>
    aProp.Name = "FirstName" 'Set the Name property
</p>
<p>
    aProp.Value = "Paterton" 'Set the Value property
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                CreateObject offers more flexibility than CreateUnoStruct to dynamically create objects based on a name.
            </td>
        </tr>
    </tbody>
</table>
<p>
    I wrote a small test program that created 20000 structs. CreateUnoStruct and CreateObject took about the same amount
    of time. Using Dim As New, however, used 500 clock ticks less, which is useful if you want to make a macro run as
    fast as possible.
</p>
<p>
    The TypeName function indicates that a UNO structure is an object. Use the IsUnoStruct function to determine if a
    variable is a UNO structure.
</p>
<p>
    <strong>Listing .</strong> Use IsUnoStruct to check if an object is an UNO Struct.
</p>
<p>
    Dim aProp As New com.sun.star.beans.PropertyValue
</p>
<p>
    Print TypeName(aProp) 'Object
</p>
<p>
    Print IsUnoStruct(aProp) 'True
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="uno-interface">
                    <span id="anchor-184"></span>UNO interface
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    An interface defines how something interacts with its environment. A UNO interface resembles a group of subroutine
    and function declarations; arguments and return types are specified along with functionality.
</p>
<p>
    You can use the interface to retrieve data from an object, set data in an object, or tell an object to do something.
    The interface indicates how an object can be used, but it says nothing about the implementation. For example, if an
    interface contains the method GetHeight that returns an integer, it’s natural to assume that the object contains an
    integer property named Height. It’s possible, however, that the height is derived or calculated from other
    properties. The interface does not specify how the height is obtained, just that it is available. A UNO structure,
    however, contains properties that are accessed directly; the internal representation is not hidden.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                <p>
                    UNO interface names start with the capital letter X.
                </p>
                <p>
                    When you want to know what methods are supported by an object, check the interfaces.
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    UNO interface names start with the capital letter X, which makes it easy to recognize an interface; for example, the
    interface com.sun.star.text.XTextRange specifies a section of text with both a start and end position. Objects that
    support the XTextRange interface are also used to identify an object’s position in text document. The start and end
    positions may be the same. The XTextRange interface defines the methods in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Methods defined by the
    com.sun.star.text.XTextRange interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getText()
            </td>
            <td>
                Return the com.sun.star.text.XText interface that contains this XTextRange.
            </td>
        </tr>
        <tr class="even">
            <td>
                getStart()
            </td>
            <td>
                Return a com.sun.star.text.XTextRange that references only the start position.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getEnd()
            </td>
            <td>
                Return a com.sun.star.text.XTextRange that references only the end position.
            </td>
        </tr>
        <tr class="even">
            <td>
                getString()
            </td>
            <td>
                Return a string that includes the text inside this text range.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setString(str)
            </td>
            <td>
                Set the string for this text range, replacing existing text and clearing all styles.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                A UNO interface may be derived from another. Every UNO interface is required to be derived from
                com.sun.star.uno.XInterface.
            </td>
        </tr>
    </tbody>
</table>
<p>
    A new UNO interface may be derived from another. This is not something that you do, but rather it’s something that
    is done by the designer of the interface. The derived interface supports all of the methods defined in the interface
    from which it is derived. For example, the com.sun.star.text.XTextCursor extends the XTextRange interface to allow
    it to change the range, which makes sense if you think about what you do with a cursor. Any object that implements
    the XTextCursor interface, supports the methods in and the new methods introduced by the XTextCursor interface.
</p>
<p>
    The main points regarding interfaces (so far) are:
</p>
<ol type="1">
    <li>
        An interface defines methods. In other words, an interface defines what an object can do; including getting and
        setting internal properties.
    </li>
    <li>
        An interface may be derived from another interface.
    </li>
    <li>
        The last portion of an interface name begins with an X.
    </li>
</ol>
<p>
    In UNO, objects are accessed by their interface. Many of the programming languages, such as Java and C++, force you
    to perform a little UNO magic and extract the correct interface before you can call the methods defined in the
    interface. OOo Basic hides these details for you so that you can directly call methods and access properties
    directly.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                OOo Basic hides many of the complicated details, so, for most things, it is easier to write an OOo Basic
                program than to write a Java script.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="uno-service">
                    <span id="anchor-185"></span>UNO service
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    A service abstractly defines an object by combining interfaces and properties to encapsulate some useful
    functionality. A UNO interface defines how an object interacts with the outside world; a UNO structure defines a
    collection of data; and a UNO service combines them together. Like a UNO interface, a UNO service does not specify
    the implementation. It only specifies how to interact with the object.
</p>
<p>
    Almost every UNO object is defined by a service, so UNO objects are called services. Strictly speaking, however, “a
    service” is the object definition. The UNO object is the actual object created as defined by the service. A service
    may include multiple services and interfaces. An interface usually defines a single aspect of a service and
    therefore is usually smaller in scope.
</p>
<p>
    Many services have a name similar to an interface name; for example, one of the interfaces exported by the
    TextCursor service is the XTextCursor interface. An interface or property may be declared as optional for a service.
    The XWordCursor interface is marked as optional for the TextCursor service. The implication is that not all text
    cursors support the word cursor interface. In practice, you learn which text cursors support which interfaces and
    then simply use them.
</p>
<p>
    There are two typical methods for obtaining a service.
</p>
<ul>
    <li>
        Get a reference to an existing object; for example, retrieving the first text table in the current document.
    </li>
    <li>
        Ask a service factory to create an instance of an object; for example, if I want to insert a new text table into
        a document, I ask the document to give me a new empty table, which I then configure and insert into the
        document.
    </li>
</ul>
<p>
    A service factory returns objects based on the name. The process service manager is the main object factory for
    OpenOffice.org. The factory is given the service name, and the factory decides what to return. A factory may return
    a brand new instance of an object, or, it may return an existing instance. Use GetProcessServiceManager() to obtain
    a reference to the process service manager. Use CreateInstance to create a service from the process service manager
    as shown in .
</p>
<p>
    <strong>Listing .</strong> Use process service manager to create a service.
</p>
<p>
    Sub ManagerCreatesAService
</p>
<p>
    Dim vFileAccess
</p>
<p>
    Dim s As String
</p>
<p>
    Dim vManager
</p>
<p>
    vManager = GetProcessServiceManager()
</p>
<p>
    vFileAccess = vManager.CreateInstance("com.sun.star.ucb.SimpleFileAccess")
</p>
<p>
    s = vFileAccess.getContentType("http://www.pitonyak.org/AndrewMacro.odt")
</p>
<p>
    Print s
</p>
<p>
    End Sub
</p>
<p>
    The code in obtains the process service manager, creates an instance of the SimpleFileAccess service, and then uses
    the created service. The CreateUnoService function is a shortcut for creating a UNO service (see). The purpose of is
    to demonstrate the CreateUnoService function, showing that it’s simpler than creating a service manager. also
    demonstrates some useful functionality, using a dialog to choose a file.
</p>
<p>
    <strong>Listing .</strong> Select a file on disk.
</p>
<p>
    Function ChooseAFileName() As String
</p>
<p>
    Dim vFileDialog 'FilePicker service instance
</p>
<p>
    Dim vFileAccess 'SimpleFileAccess service instance
</p>
<p>
    Dim iAccept as Integer 'Response to the FilePicker
</p>
<p>
    Dim sInitPath as String 'Hold the initial path
</p>
<p>
    'Note: The following services MUST be called in the following order
</p>
<p>
    'or Basic will not remove the FileDialog Service
</p>
<p>
    vFileDialog = CreateUnoService("com.sun.star.ui.dialogs.FilePicker")
</p>
<p>
    vFileAccess = CreateUnoService("com.sun.star.ucb.SimpleFileAccess")
</p>
<p>
    'Set the initial path here!
</p>
<p>
    sInitPath = ConvertToUrl(CurDir)
</p>
<p>
    If vFileAccess.Exists(sInitPath) Then
</p>
<p>
    vFileDialog.SetDisplayDirectory(sInitPath)
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    iAccept = vFileDialog.Execute() 'Run the file chooser dialog
</p>
<p>
    If iAccept = 1 Then 'What was the return value?
</p>
<p>
    ChooseAFileName = vFileDialog.Files(0) 'Set file name if it was not canceled
</p>
<p>
    End If
</p>
<p>
    vFileDialog.Dispose() 'Dispose of the dialog
</p>
<p>
    End Function
</p>
<p>
    A directory can be chosen similarly.
</p>
<p>
    <strong>Listing .</strong> Select a directory.
</p>
<p>
    REM sInPath specifies the initial directory. If the initial directory
</p>
<p>
    REM is not specified, then the user's default work directory is used.
</p>
<p>
    REM The selected directory is returned as a URL.
</p>
<p>
    Function ChooseADirectory(Optional sInPath$) As String
</p>
<p>
    Dim oDialog As Object
</p>
<p>
    Dim oSFA As Object
</p>
<p>
    Dim s As String
</p>
<p>
    Dim oPathSettings
</p>
<p>
    oDialog = CreateUnoService("com.sun.star.ui.dialogs.FolderPicker")
</p>
<p>
    'oDialog = CreateUnoService("com.sun.star.ui.dialogs.OfficeFolderPicker")
</p>
<p>
    oSFA = createUnoService("com.sun.star.ucb.SimpleFileAccess")
</p>
<p>
</p>
<p>
    If IsMissing(sInPath) Then
</p>
<p>
    oPathSettings = CreateUnoService("com.sun.star.util.PathSettings")
</p>
<p>
    oDialog.setDisplayDirectory(oPathSettings.Work)
</p>
<p>
    ElseIf oSFA.Exists(sInPath) Then
</p>
<p>
    oDialog.setDisplayDirectory(sInPath)
</p>
<p>
    Else
</p>
<p>
    s = "Directory '" &amp; sInPath &amp; "' Does not exist"
</p>
<p>
    If MsgBox(s, 33, "Error") = 2 Then Exit Function
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    If oDialog.Execute() = 1 Then
</p>
<p>
    ChooseADirectory() = oDialog.getDirectory()
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The file picker and folder picker dialogs can use either the operating system supplied default dialogs,
                or OOo specific dialogs. The operating system specific dialogs provide less functionality; for example,
                you cannot set the initial displayed directory. Use Tools &gt; Options &gt; OpenOffice.org &gt; General
                and place a check next to "Use OpenOffice.org dialogs".
            </td>
        </tr>
    </tbody>
</table>
<p>
    The code in creates two UNO services by using the function CreateUnoService. There are times, however, when the
    service manager is required. For example, the service manager has methods to create a service with arguments,
    CreateInstanceWithArguments, and to obtain a list of all supported services, getAvailableServiceNames(). The code in
    obtains a list of the supported service names; there are 1003 services on my computer using OOo version 3.2.1; up
    from 562 with OOo version 1.
</p>
<p>
    <strong>Listing .</strong> Service manager supports services.
</p>
<p>
    Sub HowManyServicesSupported
</p>
<p>
    Dim oDoc ' Document created to hold the service names.
</p>
<p>
    Dim oText ' Document text object.
</p>
<p>
    Dim oSD ' SortDescriptor created for the document.
</p>
<p>
    Dim oCursor ' Text cursor used for sorting.
</p>
<p>
    Dim i% ' Index Variable.
</p>
<p>
    Dim sServices
</p>
<p>
    sServices = GetProcessServiceManager().getAvailableServiceNames()
</p>
<p>
    Print "Service manager supports ";UBound(sServices);" services"
</p>
<p>
    ' Create a Writer document.
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL( "private:factory/swriter", "_blank", 0, Array() )
</p>
<p>
    oText = oDoc.getText()
</p>
<p>
</p>
<p>
    ' Print the service names into a Writer document.
</p>
<p>
    For i = LBound( sServices ) To UBound( sServices )
</p>
<p>
    oText.insertString( oText.getEnd(), sServices(i), False )
</p>
<p>
    ' Do not insert a blank line at the end.
</p>
<p>
    oText.insertControlCharacter( oText.getEnd(), _
</p>
<p>
    com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK, False )
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    oCursor = oDoc.Text.CreateTextCursorByRange(oDoc.Text)
</p>
<p>
    oSD = oCursor.createSortDescriptor()
</p>
<p>
    oCursor.sort(oSD)
</p>
<p>
</p>
<p>
    oText.insertString( oText.getStart(), _
</p>
<p>
    "Service manager supports "&amp;UBound(sServices)&amp;" services", False )
</p>
<p>
    End Sub
</p>
<p>
    It is useful to look at the list of supported services. This provides insight into available functionality that you
    can explore. A great example of this is shown . An object inserted into a document must be created by that document.
    Using the methods of , you can check to see what types of objects the document can create.
</p>
<p>
    <strong>Listing .</strong> What objects can a document create.
</p>
<p>
    REM Print the object / service types that a document can create.
</p>
<p>
    REM If the document (oDoc) is missing, the current document is used.
</p>
<p>
    REM If nameFilter is included, then service names that contain
</p>
<p>
    REM the string are printed; based on a case insensitive compare.
</p>
<p>
    REM The service names are stored in a newly created Write document.
</p>
<p>
    Sub TypesDocCanCreate(Optional oDoc, Optional nameFilter$)
</p>
<p>
    Dim allNames ' List of all the names.
</p>
<p>
    Dim oWriteDoc ' Newly created Write document to contain the names.
</p>
<p>
    Dim oText ' Document text object.
</p>
<p>
    Dim s : s = "private:factory/swriter"
</p>
<p>
    ' Find out what this document can create.
</p>
<p>
    If IsMissing(oDoc) Then
</p>
<p>
    allNames = ThisComponent.getAvailableServiceNames()
</p>
<p>
    Else
</p>
<p>
    allNames = oDoc.getAvailableServiceNames()
</p>
<p>
    End If
</p>
<p>
    ' Create a new Write document to contain the list.
</p>
<p>
    oWriteDoc = StarDesktop.loadComponentFromURL(s, "_blank", 0, Array())
</p>
<p>
    oText = oWriteDoc.getText()
</p>
<p>
    If IsMissing(nameFilter) Then
</p>
<p>
    oText.insertString ( oText.End, Join(allNames, CHR$(13)), False)
</p>
<p>
    Else
</p>
<p>
    Dim i%
</p>
<p>
    For i = LBound(allNames) To UBound(allNames)
</p>
<p>
    If (InStr(allNames(i), nameFilter) &gt; 0) Then
</p>
<p>
    ' Insert the text.
</p>
<p>
    oText.insertString ( oText.End, allNames(i), False )
</p>
<p>
</p>
<p>
    ' Insert a new paragraph.
</p>
<p>
    oText.InsertControlCharacter(oText.getEnd(),_
</p>
<p>
    com.sun.star.text.ControlCharacter.APPEND_PARAGRAPH, False)
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="setting-a-read-only-value">
                            <span id="anchor-186"></span>Setting a Read-Only Value
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Some values can be set only once, so changing the value requires creating a new object. As an example, consdier:
</p>
<ul>
    <li>
        A Calc sheet with combox controls (com.sun.star.awt.UnoControlComboBoxModel).
    </li>
    <li>
        The controls are anchored to cells.
    </li>
    <li>
        Each control bound to a cell.
    </li>
    <li>
        Write a macro that finds each combobox and bind it to the cell in which it is anchored.
    </li>
</ul>
<p>
    The obvious way to change the bound cell is to access and change the bound cell doing something like the following
    code that fails because ValueBinding is read-only:
</p>
<p>
    ' BoundCell is a struct, so copy the value out, change it and write it back.
</p>
<p>
    oBoundCell = oControlDataModel.ValueBinding.BoundCell
</p>
<p>
    oBoundCell.Column = 6
</p>
<p>
    oBoundCell.Row = 6
</p>
<p>
    oBoundCell.Sheet = 0
</p>
<p>
    oControlDataModel.ValueBinding.BoundCell = oBoundCell
</p>
<p>
    If you create a new value binding object and try to set the BoundCell property, this still fails. The value binding
    object must be initialized with the bound cell value, and it cannot be changed again:
</p>
<p>
    Dim arg(0) as new com.sun.star.beans.NamedValue 'not a PropertyValue, a Named Value.
</p>
<p>
    Dim oCellAddress As new com.sun.star.table.CellAddress
</p>
<p>
    oCellAddress.Column = 6
</p>
<p>
    oCellAddress.Row=13
</p>
<p>
    oCellAddress.Sheet=0
</p>
<p>
    arg(0).Name = "BoundCell"
</p>
<p>
    arg(0).Value = oCellAddress
</p>
<p>
    oService = oDoc.createInstanceWithArguments("com.sun.star.table.CellValueBinding", arg)
</p>
<p>
    oControlDataModel.ValueBinding = oService
</p>
<p>
    Using CreateInstanceWithArguments allows the service to be created and values be set when the object is initialized.
    You can accomplish the same thing in two steps (instead of one) by creating the instance without arguments and
    calling the initialize method after creating the object.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="context">
                    <span id="anchor-187"></span>Context
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OpenOffice has “things” that are available by name. For example, the type description manager and the service
    manager. A context is a collection of name-value pairs that you can use to get these “things” by name. OOo maintains
    a default context that is available with the function GetDefaultContext. Although a context is required when a
    service is created, OOo Basic automatically uses the default context when calling CreateUnoService; yet another
    reason why OOo Basic is easier to use than other languages.
</p>
<p>
    <strong>Listing .</strong> View context element names.
</p>
<p>
    MsgBox Join(GetDefaultContext().getElementNames(), CHR$(10))
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="inspecting-universal-network-objects">
                    <span id="anchor-188"></span>Inspecting Universal Network Objects
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    While writing an OOo Basic macro, I don’t always understand the values returned from internal OOo functions<em><em>
            — </em></em>for example, inspecting the value returned by GetDefaultContext. I write test code to examine
    the return values so that I can make appropriate decisions. I then frequently add more test code to further inspect
    the returned object. The initial inspection uses routines that you probably know (see ).
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Initial inspection routines.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                IsMissing(obj)
            </td>
            <td>
                Use this for optional arguments to see if they are missing.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsNull(obj)
            </td>
            <td>
                You cannot inspect a null object, but you know that it is null.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsEmpty(obj)
            </td>
            <td>
                You cannot inspect an empty object, but you know that it is empty.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsArray(obj)
            </td>
            <td>
                Use array-inspection methods to learn more about the array.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TypeName(obj)
            </td>
            <td>
                Determine if this is a simple type such as a String or an Integer. If this is an Object, it is probably
                a UNO structure or a UNO service.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsUnoStruct(obj)
            </td>
            <td>
                Determine if this is a UNO structure.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The code in demonstrates an initial use of the functions in .
</p>
<p>
    <strong>Listing .</strong> Inspect the TextTables object on the current document.
</p>
<p>
    Dim v
</p>
<p>
    v = Thiscomponent.getTextTables()
</p>
<p>
    Print IsObject(v) 'True
</p>
<p>
    Print IsNull(v) 'False
</p>
<p>
    Print IsEmpty(v) 'False
</p>
<p>
    Print IsArray(v) 'False
</p>
<p>
    Print IsUnoStruct(v) 'False
</p>
<p>
    Print TypeName(v) 'Object
</p>
<p>
    MsgBox v.dbg_methods 'This property is discussed later
</p>
<p>
    If the returned object has a type name of Object and it isn’t a UNO structure, it is probably a UNO service. Use the
    HasUnoInterfaces function to determine if a UNO object supports a set of interfaces. The first argument is the
    object to test. The arguments following the first are a list of interface names. If all of the listed interfaces are
    supported, the function returns True, otherwise it returns False. More than one interface may be checked at the same
    time.
</p>
<p>
    HasUnoInterfaces(obj, interface1)
</p>
<p>
    HasUnoInterfaces(obj, interface1[, interface2[, interface3[, ...]]])
</p>
<p>
    To distinguish between a UNO structure, an arbitrary object, and a UNO service, first check to see if the variable
    is an object. This is easily done using the TypeName function. If the TypeName contains the word Object, then you
    know it’s an object of some sort. The next step is to see if the object is a UNO structure, by using the function
    IsUnoStruct. Finally, if the object supports an interface (any interface will do), you know it’s a UNO service.
    Every interface is derived from com.sun.star.uno.XInterface, so it suffices to see if the object supports the
    XInterface interface. The code in uses the OOo Basic variable ThisComponent, which represents the current document.
</p>
<p>
    <strong>Listing .</strong> Use HasUnoInterfaces and IsUnoStruct to determine the UNO type.
</p>
<p>
    Dim aProp As New com.sun.star.beans.PropertyValue
</p>
<p>
    Print IsUnoStruct(aProp) 'True
</p>
<p>
    Print HasUnoInterfaces(aProp, "com.sun.star.uno.XInterface") 'False
</p>
<p>
    Print IsUnoStruct(ThisComponent) 'False
</p>
<p>
    Print HasUnoInterfaces(ThisComponent, "com.sun.star.uno.XInterface") 'True
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                If the first argument to the function HasUnoInterfaces is not an object, a run-time error occurs. The
                object may be null, but it must be an object. If the argument is a variant, it must contain an object;
                it cannot be empty.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Most UNO services also support the com.sun.star.lang.XServiceInfo interface, which allows you to ask the object what
    services it supports (see ).
</p>
<p>
    <strong>Table .</strong> XServiceInfo methods.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getImplementationName()
            </td>
            <td>
                Returns a string that uniquely identifies the implementation of the service. For example,
                SwXTextDocument is the name of a Writer text document.
            </td>
        </tr>
        <tr class="even">
            <td>
                getSupportedServiceNames()
            </td>
            <td>
                Return a string array of services that the object supports.
            </td>
        </tr>
        <tr class="odd">
            <td>
                supportsService(serviceName)
            </td>
            <td>
                Return True if the object supports the service name.
            </td>
        </tr>
    </tbody>
</table>
<p>
    OOo supports different types of documents, such as Writer (word processing) and Calc (spreadsheet). Each document
    type supports at least one service that is supported only by that document type (see ). You can determine the
    document type by checking if it supports one of these services. You can also use the method getImplementationName(),
    as shown in .
</p>
<p>
    The code in demonstrates how to verify that a variable references a Writer document. If the argument vDoc does not
    support the XServiceInfo interface, however, a run-time error occurs because the SupportsService method is not
    implemented. Use appropriate error handling if this is required, as shown in ; this is used in . If the argument is
    missing, the current document is used. If an error occurs or a recognized service is not supported, the text
    “unknown” is returned.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Unique service names based on document
    type.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Drawing
            </td>
            <td>
                com.sun.star.drawing.DrawDocument
            </td>
        </tr>
        <tr class="even">
            <td>
                Writer
            </td>
            <td>
                com.sun.star.text.TextDocument
            </td>
        </tr>
        <tr class="odd">
            <td>
                Writer HTML
            </td>
            <td>
                com.sun.star.text.WebDocument
            </td>
        </tr>
        <tr class="even">
            <td>
                Calc
            </td>
            <td>
                com.sun.star.sheet.SpreadsheetDocument
            </td>
        </tr>
        <tr class="odd">
            <td>
                Math
            </td>
            <td>
                com.sun.star.formula.FormulaProperties
            </td>
        </tr>
        <tr class="even">
            <td>
                Presentation
            </td>
            <td>
                com.sun.star.presentation.PresentationDocument
            </td>
        </tr>
        <tr class="odd">
            <td>
                Base
            </td>
            <td>
                com.sun.star.sdb.OfficeDatabaseDocument
            </td>
        </tr>
        <tr class="even">
            <td>
                Base Table
            </td>
            <td>
                com.sun.star.sdb.DataSourceBrowser
            </td>
        </tr>
        <tr class="odd">
            <td>
                Basic IDE
            </td>
            <td>
                com.sun.star.script.BasicIDE
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Verify that the document is a Writer document.
</p>
<p>
    Sub DoSomethingToWriteDocument(vDoc)
</p>
<p>
    If NOT vDoc.supportsService("com.sun.star.text.TextDocument") Then
</p>
<p>
    MsgBox "A Writer document is required", 48, "Error"
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    REM rest of the subroutine starts here
</p>
<p>
    End Sub
</p>
<p>
    <strong>Listing .</strong> Determine a document's type.
</p>
<p>
    Function getDocType(Optional vDoc) As String
</p>
<p>
    On Error GoTo Oops
</p>
<p>
    If IsMissing(vDoc) Then vDoc = ThisComponent
</p>
<p>
    If vDoc.SupportsService("com.sun.star.sheet.SpreadsheetDocument") Then
</p>
<p>
    getDocType = "calc"
</p>
<p>
    ElseIf vDoc.SupportsService("com.sun.star.text.TextDocument") Then
</p>
<p>
    getDocType = "writer"
</p>
<p>
    ElseIf vDoc.SupportsService("com.sun.star.drawing.DrawingDocument") Then
</p>
<p>
    getDocType = "draw"
</p>
<p>
    ElseIf vDoc.SupportsService(_
</p>
<p>
    "com.sun.star.presentation.PresentationDocuments") Then
</p>
<p>
    getDocType = "presentation"
</p>
<p>
    ElseIf vDoc.SupportsService("com.sun.star.formula.FormulaProperties") Then
</p>
<p>
    getDocType = "math"
</p>
<p>
    ElseIf vDoc.SupportsService("com.sun.star.sdb.OfficeDatabaseDocument") Then
</p>
<p>
    getDocType = "base"
</p>
<p>
    Else
</p>
<p>
    getDocType = "unknown"
</p>
<p>
    End If
</p>
<p>
    Oops:
</p>
<p>
    If Err &lt;&gt; 0 Then getDocType = "unknown"
</p>
<p>
    On Error GoTo 0 'Turn off error handling AFTER checking for an error
</p>
<p>
    End Function
</p>
<p>
    Some document types cannot be easily distinguished; for example, an XForms document and a Master document both
    support the same services as a regular text document. All of the Write based documents support the service
    com.sun.star.text.GenericTextDocument, and all of the office type documents support the service
    com.sun.star.document.OfficeDocument.
</p>
<p>
    When I want to know about an interface or service, the first place that I look is online for the official
    documentation. Unfortunately, only a partial picture is easily produced (for the TextCursor service, see <a
        href="http://api.openoffice.org/docs/common/ref/com/sun/star/text/TextCursor.html">http://api.openoffice.org/docs/common/ref/com/sun/star/text/TextCursor.html</a>).
    There are some issues:
</p>
<ol type="1">
    <li>
        The documentation does not present a unified picture, you must follow many links to determine what the object
        can do. All supported and optional interfaces are listed, but you must inspect each interface to know what each
        one does.
    </li>
    <li>
        Each interface has its own page. If an interface is derived from another, you must look at another page to see
        the definition of the parent interface.
    </li>
    <li>
        You don’t know if the optional items are supported for a specific object instance without inspecting the object.
    </li>
</ol>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Use Google to search for “site:api.openoffice.org TextCursor” to quickly find the documentation for the
                TextCursor service.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                <a
                    href="http://api.openoffice.org/docs/common/ref/com/sun/star/text/module-ix.html">http://api.openoffice.org/docs/common/ref/com/sun/star/text/module-ix.html</a>
                lists all of the services and interfaces at the com.sun.star.text level.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Most UNO services contain the properties dbg_properties, dbg_methods, and dbg_supportedInterfaces. Each of these
    properties is a string that contains a list of the supported properties, methods, or supported interfaces. Each
    string starts with text similar to “Properties of Object "ThisComponent":”. The individual items are separated by
    the delimiter as shown in . Sometimes there are extra spaces following the delimiter and sometimes there are extra
    new-line characters<em><em> — </em></em>CHR$(10).
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> UNO “dbg_” properties.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                dbg_properties
            </td>
            <td>
                “;”
            </td>
            <td>
                All properties supported by the object.
            </td>
        </tr>
        <tr class="even">
            <td>
                dbg_methods
            </td>
            <td>
                “;”
            </td>
            <td>
                All methods supported by the object.
            </td>
        </tr>
        <tr class="odd">
            <td>
                dbg_supportedInterfaces
            </td>
            <td>
                Chr$(10)
            </td>
            <td>
                All interfaces supported by the object.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The code in provides an easy method to see what an object supports. Sometimes, however, too many items are displayed
    and portions of the dialog do not fit on the screen. To avoid this problem, the code in splits the list into
    smaller, easily managed chunks. is only one of the many dialogs that are displayed by the macro in . Be warned, the
    dialogs will not fit on the screen, so, just press enter to close each dialog.
</p>
<p>
    <strong>Listing .</strong> The “dbg_” properties return useful information.
</p>
<p>
    MsgBox vObj.dbg_properties
</p>
<p>
    MsgBox vObj.dbg_methods
</p>
<p>
    MsgBox vObj.dbg_supportedInterfaces
</p>
<p>
    <strong>Listing .</strong> Display information from one of the debug properties.
</p>
<p>
    Sub ExampleDisplayDbgInfoStr()
</p>
<p>
    Dim vObj
</p>
<p>
    vObj = ThisComponent
</p>
<p>
    DisplayDbgInfoStr(vObj.dbg_properties, ";", 40, "Properties")
</p>
<p>
    DisplayDbgInfoStr(vObj.dbg_methods, ";", 40, "Methods")
</p>
<p>
    DisplayDbgInfoStr(vObj.dbg_supportedInterfaces, CHR$(10), 40, "Interfaces")
</p>
<p>
    End Sub
</p>
<p>
    Sub DisplayDbgInfoStr(sInfo$, sSep$, nChunks, sHeading$)
</p>
<p>
    Dim aInfo() 'Array to hold each string
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
    Dim j As Integer 'Junk integer variable for temporary values
</p>
<p>
    Dim s As String 'holds the portion that is not completed
</p>
<p>
    s = sInfo$
</p>
<p>
    j = InStr(s, ":") 'Initial colon
</p>
<p>
    If j &gt; 0 Then Mid(s, 1, j, "") 'Remove portion up to the initial colon
</p>
<p>
    Do
</p>
<p>
    aInfo() = Split(s, sSep$, nChunks) 'Split string based on delimiter.
</p>
<p>
    s = aInfo(UBound(aInfo())) 'Grab the last piece. Contains
</p>
<p>
    If InStr(s, sSep$) &lt; 1 Then 'the rest if there were too many.
</p>
<p>
    s = "" 'If there were not, then clear s.
</p>
<p>
    Else 'If there was a delimiter then
</p>
<p>
    ReDim Preserve aInfo(nChunks - 2) 'change array dimension to
</p>
<p>
    End If 'remove the extra last piece.
</p>
<p>
    For i = LBound(aInfo()) To UBound(aInfo())'Look at each piece to remove
</p>
<p>
    aInfo(i) = Trim(aInfo(i)) 'leading and trailing spaces.
</p>
<p>
    j = InStr(aInfo(i), CHR$(10)) 'Some have an extra
</p>
<p>
    If j &gt; 0 Then Mid(aInfo(i), j, 1, "") 'new line that should be removed.
</p>
<p>
    Next
</p>
<p>
    MsgBox Join(aInfo(), CHR$(10)), 0, sHeading$
</p>
<p>
    Loop Until Len(s) = 0
</p>
<p>
    End Sub
</p>
<p>
    When a type is included in one of the “dbg_” properties, it is preceded by the text “Sbx”, as shown in . These names
    starting with Sbx correspond to the internal names used by OOo Basic.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                A complete object browser is presented later that demonstrates all of these concepts (see section <a
                    href="#anchor-189">18.5</a> <a href="#anchor-189">The object inspector example</a>).
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                A popular object browser, called Xray described at the following link: <a
                    href="http://wiki.openoffice.org/wiki/Extensions_development_basic">http://wiki.openoffice.org/wiki/Extensions_development_basic</a>
            </td>
        </tr>
    </tbody>
</table>
<p>
    <img src="Pictures/1000000000000109000001CDF95DF31C.png" style="width:2.7602in;height:4.802in" />
</p>
<p>
    <strong>Figure .</strong> A few properties in a Writer document; one dialog of many displayed.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="using-the-type-description-manager">
                    <span id="anchor-190"></span>Using the type description manager
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The TypeDescriptionManager manages type descriptions and acts as a central access point for every type description.
    This object is available from the default context as a singleton. Creating the object directly does not provide a
    usable object
</p>
<p>
    CreateUnoService("com.sun.star.reflection.TypeDescriptionManager")
</p>
<p>
    I created a usable object using the accepted method (shown shortly), and even when using that type directly, it too
    failed.
</p>
<p>
    CreateUnoService("com.sun.star.comp.stoc.TypeDescriptionManager")
</p>
<p>
    Get the type description manager from the default context; see section <a href="#anchor-187">10.4</a> <a
        href="#anchor-187">Context</a>, which also shows how to enumerate all of the singleton objects available.
</p>
<p>
    Function GetTypeDescriptionManager()
</p>
<p>
    Dim sTDMName$ ' Name of the type description manager.
</p>
<p>
    sTDMName = "/singletons/com.sun.star.reflection.theTypeDescriptionManager"
</p>
<p>
    GetTypeDescriptionManager() = GetDefaultContext().getValueByName(sTDMName)
</p>
<p>
    End Function
</p>
<p>
    The following method enumerates all “things” in the com.sun.star.awt module.
</p>
<p>
    <strong>Listing .</strong> Enumerate types in a module.
</p>
<p>
    Sub EnumerateTypesTest
</p>
<p>
    Dim oTDM ' Type Description Manager.
</p>
<p>
    Dim oTDE ' Type Description Enumerations.
</p>
<p>
    Dim oTD ' One Type Description.
</p>
<p>
    Dim typeArray ' Types for which descriptions are returned.
</p>
<p>
    Dim s$ ' Utility string variable.
</p>
<p>
</p>
<p>
    REM All supported types.
</p>
<p>
    typeArray = Array(com.sun.star.uno.TypeClass.VOID, _
</p>
<p>
    com.sun.star.uno.TypeClass.CHAR, _
</p>
<p>
    com.sun.star.uno.TypeClass.BOOLEAN, _
</p>
<p>
    com.sun.star.uno.TypeClass.BYTE, _
</p>
<p>
    com.sun.star.uno.TypeClass.SHORT, _
</p>
<p>
    com.sun.star.uno.TypeClass.UNSIGNED_SHORT, _
</p>
<p>
    com.sun.star.uno.TypeClass.LONG, _
</p>
<p>
    com.sun.star.uno.TypeClass.UNSIGNED_LONG, _
</p>
<p>
    com.sun.star.uno.TypeClass.HYPER, _
</p>
<p>
    com.sun.star.uno.TypeClass.UNSIGNED_HYPER, _
</p>
<p>
    com.sun.star.uno.TypeClass.FLOAT, _
</p>
<p>
    com.sun.star.uno.TypeClass.DOUBLE, _
</p>
<p>
    com.sun.star.uno.TypeClass.STRING, _
</p>
<p>
    com.sun.star.uno.TypeClass.TYPE, _
</p>
<p>
    com.sun.star.uno.TypeClass.ANY, _
</p>
<p>
    com.sun.star.uno.TypeClass.ENUM, _
</p>
<p>
    com.sun.star.uno.TypeClass.TYPEDEF, _
</p>
<p>
    com.sun.star.uno.TypeClass.STRUCT, _
</p>
<p>
    com.sun.star.uno.TypeClass.UNION, _
</p>
<p>
    com.sun.star.uno.TypeClass.EXCEPTION, _
</p>
<p>
    com.sun.star.uno.TypeClass.SEQUENCE, _
</p>
<p>
    com.sun.star.uno.TypeClass.ARRAY, _
</p>
<p>
    com.sun.star.uno.TypeClass.INTERFACE, _
</p>
<p>
    com.sun.star.uno.TypeClass.SERVICE, _
</p>
<p>
    com.sun.star.uno.TypeClass.MODULE, _
</p>
<p>
    com.sun.star.uno.TypeClass.INTERFACE_METHOD, _
</p>
<p>
    com.sun.star.uno.TypeClass.INTERFACE_ATTRIBUTE, _
</p>
<p>
    com.sun.star.uno.TypeClass.UNKNOWN, _
</p>
<p>
    com.sun.star.uno.TypeClass.PROPERTY, _
</p>
<p>
    com.sun.star.uno.TypeClass.CONSTANT, _
</p>
<p>
    com.sun.star.uno.TypeClass.CONSTANTS, _
</p>
<p>
    com.sun.star.uno.TypeClass.SINGLETON)
</p>
<p>
    oTDM = GetTypeDescriptionManager()
</p>
<p>
    Dim sBaseName$ : sBaseName = "com.sun.star.awt"
</p>
<p>
</p>
<p>
    ' Change com.sun.star.reflection.TypeDescriptionSearchDepth.ONE
</p>
<p>
    ' to com.sun.star.reflection.TypeDescriptionSearchDepth.INFINITE
</p>
<p>
    ' to traverse more than a single level.
</p>
<p>
    oTDE = oTDM.createTypeDescriptionEnumeration(sBaseName, _
</p>
<p>
    typeArray, _
</p>
<p>
    com.sun.star.reflection.TypeDescriptionSearchDepth.ONE)
</p>
<p>
</p>
<p>
    While oTDE.hasMoreElements()
</p>
<p>
    oTD = oTDE.nextTypeDescription()
</p>
<p>
    s$ = s &amp; oTD.Name &amp; CHR$(10)
</p>
<p>
    Wend
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    To get the information on a specific fully qualified type, use the following macro (adapted from an example by
    Bernard Marcelly):
</p>
<p>
    <strong>Listing .</strong> Get object description from a fully qualified name.
</p>
<p>
    Function GetOOoConst(constString)
</p>
<p>
    Dim sTDMName$
</p>
<p>
    Dim oTDM
</p>
<p>
</p>
<p>
    sTDMName = "/singletons/com.sun.star.reflection.theTypeDescriptionManager"
</p>
<p>
    oTDM = GetDefaultContext().getValueByName(sTDMName)
</p>
<p>
</p>
<p>
    If oTDM.hasByHierarchicalName(constString) Then
</p>
<p>
    GetOOoConst = oTDM.getByHierarchicalName(constString)
</p>
<p>
    Else
</p>
<p>
    MsgBox "Unrecognized name : " &amp; constString, 16, "OOo API constant or enum"
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<p>
    The method is usable to obtain constant and enumeration values from a text string
</p>
<p>
    Print GetOOoConst("com.sun.star.awt.FontSlant.ITALIC")
</p>
<p>
    This can also return an object that describes the type. This can be used to enumerate the values and the strings.
</p>
<p>
    <strong>Listing .</strong> Inspect enumerations.
</p>
<p>
    Sub EnumerateEnumerations(sName$)
</p>
<p>
    Dim oTD ' One Type Description.
</p>
<p>
    Dim oTDE ' Element enumeration
</p>
<p>
    Dim s$ ' Utility string variable.
</p>
<p>
    Dim sNames
</p>
<p>
    Dim lValues
</p>
<p>
    Dim i As Long
</p>
<p>
    Dim iCount As Integer
</p>
<p>
</p>
<p>
    oTD = GetOOoConst(sName)
</p>
<p>
    If IsNull(oTD) OR IsEmpty(oTD) Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
</p>
<p>
    If HasUnoInterfaces(oTD, "com.sun.star.reflection.XEnumTypeDescription") Then
</p>
<p>
</p>
<p>
    'MsgBox Join( oTD.getEnumNames(), CHR$(10))
</p>
<p>
    sNames = oTD.getEnumNames()
</p>
<p>
    lValues = otd.getEnumValues()
</p>
<p>
    For i = LBound(sNames) To UBound(sNames)
</p>
<p>
    iCount = iCount + 1
</p>
<p>
    If (iCount &gt; 40) Then
</p>
<p>
    MsgBox(s)
</p>
<p>
    s = ""
</p>
<p>
    End If
</p>
<p>
    s = s &amp; lValues(i) &amp; CHR$(9) &amp; sNames(i) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    ElseIf HasUnoInterfaces(oTD, "com.sun.star.reflection.XConstantsTypeDescription") Then
</p>
<p>
    lValues = oTD.getConstants()
</p>
<p>
    For i = LBound(lValues) To UBound(lValues)
</p>
<p>
    iCount = iCount + 1
</p>
<p>
    If (iCount &gt; 40) Then
</p>
<p>
    MsgBox(s)
</p>
<p>
    s = ""
</p>
<p>
    End If
</p>
<p>
    s = s &amp; lValues(i).getConstantValue() &amp; CHR$(9) &amp; lValues(i).getName() &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    Else
</p>
<p>
    'Inspect oTD
</p>
<p>
    MsgBox "Unsupported type " &amp; sName
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    This can be used to see enumerations.
</p>
<p>
    EnumerateEnumerations("com.sun.star.awt.FontSlant")
</p>
<p>
    This can be used to see constant groups.
</p>
<p>
    EnumerateEnumerations("com.sun.star.awt.FontWeight")
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="use-object-or-variant">
                    <span id="anchor-191"></span>Use Object or Variant
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    It is almost always safe to use Object variables to hold UNO services. It is so safe, apparently, that even the
    macro recorder uses Object variables to hold UNO services. Unfortunately, it is not always safe. The OOo Developer’s
    Guide specifically states that Variant variables should be used instead of Object variables. Always use the type
    Variant to declare variables for UNO services, not the type Object. The OOo Basic type Object is tailored for pure
    OOo Basic objects<em><em> — </em></em>in other words, objects that can be created with the Dim As New syntax. The
    Variant variables are best for UNO services to avoid problems that can result from the OOo Basic specific behavior
    of the type Object. I asked Andreas Bregas (one of the primary developers for the OOo Basic infrastructure) about
    this, and he said that in most cases, both work. The OOo Developer’s Guide prefers Variant because there are some
    odd situations in which the usage of type Object leads to an error due to the old Basic Object type semantics. But
    if a Basic program uses type Object, it will almost always run correctly and there should be no problems. It is
    sufficiently rare, however, that he could not remember an example where it was a problem. On the other hand, with
    OOo version 1, I experienced a problem that corrected itself, when I changed the variable type from Variant to
    Object.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="comparing-uno-variables">
                    <span id="anchor-192"></span>Comparing UNO variables
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the EqualUnoObjects function to determine if two UNO objects are the same object. UNO structures are copied by
    value but UNO services are copied by reference. This means that EqualUnoObjects should always return False for two
    variables that contain a structure, and it might return True for UNO services.
</p>
<p>
    Dim vObj
</p>
<p>
    vObj = ThisComponent
</p>
<p>
    Print EqualUnoObjects(vObj, ThisComponent) 'True
</p>
<p>
</p>
<p>
    Dim aProp As New com.sun.star.beans.PropertyValue
</p>
<p>
    vObj = aProp
</p>
<p>
    Print EqualUnoObjects(vObj, aProp) 'False
</p>
<p>
    After using OOo for many years, I finally found a use for EqualUnoObjects. Be warned that this is an advance topic
    and makes use of constructs not widely known. The problem as posed is: “When a button is pressed in a Calc document,
    I want to know which cell contains the button.” Here are some bits of information to help understand the problem:
</p>
<ul>
    <li>
        Each document has at least one “draw page” that contains graphical things such as images imbedded in the
        document.
    </li>
    <li>
        You can embed controls such as a button in a document. When the button is pressed, and a macro is called, it is
        trivial to get a reference to the control “data model”.
    </li>
    <li>
        Each control has a shape embedded in the draw page.
    </li>
    <li>
        Each control also has a “data model” that contains properties and other similar things.
    </li>
    <li>
        From a control data model I cannot easily obtain the shape or the cell containing the control.
    </li>
    <li>
        From a shape in a Calc document, I can easily find the cell – if the control is anchored to a cell.
    </li>
</ul>
<p>
    My solution was to find the shape associated with a control. It is easy to find the control name, but, a control
    name need not be unique. I opted to look at every shape on the draw page and then check to see if the control
    associated with that shape is the same object as the control in question.
</p>
<p>
    <strong>Listing .</strong> Find the control shape for a specific control.
</p>
<p>
    Function FindCellWithControl(oDrawPage, oControl)
</p>
<p>
    Dim oShape
</p>
<p>
    Dim oAnchor
</p>
<p>
    oShape = FindShapeForControl(oDrawPage, oControl)
</p>
<p>
    If Not IsEmpty(oShape) Then
</p>
<p>
    If oShape.getAnchor().supportsService("com.sun.star.sheet.SheetCell") Then
</p>
<p>
    FindCellWithControl = oShape.getAnchor()
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<p>
    Function FindShapeForControl(oDrawPage, oControl)
</p>
<p>
    Dim i
</p>
<p>
    Dim oShape
</p>
<p>
    For i = 0 To oDrawPage.getCount()
</p>
<p>
    oShape = oDrawPage.getByIndex(i)
</p>
<p>
    If oShape.supportsService("com.sun.star.drawing.ControlShape") Then
</p>
<p>
    If EqualUNOObjects(oControl, oShape.Control) Then
</p>
<p>
    FindShapeForControl = oShape
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End Function
</p>
<p>
    What does the event handler called by the button look like?
</p>
<p>
    Sub ButtonHandler(oEvent)
</p>
<p>
    Dim oControlModel
</p>
<p>
    Dim oParent
</p>
<p>
    Dim oCell
</p>
<p>
</p>
<p>
    'Print oEvent.Source.Model.getName()
</p>
<p>
    oControlModel = oEvent.Source.Model
</p>
<p>
</p>
<p>
    oParent = oControlModel.getParent()
</p>
<p>
    Do While NOT oParent.supportsService("com.sun.star.sheet.SpreadsheetDocument")
</p>
<p>
    oParent = oParent.getParent()
</p>
<p>
    Loop
</p>
<p>
</p>
<p>
    oCell = FindCellWithControl(oParent.getCurrentController().getActiveSheet().getDrawPage(), oControlModel)
</p>
<p>
    If NOT IsEmpty(oCell) Then
</p>
<p>
    Print "Control is in cell " &amp; oCell.AbsoluteName
</p>
<p>
    Else
</p>
<p>
    Print "Unable to find cell with control"
</p>
<p>
    ENd If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="built-in-global-uno-variables">
                    <span id="anchor-193"></span>Built-in global UNO variables
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic contains built-in global variables that provide quick access to frequently used components in OOo. The
    most commonly used variable is ThisComponent, which refers to the currently active document. To demonstrate using
    the variable ThisComponent, the macro in displays all of the styles in the current document. is only one of the many
    dialogs that are displayed while the macro runs. The fact that a style exists in a document does not imply that the
    style is actually used in the document.
</p>
<p>
    <strong>Listing .</strong> Display all styles known by this document.
</p>
<p>
    Sub DisplayAllStyles
</p>
<p>
    Dim vFamilies As Variant 'All the style types
</p>
<p>
    Dim vFamNames As Variant 'Array with names of the style types
</p>
<p>
    Dim vStyles As Variant 'One style type such as Number or Page Styles
</p>
<p>
    Dim vStlNames As Variant 'Array with names of specific styles
</p>
<p>
    Dim s As String 'Message to display
</p>
<p>
    Dim n As Integer 'Iterate through the style types
</p>
<p>
    Dim i As Integer 'Iterate through the styles
</p>
<p>
</p>
<p>
    vFamilies = ThisComponent.StyleFamilies 'Get the styles
</p>
<p>
    vFamNames = vFamilies.getElementNames() 'What type of styles?
</p>
<p>
    For n = LBound(vFamNames) To UBound(vFamNames) 'Look at all style types
</p>
<p>
    s = ""
</p>
<p>
    vStyles = vFamilies.getByName(vFamNames(n)) 'Get styles of a type
</p>
<p>
    vStlNames = vStyles.getElementNames() 'names of styles for type
</p>
<p>
    For i = LBound(vStlNames) To UBound (vStlNames) 'for all styles of a type
</p>
<p>
    s=s &amp; i &amp; " : " &amp; vStlNames(i) &amp; Chr$(13) 'Build a display string
</p>
<p>
    If ((i + 1) Mod 35 = 0) Then 'Display 35 at a time
</p>
<p>
    MsgBox s,0,vFamNames(n) 'Display them
</p>
<p>
    s = "" 'Clear string, start over
</p>
<p>
    End If
</p>
<p>
    Next i 'Next style
</p>
<p>
    If Len(s) &gt; 0 Then MsgBox s,0,vFamNames(n) 'Leftover styles for type
</p>
<p>
    Next n 'Next style type
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000C4000000EC468C727A.png" style="width:2.0417in;height:2.4583in" />
</p>
<p>
    <strong>Figure .</strong> Frame styles known by the current document.
</p>
<p>
    OpenOffice is based on the same code as StarOffice, which had a desktop. All of the individual windows were
    contained in this desktop. The desktop paradigm is now gone, but for legacy reasons a desktop object still acts as
    the global application that ties all of the documents together. Although I frequently see code that creates a
    desktop service by using the function CreateUnoService, this is not required in OOo Basic. OOo Basic provides the
    variable StarDesktop, which accesses the primary desktop service in OOo. The macro in demonstrates the use of the
    StarDesktop by traversing all of the currently open documents. The getDocType method is defined in .
</p>
<p>
    <strong>Listing .</strong> Inspect each open component.
</p>
<p>
    Sub IterateThroughAllDocs
</p>
<p>
    On Error Resume Next 'Ignore the non-document components
</p>
<p>
    Dim vComponents As Object 'All of the components
</p>
<p>
    Dim vDocs As Object 'Enumeration of the documents
</p>
<p>
    Dim vDoc As Object 'A single document
</p>
<p>
    Dim s As String
</p>
<p>
    GlobalScope.BasicLibraries.LoadLibrary("Tools")'Contains FileNameOutOfPath
</p>
<p>
    vComponents = StarDesktop.getComponents() 'Get all the components
</p>
<p>
    vDocs = vComponents.createEnumeration() 'Enumerate them
</p>
<p>
    Do While vDocs.hasMoreElements() 'While there are more
</p>
<p>
    vDoc = vDocs.nextElement() 'Get the next component
</p>
<p>
    s = s &amp; getDocType(vDoc) &amp; " " 'Add the document type
</p>
<p>
    s = s &amp; FileNameOutOfPath(vDoc.getURL()) 'Add the file name
</p>
<p>
    s = s &amp; CHR$(10) 'Add a new line
</p>
<p>
    Loop
</p>
<p>
    MsgBox s, 0, "Currently Open Components"
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The primary visible windows in OOo are called “components.” Every open document is a component, as is
                the Basic IDE and the Help window. In OOo, the word “component” almost always means an open document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    While iterating through the open documents (components), you may find some unexpected documents. These are component
    windows such as the Basic IDE and the Help window. The macro in uses the function FileNameOutOfPath. This is another
    macro and is not a function that is built into OOo Basic. This function is stored in the Strings module of the
    application-level Tools library. If a library is not currently loaded, you cannot call the methods that it contains.
</p>
<p>
    The GlobalScope variable references the application-level libraries and is used to load the Tools library. Loading a
    library loads all of the modules in the specified library. OOo contains libraries and modules that are not built
    into OOo Basic. Use the LoadLibrary method before you use the routines in the libraries.
</p>
<p>
    GlobalScope.BasicLibraries.LoadLibrary("Tools")
</p>
<p>
    To access the Basic libraries in the current document, either use the BasicLibraries global variable or access the
    BasicLibraries property in the current document.
</p>
<p>
    Print EqualUnoObjects(vObj.BasicLibraries, BasicLibraries) 'True
</p>
<p>
    Use the DialogLibraries variable to access the dialog libraries in the current document. Unlike BasicLibraries, an
    individual document does not contain a property called DialogLibaries to directly obtain the dialog libraries for a
    specific document. You can easily obtain the dialog and Basic libraries for a specific document through a less
    direct route. Each document has a LibraryContainer property.
</p>
<p>
    ThisComponent.LibraryContainer.getByName("OOME_30").getModuleContainer()
</p>
<p>
    ThisComponent.LibraryContainer.getByName("OOME_30").getDialogContainer()
</p>
<p>
    The getByName() method on the LibraryContainer returns the named library. The getModuleContainer() method returns
    the Basic container for the specified library, and the getDialogContainer() method returns the Dialog container for
    the specified library. The code in , however, uses the variables DialogLibraries and BasicLibraries to list the
    number of dialogs and modules in each library in the current document. shows the results.
</p>
<p>
    <strong>Listing .</strong> View the libraries and dialogs stored in the current document.
</p>
<p>
    Sub ExamineDocumentLibraries
</p>
<p>
    Dim vLibs 'Hold the library names
</p>
<p>
    Dim vMod 'Hold the modules/dialogs object
</p>
<p>
    Dim nNumMods% 'Number of modules or dialogs in a library
</p>
<p>
    Dim i% 'Scrap index variable
</p>
<p>
    Dim s$ 'Scrap string variable
</p>
<p>
    s = "*** Dialog Libs In Document" &amp; CHR$(10) 'Initialize s
</p>
<p>
    vLibs = DialogLibraries.getElementNames() 'Library names
</p>
<p>
    For i = LBound(vLibs) To UBound(vLibs) 'Look at each name
</p>
<p>
    vMod = DialogLibraries.getByName(vLibs(i)) 'Get the dialog library
</p>
<p>
    nNumMods = UBound(vMod.getElementNames()) + 1 'How many dialogs
</p>
<p>
    s = s &amp; vLibs(i) &amp; " has " &amp; nNumMods &amp; " dialogs" 'Build string
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next i
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    s = s &amp; "*** Basic Libs In Document" &amp; CHR$(10) 'Ready for code libs
</p>
<p>
    vLibs = BasicLibraries.getElementNames() 'Library names
</p>
<p>
    For i = LBound(vLibs) To UBound(vLibs) 'Look at each name
</p>
<p>
    vMod = BasicLibraries.getByName(vLibs(i)) 'Get the code library
</p>
<p>
    nNumMods = UBound(vMod.getElementNames()) + 1 'Number of modules
</p>
<p>
    s = s &amp; vLibs(i) &amp; " has " &amp; nNumMods &amp; " modules" 'Build the string
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next i
</p>
<p>
    MsgBox s, 0, "Libraries"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000D0000000B066005C7B.png" style="width:2.1665in;height:1.8335in" />
</p>
<p>
    <strong>Figure .</strong> Dialog and Basic libraries in the current document.
</p>
<p>
    To view the libraries in the application-level library container, modify the code in . Add GlobalScope before each
    occurrence of BasicLibraries and DialogLibraries.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="creating-uno-values-for-ooo-internals">
                    <span id="anchor-194"></span>Creating UNO values for OOo internals
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic does an excellent job of converting between the native Basic types and the types required internally by
    OOo. However, if you call a method on a Universal Network Object and OOo Basic doesn’t know what the type should be,
    it may not properly convert the type. For example, the setPropertyValue method in the XPropertySet interface accepts
    two arguments<em><em> — </em></em>a string name of the property to set and the value to set. The type of the value
    to set depends on which property is set. Use the function CreateUnoValue (shown in ) to create a reference to a
    Universal Network Object that contains the appropriate type if there is a problem creating the correct type. I have
    never seen this happen, so don’t fret that much about your arguments; you can almost always trust OOo Basic to do
    the correct thing.
</p>
<p>
    <strong>Listing .</strong> Use CreateUnoValue to create a reference to an internal UNO value.
</p>
<p>
    Dim v
</p>
<p>
    v = CreateUnoValue("unsigned long", 10)
</p>
<p>
    v = CreateUnoValue("string", "hello")
</p>
<p>
    v = CreateUnoValue("byte", 10) 'A byte is from 0 through 255
</p>
<p>
    v = CreateUnoValue("[]byte", Array(3, 2, 1)) 'You can even create arrays
</p>
<p>
    'v = CreateUnoValue("Byte", 10) 'No such element exception
</p>
<p>
    'v = CreateUnoValue("byte", 1000) 'Out of range exception
</p>
<p>
    'v = CreateUnoValue("uint64", 10) 'No such element exception
</p>
<p>
    The first argument to CreateUnoValue is the data type that should be created. The supported data types are void,
    char, boolean, byte, short, unsigned short, long, unsigned long, hyper, unsigned hyper, float, double, string, type,
    and any. The names are case sensitive and may be preceded by square brackets to indicate an array. The value
    returned by CreateUNOValue is not usable by OOo Basic; it is only useful to the internals of OOo. In other words, do
    not create a “byte” type and then expect to use it as a number.
</p>
<p>
    <strong>Listing .</strong> Test types supported by CreateUnoValue.
</p>
<p>
    Sub TestCreateUnoValues
</p>
<p>
    Dim typeNames
</p>
<p>
    Dim v
</p>
<p>
    Dim i%
</p>
<p>
    typeNames = Array("void", "boolean", "char", "byte", "string", _
</p>
<p>
    "short", "unsigned short", "long", "unsigned long", _
</p>
<p>
    "hyper", "unsigned hyper", "float", "double", "any")
</p>
<p>
</p>
<p>
    ' I took the list of names from
</p>
<p>
    ' cppu/source/typelib/typelib.cxx
</p>
<p>
    For i = LBound(typeNames) To UBound(typeNames)
</p>
<p>
    v = CreateUnoValue(typeNames(i), 65)
</p>
<p>
    ' You cannot directly use the value because it is an UNO type,
</p>
<p>
    ' which is only good for passing back into UNO.
</p>
<p>
    ' Things like "Print v" or "CStr(v)" will fail.
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="finding-objects-and-properties">
                    <span id="anchor-195"></span>Finding objects and properties
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic has functions to find variables and their properties based on their names. This functionality was
    initially described to me as poorly documented, possibly deprecated, and buggy<em><em> — </em></em>and I cannot
    disagree. Use FindObject to obtain a reference to a variable with a given name, and FindPropertyObject to obtain a
    reference to a named property of an object. The macro in demonstrates some of the idiosyncrasies of the FindObject
    and FindPropertyObject functions.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Do not use the functions FindObject and FindPropertyObject — they are poorly documented, buggy, and
                likely to be deprecated. I only mention the methods to be complete.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Test the FindObject method.
</p>
<p>
    Sub TestFindObject
</p>
<p>
    Dim oTst
</p>
<p>
    Dim oDoc 'Initial value is EMPTY, whis ic not null.
</p>
<p>
    Dim oLib 'Gimmicks library.
</p>
<p>
    Dim oMod 'UserFields module in the Gimmicks library.
</p>
<p>
    Dim s$
</p>
<p>
</p>
<p>
    oTst = FindObject("oDoc")
</p>
<p>
</p>
<p>
    s = "oTst = FindObject(""oDoc""), " &amp; CHR$(10) &amp; _
</p>
<p>
    "IsNull(oTst) = " &amp; IsNull(oTst) &amp; _
</p>
<p>
    " and (oTst IS oDoc) = " &amp; (oTst IS oDoc)
</p>
<p>
</p>
<p>
    Rem Test against the current document
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    oTst = FindObject("oDoc")
</p>
<p>
</p>
<p>
    s = s &amp; CHR$(10) &amp; CHR$(10) &amp; _
</p>
<p>
    "oDoc = ThisComponent" &amp; CHR$(10) &amp; _
</p>
<p>
    "oTst = FindObject(""oDoc"")" &amp; CHR$(10) &amp; _
</p>
<p>
    "oDoc IS ThisComponent = " &amp; (oDoc IS ThisComponent) &amp; CHR$(10) &amp; _
</p>
<p>
    "oTst IS oDoc = " &amp; (oTst IS oDoc) &amp; CHR$(10) &amp; _
</p>
<p>
    "oTst IS ThisComponent = " &amp; (oTst IS ThisComponent) &amp; _
</p>
<p>
    CHR$(10) &amp; CHR$(10) &amp; _
</p>
<p>
    "oTst = FindObject(""ThisComponent"")" &amp; CHR$(10)
</p>
<p>
    REM Do it again, but do search for ThisComponent
</p>
<p>
    oTst = FindObject("ThisComponent")
</p>
<p>
</p>
<p>
    s = s &amp; "oTst IS oDoc" &amp; (oTst IS oDoc) &amp; CHR$(10) &amp; _
</p>
<p>
    "oTst IS ThisComponent = " &amp; (oTst IS ThisComponent) &amp; CHR$(10) &amp; _
</p>
<p>
    "oDoc IS ThisComponent = " &amp; ( oDoc IS ThisComponent) &amp; CHR$(10)
</p>
<p>
    REM ThisComponent has a DocumentInfo property
</p>
<p>
    oTst = FindPropertyObject(ThisComponent, "DocumentInfo")
</p>
<p>
</p>
<p>
    s = s &amp; "IsNull(FindPropertyObject(ThisComponent, " &amp; _
</p>
<p>
    """DocumentInfo""))" &amp; CHR$(10) &amp; _
</p>
<p>
    "returns " &amp; IsNull(oTst)
</p>
<p>
</p>
<p>
    MsgBox s
</p>
<p>
</p>
<p>
</p>
<p>
    REM Load the Gimmicks library
</p>
<p>
    GlobalScope.BasicLibraries.LoadLibrary("Gimmicks")
</p>
<p>
</p>
<p>
    REM Find the library even though it is not a variable
</p>
<p>
    oLib = FindObject("Gimmicks")
</p>
<p>
</p>
<p>
    REM userfields is a module in the Gimmicks library
</p>
<p>
    oMod = FindPropertyObject(oLib, "Userfields")
</p>
<p>
</p>
<p>
    s = "And now for something different." &amp; CHR$(10) &amp; _
</p>
<p>
    "Find the loaded Gimmicks library" &amp; CHR$(10) &amp; _
</p>
<p>
    "oMod Is Gimmicks.Userfields = " &amp; (oMod Is Gimmicks.Userfields)
</p>
<p>
</p>
<p>
    MsgBox s
</p>
<p>
</p>
<p>
    'The StartChangesUserfields function is in the module Userfields
</p>
<p>
    'Call the routine
</p>
<p>
    Print "Call 'StartChangesUserfields' directly"
</p>
<p>
    oLib.Userfields.StartChangesUserfields
</p>
<p>
    Print "Call 'StartChangesUserfields' using oMod"
</p>
<p>
    oMod.StartChangesUserfields
</p>
<p>
    End Sub
</p>
<p>
    If these functions serve your purposes, use them. I tried to use these to write an object inspector, but the
    FindPropertyObject function did not work as I expected.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="uno-listeners">
                    <span id="anchor-196"></span>UNO listeners
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo uses listeners to inform other objects what it is doing. Consider a hospital worker as an analogy: Before I (the
    hospital worker) do anything interesting to treat patient Paolo, I am required first to call his parents. For some
    things the parents may say “no, you cannot do that”, and for others the parents are only informed (status updates).
    This is very similar to UNO listeners. The code that you write is called the listener, and the thing to which you
    listen is called the broadcaster. In the previous example, the hospital worker is the broadcaster and Paolo’s
    parents are the listeners.
</p>
<p>
    You can listen to the OOo objects that act as a broadcaster. The routines required to listen to a specific OOo
    interface are specific to that interface. In other words, the set of subroutines and functions that can act as a
    listener to printing events is different than the set of subroutines and functions that can listen to keystroke
    events.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                If you do not implement a required method specified for the listener interface, the listener may crash
                OOo.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="your-first-listener">
                            <span id="anchor-197"></span>Your first listener
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    This listener is presented with details that are explained in the next section, so, follow the easy process and then
    find out why. A print listener is demonstrated in section <a href="#anchor-198">13.15.3</a> <a href="#anchor-198">A
        Calc example with a Print listener</a>.
</p>
<p>
    All listeners must implement the methods in the com.sun.star.lang.XEventListener interface, which defines a one
    subroutine; disposing(EventObject). The disposing method is called when the broadcaster is about to become
    unavailable. In other words, the broadcaster will no longer exist and you should not use it. For example, a print
    job is finished so it is no longer required or a document is closing. demonstrates the most basic listener possible,
    XEventListener; Notice the string prefix “first_listen_” before the required name “disposing”; I chose
    “first_listen_” because it is descriptive.
</p>
<p>
    <strong>Listing .</strong> Simple listener that does nothing.
</p>
<p>
    Sub first_listen_disposing( vArgument )
</p>
<p>
    MsgBox "Disposing In First Listener"
</p>
<p>
    End Sub
</p>
<p>
    is all that is required for this simple listener. Use the CreateUNOListener to create a UNO listener that is
    associated with the macro in . The first argument is the string prefix and the second argument is the name of the
    service to create.
</p>
<p>
    The routine in creates the UNO listener and associates it with the routine in . When the disposing method is called
    on vListener, it calls the routine in .
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The code in creates a listener and then calls the objects disposing method. The listener is implemented
                in , so, this ultimately calls first_listen_disposing in .
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Create a listener and then call the disposing method.
</p>
<p>
    Sub MyFirstListener
</p>
<p>
    Dim vListener
</p>
<p>
    Dim vEventObj As New com.sun.star.lang.EventObject
</p>
<p>
    Dim sPrefix$
</p>
<p>
    Dim sService$
</p>
<p>
    sPrefix = "first_listen_"
</p>
<p>
    sService = "com.sun.star.lang.XEventListener"
</p>
<p>
    vListener = CreateUnoListener(sPrefix, sService)
</p>
<p>
    vListener.disposing(vEventObj)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="a-complete-listener-selection-change-listener">
                            <span id="anchor-199"></span>A complete listener: selection change listener
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The two most difficult parts of creating a listener are determining which broadcaster and which listener interface
    to use. The rest of the steps are easier.
</p>
<ol type="1">
    <li>
        Determine the broadcaster to use.
    </li>
    <li>
        Determine the listener interface to implement.
    </li>
    <li>
        Create global variables for the listener and maybe the broadcaster. Test your understanding and ask yourself why
        the variable must be global before reading the tip below.
    </li>
    <li>
        Determine the prefix that you will use; make it descriptive.
    </li>
    <li>
        Write all of the subroutines and functions that implement the listener.
    </li>
    <li>
        Create the UNO listener and save it in the global variable.
    </li>
    <li>
        Register the listener with the broadcaster.
    </li>
    <li>
        When finished, remove the listener from the broadcaster.
    </li>
</ol>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Why store the listener in a global variable? There is usually a subroutine to create and register the
                listener with the broadcaster and then the macro ends. The listener must exist when the macro stops
                running. The only way to do this in Basic is to use a Global variable. Another macro, run later, removes
                the listener from the broadcaster. The latter macro must be able to access the listener.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Knowing which broadcaster to use is not always an easy task. It requires understanding how OOo is designed; this
    comes with experience. There is usually an obvious place to start looking<em><em> — </em></em>the current document,
    available from the variable ThisComponent, contains the document data. For example, the document accepts an
    XPrintJobListener to monitor how printing is progressing. Most tasks related to user interactions<em><em> —
        </em></em>such as selecting text, moving the mouse, and entering keystrokes<em><em> — </em></em>all go through
    the document’s controller.
</p>
<p>
    After selecting the broadcaster check the broadcaster for methods with names like “add listener”. I was asked how to
    prevent a dialog from closing when the user clicks on the little X icon in the upper-right corner of a dialog. I
    reasoned that the dialog is probably the correct broadcaster to use, so I created a dialog and inspected the
    “dbg_methods” property to see which listeners it supports (each supported listener has “set” and “remove” methods).
    Another option is to determine the event type that is produced and then search for broadcasters supporting this
    event type. I usually do this by searching the OOo Developer’s Guide and the Internet; I discuss effective methods
    for finding information in Chapter <a href="#anchor-200">19</a>, <a href="#anchor-200">Sources of Information</a>.
</p>
<p>
    To listen for a selection change event, implement an XSelectionChangeListener and register it with the current
    controller. The XSelectionChangeListener interface defines only one subroutine that must be implemented<em><em> —
        </em></em>selectionChanged(ObjectEvent). All listeners are derived from the XEventListener so the
    disposing(ObjectEvent) method must also be implemented. The fastest way to determine which subroutines and functions
    must be implemented is to create an instance of the listener by using the function CreateUNOListener and then
    inspect the dbg_methods property (see and).
</p>
<p>
    <strong>Listing .</strong> See the methods supported by a specific listener.
</p>
<p>
    Sub InspectListenerMethods
</p>
<p>
    Dim sPrefix$
</p>
<p>
    Dim sService$
</p>
<p>
    Dim vService
</p>
<p>
    sPrefix = "sel_change_"
</p>
<p>
    sService = "com.sun.star.view.XSelectionChangeListener"
</p>
<p>
    vService = CreateUnoListener(sPrefix, sService)
</p>
<p>
    DisplayDbgInfoStr(vService.dbg_methods, ";", 35, "Methods")
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000012B0000007462F7C926.png" style="width:3.1146in;height:1.2083in" />
</p>
<p>
    <strong>Figure .</strong> Ignore the queryInterface method.
</p>
<p>
    The queryInterface method is from the interface com.sun.star.uno.XInterface, which is inherited from the
    XEventListener. You can ignore this method. However, you must implement the rest of the routines. Choose a
    descriptive prefix so that the code can contain more than one listener. See .
</p>
<p>
    <strong>Listing .</strong> Disposing and selection changed.
</p>
<p>
    'All listeners must support this event
</p>
<p>
    Sub sel_change_disposing(vEvent)
</p>
<p>
    msgbox "disposing the selection change listener"
</p>
<p>
    End Sub
</p>
<p>
    Sub sel_change_selectionChanged(vEvent)
</p>
<p>
    Dim vCurrentSelection As Object
</p>
<p>
    vCurrentSelection = vEvent.source
</p>
<p>
    Print "Number of selected areas = " &amp;_
</p>
<p>
    vCurrentSelection.getSelection().getCount()
</p>
<p>
    End Sub
</p>
<p>
    The routine in creates a listener by calling the function CreateUnoListener. When I tested this listener, I ran the
    macro and then the macro stopped running. The listener is still active and called by the broadcaster even though the
    macro is no longer running. In other words, the routine in registers a listener, and then it is finished. The
    broadcaster calls the listener when things occur. The listener must be stored in a global variable so that it’s
    available later<em><em> — </em></em>for example, when it’s time to remove the listener from the object or when one
    of the methods is called.
</p>
<p>
    <strong>Listing .</strong> Start listening for selection change events.
</p>
<p>
    Global vSelChangeListener 'Must be global
</p>
<p>
    Global vSelChangeBroadCast
</p>
<p>
    'Run this macro to start event intercepting
</p>
<p>
    Sub StartListeningToSelChangeEvents
</p>
<p>
    Dim sPrefix$
</p>
<p>
    Dim sService$
</p>
<p>
    sPrefix = "sel_change_"
</p>
<p>
    sService = "com.sun.star.view.XSelectionChangeListener"
</p>
<p>
</p>
<p>
    REM to register for a selection change, you must register with the
</p>
<p>
    REM current controller
</p>
<p>
    vSelChangeBroadCast = ThisComponent.getCurrentController
</p>
<p>
</p>
<p>
    'Create a listener to intercept the selection change events
</p>
<p>
    vSelChangeListener = CreateUnoListener(sPrefix, sService)
</p>
<p>
</p>
<p>
    'Register the listener to the document controller
</p>
<p>
    vSelChangeBroadCast.addSelectionChangeListener(vSelChangeListener)
</p>
<p>
    End Sub
</p>
<p>
    The behavior of the code in is annoying. Every time a new selection is made, the code is called and it opens a
    dialog on the screen. This interferes with selecting text. To remove the listener, use the code in .
</p>
<p>
    <strong>Listing .</strong> Stop listening for selection change events.
</p>
<p>
    Sub StopListeningToSelChangeEvents
</p>
<p>
    ' removes the listener
</p>
<p>
    vSelChangeBroadCast.removeSelectionChangeListener(vSelChangeListener)
</p>
<p>
    End Sub
</p>
<p>
    To test the listener:
</p>
<ol type="1">
    <li>
        Start listening.
    </li>
    <li>
        Make very simple selection changes such as: Click someplace. Shift+Click to select more. Ctrl+Click to make a
        second selection.
    </li>
    <li>
        Stop listening.
    </li>
</ol>
<p>
    Save all open documents while testing listeners, a simple error is likely to cause OOo to crash.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="creating-a-uno-dialog">
                    <span id="anchor-201"></span>Creating a UNO dialog
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use CreateUnoDialog to create an existing dialog. This section introduces the function CreateUnoDialog, it does not
    discuss how to create dialogs. CreateUnoDialog accepts a single argument, the full path to the dialog definition.
</p>
<p>
    CreateUnoDialog(GlobalScope.BasicLibraries.LibName.DialogName)
</p>
<p>
    The variable GlobalScope provides access to the application-level libraries. The Tools library contains the dialog
    named <em><em>DlgOverwriteAll; y</em></em>ou must load the library containing the dialog before you can use the
    dialog. You can manually load the library, or do it directly from the macro. Use Tools &gt; Macros &gt; Organize
    Dialogs to open the Basic Macros Organizer dialog, which can be used To manually load libraries. Use the LoadLibrary
    command to load a library using a macro.
</p>
<p>
    GlobalScope.BasicLibraries.LoadLibrary("Tools")
</p>
<p>
    CreateUnoDialog(GlobalScope.BasicLibraries.Tools.DlgOverwriteAll)
</p>
<p>
    If the dialog is defined inside a document, use the BasicLibraries variable.
</p>
<p>
    CreateUnoDialog(BasicLibraries.LibName.DialogName)
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                An event means that something happened. When certain things happen, an event object is created that
                describes something about what happened. The event object is sent to a listener, or what ever routine is
                configured to be called when the event occurs. You can write an “event” routine that is called when
                something happens; for example, when a button is pressed.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When you create a dialog, you usually write event handlers as subroutines in Basic; for example, a button in a
    dialog does nothing unless events are mapped to subroutines or functions that you write. You can add a close button
    to a dialog and map the button's “Execute action” event to a macro that closes the dialog. If a macro called from an
    event handler accesses a running dialog, then the dialog must be stored in a variable that the macro can access. I
    generally choose to create a private variable that holds this type of data. See .
</p>
<p>
    <strong>Listing .</strong> Display information about an object using a dialog.
</p>
<p>
    Private MySampleDialog
</p>
<p>
    Sub DisplayObjectInformation(Optional vOptionalObj)
</p>
<p>
    Dim vControl 'Access the text control in the dialog.
</p>
<p>
    Dim s$ 'Temporary string variable.
</p>
<p>
    Dim vObj 'Object about which to display information.
</p>
<p>
</p>
<p>
    REM If vOptionalObj object is not provided, use the current document.
</p>
<p>
    If IsMissing(vOptionalObj) Then
</p>
<p>
    vObj = ThisComponent
</p>
<p>
    Else
</p>
<p>
    vObj = vOptionalObj
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM Create the dialog and set the title
</p>
<p>
    MySampleDialog = CreateUnoDialog(DialogLibraries.OOME_30.MyFirstDialog)
</p>
<p>
    MySampleDialog.setTitle("Variable Type " &amp; TypeName(vObj))
</p>
<p>
</p>
<p>
    REM Get the text field from the dialog
</p>
<p>
    REM I added this text manually
</p>
<p>
    vControl = MySampleDialog.getControl("TextField1")
</p>
<p>
</p>
<p>
    If InStr(TypeName(vObj), "Object") &lt; 1 Then
</p>
<p>
    REM If this is NOT an object, simply display simple information
</p>
<p>
    vControl.setText(Dlg_GetObjTypeInfo(vObj))
</p>
<p>
</p>
<p>
    ElseIf NOT HasUnoInterfaces(vObj, "com.sun.star.uno.XInterface") Then
</p>
<p>
    REM It is an object but it is not a UNO object.
</p>
<p>
    REM Cannot call HasUnoInterfaces if it is not an UNO object.
</p>
<p>
    vControl.setText(Dlg_GetObjTypeInfo(vObj))
</p>
<p>
</p>
<p>
    Else
</p>
<p>
    REM This is a UNO object so attempt to access the "dbg_" properties
</p>
<p>
    MySampleDialog.setTitle("Variable Type " &amp; vObj.getImplementationName())
</p>
<p>
    s = "*************** Methods **************" &amp; CHR$(10) &amp;_
</p>
<p>
    Dlg_DisplayDbgInfoStr(vObj.dbg_methods, ";") &amp; CHR$(10) &amp;_
</p>
<p>
    "*************** Properties **************" &amp; CHR$(10) &amp;_
</p>
<p>
    Dlg_DisplayDbgInfoStr(vObj.dbg_properties, ";") &amp; CHR$(10) &amp;_
</p>
<p>
    "*************** Services **************" &amp; CHR$(10) &amp;_
</p>
<p>
    Dlg_DisplayDbgInfoStr(vObj.dbg_supportedInterfaces, CHR$(10))
</p>
<p>
    vControl.setText(s)
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM tell the dialog to start itself
</p>
<p>
    MySampleDialog.execute()
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Store the dialog in a private variable declared as type Object. Use a private variable so that it
                doesn’t needlessly affect other modules. On at least one occasion, a dialog that I created worked when
                it was held in a variable declared as an Object, but failed when held in a variable declared as a
                Variant; so much for my recommendation to usually a variant rather than an Object.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in displays a dialog that displays information about the object that was passed in as an argument. I use
    the HasUnoInterfaces function to see if this is a UNO service. I first check to see if the object’s TypeName
    contains the text “Object”; this tells me if the object is really an object.
</p>
<p>
    If InStr(TypeName(vObj), "Object") &lt; 1 Then
</p>
<p>
    If the object is not an object that supports a UNO interface, the object is inspected and information about it
    displayed. shows the text string to do this. shows the results.
</p>
<p>
    <strong>Listing .</strong> Return type information as a string.
</p>
<p>
    Function Dlg_GetObjTypeInfo(vObj) As String
</p>
<p>
    Dim s As String
</p>
<p>
    s = "TypeName = " &amp; TypeName(vObj) &amp; CHR$(10) &amp;_
</p>
<p>
    "VarType = " &amp; VarType(vObj) &amp; CHR$(10)
</p>
<p>
    If IsNull(vObj) Then
</p>
<p>
    s = s &amp; "IsNull = True"
</p>
<p>
    ElseIf IsEmpty(vObj) Then
</p>
<p>
    s = s &amp; "IsEmpty = True"
</p>
<p>
    Else
</p>
<p>
    If IsObject(vObj) Then s = s &amp; "IsObject = True" &amp; CHR$(10)
</p>
<p>
    If IsUnoStruct(vObj) Then s = s &amp; "IsUnoStruct = True" &amp; CHR$(10)
</p>
<p>
    If IsDate(vObj) Then s = s &amp; "IsDate = True" &amp; CHR$(10)
</p>
<p>
    If IsNumeric(vObj) Then s = s &amp; "IsNumeric = True" &amp; CHR$(10)
</p>
<p>
    If IsArray(vObj) Then
</p>
<p>
    On Local Error Goto DebugBoundsError:
</p>
<p>
    Dim i%, sTemp$
</p>
<p>
    s = s &amp; "IsArray = True" &amp; CHR$(10) &amp; "range = ("
</p>
<p>
    Do While (i% &gt;= 0)
</p>
<p>
    i% = i% + 1
</p>
<p>
    sTemp$ = LBound(vObj, i%) &amp; " To " &amp; UBound(vObj, i%)
</p>
<p>
    If i% &gt; 1 Then s = s &amp; ", "
</p>
<p>
    s = s &amp; sTemp$
</p>
<p>
    Loop
</p>
<p>
    DebugBoundsError:
</p>
<p>
    On Local Error Goto 0
</p>
<p>
    s = s &amp; ")" &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Dlg_GetObjTypeInfo = s
</p>
<p>
    End Function
</p>
<p>
    <img src="Pictures/100000000000012900000066AE1947C5.png" style="width:3.0937in;height:1.0626in" />
</p>
<p>
    <strong>Figure .</strong> The variable is an array of strings
</p>
<p>
    If the first argument supports a UNO interface, the “dbg_” properties are used to display all of the methods,
    properties, and services supported by this object (see and ). This is very similar to the code in , except that it
    returns a string rather than displaying a series of simple dialogs. This is an excellent way to quickly see what
    methods, properties, and interfaces an object supports. Notice also that the variable type is displayed in the
    upper-left corner of the dialog.
</p>
<p>
    <strong>Listing .</strong> Convert the debug string into one string with new line characters.
</p>
<p>
    Function Dlg_DisplayDbgInfoStr(sInfo$, sSep$) As String
</p>
<p>
    Dim aInfo() 'Array to hold each string
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
    Dim j As Integer 'Junk integer variable for temporary values
</p>
<p>
    Dim s As String 'holds the portion that is not completed
</p>
<p>
    s = sInfo$
</p>
<p>
    j = InStr(s, ":") 'Initial colon
</p>
<p>
    If j &gt; 0 Then Mid(s, 1, j, "") 'Remove portion up to the initial colon
</p>
<p>
    aInfo() = Split(s, sSep$) 'Split string based on delimiter
</p>
<p>
    For i = LBound(aInfo()) To Ubound(aInfo()) 'Look at each piece to remove
</p>
<p>
    aInfo(i) = Trim(aInfo(i)) 'leading and trailing spaces
</p>
<p>
    j = InStr(aInfo(i), CHR$(10)) 'Some have an extra
</p>
<p>
    If j &gt; 0 Then Mid(aInfo(i), j, 1, "") 'new line that should be removed
</p>
<p>
    Next
</p>
<p>
    Dlg_DisplayDbgInfoStr = Join(aInfo(), CHR$(10))
</p>
<p>
    End Function
</p>
<p>
    <img src="Pictures/10000000000002860000019BE3D1192C.png" style="width:6.7291in;height:4.2811in" />
</p>
<p>
    <strong>Figure .</strong> The variable is a Writer document.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-8">
                    <span id="anchor-202"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The subroutines and functions supplied with OOo Basic support a wide range of operations that are required to access
    the internals of OOo. Use the methods presented in this chapter to inspect and use the UNO services. This chapter
    examined the fundamentals for creating UNO listeners. UNO listeners provide basic system functionality, and new UNO
    listeners extend this functionality to give the programmer a great deal of control over system applications and
    behavior. Any UNO listener listens to one or more broadcasters, providing the capability to respond to system events
    that are communicated across applications.
</p>
<ol type="1">
    <li>
        <h1 id="the-dispatcher">
            <span id="anchor-203"></span>The Dispatcher
        </h1>
    </li>
</ol>
<p>
    This chapter builds on previous coverage of the OpenOffice.org paradigm and then introduces the dispatcher. The
    dispatcher provides a simple mechanism for invoking internal functionality with limited knowledge of how the
    internals work, but it is considered the least-favored way of controlling OpenOffice.org.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="the-environment">
                    <span id="anchor-204"></span>The environment
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OpenOffice.org separates a component’s (document's) functionality into the model, the controller, and the frame.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Component almost always means an open document, but other windows are also components; for example, the
                Basic IDE and the help window.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="two-different-methods-to-control-ooo">
                            <span id="anchor-205"></span>Two different methods to control OOo
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The most versatile method to manipulate an OOo document is to get the internal UNO objects and manipulate them.
    Using the model provides significant control, but you must understand much about the different services and
    interfaces.
</p>
<p>
    Another method, which requires very little understanding of the OOo internals, is to use a UNO dispatcher. The
    dispatcher accepts a command such as “.uno:Undo” and takes care of the rest of the details. The frame provides the
    required dispatchers to perform the work. For simplicity, think of issuing a dispatch as very similar to selecting
    an action from the menu.
</p>
<p>
    Although direct control using UNO services provides the most control and versatility, some operations are much
    easier to perform using the dispatcher; sometimes a dispatcher is the only way to accomplish a task. For example,
    the dispatcher is the best solution for handling the clipboard. Even the macro recorder performs almost all tasks
    using a dispatcher.
</p>
<p>
    Three things are required to accomplish tasks using a dispatcher: (1) the command to dispatch, (2) arguments that
    control the dispatch, and (3) an object capable of performing the dispatch (a dispatch provider, which is usually a
    frame). Each document has a controller that, loosely speaking, acts as the interface between the outside world and
    the document. For example, use the current controller to select text, find the current cursor location, or determine
    which sheet is active in a spreadsheet. The current controller can also return the frame of the document, which
    supports the dispatch command.
</p>
<p>
    <strong>Listing .</strong> The DispatchHelper service greatly simplifies executing dispatches.
</p>
<p>
    oDispHelper = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
    The dispatch helper implements the function executeDispatch, which implements most of the functionality required to
    perform a dispatch. contains a list of the arguments supported by the executeDispatch method.
</p>
<p>
    While executing a dispatch, as discussed here, you cannot dispatch a command to a frame based on its name<em><em> —
        </em></em>either leave the target frame empty or enter “_self”. It is also, therefore, not important to use
    anything other than zero, or omit the argument completely, for the search flag. Attempting to specify another frame
    results in a run-time error (it seems silly to me that the arguments exist if they are not usable<a href="#fn1"
        class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>).
</p>
<p>
    <strong>Table .</strong> Arguments to executeDispatch.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                XDispatchProvider
            </td>
            <td>
                Dispatch provider that performs the dispatch.
            </td>
        </tr>
        <tr class="even">
            <td>
                URL String
            </td>
            <td>
                The command to dispatch, as a string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Target Frame String
            </td>
            <td>
                Identifies the frame that will receive the dispatch. Use an empty string or “_self” to specify<br /> the
                current frame (any other value is invalid).
            </td>
        </tr>
        <tr class="even">
            <td>
                long
            </td>
            <td>
                Optional search flags that indicate how to find the target frame. Use zero or blank (see ), because it
                is not supported.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PropertyValue()
            </td>
            <td>
                Optional arguments that are dependent on the implementation.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Execute the “undo” dispatch.
</p>
<p>
    Sub NewUndo
</p>
<p>
    Dim oDispHelper as object
</p>
<p>
    Dim oProvider As Object
</p>
<p>
    oProvider = ThisComponent.CurrentController.Frame
</p>
<p>
    oDispHelper = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
    oDispHelper.executeDispatch(oProvider,".uno:Undo", "", , Array())
</p>
<p>
    End Sub
</p>
<p>
    The dispatch commands have both a name and a number, called a “slot.” Although a dispatch can be made based on
    either, the developers told me that the slot number may change in the future so it is safer to use the name. If you
    must use a slot, the Tools library contains a subroutine called DispatchSlot, which performs a dispatch based on a
    slot number alone.
</p>
<p>
    <strong>Listing .</strong> Dispatch to a numeric slot.
</p>
<p>
    'Include this library to use the DispatchSlot command.
</p>
<p>
    GlobalScope.BasicLibraries.LoadLibrary("Tools")
</p>
<p>
    DispatchSlot(5301) 'Load the About dialog, same as ".uno:About"
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                You cannot call a routine in a library unless the library is loaded. You can load a library manually
                from the Macro dialog and you can load it using the LoadLibrary command as shown in . The Tools library
                included with OOo contains the DispatchSlot subroutine.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Some dispatch commands require arguments. The example in perform a dispatch with arguments. The GoToCell command
    needs to know which cell to go to. This macro moves the current cursor to the cell B3 in a spreadsheet document.
</p>
<p>
    <strong>Listing .</strong> Dispatch commands can use arguments.
</p>
<p>
    Dim args2(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args2(0).Name = "ToPoint"
</p>
<p>
    args2(0).Value = "$B$3" ' position to B3
</p>
<p>
    Dim oDispHelper as object
</p>
<p>
    Dim oProvider As Object
</p>
<p>
    oProvider = ThisComponent.CurrentController.Frame
</p>
<p>
    oDispHelper = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
    oDispHelper.executeDispatch(oProvider, ".uno:GoToCell", "", 0, args2())
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="finding-dispatch-commands">
                            <span id="anchor-206"></span>Finding dispatch commands
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A complete list of dispatch commands is tricky to find. Previously, I assembled a complete list of all supported
    dispatch commands, but, the list changes and it is not clear to me that it is of much user. As such, I decided to
    tell you how to find the list on your own. If there is a demand for it, I may be convinced to compile a new list.
    Thanks to Ariel Constenla Haile for this information.
</p>
<h4 id="use-the-wiki">
    <span id="anchor-207"></span>Use the WIKI
</h4>
<p>
    <a
        href="http://wiki.services.openoffice.org/wiki/Framework/Article/OpenOffice.org_3.x_Commands">http://wiki.services.openoffice.org/wiki/Framework/Article/OpenOffice.org_3.x_Commands</a>
    contains a list of commands and slots. Clearly some commands are missing, such as “.uno:ObjectTitleDescription”, but
    the list is fairly complete.
</p>
<h4 id="probe-the-interface">
    <span id="anchor-208"></span>Probe the interface
</h4>
<p>
    The following macro uses the UICommandDescription service to enumerate the supported modules. A new Calc document is
    created and a sheet is created for each module. The commands supported by the module are placed on the sheet. Note
    that the macro takes a while to run because there is a lot of data to process.
</p>
<p>
    <strong>Listing .</strong> Get commands from the ModuleManager.
</p>
<p>
    Sub Print_All_Commands
</p>
<p>
    ' Create a new Calc document to hold the dispatch commands
</p>
<p>
    Dim oDoc As Object
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/scalc", "_default", 0, Array())
</p>
<p>
    Dim oSheets As Object : oSheets = oDoc.getSheets()
</p>
<p>
    'The UICommandDescription service provides access to the user interface commands that are
</p>
<p>
    'part of OpenOffice.org modules, like Writer or Calc.
</p>
<p>
    Dim oUICommandDescription As Object
</p>
<p>
    oUICommandDescription = CreateUnoService("com.sun.star.frame.UICommandDescription")
</p>
<p>
    'Identify office modules and provide read access to the configuration of office modules.
</p>
<p>
    Dim oModuleIdentifier As Object
</p>
<p>
    oModuleIdentifier = CreateUnoService("com.sun.star.frame.ModuleManager")
</p>
<p>
    Dim oModuleUICommandDescription As Object, aModules$(),aCommand
</p>
<p>
    Dim aCommands$()
</p>
<p>
    Dim n&amp;, i&amp;
</p>
<p>
    ' Get a list of module names such as "com.sun.star.presentation.PresentationDocument"
</p>
<p>
    ' Create a sheet for each module.
</p>
<p>
    aModules = oModuleIdentifier.getElementNames()
</p>
<p>
    For n = 0 To UBound(aModules)
</p>
<p>
    oModuleUICommandDescription = oUICommandDescription.getByName(aModules(n))
</p>
<p>
    ' Get the commands supported by this module.
</p>
<p>
    ReDim aCommands$()
</p>
<p>
    aCommands = oModuleUICommandDescription.getElementNames()
</p>
<p>
</p>
<p>
    If n &lt;= UBound(oSheets.getElementNames()) Then
</p>
<p>
    oSheets.getByIndex(n).setName(aModules(n))
</p>
<p>
    Else
</p>
<p>
    oSheets.insertNewByName(aModules(n),n)
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    oSheets.getCellByPosition(0, 0, n).getText().setString("Command")
</p>
<p>
    oSheets.getCellByPosition(1, 0, n).getText().setString("Label")
</p>
<p>
    oSheets.getCellByPosition(2, 0, n).getText().setString("Name")
</p>
<p>
    oSheets.getCellByPosition(3, 0, n).getText().setString("Popup")
</p>
<p>
    oSheets.getCellByPosition(4, 0, n).getText().setString("Property")
</p>
<p>
</p>
<p>
    For i = 0 To UBound(aCommands)
</p>
<p>
    aCommand = oModuleUICommandDescription.getByName(aCommands(i))
</p>
<p>
</p>
<p>
    Dim sLabel$, sName$, bPopup as Boolean, nProperty&amp;, k%
</p>
<p>
    For k = 0 To UBound(aCommand)
</p>
<p>
    If aCommand(k).Name = "Label" Then
</p>
<p>
    sLabel = aCommand(k).Value
</p>
<p>
    ElseIf aCommand(k).Name = "Name" Then
</p>
<p>
    sName = aCommand(k).Value
</p>
<p>
    ElseIf aCommand(k).Name = "Popup" Then
</p>
<p>
    bPopup = aCommand(k).Value
</p>
<p>
    ElseIf aCommand(k).Name = "Property" Then
</p>
<p>
    nProperty = aCommand(k).Value
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    oSheets.getCellByPosition(0, i+1, n).getText().setString(aCommands(i))
</p>
<p>
    oSheets.getCellByPosition(1, i+1, n).getText().setString(sLabel)
</p>
<p>
    oSheets.getCellByPosition(2, i+1, n).getText().setString(sName)
</p>
<p>
    If bPopup Then
</p>
<p>
    oSheets.getCellByPosition(3, i+1, n).getText().setString("True")
</p>
<p>
    Else
</p>
<p>
    oSheets.getCellByPosition(3, i+1, n).getText().setString("False")
</p>
<p>
    End If
</p>
<p>
    oSheets.getCellByPosition(4, i+1, n).getText().setString(CStr(nProperty))
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    Dim oColumns as Object
</p>
<p>
    oColumns = oSheets.getByIndex(n).getColumns()
</p>
<p>
    Dim j%
</p>
<p>
    For j = 0 To 4
</p>
<p>
    oColumns.getByIndex(j).setPropertyValue("OptimalWidth", True)
</p>
<p>
    Next
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    XDispatchInformationProvider constructs a list of dispatch commands as returned by the current controller and
    displays the list in a Calc document.
</p>
<p>
    <strong>Listing .</strong> Get commands from the current controller.
</p>
<p>
    Sub XDispatchInformationProvider
</p>
<p>
    Dim oDoc As Object
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/scalc", "_default", 0, Array())
</p>
<p>
    Dim oSheet As Object : oSheet = oDoc.getSheets().getByIndex(0)
</p>
<p>
    oSheet.getCellByPosition(0, 0).getText().setString("Group")
</p>
<p>
    oSheet.getCellByPosition(1, 0).getText().setString("Command")
</p>
<p>
</p>
<p>
    Dim oController : oController = ThisComponent.getCurrentController()
</p>
<p>
    If IsNull(oController) Or _
</p>
<p>
    NOT HasUnoInterfaces( oController, "com.sun.star.frame.XDispatchInformationProvider") Then
</p>
<p>
    'TODO: some warning
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    Dim iSupportedCmdGroups%()
</p>
<p>
    iSupportedCmdGroups = oController.getSupportedCommandGroups()
</p>
<p>
</p>
<p>
    Dim i%, j%
</p>
<p>
    Dim k%
</p>
<p>
    For i = 0 To UBound(iSupportedCmdGroups)
</p>
<p>
    Dim aDispatchInfo()
</p>
<p>
    aDispatchInfo = oController.getConfigurableDispatchInformation(iSupportedCmdGroups(i))
</p>
<p>
</p>
<p>
    For j = 0 To UBound(aDispatchInfo)
</p>
<p>
    Dim aDispatchInformation
</p>
<p>
    aDispatchInformation = aDispatchInfo(j)
</p>
<p>
    k = k + 1
</p>
<p>
    oSheet.getCellByPosition(0, k).getText().setString(iSupportedCmdGroups(i))
</p>
<p>
    oSheet.getCellByPosition(1, k).getText().setString(aDispatchInformation.Command)
</p>
<p>
    Next
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    I exchanged email with a developer who expressed doubts as to the completeness and accuracy of the returned list;
    because the Bibliographic commands provided by the UICommandDescription included commands such as
    “.uno:ArrowShapes”, which is nonsensical in this context.
</p>
<h4 id="read-source-code">
    <span id="anchor-209"></span>Read source code
</h4>
<p>
    SFX2 based components share a common base class for their Controller object implementation, SfxBaseController. For
    modules based on SFX2, it is possible to obtain the dispatches as well as the arguments by parsing the SDI files
    inside every sfx2 based module (look at the folder &lt;module&gt;/sdi/); or even parse the header files generated in
    the build environment. Consider files with names such as sfxslots.hxx, svxslots.hxx, scslots.hxx, sdslots.hxx,
    swslots.hxx, basslots.hxx, and smslots.hxx.
</p>
<p>
    For new modules it may be easier to just browse the source code; for example, in chart2:
</p>
<ul>
    <li>
        chart2/source/controller/main/ChartController.cxx
    </li>
    <li>
        chart2/source/controller/main/DrawCommandDispatch.cxx
    </li>
    <li>
        chart2/source/controller/main/ShapeController.cxx
    </li>
</ul>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Dispatch command names are case sensitive.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="writing-a-macro-using-the-dispatcher">
                    <span id="anchor-210"></span>Writing a macro using the dispatcher
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    When you can’t find a method to accomplish a task using the UNO API, the next choice is usually to use the
    dispatcher. Macros created by the macro recorder using dispatches; use Tools | Macros | Record Macro to start the
    macro recorder.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Some component types do not support the macro recorder; for example, Draw.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro recorder has many limitations; for example, the macro recorder usually does not track what happens when a
    dialog is opened. I discovered this limitation when I used the macro recorder to create a macro to import text
    files. The “Text (encoded)” import filter opens a dialog and asks questions about the imported file. The values
    entered in the dialog are not captured by the macro recorder.
</p>
<p>
    If you desire to write a macro using the API, start by reading through the supported commands as generated by one of
    the macros shown above.
</p>
<p>
    The “SendOutLineToStarImpress” command creates an Impress presentation with an outline created from the headings in
    the current document. No arguments are required.
</p>
<p>
    <strong>Listing .</strong> Create an Impress document with an outline from this document.
</p>
<p>
    Sub CreateOutlineInImpress
</p>
<p>
    Dim oDispHelper as object
</p>
<p>
    Dim oProvider As Object
</p>
<p>
    oProvider = ThisComponent.CurrentController.Frame
</p>
<p>
    oDispHelper = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
    oDispHelper.executeDispatch(oProvider,".uno:SendOutlineToStarImpress",_
</p>
<p>
    "", , Array())
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="dispatch-failure-an-advanced-clipboard-example">
                    <span id="anchor-211"></span>Dispatch failure – an advanced clipboard example
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The request was easy, copy an entire Writer document to the clipboard. The macro recorder very quickly provided a
    solution. Unfortunately, the macro fails in LO when called from a button added to the document; but it works from
    the IDE and from AOO when called from a button. The solution is to set the focus on the document, before executing
    the dispatches.
</p>
<p>
    <strong>Listing .</strong> Select all and copy using dispatches.
</p>
<p>
    Sub CopyToClipboard_Dispatch
</p>
<p>
    dim document as object
</p>
<p>
    dim dispatcher as object
</p>
<p>
    document = ThisComponent.CurrentController.Frame
</p>
<p>
    ' This next line was NOT added by the macro recorder.
</p>
<p>
    ' Without the next line, this fails in LO when called from a button.
</p>
<p>
    document.ContainerWindow.setFocus
</p>
<p>
    dispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:SelectAll", "", 0, Array())
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:Copy", "", 0, Array())
</p>
<p>
    End Sub
</p>
<p>
    The API is more stable than the dispatches and works where a dispatch may fail. Another example where the API may be
    required is when the macro is invoked from OpenOffice started in headless mode; a topic not otherwise discussed in
    this document.
</p>
<p>
    <strong>Listing .</strong> Select all and copy using the API.
</p>
<p>
    Sub CopyToClipboard_API()
</p>
<p>
    Dim o ' Transferable content.
</p>
<p>
    Dim oClip ' Clipboard service.
</p>
<p>
    Dim oContents
</p>
<p>
    Dim sClipName As String
</p>
<p>
    ThisComponent.CurrentController.Select(ThisComponent.Text)
</p>
<p>
    o = ThisComponent.CurrentController.getTransferable()
</p>
<p>
    sClipName = "com.sun.star.datatransfer.clipboard.SystemClipboard"
</p>
<p>
    oClip = createUnoService(sClipName)
</p>
<p>
    oContents = oClip.setContents(o, null)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-9">
                    <span id="anchor-212"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The dispatch commands are powerful and require little knowledge of the internal workings of OOo. Although some
    functionality, such as the Undo command, can only be used in the dispatcher, macros that will be used for a long
    time are better off using the internal objects directly.
</p>
<ol type="1">
    <li>
        <h1 id="stardesktop">
            <span id="anchor-213"></span>StarDesktop
        </h1>
    </li>
</ol>
<p>
    The desktop acts as the main application that controls OpenOffice.org. This chapter introduces general
    techniques<em><em> — </em></em>such as accessing indexed objects, enumerating open documents, and loading new
    documents<em><em> — </em></em>while discussing and demonstrating the base functionality of the Desktop object. This
    chapter also covers the Desktop object and ThisComponent.
</p>
<p>
    The Desktop object is a com.sun.star.frame.Desktop service, which supplies four primary functions:
</p>
<ol type="1">
    <li>
        StarDesktop acts as a frame. The desktop is the parent frame and controls the frames for all of the documents.
    </li>
    <li>
        StarDesktop acts as a desktop. The desktop is the main application with the ability to close the
        documents<em><em> — </em></em>when the application is shut down, for example.
    </li>
    <li>
        StarDesktop acts as a document loader. The role of the main application also allows the desktop to load existing
        documents and create new documents.
    </li>
    <li>
        StarDesktop acts as an event broadcaster. The desktop notifies existing documents (or any other listener) of
        things that are happening<em><em> — </em></em>when the application is about to shut down, for example.
    </li>
</ol>
<p>
    The Desktop, acting as the primary application object, is created when OOo is started. Use the globally available
    variable StarDesktop to access the OOo Desktop object.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="the-frame-service">
                    <span id="anchor-214"></span>The Frame service
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The desktop is a com.sun.star.frame.Frame service (remember that an object can, and usually does, implement more
    than one service at a time). For a document, the primary purpose of a frame is to act as a liaison between the
    document and the visible window. For the desktop, however, the primary purpose is to act as the root frame, which
    contains all other frames. A frame can hold a component and zero or more subframes<em><em> — </em></em>for
    simplicity, consider a component to be a document. In the case of the desktop, all the other frames are subframes of
    the root frame, and the component (document) is a set of data. Simply stated, each document contains a frame that it
    uses to interact with the visible window, but the desktop is a frame so that it can contain, control, and access all
    of the document’s frames.
</p>
<p>
    The service com.sun.star.frame.Frame<em><em> — F</em></em>rame for short<em><em> — </em></em>provides numerous
    interesting capabilities that are not generally useful as part of the Desktop object. For example, the Title and the
    StatusIndicator defined as part of the Frame service are of no use for the Desktop object because the Desktop object
    does not have a displayed window. These properties are meaningful only in a frame that contains a display window.
    The desktop is a frame so that it can act as the root frame for all the other frames.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Although it is possible to use the desktop as a Frame service to enumerate the contained frames, the
                XDesktop interface is generally more useful to enumerate the documents rather than the frames. I usually
                access frames to obtain window titles.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the getActiveFrame() method of the desktop to obtain the active frame (see ). The active frame is the frame that
    contains the current focus. If the currently focused window is not an OOo window, getActiveFrame returns the last
    OOo frame that had the focus.
</p>
<p>
    <strong>Listing .</strong> Print the title of the current frame.
</p>
<p>
    Print StarDesktop.getActiveFrame().Title
</p>
<p>
    Use the getFrames() method to enumerate or search all of the frames contained in the desktop. The getFrames() method
    returns an object that implements the com.sun.star.frame.XFrames interface. A frame can contain other frames; the
    XFrames interface provides access to the contained frames.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Use the full interface name to find the Web address for the API information on the XFrames interface. It
                is important that you learn to find the Web pages on the API site from the full service or interface
                name.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="the-xindexaccess-interface">
                            <span id="anchor-215"></span>The XIndexAccess interface
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The XFrames interface is derived from the com.sun.star.container.XIndexAccess interface. As its name implies, this
    interface allows access to the contained frames using a numeric index. Numerous other interfaces also derive from
    the XIndexAccess interface, allowing a simple numeric index to access the contained elements. See and . The sheets
    object in a Calc document allows you to access each sheet based on the index, or the name.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Learn how to use the XIndexAccess interface because OOo uses this service in numerous other places.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Display frame titles of open components.
</p>
<p>
    Sub DisplayFrameTitles
</p>
<p>
    Dim vFrames As Variant 'All of the frames
</p>
<p>
    Dim vFrame As Variant 'A single frame
</p>
<p>
    Dim i As Integer 'Index to enumerate the frames
</p>
<p>
    Dim s As String 'Contains the string to print
</p>
<p>
</p>
<p>
    vFrames = StarDesktop.getFrames() 'Get all of the frames
</p>
<p>
</p>
<p>
    REM getCount() returns the number of contained frames
</p>
<p>
    REM If there are four frames, then i has the values 1, 2, 3, and 4
</p>
<p>
    REM the getByIndex(i) method, however, is zero based. This means
</p>
<p>
    REM that it requires the values 0, 1, 2, and 3
</p>
<p>
    For i = 1 To vFrames.getCount()
</p>
<p>
    vFrame = vFrames.getByIndex(i-1)
</p>
<p>
    s = s &amp; CStr(i-1) &amp; " : " &amp; vFrame.Title &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Frame Titles"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000006180000021A611B0B97.png" style="width:4.3189in;height:1.3626in" />
</p>
<p>
    <strong>Figure .</strong> Titles of top-level frames.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="find-frames-with-framesearchflag-constants">
                            <span id="anchor-216"></span>Find frames with FrameSearchFlag constants
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the com.sun.star.frame.FrameSearchFlag constants to search the OOo frames (see ). FrameSearchFlag constants are
    used to create an enumerated list of frames from the queryFrames() method defined in the XFrames interface. The
    FrameSearchFlag constants are also used to find a frame when loading a document and specifying which frames will
    receive a dispatch. In other words, you will see the FrameSearchFlag constants again.
</p>
<p>
    <strong>Table .</strong> com.sun.star.frame.FrameSearchFlag constants.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                AUTO
            </td>
            <td>
                Deprecated. Use 6 = SELF+CHILDREN.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                PARENT
            </td>
            <td>
                Include the parent frame.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                SELF
            </td>
            <td>
                Include this frame.
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                CHILDREN
            </td>
            <td>
                Include the child frames of this frame.
            </td>
        </tr>
        <tr class="odd">
            <td>
                8
            </td>
            <td>
                CREATE
            </td>
            <td>
                Create a frame if the requested frame is not found.
            </td>
        </tr>
        <tr class="even">
            <td>
                16
            </td>
            <td>
                SIBLINGS
            </td>
            <td>
                Include the child frames of the parent of this frame.
            </td>
        </tr>
        <tr class="odd">
            <td>
                32
            </td>
            <td>
                TASKS
            </td>
            <td>
                Include all frames in all tasks in the current frames hierarchy.
            </td>
        </tr>
        <tr class="even">
            <td>
                23
            </td>
            <td>
                ALL
            </td>
            <td>
                Include all frames except TASKS frames. 23 = 1+2+4+16 = PARENT + SELF + CHILDREN + SIBLINGS.
            </td>
        </tr>
        <tr class="odd">
            <td>
                55
            </td>
            <td>
                GLOBAL
            </td>
            <td>
                Include every frame. 55 = 1+2+4+16+32 = PARENT + SELF + CHILDREN + SIBLINGS + TASKS.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The values in are enumerated constants. OOo has enumerated values for many different purposes. You can access all
    enumerated values in OOo Basic in a similar fashion. Each constant has an assigned name, as seen in the Name column
    in . You can use this name by preceding it with com.sun.star.frame.FrameSearchFlag. For example, use
    com.sun.star.frame.FrameSearchFlag.TASKS to use the TASKS constant (see). The name of a constant provides meaningful
    information while reading the Basic code. Using the constant values directly, although allowed, obfuscates your
    code<em><em> — </em></em>in other words, causes it to be less readable.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Constant names are case sensitive the first time that they are used. If the two lines in are switched,
                then a run-time error occurs because the version with the wrong case is found first.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Constant names are not case sensitive the second time they are used.
</p>
<p>
    Print com.sun.star.frame.FrameSearchFlag.TASKS '32
</p>
<p>
    Print COM.SUN.STAR.frame.FrameSearchFLAG.tasKS '32 – Works because it is already known.
</p>
<p>
    The values in are flags that may be combined. For example, the values for ALL and GLOBAL exist only as a
    convenience; they are a combination of the other flags as shown in . You can create your own values if a suitable
    combination is not provided. For example, to search ALL and to create a frame if it is not found, use the value 31 =
    23 + 8 = ALL + CREATE.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Frame search flags are bit-flags that can be combined by using the OR operator. If you do not know what
                a bit-flag is, just smile and nod.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The code in uses the FrameSearchFlag constants to search the frames that are children of the Desktop object. The
    output from duplicates the output from by obtaining a list of all child frames from the Desktop object. Note that
    the return type from the queryFrames() method is an array. I know this because I looked at the API Web site.
    Although you can inspect the returned object to see what it is, it isn’t possible to determine the values of the
    arguments to the queryFrames() method by inspection alone.
</p>
<p>
    <strong>Listing .</strong> Query frames to get frame titles.
</p>
<p>
    Sub QueryFrames
</p>
<p>
    Dim vFrames As Variant 'All of the frames
</p>
<p>
    Dim vFrame As Variant 'A single frame
</p>
<p>
    Dim i As Integer 'Index to enumerate the frames
</p>
<p>
    Dim s As String 'Contains the string to print
</p>
<p>
    REM Call the queryFrames() method on the XFrames interface.
</p>
<p>
    REM This takes one argument, a FrameSearchFlag.
</p>
<p>
    REM This searches the children of the desktop.
</p>
<p>
    vFrames = StarDesktop.getFrames().queryFrames(_
</p>
<p>
    com.sun.star.frame.FrameSearchFlag.CHILDREN)
</p>
<p>
</p>
<p>
    For i = LBound(vFrames) To UBound(vFrames) ' The return value is an array.
</p>
<p>
    s = s &amp; vFrames(i).Title &amp; CHR$(10) ' Append the title and a new line.
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Frame Titles" ' Display the titles.
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                In OOo 3.3.0, I noticed that the frame title differs for the help window when enumerated using a query.
                I have not pursued exactly why.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="the-xeventbroadcaster-interface">
                    <span id="anchor-217"></span>The XEventBroadcaster interface
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    When certain important events occur in OOo, the event is broadcast to all the objects that register as listeners for
    a specific event<em><em> — </em></em>for example, to be notified before a document is closed. The
    com.sun.star.document.XEventBroadcaster interface allows the desktop to act as a broadcaster.
</p>
<p>
    The XEventBroadcaster interface defines the methods addEventListener() and removeEventListener() to add and remove
    event listeners. These two methods are not usually used directly because methods that are specific to the listener
    are typically used. For example, the Controller object contains the methods addKeyHandler() and removeKeyHandler()
    to add and remove listeners for key-press events.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="the-xdesktop-interface">
                    <span id="anchor-218"></span>The XDesktop interface
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The com.sun.star.frame.XDesktop interface defines the primary functionality of the Desktop service. The desktop
    contains the top-level components that can be viewed in a frame. In other words, it contains and controls the life
    cycle of the OpenOffice.org documents, help window, Basic IDE, and the other component types.
</p>
<p>
    The desktop is a Frame service so that it can act as the root frame containing all the other frames. The desktop,
    therefore, has access to and controls all the other frames. This control includes the ability to load documents and
    the ability to close all frames and exit OOo.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="closing-the-desktop-and-contained-components">
                            <span id="anchor-219"></span>Closing the desktop and contained components
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    To close the desktop and all the contained frames, call the terminate() method. This method is not guaranteed to
    close the desktop; it is merely a suggestion (or request) that you would like OOo to close. Before closing, the
    desktop asks every object that asked to be notified before closing if it is OK to close. If any listener says no,
    then OOo will not terminate. Every open document registers as a terminate listener and asks you if you want to save
    a document if it has not yet been saved; in case you wondered how that works.
</p>
<p>
    All the OOo document types support the com.sun.star.util.XCloseable interface. The XCloseable interface defines the
    method “close(bForce As Boolean)”. If bForce is False, the object may refuse to close. If bForce is True, the object
    is not able to refuse.
</p>
<p>
    According to Mathias Bauer, one of the lead developers, the Desktop object does not support the XCloseable interface
    for legacy reasons. The terminate() method was used before it was determined to be inadequate for closing documents
    or windows. If the terminate() method was not already implemented, then the desktop would also support the
    XCloseable interface.
</p>
<p>
    The code in demonstrates the safe way to close a document using any version of OOo. If you know that your code will
    run on OOo 1.1 or later, you can simply use the close() method.
</p>
<p>
    <strong>Listing .</strong> The safe way to close a document using any version of OOo.
</p>
<p>
    If HasUnoInterfaces(oDoc, "com.sun.star.util.XCloseable") Then
</p>
<p>
    oDoc.close(true)
</p>
<p>
    Else
</p>
<p>
    oDoc.dispose()
</p>
<p>
    End If
</p>
<p>
    The code in assumes that the variable oDoc references an OOo document. Some component types do not support the
    XCloseable interface. One example is the Basic IDE. The desktop contains methods to enumerate the currently open
    components and to access the current component. These methods are discussed shortly.
</p>
<p>
    The dispose() method automatically discards a document even if it is modified, while the close() method does not.
    Use setModified(False) to mark a modified document as not modified, thereby preventing the close() method from
    complaining that you are closing a modified document.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="enumerating-components-using-xenumerationaccess">
                            <span id="anchor-220"></span>Enumerating components using XEnumerationAccess
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Usually, a component refers to an OOo document, but it may refer to other things, such as the Basic IDE or the
    included help pages. Use the getComponents() method defined in the XDesktop interface to return an enumeration of
    the components controlled by the desktop. The returned object supports the interface
    com.sun.star.container.XEnumerationAccess.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                OOo has many interfaces for returning a list of objects — some methods return an array of objects. In
                the desktop, XIndexAccess is used to enumerate frames and the XEnumerationAccess interface is used to
                enumerate components.
            </td>
        </tr>
    </tbody>
</table>
<p>
    A component that is also an OOo document supports the XModel interface. The model represents the underlying document
    data, so if a component doesn’t support the XModel interface, it isn’t an OOo document. In other words, supporting
    the XModel interface implies that a component has data; if it doesn’t have data, then it isn’t a document. Use the
    HasUnoInterfaces function to check each component to see if it is an OOo document. To find a specific document,
    search all of the components and check the URL or some other distinguishing characteristic.
</p>
<p>
    It is possible that a document does not have a URL, in this case, the returned URL is an empty string. The
    subroutine FileNameOutOfPath fails with an empty string; so EnumerateComponentNames checks for this case.
</p>
<p>
    <strong>Listing .</strong> Demonstrate how to enumerate components.
</p>
<p>
    Sub EnumerateComponentNames
</p>
<p>
    Dim vComps 'Enumeration access object
</p>
<p>
    Dim vEnumerate 'Enumeration object
</p>
<p>
    Dim vComp 'Single component
</p>
<p>
    Dim s As String 'Display string
</p>
<p>
    Dim sURL As String 'Document URL
</p>
<p>
</p>
<p>
    REM Load the Tools library because Strings module contains
</p>
<p>
    REM the function FileNameOutOfPath()
</p>
<p>
    GlobalScope.BasicLibraries.LoadLibrary("Tools")
</p>
<p>
</p>
<p>
    vComps=StarDesktop.getComponents()'com.sun.star.container.XEnumerationAccess
</p>
<p>
    If NOT vComps.hasElements() Then 'I do not have to do this, but
</p>
<p>
    Print "There are no components" 'this demonstrates that I can
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    vEnumerate = vComps.createEnumeration() 'com.sun.star.container.XEnumeration
</p>
<p>
    Do While vEnumerate.hasMoreElements() 'Are there any elements to retrieve?
</p>
<p>
    vComp = vEnumerate.nextElement() 'Get next element
</p>
<p>
    REM Only try to get the URL from document components
</p>
<p>
    REM This will skip the IDE, for example
</p>
<p>
    If HasUnoInterfaces(vComp, "com.sun.star.frame.XModel") Then
</p>
<p>
    sURL = vComp.getURL()
</p>
<p>
    If sURL = "" Then
</p>
<p>
    s = s &amp; "&lt;Component With No URL&gt;" &amp; CHR$(10)
</p>
<p>
    Else
</p>
<p>
    s = s &amp; FileNameOutOfPath(sURL) &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    MsgBox s, 0, "Document Names"
</p>
<p>
    End Sub
</p>
<p>
    , produced by Listing 6, lists the file names of all currently open documents.
</p>
<p>
    <img src="Pictures/10000000000004B0000001B242456994.png" style="width:3.4984in;height:1.1602in" />
</p>
<p>
    <strong>Figure .</strong> File names of currently open documents.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="current-component">
                            <span id="anchor-221"></span>Current component
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use getCurrentComponent() to return the currently focused component, which is not necessarily an OOo document. To
    obtain the most current document, use the globally defined variable ThisComponent.
</p>
<p>
    <strong>Listing .</strong> ThisComponent references the current OOo document.
</p>
<p>
    Print ThisComponent.getURL() 'Works from Basic IDE
</p>
<p>
    Print StarDesktop.getCurrentComponent().getURL() 'Fails from Basic IDE
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                StarDesktop.getCurrentComponent() returns the currently focused component. If the Basic IDE is open, the
                Basic IDE component is returned. Use the globally defined variable ThisComponent to return the most
                current document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Most of the macros that I write are intended to modify the current document. Because of this, I frequently use
    ThisComponent.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="current-component-again">
                            <span id="anchor-222"></span>Current component (again)
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Although StarDesktop.getCurrentComponent() can be used in many situations, it is not a reliable method to obtain the
    document that most recently had focus. The method getCurrentComponent() returns either the component that currently
    has focus, or the component that had the focus before control was switched to a different application. This behavior
    causes problems when attempting to debug Basic programs, because the Basic IDE is the current component. It is
    therefore preferable to use ThisComponent rather than StarDesktop.CurrentComponent. Forcing a new document’s window
    to become focused does not change the value of ThisComponent. The value of ThisComponent is set when the macro
    begins running and then it is not changed.
</p>
<p>
    <strong>Listing .</strong> Use one of these two methods to cause oDoc2 to become the focused document.
</p>
<p>
    oDoc2.CurrentController.Frame.ContainerWindow.toFront()
</p>
<p>
    oDoc2.CurrentController.Frame.Activate()
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                When a macro is called because an event occurred, ThisComponent refers to the document that produced the
                event unless the macro is contained in another document. Therefore, it’s better to place global macros
                that will be called from other documents inside a global library rather than inside a document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Macros may be called when certain events occur (perhaps as a registered event handler). When a macro is called
    because an event occurred, ThisComponent refers to the document that produced the event even if it isn’t the
    currently focused document. The variable ThisComponent is available only from BASIC.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                It is possible to run a macro when no document is open; for obvious reasons, the macro must reside in
                the application library rather than in a document.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="current-frame">
                            <span id="anchor-223"></span>Current frame
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Although the Frame service allows the desktop to enumerate the contained frames, it is the XDesktop interface that
    defines the method getCurrentFrame(). The getCurrentFrame() method returns the frame of the currently focused
    component.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The component contained in the current frame may, or may not, be an OOo document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The code in shows one of many things you can do with the current frame. The macro obtains the current frame, the
    frame returns the current window, and then the macro reduces the size of the current window.
</p>
<p>
    <strong>Listing .</strong> Shrink the size of the current window by 25%
</p>
<p>
    REM Shrink the current window to 75% of its current size.
</p>
<p>
    Sub ShrinkWindowBy75
</p>
<p>
    Dim vFrame 'Current frame
</p>
<p>
    Dim vWindow 'container window
</p>
<p>
</p>
<p>
    REM And this is a struct that holds a rectangle object
</p>
<p>
    REM I could have also used a Variant or an Object to
</p>
<p>
    REM hold the return type, but I know what it is, so I
</p>
<p>
    REM defined the correct type to hold it.
</p>
<p>
    Dim vRect As New com.sun.star.awt.Rectangle
</p>
<p>
</p>
<p>
    vFrame = StarDesktop.getCurrentFrame()
</p>
<p>
    vWindow = vFrame.getContainerWindow()
</p>
<p>
</p>
<p>
    REM As a struct, the object is copied by value, not by reference.
</p>
<p>
    REM This means that I can modify vRect and it will not affect
</p>
<p>
    REM the position and size of the window.
</p>
<p>
    REM In my tests, vRect.X and vRect.Y are zero, which is wrong.
</p>
<p>
    REM vRect.Width and vRect.Height are indeed correct.
</p>
<p>
    vRect = vWindow.getPosSize()
</p>
<p>
</p>
<p>
    REM When setting the position and size, the last argument specifies
</p>
<p>
    REM which of the arguments to use.
</p>
<p>
    'com.sun.star.awt.PosSize.X Set only the X-position
</p>
<p>
    'com.sun.star.awt.PosSize.Y Set only the Y-position
</p>
<p>
    'com.sun.star.awt.PosSize.WIDTH Set only the Width
</p>
<p>
    'com.sun.star.awt.PosSize.HEIGHT Set only the Height
</p>
<p>
    'com.sun.star.awt.PosSize.POS Set only the Position
</p>
<p>
    'com.sun.star.awt.PosSize.SIZE Set only the Size
</p>
<p>
    'com.sun.star.awt.PosSize.POSSIZE Set both the Position and Size
</p>
<p>
    vWindow.setPosSize( vRect.X, vRect.Y, 3*vRect.Width/4, 3*vRect.Height/4,_
</p>
<p>
    com.sun.star.awt.PosSize.SIZE )
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="load-a-document">
                    <span id="anchor-224"></span>Load a document
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The desktop implements the com.sun.star.frame.XComponentLoader interface. This is a simple interface to load
    components from a URL. Use the method LoadComponentFromUrl() defined in the XComponentLoader interface to load an
    existing document or create a new one.
</p>
<p>
    com.sun.star.lang.XComponent loadComponentFromUrl(
</p>
<p>
    String aURL,
</p>
<p>
    String aTargetFrameName,
</p>
<p>
    Long nSearchFlags,
</p>
<p>
    sequence&lt; com::sun::star::beans::PropertyValue &gt; aArgs)
</p>
<p>
    The first argument to the method LoadComponentFromUrl() specifies the URL of the document to load. To load an
    existing document, provide the URL of the document. Use the function ConvertToURL to convert a file name expressed
    in an operating-system-specific format to a URL.
</p>
<p>
    Print ConvertToURL("c:\temp\file.txt") 'file:///c:/temp/file.txt
</p>
<p>
    The URL may indicate a local file, or even a file on the Internet (see ). I recommend obtaining a high-speed
    Internet connection before running this macro because it loads a 500-page document. Also, do not run this macro
    unless you have OOo 3.4 or later, because when you close AndrewMacro, it will cause OOo to crash.
</p>
<p>
    <strong>Listing .</strong> Load document over HTTP.
</p>
<p>
    Sub LoadMacroDocFromHttp
</p>
<p>
    Dim noArgs() 'An empty array for the arguments.
</p>
<p>
    Dim vComp 'The loaded component
</p>
<p>
    Dim sURL As String 'URL of the document to load
</p>
<p>
    sURL = "http://www.pitonyak.org/AndrewMacro.odt"
</p>
<p>
    vComp = StarDesktop.LoadComponentFromUrl(sURL, "_blank", 0, noArgs())
</p>
<p>
    End Sub
</p>
<p>
    OOo uses special URLs to indicate that a new document, rather than an existing document, should be created.
</p>
<p>
    <strong>Table .</strong> URLs for creating new documents.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                "private:factory/scalc"
            </td>
            <td>
                Calc document
            </td>
        </tr>
        <tr class="even">
            <td>
                "private:factory/swriter"
            </td>
            <td>
                Writer document
            </td>
        </tr>
        <tr class="odd">
            <td>
                "private:factory/swriter/web"
            </td>
            <td>
                Writer HTML Web document
            </td>
        </tr>
        <tr class="even">
            <td>
                "private:factory/swriter/GlobalDocument"
            </td>
            <td>
                Master document
            </td>
        </tr>
        <tr class="odd">
            <td>
                "private:factory/sdraw"
            </td>
            <td>
                Draw document
            </td>
        </tr>
        <tr class="even">
            <td>
                "private:factory/smath"
            </td>
            <td>
                Math formula document
            </td>
        </tr>
        <tr class="odd">
            <td>
                "private:factory/simpress"
            </td>
            <td>
                Impress presentation document
            </td>
        </tr>
        <tr class="even">
            <td>
                "private:factory/schart"
            </td>
            <td>
                Chart
            </td>
        </tr>
        <tr class="odd">
            <td>
                ".component:Bibliography/View1"
            </td>
            <td>
                Bibliography — Edit the bibliography entries
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    ".component:DB/QueryDesign"
                </p>
                <p>
                    ".component:DB/TableDesign"
                </p>
                <p>
                    ".component:DB/RelationDesign"
                </p>
                <p>
                    ".component:DB/DataSourceBrowser"
                </p>
                <p>
                    ".component:DB/FormGridView"
                </p>
            </td>
            <td>
                Database components
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in opens five new documents<em><em> — </em></em>each in a new window. When I last ran this in OOo 3.3, OOo
    seemed a bit confused as to which document should have focus.
</p>
<p>
    <strong>Listing .</strong> Create new documents.
</p>
<p>
    Sub LoadEmptyDocuments
</p>
<p>
    Dim noArgs() 'An empty array for the arguments
</p>
<p>
    Dim vComp 'The loaded component
</p>
<p>
    Dim sURLs() 'URLs of the new document types to load
</p>
<p>
    Dim sURL As String 'URL of the document to load
</p>
<p>
    Dim i As Integer
</p>
<p>
    sURLs = Array("scalc", "swriter", "sdraw", "smath", "simpress")
</p>
<p>
    For i = LBound(sURLs) To UBound(sURLs)
</p>
<p>
    sURL = "private:factory/" &amp; sURLs(i)
</p>
<p>
    vComp = StarDesktop.LoadComponentFromUrl(sURL, "_blank", 0, noArgs())
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                You can also load a document from a frame.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When a component (document) is loaded, it is placed into a frame; the second argument to LoadComponentFromUrl()
    specifies the name of the frame. If a frame with the specified name already exists, the newly loaded document uses
    the existing frame. The code in demonstrates the special frame name “_blank”<em><em> — </em></em>the special frame
    names are discussed shortly. Frame names that are not “special,” specify the name of an existing frame or a new
    frame. If you specify a frame name, you must tell OOo how to find the frame. The values in enumerate valid values
    for the frame search flags. It used to be possible to specify the name of the frame that will contain a document
    (but this has not worked since OOo 1.1.0). Here are a few items to note:
</p>
<ol type="1">
    <li>
        When a document is loaded, the frame name becomes something like “Untitled 1 – OpenOffice.org Writer” rather
        than the specified name.
    </li>
    <li>
        If you specify the frame name, the document will fail to load if a frame with that name does not exist. If the
        frame does exist, it will load it into a new frame.
    </li>
</ol>
<p>
    If you experiment with this, be certain to save your documents before running the macro, at least one experiment
    caused the new document to load into the current frame.
</p>
<p>
    <strong>Listing .</strong> Open a document into an existing frame.
</p>
<p>
    Sub UseAnExistingFrame
</p>
<p>
    Dim noArgs() 'An empty array for the arguments
</p>
<p>
    Dim vDoc 'The loaded component
</p>
<p>
    Dim sURL As String 'URL of the document to load
</p>
<p>
    Dim nSearch As Long 'Search flags
</p>
<p>
    Dim sFName As String 'Frame Name
</p>
<p>
    Dim vFrame 'Document Frame
</p>
<p>
    Dim s As String 'Display string
</p>
<p>
</p>
<p>
    REM Search globally for this
</p>
<p>
    nSearch = com.sun.star.frame.FrameSearchFlag.GLOBAL + _
</p>
<p>
    com.sun.star.frame.FrameSearchFlag.CREATE
</p>
<p>
</p>
<p>
    REM I can even open a real file for this, but I don't know what files
</p>
<p>
    REM you have on your computer so I create a new Writer document instead
</p>
<p>
    sURL = "file:///andrew0/home/andy/doc1.odt"
</p>
<p>
    sURL = "private:factory/swriter"
</p>
<p>
</p>
<p>
    REM Create a frame with the name MyFrame rather than _default
</p>
<p>
    sFName = "MyFrame"
</p>
<p>
    vFrame = ThisComponent.CurrentController.Frame
</p>
<p>
    vDoc = vFrame.LoadComponentFromUrl(sURL, sFName, nSearch, noArgs())
</p>
<p>
    If IsNull(vDoc) Then
</p>
<p>
    Print "Failed to create a document"
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM The name of the frame is MyFrame. Note that the name has nothing
</p>
<p>
    REM to do with the title!
</p>
<p>
    sFName = vDoc.CurrentController.Frame.Name
</p>
<p>
    s = "Created document to frame " &amp; sFName &amp; CHR$(10)
</p>
<p>
    MsgBox s
</p>
<p>
</p>
<p>
    REM This time, do not allow creation; only allow an existing frame
</p>
<p>
    nSearch = com.sun.star.frame.FrameSearchFlag.Global
</p>
<p>
    sURL = "file:///andrew0/home/andy/doc2.odt"
</p>
<p>
    sURL = "private:factory/scalc"
</p>
<p>
    'sFName = "doc1 – OpenOffice.org Writer"
</p>
<p>
    vDoc = vFrame.LoadComponentFromUrl(sURL, sFName, nSearch, noArgs())
</p>
<p>
    If IsNull(vDoc) Then
</p>
<p>
    Print "Failed to create a document"
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    s = s &amp; "Created document to frame " &amp; sFName
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<p>
    OOo uses special frame names to specify special behavior (see ). Use these special frame names to cause the
    specified behavior.
</p>
<p>
    <strong>Table .</strong> Special frame names.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                "_blank"
            </td>
            <td>
                Creates a new frame.
            </td>
        </tr>
        <tr class="even">
            <td>
                "_default"
            </td>
            <td>
                Detects an already loaded document or creates a new frame if it is not found.
            </td>
        </tr>
        <tr class="odd">
            <td>
                "_self"
            </td>
            <td>
                Use or return this frame.
            </td>
        </tr>
        <tr class="even">
            <td>
                ""
            </td>
            <td>
                Use or return this frame.
            </td>
        </tr>
        <tr class="odd">
            <td>
                "_parent"
            </td>
            <td>
                Use or return the direct parent of this frame.
            </td>
        </tr>
        <tr class="even">
            <td>
                "_top"
            </td>
            <td>
                Use or return the highest level parent frame.
            </td>
        </tr>
        <tr class="odd">
            <td>
                "_beamer"
            </td>
            <td>
                Use or return a special subframe.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Although you cannot currently cause OOo to find a frame and use it, you can search for the frame with the desired
    name and then use that frame to load a document into that frame; by using the frame name “_self”.
</p>
<p>
    <strong>Listing .</strong> ReuseAFrame
</p>
<p>
    Sub UseFrameSelf
</p>
<p>
    Dim noArgs() 'An empty array for the arguments
</p>
<p>
    Dim vDoc 'The loaded component
</p>
<p>
    Dim sURL As String 'URL of the document to load
</p>
<p>
    Dim nSearch As Long 'Search flags
</p>
<p>
    Dim sFName As String 'Frame Name
</p>
<p>
    Dim vFrame 'Document Frame
</p>
<p>
    Dim s As String 'Display string
</p>
<p>
</p>
<p>
    REM Search globally for this
</p>
<p>
    nSearch = com.sun.star.frame.FrameSearchFlag.GLOBAL + _
</p>
<p>
    com.sun.star.frame.FrameSearchFlag.CREATE
</p>
<p>
</p>
<p>
    REM I can even open a real file for this, but I don't know what files
</p>
<p>
    REM you have on your computer so I create a new Writer document instead
</p>
<p>
    sURL = "file:///andrew0/home/andy/doc1.odt"
</p>
<p>
    sURL = "private:factory/swriter"
</p>
<p>
</p>
<p>
    REM Create a frame with the name MyFrame rather than _default
</p>
<p>
    sFName = "MyFrame"
</p>
<p>
    vFrame = ThisComponent.CurrentController.Frame
</p>
<p>
    vDoc = vFrame.LoadComponentFromUrl(sURL, sFName, nSearch, noArgs())
</p>
<p>
    If IsNull(vDoc) Then
</p>
<p>
    Print "Failed to create a document"
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM The name of the frame is MyFrame. Note that the name has nothing
</p>
<p>
    REM to do with the title!
</p>
<p>
    sFName = vDoc.CurrentController.Frame.Name
</p>
<p>
    s = "Created document to frame " &amp; sFName &amp; CHR$(10)
</p>
<p>
    MsgBox s
</p>
<p>
</p>
<p>
    REM This time, do not allow creation; only allow an existing frame
</p>
<p>
    sURL = "file:///andrew0/home/andy/doc2.odt"
</p>
<p>
    sURL = "private:factory/scalc"
</p>
<p>
    sFName = "_self"
</p>
<p>
    ' Get a document's frame from the document's current controller.
</p>
<p>
    vDoc = vDoc.CurrentController.Frame.LoadComponentFromUrl(sURL, sFName, nSearch, noArgs())
</p>
<p>
    If IsNull(vDoc) Then
</p>
<p>
    Print "Failed to create a document"
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    s = s &amp; "Created document to frame " &amp; sFName
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="named-arguments">
                            <span id="anchor-225"></span>Named arguments
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The final argument to the LoadComponentFromUrl() method is an array of structures of type
    com.sun.star.beans.PropertyValue. Each property value consists of a name and a value. The properties are used to
    pass named arguments that direct OOo when it loads the document. <strong> </strong>contains a brief description of
    the supported named arguments.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                contains only named arguments that are not deprecated. The API Web site on the
                com.sun.star.document.MediaDescriptor service contains a complete list of named arguments, deprecated
                and otherwise. Some properties are not shown, such as Aborted, because they are set while loading; for
                example, Aborted, which is set if an incorrect password is used.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong> </strong>Valid named arguments for loading and
    storing documents.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                AsTemplate
            </td>
            <td>
                A value of True creates a new untitled document, even if the document is not a template.<br /> The
                default loads the template document for editing.
            </td>
        </tr>
        <tr class="even">
            <td>
                Author
            </td>
            <td>
                Sets the current author if the component can track the author of the current version when the document
                is saved.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharacterSet
            </td>
            <td>
                Identifies the character set for single-byte characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                Comment
            </td>
            <td>
                Similar to the Author argument, but sets the document description for version control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ComponentData
            </td>
            <td>
                Allows component-specific properties.
            </td>
        </tr>
        <tr class="even">
            <td>
                DocumentTitle
            </td>
            <td>
                Sets the Document title.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FilterData
            </td>
            <td>
                Additional properties for a filter if it is required.
            </td>
        </tr>
        <tr class="even">
            <td>
                FilterName
            </td>
            <td>
                Name of the filter for loading or storing the component when not using OOo types.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FilterOptions
            </td>
            <td>
                Additional properties for a filter if it is required. These values must be strings and must be supported
                by the filter. Use FilterData for non-string options.
            </td>
        </tr>
        <tr class="even">
            <td>
                Frame
            </td>
            <td>
                Specify the frame containing the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Hidden
            </td>
            <td>
                A value of False loads the document so that it is hidden. Do not do this if you intend to<br /> make the
                document visible after it is loaded.
            </td>
        </tr>
        <tr class="even">
            <td>
                HierarchicalDocumentName
            </td>
            <td>
                The hierarchical path to the embedded document from topmost container; for example, Base forms are
                stored in the Base document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                InputStream
            </td>
            <td>
                You can specify an existing input stream for loading a document<em><em> — </em></em>for example, if you
                have the document in memory and don’t want to write it to disk first.
            </td>
        </tr>
        <tr class="even">
            <td>
                InteractionHandler
            </td>
            <td>
                Passes an interaction handler to handle errors and obtains a password if required.
            </td>
        </tr>
        <tr class="odd">
            <td>
                JumpMark
            </td>
            <td>
                Jumps to a marked position after loading the component. A similar thing can be accomplished by appending
                a '#' and the jump mark name in the URL used to open the document; the syntax with a '#' is not
                specified in most URL schemas.
            </td>
        </tr>
        <tr class="even">
            <td>
                MacroExecutionMode
            </td>
            <td>
                The numeric value specifies if macros are executed when the document is loaded (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                MediaType
            </td>
            <td>
                Specifies the MIME type of the data that will be loaded.
            </td>
        </tr>
        <tr class="even">
            <td>
                OpenNewView
            </td>
            <td>
                A value of True forces the component to create a new window even if the document is already loaded. Some
                components support multiple views for the same data. If the opened component does not support multiple
                views, a new window is opened. It is not a view, but merely the document loaded one more time.
            </td>
        </tr>
        <tr class="odd">
            <td>
                OutputStream
            </td>
            <td>
                If used when storing a document (not for reading), the stream must be used to write the data. If a
                stream is not provided, the loader will create a stream by itself using the other properties.
            </td>
        </tr>
        <tr class="even">
            <td>
                Overwrite
            </td>
            <td>
                A value of True overwrites any existing file with the same name while saving.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Password
            </td>
            <td>
                Password for loading or storing a document. If a document that requires a password is loaded and no
                password is specified, the document is not loaded.
            </td>
        </tr>
        <tr class="even">
            <td>
                PostData
            </td>
            <td>
                Posts data to an HTTP address and then loads the response as a document. PostData is usually used to
                obtain a result from a Web form on a Web site.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Preview
            </td>
            <td>
                A value of True specifies that the document is loaded for preview. OOo may make some optimizations when
                it opens a document in preview mode.
            </td>
        </tr>
        <tr class="even">
            <td>
                ReadOnly
            </td>
            <td>
                Opens the document as read-only. Read-only documents are not modifiable from the user interface, but you
                can modify them by using the OOo API (in other words, from a macro).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Referer
            </td>
            <td>
                A URL indicating the referrer who opened this document. Without a referrer, a document that requires
                security checks is denied. (Yes, the argument name is “Referer,” not “Referrer.”)
            </td>
        </tr>
        <tr class="even">
            <td>
                RepairPackage
            </td>
            <td>
                OOo documents are stored in a compressed zipped format. A value of True attempts to recover information
                from a damaged ZIP file.
            </td>
        </tr>
        <tr class="odd">
            <td>
                StartPresentation
            </td>
            <td>
                If the document contains a presentation, it is started immediately.
            </td>
        </tr>
        <tr class="even">
            <td>
                StatusIndicator
            </td>
            <td>
                Value is an object to use as a progress indicator as the document is loaded or saved.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SuggestedSaveAsDir
            </td>
            <td>
                Specify the URL that is used next time SaveAs dialog is opened.
            </td>
        </tr>
        <tr class="even">
            <td>
                SuggestedSaveAsName
            </td>
            <td>
                Specify the suggested file name that is used next time SaveAs dialog is opened.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TemplateName
            </td>
            <td>
                Name of the template instead of the URL. Must also use the TemplateRegionName.
            </td>
        </tr>
        <tr class="even">
            <td>
                TemplateRegionName
            </td>
            <td>
                Path to the template instead of the URL. Must also use the TemplateName.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Unpacked
            </td>
            <td>
                OOo stores documents in a zipped format. A value of True stores the file in a folder if it is supported
                for the component type.
            </td>
        </tr>
        <tr class="even">
            <td>
                UpdateDocMode
            </td>
            <td>
                The numeric value specifies how the document is updated. See the API site for the constant
                com.sun.star.document.UpdateDocMode.
            </td>
        </tr>
        <tr class="odd">
            <td>
                URL
            </td>
            <td>
                Fully qualified URL of the document to load, including the JumpDescriptor if required.
            </td>
        </tr>
        <tr class="even">
            <td>
                Version
            </td>
            <td>
                If versioning is supported for the component, this argument indicates the version to load or save. The
                main document is loaded or saved if no version is specified.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ViewControllerName
            </td>
            <td>
                While loading a document into a frame, this specifies the name of the view controller to create. That
                is, the property is passed to the document's createViewController method. If the loaded document does
                not support the XModel2 interface, the property is ignored.
            </td>
        </tr>
        <tr class="even">
            <td>
                ViewData
            </td>
            <td>
                The value for this argument is component specific and usually supplied by the frame controller.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ViewId
            </td>
            <td>
                Some components support different views of the same data. The value specifies the view to use after
                loading. The default is zero and is treated as the default view.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="loading-a-template">
                            <span id="anchor-226"></span>Loading a template
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    While loading a document using LoadComponentFromUrl(), the OOo API treats all documents the same. You can open an
    OOo template for editing (changing a template and then saving it as a new template) or you can use a template as the
    starting point for a new document. The named argument AsTemplate directs OOo to open the specified document as a
    template rather than opening a document for editing. The macro in <strong> </strong>opens a document as a template.
</p>
<p>
    <strong>Listing .</strong> Load a document as a template.
</p>
<p>
    Sub UseTemplate
</p>
<p>
    REM This is an array from 0 To 0 of type PropertyValue
</p>
<p>
    Dim args(0) As New com.sun.star.beans.PropertyValue
</p>
<p>
    Dim sURL As String 'URL of the document to load
</p>
<p>
    sURL = "file:///home/andy/doc1.ott"
</p>
<p>
    args(0).Name = "AsTemplate"
</p>
<p>
    args(0).Value = True
</p>
<p>
    StarDesktop.LoadComponentFromUrl(sURL, "_blank", 0, args())
</p>
<p>
    End Sub
</p>
<p>
    The method LoadComponentFromUrl() assumes that a URL is used to specify the document location; this is not
    operating-system specific. Although I ran the macro in on my Linux computer, it will work on a Windows computer as
    well. On a Windows computer, the URL usually includes the drive letter.
</p>
<p>
    sURL = "file://c:/home/andy/doc1.ott"
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Use the functions ConvertFromURL and ConvertToURL to convert between the operating-system-specific
                notation and URL notation.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="enabling-macros-while-loading-a-document">
                            <span id="anchor-227"></span>Enabling macros while loading a document
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    When a document that contains a macro is opened from the user interface (UI), a security dialog opens, asking if
    macros should be run. When a document is loaded from a macro using the OOo API, macros are disabled in the document.
    Some macros run based on events that occur in a document. If macros are disabled in the document, you can still
    manually run the contained macros, but the macros that are usually started from an event in the document will never
    run.
</p>
<p>
    The named argument MacroExecutionMode directs OOo how to treat macros when a document is loaded. <strong>
    </strong>enumerates the valid values for the MacroExecutionMode argument.
</p>
<p>
    <strong>Table .</strong> com.sun.star.document.MacroExecutionMode constants.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                NEVER_EXECUTE
            </td>
            <td>
                A macro should not be executed at all.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                FROM_LIST
            </td>
            <td>
                Execute macros from secure list quietly.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                ALWAYS_EXECUTE
            </td>
            <td>
                Execute any macro, macros signed with trusted certificates and macros from secure list are executed
                quietly.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                USE_CONFIG
            </td>
            <td>
                Use configuration to retrieve macro settings. In case a user confirmation is required a dialog is
                output.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                ALWAYS_EXECUTE_NO_WARN
            </td>
            <td>
                Macros are always executed without confirmation.
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                USE_CONFIG_REJECT_CONFIRMATION
            </td>
            <td>
                Use configuration to retrieve macro settings. Treat cases when user confirmation required as rejected.
            </td>
        </tr>
        <tr class="odd">
            <td>
                6
            </td>
            <td>
                USE_CONFIG_APPROVE_CONFIRMATION
            </td>
            <td>
                Use configuration to retrieve macro settings. Treat cases when user confirmation required as approved.
            </td>
        </tr>
        <tr class="even">
            <td>
                7
            </td>
            <td>
                FROM_LIST_NO_WARN
            </td>
            <td>
                Execute only macros from secure list. Macros that are not from the list are not executed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                8
            </td>
            <td>
                FROM_LIST_AND_SIGNED_WARN
            </td>
            <td>
                Execute only macros from secure list or macros that are signed by trusted certificates.
            </td>
        </tr>
        <tr class="even">
            <td>
                9
            </td>
            <td>
                FROM_LIST_AND_SIGNED_NO_WARN
            </td>
            <td>
                Execute only macros from secure list or macros that are signed by trusted certificates. No
                warning/conformation should be shown.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in loads a document as a template and allows macros to run when the document is loaded. This macro also
    demonstrates that multiple named arguments can be used simultaneously.
</p>
<p>
    <strong>Listing .</strong> Load a document as a template and enable contained macros.
</p>
<p>
    Sub UseTemplateRunMacro
</p>
<p>
    REM This is an array from 0 To 1 of type PropertyValue
</p>
<p>
    Dim args(1) As New com.sun.star.beans.PropertyValue
</p>
<p>
    Dim sURL As String 'URL of the document to load
</p>
<p>
    Print com.sun.star.document.MacroExecMode.USE_CONFIG
</p>
<p>
    sURL = "file:///home/andy/doc1.odt"
</p>
<p>
    args(0).Name = "AsTemplate"
</p>
<p>
    args(0).Value = True
</p>
<p>
    args(1).Name = "MacroExecutionMode"
</p>
<p>
    args(1).Value = com.sun.star.document.MacroExecMode.ALWAYS_EXECUTE_NO_WARN
</p>
<p>
    StarDesktop.LoadComponentFromUrl(sURL, "_blank", 0, args())
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="importing-and-exporting">
                            <span id="anchor-228"></span>Importing and exporting
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    OpenOffice.org has a type-detection mechanism to determine a document’s type when it is loaded. This mechanism has
    been reliable for the limited number of document types that I deal with daily. Sometimes, however, you must specify
    the filter name when importing a document. To export a document, you must always specify the export filter type. The
    code in opens a Microsoft Word document. In my testing the documents opened correctly even when I did not specify
    the filter name.
</p>
<p>
    <strong>Listing .</strong> Specify the filter name while loading a document.
</p>
<p>
    Sub LoadDocFile
</p>
<p>
    Dim noArgs(0) As New com.sun.star.beans.PropertyValue
</p>
<p>
    Dim sURL As String
</p>
<p>
    noArgs(0).Name = "FilterName"
</p>
<p>
    noArgs(0).Value = "Microsoft Word 97/2000/XP"
</p>
<p>
    sURL = "file:///home/andy/one.doc"
</p>
<p>
    StarDesktop.LoadComponentFromUrl(sURL, "_blank", 0, noArgs())
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="filter-names">
                            <span id="anchor-229"></span>Filter names
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    New filters are frequently added to OOo, so it seems silly to list the supported filters, when a macro can retrieve
    the latest list. The following macro creates a new Calc document and then displays the list of supported filters. A
    recorded macro is used to format the data.
</p>
<p>
    The UIName is the general name; or localized name. The Name column contains the internal name to use when specifying
    a filter name for import or export. The Import and Export columns identify if the filter can be used for import or
    export. The Options column, indicates if options can be passed to the filter. These options direct the filter.
</p>
<p>
    The filter names are also stored in the file TypeDetection.xcu stored in the OOo configuration folders.
</p>
<p>
    <strong>Listing .</strong> List supported filters in a Calc Sheet.
</p>
<p>
    sub FiltersToCalc
</p>
<p>
    Dim oFF ' FilterFactory service
</p>
<p>
    Dim oFilterNames ' Array of filter names.
</p>
<p>
    Dim oDoc ' Document created to hold the filter names.
</p>
<p>
    Dim oSheet ' Sheet that will hold the filter information.
</p>
<p>
    Dim oCell ' Cell to update
</p>
<p>
    Dim i% ' Index Variable.
</p>
<p>
    Dim fProps() ' Properties for each filter.
</p>
<p>
    Dim fp% ' Filter property index
</p>
<p>
    Dim fpCol% ' Column for the specified filter data.
</p>
<p>
    Dim s$ ' Work string that holds some property values.
</p>
<p>
    Dim iUserData% ' For enumerating array property values.
</p>
<p>
    Dim oProp ' A single property.
</p>
<p>
    Dim oArrayData ' Array of user properties.
</p>
<p>
    Dim sPropNames(7) As String
</p>
<p>
    Dim flags As Long
</p>
<p>
    sPropNames(0) = "Name"
</p>
<p>
    sPropNames(1) = "Import"
</p>
<p>
    sPropNames(2) = "Export"
</p>
<p>
    sPropNames(3) = "Options"
</p>
<p>
    sPropNames(4) = "Visible"
</p>
<p>
    sPropNames(5) = "Flags"
</p>
<p>
    sPropNames(6) = "DocumentService"
</p>
<p>
    sPropNames(7) = "UIName"
</p>
<p>
    oFF = createUnoService( "com.sun.star.document.FilterFactory" )
</p>
<p>
    oFilterNames = oFF.getElementNames()
</p>
<p>
</p>
<p>
    ' Create a Calc doc and save the filter names to it.
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL( "private:factory/scalc", "_blank", 0, Array() )
</p>
<p>
    oSheet = oDoc.getSheets().getByIndex(0)
</p>
<p>
</p>
<p>
    ' Print the filter names into a document.
</p>
<p>
    For i = LBound( oFilterNames ) To UBound( oFilterNames )
</p>
<p>
    fProps() = oFF.getByName(oFilterNames(i))
</p>
<p>
    For fp = LBound(fProps) To UBound(fProps)
</p>
<p>
    oCell = oSheet.getCellByPosition(fp, i+1)
</p>
<p>
    oProp = fProps(fp)
</p>
<p>
    fpCol = FindInArrayAdd(oProp.Name, sPropNames)
</p>
<p>
    If fpCol &gt; UBound(sPropNames) Then
</p>
<p>
    ReDim Preserve sPropNames(fpCol) As String
</p>
<p>
    sPropNames(fpCol) = oProp.Name
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    oCell = oSheet.getCellByPosition(fpCol, i+1)
</p>
<p>
    If Not IsArray(oProp.Value) Then
</p>
<p>
    oCell.setString(oProp.Value)
</p>
<p>
    If oProp.Name = "Flags" Then
</p>
<p>
    flags = oProp.Value
</p>
<p>
    oCell.setString(CStr(flags) &amp; " = " &amp; flags_int2str(flags)
</p>
<p>
    If flags and 1 Then
</p>
<p>
    oCell = oSheet.getCellByPosition(FindInArrayAdd("Import", sPropNames), i+1)
</p>
<p>
    oCell.setString("X")
</p>
<p>
    Endif
</p>
<p>
    If flags and 2 Then
</p>
<p>
    oCell = oSheet.getCellByPosition(FindInArrayAdd("Export", sPropNames), i+1)
</p>
<p>
    oCell.setString("X")
</p>
<p>
    Endif
</p>
<p>
    If flags and 128 Then
</p>
<p>
    oCell = oSheet.getCellByPosition(FindInArrayAdd("Options", sPropNames), i+1)
</p>
<p>
    oCell.setString("X")
</p>
<p>
    Endif
</p>
<p>
    If ((flags and 4096) or (flags and 8192)) Then
</p>
<p>
    oCell = oSheet.getCellByPosition(FindInArrayAdd("Visible", sPropNames), i+1)
</p>
<p>
    oCell.setString("X")
</p>
<p>
    Endif
</p>
<p>
    End If
</p>
<p>
    ElseIf LBound(oProp.Value) &lt;= UBound(oProp.Value) Then
</p>
<p>
    s = ""
</p>
<p>
    oArrayData = oProp.Value
</p>
<p>
    For iUserData = LBound(oArrayData) To UBound(oArrayData)
</p>
<p>
    If VarType(oArrayData(iUserData)) = 8 Then
</p>
<p>
    s = s &amp; "(String:" &amp; oArrayData(iUserData) &amp; ")"
</p>
<p>
    Else
</p>
<p>
    s = s &amp; "(" &amp; oArrayData(iUserData).Name &amp; ":" &amp; oArrayData(iUserData).Value &amp; ")"
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    oCell.setString(s)
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    Next
</p>
<p>
    For fp = LBound(sPropNames) To Ubound(sPropNames)
</p>
<p>
    oCell = oSheet.getCellByPosition(fp, 0)
</p>
<p>
    oCell.setString(sPropnames(fp))
</p>
<p>
    Next
</p>
<p>
    FinalFormat(oDoc)
</p>
<p>
    End Sub
</p>
<p>
    function flags_int2str(flags as long) as string
</p>
<p>
    Dim cflags as long
</p>
<p>
    Dim strval as string
</p>
<p>
    Dim curFlag As Long
</p>
<p>
    cflags = flags
</p>
<p>
    strval = ""
</p>
<p>
    if cflags and &amp;H00000001 then
</p>
<p>
    strval = strval + " Import"
</p>
<p>
    cflags = cflags-1
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000002 then
</p>
<p>
    strval = strval + " Export"
</p>
<p>
    cflags = cflags-2
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000004 then
</p>
<p>
    strval = strval + " Template"
</p>
<p>
    cflags = cflags-4
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000008 then
</p>
<p>
    strval = strval + " Internal"
</p>
<p>
    cflags = cflags-8
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000010 then
</p>
<p>
    strval = strval + " TemplatePath"
</p>
<p>
    cflags = cflags-16
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000020 then
</p>
<p>
    strval = strval + " Own"
</p>
<p>
    cflags = cflags-32
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000040 then
</p>
<p>
    strval = strval + " Alien"
</p>
<p>
    cflags = cflags-64
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000080 then
</p>
<p>
    strval = strval + " UseOptions"
</p>
<p>
    cflags = cflags-128
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000100 then
</p>
<p>
    strval = strval + " Default"
</p>
<p>
    cflags = cflags-256
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000200 then
</p>
<p>
    strval = strval + " Executable"
</p>
<p>
    cflags = cflags-512
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000400 then
</p>
<p>
    strval = strval + " SupportSelection"
</p>
<p>
    cflags = cflags-1024
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00000800 then
</p>
<p>
    strval = strval + " MapToAppPlug"
</p>
<p>
    cflags = cflags-2048
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00001000 then
</p>
<p>
    strval = strval + " NotInFileDialog"
</p>
<p>
    cflags = cflags-4096
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00002000 then
</p>
<p>
    strval = strval + " NotInChooser"
</p>
<p>
    cflags = cflags-8192
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00004000 then
</p>
<p>
    strval = strval + " Acynchronas"
</p>
<p>
    cflags = cflags-16384
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00008000 then
</p>
<p>
    strval = strval + " Creator"
</p>
<p>
    cflags = cflags-32768
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00010000 then
</p>
<p>
    strval = strval + " Readonly"
</p>
<p>
    cflags = cflags-65536
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00020000 then
</p>
<p>
    strval = strval + " NotInstalled"
</p>
<p>
    cflags = cflags-131072
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00040000 then
</p>
<p>
    strval = strval + " ConsultService"
</p>
<p>
    cflags = cflags-262144
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00080000 then
</p>
<p>
    strval = strval + " 3rdPartyFilter"
</p>
<p>
    cflags = cflags-524288
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00100000 then
</p>
<p>
    strval = strval + " Packed"
</p>
<p>
    cflags = cflags-1048576
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00200000 then
</p>
<p>
    strval = strval + " SilentExport"
</p>
<p>
    cflags = cflags-2097152
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00400000 then
</p>
<p>
    strval = strval + " BrowserPreferred"
</p>
<p>
    cflags = cflags-4194304
</p>
<p>
    endif
</p>
<p>
    if cflags and &amp;H00800000 then
</p>
<p>
    strval = strval + " [H00800000]"
</p>
<p>
    cflags = cflags-8388608
</p>
<p>
    endif
</p>
<p>
</p>
<p>
    if cflags and &amp;H01000000 then
</p>
<p>
    strval = strval + " [H01000000]"
</p>
<p>
    cflags = cflags-16777216
</p>
<p>
    endif
</p>
<p>
</p>
<p>
    if cflags and &amp;H02000000 then
</p>
<p>
    strval = strval + " [H02000000]"
</p>
<p>
    cflags = cflags-33554432
</p>
<p>
    endif
</p>
<p>
</p>
<p>
    if cflags and &amp;H10000000 then
</p>
<p>
    strval = strval + " Preferred"
</p>
<p>
    cflags = cflags-268435456
</p>
<p>
    endif
</p>
<p>
    if cflags &lt;&gt; 0 then
</p>
<p>
    strval = strval + " !!! ATTENTION: unsupported flag ["+cflags+"] detected !!!"
</p>
<p>
    endif
</p>
<p>
    flags_int2str = strval
</p>
<p>
    end function
</p>
<p>
    Function FindInArrayAdd(sName$, nameArray) As Integer
</p>
<p>
    Dim i As Integer
</p>
<p>
    For i = LBound(nameArray()) To UBound(nameArray())
</p>
<p>
    'Print nameArray(i) &amp; " and " &amp; sName
</p>
<p>
    If nameArray(i) = sName Then
</p>
<p>
    FindInArrayAdd = i
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    i = UBound(nameArray()) + 1
</p>
<p>
    FindInArrayAdd = i
</p>
<p>
    End Function
</p>
<p>
    sub FinalFormat(oDoc)
</p>
<p>
    rem ----------------------------------------------------------------------
</p>
<p>
    rem define variables
</p>
<p>
    Dim document as object
</p>
<p>
    Dim dispatcher as object
</p>
<p>
    rem ----------------------------------------------------------------------
</p>
<p>
    rem get access to the document
</p>
<p>
    document = oDoc.CurrentController.Frame
</p>
<p>
    dispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
    rem ----------------------------------------------------------------------
</p>
<p>
    Dim args1(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args1(0).Name = "ToPoint"
</p>
<p>
    args1(0).Value = "$A$1"
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:GoToCell", "", 0, args1())
</p>
<p>
    rem ----------------------------------------------------------------------
</p>
<p>
    Dim args2(1) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args2(0).Name = "By"
</p>
<p>
    args2(0).Value = 1
</p>
<p>
    args2(1).Name = "Sel"
</p>
<p>
    args2(1).Value = true
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:GoRightToEndOfData", "", 0, args2())
</p>
<p>
    rem ----------------------------------------------------------------------
</p>
<p>
    Dim args3(2) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args3(0).Name = "FontHeight.Height"
</p>
<p>
    args3(0).Value = 12
</p>
<p>
    args3(1).Name = "FontHeight.Prop"
</p>
<p>
    args3(1).Value = 100
</p>
<p>
    args3(2).Name = "FontHeight.Diff"
</p>
<p>
    args3(2).Value = 0
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:FontHeight", "", 0, args3())
</p>
<p>
    rem ----------------------------------------------------------------------
</p>
<p>
    Dim args4(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args4(0).Name = "Bold"
</p>
<p>
    args4(0).Value = true
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:Bold", "", 0, args4())
</p>
<p>
    rem ----------------------------------------------------------------------
</p>
<p>
    Dim args5(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args5(0).Name = "HorizontalAlignment"
</p>
<p>
    args5(0).Value = com.sun.star.table.CellHoriJustify.CENTER
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:HorizontalAlignment", "", 0, args5())
</p>
<p>
    rem ----------------------------------------------------------------------
</p>
<p>
    Dim args6(1) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args6(0).Name = "By"
</p>
<p>
    args6(0).Value = 1
</p>
<p>
    args6(1).Name = "Sel"
</p>
<p>
    args6(1).Value = true
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:GoDownToEndOfData", "", 0, args6())
</p>
<p>
    rem ----------------------------------------------------------------------
</p>
<p>
    Dim args7(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args7(0).Name = "aExtraWidth"
</p>
<p>
    args7(0).Value = 254
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:SetOptimalColumnWidth", "", 0, args7())
</p>
<p>
    rem ----------------------------------------------------------------------
</p>
<p>
    Dim args8(8) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args8(0).Name = "ByRows"
</p>
<p>
    args8(0).Value = true
</p>
<p>
    args8(1).Name = "HasHeader"
</p>
<p>
    args8(1).Value = true
</p>
<p>
    args8(2).Name = "CaseSensitive"
</p>
<p>
    args8(2).Value = false
</p>
<p>
    args8(3).Name = "IncludeAttribs"
</p>
<p>
    args8(3).Value = true
</p>
<p>
    args8(4).Name = "UserDefIndex"
</p>
<p>
    args8(4).Value = 0
</p>
<p>
    args8(5).Name = "Col1"
</p>
<p>
    args8(5).Value = 7
</p>
<p>
    args8(6).Name = "Ascending1"
</p>
<p>
    args8(6).Value = true
</p>
<p>
    args8(7).Name = "Col2"
</p>
<p>
    args8(7).Value = 1
</p>
<p>
    args8(8).Name = "Ascending2"
</p>
<p>
    args8(8).Value = true
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:DataSort", "", 0, args8())
</p>
<p>
    dispatcher.executeDispatch(document, ".uno:GoToCell", "", 0, args1())
</p>
<p>
    end sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="loading-and-saving-documents">
                            <span id="anchor-230"></span>Loading and saving documents
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The desktop or a frame is used to load a document. To store a document, use the method storeToURL(), which is
    implemented by the Document object. The first argument to this method is the URL to which the document will be
    stored. The second argument is an array of named arguments (see ). To export a document to a different type, the
    FilterName must specify the document export type. The code in <strong> </strong>exports a Writer document to a PDF
    file.
</p>
<p>
    <strong>Listing .</strong> Export the current document, assuming it is a Writer document, as PDF.
</p>
<p>
    Dim args(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args(0).Name = "FilterName"
</p>
<p>
    args(0).Value = "writer_pdf_Export"
</p>
<p>
    ThisComponent.storeToURL("file:///test.pdf",args())
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Filter names are case sensitive.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Some Calc import and export filters support options; for example, DIF, dBase, and Lotus filters all use the same
    filter option, a numeric index that identifies which character set to use for single-byte characters.
</p>
<p>
    <strong>Listing .</strong> The DIF, dBase, and Lotus filters all use the same filter option.
</p>
<p>
    Dim args(1) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args(0).Name = "FilterName"
</p>
<p>
    args(0).Value = "dBase"
</p>
<p>
    args(1).Name = "FilterOptions" 'Identify character set for single-byte chars
</p>
<p>
    args(1).Value = 0 'System character set
</p>
<p>
    More detailed information on CSV files is found in AndrewBase.odt.
</p>
<p>
    The discussion of the CSV filter assumes familiarity with the CSV file format. If you aren’t familiar with this
    format, feel free to skip this section. The Text CSV filter, unlike the dBase filter, uses a complicated string
    containing five tokens. Each token can contain multiple values separated by a slash mark (/). The tokens are then
    separated by a comma (,).
</p>
<p>
    <strong>Listing .</strong> The CSV filter options are complicated.
</p>
<p>
    Dim args(1) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args(0).Name = "FilterName"
</p>
<p>
    args(0).Value = "scalc: Text - txt - csv (StarCalc)"
</p>
<p>
    args(1).Name = "FilterOptions"
</p>
<p>
    args(1).Value = "44,34,0,1,1/5/2/1/3/1/4/1"
</p>
<p>
    The first token contains the field separators as ASCII values. For example, to specify a comma as the delimiter, use
    the ASCII value 44 (see ). To specify that some fields are separated by a a space (ASCII 32) and some are separated
    by a tab (ASCII 9), would use “32/9,34,0,1,1/5/2/1/3/1/4/1” for the filter options.
</p>
<p>
    In a CSV file, the text portions are usually surrounded by either double quotation marks (") or single quotation
    marks ('). specifies that text portions should be surrounded by double quotation marks, using an ASCII value of 34.
    If you want to use multiple text delimiters, separate them with a slash.
</p>
<p>
    The third token identifies the character set to use; this is the same value used to identify the character set in
    the DIF, dBase, and Lotus filters. The code in specifies a zero for the character set.
</p>
<p>
    The fourth token identifies the first line to import<em><em> — </em></em>typically line one. specifies that the
    first line of text should be input.
</p>
<p>
    The last token identifies the format of each column in the CSV file. The columns can be formatted as either
    delimited text (see ) or as fixed-width text (see ).
</p>
<p>
    <strong>Listing .</strong> Delimited-text-format string for the CSV filter.
</p>
<p>
    &lt;field_num&gt;/&lt;format&gt;/&lt;field_num&gt;/&lt;format&gt;/&lt;field_num&gt;/&lt;format&gt;/...
</p>
<p>
    The &lt;field_num&gt; is an integer that identifies a field, where 1 is the leftmost field. For example, given the
    fields “one”, “two”, and “three”, a field_num of 2 refers to “two”. The &lt;format&gt; is an integer that identifies
    the format of the field (see ). The code in specifies that fields one through four use a format of 1, which is the
    standard format.
</p>
<p>
    <strong>Table .</strong> CSV field format values.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                Standard
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                Text
            </td>
        </tr>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
                MM/DD/YY
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                DD/MM/YY
            </td>
        </tr>
        <tr class="odd">
            <td>
                5
            </td>
            <td>
                YY/MM/DD
            </td>
        </tr>
        <tr class="even">
            <td>
                9
            </td>
            <td>
                Do not import; ignore this field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                10
            </td>
            <td>
                Import a number formatted in the US-English locale regardless of the current locale.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Fixed-width-columns format string for the CSV filter.
</p>
<p>
    FIX/&lt;start&gt;/&lt;format&gt;/&lt;start&gt;/&lt;format&gt;/&lt;start&gt;/&lt;format&gt;/...
</p>
<p>
    Tell the filter that the file uses a fixed-width format by using the text “FIX” as the first portion of the last
    token. Fixed-width CSV files identify fields by specifying where each field starts (see ). The &lt;start&gt; value
    specifies the first character in a field. A start of 0 refers to the leftmost character of the text. The
    &lt;format&gt; is an integer that identifies the format of the text (see ).
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="error-handling-while-loading-a-document">
                            <span id="anchor-231"></span>Error handling while loading a document
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Exceptions are not thrown while loading a document; instead, errors are thrown using an interaction handler that is
    passed as a named argument. Unfortunately, you cannot implement an OOo Basic interaction handler. The OOo
    Developer’s Guide, however, has examples of error handlers using other languages. In other words, in BASIC, you
    cannot trap errors while loading a document; the document simply fails to load and returns null.
</p>
<p>
    The Graphical User Interface (GUI) provides an interaction handler that interacts with the user. The GUI’s
    interaction handler displays error messages when errors occur and prompts the user for a password if it is required.
    If no handler is included as a named argument, a default handler is used. The default handler simply ignores most
    errors, providing little feedback to the user.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-10">
                    <span id="anchor-232"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The desktop acts as the main application that controls OpenOffice.org, so when you need to obtain something that is
    globally related to the documents or frames, look at the desktop. The globally available variables StarDesktop and
    ThisComponent provide easy access to the OOo Desktop object and the current document. This chapter introduced
    techniques for accessing containers with multiple objects. Familiarize yourself with the basic capabilities for
    opening documents, for importing and exporting file types, and the capabilities and limitations of OOo, in order to
    expand your ability to use and create a wide variety of file types within the OOo environment.
</p>
<ol type="1">
    <li>
        <h1 id="generic-document-methods">
            <span id="anchor-233"></span>Generic Document Methods
        </h1>
    </li>
</ol>
<p>
    OpenOffice.org supports six primary document types: text, spreadsheet, drawing, math, database, and presentation.
    The different document types share significant functionality and interfaces, such as accessing the document model,
    printing, and saving. This chapter introduces common tasks across all of the document types.
</p>
<p>
    Every document contains data that can be manipulated and printed. For example, the primary data in a Writer document
    is text, but it can also contain tables and graphics. The data model consists of this underlying data that can be
    manipulated independently of how it is displayed. To manipulate the data by means of a macro, you manipulate the
    data model directly. Although you can use the dispatcher to indirectly manipulate the data, the changes are still
    made directly to the model. A typical usage of the dispatcher is to paste the clipboard contents into the document
    (see Chapter <a href="#anchor-203">11</a> <a href="#anchor-203">The Dispatcher</a>).
</p>
<p>
    The data model contains a Controller object, which manipulates the visual presentation of the data. The controller
    doesn’t change the data; it only controls how the document is presented. The controller interacts directly with the
    user interface to control the location of the displayed cursor, to control which page is displayed, and to select
    portions of the document. Use the controller to determine display-related information such as the current page or
    the currently selected text.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                OOo supports a mode called “headless,” which has no startup screen, no default document,<br /> no user
                interface, and supports no user interaction. (Use “soffice -?” to see a list of supported modes.) If OOo
                is started in headless mode, there is no display component. Therefore, a controller is not required and
                may not exist. If it’s possible for your macro to run on OOo in headless mode, you must check the
                controller to see if it is null before using it.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="service-manager">
                    <span id="anchor-234"></span>Service Manager
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OpenOffice.org has a general global service manager, which is used to create and obtain instances of general UNO
    services. A service manager accepts a string that identifies a type of object, and it returns an instance of that
    object. The global service manager is made available in OOo Basic through the function createUnoService(String). The
    global service manager returns general objects such as a dispatch helper or an object for simple file access.
</p>
<p>
    <strong>Listing .</strong> Use the global service manager.
</p>
<p>
    oDispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
    oSimpleFileAccess = createUnoService("com.sun.star.ucb.SimpleFileAccess")
</p>
<p>
    Documents are a service manager to create objects that they contain (or that are directly related to the document);
    for example, a Writer document is able to create a text table or text field that can be inserted into the document.
    In general, objects that were not created by a document cannot be inserted into the document. A Writer document is
    unable to return global objects, and the global service manager is unable to return objects that are then inserted
    into a document.
</p>
<p>
    <strong>Listing .</strong> Use a document as a service manager.
</p>
<p>
    REM Let the document create the text table.
</p>
<p>
    oTable = oDoc.createInstance( "com.sun.star.text.TextTable" )
</p>
<p>
    oTable.initialize(3, 2) 'Three rows, two columns
</p>
<p>
    REM Now insert the text table at the end of the document.
</p>
<p>
    oDoc.Text.insertTextContent(oDoc.Text.getEnd(), oTable, False)
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="services-and-interfaces">
                    <span id="anchor-235"></span>Services and interfaces
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Think of an OOo component as a window owned by the desktop. Use the Desktop object to enumerate the components,
    including documents, the Basic IDE and the help window along with the actual documents. If a component supports the
    com.sun.star.frame.XModel interface, the component is a document (rather than the Basic IDE or the help window).
    Every document supports the XModel interface and each document type has a unique service that it supports (see ).
    Use HasUnoInterfaces to determine if an object supports the XModel interface; then use the object method
    supportsService to determine the document type.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The method supportsService() is defined by the com.sun.star.lang.XServiceInfo interface.<br /> This
                interface also defines the method getImplementationName(), which returns a unique<br /> string
                identifying the object type.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Table 101. Unique services that identify the document’s type.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.text.TextDocument
            </td>
            <td>
                Writer text document.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.SpreadsheetDocument
            </td>
            <td>
                Calc spreadsheet document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.drawing.DrawingDocument
            </td>
            <td>
                Draw drawing document.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.presentation.PresentationDocument
            </td>
            <td>
                Impress presentation document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.formula.FormulaProperties
            </td>
            <td>
                Math formula document.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.comp.dba.ODatabaseDocument
            </td>
            <td>
                Base Document
            </td>
        </tr>
    </tbody>
</table>
<p>
    OOo contains numerous interfaces that are used by many (if not all) of the document types. Consider this partial
    list of common interfaces.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Interface
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.beans.XPropertySet
            </td>
            <td>
                Get and set object properties.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.container.XChild
            </td>
            <td>
                For objects with a single parent, get and set that parent.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.datatransfer.XTransferable
            </td>
            <td>
                Get data for data transfer; like copying to the clipboard.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.document.XDocumentPropertiesSupplier
            </td>
            <td>
                Access a documents properties; for example, author and creation date.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.document.XDocumentEventBroadcaster
            </td>
            <td>
                Register to be notified when events occur.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.document.XEventsSupplier
            </td>
            <td>
                Get a list of events supported by this object.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.document.XLinkTargetSupplier
            </td>
            <td>
                Get the list of link targets in a document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.document.XViewDataSupplier
            </td>
            <td>
                Get properties describing a document's open views.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.drawing.XDrawPagesSupplier
            </td>
            <td>
                Get draw pages for documents that support multiple draw pages; for example, a drawing or a presentation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.frame.XLoadable
            </td>
            <td>
                Functionality to load documents.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.frame.XModel
            </td>
            <td>
                Representation of a resource (document) in the sense that it was created/loaded from a resource; off
                hand, I am not aware of any document that does not implement XModel. This interface also provides access
                to the model's components.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.frame.XStorable
            </td>
            <td>
                Methods to store a document.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.lang.XComponent
            </td>
            <td>
                Allows an object to own and dispose (free) an object; for example, a text table.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.lang.XEventListener
            </td>
            <td>
                Base interface for all listeners; provides a disposing method.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.lang.XMultiServiceFactory
            </td>
            <td>
                Implemented by factories to create objects and determine what objects the factor can create.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.lang.XServiceInfo
            </td>
            <td>
                Determine which services an object supports.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.lang.XTypeProvider
            </td>
            <td>
                Determine the types (interfaces) an object supports.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.script.XStarBasicAccess
            </td>
            <td>
                Deprecated, but provides access to libraries.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.style.XStyleFamiliesSupplier
            </td>
            <td>
                Get style families supported by a document; for example, paragraph styles.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.util.XCloseBroadcaster
            </td>
            <td>
                Allows an object to veto a close request.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.util.XCloseable
            </td>
            <td>
                Ask a document to close; this is preferred to dispose.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.util.XModifiable
            </td>
            <td>
                Determine if a document has been modified.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.util.XModifyBroadcaster
            </td>
            <td>
                Register and be notified when a document is modified.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.util.XNumberFormatsSupplier
            </td>
            <td>
                Get the document's number formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.view.XPrintJobBroadcaster
            </td>
            <td>
                Register and be notified about print progress.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.view.XPrintable
            </td>
            <td>
                Document print functionality.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.view.XRenderable
            </td>
            <td>
                Functionality to render a document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Ironically, searching is not supported by all document types. This is because searching functionality is very
    specific to the document. For example, searching a text document is very different than searching a spreadsheet (in
    terms of desired options). In Calc, searching is provided by the each sheet rather than by the document.
</p>
<p>
    A Calc document is composed of multiple spreadsheets. A significant portion of the functionality, therefore, exists
    in the spreadsheet objects rather than in the parent Calc document. For example, searching text or obtaining draw
    pages both exist in spreadsheet objects — draw pages are discussed in depth in Chapter <a href="#anchor-236">16</a>
    <a href="#anchor-236">Draw and Impress Documents</a>.
</p>
<p>
    The OpenOffice.org API Web site contains extensive, detailed help on most of the services and interfaces. The page
    is built by starting with the Web address “http://api.openoffice.org/docs/common/ref/” and then using the interface
    name to build the rest of the address. For example, the com.sun.star.beans.XPropertySet interface has an Internet
    address as follows:
</p>
<p>
    <a
        href="http://api.openoffice.org/docs/common/ref/com/sun/star/beans/XPropertySet.html">http://api.openoffice.org/docs/common/ref/com/sun/star/beans/XPropertySet.html</a>
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="getting-and-setting-properties">
                    <span id="anchor-237"></span>Getting and setting properties
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The dbg_properties property is a string containing a list of properties supported the object containing the
    property; you should read that last sentence again.
</p>
<p>
    OOo Basic automatically makes these properties available for direct access; other languages may not. The
    com.sun.star.beans.XPropertySet interface provides methods to get, set, and enumerate the object’s properties, as
    shown in .
</p>
<p>
    Table 102. Object methods defined by the interface XPropertySet.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getPropertySetInfo()
            </td>
            <td>
                Return an object supporting the com.sun.star.beans.XPropertySetInfo interface. This object describes the
                object’s properties but may be null.
            </td>
        </tr>
        <tr class="even">
            <td>
                setPropertyValue(name, value)
            </td>
            <td>
                Set the value of the named property. A listener may veto this change.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getPropertyValue(name)
            </td>
            <td>
                Return the value of the named property.
            </td>
        </tr>
        <tr class="even">
            <td>
                addPropertyChangeListener(name, listener)
            </td>
            <td>
                Add an XPropertyChangeListener for the named property. An empty name listens for all properties.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removePropertyChangeListener(name, listener)
            </td>
            <td>
                Remove an XPropertyChangeListener.
            </td>
        </tr>
        <tr class="even">
            <td>
                addVetoableChangeListener(name, listener)
            </td>
            <td>
                Add an XVetoableChangeListener for the named property. An empty name listens for all properties.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeVetoableChangeListener(name, listener)
            </td>
            <td>
                Removes an XVetoableChangeListener.
            </td>
        </tr>
    </tbody>
</table>
<p>
    In OOo Basic, properties are usually accessed directly. demonstrates two ways to obtain the CharFontName property
    from a Writer document — these methods return the name of the font style.
</p>
<p>
    <strong>Listing .</strong> Two methods to obtain the name of the font style.
</p>
<p>
    Print ThisComponent.CharFontName
</p>
<p>
    Print CStr(ThisComponent.getPropertyValue("CharFontName"))
</p>
<p>
    Accessing the property directly is the most expedient method while using OOo Basic, but there are advantages to
    using the methods defined by the XPropertySetInfo interface. Some properties are defined as optional, so not every
    document contains every property. The XPropertySetInfo interface defines the object method hasPropertyByName(),
    which can be used to test for the existence of a property before use; errors can still be avoided by using
    error-handling routines. Another use is to generically enumerate all of the contained properties and possibly their
    values as shown in . shows some properties of a Writer document using the macro in .
</p>
<p>
    <strong>Listing .</strong> Display general document properties.
</p>
<p>
    Sub getPropertyValues
</p>
<p>
    Dim vPropInfo 'PropertySetInfo object
</p>
<p>
    Dim vProps 'Array of properties
</p>
<p>
    Dim vProp 'com.sun.star.beans.Property
</p>
<p>
    Dim v 'Value of a single property
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
    Dim s$ 'General message string
</p>
<p>
    Dim nCount%
</p>
<p>
</p>
<p>
    REM Object implements interface com.sun.star.beans.XPropertySetInfo
</p>
<p>
    vPropInfo = ThisComponent.getPropertySetInfo()
</p>
<p>
    REM sequence&lt; Property &gt; vPropInfo.getProperties()
</p>
<p>
    REM Property vPropInfo.getPropertyByName(name)
</p>
<p>
    REM boolean vPropInfo.hasPropertyByName(name)
</p>
<p>
    vProps = vPropInfo.getProperties()
</p>
<p>
    For i = 0 To UBound(vProps)
</p>
<p>
    If nCount = 30 Then
</p>
<p>
    nCount = 0
</p>
<p>
    MsgBox s, 0, "Properties"
</p>
<p>
    s = ""
</p>
<p>
    End If
</p>
<p>
    nCount = nCount + 1
</p>
<p>
    vProp = vProps(i) 'com.sun.star.beans.Property
</p>
<p>
    s = S &amp; vProp.Name &amp; " = "
</p>
<p>
    v = ThisComponent.getPropertyValue(vProp.Name)
</p>
<p>
    If IsNull(v) Then
</p>
<p>
    s = S &amp; "Null"
</p>
<p>
    ElseIf IsEmpty(v) Then
</p>
<p>
    s = S &amp; "Empty"
</p>
<p>
    ElseIf VarType(v) &lt; 9 Then
</p>
<p>
    s = S &amp; CStr(v)
</p>
<p>
    Else
</p>
<p>
    s = S &amp; "Object or Array"
</p>
<p>
    End If
</p>
<p>
    s = S &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Properties"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000038400000333DECACF7C.gif" style="width:2.5043in;height:2.1035in" />
</p>
<p>
    <strong>Figure .</strong> The first 10 properties of ThisComponent.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                In case you missed the implications of the macro in , it allows you to generically inspect any object
                that supports the XPropertySet interface. The ability to inspect an object is invaluable when you aren’t
                certain what you can do with an object.
            </td>
        </tr>
    </tbody>
</table>
<p>
    After getting a property set information object,
</p>
<ul>
    <li>
        Use getProperties() to get an array of Property objects.
    </li>
    <li>
        Use hasProperty(name) to determine if a property exists.
    </li>
    <li>
        Use getPropertyByName(name) to get a specific property.
    </li>
</ul>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="document-properties">
                    <span id="anchor-238"></span>Document properties
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Document properties contain information related to the document such as the author and creation time; as opposed to
    the properties discussed in the previous section that are related to the document contents such as the current font.
</p>
<p>
    Previous methods for obtaining document properties have been deprecated; for example, using getDocumentInfo to
    obtain and modify user fields. Use File | Properties to open the document properties dialog. Use
    getDocumentProperties to obtain the DocumentProperties object.
</p>
<p>
    <strong>Listing .</strong> Use the DocumentProperties object.
</p>
<p>
    ' com.sun.star.document.DocumentProperties
</p>
<p>
    printDocProperties(ThisComponent.getDocumentProperties())
</p>
<p>
    End Sub
</p>
<p>
    Sub printDocProperties(oDocProps)
</p>
<p>
    Dim s$
</p>
<p>
    Dim oData
</p>
<p>
</p>
<p>
    s = "Author : " &amp; oDocProps.Author &amp; CHR$(10) &amp; _
</p>
<p>
    "AutoloadSecs : " &amp; oDocProps.AutoloadSecs &amp; CHR$(10) &amp; _
</p>
<p>
    "AutoloadURL : " &amp; oDocProps.AutoloadURL &amp; CHR$(10) &amp; _
</p>
<p>
    "DefaultTarget : " &amp; oDocProps.DefaultTarget &amp; CHR$(10) &amp; _
</p>
<p>
    "Description : " &amp; oDocProps.Description &amp; CHR$(10) &amp; _
</p>
<p>
    "EditingCycles : " &amp; oDocProps.EditingCycles &amp; CHR$(10) &amp; _
</p>
<p>
    "EditingDuration : " &amp; _
</p>
<p>
    secondsAsPrettyTime(oDocProps.EditingDuration) &amp; CHR$(10) &amp; _
</p>
<p>
    "Generator : " &amp; oDocProps.Generator &amp; CHR$(10) &amp; _
</p>
<p>
    "ModifiedBy : " &amp; oDocProps.ModifiedBy &amp; CHR$(10) &amp; _
</p>
<p>
    "Title : " &amp; oDocProps.Title &amp; CHR$(10) &amp; _
</p>
<p>
    "Language : " &amp; oDocProps.Language.Country &amp; ":" &amp; _
</p>
<p>
    oDocProps.Language.Language &amp; CHR$(10) &amp; _
</p>
<p>
    "ModificationDate : " &amp; oDocProps.ModificationDate.Day &amp; "/" &amp; _
</p>
<p>
    oDocProps.ModificationDate.Month &amp; "/" &amp; _
</p>
<p>
    oDocProps.ModificationDate.Year &amp; " " &amp; _
</p>
<p>
    oDocProps.ModificationDate.Hours &amp; ":" &amp; _
</p>
<p>
    oDocProps.ModificationDate.Minutes &amp; ":" &amp; _
</p>
<p>
    oDocProps.ModificationDate.Seconds &amp; "." &amp; _
</p>
<p>
    oDocProps.ModificationDate.HundredthSeconds &amp; CHR$(10) &amp; _
</p>
<p>
    "PrintDate : " &amp; oDocProps.PrintDate.Month &amp; "/" &amp; _
</p>
<p>
    oDocProps.PrintDate.Day &amp; "/" &amp; _
</p>
<p>
    oDocProps.PrintDate.Year &amp; " " &amp; _
</p>
<p>
    oDocProps.PrintDate.Hours &amp; ":" &amp; _
</p>
<p>
    oDocProps.PrintDate.Minutes &amp; ":" &amp; _
</p>
<p>
    oDocProps.PrintDate.Seconds &amp; "." &amp; _
</p>
<p>
    oDocProps.PrintDate.HundredthSeconds &amp; CHR$(10) &amp; _
</p>
<p>
    "PrintedBy : " &amp; oDocProps.PrintedBy &amp; CHR$(10) &amp; _
</p>
<p>
    "Subject : " &amp; oDocProps.Subject &amp; CHR$(10) &amp; _
</p>
<p>
    "TemplateDate : " &amp; oDocProps.TemplateDate.Month &amp; "/" &amp; _
</p>
<p>
    oDocProps.TemplateDate.Day &amp; "/" &amp; _
</p>
<p>
    oDocProps.TemplateDate.Year &amp; " " &amp; _
</p>
<p>
    oDocProps.TemplateDate.Hours &amp; ":" &amp; _
</p>
<p>
    oDocProps.TemplateDate.Minutes &amp; ":" &amp; _
</p>
<p>
    oDocProps.TemplateDate.Seconds &amp; "." &amp; _
</p>
<p>
    oDocProps.TemplateDate.HundredthSeconds &amp; CHR$(10) &amp; _
</p>
<p>
    "TemplateName : " &amp; oDocProps.TemplateName &amp; CHR$(10) &amp; _
</p>
<p>
    "TemplateURL : " &amp; oDocProps.TemplateURL &amp; CHR$(10) &amp; _
</p>
<p>
    "Title : " &amp; oDocProps.Title &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Document Properties"
</p>
<p>
    Dim i%
</p>
<p>
    oData = oDocProps.DocumentStatistics
</p>
<p>
    s = ""
</p>
<p>
    For i = LBound(oData) To UBound(oData)
</p>
<p>
    s = s &amp; oData(i).Name &amp; " : " &amp; oData(i).Value &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Document Statistics"
</p>
<p>
    oData = oDocProps.Keywords
</p>
<p>
    s = ""
</p>
<p>
    For i = LBound(oData) To UBound(oData)
</p>
<p>
    s = s &amp; oData(i) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Keywords"
</p>
<p>
    'I have little experience with this object.
</p>
<p>
    'Seems that the user defined properties are available here.
</p>
<p>
    'com.sun.star.comp.comphelper.OPropertyBag
</p>
<p>
    oData = oDocProps.UserDefinedProperties
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="document-properties-from-a-closed-document">
                            <span id="anchor-239"></span>Document properties from a closed document
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    It is easy to access the document properties from a document that is not open.
</p>
<p>
    <strong>Listing .</strong> Read the document properties from a document that is not open.
</p>
<p>
    Sub loadExternalProperties
</p>
<p>
    Dim sPath$
</p>
<p>
    Dim sPathUrl
</p>
<p>
    Dim oDocProps
</p>
<p>
    sPath = ConvertToUrl("/andrew0/home/andy/MoveFigsFromFrames.odt")
</p>
<p>
    oDocProps = CreateUnoService("com.sun.star.document.DocumentProperties")
</p>
<p>
    oDocProps.loadFromMedium(sPath, Array())
</p>
<p>
    printDocProperties(oDocProps)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="custom-properties">
                            <span id="anchor-240"></span>Custom properties
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    You can create and remove your own custom document properties. Use the PropertyAttribute constants shown in while
    creating an attribute to control the behavior of created properties.
</p>
<p>
    Table 103. com.sun.star.beans.PropertyAttribute constants.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                MAYBEVOID
            </td>
            <td>
                1
            </td>
            <td>
                The property value can be void.
            </td>
        </tr>
        <tr class="even">
            <td>
                BOUND
            </td>
            <td>
                2
            </td>
            <td>
                A PropertyChangeEvent will be fired to all registered property change listeners when the value of this
                property changes.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CONSTRAINED
            </td>
            <td>
                4
            </td>
            <td>
                A PropertyChangeEvent will be fired to all registered vetoable change listeners when the value of this
                property changes.
            </td>
        </tr>
        <tr class="even">
            <td>
                TRANSIENT
            </td>
            <td>
                8
            </td>
            <td>
                The property value is not saved with the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                READONLY
            </td>
            <td>
                16
            </td>
            <td>
                The property value is read-only.
            </td>
        </tr>
        <tr class="even">
            <td>
                MAYBEAMBIGUOUS
            </td>
            <td>
                32
            </td>
            <td>
                The property value may be ambiguous.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MAYBEDEFAULT
            </td>
            <td>
                64
            </td>
            <td>
                The property can be set to default.
            </td>
        </tr>
        <tr class="even">
            <td>
                REMOVEABLE
            </td>
            <td>
                128
            </td>
            <td>
                The property can be removed. This used to be called REMOVABLE.
            </td>
        </tr>
        <tr class="odd">
            <td>
                OPTIONAL
            </td>
            <td>
                256
            </td>
            <td>
                The property is optional.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use addProperty(name, attributes, default_value) to create a new property and removeProperty(name) to remove a
    property from the document properties. When a property is created, that property is added to the document's
    properties, so you can use the property set information object
</p>
<p>
    <strong>Listing .</strong> Add a new document property.
</p>
<p>
    Sub AddNewDocumentProperty
</p>
<p>
    Dim oUDP
</p>
<p>
    oUDP = ThisComponent.getDocumentProperties().UserDefinedProperties
</p>
<p>
    If NOT oUDP.getPropertySetInfo().hasPropertyByName("AuthorLastName") Then
</p>
<p>
    oUDP.addProperty("AuthorLastName", _
</p>
<p>
    com.sun.star.beans.PropertyAttribute.MAYBEVOID + _
</p>
<p>
    com.sun.star.beans.PropertyAttribute.REMOVEABLE + _
</p>
<p>
    com.sun.star.beans.PropertyAttribute.MAYBEDEFAULT, _
</p>
<p>
    "Default Last Name")
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="deprecated-document-information-object">
                            <span id="anchor-241"></span>Deprecated document information object
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The deprecated method getDocumentInfo was the previous method for obtaining and modifying user data. The macro in
    sets the value of a user field and then displays its value.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                DocumentInfo and StandaloneDocumentInfo are deprecated and replaced by DocumentProperties.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Deprecated method for getting and setting user information data.
</p>
<p>
    Sub GetUserInfoFields
</p>
<p>
    Dim vDocInfo 'Document Information Object
</p>
<p>
    Dim s$ 'General string to print
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
    vDocInfo = ThisComponent.getDocumentInfo()
</p>
<p>
    vDocInfo.setUserFieldValue(1, "My special user value")
</p>
<p>
    For i% = 0 To vDocInfo().getUserFieldCount()-1
</p>
<p>
    s$ = s$ &amp; vDocInfo.getUserFieldName(i) &amp; " = " &amp;_
</p>
<p>
    CStr(vDocInfo.getUserFieldValue(i)) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s$, 0, "Info Fields"
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="list-events">
                    <span id="anchor-242"></span>List events
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    As OOo operates, it generates events to inform listeners that something has occurred. The event listener/supplier
    framework allows a macro to be called or a listener to be notified when a specific event occurs — for example, when
    a document is loaded or modified, or when text selection changes. Each document type supports the two interfaces
    com.sun.star.document.XEventBroadcaster and com.sun.star.document.XEventsSupplier, allowing them to support
    event-related activities — for example, broadcasting events to listeners and providing a list of supported events.
</p>
<p>
    The macro in lists the event listeners registered with the current document and for OOo. Another use for this macro
    is to list the events supported by the document. Although there are no registered listeners, this macro provides a
    nice list of the supported event types.
</p>
<p>
    <strong>Listing .</strong> List the document's events.
</p>
<p>
    Sub DisplayAvailableEvents
</p>
<p>
    Dim oGEB ' GlobalEventBroadcaster
</p>
<p>
    Dim oDoc
</p>
<p>
    Dim s$
</p>
<p>
    Dim oText
</p>
<p>
</p>
<p>
    oDoc = StarDesktop.LoadComponentFromUrl("private:factory/swriter", "_blank", 0, Array())
</p>
<p>
    oGEB = createUnoservice("com.sun.star.frame.GlobalEventBroadcaster")
</p>
<p>
    s = Join(oGEB.Events.getElementNames(), CHR$(10))
</p>
<p>
    oText = oDoc.Text
</p>
<p>
    oText.InsertString(oText.End, "===Global Events" &amp; CHR$(10), False)
</p>
<p>
    oText.InsertString(oText.End, s, False)
</p>
<p>
    s = Join(oDoc.Events.getElementNames(), CHR$(10))
</p>
<p>
    oText.InsertString(oText.End, CHR$(10) &amp; CHR$(10) &amp; "===Writer Events" &amp; CHR$(10), False)
</p>
<p>
    oText.InsertString(oText.End, s, False)
</p>
<p>
    End Sub
</p>
<p>
    Here is a list of events:
</p>
<ol type="1">
    <li>
        OnStartApp
    </li>
    <li>
        OnCloseApp
    </li>
    <li>
        OnCreate
    </li>
    <li>
        OnNew
    </li>
    <li>
        OnLoadFinished
    </li>
    <li>
        OnLoad
    </li>
    <li>
        OnPrepareUnload
    </li>
    <li>
        OnUnload
    </li>
    <li>
        OnSave
    </li>
    <li>
        OnSaveDone
    </li>
    <li>
        OnSaveFailed
    </li>
    <li>
        OnSaveAs
    </li>
    <li>
        OnSaveAsDone
    </li>
    <li>
        OnSaveAsFailed
    </li>
    <li>
        OnCopyTo
    </li>
    <li>
        OnCopyToDone
    </li>
    <li>
        OnCopyToFailed
    </li>
    <li>
        OnFocus
    </li>
    <li>
        OnUnfocus
    </li>
    <li>
        OnPrint
    </li>
    <li>
        OnViewCreated
    </li>
    <li>
        OnPrepareViewClosing
    </li>
    <li>
        OnViewClosed
    </li>
    <li>
        OnModifyChanged
    </li>
    <li>
        OnTitleChanged
    </li>
    <li>
        OnVisAreaChanged
    </li>
    <li>
        OnModeChanged
    </li>
    <li>
        OnStorageChanged
    </li>
    <li>
        OnPageCountChange
    </li>
    <li>
        OnMailMerge
    </li>
    <li>
        OnMailMergeFinished
    </li>
    <li>
        OnFieldMerge
    </li>
    <li>
        OnFieldMergeFinished
    </li>
    <li>
        OnLayoutFinished
    </li>
</ol>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Many objects besides documents support event listeners. For example, you can listen<br /> to an
                individual cell in a Calc document.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="registering-your-own-listener">
                            <span id="anchor-243"></span>Registering your own listener
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The macro in uses the GlobalEventBroadcaster to access event listeners at the OOo level. The macro in replaces the
    documents OnSave listener with a macro named MySave, in Module1, in the Standard library for My Macros. When the
    document is saved, MySave is automatically called. The association is maintained even after closing and opening the
    document.
</p>
<p>
    <strong>Listing .</strong> Register your own listener.
</p>
<p>
    Sub StealAnEvent
</p>
<p>
    Dim mEventProps(1) as new com.sun.star.beans.PropertyValue
</p>
<p>
    mEventProps(0).Name = "EventType"
</p>
<p>
    mEventProps(0).Value = "StarBasic"
</p>
<p>
    mEventProps(1).Name = "Script"
</p>
<p>
    mEventProps(1).Value = "macro:///Standard.Module1.MySave()"
</p>
<p>
</p>
<p>
    'oGlobalEventBroadcaster = createUnoservice("com.sun.star.frame.GlobalEventBroadcaster")
</p>
<p>
    'oGlobalEventBroadcaster.Events.ReplaceByName("OnStartApp", mEventProps())
</p>
<p>
    ThisComponent.Events.ReplaceByName("OnSave", mEventProps())
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Warn
            </td>
            <td>
                Use the location “macro://hello/Standard.Module1.MySave()” to specify a macro in the document named
                “hello.odt”. Although this works fine, the association is not lost when the document is closed.
            </td>
        </tr>
    </tbody>
</table>
<p>
    An event can just as easily be stored at the OOo level by using the GlobalEventBroadcaster.
</p>
<p>
    Do not mistake the value location for the same URL type syntax used to associate a form control to a macro:
</p>
<p>
    "vnd.sun.star.script:Standard.Module1.LocalMySave?language=Basic&amp;location=document"
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="intercepting-dispatch-commands">
                            <span id="anchor-244"></span>Intercepting dispatch commands
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Replacing a listener event is not the same as intercepting the File &gt; Save dispatch, this is merely a listener
    used after the command has been executed. Intercepting a dispatch will look more like this code provided by Paolo
    Montavoni. One of the problems with this is that a status listener is not used, so, if a command is disabled, the
    menu will not show the command as disabled.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Warn
            </td>
            <td>
                Be very careful while writing listeners and intercepting dispatches. Assume that something will change,
                or that you did something wrong and that OOo will crash; you have been warned.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Replace a few menu commands.
</p>
<p>
    Global oDispatchInterceptor
</p>
<p>
    Global oSlaveDispatchProvider
</p>
<p>
    Global oMasterDispatchProvider
</p>
<p>
    Global oFrame
</p>
<p>
    Global bDebug As Boolean
</p>
<p>
    Dim oCopyDispatch
</p>
<p>
    Sub RegisterInterceptor
</p>
<p>
    oFrame = ThisComponent.currentController.Frame
</p>
<p>
    oDispatchInterceptor = CreateUnoListener("ThisFrame_", _
</p>
<p>
    "com.sun.star.frame.XDispatchProviderInterceptor")
</p>
<p>
    oFrame.registerDispatchProviderInterceptor(oDispatchInterceptor)
</p>
<p>
    End Sub
</p>
<p>
    Sub ReleaseInterceptor()
</p>
<p>
    On Error Resume Next
</p>
<p>
    oFrame.releaseDispatchProviderInterceptor(oDispatchInterceptor)
</p>
<p>
    End Sub
</p>
<p>
    Function ThisFrame_queryDispatch ( oUrl, _
</p>
<p>
    sTargetFrameName As String, lSearchFlags As Long ) As Variant
</p>
<p>
</p>
<p>
    Dim oDisp
</p>
<p>
    Dim sUrl As String
</p>
<p>
    'slot protocol causes OOo crash...
</p>
<p>
    if oUrl.Protocol = "slot:" Then
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    If bDebug Then
</p>
<p>
    Print oUrl.complete
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    'do your dispatch management here:
</p>
<p>
    Select Case oUrl.complete
</p>
<p>
</p>
<p>
    Case ".uno:Copy"
</p>
<p>
    oDisp = GetCopyDispatch 'replace the original dispatch
</p>
<p>
    Case ".uno:Paste"
</p>
<p>
    oDisp = GetCopyDispatch 'replace the original dispatch
</p>
<p>
    Case ".uno:Save"
</p>
<p>
    oDisp = GetCopyDispatch 'replace the original dispatch
</p>
<p>
    Case ".uno:Undo"
</p>
<p>
    oDisp = GetCopyDispatch 'replace the original dispatch
</p>
<p>
    'Case ".uno:blabla"
</p>
<p>
    'do something
</p>
<p>
    Case Else
</p>
<p>
    oDisp = _
</p>
<p>
    oSlaveDispatchProvider.queryDispatch( oUrl, sTargetFrameName, lSearchFlags )
</p>
<p>
</p>
<p>
    End Select
</p>
<p>
</p>
<p>
    ThisFrame_queryDispatch = oDisp
</p>
<p>
    End Function
</p>
<p>
    Function ThisFrame_queryDispatches ( mDispatches ) As Variant
</p>
<p>
    'ThisFrame_queryDispatches = mDispatches()
</p>
<p>
    End Function
</p>
<p>
    Function ThisFrame_getSlaveDispatchProvider ( ) As Variant
</p>
<p>
    ThisFrame_getSlaveDispatchProvider = oSlaveDispatchProvider
</p>
<p>
    End Function
</p>
<p>
    Sub ThisFrame_setSlaveDispatchProvider ( oSDP )
</p>
<p>
    oSlaveDispatchProvider = oSDP
</p>
<p>
    End Sub
</p>
<p>
    Function ThisFrame_getMasterDispatchProvider ( ) As Variant
</p>
<p>
    ThisFrame_getMasterDispatchProvider = oMasterDispatchProvider
</p>
<p>
    End Function
</p>
<p>
    Sub ThisFrame_setMasterDispatchProvider ( oMDP )
</p>
<p>
    oMasterDispatchProvider = oMDP
</p>
<p>
    End Sub
</p>
<p>
    Sub toggleDebug
</p>
<p>
    bDebug = Not bDebug
</p>
<p>
    End Sub
</p>
<p>
    Function GetCopyDispatch()
</p>
<p>
    If Not IsNull(oCopyDispatch) Then
</p>
<p>
    oCopyDispatch = _
</p>
<p>
    CreateUnoListener("MyCustom_", "com.sun.star.frame.XDispatch")
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    GetCopyDispatch = oCopyDispatch
</p>
<p>
    End Function
</p>
<p>
    Sub MyCustom_dispatch(URL, Arguments)
</p>
<p>
    Select Case URL.complete
</p>
<p>
    Case ".uno:Copy"
</p>
<p>
    MsgBox "Sorry, the original " &amp; URL.complete &amp; _
</p>
<p>
    " dispatch was stolen from Paolo M.", 48
</p>
<p>
</p>
<p>
    Case ".uno:Paste"
</p>
<p>
    ThisComponent.CurrentSelection(0).String = _
</p>
<p>
    "**** ARBITRARY CLIPBOARD CONTENT PROVIDED BY PAOLO M. ****"
</p>
<p>
    Case ".uno:Save"
</p>
<p>
    MsgBox "Sorry, the original " &amp; URL.complete &amp; _
</p>
<p>
    " dispatch was stolen from Paolo M.", 48
</p>
<p>
</p>
<p>
    Case ".uno:Undo"
</p>
<p>
    MsgBox "Undo What????!!!???", 16
</p>
<p>
    Case Else
</p>
<p>
    End Select
</p>
<p>
    End Sub
</p>
<p>
    Sub MyCustom_addStatusListener(Control, URL)
</p>
<p>
    End Sub
</p>
<p>
    Sub MyCustom_removeStatusListener (Control, URL)
</p>
<p>
    End Sub
</p>
<p>
    A similar method has been used to intercept context menus using a XContextMenuInterceptor.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="link-targets">
                    <span id="anchor-245"></span>Link targets
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Link targets, also called “jump marks,” can be used to jump directly to a specific location. The document navigator
    contains a list of link targets. The object method getLinks(), defined by the
    com.sun.star.document.XLinkTargetSupplier interface, provides access to the link targets. The getLinks() method
    returns an object that supports the XNameAccess interface. In other words, you can access the links using the
    methods getByName(), getElementNames(), hasByName(), and hasElements().
</p>
<p>
    The object returned by the getLinks() method does not access the links directly, but rather it provides access to
    other objects that can. To access all of the individual links, first use the getLinks() method to access the master
    list of links. Use this returned object to access each “family” of links based on the family name. For example, to
    obtain an object that can access all of the table links, use:
</p>
<p>
    oDoc.getLinks().getByName("Tables")
</p>
<p>
    After obtaining a family of links, you can also obtain the individual links by name. At this final step, you have
    access to both the name of the link and the object that is linked. The macro in obtains all of the link families and
    the links that they contain, and then displays the link’s name in a newly created Write document.
</p>
<p>
    <strong>Listing .</strong> Get jump targets for the current document.
</p>
<p>
    Sub GetJumpTargets
</p>
<p>
    Dim sLinkNames 'Tables, Text Frames, Headings, Bookmarks, etc...
</p>
<p>
    Dim vOneLink 'One link type
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
    Dim s$ 'General string
</p>
<p>
    Dim vtemp
</p>
<p>
    Dim oNewDoc
</p>
<p>
    Dim noArgs() 'An empty array for the arguments
</p>
<p>
    Dim vComp 'The loaded component
</p>
<p>
    Dim sURLs() 'URLs of the new document types to load
</p>
<p>
    Dim sURL As String 'URL of the document to load
</p>
<p>
    Dim oText
</p>
<p>
</p>
<p>
    sURL = "private:factory/swriter"
</p>
<p>
    vComp = StarDesktop.LoadComponentFromUrl(sURL, "_blank", 0, noArgs())
</p>
<p>
    oText = vComp.Text
</p>
<p>
    oText.insertString(oText.End, "LINK TYPES" &amp; CHR$(10), False)
</p>
<p>
    sLinkNames = ThisComponent.getLinks().getElementNames()
</p>
<p>
    oText.insertString(oText.End, Join(sLinkNames, Chr$(10)), False)
</p>
<p>
    oText.insertString(oText.End, _
</p>
<p>
    CHR$(10) &amp; CHR$(10) &amp; "JUMP TARGETS" &amp; CHR$(10), _
</p>
<p>
    False)
</p>
<p>
    For i = 0 To UBound(sLinkNames)
</p>
<p>
    vOneLink = ThisComponent.getLinks().getByName(sLinkNames(i))
</p>
<p>
    s = s &amp; sLinkNames(i) &amp; " = "
</p>
<p>
    If IsEmpty(vOneLink) Then
</p>
<p>
    s = s &amp; "Empty"
</p>
<p>
    Else
</p>
<p>
    s = s &amp; sLinkNames(i) &amp; " : " &amp; _
</p>
<p>
    Join(vOneLink.getElementNames(), CHR$(10) &amp; sLinkNames(i) &amp; " : " )
</p>
<p>
    REM To obtain the actual link object, such as a
</p>
<p>
    REM text table or a graphics object, use the following
</p>
<p>
    REM vtemp = vOneLink.getElementNames()
</p>
<p>
    REM vObj = vOneLink.getByName(vtemp(0))
</p>
<p>
    End If
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    'MsgBox s, 0, "Jump Targets"
</p>
<p>
    oText.insertString(oText.End, s, False)
</p>
<p>
    End Sub
</p>
<p>
    You can use jump marks (link targets) to jump directly to a specific location when a document is loaded. Use jump
    marks to focus the cursor at a specific location when a document is opened, as shown in . The JumpMark attribute
    sets the name from the values shown in the created document (if you run the macro above); for example,
    “Table1|table” jumps to the specified table.
</p>
<p>
    <strong>Listing .</strong> Use the JumpMark property to jump to a link target.
</p>
<p>
    Dim Props(0)
</p>
<p>
    Props(0).Name = "JumpMark"
</p>
<p>
    Props(0).Value = "Table1|table"
</p>
<p>
    sUrl = "file://c:/docs/Special_doc.odt"
</p>
<p>
    vDoc = StarDesktop.LoadComponentFromUrl(sUrl, "_blank", 0, Props())
</p>
<p>
    You can also use the jump mark as part of the URL (see ) by placing it at the end of the URL separated by an
    octothorpe character (#). If the jump mark contains any special characters, such as spaces, they must be encoded
    using standard URL notation. For example, a space is encoded as %20.
</p>
<p>
    <strong>Listing .</strong> Use the JumpMark property to jump to a link target.
</p>
<p>
    sUrl = "file://c:/docs/Special_doc.odt#Table1|table"
</p>
<p>
    vDoc = StarDesktop.LoadComponentFromUrl(sUrl, "_blank", 0, Props())
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The character “#” has many names, including: number sign, pound sign, hash, sharp, crunch, hex, grid,
                pigpen, tic-tac-toe, splat, crosshatch, and octothorpe, to name a few.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="accessing-view-data-xviewdatasupplier">
                    <span id="anchor-246"></span>Accessing view data: XViewDataSupplier
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Using OOo, open a document, edit it or change something (for example, move to another page or change the zoom
    factor), close the document, and open the document again. When you do this, the document opens at the same screen
    location, at the same size, with the same zoom factor as was active when it was last saved. This information is
    stored with the document and is available through the interface com.sun.star.document.XViewDataSupplier. This
    interface provides one object method, getViewData(). displays the view data for ThisComponent (see ).
</p>
<p>
    <strong>Listing .</strong> GetViewData is found in the
</p>
<p>
    Sub GetViewData
</p>
<p>
    Dim vViewData 'View data object
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
    Dim j% 'Index variable
</p>
<p>
    Dim s$ 'General string
</p>
<p>
    Dim vtemp 'View data for one object
</p>
<p>
    vViewData = ThisComponent.getViewData()
</p>
<p>
    REM For each view of the data
</p>
<p>
    For i = 0 To vViewData.getCount() - 1
</p>
<p>
    vtemp = vViewData.getByIndex(i)
</p>
<p>
    For j = 0 To UBound(vtemp)
</p>
<p>
    s = s &amp; vtemp(j).Name &amp; " = " &amp; CStr(vtemp(j).Value) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "View Data"
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000002580000035A135DD035.gif" style="width:1.5839in;height:2.0835in" />
</p>
<p>
    <strong>Figure .</strong> View data for a document.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="close-a-document-xcloseable">
                    <span id="anchor-247"></span>Close a document: XCloseable
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    As of OOo 1.1.0, each document type supports the com.sun.star.util.XCloseable interface. To close these objects,
    call the object method close(bForce). If bForce is True, the object must close. In other words, it may not refuse to
    close. If, however, bForce is False, the object may refuse to close.
</p>
<p>
    Before a document is closed, a message is sent to all registered listeners, giving them an opportunity to prevent
    the closure. If the close request is not vetoed by any listener, a message is sent to each registered listener,
    advising them that the document will close. The XCloseBroadcaster interface provides methods to add and remove a
    close listener (see ).
</p>
<p>
    Table 104. Object methods defined by the interface XCloseBroadcaster.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                addCloseListener(XCloseListener)
            </td>
            <td>
                Add listener to receive or have a veto for “close” events.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeCloseListener(XCloseListener)
            </td>
            <td>
                Remove an object registered as a close listener using addCloseListener().
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in demonstrates the safe way to close a document using the object’s close() method. For versions of OOo
    prior to 1.1.0, the close() method is not available, so you must use the dispose() method instead. The dispose()
    method is unconditional and is not the preferred method to close a document (by document I really mean any object
    that supports both close and dispose) because it doesn’t allow a registered user who might be using the document to
    veto the close and finish what he or she is doing.
</p>
<p>
    <strong>Listing .</strong> The safe way to close a document.
</p>
<p>
    If HasUnoInterfaces(oDoc, "com.sun.star.util.XCloseable") Then
</p>
<p>
    oDoc.close(true)
</p>
<p>
    Else
</p>
<p>
    oDoc.dispose()
</p>
<p>
    End If
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Do not use dispose to close a document, it is there for legacy purposes. Assume, for example, that you
                start printing a document and then immediately dispose() the document. The document that is being used
                for printing is suddenly gone and OOo crashes.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="draw-pages-xdrawpagessupplier">
                    <span id="anchor-248"></span>Draw Pages: XDrawPagesSupplier
                </h2>
                <ol type="1">
                    <li>
                        <h3 id="draw-and-impress">
                            <span id="anchor-249"></span>Draw and Impress
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Draw and Impress are almost identical in the interfaces that they support. Draw is specifically designed to handle
    independent graphic objects, whereas Impress is designed for business effects and presentations. The drawing
    functionality of Draw and Impress is identical, however. The graphic objects are drawn and displayed on “draw
    pages.” By their design, both Draw and Impress support multiple draw pages. The functionality to retrieve a DrawPage
    object is defined by the com.sun.star.drawing.XDrawPagesSupplier interface. The interface
    com.sun.star.drawing.XDrawPages defines methods to retrieve, insert, and remove individual pages (see ).
</p>
<p>
    Table 105. Object methods defined by the interface XDrawPages.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                InsertNewByIndex(index)
            </td>
            <td>
                Create and insert a new draw page or master page.
            </td>
        </tr>
        <tr class="even">
            <td>
                remove(XDrawPage)
            </td>
            <td>
                Remove a draw page or master page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getCount()
            </td>
            <td>
                Return the number of draw pages.
            </td>
        </tr>
        <tr class="even">
            <td>
                getByIndex(index)
            </td>
            <td>
                Return a specific draw page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasElements()
            </td>
            <td>
                Return True if there are documents.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in demonstrates how to iterate through each of the draw pages. Each draw page is exported to a JPG file.
    The export type is specified by the MediaType property.
</p>
<p>
    <strong>Listing .</strong> Export each graphics page to a JPG.
</p>
<p>
    oFilter=CreateUnoService("com.sun.star.drawing.GraphicExportFilter")
</p>
<p>
    Dim args(1) as new com.sun.star.beans.PropertyValue
</p>
<p>
    For i=0 to oDoc.getDrawPages().getcount()-1
</p>
<p>
    oPage = oDoc.getDrawPages().getByIndex(i)
</p>
<p>
    name = oPage.name
</p>
<p>
    oFilter.setSourceDocument(opage)
</p>
<p>
    args(0).Name = "URL"
</p>
<p>
    args(0).Value = "file:///c|/"&amp;oPage.name&amp;".JPG"
</p>
<p>
    args(1).Name = "MediaType"
</p>
<p>
    args(1).Value = "image/jpeg"
</p>
<p>
    oFilter.filter(args())
</p>
<p>
    Next
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The index used to access draw pages is zero based. This means that the first draw page is at location 0.
                If a document contains four draw pages, they are numbered 0 through 3. This is why the For loop in is
                from 0 To oDoc.getDrawPages().getcount()-1.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in creates a new Impress document and then adds a graphic image to the first draw page. The draw image is
    sized to retain the aspect ratio.
</p>
<p>
    <strong>Listing .</strong> Add a proportionally sized graphic to a draw page.
</p>
<p>
    Sub AddProportionalGraphic
</p>
<p>
    Dim oDoc 'Newly created Impress document
</p>
<p>
    Dim oDrawPage 'The draw page that will contain the graphic image
</p>
<p>
    Dim oGraph 'The created graphic image
</p>
<p>
</p>
<p>
    REM Create an Impress presentation document!
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/simpress",_
</p>
<p>
    "_default", 0, Array())
</p>
<p>
</p>
<p>
    REM Insert a second draw page if desired,
</p>
<p>
    REM leaving the first draw page untouched!
</p>
<p>
    REM Could use the property DrawPages
</p>
<p>
    REM oDrawPage = oDoc.DrawPages.insertNewByIndex(1)
</p>
<p>
    REM oDrawPage = oDoc.getDrawPages().insertNewByIndex(1)
</p>
<p>
    REM In this case, simply use the first draw page!
</p>
<p>
    oDrawPage = oDoc.getDrawPages().getByIndex(0)
</p>
<p>
</p>
<p>
    REM Create a graphics object that can be inserted into the document
</p>
<p>
    oGraph = oDoc.createInstance("com.sun.star.drawing.GraphicObjectShape")
</p>
<p>
</p>
<p>
    REM Set the URL of the image so that it can be added to the document
</p>
<p>
    oGraph.GraphicURL = "http://www.openoffice.org/images/AOO_logos/orb.jpg"
</p>
<p>
    oDrawPage.add(oGraph)
</p>
<p>
</p>
<p>
    REM If I stop here, there will be a very small graphic image in the
</p>
<p>
    REM upper-left corner of the document. This is pretty much useless.
</p>
<p>
    REM Although I could simply size the graphic to the same size as the bitmap
</p>
<p>
    REM size, I choose instead to size this so that it is as large as possible
</p>
<p>
    REM without changing the aspect ratio.
</p>
<p>
    REM Determine the ratio of the height to the width for the image and
</p>
<p>
    REM also for the draw page.
</p>
<p>
</p>
<p>
    Dim oNewSize As New com.sun.star.awt.Size 'New Image size
</p>
<p>
    Dim oBitmapSize As New com.sun.star.awt.Size 'Bitmap size
</p>
<p>
</p>
<p>
    Dim dImageRatio As Double 'Ratio of the height to width
</p>
<p>
    Dim dPageRatio As Double 'Ratio of the height to width
</p>
<p>
</p>
<p>
    oBitmapSize = oGraph.GraphicObjectFillBitmap.GetSize
</p>
<p>
    dImageRatio = CDbl(oBitmapSize.Height) / CDbl(oBitmapSize.Width)
</p>
<p>
    dPageRatio = CDbl(oDrawPage.Height) / CDbl(oDrawPage.Width)
</p>
<p>
</p>
<p>
    REM Compare the ratios to see which is wider, relatively speaking
</p>
<p>
    If dPageRatio &gt; dImageRatio Then
</p>
<p>
    oNewSize.Width = oDrawPage.Width
</p>
<p>
    oNewSize.Height = CLng(CDbl(oDrawPage.Width) * dImageRatio)
</p>
<p>
    Else
</p>
<p>
    oNewSize.Width = CLng(CDbl(oDrawPage.Height) / dImageRatio)
</p>
<p>
    oNewSize.Height = oDrawPage.Height
</p>
<p>
    End If
</p>
<p>
    REM Center the image on the Impress page!
</p>
<p>
    Dim oPosition as new com.sun.star.awt.Point
</p>
<p>
    oPosition.X = (oDrawPage.Width - oNewSize.Width)/2
</p>
<p>
    oPosition.Y = (oDrawPage.Height - oNewSize.Height)/2
</p>
<p>
</p>
<p>
    oGraph.SetSize(oNewSize)
</p>
<p>
    oGraph.SetPosition(oPosition)
</p>
<p>
    End Sub
</p>
<p>
    As already stated, Impress and Draw documents are very similar in the API that they support. The macro in draws
    lines in a Draw document (see).
</p>
<p>
    <strong>Listing .</strong> Draw lines in a new graphic document.
</p>
<p>
    Sub DrawLinesInDrawDocument
</p>
<p>
    Dim oDoc 'Newly created Draw document
</p>
<p>
    Dim oDrawPage 'The draw page that will contain the graphics image
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    REM Create a new Draw document!
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/sdraw",_
</p>
<p>
    "_default", 0, Array())
</p>
<p>
</p>
<p>
    REM Use the first draw page
</p>
<p>
    oDrawPage = oDoc.getDrawPages().getByIndex(0)
</p>
<p>
</p>
<p>
    Dim i As Long
</p>
<p>
    Dim oPos as new com.sun.star.awt.Point
</p>
<p>
    Dim oSize as new com.sun.star.awt.Size
</p>
<p>
    Dim dStepSize As Double
</p>
<p>
    dStepSize = CDbl(oDrawPage.Height) / 10
</p>
<p>
</p>
<p>
    For i = 0 To 10
</p>
<p>
    oShape = oDoc.createInstance("com.sun.star.drawing.LineShape")
</p>
<p>
    oShape.LineColor = rgb(0, 255 - 20 * i, 20 * i)
</p>
<p>
    oShape.LineWidth = 250
</p>
<p>
</p>
<p>
    oPos.X = 0
</p>
<p>
    oPos.Y = CLng(CDbl(i) * dStepSize)
</p>
<p>
    oShape.setPosition(oPos)
</p>
<p>
</p>
<p>
    oSize.width = oDrawPage.Width
</p>
<p>
    oSize.height= oDrawPage.Height - 2 * oPos.Y
</p>
<p>
    oShape.setSize(oSize)
</p>
<p>
    oDrawPage.add(oShape)
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000200000002A300000337CCA296E1.gif" style="width:1.5083in;height:1.8366in" />
</p>
<p>
    <strong>Figure .</strong> These lines drawn in a Draw document overlap.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="draw-lines-with-arrows-in-calc">
                            <span id="anchor-250"></span>Draw lines with arrows in Calc
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Each Calc document contains a single draw page for each sheet In Calc, each sheet is like a transparent layer
    containing drawing data on top of the standard document data. The following macro demonstrates a couple of useful
    things:
</p>
<ul>
    <li>
        Each cell has a position on the draw page. This macro draws a line between specific cells by using the Position
        attribute on a cell. The line is draw from the upper left corner of cell B2 to the upper left corner of cell D4.
    </li>
    <li>
        A LineShape is created by the document.
    </li>
    <li>
        After creation, attributes are set on the LineShape; for example, position, size, and color.
    </li>
    <li>
        The LineShape is added to the draw page.
    </li>
    <li>
        Arrows, and other line endings, are added <em>after</em> the LineShape has been added to the draw page – at
        least this is required in OOo version 3.3.0.
    </li>
</ul>
<p>
    Arrow line endings are set by setting the LineEndName and LineStartName. I was not able to find a list of supported
    arrow names, so, I used the GUI to find the names mentioned in the GUI, and the few that I tried worked. Next, I
    searched the source code and I found filter/source/msfilter/escherex.cx and svx/source/dialog/sdstring.src, which
    contains the following names:
</p>
<ul>
    <li>
        Arrow
    </li>
    <li>
        Arrow concave
    </li>
    <li>
        Circle
    </li>
    <li>
        Dimension Lines
    </li>
    <li>
        Double Arrow
    </li>
    <li>
        Line Arrow
    </li>
    <li>
        Rounded large Arrow
    </li>
    <li>
        Rounded short Arrow
    </li>
    <li>
        Small Arrow
    </li>
    <li>
        Square
    </li>
    <li>
        Square 45
    </li>
    <li>
        Symmetric Arrow
    </li>
</ul>
<p>
    In testing, the en-US names worked in other locales. Locale specific names work, but the value that is stored is
    based on the en-US locale name. In other words, using "Double flèche" with a French locale sets the property to
    “Double Arrow”.
</p>
<p>
    <strong>Listing .</strong> Draw lines in a Calc document.
</p>
<p>
    Sub InsertLineInCalcDocument
</p>
<p>
    Dim oLine
</p>
<p>
    Dim oCell1
</p>
<p>
    Dim oCell2
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oPos as new com.sun.star.awt.Point
</p>
<p>
    Dim oSize as new com.sun.star.awt.Size
</p>
<p>
    Dim oPage
</p>
<p>
    oSheet = ThisComponent.Sheets(0)
</p>
<p>
    oCell1 = oSheet.getCellByPosition(1, 1)
</p>
<p>
    oCell2 = oSheet.getCellByPosition(3, 3)
</p>
<p>
    oLine = ThisComponent.createInstance("com.sun.star.drawing.LineShape")
</p>
<p>
</p>
<p>
    oPos.x = oCell1.Position.X
</p>
<p>
    oPos.y = oCell1.Position.Y
</p>
<p>
    oLine.Position = oPos
</p>
<p>
    oSize.Width = oCell2.Position.X - oCell1.Position.X
</p>
<p>
    oSize.Height = oCell2.Position.Y - oCell1.Position.Y
</p>
<p>
    oLine.Size = oSize
</p>
<p>
</p>
<p>
    oLine.LineWidth = 4
</p>
<p>
    oLine.LineColor = RGB(128, 0, 0)
</p>
<p>
    oPage = oSheet.getDrawPage()
</p>
<p>
    oPage.add(oLine)
</p>
<p>
</p>
<p>
    REM You must do this AFTER inserting the line into the page.
</p>
<p>
    oLine.LineEndName = "Arrow"
</p>
<p>
    oLine.LineStartName = "Double Arrow"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000015500000053148EE2C8.png" style="width:3.552in;height:0.8646in" />
</p>
<p>
    <strong>Figure .</strong> Draw a line in a Calc document.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="writer">
                            <span id="anchor-251"></span>Writer
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Each Writer document contains a single draw page for the entire document. In Writer, the page is like a transparent
    layer containing drawing data on top of the standard document data.
</p>
<p>
    Writer documents do not support the XDrawPagesSupplier interface, because they only contain a single draw page. They
    do, however, support the XDrawPageSupplier interface, which defines the single object method getDrawPage().
</p>
<p>
    The macro in uses optional draw page properties — namely height and width. The draw page from a Writer document does
    not contain these properties. The draw page in a Writer document has other peculiarities, however. For example,
    adding lines to the draw page — as done in — adds them as characters at the cursor position rather than interpreting
    the positions as specific locations in the document. The macro in draws lines to demonstrate this behavior (also see
    ).
</p>
<p>
    <strong>Listing .</strong> Draw lines in a Write document.
</p>
<p>
    Sub DrawLinesInWriteDocument
</p>
<p>
    Dim oDoc 'Newly created Writer document
</p>
<p>
    Dim oDrawPage 'The draw page that will contain the graphics image
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    REM Create a new Writer document!
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/swriter",_
</p>
<p>
    "_default", 0, Array())
</p>
<p>
</p>
<p>
    oDrawPage = oDoc.getDrawPage()
</p>
<p>
</p>
<p>
    Dim i As Long
</p>
<p>
    Dim oSize as new com.sun.star.awt.Size
</p>
<p>
    Dim dStepSize As Double
</p>
<p>
    dStepSize = 800
</p>
<p>
</p>
<p>
    For i = 0 To 10
</p>
<p>
    oShape = oDoc.createInstance("com.sun.star.drawing.LineShape")
</p>
<p>
    oShape.LineColor = rgb(255, 255 - 20 * i, 20 * i)
</p>
<p>
    oShape.LineWidth = 50
</p>
<p>
</p>
<p>
    oSize.width = dStepSize - CLng(CDbl(i) * dStepSize / 10)/2
</p>
<p>
    oSize.width = CLng(dStepSize/5 * i - dStepSize)
</p>
<p>
    oSize.height= dStepSize
</p>
<p>
    oShape.setSize(oSize)
</p>
<p>
    oDrawPage.add(oShape)
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000038400000281247BCCDB.gif" style="width:3.5134in;height:2.3098in" />
</p>
<p>
    <strong>Figure .</strong> These lines drawn in a Writer document are treated as characters.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="the-model">
                    <span id="anchor-252"></span>The model
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    XModel is the primary interface that distinguishes a component as a document, as opposed to the OOo Basic IDE or the
    included help pages. Objects that implement the interface com.sun.star.frame.XModel represent a component created
    from a URL. OOo document objects may be controlled by a controller, which is also considered a view of the document.
    The XModel interface defines the object methods in .
</p>
<p>
    Table 106. Object methods defined by the interface com.sun.star.frame.XModel.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getURL()
            </td>
            <td>
                URL of the document returned as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                getArgs()
            </td>
            <td>
                Return a copy of the com.sun.star.document.MediaDescriptor for this model (document).
            </td>
        </tr>
        <tr class="odd">
            <td>
                lockControllers()
            </td>
            <td>
                Prevent some display updates — macros may run faster. Be sure to unlock the controllers when you are
                finished.
            </td>
        </tr>
        <tr class="even">
            <td>
                unlockControllers()
            </td>
            <td>
                Call this once for each call to lockControllers().
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasControllersLocked()
            </td>
            <td>
                Is there at least one lock remaining?
            </td>
        </tr>
        <tr class="even">
            <td>
                getCurrentController()
            </td>
            <td>
                The controller that currently controls this model.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getCurrentSelection()
            </td>
            <td>
                Current selection on the current controller.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="document-arguments">
                            <span id="anchor-253"></span>Document arguments
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Arguments passed to the document loader control how the document is loaded; for example, opening a document as
    read-only. Use getArgs() to obtain the documents media descriptor, which details how the document was loaded. The
    MediaDescriptor service can be accessed as a series of optional properties or as an array of properties (see and ).
</p>
<p>
    <strong>Listing .</strong> Print the document media descriptor.
</p>
<p>
    Sub printDocumentArgs()
</p>
<p>
    REM This says to ignore any lines that cause an error.
</p>
<p>
    REM Obtaining a value may cause an error, but that is
</p>
<p>
    REM not a problem. It just prevents a value from being printed.
</p>
<p>
    On Error Resume Next
</p>
<p>
</p>
<p>
    Dim vArgs 'Media descriptor as an array of com.sun.star.beans.PropertyValue
</p>
<p>
    Dim s$ 'Display string
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
</p>
<p>
    REM Obtain the media descriptor. It turns out that this
</p>
<p>
    REM can be represented as an array of PropertyValue services.
</p>
<p>
    vArgs = ThisComponent.getArgs()
</p>
<p>
</p>
<p>
    For i = 0 To UBound(vArgs) 'For each property
</p>
<p>
    s = s &amp; vArgs(i).Name &amp; " = " 'Add the property name and an equals sign
</p>
<p>
    s = s &amp; vArgs(i).Value 'Obtaining the value may fail!
</p>
<p>
    s = s &amp; CHR$(10) 'Add a new-line character
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Args"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001D5000000FB2D3752BA.png" style="width:4.8854in;height:2.6146in" />
</p>
<p>
    <strong>Figure .</strong> Properties returned by the getArgs() object method.
</p>
<p>
    A text file is not a standard OOo Writer file, but rather, a simple file that has typically been created by a simple
    editor such as Notepad. Text files contain no information that identify the character set that was used, or how
    lines are terminated. Text files usually use the file extension TXT. When a text file is opened, OOo displays a
    dialog and asks questions about the file so that it knows how the text file is encoded. I was asked how to load a
    text file using a macro, avoiding the dialog and explicitly specifying the import values. Although I was able to
    correctly determine the import filter name, I had no idea how to specify the required filter options. I had no idea,
    that is, until I found the getArgs() object method.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                If you know how to open a document using the GUI, but are uncertain how the arguments must be set to
                load the document using loadComponentFromURL, then first load the document using the GUI, then inspect
                the document's media descriptor. Hint: look at FilterOptions.
            </td>
        </tr>
    </tbody>
</table>
<p>
    shows the arguments for an imported text file. The FilterName property indicates the name of the import filter, and
    the FilterOptions property indicates the filter options that were used to open the file. Using these properties with
    the desktop object method LoadComponentFromUrl(), the file is correctly imported and the dialog is not displayed.
    contains a list of the properties that may be returned from the getArgs() object method. The OOo API Web site
    contains a few more properties, but they are obscure or deprecated.
</p>
<p>
    Table 107. Object properties defined by the service MediaDescriptor.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Aborted
            </td>
            <td>
                May be set if document load is aborted while entering a password.
            </td>
        </tr>
        <tr class="even">
            <td>
                AsTemplate
            </td>
            <td>
                Document was loaded as a template.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Author
            </td>
            <td>
                Author of this document version; this is for versioning.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharacterSet
            </td>
            <td>
                Document character set for single-byte characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Comment
            </td>
            <td>
                Comment on the current document version; this is for versioning.
            </td>
        </tr>
        <tr class="even">
            <td>
                DocumentTitle
            </td>
            <td>
                If the document title is specified, it is included here.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FilterName
            </td>
            <td>
                Filter used to import or save this document.
            </td>
        </tr>
        <tr class="even">
            <td>
                FilterOptions
            </td>
            <td>
                Filter used to import this document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FilterData
            </td>
            <td>
                Additional import properties if the FilterOptions string is not sufficient.
            </td>
        </tr>
        <tr class="even">
            <td>
                Hidden
            </td>
            <td>
                If the Hidden argument is specified during load, it is included here.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HierarchicalDocumentName
            </td>
            <td>
                The hierarchical path to the embedded document from topmost container.
            </td>
        </tr>
        <tr class="even">
            <td>
                InputStream
            </td>
            <td>
                If the InputStream is specified during load, it is included here.
            </td>
        </tr>
        <tr class="odd">
            <td>
                InteractionHandler
            </td>
            <td>
                Exception handler if an error occurs during import.
            </td>
        </tr>
        <tr class="even">
            <td>
                JumpMark
            </td>
            <td>
                Jump to this marked position after loading the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MediaType
            </td>
            <td>
                MIME type of this document.
            </td>
        </tr>
        <tr class="even">
            <td>
                OpenNewView
            </td>
            <td>
                Opens a new view for an already loaded document, rather than just opening the document twice. In other
                words, request two views of the same data.
            </td>
        </tr>
        <tr class="odd">
            <td>
                OutputStream
            </td>
            <td>
                Stream to use while writing the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                Overwrite
            </td>
            <td>
                Overwrite any existing file on save.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Password
            </td>
            <td>
                Password for loading or storing the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                Preview
            </td>
            <td>
                Document loaded in preview mode; optimizes for preview-only use.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ReadOnly
            </td>
            <td>
                Document opened as read-only; controller will not change the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                Referer
            </td>
            <td>
                URL of document referrer — for example, if opened by clicking an HTTP link.
            </td>
        </tr>
        <tr class="odd">
            <td>
                RepairPackage
            </td>
            <td>
                Open the document in repair mode.
            </td>
        </tr>
        <tr class="even">
            <td>
                StartPresentation
            </td>
            <td>
                Immediately after loading an Impress document, start the presentation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                StatusIndicator
            </td>
            <td>
                If a status indicator was specified when the document was loaded, it is included here.
            </td>
        </tr>
        <tr class="even">
            <td>
                Unpacked
            </td>
            <td>
                If True, an OOo document is stored as a folder rather than a ZIP file.
            </td>
        </tr>
        <tr class="odd">
            <td>
                URL
            </td>
            <td>
                URL of the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                Version
            </td>
            <td>
                Current document version, if versioning is supported.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ViewData
            </td>
            <td>
                The view data to use.
            </td>
        </tr>
        <tr class="even">
            <td>
                ViewId
            </td>
            <td>
                The ID of the initial view.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MacroExecutionMode
            </td>
            <td>
                Specifies how macros are treated when the document is loaded.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="saving-a-document">
                    <span id="anchor-254"></span>Saving a document
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The location where a document is saved is called its Uniform Resource Locator (URL) — in other words, its file name.
    A file URL usually contains the complete path to the file. When the file name is referred to as the URL, it has a
    form similar to “file:///c:/myfile.sxw” rather than “c:\myfile.sxw”. A URL is a general way of writing a storage
    location, one that can be extended conveniently to include a wide range of storage location types in a
    manufacturer-independent and computer-independent manner. OOo Basic supports the functions ConvertToURL and
    ConvertFromURL to convert between the two notations. The XStorable interface defines object methods to save a
    document to a URL (see ).
</p>
<p>
    Table 108. Object methods defined by the service com.sun.star.frame.XStorable.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                hasLocation()
            </td>
            <td>
                True if the document has a storage location and False if this is a new blank document.
            </td>
        </tr>
        <tr class="even">
            <td>
                getLocation()
            </td>
            <td>
                Return the URL where the object was stored after calling storeAsURL().
            </td>
        </tr>
        <tr class="odd">
            <td>
                isReadonly()
            </td>
            <td>
                You cannot call store() if the file was called from a read-only location.
            </td>
        </tr>
        <tr class="even">
            <td>
                store()
            </td>
            <td>
                Stores the data to the current URL.
            </td>
        </tr>
        <tr class="odd">
            <td>
                storeAsURL(URL, args)
            </td>
            <td>
                Stores the document to the specified URL, which becomes the current URL.
            </td>
        </tr>
        <tr class="even">
            <td>
                storeToURL(URL, args)
            </td>
            <td>
                Stores the document to the specified URL, but the current URL does not change.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the object method hasLocation() to determine if a document knows where to save itself, and use the method
    store() to save it to the current URL. The macro in uses methods defined by both XStorable and XModifiable to save a
    document to disk. The document is stored only if it knows where to store itself, it has changed, and it is not
    read-only.
</p>
<p>
    <strong>Listing .</strong> Proper method to save a document.
</p>
<p>
    If (ThisComponent.isModified()) Then
</p>
<p>
    If (ThisComponent.hasLocation() AND (Not ThisComponent.isReadOnly())) Then
</p>
<p>
    ThisComponent.store()
</p>
<p>
    Else
</p>
<p>
    REM Either the document does not have a location or you cannot
</p>
<p>
    REM save the document because the location is read-only.
</p>
<p>
    setModified(False)
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    A document does not have a storage location immediately after it is created. A document loaded from disk, however,
    has a known location. Use the object method storeAsURL() or storeToURL() to save a document to a specified location.
    The difference between the methods is that storeAsURL() sets the current location (URL) and storeToURL() does not.
    The sequence of actions in helps clarify the difference.
</p>
<p>
    Table 109. Difference between storeToURL and storeAsURL.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                Create document
            </td>
            <td>
                Cannot use the store() method because the document has no location.
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                Use storeToURL
            </td>
            <td>
                Document saved, but cannot use the store() methodbecause it has no location.
            </td>
        </tr>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
                Use storeAsURL
            </td>
            <td>
                Can use the store() method because now the document has a location.
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                Use storeToURL
            </td>
            <td>
                Document saved, but the location is the same as set in step 3.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The method storeAsURL() is similar to the menu option File | Save As, which changes the current
                location. The method storeToURL() is usually used to export a document so that the file URL does not
                change and contain a non-OOo document extension.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The two object methods for storing a document, storeAsURL() and storeToURL(), accept the same arguments; learn to
    use one and you’ll know how to use the other.
</p>
<p>
    ThisComponent.storeAsURL(url, args())
</p>
<p>
    ThisComponent.storeToURL(url, args())
</p>
<p>
    The second argument is an array of property values (see ) that direct how the document is saved (see ). The files
    can just as easily be stored with no arguments (see ).
</p>
<p>
    <strong>Listing .</strong> Save a document to a new location.
</p>
<p>
    Dim args(0) As New com.sun.star.beans.PropertyValue
</p>
<p>
    Dim sUrl As String
</p>
<p>
    sUrl = "file:///c:/My%20Documents/test_file.sxw"
</p>
<p>
    args(0).Name = "Overwrite" 'This property is defined in
</p>
<p>
    args(0).Value = False 'Do not overwrite an existing document.
</p>
<p>
    ThisComponent.storeAsURL(sUrl, args())<br />
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The com.sun.star.frame.XComponentLoader interface defines the object method LoadComponentFromUrl(),
                which is used to load a file. The different document types do not implement this interface, but the
                document frame and the desktop both implement the interface. The method LoadComponentFromUrl() also uses
                the values in to direct how the file is loaded.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Save the document with an inappropriate file extension.
</p>
<p>
    ThisComponent.storeToURL("file:///c:/two.xls", Array())
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The macro in uses the file extension “xls”, which is typically used by Microsoft Excel. This does not
                cause the file to be stored using the Microsoft Excel format. The file is saved using the standard OOo
                file format if an export filter is not explicitly stated.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When you open a file, OOo checks to see if the file is in a standard OOo file format. If not, the file type is
    determined based on the file extension. I cannot even count the number of times that I have been asked why OOo is
    not able to open a comma-delimited text file. The usual answer is that a comma-delimited file must have the file
    extension CSV or OOo cannot recognize the file. Although the file extension is important while loading a file from
    the GUI, it is not important while saving. If you want to save a file in a non-OpenOffice.org native format, you
    must explicitly tell OOo to save in a different file format (see ).
</p>
<p>
    <strong>Listing .</strong> Export a document to the specified Microsoft Excel file format.
</p>
<p>
    Dim args(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args(0).Name = "FilterName" 'I am so excited, which filter will we use?
</p>
<p>
    args(0).Value = "MS Excel 97" 'Oh, the Excel 97 format!
</p>
<p>
    ThisComponent.storeToURL("file:///c:/one.xls",args())
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Although the export filter names are the same as the import filter names, not every import filter can
                export and not every export filter can import.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Impress and Draw, used to edit graphical content, support multiple draw pages. To export a draw page to a specific
    graphics format requires the use of a graphics export filter (see ). The media type must be specified or the export
    will fail.
</p>
<p>
    <strong>Listing .</strong> Export the first draw page to a JPG file.
</p>
<p>
    Dim oFilter
</p>
<p>
    Dim args(1) as new com.sun.star.beans.PropertyValue
</p>
<p>
    oFilter=CreateUnoService("com.sun.star.drawing.GraphicExportFilter")
</p>
<p>
    oFilter.setSourceDocument(ThisComponent.drawPages(0))
</p>
<p>
    args(0).Name = "URL" 'Where the file will be saved
</p>
<p>
    args(0).Value = "file:///c:/one.JPG" 'The destination URL
</p>
<p>
    args(1).Name = "MediaType" 'What type of file
</p>
<p>
    args(1).Value = "image/jpeg" 'The file type
</p>
<p>
    oFilter.filter(args())
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="manipulating-styles">
                    <span id="anchor-255"></span>Manipulating styles
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Styles provide a method of grouping formatting information. For example, a paragraph style defines the font,
    character size, margins, and many other formatting options. Changing a style changes every object using the style.
    The interface com.sun.star.style.XStyleFamiliesSupplier provides access to the styles used by a document. The macro
    in displays the names of all styles in the current document; shows the results for one of my documents.
</p>
<p>
    <strong>Listing .</strong> Display styles used in a document.
</p>
<p>
    Sub DisplayAllStyles
</p>
<p>
    Dim oFamilies 'Families is interface com.sun.star.container.XNameAccess
</p>
<p>
    Dim oFamilyNames 'Names of family types. Array of string
</p>
<p>
    Dim oStyleNames 'Names of styles. Array of string
</p>
<p>
    Dim oStyles 'Styles is interface com.sun.star.container.XNameAccess
</p>
<p>
    Dim oStyle 'An individual style
</p>
<p>
    Dim s As String 'Utility string variable
</p>
<p>
    Dim n As Integer 'Index variable
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
</p>
<p>
    oFamilies = ThisComponent.StyleFamilies
</p>
<p>
    oFamilyNames = oFamilies.getElementNames()
</p>
<p>
</p>
<p>
    REM First, display the style types and the number
</p>
<p>
    REM of each style type.
</p>
<p>
    For n = LBound(oFamilyNames) To UBound(oFamilyNames)
</p>
<p>
    oStyles = oFamilies.getByName(oFamilyNames(n))
</p>
<p>
    s = s &amp; oStyles.getCount() &amp; " " &amp; oFamilyNames(n) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Style Families"
</p>
<p>
    REM Now, display all of the different style names
</p>
<p>
    For n = LBound(oFamilyNames) To UBound(oFamilyNames)
</p>
<p>
    s = ""
</p>
<p>
    oStyles = oFamilies.getByName(oFamilyNames(n))
</p>
<p>
    oStyleNames = oStyles.getElementNames()
</p>
<p>
    For i = LBound(oStyleNames) To UBound (oStyleNames)
</p>
<p>
    s=s + i + " : " + oStyleNames(i) + CHR$(10)
</p>
<p>
    If ((i + 1) Mod 30 = 0) Then
</p>
<p>
    MsgBox s,0,oFamilyNames(n)
</p>
<p>
    s = ""
</p>
<p>
    End If
</p>
<p>
    Next i
</p>
<p>
    If Len(s) &lt;&gt; 0 Then MsgBox s,0,oFamilyNames(n)
</p>
<p>
    Next n
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000AA000000921F2C95E6.png" style="width:1.7709in;height:1.5209in" />
</p>
<p>
    <strong>Figure .</strong> The style families in one of my Writer documents.
</p>
<p>
    The different document types contain different types of styles. shows the style families in a Writer document. Calc
    documents contain the style families CellStyles and PageStyles; Impress documents contain the style families
    Graphics and Default; Draw documents contain the style family Graphic. Although each style type is different, they
    do have similarities. For example, each style implements both the com.sun.star.style.Style service and the
    com.sun.star.style.XStyle interface. The common methods and properties provide very rudimentary functionality (see
    ).
</p>
<p>
    Table 110. Object methods defined in the com.sun.star.style.Style service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                isUserDefined()
            </td>
            <td>
                Is this style user-defined? If not, it is included with OOo.
            </td>
        </tr>
        <tr class="even">
            <td>
                isInUse()
            </td>
            <td>
                Is this style used in the document?
            </td>
        </tr>
        <tr class="odd">
            <td>
                getParentStyle()
            </td>
            <td>
                What is the parent style?
            </td>
        </tr>
        <tr class="even">
            <td>
                setParentStyle(name)
            </td>
            <td>
                Set the parent style.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsPhysical
            </td>
            <td>
                Is the style physically created?
            </td>
        </tr>
        <tr class="even">
            <td>
                FollowStyle
            </td>
            <td>
                Style name applied to the next paragraph. For example, while using a heading style I might want the next
                paragraph to be regular text.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DisplayName
            </td>
            <td>
                Name of the style as displayed in the user interface.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsAutoUpdate
            </td>
            <td>
                If the properties of an object using this style are changed (for example, if I change the font), are
                these changes automatically updated to the style?
            </td>
        </tr>
    </tbody>
</table>
<p>
    shows methods and properties that can be used to answer the common question, “How do I obtain a list of styles that
    are currently used by a document?” See and .
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                accesses styles by name; accesses styles by index. Notice that when getCount() returns 10, there are 10
                items present, indexed 0 through 9.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Display all used paragraph styles.
</p>
<p>
    Sub DisplayAllUsedParagraphStyles
</p>
<p>
    Dim oStyles 'Styles is interface com.sun.star.container.XNameAccess
</p>
<p>
    Dim oStyle 'An individual style
</p>
<p>
    Dim s As String 'Utility string variable
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
</p>
<p>
    oStyles = ThisComponent.StyleFamilies.getByName("ParagraphStyles")
</p>
<p>
    REM If getCount() says that there are 10 styles, this means from 0 to 9
</p>
<p>
    For i = 1 To oStyles.getCount()
</p>
<p>
    oStyle = oStyles.getByIndex(i-1)
</p>
<p>
    If oStyle.isInUse() Then s = s &amp; oStyle.DisplayName &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s,0,"Paragraph Styles In Use"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000002EE000002F8E9CD6B6B.gif" style="width:1.9516in;height:1.8339in" />
</p>
<p>
    <strong>Figure .</strong> Paragraph styles used in a Writer document.
</p>
<p>
    Initially, I was confused by the results shown in because it included paragraph styles that I thought I wasn’t
    using. I assumed that I had made a mistake while writing my document, so I started looking for these accidentally
    used styles. To find the incorrectly styled text, I started with the Find &amp; Replace dialog (Edit | Find &amp;
    Replace). If you check the box labeled “Search for Styles,” all of the styles used in the document become available
    in the “Search for” drop-down box. I used this method to search for the style “Text body” (shown in ), but it was
    not found in the document. After some moments of confusion — in this case, roughly five minutes — I realized that I
    had not found a bug in OpenOffice.org, but rather I had uncovered an interesting behavior of which I had not been
    previously aware. When a style is used in a document, the parent style is listed as used even if it is not directly
    used. For example, in my document, the style “Table Contents” uses “Text body” as the parent style.
</p>
<p>
    The different style types contain methods and properties appropriate for their type. See
    http://api.openoffice.org/docs/common/ref/com/sun/star/style/module-ix.html for the common services, interfaces,
    structs, and constants related to styles. The types shown in the style module are the base on which the other styles
    are built. For example, the two services com.sun.star.text.TextPageStyle and com.sun.star.sheet.TablePageStyle both
    have the service com.sun.star.style.PageStyle in common. To get a feel for a style it is frequently expedient to
    start by inspecting the object.
</p>
<p>
    MsgBox vObj.dbg_methods
</p>
<p>
    MsgBox vObj.dbg_supportedInterfaces
</p>
<p>
    MsgBox vObj.dbg_properties
</p>
<p>
    The style objects, like many other objects, implement the XPropertySet interface. The macro in uses this interface
    to display a list of properties contained in the “_body text” paragraph style. does not display the value of each
    property; it only displays the name of each property. It is an interesting exercise to modify to also display the
    value of each property that is a standard data type — a property may be a complex object.
</p>
<p>
    <strong>Listing .</strong> Display Properties for a paragraph style.
</p>
<p>
    Sub StyleProperties
</p>
<p>
    Dim oStyles 'Styles is interface com.sun.star.container.XNameAccess
</p>
<p>
    Dim s As String 'Utility string variable
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
    Dim Props 'Array of properties
</p>
<p>
</p>
<p>
    REM Each style supports the com.sun.star.beans.XPropertySet interface
</p>
<p>
    REM This supports the method getPropertySetInfo(), which allows
</p>
<p>
    REM an enumeration of the contained properties.
</p>
<p>
    REM Get properties returns an array of com.sun.star.beans.Property
</p>
<p>
    oStyles = ThisComponent.StyleFamilies.getByName("ParagraphStyles")
</p>
<p>
    Props = oStyles.getByName("_body text").getPropertySetInfo().getProperties()
</p>
<p>
    For i = 0 To UBound(Props) 'For each property
</p>
<p>
    s = s &amp; Props(i).Name &amp; CHR$(10) 'Include the property name and new line
</p>
<p>
    If (i+1) MOD 30 = 0 Then 'If the string becomes too large
</p>
<p>
    MsgBox s,0,"Style Properties" 'display the current string
</p>
<p>
    s = "" 'Reset the list
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    REM In case the entire list was not printed.
</p>
<p>
    If Len(s) &lt;&gt; 0 Then MsgBox s,0,"Style Properties"
</p>
<p>
    End Sub
</p>
<p>
    In my experience, it’s rare to access and inspect styles. It’s even less common to modify a style from a macro.
    There are times, however, when this is done. For example, the page size is defined by the current page style. Use
    the current controller to determine the current page style, and then use that to determine the page dimensions.
    displays the size of the page, the margins, and the current cursor position on the page. shows the results.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The most common reason that I have seen for modifying a page style is to add a header or footer to the
                current page style.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Portions of this code are speculative and have changed since I originally created the code. The current controller
    returns the current cursor position based on the leftmost corner of the first page in the document. On page 200,
    therefore, the Y coordinate may be very large. The following code attempts to compensate for this, but, it does so
    poorly – where poorly means that I believe the answer is incorrect with respect to the top and the bottom of the
    page.
</p>
<p>
    <strong>Listing .</strong> PrintPageInformation
</p>
<p>
    Sub PrintPageInformation
</p>
<p>
    Dim oViewCursor 'Current view cursor
</p>
<p>
    Dim oStyle 'Current page style
</p>
<p>
    Dim lHeight As Long 'Page height from Page Style in 1/100 mm
</p>
<p>
    Dim lWidth As Long 'Page width from Page Style in 1/100 mm
</p>
<p>
    Dim s As String 'Temporary string variable
</p>
<p>
    REM The current controller interfaces with the human — that's you!
</p>
<p>
    REM Well, we hope you are human anyway.
</p>
<p>
    REM Obtain the current view cursor from the controller. It is
</p>
<p>
    REM the thing that knows where the current cursor is, after all.
</p>
<p>
    oViewCursor = ThisComponent.CurrentController.getViewCursor()
</p>
<p>
</p>
<p>
    REM That view cursor knows a lot of things, including the
</p>
<p>
    REM current page style. Use the page style name to get
</p>
<p>
    REM a reference to the current page style.
</p>
<p>
    s = oViewCursor.PageStyleName
</p>
<p>
    oStyle = ThisComponent.StyleFamilies.getByName("PageStyles").getByName(s)
</p>
<p>
    s = "Page Style = " &amp; s &amp; CHR$(10)
</p>
<p>
    lHeight = oStyle.Height 'Page height in 1/100 mm
</p>
<p>
    lWidth = oStyle.Width 'Page width in 1/100 mm
</p>
<p>
</p>
<p>
    REM Page dimensions in mm, inches, and picas.
</p>
<p>
    s = s &amp; "Page size is " &amp; CHR$(10) &amp;_
</p>
<p>
    " " &amp; CStr(lWidth / 100.0) &amp; " mm By " &amp;_
</p>
<p>
    " " &amp; CStr(lHeight / 100.0) &amp; " mm" &amp; CHR$(10) &amp;_
</p>
<p>
    " " &amp; CStr(lWidth / 2540.0) &amp; " inches By " &amp;_
</p>
<p>
    " " &amp; CStr(lHeight / 2540.0) &amp; " inches" &amp; CHR$(10) &amp;_
</p>
<p>
    " " &amp; CStr(lWidth *72.0 / 2540.0) &amp; " picas By " &amp;_
</p>
<p>
    " " &amp; CStr(lHeight *72.0 / 2540.0) &amp; " picas" &amp; CHR$(10)
</p>
<p>
    Dim dCharHeight As Double 'Character height in inches
</p>
<p>
    Dim iCurPage As Integer 'Current page
</p>
<p>
</p>
<p>
    Dim dXCursor As Double 'Distance from cursor to left in inches
</p>
<p>
    Dim dYCursor As Double 'Distance from cursor to top in inches
</p>
<p>
    Dim dXRight As Double 'Distance from cursor to right in inches
</p>
<p>
    Dim dYBottom As Double 'Distance from cursor to bottom in inches
</p>
<p>
    Dim dBottom As Double 'Bottom margin in inches
</p>
<p>
    Dim dLeft As Double 'Left margin in inches
</p>
<p>
    Dim dRight As Double 'Right margin in inches
</p>
<p>
    Dim dTop As Double 'Top margin in inches
</p>
<p>
</p>
<p>
    dCharHeight = oViewCursor.CharHeight / 72.0 'Convert points to inches
</p>
<p>
    iCurPage = oViewCursor.getPage() 'Page number
</p>
<p>
    s = s &amp; "Current page = " &amp; iCurPage &amp; CHR$(10)
</p>
<p>
</p>
<p>
    dBottom = oStyle.BottomMargin / 2540.0 : dLeft = oStyle.LeftMargin / 2540.0
</p>
<p>
    dRight = oStyle.RightMargin / 2540.0 : dTop = oStyle.TopMargin / 2540.0
</p>
<p>
    s = s &amp; "Margin (inches): Left= " &amp; dLeft &amp; " Right= " &amp; dRight &amp; CHR$(10)
</p>
<p>
    s = s &amp; "Margin (inches): Top= " &amp; dTop &amp; " Bottom= " &amp; dBottom &amp; CHR$(10)
</p>
<p>
</p>
<p>
    Dim v
</p>
<p>
    REM Cursor's coordinates relative to the top left position of the page
</p>
<p>
    REM Return type is com.sun.star.awt.Point
</p>
<p>
    REM Units are in twips. Convert them to inches.
</p>
<p>
    v = oViewCursor.getPosition()
</p>
<p>
</p>
<p>
    REM Page number from the view cursor includes "phantom" pages because
</p>
<p>
    REM two pages in a row must both be on say a right side.
</p>
<p>
    REM v.Y does not include this.
</p>
<p>
    Dim realPageNumber As Long
</p>
<p>
    realPageNumber = Fix(v.Y / lHeight)
</p>
<p>
</p>
<p>
    Dim realY : realY = v.Y - realPageNumber * lHeight
</p>
<p>
</p>
<p>
    REM Place the cursor as the distance to the margin and then add the margin.
</p>
<p>
    REM For the vertical height add half the character height. I should
</p>
<p>
    REM probably do this for the character width as well for horizontal.
</p>
<p>
    dYCursor = realY/2540.0 + dTop + dCharHeight / 2
</p>
<p>
    dYBottom = (lHeight - realY)/2540.0 - dTop - dCharHeight / 2
</p>
<p>
    dXCursor = v.X/2540.0 + dLeft
</p>
<p>
    dXRight = (lWidth - v.X)/2540.0 - dLeft
</p>
<p>
</p>
<p>
    s=s &amp;"Cursor is "&amp;Format(dXCursor, "0.##") &amp; " inches from left "&amp;CHR$(10)
</p>
<p>
    s=s &amp;"Cursor is "&amp;Format(dXRight, "0.##") &amp; " inches from right "&amp;CHR$(10)
</p>
<p>
    s=s &amp;"Cursor is "&amp;Format(dYCursor, "0.##") &amp; " inches from top "&amp;CHR$(10)
</p>
<p>
    s=s &amp;"Cursor is "&amp;Format(dYBottom, "0.##") &amp; " inches from bottom "&amp;CHR$(10)
</p>
<p>
    s=s &amp;"Char height = " &amp; Format(dCharHeight, "0.####") &amp; " inches"&amp;CHR$(10)
</p>
<p>
    MsgBox s, 0, "Page information"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000004B0000003DD59053D4B.gif" style="width:3.0016in;height:2.2953in" />
</p>
<p>
    <strong>Figure .</strong> Information from the page style.
</p>
<p>
    Calc documents are composed of spreadsheets. Each sheet can use a different page style. The macro in obtains the
    current page style using the view cursor. To obtain the style from a Calc document, use the active sheet.
</p>
<p>
    REM Use the currently active sheet to obtain the page style.
</p>
<p>
    REM In a Calc document, the current controller knows which sheet
</p>
<p>
    REM is active.
</p>
<p>
    Print "Style = " &amp; ThisComponent.CurrentController.getActiveSheet().PageStyle
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="style-utilities">
                            <span id="anchor-256"></span>Style utilities
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Although modifying styles using macros is easy, small details can cause big problems; for example, specifying a
    paragraph style is not available on the current computer.
</p>
<p>
    <strong>Listing .</strong> Check a document for a paragraph style.
</p>
<p>
    Function DocHasParStyle(oDoc, sName$) As Boolean
</p>
<p>
    Dim oStyles
</p>
<p>
    oStyles = oDoc.StyleFamilies.getByName("ParagraphStyles")
</p>
<p>
    DocHasParStyle() = oStyles.hasByName(sName)
</p>
<p>
    End Function
</p>
<p>
    Checking for the character style is equally trivial.
</p>
<p>
    <strong>Listing .</strong> Check a document for a character style.
</p>
<p>
    Function DocHasCharStyle(oDoc, sName$) As Boolean
</p>
<p>
    Dim oStyles
</p>
<p>
    oStyles = oDoc.StyleFamilies.getByName("CharacterStyles")
</p>
<p>
    DocHasCharStyle() = oStyles.hasByName(sName)
</p>
<p>
    End Function
</p>
<p>
    To determine if a document supports a specific font, check the font descriptors available from the container window.
</p>
<p>
    <strong>Listing .</strong> Check a document for a font.
</p>
<p>
    Function DocHasFontName(oDoc, sName$) As Boolean
</p>
<p>
    Dim oWindow
</p>
<p>
    Dim oFonts()
</p>
<p>
    Dim i%
</p>
<p>
</p>
<p>
    oWindow = oDoc.getCurrentController().getFrame().getContainerWindow()
</p>
<p>
    oFonts() = oWindow.getFontDescriptors()
</p>
<p>
    For i = LBound(oFonts()) To UBound(oFonts())
</p>
<p>
    If oFonts(i).Name = sName Then
</p>
<p>
    DocHasFontName() = True
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    DocHasFontName() = False
</p>
<p>
    End Function
</p>
<p>
    A property is a structure with a name and a value. The following macro accepts a name and a value and returns a
    property with the name and value.
</p>
<p>
    <strong>Listing .</strong> Create a property with the specified name and value.
</p>
<p>
    '****************************************************************
</p>
<p>
    '** Create and return a PropertyValue structure.
</p>
<p>
    '****************************************************************
</p>
<p>
    Function CreateProperty( Optional cName As String, Optional uValue ) As com.sun.star.beans.PropertyValue
</p>
<p>
    Dim oPropertyValue As New com.sun.star.beans.PropertyValue
</p>
<p>
    If Not IsMissing( cName ) Then
</p>
<p>
    oPropertyValue.Name = cName
</p>
<p>
    EndIf
</p>
<p>
    If Not IsMissing( uValue ) Then
</p>
<p>
    oPropertyValue.Value = uValue
</p>
<p>
    EndIf
</p>
<p>
    CreateProperty() = oPropertyValue
</p>
<p>
    End Function
</p>
<p>
    allows properties to be created directly in an array.
</p>
<p>
    <strong>Listing .</strong> Creating properties used to create a character style.
</p>
<p>
    REM Base style for all.
</p>
<p>
    REM computer code that is not color coded and used in regular text
</p>
<p>
    REM uses this style.
</p>
<p>
    oProps() = Array(CreateProperty("CharFontName", sFontName), _
</p>
<p>
    CreateProperty("CharColor", RGB(0, 0, 0)), _
</p>
<p>
    CreateProperty("CharNoHyphenation", True) )
</p>
<p>
    CreateCharacterStyle("OOoComputerCode", oProps())
</p>
<p>
</p>
<p>
    REM Base style for normal listings.
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "OOoComputerCode"))
</p>
<p>
</p>
<p>
    CreateCharacterStyle("_OOoComputerBase", oProps())
</p>
<p>
    The difficult part is determining what properties to set and what properties to not set. It is a useful exercise to
    inspect a manually created style containing the values of interest. A property that is not specifically set inherits
    its value from the parent style or existing format; for example, setting a character style to bold but not
    specifying the font or font size, produces a character style that will not affect font or font size and only set the
    font to be bold.
</p>
<p>
    <strong>Listing .</strong> Character styles used to format code examples.
</p>
<p>
    '****************************************************************
</p>
<p>
    '** Create character styles for StarBasic using the same colors
</p>
<p>
    '** as the OOo IDE.
</p>
<p>
    '****************************************************************
</p>
<p>
    Function CreateStarBasicCharStyles()
</p>
<p>
    Dim oProps()
</p>
<p>
    REM If you do not want something to have a language, which prevents
</p>
<p>
    REM a spell check, set CharLocale to noLocale.
</p>
<p>
    Dim noLocale As New com.sun.star.lang.Locale
</p>
<p>
    noLocale.Country = ""
</p>
<p>
    noLocale.Language = "zxx"
</p>
<p>
    If NOT CreateBaseCharStyles() Then
</p>
<p>
    CreateStarBasicCharStyles() = False
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "_OOoComputerBase"), _
</p>
<p>
    CreateProperty("CharColor", RGB(76, 76, 76)))
</p>
<p>
    CreateCharacterStyle("_OOoComputerComment", oProps())
</p>
<p>
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "_OOoComputerBase"), _
</p>
<p>
    CreateProperty("CharColor", RGB(255, 0, 0)))
</p>
<p>
    CreateCharacterStyle("_OOoComputerLiteral", oProps())
</p>
<p>
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "_OOoComputerBase"), _
</p>
<p>
    CreateProperty("CharLocale", noLocale), _
</p>
<p>
    CreateProperty("CharColor", RGB(0, 0, 128)))
</p>
<p>
    CreateCharacterStyle("_OOoComputerKeyWord", oProps())
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "_OOoComputerBase"), _
</p>
<p>
    CreateProperty("CharColor", RGB(0, 128, 0)))
</p>
<p>
    CreateCharacterStyle("_OOoComputerIdent", oProps())
</p>
<p>
    CreateStarBasicCharStyles() = True
</p>
<p>
    End Function
</p>
<p>
    The following macro creates a character style if it does not exist. A special check is performed to verify that the
    parent style exists; the parent style must be created before the child style.
</p>
<p>
    <strong>Listing .</strong> Create a character style if it does not exist.
</p>
<p>
    Sub CreateCharacterStyle(sStyleName$, oProps())
</p>
<p>
    Dim i%
</p>
<p>
    Dim oFamilies
</p>
<p>
    Dim oStyle
</p>
<p>
    Dim oStyles
</p>
<p>
</p>
<p>
    oFamilies = ThisComponent.StyleFamilies
</p>
<p>
    oStyles = oFamilies.getByName("CharacterStyles")
</p>
<p>
    If oStyles.HasByName(sStyleName) Then
</p>
<p>
    'PrintColor(oStyles.getByName(sStyleName).CharColor)
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    oStyle = ThisComponent.createInstance("com.sun.star.style.CharacterStyle")
</p>
<p>
    For i=LBound(oProps) To UBound(oProps)
</p>
<p>
    If oProps(i).Name = "ParentStyle" Then
</p>
<p>
</p>
<p>
    If oStyles.HasByName(oProps(i).Value) Then
</p>
<p>
    oStyle.ParentStyle = oProps(i).Value
</p>
<p>
    Else
</p>
<p>
    Print "Parent character style (" &amp; oProps(i).Value &amp; _
</p>
<p>
    ") does not exist, ignoring parent."
</p>
<p>
    End If
</p>
<p>
    oStyle.ParentStyle = oProps(i).Value
</p>
<p>
    Else
</p>
<p>
    oStyle.setPropertyValue(oProps(i).Name, oProps(i).Value)
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    oStyles.insertByName(sStyleName, oStyle)
</p>
<p>
    End Sub
</p>
<p>
    A paragraph style is a bit more complicated because a few elements require special consideration; for example,
    setting tab stops.
</p>
<p>
    <strong>Listing .</strong> Create a paragraph style if it does not exist.
</p>
<p>
    Sub CreateParStyle(sStyleName$, oProps())
</p>
<p>
    Dim i%, j%
</p>
<p>
    Dim oFamilies
</p>
<p>
    Dim oStyle
</p>
<p>
    Dim oStyles
</p>
<p>
    Dim tabStops%
</p>
<p>
</p>
<p>
    oFamilies = ThisComponent.StyleFamilies
</p>
<p>
    oStyles = oFamilies.getByName("ParagraphStyles")
</p>
<p>
    If oStyles.HasByName(sStyleName) Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    oStyle = ThisComponent.createInstance("com.sun.star.style.ParagraphStyle")
</p>
<p>
    For i=LBound(oProps) To UBound(oProps)
</p>
<p>
    If oProps(i).Name = "ParentStyle" Then
</p>
<p>
    If oStyles.HasByName(oProps(i).Value) Then
</p>
<p>
    oStyle.ParentStyle = oProps(i).Value
</p>
<p>
    Else
</p>
<p>
    Print "Parent paragraph style (" &amp; oProps(i).Value &amp; _
</p>
<p>
    ") does not exist, ignoring parent"
</p>
<p>
    End If
</p>
<p>
    ElseIf oProps(i).Name = "ParaTabStops" Then
</p>
<p>
    tabStops = oProps(i).Value
</p>
<p>
    Dim tab(0 To 19) As New com.sun.star.style.TabStop
</p>
<p>
    For j =LBound(tab) To UBound(tab)
</p>
<p>
    tab(j).Alignment = com.sun.star.style.TabAlign.LEFT
</p>
<p>
    tab(j).DecimalChar = ASC(".")
</p>
<p>
    tab(j).FillChar = 32
</p>
<p>
    tab(j).Position = (j+1) * tabStops
</p>
<p>
    Next
</p>
<p>
    oStyle.ParaTabStops = tab
</p>
<p>
    ElseIf oProps(i).Name = "FollowStyle" Then
</p>
<p>
    If oStyles.HasByName(oProps(i).Value) OR oProps(i).Value = sStyleName Then
</p>
<p>
    oStyle.setPropertyValue(oProps(i).Name, oProps(i).Value)
</p>
<p>
    Else
</p>
<p>
    Print "Next paragraph style (" &amp; oProps(i).Value &amp; _
</p>
<p>
    ") does not exist, ignoring for style " &amp; sStyleName
</p>
<p>
    End If
</p>
<p>
    Else
</p>
<p>
    oStyle.setPropertyValue(oProps(i).Name, oProps(i).Value)
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    oStyles.insertByName(sStyleName, oStyle)
</p>
<p>
    End Sub
</p>
<p>
    This code creates the primary paragraph styles used to format code styles in this document.
</p>
<p>
    <strong>Listing .</strong> Properties to create a paragraph style.
</p>
<p>
    REM Tab stops are set in the paragraph style
</p>
<p>
    ' 1/4 of an inch
</p>
<p>
    tabStopLoc% = 2540 / 4
</p>
<p>
    oProps() = Array(CreateProperty("ParaTopMargin", CLng(0)), _
</p>
<p>
    CreateProperty("ParaBottomMargin", CLng(2540 * 0.03)), _
</p>
<p>
    CreateProperty("ParaLeftMargin", CLng(2540 * 0.20)), _
</p>
<p>
    CreateProperty("ParaRightMargin", CLng(0)), _
</p>
<p>
    CreateProperty("ParaFirstLineIndent", CLng(0)), _
</p>
<p>
    CreateProperty("CharFontName",sFontName), _
</p>
<p>
    CreateProperty("ParaTabStops", tabStopLoc), _
</p>
<p>
    CreateProperty("ParaLineNumberCount", False), _
</p>
<p>
    CreateProperty("WritingMode", com.sun.star.text.WritingMode.LR_TB), _
</p>
<p>
    CreateProperty("CharAutoKerning", False), _
</p>
<p>
    CreateProperty("CharHeight", fParNormalCharHeight) )
</p>
<p>
    CreateParStyle("_OOoComputerCode", oProps())
</p>
<p>
    oProps() = Array(CreateProperty("ParentStyle", "_OOoComputerCode"), _
</p>
<p>
    CreateProperty("ParaTopMargin", CLng(0)), _
</p>
<p>
    CreateProperty("ParaBottomMargin", CLng(2540 * 0.10)), _
</p>
<p>
    CreateProperty("ParaLeftMargin", CLng(2540 * 0.20)), _
</p>
<p>
    CreateProperty("ParaRightMargin", CLng(0)), _
</p>
<p>
    CreateProperty("ParaFirstLineIndent", CLng(0)), _
</p>
<p>
    CreateProperty("CharFontName",sFontName), _
</p>
<p>
    CreateProperty("ParaTabStops", tabStopLoc), _
</p>
<p>
    CreateProperty("ParaLineNumberCount", False), _
</p>
<p>
    CreateProperty("WritingMode", com.sun.star.text.WritingMode.LR_TB), _
</p>
<p>
    CreateProperty("CharAutoKerning", False), _
</p>
<p>
    CreateProperty("CharHeight", fParNormalCharHeight), _
</p>
<p>
    CreateProperty("FollowStyle", sNextStyle) )
</p>
<p>
    CreateParStyle("_OOoComputerCodeLastLine", oProps())
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="dealing-with-locale">
                    <span id="anchor-257"></span>Dealing with locale
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    A locale represents a specific geographical, political, or cultural region. Numbers and dates are considered
    locale-sensitive, so number formats are associated with a locale. Use Tools | Options | Language Settings |
    Languages to see which locale is used for your computer. Creating a locale is very easy.
</p>
<p>
    Dim aLocale As New com.sun.star.lang.Locale
</p>
<p>
    aLocale.Language = "fr"
</p>
<p>
    aLocale.Country = "FR"
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                OOo may not support every possible locale, but it will attempt to use the best possible match.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The locale depends upon both the language and the country. Some countries use multiple languages and some languages
    are used in multiple countries. contains the two-character code that identifies each language, and contains the
    two-character code that identifies each country.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Although the locale codes are not case sensitive, they are typically written in lowercase for the
                language and uppercase for the country.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Table 111. Locale language codes, alphabetized by code.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                aa
            </td>
            <td>
                Afar
            </td>
            <td>
                ab
            </td>
            <td>
                Abkhazian
            </td>
            <td>
                af
            </td>
            <td>
                Afrikaans
            </td>
        </tr>
        <tr class="even">
            <td>
                am
            </td>
            <td>
                Amharic
            </td>
            <td>
                ar
            </td>
            <td>
                Arabic
            </td>
            <td>
                as
            </td>
            <td>
                Assamese
            </td>
        </tr>
        <tr class="odd">
            <td>
                ay
            </td>
            <td>
                Aymara
            </td>
            <td>
                az
            </td>
            <td>
                Azerbaijani
            </td>
            <td>
                ba
            </td>
            <td>
                Bashkir
            </td>
        </tr>
        <tr class="even">
            <td>
                be
            </td>
            <td>
                Byelorussian
            </td>
            <td>
                bg
            </td>
            <td>
                Bulgarian
            </td>
            <td>
                bh
            </td>
            <td>
                Bihari
            </td>
        </tr>
        <tr class="odd">
            <td>
                bi
            </td>
            <td>
                Bislama
            </td>
            <td>
                bn
            </td>
            <td>
                Bengali; Bangla
            </td>
            <td>
                bo
            </td>
            <td>
                Tibetan
            </td>
        </tr>
        <tr class="even">
            <td>
                br
            </td>
            <td>
                Breton
            </td>
            <td>
                ca
            </td>
            <td>
                Catalan
            </td>
            <td>
                co
            </td>
            <td>
                Corsican
            </td>
        </tr>
        <tr class="odd">
            <td>
                cs
            </td>
            <td>
                Czech
            </td>
            <td>
                cy
            </td>
            <td>
                Welsh
            </td>
            <td>
                da
            </td>
            <td>
                Danish
            </td>
        </tr>
        <tr class="even">
            <td>
                de
            </td>
            <td>
                German
            </td>
            <td>
                dz
            </td>
            <td>
                Bhutani
            </td>
            <td>
                el
            </td>
            <td>
                Greek
            </td>
        </tr>
        <tr class="odd">
            <td>
                en
            </td>
            <td>
                English
            </td>
            <td>
                eo
            </td>
            <td>
                Esperanto
            </td>
            <td>
                es
            </td>
            <td>
                Spanish
            </td>
        </tr>
        <tr class="even">
            <td>
                et
            </td>
            <td>
                Estonian
            </td>
            <td>
                eu
            </td>
            <td>
                Basque
            </td>
            <td>
                fa
            </td>
            <td>
                Persian
            </td>
        </tr>
        <tr class="odd">
            <td>
                fi
            </td>
            <td>
                Finnish
            </td>
            <td>
                fj
            </td>
            <td>
                Fiji
            </td>
            <td>
                fo
            </td>
            <td>
                Faroese
            </td>
        </tr>
        <tr class="even">
            <td>
                fr
            </td>
            <td>
                French
            </td>
            <td>
                fy
            </td>
            <td>
                Frisian
            </td>
            <td>
                ga
            </td>
            <td>
                Irish
            </td>
        </tr>
        <tr class="odd">
            <td>
                gd
            </td>
            <td>
                Scots Gaelic
            </td>
            <td>
                gl
            </td>
            <td>
                Galician
            </td>
            <td>
                gn
            </td>
            <td>
                Guarani
            </td>
        </tr>
        <tr class="even">
            <td>
                gu
            </td>
            <td>
                Gujarati
            </td>
            <td>
                ha
            </td>
            <td>
                Hausa
            </td>
            <td>
                he
            </td>
            <td>
                Hebrew (formerly iw)
            </td>
        </tr>
        <tr class="odd">
            <td>
                hi
            </td>
            <td>
                Hindi
            </td>
            <td>
                hr
            </td>
            <td>
                Croatian
            </td>
            <td>
                hu
            </td>
            <td>
                Hungarian
            </td>
        </tr>
        <tr class="even">
            <td>
                hy
            </td>
            <td>
                Armenian
            </td>
            <td>
                ia
            </td>
            <td>
                Interlingua
            </td>
            <td>
                id
            </td>
            <td>
                Indonesian (formerly in)
            </td>
        </tr>
        <tr class="odd">
            <td>
                ie
            </td>
            <td>
                Interlingue
            </td>
            <td>
                ik
            </td>
            <td>
                Inupiak
            </td>
            <td>
                is
            </td>
            <td>
                Icelandic
            </td>
        </tr>
        <tr class="even">
            <td>
                it
            </td>
            <td>
                Italian
            </td>
            <td>
                iu
            </td>
            <td>
                Inuktitut
            </td>
            <td>
                ja
            </td>
            <td>
                Japanese
            </td>
        </tr>
        <tr class="odd">
            <td>
                jw
            </td>
            <td>
                Javanese
            </td>
            <td>
                ka
            </td>
            <td>
                Georgian
            </td>
            <td>
                kk
            </td>
            <td>
                Kazakh
            </td>
        </tr>
        <tr class="even">
            <td>
                kl
            </td>
            <td>
                Greenlandic
            </td>
            <td>
                km
            </td>
            <td>
                Cambodian
            </td>
            <td>
                kn
            </td>
            <td>
                Kannada
            </td>
        </tr>
        <tr class="odd">
            <td>
                ko
            </td>
            <td>
                Korean
            </td>
            <td>
                ks
            </td>
            <td>
                Kashmiri
            </td>
            <td>
                ku
            </td>
            <td>
                Kurdish
            </td>
        </tr>
        <tr class="even">
            <td>
                ky
            </td>
            <td>
                Kirghiz
            </td>
            <td>
                la
            </td>
            <td>
                Latin
            </td>
            <td>
                ln
            </td>
            <td>
                Lingala
            </td>
        </tr>
        <tr class="odd">
            <td>
                lo
            </td>
            <td>
                Laothian
            </td>
            <td>
                lt
            </td>
            <td>
                Lithuanian
            </td>
            <td>
                lv
            </td>
            <td>
                Latvian, Lettish
            </td>
        </tr>
        <tr class="even">
            <td>
                mg
            </td>
            <td>
                Malagasy
            </td>
            <td>
                mi
            </td>
            <td>
                Maori
            </td>
            <td>
                mk
            </td>
            <td>
                Macedonian
            </td>
        </tr>
        <tr class="odd">
            <td>
                ml
            </td>
            <td>
                Malayalam
            </td>
            <td>
                mn
            </td>
            <td>
                Mongolian
            </td>
            <td>
                mo
            </td>
            <td>
                Moldavian
            </td>
        </tr>
        <tr class="even">
            <td>
                mr
            </td>
            <td>
                Marathi
            </td>
            <td>
                ms
            </td>
            <td>
                Malay
            </td>
            <td>
                mt
            </td>
            <td>
                Maltese
            </td>
        </tr>
        <tr class="odd">
            <td>
                my
            </td>
            <td>
                Burmese
            </td>
            <td>
                na
            </td>
            <td>
                Nauru
            </td>
            <td>
                ne
            </td>
            <td>
                Nepali
            </td>
        </tr>
        <tr class="even">
            <td>
                nl
            </td>
            <td>
                Dutch
            </td>
            <td>
                no
            </td>
            <td>
                Norwegian
            </td>
            <td>
                oc
            </td>
            <td>
                Occitan
            </td>
        </tr>
        <tr class="odd">
            <td>
                om
            </td>
            <td>
                (Afan) Oromo
            </td>
            <td>
                or
            </td>
            <td>
                Oriya
            </td>
            <td>
                pa
            </td>
            <td>
                Punjabi
            </td>
        </tr>
        <tr class="even">
            <td>
                pl
            </td>
            <td>
                Polish
            </td>
            <td>
                ps
            </td>
            <td>
                Pashto, Pushto
            </td>
            <td>
                pt
            </td>
            <td>
                Portuguese
            </td>
        </tr>
        <tr class="odd">
            <td>
                qu
            </td>
            <td>
                Quechua
            </td>
            <td>
                rm
            </td>
            <td>
                Rhaeto-Romance
            </td>
            <td>
                rn
            </td>
            <td>
                Kirundi
            </td>
        </tr>
        <tr class="even">
            <td>
                ro
            </td>
            <td>
                Romanian
            </td>
            <td>
                ru
            </td>
            <td>
                Russian
            </td>
            <td>
                rw
            </td>
            <td>
                Kinyarwanda
            </td>
        </tr>
        <tr class="odd">
            <td>
                sa
            </td>
            <td>
                Sanskrit
            </td>
            <td>
                sd
            </td>
            <td>
                Sindhi
            </td>
            <td>
                sg
            </td>
            <td>
                Sangho
            </td>
        </tr>
        <tr class="even">
            <td>
                sh
            </td>
            <td>
                Serbo-Croatian
            </td>
            <td>
                si
            </td>
            <td>
                Sinhalese
            </td>
            <td>
                sk
            </td>
            <td>
                Slovak
            </td>
        </tr>
        <tr class="odd">
            <td>
                sl
            </td>
            <td>
                Slovenian
            </td>
            <td>
                sm
            </td>
            <td>
                Samoan
            </td>
            <td>
                sn
            </td>
            <td>
                Shona
            </td>
        </tr>
        <tr class="even">
            <td>
                so
            </td>
            <td>
                Somali
            </td>
            <td>
                sq
            </td>
            <td>
                Albanian
            </td>
            <td>
                su
            </td>
            <td>
                Sundanese
            </td>
        </tr>
        <tr class="odd">
            <td>
                ss
            </td>
            <td>
                Siswati
            </td>
            <td>
                st
            </td>
            <td>
                Sesotho
            </td>
            <td>
                sv
            </td>
            <td>
                Swedish
            </td>
        </tr>
        <tr class="even">
            <td>
                sw
            </td>
            <td>
                Swahili
            </td>
            <td>
                ta
            </td>
            <td>
                Tamil
            </td>
            <td>
                te
            </td>
            <td>
                Telugu
            </td>
        </tr>
        <tr class="odd">
            <td>
                tg
            </td>
            <td>
                Tajik
            </td>
            <td>
                th
            </td>
            <td>
                Thai
            </td>
            <td>
                ti
            </td>
            <td>
                Tigrinya
            </td>
        </tr>
        <tr class="even">
            <td>
                tk
            </td>
            <td>
                Turkmen
            </td>
            <td>
                tl
            </td>
            <td>
                Tagalog
            </td>
            <td>
                tn
            </td>
            <td>
                Setswana
            </td>
        </tr>
        <tr class="odd">
            <td>
                to
            </td>
            <td>
                Tonga
            </td>
            <td>
                tr
            </td>
            <td>
                Turkish
            </td>
            <td>
                ts
            </td>
            <td>
                Tsonga
            </td>
        </tr>
        <tr class="even">
            <td>
                tt
            </td>
            <td>
                Tatar
            </td>
            <td>
                tw
            </td>
            <td>
                Twi
            </td>
            <td>
                ug
            </td>
            <td>
                Uighur
            </td>
        </tr>
        <tr class="odd">
            <td>
                uk
            </td>
            <td>
                Ukrainian
            </td>
            <td>
                ur
            </td>
            <td>
                Urdu
            </td>
            <td>
                uz
            </td>
            <td>
                Uzbek
            </td>
        </tr>
        <tr class="even">
            <td>
                vi
            </td>
            <td>
                Vietnamese
            </td>
            <td>
                vo
            </td>
            <td>
                Volapuk
            </td>
            <td>
                wo
            </td>
            <td>
                Wolof
            </td>
        </tr>
        <tr class="odd">
            <td>
                xh
            </td>
            <td>
                Xhosa
            </td>
            <td>
                yi
            </td>
            <td>
                Yiddish (formerly ji)
            </td>
            <td>
                yo
            </td>
            <td>
                Yoruba
            </td>
        </tr>
        <tr class="even">
            <td>
                za
            </td>
            <td>
                Zhuang
            </td>
            <td>
                zh
            </td>
            <td>
                Chinese
            </td>
            <td>
                zu
            </td>
            <td>
                Zulu
            </td>
        </tr>
    </tbody>
</table>
<p>
    Table 112. Locale country codes, capitalized by country.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                AF
            </td>
            <td>
                Afghanistan
            </td>
            <td>
                AL
            </td>
            <td>
                Albania
            </td>
        </tr>
        <tr class="even">
            <td>
                DZ
            </td>
            <td>
                Algeria
            </td>
            <td>
                AS
            </td>
            <td>
                American Samoa
            </td>
        </tr>
        <tr class="odd">
            <td>
                AD
            </td>
            <td>
                Andorra
            </td>
            <td>
                AO
            </td>
            <td>
                Angola
            </td>
        </tr>
        <tr class="even">
            <td>
                AI
            </td>
            <td>
                Anguilla
            </td>
            <td>
                AQ
            </td>
            <td>
                Antarctica
            </td>
        </tr>
        <tr class="odd">
            <td>
                AG
            </td>
            <td>
                Antigua and Barbuda
            </td>
            <td>
                AR
            </td>
            <td>
                Argentina
            </td>
        </tr>
        <tr class="even">
            <td>
                AM
            </td>
            <td>
                Armenia
            </td>
            <td>
                AW
            </td>
            <td>
                Aruba
            </td>
        </tr>
        <tr class="odd">
            <td>
                AU
            </td>
            <td>
                Australia
            </td>
            <td>
                AT
            </td>
            <td>
                Austria
            </td>
        </tr>
        <tr class="even">
            <td>
                AZ
            </td>
            <td>
                Azerbaijan
            </td>
            <td>
                BS
            </td>
            <td>
                Bahamas
            </td>
        </tr>
        <tr class="odd">
            <td>
                BH
            </td>
            <td>
                Bahrain
            </td>
            <td>
                BD
            </td>
            <td>
                Bangladesh
            </td>
        </tr>
        <tr class="even">
            <td>
                BB
            </td>
            <td>
                Barbados
            </td>
            <td>
                BY
            </td>
            <td>
                Belarus
            </td>
        </tr>
        <tr class="odd">
            <td>
                BE
            </td>
            <td>
                Belgium
            </td>
            <td>
                BZ
            </td>
            <td>
                Belize
            </td>
        </tr>
        <tr class="even">
            <td>
                BJ
            </td>
            <td>
                Benin
            </td>
            <td>
                BM
            </td>
            <td>
                Bermuda
            </td>
        </tr>
        <tr class="odd">
            <td>
                BT
            </td>
            <td>
                Bhutan
            </td>
            <td>
                BO
            </td>
            <td>
                Bolivia
            </td>
        </tr>
        <tr class="even">
            <td>
                BA
            </td>
            <td>
                Bosnia and Herzegowina
            </td>
            <td>
                BW
            </td>
            <td>
                Botswana
            </td>
        </tr>
        <tr class="odd">
            <td>
                BV
            </td>
            <td>
                Bouvet Island
            </td>
            <td>
                BR
            </td>
            <td>
                Brazil
            </td>
        </tr>
        <tr class="even">
            <td>
                IO
            </td>
            <td>
                British Indian Ocean Territory
            </td>
            <td>
                BN
            </td>
            <td>
                Brunei Darussalam
            </td>
        </tr>
        <tr class="odd">
            <td>
                BG
            </td>
            <td>
                Bulgaria
            </td>
            <td>
                BF
            </td>
            <td>
                Burkina Faso
            </td>
        </tr>
        <tr class="even">
            <td>
                BI
            </td>
            <td>
                Burundi
            </td>
            <td>
                KH
            </td>
            <td>
                Cambodia
            </td>
        </tr>
        <tr class="odd">
            <td>
                CM
            </td>
            <td>
                Cameroon
            </td>
            <td>
                CA
            </td>
            <td>
                Canada
            </td>
        </tr>
        <tr class="even">
            <td>
                CV
            </td>
            <td>
                Cape Verde
            </td>
            <td>
                KY
            </td>
            <td>
                Cayman Islands
            </td>
        </tr>
        <tr class="odd">
            <td>
                CF
            </td>
            <td>
                Central African Republic
            </td>
            <td>
                TD
            </td>
            <td>
                Chad
            </td>
        </tr>
        <tr class="even">
            <td>
                CL
            </td>
            <td>
                Chile
            </td>
            <td>
                CN
            </td>
            <td>
                China
            </td>
        </tr>
        <tr class="odd">
            <td>
                CX
            </td>
            <td>
                Christmas Island
            </td>
            <td>
                CC
            </td>
            <td>
                Cocos (Keeling) Islands
            </td>
        </tr>
        <tr class="even">
            <td>
                CO
            </td>
            <td>
                Colombia
            </td>
            <td>
                KM
            </td>
            <td>
                Comoros
            </td>
        </tr>
        <tr class="odd">
            <td>
                CD
            </td>
            <td>
                Congo, Democratic Republic of (was Zaire)
            </td>
            <td>
                CG
            </td>
            <td>
                Congo, People’s Republic of
            </td>
        </tr>
        <tr class="even">
            <td>
                CK
            </td>
            <td>
                Cook Islands
            </td>
            <td>
                CR
            </td>
            <td>
                Costa Rica
            </td>
        </tr>
        <tr class="odd">
            <td>
                CI
            </td>
            <td>
                Cote D’Ivoire
            </td>
            <td>
                HR
            </td>
            <td>
                Croatia (local name: Hrvatska)
            </td>
        </tr>
        <tr class="even">
            <td>
                CU
            </td>
            <td>
                Cuba
            </td>
            <td>
                CY
            </td>
            <td>
                Cyprus
            </td>
        </tr>
        <tr class="odd">
            <td>
                CZ
            </td>
            <td>
                Czech Republic
            </td>
            <td>
                DK
            </td>
            <td>
                Denmark
            </td>
        </tr>
        <tr class="even">
            <td>
                DJ
            </td>
            <td>
                Djibouti
            </td>
            <td>
                DM
            </td>
            <td>
                Dominica
            </td>
        </tr>
        <tr class="odd">
            <td>
                DO
            </td>
            <td>
                Dominican Republic
            </td>
            <td>
                TL
            </td>
            <td>
                East Timor
            </td>
        </tr>
        <tr class="even">
            <td>
                EC
            </td>
            <td>
                Ecuador
            </td>
            <td>
                EG
            </td>
            <td>
                Egypt
            </td>
        </tr>
        <tr class="odd">
            <td>
                SV
            </td>
            <td>
                El Salvador
            </td>
            <td>
                GQ
            </td>
            <td>
                Equatorial Guinea
            </td>
        </tr>
        <tr class="even">
            <td>
                ER
            </td>
            <td>
                Eritrea
            </td>
            <td>
                EE
            </td>
            <td>
                Estonia
            </td>
        </tr>
        <tr class="odd">
            <td>
                ET
            </td>
            <td>
                Ethiopia
            </td>
            <td>
                FK
            </td>
            <td>
                Falkland Islands (Malvinas)
            </td>
        </tr>
        <tr class="even">
            <td>
                FO
            </td>
            <td>
                Faroe Islands
            </td>
            <td>
                FJ
            </td>
            <td>
                Fiji
            </td>
        </tr>
        <tr class="odd">
            <td>
                FI
            </td>
            <td>
                Finland
            </td>
            <td>
                FR
            </td>
            <td>
                France
            </td>
        </tr>
        <tr class="even">
            <td>
                FX
            </td>
            <td>
                France, Metropolitan
            </td>
            <td>
                GF
            </td>
            <td>
                French Guiana
            </td>
        </tr>
        <tr class="odd">
            <td>
                PF
            </td>
            <td>
                French Polynesia
            </td>
            <td>
                TF
            </td>
            <td>
                French Southern Territories
            </td>
        </tr>
        <tr class="even">
            <td>
                GA
            </td>
            <td>
                Gabon
            </td>
            <td>
                GM
            </td>
            <td>
                Gambia
            </td>
        </tr>
        <tr class="odd">
            <td>
                GE
            </td>
            <td>
                Georgia
            </td>
            <td>
                DE
            </td>
            <td>
                Germany
            </td>
        </tr>
        <tr class="even">
            <td>
                GH
            </td>
            <td>
                Ghana
            </td>
            <td>
                GI
            </td>
            <td>
                Gibraltar
            </td>
        </tr>
        <tr class="odd">
            <td>
                GR
            </td>
            <td>
                Greece
            </td>
            <td>
                GL
            </td>
            <td>
                Greenland
            </td>
        </tr>
        <tr class="even">
            <td>
                GD
            </td>
            <td>
                Grenada
            </td>
            <td>
                GP
            </td>
            <td>
                Guadeloupe
            </td>
        </tr>
        <tr class="odd">
            <td>
                GU
            </td>
            <td>
                Guam
            </td>
            <td>
                GT
            </td>
            <td>
                Guatemala
            </td>
        </tr>
        <tr class="even">
            <td>
                GN
            </td>
            <td>
                Guinea
            </td>
            <td>
                GW
            </td>
            <td>
                Guinea-Bissau
            </td>
        </tr>
        <tr class="odd">
            <td>
                GY
            </td>
            <td>
                Guyana
            </td>
            <td>
                HT
            </td>
            <td>
                Haiti
            </td>
        </tr>
        <tr class="even">
            <td>
                HM
            </td>
            <td>
                Heard and Mc Donald Islands
            </td>
            <td>
                HN
            </td>
            <td>
                Honduras
            </td>
        </tr>
        <tr class="odd">
            <td>
                HK
            </td>
            <td>
                Hong Kong
            </td>
            <td>
                HU
            </td>
            <td>
                Hungary
            </td>
        </tr>
        <tr class="even">
            <td>
                IS
            </td>
            <td>
                Iceland
            </td>
            <td>
                IN
            </td>
            <td>
                India
            </td>
        </tr>
        <tr class="odd">
            <td>
                ID
            </td>
            <td>
                Indonesia
            </td>
            <td>
                IR
            </td>
            <td>
                Iran (Islamic Republic Of)
            </td>
        </tr>
        <tr class="even">
            <td>
                IQ
            </td>
            <td>
                Iraq
            </td>
            <td>
                IE
            </td>
            <td>
                Ireland
            </td>
        </tr>
        <tr class="odd">
            <td>
                IL
            </td>
            <td>
                Israel
            </td>
            <td>
                IT
            </td>
            <td>
                Italy
            </td>
        </tr>
        <tr class="even">
            <td>
                JM
            </td>
            <td>
                Jamaica
            </td>
            <td>
                JP
            </td>
            <td>
                Japan
            </td>
        </tr>
        <tr class="odd">
            <td>
                JO
            </td>
            <td>
                Jordan
            </td>
            <td>
                KZ
            </td>
            <td>
                Kazakhstan
            </td>
        </tr>
        <tr class="even">
            <td>
                KE
            </td>
            <td>
                Kenya
            </td>
            <td>
                KI
            </td>
            <td>
                Kiribati
            </td>
        </tr>
        <tr class="odd">
            <td>
                KP
            </td>
            <td>
                Korea, Democratic People’s Republic Of
            </td>
            <td>
                KR
            </td>
            <td>
                Korea, Republic Of
            </td>
        </tr>
        <tr class="even">
            <td>
                KW
            </td>
            <td>
                Kuwait
            </td>
            <td>
                KG
            </td>
            <td>
                Kyrgyzstan
            </td>
        </tr>
        <tr class="odd">
            <td>
                LA
            </td>
            <td>
                Lao People’s Democratic Republic
            </td>
            <td>
                LV
            </td>
            <td>
                Latvia
            </td>
        </tr>
        <tr class="even">
            <td>
                LB
            </td>
            <td>
                Lebanon
            </td>
            <td>
                LS
            </td>
            <td>
                Lesotho
            </td>
        </tr>
        <tr class="odd">
            <td>
                LR
            </td>
            <td>
                Liberia
            </td>
            <td>
                LY
            </td>
            <td>
                Libyan Arab Jamahiriya
            </td>
        </tr>
        <tr class="even">
            <td>
                LI
            </td>
            <td>
                Liechtenstein
            </td>
            <td>
                LT
            </td>
            <td>
                Lithuania
            </td>
        </tr>
        <tr class="odd">
            <td>
                LU
            </td>
            <td>
                Luxembourg
            </td>
            <td>
                MK
            </td>
            <td>
                Macedonia, The Former Yugoslav Republic Of
            </td>
        </tr>
        <tr class="even">
            <td>
                MG
            </td>
            <td>
                Madagascar
            </td>
            <td>
                MW
            </td>
            <td>
                Malawi
            </td>
        </tr>
        <tr class="odd">
            <td>
                MY
            </td>
            <td>
                Malaysia
            </td>
            <td>
                MV
            </td>
            <td>
                Maldives
            </td>
        </tr>
        <tr class="even">
            <td>
                ML
            </td>
            <td>
                Mali
            </td>
            <td>
                MT
            </td>
            <td>
                Malta
            </td>
        </tr>
        <tr class="odd">
            <td>
                MH
            </td>
            <td>
                Marshall Islands
            </td>
            <td>
                MQ
            </td>
            <td>
                Martinique
            </td>
        </tr>
        <tr class="even">
            <td>
                MR
            </td>
            <td>
                Mauritania
            </td>
            <td>
                MU
            </td>
            <td>
                Mauritius
            </td>
        </tr>
        <tr class="odd">
            <td>
                YT
            </td>
            <td>
                Mayotte
            </td>
            <td>
                MX
            </td>
            <td>
                Mexico
            </td>
        </tr>
        <tr class="even">
            <td>
                FM
            </td>
            <td>
                Micronesia, Federated States Of
            </td>
            <td>
                MD
            </td>
            <td>
                Moldova, Republic Of
            </td>
        </tr>
        <tr class="odd">
            <td>
                MC
            </td>
            <td>
                Monaco
            </td>
            <td>
                MN
            </td>
            <td>
                Mongolia
            </td>
        </tr>
        <tr class="even">
            <td>
                MS
            </td>
            <td>
                Montserrat
            </td>
            <td>
                MA
            </td>
            <td>
                Morocco
            </td>
        </tr>
        <tr class="odd">
            <td>
                MZ
            </td>
            <td>
                Mozambique
            </td>
            <td>
                MM
            </td>
            <td>
                Myanmar
            </td>
        </tr>
        <tr class="even">
            <td>
                NA
            </td>
            <td>
                Namibia
            </td>
            <td>
                NR
            </td>
            <td>
                Nauru
            </td>
        </tr>
        <tr class="odd">
            <td>
                NP
            </td>
            <td>
                Nepal
            </td>
            <td>
                NL
            </td>
            <td>
                Netherlands
            </td>
        </tr>
        <tr class="even">
            <td>
                AN
            </td>
            <td>
                Netherlands Antilles
            </td>
            <td>
                NC
            </td>
            <td>
                New Caledonia
            </td>
        </tr>
        <tr class="odd">
            <td>
                NZ
            </td>
            <td>
                New Zealand
            </td>
            <td>
                NI
            </td>
            <td>
                Nicaragua
            </td>
        </tr>
        <tr class="even">
            <td>
                NE
            </td>
            <td>
                Niger
            </td>
            <td>
                NG
            </td>
            <td>
                Nigeria
            </td>
        </tr>
        <tr class="odd">
            <td>
                NU
            </td>
            <td>
                Niue
            </td>
            <td>
                NF
            </td>
            <td>
                Norfolk Island
            </td>
        </tr>
        <tr class="even">
            <td>
                MP
            </td>
            <td>
                Northern Mariana Islands
            </td>
            <td>
                NO
            </td>
            <td>
                Norway
            </td>
        </tr>
        <tr class="odd">
            <td>
                OM
            </td>
            <td>
                Oman
            </td>
            <td>
                PK
            </td>
            <td>
                Pakistan
            </td>
        </tr>
        <tr class="even">
            <td>
                PW
            </td>
            <td>
                Palau
            </td>
            <td>
                PS
            </td>
            <td>
                Palestinian Territory, Occupied
            </td>
        </tr>
        <tr class="odd">
            <td>
                PA
            </td>
            <td>
                Panama
            </td>
            <td>
                PG
            </td>
            <td>
                Papua New Guinea
            </td>
        </tr>
        <tr class="even">
            <td>
                PY
            </td>
            <td>
                Paraguay
            </td>
            <td>
                PE
            </td>
            <td>
                Peru
            </td>
        </tr>
        <tr class="odd">
            <td>
                PH
            </td>
            <td>
                Philippines
            </td>
            <td>
                PN
            </td>
            <td>
                Pitcairn
            </td>
        </tr>
        <tr class="even">
            <td>
                PL
            </td>
            <td>
                Poland
            </td>
            <td>
                PT
            </td>
            <td>
                Portugal
            </td>
        </tr>
        <tr class="odd">
            <td>
                PR
            </td>
            <td>
                Puerto Rico
            </td>
            <td>
                QA
            </td>
            <td>
                Qatar
            </td>
        </tr>
        <tr class="even">
            <td>
                RE
            </td>
            <td>
                Reunion
            </td>
            <td>
                RO
            </td>
            <td>
                Romania
            </td>
        </tr>
        <tr class="odd">
            <td>
                RU
            </td>
            <td>
                Russian Federation
            </td>
            <td>
                RW
            </td>
            <td>
                Rwanda
            </td>
        </tr>
        <tr class="even">
            <td>
                KN
            </td>
            <td>
                Saint Kitts And Nevis
            </td>
            <td>
                LC
            </td>
            <td>
                Saint Lucia
            </td>
        </tr>
        <tr class="odd">
            <td>
                VC
            </td>
            <td>
                Saint Vincent and The Grenadines
            </td>
            <td>
                WS
            </td>
            <td>
                Samoa
            </td>
        </tr>
        <tr class="even">
            <td>
                SM
            </td>
            <td>
                San Marino
            </td>
            <td>
                ST
            </td>
            <td>
                Sao Tome and Principe
            </td>
        </tr>
        <tr class="odd">
            <td>
                SA
            </td>
            <td>
                Saudi Arabia
            </td>
            <td>
                SN
            </td>
            <td>
                Senegal
            </td>
        </tr>
        <tr class="even">
            <td>
                SC
            </td>
            <td>
                Seychelles
            </td>
            <td>
                SL
            </td>
            <td>
                Sierra Leone
            </td>
        </tr>
        <tr class="odd">
            <td>
                SG
            </td>
            <td>
                Singapore
            </td>
            <td>
                SK
            </td>
            <td>
                Slovakia (Slovak Republic)
            </td>
        </tr>
        <tr class="even">
            <td>
                SI
            </td>
            <td>
                Slovenia
            </td>
            <td>
                SB
            </td>
            <td>
                Solomon Islands
            </td>
        </tr>
        <tr class="odd">
            <td>
                SO
            </td>
            <td>
                Somalia
            </td>
            <td>
                ZA
            </td>
            <td>
                South Africa
            </td>
        </tr>
        <tr class="even">
            <td>
                GS
            </td>
            <td>
                South Georgia and The South Sandwich Islands
            </td>
            <td>
                ES
            </td>
            <td>
                Spain
            </td>
        </tr>
        <tr class="odd">
            <td>
                LK
            </td>
            <td>
                Sri Lanka
            </td>
            <td>
                SH
            </td>
            <td>
                St. Helena
            </td>
        </tr>
        <tr class="even">
            <td>
                PM
            </td>
            <td>
                St. Pierre And Miquelon
            </td>
            <td>
                SD
            </td>
            <td>
                Sudan
            </td>
        </tr>
        <tr class="odd">
            <td>
                SR
            </td>
            <td>
                Suriname
            </td>
            <td>
                SJ
            </td>
            <td>
                Svalbard And Jan Mayen Islands
            </td>
        </tr>
        <tr class="even">
            <td>
                SZ
            </td>
            <td>
                Swaziland
            </td>
            <td>
                SE
            </td>
            <td>
                Sweden
            </td>
        </tr>
        <tr class="odd">
            <td>
                CH
            </td>
            <td>
                Switzerland
            </td>
            <td>
                SY
            </td>
            <td>
                Syrian Arab Republic
            </td>
        </tr>
        <tr class="even">
            <td>
                TW
            </td>
            <td>
                Taiwan
            </td>
            <td>
                TJ
            </td>
            <td>
                Tajikistan
            </td>
        </tr>
        <tr class="odd">
            <td>
                TZ
            </td>
            <td>
                Tanzania, United Republic Of
            </td>
            <td>
                TH
            </td>
            <td>
                Thailand
            </td>
        </tr>
        <tr class="even">
            <td>
                TG
            </td>
            <td>
                Togo
            </td>
            <td>
                TK
            </td>
            <td>
                Tokelau
            </td>
        </tr>
        <tr class="odd">
            <td>
                TO
            </td>
            <td>
                Tonga
            </td>
            <td>
                TT
            </td>
            <td>
                Trinidad and tobago
            </td>
        </tr>
        <tr class="even">
            <td>
                TN
            </td>
            <td>
                Tunisia
            </td>
            <td>
                TR
            </td>
            <td>
                Turkey
            </td>
        </tr>
        <tr class="odd">
            <td>
                TM
            </td>
            <td>
                Turkmenistan
            </td>
            <td>
                TC
            </td>
            <td>
                Turks And Caicos Islands
            </td>
        </tr>
        <tr class="even">
            <td>
                TV
            </td>
            <td>
                Tuvalu
            </td>
            <td>
                UG
            </td>
            <td>
                Uganda
            </td>
        </tr>
        <tr class="odd">
            <td>
                UA
            </td>
            <td>
                Ukraine
            </td>
            <td>
                AE
            </td>
            <td>
                United Arab Emirates
            </td>
        </tr>
        <tr class="even">
            <td>
                GB
            </td>
            <td>
                United Kingdom
            </td>
            <td>
                US
            </td>
            <td>
                United States
            </td>
        </tr>
        <tr class="odd">
            <td>
                UM
            </td>
            <td>
                United States Minor Outlying Islands
            </td>
            <td>
                UY
            </td>
            <td>
                Uruguay
            </td>
        </tr>
        <tr class="even">
            <td>
                UZ
            </td>
            <td>
                Uzbekistan
            </td>
            <td>
                VU
            </td>
            <td>
                Vanuatu
            </td>
        </tr>
        <tr class="odd">
            <td>
                VA
            </td>
            <td>
                Vatican City State (Holy See)
            </td>
            <td>
                VE
            </td>
            <td>
                Venezuela
            </td>
        </tr>
        <tr class="even">
            <td>
                VN
            </td>
            <td>
                Viet Nam
            </td>
            <td>
                VG
            </td>
            <td>
                Virgin Islands (British)
            </td>
        </tr>
        <tr class="odd">
            <td>
                VI
            </td>
            <td>
                Virgin Islands (U.S.)
            </td>
            <td>
                WF
            </td>
            <td>
                Wallis and Futuna Islands
            </td>
        </tr>
        <tr class="even">
            <td>
                EH
            </td>
            <td>
                Western Sahara
            </td>
            <td>
                YE
            </td>
            <td>
                Yemen
            </td>
        </tr>
        <tr class="odd">
            <td>
                YU
            </td>
            <td>
                Yugoslavia
            </td>
            <td>
                ZM
            </td>
            <td>
                Zambia
            </td>
        </tr>
        <tr class="even">
            <td>
                ZW
            </td>
            <td>
                Zimbabwe
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<p>
    I make extensive use of styles in the OOo documents that I write. I use a specific paragraph style to format my code
    samples. Each paragraph style allows you to set the default character attributes to use in the paragraph. In OOo,
    characters specify the locale so I set the locale for this paragraph style to unknown; this prevents the
    spell-checker from checking my code samples.
</p>
<p>
    To tell OOo that a word is French, and should be checked as French, set the locale of the characters to French. The
    code in traverses the paragraphs in a document and sets the locale on each one.
</p>
<p>
    <strong>Listing .</strong> Set a simple Writer document to use a French locale.
</p>
<p>
    Sub SetDocumentLocale
</p>
<p>
    Dim aLocale As New com.sun.star.lang.Locale
</p>
<p>
    aLocale.Language = "fr" 'Set the Locale to use the French language
</p>
<p>
    aLocale.Country = "FR" 'Set the Locale to use France as the country
</p>
<p>
    Dim oCursor 'Cursor used to traverse the document.
</p>
<p>
    Dim oText 'The document text object
</p>
<p>
    oText = ThisComponent.Text 'Writer documents have a Text object
</p>
<p>
    oCursor = oText.createTextCursor() 'Create a text cursor
</p>
<p>
    REM Move cursor to the start of the document and do not select text.
</p>
<p>
    oCursor.GoToStart(False)
</p>
<p>
    REM Move to the end of the paragraph, selecting the entire paragraph.
</p>
<p>
    REM gotoNextParagraph() returns False if it fails.
</p>
<p>
    Do While oCursor.gotoNextParagraph(True)
</p>
<p>
    oCursor.CharLocale = aLocale 'This can fail for some paragraph types
</p>
<p>
    oCursor.goRight(0, False) 'Deselect all text
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<p>
    The spell-checker, hyphenation, and thesaurus all require a locale to function. They will not function, however, if
    they aren’t properly configured. Use Tools | Options | Language Settings | Writing Aids to configure these in OOo.
    The macro in obtains a SpellChecker, Hyphenator, and Thesaurus, all of which require a Locale object.
</p>
<p>
    <strong>Listing .</strong> Spell Check, Hyphenate, and Thesaurus.
</p>
<p>
    Sub SpellCheckExample
</p>
<p>
    Dim s() 'Contains the words to check
</p>
<p>
    Dim vReturn 'Value returned from SpellChecker, Hyphenator, and Thesaurus
</p>
<p>
    Dim i As Integer 'Utility index variable
</p>
<p>
    Dim msg$ 'Message string
</p>
<p>
</p>
<p>
    REM Although I create an empty argument array, I could also
</p>
<p>
    REM use Array() to return an empty array.
</p>
<p>
    Dim emptyArgs() as new com.sun.star.beans.PropertyValue
</p>
<p>
</p>
<p>
    Dim aLocale As New com.sun.star.lang.Locale
</p>
<p>
    aLocale.Language = "en" 'Use the English language
</p>
<p>
    aLocale.Country = "US" 'Use the United States as the country
</p>
<p>
</p>
<p>
    REM Words to check for spelling, hyphenation, and thesaurus
</p>
<p>
    s = Array("hello", "anesthesiologist",_
</p>
<p>
    "PNEUMONOULTRAMICROSCOPICSILICOVOLCANOCONIOSIS",_
</p>
<p>
    "Pitonyak", "misspell")
</p>
<p>
</p>
<p>
    REM *********Spell Check Example!
</p>
<p>
    Dim vSpeller As Variant
</p>
<p>
    vSpeller = createUnoService("com.sun.star.linguistic2.SpellChecker")
</p>
<p>
    'Use vReturn = vSpeller.spell(s, aLocale, emptyArgs()) if you want options!
</p>
<p>
    For i = LBound(s()) To UBound(s())
</p>
<p>
    vReturn = vSpeller.isValid(s(i), aLocale, emptyArgs())
</p>
<p>
    msg = msg &amp; vReturn &amp; " for " &amp; s(i) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox msg, 0, "Spell Check Words"
</p>
<p>
    msg = ""
</p>
<p>
</p>
<p>
    '******Hyphenation Example!
</p>
<p>
    Dim vHyphen As Variant
</p>
<p>
    vHyphen = createUnoService("com.sun.star.linguistic2.Hyphenator")
</p>
<p>
    For i = LBound(s()) To UBound(s())
</p>
<p>
    'vReturn = vHyphen.hyphenate(s(i), aLocale, 0, emptyArgs())
</p>
<p>
    vReturn = vHyphen.createPossibleHyphens(s(i), aLocale, emptyArgs())
</p>
<p>
    If IsNull(vReturn) Then
</p>
<p>
    'hyphenation is probablly off in the configuration
</p>
<p>
    msg = msg &amp; " null for " &amp; s(i) &amp; CHR$(10)
</p>
<p>
    Else
</p>
<p>
    msg = msg &amp; vReturn.getPossibleHyphens() &amp; " for " &amp; s(i) &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    MsgBox msg, 0, "Hyphenate Words"
</p>
<p>
    msg = ""
</p>
<p>
</p>
<p>
    '******Thesaurus Example!
</p>
<p>
    Dim vThesaurus As Variant
</p>
<p>
    Dim j As Integer, k As Integer
</p>
<p>
    vThesaurus = createUnoService("com.sun.star.linguistic2.Thesaurus")
</p>
<p>
    s = Array("hello", "stamp", "cool")
</p>
<p>
    For i = LBound(s()) To UBound(s())
</p>
<p>
    vReturn = vThesaurus.queryMeanings(s(i), aLocale, emptyArgs())
</p>
<p>
    If UBound(vReturn) &lt; 0 Then
</p>
<p>
    Print "Thesaurus found nothing for " &amp; s(i)
</p>
<p>
    Else
</p>
<p>
    msg = "Word " &amp; s(i) &amp; " has the following meanings:" &amp; CHR$(10)
</p>
<p>
    For j = LBound(vReturn) To UBound(vReturn)
</p>
<p>
    msg=msg &amp; CHR$(10) &amp; "Meaning = " &amp; vReturn(j).getMeaning() &amp; CHR$(10)
</p>
<p>
    msg = msg &amp; Join(vReturn(j).querySynonyms(), " ") &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox msg, 0, "Althernate Meanings"
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    It is possible to obtain the default locale that is configured for OOo. Laurent Godard, an active OpenOffice.org
    volunteer, wrote the macro in , which obtains OOo’s currently configured locale.
</p>
<p>
    <strong>Listing .</strong> Currently configured language (Locale).
</p>
<p>
    Sub OOoLang()
</p>
<p>
    'Retreives the running OOO version
</p>
<p>
    'Author : Laurent Godard
</p>
<p>
    'e-mail : listes.godard@laposte.net
</p>
<p>
    '
</p>
<p>
    Dim aSettings, aConfigProvider
</p>
<p>
    Dim aParams2(0) As new com.sun.star.beans.PropertyValue
</p>
<p>
    Dim sProvider$, sAccess$
</p>
<p>
    sProvider = "com.sun.star.configuration.ConfigurationProvider"
</p>
<p>
    sAccess = "com.sun.star.configuration.ConfigurationAccess"
</p>
<p>
    aConfigProvider = createUnoService(sProvider)
</p>
<p>
    aParams2(0).Name = "nodepath"
</p>
<p>
    aParams2(0).Value = "/org.openoffice.Setup/L10N"
</p>
<p>
    aSettings = aConfigProvider.createInstanceWithArguments(sAccess, aParams2())
</p>
<p>
    Dim OOLangue as string
</p>
<p>
    OOLangue= aSettings.getbyname("ooLocale") 'en-US
</p>
<p>
    MsgBox "OOo is configured with Locale " &amp; OOLangue, 0, "OOo Locale"
</p>
<p>
    End Sub
</p>
<p>
    The above macro is reputed to fail on AOO, but, the following should work correctly. The macro does function
    correctly with LO. The macro shown below should work for both AOO and LO.
</p>
<p>
    <strong>Listing .</strong> You can use the tools library to get the current locale as a string.
</p>
<p>
    GlobalScope.BasicLibraries.loadLibrary( "Tools" )<br /> Print
    GetRegistryKeyContent("org.openoffice.Setup/L10N",FALSE).getByName("ooLocale")
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="enumerating-printers">
                    <span id="anchor-258"></span>Enumerating printers
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The ability to enumerate printers has long been lacking in OOo. To obtain a printer list in OOo version 1.x or 2.x I
    used the .uno:print dispatch to open the print dialog, and then I directly access the dialog to extract the list of
    available printers.
</p>
<p>
    The PrinterServer service was introduced, but it was not properly constructed, so the methods in the XPrinterServer
    interface are not directly available; according to Ariel Constenla-Haile this is slated to be ready in OOo 3.5.
    Thankfully, Niklas Nebel provided a working solution. The solution is a bit tricky, but it demonstrates how to work
    around the problem.
</p>
<p>
    <strong>Listing .</strong> Display available printers.
</p>
<p>
    Sub PrintAllPrinterNames()
</p>
<p>
    Dim oPrintServer ' The print server service.
</p>
<p>
    Dim oCore ' Get classes and other objects by name.
</p>
<p>
    Dim oClass ' XPrinterServer class object.
</p>
<p>
    Dim oMethod ' getPrinterNames method from the XPrinterServer class.
</p>
<p>
    Dim aNames ' List of printer names.
</p>
<p>
</p>
<p>
    ' Create the object that will not be directly usable until OOo 3.5.
</p>
<p>
    oPrintServer = CreateUnoService("com.sun.star.awt.PrinterServer")
</p>
<p>
    oCore = CreateUnoService("com.sun.star.reflection.CoreReflection")
</p>
<p>
</p>
<p>
    ' Get the class object for the XPrinterServer interface.
</p>
<p>
    oClass = oCore.forName("com.sun.star.awt.XPrinterServer")
</p>
<p>
</p>
<p>
    ' Get the getPrinterNames method for the XPrinterServer class.
</p>
<p>
    oMethod = oClass.getMethod("getPrinterNames")
</p>
<p>
</p>
<p>
    ' Call the getPrinterNames method on the PrinterServer object.
</p>
<p>
    aNames = oMethod.invoke(oPrintServer, Array())
</p>
<p>
    MsgBox Join(aNames, CHR$(10))
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                If OOo does not recognize your printer by it's name, surround the printer name with angle brackets
                “&lt;printer_name&gt;”, in the past some printers required this.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Prior to OOo 3.5, the PrinterServer cannot be used from Basic, because XTypeProvider is not declared to be inherited
    by that class; although it is implemented in the class. Basic cannot, therefore, recognize the methods supported by
    the object. The code in demonstrates how to call the method directly.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="printing-documents">
                    <span id="anchor-259"></span>Printing documents
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The primary printing functionality is common to all OOo document types. The interface com.sun.star.view.XPrintable
    defines three methods (see ).
</p>
<p>
    Table 113. Object methods defined by com.sun.star.view.XPrintable.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getPrinter()
            </td>
            <td>
                Default printer as an array of properties (com.sun.star.view.PrinterDescriptor).
            </td>
        </tr>
        <tr class="even">
            <td>
                setPrinter(properties)
            </td>
            <td>
                Assign a new printer to the object (com.sun.star.view.PrinterDescriptor).
            </td>
        </tr>
        <tr class="odd">
            <td>
                print(properties)
            </td>
            <td>
                Print the document (com.sun.star.view.PrintOptions).
            </td>
        </tr>
    </tbody>
</table>
<p>
    The object method getPrinter() returns an array of properties that describe the printer (see ). The macro in
    demonstrates how to access and interpret each of the properties (see for supported properties).
</p>
<p>
    <strong>Listing .</strong> Display printer properties.
</p>
<p>
    Sub DisplayPrinterProperties
</p>
<p>
    Dim Props 'Array of com.sun.star.beans.PropertyValue
</p>
<p>
    Dim i% 'Index variable of type Integer
</p>
<p>
    Dim s$ 'Display string
</p>
<p>
    Dim v '
</p>
<p>
    Dim sName$ '
</p>
<p>
    On Error Resume Next
</p>
<p>
    Props = ThisComponent.getPrinter()
</p>
<p>
    For i = 0 To UBound(Props)
</p>
<p>
    sName = props(i).Name
</p>
<p>
    v = props(i).Value
</p>
<p>
    s = s &amp; sName &amp; " = "
</p>
<p>
    If sName = "PaperOrientation" Then
</p>
<p>
    REM com.sun.star.view.PaperOrientation.LANDSCAPE also supported
</p>
<p>
    s = s &amp; IIf(v=com.sun.star.view.PaperOrientation.PORTRAIT,_
</p>
<p>
    "Portrait", "Landscape") &amp; " = " &amp; CStr(v)
</p>
<p>
    ElseIf sName = "PaperFormat" Then
</p>
<p>
    Select Case v
</p>
<p>
    Case com.sun.star.view.PaperFormat.A3
</p>
<p>
    s = s &amp; "A3"
</p>
<p>
    Case com.sun.star.view.PaperFormat.A4
</p>
<p>
    s = s &amp; "A4"
</p>
<p>
    Case com.sun.star.view.PaperFormat.A5
</p>
<p>
    s = s &amp; "A5"
</p>
<p>
    Case com.sun.star.view.PaperFormat.B4
</p>
<p>
    s = s &amp; "B4"
</p>
<p>
    Case com.sun.star.view.PaperFormat.B5
</p>
<p>
    s = s &amp; "B5"
</p>
<p>
    Case com.sun.star.view.PaperFormat.LETTER
</p>
<p>
    s = s &amp; "LETTER"
</p>
<p>
    Case com.sun.star.view.PaperFormat.LEGAL
</p>
<p>
    s = s &amp; "LEGAL"
</p>
<p>
    Case com.sun.star.view.PaperFormat.TABLOID
</p>
<p>
    s = s &amp; "TABLOID"
</p>
<p>
    Case com.sun.star.view.PaperFormat.USER
</p>
<p>
    s = s &amp; "USER"
</p>
<p>
    Case Else
</p>
<p>
    s = s &amp; "Unknown value"
</p>
<p>
    End Select
</p>
<p>
    s = s &amp; " = " &amp; CStr(v)
</p>
<p>
    ElseIf sName = "PaperSize" Then
</p>
<p>
    REM type is com.sun.star.awt.Size
</p>
<p>
    REM The size is in TWIPS and there are 1440 twips per inch
</p>
<p>
    s=s &amp; CDbl(v.Width)/1440.0 &amp; "x" &amp; CDbl(v.Height)/1440.0 &amp; " (inches)"
</p>
<p>
    Else
</p>
<p>
    s = s &amp; CStr(v)
</p>
<p>
    End If
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Printer Properties"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000F4000000BF79A75E2B.png" style="width:2.5417in;height:1.9898in" />
</p>
<p>
    <strong>Figure .</strong> Properties of the default printer.
</p>
<p>
    Table 114. Properties defined by the service com.sun.star.view.PrinterDescriptor.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Name
            </td>
            <td>
                Name of the printer queue.
            </td>
        </tr>
        <tr class="even">
            <td>
                PaperOrientation
            </td>
            <td>
                Paper orientation (com.sun.star.view.PaperOrientation).
            </td>
        </tr>
        <tr class="odd">
            <td>
                PaperFormat
            </td>
            <td>
                Predefined paper sizes (com.sun.star.view.PaperFormat).
            </td>
        </tr>
        <tr class="even">
            <td>
                PaperSize
            </td>
            <td>
                Paper size in twips (com.sun.star.awt.Size).
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsBusy
            </td>
            <td>
                Is the printer busy?
            </td>
        </tr>
        <tr class="even">
            <td>
                CanSetPaperOrientation
            </td>
            <td>
                Can the paper orientation be set?
            </td>
        </tr>
        <tr class="odd">
            <td>
                CanSetPaperFormat
            </td>
            <td>
                Are other paper formats supported?
            </td>
        </tr>
        <tr class="even">
            <td>
                CanSetPaperSize
            </td>
            <td>
                Can the paper size be set?
            </td>
        </tr>
    </tbody>
</table>
<p>
    Call the print() method with no properties to print a single copy of the document to the current printer. All of the
    document types support the properties in . The Pages property supports the standard format used in the Print dialog.
    The format string “1, 3, 4-7, 9-” prints pages 1, 3, 4 through 7, and 9 through the last page.
</p>
<p>
    Table 115. Properties defined by com.sun.star.view.PrintOptions.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Collate
            </td>
            <td>
                Collate the printed pages (set to True or False).
            </td>
        </tr>
        <tr class="even">
            <td>
                CopyCount
            </td>
            <td>
                Number of copies to print.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DuplexMode
            </td>
            <td>
                Use the com.sun.star.view.DuplexMode constants to set duplex mode. Supported values include UNKNOWN (0),
                OFF (1), LONGEDGE (2), and SHORTEDGE (3).
            </td>
        </tr>
        <tr class="even">
            <td>
                FileName
            </td>
            <td>
                Send the output to a file rather than to the printer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Pages
            </td>
            <td>
                Specifies pages and page ranges to print.
            </td>
        </tr>
        <tr class="even">
            <td>
                Wait
            </td>
            <td>
                If TRUE, the print request is synchronous; wait for the job to finish before returning.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Print pages 30 and 31 of the current document.
</p>
<p>
    Dim Props(1) As New com.sun.star.beans.PropertyValue
</p>
<p>
    Props(0).Name = "Pages" : Props(0).Value = "30-31"
</p>
<p>
    ThisComponent.print(Props())
</p>
<p>
    When a document is printed, control returns to the caller before the printing is complete. If you close the document
    before printing is done, OpenOffice is likely to crash because the OO internals are still using the document. It’s
    possible to set up an event listener that watches for the print job to finish, but there’s an easier way that isn’t
    currently documented. The print() method accepts an array of properties that direct the printing. The “wait”
    argument with a Boolean value of True instructs the print() method to not return until after printing is complete.
    As of May 17, 2011 with OOo 3.3, the wait argument does not work; print listener is demonstrated in section <a
        href="#anchor-198">13.15.3</a> <a href="#anchor-198">A Calc example with a Print listener</a>.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Closing a document while OpenOffice.org is printing the document can cause OpenOffice.org<br /> to
                crash. Use the “wait” property to avoid this problem.
            </td>
        </tr>
    </tbody>
</table>
<p>
    On Unix-type computers, printers are configured to work with OpenOffice.org using the “spadmin” utility. After a
    printer has been configured for OOo, it is available for use by name. You can still use printers that have not been
    configured for OOo, but you must enclose the printer name between the characters “&lt;” and “&gt;”. To print with a
    printer other than the default, use code similar to the following:
</p>
<p>
    Public oProps(0) as New com.sun.star.beans.PropertyValue
</p>
<p>
    Public oOpts(1) as New com.sun.star.beans.PropertyValue
</p>
<p>
    Dim oDoc 'Document to print.
</p>
<p>
    Dim oPrinter 'Array of properties that define the printer.
</p>
<p>
    Dim sUrl$ 'URL of the document to load and print.
</p>
<p>
    Dim sPrinter$ 'Name of the printer.
</p>
<p>
    REM Set the name of the printer as known by the system.
</p>
<p>
    sPrinter = "HP-Color-LaserJet-4650DN"
</p>
<p>
    REM Load the document in hidden mode so it is not visible
</p>
<p>
    REM on the screen.
</p>
<p>
    oProps(0).Name = "Hidden"
</p>
<p>
    oProps(0).Value = True
</p>
<p>
    REM Now load the document.
</p>
<p>
    sUrl = "file:///c:/test_doc.sxw"
</p>
<p>
    oDoc = oDesk.LoadComponentFromUrl(sUrl, "_blank", 63, oProps())
</p>
<p>
    REM Obtain the current printer object from the document.
</p>
<p>
    REM This is really an array of property values.
</p>
<p>
    REM Change the name of the object to reference the printer that
</p>
<p>
    REM you want to use. Notice that the printer name is the system name.
</p>
<p>
    oPrinter = oDoc.getPrinter()
</p>
<p>
    For i = LBound(oPrinter) to UBound(oPrinter)
</p>
<p>
    If oPrinter(i).Name = "Name" Then
</p>
<p>
    oPrinter(i).Value = sPrinter
</p>
<p>
    End If
</p>
<p>
    Next i
</p>
<p>
    REM Set the printer back into the document. The only thing
</p>
<p>
    REM that has changed is the printer name.
</p>
<p>
    oDoc.setPrinter(oPrinter)
</p>
<p>
    REM Now, set up the print options for actual printing.
</p>
<p>
    REM Notice that the printer name is surrounded by the characters &lt; and &gt;.
</p>
<p>
    REM Also notice that the print() method is set to not return until
</p>
<p>
    REM after printing is completed.
</p>
<p>
    oOpts(0).Name = "Name"
</p>
<p>
    oOpts(0).Value = "&lt;" &amp; sPrinter &amp; "&gt;"
</p>
<p>
    oOpts(1).Name = "Wait"
</p>
<p>
    oOpts(1).Value = True
</p>
<p>
    oDoc.Print(oOpts())
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Historically, it has been experimentally determined that you must set the destination printer in the
                document before trying to print to a printer other than the default.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="printing-writer-documents">
                            <span id="anchor-260"></span>Printing Writer documents
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Different document types support extra options for printing. Text documents support the interface
    com.sun.star.text.XPagePrintable (see ). The XPagePrintable interface implements an alternate method of printing the
    document that provides more control of the output. The primary advantage is that you can print multiple pages from
    the document on a single output page.
</p>
<p>
    Table 116. Methods defined by the com.sun.star.text.XPagePrintable interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getPagePrintSettings()
            </td>
            <td>
                Returns an array of properties (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                setPagePrintSettings(properties)
            </td>
            <td>
                Change the settings (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                printPages(properties)
            </td>
            <td>
                Print using properties in .
            </td>
        </tr>
    </tbody>
</table>
<p>
    The object method printPages() accepts the same properties as the print() method (see ). The methods to get and set
    the page print properties are outlined in . The macro in obtains and prints the current page print properties, shown
    in .
</p>
<p>
    Table 117. Properties used by the com.sun.star.text.XPagePrintable interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                PageRows
            </td>
            <td>
                Number of rows of pages on each printed page.
            </td>
        </tr>
        <tr class="even">
            <td>
                PageColumns
            </td>
            <td>
                Number of columns of pages on each printed page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LeftMargin
            </td>
            <td>
                Left margin.
            </td>
        </tr>
        <tr class="even">
            <td>
                RightMargin
            </td>
            <td>
                Right margin.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TopMargin
            </td>
            <td>
                Top margin.
            </td>
        </tr>
        <tr class="even">
            <td>
                BottomMargin
            </td>
            <td>
                Bottom margin.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HoriMargin
            </td>
            <td>
                Margin between rows of pages.
            </td>
        </tr>
        <tr class="even">
            <td>
                VertMargin
            </td>
            <td>
                Margin between columns of pages.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsLandscape
            </td>
            <td>
                True or False; print in landscape format.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Display Page Print Properties.
</p>
<p>
    Sub DisplayPagePrintProperties
</p>
<p>
    Dim Props 'Array of com.sun.star.beans.PropertyValue
</p>
<p>
    Dim i% 'Index variable of type Integer
</p>
<p>
    Dim s$ 'Display string
</p>
<p>
    If HasUnoInterfaces(ThisComponent, "com.sun.star.text.XPagePrintable") Then
</p>
<p>
    Props = ThisComponent.getPagePrintSettings()
</p>
<p>
    For i = 0 To UBound(Props)
</p>
<p>
    s = s &amp; props(i).Name &amp; " = " &amp; CStr(props(i).Value) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Page Print Properties"
</p>
<p>
    Else
</p>
<p>
    Print "Sorry, this document does not support the XPagePrintable interface"
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000002EE000002FC3029E0B0.gif" style="width:2.0016in;height:1.8898in" />
</p>
<p>
    <strong>Figure .</strong> Page print properties of a Writer document.
</p>
<p>
    The macro in attempts to print a document with two pages on each printed page in landscape mode. With my latest
    testing in OOo version 3.3, the document is printed normally, which is an improvement over the previous behavior of
    crashing OOo.
</p>
<p>
    <strong>Listing .</strong> Print Two Per Page.
</p>
<p>
    Sub PrintTwoPerPage
</p>
<p>
    Dim Props(0 To 1) As New com.sun.star.beans.PropertyValue
</p>
<p>
    Props(0).Name = "PageColumns" : Props(0).Value = 2
</p>
<p>
    Props(1).Name = "IsLandscape" : Props(1).Value = True
</p>
<p>
    If HasUnoInterfaces(ThisComponent, "com.sun.star.text.XPagePrintable") Then
</p>
<p>
    ThisComponent.setPagePrintSettings(Props()) '
</p>
<p>
    ThisComponent.printPages(Array()) 'Use default properties
</p>
<p>
    Else
</p>
<p>
    Print "Sorry, this document does not support the XPagePrintable interface"
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    Although the macro in stopped working with OOo 1.1.1, a small modification allows the macro to run. The new macro
    still causes OOo to crash under Linux and to close the document under Windows, but it does manage to print the
    document. As with , the document is printed in portrait mode rather than landscape mode — this is an OOo bug.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="printing-calc-documents">
                            <span id="anchor-261"></span>Printing Calc documents
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    To perform special printing functions with a Writer document, a special object method is called. To perform special
    printing functions with Calc documents, you must modify the document properties and page-style properties and then
    use the standard print() method. For example, it is common for a Calc sheet to be too large to fit on a single sheet
    of paper. To scale the sheet to fit on a specified number of pages, set the ScaleToPages property to contain the
    number of pages that should contain the sheet. To simply scale the page based on a percentage, use the PageScale
    property (see ).
</p>
<p>
    <strong>Listing .</strong> Print a spreadsheet at 25 percent; this is very small!
</p>
<p>
    Sub PrintScaledSpreadsheet
</p>
<p>
    Dim s$ 'Style name
</p>
<p>
    Dim oStyle 'The current page style
</p>
<p>
    REM Use the currently active sheet to obtain the page style.
</p>
<p>
    REM In a Calc document, the current controller knows which sheet
</p>
<p>
    REM is active.
</p>
<p>
    s = ThisComponent.CurrentController.getActiveSheet().PageStyle
</p>
<p>
    oStyle = ThisComponent.StyleFamilies.getByName("PageStyles").getByName(s)
</p>
<p>
    REM oStyle.PageScale = 100 Default value is 100 (as in 100%)
</p>
<p>
    REM oStyle.ScaleToPages = 0 Default value is 0, as in don't scale
</p>
<p>
    oStyle.PageScale = 25 'Scale document to 25% (very very very small)
</p>
<p>
    ThisComponent.Print(Array()) 'Print the document
</p>
<p>
    End Sub
</p>
<p>
    The second aspect to printing Calc documents involves setting the area to print along with the column and row titles
    (see ).
</p>
<p>
    Table 118. Properties used by the com.sun.star.sheet.XPrintAreas interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getPrintAreas()
            </td>
            <td>
                Return array of type com.sun.star.table.CellRangeAddress.
            </td>
        </tr>
        <tr class="even">
            <td>
                setPrintAreas(ranges)
            </td>
            <td>
                Set print areas for the sheet with array of type CellRangeAddress. Print everything if nothing is set.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getPrintTitleColumns()
            </td>
            <td>
                Return True if title columns are repeated to the right.
            </td>
        </tr>
        <tr class="even">
            <td>
                setPrintTitleColumns(boolean)
            </td>
            <td>
                Set True if title columns are repeated on all print pages to the right.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getTitleColumns()
            </td>
            <td>
                Array of type com.sun.star.table.CellRangeAddress.
            </td>
        </tr>
        <tr class="even">
            <td>
                setTitleColumns(ranges)
            </td>
            <td>
                Set columns to use as titles. Rows are ignored; only columns matter.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getPrintTitleRows()
            </td>
            <td>
                Return True if title rows are repeated on all print pages.
            </td>
        </tr>
        <tr class="even">
            <td>
                setPrintTitleRows(boolean)
            </td>
            <td>
                Set to True if row titles are repeated on all print pages to the bottom.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getTitleRows()
            </td>
            <td>
                Return array of type com.sun.star.table.CellRangeAddress.
            </td>
        </tr>
        <tr class="even">
            <td>
                setTitleRows(ranges)
            </td>
            <td>
                Set rows to use as titles. Columns are ignored; only rows matter.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The methods in are based on sheets in a Calc document; as opposed to the entire Calc document. The macro in sets two
    print ranges and then prints the document. Each print range is printed on a new page.
</p>
<p>
    <strong>Listing .</strong> Set and print multiple ranges in a Calc document.
</p>
<p>
    Sub PrintSpreadsheetAreas
</p>
<p>
    Dim oRanges(1) As New com.sun.star.table.CellRangeAddress
</p>
<p>
    oRanges(0).Sheet = 0
</p>
<p>
    oRanges(0).StartColumn = 0 : oRanges(0).StartRow = 0 'A1
</p>
<p>
    oRanges(0).EndColumn = 3 : oRanges(0).EndRow = 4 'D5
</p>
<p>
</p>
<p>
    oRanges(1).Sheet = 0
</p>
<p>
    oRanges(1).StartColumn = 0 : oRanges(1).StartRow = 8 'A9
</p>
<p>
    oRanges(1).EndColumn = 3 : oRanges(1).EndRow = 10 'D11
</p>
<p>
</p>
<p>
    ThisComponent.CurrentController.getActiveSheet().setPrintAreas(oRanges())
</p>
<p>
    ThisComponent.Print(Array())
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="a-calc-example-with-a-print-listener">
                            <span id="anchor-198"></span>A Calc example with a Print listener
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Sheet1 in a Calc document contains a button that prints Sheet2 and leaves Sheet1 as the active sheet. To print
    Sheet2, it must be made the active sheet. The code was structured as follows:
</p>
<ol type="1">
    <li>
        Set Sheet2 active.
    </li>
    <li>
        Call the document level print method.
    </li>
    <li>
        Set Sheet1 active.
    </li>
</ol>
<p>
    The print method returns immediately and the document is printed in the background. Sheet1, therefore, becomes the
    active sheet before printing begins, so Sheet1 is printed rather than Sheet2. The correct solution is to register a
    print listener that sets Sheet1 active after printing is complete.
</p>
<p>
    A listener is stored in a Global variable so that is lives after the macro is finished running. Be warned, however,
    that if you edit any macro the global variable will be erased but the listener will still be registered; and you
    will have no way to unregister it without closing the document. So, first, create the variables to reference the
    listener. The document is also stored, but I could have referenced ThisComponent instead.
</p>
<p>
    <strong>Listing .</strong> Global variables that reference the listener and the document.
</p>
<p>
    Global oPrintListener
</p>
<p>
    Global oPrintJobListnerDoc
</p>
<p>
    The current active sheet is set as part of the real world macro, so it is also shown here.
</p>
<p>
    <strong>Listing .</strong> Utility routine to set a Calc document's active sheet.
</p>
<p>
    REM *******************************
</p>
<p>
    REM ** oDoc - Calc sheet on which to operate. No error checking is performed
</p>
<p>
    REM ** sSheetName - Sheet name to make active. The sheet is verified to exist.
</p>
<p>
    REM *******************************
</p>
<p>
    Sub set_active_sheet(oDoc, sSheetName)
</p>
<p>
    Dim oSheets
</p>
<p>
    oSheets = oDoc.Sheets
</p>
<p>
    If oSheets.hasByName(sSheetName) Then
</p>
<p>
    oDoc.currentController.setActiveSheet(oSheets.getByName(sSheetName))
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    An event is sent to the listener if the listener is being disposed. The text “print_listener_” prefixes the routines
    used to implement the listener.
</p>
<p>
    <strong>Listing .</strong> Print listener disposing method.
</p>
<p>
    REM *******************************
</p>
<p>
    REM ** The print job is disposing, so, remove it.
</p>
<p>
    REM *******************************
</p>
<p>
    Sub print_listener_disposing(oEvent)
</p>
<p>
    On Error Resume Next
</p>
<p>
    Dim emptyObj
</p>
<p>
    If NOT IsNull(oPrintJobListnerDoc) AND NOT IsEMpty(oPrintJobListnerDoc) Then
</p>
<p>
    oPrintJobListnerDoc.removePrintJobListener(oPrintListener)
</p>
<p>
    oPrintJobListnerDoc = emptyObj
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    The listener is called every time the print job changes state.
</p>
<p>
    <strong>Listing .</strong> Print listener status changed event.
</p>
<p>
    REM *******************************
</p>
<p>
    REM ** Called everytime the state of the print job changes.
</p>
<p>
    REM ** Error messages are printed if they occur.
</p>
<p>
    REM ** If the event announces an error or that the job is finished,
</p>
<p>
    REM ** the print job listener is removed and the "Input Data" sheet is set to active.
</p>
<p>
    REM *******************************
</p>
<p>
    Sub print_listener_printJobEvent(oPrintJobEvent)
</p>
<p>
    Dim bCleanup As Boolean ' Set to true if the listener should be removed.
</p>
<p>
    Dim sMessage$ ' If not empty, a message is printed.
</p>
<p>
    REM All supported event state changes are shown.
</p>
<p>
    Select Case oPrintJobEvent.State
</p>
<p>
    Case com.sun.star.view.PrintableState.JOB_STARTED
</p>
<p>
    ' Rendering the document to print.
</p>
<p>
    bCleanup = False
</p>
<p>
    Case com.sun.star.view.PrintableState.JOB_COMPLETED
</p>
<p>
    ' Rendering is finished, start spooling.
</p>
<p>
    bCleanup = False
</p>
<p>
    Case com.sun.star.view.PrintableState.JOB_SPOOLED
</p>
<p>
    ' Success!
</p>
<p>
    'sMessage = "Print job spooled to the printer."
</p>
<p>
    bCleanup = True
</p>
<p>
    Case com.sun.star.view.PrintableState.JOB_ABORTED
</p>
<p>
    sMessage = "Printing was aborted."
</p>
<p>
    bCleanup = True
</p>
<p>
    Case com.sun.star.view.PrintableState.JOB_FAILED
</p>
<p>
    sMessage = "Error printing."
</p>
<p>
    bCleanup = True
</p>
<p>
    Case com.sun.star.view.PrintableState.JOB_SPOOLING_FAILED
</p>
<p>
    sMessage = "Document failed to print or spool to the print."
</p>
<p>
    bCleanup = True
</p>
<p>
    Case Else
</p>
<p>
    sMessage = "Unknown unexpected print state."
</p>
<p>
    bCleanup = True
</p>
<p>
    End Select
</p>
<p>
    REM Remove the listener if printing is finished, then call a worker macro
</p>
<p>
    REM to set Sheet1 as active.
</p>
<p>
    If bCleanup AND NOT IsNull(oPrintJobListnerDoc) AND NOT IsEMpty(oPrintJobListnerDoc) Then
</p>
<p>
    On Error Resume Next
</p>
<p>
    Dim emptyObj
</p>
<p>
    oPrintJobListnerDoc.removePrintJobListener(oPrintListener)
</p>
<p>
    Call set_active_sheet(oPrintJobListnerDoc, "Sheet1")
</p>
<p>
    oPrintJobListnerDoc = emptyObj
</p>
<p>
    End If
</p>
<p>
    If sMessage &lt;&gt; "" Then
</p>
<p>
    MsgBox sMessage
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    If the sheet name exists, the desired sheet is set to be active, the print job listener is created and registered,
    and then document printing is requested.
</p>
<p>
    <strong>Listing .</strong> Print the specified sheet.
</p>
<p>
    Sub PrintSheet(oDoc, sSheetToPrint)
</p>
<p>
    Dim sPrefix$ ' Prefix used to identify the print listener routines.
</p>
<p>
    Dim sService$ ' Print listener service name.
</p>
<p>
    sPrefix = "print_listener_"
</p>
<p>
    sService = "com.sun.star.view.XPrintJobListener"
</p>
<p>
    If NOT oDoc.sheets().hasByName(sSheetToPrint) Then
</p>
<p>
    MsgBox "Document does not contain a sheet named " &amp; sSheetToPrint
</p>
<p>
    Exit sub
</p>
<p>
    End If
</p>
<p>
    Call set_active_sheet(oDoc, sSheetToPrint)
</p>
<p>
</p>
<p>
    oPrintListener = CreateUnoListener(sPrefix, sService)
</p>
<p>
    oDoc.addPrintJobListener(oPrintListener)
</p>
<p>
    oPrintJobListnerDoc = oDoc
</p>
<p>
    oDoc.Print(Array())
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="print-examples-by-vincent-van-houtte">
                            <span id="anchor-262"></span>Print examples by Vincent Van Houtte
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    I found some very nice examples by Vincent Van Houtte, that he has graciously allowed me to reproduce here. Some
    highlights of the contained macros:
</p>
<ul>
    <li>
        printDoc – Print a document with specific paper size, with specific paper trays, and with (or without) a page
        background image. Numerous stub methods are included to call this one routine. Note that the method directly
        specifies the destination printer.
    </li>
    <li>
        printPage – Same as printDoc, but prints a single page.
    </li>
    <li>
        closeDocument – Close the specified document.
    </li>
    <li>
        ExportAsPdfAndSendEmail – Export as a PDF document and send an email.
    </li>
</ul>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The very popular routine FindCreateNumberFormatStyle (see ) is used by .
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Print examples by Vincent Van Houtte.
</p>
<p>
    Sub PrintWithCopyStamp()
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro inserts a 'COPY'-stamp and prints the document
</p>
<p>
    ' without the background(-image) to tray1.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    REM Insert timestamp of sending
</p>
<p>
    Dim sActionText AS String
</p>
<p>
    sActionText = "KOPIE"
</p>
<p>
    InsertDTstamp(sActionText)
</p>
<p>
    REM Print the page
</p>
<p>
    PrintDocWithoutBgToTray1()
</p>
<p>
</p>
<p>
    REM Remove the copystamp-frame
</p>
<p>
    RemoveDTstamp()
</p>
<p>
    End Sub
</p>
<p>
    Sub InsertDTstamp(sActionText)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro inserts a 'DATE/TIME'-stamp with sActionText 'Printed' or 'Sent'
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM oCursor, oText, oDoc AS Object
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    oText = oDoc.getText()
</p>
<p>
    oCursor = oText.createTextCursor()
</p>
<p>
    oCursor.goToStart(FALSE)
</p>
<p>
    REM Create the date and time objects
</p>
<p>
    DIM oDate, oTime AS Object
</p>
<p>
    oDate = oDoc.createInstance("com.sun.star.text.TextField.DateTime")
</p>
<p>
    oDate.IsFixed = TRUE
</p>
<p>
    oDate.IsDate = TRUE
</p>
<p>
    oDate.NumberFormat = FindCreateNumberFormatStyle("D MMMM JJJJ", oDoc)
</p>
<p>
</p>
<p>
    oTime = oDoc.createInstance("com.sun.star.text.TextField.DateTime")
</p>
<p>
    oTime.IsFixed = True
</p>
<p>
    oTime.IsDate = False
</p>
<p>
    oTime.NumberFormat = FindCreateNumberFormatStyle("UU:MM", oDoc)
</p>
<p>
    REM Create the frame
</p>
<p>
    DIM oFrameDT AS Object
</p>
<p>
    oFrameDT = oDoc.createInstance("com.sun.star.text.TextFrame")
</p>
<p>
    With oFrameDT
</p>
<p>
    .setName("FrameDT")
</p>
<p>
    .AnchorType = com.sun.star.text.TextContentAnchorType.AT_PAGE
</p>
<p>
    .HoriOrient = com.sun.star.text.HoriOrientation.NONE
</p>
<p>
    .VertOrient = com.sun.star.text.VertOrientation.NONE
</p>
<p>
    .HoriOrientPosition = -4900
</p>
<p>
    .VertOrientPosition = -1600
</p>
<p>
    .width = 4000
</p>
<p>
    .height = 1500
</p>
<p>
    .BorderDistance = 100
</p>
<p>
    End With
</p>
<p>
    REM Insert the frame into the text document
</p>
<p>
    oText.insertTextContent( oCursor, oFrameDT, True )
</p>
<p>
    REM Write the text inside the frame
</p>
<p>
    DIM oCursor2 AS Object
</p>
<p>
    oCursor2 = oFrameDT.createTextCursor()
</p>
<p>
    With oCursor2
</p>
<p>
    .charHeight = 16
</p>
<p>
    .charWeight = com.sun.star.awt.FontWeight.BOLD
</p>
<p>
    .paraAdjust = com.sun.star.style.ParagraphAdjust.CENTER
</p>
<p>
    End With
</p>
<p>
    oFrameDT.insertString( oCursor2, sActionText, False )
</p>
<p>
    With oCursor2
</p>
<p>
    .charHeight = 9
</p>
<p>
    .charWeight = com.sun.star.awt.FontWeight.NORMAL
</p>
<p>
    .paraAdjust = com.sun.star.style.ParagraphAdjust.CENTER
</p>
<p>
    End With
</p>
<p>
    oFrameDT.insertControlCharacter( oCursor2, com.sun.star.text.ControlCharacter.PARAGRAPH_BREAK, False )
</p>
<p>
    oFrameDT.insertTextContent( oCursor2, oDate, False )
</p>
<p>
    oFrameDT.insertControlCharacter( oCursor2, com.sun.star.text.ControlCharacter.LINE_BREAK, False )
</p>
<p>
    oFrameDT.insertTextContent( oCursor2, oTime, False )
</p>
<p>
    End Sub
</p>
<p>
    Sub RemoveDTstamp()
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro removes the 'DATE/TIME'-stamp created with the previous macro
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM oDoc, oTextFrames, oFrameDT AS Object
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    REM Look for the datetimestamp-frame and remove it
</p>
<p>
    oTextFrames = oDoc.getTextFrames
</p>
<p>
    If oTextFrames.hasByName("FrameDT") Then
</p>
<p>
    oFrameDT = oTextFrames.getByName("FrameDT")
</p>
<p>
    oFrameDT.dispose()
</p>
<p>
    EndIf
</p>
<p>
    End Sub
</p>
<p>
    Sub PrintDocWithBgToTray1
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the document with the background(-image) to the
</p>
<p>
    ' first papertray. This is only used to save on stationary, if you
</p>
<p>
    ' have run out on stationary or if the second printertray is jammed ;)
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM sTray1 AS String
</p>
<p>
    DIM sTray2 AS String
</p>
<p>
    DIM bBg1 AS Boolean
</p>
<p>
    DIM bBg2 AS Boolean
</p>
<p>
    DIM wait AS Boolean
</p>
<p>
    sTray1 = "Tray1"
</p>
<p>
    sTray2 = "Tray1"
</p>
<p>
    bBg1 = True
</p>
<p>
    bBg2 = False
</p>
<p>
    wait = True
</p>
<p>
    printDoc(sTray1, sTray2, bBg1, bBg2, wait)
</p>
<p>
    End Sub
</p>
<p>
    Sub PrintDocWithoutBgToTray1
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the document without the background(-image) to the
</p>
<p>
    ' first papertray. This is useful for copies of the letters you sent out.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM sTray1 AS String
</p>
<p>
    DIM sTray2 AS String
</p>
<p>
    DIM bBg1 AS Boolean
</p>
<p>
    DIM bBg2 AS Boolean
</p>
<p>
    DIM wait AS Boolean
</p>
<p>
    sTray1 = "Tray1"
</p>
<p>
    sTray2 = "Tray1"
</p>
<p>
    bBg1 = False
</p>
<p>
    bBg2 = False
</p>
<p>
    wait = True
</p>
<p>
    printDoc(sTray1, sTray2, bBg1, bBg2, wait)
</p>
<p>
    End Sub
</p>
<p>
    Sub PrintDocWithoutBgToTray2_old
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the document without the background(-image) to the
</p>
<p>
    ' second papertray. This is useful when you have pre-printed stationary:
</p>
<p>
    ' you can set an image as a background, that you don't want to print,
</p>
<p>
    ' but that you want to show up when converted to PDF.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM sTray1 AS String
</p>
<p>
    DIM sTray2 AS String
</p>
<p>
    DIM bBg1 AS Boolean
</p>
<p>
    DIM bBg2 AS Boolean
</p>
<p>
    DIM wait AS Boolean
</p>
<p>
    sTray1 = "Tray2"
</p>
<p>
    sTray2 = "Tray1"
</p>
<p>
    bBg1 = False
</p>
<p>
    bBg2 = False
</p>
<p>
    wait = True
</p>
<p>
    printDoc(sTray1, sTray2, bBg1, bBg2, wait)
</p>
<p>
    End Sub
</p>
<p>
    Sub PrintDocWithoutBgToTray2
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the first page (without the backgroundimage) to the
</p>
<p>
    ' second papertray and all other pages (without the backgroundimage) to the
</p>
<p>
    ' first papertray.
</p>
<p>
    ' This is useful when you have pre-printed stationary, but want to save on it
</p>
<p>
    ' by only printing the first page on expensive stationary
</p>
<p>
    ' you can set an image as a background, that you don't want to print,
</p>
<p>
    ' but that you want to show up when converted to PDF.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM oDoc AS Object
</p>
<p>
    DIM iPageCount, n AS Integer
</p>
<p>
    DIM sPage AS String
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    REM Count the amount of pages
</p>
<p>
    iPageCount = oDoc.getCurrentController().getPropertyValue("PageCount")
</p>
<p>
    REM Loop over every page
</p>
<p>
    n = 1
</p>
<p>
    Do Until n &gt; iPageCount
</p>
<p>
</p>
<p>
    REM Print every page to the right tray
</p>
<p>
    If n = 1 Then
</p>
<p>
    Print_stat(n)
</p>
<p>
    Else
</p>
<p>
    Print_plain(n)
</p>
<p>
    End If
</p>
<p>
    n = n + 1
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<p>
    Sub Print_stat(sPageNr AS String)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the first page without the background(-image) to the
</p>
<p>
    ' second papertray. This is useful when you have pre-printed stationary:
</p>
<p>
    ' you can set an image as a background, that you don't want to print,
</p>
<p>
    ' but that you want to show up when converted to PDF.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM sTray1 AS String
</p>
<p>
    DIM sTray2 AS String
</p>
<p>
    DIM bBg1 AS Boolean
</p>
<p>
    DIM bBg2 AS Boolean
</p>
<p>
    DIM wait AS Boolean
</p>
<p>
    sTray1 = "Tray2"
</p>
<p>
    sTray2 = "Tray1"
</p>
<p>
    bBg1 = False
</p>
<p>
    bBg2 = False
</p>
<p>
    wait = True
</p>
<p>
    printPage(sTray1, sTray2, bBg1, bBg2, wait, sPageNr)
</p>
<p>
    End Sub
</p>
<p>
    Sub Print_plain(sPageNr AS String)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the next page without the background(-image) to the
</p>
<p>
    ' first papertray. This is useful when you want to saveon your pre-printed stationary:
</p>
<p>
    ' you can set an image as a background, that you don't want to print,
</p>
<p>
    ' but that you want to show up when converted to PDF.
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM sTray1 AS String
</p>
<p>
    DIM sTray2 AS String
</p>
<p>
    DIM bBg1 AS Boolean
</p>
<p>
    DIM bBg2 AS Boolean
</p>
<p>
    DIM wait AS Boolean
</p>
<p>
    sTray1 = "Tray1"
</p>
<p>
    sTray2 = "Tray1"
</p>
<p>
    bBg1 = False
</p>
<p>
    bBg2 = False
</p>
<p>
    wait = True
</p>
<p>
    printPage(sTray1, sTray2, bBg1, bBg2, wait, sPageNr)
</p>
<p>
    End Sub
</p>
<p>
    Sub printDoc(sTray1, sTray2, bBg1, bBg2, wait)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the document given the chosen arguments
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM oDoc AS Object
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    REM Set backgroundImage-option in DocumentSettings to False
</p>
<p>
    DIM oSettings AS Object
</p>
<p>
    oSettings = oDoc.createInstance("com.sun.star.text.DocumentSettings")
</p>
<p>
    oSettings.PrintPageBackground = bBg1
</p>
<p>
    REM choose a certain printer
</p>
<p>
    DIM mPrinterOpts(2) AS NEW com.sun.star.beans.PropertyValue
</p>
<p>
    mPrinterOpts(0).Name = "Name"
</p>
<p>
    mPrinterOpts(0).Value = "MFC8880DN"
</p>
<p>
    mPrinterOpts(1).Name = "PaperFormat"
</p>
<p>
    mPrinterOpts(1).Value = com.sun.star.view.PaperFormat.A4
</p>
<p>
    mPrinterOpts(2).Name = "PaperOrientation"
</p>
<p>
    mPrinterOpts(2).Value = com.sun.star.view.PaperOrientation.PORTRAIT
</p>
<p>
    oDoc.Printer = mPrinterOpts()
</p>
<p>
    REM set Papertray in Styles
</p>
<p>
    DIM oStyle AS Object
</p>
<p>
    DIM sPageStyle AS String
</p>
<p>
    sPageStyle = oDoc.CurrentController.getViewCursor().PageStyleName
</p>
<p>
    ostyle = oDoc.StyleFamilies.getByName("PageStyles").getByName(sPageStyle)
</p>
<p>
    oStyle.PrinterPaperTray = sTray1
</p>
<p>
    REM Set printOptions
</p>
<p>
    DIM mPrintOpts(2) AS NEW com.sun.star.beans.PropertyValue
</p>
<p>
    mPrintOpts(0).Name = "CopyCount"
</p>
<p>
    mPrintOpts(0).Value = 1
</p>
<p>
    mPrintOpts(1).Name = "Collate"
</p>
<p>
    mPrintOpts(1).Value = True
</p>
<p>
    mPrintOpts(2).Name = "Wait"
</p>
<p>
    mPrintOpts(2).Value = True
</p>
<p>
    REM Print
</p>
<p>
    oDoc.Print(mPrintOpts())
</p>
<p>
    REM RESET OPTIONS
</p>
<p>
    REM Reset backgroundImage-option in DocumentSettings
</p>
<p>
    oSettings.PrintPageBackground = bBg2
</p>
<p>
    REM Reset Papertray in Styles
</p>
<p>
    oStyle.PrinterPaperTray = sTray2
</p>
<p>
    REM Do a 0-print to complete the reset
</p>
<p>
    DIM mPrintOpts2(0) AS NEW com.sun.star.beans.PropertyValue
</p>
<p>
    mPrintOpts2(0).Name = "CopyCount"
</p>
<p>
    mPrintOpts2(0).Value = 0
</p>
<p>
    oDoc.Print(mPrintOpts2())
</p>
<p>
    End Sub
</p>
<p>
    Sub printPage(sTray1, sTray2, bBg1, bBg2, wait, sPageNr)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro prints the document given the chosen arguments
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM oDoc AS Object
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    REM Set backgroundImage-option in DocumentSettings to False
</p>
<p>
    DIM oSettings AS Object
</p>
<p>
    oSettings = oDoc.createInstance("com.sun.star.text.DocumentSettings")
</p>
<p>
    oSettings.PrintPageBackground = bBg1
</p>
<p>
    REM choose a certain printer
</p>
<p>
    DIM mPrinterOpts(3) AS NEW com.sun.star.beans.PropertyValue
</p>
<p>
    mPrinterOpts(0).Name = "Name"
</p>
<p>
    mPrinterOpts(0).Value = "MFC8880DN"
</p>
<p>
    mPrinterOpts(1).Name = "PaperFormat"
</p>
<p>
    mPrinterOpts(1).Value = com.sun.star.view.PaperFormat.A4
</p>
<p>
    mPrinterOpts(2).Name = "PaperOrientation"
</p>
<p>
    mPrinterOpts(2).Value = com.sun.star.view.PaperOrientation.PORTRAIT
</p>
<p>
    oDoc.Printer = mPrinterOpts()
</p>
<p>
    REM set Papertray in Styles
</p>
<p>
    DIM oStyle AS Object
</p>
<p>
    DIM sPageStyle AS String
</p>
<p>
    sPageStyle = oDoc.CurrentController.getViewCursor().PageStyleName
</p>
<p>
    ostyle = oDoc.StyleFamilies.getByName("PageStyles").getByName(sPageStyle)
</p>
<p>
    oStyle.PrinterPaperTray = sTray1
</p>
<p>
    REM Set printOptions
</p>
<p>
    DIM mPrintOpts(3) AS NEW com.sun.star.beans.PropertyValue
</p>
<p>
    mPrintOpts(0).Name = "CopyCount"
</p>
<p>
    mPrintOpts(0).Value = 1
</p>
<p>
    mPrintOpts(1).Name = "Collate"
</p>
<p>
    mPrintOpts(1).Value = True
</p>
<p>
    mPrintOpts(2).Name = "Pages"
</p>
<p>
    mPrintOpts(2).Value = sPageNr
</p>
<p>
    mPrintOpts(3).Name = "Wait"
</p>
<p>
    mPrintOpts(3).Value = True
</p>
<p>
    REM Print
</p>
<p>
    oDoc.Print(mPrintOpts())
</p>
<p>
    REM RESET OPTIONS
</p>
<p>
    REM Reset backgroundImage-option in DocumentSettings
</p>
<p>
    oSettings.PrintPageBackground = bBg2
</p>
<p>
    REM Reset Papertray in Styles
</p>
<p>
    oStyle.PrinterPaperTray = sTray2
</p>
<p>
    REM Do a 0-print to complete the reset
</p>
<p>
    DIM mPrintOpts2(0) AS NEW com.sun.star.beans.PropertyValue
</p>
<p>
    mPrintOpts2(0).Name = "CopyCount"
</p>
<p>
    mPrintOpts2(0).Value = 0
</p>
<p>
    oDoc.Print(mPrintOpts2())
</p>
<p>
    End Sub
</p>
<p>
    Sub closeDocument(oDoc AS Object)
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro closes the current document
</p>
<p>
    '
</p>
<p>
    ' Written by Andrew Pitonyak (2010)
</p>
<p>
    ' Adapted by Vincent Van Houtte (2011)
</p>
<p>
    ' ------------------------------
</p>
<p>
    REM Check if the document exists
</p>
<p>
    If IsNull(oDoc) Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    REM Store the document if it was modified
</p>
<p>
    If (oDoc.isModified) Then
</p>
<p>
    If (oDoc.hasLocation AND (Not oDoc.isReadOnly)) Then
</p>
<p>
    oDoc.store()
</p>
<p>
    Else
</p>
<p>
    oDoc.setModified(False)
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM Close the document
</p>
<p>
    oDoc.close(true)
</p>
<p>
    End Sub
</p>
<p>
    Sub ExportAsPdfAndSendEmail
</p>
<p>
    ' ------------------------------
</p>
<p>
    ' This macro converts the active document to PDF and then adds the PDF
</p>
<p>
    ' to a new emailmessage. The recipientaddress and subject are
</p>
<p>
    ' generated automagically from a textfield inside the document
</p>
<p>
    '
</p>
<p>
    ' This macro assumes the default email application is set
</p>
<p>
    ' in Tools -&gt; Options -&gt; OpenOffice.org -&gt; External Programs.
</p>
<p>
    '
</p>
<p>
    ' This macro uses SimpleCommandMail, which might not work in windows
</p>
<p>
    ' Try SimpleSystemMail instead
</p>
<p>
    '
</p>
<p>
    ' Written by Vincent Van Houtte (2010)
</p>
<p>
    ' ------------------------------
</p>
<p>
    DIM oDoc, MailClient, MailAgent, MailMessage AS Object
</p>
<p>
    DIM sDocURL, sPDFURL, sTo, sSubject AS String
</p>
<p>
    REM Get location of the doc
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    If (Not oDoc.hasLocation()) Then
</p>
<p>
    oDoc.store()
</p>
<p>
    End if
</p>
<p>
    REM Insert timestamp of sending
</p>
<p>
    Dim sActionText AS String
</p>
<p>
    sActionText = "VERZONDEN"
</p>
<p>
    InsertDTstamp(sActionText)
</p>
<p>
    REM Print the page
</p>
<p>
    PrintDocWithoutBgToTray1()
</p>
<p>
    REM Replace .odt with .pdf
</p>
<p>
    sDocURL = oDoc.getURL()
</p>
<p>
    sPDFURL = Left$(sDocURL,Len(sDocURL)-4) + ".pdf"
</p>
<p>
    REM Save as PDF
</p>
<p>
    DIM args(0) AS NEW com.sun.star.beans.PropertyValue
</p>
<p>
    args(0).Name = "FilterName"
</p>
<p>
    args(0).Value = "writer_pdf_Export"
</p>
<p>
    oDoc.storeToURL(sPDFURL,args())
</p>
<p>
    REM Remove the Date/time-stamp
</p>
<p>
    RemoveDTstamp()
</p>
<p>
    REM Get the values of the textfields inside the document to form the subject line
</p>
<p>
    DIM enuTF, aTextField AS Object
</p>
<p>
    DIM sDosName, sDosNum, sDosUref AS String
</p>
<p>
    enuTF = oDoc.TextFields.createEnumeration
</p>
<p>
    Do While enuTF.hasMoreElements
</p>
<p>
    aTextField = enuTF.nextElement
</p>
<p>
    if aTextField.supportsService("com.sun.star.text.TextField.Input") then
</p>
<p>
    Select Case aTextField.getPropertyValue("Hint")
</p>
<p>
    Case "DOS_NAAM":
</p>
<p>
    sDosName = aTextField.getPropertyValue("Content")
</p>
<p>
    Case "DOS_NUM":
</p>
<p>
    sDosNum = aTextField.getPropertyValue("Content")
</p>
<p>
    Case "REF_O":
</p>
<p>
    sDosNum = aTextField.getPropertyValue("Content")
</p>
<p>
    Case "UREF":
</p>
<p>
    sDosUref = aTextField.getPropertyValue("Content")
</p>
<p>
    Case "EMAIL_ADDR":
</p>
<p>
    sTo = aTextField.getPropertyValue("Content")
</p>
<p>
    End Select
</p>
<p>
    end if
</p>
<p>
    Loop
</p>
<p>
    sSubject = sDosName + " - " + sDosUref + " - " + sDosNum
</p>
<p>
    REM Send the PDF as an attachment
</p>
<p>
    MailAgent = CreateUnoService("com.sun.star.system.SimpleCommandMail")
</p>
<p>
    MailClient = MailAgent.querySimpleMailClient()
</p>
<p>
    MailMessage=MailClient.createSimpleMailMessage()
</p>
<p>
    MailMessage.setRecipient(sTo)
</p>
<p>
    MailMessage.setSubject(sSubject)
</p>
<p>
    MailMessage.setAttachement(array(sPDFURL))
</p>
<p>
    MailClient.sendSimpleMailMessage(MailMessage, 0)
</p>
<p>
    REM Save and close the document
</p>
<p>
    closeDocument(oDoc)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="creating-services">
                    <span id="anchor-263"></span>Creating services
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    An object that supports the XMultiServiceFactory interface may create services. An object is usually created by the
    object that will own it. As an example, a text table is created by the text document that will contain the text
    table. Similarly, the DocumentSettings object is created by the document of interest. The function CreateUnoService
    creates services in the scope of the OOo application.
</p>
<p>
    The oSettings object in supports the service com.sun.star.text.DocumentSettings. The oSettings object is related to
    ThisComponent in that it reflects the settings for ThisComponent — the current document — but not for any other
    document.
</p>
<p>
    <strong>Listing .</strong> Create an object that supports the DocumentSettings service.
</p>
<p>
    oSettings=ThisComponent.createInstance("com.sun.star.text.DocumentSettings")
</p>
<p>
    The createInstance() method returns an object that supports the requested service if it can; if it cannot, it
    returns NULL. The returned object may support other services as well (see and ).
</p>
<p>
    <strong>Listing .</strong> Inspect a text document settings object.
</p>
<p>
    Sub WriteDocumentSettings
</p>
<p>
    Dim oSettings 'Settings object to create
</p>
<p>
    Dim s$ 'Utility string
</p>
<p>
    Dim i% 'Uitlity index variable
</p>
<p>
    Dim v 'This will contain an array of service names
</p>
<p>
    REM Create an object that supports the DocumentSettings service
</p>
<p>
    oSettings=ThisComponent.createInstance("com.sun.star.text.DocumentSettings")
</p>
<p>
    v = oSettings.getSupportedServiceNames()
</p>
<p>
    s = "**** Specified Supported Services ****" &amp; CHR$(10) &amp; Join(v, CHR$(10))
</p>
<p>
    s = s &amp; CHR$(10) &amp; CHR$(10) &amp; "**** Tested Services ****" &amp; CHR$(10)
</p>
<p>
</p>
<p>
    REM Now check to see if this created object supports any other services.
</p>
<p>
    v = Array("com.sun.star.comp.Writer.DocumentSettings",_
</p>
<p>
    "com.sun.star.text.PrintSettings")
</p>
<p>
</p>
<p>
    For i = 0 To UBound(v)
</p>
<p>
    If oSettings.supportsService(v(i)) Then
</p>
<p>
    s = s &amp; "Supports service " &amp; v(i) &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Some services for " &amp; oSettings.getImplementationName()
</p>
<p>
</p>
<p>
    REM What is the status of the PrintControls property?
</p>
<p>
    Print oSettings.PrintControls
</p>
<p>
</p>
<p>
    REM I could set this to True or False
</p>
<p>
    'oSettings.Printcontrols = True
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001EA000000CCF4E911EF.png" style="width:5.1043in;height:2.1252in" />
</p>
<p>
    <strong>Figure .</strong> Some Writer document settings.
</p>
<p>
    A careful inspection of and demonstrate that the object supports multiple services.
</p>
<p>
    The method getSupportedServiceNames() lists the services supported by the object.
</p>
<p>
    The method getImplementationName() returns the service that uniquely identifies the returned service
    (com.sun.star.comp.Writer.DocumentSettings). The unique service name is not in the list of supported service names.
</p>
<p>
    Although not shown in , the two “Tested Services” in cannot be created using the createInstance() object method. I
    discovered the PrintSettings service entirely by accident. I inspected the dbg_properties property, which contained
    PrintControls. I then searched Google for “site:api.openoffice.org PrintSettings”. The important things to notice
    are as follows:
</p>
<ol type="1">
    <li>
        There are different methods of inspecting an object; use all of them.
    </li>
    <li>
        The documentation is not complete. You must manually inspect an object to see what it supports. However,
        undocumented methods and properties may be deprecated and removed later — so do this carefully.
    </li>
    <li>
        You can search the Internet for services and properties.
    </li>
</ol>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="document-settings">
                    <span id="anchor-264"></span>Document settings
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo contains numerous document options; these are available in the Tools | Options dialog. For example, Text
    Document contains a Print tab, which allows graphics to be printed, or not. The typical method for modifying
    properties in a document involves using either “get” and “set” methods, or directly accessing object properties. To
    access advanced document settings, however, you must use a completely different method. First the document has to
    create an object that supports the document settings. Every document type, except for the Math type, has the ability
    to create a service using the createInstance() method. contains a list of the properties common to all of the
    document setting types; there are more.
</p>
<p>
    Table 119. Common document properties in com.sun.star.document.Settings.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                ForbiddenCharacters
            </td>
            <td>
                Allow access to otherwise forbidden characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                LinkUpdateMode
            </td>
            <td>
                The update mode for links when loading text documents.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrinterName
            </td>
            <td>
                Printer used by the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrinterSetup
            </td>
            <td>
                Platform- and driver-dependent printer setup data.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsKernAsianPunctuation
            </td>
            <td>
                Is kerning applied to Asian punctuation?
            </td>
        </tr>
        <tr class="even">
            <td>
                CharacterCompressionType
            </td>
            <td>
                Compression (character spacing) used for Asian characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ApplyUserData
            </td>
            <td>
                Should user-specific settings saved in a document be loaded again?
            </td>
        </tr>
        <tr class="even">
            <td>
                SaveVersionOnClose
            </td>
            <td>
                Is a new version created when a modified document is closed?
            </td>
        </tr>
        <tr class="odd">
            <td>
                UpdateFromTemplate
            </td>
            <td>
                Should a document be updated when its creation template changes?
            </td>
        </tr>
        <tr class="even">
            <td>
                FieldAutoUpdate
            </td>
            <td>
                Are text document fields automatically updated?
            </td>
        </tr>
        <tr class="odd">
            <td>
                CurrentDatabaseDataSource
            </td>
            <td>
                Name of the data source from which the current data is taken.
            </td>
        </tr>
        <tr class="even">
            <td>
                CurrentDatabaseCommand
            </td>
            <td>
                Displayed object’s name (or the SQL statement used).
            </td>
        </tr>
        <tr class="odd">
            <td>
                CurrentDatabaseCommandType
            </td>
            <td>
                Specifies how to interpret the DataTableName property.
            </td>
        </tr>
        <tr class="even">
            <td>
                DefaultTabStop
            </td>
            <td>
                Default tab width.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsPrintBooklet
            </td>
            <td>
                Is the document printed as a booklet (brochure)?
            </td>
        </tr>
        <tr class="even">
            <td>
                IsPrintBookletFront
            </td>
            <td>
                If True, only the front pages of a booklet are printed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsPrintBookletBack
            </td>
            <td>
                If True, only the back pages of a booklet are printed.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintQuality
            </td>
            <td>
                Quality to use when printing.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ColorTableURL
            </td>
            <td>
                URL of the color table (SOC file) showing a palette in dialogs that use colors.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrinterIndependentLayout
            </td>
            <td>
                If true, do not use printer metrics for layout.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Specific document settings services exist for Writer, Calc, Draw, and Impress documents (see ). Although each of
    these services implements the Settings service as shown in , all of the properties except for PrinterName and
    PrinterSetup are optional.
</p>
<p>
    Table 120. Specific document settings service types.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.text.DocumentSettings
            </td>
            <td>
                Writer
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.DocumentSettings
            </td>
            <td>
                Calc
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.drawing.DocumentSettings
            </td>
            <td>
                Draw
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.presentation.DocumentSettings
            </td>
            <td>
                Impress
            </td>
        </tr>
    </tbody>
</table>
<p>
    As shown in and , the Writer document settings support the PrintSettings service (see ). The Draw and Impress
    document settings services each contain special settings that apply only to their respective document types.
</p>
<p>
    Table 121. Properties defined by the com.sun.star.text.PrintSettings service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                PrintGraphics
            </td>
            <td>
                If True, print graphic object.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintTables
            </td>
            <td>
                If True, print text tables.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintDrawings
            </td>
            <td>
                If True, print shapes.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintLeftPages
            </td>
            <td>
                If True, print left pages.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintRightPages
            </td>
            <td>
                If True, print right pages.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintControls
            </td>
            <td>
                If True, print control contained in the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintReversed
            </td>
            <td>
                If True, print the pages in reverse order, starting with the last page.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintPaperFromSetup
            </td>
            <td>
                If True, use the paper tray specified for the system printer. If False, use the paper tray specified by
                the page style.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintFaxName
            </td>
            <td>
                Name of the fax.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintAnnotationMode
            </td>
            <td>
                Specify how notes are printed. Uses com.sun.star.text.NotePrintMode enumerated value. Possible values
                include NOT, ONLY, DOC_END, or PAGE_END.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintProspect
            </td>
            <td>
                If True, prospect printing is used; however, I cannot find a definition for prospect printing.
            </td>
        </tr>
        <tr class="even">
            <td>
                PrintPageBackground
            </td>
            <td>
                If True, the background color and/or background graphic is printed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrintBlackFonts
            </td>
            <td>
                If True, characters are always printed in black.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="the-coolest-trick-i-know">
                    <span id="anchor-265"></span>The coolest trick I know
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Sadly, this only works in LibreOffice, and not in OOo. While editing a document:
</p>
<ol type="1">
    <li>
        Use File &gt; Open to open the Open dialog.
    </li>
    <li>
        Enter “vnd.sun.star.tdoc:/” for the file name and click Open.
    </li>
    <li>
        Currently open documents are shown for selection. Select a document; and click open.
    </li>
</ol>
<p>
    You are looking at the document's internal structures. You can even open an image embedded in a document. A document
    containing pictures is a good example to try.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="converting-to-a-url-in-other-languages">
                    <span id="anchor-266"></span>Converting to a URL in other languages
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Basic provides the methods ConvertToURL and ConvertFromURL, other languages do not. Some URI schemes leave
    unspecified important aspects of how to interpret URIs of those schemes. For example, it is unspecified for “file”
    URLs how to map the byte sequences that constitute the path segments of a “file” URL to filenames on a given
    platform: The UNO environment always assumes that path segments of “file” URLs represent UTF-8–encoded strings
    (which have to be mapped to filenames in a platform-specific way), while other applications typically assume that
    path segments of “file” URLs directly represent a platform's byte-sequence filenames. The
    ExternalUriReferenceTranslator offers methods to translate between such internal URIs (e.g., UTF-8–encoded “file”
    URLs used within the UNO environment) and external URIs (e.g., byte-sequence–oriented “file” URLs used by other
    applications). Typically, only “file” URLs are affected by this translation.
</p>
<p>
    x = CreateUnoService("com.sun.star.uri.ExternalUriReferenceTranslator")
</p>
<p>
    Print x.translateToExternal("file:///c:/MyDoc.oot")
</p>
<p>
    Print x.translateToInternal("file:/c:/MyDoc.oot")
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-11">
                    <span id="anchor-267"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The interfaces and services introduced in this chapter provide a good introduction to the capabilities of OOo that
    are not directly related to a specific document type. OOo contains numerous other capabilities that I could have
    included in this chapter, but it isn’t possible to exhaustively cover every subject. Use these topics and methods as
    a starting point to investigate the other capabilities of OpenOffice.org.
</p>
<ol type="1">
    <li>
        <h1 id="writer-documents">
            <span id="anchor-268"></span>Writer Documents
        </h1>
    </li>
</ol>
<p>
    Writer documents primarily deal with text content arranged in paragraphs. This chapter introduces appropriate
    methods to manipulate, traverse, search, format, and modify the content contained in an OpenOffice.org Writer
    document. First, a bit of review that is applicable to most document types.
</p>
<p>
    Conceptually, all document types have two components: the data they contain and the controller that determines how
    the data is displayed. Writer documents primarily contain simple formatted text. In addition to simple text, Writer
    documents may contain other content such as tables, frames, graphics, text fields, bookmarks, footnotes, endnotes,
    text sections, index entries, tracked document changes (called redlining), objects for styling, and objects for
    numbering. OOo uses the same methods and interfaces to interact with most of these capabilities. Consequently,
    learning to manipulate a few types of content will give you a solid basis for dealing with all of them.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                In OOo, the data contained in a document is called the “model.” The base model interface is
                com.sun.star.frame.XModel.
            </td>
        </tr>
    </tbody>
</table>
<p>
    In OpenOffice.org, the data contained in a document is called the model. Each model has a controller that is
    responsible for the visual presentation of the data. The controller knows the location of the visible text cursor,
    the current page, and what is currently selected.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                While trying to determine which portion of the OOo API to use to solve a specific problem, first ask if
                the problem is display-centric or data-centric. For example, a paragraph boundary is specified in the
                data, but a new line is usually determined by the controller when the data is formatted.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Every text document supports the com.sun.star.text.TextDocument service. When I write a macro that must be user
    friendly and requires a text document, I verify that the document is the correct type by using the object method
    supportsService (see ).
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Text documents support the
    com.sun.star.text.TextDocument service.
</p>
<p>
    REM If it really matters, you should check the document type
</p>
<p>
    REM to avoid a run-time error.
</p>
<p>
    If NOT ThisComponent.supportsService("com.sun.star.text.TextDocument") Then
</p>
<p>
    MsgBox "The current document is not a Writer text document", 48, "Error"
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    An interface defines a series of methods. If an object implements an interface, it also implements every method
    defined by that interface. A service defines an object by specifying the interfaces that it implements, the
    properties that it contains, and the other services that it exports. A service indirectly specifies the implemented
    methods by specifying interfaces. The interfaces supported by the TextDocument service provide a good overview of
    the provided functionality (see).
</p>
<p>
    <strong>Table . </strong>Interfaces supported by text documents.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.text.XTextDocument
            </td>
            <td>
                Main text document interface.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XBookmarksSupplier
            </td>
            <td>
                Access the bookmarks.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.text.XChapterNumberingSupplier
            </td>
            <td>
                Numbering rules for chapters.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XDocumentIndexesSupplier
            </td>
            <td>
                Access the collection of indexes.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.text.XTextEmbeddedObjectsSupplier
            </td>
            <td>
                Access embedded objects.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XEndnotesSupplier
            </td>
            <td>
                Access endnote content.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.text.XFootnotesSupplier
            </td>
            <td>
                Access footnote content.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XLineNumberingSupplier
            </td>
            <td>
                Numbering rules for line numbers.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.text.XPagePrintable
            </td>
            <td>
                Print multiple pages on one page.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XReferenceMarksSupplier
            </td>
            <td>
                Access the document reference marks, which are used to refer to text positions in a text document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.text.XTextFieldsSupplier
            </td>
            <td>
                Access contained fields.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XTextFramesSupplier
            </td>
            <td>
                Access contained text frames.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.text.XTextGraphicObjectsSupplier
            </td>
            <td>
                Access embedded and linked graphics.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XTextSectionsSupplier
            </td>
            <td>
                Access contained text sections.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.text.XTextTablesSupplier
            </td>
            <td>
                Access contained tables.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.style.XStyleFamiliesSupplier
            </td>
            <td>
                Access contained styles by type.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.util.XNumberFormatsSupplier
            </td>
            <td>
                Access contained number formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.util.XRefreshable
            </td>
            <td>
                Refresh data that can be refreshed from a database.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.util.XReplaceable
            </td>
            <td>
                Replace text found with a search descriptor.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.util.XSearchable
            </td>
            <td>
                Search a text range for a specific string pattern.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.beans.XPropertySet
            </td>
            <td>
                Access document properties by name.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="basic-building-blocks">
                    <span id="anchor-269"></span>Basic building blocks
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    While dealing with Writer documents, you’ll see that a few simple interfaces and concepts recur. These basic
    building blocks are interrelated in that their respective interfaces are circularly defined (they refer to each
    other). Fortunately, the concepts are intuitive and therefore easy to grasp, even with a brief introduction. This
    section briefly introduces these basic building blocks, laying the groundwork for detailed coverage later.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="primary-text-content-the-xtext-interface">
                            <span id="anchor-270"></span>Primary text content: the XText interface
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Text content is contained in an object that implements the XText interface. The primary purpose of a text object is
    to contain text content, create text cursors to move through text, insert text, and remove text (see
    <strong></strong>).
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.text.XText interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                createTextCursor()
            </td>
            <td>
                Return a TextCursor service used to traverse the text object.
            </td>
        </tr>
        <tr class="even">
            <td>
                createTextCursorByRange(XTextRange)
            </td>
            <td>
                Return a TextCursor that is located at the specified TextRange.
            </td>
        </tr>
        <tr class="odd">
            <td>
                insertString(XTextRange, String, boolean)
            </td>
            <td>
                Insert a string of characters into the text at the specified text range. Each CR (ASCII 13) inserts a
                new paragraph and each LF (ASCII 10) inserts a new line. If the Boolean value is True, the text in the
                range is overwritten; otherwise, the text characters are inserted after the text range.
            </td>
        </tr>
        <tr class="even">
            <td>
                insertControlCharacter(XTextRange, Short, boolean)
            </td>
            <td>
                Insert a control character (such as a paragraph break or a hard space) into the text. The short integer
                is a value from the constant group com.sun.star.text.ControlCharacter:
            </td>
        </tr>
        <tr class="odd">
            <td>
                insertTextContent(XTextRange, XTextContent, boolean)
            </td>
            <td>
                Insert text content such as a text table, text frame, or text field. In general, the text content should
                be created by the text object. If the Boolean value is True, the text in the text range is overwritten;
                otherwise, the text content is inserted after the text range.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeTextContent(XTextContent)
            </td>
            <td>
                Remove the specified text content from the text object.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Because the XText interface is derived from the XTextRange interface, all objects that implement the XText interface
    also support the object methods defined by the XTextRange interface (see ).
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="text-ranges-the-xtextrange-interface">
                            <span id="anchor-271"></span>Text ranges: the XTextRange interface
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A text range is one of the most important concepts in a text document because so many interfaces derive from the
    XTextRange interface. The primary purpose of a text range is to define a start and end position in the text (see ).
    It is possible that the start position and the end position in a text range are the same. When the start and end
    positions are the same, the text range identifies a position in the text<em><em>—</em></em>for example, the cursor
    in a text document when no text is selected. If the start and end positions of a text range are not the same, they
    represent a section of text.
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.text.XTextRange interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getText()
            </td>
            <td>
                Return the XText interface that contains the text range.
            </td>
        </tr>
        <tr class="even">
            <td>
                getStart()
            </td>
            <td>
                A text range has a start and end position. The getStart() method returns a text range that contains only
                the start position of this text range.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getEnd()
            </td>
            <td>
                A text range has a start and end position. The getStart() method returns a text range that contains only
                the end position of this text range.
            </td>
        </tr>
        <tr class="even">
            <td>
                setString(String)
            </td>
            <td>
                A text range has a start and end position. The setString() method replaces all of the text between the
                start and end positions with the argument string. All styles are removed and all text in this text range
                is replaced.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getString()
            </td>
            <td>
                Return a string that represents the text in this text range. Strings in OOo Basic are limited to 64KB in
                size, but text ranges and text objects are not; use this with care.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Every XTextRange object is associated with a text object. It can be said that an XTextRange object is contained in
    an object that implements the XText interface. The XText interface is itself derived from the XTextRange interface.
    Use the getText() object method to obtain the text object that is associated with the text range.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Common tasks include obtaining a bookmark, obtaining the bookmark’s anchor position (a text range), and
                then inserting text content at the bookmark’s anchor position. Although the setString() method is the
                quickest way to add text at the anchor position, inserting text content requires an object that supports
                the XText interface. The getText() method returns an object that can insert text content using the text
                range.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Writer documents primarily contain formatted text. To access the formatted text, either call the document’s object
    method getText() or directly access the document’s Text property. I usually directly access the Text property
    because it requires less typing.
</p>
<p>
    ThisComponent.Text 'Current document's text object
</p>
<p>
    ThisComponent.getText() 'Current document's text object
</p>
<p>
    The document’s text object implements the XTextRange interface. The simplest method to obtain all of the text
    characters contained in a text document is to call the getString() object method (see ). The getString() method
    returns a single string containing a text version of the document. Each cell in a text table is returned as a single
    paragraph, and all formatting is lost. The object method setString() can be used to set the entire document’s text
    in one call<em><em>—</em></em>when setString() is used, all of the existing text is lost! See <strong>. </strong>
</p>
<p>
    <strong>Listing . </strong>Get and set the entire document text with no formatting.
</p>
<p>
    MsgBox ThisComponent.Text.getString(), 0, "Document Text String"
</p>
<p>
    ThisComponent.Text.setString("This is text to set")
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Use getString() only on small text documents. I wrote a macro that computed word-usage statistics by
                first calling the getString() object method. Because OOo Basic strings are limited to 64KB characters,
                the macro failed on large documents.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The getString() and setString() object methods are limited, because OOo Basic strings are limited to 64KB in size
    and they contain no formatting information. Due to these limitations, other methods are usually used to get and set
    the document text. Generally, large or complex documents are best handled with the getText() method and related
    methods, because they support arbitrary size and modular management of complex documents.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="inserting-simple-text">
                            <span id="anchor-272"></span>Inserting simple text
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    With the limited information already presented, you can already insert simple text content at the beginning and the
    end of a document. The getStart() and getEnd() object methods both return a text range that can be used to insert
    text into a text object (see and ). The code in inserts simple text at the start of the document and a new paragraph
    at the end of the document.
</p>
<p>
    <strong>Listing . </strong>Insert simple text at the start and end of the document.
</p>
<p>
    Sub InsertSimpleText
</p>
<p>
    Dim oText As Object
</p>
<p>
    oText = ThisComponent.Text
</p>
<p>
</p>
<p>
    REM Insert some simple text at the start
</p>
<p>
    oText.insertString(oText.getStart(), "Text object start." &amp; CHR$(13), False)
</p>
<p>
    REM Append a new paragraph at the end
</p>
<p>
    oText.InsertControlCharacter(oText.getEnd(),_
</p>
<p>
    com.sun.star.text.ControlCharacter.APPEND_PARAGRAPH, False)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="text-content-the-textcontent-service">
                            <span id="anchor-273"></span>Text content: the TextContent service
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The primary purpose of the TextContent service is to anchor an object (text content) to its surrounding text.
    Conceptually there are two types of text content: content that is part of the surrounding text (a text field, for
    example), and content that is more like a floating field (a graphic image, for example).
</p>
<p>
    To determine where text content is anchored in the text, call the getAnchor() object method. This returns a text
    range that defines the anchor location. For floating text content objects, the text needs to know how to flow around
    the object and how the object is anchored to the text (see ). The behavior of text content inserted as a character
    should be well understood. The content acts just like a character would act: The text content is moved along between
    two other characters. When text content is anchored at a paragraph, however, the text content is not required to
    move as the characters before and after it are moved. It is only required that the object stay attached to a
    paragraph, and the object is not inserted into a paragraph. I usually anchor an object to a paragraph when I want
    text to flow around the object; for example, a graphic on the right and text on the left.
</p>
<p>
    <strong>Table . </strong>Properties supported by the com.sun.star.text.TextContent service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                AnchorType
            </td>
            <td>
                Enumeration of type com.sun.star.text.TextContentAnchorType that defines how this text content is
                attached to the surrounding text.
            </td>
        </tr>
        <tr class="even">
            <td>
                AnchorTypes
            </td>
            <td>
                Array of TextContentAnchorType that contains the anchor types of the text content.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextWrap
            </td>
            <td>
                Enumeration of type com.sun.star.text.WrapTextMode that defines how the surrounding text wraps around
                this text content object.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The text object contains methods to insert TextContent objects at specified locations (see ). In general, the
    TextContent type must be created by the document before it is inserted (see ).
</p>
<p>
    <strong>Listing . </strong>Insert text content (a text table) at the end of the current document.
</p>
<p>
    Sub InsertSimpleTableAtEnd
</p>
<p>
    Dim oTable 'Newly created table to insert
</p>
<p>
    REM Let the document create the text table.
</p>
<p>
    oTable = ThisComponent.createInstance( "com.sun.star.text.TextTable")
</p>
<p>
    oTable.initialize(3, 2) 'Three rows, two columns
</p>
<p>
</p>
<p>
    REM Now insert the text table at the end of the document.
</p>
<p>
    ThisComponent.Text.insertTextContent(_
</p>
<p>
    ThisComponent.Text.getEnd(), oTable, False)
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                In general, the TextContent type must be created by the document before it is inserted.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Call the removeTextContent(XTextContent) object method (see ) to remove text content. Another method of removing
    text content is to write new text content in its place. A simple example of this is to call the setString() method
    on a text range that includes the text content (see).
</p>
<p>
    <strong>Listing . </strong>Clear the entire document of all text content.
</p>
<p>
    ThisComponent.Text.setString("") 'Clear an entire document!
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="enumerating-paragraphs">
                    <span id="anchor-274"></span>Enumerating paragraphs
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Writer documents primarily contain formatted text that is arranged into paragraphs. Writer methods can operate on
    words, sentences, paragraphs, and entire text objects. Paragraphs are the most basic organizational unit for
    formatted text, and methods on paragraphs are often the most reliable, meaning they contain fewer bugs. The
    paragraphs can be enumerated sequentially using the XEnumerationAccess interface defined in the document’s text
    object. OOo treats tables as a special type of paragraph, and they are returned while enumerating paragraphs (see ).
</p>
<p>
    <strong>Listing .</strong> Count paragraphs and text tables.
</p>
<p>
    Sub enumerateParagraphs
</p>
<p>
    Dim oEnum 'com.sun.star.container.XEnumerationAccess
</p>
<p>
    Dim oPar 'Paragraph of some sort
</p>
<p>
    Dim nPars As Integer 'Number of paragraphs
</p>
<p>
    Dim nTables As Integer 'Number of tables
</p>
<p>
</p>
<p>
    REM ThisComponent refers to the current OOo document
</p>
<p>
    REM Text is a property of ThisComponent for a text document
</p>
<p>
    REM The getText() object method returns the same thing.
</p>
<p>
    REM createEnumeration() is an object method.
</p>
<p>
    oEnum = ThisComponent.Text.createEnumeration()
</p>
<p>
    Do While oEnum.hasMoreElements()
</p>
<p>
    oPar = oEnum.nextElement()
</p>
<p>
</p>
<p>
    REM The returned paragraph will be a paragraph or a text table
</p>
<p>
    If oPar.supportsService("com.sun.star.text.Paragraph") Then
</p>
<p>
    nPars = nPars + 1
</p>
<p>
    ElseIf oPar.supportsService("com.sun.star.text.TextTable") Then
</p>
<p>
    nTables = nTables + 1
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    MsgBox CStr(nPars) &amp; " Paragraph(s)" &amp; CHR$(13) &amp;_
</p>
<p>
    CStr(nTables) &amp; " Table(s)" &amp; CHR$(13), 0,_
</p>
<p>
    "Paragraph Types In Document"
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Visual Basic for Applications (VBA) supports accessing paragraphs using an index; OOo does not.
            </td>
        </tr>
    </tbody>
</table>
<p>
    While enumerating the paragraphs in a Writer document, both paragraphs and tables are returned. The object method
    supportsService() is used to determine if a paragraph or a table is returned. Paragraph objects support both the
    XTextRange interface and the XTextContent interface. TextTable objects, however, support only the XTextContent
    interface.
</p>
<p>
    The macro in enumerates paragraphs in the high level text object. Many objects contains their own text object; fore
    example, each cell in a text table and each frame.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="paragraph-properties">
                            <span id="anchor-275"></span>Paragraph properties
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Paragraphs contain numerous paragraph-related properties encapsulated in services. The properties that are primarily
    related to the entire paragraph are encapsulated in the ParagraphProperties service (see).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The Paragraph service is not the only service that supports the ParagraphProperties service. Other
                services, especially those that are also a text range, also support paragraph properties. Techniques
                used to modify paragraph properties in paragraphs apply to these services as well.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table . </strong>Properties supported by the com.sun.style.ParagraphProperties service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                ParaAdjust
            </td>
            <td>
                Specify how the paragraph is aligned (or justified). Five values are supported from the
                com.sun.star.style.ParagraphAdjust enumeration:
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaLastLineAdjust
            </td>
            <td>
                Adjust the last line if the ParaAdjust is set to BLOCK.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaLineSpacing
            </td>
            <td>
                Specify the paragraph line spacing. The property is a structure of type com.sun.star.style.LineSpacing,
                which contains two properties of type Short. The Height property specifies the height and the Mode
                property specifies how to use the Height property. The Mode property supports values defined in the
                com.sun.star.style.LineSpacingMode constants group.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaBackColor
            </td>
            <td>
                Specify the paragraph background color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaBackTransparent
            </td>
            <td>
                If True, set the paragraph background color to transparent.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaBackGraphicURL
            </td>
            <td>
                Specify the URL of the paragraph background graphic.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaBackGraphicFilter
            </td>
            <td>
                Specify the name of the graphic filter for the paragraph background graphic.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaBackGraphicLocation
            </td>
            <td>
                Specify the position of the background graphic using the enumeration sun.star.style.GraphicLocation:
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaExpandSingleWord
            </td>
            <td>
                If True, single words may be stretched.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaLeftMargin
            </td>
            <td>
                Specify the left paragraph margin in 0.01 mm as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaRightMargin
            </td>
            <td>
                Specify the right paragraph margin in 0.01 mm as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaTopMargin
            </td>
            <td>
                Specify the top paragraph margin in 0.01 mm as a Long Integer. The distance between two paragraphs is
                the maximum of the bottom margin of the previous paragraph and the top margin of the next paragraph.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaBottomMargin
            </td>
            <td>
                Specify the bottom paragraph margin in 0.01 mm as a Long Integer. The distance between two paragraphs is
                the maximum of the bottom margin of the previous paragraph and the top margin of the next paragraph.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaLineNumberCount
            </td>
            <td>
                If True, this paragraph is included in line numbering.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaLineNumberStartValue
            </td>
            <td>
                Specify the start value for line numbering as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                PageDescName
            </td>
            <td>
                Setting this string causes a page break to occur before the paragraph. The new page uses the specified
                page style name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PageNumberOffset
            </td>
            <td>
                Specify a new page number if a page break occurs.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaRegisterModeActive
            </td>
            <td>
                If True, and if the paragraph's page style also has the register mode set to True, the register mode is
                active for this paragraph. If register mode is active, each line has the same height.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaTabStops
            </td>
            <td>
                Specify the tab stops for this paragraph. This is an array of structures of type
                com.sun.star.style.TabStop. Each structure contains the following properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaStyleName
            </td>
            <td>
                Specify the name of the current paragraph style.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DropCapFormat
            </td>
            <td>
                Structure that determines if the first characters of the paragraph use dropped capital letters. The
                com.sun.star.style.DropCapFormat contains the following properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                DropCapWholeWord
            </td>
            <td>
                If True, the DropCapFormat is applied to the entire first word.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaKeepTogether
            </td>
            <td>
                If True, prevents a page or column break after this paragraph<em><em>—</em></em>for example, to prevent
                a title from being the last line on a page or column.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaSplit
            </td>
            <td>
                If False, prevents the paragraph from splitting into two pages or columns.
            </td>
        </tr>
        <tr class="odd">
            <td>
                NumberingLevel
            </td>
            <td>
                Specify the numbering level of the paragraph.
            </td>
        </tr>
        <tr class="even">
            <td>
                NumberingRules
            </td>
            <td>
                Specify the numbering rules applied to this paragraph. This object implements the
                com.sun.star.container.XIndexReplace interface.
            </td>
        </tr>
        <tr class="odd">
            <td>
                NumberingStartValue
            </td>
            <td>
                Specify the start value for numbering if ParaIsNumberingRestart is True.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaIsNumberingRestart
            </td>
            <td>
                Specify if numbering restarts at the current paragraph (see NumberingStartValue).
            </td>
        </tr>
        <tr class="odd">
            <td>
                NumberingStyleName
            </td>
            <td>
                Specify the name of the style for numbering (see ParaLineNumberCount).
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaOrphans
            </td>
            <td>
                Specify the minimum number of lines at the bottom of a page if the paragraph spans more than one page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaWidows
            </td>
            <td>
                Specify the minimum number of lines at the top of a page if the paragraph spans more than one page.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaShadowFormat
            </td>
            <td>
                Specify the paragraph shadow format as a com.sun.star.table.ShadowFormat:
            </td>
        </tr>
        <tr class="odd">
            <td>
                LeftBorder
            </td>
            <td>
                Specify the left border as a com.sun.star.table.BorderLine (see).
            </td>
        </tr>
        <tr class="even">
            <td>
                RightBorder
            </td>
            <td>
                Specify the right border (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                TopBorder
            </td>
            <td>
                Specify the top border (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                BottomBorder
            </td>
            <td>
                Specify the bottom border (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                BorderDistance
            </td>
            <td>
                Specify the distance from the border to the object (in 0.01 mm).
            </td>
        </tr>
        <tr class="even">
            <td>
                LeftBorderDistance
            </td>
            <td>
                Specify the distance from the left border to the object (in 0.01 mm).
            </td>
        </tr>
        <tr class="odd">
            <td>
                RightBorderDistance
            </td>
            <td>
                Specify the distance from the right border to the object (in 0.01 mm).
            </td>
        </tr>
        <tr class="even">
            <td>
                TopBorderDistance
            </td>
            <td>
                Specify the distance from the top border to the object (in 0.01 mm).
            </td>
        </tr>
        <tr class="odd">
            <td>
                BottomBorderDistance
            </td>
            <td>
                Specify the distance from the bottom border to the object (in 0.01 mm).
            </td>
        </tr>
        <tr class="even">
            <td>
                BreakType
            </td>
            <td>
                Specify the type of break that is applied at the start of the paragraph. This is an enumeration of type
                com.sun.star.style.BreakType with the following values:
            </td>
        </tr>
        <tr class="odd">
            <td>
                DropCapCharStyleName
            </td>
            <td>
                Specify the name of the character style for drop caps.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaFirstLineIndent
            </td>
            <td>
                Specify the indent for the first line in a paragraph.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaIsAutoFirstLineIndent
            </td>
            <td>
                If True, the first line is indented automatically.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaIsHyphenation
            </td>
            <td>
                If True, automatic hyphenation is applied.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaHyphenationMaxHyphens
            </td>
            <td>
                Specify the maximum number of consecutive hyphens for each word contained in the current paragraph.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaHyphenationMaxLeadingChars
            </td>
            <td>
                Specify the maximum number of characters to remain before a hyphen character.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaHyphenationMaxTrailingChars
            </td>
            <td>
                Specify the maximum number of characters to remain after a hyphen character.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaVertAlignment
            </td>
            <td>
                Specify the vertical alignment of the paragraph. This is a constant group of type
                com.sun.star.text.ParagraphVertAlign with valid values:
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaUserDefinedAttributes
            </td>
            <td>
                Stores XML attributes that are saved and restored from the automatic styles inside XML files. The object
                implements the com.sun.star.container.XNameContainer interface.
            </td>
        </tr>
        <tr class="even">
            <td>
                NumberingIsNumber
            </td>
            <td>
                If True, the numbering of a paragraph is a number but has no symbol. This is void if the paragraph is
                not part of a paragraph numbering sequence.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaIsConnectBorder
            </td>
            <td>
                If True, paragraph borders are merged with the previous paragraph if the borders are identical. This
                property may be void.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Paragraph properties are usually set using paragraph styles<em><em>—</em></em>at least they should be.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Many of the properties in are structures; they require special care if you want to modify them, because a structure
    is copied by value rather than by reference. For example, the ParaLineSpacing property is a structure. Although the
    code in looks correct, it fails; this usage is a very common error committed by OOo Basic programmers.
</p>
<p>
    <strong>Listing . </strong>This code fails because ParaLineSpacing is a structure.
</p>
<p>
    oPar.ParaLineSpacing.Mode = com.sun.star.style.LineSpacing.LEADING
</p>
<p>
    The code in fails because the code “oPar.ParaLineSpacing” made a copy of the structure. The Mode is set, but it is
    set only on the copy, leaving the original intact. The code in <strong> </strong>demonstrates the proper way to
    modify the value of a structure when it is used as a property. A copy of the structure is stored in the variable v,
    which is then modified and copied back.
</p>
<p>
    <strong>Listing . </strong>This works because it makes a copy and then copies it back.
</p>
<p>
    v = oPar.ParaLineSpacing
</p>
<p>
    v.Mode = com.sun.star.style.LineSpacing.LEADING
</p>
<p>
    oPar.ParaLineSpacing = v
</p>
<h4 id="insert-a-page-break">
    <span id="anchor-276"></span>Insert a page break
</h4>
<p>
    To insert a page break, set the PageDescName property to the name of the page style to use after the page break.
    This style may be the same as the current page style; it is the act of setting the PageDescName
    property<em><em>—</em></em>not changing it to a new value<em><em>—</em></em>that causes a page break to occur. The
    page style name must exist in the document or a page break is not inserted. When you insert a page break, you can
    also set a new page number by setting the PageNumberOffset property to the new page number. See .
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                It is rare to insert a page break while enumerating paragraphs. It is more common to insert a page break
                using a text cursor or a text range. You can use any service that supports paragraph properties to
                insert a page break.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Insert a page break after the last paragraph.
</p>
<p>
    Sub SetPageBreakAtEndFromEnumeration
</p>
<p>
    Dim oEnum 'com.sun.star.container.XEnumerationAccess
</p>
<p>
    Dim oParTest 'Paragraph of some sort
</p>
<p>
    Dim oPar 'Last Paragraph object
</p>
<p>
    REM Find the last paragraph
</p>
<p>
    oEnum = ThisComponent.Text.createEnumeration()
</p>
<p>
    Do While oEnum.hasMoreElements()
</p>
<p>
    oParTest = oEnum.nextElement()
</p>
<p>
    If oParTest.supportsService("com.sun.star.text.Paragraph") Then
</p>
<p>
    oPar = oParTest
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
</p>
<p>
    REM Note that this does not actually change the page style name
</p>
<p>
    oPar.PageDescName = oPar.PageStyleName
</p>
<p>
</p>
<p>
    REM Set the new page number to be 7
</p>
<p>
    oPar.PageNumberOffset = 7
</p>
<p>
    End Sub
</p>
<h4 id="set-the-paragraph-style">
    <span id="anchor-277"></span>Set the paragraph style
</h4>
<p>
    The ParaStyleName property indicates the paragraph style for that paragraph. This property may be directly set.
</p>
<p>
    <strong>Listing .</strong> Enumerate the paragraph styles in the current document.
</p>
<p>
    Sub EnumerateParStyles()
</p>
<p>
    Dim oEnum 'com.sun.star.container.XEnumerationAccess
</p>
<p>
    Dim oCurPar 'Last Paragraph object.
</p>
<p>
    Dim s$ 'General string variable.
</p>
<p>
    oEnum = ThisComponent.Text.createEnumeration()
</p>
<p>
    Do While oEnum.hasMoreElements()
</p>
<p>
    oCurPar = oEnum.nextElement()
</p>
<p>
    s = s &amp; oCurPar.ParaStyleName &amp; CHR$(10)
</p>
<p>
    Loop
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="character-properties">
                            <span id="anchor-278"></span>Character properties
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Paragraphs contain numerous character-related properties. Like the paragraph-specific properties, these properties
    are optional and are encapsulated in services. The properties that are primarily related to characters are found in
    the CharacterProperties service (see <strong></strong>).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Many of the properties are represented by a value in a constant group. Constant groups associate
                meaningful names to constant values. For example, the CharFontFamily accepts the value
                com.sun.star.awt.FontFamily.ROMAN to specify a Roman font with serifs. A value of 3 may also be used. In
                almost all cases, the first value is 0, the second value is 1, and so on. Code that uses the descriptive
                names is easier to read and understand.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table . </strong>Properties supported by the com.sun.style.CharacterProperties service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CharFontName
            </td>
            <td>
                Specify the name of the font in western text. This may be a comma-separated list of names.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharFontStyleName
            </td>
            <td>
                Specify the name of the font style.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharFontFamily
            </td>
            <td>
                Specify the name of the font family as specified in com.sun.star.awt.FontFamily constant group.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharFontCharSet
            </td>
            <td>
                Specify the text encoding of the font using the com.sun.star.awt.CharSet constant group. The values are
                self-explanatory: DONTKNOW, ANSI, MAC, IBMPC_437 (IBM PC character set number 437), IBMPC_850,
                IBMPC_860, IBMPC_86, IBMPC_863, IBMPC_865, SYSTEM, and SYMBOL.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharFontPitch
            </td>
            <td>
                Specify the character font pitch using the com.sun.star.awt.FontPitch constant group. The values are
                self-explanatory: DONTKNOW, FIXED, and VARIABLE.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharColor
            </td>
            <td>
                Specify the text color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharEscapement
            </td>
            <td>
                Specify the Short Integer representing the percentage of raising or lowering for superscript/subscript
                characters. Negative values lower the characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharHeight
            </td>
            <td>
                Specify the character height in points as a decimal number.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharUnderline
            </td>
            <td>
                Specify the character underline type using the com.sun.star.awt.FontUnderline constant group.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharWeight
            </td>
            <td>
                Specify the font weight using the com.sun.star.awt.FontWeight constant group.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharPosture
            </td>
            <td>
                Specify the character posture using the com.sun.star.awt.FontSlant enumeration with values:
            </td>
        </tr>
        <tr class="even">
            <td>
                CharAutoKerning
            </td>
            <td>
                Set to True to use the kerning tables for the current font. Automatic kerning adjusts the spacing
                between certain pairs of characters to improve readability.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharBackColor
            </td>
            <td>
                Specify the text background color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharBackTransparent
            </td>
            <td>
                If True, the text background color is transparent.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharCaseMap
            </td>
            <td>
                Specify how characters should be displayed using the com.sun.star.style.CaseMap constant group. This
                does not change the actual text<em><em>—</em></em>only the way it is displayed.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharCrossedOut
            </td>
            <td>
                If True, the characters have a line through them.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharFlash
            </td>
            <td>
                If True, the characters are displayed flashing.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharStrikeout
            </td>
            <td>
                Specify character strikeout using the com.sun.star.awt.FontStrikeout constant group:
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharWordMode
            </td>
            <td>
                If True, white spaces (spaces and tabs) ignore the CharStrikeout and CharUnderline properties.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharKerning
            </td>
            <td>
                Specify the character kerning value as a Short Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharLocale
            </td>
            <td>
                Specify the character locale as a com.star.lang.Locale structure.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharKeepTogether
            </td>
            <td>
                If True, OOo tries to keep the character range on the same line. If a break must occur, it occurs before
                the characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharNoLineBreak
            </td>
            <td>
                If True, OOo ignores a line break in the character range. If a break must occur, it occurs after the
                characters so it is possible that they will cross a border.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharShadowed
            </td>
            <td>
                If True, the characters are formatted and displayed with a shadow effect.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharFontType
            </td>
            <td>
                Specify the fundamental technology of the font using the com.sun.star.awt.FontType constant group.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharStyleName
            </td>
            <td>
                Specify the name of the font style as a string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharContoured
            </td>
            <td>
                If True, characters are formatted and displayed with a contour (3-D outline) effect.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharCombineIsOn
            </td>
            <td>
                If True, text is formatted and displayed using two lines. The CharCombinePrefix string precedes the text
                in full size, and the CharCombineSuffix follows the text in full size.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharCombinePrefix
            </td>
            <td>
                Specify the prefix (usually parentheses) used with the CharCombineIsOn property.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharCombineSuffix
            </td>
            <td>
                Specify the suffix (usually parentheses) used with the CharCombineIsOn property.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharEmphasize
            </td>
            <td>
                Specify the type and position of emphasis marks in Asian texts using the com.sun.star.text.FontEmphasis
                constant group:
            </td>
        </tr>
        <tr class="even">
            <td>
                CharRelief
            </td>
            <td>
                Specify the relief value from the com.sun.star.text.FontRelief constant group:
            </td>
        </tr>
        <tr class="odd">
            <td>
                RubyText
            </td>
            <td>
                Specify the text that is set as ruby. “Ruby Text” acts as an annotation and is associated with a “Ruby
                Base.” This is typically used in Asian writing systems, providing a helper for uncommonly used writing
                characters that are not easily recognizable, especially by children. For example, in Japanese writing,
                the phonetic Hiragana alphabet is used to pair phonetic “helper” readings (called Furigana or Yomigana
                in Japanese) with the Chinese character counterpart.
            </td>
        </tr>
        <tr class="even">
            <td>
                RubyAdjust
            </td>
            <td>
                Specify the ruby text adjustment using the com.sun.star.text.RubyAdjust enumeration:
            </td>
        </tr>
        <tr class="odd">
            <td>
                RubyCharStyleName
            </td>
            <td>
                Specify the name of the character style that is applied to RubyText.
            </td>
        </tr>
        <tr class="even">
            <td>
                RubyIsAbove
            </td>
            <td>
                If True, the Ruby is printed above the text (right if the text is vertical).
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharRotation
            </td>
            <td>
                Specify the rotation of a character in degrees as a Short Integer. Not all implementations support all
                values.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharRotationIsFitToLine
            </td>
            <td>
                If True, OOo tries to fit the rotated text to the surrounding line height.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharScaleWidth
            </td>
            <td>
                Specify the scaling for superscript and subscript as a percentage using a Short Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                HyperLinkURL
            </td>
            <td>
                Specify the URL of a hyperlink (if set) as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HyperLinkTarget
            </td>
            <td>
                Specify the name of the target for a hyperlink (if set) as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                HyperLinkName
            </td>
            <td>
                Specify the name of the hyperlink (if set) as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                VisitedCharStyleName
            </td>
            <td>
                Specify the character style for visited hyperlinks as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                UnvisitedCharStyleName
            </td>
            <td>
                Specify the character style name for unvisited hyperlinks as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharEscapementHeight
            </td>
            <td>
                Specify the additional height used for subscript or superscript characters as an Integer percent. For
                subscript characters the value is negative.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharNoHyphenation
            </td>
            <td>
                If True, the word cannot be hyphenated at the character.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharUnderlineColor
            </td>
            <td>
                Specify the color of the underline as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                CharUnderlineHasColor
            </td>
            <td>
                If True, the CharUnderlineColor is used for an underline.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharStyleNames
            </td>
            <td>
                An array of character style names applied to the text. The order is not necessarily relevant.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                When a property supports a DONTKNOW value, the property is usually used as a hint to perform certain
                operations more efficiently or to find a close replacement value if the requested value is not
                available. For example, if a particular font is not available, you can use the CharFontFamily to choose
                a font of the correct type.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The code in demonstrates modifying the character properties by modifying the FontRelief property and then changing
    it back.
</p>
<p>
    <strong>Listing .</strong> Set then restore the font relief.
</p>
<p>
    Sub ViewFontRelief
</p>
<p>
    Dim oEnum 'com.sun.star.container.XEnumerationAccess
</p>
<p>
    Dim oPar 'Paragraph of some sort
</p>
<p>
    Dim i% 'General Counting variable
</p>
<p>
    Dim s$
</p>
<p>
</p>
<p>
    oEnum = ThisComponent.Text.createEnumeration()
</p>
<p>
    Do While oEnum.hasMoreElements()
</p>
<p>
    oPar = oEnum.nextElement()
</p>
<p>
</p>
<p>
    REM The returned paragraph will be a paragraph or a text table
</p>
<p>
    If oPar.supportsService("com.sun.star.text.Paragraph") Then
</p>
<p>
    i = i + 1
</p>
<p>
    oPar.CharRelief = i MOD 3
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
</p>
<p>
    MsgBox "The document now uses NONE, EMBOSSED, and ENGRAVED character relief"
</p>
<p>
</p>
<p>
    oEnum = ThisComponent.Text.createEnumeration()
</p>
<p>
    Do While oEnum.hasMoreElements()
</p>
<p>
    oPar = oEnum.nextElement()
</p>
<p>
</p>
<p>
    REM The returned paragraph will be a paragraph or a text table
</p>
<p>
    If oPar.supportsService("com.sun.star.text.Paragraph") Then
</p>
<p>
    i = i + 1
</p>
<p>
    oPar.CharRelief = com.sun.star.text.FontRelief.NONE
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="enumerating-text-sections-paragraph-portions">
                            <span id="anchor-279"></span>Enumerating text sections (paragraph portions)
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    It is not unusual for a paragraph to contain text with dissimilar formatting<em><em>—</em></em>for example, a single
    word may be displayed in <strong>bold</strong> in the middle of a sentence that is displayed in the font’s normal
    state. Just as you can enumerate the paragraphs in a document, you can enumerate the text sections in a paragraph.
    Text within each enumerated portion uses the same properties and is of the same type. lists the properties directly
    supported by the TextPortion service. The TextPortion service exports the TextRange service so it also supports the
    paragraph properties in and the character properties in .
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                An object that supports paragraph or character properties typically provides a way to enclose a range of
                text. If a specific property changes value in the text range, it usually isn’t available to be set. For
                example, a text range can contain more than one paragraph. If all of the contained paragraphs in the
                text range do not support the same paragraph style, the paragraph style property is not available to the
                text range. If, however, the text range is reduced to contain only paragraphs that support a single
                paragraph style, the paragraph style property will be available to that text range.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table . </strong>Properties supported by the com.sun.text.TextPortion service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TextPortionType
            </td>
            <td>
                String containing the type of the text portion. Valid content type names are:
            </td>
        </tr>
        <tr class="even">
            <td>
                ControlCharacter
            </td>
            <td>
                Short Integer containing the control character if the text portion contains a ControlCharacter.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Bookmark
            </td>
            <td>
                If the text content is a bookmark, this is a reference to the bookmark. The property implements the
                com.sun.star.text.XTextContent interface.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsCollapsed
            </td>
            <td>
                If True, the text portion is a point.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsStart
            </td>
            <td>
                If True, the text portion is a start portion if two portions are needed to include an object.<br /> For
                example, a DocmentIndexMark has a start and end text portion surrounding the text<br /> to be indexed.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in demonstrates enumerating the text content inside a paragraph. It displays the paragraph number and the
    included text portion types in a dialog. The paragraph number is calculated and is not a property of the paragraph.
</p>
<p>
    <strong>Listing .</strong> See text portion types.
</p>
<p>
    Sub EnumerateTextSections
</p>
<p>
    Dim oParEnum 'Paragraph enumerator
</p>
<p>
    Dim osecEnum 'Text section enumerator
</p>
<p>
    Dim oPar 'Current paragraph
</p>
<p>
    Dim oParSection 'Current section
</p>
<p>
    Dim nPars As Integer 'Number of paragraphs
</p>
<p>
    Dim s$
</p>
<p>
</p>
<p>
    oParEnum = ThisComponent.Text.createEnumeration()
</p>
<p>
    Do While oParEnum.hasMoreElements()
</p>
<p>
    oPar = oParEnum.nextElement()
</p>
<p>
</p>
<p>
    If oPar.supportsService("com.sun.star.text.Paragraph") Then
</p>
<p>
    nPars = nPars + 1
</p>
<p>
    oSecEnum = oPar.createEnumeration()
</p>
<p>
    s = s &amp; nPars &amp; ":"
</p>
<p>
    Do While oSecEnum.hasMoreElements()
</p>
<p>
    oParSection = oSecEnum.nextElement()
</p>
<p>
    s = s &amp; oParSection.TextPortionType &amp; ":"
</p>
<p>
    Loop
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    If nPars MOD 10 = 0 Then
</p>
<p>
    MsgBox s, 0, "Paragraph Text Sections"
</p>
<p>
    s = ""
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    MsgBox s, 0, "Paragraph Text Sections"
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="graphics">
                    <span id="anchor-280"></span>Graphics
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The following macro inserts a text graphic object as a link in to the current document. This is a text graphics
    object, which is inserted at a cursor position. Although you must set the image size, you do not need to set the
    position.
</p>
<p>
    <strong>Listing .</strong> Insert a Graphics as a link at the start of the document.
</p>
<p>
    Sub InsertGraphicObject(oDoc, sURL$)
</p>
<p>
    Dim oCursor
</p>
<p>
    Dim oGraph
</p>
<p>
    Dim oText
</p>
<p>
    oText = oDoc.getText()
</p>
<p>
    oCursor = oText.createTextCursor()
</p>
<p>
    oCursor.goToStart(FALSE)
</p>
<p>
    oGraph = oDoc.createInstance("com.sun.star.text.GraphicObject")
</p>
<p>
    With oGraph
</p>
<p>
    .GraphicURL = sURL
</p>
<p>
    .AnchorType = com.sun.star.text.TextContentAnchorType.AS_CHARACTER
</p>
<p>
    .Width = 6000
</p>
<p>
    .Height = 8000
</p>
<p>
    End With
</p>
<p>
    'now insert the image into the text document
</p>
<p>
    oText.insertTextContent( oCursor, oGraph, False )
</p>
<p>
    End Sub
</p>
<p>
    You can also insert a graphics object shape, which is inserted into the draw page rather than at a cursor location,
    but you must use a com.sun.star.drawing.GraphicObjectShape, and then set both the location and the size.
</p>
<p>
    Sometimes, you must guess the image size because it is not available. The following method assumes that the argument
    is a service of type com.sun.star.graphic.GraphicDescriptor, which optionally provides the image size in 100th mm
    and in pixels. The method returns a value in 100th mm, which is what is required for the internal display.
</p>
<p>
    Integers are not used because the intermediate values may be large.
</p>
<p>
    If the size is available in 100th mm, then this is used. Next, the size is checked in Pixels. An image has both a
    size in pixels, and an expected pixel density (Dots Per Inch). We may have the number of pixels, but we do not have
    the DPI. I guess the pixel density as the pixel density of the computer display. In other words, if the expected
    size is not available, then assume that this was created for display on the current monitor.
</p>
<p>
    <strong>Listing .</strong> Guess image size.
</p>
<p>
    Function RecommendGraphSize(oGraph)
</p>
<p>
    Dim oSize
</p>
<p>
    Dim lMaxW As Double ' Maximum width in 100th mm
</p>
<p>
    Dim lMaxH As Double ' Maximum height in 100th mm
</p>
<p>
    lMaxW = 6.75 * 2540 ' 6.75 inches
</p>
<p>
    lMaxH = 9.5 * 2540 ' 9.5 inches
</p>
<p>
</p>
<p>
    If IsNull(oGraph) OR IsEmpty(oGraph) Then
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    oSize = oGraph.Size100thMM
</p>
<p>
    If oSize.Height = 0 OR oSize.Width = 0 Then
</p>
<p>
    ' 2540 is 25.40 mm in an inch, but I need 100th mm.
</p>
<p>
    ' There are 1440 twips in an inch
</p>
<p>
    oSize.Height = oGraph.SizePixel.Height * 2540.0 * TwipsPerPixelY() / 1440
</p>
<p>
    oSize.Width = oGraph.SizePixel.Width * 2540.0 * TwipsPerPixelX() / 1440
</p>
<p>
    End If
</p>
<p>
    If oSize.Height = 0 OR oSize.Width = 0 Then
</p>
<p>
    'oSize.Height = 2540
</p>
<p>
    'oSize.Width = 2540
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    If oSize.Width &gt; lMaxW Then
</p>
<p>
    oSize.Height = oSize.Height * lMaxW / oSize.Width
</p>
<p>
    oSize.Width = lMaxW
</p>
<p>
    End If
</p>
<p>
    If oSize.Height &gt; lMaxH Then
</p>
<p>
    oSize.Width = oSize.Width * lMaxH / oSize.Height
</p>
<p>
    oSize.Height = lMaxH
</p>
<p>
    End If
</p>
<p>
    RecommendGraphSize = oSize
</p>
<p>
    End Function
</p>
<p>
    An image is embedded as follows:
</p>
<ol type="1">
    <li>
        A shape is created and added to the draw page.
    </li>
    <li>
        The graphic provider service is used to obtain image descriptor from disk before it is loaded.
    </li>
    <li>
        The image descriptor is used to guess the image size. The image size is guessed, because we only know what is in
        the descriptor, and the descriptor may not really know.
    </li>
    <li>
        The shape is set to image as provided by the graphic provider service. At this point, the image is loaded and
        known by OOo.
    </li>
    <li>
        A newly created graph object sets its URL to the URL used by the shape object. As such, the graphic and the
        shape should reference the same image.
    </li>
    <li>
        The graph is anchored as a character and then inserted into the document at the cursor.
    </li>
    <li>
        The shape is no longer required, so it is removed.
    </li>
</ol>
<p>
    For reasons I do not understand, all images inserted as a very small images (less than 1 cm). I use the guessed
    image size to set the graphic size.
</p>
<p>
    <strong>Listing .</strong> Embed an image in a document.
</p>
<p>
    ' oDoc - document to contain the image.
</p>
<p>
    ' oCurs - Cursor where the image is added
</p>
<p>
    ' sURL - URL of the image to insert.
</p>
<p>
    ' sParStyle - set the paragraph style to this.
</p>
<p>
    Sub EmbedGraphic(oDoc, oCurs, sURL$, sParStyle$)
</p>
<p>
    Dim oShape
</p>
<p>
    Dim oGraph 'The graphic object is text content.
</p>
<p>
    Dim oProvider 'GraphicProvider service.
</p>
<p>
    Dim oText
</p>
<p>
    oShape = oDoc.createInstance("com.sun.star.drawing.GraphicObjectShape")
</p>
<p>
    oGraph = oDoc.createInstance("com.sun.star.text.GraphicObject")
</p>
<p>
    oDoc.getDrawPage().add(oShape)
</p>
<p>
    oProvider = createUnoService("com.sun.star.graphic.GraphicProvider")
</p>
<p>
    Dim oProps(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    oProps(0).Name = "URL"
</p>
<p>
    oProps(0).Value = sURL
</p>
<p>
    REM Save the original size.
</p>
<p>
    Dim oSize100thMM
</p>
<p>
    Dim lHeight As Long
</p>
<p>
    Dim lWidth As Long
</p>
<p>
    oSize100thMM = RecommendGraphSize(oProvider.queryGraphicDescriptor(oProps))
</p>
<p>
    If NOT IsNull(oSize100thMM) AND NOT IsEmpty(oSize100thMM) Then
</p>
<p>
    lHeight = oSize100thMM.Height
</p>
<p>
    lWidth = oSize100thMM.Width
</p>
<p>
    End If
</p>
<p>
    oShape.Graphic = oProvider.queryGraphic(oProps())
</p>
<p>
    oGraph.graphicurl = oShape.graphicurl
</p>
<p>
    oGraph.AnchorType = com.sun.star.text.TextContentAnchorType.AS_CHARACTER
</p>
<p>
    oText= oCurs.getText()
</p>
<p>
    oText.insertTextContent(oCurs, oGraph, false)
</p>
<p>
    oDoc.getDrawPage().remove(oShape)
</p>
<p>
    If lHeight &gt; 0 AND lWidth &gt; 0 Then
</p>
<p>
    Dim oSize
</p>
<p>
    oSize = oGraph.Size
</p>
<p>
    oSize.Height = lHeight
</p>
<p>
    oSize.Width = lWidth
</p>
<p>
    oGraph.Size = oSize
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    ' Set the paragraph style if it is in the document.
</p>
<p>
    Dim oStyles
</p>
<p>
    oStyles = oDoc.StyleFamilies.getByName("ParagraphStyles")
</p>
<p>
    If oStyles.hasByName(sParStyle) Then
</p>
<p>
    oCurs.ParaStyleName = sParStyle
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="paste-html-then-embed-linked-graphics">
                    <span id="anchor-281"></span>Paste HTML then embed linked graphics
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    After copying a web page and pasting it into a text document, all of the images are embedded. Graphics in a document
    contain the GraphicURL property. The URL for a graphic contained in the document begins with the
    “vnd.sun.star.GraphiObject:”. Graphic inserted using the API are inserted as links – they are not embedded into the
    document without some work.
</p>
<p>
    The following macro brings many concepts together to find all linked images and convert them into embedded images
    contained in the document.
</p>
<p>
    <strong>Listing .</strong> Convert all linked images to embedded images.
</p>
<p>
    Sub ConvertAllLinkedGraphics(Optional aDoc)
</p>
<p>
    Dim oDoc ' Working document
</p>
<p>
    Dim oDP ' Draw page
</p>
<p>
    Dim i% ' Index counter
</p>
<p>
    Dim oGraph ' Graph object in the draw page
</p>
<p>
    Dim iLinked% ' Number of linked images
</p>
<p>
    Dim iEmbedded% ' Number of embedded images
</p>
<p>
    Dim iConverted% ' Linked images converted to embedded
</p>
<p>
    Dim s1$ ' Graphic service name
</p>
<p>
    Dim s2$ ' Graphic service name
</p>
<p>
    REM Only know how to convert these types
</p>
<p>
    s1 = "com.sun.star.drawing.GraphicObjectShape"
</p>
<p>
    s2 = "com.sun.star.text.TextGraphicObject"
</p>
<p>
    If IsMissing(aDoc) OR IsNull(aDoc) OR IsEmpty(aDoc) Then
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    Else
</p>
<p>
    oDoc = aDoc
</p>
<p>
    End If
</p>
<p>
    REM Get the document draw page and then enumerate the images.
</p>
<p>
    oDP = oDoc.getDrawPage()
</p>
<p>
    For i=0 To oDP.getCount()-1
</p>
<p>
    oGraph = oDP.getByIndex(i)
</p>
<p>
    If oGraph.supportsService(s1) OR oGraph.supportsService(s2) Then
</p>
<p>
    If InStr(oGraph.GraphicURL, "vnd.sun") &lt;&gt; 0 Then
</p>
<p>
    iEmbedded = iEmbedded + 1
</p>
<p>
    Else
</p>
<p>
    iLinked = iLinked + 1
</p>
<p>
    If EmbedLinkedGraphic(oGraph, oDoc) Then
</p>
<p>
    iConverted = iConverted + 1
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    Print "Found " &amp; iLinked &amp; " linked and " &amp; iEmbedded &amp; _
</p>
<p>
    " embedded images and converted " &amp; iConverted
</p>
<p>
    End Sub
</p>
<p>
    Function EmbedLinkedGraphic(oGraph, oDoc) As Boolean
</p>
<p>
    REM Author: Andrew Pitonyak
</p>
<p>
    Dim sGraphURL$ ' External URL of the image.
</p>
<p>
    Dim oGraph_2 ' Created image.
</p>
<p>
    Dim oCurs ' Cursor where the image is located.
</p>
<p>
    Dim oText ' Text object containing image.
</p>
<p>
    Dim oAnchor ' Anchor point of the image
</p>
<p>
    Dim s1$ ' Graphic service name
</p>
<p>
    Dim s2$ ' Graphic service name
</p>
<p>
    EmbedLinkedGraphic = False
</p>
<p>
    If InStr(oGraph.GraphicURL, "vnd.sun") &lt;&gt; 0 Then
</p>
<p>
    REM Ignore an image that is already embedded
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    s1 = "com.sun.star.drawing.GraphicObjectShape"
</p>
<p>
    s2 = "com.sun.star.text.TextGraphicObject"
</p>
<p>
    If oGraph.supportsService(s1) Then
</p>
<p>
    REM Convert a GraphicObjectShape.
</p>
<p>
    oAnchor = oGraph.getAnchor()
</p>
<p>
    oText = oAnchor.getText()
</p>
<p>
</p>
<p>
    oGraph_2 = ThisComponent.createInstance(s)
</p>
<p>
    oGraph_2.GraphicObjectFillBitmap = oGraph.GraphicObjectFillBitmap
</p>
<p>
    oGraph_2.Size = oGraph.Size
</p>
<p>
    oGraph_2.Position = oGraph.Position
</p>
<p>
    oText.insertTextContent(oAnchor, oGraph_2, False)
</p>
<p>
    oText.removeTextContent(oGraph)
</p>
<p>
    EmbedLinkedGraphic = True
</p>
<p>
</p>
<p>
    ElseIf oGraph.supportsService(s2) Then
</p>
<p>
</p>
<p>
    REM Convert a TextGraphicObject.
</p>
<p>
    Dim oBitmaps
</p>
<p>
    Dim sNewURL$
</p>
<p>
    Dim sName$
</p>
<p>
    sName$ = oGraph.LinkDisplayName
</p>
<p>
    oBitmaps = oDoc.createInstance( "com.sun.star.drawing.BitmapTable")
</p>
<p>
    If oBitMaps.hasByName(sName) Then
</p>
<p>
    Print "Link display name " &amp; sName &amp; " already exists"
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    'Print "Ready to insert " &amp; sName
</p>
<p>
    oBitmaps.insertByName( sName, oGraph.GraphicURL )
</p>
<p>
    sNewURL$ = oBitmaps.getByName( sName )
</p>
<p>
    'Print "inserted URL " &amp; sNewURL
</p>
<p>
    oGraph.GraphicURL = sNewURL
</p>
<p>
    EmbedLinkedGraphic = True
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="cursors">
                    <span id="anchor-282"></span>Cursors
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The capability to enumerate the entire text content is primarily used for tasks such as exporting a document,
    because exporting requires all of the content to be accessed in sequential order. A more typical method for
    accessing and manipulating a document involves the use of cursors. A TextCursor is a TextRange, which can be moved
    within a Text object. In other words, a text cursor not only can specify a single point in the text, but it also can
    encompass a range of text. You can use the cursor movement methods to reposition the cursor and to expand the
    section of selected text. Two primary types of text cursors are available in OOo: cursors that are view cursors (see
    ) and cursors that are not (see).
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="view-cursors">
                            <span id="anchor-283"></span>View cursors
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    As its name implies, the view cursor deals with the visible cursor. In a single document window, you see one view at
    a time. Analogously, you can have one view cursor at a time. View cursors support commands that are directly related
    to viewing. To move a cursor one line at a time, or one screen at a time, requires a view cursor. The view cursor
    knows how the text is displayed (see ).
</p>
<p>
    <strong>Table . </strong>In general, view cursors are not related to text ranges or XTextCursor.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.view.XViewCursor
            </td>
            <td>
                Simple cursor with basic movement methods that work in both text and tables.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XTextViewCursor
            </td>
            <td>
                Derived from XTextCursor, this describes a cursor in a text document’s view. It supports only very
                simple movements.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.view.XLineCursor
            </td>
            <td>
                Defines line-related methods; this interface is not derived from a text range.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XPageCursor
            </td>
            <td>
                Defines page-related methods; this interface is not derived from a text range.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.view.XScreenCursor
            </td>
            <td>
                Defines methods to move up and down one screen at a time.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Most of the cursor movement methods accept a Boolean argument that determines whether the text range of the cursor
    is expanded (True) or whether the cursor is simply moved to the new position (False). In other words, if the Boolean
    expression is False, the cursor is moved to the new position and no text is selected by the cursor. The description
    of the Boolean variable is assumed and not explicitly stated for each of the cursor movement methods in . Another
    commonality with the movement methods is that they return a Boolean value. A True value means that the movement
    worked, and a False value means that the movement failed. A movement request fails if it cannot be completed
    successfully. It is not possible, for example, to move the cursor down if it is already at the end of the document.
    The screen cursor is obtained from the document’s current controller (see ).
</p>
<p>
    <strong>Table . </strong>Object methods related to view cursors.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                XViewCursor
            </td>
            <td>
                goDown(n, Boolean)
            </td>
            <td>
                Move the cursor down by n lines.
            </td>
        </tr>
        <tr class="even">
            <td>
                XViewCursor
            </td>
            <td>
                goUp(n, Boolean)
            </td>
            <td>
                Move the cursor up by n lines.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XViewCursor
            </td>
            <td>
                goLeft(n, Boolean)
            </td>
            <td>
                Move the cursor left by n characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                XViewCursor
            </td>
            <td>
                goRight(n, Boolean)
            </td>
            <td>
                Move the cursor right by n characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XTextViewCursor
            </td>
            <td>
                isVisible()
            </td>
            <td>
                Return True if the cursor is visible.
            </td>
        </tr>
        <tr class="even">
            <td>
                XTextViewCursor
            </td>
            <td>
                setVisible(Boolean)
            </td>
            <td>
                Show or hide the cursor.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XTextViewCursor
            </td>
            <td>
                getPosition()
            </td>
            <td>
                Return a com.sun.star.awt.Point structure specifying the cursor’s coordinates relative to the top-left
                position of the first page of the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                XLineCursor
            </td>
            <td>
                isAtStartOfLine()
            </td>
            <td>
                Return True if the cursor is at the start of the line.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XLineCursor
            </td>
            <td>
                isAtEndOfLine()
            </td>
            <td>
                Return True if the cursor is at the end of the line.
            </td>
        </tr>
        <tr class="even">
            <td>
                XLineCursor
            </td>
            <td>
                gotoEndOfLine(Boolean)
            </td>
            <td>
                Move the cursor to the end of the current line.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XLineCursor
            </td>
            <td>
                gotoStartOfLine(Boolean)
            </td>
            <td>
                Move the cursor to the start of the current line.
            </td>
        </tr>
        <tr class="even">
            <td>
                XPageCursor
            </td>
            <td>
                jumpToFirstPage()
            </td>
            <td>
                Move the cursor to the first page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XPageCursor
            </td>
            <td>
                jumpToLastPage()
            </td>
            <td>
                Move the cursor to the last page.
            </td>
        </tr>
        <tr class="even">
            <td>
                XPageCursor
            </td>
            <td>
                jumpToPage(n)
            </td>
            <td>
                Move the cursor to the specified page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XPageCursor
            </td>
            <td>
                getPage()
            </td>
            <td>
                Return the current page as a Short Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                XPageCursor
            </td>
            <td>
                jumpToNextPage()
            </td>
            <td>
                Move the cursor to the next page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XPageCursor
            </td>
            <td>
                jumpToPreviousPage()
            </td>
            <td>
                Move the cursor to the previous page.
            </td>
        </tr>
        <tr class="even">
            <td>
                XPageCursor
            </td>
            <td>
                jumpToEndOfPage()
            </td>
            <td>
                Move the cursor to the end of the current page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XPageCursor
            </td>
            <td>
                jumpToStartOfPage()
            </td>
            <td>
                Move the cursor to the start of the current page.
            </td>
        </tr>
        <tr class="even">
            <td>
                XScreenCursor
            </td>
            <td>
                screenDown()
            </td>
            <td>
                Scroll the view forward by one visible page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XScreenCursor
            </td>
            <td>
                screenUp()
            </td>
            <td>
                Scroll the view backward by one visible page.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing . </strong>ScrollDownOneScreen is found in the Writer module in this chapter’s source code files as
    SC13.sxw.
</p>
<p>
    Sub ScrollDownOneScreen
</p>
<p>
    REM Get the view cursor from the current controller
</p>
<p>
    ThisComponent.currentController.getViewCursor().screenDown()
</p>
<p>
    End Sub
</p>
<p>
    A more typical use of the view cursor is to insert some special text content at the current cursor position. The
    macro in inserts the character with Unicode value 257 (“a” with a bar over it) at the current cursor position. This
    type of macro is typically associated with a keystroke to insert special characters that are not present on the
    keyboard. The macro in is short and simple, yet very useful.
</p>
<p>
    <strong>Listing . </strong>Insert the character with Unicode value 257 at the current cursor.
</p>
<p>
    Sub InsertControlCharacterAtCurrentCursor
</p>
<p>
    Dim oViewCursor As Object
</p>
<p>
    oViewCursor = ThisComponent.CurrentController.getViewCursor()
</p>
<p>
    oViewCursor.getText.insertString(oViewCursor.getStart(), CHR$(257), False)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="text-non-view-cursors">
                            <span id="anchor-284"></span>Text (non-view) cursors
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The view cursor knows how the data is displayed, but doesn’t know about the data itself. Text cursors (non-view
    cursors), however, know a lot about the data but very little about how it is displayed. For example, view cursors do
    not know about words or paragraphs, and text cursors do not know about lines, screens, or pages (see ).
</p>
<p>
    <strong>Table . </strong>Text cursor interfaces all implement the XTextCursor interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.text.XTextCursor
            </td>
            <td>
                The primary text cursor that defines simple movement methods.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XWordCursor
            </td>
            <td>
                Provides word-related movement and testing methods.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.text.XSentenceCursor
            </td>
            <td>
                Provides sentence-related movement and testing methods.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.text.XParagraphCursor
            </td>
            <td>
                Provides paragraph-related movement and testing methods.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.text.XTextViewCursor
            </td>
            <td>
                Derived from XTextCursor, this describes a cursor in a text document’s view.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Text cursors and view cursors have some overlap. The XTextViewCursor is derived from the XTextCursor so
                it supports the XTextCursor methods. This does not provide functionality with respect to the underlying
                data such as word-related or paragraph-related methods (see ).
            </td>
        </tr>
    </tbody>
</table>
<p>
    The word cursor, sentence cursor, and paragraph cursor all define essentially identical object methods (see ). The
    XTextViewCursor interface is listed in so it is omitted from .
</p>
<p>
    <strong>Table . </strong>Object methods related to text cursors.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                XTextCursor
            </td>
            <td>
                collapseToStart()
            </td>
            <td>
                Set the end position to the start position.
            </td>
        </tr>
        <tr class="even">
            <td>
                XTextCursor
            </td>
            <td>
                collapseToEnd()
            </td>
            <td>
                Set the start position to the end position.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XTextCursor
            </td>
            <td>
                isCollapsed()
            </td>
            <td>
                Return True if the start and end positions are the same.
            </td>
        </tr>
        <tr class="even">
            <td>
                XTextCursor
            </td>
            <td>
                goLeft(n, Boolean)
            </td>
            <td>
                Move the cursor left by n characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XTextCursor
            </td>
            <td>
                goRight(n, Boolean)
            </td>
            <td>
                Move the cursor right by n characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                XTextCursor
            </td>
            <td>
                gotoStart(Boolean)
            </td>
            <td>
                Move the cursor to the start of the text.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XTextCursor
            </td>
            <td>
                gotoEnd(Boolean)
            </td>
            <td>
                Move the cursor to the end of the text.
            </td>
        </tr>
        <tr class="even">
            <td>
                XTextCursor
            </td>
            <td>
                gotoRange(XTextRange, Boolean)
            </td>
            <td>
                Move or expand the cursor to the TextRange.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XWordCursor
            </td>
            <td>
                isStartOfWord()
            </td>
            <td>
                Return True if at the start of a word.
            </td>
        </tr>
        <tr class="even">
            <td>
                XWordCursor
            </td>
            <td>
                isEndOfWord()
            </td>
            <td>
                Return True if at the end of a word.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XWordCursor
            </td>
            <td>
                gotoNextWord(Boolean)
            </td>
            <td>
                Move to the start of the next word.
            </td>
        </tr>
        <tr class="even">
            <td>
                XWordCursor
            </td>
            <td>
                gotoPreviousWord(Boolean)
            </td>
            <td>
                Move to the end of the previous word.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XWordCursor
            </td>
            <td>
                gotoEndOfWord(Boolean)
            </td>
            <td>
                Move to the end of the current word.
            </td>
        </tr>
        <tr class="even">
            <td>
                XWordCursor
            </td>
            <td>
                gotoStartOfWord(Boolean)
            </td>
            <td>
                Move to the start of the current word.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XSentenceCursor
            </td>
            <td>
                isStartOfSentence()
            </td>
            <td>
                Return True if at the start of a sentence.
            </td>
        </tr>
        <tr class="even">
            <td>
                XSentenceCursor
            </td>
            <td>
                isEndOfSentence()
            </td>
            <td>
                Return True if at the end of a sentence.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XSentenceCursor
            </td>
            <td>
                gotoNextSentence(Boolean)
            </td>
            <td>
                Move to the start of the next sentence.
            </td>
        </tr>
        <tr class="even">
            <td>
                XSentenceCursor
            </td>
            <td>
                gotoPreviousSentence(Boolean)
            </td>
            <td>
                Move to the end of the previous sentence.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XSentenceCursor
            </td>
            <td>
                gotoEndOfSentence(Boolean)
            </td>
            <td>
                Move to the end of the current sentence.
            </td>
        </tr>
        <tr class="even">
            <td>
                XSentenceCursor
            </td>
            <td>
                gotoStartOfSentence(Boolean)
            </td>
            <td>
                Move to the start of the current sentence.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XParagraphCursor
            </td>
            <td>
                isStartOfParagraph()
            </td>
            <td>
                True if at the start of a paragraph.
            </td>
        </tr>
        <tr class="even">
            <td>
                XParagraphCursor
            </td>
            <td>
                isEndOfParagraph()
            </td>
            <td>
                True if at the end of a paragraph.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XParagraphCursor
            </td>
            <td>
                gotoNextParagraph(Boolean)
            </td>
            <td>
                Move to the start of the next paragraph.
            </td>
        </tr>
        <tr class="even">
            <td>
                XParagraphCursor
            </td>
            <td>
                gotoPreviousParagraph(Boolean)
            </td>
            <td>
                Move to the end of the previous paragraph.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XParagraphCursor
            </td>
            <td>
                gotoEndOfParagraph(Boolean)
            </td>
            <td>
                Move to the end of the current paragraph.
            </td>
        </tr>
        <tr class="even">
            <td>
                XParagraphCursor
            </td>
            <td>
                gotoStartOfParagraph(Boolean)
            </td>
            <td>
                Move to the start of the current paragraph.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="using-cursors-to-traverse-text">
                            <span id="anchor-285"></span>Using cursors to traverse text
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Although traversing text using a cursor is not inherently difficult, I struggled with cursors for a long time before
    I finally realized that I had a very basic and yet simple misunderstanding. A very common, and yet subtly incorrect,
    method of traversing text content using cursors is shown in . This macro attempts to move the cursor from one
    paragraph to the next, selecting one paragraph at a time. Typically, something would be done to manipulate or modify
    the paragraph, such as setting the paragraph style.
</p>
<p>
    <strong>Listing . </strong>Example of incorrect use of cursors: This code misses the last paragraph in the document.
</p>
<p>
    Dim oCursor
</p>
<p>
    REM Create a text cursor
</p>
<p>
    oCursor = ThisComponent.Text.createTextCursor()
</p>
<p>
    REM Start at the beginning of the document.
</p>
<p>
    REM This is the same as the start of the first document.
</p>
<p>
    oCursor.gotoStart(False)
</p>
<p>
    REM And this is where things go wrong!
</p>
<p>
    REM The cursor now spans from the start of the
</p>
<p>
    REM first paragraph to the start of the second paragraph.
</p>
<p>
    Do While oCursor.gotoNextParagraph(True)
</p>
<p>
    REM Process the paragraph here!
</p>
<p>
    REM Now, deselect all of the text, leaving the cursor at the
</p>
<p>
    REM start of the next paragraph.
</p>
<p>
    oCursor.goRight(0, False)
</p>
<p>
    Loop
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                I produced incorrect code as shown in before I understood cursors.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The problem in is that the method gotoNextParagraph(True) causes the cursor to extend its selection from the start
    of one paragraph to the start of the next. The first problem with selecting from the start of one paragraph to the
    start of the next is that more than just one paragraph is selected. If the two different paragraphs do not have the
    same paragraph style, the ParaStyleName property will return an empty string rather than a value. The second problem
    is that when the cursor (as shown in ) is positioned at the start of the last paragraph, it is not possible to go to
    the next paragraph because the next paragraph does not exist. Therefore, the statement “gotoNextParagraph(True)”
    returns False and the last paragraph is never processed. The code in demonstrates one correct method of traversing
    all of the paragraphs using a cursor.
</p>
<p>
    <strong>Listing . </strong>The correct way to use cursors.
</p>
<p>
    Dim oCursor
</p>
<p>
    REM Create a text cursor.
</p>
<p>
    oCursor = ThisComponent.Text.createTextCursor()
</p>
<p>
    REM Start at the beginning of the document.
</p>
<p>
    REM This is the same as the start of the first document.
</p>
<p>
    oCursor.gotoStart(False)
</p>
<p>
    Do
</p>
<p>
    REM The cursor is already positioned at the start
</p>
<p>
    REM of the current paragraph, so select the entire paragraph.
</p>
<p>
    oCursor.gotoEndOfParagraph(True)
</p>
<p>
    REM Process the paragraph here!
</p>
<p>
    REM The Loop statement moves to the next paragraph and
</p>
<p>
    REM it also deselects the text in the cursor.
</p>
<p>
    Loop While oCursor.gotoNextParagraph(False)
</p>
<p>
    The point is to align the cursor over the current paragraph, and then iterate aligned with the paragraphs, rather
    than ever looking ahead to the next paragraph while in the midst of dealing with the cursor.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                You can use cursors and enumeration to traverse an entire document and obtain all of the paragraphs.
                Using a cursor is five times faster than using an enumerator.
            </td>
        </tr>
    </tbody>
</table>
<p>
    It is very simple to write an iterator that traverses the text while counting the words, sentences, and paragraphs
    (see ).
</p>
<p>
    <strong>Listing . </strong>Count paragraphs, sentences, and words.
</p>
<p>
    Sub CountWordSentPar
</p>
<p>
    Dim oCursor
</p>
<p>
    Dim nPars As Long
</p>
<p>
    Dim nSentences As Long
</p>
<p>
    Dim nWords As Long
</p>
<p>
</p>
<p>
    REM Create a text cursor.
</p>
<p>
    oCursor = ThisComponent.Text.createTextCursor()
</p>
<p>
    oCursor.gotoStart(False)
</p>
<p>
    Do
</p>
<p>
    nPars = nPars + 1
</p>
<p>
    Loop While oCursor.gotoNextParagraph(False)
</p>
<p>
    oCursor.gotoStart(False)
</p>
<p>
    Do
</p>
<p>
    nSentences = nSentences + 1
</p>
<p>
    Loop While oCursor.gotoNextSentence(False)
</p>
<p>
</p>
<p>
    oCursor.gotoStart(False)
</p>
<p>
    Do
</p>
<p>
    nWords = nWords + 1
</p>
<p>
    Loop While oCursor.gotoNextWord(False)
</p>
<p>
</p>
<p>
    MsgBox "Paragraphs: " &amp; nPars &amp; CHR$(10) &amp;_
</p>
<p>
    "Sentences: " &amp; nSentences &amp; CHR$(10) &amp;_
</p>
<p>
    "Words: " &amp; nWords &amp; CHR$(10), 0, "Doc Statistics"
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                With OOo 1.1, I found gotoNextSentence() and gotoNextWord() to be unreliable, but the paragraph cursor
                worked well. To count words, therefore, I used the word count macros from Andrew Brows:<br /> <a
                    href="http://www.darwinwars.com/lunatic/bugs/oo_macros.html"><strong>http://www.darwinwars.com/lunatic/bugs/oo_macros.html</strong></a>.
            </td>
        </tr>
    </tbody>
</table>
<h4 id="keep-the-view-cursor-and-text-cursor-in-sync">
    <span id="anchor-286"></span>Keep the view cursor and text cursor in sync
</h4>
<p>
    A paragraph is broken into lines based on the page margins. Adjust the page margins and the line breaks change.
    Also, text copied from writer as text do not contain the page breaks. For the real world example in adds real line
    breaks into the text based on how the lines break on screen.
</p>
<p>
    Both a view cursor and a non-view cursor are required to move through the text. The view cursor knows where a line
    ends, but it does not know where the paragraph starts or ends. A non-view cursor knows about paragraphs, but the
    view cursor does not.
</p>
<p>
    moves the view cursor around on the screen, demonstrating how to change its location.
</p>
<p>
    <strong>Listing .</strong> Add line breaks in a paragraph.
</p>
<p>
    Sub LineBreaksInParagraph
</p>
<p>
    Dim oText 'Save typing ThisComponent.Text
</p>
<p>
    Dim oViewCursor 'Save typing
</p>
<p>
    ThisComponent.CurrentController.getViewCursor()
</p>
<p>
    Dim oTextCursor 'Created text cursor
</p>
<p>
    Dim oSaveCursor 'In case I want to restore the view cursor
</p>
<p>
</p>
<p>
    oText = ThisComponent.Text
</p>
<p>
</p>
<p>
    REM You require a view cursor
</p>
<p>
    REM because only the view knows where a line ends.
</p>
<p>
    oViewCursor = ThisComponent.CurrentController.getViewCursor()
</p>
<p>
</p>
<p>
    REM You require a text cursor so that you know where the paragraph ends.
</p>
<p>
    REM Too bad the view cursor is not a paragraph cursor.
</p>
<p>
    oTextCursor = oText.createTextCursorByRange(oViewCursor)
</p>
<p>
</p>
<p>
    REM You only need this if you want to restore the view cursor
</p>
<p>
    oSaveCursor = oText.createTextCursorByRange(oViewCursor)
</p>
<p>
    REM Move the cursor to the start of the current paragraph
</p>
<p>
    REM so that the entire paragraph can be processed.
</p>
<p>
    If NOT oTextCursor.isStartOfParagraph() Then
</p>
<p>
    oTextCursor.gotoStartOfParagraph(False)
</p>
<p>
    oViewCursor.gotoRange(oTextCursor, False)
</p>
<p>
    End If
</p>
<p>
    REM Now visit each line of the paragraph.
</p>
<p>
    Do While True
</p>
<p>
    REM Only the view cursor knows where the end of the line is
</p>
<p>
    REM because this is a formatting issue and not determined by
</p>
<p>
    REM punctuation.
</p>
<p>
    oViewCursor.gotoEndOfLine(false)
</p>
<p>
</p>
<p>
    REM Move with the view cursor to the end of the current line
</p>
<p>
    REM and then see if you're at the end of the paragraph.
</p>
<p>
    oTextCursor.gotoRange(oViewCursor, False)
</p>
<p>
</p>
<p>
    REM Check for end of paragraph BEFORE inserting the line break.
</p>
<p>
    If oTextCursor.isEndOfParagraph() Then Exit Do
</p>
<p>
</p>
<p>
    REM Insert a line break at the current view cursor.
</p>
<p>
    oText.insertControlCharacter(oViewCursor,_
</p>
<p>
    com.sun.star.text.ControlCharacter.LINE_BREAK, false)
</p>
<p>
    Loop
</p>
<p>
    REM If you only want to move the cursor away from the end of the
</p>
<p>
    REM current paragraph, then this will suffice.
</p>
<p>
    oViewCursor.goRight(1, False)
</p>
<p>
    REM I want to restore the view cursor location, however.
</p>
<p>
    REM oViewCursor.gotoRange(oSaveCursor, False)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="accessing-content-using-cursors">
                            <span id="anchor-287"></span>Accessing content using cursors
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    I have a habit of inspecting the objects returned to me by OOo. While inspecting a view cursor, I noticed that the
    view cursor contained useful undocumented properties. According to the developers at Sun, these will eventually be
    documented. Some of the properties that I noticed include: Cell, DocumentIndex, DocumentIndexMark, Endnote,
    Footnote, ReferenceMark, Text, TextField, TextFrame, TextSection, and TextTable. If a cursor is in a text table, the
    cursor’s TextTable property is not empty. If a cursor is on a text field, the cursor’s TextField property is not
    empty. These special properties are empty if they are not relevant. I first used these undocumented properties when
    I was asked how to determine if the view cursor was positioned in a text table, and if so, what cell contains the
    view cursor. See .
</p>
<p>
    <strong>Listing . </strong>Testing view cursor properties.
</p>
<p>
    If NOT IsEmpty(oViewCursor.TextTable) Then
</p>
<p>
    Cursors provide the ability to quickly find objects in close proximity to something else. For example, I was
    recently asked how to find a text field contained in the current paragraph<em><em>—</em></em>the current paragraph
    is defined as the paragraph containing the view cursor. It’s easy to obtain the view cursor, and you can use a
    paragraph cursor to move around the current paragraph.
</p>
<p>
    My first attempt called the createContentEnumeration("com.sun.star.text.TextContent") object method on the cursor.
    This creates an enumeration of text content, enumerating objects such as inserted buttons. I had mistakenly assumed
    that this would include text fields in the enumeration. My second attempt to find a text field, which was
    successful, uses the createEnumeration() object method. The createEnumeration() method returns an enumeration of the
    paragraphs contained in the cursor. Enumerating the content contained in a paragraph provides access to the text
    field. My final attempt, which was also successful, moves the cursor to the start of the document and then moves
    through the paragraph one location at a time looking for a text field. The macro in demonstrates all of the methods
    that I used to try to find a text field in the current paragraph.
</p>
<p>
    <strong>Listing .</strong> Check current paragraph for a text field.
</p>
<p>
    Sub TextFieldInCurrentParagraph
</p>
<p>
    Dim oEnum 'Cursor enumerator
</p>
<p>
    Dim oSection 'Current section
</p>
<p>
    Dim oViewCursor 'Current view cursor
</p>
<p>
    Dim oTextCursor 'Created text cursor
</p>
<p>
    Dim oText 'Text object in current document
</p>
<p>
    Dim s$
</p>
<p>
    Dim sTextContent$ 'Service name for text content.
</p>
<p>
    sTextContent = "com.sun.star.text.TextContent"
</p>
<p>
</p>
<p>
    oText = ThisComponent.Text
</p>
<p>
    oViewCursor = ThisComponent.CurrentController.getViewCursor()
</p>
<p>
</p>
<p>
    REM Obtain the view cursor, and then select the paragraph
</p>
<p>
    REM containing the view cursor.
</p>
<p>
    oTextCursor = oText.createTextCursorByRange(oViewCursor)
</p>
<p>
</p>
<p>
    REM Move to the start of the paragraph as a single point.
</p>
<p>
    oTextCursor.gotoStartOfParagraph(False)
</p>
<p>
    REM Move to the end of the current paragraph and expand the
</p>
<p>
    REM selection so that the entire paragraph is selected.
</p>
<p>
    oTextCursor.gotoEndOfParagraph(True)
</p>
<p>
</p>
<p>
    REM I want to enumerate the text content contained by this text cursor.
</p>
<p>
    REM Although this will find inserted drawing objects, such as the shape
</p>
<p>
    REM used by a button, it will not find a text field!
</p>
<p>
    oEnum = oTextCursor.createContentEnumeration(sTextContent)
</p>
<p>
    Do While oEnum.hasMoreElements()
</p>
<p>
    oSection = oEnum.nextElement()
</p>
<p>
    Print "Enumerating TextContent: " &amp; oSection.ImplementationName
</p>
<p>
    Loop
</p>
<p>
    REM And this enumerates the paragraphs that are contained in
</p>
<p>
    REM the text cursor.
</p>
<p>
    oEnum = oTextCursor.createEnumeration()
</p>
<p>
    Dim v
</p>
<p>
    Do While oEnum.hasMoreElements()
</p>
<p>
    v = oEnum.nextElement()
</p>
<p>
    Dim oSubSection
</p>
<p>
    Dim oSecEnum
</p>
<p>
</p>
<p>
    REM Now create an enumeration of the paragraphs.
</p>
<p>
    REM We can enumerate the sections of the paragraph to
</p>
<p>
    REM obtain the text field and other paragraph content.
</p>
<p>
    oSecEnum = v.createEnumeration()
</p>
<p>
    s = "Enumerating section type: " &amp; v.ImplementationName
</p>
<p>
    Do While oSecEnum.hasMoreElements()
</p>
<p>
    oSubSection = oSecEnum.nextElement()
</p>
<p>
    s = s &amp; CHR$(10) &amp; oSubSection.TextPortionType
</p>
<p>
    If oSubSection.TextPortionType = "TextField" Then
</p>
<p>
    s = s &amp; " &lt;== Type " &amp; oSubSection.TextField.ImplementationName
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    MsgBox s, 0, "Enumerate Single Paragraph"
</p>
<p>
    Loop
</p>
<p>
</p>
<p>
    REM And this is yet another way to find the text field.
</p>
<p>
    REM Start at the beginning of the paragraph and then move the cursor
</p>
<p>
    REM through it, looking for text fields.
</p>
<p>
    oTextCursor.gotoStartOfParagraph(False)
</p>
<p>
    Do While oTextCursor.goRight(1, False) AND _
</p>
<p>
    NOT oTextCursor.isEndOfParagraph()
</p>
<p>
    If NOT IsEmpty(oTextCursor.TextField) Then
</p>
<p>
    Print "It is NOT empty, you can use the text field"
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                As unintuitive as it sounds, it is not only possible<em><em>—</em></em>but common<em><em>—</em></em>for
                the end of a text range to come before the start of a text range. The order of the start and end is
                primarily an issue when dealing with text selected by a human user but may also occur due to the
                movement of a text cursor while expanding the text range.
            </td>
        </tr>
    </tbody>
</table>
<p>
    As the object methods getStart() and getEnd() imply, it’s possible for a text range to represent a single point.
    It’s also possible that the start position comes after the end position. Unexpected start and end positions are
    typically a problem while dealing with selected text. When you select text using a mouse or your keyboard, the
    initial selection point is generally the start location. Moving the final selection point toward the start of the
    document causes the end position to occur before the start position in the text range. The same behavior may occur
    while manually moving and expanding a cursor. This behavior is not documented, but it has been observed in OOo
    1.1.0, and like all undocumented behavior, it may change at any time. The text object can compare two ranges (see ),
    but the text object must contain both text ranges<em><em>—</em></em>a text range has the getText() object method to
    return the text object that contains the text range.
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.text.XTextRangeCompare interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                compareRegionStarts(XTextRange, XTextRange)
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                compareRegionEnds(XTextRange, XTextRange)
            </td>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="selected-text">
                    <span id="anchor-288"></span>Selected text
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Selected text refers to the text that has been selected by a user, probably using the keyboard or the mouse.
    Selected text is represented as nothing more than a text range. After you find a text selection, it’s possible to
    get the text [getString()] and set the text [setString()]. Although strings are limited to 64KB in size, selections
    are not. There are some instances, therefore, when you can’t use the getString() and setString() methods. Therefore,
    it’s probably better to use a cursor to traverse the selected text and then use the cursor’s text object to insert
    text content. Most problems using selected text look the same at an abstract level.
</p>
<p>
    If nothing is selected then
</p>
<p>
    do work on entire document
</p>
<p>
    else
</p>
<p>
    for each selected area
</p>
<p>
    do work on selected area
</p>
<p>
    The difficult part that changes each time is writing a macro that iterates over a selection or between two text
    ranges.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="is-text-selected">
                            <span id="anchor-289"></span>Is text selected?
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Text documents support the XTextSectionsSupplier interface (see ), which defines the single method
    getCurrentSelection(). If there is no current controller (which means that you’re an advanced user running
    OpenOffice.org as a server with no user interface and you won’t be looking for selected text anyway),
    getCurrentSelection() returns a null rather than any selected text.
</p>
<p>
    If the selection count is zero, nothing is selected. I have never seen a selection count of zero, but I check for it
    anyway. If no text is selected, there is one selection of zero length<em><em>—</em></em>the start and end positions
    are the same. I have seen examples, which I consider unsafe, where a zero-length selection is determined as follows:
</p>
<p>
    If Len(oSel.getString()) = 0 Then nothing is selected
</p>
<p>
    It is possible that selected text will contain more than 64KB characters, and a string cannot contain more than 64KB
    characters. Therefore, don’t check the length of the selected string to see if it is zero; this is not safe. The
    better solution is to create a text cursor from the selected range and then check to see if the start and end points
    are the same.
</p>
<p>
    oCursor = oDoc.Text.CreateTextCursorByRange(oSel)
</p>
<p>
    If oCursor.IsCollapsed() Then nothing is selected
</p>
<p>
    The macro function in performs the entire check, returning True if something is selected, and False if nothing is
    selected.
</p>
<p>
    <strong>Listing . </strong>Determine if anything is selected.
</p>
<p>
    Function IsAnythingSelected(oDoc As Object) As Boolean
</p>
<p>
    Dim oSelections 'Contains all of the selections
</p>
<p>
    Dim oSel 'Contains one specific selection
</p>
<p>
    Dim oCursor 'Text cursor to check for a collapsed range
</p>
<p>
    REM Assume nothing is selected
</p>
<p>
    IsAnythingSelected = False
</p>
<p>
    If IsNull(oDoc) Then Exit Function
</p>
<p>
    ' The current selection in the current controller.
</p>
<p>
    'If there is no current controller, it returns NULL.
</p>
<p>
    oSelections = oDoc.getCurrentSelection()
</p>
<p>
    If IsNull(oSelections) Then Exit Function
</p>
<p>
    If oSelections.getCount() = 0 Then Exit Function
</p>
<p>
    If oSelections.getCount() &gt; 1 Then
</p>
<p>
    REM There is more than one selection so return True
</p>
<p>
    IsAnythingSelected = True
</p>
<p>
    Else
</p>
<p>
    REM There is only one selection so obtain the first selection
</p>
<p>
    oSel = oSelections.getByIndex(0)
</p>
<p>
</p>
<p>
    REM Create a text cursor that covers the range and then see if it is
</p>
<p>
    REM collapsed.
</p>
<p>
    oCursor = oDoc.Text.CreateTextCursorByRange(oSel)
</p>
<p>
    If Not oCursor.IsCollapsed() Then IsAnythingSelected = True
</p>
<p>
    REM You can also compare these to see if the selection starts and ends at
</p>
<p>
    REM the same location.
</p>
<p>
    REM If oDoc.Text.compareRegionStarts(oSel.getStart(),_
</p>
<p>
    REM oSel.getEnd()) &lt;&gt; 0 Then
</p>
<p>
    REM IsAnythingSelected = True
</p>
<p>
    REM End If
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<p>
    Obtaining a selection is complicated because it’s possible to have multiple non-contiguous selections. Some
    selections are empty and some are not. If you write code to handle text selection, it should handle all of these
    cases because they occur frequently. The example in iterates through all selected sections and displays them in a
    message box.
</p>
<p>
    <strong>Listing . </strong>Display selected text.
</p>
<p>
    Sub PrintMultipleTextSelection
</p>
<p>
    Dim oSelections 'Contains all of the selections
</p>
<p>
    Dim oSel 'Contains one specific selection
</p>
<p>
    Dim lWhichSelection As Long 'Which selection to print
</p>
<p>
</p>
<p>
    If NOT IsAnythingSelected(ThisComponent) Then
</p>
<p>
    Print "Nothing is selected"
</p>
<p>
    Else
</p>
<p>
    oSelections = ThisComponent.getCurrentSelection()
</p>
<p>
    For lWhichSelection = 0 To oSelections.getCount() - 1
</p>
<p>
    oSel = oSelections.getByIndex(lWhichSelection)
</p>
<p>
    MsgBox oSel.getString(), 0, "Selection " &amp; lWhichSelection
</p>
<p>
    Next
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="selected-text-which-end-is-which">
                            <span id="anchor-290"></span>Selected text: Which end is which?
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Selections are text ranges with a start and an end. Although selections have both a start and an end, which side of
    the text is which is determined by the selection method. For example, position the cursor in the middle of a line,
    and then select text by moving the cursor either right or left. In both cases, the start position is the same. In
    one of these cases, the start position is after the end position. The text object provides methods to compare
    starting and ending positions of text ranges (see ). I use the two methods in to find the leftmost and rightmost
    cursor position of selected text.
</p>
<p>
    <strong>Listing . </strong>Get left and right cursor.
</p>
<p>
    'oSel is a text selection or cursor range
</p>
<p>
    'oText is the text object
</p>
<p>
    Function GetLeftMostCursor(oSel, oText)
</p>
<p>
    Dim oRange
</p>
<p>
    Dim oCursor
</p>
<p>
    If oText.compareRegionStarts(oSel.getEnd(), oSel) &gt;= 0 Then
</p>
<p>
    oRange = oSel.getEnd()
</p>
<p>
    Else
</p>
<p>
    oRange = oSel.getStart()
</p>
<p>
    End If
</p>
<p>
    oCursor = oText.CreateTextCursorByRange(oRange)
</p>
<p>
    oCursor.goRight(0, False)
</p>
<p>
    GetLeftMostCursor = oCursor
</p>
<p>
    End Function
</p>
<p>
    'oSel is a text selection or cursor range
</p>
<p>
    'oText is the text object
</p>
<p>
    Function GetRightMostCursor(oSel, oText)
</p>
<p>
    Dim oRange
</p>
<p>
    Dim oCursor
</p>
<p>
</p>
<p>
    If oText.compareRegionStarts(oSel.getEnd(), oSel) &gt;= 0 Then
</p>
<p>
    oRange = oSel.getStart()
</p>
<p>
    Else
</p>
<p>
    oRange = oSel.getEnd()
</p>
<p>
    End If
</p>
<p>
    oCursor = oText.CreateTextCursorByRange(oRange)
</p>
<p>
    oCursor.goLeft(0, False)
</p>
<p>
    GetRightMostCursor = oCursor
</p>
<p>
    End Function
</p>
<p>
    While using text cursors to move through a document, I noticed that cursors remember the direction in which they are
    traveling. The cursors returned by the macros in are oriented to travel into the text selection by moving the cursor
    left or right zero characters. This is also an issue while moving a cursor to the right and then turning it around
    to move left. I always start by moving the cursor zero characters in the desired direction before actually moving
    the cursor. Then my macro can use these cursors to traverse the selected text from the start (moving right) or the
    end (moving left).
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="selected-text-framework">
                            <span id="anchor-291"></span>Selected text framework
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    While dealing with selected text, I use a framework that returns a two-dimensional array of start and end cursors
    over which to iterate. Using a framework allows me to use a very minimal code base to iterate over selected text or
    the entire document. If no text is selected, the framework asks if the macro should use the entire document. If the
    answer is yes, a cursor is created at the start and the end of the document. If text is selected, each selection is
    retrieved, and a cursor is obtained at the start and end of each selection. See .
</p>
<p>
    <strong>Listing .</strong> Create cursors with selected areas.
</p>
<p>
    'sPrompt : How to ask if should iterate over the entire text
</p>
<p>
    'oCursors() : Has the return cursors
</p>
<p>
    'Returns True if should iterate and False if should not
</p>
<p>
    Function CreateSelectedTextIterator(oDoc, sPrompt$, oCursors()) As Boolean
</p>
<p>
    Dim oSelections 'Contains all of the selections
</p>
<p>
    Dim oSel 'Contains one specific selection
</p>
<p>
    Dim oText 'Document text object
</p>
<p>
    Dim lSelCount As Long 'Number of selections
</p>
<p>
    Dim lWhichSelection As Long 'Current selection
</p>
<p>
    Dim oLCursor, oRCursor 'Temporary cursors
</p>
<p>
    CreateSelectedTextIterator = True
</p>
<p>
    oText = oDoc.Text
</p>
<p>
    If Not IsAnythingSelected(oDoc) Then
</p>
<p>
    Dim i%
</p>
<p>
    i% = MsgBox("No text selected!" + CHR$(13) + sPrompt, _
</p>
<p>
    1 OR 32 OR 256, "Warning")
</p>
<p>
    If i% = 1 Then
</p>
<p>
    oLCursor = oText.createTextCursorByRange(oText.getStart())
</p>
<p>
    oRCursor = oText.createTextCursorByRange(oText.getEnd())
</p>
<p>
    oCursors = DimArray(0, 1) 'Two-Dimensional array with one row
</p>
<p>
    oCursors(0, 0) = oLCursor
</p>
<p>
    oCursors(0, 1) = oRCursor
</p>
<p>
    Else
</p>
<p>
    oCursors = DimArray() 'Return an empty array
</p>
<p>
    CreateSelectedTextIterator = False
</p>
<p>
    End If
</p>
<p>
    Else
</p>
<p>
    oSelections = oDoc.getCurrentSelection()
</p>
<p>
    lSelCount = oSelections.getCount()
</p>
<p>
    oCursors = DimArray(lSelCount - 1, 1)
</p>
<p>
    For lWhichSelection = 0 To lSelCount - 1
</p>
<p>
    oSel = oSelections.getByIndex(lWhichSelection)
</p>
<p>
    oLCursor = GetLeftMostCursor(oSel, oText)
</p>
<p>
    oRCursor = GetRightMostCursor(oSel, oText)
</p>
<p>
    oCursors(lWhichSelection, 0) = oLCursor
</p>
<p>
    oCursors(lWhichSelection, 1) = oRCursor
</p>
<p>
    Next
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The argument oCursors() is an array that is set in the macro in .
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in <strong> </strong>uses the selected text framework to print the Unicode values of the selected text.
</p>
<p>
    <strong>Listing .</strong> Display Unicode of the selected text.
</p>
<p>
    Sub PrintUnicodeExamples
</p>
<p>
    Dim oCursors(), i%
</p>
<p>
    If Not CreateSelectedTextIterator(ThisComponent, _
</p>
<p>
    "Print Unicode for the entire document?", oCursors()) Then Exit Sub
</p>
<p>
    For i% = LBound(oCursors()) To UBound(oCursors())
</p>
<p>
    PrintUnicode_worker(oCursors(i%, 0), oCursors(i%, 1), ThisComponent.Text)
</p>
<p>
    Next i%
</p>
<p>
    End Sub
</p>
<p>
    Sub PrintUnicode_worker(oLCursor, oRCursor, oText)
</p>
<p>
    Dim s As String 'contains the primary message string
</p>
<p>
    Dim ss As String 'used as a temporary string
</p>
<p>
    If IsNull(oLCursor) Or IsNull(oRCursor) Or IsNull(oText) Then Exit Sub
</p>
<p>
    If oText.compareRegionEnds(oLCursor, oRCursor) &lt;= 0 Then Exit Sub
</p>
<p>
    REM Start the cursor in the correct direction with no text selected
</p>
<p>
    oLCursor.goRight(0, False)
</p>
<p>
    Do While oLCursor.goRight(1, True)_
</p>
<p>
    AND oText.compareRegionEnds(oLCursor, oRCursor) &gt;= 0
</p>
<p>
    ss = oLCursor.getString()
</p>
<p>
    REM The string may be empty
</p>
<p>
    If Len(ss) &gt; 0 Then
</p>
<p>
    s = s &amp; oLCursor.getString() &amp; "=" &amp; ASC(oLCursor.getString()) &amp; " "
</p>
<p>
    End If
</p>
<p>
    oLCursor.goRight(0, False)
</p>
<p>
    Loop
</p>
<p>
    msgBox s, 0, "Unicode Values"
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="remove-empty-spaces-and-lines-a-larger-example">
                            <span id="anchor-292"></span>Remove empty spaces and lines: A larger example
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A common request is for a macro that removes extra blank spaces. To remove all empty paragraphs, it’s better to use
    the Remove Blank Paragraphs option from the AutoCorrect dialog (Tools | AutoCorrect Options | Options). To remove
    only selected paragraphs or runs of blank space, a macro is required.
</p>
<p>
    This section presents a set of macros that replaces all runs of white-space characters with a single white-space
    character. You can easily modify this macro to delete different types of white space. The different types of space
    are ordered by importance, so if you have a regular space followed by a new paragraph, the new paragraph stays and
    the single space is removed. The end effect is that leading and trailing white space is removed from each line.
</p>
<h4 id="what-is-white-space">
    <span id="anchor-293"></span>What is white space?
</h4>
<p>
    The term “white space” typically refers to any character that is displayed as a blank space. This includes tabs
    (ASCII value 9), regular spaces (ASCII value 32), non-breaking spaces (ASCII value 160), new paragraphs (ASCII value
    13), and new lines (ASCII value 10). By encapsulating the definition of white space into a function (see ), you can
    trivially change the definition of white space to ignore certain characters.
</p>
<p>
    <strong>Listing .</strong> Determine if a character is white space.
</p>
<p>
    Function IsWhiteSpace(iChar As Integer) As Boolean
</p>
<p>
    Select Case iChar
</p>
<p>
    Case 9, 10, 13, 32, 160
</p>
<p>
    IsWhiteSpace = True
</p>
<p>
    Case Else
</p>
<p>
    IsWhiteSpace = False
</p>
<p>
    End Select
</p>
<p>
    End Function
</p>
<p>
    If time is a serious issue, it is faster to create an array that is indexed by the Unicode value that contains true
    or false to indicate if a character is white space. The problem is that the array must be set before the call.
</p>
<p>
    For i = LBound(isWhiteArray) To UBound(isWhiteArray)
</p>
<p>
    isWhiteArray(i) = False
</p>
<p>
    Next
</p>
<p>
    isWhiteArray(9) = True
</p>
<p>
    isWhiteArray(10) = True
</p>
<p>
    isWhiteArray(13) = True
</p>
<p>
    isWhiteArray(32) = True
</p>
<p>
    isWhiteArray(160) = True
</p>
<p>
    The function to test is as follows:
</p>
<p>
    Function IsWhiteSpace2(iChar As Integer) As Boolean
</p>
<p>
    If iChar &gt; UBound(isWhiteArray) Then
</p>
<p>
    IsWhiteSpace2 = False
</p>
<p>
    Else
</p>
<p>
    IsWhiteSpace2 = isWhiteArray(iChar)
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<h4 id="rank-characters-for-deletion">
    <span id="anchor-294"></span>Rank characters for deletion
</h4>
<p>
    While removing runs of white space, each character is compared to the character before it. If both characters are
    white space, the less important character is deleted. For example, if there is both a space and a new paragraph, the
    space is deleted. The RankChar() function (see) accepts two characters: the previous character and the current
    character. The returned integer indicates which, if any, character should be deleted.
</p>
<p>
    <strong>Listing .</strong> Rank characters for deletion.
</p>
<p>
    '-1 means delete the previous character
</p>
<p>
    ' 0 means ignore this character
</p>
<p>
    ' 1 means delete this character
</p>
<p>
    ' If an input character is 0, this is the start of a line.
</p>
<p>
    ' Rank from highest to lowest is: 0, 13, 10, 9, 160, 32
</p>
<p>
    Function RankChar(iPrevChar, iCurChar) As Integer
</p>
<p>
    If Not IsWhiteSpace(iCurChar) Then 'Current not white space, ignore it
</p>
<p>
    RankChar = 0
</p>
<p>
    ElseIf iPrevChar = 0 Then 'Line start, current is white space
</p>
<p>
    RankChar = 1 ' delete the current character.
</p>
<p>
    ElseIf Not IsWhiteSpace(iPrevChar) Then 'Current is space but not previous
</p>
<p>
    RankChar = 0 ' ignore the current character.
</p>
<p>
</p>
<p>
    REM At this point, both characters are white space
</p>
<p>
    ElseIf iPrevChar = 13 Then 'Previous is highest ranked space
</p>
<p>
    RankChar = 1 ' delete the current character.
</p>
<p>
    ElseIf iCurChar = 13 Then 'Current is highest ranked space
</p>
<p>
    RankChar = -1 ' delete the previous character.
</p>
<p>
    REM Neither character is a new paragraph, the highest ranked
</p>
<p>
    ElseIf iPrevChar = 10 Then 'Previous is new line
</p>
<p>
    RankChar = 1 ' delete the current character.
</p>
<p>
    ElseIf iCurChar = 10 Then 'Current is new line
</p>
<p>
    RankChar = -1 ' delete the previous character.
</p>
<p>
    REM At this point, the highest ranking possible is a tab
</p>
<p>
    ElseIf iPrevChar = 9 Then 'Previous char is tab
</p>
<p>
    RankChar = 1 ' delete the current character.
</p>
<p>
    ElseIf iCurChar = 9 Then 'Current char is tab
</p>
<p>
    RankChar = -1 ' delete the previous character.
</p>
<p>
    ElseIf iPrevChar = 160 Then 'Previous char is a hard space
</p>
<p>
    RankChar = 1 ' delete the current character.
</p>
<p>
    ElseIf iCurChar = 160 Then 'Current char is a hard space
</p>
<p>
    RankChar = -1 ' delete the previous character.
</p>
<p>
    ElseIf iPrevChar = 32 Then 'Previous char is a regular space
</p>
<p>
    RankChar = 1 ' delete the current character.
</p>
<p>
    REM Probably should never get here... both characters are white space
</p>
<p>
    REM and the previous is not any known white space character.
</p>
<p>
    ElseIf iCurChar = 32 Then 'Current char is a regular space
</p>
<p>
    RankChar = -1 ' delete the previous character.
</p>
<p>
    Else 'Should probably not get here
</p>
<p>
    RankChar = 0 'so simply ignore it!
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<h4 id="use-the-standard-framework">
    <span id="anchor-295"></span>Use the standard framework
</h4>
<p>
    The standard framework is used to remove the empty spaces. The primary routine is simple enough that it barely
    warrants mentioning.
</p>
<p>
    <strong>Listing . </strong>Remove empty space.
</p>
<p>
    Sub RemoveEmptySpace
</p>
<p>
    Dim oCursors(), i%
</p>
<p>
    If Not CreateSelectedTextIterator(ThisComponent, _
</p>
<p>
    "ALL empty space will be removed from the ENTIRE document?", oCursors()) Then Exit Sub
</p>
<p>
    For i% = LBOUND(oCursors()) To UBOUND(oCursors())
</p>
<p>
    RemoveEmptySpaceWorker (oCursors(i%, 0), oCursors(i%, 1), ThisComponent.Text)
</p>
<p>
    Next i%
</p>
<p>
    End Sub
</p>
<h4 id="the-worker-macro">
    <span id="anchor-296"></span>The worker macro
</h4>
<p>
    The macro in represents the interesting part of this problem; it decides what is deleted and what is left untouched.
    Some interesting points should be noted:
</p>
<p>
    Because a text cursor is used, the formatting is left unchanged.
</p>
<p>
    A text range (cursor) may contain text content that returns a zero-length string. This includes, for example,
    buttons and graphic images contained in the document. Handling exceptional cases adds complexity to the macro. Many
    tasks are very simple if you ignore the exceptional cases, such as inserted graphics. If you know that your macro
    will run with simple controlled data, you may choose to sacrifice robustness to reduce complexity. handles the
    exceptional cases.
</p>
<p>
    If the selected text starts or ends with white space, it will be removed even if it does not start or end the
    document.
</p>
<p>
    <strong>Listing . </strong>RemoveEmptySpaceWorker.
</p>
<p>
    Sub RemoveEmptySpaceWorker(oLCursor, oRCursor, oText)
</p>
<p>
    Dim s As String 'Temporary text string
</p>
<p>
    Dim i As Integer 'Temporary integer used for comparing text ranges
</p>
<p>
    Dim iLastChar As Integer 'Unicode of last character
</p>
<p>
    Dim iThisChar As Integer 'Unicode of the current character
</p>
<p>
    Dim iRank As Integer 'Integer ranking that decides what to delete
</p>
<p>
</p>
<p>
    REM If something is null, then do nothing
</p>
<p>
    If IsNull(oLCursor) Or IsNull(oRCursor) Or IsNull(oText) Then Exit Sub
</p>
<p>
    REM Ignore any collapsed ranges
</p>
<p>
    If oText.compareRegionEnds(oLCursor, oRCursor) &lt;= 0 Then Exit Sub
</p>
<p>
    REM Default the first and last character to indicate start of new line
</p>
<p>
    iLastChar = 0
</p>
<p>
    iThisChar = 0
</p>
<p>
    REM Start the leftmost cursor moving toward the end of the document
</p>
<p>
    REM and make certain that no text is currently selected.
</p>
<p>
    oLCursor.goRight(0, False)
</p>
<p>
    REM At the end of the document, the cursor can no longer move right
</p>
<p>
    Do While oLCursor.goRight(1, True)
</p>
<p>
</p>
<p>
    REM It is possible that the string is zero length.
</p>
<p>
    REM This can happen when stepping over certain objects anchored into
</p>
<p>
    REM the text that contain no text. Extra care must be taken because
</p>
<p>
    REM this routine can delete these items because the cursor steps over
</p>
<p>
    REM them but they have no text length. I arbitrarily call this a regular
</p>
<p>
    REM ASCII character without obtaining the string.
</p>
<p>
    s = oLCursor.getString()
</p>
<p>
    If Len(s) = 0 Then
</p>
<p>
    oLCursor.goRight(0, False)
</p>
<p>
    iThisChar = 65
</p>
<p>
    Else
</p>
<p>
    iThisChar = Asc(oLCursor.getString())
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM If at the last character Then always remove white space
</p>
<p>
    i = oText.compareRegionEnds(oLCursor, oRCursor)
</p>
<p>
    If i = 0 Then
</p>
<p>
    If IsWhiteSpace(iThisChar) Then oLCursor.setString("")
</p>
<p>
    Exit Do
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM If went past the end then get out
</p>
<p>
    If i &lt; 0 Then Exit Do
</p>
<p>
</p>
<p>
    iRank = RankChar(iLastChar, iThisChar)
</p>
<p>
    If iRank = 1 Then
</p>
<p>
    REM Ready to delete the current character.
</p>
<p>
    REM The iLastChar is not changed.
</p>
<p>
    REM Deleting the current character by setting the text to the
</p>
<p>
    REM empty string causes no text to be selected.
</p>
<p>
    'Print "Deleting Current with " + iLastChar + " and " + iThisChar
</p>
<p>
    oLCursor.setString("")
</p>
<p>
    ElseIf iRank = -1 Then
</p>
<p>
    REM Ready to delete the previous character. One character is already
</p>
<p>
    REM selected. It was selected by moving right so moving left two
</p>
<p>
    REM deslects the currently selected character and selects the
</p>
<p>
    REM character to the left.
</p>
<p>
    oLCursor.goLeft(2, True)
</p>
<p>
    'Print "Deleting to the left with " + iLastChar + " and " + iThisChar
</p>
<p>
    oLCursor.setString("")
</p>
<p>
    REM Now the cursor is moved over the current character again but
</p>
<p>
    REM this time it is not selected.
</p>
<p>
    oLCursor.goRight(1, False)
</p>
<p>
    REM Set the previous character to the current character.
</p>
<p>
    iLastChar = iThisChar
</p>
<p>
    Else
</p>
<p>
    REM Instructed to ignore the current character so deselect any text
</p>
<p>
    REM and then set the last character to the current character.
</p>
<p>
    oLCursor.goRight(0, False)
</p>
<p>
    iLastChar = iThisChar
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="selected-text-closing-thoughts">
                            <span id="anchor-297"></span>Selected text, closing thoughts
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Anyone who has studied algorithms will tell you that a better algorithm is almost always better than a faster
    computer. An early problem that I solved was counting words in selected text. I created three solutions with varying
    degrees of success.
</p>
<p>
    My first solution converted the selected text to OOo Basic strings and then manipulated the strings. This solution
    was fast, counting 8000 words in 2.7 seconds. This solution failed when text strings exceeded 64KB in size,
    rendering it useless for large documents.
</p>
<p>
    My second solution used a cursor as it walked through the text one character at a time. This solution, although able
    to handle any length of text, required 47 seconds to count the same 8000 words. In other words, the users found the
    solution unusably slow.
</p>
<p>
    My final solution used a word cursor, which counted the words in 1.7 seconds. Unfortunately, sometimes the word
    cursor is sometimes unreliable.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                To count words correctly, visit Andrew Brown’s useful macro Web site: <a
                    href="http://www.darwinwars.com/lunatic/bugs/oo_macros.html"><strong>http://www.darwinwars.com/lunatic/bugs/oo_macros.html</strong></a>.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="search-and-replace">
                    <span id="anchor-298"></span>Search and replace
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The search process is directed by a search descriptor, which is able to search only the object that created it. In
    other words, you cannot use the same search descriptor to search multiple documents. The search descriptor specifies
    the search text and how the text is searched (see). The search descriptor is the most complicated component of
    searching.
</p>
<p>
    <strong>Table . </strong>Properties of the com.sun.star.util.SearchDescriptor service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                SearchBackwards
            </td>
            <td>
                If True, search the document backwards.
            </td>
        </tr>
        <tr class="even">
            <td>
                SearchCaseSensitive
            </td>
            <td>
                If True, the case of the letters affects the search.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SearchWords
            </td>
            <td>
                If True, only complete words are found.
            </td>
        </tr>
        <tr class="even">
            <td>
                SearchRegularExpression
            </td>
            <td>
                If True, the search string is treated as a regular expression.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SearchStyles
            </td>
            <td>
                If True, text is found based on applied style names<em><em>—</em></em>not on the text content.
            </td>
        </tr>
        <tr class="even">
            <td>
                SearchSimilarity
            </td>
            <td>
                If True, a “similarity search” is performed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SearchSimilarityRelax
            </td>
            <td>
                If True, the properties SearchSimilarityRelax, SearchSimilarityRemove, SearchSimilarityAdd, and
                SearchSimilarityExchange are all used.
            </td>
        </tr>
        <tr class="even">
            <td>
                SearchSimilarityRemove
            </td>
            <td>
                Short Integer specifying how many characters may be ignored in a match.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SearchSimilarityAdd
            </td>
            <td>
                Short Integer specifying how many characters may be added in a match.
            </td>
        </tr>
        <tr class="even">
            <td>
                SearchSimilarityExchange
            </td>
            <td>
                Short Integer specifying how many characters may be replaced in a match.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Although not included in , a search descriptor supports the string property SearchString, which represents the
    string to search. The XSearchDescriptor interface defines the methods getSearchString() and setSearchString() to get
    and set the property if you prefer to use a method rather than directly setting the property. The XSearchable
    interface defines the methods used for searching and creating the search descriptor (see ).
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.util.XSearchable interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                createSearchDescriptor()
            </td>
            <td>
                Create a new SearchDescriptor.
            </td>
        </tr>
        <tr class="even">
            <td>
                findAll(XSearchDescriptor)
            </td>
            <td>
                Return an XindexAccess containing all occurrences.
            </td>
        </tr>
        <tr class="odd">
            <td>
                findFirst(XSearchDescriptor)
            </td>
            <td>
                Starting from the beginning of the searchable object, return a text range containing the first found
                text.
            </td>
        </tr>
        <tr class="even">
            <td>
                findNext(XTextRange, XSearchDescriptor)
            </td>
            <td>
                Starting from the provided text range, return a text range containing the first found text.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in <strong> </strong>is very simple; it sets the CharWeight character property of all occurrences of the
    text “hello” to com.sun.start.awt.FontWeight.BOLD<em><em>—</em></em>text ranges support character and paragraph
    properties.
</p>
<p>
    <strong>Listing . </strong>Set all occurrences of the word “hello” to bold text.
</p>
<p>
    Sub SetHelloToBold
</p>
<p>
    Dim oDescriptor 'The search descriptor
</p>
<p>
    Dim oFound 'The found range
</p>
<p>
    oDescriptor = ThisComponent.createSearchDescriptor()
</p>
<p>
    With oDescriptor
</p>
<p>
    .SearchString = "hello"
</p>
<p>
    .SearchWords = true 'The attributes default to False
</p>
<p>
    .SearchCaseSensitive = False 'So setting one to False is redundant
</p>
<p>
    End With
</p>
<p>
    ' Find the first one
</p>
<p>
    oFound = ThisComponent.findFirst(oDescriptor)
</p>
<p>
    Do While Not IsNull(oFound)
</p>
<p>
    Print oFound.getString()
</p>
<p>
    oFound.CharWeight = com.sun.star.awt.FontWeight.BOLD
</p>
<p>
    oFound = ThisComponent.findNext(oFound.End, oDescriptor)
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="searching-selected-text-or-a-specified-range">
                            <span id="anchor-299"></span>Searching selected text or a specified range
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The trick to searching a specified range of text is to notice that you can use any text range, including a text
    cursor, in the findNext routine. After each call to findNext(), check the end points of the find to see if the
    search went too far. You may, therefore, constrain a search to any text range. The primary purpose of the findFirst
    method is to obtain the initial text range for the findNext routine. You can use the selected text framework very
    easily to search a range of text.
</p>
<p>
    <strong>Listing . </strong>Iterate through all occurrences of text between two cursors.
</p>
<p>
    Sub SearchSelectedWorker(oLCursor, oRCursor, oText, oDescriptor)
</p>
<p>
    If oText.compareRegionEnds(oLCursor, oRCursor) &lt;= 0 Then Exit Sub
</p>
<p>
    oLCursor.goRight(0, False)
</p>
<p>
    Dim oFound
</p>
<p>
    REM There is no reason to perform a findFirst.
</p>
<p>
    oFound = oDoc.findNext(oLCursor, oDescriptor)
</p>
<p>
    Do While Not IsNull(oFound)
</p>
<p>
    REM See if we searched past the end
</p>
<p>
    If -1 = oText.compareRegionEnds(oFound, oRCursor) Then Exit Do
</p>
<p>
    Print oFound.getString()
</p>
<p>
    oFound = ThisComponent.findNext(oFound.End, oDescriptor)
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<p>
    The text object cannot compare two regions unless they both belong to that text object. Text that resides in a
    different frame, section, or even a text table, uses a different text object than the main document text object. As
    an exercise, investigate what happens if the found text is in a different text object than the text object that
    contains oRCursor in . Is the code in robust?
</p>
<h3 id="searching-for-all-occurrences">
    <span id="anchor-300"></span>Searching for all occurrences
</h3>
<p>
    It is significantly faster to search for all occurrences of the text at one time using the findAll() object method
    than to repeatedly call findNext(). Care must be used, however, when using all occurrences of the specified text.
    The macro in is an extreme example of code gone bad on purpose.
</p>
<p>
    <strong>Listing . </strong>Find and replace all occurrences of the word “helloxyzzy”.
</p>
<p>
    Sub SimpleSearchHelloXyzzy
</p>
<p>
    Dim oDescriptor 'The search descriptor
</p>
<p>
    Dim oFound 'The found range
</p>
<p>
    Dim oFoundAll 'The found range
</p>
<p>
    Dim n% 'General index variable
</p>
<p>
    oDescriptor = ThisComponent.createSearchDescriptor()
</p>
<p>
    oDescriptor.SearchString = "helloxyzzy"
</p>
<p>
    oFoundAll = ThisComponent.findAll(oDescriptor)
</p>
<p>
    For n% = 0 to oFoundAll.getCount()-1
</p>
<p>
    oFound = oFoundAll.getByIndex(n%)
</p>
<p>
    'Print oFound.getString()
</p>
<p>
    oFound.setString("hello" &amp; n%)
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    The macro in obtains a list of text ranges that encapsulate the text “helloxyzzy”. This text is then replaced with a
    shorter piece of text. In a perfect world, the occurrences of “helloxyzzy” would be replaced with “hello0”,
    “hello1”, “hello2”, ... When each instance is replaced with the shorter text, the total length of the document
    changes. Remember that the text-range objects were all obtained before the first instance of text is modified.
    Although the text-range interface is clearly defined, the internal workings are not. I purposely created this
    example because I expected it to fail, and with no defined behavior my only option was to create a test.
    Experimentally, I observed that if multiple occurrences of “helloxyzzy” are contained in the same word, poor
    behavior results. I also observed that if all occurrences of “helloxyzzy” are contained in separate words,
    everything works great, and only occurrences of “helloxyzzy” are changed<em><em>—</em></em>leaving the surrounding
    text intact. I can but nod my head in approval at the brilliance of the programmers that allow this behavior, while
    remaining cautiously paranoid, expecting that code relying on this behavior will fail in the future.
</p>
<p>
    Investigating the behavior of the macro in is more than simple academics. I use a similar macro regularly in my own
    writing. For various reasons, the numbering used during the creation of this book was done manually rather than
    using the built-in numbering capabilities of OOo<em><em>—</em></em>in other words, I should have read Chapter 5 of
    <em>Taming OpenOffice.org Writer 1.1</em> by Jean Hollis Weber. Manually inserting numbering is a problem when a
    table, figure, or code listing is deleted, inserted, or moved. In other words, if I delete the first table in my
    document, all of my tables will be numbered incorrectly. I created a macro that verifies that the items are
    sequentially numbered starting with 1. Consider tables, for example. The table captions use the paragraph style
    “_table caption.” Tables are numbered using the form “.” The macro in <strong></strong> verifies that the captions
    are sequentially numbered, and it renumbers them if required. When the text “Table #” is found in a paragraph using
    the “_table caption” paragraph style, it is assumed to be identifying a table. The macro in renumbers these based on
    their occurrence in the document. Each occurrence of “Table #” that is not in the “_table caption” paragraph style
    is assumed to be a reference to a table.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="searching-and-replacing">
                            <span id="anchor-301"></span>Searching and replacing
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    You can perform simple searching and replacing by searching and manually replacing each found occurrence with the
    replacement text. OOo also defines the XReplaceable interface, which adds the ability to replace all occurrences
    using one method. You must use an XReplaceDescriptor rather than an XSearchDescriptor, however. Replacing all
    occurrences of text is very simple (see ).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The XReplaceable interface is derived from the XSearchable interface, and the XReplaceDescriptor is
                derived from the XSearchDescriptor interface.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing . </strong>Replace “hello you” with “hello me”.
</p>
<p>
    oDescriptor = oDoc.createReplaceDescriptor()
</p>
<p>
    With oDescriptor
</p>
<p>
    .SearchString = "hello you"
</p>
<p>
    .ReplaceString = "hello me"
</p>
<p>
    End With
</p>
<p>
    oDoc.ReplaceAll(oDescriptor)
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="advanced-search-and-replace">
                            <span id="anchor-302"></span>Advanced search and replace
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    While using the OOo GUI for searching and replacing, it is possible to search for and replace attributes as well as
    text. An inspection of the search-and-replace descriptors reveals the object methods setSearchAttributes() and
    setReplaceAttributes(). I discovered how to use these object methods when I found some code written by Alex
    Savitsky, whom I do not know, and Laurent Godard, whom I do.
</p>
<p>
    The macro in finds all text that is in bold type, converts the text to regular type, and then surrounds the text
    with two sets of curly brackets. The conversion of attributes to text tags is frequently done while converting
    formatted text to regular ASCII text with no special formatting capabilities. While reading , look for the following
    interesting techniques:
</p>
<p>
    To search for all text that is bold regardless of the content, you must use a regular expression. In OOo, the period
    matches any single character and the asterisk means “find zero or more occurrences of the previous character.”
    Placed together, the regular expression “.*” matches any text. Regular expressions are required to find “any text”
    that is bold.
</p>
<p>
    While searching regular expressions, the ampersand character is replaced by the found text. In , the replacement
    text “{{ &amp; }}” causes the found text “hello” to become “{{ hello }}”.
</p>
<p>
    Text that is set to bold using an applied style is found only while searching character attributes if SearchStyles
    is set to True. If the SearchStyles attribute is set to False, only text that has been directly set to bold will be
    found.
</p>
<p>
    To search for text with specific attributes, create an array of structures of type PropertyValue. There should be
    one entry in the array for each attribute you want to search. Set the property name to the name of the attribute to
    search, and the property value to the value for which to search. Although this is complicated to describe using
    words, it is clearly shown in .
</p>
<p>
    You can set attribute values by specifying the replacement attributes in the same way that you set the search
    attributes.
</p>
<p>
    <strong>Listing . </strong>Replace bold text.
</p>
<p>
    Sub ReplaceFormatting
</p>
<p>
    REM original code : Alex Savitsky
</p>
<p>
    REM modified by : Laurent Godard
</p>
<p>
    REM modified by : Andrew Pitonyak
</p>
<p>
    REM The purpose of this macro is to surround all BOLD elements with {{ }}
</p>
<p>
    REM and change the Bold attribute to NORMAL by using a regular expression.
</p>
<p>
    Dim oReplace
</p>
<p>
    Dim SrchAttributes(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    Dim ReplAttributes(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    oReplace = ThisComponent.createReplaceDescriptor()
</p>
<p>
    oReplace.SearchString = ".*" 'Regular expression. Match any text
</p>
<p>
    oReplace.ReplaceString = "{{ &amp; }}" 'Note the &amp; places the found text back
</p>
<p>
    oReplace.SearchRegularExpression=True 'Use regular expressions
</p>
<p>
    oReplace.searchStyles=True 'We want to search styles
</p>
<p>
    oReplace.searchAll=True 'Do the entire document
</p>
<p>
    REM This is the attribute to find
</p>
<p>
    SrchAttributes(0).Name = "CharWeight"
</p>
<p>
    SrchAttributes(0).Value =com.sun.star.awt.FontWeight.BOLD
</p>
<p>
    REM This is the attribute to replace it with
</p>
<p>
    ReplAttributes(0).Name = "CharWeight"
</p>
<p>
    ReplAttributes(0).Value =com.sun.star.awt.FontWeight.NORMAL
</p>
<p>
    REM Set the attributes in the replace descriptor
</p>
<p>
    oReplace.SetSearchAttributes(SrchAttributes())
</p>
<p>
    oReplace.SetReplaceAttributes(ReplAttributes())
</p>
<p>
    REM Now do the work!
</p>
<p>
    ThisComponent.replaceAll(oReplace)
</p>
<p>
    End Sub
</p>
<p>
    <strong> </strong>lists the supported regular expression characters.
</p>
<p>
    <strong>Table . </strong>Supported regular expression characters.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                .
            </td>
            <td>
                A period represents any single character. The search term "sh.rt" finds both “shirt” and “short”.
            </td>
        </tr>
        <tr class="even">
            <td>
                *
            </td>
            <td>
                An asterisk represents any number of characters. The search term “sh*rt” finds “shrt”, “shirt”,
                ”shiirt”, “shioibaldawpclasdfa asdf asdfrt” and “short”<em><em>—</em></em>to name a few things that it
                can find.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ^
            </td>
            <td>
                A caret represents the beginning of a paragraph. The search term “^Bob” only finds the word “Bob” if it
                is at the beginning of a paragraph. The search term “^.” finds the first character in a paragraph.
            </td>
        </tr>
        <tr class="even">
            <td>
                $
            </td>
            <td>
                A dollar sign represents the end of a paragraph. The search term “Bob$” only finds the word “Bob” if it
                is at the end of a paragraph.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ^$
            </td>
            <td>
                Search for an empty paragraph. This is listed here only because it is used so frequently.
            </td>
        </tr>
        <tr class="even">
            <td>
                +
            </td>
            <td>
                <p>
                    A plus sign indicates that the preceding character must appear at least once. The plus sign also
                    works with the wildcard character “.”. For example, “t.+s” finds a section of text that starts with
                    a “t” and ends with an “s”.
                </p>
                <p>
                    The longest possible text within the paragraph is always found. In other words, multiple words may
                    be found, but the found text will always reside in the same paragraph.
                </p>
            </td>
        </tr>
        <tr class="odd">
            <td>
                ?
            </td>
            <td>
                A question mark marks the previous character as optional. For example, you could find words that include
                the characters that come before the character that is in front of the “\”. For example, “birds?” finds
                both “bird” and “birds”.
            </td>
        </tr>
        <tr class="even">
            <td>
                \n
            </td>
            <td>
                The text “\n” has two uses. When searching, this finds a hard row break inserted with Shift+Enter. In
                the replace field, this represents a paragraph break. You can, therefore, replace all hard breaks with a
                paragraph break.
            </td>
        </tr>
        <tr class="odd">
            <td>
                \t
            </td>
            <td>
                The text “\t” is used to find a tab. In the replace field, this adds a tab.
            </td>
        </tr>
        <tr class="even">
            <td>
                \&gt;
            </td>
            <td>
                Using the text “\&gt;” indicates that the preceding text must end a word. For example, “book\&gt;” finds
                “checkbook” but not “bookmark”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                \&lt;
            </td>
            <td>
                Using the text “\&lt;” indicates that the following text must start a word. For example, “\&lt;book”
                finds “bookmark” but not “checkbook”.
            </td>
        </tr>
        <tr class="even">
            <td>
                \xXXXX
            </td>
            <td>
                A backslash followed by a lowercase x followed by a four-digit hexadecimal number (XXXX) finds the
                character whose Unicode (ASCII) value is the same as the four-digit hexadecimal number.
            </td>
        </tr>
        <tr class="odd">
            <td>
                \
            </td>
            <td>
                The backslash character followed by anything other than “n”, “t”, “&gt;”, “&lt;”, or “x” is used to
                specify the character that follows. For example, “\M” finds “M”. The primary purpose is to allow special
                wild characters to be found. For example, assume that I wanted to find any character preceded by a “+”.
                Well, the “+” is a special character so I need to precede it with a “\”. Use “.\+” to find any character
                preceding a “+” character.
            </td>
        </tr>
        <tr class="even">
            <td>
                &amp;
            </td>
            <td>
                The ampersand is used in the replace text to add the found characters. In , the ampersand is used to
                surround all bold text with “{{“ and “}}”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                [abc123]
            </td>
            <td>
                Match any character that is between square brackets. For example, “t[ex]+t” finds “text”, “teet”, and
                “txeeet”; to name a few examples of what it finds.
            </td>
        </tr>
        <tr class="even">
            <td>
                [a-e]
            </td>
            <td>
                The minus sign is used to define a range when used inside of square brackets. For example, “[a-e]”
                matches characters between “a” and “e” and “[a-ex-z]” matches characters between “a” and “e” or<br />
                “x” and “z”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                [^a-e]
            </td>
            <td>
                Placing a caret symbol inside square brackets will find anything but the specified characters.<br /> For
                example, “[^a-e]” finds any character that is not between “a” and “e”.
            </td>
        </tr>
        <tr class="even">
            <td>
                |
            </td>
            <td>
                Placing a vertical bar between two search strings will match what is before and also match what is
                after. For example, “bob|jean” matches the string “bob” and also matches the string “jean”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                {2}
            </td>
            <td>
                Placing a number between curly brackets finds that many occurrences of the previous character.<br /> For
                example, “me{2}t” matches “meet”, and “[0-9]{3}” matches any three-digit number. Note that<br />
                “[0-9]{3}” will also find the first three digits of a number with more than three digits, unless “find
                whole words” is also specified.
            </td>
        </tr>
        <tr class="even">
            <td>
                {1,2}
            </td>
            <td>
                Placing two numbers separated by a comma between curly brackets finds the preceding character a variable
                number of times. For example, “[0-9]{1,4}” finds any number that contains between one and four digits.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ( )
            </td>
            <td>
                <p>
                    Text placed within parentheses is treated as a reference. The text “\1” finds the first reference,
                    “\2” finds the second reference, and so on. For example, “([0-9]{3})-[0-9]{2}-\1” finds “123-45-123”
                    but not “123-45-678”.
                </p>
                <p>
                    Parentheses can also be used for grouping. For example, “(he|she|me)$” finds any paragraph that ends
                    with “he”, “she”, or “me”.
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                [:digit:]
            </td>
            <td>
                Finds a single-digit number. For example, “[:digit:]?” finds a single-digit number and “[:digit:]+”
                finds any number with one or more digits.
            </td>
        </tr>
        <tr class="odd">
            <td>
                [:space:]
            </td>
            <td>
                Finds any white space, such as spaces and tabs.
            </td>
        </tr>
        <tr class="even">
            <td>
                [:print:]
            </td>
            <td>
                Finds any printable characters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                [:cntrl:]
            </td>
            <td>
                Finds any non-printing characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                [:alnum:]
            </td>
            <td>
                Finds any alphanumeric characters (numbers and text characters).
            </td>
        </tr>
        <tr class="odd">
            <td>
                [:alpha:]
            </td>
            <td>
                Finds any alphabetic characters, both uppercase and lowercase.
            </td>
        </tr>
        <tr class="even">
            <td>
                [:lower:]
            </td>
            <td>
                Finds any lowercase characters if “Match case” is selected in the Options area.
            </td>
        </tr>
        <tr class="odd">
            <td>
                [:upper:]
            </td>
            <td>
                Finds any uppercase characters if “Match case” is selected in the Options area.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="text-content">
                    <span id="anchor-303"></span>Text content
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The primary purpose of a Writer document is to contain simple text. The text is stored and enumerated by paragraphs.
    When a paragraph enumerates content, each enumerated section uses the same set of properties. In general, text
    content must be created by the document that will contain the content. After creation, the text content is inserted
    into the document at a specified location. Paragraphs, however, are not specifically created and then inserted (see
    near the beginning of this chapter). Paragraph text is inserted as a string and new paragraphs are inserted as
    control characters (see ). More complicated text content is typically added using the insertTextContent() object
    method (see ). There are other, less-used methods to insert text content<em><em>—</em></em>for example, pasting
    content from the clipboard (see later in this chapter) and inserting an entire document (see ).
</p>
<p>
    <strong>Listing . </strong>Insert a document at a text cursor.
</p>
<p>
    oCursor.insertDocumentFromURL(sFileURL, Array())
</p>
<p>
    Most text content is named and accessible in a similar way (see <strong></strong>). The most popular content type in
    is undoubtedly text tables.
</p>
<p>
    <strong>Table . </strong>Content contained in a text document.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Footnotes
            </td>
            <td>
                Index Access
            </td>
            <td>
                getFootnotes()
            </td>
        </tr>
        <tr class="even">
            <td>
                Endnotes
            </td>
            <td>
                Index Access
            </td>
            <td>
                getEndnotes()
            </td>
        </tr>
        <tr class="odd">
            <td>
                Reference marks
            </td>
            <td>
                Named Access
            </td>
            <td>
                getReferenceMarks()
            </td>
        </tr>
        <tr class="even">
            <td>
                Graphic objects
            </td>
            <td>
                Named Access
            </td>
            <td>
                getGraphicObjects()
            </td>
        </tr>
        <tr class="odd">
            <td>
                Embedded objects
            </td>
            <td>
                Named Access
            </td>
            <td>
                getEmbeddedObjects()
            </td>
        </tr>
        <tr class="even">
            <td>
                Text tables
            </td>
            <td>
                Named Access
            </td>
            <td>
                getTables()
            </td>
        </tr>
        <tr class="odd">
            <td>
                Bookmarks
            </td>
            <td>
                Named Access
            </td>
            <td>
                getBookmarks()
            </td>
        </tr>
        <tr class="even">
            <td>
                Style families
            </td>
            <td>
                Named Access
            </td>
            <td>
                getStyleFamilies()
            </td>
        </tr>
        <tr class="odd">
            <td>
                Document indexes
            </td>
            <td>
                Index Access
            </td>
            <td>
                getDocumentIndexes()
            </td>
        </tr>
        <tr class="even">
            <td>
                Text fields
            </td>
            <td>
                Enumeration Access
            </td>
            <td>
                getTextFields()
            </td>
        </tr>
        <tr class="odd">
            <td>
                Text field masters
            </td>
            <td>
                Named Access
            </td>
            <td>
                getTextFieldMasters()
            </td>
        </tr>
        <tr class="even">
            <td>
                Text frames
            </td>
            <td>
                Named Access
            </td>
            <td>
                getTextFrames()
            </td>
        </tr>
        <tr class="odd">
            <td>
                Text sections
            </td>
            <td>
                Named Access
            </td>
            <td>
                getTextSections()
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Content accessible using named access also provides indexed access.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="text-tables">
                    <span id="anchor-304"></span>Text tables
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Writer documents act as a text-tables supplier, so you can directly retrieve text tables from Writer documents.
    Although text tables are enumerated as text content along with paragraphs (see ), tables are more typically obtained
    by name or by index (see <strong></strong> and<strong> </strong>).
</p>
<p>
    <strong>Listing .</strong> Demonstrate enumerating text tables.
</p>
<p>
    Sub EnumrateAllTextTables
</p>
<p>
    Dim oTables 'All of the text tables
</p>
<p>
    Dim s$ 'Work string
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
</p>
<p>
    oTables = ThisComponent.TextTables REM First, access the tables based on index.
</p>
<p>
    s = "Tables By Index" &amp; CHR$(10)
</p>
<p>
    For i = 0 To oTables.getCount() - 1
</p>
<p>
    s = s &amp; "Table " &amp; (i+1) &amp; " = " &amp; oTables(i).Name &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    s = s &amp; CHR$(10) &amp; CHR$(10) &amp; "Text Tables By Name" &amp; CHR$(10)
</p>
<p>
    s = s &amp; Join(oTables.getElementNames(), CHR$(10))
</p>
<p>
    MsgBox s, 0, "Tables"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000021C000002D8FAF532FB.gif" style="width:1.5783in;height:1.9744in" />
</p>
<p>
    <strong>Figure . </strong>Tables contained in a document, by index and named access.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Most named text content is retrieved, created, inserted, and disposed of in the same way. Learn to do
                this using tables and you’ll be ready to use other named text content<em><em>—</em></em>bookmarks, for
                example.
            </td>
        </tr>
    </tbody>
</table>
<p>
    As with most text content, tables must be created by the document before they are inserted into the document. The
    macro in inserts a table named “SampleTable” if it does not exist, and removes it if it does.
</p>
<p>
    <strong>Listing . </strong>Insert then delete a text table.
</p>
<p>
    Sub InsertDeleteTable
</p>
<p>
    Dim oTable 'Newly created table to insert
</p>
<p>
    Dim oTables 'All of the text tables
</p>
<p>
    Dim oInsertPoint 'Where the table will be inserted
</p>
<p>
    Dim sTableName as String
</p>
<p>
</p>
<p>
    sTableName = "SampleTable"
</p>
<p>
    oTables = ThisComponent.TextTables
</p>
<p>
</p>
<p>
    If oTables.hasByName(sTableName) Then
</p>
<p>
    oTable = oTables.getByName(sTableName)
</p>
<p>
</p>
<p>
    REM Although this seems like the correct way to remove text content,
</p>
<p>
    REM what if the table is not inserted into the primary document's
</p>
<p>
    REM text object? oTable.dispose() may be safer to use.
</p>
<p>
    ThisComponent.Text.removeTextContent(oTable)
</p>
<p>
    Else
</p>
<p>
    REM Let the document create the text table.
</p>
<p>
    oTable = ThisComponent.createInstance( "com.sun.star.text.TextTable")
</p>
<p>
    oTable.initialize(2, 3) 'Two rows, three columns
</p>
<p>
</p>
<p>
    REM If there is a bookmark named "InsertTableHere", then insert
</p>
<p>
    REM the table at that point. If this bookmark does not exist,
</p>
<p>
    REM then simply choose the very end of the document.
</p>
<p>
    If ThisComponent.getBookmarks().hasByName("InsertTableHere") Then
</p>
<p>
    oInsertPoint =_
</p>
<p>
    ThisComponent.getBookmarks().getByName("InsertTableHere").getAnchor()
</p>
<p>
    Else
</p>
<p>
    oInsertPoint = ThisComponent.Text.getEnd()
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM Now insert the text table at the end of the document.
</p>
<p>
    REM Note that the text object from the oInsertPoint text
</p>
<p>
    REM range is used rather than the document text object.
</p>
<p>
    oInsertPoint.getText().insertTextContent(oInsertPoint , oTable, False)
</p>
<p>
</p>
<p>
    REM The setData() object method works ONLY with numerical data.
</p>
<p>
    REM The setDataArray() object method, however, also allows strings.
</p>
<p>
    oTable.setDataArray(Array(Array(0, "One", 2), Array(3, "Four", 5)))
</p>
<p>
    oTable.setName(sTableName)
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                In general, it is better to set table properties before inserting the table into the document. This
                prevents screen flicker as the object is modified and then redrawn on the screen. Due to a bug in OOo
                1.1.0, if is modified to set the data before inserting the table, the table name is modified and it
                contains an extra garbage character at the end. Be warned, however, that some text content, such as text
                field masters, cannot change their names after they have been inserted into a document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in demonstrates many useful techniques:
</p>
<ul>
    <li>
        A named text content is found and obtained. Notice that finding the table and the bookmark are very similar
        processes.
    </li>
    <li>
        A bookmark is used.
    </li>
    <li>
        A text table is created, initialized, and inserted at a location marked by a bookmark.
    </li>
    <li>
        Text content is deleted.
    </li>
    <li>
        A table is initialized with data.
    </li>
    <li>
        The table name is set.
    </li>
</ul>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="using-the-correct-text-object">
                            <span id="anchor-305"></span>Using the correct text object
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    It is very important that you use the correct text object. It is possible that the text object in a text section or
    table cell is not the same as the text object returned by the document. Each text range is associated with a
    specific text object. Attempting to use object methods from one text object to operate on a text range associated
    with a different text object causes an error. In , a table is removed, with the single line shown in
    <strong></strong>.
</p>
<p>
    <strong>Listing . </strong>What if the table is not contained in the document’s text object?
</p>
<p>
    ThisComponent.Text.removeTextContent(oTable)
</p>
<p>
    The code in assumes that the table is contained in the document’s text object. If the table is not contained in the
    primary document’s text object, the code in will fail. Although will rarely fail, it will undoubtedly fail at the
    worst possible time. The macro works because the sample document was designed so that the table is inserted into the
    primary document’s text object. Either solution shown in may be a better solution for deleting the table.
</p>
<p>
    <strong>Listing . </strong>Two safe methods to delete the table.
</p>
<p>
    oTable.getAnchor().getText().removeTextContent(oTable)
</p>
<p>
    oTable.dispose()
</p>
<p>
    The second time that a text object is used in , it is obtained from the anchor returned from a
    bookmark<em><em>—</em></em>this is safe.
</p>
<p>
    <strong>Listing . </strong>A safe way to get a text object.
</p>
<p>
    oInsertPoint.getText().insertTextContent(oInsertPoint , oTable, False)
</p>
<p>
    If the text range oInsertPoint is not contained in the document’s text object, attempting to insert the table using
    the document’s text object will fail. Only you can decide how careful you need to be when accessing text objects.
    Consider the selected text framework. What text object is used to create text cursors and to compare text cursors?
    Can you make the code more robust?
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="methods-and-properties">
                            <span id="anchor-306"></span>Methods and properties
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The methods supported by text tables are very similar to the methods supported by spreadsheets contained in Calc
    documents (see Chapter <a href="#anchor-307">15</a>, “<a href="#anchor-307">Calc Documents</a>”). summarizes the
    object methods supported by text tables.
</p>
<p>
    <strong>Table . </strong>Object methods supported by text tables.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                autoFormat(name)
            </td>
            <td>
                Apply the specified auto-format name to the table.
            </td>
        </tr>
        <tr class="even">
            <td>
                createCursorByCellName(name)
            </td>
            <td>
                XTextTableCursor positioned at the specified cell.
            </td>
        </tr>
        <tr class="odd">
            <td>
                createSortDescriptor()
            </td>
            <td>
                Array of PropertyValues that specify the sort criteria.
            </td>
        </tr>
        <tr class="even">
            <td>
                dispose()
            </td>
            <td>
                Destroy a text object, which also removes it from the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getAnchor()
            </td>
            <td>
                Return a text range identifying where the table is anchored. This method allows text content to be added
                easily before or after a text table.
            </td>
        </tr>
        <tr class="even">
            <td>
                getCellByName(name)
            </td>
            <td>
                Return an XCell based on the cell name, such as “B3”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getCellByPosition(col, row)
            </td>
            <td>
                Numbering starts at zero. This has difficulties with complex tables.
            </td>
        </tr>
        <tr class="even">
            <td>
                getCellNames()
            </td>
            <td>
                String array of cell names contained in the table.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getCellRangeByName(name)
            </td>
            <td>
                XCellRange based on cell name, such as A1:B4. Fails if the name identifies a cell that has been split.
            </td>
        </tr>
        <tr class="even">
            <td>
                getCellRangeByPosition(left, top, right, bottom)
            </td>
            <td>
                XCellRange based on numeric range.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getColumnDescriptions()
            </td>
            <td>
                Array of strings describing the columns. Fails for complex tables.
            </td>
        </tr>
        <tr class="even">
            <td>
                getColumns()
            </td>
            <td>
                XTableColumns object enumerates columns by index. Also supports insertByIndex(idx, count) and
                removeByIndex(idx, count).
            </td>
        </tr>
        <tr class="odd">
            <td>
                getData()
            </td>
            <td>
                Get numerical data as a nested sequence of values (arrays in an array). Fails for complex tables.
            </td>
        </tr>
        <tr class="even">
            <td>
                getDataArray()
            </td>
            <td>
                Same as getData() but may contain String or Double.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getName()
            </td>
            <td>
                Get the table name as a string.
            </td>
        </tr>
        <tr class="even">
            <td>
                getRowDescriptions()
            </td>
            <td>
                Array of strings describing the rows. Fails for complex tables.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getRows()
            </td>
            <td>
                XTableRows object enumerates rows by index. Also supports insertByIndex(idx, count) and
                removeByIndex(idx, count).
            </td>
        </tr>
        <tr class="even">
            <td>
                initialize(rows, cols)
            </td>
            <td>
                Set the numbers of rows and columns. Must be done before the table is inserted (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                setColumnDescriptions(string())
            </td>
            <td>
                Set the column descriptions from an array of strings.
            </td>
        </tr>
        <tr class="even">
            <td>
                setData(Double())
            </td>
            <td>
                Set numerical data as a nested sequence of values. Fails for complex tables.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setDataArray(array())
            </td>
            <td>
                Same as setData() but may contain String or Double.
            </td>
        </tr>
        <tr class="even">
            <td>
                setName(name)
            </td>
            <td>
                Set the table name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setRowDescriptions(string())
            </td>
            <td>
                Set the row descriptions from an array of strings.
            </td>
        </tr>
        <tr class="even">
            <td>
                sort(array())
            </td>
            <td>
                Sort the table based on a sort descriptor.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Text table objects also support a variety of properties (see ). Text tables support many of the same properties that
    are supported by paragraphs (see ).
</p>
<p>
    <strong>Table . </strong>Properties supported by the com.sun.star.text.TextTable service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BreakType
            </td>
            <td>
                Specify the type of break that is applied at the start of the table (see the BreakType attribute in ).
            </td>
        </tr>
        <tr class="even">
            <td>
                LeftMargin
            </td>
            <td>
                Specify the left table margin in 0.01 mm as a Long Integer. Set the HoriOrient property to something
                other than FULL.
            </td>
        </tr>
        <tr class="odd">
            <td>
                RightMargin
            </td>
            <td>
                Specify the right table margin in 0.01 mm as a Long Integer. Set the HoriOrient property to something
                other than FULL.
            </td>
        </tr>
        <tr class="even">
            <td>
                HoriOrient
            </td>
            <td>
                Specify the horizontal orientation using the com.sun.star.text.HoriOrientation constants.<br /> The
                default value is com.sun.star.text.HoriOrientation.FULL.
            </td>
        </tr>
        <tr class="odd">
            <td>
                KeepTogether
            </td>
            <td>
                If True, prevents page or column breaks between this table and the following paragraph or text table.
            </td>
        </tr>
        <tr class="even">
            <td>
                Split
            </td>
            <td>
                If False, the table will not split across two pages.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PageDescName
            </td>
            <td>
                If this string is set, a page break occurs before the paragraph, and the new page uses the given page
                style name (see PageDescName in ).
            </td>
        </tr>
        <tr class="even">
            <td>
                PageNumberOffset
            </td>
            <td>
                If a page break occurs, specify a new page number (see PageNumberOffset in ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                RelativeWidth
            </td>
            <td>
                Specify the width of the table relative to its environment as a Short Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsWidthRelative
            </td>
            <td>
                If True, the relative width is valid.
            </td>
        </tr>
        <tr class="odd">
            <td>
                RepeatHeadline
            </td>
            <td>
                If True, the first row of the table is repeated on every new page.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShadowFormat
            </td>
            <td>
                Specify the type, color, and size of the shadow (see ParaShadowFormat in ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                TopMargin
            </td>
            <td>
                Specify the top table margin in 0.01 mm as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                BottomMargin
            </td>
            <td>
                Specify the bottom table margin in 0.01 mm as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                BackTransparent
            </td>
            <td>
                If True, the background color is transparent.
            </td>
        </tr>
        <tr class="even">
            <td>
                Width
            </td>
            <td>
                Specify the absolute table width as a Long Integer<em><em>—</em></em>this is a read-only property.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ChartRowAsLabel
            </td>
            <td>
                If True, the first row is treated as axis labels if a chart is created.
            </td>
        </tr>
        <tr class="even">
            <td>
                ChartColumnAsLabel
            </td>
            <td>
                If True, the first column is treated as axis labels if a chart is created.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TableBorder
            </td>
            <td>
                Specify the table borders in a com.sun.star.table.TableBorder structure. The structure contains numerous
                complicated properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                TableColumnSeparators
            </td>
            <td>
                <p>
                    Specify the width of each column with an array of table column separators. Each separator is a
                    com.sun.star.text.TableColumnSeparator structure.
                </p>
                <p>
                    The width of a cell is defined by the position of the separator between adjacent cells. When two
                    cells are merged, the separator is hidden, not removed.
                </p>
                <p>
                    The Position values are relative to the text table TableColumnRelativeSum property. This property is
                    valid for a table only if every row has the same structure. If they do not, obtain the separators
                    from the individual row objects.
                </p>
            </td>
        </tr>
        <tr class="odd">
            <td>
                TableColumnRelativeSum
            </td>
            <td>
                Specify the sum of the column-width values used in TableColumnSeparators as a Short Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                BackColor
            </td>
            <td>
                Specify the paragraph background color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                BackGraphicURL
            </td>
            <td>
                Specify the URL of the paragraph background graphic.
            </td>
        </tr>
        <tr class="even">
            <td>
                BackGraphicFilter
            </td>
            <td>
                Specify the name of the graphic filter for the paragraph background graphic.
            </td>
        </tr>
        <tr class="odd">
            <td>
                BackGraphicLocation
            </td>
            <td>
                Specify the position of a background graphic (see ParaBackGraphicLocation in ).
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="simple-and-complex-tables">
                            <span id="anchor-308"></span>Simple and complex tables
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Simply speaking, a text table is a set of rows and columns of text. All of the tables in this book are represented
    using simple text tables. OOo supports both simple and complex tables. A simple table contains no merged or split
    cells; the table cells are laid out in a simple grid (see <strong></strong>). Each column is labeled alphabetically
    starting with the letter A, and each row is labeled numerically starting with the number 1. The object method
    getCellByName() uses this name to return the specified cell. A similar object method, getCellByPosition(), returns
    the cell based on the column and row number. The column and row number are zero-based numbers, so requesting (1, 2)
    returns the cell named “B3”.
</p>
<p>
    <strong>Table .</strong> Simple table with the cell names labeled.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                A1
            </td>
            <td>
                B1
            </td>
            <td>
                C1
            </td>
            <td>
                D1
            </td>
        </tr>
        <tr class="even">
            <td>
                A2
            </td>
            <td>
                B2
            </td>
            <td>
                C2
            </td>
            <td>
                D2
            </td>
        </tr>
        <tr class="odd">
            <td>
                A3
            </td>
            <td>
                B3
            </td>
            <td>
                C3
            </td>
            <td>
                D3
            </td>
        </tr>
        <tr class="even">
            <td>
                A4
            </td>
            <td>
                B4
            </td>
            <td>
                C4
            </td>
            <td>
                D4
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use getRows() to obtain the rows from the text table. The returned rows object is useful to determine how many rows
    are present, retrieving, inserting, and deleting rows.
</p>
<p>
    <strong>Table .</strong> Main access methods supported by a table rows object.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getByIndex
            </td>
            <td>
                Retrieve a specific row.
            </td>
        </tr>
        <tr class="even">
            <td>
                getCount
            </td>
            <td>
                Number of rows in the table.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasElements
            </td>
            <td>
                Determine if there are any rows in the table.
            </td>
        </tr>
        <tr class="even">
            <td>
                insertByIndex
            </td>
            <td>
                Add rows to the table.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeByIndex
            </td>
            <td>
                Remove rows from the table.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Although it is easy to enumerate individual rows, a row is not useful for obtaining the cells that it contains. An
    individual row object is primarily used as follows:
</p>
<ul>
    <li>
        Set the row height using the Height attribute.
    </li>
    <li>
        Set IsAutoHeight to true so that the rows height is automatically adjusted.
    </li>
    <li>
        Set IsSplitAllowed to false so that a row can not be split at a page boundary.
    </li>
    <li>
        Modify the TableColumnSeparators to change column widths.
    </li>
</ul>
<p>
    Use getColumns() to obtain the columns from the text table. The columns object supports the same methods as the rows
    object. It is not possible, however, to obtain a specific column from a column object; the method getByIndex()
    exists, but it returns null. Although I expected to set a column width by obtaining a specific column and setting
    the width, you need to modify the table column separators available from the row object.
</p>
<p>
    A complex text table is a text table that is not simple. More accurately, a complex text table contains cells that
    have been split, or merged. To demonstrate a complex text table, start with <em></em> and perform the following
    tasks:
</p>
<ol type="1">
    <li>
        Right click in cell A2 and choose Cell &gt; Split &gt; Horizontal. Cell A2 becomes two cells. From a cell naming
        perspective, a new third row is inserted that contains one column. At this point, the API indicates that there
        are five rows and four columns.
    </li>
</ol>
<blockquote>
    <p>
        <strong>Table .</strong> Split cell A2 horizontally.
    </p>
</blockquote>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                A1
            </td>
            <td>
                B1
            </td>
            <td>
                C1
            </td>
            <td>
                D1
            </td>
        </tr>
        <tr class="even">
            <td>
                A2
            </td>
            <td>
                B2
            </td>
            <td>
                C2
            </td>
            <td>
                D2
            </td>
        </tr>
        <tr class="odd">
            <td>
                (A3)
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                A3=&gt;A4
            </td>
            <td>
                B3=&gt;B4
            </td>
            <td>
                C3=&gt;C4
            </td>
            <td>
                D3=&gt;D4
            </td>
        </tr>
        <tr class="odd">
            <td>
                A4=&gt;A5
            </td>
            <td>
                B4=&gt;B5
            </td>
            <td>
                C4=&gt;C5
            </td>
            <td>
                D4=&gt;D5
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        Right click in cell B2 and choose Cell &gt; Split &gt; Vertical. Cell B2 becomes two distinct cells, B2 and C2;
        a new column appears to have been inserted at cell B2. The API still indicates that there are five rows and four
        columns.
    </li>
</ol>
<blockquote>
    <p>
        <strong>Table .</strong> Split cell B2 vertically..
    </p>
</blockquote>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                A1
            </td>
            <td>
                B1
            </td>
            <td>
                C1
            </td>
            <td>
                D1
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                A2
            </td>
            <td>
                B2
            </td>
            <td>
                (C2)
            </td>
            <td>
                C2=&gt;D2
            </td>
            <td>
                D2=&gt;E2
            </td>
        </tr>
        <tr class="odd">
            <td>
                A3
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                A4
            </td>
            <td>
                B4
            </td>
            <td>
                C4
            </td>
            <td>
                D4
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                A5
            </td>
            <td>
                B5
            </td>
            <td>
                C5
            </td>
            <td>
                D5
            </td>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        Select cells A4 and B4, right click and choose Cell &gt; Merge.
    </li>
</ol>
<blockquote>
    <p>
        <strong>Table .</strong> Complex table after merging cells in the same row.
    </p>
</blockquote>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                A1
            </td>
            <td>
                B1
            </td>
            <td>
                C1
            </td>
            <td>
                D1
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                A2
            </td>
            <td>
                B2
            </td>
            <td>
                C2
            </td>
            <td>
                D2
            </td>
            <td>
                E2
            </td>
        </tr>
        <tr class="odd">
            <td>
                A3
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                A4, (B4) =&gt; A4
            </td>
            <td>
                C4=&gt;B4
            </td>
            <td>
                D4=&gt;C4
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                A5
            </td>
            <td>
                B5
            </td>
            <td>
                C5
            </td>
            <td>
                D5
            </td>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        Select cells B4 and C5, right click and choose Cell &gt; Merge. Cell C5 just goes away.
    </li>
</ol>
<blockquote>
    <p>
        <strong>Table .</strong> Split cell B2 vertically..
    </p>
</blockquote>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                A1
            </td>
            <td>
                B1
            </td>
            <td>
                C1
            </td>
            <td>
                D1
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                A2
            </td>
            <td>
                B2
            </td>
            <td>
                C2
            </td>
            <td>
                D2
            </td>
            <td>
                E2
            </td>
        </tr>
        <tr class="odd">
            <td>
                A3
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                A4
            </td>
            <td>
                B4, (C5)=&gt;B4
            </td>
            <td>
                C4
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                A5
            </td>
            <td>
                B5
            </td>
            <td>
                D5
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Not all object methods work with complex tables. For example, the object methods getData()<br /> and
                setData() cause an exception for complex tables, which makes sense.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Although the object method getCellByName() works as expected for complex tables, getCellByPosition() is not able to
    return all of the cells because it allows only a column and a row number. Use the getCellNames() object method to
    return the names of the cells in a table (see ); you can then use the cell names to individually obtain each cell in
    the table.
</p>
<p>
    <strong>Listing . </strong>Join the array of strings to print the cell names in a table.
</p>
<p>
    MsgBox Join(oTable.getCellNames(), "|")
</p>
<p>
    Place the text cursor in a text table and run the following macro to set the text in each cell to the text name;
    this modifies the text table and erases all existing text.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Set the text of each cell to contain
    the cell's name.
</p>
<p>
    Sub SetCellNames
</p>
<p>
    Dim oTable
</p>
<p>
    Dim sNames
</p>
<p>
    Dim i As Integer
</p>
<p>
</p>
<p>
    oTable = ThisComponent.currentController.ViewCursor.TextTable
</p>
<p>
    If IsNull(oTable) Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    sNames = oTable.getCellNames()
</p>
<p>
    For i = LBound(sNames) To UBound(sNames)
</p>
<p>
    oTable.getCellByName(sNames(i)).setString(sNames(i))
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="tables-contain-cells">
                            <span id="anchor-309"></span>Tables contain cells
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The cells in a text table are very versatile objects capable of holding all types of data. The cell objects
    implement both the XText interface (see near the beginning of this chapter) as well as the XCell interface (see ).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Tables are able to create a text table cursor with methods and properties specifically designed to
                traverse and select cells, and each individual cell is able to produce a text cursor that is local to
                the cell text object.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.table.XCell interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getFormula()
            </td>
            <td>
                The original string typed into the cell, even if it is not a formula.
            </td>
        </tr>
        <tr class="even">
            <td>
                setFormula(String)
            </td>
            <td>
                Set the cell’s formula. Use setString() from the XText interface to set text.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getValue()
            </td>
            <td>
                Floating-point (Double) value of the cell.
            </td>
        </tr>
        <tr class="even">
            <td>
                setValue(Double)
            </td>
            <td>
                Set the floating-point value of the cell.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getType()
            </td>
            <td>
                Return a com.sun.star.table.CellContentType enumeration with valid values of EMPTY, VALUE, TEXT, and
                FORMULA.
            </td>
        </tr>
        <tr class="even">
            <td>
                getError()
            </td>
            <td>
                Long Integer error value. If the cell is not a formula, the error value is zero.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Each cell object posses numerous properties. These properties are generally familiar because they are used in other
    objects. For example, the BackColor, BackGraphicFilter, BackGraphicLocation, BackGraphicURL, BackTransparent,
    BorderDistance, BottomBorder, BottomBorderDistance, LeftBorder, LeftBorderDistance, RightBorder,
    RightBorderDistance, TopBorder, and TopBorderDistance properties are defined for text tables in and/or paragraph
    properties in . One of the more useful properties that is available only in the cell object, however, is CellName.
    This is useful to determine the location of the current cursor. The macro in demonstrates a few new manipulations
    for tables.
</p>
<p>
    The text tables, rows, columns, and cells all support the BackColor property. sets the background color of the first
    row to a light gray, which is commonly used to mark headings.
</p>
<p>
    The insertByIndex(index, num) object method is used to insert new rows at the end of a table. Rows can also be
    inserted into the middle or at the start of a table.
</p>
<p>
    Individual cells are retrieved by name; both numeric values and strings are set. Notice that strings are set using
    setString() rather than setFormula().
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Although the Web-based OOo documentation makes no distinction between cells contained in text tables and
                cells contained in spreadsheets, the two cell types do not support the same property set. For example,
                the CellStyle, CellBackColor, and RotateAngle properties are not supported in a text document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing . </strong>Simple text table manipulations.
</p>
<p>
    Sub SimpleTableManipulations
</p>
<p>
    Dim oTable 'Newly created table to insert
</p>
<p>
    Dim oTables 'All of the text tables
</p>
<p>
    Dim oInsertPoint 'Where the table will be inserted
</p>
<p>
    Dim sTableName as String
</p>
<p>
</p>
<p>
    sTableName = "SampleTable"
</p>
<p>
    oTables = ThisComponent.TextTables
</p>
<p>
    REM Remove the table if it exists!
</p>
<p>
    If oTables.hasByName(sTableName) Then
</p>
<p>
    ThisComponent.Text.removeTextContent(oTables.getByName(sTableName))
</p>
<p>
    End If
</p>
<p>
    REM Let the document create the text table.
</p>
<p>
    oTable = ThisComponent.createInstance( "com.sun.star.text.TextTable")
</p>
<p>
    oTable.initialize(4, 3) 'Two rows, three columns
</p>
<p>
    REM If there is a bookmark named "InsertTableHere", then insert
</p>
<p>
    REM the table at that point. If this bookmark does not exist,
</p>
<p>
    REM then simply choose the very end of the document.
</p>
<p>
    If ThisComponent.getBookmarks().hasByName("InsertTableHere") Then
</p>
<p>
    oInsertPoint =_
</p>
<p>
    ThisComponent.getBookmarks().getByName("InsertTableHere").getAnchor()
</p>
<p>
    Else
</p>
<p>
    oInsertPoint = ThisComponent.Text.getEnd()
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    oInsertPoint.getText().insertTextContent(oInsertPoint , oTable, False)
</p>
<p>
</p>
<p>
    oTable.setDataArray(Array(Array("Name", "Score", "Test"),_
</p>
<p>
    Array("Bob", 80, "CCW"), Array("Andy", 80, "CCW"),_
</p>
<p>
    Array("Jean", 100, "CCI")))
</p>
<p>
    oTable.setName(sTableName)
</p>
<p>
    REM Set the first row to have a gray background.
</p>
<p>
    oTable.getRows().getByIndex(0).BackColor = RGB(235, 235, 235)
</p>
<p>
    REM removeByIndex uses the same arguments as insertByIndex, namely
</p>
<p>
    REM the index at which to insert or remove followed by the number
</p>
<p>
    REM of rows to insert or remove. The following line inserts
</p>
<p>
    REM one row at index 4.
</p>
<p>
    oTable.getRows().insertByIndex(4, 1)
</p>
<p>
</p>
<p>
    REM Obtain the individual cells and set the values.
</p>
<p>
    oTable.getCellByName("A5").setString("Whil")
</p>
<p>
    oTable.getCellByName("B5").setValue(100)
</p>
<p>
    oTable.getCellByName("C5").setString("Advanced")
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="using-a-table-cursor">
                            <span id="anchor-310"></span>Using a table cursor
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Although text table cursors implement methods specific to traversing text tables, they are not significantly
    different from their text cursor counterparts in general functionality. You can select and manipulate ranges of
    cells, and set cell properties.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                You cannot obtain a text table from the document and then simply insert it again at another location.
                So, how do you copy a text table? See .
            </td>
        </tr>
    </tbody>
</table>
<p>
    Like text cursors, text table cursor movement methods accept a Boolean argument that indicates if the current
    selection should be expanded (True) or if the cursor should simply be moved (False). The movement methods also
    return a Boolean value indicating if the movement was successful. contains the methods defined by the
    XTextTableCursor interface.
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.text.XTextTableCursor interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getRangeName()
            </td>
            <td>
                Return the cell range selected by this cursor as a string. For example, “B3:D5”.
            </td>
        </tr>
        <tr class="even">
            <td>
                gotoCellByName(String, boolean)
            </td>
            <td>
                Move the cursor to the cell with the specified name; return Boolean.
            </td>
        </tr>
        <tr class="odd">
            <td>
                goLeft(n, boolean)
            </td>
            <td>
                Move the cursor left n cells; return Boolean.
            </td>
        </tr>
        <tr class="even">
            <td>
                goRight(n, boolean)
            </td>
            <td>
                Move the cursor right n cells; return Boolean.
            </td>
        </tr>
        <tr class="odd">
            <td>
                goUp(n, boolean)
            </td>
            <td>
                Move the cursor up n cells; return Boolean.
            </td>
        </tr>
        <tr class="even">
            <td>
                goDown(n, boolean)
            </td>
            <td>
                Move the cursor down n cells; return Boolean.
            </td>
        </tr>
        <tr class="odd">
            <td>
                gotoStart(boolean)
            </td>
            <td>
                Move the cursor to the top left cell.
            </td>
        </tr>
        <tr class="even">
            <td>
                gotoEnd(boolean)
            </td>
            <td>
                Move the cursor to the bottom right cell.
            </td>
        </tr>
        <tr class="odd">
            <td>
                mergeRange()
            </td>
            <td>
                Merge the selected range of cells; return True for success.
            </td>
        </tr>
        <tr class="even">
            <td>
                splitRange(n, boolean)
            </td>
            <td>
                Create n (an integer) new cells in each cell selected by the cursor. For the Boolean, specify True to
                split horizontally, False for vertically. Returns True on success.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Text table cursors are used to split and merge table cells. In general, I consider this to be the primary use of a
    text table cursor. You can use text table cursors to move around the table by using the methods in . The macro in
    obtains the table cell names, creates a cell cursor that contains the first table cell, and then moves the cursor to
    the last cell in the table. A cell range is created based on the range name, and then the entire table is selected
    by the current controller.
</p>
<p>
    <strong>Listing . </strong>Select an entire table using a cursor. This may fail for a complex table.
</p>
<p>
    oCellNames = oTable.getCellNames()
</p>
<p>
    oCursor = oTable.createCursorByCellName(oCellNames(0))
</p>
<p>
    oCursor.gotoCellByName(oCellNames(UBound(oCellNames())), True)
</p>
<p>
    oRange = oTable.getCellRangeByName(oCursor.getRangeName()) 'This may fail!
</p>
<p>
    Thiscomponent.getCurrentController.select(oRange)
</p>
<p>
    demonstrates how to select all cells in a table by using a table cell cursor. You can then manipulate the entire
    table using the cursor. It may fail, however, in selecting the entire table in the current view. Table cell cursors
    have no problems with complex tables. The object methods supported by tables, however, do not all support complex
    tables. A notable example is the object method getCellRangeByName(), as used in . This is very unfortunate because
    the view cursor is able to select text based on a cell range, but the table cannot return a cell range that has a
    split cell as one of the endpoints. For example, the cell range A1.2.1:C4 fails.
</p>
<p>
    There is no easy method to duplicate an entire text table. The clipboard has always been the solution of choice to
    copy general text (see ), but, if available, use transferable content instead (see ). First, use the view cursor or
    current controller to select the object that you want to copy. Then use a dispatcher to copy the object to the
    clipboard, move the view cursor where the object should be placed, and then use a dispatcher to paste the object
    from the clipboard.
</p>
<p>
    As you may have guessed, the difficult part in this process is selecting the table with the view cursor. Although
    numerous people have tried and failed to solve this problem, a brilliant solution was provided by Paolo Mantovani, a
    contributor on the OOo mailing lists. Paolo starts by noting that selecting an entire table with the current
    controller places the view cursor at the start of the first cell (see).
</p>
<p>
    <strong>Listing . </strong>Place the cursor at the start of the first cell in the table.
</p>
<p>
    ThisComponent.CurrentController.select(oTable)
</p>
<p>
    Although does not entirely solve the problem, it does provide a good start, because the view cursor is in the table
    at a known position. Paolo then provides a very succinct method to select the entire table (see ).
</p>
<p>
    <strong>Listing . </strong>Select the entire table in the current view.
</p>
<p>
    ThisComponent.CurrentController.select(oTable)
</p>
<p>
    oVCursor.gotoEnd(True) 'Move to the end of the current cell
</p>
<p>
    oVCursor.gotoEnd(True) 'Move to the end of the table
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Remember to carefully test all code dealing with tables. A different solution proposed by
                Paolo<em><em>—</em></em>which failed<em><em>—</em></em>was to use goRight() and then goDown() based on
                the number of rows and columns.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in selects a table by name, copies the table to the clipboard, and then pastes it at the end of the
    document.
</p>
<p>
    <strong>Listing . </strong>Copy a text table using the clipboard.
</p>
<p>
    Sub CopyNamedTableToEndWithClipboard(sName As String)
</p>
<p>
    Dim oTable 'Table to copy
</p>
<p>
    Dim oText 'Document's text object
</p>
<p>
    Dim oFrame 'Current frame to use with the dispatcher
</p>
<p>
    Dim oVCursor 'Current view cursor
</p>
<p>
    Dim oDispatcher 'Dispatcher for clipboard commands
</p>
<p>
</p>
<p>
    oVCursor = ThisComponent.CurrentController.getViewCursor()
</p>
<p>
    oText = ThisComponent.getText()
</p>
<p>
    oFrame = ThisComponent.CurrentController.Frame
</p>
<p>
    oDispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
</p>
<p>
    If NOT ThisComponent.getTextTables().hasByName(sName) Then
</p>
<p>
    MsgBox "Sorry, the document does not contain table " &amp; sName
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    oTable = ThisComponent.getTextTables().getByName(sName)
</p>
<p>
</p>
<p>
    REM Place the cursor in the start of the first cell.
</p>
<p>
    REM This is very easy!
</p>
<p>
    ThisComponent.CurrentController.select(oTable)
</p>
<p>
    oVCursor.gotoEnd(True) 'Move to the end of the current cell.
</p>
<p>
    oVCursor.gotoEnd(True) 'Move to the end of the table.
</p>
<p>
    REM Copy the table to the clipboard.
</p>
<p>
    oDispatcher.executeDispatch(oFrame, ".uno:Copy", "", 0, Array())
</p>
<p>
    REM Move the cursor to the end of the document and then paste the table.
</p>
<p>
    oVCursor.gotoRange(oText.getEnd(), False)
</p>
<p>
    oDispatcher.executeDispatch(oFrame, ".uno:Paste", "", 0, Array())
</p>
<p>
    End Sub
</p>
<p>
    The clipboard is used by all applications so another application may modify the clipboard while the problem is
    running. The current controller provides access to the transferable content without using the clipboard.
</p>
<p>
    <strong>Listing . </strong>Copy a text table using transferable content.
</p>
<p>
    Sub CopyNamedTableToEndUsingTransferable(sName As String)
</p>
<p>
    Dim oTable 'Table to copy
</p>
<p>
    Dim oText 'Document's text object
</p>
<p>
    Dim oVCursor 'Current view cursor
</p>
<p>
    Dim o 'Transferable content
</p>
<p>
</p>
<p>
    oVCursor = ThisComponent.CurrentController.getViewCursor()
</p>
<p>
    oText = ThisComponent.getText()
</p>
<p>
</p>
<p>
    If NOT ThisComponent.getTextTables().hasByName(sName) Then
</p>
<p>
    MsgBox "Sorry, the document does not contain table " &amp; sName
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    oTable = ThisComponent.getTextTables().getByName(sName)
</p>
<p>
</p>
<p>
    REM Place the cursor in the start of the first cell.
</p>
<p>
    REM This is very easy!
</p>
<p>
    ThisComponent.CurrentController.select(oTable)
</p>
<p>
    oVCursor.gotoEnd(True) 'Move to the end of the current cell.
</p>
<p>
    oVCursor.gotoEnd(True) 'Move to the end of the table.
</p>
<p>
    o = ThisComponent.CurrentController.getTransferable()
</p>
<p>
    REM Move the cursor to the end of the document and then paste the table.
</p>
<p>
    oVCursor.gotoRange(oText.getEnd(), False)
</p>
<p>
    ThisComponent.CurrentController.insertTransferable(o)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="formatting-a-text-table">
                            <span id="anchor-311"></span>Formatting a text table
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    I format text tables using paragraph styles, alternating the background color for each row, and by changing the cell
    borders.
</p>
<p>
    <strong>Listing .</strong> Format a text table.
</p>
<p>
    Sub FormatTable(Optional oUseTable)
</p>
<p>
    Dim oTable
</p>
<p>
    Dim oCell
</p>
<p>
    Dim nRow As Long
</p>
<p>
    Dim nCol As Long
</p>
<p>
</p>
<p>
    If IsMissing(oUseTable) Then
</p>
<p>
    oTable = ThisComponent.CurrentController.getViewCursor().TextTable
</p>
<p>
    Else
</p>
<p>
    oTable = oUseTable
</p>
<p>
    End If
</p>
<p>
    If IsNull(oTable) OR IsEmpty(oTable) Then
</p>
<p>
    Print "FormatTable: No table specified"
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    Dim v
</p>
<p>
    Dim x
</p>
<p>
    v = oTable.TableBorder
</p>
<p>
    x = v.TopLine : x.OuterLineWidth = 2
</p>
<p>
    v.TopLine = x
</p>
<p>
</p>
<p>
    x = v.LeftLine
</p>
<p>
    x.OuterLineWidth = 2
</p>
<p>
    v.LeftLine = x
</p>
<p>
</p>
<p>
    x = v.RightLine
</p>
<p>
    x.OuterLineWidth = 2
</p>
<p>
    v.RightLine = x
</p>
<p>
</p>
<p>
    x = v.TopLine
</p>
<p>
    x.OuterLineWidth = 2
</p>
<p>
    v.TopLine = x
</p>
<p>
</p>
<p>
    x = v.VerticalLine
</p>
<p>
    x.OuterLineWidth = 2
</p>
<p>
    v.VerticalLine = x
</p>
<p>
</p>
<p>
    x = v.HorizontalLine
</p>
<p>
    x.OuterLineWidth = 0
</p>
<p>
    v.HorizontalLine = x
</p>
<p>
</p>
<p>
    x = v.BottomLine
</p>
<p>
    x.OuterLineWidth = 2
</p>
<p>
    v.BottomLine = x
</p>
<p>
    oTable.TableBorder = v
</p>
<p>
    For nRow = 0 To oTable.getRows().getCount() - 1
</p>
<p>
    For nCol = 0 To oTable.getColumns().getCount() - 1
</p>
<p>
    oCell = oTable.getCellByPosition(nCol, nRow)
</p>
<p>
    If nRow = 0 Then
</p>
<p>
    oCell.BackColor = 128
</p>
<p>
    SetParStyle(oCell.getText(), "OOoTableHeader")
</p>
<p>
    Else
</p>
<p>
    SetParStyle(oCell.getText(), "OOoTableText")
</p>
<p>
    If nRow MOD 2 = 1 Then
</p>
<p>
    oCell.BackColor = -1
</p>
<p>
    Else
</p>
<p>
    REM color is (230, 230, 230)
</p>
<p>
    oCell.BackColor = 15132390
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    Each cell has its own text object. The following macro sets every paragraph in a text object to use the same
    paragraph style.
</p>
<p>
    <strong>Listing .</strong> Set the paragraph style for every paragraph in a text object.
</p>
<p>
    Sub SetParStyle(oText, sParStyle As String)
</p>
<p>
    Dim oEnum
</p>
<p>
    Dim oPar
</p>
<p>
    oEnum = oText.createEnumeration()
</p>
<p>
    Do While oEnum.hasMoreElements()
</p>
<p>
    oPar = oEnum.nextElement()
</p>
<p>
    If opar.supportsService("com.sun.star.text.Paragraph") Then
</p>
<p>
    'oPar.ParaConditionalStyleName = sParStyle
</p>
<p>
    oPar.ParaStyleName = sParStyle
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="text-fields">
                    <span id="anchor-312"></span>Text fields
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    A text field is text content that is usually seamlessly inserted into the existing text, but the actual content
    comes from elsewhere<em><em>—</em></em>for example, the total number of pages or a database field. lists the
    standard field types.
</p>
<p>
    <strong>Table . </strong>Text field services starting with com.sun.star.text.TextField.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Annotation
            </td>
            <td>
                Inserted note with string properties Author and Content. The property Date, of type
                com.sun.star.util.Date, contains the date that the note was created.
            </td>
        </tr>
        <tr class="even">
            <td>
                Author
            </td>
            <td>
                Displays the document’s author. The following optional fields may be present:
            </td>
        </tr>
        <tr class="odd">
            <td>
                Bibliography
            </td>
            <td>
                Contains a property named Fields, which is an array of type PropertyValue. This field is dependent on a
                Bibliography text field master.
            </td>
        </tr>
        <tr class="even">
            <td>
                Chapter
            </td>
            <td>
                Chapter information. The Level property is a Byte integer. The ChapterFormat property is a constant
                group of type com.sun.star.text.ChapterFormat with the following valid values:<br /> NAME (0), NUMBER
                (1), NAME_NUMBER (2), NO_PREFIX_SUFFIX (3), or DIGIT (4).
            </td>
        </tr>
        <tr class="odd">
            <td>
                CharacterCount
            </td>
            <td>
                Indicates the number of characters in the document. This contains one property, NumberingType, from the
                constant group com.sun.star.style.NumberingType; valid values are shown in .
            </td>
        </tr>
        <tr class="even">
            <td>
                CombinedCharacters
            </td>
            <td>
                Displays one to six characters and treats them as one character.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ConditionalText
            </td>
            <td>
                Displays text that changes based on a condition in the text field.
            </td>
        </tr>
        <tr class="even">
            <td>
                DDE
            </td>
            <td>
                Displays the result from a DDE connection. Uses a DDE text field master.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Database
            </td>
            <td>
                Database text field used as a mail-merge field. This field depends on a text field master and contains
                the following properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                DatabaseName
            </td>
            <td>
                Display the database name when performing database operations (depends on a text field master) with
                these properties:
            </td>
        </tr>
        <tr class="odd">
            <td>
                DatabaseNextSet
            </td>
            <td>
                Increment a selection (depends on a text field master) with these properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                DatabaseNumberOfSet
            </td>
            <td>
                Display the current database set number (depends on a text field master) with these properties:
            </td>
        </tr>
        <tr class="odd">
            <td>
                DatabaseSetNumber
            </td>
            <td>
                Set the database cursor selection (depends on a text field master) with these properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                DateTime
            </td>
            <td>
                Display a date or time with the following optional properties:
            </td>
        </tr>
        <tr class="odd">
            <td>
                DropDown
            </td>
            <td>
                Display a drop-down field with the following properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                EmbeddedObjectCount
            </td>
            <td>
                Display the number of objects embedded in the document. Contains the NumberingType property; see
                property for valid values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ExtendedUser
            </td>
            <td>
                Display information for the user data (under Tools | Options | OpenOffice.org | User Data) such as name,
                address, or phone number.
            </td>
        </tr>
        <tr class="even">
            <td>
                FileName
            </td>
            <td>
                Display the document file name (URL). Contains the following properties:
            </td>
        </tr>
        <tr class="odd">
            <td>
                GetExpression
            </td>
            <td>
                <p>
                    Display the result from a “SetExpression” text field. (use Insert &gt; Fields &gt; Other, to open
                    the Fields dialog, then navigate to the Cross-references tab).
                </p>
                <p>
                    <em><em>A GetExpression field references a SetExpression field. If you delete the corresponding
                            SetExpression field, the CurrentPresentation says something like “Invalid reference”, but I
                            know of no other way to determine that the reference is no longer valid.</em></em>
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                GetReference
            </td>
            <td>
                Reference field with these properties:
            </td>
        </tr>
        <tr class="odd">
            <td>
                GraphicObjectCount
            </td>
            <td>
                Display the number of graphic objects embedded in the document. Contains the NumberingType property; see
                property for valid values.
            </td>
        </tr>
        <tr class="even">
            <td>
                HiddenParagraph
            </td>
            <td>
                Allow a paragraph to be hidden. Used, for example, to create a test with the questions and answers all
                in one document. Setting the answers to hidden allows the test questions to be printed for the students.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HiddenText
            </td>
            <td>
                A field with hidden text. Differs from a hidden paragraph in that only the text in the field is hidden,
                rather than the entire containing paragraph.
            </td>
        </tr>
        <tr class="even">
            <td>
                Input
            </td>
            <td>
                Text input field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                InputUser
            </td>
            <td>
                User-defined text field that depends on a field master.
            </td>
        </tr>
        <tr class="even">
            <td>
                JumpEdit
            </td>
            <td>
                Placeholder text field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Macro
            </td>
            <td>
                Macro text field.
            </td>
        </tr>
        <tr class="even">
            <td>
                PageCount
            </td>
            <td>
                Display the number of pages in the document. Contains the NumberingType property; see property for valid
                values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PageNumber
            </td>
            <td>
                Display a page number.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParagraphCount
            </td>
            <td>
                Display the number of paragraphs in the document. Contains the NumberingType property; see property for
                valid values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ReferencePageGet
            </td>
            <td>
                Display the page number of a reference point. Contains the NumberingType property; see property for
                valid values.
            </td>
        </tr>
        <tr class="even">
            <td>
                ReferencePageSet
            </td>
            <td>
                Insert additional page numbers. Contains these properties:
            </td>
        </tr>
        <tr class="odd">
            <td>
                Script
            </td>
            <td>
                Display text obtained by running a script. Contains these properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                SetExpression
            </td>
            <td>
                An expression text field (use Insert &gt; Fields &gt; Other, to open the Fields dialog, then navigate to
                the Variables tab). Contains these properties:
            </td>
        </tr>
        <tr class="odd">
            <td>
                TableCount
            </td>
            <td>
                Display the number of tables in the document. Contains the NumberingType property; see property for
                valid values.
            </td>
        </tr>
        <tr class="even">
            <td>
                TemplateName
            </td>
            <td>
                Display the name of the template used to create the document. Supports the FileFormat property as
                supported by the Filename property.
            </td>
        </tr>
        <tr class="odd">
            <td>
                URL
            </td>
            <td>
                Display a URL. Contains these properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                User
            </td>
            <td>
                Display a user-defined field with a field master. Contains these properties:
            </td>
        </tr>
        <tr class="odd">
            <td>
                WordCount
            </td>
            <td>
                Display the number of words in the document. Contains the NumberingType property; see property for valid
                values.
            </td>
        </tr>
        <tr class="even">
            <td>
                docinfo.ChangeAuthor
            </td>
            <td>
                Display the name of the last author to modify the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                docinfo.ChangeDateTime
            </td>
            <td>
                Display the date and time the document was last changed. Contains these properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                docinfo.CreateAuthor
            </td>
            <td>
                Display the name of the author who created the document (see docinfo.ChangeAuthor for supported
                properties).
            </td>
        </tr>
        <tr class="odd">
            <td>
                docinfo.CreateDateTime
            </td>
            <td>
                Display the date and time the document was created (see docinfo.ChangeDateTime for supported
                properties).
            </td>
        </tr>
        <tr class="even">
            <td>
                docinfo.Custom
            </td>
            <td>
                Display the user-defined field in the document information; used to be docinfo.Info0.
            </td>
        </tr>
        <tr class="odd">
            <td>
                docinfo.Description
            </td>
            <td>
                Display the document description as contained in the document properties (File | Properties).
            </td>
        </tr>
        <tr class="even">
            <td>
                docinfo.EditTime
            </td>
            <td>
                Display the duration the document has been edited. In other words, how long did it take to write?
            </td>
        </tr>
        <tr class="odd">
            <td>
                docinfo.Info0
            </td>
            <td>
                Deprecated, use docinfo.Custom instead.
            </td>
        </tr>
        <tr class="even">
            <td>
                docinfo.Info1
            </td>
            <td>
                Deprecated, use docinfo.Custom instead.
            </td>
        </tr>
        <tr class="odd">
            <td>
                docinfo.Info2
            </td>
            <td>
                Deprecated, use docinfo.Custom instead.
            </td>
        </tr>
        <tr class="even">
            <td>
                docinfo.Info3
            </td>
            <td>
                Deprecated, use docinfo.Custom instead.
            </td>
        </tr>
        <tr class="odd">
            <td>
                docinfo.Keywords
            </td>
            <td>
                Display the document info keywords (see docinfo.Description).
            </td>
        </tr>
        <tr class="even">
            <td>
                docinfo.PrintAuthor
            </td>
            <td>
                Display the name of the author who printed the document (see docinfo.ChangeAuthor for supported
                properties).
            </td>
        </tr>
        <tr class="odd">
            <td>
                docinfo.PrintDateTime
            </td>
            <td>
                Display the time the document was last printed (see docinfo.ChangeDateTime for supported properties).
            </td>
        </tr>
        <tr class="even">
            <td>
                docinfo.Revision
            </td>
            <td>
                Display the current document revision (see docinfo.Description).
            </td>
        </tr>
        <tr class="odd">
            <td>
                docinfo.Subject
            </td>
            <td>
                Display the document subject specified in the document information (see docinfo.Description).
            </td>
        </tr>
        <tr class="even">
            <td>
                docinfo.Title
            </td>
            <td>
                Display the document title specified in the document information (see docinfo.Description).
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The Annotation field is a service of type com.sun.star.text.TextField.Annotation. Some sources of
                documentation show the text “textfield” in all lowercase letters; this is incorrect. The code in
                <strong> </strong>shows this correctly.
            </td>
        </tr>
    </tbody>
</table>
<p>
    contains the valid values for the CharacterCount property from . Most API listings stop at CIRCLE_NUMBER=14, I do
    not know why.
</p>
<p>
    <strong>Table . </strong>Constants defined by com.sun.star.style.NumberingType.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CHARS_UPPER_LETTER
            </td>
            <td>
                Numbering is in uppercase letters as “A, B, C, D, ...”.
            </td>
        </tr>
        <tr class="even">
            <td>
                CHARS_LOWER_LETTER
            </td>
            <td>
                Numbering is in lowercase letters as “a, b, c, d,...”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ROMAN_UPPER
            </td>
            <td>
                Numbering is in Roman numbers with uppercase letters as “I, II, III, IV, ...”.
            </td>
        </tr>
        <tr class="even">
            <td>
                ROMAN_LOWER
            </td>
            <td>
                Numbering is in Roman numbers with lowercase letters as “i, ii, iii, iv, ...”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ARABIC
            </td>
            <td>
                Numbering is in Arabic numbers as “1, 2, 3, 4, ...”.
            </td>
        </tr>
        <tr class="even">
            <td>
                NUMBER_NONE
            </td>
            <td>
                Numbering is invisible.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CHAR_SPECIAL
            </td>
            <td>
                Use a character from a specified font.
            </td>
        </tr>
        <tr class="even">
            <td>
                PAGE_DESCRIPTOR
            </td>
            <td>
                Numbering is specified in the page style.
            </td>
        </tr>
        <tr class="odd">
            <td>
                BITMAP
            </td>
            <td>
                Numbering is displayed as a bitmap graphic.
            </td>
        </tr>
        <tr class="even">
            <td>
                CHARS_UPPER_LETTER_N
            </td>
            <td>
                Numbering is in uppercase letters as “A, B, ..., Y, Z, AA, BB, CC, ... AAA, ...”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CHARS_LOWER_LETTER_N
            </td>
            <td>
                Numbering is in lowercase letters as “a, b, ..., y, z, aa, bb, cc, ... aaa, ...”.
            </td>
        </tr>
        <tr class="even">
            <td>
                TRANSLITERATION
            </td>
            <td>
                A transliteration module is used to produce numbers in Chinese, Japanese, etc.
            </td>
        </tr>
        <tr class="odd">
            <td>
                NATIVE_NUMBERING
            </td>
            <td>
                The native-number-supplier service is called to produce numbers in native languages.
            </td>
        </tr>
        <tr class="even">
            <td>
                FULLWIDTH_ARABIC
            </td>
            <td>
                Numbering for full-width Arabic number.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CIRCLE_NUMBER
            </td>
            <td>
                Bullet for Circle Number.
            </td>
        </tr>
        <tr class="even">
            <td>
                NUMBER_LOWER_ZH
            </td>
            <td>
                Numbering for Chinese lowercase numbers.
            </td>
        </tr>
        <tr class="odd">
            <td>
                NUMBER_UPPER_ZH
            </td>
            <td>
                Numbering for Chinese uppercase numbers.
            </td>
        </tr>
        <tr class="even">
            <td>
                NUMBER_UPPER_ZH_TW
            </td>
            <td>
                Numbering for Traditional Chinese uppercase numbers.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TIAN_GAN_ZH
            </td>
            <td>
                Bullet for Chinese Tian Gan.
            </td>
        </tr>
        <tr class="even">
            <td>
                DI_ZI_ZH
            </td>
            <td>
                Bullet for Chinese Di Zi.
            </td>
        </tr>
        <tr class="odd">
            <td>
                NUMBER_TRADITIONAL_JA
            </td>
            <td>
                Numbering for Japanese traditional numbers.
            </td>
        </tr>
        <tr class="even">
            <td>
                AIU_FULLWIDTH_JA
            </td>
            <td>
                Bullet for Japanese AIU full width.
            </td>
        </tr>
        <tr class="odd">
            <td>
                AIU_HALFWIDTH_JA
            </td>
            <td>
                Bullet for Japanese AIU half width.
            </td>
        </tr>
        <tr class="even">
            <td>
                IROHA_FULLWIDTH_JA
            </td>
            <td>
                Bullet for Japanese IROHA full width.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IROHA_HALFWIDTH_JA
            </td>
            <td>
                Bullet for Japanese IROHA half width.
            </td>
        </tr>
        <tr class="even">
            <td>
                NUMBER_UPPER_KO
            </td>
            <td>
                Numbering for Korean uppercase numbers.
            </td>
        </tr>
        <tr class="odd">
            <td>
                NUMBER_HANGUL_KO
            </td>
            <td>
                Numbering for Korean hangul numbers.
            </td>
        </tr>
        <tr class="even">
            <td>
                HANGUL_JAMO_KO
            </td>
            <td>
                Bullet for Korean Hangul Jamo.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HANGUL_SYLLABLE_KO
            </td>
            <td>
                Bullet for Korean Hangul Syllable.
            </td>
        </tr>
        <tr class="even">
            <td>
                HANGUL_CIRCLED_JAMO_KO
            </td>
            <td>
                Bullet for Korean Hangul Circled Jamo.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HANGUL_CIRCLED_SYLLABLE_KO
            </td>
            <td>
                Bullet for Korean Hangul Circled Syllable.
            </td>
        </tr>
        <tr class="even">
            <td>
                CHARS_ARABIC
            </td>
            <td>
                Numbering in Arabic alphabet letters.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CHARS_THAI
            </td>
            <td>
                Numbering in Thai alphabet letters.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The text fields contained in the document are available using the getTextFields() object method (see ). Every text
    field object supports the object method getPresentation(boolean), which returns a string representing either the
    field type (True) or the displayed text (False). See <strong></strong> and <strong></strong>.
</p>
<p>
    <strong>Listing . </strong>Display Fields.
</p>
<p>
    Sub DisplayFields
</p>
<p>
    oEnum = ThisComponent.getTextFields().createEnumeration()
</p>
<p>
    Do While oEnum.hasMoreElements()
</p>
<p>
    oField = oEnum.nextElement()
</p>
<p>
    s = s &amp; oField.getPresentation(True) &amp; " = " 'Field type
</p>
<p>
    If oField.supportsService("com.sun.star.text.TextField.Annotation") Then
</p>
<p>
    REM More cryptic, I could use If oField.getPresentation(True) = "Note"...
</p>
<p>
    REM A "Note" has no displayed content so calling getPresentation(False)
</p>
<p>
    REM returns an empty string. Instead, obtain the author and the content.
</p>
<p>
    s = s &amp; oField.Author &amp; " says " &amp; oField.Content
</p>
<p>
    Else
</p>
<p>
    s = s &amp; oField.getPresentation(False) 'String content
</p>
<p>
    End If
</p>
<p>
    s = s &amp; CHR$(13)
</p>
<p>
    Loop
</p>
<p>
    MsgBox s, 0, "Text Fields"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/1000000000000384000001E7C676846D.gif" style="width:2.5035in;height:1.3516in" />
</p>
<p>
    <strong>Figure . </strong>Text fields in the current document.
</p>
<p>
    The source document used to create contains a DateTime field, PageNumber fields, Annotation field, and a User field.
    The code in provides special treatment for note fields to display both the author and the note. The field is checked
    to see if it supports the Annotation service by using the supportsServiceObject() method.
</p>
<p>
    The primary method of finding a specific text field is by enumerating the text fields as shown in . If the document
    is large and contains many text fields, it may take a long time to find a specific text field. If you know where the
    text field is located in the document, demonstrates how to find a text field by enumerating text content in a
    paragraph.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Text fields implement the object method update(). The update() method causes a text field to update
                itself with the most current information if it is applicable. For example, date/time, file name, and the
                document information text fields all update to the most current information.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="text-master-fields">
                            <span id="anchor-313"></span>Text master fields
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Some text fields contain their own content, and others rely on an external source to obtain the displayed
    information. The external source is called a master field. lists the text field types that require a master field.
    Besides the properties shown in , every text field master also supports the properties shown in .
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The object method getTextFieldMaster() returns a text field’s master field. Unfortunately, every field,
                even fields that do not have master fields, implements this method and returns a non-null master field.
                OOo may crash if you obtain and manipulate a master field from a field that does not contain one.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Although text fields are accessible only by enumeration, master fields are accessible by name and enumeration (see
    ). The name used for a master field is obtained by appending the field name to the field master type. For example,
    the User field “AndyField”, as shown in , has a master field named com.sun.star.text.FieldMaster.User.AndyField.
    Database master fields are named differently than all of the other master fields; they append the DatabaseName,
    DatatableName, and DataColumnName to the service name. demonstrates how to obtain the text field masters in a
    document. shows the results.
</p>
<p>
    <strong>Table . </strong>Text field services starting with com.sun.star.text.FieldMaster.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Bibliography
            </td>
            <td>
                Field master to a Bibliography text field. Contains these properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                DDE
            </td>
            <td>
                Field master to a DDE text field. Contains these properties:
            </td>
        </tr>
        <tr class="odd">
            <td>
                Database
            </td>
            <td>
                Field master to a Database text field. Contains these properties:
            </td>
        </tr>
        <tr class="even">
            <td>
                SetExpression
            </td>
            <td>
                Field master to a “set expression” text field. Contains these properties:
            </td>
        </tr>
        <tr class="odd">
            <td>
                User
            </td>
            <td>
                Field master to a user text field. Contains the properties:
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table . </strong>Properties defined by the service com.sun.star.text.FieldMaster.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Name
            </td>
            <td>
                Optional string with the field name; this must be set before the field is added to the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                DependentTextFields
            </td>
            <td>
                Array of text fields that use this master field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                InstanceName
            </td>
            <td>
                String instance name as it is used in the XTextFieldsSupplier.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing . </strong>Show text field masters.
</p>
<p>
    Sub ShowFieldMasters
</p>
<p>
    Dim oMasters 'All of the text field masters
</p>
<p>
    Dim oMasterNames 'Array of the text field master names
</p>
<p>
    Dim i%, j% 'Index variables
</p>
<p>
    Dim sMasterName$ 'Full name of the master field
</p>
<p>
    Dim s$ 'Utility string
</p>
<p>
    Dim oMaster 'Master field
</p>
<p>
    REM Obtain the text field masters object.
</p>
<p>
    oMasters = ThisComponent.getTextFieldMasters()
</p>
<p>
    REM Obtain ALL of the text master field names.
</p>
<p>
    REM This is an array of strings.
</p>
<p>
    oMasterNames = oMasters.getElementNames()
</p>
<p>
    For i = LBound(oMasterNames) to UBound(oMasterNames)
</p>
<p>
</p>
<p>
    REM For a given name, obtain the master field,
</p>
<p>
    REM then look at the DependentTextFields property,
</p>
<p>
    REM which is an array of text fields that depend
</p>
<p>
    REM on this master field.
</p>
<p>
    sMasterName = oMasterNames(i)
</p>
<p>
    oMaster = oMasters.getByName(sMasterName)
</p>
<p>
    s = s &amp; "***" &amp; sMasterName &amp; "***" &amp; CHR$(10)
</p>
<p>
    s = s &amp; oMaster.Name &amp; " Contains " &amp;_
</p>
<p>
    CStr(UBound(oMaster.DependentTextFields) + 1) &amp;_
</p>
<p>
    " dependent fields" &amp; CHR$(10)
</p>
<p>
    s = s &amp; CHR$(13)
</p>
<p>
    Next I
</p>
<p>
    REM Directly obtain a master field based on the name.
</p>
<p>
    REM This is a user field that I added to the source code file.
</p>
<p>
    If oMasters.hasByName("com.sun.star.text.FieldMaster.User.AndyField") Then
</p>
<p>
    oMaster=oMasters.getByName("com.sun.star.text.FieldMaster.User.AndyField")
</p>
<p>
    s = s &amp; "Directly obtained the field master " &amp; oMaster.Name &amp; CHR$(10) &amp;_
</p>
<p>
    "The field contains the text " &amp; oMaster.Content
</p>
<p>
    End If
</p>
<p>
    MsgBox s, 0, "Text Field Masters"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000004B00000041E51634F2E.gif" style="width:3.5217in;height:2.8693in" />
</p>
<p>
    <strong>Figure . </strong>Text master fields in the current document.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="creating-and-adding-text-fields">
                            <span id="anchor-314"></span>Creating and adding text fields
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Text fields must be created by the document that will contain them. It is also the document that will destroy them
    if you choose to remove them from the document. demonstrates the creation, configuration, and insertion of both a
    DateTime text field and an Annotation text field. The text fields are appended to the end of the document. The
    DateTime text field is formatted in an unusual manner, so a new number format style is created if it does not yet
    exist.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The very popular routine FindCreateNumberFormatStyle (see ) is used by .
            </td>
        </tr>
    </tbody>
</table>
<p>
    What is required to properly insert an annotation field has changed over time and may differ between AOO and LO.
    When OOo, inserting an annotation set the insertion date to the current time. My latest testing with LO 4.0.1.2 does
    not set a date. In LO, there is a Date property, which seems to be ignored. To set the date, ou must set the
    DateTimeValue property instead. The insertion date/time must be set before the text field is inserted, the date/time
    cannot be changed after. I have not tested this particular macro with AOO.
</p>
<p>
    <strong>Listing . </strong>Insert text fields.
</p>
<p>
    Sub InsertFields
</p>
<p>
    Dim oText 'Text object for the current document
</p>
<p>
    Dim oField 'Field to insert
</p>
<p>
    Dim oDoc 'oDoc is fewer characters than ThisComponent
</p>
<p>
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    oText = oDoc.Text
</p>
<p>
</p>
<p>
    REM Start by inserting a date time text field at the end of the
</p>
<p>
    REM document. Format the date time as "DD. MMM YYYY"
</p>
<p>
    REM Insert some explanatory text before the newly inserted field.
</p>
<p>
    oText.insertString(oText.getEnd(), "Today is ", FALSE)
</p>
<p>
</p>
<p>
    REM Create a date time field.
</p>
<p>
    oField = oDoc.createInstance("com.sun.star.text.TextField.DateTime")
</p>
<p>
    oField.IsFixed = TRUE
</p>
<p>
    oField.NumberFormat = FindCreateNumberFormatStyle("DD. MMMM YYYY", oDoc)
</p>
<p>
    oText.insertTextContent(oText.getEnd(), oField, False)
</p>
<p>
    REM Now, insert an Annotation after the inserted text field.
</p>
<p>
    REM Lie about the date and say that I did it a little while ago!
</p>
<p>
    Dim oDate As New com.sun.star.util.Date
</p>
<p>
    Dim oRightNow
</p>
<p>
    oRightNow = Now
</p>
<p>
    With oDate
</p>
<p>
    .Day = Day(oRightNow - 10)
</p>
<p>
    .Month = Month(oRightNow - 10)
</p>
<p>
    .Year = Year(oRightNow - 10)
</p>
<p>
    End With
</p>
<p>
</p>
<p>
    Dim oDT As New com.sun.star.util.DateTime
</p>
<p>
    With oDT
</p>
<p>
    .Day = Day(oRightNow - 10)
</p>
<p>
    .Month = Month(oRightNow - 10)
</p>
<p>
    .Year = Year(oRightNow - 10)
</p>
<p>
    .Hours = 4
</p>
<p>
    .Minutes = 5
</p>
<p>
    .Seconds = 6
</p>
<p>
    .HundredthSeconds = 0
</p>
<p>
    End With
</p>
<p>
    REM Like most text content, the field must be created by the document
</p>
<p>
    REM that will contain it.
</p>
<p>
    REM In LO, setting the Date field does nothing.
</p>
<p>
    oField = oDoc.createInstance("com.sun.star.text.TextField.Annotation")
</p>
<p>
    With oField
</p>
<p>
    .Author = "AP"
</p>
<p>
    .Content = "This note is next to a date field that I just added"
</p>
<p>
    .Date = oDate
</p>
<p>
    .DateTimeValue = oDT
</p>
<p>
    End With
</p>
<p>
    oText.insertTextContent(oText.getEnd(), oField, False)
</p>
<p>
    MsgBox "Two fields inserted at the end of the document"
</p>
<p>
    End Sub
</p>
<p>
    Inserting a field that requires a text field master is slightly more difficult than inserting a regular text field.
    Both the master field and the dependent text field must be created by the document using the object method
    createInstance(). The master field must be named before it is used; after inserting a field into a document, you
    cannot change the name. The dependent field is attached to the master field, which provides the content to the
    dependent field. The dependent field, not the master field, is inserted as text content into the document. The
    dependent field can be removed from the document by using the removeTextContent() object method. To remove the
    master field, use the dispose() method of the master field.
</p>
<p>
    demonstrates the use of master fields by performing various operations on a master field named “TestField”. Three
    specific states are checked and appropriate behavior is taken as follows:
</p>
<p>
    If the master field does not exist, the master field and a dependent field are created and inserted into the
    document. The field is now visible by opening the Field dialog using Insert | Fields | Other and choosing the
    Variables tab.
</p>
<p>
    If the master field exists with a corresponding dependent field, the dependent field is removed from the document.
    The master field still exists, but no dependent field is inserted in the document. You can view the master field by
    using the Field dialog.
</p>
<p>
    If the master field exists and has no corresponding dependent field, the master field is removed by using the
    dispose() object method. The Field dialog no longer shows the master field.
</p>
<p>
    <strong>Listing . </strong>Insert field master.
</p>
<p>
    Sub InsertFieldMaster
</p>
<p>
    Dim oMasters 'All of the text field masters
</p>
<p>
    Dim oText 'Text object for the current document
</p>
<p>
    Dim oUField 'User field to insert
</p>
<p>
    Dim oMField 'The master field for the user field
</p>
<p>
    Dim oDoc 'oDoc is fewer characters than ThisComponent
</p>
<p>
    Dim sLead$ 'Leading field name
</p>
<p>
    Dim sName$ 'Name of the field to remove or insert
</p>
<p>
    Dim sTotName$ 'The entire name
</p>
<p>
    REM Set the names.
</p>
<p>
    sName = "TestField"
</p>
<p>
    sLead = "com.sun.star.text.FieldMaster.User"
</p>
<p>
    sTotName = sLead &amp; "." &amp; sName
</p>
<p>
    REM Initialize some values.
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    oText = oDoc.Text
</p>
<p>
    oMasters = ThisComponent.getTextFieldMasters()
</p>
<p>
    REM If the master field already exists, then perform special handling.
</p>
<p>
    REM Special handling is for illustrative purposes only, not that it
</p>
<p>
    REM solves any particularly fun and exciting problem.
</p>
<p>
    If oMasters.hasByName(sTotName) Then
</p>
<p>
    REM Obtain the master field and the fields dependent on this field.
</p>
<p>
    oMField = oMasters.getByName(sTotName)
</p>
<p>
</p>
<p>
    REM If there are fields dependent on this field then
</p>
<p>
    REM the array of dependent fields has values!
</p>
<p>
    If UBound(oMField.DependentTextFields) &gt;= 0 Then
</p>
<p>
    REM Remove the text content and it disappears from the
</p>
<p>
    REM document. The master field still exists, however!
</p>
<p>
    oUField = oMField.DependentTextFields(0)
</p>
<p>
    oText.removeTextContent(oUField)
</p>
<p>
    MsgBox "Removed one instance from the document"
</p>
<p>
    Else
</p>
<p>
    REM I arbitrarily decided that I would destroy the master field
</p>
<p>
    REM but I could just as easily create a new user field and
</p>
<p>
    REM attach it to the existing master field and then insert
</p>
<p>
    REM the new field into the document.
</p>
<p>
    MsgBox "No instances in the document, disposing master field"
</p>
<p>
    oMField.content=""
</p>
<p>
    oMField.dispose()
</p>
<p>
    End If
</p>
<p>
    Else
</p>
<p>
    REM Create a User text field that requires a master field.
</p>
<p>
    oUField = oDoc.createInstance("com.sun.star.text.TextField.User")
</p>
<p>
</p>
<p>
    REM Now create the master field.
</p>
<p>
    Dim oMasterField
</p>
<p>
    oMasterField = oDoc.createInstance(sLead)
</p>
<p>
</p>
<p>
    REM You CANNOT change the name of a master field AFTER it is inserted
</p>
<p>
    REM into a document so you must set it now.
</p>
<p>
    oMasterField.Name = sName
</p>
<p>
</p>
<p>
    REM This is the data that will be displayed. Remember that the
</p>
<p>
    REM user field displays what the master tells it to display.
</p>
<p>
    oMasterField.Content = "Hello"
</p>
<p>
</p>
<p>
    REM A user field must be attached to a master field.
</p>
<p>
    REM The user field is now a "DependentTextField".
</p>
<p>
    oUField.attachTextFieldMaster(oMasterField)
</p>
<p>
</p>
<p>
    REM Insert the user field into the document.
</p>
<p>
    oText.insertTextContent(oText.getEnd(), oUField, False)
</p>
<p>
    MsgBox "One field inserted at the end of the document"
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="bookmarks">
                    <span id="anchor-315"></span>Bookmarks
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    A bookmark is text content that is accessible based on its name. A bookmark may encompass a text range or a single
    point. inserts text content at the point where a bookmark is anchored. Use the getString() object method to obtain
    the string contained in the bookmark. Use setString() to set the string contained in the bookmark. If the bookmark
    is merely a point, the text is merely inserted before the bookmark. When a created bookmark is inserted into the
    text, the insertion point determines the bookmark’s anchor position.
</p>
<p>
    <strong>Listing .</strong> Demonstrate how to add a bookmark.
</p>
<p>
    Sub AddBookmark
</p>
<p>
    Dim oBookmark 'Created bookmark to add
</p>
<p>
    Dim oCurs 'Text cursor
</p>
<p>
</p>
<p>
    REM Create a text cursor that contains the last four characters
</p>
<p>
    REM in the document.
</p>
<p>
    oCurs = ThisComponent.Text.createTextCursor()
</p>
<p>
    oCurs.gotoEnd(False)
</p>
<p>
    oCurs.goLeft(4, True)
</p>
<p>
    REM Create the bookmark.
</p>
<p>
    oBookmark = ThisComponent.createInstance("com.sun.star.text.Bookmark")
</p>
<p>
</p>
<p>
    REM If the bookmark is not given a name, OOo will create a name.
</p>
<p>
    REM If the name already exists, a number is appended to the name.
</p>
<p>
    oBookmark.setName("Bobert")
</p>
<p>
</p>
<p>
    REM Because True is used, the bookmark contains the last four characters
</p>
<p>
    REM in the document. If False is used instead, then the bookmark
</p>
<p>
    REM contains no characters and it is positioned before the fourth character
</p>
<p>
    REM from the end of the document.
</p>
<p>
    ThisComponent.Text.insertTextContent(oCurs, oBookmark, False)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="sequence-fields-references-and-formatting">
                    <span id="anchor-316"></span>Sequence fields, references, and formatting
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Consider the caption for . Ignoring formatting, enter the caption as follows:
</p>
<ol type="1">
    <li>
        Enter the text “Listing ”.
    </li>
    <li>
        Use Insert &gt; Fields &gt; Other to open the Fields dialog.
    </li>
    <li>
        Select the Variables tab.
    </li>
    <li>
        Select the Number Range type .
    </li>
    <li>
        Enter <em>Listing</em> for name and Listing + 1 for the value.
    </li>
    <li>
        Click Insert.
    </li>
    <li>
        Enter the rest of the caption.
    </li>
</ol>
<p>
    Sequence fields (number ranges) work well because they automatically renumber as captions are added and removed. A
    reference to a sequence field renumbers if the field itself changes value because a field is added or removed.
</p>
<p>
    I had a collection of documents containing hundreds of captions and references. Unfortunately, all captions and
    references were text as opposed to fields. I needed a macro to convert the text captions and references to use
    sequence fields and linked cross references.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="formatting-numbers-and-dates">
                            <span id="anchor-317"></span>Formatting numbers and dates
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Sequence fields can be formatted in many ways. Ultimately, the formatting is associated to a defined format string.
    OOo is configured to know many common number and date formats, and you can create new formats as you desire. Each
    number format is assigned a numeric ID. Things that format numbers and dates – such as fields and table cells –
    contain the numeric key for the formatting string used to display the contained value.
</p>
<h4 id="list-formats-known-to-the-current-document">
    <span id="anchor-318"></span>List formats known to the current document
</h4>
<p>
    When you create a new number format, the format is stored in the current document. The supported numeric formats and
    the ID for a specific format will differ from document to document.
</p>
<p>
    <strong>Listing .</strong> List the formats in the current document.
</p>
<p>
    Sub ListFormatsInCurrentDocument()
</p>
<p>
    Dim oDoc ' Document created to hold the format strings.
</p>
<p>
    Dim oFormats ' Formats in the current document.
</p>
<p>
    Dim oFormat ' Current format object.
</p>
<p>
    Dim oData ' Keys queried from the formats.
</p>
<p>
    Dim i% ' General index variable.
</p>
<p>
    Dim sFormat$ ' Current format string.
</p>
<p>
    Dim sPrevFormat$ ' Previous format string.
</p>
<p>
    Dim aLocale as new com.sun.star.lang.Locale
</p>
<p>
    oFormats = ThisComponent.getNumberFormats()
</p>
<p>
</p>
<p>
    ' Create an output document.
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL( "private:factory/swriter", "_blank", 0, Array() )
</p>
<p>
    oData = oFormats.queryKeys(com.sun.star.util.NumberFormat.ALL, aLocale, False)
</p>
<p>
    For i = LBound(oData) To UBound(oData)
</p>
<p>
    oFormat=oFormats.getbykey(oData(i))
</p>
<p>
    sFormat=oFormat.FormatString
</p>
<p>
    If sFormat&lt;&gt;sPrevFormat Then
</p>
<p>
    sPrevFormat=sFormat
</p>
<p>
    oDoc.getText().insertString(oDoc.getText().End, _
</p>
<p>
    CStr(oData(i)) &amp; CHR$(9) &amp; sFormat &amp; CHR$(10), False)
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<h4 id="find-or-create-a-numeric-format.">
    <span id="anchor-319"></span>Find or create a numeric format.
</h4>
<p>
    When a number format is added, it may be modified and stored in a slightly different format. QueryKey searches the
    internal modified query strings without first modifying the input string. The end result is that after storing a key
    queryKey will claim that the format string is not present. If you then dutifully, add the format string, an
    exception will be thrown because it already exists.
</p>
<ol type="1">
    <li>
        Adding "#,##0.00_);[Red](#,##0.000)" stores "#,##0.00_);[RED](#,##0.000)"; red is converted to upper case (see
        <a
            href="https://issues.apache.org/ooo/show_bug.cgi?id=72380">https://issues.apache.org/ooo/show_bug.cgi?id=72380</a>).
    </li>
    <li>
        While storing, "##0,0#\h" is changed to "##,00#\h".
    </li>
</ol>
<p>
    The usual advice is to use a number format that does not change.
</p>
<p>
    returns the ID that identifies the specified format. The returned ID can be used to format a value. If you add a
    format and then the format is not available, make note of the format ID and use to display the formats in the
    modified form.
</p>
<p>
    <strong>Listing .</strong> Find or create a numeric format.
</p>
<p>
    'sFormat – Format to find / create.
</p>
<p>
    'oDoc - Document to use. If omitted, the current document is used.
</p>
<p>
    'locale - Locale to use. If omitted, the default locale is used.
</p>
<p>
    Function FindCreateNumberFormatStyle (sFormat$, Optional oDoc, Optional locale)
</p>
<p>
    Dim oDocument As Object
</p>
<p>
    Dim aLocale as new com.sun.star.lang.Locale
</p>
<p>
    Dim oFormats As Object
</p>
<p>
    Dim formatNum As Long
</p>
<p>
    oDocument = IIf(IsMissing(oDoc), ThisComponent, oDoc)
</p>
<p>
    oFormats = oDocument.getNumberFormats()
</p>
<p>
    'I could set the locale from values stored at
</p>
<p>
    'http://www.ics.uci.edu/pub/ietf/http/related/iso639.txt
</p>
<p>
    'http://www.chemie.fu-berlin.de/diverse/doc/ISO_3166.html
</p>
<p>
    'I use a NULL locale and let it use what ever it likes.
</p>
<p>
    'First, see if the number format exists
</p>
<p>
    If ( Not IsMissing(locale)) Then
</p>
<p>
    aLocale = locale
</p>
<p>
    End If
</p>
<p>
    formatNum = oFormats.queryKey (sFormat, aLocale, TRUE)
</p>
<p>
    'MsgBox "Current Format number is" &amp; formatNum
</p>
<p>
    'If the number format does not exist then add it
</p>
<p>
    If (formatNum = -1) Then
</p>
<p>
    formatNum = oFormats.addNew(sFormat, aLocale)
</p>
<p>
    If (formatNum = -1) Then formatNum = 0
</p>
<p>
    'MsgBox "new Format number is " &amp; formatNum
</p>
<p>
    End If
</p>
<p>
    FindCreateNumberFormatStyle = formatNum
</p>
<p>
    End Function
</p>
<h4 id="default-formats">
    <span id="anchor-320"></span>Default formats
</h4>
<p>
    It is possible to get formats of a specific type without manually specifying the format using the getStandardFormat
    method on the Formats object. Specify the desired format using the NumberFormat constant group. Consider this
    snippet to set cells in Calc to the local currency format:
</p>
<p>
    oFormats = oDoc.NumberFormats
</p>
<p>
    Dim aLocale As New com.sun.star.lang.Locale
</p>
<p>
    oRange = oSheet.getCellRangeByName("D2:F19")
</p>
<p>
    oRange.NumberFormat = oFormats.getStandardFormat(_
</p>
<p>
    com.sun.star.util.NumberFormat.CURRENCY, aLocale)
</p>
<p>
    <strong>Table .</strong> Constants for the com.sun.star.util.NumberFormat constant group.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Value
            </td>
            <td>
                Name
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                0
            </td>
            <td>
                ALL
            </td>
            <td>
                selects all number formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                DEFINED
            </td>
            <td>
                selects only user-defined number formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                DATE
            </td>
            <td>
                selects date formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                TIME
            </td>
            <td>
                selects time formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                CURRENCY
            </td>
            <td>
                selects currency formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                16
            </td>
            <td>
                NUMBER
            </td>
            <td>
                selects decimal number formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                32
            </td>
            <td>
                SCIENTIFIC
            </td>
            <td>
                selects scientific number formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                64
            </td>
            <td>
                FRACTION
            </td>
            <td>
                selects number formats for fractions.
            </td>
        </tr>
        <tr class="even">
            <td>
                128
            </td>
            <td>
                PERCENT
            </td>
            <td>
                selects percentage number formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                256
            </td>
            <td>
                TEXT
            </td>
            <td>
                selects text number formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                6
            </td>
            <td>
                DATETIME
            </td>
            <td>
                selects number formats which contain date and time.
            </td>
        </tr>
        <tr class="odd">
            <td>
                1024
            </td>
            <td>
                LOGICAL
            </td>
            <td>
                selects boolean number formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                2048
            </td>
            <td>
                UNDEFINED
            </td>
            <td>
                is used as a return value if no format exists.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="create-a-field-master">
                            <span id="anchor-321"></span>Create a field master
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A <em>Listing</em> sequence field is associated to the com.sun.star.text.FieldMaster.SetExpression.Listing master
    field, which must exist before the sequence field can be used. Demonstrates how to create a master field if it does
    not exist, and how to get the master field if it does.
</p>
<p>
    <strong>Listing .</strong> Creating a master field.
</p>
<p>
    oMasters = oDoc.getTextFieldMasters
</p>
<p>
    If NOT oMasters.hasByName("com.sun.star.text.FieldMaster.SetExpression.Listing") Then
</p>
<p>
    oMasterField = oDoc.createInstance("com.sun.star.text.FieldMaster.SetExpression")
</p>
<p>
    oMasterField.Name = "Listing"
</p>
<p>
    oMasterField.SubType = com.sun.star.text.SetVariableType.SEQUENCE
</p>
<p>
    Else
</p>
<p>
    oMasterField = oMasters.getByName("com.sun.star.text.FieldMaster.SetExpression.Listing")
</p>
<p>
    End If
</p>
<p>
    The master field sub-type determines the field type (see ).
</p>
<p>
    <strong>Table .</strong> Constants for com.sun.star.text.SetVariableType.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                com.sun.star.text.SetVariableType.VAR
            </td>
            <td>
                Simple variable.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                com.sun.star.text.SetVariableType.SEQUENCE
            </td>
            <td>
                Number sequence field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                com.sun.star.text.SetVariableType.FORMULA
            </td>
            <td>
                Formula field.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                com.sun.star.text.SetVariableType.STRING
            </td>
            <td>
                String field.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="insert-a-sequence-field">
                            <span id="anchor-322"></span>Insert a sequence field
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The sequence field is created by the document, then the numbering type is set to arabic. The number format is set,
    the master field is associated to the field (the master field is a sequence field), and then the field content is
    set to increment the value (Listing + 1). Note that when the field is inserted, the field may not be immediately
    updated. Either wait for the field to update, or force an update using Tools &gt; Update &gt; Fields.
</p>
<p>
    <strong>Listing .</strong> Creating a set expression sequence field.
</p>
<p>
    oField = oDoc.createInstance("com.sun.star.text.TextField.SetExpression")
</p>
<p>
    oField.NumberingType = com.sun.star.style.NumberingType.ARABIC
</p>
<p>
    oField.NumberFormat = FindCreateNumberFormatStyle("###0", oDoc)
</p>
<p>
    oField.attachTextFieldMaster(oMasterField)
</p>
<p>
    oField.Content = name &amp; " + 1"
</p>
<p>
    Constants used to set the numbering type are set as shown in the .
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="replace-text-with-a-sequence-field">
                            <span id="anchor-323"></span>Replace text with a sequence field
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Finally, the main working macro to find the text and replace it with a sequence field. The location to insert the
    sequence field is found by searching for a regular expression. The regular expression "^Listing
    [:digit:]+\.[:space:]+" searches for a line that begins with the text “Listing”, followed by a space, one or more
    numeric digits, a period, and one or more spaces; for example, “Listing 12. ”.
</p>
<p>
    <strong>Listing .</strong> Replace text with sequence fields.
</p>
<p>
    Function FindReplaceTextFields(oDoc, name$) As Integer
</p>
<p>
    Dim oDescriptor ' Search descriptor used to find the captions.
</p>
<p>
    Dim oFound ' Text matching the search descriptor.
</p>
<p>
    Dim oMasters ' Master fields in this document.
</p>
<p>
    Dim oMasterField ' The associated master field.
</p>
<p>
    Dim oFrame ' Documents main frame, used for dispatches.
</p>
<p>
    Dim oDispatcher ' Dispatcher object.
</p>
<p>
    Dim oCurs ' Text cursor used to insert text content.
</p>
<p>
    Dim oField ' Sequence field to insert.
</p>
<p>
    Dim formatNum&amp; ' ID (Key) for the format for the field.
</p>
<p>
    Dim i As Integer ' General index variable.
</p>
<p>
    'Assume that no text fields are inserted.
</p>
<p>
    FindReplaceTextFields = 0
</p>
<p>
    'What number format to use for the field.
</p>
<p>
    formatNum = FindCreateNumberFormatStyle("###0", oDoc)
</p>
<p>
    ' Create the master field if needed.
</p>
<p>
    oMasters = oDoc.getTextFieldMasters
</p>
<p>
    If NOT oMasters.hasByName("com.sun.star.text.FieldMaster.SetExpression." &amp; name) Then
</p>
<p>
    oMasterField = oDoc.createInstance("com.sun.star.text.FieldMaster.SetExpression")
</p>
<p>
    oMasterField.Name = name
</p>
<p>
    oMasterField.SubType = com.sun.star.text.SetVariableType.SEQUENCE
</p>
<p>
    Else
</p>
<p>
    oMasterField = oMasters.getByName("com.sun.star.text.FieldMaster.SetExpression." &amp; name)
</p>
<p>
    End If
</p>
<p>
    'Search for a line beginning with the name, a space, a number, a period, and a space.
</p>
<p>
    oDescriptor = oDoc.createSearchDescriptor()
</p>
<p>
    With oDescriptor
</p>
<p>
    .SearchString = "^" &amp; name &amp; " [:digit:]+\.[:space:]+"
</p>
<p>
    .SearchRegularExpression = True
</p>
<p>
    End With
</p>
<p>
    'Prepare to issue a dispatch to clear formatting.
</p>
<p>
    oFrame = oDoc.CurrentController.Frame
</p>
<p>
    oDispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
    'Begin the find process.
</p>
<p>
    oFound = oDoc.findFirst(oDescriptor)
</p>
<p>
    Do While Not IsNull(oFound)
</p>
<p>
    ' Use the strong emphasis character style for "Listing 7."
</p>
<p>
    oFound.CharStyleName = "OOoStrongEmphasis"
</p>
<p>
    ' Create and configure the sequence field.
</p>
<p>
    oField = oDoc.createInstance("com.sun.star.text.TextField.SetExpression")
</p>
<p>
    oField.NumberingType = com.sun.star.style.NumberingType.ARABIC
</p>
<p>
    oField.NumberFormat = formatNum
</p>
<p>
    oField.attachTextFieldMaster(oMasterField)
</p>
<p>
    oField.Content = name &amp; " + 1"
</p>
<p>
</p>
<p>
    ' Create a text cursor with the found text.
</p>
<p>
    oCurs = oFound.getText().createTextCursorByRange(oFound)
</p>
<p>
</p>
<p>
    ' Insert the text such as "Listing &lt;sequence variable&gt;. "
</p>
<p>
    ' This inserted text replaces the found text.
</p>
<p>
    oFound.getText().insertString(oCurs, name &amp; " ", True)
</p>
<p>
    oCurs.collapseToEnd()
</p>
<p>
    oFound.getText().insertTextContent(oCurs, oField, True)
</p>
<p>
    oCurs.collapseToEnd()
</p>
<p>
    oFound.getText().insertString(oCurs, ".", True)
</p>
<p>
    oCurs.collapseToEnd()
</p>
<p>
    oFound.getText().insertString(oCurs, " ", True)
</p>
<p>
    oCurs.collapseToEnd()
</p>
<p>
</p>
<p>
    ' The inserted text uses strong emphasis.
</p>
<p>
    ' Move the cursor back one so that it is before the space.
</p>
<p>
    ' Jump to the end of the paragraph and reset the attributes.
</p>
<p>
    oCurs.goLeft(1, False)
</p>
<p>
    oCurs.gotoEndofParagraph(True)
</p>
<p>
    oDoc.CurrentController.Select(oCurs)
</p>
<p>
    oDispatcher.executeDispatch(oFrame, ".uno:ResetAttributes", "", 0, Array())
</p>
<p>
</p>
<p>
    ' Find the next occurrence.
</p>
<p>
    oFound = oDoc.findNext(oFound.End, oDescriptor)
</p>
<p>
    i = i + 1
</p>
<p>
    Loop
</p>
<p>
    FindReplaceTextFields = i
</p>
<p>
    End Function
</p>
<p>
    The above method contains extra code that clears formatting after the main sequence variables.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="create-a-getreference-field">
                            <span id="anchor-324"></span>Create a GetReference field
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    An inserted sequence field is directly associated to a field master, which may be referenced by many different
    fields; every listing in this book references a single field master. A GetReference field, however, does not
    reference a field as easily. When a field is inserted, OOo automatically assigns a sequence value. The GetReference
    field has a SequenceNumber attribute that takes the numeric SequenceValue from the referenced field (see ).
</p>
<p>
    The reference field source indicates the type of field that is referenced. The supported types are shown in . Much
    of this is poorly documented, and I speculate that the sequence value may be unique relative to field source.
</p>
<p>
    The ReferenceFieldPart indicates how the reference is displayed. Valid values are shown in . The example in uses the
    category and the number. In a caption, all text before the number is the category.
</p>
<p>
    <strong>Listing .</strong> Inserting a GetReference field.
</p>
<p>
    oField = oDoc.createInstance("com.sun.star.text.textfield.GetReference")
</p>
<p>
    oField.ReferenceFieldPart = com.sun.star.text.ReferenceFieldPart.CATEGORY_AND_NUMBER
</p>
<p>
    oField.ReferenceFieldSource = com.sun.star.text.ReferenceFieldSource.SEQUENCE_FIELD
</p>
<p>
    oField.SequenceNumber = oReferencedField.SequenceValue
</p>
<p>
    oField.SourceName = sSeqName
</p>
<p>
    oText.insertTextContent(oCurs, oField, True)
</p>
<p>
    <strong>Table .</strong> Constants for com.sun.star.text.ReferenceFieldPart.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                PAGE
            </td>
            <td>
                The page number is displayed using Arabic numbers.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                CHAPTER
            </td>
            <td>
                The chapter number is displayed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                TEXT
            </td>
            <td>
                The reference text is displayed.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                UP_DOWN
            </td>
            <td>
                Use localized words for "above" or "below".
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                PAGE_DESC
            </td>
            <td>
                The page number is displayed using the numbering type defined in the page style of the reference
                position.
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                CATEGORY_AND_NUMBER
            </td>
            <td>
                The category and the number of a caption is displayed; for example, Listing 7.
            </td>
        </tr>
        <tr class="odd">
            <td>
                6
            </td>
            <td>
                ONLY_CAPTION
            </td>
            <td>
                The caption text of a caption is displayed.
            </td>
        </tr>
        <tr class="even">
            <td>
                7
            </td>
            <td>
                ONLY_SEQUENCE_NUMBER
            </td>
            <td>
                The number of a sequence field is displayed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                8
            </td>
            <td>
                NUMBER
            </td>
            <td>
                The numbering label and depending of the reference field context numbering labels of superior list
                levels of the reference are displayed.
            </td>
        </tr>
        <tr class="even">
            <td>
                9
            </td>
            <td>
                NUMBER_NO_CONTEXT
            </td>
            <td>
                The numbering label of the reference is displayed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                10
            </td>
            <td>
                NUMBER_FULL_CONTEXT
            </td>
            <td>
                The numbering label and numbering labels of superior list levels of the reference are displayed.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table .</strong> Constants for com.sun.star.text.ReferenceFieldSource.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                REFERENCE_MARK
            </td>
            <td>
                The source is a reference mark.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                SEQUENCE_FIELD
            </td>
            <td>
                The source is a number sequence field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                BOOKMARK
            </td>
            <td>
                The source is a bookmark.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                FOOTNOTE
            </td>
            <td>
                The source is a footnote.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                ENDNOTE
            </td>
            <td>
                The source is an endnote.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="replace-text-with-a-getreference-field">
                            <span id="anchor-325"></span>Replace text with a GetReference field
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    accepts an array of strings and a string to find in the array. The function returns the index of the string in the
    array. The need for this macro is explained below.
</p>
<p>
    <strong>Listing .</strong> Find a string in an array.
</p>
<p>
    Function FindStringInArray(oData, s) As Integer
</p>
<p>
    Dim i As Integer
</p>
<p>
    FindStringInArray = -1
</p>
<p>
    For i = LBound(oData) To UBound(oData)
</p>
<p>
    If oData(i) = s Then
</p>
<p>
    FindStringInArray = i
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End Function
</p>
<p>
    The inner workings of the main macro are described in the comments of the macro itself (see ).
</p>
<p>
    <strong>Listing .</strong> Replace text with a GetReference field.
</p>
<p>
    Function referenceSequenceVariables(oDoc, sSeqName) As Integer
</p>
<p>
    Dim oEnum ' Enumeration of text sections.
</p>
<p>
    Dim oField ' Enumerated text field.
</p>
<p>
    Dim s$ ' Generic string variable.
</p>
<p>
    Dim oFrame ' Documents main frame, used for dispatches.
</p>
<p>
    Dim oDispatcher ' Dispatcher object.
</p>
<p>
    Dim oFields() ' Set expressions that may be referenced.
</p>
<p>
    Dim sPresentations() ' Text of what is displayed; for example, "Listing 7"
</p>
<p>
    Dim i As Integer ' Location of a reference (such as "Listing 7") in sPresentations.
</p>
<p>
    Dim n As Integer ' Count the fields.
</p>
<p>
    Dim oCurs ' Cursor used to clear formatting.
</p>
<p>
    Dim oDescriptor ' The search descriptor.
</p>
<p>
    Dim oFound ' The found range.
</p>
<p>
    ' Default to no references created.
</p>
<p>
    referenceSequenceVariables = 0
</p>
<p>
    ' Setup to perform a dispatch.
</p>
<p>
    oFrame = oDoc.CurrentController.Frame
</p>
<p>
    oDispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
    ' Enumerate the text fields and identify the appropriate set field expressions.
</p>
<p>
    ' The field presentation is the number as it is displayed.
</p>
<p>
    ' When this section is finished:
</p>
<p>
    ' oFields() - All the set expression fields for the specified name.
</p>
<p>
    ' sPresentations() - Contains the full reference such as "Listing 7" for the listing
</p>
<p>
    ' sequence with the value 7.
</p>
<p>
    oEnum = oDoc.getTextFields().createEnumeration()
</p>
<p>
    If Not IsNull(oEnum) Then
</p>
<p>
    Do While oEnum.hasMoreElements()
</p>
<p>
    oField = oEnum.nextElement()
</p>
<p>
    If oField.supportsService("com.sun.star.text.TextField.SetExpression") Then
</p>
<p>
    If oField.VariableName = sSeqName Then
</p>
<p>
    ReDim Preserve oFields(0 To n)
</p>
<p>
    ReDim Preserve sPresentations(0 To n)
</p>
<p>
    oFields(n) = oField
</p>
<p>
    sPresentations(n) = sSeqName &amp; " " &amp; oField.CurrentPresentation
</p>
<p>
    n = n + 1
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    End If
</p>
<p>
    ' Create the search descriptor to find all instances of things such as "Listing 23".
</p>
<p>
    ' Values in fields are not found, because search does NOT search fields.
</p>
<p>
    oDescriptor = oDoc.createSearchDescriptor()
</p>
<p>
    With oDescriptor
</p>
<p>
    .SearchString = sSeqName &amp; " [:digit:]+"
</p>
<p>
    .SearchRegularExpression = True
</p>
<p>
    End With
</p>
<p>
    n = 0
</p>
<p>
    oFound = oDoc.findFirst(oDescriptor)
</p>
<p>
    Do While Not IsNull(oFound)
</p>
<p>
    ' Look for a field with the text such as "Listing 7"
</p>
<p>
    i = FindStringInArray(sPresentations, oFound.getString())
</p>
<p>
    If i &gt;= 0 Then
</p>
<p>
    ' Create and configure the GetReference field
</p>
<p>
    oField = oDoc.createInstance("com.sun.star.text.textfield.GetReference")
</p>
<p>
    oField.ReferenceFieldPart = com.sun.star.text.ReferenceFieldPart.CATEGORY_AND_NUMBER
</p>
<p>
    oField.ReferenceFieldSource = com.sun.star.text.ReferenceFieldSource.SEQUENCE_FIELD
</p>
<p>
    oField.SequenceNumber = oFields(i).SequenceValue
</p>
<p>
    oField.SourceName = sSeqName
</p>
<p>
    ' Create a text cursor where the text was found.
</p>
<p>
    ' Clear the text, then insert the GetReference field at that location.
</p>
<p>
    oCurs = oFound.getText().createTextCursorByRange(oFound)
</p>
<p>
    oCurs.setString("")
</p>
<p>
    oFound.getText().insertTextContent(oCurs, oField, True)
</p>
<p>
    ' Sometimes, special formatting was used for the reference text.
</p>
<p>
    ' A cursor cannot move into a field, so collapsing the cursor then selecting
</p>
<p>
    ' one character to the left will select the GetReference field.
</p>
<p>
    oCurs.collapseToEnd()
</p>
<p>
    oCurs.goLeft(1, True)
</p>
<p>
    ' Select the GetReference field on the display, then use a
</p>
<p>
    ' dispatch to clear all attributes.
</p>
<p>
    oDoc.CurrentController.select(oCurs)
</p>
<p>
    oDispatcher.executeDispatch(oFrame, ".uno:ResetAttributes", "", 0, Array())
</p>
<p>
    n = n + 1
</p>
<p>
    Else
</p>
<p>
    s = s &amp; "Failed to find (" &amp; oFound.getString() &amp; ")" &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    oFound = oDoc.findNext(oFound.End, oDescriptor)
</p>
<p>
    Loop
</p>
<p>
    referenceSequenceVariables = n
</p>
<p>
    If s &lt;&gt; "" Then
</p>
<p>
    Msgbox s
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="the-worker-that-ties-it-all-together">
                            <span id="anchor-326"></span>The worker that ties it all together
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The main worker macro starts by replacing captions for Figure, Listing, and Table with sequence variables. It is
    assumed, but never verified, that the captions are sequentially numbered as they appear in the document with no gaps
    in numbering. In other words, the routines are a bit fragile, but they worked great for the documents that I desired
    to use.
</p>
<p>
    My first test set about 100 captions. All cross-references failed because the fields had not yet updated. After
    creating all sequence fields, a dispatch causes the fields to update so that the next phase can begin. Note that if
    this is not done, then the CurrentPresentation attribute on the sequence fields will be incorrect.
</p>
<p>
    <strong>Listing .</strong> Set captions and references for a document.
</p>
<p>
    sub replaceCaptions()
</p>
<p>
    Dim oDoc ' Document on which to operate.
</p>
<p>
    Dim oFrame ' Documents main frame, used for dispatches.
</p>
<p>
    Dim oDispatcher ' Dispatcher object.
</p>
<p>
    Dim i As Integer ' General index variable.
</p>
<p>
    Dim n As Integer ' Number of fields created.
</p>
<p>
    Dim s$ ' Summary of work performed.
</p>
<p>
    Dim fields() ' Field names on which to operate.
</p>
<p>
    fields = Array("Listing", "Table", "Figure")
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    oFrame = oDoc.CurrentController.Frame
</p>
<p>
    oDispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
</p>
<p>
    For i = LBound(fields()) To UBound(fields())
</p>
<p>
    n = FindReplaceTextFields(ThisComponent, fields(i))
</p>
<p>
    s = s &amp; "Fixed " &amp; n &amp; " captions for " &amp; fields(i) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    ' This next part will NOT work until after all of the fields have updated.
</p>
<p>
    ' So, force an update.
</p>
<p>
    oDispatcher.executeDispatch(oFrame, ".uno:UpdateFields", "", 0, Array())
</p>
<p>
    For i = LBound(fields()) To UBound(fields())
</p>
<p>
    n = referenceSequenceVariables(ThisComponent, fields(i))
</p>
<p>
    s = s &amp; "set " &amp; n &amp; " references to " &amp; fields(i) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="table-of-contents-1">
                    <span id="anchor-327"></span>Table of contents
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Finding and inserting a table of contents (TOC) is easy unless you want to change the defaults. The following macro
    checks ThisComponent to see if the document contains a content index.
</p>
<p>
    REM Find TOC if it exists.
</p>
<p>
    oIndexes = ThisComponent.getDocumentIndexes()
</p>
<p>
    bIndexFound = False
</p>
<p>
    For i = 0 To oIndexes.getCount() - 1
</p>
<p>
    oIndex = oIndexes.getByIndex(i)
</p>
<p>
    If oIndex.supportsService("com.sun.star.text.ContentIndex") Then
</p>
<p>
    bIndexFound = True
</p>
<p>
    Exit For
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    Use dispose to remove an existing index from the document.
</p>
<p>
    When I create a TOC, I usually set CreateFromOutline to true to create the index based on the document outline
    styles (see ).
</p>
<p>
    <strong>Listing .</strong> Insert a standard TOC into a document.
</p>
<p>
    Sub InsertATOC
</p>
<p>
    REM Author: Andrew Pitonyak
</p>
<p>
    Dim oCurs 'Used to insert the text content.
</p>
<p>
    Dim oIndexes 'All of the existing indexes
</p>
<p>
    Dim oIndex 'TOC if it exists and a new one if not
</p>
<p>
    Dim i% 'Find an existing TOC
</p>
<p>
    Dim bIndexFound As Boolean 'Flag to track if the TOC was found
</p>
<p>
    REM Find TOC if it exists.
</p>
<p>
    oIndexes = ThisComponent.getDocumentIndexes()
</p>
<p>
    bIndexFound = False
</p>
<p>
    For i = 0 To oIndexes.getCount() - 1
</p>
<p>
    oIndex = oIndexes.getByIndex(i)
</p>
<p>
    If oIndex.supportsService("com.sun.star.text.ContentIndex") Then
</p>
<p>
    bIndexFound = True
</p>
<p>
    Exit For
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    If Not bIndexFound Then
</p>
<p>
    Print "I did not find an existing content index"
</p>
<p>
    REM Create and insert a new TOC.
</p>
<p>
    REM The new TOC must be created by the document that will contain the TOC.
</p>
<p>
    oIndex = ThisComponent.createInstance("com.sun.star.text.ContentIndex")
</p>
<p>
    oIndex.CreateFromOutline = True
</p>
<p>
    oCurs = ThisComponent.getText().createTextCursor()
</p>
<p>
    oCurs.gotoStart(False)
</p>
<p>
    ThisComponent.getText().insertTextContent(oCurs, oIndex, False)
</p>
<p>
    End If
</p>
<p>
    REM Even the newly inserted index is not updated until right HERE!
</p>
<p>
    oIndex.update()
</p>
<p>
    End Sub
</p>
<p>
    The same code can be used to create a DocumentIndex, ContentIndex, UserDefinedIndex, IllustrationIndex, TableIndex,
    or ObjectIndex. Properties common to all index types are shown in .
</p>
<p>
    <strong>Table .</strong> Common index properties.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BackColor
            </td>
            <td>
                Background color. Set to -1 for none.
            </td>
        </tr>
        <tr class="even">
            <td>
                BackGraphicFilter
            </td>
            <td>
                Filter for the graphic displayed as background graphic.
            </td>
        </tr>
        <tr class="odd">
            <td>
                BackGraphicLocation
            </td>
            <td>
                Location of the back graphic. Set using the com.sun.star.style.GraphicLocation constants. This includes
                NONE, LEFT_TOP, MIDDLE_TOP, RIGHT_TOP, LEFT_MIDDLE, MIDDLE_MIDDLE, RIGHT_MIDDLE, LEFT_BOTTOM,
                MIDDLE_BOTTOM, RIGHT_BOTTOM, AREA, and TILED
            </td>
        </tr>
        <tr class="even">
            <td>
                BackGraphicURL
            </td>
            <td>
                URL to the graphic displayed as a background graphic. I did not experiment with this, it may require an
                internal URL??
            </td>
        </tr>
        <tr class="odd">
            <td>
                CreateFromChapter
            </td>
            <td>
                Set to True to create an index based on the current chapter rather than the entire document.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsProtected
            </td>
            <td>
                If true, the index is protected and cannot be edited as part of the text.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaStyleHeading
            </td>
            <td>
                Paragraph style name used for the heading.
            </td>
        </tr>
        <tr class="even">
            <td>
                ParaStyleLevel1
            </td>
            <td>
                Paragraph style named used for level 1. Note that there is an attribute for levels 1 through 10.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Title
            </td>
            <td>
                Index title that is inserted as part of the TOC. I usually leave this blank and place the title before
                the TOC using the “Heading 1” paragraph style so that it is included as part of the TOC; silly, I know.
            </td>
        </tr>
    </tbody>
</table>
<p>
    A TOC contains columns of data; for example, section numbering, section title, and page number. Each column is
    represented by an array of named properties. The supported properties are shown .
</p>
<p>
    <strong>Table .</strong> Supported column tokens.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TokenType
            </td>
            <td>
                Identifies the contents of the column. Every column has a token type as the first property. TokenType
                property values are strings shown in .
            </td>
        </tr>
        <tr class="even">
            <td>
                CharacterStyleName
            </td>
            <td>
                Name of the character style applied to the element. Do not include for tab stops. An empty value causes
                the Default style to be used.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TabStopRightAligned
            </td>
            <td>
                Tab stop is right aligned. Only valid for tab stops.
            </td>
        </tr>
        <tr class="even">
            <td>
                TabStopPosition
            </td>
            <td>
                Position of the tab stop. Only valid for tab stops.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TabStopFillCharacter
            </td>
            <td>
                Fill character in tab stops. Only valid for tab stops.
            </td>
        </tr>
        <tr class="even">
            <td>
                WithTab
            </td>
            <td>
                If true insert tab character.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Text
            </td>
            <td>
                Only valid in user defined text.
            </td>
        </tr>
        <tr class="even">
            <td>
                ChapterFormat
            </td>
            <td>
                Valid in chapter info and entry number only. The chapter format is also mentioned in . For chapter info
                NUMBER and NAME_NUMBER are allowed and for an entry NUMBER and DIGIT are allowed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ChapterLevel
            </td>
            <td>
                Valid in chapter info and entry number only. Denotes the level up to which the chapter information is
                given. Values permitted 1 to 10 inclusive.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Some token types are not supported by all index types. The Value is the string name used to identify the token type.
    The Entry column contains the text used in the GUI while specifying the columns. If an entry is empty, it is because
    I did not verify every type to see what values are used and I do not know the value.
</p>
<p>
    <strong>Table .</strong> Supported TokenType values.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TokenEntryNumber
            </td>
            <td>
                E#
            </td>
            <td>
                Chapter number
            </td>
            <td>
                Content
            </td>
        </tr>
        <tr class="even">
            <td>
                TokenEntryText
            </td>
            <td>
                E
            </td>
            <td>
                Entry text
            </td>
            <td>
                All
            </td>
        </tr>
        <tr class="odd">
            <td>
                TokenTabStop
            </td>
            <td>
                T
            </td>
            <td>
                Tab stop
            </td>
            <td>
                All
            </td>
        </tr>
        <tr class="even">
            <td>
                TokenText
            </td>
            <td>
            </td>
            <td>
                User defined text
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                TokenPageNumber
            </td>
            <td>
                #
            </td>
            <td>
                page number
            </td>
            <td>
                All
            </td>
        </tr>
        <tr class="even">
            <td>
                TokenChapterInfo
            </td>
            <td>
            </td>
            <td>
                Chapter information
            </td>
            <td>
                Illustration, Table, User, Table of Objects, and Alphabetical
            </td>
        </tr>
        <tr class="odd">
            <td>
                TokenHyperlinkStart
            </td>
            <td>
                LS
            </td>
            <td>
                Begin a hyperlink
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                TokenHyperlinkEnd
            </td>
            <td>
                LE
            </td>
            <td>
                End a hyperlink
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                TokenBibliographyDataField
            </td>
            <td>
            </td>
            <td>
                Bibliographic data field
            </td>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in inspects the level formatting for the TOC in the current document and then inserts text at the end of
    the current document.
</p>
<p>
    <strong>Listing .</strong> Inspect the TOC in the current document.
</p>
<p>
    Sub InspectCurrentTOCColumns
</p>
<p>
    'Inspect ThisComponent
</p>
<p>
    Dim oCurs 'Used to insert the text content.
</p>
<p>
    Dim oIndexes 'All of the existing indexes
</p>
<p>
    Dim oIndex 'TOC if it exists and a new one if not
</p>
<p>
    Dim i% 'Find an existing TOC
</p>
<p>
    Dim bIndexFound As Boolean 'Flag to track if the TOC was found
</p>
<p>
    Dim iLevel% ' Iterate over the levels in the LevelFormat property.
</p>
<p>
    Dim iCol% ' Iterate over the columns in each level.
</p>
<p>
    Dim iProp% ' Iterate over the properties for a single column.
</p>
<p>
    Dim oLevel ' Level object.
</p>
<p>
    Dim oCol ' Column object.
</p>
<p>
    Dim s$
</p>
<p>
    REM Find TOC if it exists.
</p>
<p>
    oIndexes = ThisComponent.getDocumentIndexes()
</p>
<p>
    bIndexFound = False
</p>
<p>
    For i = 0 To oIndexes.getCount() - 1
</p>
<p>
    oIndex = oIndexes.getByIndex(i)
</p>
<p>
    If oIndex.supportsService("com.sun.star.text.ContentIndex") Then
</p>
<p>
    bIndexFound = True
</p>
<p>
    Exit For
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    If Not bIndexFound Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    s = "Level" &amp; CHR$(9) &amp; "Column" &amp; CHR$(9) &amp; "Property" &amp; CHR$(9) &amp; "Name" &amp; _
</p>
<p>
    CHR$(9) &amp; "Value" &amp; CHR$(13)
</p>
<p>
    For iLevel = 0 To oIndex.LevelFormat.getCount() - 1
</p>
<p>
    oLevel = oIndex.LevelFormat.getByIndex(iLevel)
</p>
<p>
    For iCol = LBound(oLevel) To UBound(oLevel)
</p>
<p>
    oCol = oLevel(iCol)
</p>
<p>
    For iProp = LBound(oCol) To UBound(oCol)
</p>
<p>
    s = s &amp; iLevel &amp; CHR$(9) &amp; iCol &amp; CHR$(9) &amp; iProp &amp; CHR$(9) &amp; _
</p>
<p>
    oCol(iProp).Name &amp; CHR$(9) &amp; oCol(iProp).Value &amp; CHR$(13)
</p>
<p>
    Next
</p>
<p>
    Next
</p>
<p>
    Next
</p>
<p>
    ThisComponent.getText().insertString(ThisComponent.getText().End, s, False)
</p>
<p>
    End Sub
</p>
<p>
    I ran the macro in with OOo version 3.3.0 and noticed that level 0 contains no entries, and levels 1 – 10 are
    identical. The output for level 1 is shown in .
</p>
<ul>
    <li>
        Column 0 is the TokenEntryNumber formatted with the Default character style. In the TOC, this is the chapter
        numbering.
    </li>
    <li>
        A hyperlink begins in column 1, and it is formatted using the “Internet Link” character style.
    </li>
    <li>
        Column 2 contains the heading text. No character style is provided, but it is formatted using the “Internet
        Link” style because it is included in the hyperlink.
    </li>
    <li>
        Column 3 specifies the end of the hyperlink, so the hyperlink includes only the heading text.
    </li>
    <li>
        Column 4 specifies a right aligned tab stop that fills the empty space between the heading text and the page
        number with periods.
    </li>
    <li>
        Column 5 contains the page number.
    </li>
</ul>
<p>
    <strong>Table .</strong> Level format for level 1.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                0
            </td>
            <td>
                0
            </td>
            <td>
                TokenType
            </td>
            <td>
                TokenEntryNumber
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                0
            </td>
            <td>
                1
            </td>
            <td>
                CharacterStyleName
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                1
            </td>
            <td>
                0
            </td>
            <td>
                TokenType
            </td>
            <td>
                TokenHyperlinkStart
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                1
            </td>
            <td>
                1
            </td>
            <td>
                CharacterStyleName
            </td>
            <td>
                Internet link
            </td>
        </tr>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                2
            </td>
            <td>
                0
            </td>
            <td>
                TokenType
            </td>
            <td>
                TokenEntryText
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                2
            </td>
            <td>
                1
            </td>
            <td>
                CharacterStyleName
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                3
            </td>
            <td>
                0
            </td>
            <td>
                TokenType
            </td>
            <td>
                TokenHyperlinkEnd
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                4
            </td>
            <td>
                0
            </td>
            <td>
                TokenType
            </td>
            <td>
                TokenTabStop
            </td>
        </tr>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                4
            </td>
            <td>
                1
            </td>
            <td>
                TabStopRightAligned
            </td>
            <td>
                TRUE
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                4
            </td>
            <td>
                2
            </td>
            <td>
                TabStopFillCharacter
            </td>
            <td>
                .
            </td>
        </tr>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                4
            </td>
            <td>
                3
            </td>
            <td>
                CharacterStyleName
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                4
            </td>
            <td>
                4
            </td>
            <td>
                WithTab
            </td>
            <td>
                TRUE
            </td>
        </tr>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                5
            </td>
            <td>
                0
            </td>
            <td>
                TokenType
            </td>
            <td>
                TokenPageNumber
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                5
            </td>
            <td>
                1
            </td>
            <td>
                CharacterStyleName
            </td>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<p>
    While creating a TOC manually, the columns are edited to include things such as chapter numbers, chapter text,
    hyperlink start, hyperlink end, page number, and other things. These values are stored in the LevelFormat property.
</p>
<p>
    <strong>Listing .</strong> Insert a TOC with hyperlinks.
</p>
<p>
    Sub InsertATOCWithHyperlinks
</p>
<p>
    REM Author: Andrew Pitonyak
</p>
<p>
    Dim oCurs 'Used to insert the text content.
</p>
<p>
    Dim oIndexes 'All of the existing indexes.
</p>
<p>
    Dim oIndex 'TOC if it exists and a new one if not.
</p>
<p>
    Dim i% 'Find an existing TOC.
</p>
<p>
    Dim bIndexFound As Boolean 'Flag to track if the TOC was found.
</p>
<p>
    Dim iLevel
</p>
<p>
    REM Find TOC if it exists.
</p>
<p>
    oIndexes = ThisComponent.getDocumentIndexes()
</p>
<p>
    bIndexFound = False
</p>
<p>
    For i = 0 To oIndexes.getCount() - 1
</p>
<p>
    oIndex = oIndexes.getByIndex(i)
</p>
<p>
    If oIndex.supportsService("com.sun.star.text.ContentIndex") Then
</p>
<p>
    bIndexFound = True
</p>
<p>
    Exit For
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    If Not bIndexFound Then
</p>
<p>
    REM Create and insert a new TOC.
</p>
<p>
    REM The new TOC must be created by the document that will contain the TOC.
</p>
<p>
    oIndex = ThisComponent.createInstance("com.sun.star.text.ContentIndex")
</p>
<p>
    oIndex.CreateFromOutline = True
</p>
<p>
</p>
<p>
    ' Ignore level 0
</p>
<p>
    For iLevel = 1 To oIndex.LevelFormat.getCount() - 1
</p>
<p>
    oIndex.LevelFormat.replaceByIndex(iLevel, CreateTOCColumnEntries())
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    oCurs = ThisComponent.getText().createTextCursor()
</p>
<p>
    oCurs.gotoRange(ThisComponent.CurrentController.ViewCursor, False)
</p>
<p>
    ThisComponent.getText().insertTextContent(oCurs, oIndex, False)
</p>
<p>
    End If
</p>
<p>
    REM Even the newly inserted index is not updated until right HERE!
</p>
<p>
    oIndex.update()
</p>
<p>
    End Sub
</p>
<p>
    Function CreateTOCColumnEntries()
</p>
<p>
    Dim o
</p>
<p>
    o = Array( Array(MakeProperty("TokenType", "TokenEntryNumber"), _
</p>
<p>
    MakeProperty("CharacterStyleName", "")), _
</p>
<p>
    Array(MakeProperty("TokenType", "TokenHyperlinkStart"), _
</p>
<p>
    MakeProperty("CharacterStyleName", "Internet link")), _
</p>
<p>
    Array(MakeProperty("TokenType", "TokenEntryText"), _
</p>
<p>
    MakeProperty("CharacterStyleName", "")), _
</p>
<p>
    Array(MakeProperty("TokenType", "TokenHyperlinkEnd")), _
</p>
<p>
    Array(MakeProperty("TokenType", "TokenTabStop"), _
</p>
<p>
    MakeProperty("TabStopRightAligned", TRUE), _
</p>
<p>
    MakeProperty("TabStopFillCharacter", "."), _
</p>
<p>
    MakeProperty("CharacterStyleName", ""), _
</p>
<p>
    MakeProperty("WithTab", TRUE)), _
</p>
<p>
    Array(MakeProperty("TokenType", "TokenPageNumber"), _
</p>
<p>
    MakeProperty("CharacterStyleName", "")))
</p>
<p>
    CreateTOCColumnEntries() = o
</p>
<p>
    End Function
</p>
<p>
    Function MakeProperty(sName$, value)
</p>
<p>
    Dim oProp
</p>
<p>
    oProp = CreateObject("com.sun.star.beans.PropertyValue")
</p>
<p>
    oProp.Name = sName
</p>
<p>
    oProp.Value = value
</p>
<p>
    MakeProperty = oProp
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-12">
                    <span id="anchor-328"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Although this chapter didn’t cover every object and capability supported by Writer, it did discuss the capabilities
    most frequently questioned on the mailing lists. Many of the techniques demonstrated in this chapter are
    representative of the techniques that are required for objects not discussed. For example, all objects supporting
    named access are retrieved in the same manner. Use the material covered here as a starting point in your exploration
    of Writer documents in OpenOffice.org.
</p>
<ol type="1">
    <li>
        <h1 id="calc-documents">
            <span id="anchor-307"></span>Calc Documents
        </h1>
    </li>
</ol>
<p>
    The primary purpose of a Calc document is to contain multiple spreadsheets, which in turn contain rows and columns
    of data<em><em> — </em></em>in other words, tables. This chapter introduces appropriate methods to manipulate,
    traverse, format, and modify the content contained in a Calc document.
</p>
<p>
    OpenOffice.org supports three primary table types: text tables in Writer documents, database tables, and
    spreadsheets in Calc documents. Each of the different table types is tailored for a specific purpose. Text tables in
    Writer documents support complex text formatting but only simple table calculations. Spreadsheet documents, on the
    other hand, support complex calculations and only simple text formatting.
</p>
<p>
    Conceptually, all document types have two components: the data they contain and the controller that determines how
    the data is displayed. In OpenOffice.org, the collection of data contained in a document is called the
    <em>model</em>. Each model has a controller that is responsible for the visual presentation of the data. The
    controller knows the location of the visible text cursor and the current page, and knows what is currently selected.
</p>
<p>
    Every Calc document supports the com.sun.star.sheet.SpreadsheetDocument service. When I write a macro that must be
    user-friendly and requires a spreadsheet document, I verify that the document is the correct type by using the
    object method supportsService(). See .
</p>
<p>
    <strong>Listing .</strong> Calc documents support the com.sun.star.sheet.SpreadsheetDocument service.
</p>
<p>
    REM A trick is used to avoid a bug in OOo.
</p>
<p>
    REM This function tests the argument to see if it supports a service.
</p>
<p>
    REM If the object does not support a service, a runtime error
</p>
<p>
    REM occurs that complains that the variable is not set.
</p>
<p>
    REM Assigning the argument to a temporary variable and
</p>
<p>
    REM using that to call SupportsService avoids the error.
</p>
<p>
    Function isCalcDocument(oDoc) As Boolean
</p>
<p>
    On Error Goto ErrorJumpPoint
</p>
<p>
    Dim s$ : s$ = "com.sun.star.sheet.SpreadsheetDocument"
</p>
<p>
    isCalcDocument = False
</p>
<p>
    If oDoc.SupportsService(s$) Then
</p>
<p>
    isCalcDocument = True
</p>
<p>
    End If
</p>
<p>
    ErrorJumpPoint:
</p>
<p>
    End Function
</p>
<p>
    An interface defines a series of methods. If an object implements an interface, it implements every method defined
    by that interface. A service defines an object by specifying the interfaces that it implements, the properties that
    it contains, and the other services that it exports. A service indirectly specifies the implemented methods by
    specifying interfaces. The interfaces supported by Calc documents provide a good overview of the provided
    functionality (see ).
</p>
<p>
    <strong>Table .</strong> Some interfaces supported by Calc documents.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.document.XActionLockable
            </td>
            <td>
                Temporarily lock the document from user interaction and automatic cell updates. Locking an object makes
                it possible to prevent internal object updates while you quickly change multiple parts of the objects
                that might temporarily invalidate each other.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.drawing.XDrawPagesSupplier
            </td>
            <td>
                Access all draw pages in this document; there is one draw page for each contained sheet.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.XCalculatable
            </td>
            <td>
                Control automatic calculation of cells.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.XConsolidatable
            </td>
            <td>
                Perform data consolidation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.XGoalSeek
            </td>
            <td>
                Perform a “Goal Seek” for a cell.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.XSpreadsheetDocument
            </td>
            <td>
                Access the contained spreadsheets.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.style.XStyleFamiliesSupplier
            </td>
            <td>
                Access the contained styles by type.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.util.XNumberFormatsSupplier
            </td>
            <td>
                Access the number formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.util.XProtectable
            </td>
            <td>
                Protect and unprotect the document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The createNewCalcDoc function is used to create a new empty Calc document. This method is used by other methods in
    this chapter.
</p>
<p>
    <strong>Listing .</strong> Create a new Calc document.
</p>
<p>
    Function createNewCalcDoc
</p>
<p>
    Dim noArgs() 'An empty array for the arguments
</p>
<p>
    Dim sURL As String 'URL of the document to load
</p>
<p>
    Dim oDoc
</p>
<p>
    sURL = "private:factory/scalc"
</p>
<p>
    oDoc = StarDesktop.LoadComponentFromUrl(sURL, "_blank", 0, noArgs())
</p>
<p>
    createNewCalcDoc = oDoc
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="accessing-sheets">
                    <span id="anchor-329"></span>Accessing sheets
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The primary purpose of a spreadsheet document is to act as a container for individual sheets through the
    XSpreadsheetDocument interface. The XSpreadsheetDocument interface defines the single method getSheets() that
    returns a Spreadsheets object used to manipulate the individual sheets (see ).
</p>
<p>
    <strong>Listing .</strong> Obtain a com.sun.star.sheet.Spreadsheets service using a method or a property.
</p>
<p>
    ThisComponent.getSheets() 'Method defined by XSpreadsheetDocument interface.
</p>
<p>
    ThisComponent.Sheets 'Property of the spreadsheet document.
</p>
<p>
    The Spreadsheet service allows the individual sheets to be returned by index, by enumeration, and by name (see ).
    The Spreadsheets service also allows sheets to be created, moved, and deleted. Many of the methods shown in are
    demonstrated in .
</p>
<p>
    <strong>Table .</strong> Methods implemented by the com.sun.star.sheet.Spreadsheets service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                copyByName( srcName, destName, index )
            </td>
            <td>
                Copy the sheet named srcName to the specified index and name it destName.
            </td>
        </tr>
        <tr class="even">
            <td>
                createEnumeration()
            </td>
            <td>
                Create an object that enumerates the spreadsheets.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getByIndex(index)
            </td>
            <td>
                Obtain a spreadsheet based on the sheet’s index.
            </td>
        </tr>
        <tr class="even">
            <td>
                getByName(name)
            </td>
            <td>
                Obtain a spreadsheet based on the sheet’s name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getCount()
            </td>
            <td>
                Return the number of sheets as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasByName(name)
            </td>
            <td>
                Return True if the named spreadsheet exits.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasElements()
            </td>
            <td>
                Return True if the document contains at least one spreadsheet.
            </td>
        </tr>
        <tr class="even">
            <td>
                insertNewByName(name, index)
            </td>
            <td>
                Create a new spreadsheet and insert it at the specified location with the supplied name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                moveByName(name, index)
            </td>
            <td>
                Move the named spreadsheet to the specified index.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeByName(name)
            </td>
            <td>
                Remove the named spreadsheet.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Manipulate sheets in a Calc document.
</p>
<p>
    Sub AccessSheets
</p>
<p>
    Dim oSheets 'The sheets object that contains all of the sheets
</p>
<p>
    Dim oSheet 'Individual sheet
</p>
<p>
    Dim oSheetEnum 'For accessing by enumeration
</p>
<p>
    Dim s As String 'String variable to hold temporary data
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
    Dim oDoc
</p>
<p>
</p>
<p>
    oDoc = createNewCalcDoc()
</p>
<p>
    oSheets = oDoc.Sheets
</p>
<p>
</p>
<p>
    REM Insert new sheet as the second sheet.
</p>
<p>
    oSheets.insertNewByName("CreatedSheet", 1)
</p>
<p>
</p>
<p>
    REM Create a new sheet named "First" at the start.
</p>
<p>
    oSheets.insertNewByName("First", 0)
</p>
<p>
    REM Verify that the sheet named "Sheet3" exists
</p>
<p>
    If oSheets.hasbyName("Sheet3") Then
</p>
<p>
    oSheet = oSheets.getByName("Sheet3")
</p>
<p>
    oSheet.getCellByPosition(0, 0).setString("Test")
</p>
<p>
</p>
<p>
    REM Copy "Sheet3" to the end. That is copy, not move!
</p>
<p>
    oSheets.copyByName("Sheet3", "Copy1", oSheets.getCount())
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    If oSheets.hasbyName("Sheet1") Then
</p>
<p>
    oSheets.removeByName("Sheet1")
</p>
<p>
    End If
</p>
<p>
</p>
<p>
</p>
<p>
    REM The sheets are indexed starting at zero, but getCount() indicates
</p>
<p>
    REM exactly how many sheets there are.
</p>
<p>
    For i = 0 To oSheets.getCount()-1
</p>
<p>
    s = s &amp; "Sheet " &amp; i &amp; " = " &amp; oSheets.getByIndex(i).Name &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    Msgbox s, 0, "After Inserting New Sheets"
</p>
<p>
</p>
<p>
    REM Now remove the new sheets that I inserted
</p>
<p>
    oSheets.removeByName("First")
</p>
<p>
    oSheets.removeByName("Copy1")
</p>
<p>
    s = "" : i = 0
</p>
<p>
    oSheetEnum = oSheets.createEnumeration()
</p>
<p>
    Do While oSheetEnum.hasMoreElements()
</p>
<p>
    oSheet = oSheetEnum.nextElement()
</p>
<p>
    s = s &amp; "Sheet " &amp; i &amp; " = " &amp; oSheet.Name &amp; CHR$(10)
</p>
<p>
    i = i + 1
</p>
<p>
    Loop
</p>
<p>
    Msgbox s, 0, "After Deleting Sheets"
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="sheet-cells-contain-the-data">
                    <span id="anchor-330"></span>Sheet cells contain the data
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    A spreadsheet document contains individual sheets that are composed of rows and columns of cells. Each column is
    labeled alphabetically starting with the letter A, and each row is labeled numerically starting with the number 1. A
    cell can be identified by its name, which uses the column letter and the row number, or by its position. The
    upper-left cell is “A1” at position (0, 0) and cell “B3” is at location (1, 2).
</p>
<p>
    The Calc user interface identifies cells with names such as “Sheet2.D5”. A cell, on the other hand, identifies
    itself by the row and column offset, which requires a bit of work to turn into human-readable form. The
    CellAddressConversion service converts a cell address into human readable form. The CellAddressConversion service is
    not yet documented, so I performed some tests. When a cell address is assigned to the Address property (See ), the
    PersistentRepresentation property is set to the full cell name including the sheet name. The
    UserInterfaceRepresentation property, however, contains the sheet name only if the cell is not contained in the
    active sheet.
</p>
<p>
    <strong>Listing .</strong> Obtain the cell name using the CellAddressConversion service.
</p>
<p>
    Dim oConv
</p>
<p>
    Dim oCell
</p>
<p>
    oConv = oDoc.createInstance("com.sun.star.table.CellAddressConversion")
</p>
<p>
    oCell = ThisComponent.Sheets(2).getCellByPosition(0, 0) 'Cell A1
</p>
<p>
    oConv.Address = oCell.getCellAddress()
</p>
<p>
    Print oConv.UserInterfaceRepresentation 'A1
</p>
<p>
    print oConv.PersistentRepresentation 'Sheet1.A1
</p>
<p>
    I had difficulty with the CellAddressConversion service, so I opted to write my own. The following method accepts
    the sheet number, column, and row, and returns an address. The “cheat” that I used, is to assume that the sheet name
    is formatted as Sheet1, Sheet2, etc. This is trivial to change, but I opted to not do it. The only tricky part is to
    understand that columns are labeled using Base 26 where the digits are A-Z and not 0-9; and being enough of a
    technical person to understand what that means.
</p>
<p>
    <strong>Listing .</strong> Format a single cell address assuming all sheets are named Sheet.
</p>
<p>
    Function AddressString(iSheet As Long, iCol As Long, iRow As Long, bWwithSheet As Boolean)
</p>
<p>
    Dim s$
</p>
<p>
    iCol = iCol + 1
</p>
<p>
    Do
</p>
<p>
    iCol = iCol - 1
</p>
<p>
    s = CHR$((iCol MOD 26) + 65) &amp; s
</p>
<p>
    iCol = iCol \ 26 - 1
</p>
<p>
    Loop Until iCol &lt; 0
</p>
<p>
    If bWwithSheet Then
</p>
<p>
    AddressString = "Sheet" &amp; CStr(iSheet + 1) &amp; "." &amp; s &amp; CStr(iRow + 1)
</p>
<p>
    Else
</p>
<p>
    AddressString = s &amp; CStr(iRow + 1)
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<p>
    This next function accepts a range address.
</p>
<p>
    <strong>Listing .</strong> Format a single range address assuming all sheets are named Sheet.
</p>
<p>
    Function prettyRangeAddressName(oRangeAddr)
</p>
<p>
    Dim s1$, s2$
</p>
<p>
    Dim oConv
</p>
<p>
    Dim oCellAddr As New com.sun.star.table.CellAddress
</p>
<p>
</p>
<p>
    s1 = AddressString(oRangeAddr.Sheet, oRangeAddr.StartColumn, oRangeAddr.StartRow, True)
</p>
<p>
    s2 = AddressString(oRangeAddr.Sheet, oRangeAddr.EndColumn, oRangeAddr.EndRow, False)
</p>
<p>
    prettyRangeAddressName = s1 &amp; ":" &amp; s2
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="cell-address">
                            <span id="anchor-331"></span>Cell address
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    In OOo, a cell’s address is specified by the sheet that contains the cell, and the row and column in which the cell
    is located. OOo encapsulates a cell’s address in a CellAddress structure (see ). The CellAddress structure is
    available directly from a cell and it is also used as an argument to numerous object methods.
</p>
<p>
    <strong>Table .</strong> Properties of the com.sun.star.table.CellAddress structure.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Sheet
            </td>
            <td>
                Short Integer index of the sheet that contains the cell.
            </td>
        </tr>
        <tr class="even">
            <td>
                Column
            </td>
            <td>
                Long Integer index of the column where the cell is located.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Row
            </td>
            <td>
                Long Integer index of the row where the cell is located.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="cell-data">
                            <span id="anchor-332"></span>Cell data
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A cell can contain four types of data. Use the method getType() to find out the type of data that it contains. A
    cell that contains no data is considered empty. A cell can contain a floating-point Double value. Use the object
    methods getValue() and setValue(Double) to get and set a cell’s value.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                If the cell contains a formula, you can still determine the type of data that is stored in the cell from
                the FormulaResultType property shown in .
            </td>
        </tr>
    </tbody>
</table>
<p>
    A cell can contain textual data. The standard method of getting and setting textual data is to use the methods
    getString() and setString(String). The real story, however, is that the com.sun.star.table.Cell service implements
    the com.sun.star.text.XText interface. The XText interface is the primary text interface used in Writer documents,
    and it allows individual cells to contain very complex data.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                Sheet cells support the com.sun.star.text.XText interface. It should come as no surprise, therefore,
                that cells also support the com.sun.star.text.XTextFieldsSupplier interface<em><em> — </em></em>in case
                you want to insert special text fields into a cell.
            </td>
        </tr>
    </tbody>
</table>
<p>
    A cell can contain a formula. The methods getFormula() and setFormula(String) get and set a cell’s formula. To
    determine if a formula contains an error, use the getError() method<em><em> — </em></em>the Long Integer return
    value is zero if there is no error. The macro in demonstrates how to inspect a cell’s type.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                When setting a cell’s formula, you must include the leading equals sign (=) and the formula must be in
                English. To set a formula using your own local language, use the FormulaLocal property shown in .
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Get a string representation of the cell type.
</p>
<p>
    Function GetCellType(oCell) As String
</p>
<p>
    Select Case oCell.getType()
</p>
<p>
    Case com.sun.star.table.CellContentType.EMPTY
</p>
<p>
    GetCellType = "Empty"
</p>
<p>
    Case com.sun.star.table.CellContentType.VALUE
</p>
<p>
    GetCellType = "Value"
</p>
<p>
    Case com.sun.star.table.CellContentType.TEXT
</p>
<p>
    GetCellType = "Text"
</p>
<p>
    Case com.sun.star.table.CellContentType.FORMULA
</p>
<p>
    GetCellType = "Formula"
</p>
<p>
    Case Else
</p>
<p>
    GetCellType = "Unknown"
</p>
<p>
    End Select
</p>
<p>
    End Function
</p>
<p>
    demonstrates how to get and set information in a cell. A numeric value, a string, and a formula are set in a cell.
    After setting each type, information is printed about the cell (see ). The macro in is very simple but it
    demonstrates some very important behavior. Inspect the output in to see what is returned by getString(), getValue(),
    and getFormula() for each different cell content type.
</p>
<p>
    <strong>Listing .</strong> Get cell information.
</p>
<p>
    Function SimpleCellInfo(oCell) As String
</p>
<p>
    SimpleCellInfo = oCell.AbsoluteName &amp; " has type " &amp;_
</p>
<p>
    GetCellType(oCell) &amp; " String(" &amp; oCell.getString() &amp; ") Value(" &amp;_
</p>
<p>
    oCell.getValue() &amp; ") Formula(" &amp; oCell.getFormula() &amp; ")"
</p>
<p>
    End Function
</p>
<p>
    Sub GetSetCells
</p>
<p>
    Dim oCell
</p>
<p>
    Dim s As String
</p>
<p>
    Dim oDoc
</p>
<p>
</p>
<p>
    oDoc = createNewCalcDoc()
</p>
<p>
    oCell = oDoc.Sheets(0).getCellByPosition(0, 0) 'Cell A1
</p>
<p>
    oCell.setString("Andy")
</p>
<p>
    oCell = oDoc.Sheets(0).getCellByPosition(104, 0) 'Cell DA1
</p>
<p>
    s = SimpleCellInfo(oCell) &amp; CHR$(10)
</p>
<p>
    oCell.setValue(23.2)
</p>
<p>
    s = s &amp; SimpleCellInfo(oCell) &amp; CHR$(10)
</p>
<p>
    oCell.setString("4")
</p>
<p>
    s = s &amp; SimpleCellInfo(oCell) &amp; CHR$(10)
</p>
<p>
    oCell.setFormula("=A1")
</p>
<p>
    s = s &amp; SimpleCellInfo(oCell) &amp; CHR$(10)
</p>
<p>
    oCell.setFormula("")
</p>
<p>
    s = s &amp; SimpleCellInfo(oCell) &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Cell Values And Types"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/1000000000000591000001FAA37F6AA9.gif" style="width:3.511in;height:1.152in" />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> Values returned by getType(),
    getString(), getValue(), and getFormula() for different<br /> types of content.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                The methods getString() and getFormula() return relevant values even when the cell type is not String or
                Formula (see ). Notice also that setting a string value of 4 does not set a numeric value, and the
                formula even shows a single quotation mark in front of the “4”. This provides a pretty good clue that
                you can also do things such as setFormula("'I am text") to set text.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="cell-properties">
                            <span id="anchor-333"></span>Cell properties
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Cells contained in a sheet are defined by the com.sun.star.sheet.SheetCell service, which supports numerous
    properties for formatting the cell contents. Given that a cell also supports the Text service, it is of no surprise
    that it also supports properties related to text content: CharacterProperties, CharacterPropertiesAsian,
    CharacterPropertiesComplex, and ParagraphProperties. There are also cell-specific properties such as setting border
    lines. You specify the border lines for cells by using a BorderLine structure as shown in . The BorderLine structure
    defines how a single border line is displayed, and the TableBorder structure defines how the lines in a given range
    are displayed (see ).
</p>
<p>
    <strong>Table .</strong> Properties of the com.sun.star.table.BorderLine structure.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Color
            </td>
            <td>
                Line color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                InnerLineWidth
            </td>
            <td>
                Width of the inner part of a double line (in 0.01 mm) as a Short Integer<em><em> — </em></em>zero for a
                single line.
            </td>
        </tr>
        <tr class="odd">
            <td>
                OuterLineWidth
            </td>
            <td>
                Width of a single line, or width of the outer part of a double line (in 0.01 mm) as a Short Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineDistance
            </td>
            <td>
                Distance between the inner and outer parts of a double line (in 0.01 mm) as a Short Integer.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table .</strong> Properties of the com.sun.star.table.TableBorder structure.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TopLine
            </td>
            <td>
                Line style at the top edge (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                IsTopLineValid
            </td>
            <td>
                If True, the TopLine is used when setting values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                BottomLine
            </td>
            <td>
                Line style at the bottom edge (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                IsBottomLineValid
            </td>
            <td>
                If True, the BottomLine is used when setting values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LeftLine
            </td>
            <td>
                Line style at the left edge (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                IsLeftLineValid
            </td>
            <td>
                If True, the LeftLine is used when setting values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                RightLine
            </td>
            <td>
                Line style at the right edge (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                IsRightLineValid
            </td>
            <td>
                If True, the RightLine is used when setting values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HorizontalLine
            </td>
            <td>
                Line style for horizontal lines between cells (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                IsHorizontalLineValid
            </td>
            <td>
                If True, the HorizontalLine is used when setting values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                VerticalLine
            </td>
            <td>
                Line style for vertical lines between cells (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                IsVerticalLineValid
            </td>
            <td>
                If True, the VerticalLine is used when setting values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Distance
            </td>
            <td>
                Distance between the lines and other contents as a Short Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsDistanceValid
            </td>
            <td>
                If True, the Distance is used when setting values.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When setting values in a TableBorder structure, not all values are always required. For example, when using a
    TableBorder structure to configure a cell’s border, the individual values are used only if the corresponding
    “Is...Valid” property is set. This provides the ability to set a single value and leave the other values unchanged.
    If, on the other hand, a TableBorder structure is obtained by using a query (meaning you get the value), the flags
    indicate that not all lines use the same value.
</p>
<p>
    Consider the following macro that sets all four borders on a single range.
</p>
<p>
    <strong>Listing .</strong> Add cell borders.
</p>
<p>
    Sub SetCalcBorder
</p>
<p>
    Dim oDoc
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oCells
</p>
<p>
    Dim oBorder
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/scalc", "_default", 0, Array())
</p>
<p>
    oSheet = oDoc.Sheets(0)
</p>
<p>
    oCells = oSheet.getCellRangeByName("B2:C6")
</p>
<p>
</p>
<p>
    ' Create the structure so that I know the values
</p>
<p>
    ' are all zero.
</p>
<p>
    oBorder = CreateUnoStruct("com.sun.star.table.BorderLine")
</p>
<p>
    ' If you want to modify an existing border, copy it.
</p>
<p>
    'oBorder = oCells.LeftBorder
</p>
<p>
</p>
<p>
    ' Set color to red.
</p>
<p>
    oBorder.Color = RGB(199, 50, 0)
</p>
<p>
    oBorder.OuterLineWidth = 35
</p>
<p>
    oCells.LeftBorder = oBorder
</p>
<p>
    ' Set color to blue.
</p>
<p>
    oBorder.Color = RGB(0, 102, 199)
</p>
<p>
    oBorder.InnerLineWidth = 35
</p>
<p>
</p>
<p>
</p>
<p>
    oCells.TopBorder = oBorder
</p>
<p>
    oBorder.LineDistance = 35
</p>
<p>
    oCells.RightBorder = oBorder
</p>
<p>
    oCells.BottomBorder = oBorder
</p>
<p>
</p>
<p>
    oBorder = oSheet.getCellRangeByName("C2").LeftBorder
</p>
<p>
    Print "Red portion of border = " &amp; Red(oBorder.Color)
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001D1000000BDE87F9264.png" style="width:4.8437in;height:1.9689in" />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> Cells with borders.
</p>
<p>
    Please note the following:
</p>
<ul>
    <li>
        The BorderLine structure is copied by value, not reference. To modify the structure, therefore, you must copy
        the structure to a variable, modify the variable, and then copy the structure back to the left, right, top, or
        bottom border.
    </li>
    <li>
        You can set borders on a cell range as well as an individual cell.
    </li>
    <li>
        <p>
            Although the left border on cell B2 and C2 are both a red line, the red line is not shown in cell C2 (see ).
            How does OOo decide which border should be used right or left, top or bottom? Although the behavior is not
            documented, the following precedence was observed:
        </p>
        <ul>
            <li>
                A border with a line distance is more important than a border without a line distance.
            </li>
            <li>
                Top and left borders are more important than right or bottom borders.
            </li>
        </ul>
    </li>
</ul>
<p>
    contains cell-specific properties. Cell properties use the TableBorder structure to set the border types.
</p>
<p>
    <strong>Table .</strong> Properties supported by the com.sun.star.table.CellProperties service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CellStyle
            </td>
            <td>
                Optional property; the name of the style of the cell as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                CellBackColor
            </td>
            <td>
                The cell background color as a Long Integer (see IsCellBackgroundTransparent).
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsCellBackgroundTransparent
            </td>
            <td>
                If True, the cell background is transparent and the CellBackColor is ignored.
            </td>
        </tr>
        <tr class="even">
            <td>
                HoriJustify
            </td>
            <td>
                The cell’s horizontal alignment as a com.sun.star.table.CellHoriJustify enum:
            </td>
        </tr>
        <tr class="odd">
            <td>
                VertJustify
            </td>
            <td>
                The cell’s vertical alignment as a com.sun.star.table.CellVertJustify enum:
            </td>
        </tr>
        <tr class="even">
            <td>
                IsTextWrapped
            </td>
            <td>
                If True, the cell’s content is automatically wrapped at the right border.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ParaIndent
            </td>
            <td>
                The indentation of the cell’s content (in 0.01 mm) as a Short Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Orientation
            </td>
            <td>
                If the RotateAngle is zero, this specifies the orientation of the cell’s content as an enum of type
                com.sun.star.table.CellOrientation:
            </td>
        </tr>
        <tr class="odd">
            <td>
                RotateAngle
            </td>
            <td>
                Defines how much to rotate the cell’s content (in 0.01 degrees) as a Long Integer. The entire string is
                rotated as one unit rather than as individual characters.
            </td>
        </tr>
        <tr class="even">
            <td>
                RotateReference
            </td>
            <td>
                Defines the edge where rotated cells are aligned using the same enum as VertJustify.
            </td>
        </tr>
        <tr class="odd">
            <td>
                AsianVerticalMode
            </td>
            <td>
                If True, only Asian characters use a vertical orientation. In other words, in Asian mode only Asian
                characters are printed in horizontal orientation if the Orientation property is STACKED; for other
                orientations, this value is not used.
            </td>
        </tr>
        <tr class="even">
            <td>
                TableBorder
            </td>
            <td>
                Description of the cell or cell range border (see ). When used with a single cell, the values set the
                borders for the single cell. When used with a range of cells, the borders are for the outer edges of the
                range rather than the individual cells.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TopBorder
            </td>
            <td>
                Description of the cell’s top border line (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                BottomBorder
            </td>
            <td>
                Description of the cell’s bottom border line (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                LeftBorder
            </td>
            <td>
                Description of the cell’s left border line (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                RightBorder
            </td>
            <td>
                Description of the cell’s right border line (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                NumberFormat
            </td>
            <td>
                Index of the cell’s number format. The proper value can be determined by using the
                com.sun.star.util.XNumberFormatter interface supported by the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShadowFormat
            </td>
            <td>
                Defines the shadow format using a com.sun.star.table.ShadowFormat structure:
            </td>
        </tr>
        <tr class="odd">
            <td>
                CellProtection
            </td>
            <td>
                Defines the cell’s protection as a com.sun.star.util.CellProtection structure:
            </td>
        </tr>
        <tr class="even">
            <td>
                UserDefinedAttributes
            </td>
            <td>
                This property is used to store additional attributes in a com.sun.star.container.XNameContainer
                interface.
            </td>
        </tr>
    </tbody>
</table>
<p>
    In general, the process of setting cell attributes is very simple. The macro in demonstrates some of the properties
    in by setting the text of cell B1 to “Hello”, centering the text, and then rotating the text 30 degrees
    counterclockwise.
</p>
<p>
    <strong>Listing .</strong> Center “Hello” and rotate it 30 degrees.
</p>
<p>
    Sub RotateCellText
</p>
<p>
    Dim oCell
</p>
<p>
    Dim oDoc
</p>
<p>
</p>
<p>
    oDoc = createNewCalcDoc()
</p>
<p>
    oCell = oDoc.Sheets(0).getCellByPosition(1, 0) 'Cell B1
</p>
<p>
    oCell.setString("Hello")
</p>
<p>
    oCell.HoriJustify = com.sun.star.table.CellHoriJustify.CENTER
</p>
<p>
    oCell.RotateAngle = 3000 '30 degrees
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000014800000054B2C35280.png" style="width:3.4165in;height:0.8752in" />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> Cell value rotated 30 degrees.
</p>
<p>
    Cell properties (see ) are generic to most types of cells including text table cells. Cells in a spreadsheet contain
    other properties as well (see ).
</p>
<p>
    <strong>Table .</strong> Properties supported by the com.sun.star.sheet.SheetCell service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Position
            </td>
            <td>
                The position of the cell in the sheet (in 0.01 mm) as a com.sun.star.awt.Point structure. This is the
                absolute position in the entire sheet, not the position in the visible area.
            </td>
        </tr>
        <tr class="even">
            <td>
                Size
            </td>
            <td>
                The size of the cell (in 0.01 mm) as a com.sun.star.awt.Size structure:
            </td>
        </tr>
        <tr class="odd">
            <td>
                FormulaLocal
            </td>
            <td>
                Optional string containing the formula using localized function names.
            </td>
        </tr>
        <tr class="even">
            <td>
                FormulaResultType
            </td>
            <td>
                Formula result type with values from the com.sun.star.sheet.FormulaResult constant group:
            </td>
        </tr>
        <tr class="odd">
            <td>
                ConditionalFormat
            </td>
            <td>
                The conditional formatting settings for this cell. When a conditional format is changed, it must be
                reinserted into the property set.
            </td>
        </tr>
        <tr class="even">
            <td>
                ConditionalFormatLocal
            </td>
            <td>
                Optional property duplicating ConditionalFormat except that formula names use local names.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Validation
            </td>
            <td>
                The data validation settings for this cell as a com.sun.star.beans.XPropertySet.
            </td>
        </tr>
        <tr class="even">
            <td>
                ValidationLocal
            </td>
            <td>
                Optional property duplicating Validation except that formula names use local names.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in demonstrates how to obtain a cell’s position and size in a sheet.
</p>
<p>
    <strong>Listing .</strong> Print cell dimensions.
</p>
<p>
    Sub CellDimensions
</p>
<p>
    Dim oCell
</p>
<p>
    Dim s As String
</p>
<p>
    oCell = ThisComponent.Sheets(0).getCellByPosition(1, 0) 'Cell B1
</p>
<p>
    s = s &amp; CStr(oCell.Position.X \ 100) &amp; " mm from the left" &amp; CHR$(10)
</p>
<p>
    s = s &amp; CStr(oCell.Position.Y \ 100) &amp; " mm from the top" &amp; CHR$(10)
</p>
<p>
    s = s &amp; CStr(oCell.Size.Width \ 100) &amp; " mm wide" &amp; CHR$(10)
</p>
<p>
    s = s &amp; CStr(oCell.Size.Height \ 100) &amp; " mm tall" &amp; CHR$(10)
</p>
<p>
    MsgBox s, 0, "Size And Postion Of Cell " &amp; oCell.AbsoluteName
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="cell-annotations">
                            <span id="anchor-334"></span>Cell annotations
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Each cell can contain one annotation that consists of simple unformatted text. The cell’s getAnnotation() method
    returns an object that supports the com.sun.star.sheet.CellAnnotation service. Cell annotations support the
    XSimpleText interface used in Writer documents as well as the more specific methods shown in<strong> </strong>.
</p>
<p>
    <strong>Table .</strong> Methods implemented by the com.sun.star.sheet.CellAnnotation service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getParent()
            </td>
            <td>
                Get the object (cell) containing this annotation.
            </td>
        </tr>
        <tr class="even">
            <td>
                setParent(oCell)
            </td>
            <td>
                Set the cell that contains this annotation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getPosition()
            </td>
            <td>
                Get the com.sun.star.table.CellAddress of the cell containing this annotation (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                getAuthor()
            </td>
            <td>
                Get the user who last changed the annotation as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getDate()
            </td>
            <td>
                Get the date the annotation was last changed as a formatted String.
            </td>
        </tr>
        <tr class="even">
            <td>
                getIsVisible()
            </td>
            <td>
                Returns True if the annotation is visible.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setIsVisible(boolean)
            </td>
            <td>
                Set whether the annotation is visible.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The spreadsheet object supports the method getAnnotations(), which returns all of the annotations in the
    spreadsheet. You can obtain individual annotations by using indexed access or enumeration. The object returned by
    getAnnotations() also supports the methods removeByIndex(n) and insertNew(CellAddress, String).
</p>
<p>
    <strong>Listing .</strong> Manipulate cell annotations.
</p>
<p>
    Sub manipulateAnnotations
</p>
<p>
    Dim doc As Object
</p>
<p>
    Dim aSheet As Object
</p>
<p>
    Dim aCell As Object
</p>
<p>
    Dim annotations As Object
</p>
<p>
    Dim myAnnotation As Object
</p>
<p>
</p>
<p>
    doc = ThisComponent
</p>
<p>
    aSheet = doc.sheets.getByIndex(0)
</p>
<p>
</p>
<p>
    'Insert a new annotation.
</p>
<p>
    aCell = aSheet.getCellByPosition(0, 0)
</p>
<p>
    annotations = aSheet.annotations
</p>
<p>
    annotations.insertNew(aCell.cellAddress, "Text content")
</p>
<p>
</p>
<p>
    'Modify an existing annotation.
</p>
<p>
    'Cannot use the cell's pseudo-property "annotation" which is read-only
</p>
<p>
    myAnnotation = getAnnotationByCell(aCell)
</p>
<p>
    myAnnotation.isVisible = true
</p>
<p>
    myAnnotation.annotationShape.fillColor = rgb(148, 0, 107)
</p>
<p>
    myAnnotation.annotationShape.charFontName = "Tahoma"
</p>
<p>
    myAnnotation.annotationShape.charHeight = 12
</p>
<p>
    End Sub
</p>
<p>
    Function getAnnotationByCell(aCell As Object) As Object
</p>
<p>
    Dim result As Object
</p>
<p>
    Dim annotations As Object
</p>
<p>
    Dim annotationIndex As Long
</p>
<p>
    Dim anAnnotation As Object
</p>
<p>
    Dim isFound As Boolean
</p>
<p>
</p>
<p>
    annotations = aCell.spreadSheet.annotations
</p>
<p>
    While ((annotationIndex &lt; annotations.count) and (not isFound))
</p>
<p>
    anAnnotation = annotations.getByIndex(annotationIndex)
</p>
<p>
    isFound = ((anAnnotation.position.row = aCell.cellAddress.row) and (anAnnotation.position.column =
    aCell.cellAddress.column))
</p>
<p>
    If (isFound) Then
</p>
<p>
    result = anAnnotation
</p>
<p>
    End If
</p>
<p>
    annotationIndex = annotationIndex + 1
</p>
<p>
    Wend
</p>
<p>
    getAnnotationByCell = result
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="uninterpreted-xml-attributes">
                    <span id="anchor-335"></span>Uninterpreted XML Attributes
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OpenOffice.org stores documents as XML. When an OOo document is read, it is parsed by an XML parser. User-defined
    attributes are not interpreted by the parser, but they are simply read, stored, and then written. The intent is that
    a parser can store attributes that it cannot handle by itself on reading an XML file. When the file is stored again,
    the unknown attributes can be written back without loss.
</p>
<p>
    Uninterpreted attributes also allow you to add your own properties that are saved with the document.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Methods to manipulate user defined
    attributes.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getByName
            </td>
            <td>
                Get the named attribute.
            </td>
        </tr>
        <tr class="even">
            <td>
                getElementNames
            </td>
            <td>
                Get an array of strings containing the existing attribute names.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasByName(name)
            </td>
            <td>
                Determine if the named attribute exists.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasElements
            </td>
            <td>
                Determine if any attributes exist.
            </td>
        </tr>
        <tr class="odd">
            <td>
                insertByName(name, attr)
            </td>
            <td>
                Insert a new attribute.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeByName(name)
            </td>
            <td>
                Remove an existing attribute.
            </td>
        </tr>
        <tr class="odd">
            <td>
                replaceByName(name, attr)
            </td>
            <td>
                Replace an existing attribute.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> To manipulate UserDefinedAttributes, use a copy and then assign it back.
</p>
<p>
    Sub UserDefinedAttributeToCell
</p>
<p>
    Dim oCell 'The cell that will contain the attribute
</p>
<p>
    Dim oUserData 'A copy of the UserDefinedAttributes
</p>
<p>
    Dim oMyAttribute As New com.sun.star.xml.AttributeData
</p>
<p>
    Dim oAttribute
</p>
<p>
    Dim oDoc
</p>
<p>
</p>
<p>
    oDoc = createNewCalcDoc()
</p>
<p>
    REM First, get the cell that will contain the new attribute
</p>
<p>
    oCell = oDoc.Sheets(0).getCellByPosition(1, 0) 'Cell B1
</p>
<p>
    REM Now add data to the attribute.
</p>
<p>
    REM The Namespace is usually left blank, but set it if you want to.
</p>
<p>
    REM omyAttribute.Namespace = "http://what/ever/you/want"
</p>
<p>
    REM Notice that the type is CDATA and not something like "String"
</p>
<p>
    oMyAttribute.Type = "CDATA"
</p>
<p>
    oMyAttribute.Value = "Andrew Pitonyak"
</p>
<p>
    REM Here is where things usually go wrong with a statement like
</p>
<p>
    REM oCell.UserDefinedAttributes.insertByName("Andy", oMyAttribute)
</p>
<p>
    REM This fails every time. Instead, first make a copy and then
</p>
<p>
    REM operate on the copy.
</p>
<p>
    oUserData = oCell.UserDefinedAttributes
</p>
<p>
    If NOT oUserData.hasByName("Andy") Then
</p>
<p>
    oUserData.insertByName("Andy", oMyAttribute)
</p>
<p>
    oCell.UserDefinedAttributes = oUserData
</p>
<p>
    End If
</p>
<p>
    oAttribute = oCell.UserDefinedAttributes.getByName("Andy")
</p>
<p>
    Print oAttribute.Value
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                All services that support UserDefinedAttributes work the same way.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="sheet-cell-ranges">
                    <span id="anchor-336"></span>Sheet cell ranges
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    In Writer documents, continuous text can be grouped in a text range. In a spreadsheet, cells can be grouped in
    rectangular regions with a SheetCellRange. Grouping cells together allows multiple cells to be operated on at one
    time. The SheetCellRange service supports many of the same interfaces and properties as a SheetCell.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                Each sheet in a spreadsheet document is also a SheetRange.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Each cell has a cell address (see ) that identifies its location in the spreadsheet document. Each cell range has an
    analogous structure that identifies its location in the spreadsheet (see ).
</p>
<p>
    <strong>Table .</strong> Properties of the com.sun.star.table.CellRangeAddress structure.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Sheet
            </td>
            <td>
                Short Integer index of the sheet that contains the cell.
            </td>
        </tr>
        <tr class="even">
            <td>
                StartColumn
            </td>
            <td>
                Long Integer index of the column where the left edge is located.
            </td>
        </tr>
        <tr class="odd">
            <td>
                StartRow
            </td>
            <td>
                Long Integer index of the row where the top edge is located.
            </td>
        </tr>
        <tr class="even">
            <td>
                EndColumn
            </td>
            <td>
                Long Integer index of the column of the right edge of the range.
            </td>
        </tr>
        <tr class="odd">
            <td>
                EndRow
            </td>
            <td>
                Long Integer index of the row of the bottom edge of the range.
            </td>
        </tr>
    </tbody>
</table>
<p>
    A single sheet cell range exists in a single sheet and contains one rectangular region. Multiple ranges are
    encapsulated by the SheetCellRanges service, which supports most of the same properties and services as a
    SheetCellRange. The similarity in functionality simplifies the learning curve and offers a lot of otherwise
    complicated functionality.
</p>
<p>
    The SheetCellRanges service provides access to each range through the use of the XElementAccess interface and the
    XIndexAccess interface. The methods in <strong> </strong>also provide access to the contained cell ranges.
</p>
<p>
    <strong>Table .</strong> Methods defined by the com.sun.star.table.XSheetCellRanges interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getCells()
            </td>
            <td>
                Return the collection of contained cells as an XEnumerationAccess.
            </td>
        </tr>
        <tr class="even">
            <td>
                getRangeAddressesAsString()
            </td>
            <td>
                Return a string with the addresses of all contained ranges. The output format is similar to
                “Sheet1.B2:D6;Sheet3.C4:D5”.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getRangeAddresses()
            </td>
            <td>
                Return an array of services of type CellRangeAddress (see ).
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="sheet-cell-range-properties">
                            <span id="anchor-337"></span>Sheet cell range properties
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Sheet cell ranges and sheet cells both support the properties Position, Size, ConditionalFormat,
    ConditionalFormatLocal, Validation, and ValidationLocal (see ). The Position property for a sheet cell range
    provides the location of the upper-left cell<em><em> — </em></em>this is equivalent to obtaining the position
    property from the upper-left cell in the range. The Size property for a cell returns the size of a single cell, and
    the Size property for a sheet cell range provides the size for all of the cells contained in the range.
</p>
<h4 id="validation-settings">
    <span id="anchor-338"></span>Validation settings
</h4>
<p>
    Sheet cells and sheet cell ranges are able to validate the data that they contain, to prevent invalid data from
    populating the cells. You can display a dialog when invalid data is entered (see ). The service
    com.sun.star.sheet.TableValidation controls the validation process.
</p>
<p>
    Before demonstrating how a validation is performed, I must introduce a few enumerated values, properties, and
    methods. Specify the validation that is performed by using the enumerated values shown in .
</p>
<p>
    <strong>Table .</strong> Validation types defined by the com.sun.star.sheet.ValidationType enum.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ValidationType.ANY
            </td>
            <td>
                All content is valid; no conditions are used.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ValidationType.WHOLE
            </td>
            <td>
                Compare a whole (integer) number against the specified condition.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ValidationType.DECIMAL
            </td>
            <td>
                Compare any number against the specified condition.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ValidationType.DATE
            </td>
            <td>
                Compare a date value against the specified condition.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ValidationType.TIME
            </td>
            <td>
                Compare a time value against the specified condition.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ValidationType.TEXT_LEN
            </td>
            <td>
                Compare a string length against the specified condition.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ValidationType.LIST
            </td>
            <td>
                Only allow strings in the specified list.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ValidationType.CUSTOM
            </td>
            <td>
                Specify a formula that determines if the contents are valid.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When a cell containing invalid data is found, the ValidationAlertStyle enum specifies how the invalid data should be
    handled (see ). lists the supported conditional operators.
</p>
<p>
    <strong>Table .</strong> Validation alerts defined by the com.sun.star.sheet.ValidationAlertStyle enum.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ValidationAlertStyle.STOP
            </td>
            <td>
                Display an error message and reject the change.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ValidationAlertStyle.WARNING
            </td>
            <td>
                Display a warning message and ask the user if the change will be accepted. The default answer is No.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ValidationAlertStyle.INFO
            </td>
            <td>
                Display an information message and ask the user if the change will be accepted. The default answer is
                Yes.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ValidationAlertStyle.MACRO
            </td>
            <td>
                Execute a specified macro.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table .</strong> Conditions defined by the com.sun.star.sheet.ConditionOperator enum.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ConditionOperator.NONE
            </td>
            <td>
                No condition is specified.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ConditionOperator.EQUAL
            </td>
            <td>
                The value must be equal to the specified value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ConditionOperator.NOT_EQUAL
            </td>
            <td>
                The value must not be equal to the specified value.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ConditionOperator.GREATER
            </td>
            <td>
                The value must be greater than the specified value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ConditionOperator.GREATER_EQUAL
            </td>
            <td>
                The value must be greater than or equal to the specified value.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ConditionOperator.LESS
            </td>
            <td>
                The value must be less than the specified value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ConditionOperator.LESS_EQUAL
            </td>
            <td>
                The value must be less than or equal to the specified value.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ConditionOperator.BETWEEN
            </td>
            <td>
                The value must be between the two specified values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.ConditionOperator.NOT_BETWEEN
            </td>
            <td>
                The value must be outside of the two specified values.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.ConditionOperator.FORMULA
            </td>
            <td>
                The specified formula must have a non-zero result.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The validation object defines the type of validation and how to react to the validation using properties of the
    object (see ).
</p>
<p>
    <strong>Table .</strong> Properties supported by the com.sun.star.sheet.TableValidation service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Type
            </td>
            <td>
                The type of validation to perform, as shown in .
            </td>
        </tr>
        <tr class="even">
            <td>
                ShowInputMessage
            </td>
            <td>
                If True, an input message appears when the cursor is in an invalid cell.
            </td>
        </tr>
        <tr class="odd">
            <td>
                InputTitle
            </td>
            <td>
                Title (String) of the dialog with the input message.
            </td>
        </tr>
        <tr class="even">
            <td>
                InputMessage
            </td>
            <td>
                Text (String) of the input message.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ShowErrorMessage
            </td>
            <td>
                If True, an error message appears when invalid data is entered.
            </td>
        </tr>
        <tr class="even">
            <td>
                ErrorTitle
            </td>
            <td>
                Title (String) of the dialog showing the error message.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ErrorMessage
            </td>
            <td>
                Text (String) of the error message.
            </td>
        </tr>
        <tr class="even">
            <td>
                IgnoreBlankCells
            </td>
            <td>
                If True, blank cells are allowed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ErrorAlertStyle
            </td>
            <td>
                The action that is taken when an error occurs, as shown in .
            </td>
        </tr>
    </tbody>
</table>
<p>
    Finally, the comparison that is performed is specified using methods implemented by the TableValidation service (see
    ).
</p>
<p>
    <strong>Table .</strong> Methods supported by the com.sun.star.sheet.TableValidation service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getOperator()
            </td>
            <td>
                Get the operator used in the condition, as shown in .
            </td>
        </tr>
        <tr class="even">
            <td>
                setOperator(condition)
            </td>
            <td>
                Set the operator used in the condition, as shown in .
            </td>
        </tr>
        <tr class="odd">
            <td>
                getFormula1()
            </td>
            <td>
                Get the comparison value (String) used in the condition, or the first value if two are needed.
            </td>
        </tr>
        <tr class="even">
            <td>
                setFormula1(String)
            </td>
            <td>
                Set the comparison value used in the condition, or the first value if two are required.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getFormula2()
            </td>
            <td>
                Get the second value (String) if two are required.
            </td>
        </tr>
        <tr class="even">
            <td>
                setFormula2(String)
            </td>
            <td>
                Set the second value (String) if two are required.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getSourcePosition()
            </td>
            <td>
                Get the CellAddress that is used as a base for relative references in the formulas<br /> (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                setSourcePosition(CellAddress)
            </td>
            <td>
                Set the CellAddress that is used as a base for relative references in the formulas<br /> (see ).
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in sets a validation range in the first sheet<em><em> — </em></em>that is, the sheet with a numerical
    index of 0. The cells from B2 to D6 are set to disallow any values that are not between 1 and 10. The macro itself
    is unexpectedly simple.
</p>
<p>
    <strong>Listing .</strong> Set validation range in Calc.
</p>
<p>
    Sub SetValidationRange
</p>
<p>
    Dim oRange 'Range that will accept the validation
</p>
<p>
    Dim oValidation 'The validation object
</p>
<p>
    Dim oDoc
</p>
<p>
</p>
<p>
    oDoc = createNewCalcDoc()
</p>
<p>
    REM Sheets support returning a cell range based on UI type names.
</p>
<p>
    oRange = oDoc.Sheets(0).getCellRangeByName("B2:D6")
</p>
<p>
</p>
<p>
    REM Obtain the Validation object
</p>
<p>
    oValidation = oRange.Validation
</p>
<p>
</p>
<p>
    REM Configure the validation to perform
</p>
<p>
    oValidation.Type = com.sun.star.sheet.ValidationType.DECIMAL
</p>
<p>
    oValidation.ErrorMessage = "Please enter a number between one and ten"
</p>
<p>
    oValidation.ShowErrorMessage = True
</p>
<p>
    oValidation.ErrorAlertStyle = com.sun.star.sheet.ValidationAlertStyle.STOP
</p>
<p>
    oValidation.setOperator(com.sun.star.sheet.ConditionOperator.BETWEEN)
</p>
<p>
</p>
<p>
    oValidation.setFormula1(1.0)
</p>
<p>
    oValidation.setFormula2(10.0)
</p>
<p>
    REM Now set the validation
</p>
<p>
    oRange.Validation = oValidation
</p>
<p>
    Print "Try to enter a number in cells B2:D6 that is not between 1 and 10."
</p>
<p>
    End Sub
</p>
<p>
    The example in sets a Decimal validation between 1 and 10. This validation example does not generate an error for a
    value of 0 or 0.5. Try a few examples to see what else might fail.
</p>
<h4 id="conditional-formatting">
    <span id="anchor-339"></span>Conditional formatting
</h4>
<p>
    Conditional formatting allows the cell style to change based on the cell’s content. Sheet cells and sheet cell
    ranges both support the ConditionalFormat property, which in turn supports the XSheetConditionalEntries interface.
    You can access conditional formatting entries by using element access, indexed access, or the methods
    addNew(properties()), clear(), and removeByIndex(index).
</p>
<p>
    You can also apply multiple conditional formatting entries to the same cell. The first one that matches is applied.
    Each formatting entry is represented by an array of PropertyValue structures. Conditional formatting is very similar
    to validation in that they both use values and types from through .
</p>
<p>
    Validation is a relatively simple condition on a data element, enforcing type and format constraints. Conditional
    formatting supports validation and a more extended set of checks, including attributes or metadata defined on
    elements or collections of elements<em><em> — </em></em>the names are similar, but the actual operations,
    applications, and implications are much more elaborate. It is more difficult to explain than it is to demonstrate.
    The macro in sets a range of cells to use the “Heading1” style if the cell contains a negative number.
</p>
<p>
    <strong>Listing .</strong> Set conditional style in Calc.
</p>
<p>
    Sub SetConditionalStyle
</p>
<p>
    Dim oRange 'Cell range to use
</p>
<p>
    Dim oConFormat 'Conditional format object
</p>
<p>
    Dim oCondition(2) As New com.sun.star.beans.PropertyValue
</p>
<p>
    REM Sheets support returning a cell range based on UI type names.
</p>
<p>
    oRange = ThisComponent.Sheets(0).getCellRangeByName("B2:D6")
</p>
<p>
    oConFormat = oRange.ConditionalFormat
</p>
<p>
</p>
<p>
    oCondition(0).Name = "Operator"
</p>
<p>
    oCondition(0).Value = com.sun.star.sheet.ConditionOperator.LESS
</p>
<p>
    oCondition(1).Name = "Formula1"
</p>
<p>
    oCondition(1).Value = 0
</p>
<p>
    oCondition(2).Name = "StyleName"
</p>
<p>
    oCondition(2).Value = "Heading1"
</p>
<p>
    oConFormat.addNew(oCondition())
</p>
<p>
    oRange.ConditionalFormat = oConFormat
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="sheet-cell-range-services">
                            <span id="anchor-340"></span>Sheet cell range services
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Sheet cells and sheet cell ranges have numerous services in common<em><em> — </em></em>for example, CellProperties
    (see ), CharacterProperties, CharacterPropertiesAsian, CharacterPropertiesComplex, ParagraphProperties, and
    SheetRangesQuery.
</p>
<h4 id="retrieving-cells-and-ranges">
    <span id="anchor-341"></span>Retrieving cells and ranges
</h4>
<p>
    A SheetCellRange support the CellRange service, which in turn supports CellProperties (see ). The CellRange service
    offers extra functionality that is appropriate for cell ranges, but not for individual cells<em><em> — </em></em>for
    example, retrieving cells and cell ranges. When a cell range is retrieved using the methods in , the cells are
    indexed relative to the top-left corner of the range. When the range is an entire sheet, the location (0, 0) refers
    to the cell “A1.” If the range includes the cells “B2:D6”, however, the location (0,0) refers to cell “B2.” The
    macros in through all use the method getCellByPosition().
</p>
<p>
    <strong>Table .</strong> Methods supported by the com.sun.star.table.XCellRange interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getCellByPosition(left, top)
            </td>
            <td>
                Get a cell within the range.
            </td>
        </tr>
        <tr class="even">
            <td>
                getCellRangeByPosition(left, top, right, bottom)
            </td>
            <td>
                Get a cell range within the range.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getCellRangeByName(name)
            </td>
            <td>
                Get a cell range within the range based on its name. The string directly references cells using the
                standard formats<em><em> — </em></em>such as “B2:D5” or “$B$2”<em><em> — </em></em>or defined cell range
                names.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                The methods getCellByPosition(), getCellRangeByPosition(), and getCellRangeByName()<br /> cannot return
                a value that is not in the range (see ).
            </td>
        </tr>
    </tbody>
</table>
<h4 id="querying-cells">
    <span id="anchor-342"></span>Querying cells
</h4>
<p>
    Sheet cell ranges and sheet cells both support the ability to find cells with specific properties. This ability
    provides a mechanism for finding all cells that are referenced by the current cell’s formula and the ability to see
    which cells reference the current cell. While performing a query based on the cell’s content, the CellFlags in
    specify the content type to search.
</p>
<p>
    <strong>Table .</strong> Values in the com.sun.star.sheet.CellFlags constant group.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                com.sun.star.sheet.CellFlags.VALUE
            </td>
            <td>
                Select numbers not formatted as dates or times.
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                com.sun.star.sheet.CellFlags.DATETIME
            </td>
            <td>
                Select numbers formatted as dates or times.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                com.sun.star.sheet.CellFlags.STRING
            </td>
            <td>
                Select strings.
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                com.sun.star.sheet.CellFlags.ANNOTATION
            </td>
            <td>
                Select cell annotations.
            </td>
        </tr>
        <tr class="odd">
            <td>
                16
            </td>
            <td>
                com.sun.star.sheet.CellFlags.FORMULA
            </td>
            <td>
                Select formulas.
            </td>
        </tr>
        <tr class="even">
            <td>
                32
            </td>
            <td>
                com.sun.star.sheet.CellFlags.HARDATTR
            </td>
            <td>
                Select explicit formatting<em><em> — </em></em>not styles.
            </td>
        </tr>
        <tr class="odd">
            <td>
                64
            </td>
            <td>
                com.sun.star.sheet.CellFlags.STYLES
            </td>
            <td>
                Select cell styles.
            </td>
        </tr>
        <tr class="even">
            <td>
                128
            </td>
            <td>
                com.sun.star.sheet.CellFlags.OBJECTS
            </td>
            <td>
                Select drawing objects such as buttons and graphics.
            </td>
        </tr>
        <tr class="odd">
            <td>
                256
            </td>
            <td>
                com.sun.star.sheet.CellFlags.EDITATTR
            </td>
            <td>
                Select formatting within the cell’s content.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Each of the methods used to query a cell range (see ) also returns a cell range (see ).
</p>
<p>
    <strong>Table .</strong> Methods to query a cell range.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                queryDependents(boolean)
            </td>
            <td>
                Return all cells that reference cells in this range. If True, search is recursive.
            </td>
        </tr>
        <tr class="even">
            <td>
                queryPrecedents(boolean)
            </td>
            <td>
                Return all cells referenced by cells in this range. If True, search is recursive.
            </td>
        </tr>
        <tr class="odd">
            <td>
                queryVisibleCells()
            </td>
            <td>
                Return all visible cells.
            </td>
        </tr>
        <tr class="even">
            <td>
                queryEmptyCells()
            </td>
            <td>
                Return all empty cells.
            </td>
        </tr>
        <tr class="odd">
            <td>
                queryContentCells(CellFlags)
            </td>
            <td>
                Return all cells with the specified content types (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                queryFormulaCells(FormulaResult)
            </td>
            <td>
                Return all cells containing a formula with the specified result type (see FormulaResultType in ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                queryColumnDifferences(CellAddress)
            </td>
            <td>
                Return all cells that differ from the comparison cell in the specified cell’s row (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                queryRowDifferences(CellAddress)
            </td>
            <td>
                Return all cells that differ from the comparison cell in the specified cell’s column (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                queryIntersection(CellRangeAddress)
            </td>
            <td>
                Return the range of cells that intersect the specified range (see).
            </td>
        </tr>
    </tbody>
</table>
<h4 id="finding-non-empty-cells-in-a-range">
    <span id="anchor-343"></span>Finding non-empty cells in a range
</h4>
<p>
    Use the method queryContentCells(CellFlags) to obtain a list of all cells in a range that are not empty. The
    CellFlags argument is set to return all cells that contain a value, string, formula, or date/time. The interesting
    thing about is not that it uses a query to find the nonempty cells, but rather that it demonstrates how to extract
    the cells from the query and enumerate all of the returned cells. In other words, the macro in demonstrates how to
    visit all of the nonempty cells in a specific range.
</p>
<p>
    <strong>Listing .</strong> Find cells that are not empty in a range.
</p>
<p>
    Function NonEmptyCellsInRange(oRange, sep$) As String
</p>
<p>
    Dim oCell 'The cell to use!
</p>
<p>
    Dim oRanges 'Ranges returned after querying for the cells
</p>
<p>
    Dim oAddrs() 'Array of CellRangeAddress
</p>
<p>
    Dim oAddr 'One CellRangeAddress
</p>
<p>
    Dim oSheet 'Sheet that contains the cell range
</p>
<p>
    Dim i As Long 'General index variable
</p>
<p>
    Dim nRow As Long 'Row number
</p>
<p>
    Dim nCol As Long 'Column number
</p>
<p>
    Dim s As String
</p>
<p>
</p>
<p>
    REM First, find the cells that are NOT empty in this range!
</p>
<p>
    REM I consider a cell to be not empty if it has a value,
</p>
<p>
    REM date/time, string, or formula.
</p>
<p>
    oRanges = oRange.queryContentCells(_
</p>
<p>
    com.sun.star.sheet.CellFlags.VALUE OR _
</p>
<p>
    com.sun.star.sheet.CellFlags.DATETIME OR _
</p>
<p>
    com.sun.star.sheet.CellFlags.STRING OR _
</p>
<p>
    com.sun.star.sheet.CellFlags.FORMULA)
</p>
<p>
</p>
<p>
    oAddrs() = oRanges.getRangeAddresses()
</p>
<p>
    For i = 0 To UBound(oAddrs())
</p>
<p>
</p>
<p>
    REM Get a specific address range
</p>
<p>
    oAddr = oAddrs(i)
</p>
<p>
</p>
<p>
    For nRow = oAddr.StartRow To oAddr.EndRow
</p>
<p>
    For nCol = oAddr.StartColumn To oAddr.EndColumn
</p>
<p>
    oCell = oRange.Spreadsheet.getCellByPosition(nCol, nRow)
</p>
<p>
    s = s &amp; oCell.AbsoluteName &amp; sep$
</p>
<p>
    Next
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    Next
</p>
<p>
    NonEmptyCellsInRange = s
</p>
<p>
    End Function
</p>
<h4 id="using-complex-queries">
    <span id="anchor-344"></span>Using complex queries
</h4>
<p>
    Although the query methods are easy to use, some of them are conceptually quite complicated. All of the query
    methods return a SheetCellRanges object. The macro in demonstrates how to find the cells referenced by a formula
    using the queryPrecedents() method, how to find the cells referencing a particular cell using the queryDependents()
    method, as well as how to find row and column differences using the queryRowDifferences() and
    queryColumnDifferences() methods.
</p>
<p>
    The macro in configures the first sheet with values and formulas, and then the macro performs some queries. The code
    that performs the demonstrated queries is simple and short. The code that creates the data that is queried, however,
    is more complicated and instructive. More specifically, the macro in demonstrates how to clear a range of cells by
    using the clearContents() method. The dialog produced by is shown in .
</p>
<p>
    <strong>Listing .</strong> Query a range of cells to find references, dependencies, and differences.
</p>
<p>
    Sub QueryCellRange
</p>
<p>
    Dim oCell 'Holds a cell temporarily
</p>
<p>
    Dim oCellAddress 'Holds a cell's address
</p>
<p>
    Dim oRange 'The primary range
</p>
<p>
    Dim oSheet 'The first sheet
</p>
<p>
    Dim i As Integer 'Temporary index variable
</p>
<p>
    Dim s As String 'Temporary String
</p>
<p>
    Dim oDoc : oDoc = createNewCalcDoc()
</p>
<p>
</p>
<p>
    PopulateSheetForQuery(oDoc)
</p>
<p>
    REM Sheets support returning a cell range based on UI type names.
</p>
<p>
    oSheet = oDoc.Sheets(0)
</p>
<p>
    REM Get the range I want to use!
</p>
<p>
    oRange = oSheet.getCellRangeByName("A1:F8")
</p>
<p>
    s = InputBox("Query which cell?", "Enter Cell Address", "C7")
</p>
<p>
</p>
<p>
    REM This includes cells "C2:C7". Notice that it includes the cell itself
</p>
<p>
    oCell = oSheet.getCellByPosition(2, 6)
</p>
<p>
    s = s &amp; "=SUM(C2:C6) directly references " &amp;_
</p>
<p>
    oCell.queryPrecedents(False).getRangeAddressesAsString() &amp; CHR$(10)
</p>
<p>
</p>
<p>
    REM This includes cells "B2:B6;C2:C7"
</p>
<p>
    s = s &amp; "=SUM(C2:C6) Including indirect references " &amp;_
</p>
<p>
    oCell.queryPrecedents(True).getRangeAddressesAsString() &amp; CHR$(10)
</p>
<p>
</p>
<p>
    REM Find direct and indirect references
</p>
<p>
    oCell = oSheet.getCellByPosition(1, 2) 'B3
</p>
<p>
    s = s &amp; "Cells that reference B3 " &amp;_
</p>
<p>
    oCell.queryDependents(True).getRangeAddressesAsString() &amp; CHR$(10)
</p>
<p>
    oCellAddress = oCell.CellAddress
</p>
<p>
    s = s &amp; "Column differences for B3 " &amp;_
</p>
<p>
    oRange.queryColumnDifferences(oCellAddress).getRangeAddressesAsString()
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
</p>
<p>
    s = s &amp; "Row differences for B3 " &amp;_
</p>
<p>
    oRange.queryRowDifferences(oCellAddress).getRangeAddressesAsString()
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
</p>
<p>
    MsgBox s, 0, "Manipulating A Range"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001D60000011901618852.png" style="width:4.8957in;height:2.9272in" />
</p>
<p>
    <strong>Figure .</strong> Query a range of cells to find references, dependencies, and similarities.
</p>
<p>
    shows the formulas and values created by the macro in , assists in understanding the output shown in .
</p>
<p>
    <strong>Table .</strong> The formulas and values set by .
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                2
            </td>
            <td>
                =B1-1
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                1
            </td>
            <td>
                =B2+1
            </td>
            <td>
                =C2-1
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
                2
            </td>
            <td>
                =B3+1
            </td>
            <td>
                =C3-1
            </td>
            <td>
                2
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                3
            </td>
            <td>
                =B4+1
            </td>
            <td>
                =C4-1
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                5
            </td>
            <td>
                4
            </td>
            <td>
                =B5+1
            </td>
            <td>
                =C5-1
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                6
            </td>
            <td>
                5
            </td>
            <td>
                =B6+1
            </td>
            <td>
                =C6-1
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                7
            </td>
            <td>
                =SUM(B2:B5)
            </td>
            <td>
                =SUM(C2:C6)
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                2
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
                2
            </td>
        </tr>
    </tbody>
</table>
<h5 id="query-precedents-and-dependents">
    <span id="anchor-345"></span>Query Precedents and Dependents
</h5>
<p>
    The first line in shows the result of queryPrecedents(False) on a range that contains only cell C7. As shown in ,
    cell C7 directly references the cells C2:C6 and itself. By calling queryPrecedents(True)<em><em> — </em></em>the
    second line in <em><em> — </em></em>the cells B2:B6 are added because the cells in column C reference the cells in
    column B.
</p>
<p>
    The method queryDependents(True) provides the third line in , which displays all of the cells that reference B3,
    directly or indirectly. shows that B3, B7, and C3 directly reference cell B3, and that cells C7 and D3 indirectly
    reference cell B3.
</p>
<h5 id="query-column-differences">
    <span id="anchor-346"></span>Query Column Differences
</h5>
<p>
    The fourth line in lists the “column differences” based on cell B3. While calculating column differences, only the
    row matters. In other words, the same result is returned if cell A3, C3, D3, or E3 is used instead of cell B3. shows
    the sheet; the cells that are considered different are marked with a black background. helps to illustrate what is,
    and is not, considered a difference. By choosing cell B3, all of the cells in each column (of the range) are
    compared to the cell in row 3 (in the same column). The first column, A, has no cells selected because they are all
    empty; therefore, all the cells in the column have the same value. In column B, cell B3 contains the constant value
    of 2. Cells B1 and B8 also contain the constant value 2, so these cells are not considered different. Column C is
    very interesting in that it does not contain constants, but rather it contains formulas that are similar. The cells
    C2, C4, C5, and C6 are similar to cell C3. The formulas are effectively the same (see ) in that they all add 1 to
    the cell to the left. The formula in C1 is not similar to C3 so it is included in the difference list. Column D is
    similar to column C and column E is similar to column B. I leave it as an exercise for the reader to explain the row
    differences as shown in .
</p>
<p>
    <img src="Pictures/100002000000046500000224DC299FFF.gif" style="width:3.4752in;height:1.5571in" /><br />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> Output from with “column differences”
    highlighted.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="searching-and-replacing-1">
                            <span id="anchor-347"></span>Searching and replacing
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The thing that I find most interesting about searching in a spreadsheet document is that searching is not supported
    by the document object. Cell object and cell range objects support searching, however. Each sheet is also a sheet
    range, so it’s possible to search an entire sheet. It is not possible, therefore, to search an entire document at
    one time; you must search each sheet separately. <strong> </strong>demonstrates searching and replacing text in a
    single sheet.
</p>
<p>
    <strong>Listing .</strong> Simple Calc search.
</p>
<p>
    Sub SearchSheet
</p>
<p>
    Dim oSheet 'Sheet in which to replace
</p>
<p>
    Dim oReplace 'Replace descriptor
</p>
<p>
    Dim nCount 'Number of times replaced
</p>
<p>
</p>
<p>
    oSheet = ThisComponent.Sheets(3)
</p>
<p>
    oReplace = oSheet.createReplaceDescriptor()
</p>
<p>
    oReplace.setSearchString("Xyzzy")
</p>
<p>
    oReplace.setReplaceString("Something Else")
</p>
<p>
    oReplace.SearchWords = False
</p>
<p>
    nCount = oSheet.replaceAll(oReplace)
</p>
<p>
    MsgBox "Replaced " &amp; nCount
</p>
<p>
    End Sub
</p>
<p>
    Searching a sheet in a Calc document is almost identical to searching for text in a Writer document. In a Calc
    document, setting SearchWords to True forces the entire cell to contain the search text. In a Writer document,
    setting SearchWords to True forces the text to not be part of another word.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                In a Calc document, setting SearchWords to True forces the entire cell to contain the search text.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="merging-cells">
                            <span id="anchor-348"></span>Merging cells
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the merge method to merge and unmerge a range of cells. After merging the range B2:D7, cell B2 appears in the
    area formerly used by the entire range. What is not shown in is that the cells that aren’t visible still exist and
    are accessible; they are simply not displayed. Use the getIsMerged() method to determine if all of the cells in a
    range are merged.
</p>
<p>
    <strong>Listing .</strong> Merge a range of cells.
</p>
<p>
    Sub MergeExperiment
</p>
<p>
    Dim oCell 'Holds a cell temporarily
</p>
<p>
    Dim oRange 'The primary range
</p>
<p>
    Dim oSheet 'The first sheet
</p>
<p>
    REM Merge a range of cells
</p>
<p>
    oSheet = ThisComponent.Sheets(0)
</p>
<p>
    oRange = oSheet.getCellRangeByName("B2:D7")
</p>
<p>
    oRange.merge(True)
</p>
<p>
</p>
<p>
    REM Now obtain a cell that was merged
</p>
<p>
    REM and I can do it!
</p>
<p>
    oCell = oSheet.getCellByPosition(2, 3) 'C4
</p>
<p>
    Print oCell.getValue()
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000200000003CF000002117B017117.gif" style="width:2.9874in;height:1.498in" /><br />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> Merging cells causes the top-left cell
    to use the entire merged area.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="retrieving-inserting-and-deleting-columns-and-rows">
                            <span id="anchor-349"></span>Retrieving, inserting, and deleting columns and rows
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use the methods getColumns() and getRows() to retrieve columns and rows covered by cells and cell ranges. After
    retrieving the columns for a range or a cell, you can retrieve the individual columns by using the interfaces
    XElementAccess or XindexAccess. You can use two additional methods<em><em> — </em></em>insertByIndex(index, count)
    and removeByIndex(index, count)<em><em> — </em></em>to insert and remove columns. After obtaining a single column,
    you can get the column’s name with getName(), set cell properties for the entire column, and extract cells by using
    the cell range methods in .
</p>
<p>
    All of the manipulations mentioned for columns<em><em> — </em></em>except for getName()<em><em> — </em></em>also
    apply to the rows obtained by using the getRows() method. The difference lies in the properties supported by the
    individual columns and rows (see ).
</p>
<p>
    <strong>Table .</strong> Individual row and column properties.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Column
            </td>
            <td>
                Width
            </td>
            <td>
                Width of the column (in 0.01 mm) as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Row
            </td>
            <td>
                Height
            </td>
            <td>
                Height of the row (in 0.01 mm) as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Column
            </td>
            <td>
                OptimalWidth
            </td>
            <td>
                If True, the column always keeps its optimal width.
            </td>
        </tr>
        <tr class="even">
            <td>
                Row
            </td>
            <td>
                OptimalHeight
            </td>
            <td>
                If True, the row always keeps its optimal height.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Both
            </td>
            <td>
                IsVisible
            </td>
            <td>
                If True, the row or column is visible.
            </td>
        </tr>
        <tr class="even">
            <td>
                Both
            </td>
            <td>
                IsStartOfNewPage
            </td>
            <td>
                If True, a horizontal (vertical) page break is attached to the column (row).
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in <strong> </strong>obtains the range “B6:C9” and then traverses all of the nonempty cells. The hard part
    is done in the routine NonEmptyCellsInRange() as shown in . , however, demonstrates how to extract the individual
    rows from a range. Typically, when writing a macro, you know where the data lies so you simply write code to
    traverse the data directly. <strong> </strong>shows the output from when the macro is run using the data shown in .
</p>
<p>
    <strong>Listing .</strong> Enumerate rows in a range and find nonempty cells.
</p>
<p>
    Sub TraverseRows
</p>
<p>
    Dim oRange 'The primary range
</p>
<p>
    Dim oSheet 'The fourth sheet
</p>
<p>
    Dim oRows 'Rows object
</p>
<p>
    Dim oRow 'A single row
</p>
<p>
    Dim oRowEnum 'Enumerator for the rows
</p>
<p>
    Dim s As String 'General String Variable
</p>
<p>
</p>
<p>
    oSheet = ThisComponent.Sheets(3)
</p>
<p>
    oRange = oSheet.getCellRangeByName("B6:C9")
</p>
<p>
</p>
<p>
    REM I now want to find ALL of the cells that are NOT empty in the
</p>
<p>
    REM rows that are related to the range. Notice that I do not want to
</p>
<p>
    REM limit myself to cells in the range, but that I am interested in the
</p>
<p>
    REM rows.
</p>
<p>
    oRows = oRange.getRows()
</p>
<p>
    REM Sure, I could access things by index, but you probably expected that!
</p>
<p>
    oRowEnum = oRows.createEnumeration()
</p>
<p>
    Do While oRowEnum.hasMoreElements()
</p>
<p>
    oRow = oRowEnum.nextElement()
</p>
<p>
    s = s &amp; NonEmptyCellsInRange(oRow, " ") &amp; CHR$(10)
</p>
<p>
    Loop
</p>
<p>
    MsgBox s, 0, "Non-Empty Cells In Rows"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/1000000000000339000001CE7FD95688.gif" style="width:2.2154in;height:1.1516in" />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> The nonempty cells are displayed from
    rows 6 through 8.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="retrieving-and-setting-data-as-an-array">
                            <span id="anchor-350"></span>Retrieving and setting data as an array
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    You can quickly and easily obtain all data from a range as an array of arrays by using the getDataArray() method.
    The data in each cell is returned as either a number or a string. You can also set the data for a range by using the
    setDataArray() method; just be certain that the array dimensions match the range dimensions (see ).
</p>
<p>
    <strong>Listing .</strong> Get and set data in a Calc sheet.
</p>
<p>
    Sub GetAndSetData
</p>
<p>
    Dim oRange 'The primary range
</p>
<p>
    Dim oSheet 'The fourth sheet
</p>
<p>
    Dim oAllData 'Array containing the data
</p>
<p>
    Dim s As String 'General string variable
</p>
<p>
    Dim i As Integer 'General index variable
</p>
<p>
</p>
<p>
    oSheet = ThisComponent.Sheets(3)
</p>
<p>
    oRange = oSheet.getCellRangeByName("B6:E8")
</p>
<p>
</p>
<p>
    REM Get the data contained in the range!
</p>
<p>
    REM Data from empty cells is included.
</p>
<p>
    oAllData = oRange.getDataArray()
</p>
<p>
    For i = 0 To UBound(oAllData)
</p>
<p>
    REM oAllData(i) is an array, so simply join the data together
</p>
<p>
    REM for a quick printing!
</p>
<p>
    s = s &amp; "(" &amp; Join(oAllData(i), ") (") &amp; ")" &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Data In Range"
</p>
<p>
    REM Now quickly set some data.
</p>
<p>
    oRange = oSheet.getCellRangeByName("F1:G2")
</p>
<p>
    oRange.setDataArray(Array(Array(1, "One"), Array(2, "Two")))
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                <p>
                    As of Calc 3.0, the maximum number of columns is 1024 (column is AMJ), the maximum number of rows is
                    65,536, and the maximum number cells in a sheet is 67,108,864. Laurent Godard performed tests and
                    increased the number for testing purposes: see
                </p>
                <p>
                    <a
                        href="http://blogs.nuxeo.com/dev/2006/08/the-spreadsheet-next.html">http://blogs.nuxeo.com/dev/2006/08/the-spreadsheet-next.html</a>
                </p>
                <p>
                    <a
                        href="http://wiki.services.openoffice.org/wiki/Calc/hacks/number_of_rows">http://wiki.services.openoffice.org/wiki/Calc/hacks/number_of_rows</a>
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    Sheet cell ranges also provide the ability to get and set formulas in bulk using arrays. Use the methods
    getFormulaArray() and setFormulaArray() to get and set the formulas in a range as an array<em><em> — </em></em>these
    two methods can be a real time saver.
</p>
<p>
    If you inspect a sheet range, you will notice that a sheet supports getData() and getDataArray(). Both methods
    return an array of arrays. The method getDataArray returns numbers and strings. The getData method defined by the
    XChartData interface, however, returns numbers and ignores strings.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="computing-functions-on-a-range">
                            <span id="anchor-351"></span>Computing functions on a range
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    It’s possible to compute a value based on a specified range (see and), but it is tedious. You can use the
    getDataArray() method (see ) to quickly obtain all of the data and simply process the data in the nested arrays. To
    easily apply a simple function to a range, use the object method computeFunction(GeneralFunction). lists the
    functions supported by the GeneralFunction enumeration.
</p>
<p>
    <strong>Table .</strong> The com.sun.star.sheet.GeneralFunction enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.GeneralFunction.NONE
            </td>
            <td>
                Nothing is calculated.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.GeneralFunction.AUTO
            </td>
            <td>
                Use SUM if all values are numerical; otherwise use COUNT.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.GeneralFunction.SUM
            </td>
            <td>
                Sum (add) all of the numerical values.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.GeneralFunction.COUNT
            </td>
            <td>
                Count all of the values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.GeneralFunction.AVERAGE
            </td>
            <td>
                Average all of the numerical values.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.GeneralFunction.MAX
            </td>
            <td>
                Maximum numerical value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.GeneralFunction.MIN
            </td>
            <td>
                Minimum numerical value.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.GeneralFunction.PRODUCT
            </td>
            <td>
                Product (multiplication) of all the numerical values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.GeneralFunction.COUNTNUMS
            </td>
            <td>
                Count the numerical values.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.GeneralFunction.STDEV
            </td>
            <td>
                Standard deviation based on a sample.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.GeneralFunction.STDEVP
            </td>
            <td>
                Standard deviation based on the entire population.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.GeneralFunction.VAR
            </td>
            <td>
                Variance based on a sample.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.GeneralFunction.VARP
            </td>
            <td>
                Variance based on the entire population.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in demonstrates the use of the compute function. Using the sheet shown in and the macro in , there are
    seven nonempty cells in the range A5:C9.
</p>
<p>
    <strong>Listing .</strong> Compute a function on a range.
</p>
<p>
    Sub UseCompute
</p>
<p>
    Dim oRange 'The primary range
</p>
<p>
    Dim oSheet 'The fourth sheet
</p>
<p>
    Dim d As Double 'Return value
</p>
<p>
</p>
<p>
    oSheet = ThisComponent.Sheets(3)
</p>
<p>
    oRange = oSheet.getCellRangeByName("A5:C9")
</p>
<p>
    d = oRange.computeFunction(com.sun.star.sheet.GeneralFunction.COUNT)
</p>
<p>
    MsgBox "Non-Empty cells in A5:C9 = " &amp; d, 0, "ComputFuntion()"
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="clearing-cells-and-cell-ranges">
                            <span id="anchor-352"></span>Clearing cells and cell ranges
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    In a Calc document, click on a cell and press the Delete key. A dialog opens with a list of things that can be
    deleted. The ability to delete any combination of things from different types of content or formatting is amazingly
    powerful and flexible. The types of things that can be deleted are encapsulated by the CellFlags shown in .
    CellFlags may be combined using the OR operator and passed to the clearContents(CellFlags) method (see ).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                The clearContents() method is supported by cells, cell ranges, and even rows and columns.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="automatic-data-fill">
                            <span id="anchor-353"></span>Automatic data fill
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    painfully fills consecutive cells with data. Sheet cell ranges provide a better method for automatically filling a
    range with data by using the fillAuto(FillDirection, nCount) method. The FillDirection enumerated values shown in
    control how the data is propagated.
</p>
<p>
    <strong>Table .</strong> The com.sun.star.sheet.FillDirection enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FillDirection.TO_BOTTOM
            </td>
            <td>
                Rows are filled from top to bottom.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FillDirection.TO_RIGHT
            </td>
            <td>
                Columns are filled from left to right.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FillDirection.TO_TOP
            </td>
            <td>
                Rows are filled from bottom to top.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FillDirection.TO_LEFT
            </td>
            <td>
                Columns are filled from right to left.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the method fillAuto(FillDirection, nCount) to automatically fill an area. First, select the range that you want
    to fill. Second, set the initial value that will be incremented by the fillAuto() method. The location of the
    initial values depend on the direction that will be filled. For example, if using TO_LEFT, the rightmost cells in
    the range must contain an initial value so that they can be filled to the left.
</p>
<p>
    While filling new values, the fillAuto() method increments the number by 1 while moving to the right or bottom, and
    decrements the number by 1 while moving to the left or top. If the number is formatted as a time or date,
    incrementing by 1 adds one day.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                When a time is incremented using fillAuto(), it is incremented by one day. If the cell is formatted to
                show only the time, it will appear as though the value does not change<em><em> — </em></em>although it
                has. This should be obvious if you think about it.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The fillAuto() method uses the last argument, nCount, to determine how many cells to move before entering a new
    value. A value of 1, therefore, fills every cell as the cursor moves. While filling new cells, the fillAuto() method
    won’t move outside the range used to call fillAuto(). The code snippet in assumes that Sheet 3 contains numerical
    values in the cell range E11:E20.
</p>
<p>
    <strong>Listing .</strong> Fill values from E11:N20 using fillAuto.
</p>
<p>
    oSheet = ThisComponent.Sheets(3)
</p>
<p>
    oRange = oSheet.getCellRangeByName("E11:N20")
</p>
<p>
    oRange.fillAuto(com.sun.star.sheet.FillDirection.TO_RIGHT, 1)
</p>
<p>
    OOo also supports more complicated fill methods. The FillMode enumeration (see ) directs the special functionality
    provided by the method fillSeries(). The fillAuto() method always uses the LINEAR mode to increment the value by
    one, whereas the fillSeries() method allows for any fill mode.
</p>
<p>
    <strong>Table .</strong> The com.sun.star.sheet.FillMode enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FillMode.SIMPLE
            </td>
            <td>
                All of the values are the same (constant series).
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FillMode.LINEAR
            </td>
            <td>
                The values change by a constant increment (arithmetic series).
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FillMode.GROWTH
            </td>
            <td>
                The values change by a constant multiple (geometric series).
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FillMode.DATE
            </td>
            <td>
                An arithmetic series for date values. This causes all numbers to be treated as dates, regardless of
                formatting.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FillMode.AUTO
            </td>
            <td>
                The cells are filled from a user-defined list.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The fillSeries() method recognizes dates and times based on the numerical format used to display them. Using the
    FillMode DATE forces all numbers to be recognized as dates rather than just numbers that are formatted as dates.
    When a date is filled, the day, month, or year can be changed as specified by the FillDateMode enumerated values
    (see).
</p>
<p>
    <strong>Table .</strong> The com.sun.star.sheet.FillDateMode enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FillDateMode.FILL_DATE_DAY
            </td>
            <td>
                Increment the day by 1.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FillDateMode.FILL_DATE_WEEKDAY
            </td>
            <td>
                Increment the day by 1 but skip Saturday and Sunday.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FillDateMode.FILL_DATE_MONTH
            </td>
            <td>
                Increment the month (the day is unchanged).
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FillDateMode.FILL_DATE_YEAR
            </td>
            <td>
                Increment the year (the day and month are unchanged).
            </td>
        </tr>
    </tbody>
</table>
<p>
    The method fillSeries(FillDirection, FillMode, FillDateMode, nStep, nEndValue) provides the greatest flexibility for
    filling values. The nStep value indicates how the value is modified from cell to cell. The final argument specifies
    a final value not to exceed during the fill. The fillSeries() method will not modify a value outside of the range
    and stops adding values when passing the end value. While specifying an end value, remember that dates expressed as
    a regular number are rather large; 40000 refers to July 6, 2009. uses the fillSeries() method to fill a range of
    dates.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                The fillAuto() method increments or decrements the value depending on the direction in which the values
                are filled. The fillSeries() method, however, always uses the nStep value regardless of the direction.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Fill values from E11:N20 using fillSeries().
</p>
<p>
    oSheet = ThisComponent.Sheets(3)
</p>
<p>
    oRange = oSheet.getCellRangeByName("E11:N20")
</p>
<p>
    oRange.fillSeries(com.sun.star.sheet.FillDirection.TO_LEFT,_
</p>
<p>
    com.sun.star.sheet.FillMode.LINEAR,_
</p>
<p>
    com.sun.star.sheet.FillDateMode.FILL_DATE_DAY,2, 40000)
</p>
<p>
    If text containing a number is found in an initial cell, the copied value copies the text and increments the
    rightmost number in the text. For example, I entered the text “Text 1” and the filled text contained “Text 3”, “Text
    5”, and so on.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="array-formulas">
                            <span id="anchor-354"></span>Array formulas
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The simplest usage of an array formula that I have seen involves placing an array formula in one cell and using the
    formula in multiple cells. Now that I have provided just enough detail to cause confusion, consider the simple
    example shown in .
</p>
<p>
    <strong>Table .</strong> A simple formula in column I.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
            </td>
            <td>
                1
            </td>
            <td>
                3
            </td>
            <td>
                =G3+H3
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
            </td>
            <td>
                2
            </td>
            <td>
                4
            </td>
            <td>
                =G4+H4
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                5
            </td>
            <td>
            </td>
            <td>
                3
            </td>
            <td>
                5
            </td>
            <td>
                =G5+H5
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                6
            </td>
            <td>
            </td>
            <td>
                4
            </td>
            <td>
                6
            </td>
            <td>
                =G6+H6
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                7
            </td>
            <td>
            </td>
            <td>
                5
            </td>
            <td>
                7
            </td>
            <td>
                =G7+H7
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
            </td>
            <td>
                6
            </td>
            <td>
                8
            </td>
            <td>
                =G8+H8
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<p>
    Column I contains the formula to add column G to column H. This can be done using an array formula by entering one
    formula in one cell. To enter an array formula into column J that mimics the formula in column I, first place the
    cursor in cell J3. Enter the formula “=G3:G8+H3:H8” and then press Ctrl-Shift-Enter. The cells J3 through J8 now
    contain the single formula “{=G3:G8+H3:H8}” and the values in column J should match those in column I. Column I
    contains six formulas that are not directly related to each other, but the cells in column J use only one formula.
    The macro in sets a sheet to look like and then sets column J to contain an array formula that calculates the same
    values as column I.
</p>
<p>
    <strong>Listing .</strong> Demonstrate an array formula.
</p>
<p>
    Sub ArrayFormula
</p>
<p>
    Dim oRange 'The primary range
</p>
<p>
    Dim oSheet 'The fourth sheet
</p>
<p>
    Dim oCell 'Holds a cell temporarily
</p>
<p>
    Dim i As Integer 'General Index Variable
</p>
<p>
    Dim oDoc 'Reference newly created calc document.
</p>
<p>
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/scalc", "_default", 0, Array())
</p>
<p>
    oSheet = oDoc.Sheets(0)
</p>
<p>
</p>
<p>
    REM Set the two top cells in G3:H8
</p>
<p>
    oCell = oSheet.getCellByPosition(6, 2) 'Cell G3
</p>
<p>
    oCell.setValue(1)
</p>
<p>
</p>
<p>
    oCell = oSheet.getCellByPosition(7, 2) 'Cell H3
</p>
<p>
    oCell.setValue(3)
</p>
<p>
</p>
<p>
    REM Fill the values down!
</p>
<p>
    oRange = oSheet.getCellRangeByName("G3:H8")
</p>
<p>
    oRange.fillAuto(com.sun.star.sheet.FillDirection.TO_BOTTOM, 1)
</p>
<p>
    REM This demonstrates setting each cell individually.
</p>
<p>
    For i = 3 To 8
</p>
<p>
    oCell = oSheet.getCellByPosition(8, i-1) 'Cell I3 - I8
</p>
<p>
    oCell.setFormula("=G" &amp; i &amp; "+H" &amp; i)
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    REM Setting a single array formula is much easier in this case.
</p>
<p>
    oRange = oSheet.getCellRangeByName("J3:J8")
</p>
<p>
    oRange.setArrayFormula("=G3:G8+H3:H8")
</p>
<p>
</p>
<p>
    REM Add some headings!
</p>
<p>
    oRange = oSheet.getCellRangeByName("G2:J2")
</p>
<p>
    oRange.setDataArray(Array(Array("G", "H", "Formula", "Array Formula")))
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="computing-multiple-functions-on-a-range">
                            <span id="anchor-355"></span>Computing multiple functions on a range
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo supports using a series of single variable formulas against a series of values. A typical example involves a
    single column (or row) of numbers with adjacent columns (or rows) containing formulas using the numbers. The
    enumerated values in <strong> </strong>specify if rows or columns are used.
</p>
<p>
    <strong>Table .</strong> The com.sun.star.sheet.TableOperationMode enumeration
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.TableOperationMode.COLUMN
            </td>
            <td>
                Apply the operation down the columns.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.TableOperationMode.ROW
            </td>
            <td>
                Apply the operation across the rows.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.TableOperationMode.BOTH
            </td>
            <td>
                Apply the operation to both rows and columns.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The setTableOperation() method provides the ability to quickly apply multiple single variable functions to the same
    set of data producing a table of values. The method setTableOperation() accepts four arguments as follows:
</p>
<ol type="1">
    <li>
        CellRangeAddress<em><em> — </em></em>Cell range address that contains the functions to apply.
    </li>
    <li>
        TableOperationMode<em><em> — </em></em>Identifies if the data is in rows or columns (see ).
    </li>
    <li>
        CellAddress<em><em> — </em></em>Cell address that is used if using columns (row mode or both).
    </li>
    <li>
        CellAddress<em><em> — </em></em>Cell address that is used if using rows (column mode or both).
    </li>
</ol>
<p>
    The macro in generates a column of numbers from 0 to 6.3, the functions Sin() and Cos() are then applied to the
    columns.
</p>
<p>
    <strong>Listing .</strong> Use setTableOperation to quickly set an operation on a column.
</p>
<p>
    Sub MultipleOpsColumns
</p>
<p>
    Dim oRange 'The primary range
</p>
<p>
    Dim oSheet 'The fourth sheet
</p>
<p>
    Dim oCell 'Holds a cell temporarily
</p>
<p>
    Dim oBlockAddress 'Address of the block to fill
</p>
<p>
    Dim oCellAddress 'Row or column cell
</p>
<p>
    Dim oDoc 'Reference newly created calc document.
</p>
<p>
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/scalc", "_default", 0, Array())
</p>
<p>
    oSheet = oDoc.Sheets(0)
</p>
<p>
</p>
<p>
    REM Set the top-most value!
</p>
<p>
    oCell = oSheet.getCellByPosition(0, 9) 'Cell A10
</p>
<p>
    oCell.setValue(0)
</p>
<p>
</p>
<p>
    REM Fill the values down! for 0 to 6.4
</p>
<p>
    oRange = oSheet.getCellRangeByName("A10:A74")
</p>
<p>
    oRange.fillSeries(com.sun.star.sheet.FillDirection.TO_BOTTOM,_
</p>
<p>
    com.sun.star.sheet.FillMode.LINEAR,_
</p>
<p>
    com.sun.star.sheet.FillDateMode.FILL_DATE_DAY, 0.1, 6.4)
</p>
<p>
    REM Now set the Sin() and Cos() Header values
</p>
<p>
    oCell = oSheet.getCellByPosition(1, 8) 'Cell B9
</p>
<p>
    oCell.setString("Sin()")
</p>
<p>
    oCell = oSheet.getCellByPosition(2, 8) 'Cell C9
</p>
<p>
    oCell.setString("Cos()")
</p>
<p>
</p>
<p>
    REM Now set the Sin() and Cos() formulas
</p>
<p>
    oCell = oSheet.getCellByPosition(1, 9) 'Cell B10
</p>
<p>
    oCell.setFormula("=Sin(A10)")
</p>
<p>
    oCell = oSheet.getCellByPosition(2, 9) 'Cell C10
</p>
<p>
    oCell.setFormula("=Cos(A10)")
</p>
<p>
    REM Obtain the entire block on which to operate.
</p>
<p>
    oRange = oSheet.getCellRangeByName("A11:C74")
</p>
<p>
</p>
<p>
    REM Obtain the address that contains the formulas to copy.
</p>
<p>
    oBlockAddress = oSheet.getCellRangeByName("B10:C10").getRangeAddress()
</p>
<p>
</p>
<p>
    REM The address of the cell that contains the column of data.
</p>
<p>
    oCellAddress = oSheet.getCellByPosition(0, 9).getCellAddress()
</p>
<p>
</p>
<p>
    REM I really only need the column value because the row value is not used.
</p>
<p>
    oRange.setTableOperation(oBlockAddress,_
</p>
<p>
    com.sun.star.sheet.TableOperationMode.COLUMN,_
</p>
<p>
    oCellAddress, oCellAddress)
</p>
<p>
    End Sub
</p>
<p>
    If the table operation mode is set to BOTH rather than just ROW or COLUMN, then a single function is applied to two
    variables. The macro in creates the multiplication table that I memorized in third grade.
</p>
<p>
    <strong>Listing .</strong> Use a table operation to create a multiplication table
</p>
<p>
    Sub createMultiplicationTableWrapper()
</p>
<p>
    createMultiplicationTable()
</p>
<p>
    End Sub
</p>
<p>
    Function createMultiplicationTable()
</p>
<p>
    Dim oRowCell 'The row cell
</p>
<p>
    Dim oColCell 'The column cell
</p>
<p>
    Dim oRange 'The primary range
</p>
<p>
    Dim oSheet 'The fourth sheet
</p>
<p>
    Dim oCell 'Holds a cell temporarily
</p>
<p>
    Dim oBlockAddress 'Address of the block to fill
</p>
<p>
    Dim oCellAddress 'Row or column cell
</p>
<p>
    Dim oDoc 'Reference newly created calc document.
</p>
<p>
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/scalc", "_default", 0, Array())
</p>
<p>
    oSheet = oDoc.Sheets(0)
</p>
<p>
</p>
<p>
    REM Set the row of constant values
</p>
<p>
    oRowCell = oSheet.getCellByPosition(1, 9) 'Cell B10
</p>
<p>
    oRowCell.setValue(1)
</p>
<p>
    oRange = oSheet.getCellRangeByName("B10:K10")
</p>
<p>
    oRange.fillAuto(com.sun.star.sheet.FillDirection.TO_RIGHT, 1)
</p>
<p>
    oRange.CharWeight = com.sun.star.awt.FontWeight.BOLD
</p>
<p>
    oRange.CharHeight = 14
</p>
<p>
</p>
<p>
    REM Set the column of constant values
</p>
<p>
    oColCell = oSheet.getCellByPosition(0, 10) 'Cell A11
</p>
<p>
    oColCell.setValue(1)
</p>
<p>
    oRange = oSheet.getCellRangeByName("A11:A20")
</p>
<p>
    oRange.fillAuto(com.sun.star.sheet.FillDirection.TO_BOTTOM, 1)
</p>
<p>
    oRange.CharWeight = com.sun.star.awt.FontWeight.BOLD
</p>
<p>
    oRange.CharHeight = 14
</p>
<p>
    REM Set the formula that will be used. It references the first values!
</p>
<p>
    oCell = oSheet.getCellByPosition(0, 9) 'Cell A10
</p>
<p>
    oCell.setFormula("=A11*B10")
</p>
<p>
    REM Get the range of the cells
</p>
<p>
    oRange = oSheet.getCellRangeByName("A10:K20")
</p>
<p>
</p>
<p>
    REM Fill the multiplication tables for the values 1x1 through 10x10
</p>
<p>
    oRange.setTableOperation(oRange.getRangeAddress(),_
</p>
<p>
    com.sun.star.sheet.TableOperationMode.BOTH,_
</p>
<p>
    oColCell.getCellAddress(),_
</p>
<p>
    oRowCell.getCellAddress())
</p>
<p>
    createMultiplicationTable() = oDoc
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="cells-with-the-same-formatting">
                            <span id="anchor-356"></span>Cells with the same formatting
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Sheet cell ranges provide two methods for obtaining groups of cells that contain the same format. The
    getCellFormatRanges() method returns an object that supports both index and enumeration access. The equally
    formatted cells are split into multiple rectangular ranges. The enumerated ranges are returned as a SheetCellRange
    object.
</p>
<p>
    The object method getUniqueCellFormatRanges() is very similar to the method getCellFormatRanges() except that the
    returned values are objects of type SheetCellRanges. The primary difference is that all of the similarly formatted
    objects are returned in one container. The macro in <strong> </strong>displays the similarly formatted ranges using
    the two different methods.
</p>
<p>
    <strong>Listing .</strong> Use two different methods to display groups of cells that contain the same format..
</p>
<p>
    Sub DisplaySimilarRanges
</p>
<p>
    Dim oSheetCellRange 'An individual sheet cell range
</p>
<p>
    Dim oSheetCellRanges 'Sheet cell ranges
</p>
<p>
    Dim oAddr 'An address object from the sheet cell range
</p>
<p>
    Dim s$ 'Utility string variable
</p>
<p>
    Dim x 'The returned range objects are stored here
</p>
<p>
    Dim i% 'Utility index variable
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oDoc 'Reference newly created calc document.
</p>
<p>
</p>
<p>
    oDoc = createMultiplicationTable()
</p>
<p>
    oSheet = oDoc.Sheets(0)
</p>
<p>
</p>
<p>
    REM Do this for the entire sheet!
</p>
<p>
    x = oSheet.getCellFormatRanges()
</p>
<p>
    s = "**** getCellFormatRanges()" &amp; CHR$(10)
</p>
<p>
    For i = 0 To x.getcount()-1
</p>
<p>
    oSheetCellRange = x.getByIndex(i)
</p>
<p>
    oAddr = oSheetCellRange.getRangeAddress()
</p>
<p>
    s = s &amp; prettyRangeAddressName(oAddr) &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    REM SheetCellRanges
</p>
<p>
    x = oSheet.getUniqueCellFormatRanges()
</p>
<p>
    s = s &amp; CHR$(10) &amp; "**** getUniqueCellFormatRanges()" &amp; CHR$(10)
</p>
<p>
    For i = 0 To x.getcount()-1
</p>
<p>
    oSheetCellRanges = x.getByIndex(i)
</p>
<p>
    s = s &amp; i &amp; " = "&amp; oSheetCellRanges.getRangeAddressesAsString() &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Like Ranges"
</p>
<p>
    End Sub
</p>
<p>
    <strong> </strong>demonstrates very clearly the difference between the two methods. The getCellFormatRanges() method
    continually lists the rectangular ranges that are formatted similarly: with each change of format a new range
    starts. The getUniqueCellFormatRanges() method groups the found ranges in containers that contain ranges of similar
    format. So out of the seven ranges there are five (index 0) resp. two (index 1) that are formatted similarly. Both
    methods contain the same ranges; it is only a question of grouping.
</p>
<p>
    <img src="Pictures/10000000000001D500000169A0157513.png" style="width:4.75in;height:3.7917in" />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> The two methods group the data
    differently.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="sorting">
                            <span id="anchor-357"></span>Sorting
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    In general, OOo knows what type of data a cell contains. Knowledge of the contained data types reduces the need to
    inform OOo of the type of data that it is sorting, but it is still possible using the TableSortFieldType enumeration
    (see ). When you request a sort operation, an array of TableSortField structures identifies which columns or rows
    are used to determine the sort order and how they are sorted (see ).
</p>
<p>
    <strong>Table .</strong> The com.sun.star.table.TableSortFieldType enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.table.TableSortFieldType.AUTOMATIC
            </td>
            <td>
                Automatically determine the data type.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.table.TableSortFieldType.NUMERIC
            </td>
            <td>
                Sort the data as a number.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.table.TableSortFieldType.ALPHANUMERIC
            </td>
            <td>
                Sort the data as text.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table .</strong> The com.sun.star.table.TableSortField structure.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Field
            </td>
            <td>
                Zero-based index of the row or column in the table to sort. The index is relative to the<br /> start of
                the sort range.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsAscending
            </td>
            <td>
                If True, sort the data in ascending order.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsCaseSensitive
            </td>
            <td>
                If True, the sort is case sensitive.
            </td>
        </tr>
        <tr class="even">
            <td>
                FieldType
            </td>
            <td>
                Specify the data type as a TableSortFieldType (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                CollatorLocale
            </td>
            <td>
                The Locale object to use when sorting text.
            </td>
        </tr>
        <tr class="even">
            <td>
                CollatorAlgorithm
            </td>
            <td>
                The sorting algorithm used by the collator when sorting text. Check the interface
                com.sun.star.i18n.XCollator to investigate what algorithms are supported for your locale.<br /> I have
                always used the default value.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When you request a sort operation, an array of properties is passed to the sort routine. The properties determine
    what to sort and how it is sorted. One of the supported properties is SortFields (see ), which contains the array of
    TableSortField structures that determine how the rows or columns are sorted.
</p>
<p>
    <strong>Table .</strong> The old way to specify a sort using a SortDescriptor.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                IsCaseSensitive
            </td>
            <td>
                If True, the sort is case sensitive.
            </td>
        </tr>
        <tr class="even">
            <td>
                SortAscending
            </td>
            <td>
                If True, sort the data in ascending order. This property typically is not used, because the
                TableSortField specifies IsAscending for each field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SortColumns
            </td>
            <td>
                If True, columns are sorted. If False, rows are sorted.
            </td>
        </tr>
        <tr class="even">
            <td>
                CollatorLocale
            </td>
            <td>
                The Locale object to use when sorting text (usually set in the TableSortField).
            </td>
        </tr>
        <tr class="odd">
            <td>
                CollatorAlgorithm
            </td>
            <td>
                Sorting algorithm to use (usually set in the TableSortField).
            </td>
        </tr>
        <tr class="even">
            <td>
                SortFields
            </td>
            <td>
                Array of type TableSortField (see ) that directs what is sorted.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MaxSortFieldsCount
            </td>
            <td>
                Long Integer that specifies the maximum number of sort fields the descriptor can hold. This value cannot
                be set, but it can be read.
            </td>
        </tr>
        <tr class="even">
            <td>
                ContainsHeader
            </td>
            <td>
                If True, the first row or column is considered a header and is not sorted.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Orientation
            </td>
            <td>
                This property is deprecated and should no longer be used!
            </td>
        </tr>
    </tbody>
</table>
<p>
    and reveal that there is a great deal of redundancy. For example, you can specify if the sort is case sensitive
    either globally (using ) or for each specific field (using ). Although the redundant fields in are not required and
    are therefore typically not used, a new set of sort descriptors has been introduced (see ). Although you can use
    properties from or , you cannot mix the two. My recommendation is that you use the new set in ; the OO development
    team has already deprecated the use of the Orientation property in .
</p>
<p>
    <strong>Table .</strong> The new way to specify a sort using a SortDescriptor2.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                SortFields
            </td>
            <td>
                Array of type TableSortField (see ) that directs what is sorted.
            </td>
        </tr>
        <tr class="even">
            <td>
                MaxSortFieldsCount
            </td>
            <td>
                Long Integer that specifies the maximum number of sort fields the descriptor can hold. This value cannot
                be set, but it can be read.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsSortColumns
            </td>
            <td>
                If True, columns are sorted. If False, rows are sorted.
            </td>
        </tr>
        <tr class="even">
            <td>
                BindFormatsToContent
            </td>
            <td>
                If True, cell formats are moved with the contents during the sort. This property matters only if
                different cells in the sort range use different formatting.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsUserListEnabled
            </td>
            <td>
                If True, a user-defined sorting list is used from the GlobalSheetSettings.
            </td>
        </tr>
        <tr class="even">
            <td>
                UserListIndex
            </td>
            <td>
                Specify which user-defined sorting list is used as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CopyOutputData
            </td>
            <td>
                If True, the sorted data is copied to another position in the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                OutputPosition
            </td>
            <td>
                CellAddress that specifies where to copy the sorted data (if CopyOutputData is True).
            </td>
        </tr>
        <tr class="odd">
            <td>
                ContainsHeader
            </td>
            <td>
                If True, the first row or column is considered a header and is not sorted.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The first step in sorting a range is to define the fields on which to sort by using an array of type SortField.
    Next, define the properties from that you intend to use in the sort. Finally, call the sort() routine on the range
    to sort. The macro in performs a descending sort on the first column.
</p>
<p>
    <strong>Listing .</strong> Sort one column in a Calc sheet.
</p>
<p>
    Sub SortColZero
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oRange
</p>
<p>
    Dim oSortFields(0) as new com.sun.star.util.SortField
</p>
<p>
    Dim oSortDesc(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    oSheet = ThisComponent.Sheets(0)
</p>
<p>
    REM Set the range on which to sort
</p>
<p>
    oRange = oSheet.getCellRangeByName("B28:D33")
</p>
<p>
    REM Sort on the first field in the range
</p>
<p>
    oSortFields(0).Field = 0
</p>
<p>
    oSortFields(0).SortAscending = FALSE
</p>
<p>
    REM Set the sort fields to use
</p>
<p>
    oSortDesc(0).Name = "SortFields"
</p>
<p>
    oSortDesc(0).Value = oSortFields()
</p>
<p>
</p>
<p>
    REM Now sort the range!
</p>
<p>
    oRange.Sort(oSortDesc())
</p>
<p>
    End Sub
</p>
<p>
    Sorting on two columns rather than just one is as easy as adding a second sort field. sorts on the second and third
    columns.
</p>
<p>
    <strong>Listing .</strong> Sort two columns in a Calc sheet.
</p>
<p>
    Sub SortColOne
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oRange
</p>
<p>
    Dim oSortFields(1) as new com.sun.star.util.SortField
</p>
<p>
    Dim oSortDesc(0) as new com.sun.star.beans.PropertyValue
</p>
<p>
    oSheet = ThisComponent.Sheets(0)
</p>
<p>
    REM Set the range on which to sort
</p>
<p>
    oRange = oSheet.getCellRangeByName("B28:D33")
</p>
<p>
    REM Sort on the second field in the range
</p>
<p>
    oSortFields(0).Field = 1
</p>
<p>
    oSortFields(0).SortAscending = True
</p>
<p>
    oSortFields(0).FieldType = com.sun.star.util.SortFieldType.NUMERIC
</p>
<p>
    REM Sort on the third field in the range
</p>
<p>
    oSortFields(1).Field = 2
</p>
<p>
    oSortFields(1).SortAscending = True
</p>
<p>
    oSortFields(1).FieldType = com.sun.star.util.SortFieldType.ALPHANUMERIC
</p>
<p>
    REM Set the sort fields to use
</p>
<p>
    oSortDesc(0).Name = "SortFields"
</p>
<p>
    oSortDesc(0).Value = oSortFields()
</p>
<p>
</p>
<p>
    REM Now sort the range!
</p>
<p>
    oRange.Sort(oSortDesc())
</p>
<p>
    End Sub
</p>
<p>
    The method createSortDescriptor() returns an array of property values that define how a sort should occur.
    Inspecting this created sort descriptor indicates that you can use a maximum of three fields when sorting (see the
    MaxSortFieldsCount in ). The macro in creates a sort descriptor and then displays the properties that it contains
    (see ).
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Display sort descriptor properties in
    Calc.
</p>
<p>
    Sub DisplaySortDescriptor
</p>
<p>
    On Error Resume Next
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oRange ' A range is needed to create the sort descriptor.
</p>
<p>
    Dim oSortDescript
</p>
<p>
    Dim i%
</p>
<p>
    Dim s$
</p>
<p>
    Dim oDoc 'Reference newly created calc document.
</p>
<p>
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/scalc", "_default", 0, Array())
</p>
<p>
    oSheet = oDoc.Sheets(0)
</p>
<p>
    oRange = oSheet.getCellRangeByName("B28:D33")
</p>
<p>
    oSortDescript = oRange.createSortDescriptor()
</p>
<p>
    For i = LBound(oSortDescript) To UBound(oSortDescript)
</p>
<p>
    s = s &amp; oSortDescript(i).Name &amp; " = "
</p>
<p>
    s = s &amp; oSortDescript(i).Value
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    MsgBox s, 0, "Sort Descriptor"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000002A3000002B7BD8F36D4.gif" style="width:1.9366in;height:1.8516in" />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> Sort descriptor attributes.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="sheets">
                    <span id="anchor-358"></span>Sheets
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Most of a Calc document’s functionality is contained in the individual sheets rather than the document as a whole.
    The interfaces implemented by the spreadsheet document (see ) are primarily related to the document as a whole,
    rather than the individual sheets.
</p>
<p>
    The sheets in a Calc document implement the SheetCellRange service, which provides extensive functionality. The
    functionality provided by sheet cell ranges applies to any sheet cell range and is not limited to sheets. In other
    words, any range is able to use the methods implemented by the SheetCellRange service. The individual sheets support
    other interfaces that are not directly related to sheet cell ranges (see).
</p>
<p>
    <strong>Table .</strong> Interfaces implemented by the com.sun.star.sheet.Spreadsheet service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.XSpreadsheet
            </td>
            <td>
                Methods to create a cell cursor.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.container.XNamed
            </td>
            <td>
                Access the spreadsheet name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.util.XProtectable
            </td>
            <td>
                Methods to protect and unprotect the individual sheet.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.XDataPilotTablesSupplier
            </td>
            <td>
                Access the DataPilot tables with the method getDataPilotTables(). In LibreOffice, the Data Pilot is
                called Pivot Tables.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.XScenariosSupplier
            </td>
            <td>
                Access the scenarios with the method getScenarios().
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.XSheetAnnotationsSupplier
            </td>
            <td>
                Access the annotations with the method getAnnotations().
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.drawing.XDrawPageSupplier
            </td>
            <td>
                Access the sheet’s draw page with the method getDrawPage().
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.table.XTableChartsSupplier
            </td>
            <td>
                Access the document’s chart objects with the method getCharts().
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.XCellRangeMovement
            </td>
            <td>
                Move cell ranges inside the sheet or to other spreadsheets in this document.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.XPrintAreas
            </td>
            <td>
                Access to the print-area settings of this sheet.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.XSheetPageBreak
            </td>
            <td>
                Access and modify the page breaks in this sheet.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.XScenario
            </td>
            <td>
                Provide methods for a scenario sheet.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.XSheetOutline
            </td>
            <td>
                Access the row and column outline settings for the sheet.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.XSheetAuditing
            </td>
            <td>
                Look for linked cells (detective).
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.XSheetLinkable
            </td>
            <td>
                Methods to link to existing sheets in other documents.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="linking-to-an-external-spreadsheet">
                            <span id="anchor-359"></span>Linking to an external spreadsheet
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    An individual sheet may link to a sheet from another spreadsheet document. Linking causes the “link sheet” to act as
    a container for the “linked sheet.” After linking to a sheet, although you can modify the linked sheet in the
    container, these updates are not propagated back to the original document. If the linked sheet is changed in the
    original document, the change is not visible in the link document unless the link itself is refreshed. You can link
    documents by using one of the enumerated values in .
</p>
<p>
    <strong>Table .</strong> Values supported by the com.sun.star.sheet.SheetLinkMode enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.SheetLinkMode.NONE
            </td>
            <td>
                The sheet is not linked.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.SheetLinkMode.NORMAL
            </td>
            <td>
                Copy the entire content including values and formulas.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.SheetLinkMode.VALUE
            </td>
            <td>
                Copy the content by value; each formula’s returned value is copied rather than the formula itself.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the link() method to establish a link with a sheet in another document. lists the link-related methods supported
    by a sheet.
</p>
<p>
    <strong>Table .</strong> Methods defined by the com.sun.star.sheet.XSheetLinkable interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getLinkMode()
            </td>
            <td>
                Get the sheet’s link mode (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                getLinkMode(SheetLinkMode)
            </td>
            <td>
                Set the link mode (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                getLinkUrl()
            </td>
            <td>
                Get the link URL.
            </td>
        </tr>
        <tr class="even">
            <td>
                setLinkUrl(url)
            </td>
            <td>
                Set the link URL.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getLinkSheetName()
            </td>
            <td>
                Get the name of the linked sheet.
            </td>
        </tr>
        <tr class="even">
            <td>
                setLinkSheetName(name)
            </td>
            <td>
                Set the name of the linked sheet.
            </td>
        </tr>
        <tr class="odd">
            <td>
                link(url, sheetName, filterName, filterOptions, SheetLinkMode)
            </td>
            <td>
                Link the sheet to another sheet in another document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in creates a sheet named “LinkIt” and then links to a sheet in a specified external document. If the
    “LinkIt” sheet already exists, the link is obtained from the spreadsheet document and the link is refreshed.
    Refreshing a link causes the data linked into the current document to be updated.
</p>
<p>
    <strong>Listing .</strong> Link to an external sheet.
</p>
<p>
    Sub LinkASheet
</p>
<p>
    Dim oSheets 'The sheets object that contains all of the sheets
</p>
<p>
    Dim oSheet 'Individual sheet
</p>
<p>
    Dim oSheetEnum 'For accessing by enumeration
</p>
<p>
    Dim s As String 'String variable to hold temporary data
</p>
<p>
    Dim i As Integer 'Index variable
</p>
<p>
    Dim sURL As String 'URL of the document to import
</p>
<p>
    Dim oLink 'The link object
</p>
<p>
    sURL = "file://C:/My%20Documents/CH15/test.ods"
</p>
<p>
    oSheets = ThisComponent.Sheets
</p>
<p>
</p>
<p>
    If oSheets.hasbyName("LinkIt") Then
</p>
<p>
    REM The links are available from the document object
</p>
<p>
    REM based on the URL used to load them.
</p>
<p>
    oLink = ThisComponent.SheetLinks.getByName(sURL)
</p>
<p>
    oLink.refresh()
</p>
<p>
    MsgBox "The sheet named LinkIt was refreshed"
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM Insert the new sheet at the end.
</p>
<p>
    oSheets.insertNewByName ("LinkIt", oSheets.getCount())
</p>
<p>
    oSheet = oSheets.getByName("LinkIt")
</p>
<p>
</p>
<p>
    oSheet.link(sURL, "Sheet1", "", "", com.sun.star.sheet.SheetLinkMode.NORMAL)
</p>
<p>
    End Sub
</p>
<p>
    The first application that I saw for linked sheets was to consolidate a list of various investments that were
    tracked in different Calc documents. Each of the Calc documents contained a summary sheet for the investments in the
    document. A single summary document inserted links to the summary page for each of the other investment sheets.
</p>
<p>
    Although linked sheets are nice, they are sometimes overkill. If you don’t want to reference an entire sheet from
    another document, you can set the formula to directly access just one cell. See<strong> </strong>.
</p>
<p>
    <strong>Listing .</strong> Link cell A1 to K89 in another document.
</p>
<p>
    oCell = thiscomponent.sheets(0).getcellbyposition(0,0) ' A1
</p>
<p>
    oCell.setFormula("=" &amp; "'file:///home/USER/CalcFile2.odt'#$Sheet2.K89")
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="finding-dependencies-by-using-auditing-functions">
                            <span id="anchor-360"></span>Finding dependencies by using auditing functions
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The methods queryDependents() and queryPrecedents(), listed in , return a list of cells that depend on a range. The
    query methods are useful for writing macros that manipulate each dependent cell. The auditing functionality provided
    by the XSheetAuditing interface provides methods for visualizing cell dependencies (see<br />).
</p>
<p>
    <strong>Table .</strong> Methods supported by the com.sun.star.sheet.XSheetAuditing interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                hideDependents(CellAddress)
            </td>
            <td>
                Remove arrows for one level of dependents; return True if cells are marked.
            </td>
        </tr>
        <tr class="even">
            <td>
                hidePrecedents(CellAddress)
            </td>
            <td>
                Remove arrows for one level of precedents; return True if cells are marked.
            </td>
        </tr>
        <tr class="odd">
            <td>
                showDependents(CellAddress)
            </td>
            <td>
                Draw arrows from the CellAddress (see ) to its dependents; return True if cells are marked.
            </td>
        </tr>
        <tr class="even">
            <td>
                showPrecedents(CellAddress)
            </td>
            <td>
                Draw arrows to the CellAddress (see ) from its precedents; return True if cells are marked.
            </td>
        </tr>
        <tr class="odd">
            <td>
                showErrors(CellAddress)
            </td>
            <td>
                Draw arrows from the CellAddress (see ) containing an error and the cells causing the error; return True
                if cells are marked.
            </td>
        </tr>
        <tr class="even">
            <td>
                showInvalid()
            </td>
            <td>
                Show all cells containing invalid values; return True if cells are marked.
            </td>
        </tr>
        <tr class="odd">
            <td>
                clearArrows()
            </td>
            <td>
                Remove all auditing arrows from the sheet.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Each time that the showPrecedents() method is called, another level of precedents is marked with arrows. After the
    first call, arrows are drawn from all cells directly referenced by the specified cell. The QueryRange macro in
    displays the dependencies (see ); , however, displays the precedents in the spreadsheet. shows one level of
    precedents.
</p>
<p>
    The cell B7 contains the formula “=Sum(B1:B6)”. As shows, cell B7 refers to all of the “summed” cells. If you call
    the method showPrecedents() again, you’ll see the cells that reference the cells B2:B6. The showPrecedents() method
    returns True as long as more precedent cells are marked with arrows. shows the next level of precedents.
</p>
<p>
    <strong>Listing .</strong> Display precedents.
</p>
<p>
    Function SimpleCalcDocAddition()
</p>
<p>
    Dim oDoc 'Reference newly created calc document.
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oRange
</p>
<p>
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/scalc", "_default", 0, Array())
</p>
<p>
    oSheet = oDoc.Sheets(0)
</p>
<p>
    oSheet.getCellByPosition(0, 0).setValue(1)
</p>
<p>
    oRange = oSheet.getCellRangeByName("A1:A6")
</p>
<p>
    oRange.fillAuto(com.sun.star.sheet.FillDirection.TO_BOTTOM, 1)
</p>
<p>
    oRange = oSheet.getCellRangeByName("B1:B6")
</p>
<p>
    oRange.setArrayFormula("=A1:A6+1")
</p>
<p>
    oSheet.getCellByPosition(1, 6).setFormula("=Sum(B1:B6)")
</p>
<p>
    SimpleCalcDocAddition = oDoc
</p>
<p>
    End Function
</p>
<p>
    Sub ShowCellPrecedence()
</p>
<p>
    Dim oDoc
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oAddr
</p>
<p>
</p>
<p>
    oDoc = SimpleCalcDocAddition()
</p>
<p>
    oSheet = oDoc.Sheets(0)
</p>
<p>
    oAddr = oSheet.getCellByPosition(1, 6).CellAddress
</p>
<p>
    oSheet.showPrecedents(oAddr)
</p>
<p>
    Print "See one level of Precedents for cells B1:B6"
</p>
<p>
    oSheet.showPrecedents(oAddr)
</p>
<p>
    Print "See two levels of Precedents for cell B1:B6"
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000F500000099746432A0.png" style="width:2.552in;height:1.5937in" />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> One level of precedents.
</p>
<p>
    <img src="Pictures/10000000000000F9000000990B16C679.png" style="width:2.5937in;height:1.5937in" />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> Two levels of precedents with an array
    formula in B1:B6.
</p>
<p>
    The arrows in demonstrate two levels of precedents assuming an array formula. If a simple formula is used in each
    cell rather than an array formula, the figure changes noticeably. As an exercise, consider why this is.
</p>
<p>
    <img src="Pictures/100000000000014A000000D96D212199.png" style="width:3.4374in;height:2.2602in" />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> Two levels of precedents with formulas
    in B2:B6.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="outlines">
                            <span id="anchor-361"></span>Outlines
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Outlines in a Calc document group rows and columns together so that you can collapse and expand the groups with a
    single mouse click. When you create an outline, you must specify whether it’s row-centric or column-centric by using
    TableOrientation enumeration (see ). The methods in <strong> </strong>behave like their menu counterparts in the OOo
    GUI for dealing with spreadsheet outlines.
</p>
<p>
    <strong>Table .</strong> Values defined by the com.sun.star.table.TableOrientation enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.table.TableOrientation.ROWS
            </td>
            <td>
                Use rows.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.table.TableOrientation.COLUMNS
            </td>
            <td>
                Use columns.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table .</strong> Methods supported by the com.sun.star.sheet.XSheetOutline interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                group(CellRangeAddress, TableOrientation)
            </td>
            <td>
                Group the cells in the cell range into one group.
            </td>
        </tr>
        <tr class="even">
            <td>
                ungroup(CellRangeAddress, TableOrientation)
            </td>
            <td>
                Remove the innermost levels from the group.
            </td>
        </tr>
        <tr class="odd">
            <td>
                autoOutline(CellRangeAddress)
            </td>
            <td>
                Create outline groups based on formula references.
            </td>
        </tr>
        <tr class="even">
            <td>
                clearOutline()
            </td>
            <td>
                Remove all outline groups from the sheet.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hideDetail(CellRangeAddress)
            </td>
            <td>
                Collapse an outline group.
            </td>
        </tr>
        <tr class="even">
            <td>
                showDetail(CellRangeAddress)
            </td>
            <td>
                Open (uncollapse) an outline group.
            </td>
        </tr>
        <tr class="odd">
            <td>
                showLevel(n, CellRangeAddress)
            </td>
            <td>
                Show outlined groups from levels one through n.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="copying-moving-and-inserting-cells">
                            <span id="anchor-362"></span>Copying, moving, and inserting cells
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    In a Writer document, the primary method for moving or copying text content is to use the clipboard. The Spreadsheet
    service, however, provides methods for directly moving and inserting cells. When new cells are inserted, you specify
    how cells are moved out of the way by using the CellInsertMode enumeration (see ).
</p>
<p>
    <strong>Table .</strong> Values defined by the com.sun.star.sheet.CellInsertMode enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.CellInsertMode.NONE
            </td>
            <td>
                No cells are moved.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.CellInsertMode.DOWN
            </td>
            <td>
                Move cells down.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.CellInsertMode.RIGHT
            </td>
            <td>
                Move cells right.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.CellInsertMode.ROWS
            </td>
            <td>
                Move the entire row down.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.CellInsertMode.COLUMNS
            </td>
            <td>
                Move the entire column right.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the insertCells(CellRangeAddress, CellInsertMode) method to create space the size of the cell range address. If
    the insert mode is COLUMNS, then the entire column, starting with the leftmost column in the range, is shifted to
    the right the width of the range. If the insert mode is RIGHT, then the entire column is not shifted right; only the
    rows in the range are shifted. The cell insert modes ROWS and DOWN behave similarly to the COLUMNS and RIGHT modes.
    Using the cell insert range of NONE causes no cells to be moved; in other words, nothing happens. moves cells down.
</p>
<p>
    <strong>Listing .</strong> Move the range L4:M5 down.
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oRangeAddress 'The range to move
</p>
<p>
    oSheet = ThisComponent.Sheets(0)
</p>
<p>
    oRangeAddress = oSheet.getCellRangeByName("L4:M5").getRangeAddress()
</p>
<p>
    oSheet.insertCells(oRangeAddress, com.sun.star.sheet.CellInsertMode.DOWN)
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                The insertCells() and removeRange() methods silently fail if the insertion will cause an array formula
                to be split.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The removeRange(CellRangeAddress, CellInsertMode) method is essentially an “undo” command for the insertCells()
    method.
</p>
<p>
    Use the copyRange(CellAddress, CellRangeAddress) method to copy a range of cells to the location specified by the
    cell address. The top-left cell in the cell range address is positioned at the specified cell address when the range
    is copied. The net effect of the copyRange() method is the same as copying a range of cells to the clipboard,
    positioning the cursor at the specified cell, and then pasting the cells into place (see ).
</p>
<p>
    <strong>Listing .</strong> Copy the range L4:M5 to N8.
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oRangeAddress 'The range to copy
</p>
<p>
    Dim oCellAddress 'Destination address
</p>
<p>
    oSheet = ThisComponent.Sheets(0)
</p>
<p>
    oRangeAddress = oSheet.getCellRangeByName("L4:M5").getRangeAddress()
</p>
<p>
    oCellAddress = oSheet.getCellByPosition(13, 7).getCellAddress() 'N8
</p>
<p>
    oSheet.copyRange(oCellAddress, oRangeAddress)
</p>
<p>
    Use the moveRange(CellAddress, CellRangeAddress) method to move (rather than copy) a range of cells. The behavior of
    the moveRange() method is similar to that of the copyRange() method except that the cells are moved, rather than
    copied; the cells in the original range are left empty.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="copy-data-between-documents">
                            <span id="anchor-363"></span>Copy data between documents
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The copyRange method only supports copying a range in the same document. Other methods must be used to copy data
    between different documents.
</p>
<h4 id="data-functions">
    <span id="anchor-364"></span>Data functions
</h4>
<p>
    Use getData() and setData() to copy numbers. Use getDataArray() and setDataArray() to copy numbers and strings. The
    data functions are fast and easy, but they only copy data, not formatting.
</p>
<h4 id="clipboard">
    <span id="anchor-365"></span>Clipboard
</h4>
<p>
    Use dispatch commands to copy data using the clipboard. The clipboard provides many options when copying data. The
    primary issue with using the clipboard, is that the clipboard is inherently unsafe because other applications may be
    using the clipboard at the same time. Although the clipboard is not inherently safe, Paste Special provides numerous
    options when pasting data not available using other methods.
</p>
<p>
    <strong>Listing .</strong> Use the clipboard to copy data between two documents.
</p>
<p>
    oDispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
</p>
<p>
    oFrame1 = oDoc1.CurrentController.Frame
</p>
<p>
    ' Use the documents controller to select the cells A1:B2.
</p>
<p>
    oSheet = oDoc1.Sheets(0)
</p>
<p>
    rng = oSheet.getCellRangeByName("A1:B2")
</p>
<p>
    oDoc1.CurrentController.Select(rng)
</p>
<p>
    ' Use a dispatch to copy to the clipboard.
</p>
<p>
    oDispatcher.executeDispatch(oFrame1, ".uno:Copy", "", 0, Array())
</p>
<p>
    ' Upper left corner of where to paste the data.
</p>
<p>
    rng = oDoc2.Sheets(0).getCellRangeByName("A1")
</p>
<p>
    ' Place the view cursor there then paste the clipboard.
</p>
<p>
    oDoc2.CurrentController.Select(rng)
</p>
<p>
    oFrame2 = oDoc2.CurrentController.Frame
</p>
<p>
    oDispatcher.executeDispatch(oFrame2, ".uno:Paste", "", 0, Array())
</p>
<p>
    Use the macro recorder with Paste Special to see how arguments are set with paste special. One example is as
    follows:
</p>
<p>
    <strong>Listing .</strong> Arguments for Paste Special.
</p>
<p>
    Dim args1(5) as new com.sun.star.beans.PropertyValue
</p>
<p>
    args1(0).Name = "Flags"
</p>
<p>
    args1(0).Value = "SVDNT"
</p>
<p>
    args1(1).Name = "FormulaCommand"
</p>
<p>
    args1(1).Value = 0
</p>
<p>
    args1(2).Name = "SkipEmptyCells"
</p>
<p>
    args1(2).Value = false
</p>
<p>
    args1(3).Name = "Transpose"
</p>
<p>
    args1(3).Value = false
</p>
<p>
    args1(4).Name = "AsLink"
</p>
<p>
    args1(4).Value = false
</p>
<p>
    args1(5).Name = "MoveMode"
</p>
<p>
    args1(5).Value = 4
</p>
<p>
    oDispatcher.executeDispatch(oFrame2, ".uno:InsertContents", "", 0, args1())
</p>
<h4 id="transferable-content">
    <span id="anchor-366"></span>Transferable content
</h4>
<p>
    Transferable content, the newest method available for copying content, returns a copy of the selected data as though
    it was copied to the clipboard, without using the clipboard. Transferable content is also available in Writer
    documents. Unlike the clipboard, there is no inherent problems with transferable content, but you also do not have
    the flexibility of paste special.
</p>
<p>
    <strong>Listing .</strong> Use transferable content to copy data between two documents.
</p>
<p>
    Dim o
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oRange
</p>
<p>
    Dim oDoc
</p>
<p>
    oRange = oDoc1.Sheets(0).getCellRangeByName("B2:C3")
</p>
<p>
    oDoc1.CurrentController.select(oRange)
</p>
<p>
    o = oDoc1.CurrentController.getTransferable()
</p>
<p>
</p>
<p>
    oRange = oDoc2.Sheets(0).getCellRangeByName("F1")
</p>
<p>
    oDoc2.CurrentController.select(oRange)
</p>
<p>
    oDoc2.CurrentController.insertTransferable(o)
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="data-pilot-and-pivot-tables">
                            <span id="anchor-367"></span>Data pilot and pivot tables
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    OpenOffice.org has a feature named Data Pilot, but LibreOffice changed the name the Pivot Tables. This section
    assumes that you already know and understand the feature, and merely demonstrates how to implement some of the
    functions using macros.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                I could write a large section on the numerous uses of data pilot tables. To get a feel for the
                possibilities, look at the input table in and then inspect the summary data in , which is automatically
                generated by the data pilot functionality.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The DataPilot is a powerful mechanism that allows you to combine, compare, and analyze large amounts of data. The
    DataPilot manipulates portions of the data from the “source table” and then displays the results in a new location.
    Unfortunately, numerous details are involved with the creation and manipulation of data pilot tables, but this is
    due to their enormous flexibility.
</p>
<p>
    There are numerous details with respect to creating and using data pilot tables. Although the numerous details are
    logical and straightforward, they are so many that it is easy to become lost in the details. It’s instructive,
    therefore, to review a simple example that clarifies the details. I’ll present the specific types and enumerations
    following the example; you can review these as required.
</p>
<h4 id="a-data-pilot-example">
    <span id="anchor-368"></span>A data pilot example
</h4>
<p>
    For this example, I assume a fake company that sells books, candy, and pens. The company has offices in three states
    and multiple salespeople in each state. I created a spreadsheet that shows the sales for each product broken down by
    salesperson and year. The final goal of this example is to create a data pilot table that summarizes the sales of
    each product by type and state. The initial data used for this example in shown in .
</p>
<p>
    <strong>Table .</strong> Data values used for the DataPilot / PivotTable examples.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Books
            </td>
            <td>
                Michigan
            </td>
            <td>
                Jean
            </td>
            <td>
                $14,788.00
            </td>
            <td>
                $30,222.00
            </td>
            <td>
                $23,490.00
            </td>
        </tr>
        <tr class="even">
            <td>
                Candy
            </td>
            <td>
                Michigan
            </td>
            <td>
                Jean
            </td>
            <td>
                $26,388.00
            </td>
            <td>
                $15,641.00
            </td>
            <td>
                $32,849.00
            </td>
        </tr>
        <tr class="odd">
            <td>
                Pens
            </td>
            <td>
                Michigan
            </td>
            <td>
                Jean
            </td>
            <td>
                $16,569.00
            </td>
            <td>
                $32,675.00
            </td>
            <td>
                $25,396.00
            </td>
        </tr>
        <tr class="even">
            <td>
                Books
            </td>
            <td>
                Michigan
            </td>
            <td>
                Volker
            </td>
            <td>
                $21,961.00
            </td>
            <td>
                $21,242.00
            </td>
            <td>
                $29,009.00
            </td>
        </tr>
        <tr class="odd">
            <td>
                Candy
            </td>
            <td>
                Michigan
            </td>
            <td>
                Volker
            </td>
            <td>
                $26,142.00
            </td>
            <td>
                $22,407.00
            </td>
            <td>
                $32,841.00
            </td>
        </tr>
        <tr class="even">
            <td>
                Pens
            </td>
            <td>
                Michigan
            </td>
            <td>
                Volker
            </td>
            <td>
                $29,149.00
            </td>
            <td>
                $18,320.00
            </td>
            <td>
                $34,429.00
            </td>
        </tr>
        <tr class="odd">
            <td>
                Books
            </td>
            <td>
                Ohio
            </td>
            <td>
                Rebecca
            </td>
            <td>
                $21,845.00
            </td>
            <td>
                $33,503.00
            </td>
            <td>
                $32,200.00
            </td>
        </tr>
        <tr class="even">
            <td>
                Candy
            </td>
            <td>
                Ohio
            </td>
            <td>
                Rebecca
            </td>
            <td>
                $23,799.00
            </td>
            <td>
                $23,597.00
            </td>
            <td>
                $23,020.00
            </td>
        </tr>
        <tr class="odd">
            <td>
                Pens
            </td>
            <td>
                Ohio
            </td>
            <td>
                Rebecca
            </td>
            <td>
                $28,328.00
            </td>
            <td>
                $17,930.00
            </td>
            <td>
                $23,303.00
            </td>
        </tr>
        <tr class="even">
            <td>
                Books
            </td>
            <td>
                Ohio
            </td>
            <td>
                Catherine
            </td>
            <td>
                $22,797.00
            </td>
            <td>
                $31,386.00
            </td>
            <td>
                $39,490.00
            </td>
        </tr>
        <tr class="odd">
            <td>
                Candy
            </td>
            <td>
                Ohio
            </td>
            <td>
                Catherine
            </td>
            <td>
                $13,613.00
            </td>
            <td>
                $16,174.00
            </td>
            <td>
                $35,163.00
            </td>
        </tr>
        <tr class="even">
            <td>
                Pens
            </td>
            <td>
                Ohio
            </td>
            <td>
                Catherine
            </td>
            <td>
                $17,103.00
            </td>
            <td>
                $32,563.00
            </td>
            <td>
                $35,804.00
            </td>
        </tr>
        <tr class="odd">
            <td>
                Books
            </td>
            <td>
                Kentucky
            </td>
            <td>
                Michelle
            </td>
            <td>
                $29,952.00
            </td>
            <td>
                $19,133.00
            </td>
            <td>
                $33,480.00
            </td>
        </tr>
        <tr class="even">
            <td>
                Candy
            </td>
            <td>
                Kentucky
            </td>
            <td>
                Michelle
            </td>
            <td>
                $15,348.00
            </td>
            <td>
                $31,094.00
            </td>
            <td>
                $39,722.00
            </td>
        </tr>
        <tr class="odd">
            <td>
                Pens
            </td>
            <td>
                Kentucky
            </td>
            <td>
                Michelle
            </td>
            <td>
                $24,358.00
            </td>
            <td>
                $27,236.00
            </td>
            <td>
                $27,129.00
            </td>
        </tr>
        <tr class="even">
            <td>
                Books
            </td>
            <td>
                Kentucky
            </td>
            <td>
                Andy
            </td>
            <td>
                $17,199.00
            </td>
            <td>
                $26,386.00
            </td>
            <td>
                $30,450.00
            </td>
        </tr>
        <tr class="odd">
            <td>
                Candy
            </td>
            <td>
                Kentucky
            </td>
            <td>
                Andy
            </td>
            <td>
                $11,628.00
            </td>
            <td>
                $18,232.00
            </td>
            <td>
                $28,953.00
            </td>
        </tr>
        <tr class="even">
            <td>
                Pens
            </td>
            <td>
                Kentucky
            </td>
            <td>
                Andy
            </td>
            <td>
                $23,828.00
            </td>
            <td>
                $32,031.00
            </td>
            <td>
                $37,551.00
            </td>
        </tr>
    </tbody>
</table>
<h5 id="generating-the-data">
    <span id="anchor-369"></span>Generating the data
</h5>
<p>
    The data shown in is generated by the macro in , which sets both the data and the formatting. Watch for the
    following techniques:
</p>
<ul>
    <li>
        Generating random data.
    </li>
    <li>
        Setting all of the data at one time using the method setDataArray().
    </li>
    <li>
        Centering the headers and setting the cell background color.
    </li>
    <li>
        Formatting a cell as currency.
    </li>
</ul>
<p>
    <strong>Listing .</strong> Create the document used for the DataPilot / PivotTable examples.
</p>
<p>
    Function createPivotTableDoc()
</p>
<p>
    Dim oDoc 'Reference newly created calc document.
</p>
<p>
    Dim oSheet
</p>
<p>
    Dim oRange
</p>
<p>
    Dim oData
</p>
<p>
    Dim oFormats
</p>
<p>
</p>
<p>
    oData = Array(Array("Item", "State", "Team", "2002", "2003", "2004"), _
</p>
<p>
    Array("Books", "Michigan", "Jean", 14788, 30222, 23490), _
</p>
<p>
    Array("Candy", "Michigan", "Jean", 26388, 15641, 32849), _
</p>
<p>
    Array("Pens", "Michigan", "Jean", 16569, 32675, 25396), _
</p>
<p>
    Array("Books", "Michigan", "Volker", 21961, 21242, 29009), _
</p>
<p>
    Array("Candy", "Michigan", "Volker", 26142, 22407, 32841), _
</p>
<p>
    Array("Pens", "Michigan", "Volker", 29149, 18320, 34429), _
</p>
<p>
    Array("Books", "Ohio", "Rebecca", 21845, 33503, 32200), _
</p>
<p>
    Array("Candy", "Ohio", "Rebecca", 23799, 23597, 23020), _
</p>
<p>
    Array("Pens", "Ohio", "Rebecca", 28328, 17930, 23303), _
</p>
<p>
    Array("Books", "Ohio", "Catherine", 22797, 31386, 39490), _
</p>
<p>
    Array("Candy", "Ohio", "Catherine", 13613, 16174, 35163), _
</p>
<p>
    Array("Pens", "Ohio", "Catherine", 17103, 32563, 35804), _
</p>
<p>
    Array("Books", "Kentucky", "Michelle", 29952, 19133, 33480), _
</p>
<p>
    Array("Candy", "Kentucky", "Michelle", 15348, 31094, 39722), _
</p>
<p>
    Array("Pens", "Kentucky", "Michelle", 24358, 27236, 27129), _
</p>
<p>
    Array("Books", "Kentucky", "Andy", 17199, 26386, 30450), _
</p>
<p>
    Array("Candy", "Kentucky", "Andy", 11628, 18232, 28953), _
</p>
<p>
    Array("Pens", "Kentucky", "Andy", 23828, 32031, 37551))
</p>
<p>
</p>
<p>
    oDoc = StarDesktop.loadComponentFromURL("private:factory/scalc", "_default", 0, Array())
</p>
<p>
    oSheet = oDoc.Sheets(0)
</p>
<p>
    oSheet.getCellRangeByName("A1:F19").setDataArray(oData)
</p>
<p>
</p>
<p>
    ' Set the title area
</p>
<p>
    oRange = oSheet.getCellRangeByName("A1:F1")
</p>
<p>
    oRange.HoriJustify = com.sun.star.table.CellHoriJustify.CENTER
</p>
<p>
    oRange.CellBackColor = RGB(225, 225, 225)
</p>
<p>
</p>
<p>
    ' Format numbers as currency
</p>
<p>
    oFormats = oDoc.NumberFormats
</p>
<p>
    Dim aLocale As New com.sun.star.lang.Locale
</p>
<p>
    oRange = oSheet.getCellRangeByName("D2:F19")
</p>
<p>
    oRange.NumberFormat = oFormats.getStandardFormat(_
</p>
<p>
    com.sun.star.util.NumberFormat.CURRENCY, aLocale)
</p>
<p>
    createPivotTableDoc = oDoc
</p>
<p>
    End Function
</p>
<h5 id="creating-the-data-pilot-table">
    <span id="anchor-370"></span>Creating the data pilot table
</h5>
<p>
    The macro in creates and inserts a data pilot table as follows:
</p>
<ol type="1">
    <li>
        Create the data pilot table descriptor using the method createDataPilotDescriptor().
    </li>
    <li>
        Set the source range of the data to use.
    </li>
    <li>
        Configure which column is used for which purpose.
    </li>
    <li>
        Insert the data pilot table descriptor into the set of tables.
    </li>
</ol>
<p>
    <strong>Listing .</strong> Create a data pilot table.
</p>
<p>
    Sub CreateDataPilotTable()
</p>
<p>
    Dim oSheet 'Sheet that contains the data pilot
</p>
<p>
    Dim oRange 'Range for the data pilot source
</p>
<p>
    Dim oRangeAddress'The address of the range object
</p>
<p>
    Dim oTables 'Collection of data pilot tables
</p>
<p>
    Dim oTDescriptor 'A single data pilot descriptor
</p>
<p>
    Dim oFields 'Collection of all fields
</p>
<p>
    Dim oField 'A single field
</p>
<p>
    Dim oCellAddress As New com.sun.star.table.CellAddress
</p>
<p>
    Dim oDoc
</p>
<p>
    oDoc = createPivotTableDoc()
</p>
<p>
    oSheet = oDoc.Sheets.getByIndex(0)
</p>
<p>
    oRange = oSheet.getCellRangeByName("A1:F19")
</p>
<p>
</p>
<p>
    REM Sure, I could simply specify the address, but this is much more fun!
</p>
<p>
    REM Set the destination address to be two rows below the data.
</p>
<p>
    oRangeAddress = oRange.getRangeAddress()
</p>
<p>
    oCellAddress.Sheet = oRangeAddress.Sheet
</p>
<p>
    oCellAddress.Column = oRangeAddress.StartColumn
</p>
<p>
    oCellAddress.Row = oRangeAddress.EndRow + 2
</p>
<p>
</p>
<p>
    oTables = oSheet.getDataPilotTables()
</p>
<p>
</p>
<p>
    REM Step 1, create the descriptor
</p>
<p>
    oTDescriptor = oTables.createDataPilotDescriptor()
</p>
<p>
</p>
<p>
    REM Step 2, Set the source range
</p>
<p>
    oTDescriptor.setSourceRange(oRangeAddress)
</p>
<p>
</p>
<p>
    REM Step 3, Set the fields
</p>
<p>
    oFields = oTDescriptor.getDataPilotFields()
</p>
<p>
</p>
<p>
    REM Column 0 in the source is Item and I want this as a row item.
</p>
<p>
    oField = oFields.getByIndex(0)
</p>
<p>
    oField.Orientation = com.sun.star.sheet.DataPilotFieldOrientation.ROW
</p>
<p>
</p>
<p>
    REM Column 1 in the source is State and I want this as a column item.
</p>
<p>
    oField = oFields.getByIndex(1)
</p>
<p>
    oField.Orientation = com.sun.star.sheet.DataPilotFieldOrientation.COLUMN
</p>
<p>
</p>
<p>
    REM Column 3 in the source is 2002. Create a sum in the data for this!
</p>
<p>
    oField = oFields.getByIndex(3)
</p>
<p>
    oField.Orientation = com.sun.star.sheet.DataPilotFieldOrientation.DATA
</p>
<p>
    oField.Function = com.sun.star.sheet.GeneralFunction.SUM
</p>
<p>
</p>
<p>
    oTables.insertNewByName("MyFirstDataPilot", oCellAddress, oTDescriptor)
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000002D8000000D38E303AED.png" style="width:7in;height:2.0299in" />
</p>
<p>
    <strong><strong>Figure </strong><strong></strong><strong>.</strong></strong> The macro in inserts the data pilot
    table immediately after the source data.
</p>
<h4 id="manipulating-data-pilot-tables">
    <span id="anchor-371"></span>Manipulating data pilot tables
</h4>
<p>
    The getDataPilotTables() method, supported by each spreadsheet, returns an object that supports the service
    com.sun.star.sheet.DataPilotTables. The returned service provides access to the data pilot tables in the spreadsheet
    using both indexed and enumeration access. The DataPilotTables object also supports the methods in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Methods defined by the
    com.sun.star.sheet.XDataPilotTables interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                createDataPilotDescriptor()
            </td>
            <td>
                Create a new data pilot descriptor.
            </td>
        </tr>
        <tr class="even">
            <td>
                insertNewByName(name, CellAddress, DataPilotDescriptor)
            </td>
            <td>
                Add a new data pilot table to the collection that uses the provided CellAddress (see ) as the top-left
                corner of the table.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeByName(name)
            </td>
            <td>
                Delete a data pilot table from the collection.
            </td>
        </tr>
    </tbody>
</table>
<h5 id="data-pilot-fields">
    <span id="anchor-372"></span>Data pilot fields
</h5>
<p>
    Each “field” in the created data pilot table is represented by a column in the source data pilot table (cell range)
    and is named using the topmost cell of the column in the range. The field name is available through the methods
    getName() and setName(String).
</p>
<p>
    Each field contains an Orientation property of type DataPilotFieldOrientation that specifies how the field is used
    in the final output (see ). The Function property specifies the function used to calculate results for this field
    based on the GeneralFunction enumeration (see ).
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Values defined by the
    com.sun.star.sheet.DataPilotFieldOrientation enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.DataPilotFieldOrientation.HIDDEN
            </td>
            <td>
                Do not use the field.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.DataPilotFieldOrientation.COLUMN
            </td>
            <td>
                Use the field as a column field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.DataPilotFieldOrientation.ROW
            </td>
            <td>
                Use the field as a row field.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.DataPilotFieldOrientation.PAGE
            </td>
            <td>
                Use the field as a page field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.DataPilotFieldOrientation.DATA
            </td>
            <td>
                Use the field as a data field.
            </td>
        </tr>
    </tbody>
</table>
<h5 id="filtering-data-pilot-fields">
    <span id="anchor-373"></span>Filtering data pilot fields
</h5>
<p>
    The fields in the created table may be conditionally displayed based on a FilterOperator (see ).
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Values defined by the
    com.sun.star.sheet.FilterOperator enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FilterOperator.EMPTY
            </td>
            <td>
                Select empty entries.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FilterOperator.NOT_EMPTY
            </td>
            <td>
                Select nonempty entries.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FilterOperator.EQUAL
            </td>
            <td>
                The entry’s value must equal the specified value.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FilterOperator.NOT_EQUAL
            </td>
            <td>
                The entry’s value must not be equal to the specified value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FilterOperator.GREATER
            </td>
            <td>
                The entry’s value must be greater than the specified value.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FilterOperator.GREATER_EQUAL
            </td>
            <td>
                The entry’s value must be greater than or equal to the specified value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FilterOperator.LESS
            </td>
            <td>
                The entry’s value must be less than the specified value.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FilterOperator.LESS_EQUAL
            </td>
            <td>
                The entry’s value must be less than or equal to the specified value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FilterOperator.TOP_VALUES
            </td>
            <td>
                Select a specified number with the greatest values.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FilterOperator.TOP_PERCENT
            </td>
            <td>
                Select a specified percentage with the greatest values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FilterOperator.BOTTOM_VALUES
            </td>
            <td>
                Select a specified number with the lowest values.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FilterOperator.BOTTOM_PERCENT
            </td>
            <td>
                Select a specified percentage with the lowest values.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The individual filter operators are combined using the FilterConnection enumeration (see ). Each individual filter
    field is stored in a TableFilterField structure (see ). The entire collection of TableFilterFields is stored in a
    SheetFilterDescriptor. The descriptor supports the methods getFilterFields() and setFilterFields(), to get and set
    the table filter fields as an array of TableFilterField structures. The properties in<br /> are defined by the
    SheetFilterDescriptor to direct the filtering process.
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Values defined by the
    com.sun.star.sheet.FilterConnection enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.FilterConnection.AND
            </td>
            <td>
                Both conditions must be satisfied.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.FilterConnection.OR
            </td>
            <td>
                At least one of the conditions must be satisfied.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Properties in the
    com.sun.star.sheet.TableFilterField structure.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Connection
            </td>
            <td>
                Specify how the condition is connected to the previous condition as a FilterConnection (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                Field
            </td>
            <td>
                Specify which field (column) is used for the condition as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Operator
            </td>
            <td>
                Specify the condition type as a FilterOperator (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                IsNumeric
            </td>
            <td>
                If True, the NumericValue property is used; otherwise the StringValue is used.
            </td>
        </tr>
        <tr class="odd">
            <td>
                NumericValue
            </td>
            <td>
                Specify a numeric value for the condition as a Double.
            </td>
        </tr>
        <tr class="even">
            <td>
                StringValue
            </td>
            <td>
                Specify a String value for the condition.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Properties defined by the
    com.sun.star.sheet.SheetFilterDescriptor service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                IsCaseSensitive
            </td>
            <td>
                If True, string comparisons are case sensitive.
            </td>
        </tr>
        <tr class="even">
            <td>
                SkipDuplicates
            </td>
            <td>
                If True, duplicate entries are not included in the result.
            </td>
        </tr>
        <tr class="odd">
            <td>
                UseRegularExpressions
            </td>
            <td>
                If True, string values in the TableFilterField structure are interpreted as regular expressions.
            </td>
        </tr>
        <tr class="even">
            <td>
                SaveOutputPosition
            </td>
            <td>
                If True (and CopyOutputData is True), the OutputPosition is saved for future calls.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Orientation
            </td>
            <td>
                Specify if columns or rows are filtered using the TableOrientation enumeration (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                ContainsHeader
            </td>
            <td>
                If True, the first row (or column) is assumed to be a header and is not filtered.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CopyOutputData
            </td>
            <td>
                If True, the filtered data is copied to the OutputPosition.
            </td>
        </tr>
        <tr class="even">
            <td>
                OutputPosition
            </td>
            <td>
                Specify where filtered data is copied as a CellAddress (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                MaxFieldCount
            </td>
            <td>
                The maximum number of filter fields in the descriptor as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<h5 id="tables">
    <span id="anchor-374"></span>Tables
</h5>
<p>
    Each data pilot table is based on a spreadsheet cell range. Each data pilot table also supports the object method
    getOutputRange(), which returns a CellRangeAddress (see ). The refresh() method re-creates the table using the
    current data in the source range. Each data pilot table also suports the DataPilotDescriptor service, which defines
    the methods in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Methods defined by the
    com.sun.star.sheet.XDataPilotDescriptor interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getTag()
            </td>
            <td>
                Get the data pilot table tag as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                setTag(String)
            </td>
            <td>
                Set the data pilot table tag.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getSourceRange()
            </td>
            <td>
                Return the CellRangeAddress (see ) containing the data for the data pilot table.
            </td>
        </tr>
        <tr class="even">
            <td>
                setSourceRange(CellRangeAddress)
            </td>
            <td>
                Set the cell range containing the data for the data pilot table.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getFilterDescriptor()
            </td>
            <td>
                Get the SheetFilterDescriptor (see ) that specifies which data from the source cell range is used for
                the data pilot table.
            </td>
        </tr>
        <tr class="even">
            <td>
                getDataPilotFields()
            </td>
            <td>
                Get the data pilot fields as an object that supports indexed access.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getColumnFields()
            </td>
            <td>
                Get the data pilot fields used as column fields as an object that supports indexed access.
            </td>
        </tr>
        <tr class="even">
            <td>
                getRowFields()
            </td>
            <td>
                Get the data pilot fields used as row fields as an object that supports indexed access.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getPageFields()
            </td>
            <td>
                Get the data pilot fields used as page fields as an object that supports indexed access.
            </td>
        </tr>
        <tr class="even">
            <td>
                getDataFields()
            </td>
            <td>
                Get the data pilot fields used as data fields as an object that supports indexed access.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getHiddenFields()
            </td>
            <td>
                Get the data pilot fields that are not used as column, row, page, or data fields.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="sheet-cursors">
                            <span id="anchor-375"></span>Sheet cursors
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    In a Calc document, a cursor is a cell range that contains methods to move through the contained cells. Cursors are
    not used as frequently with Calc documents as with Writer documents because, unlike Writer documents, most content
    is directly accessible by index or name. Sheet cursors, like cell ranges, are limited to one sheet at a time. The
    SheetCellCursor service used by Calc documents is similar to cell cursors used in text tables (see ).
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Primary components supported by the
    com.sun.star.sheet.SheetCellCursor service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.table.CellCursor
            </td>
            <td>
                Methods to control the position of a cell cursor.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.table.CellRange
            </td>
            <td>
                Methods to access cells or subranges of a cell range (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.XSheetCellCursor
            </td>
            <td>
                Advanced methods to control the position of the cursor.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.SheetCellRange
            </td>
            <td>
                A rectangular range of cells in a spreadsheet document; this is an extension of the CellRange service
                for use in spreadsheet documents.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.XUsedAreaCursor
            </td>
            <td>
                Methods to find the used area in a sheet.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The primary methods supported by the SheetCellCursor are shown in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Primary methods supported by the
    com.sun.star.sheet.SheetCellCursor service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                XCellCursor
            </td>
            <td>
                gotoStart()
            </td>
            <td>
                Move the cursor to the first filled cell at the beginning of a contiguous series of filled cells. This
                cell may be outside the cursor’s range.
            </td>
        </tr>
        <tr class="even">
            <td>
                XCellCursor
            </td>
            <td>
                gotoEnd()
            </td>
            <td>
                Move the cursor to the last filled cell at the end of a contiguous series of filled cells. This cell may
                be outside the cursor’s range.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XCellCursor
            </td>
            <td>
                gotoNext()
            </td>
            <td>
                Move the cursor to the next (right) unprotected cell.
            </td>
        </tr>
        <tr class="even">
            <td>
                XCellCursor
            </td>
            <td>
                gotoPrevious()
            </td>
            <td>
                Move the cursor to the previous (left) unprotected cell.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XCellCursor
            </td>
            <td>
                gotoOffset(nCol, nRow)
            </td>
            <td>
                Shift the cursor’s range relative to the current position. Negative numbers shift left and up; positive
                numbers shift right and down.
            </td>
        </tr>
        <tr class="even">
            <td>
                XCellRange
            </td>
            <td>
                getCellByPosition(left, top)
            </td>
            <td>
                Get a cell within the range.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XCellRange
            </td>
            <td>
                getCellRangeByPosition(left, top, right, bottom)
            </td>
            <td>
                Get a cell range within the range.
            </td>
        </tr>
        <tr class="even">
            <td>
                XCellRange
            </td>
            <td>
                getCellRangeByName(name)
            </td>
            <td>
                Get a cell range within the range based on its name. The string directly references cells using the
                standard formats<em><em> — </em></em>such as “B2:D5” or “$B$2”<em><em> — </em></em>or defined cell range
                names.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XSheetCellCursor
            </td>
            <td>
                collapseToCurrentRegion()
            </td>
            <td>
                Expand the range to contain all contiguous nonempty cells.
            </td>
        </tr>
        <tr class="even">
            <td>
                XSheetCellCursor
            </td>
            <td>
                collapseToCurrentArray()
            </td>
            <td>
                Expand the range to contain the current array formula.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XSheetCellCursor
            </td>
            <td>
                collapseToMergedArea()
            </td>
            <td>
                Expand the range to contain merged cells that intersect the range.
            </td>
        </tr>
        <tr class="even">
            <td>
                XSheetCellCursor
            </td>
            <td>
                expandToEntireColumns()
            </td>
            <td>
                Expand the range to contain all columns that intersect the range.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XSheetCellCursor
            </td>
            <td>
                expandToEntireRows()
            </td>
            <td>
                Expand the range to contain all rows that intersect the range.
            </td>
        </tr>
        <tr class="even">
            <td>
                XSheetCellCursor
            </td>
            <td>
                collapseToSize(nCols, nRows)
            </td>
            <td>
                Without changing the upper-left corner, set the cursor range size.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XSheetCellRange
            </td>
            <td>
                getSpreadsheet()
            </td>
            <td>
                Get the sheet object that contains the cell range.
            </td>
        </tr>
        <tr class="even">
            <td>
                XUsedAreaCursor
            </td>
            <td>
                gotoStartOfUsedArea()
            </td>
            <td>
                Set the cursor to the start of the used area.
            </td>
        </tr>
        <tr class="odd">
            <td>
                XUsedAreaCursor
            </td>
            <td>
                gotoEndOfUsedArea()
            </td>
            <td>
                Set the cursor to the end of the used area.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Cell ranges, and therefore cell cursors, deal with rectangular regions. The use of rectangular regions may be
    obvious now that I state it, but it caught me by surprise when I tested the gotoStart() and gotoEnd() methods listed
    in . I started with the configuration shown in when writing the code in .
</p>
<p>
    <strong>Listing .</strong> Simple cursor movement commands use contiguous blocks.
</p>
<p>
    oCurs = oSheet.createCursorByRange(oSheet.getCellRangeByName("C3"))
</p>
<p>
    oCurs.gotoStart() REM Move the cursor to cell B1
</p>
<p>
    oCurs.gotoEnd() REM Move the cursor to cell E8
</p>
<p>
    oCurs.gotoStart() REM Move the cursor to cell E8
</p>
<p>
    The first line in positions the cursor at cell C3, right in the middle of a block of values. In , the leftmost
    contiguous column is B and the topmost contiguous row is 1. The method gotoStart(), therefore, positions the cursor
    in the top-left corner at location B1. This is where things become a little bit unexpected. The rightmost contiguous
    column is E and the bottommost contiguous row is 8. The method gotoEnd(), therefore, positions the cursor at
    location E8. As it is shown in , the cell E8 is completely disconnected from the contiguous group of cells. The
    cursor is positioned to cell E8, even if it does not contain a value. The cursor is no longer related to the
    original block of cells, so the method gotoStart() does not move the cursor back to cell B1.
</p>
<p>
    To understand the behavior of , it’s important to understand how OOo determines contiguous cells, because it isn’t
    documented anywhere that I can find. Experimentally, I have determined that the set of contiguous nonempty cells is
    defined as the smallest range (square block of cells) that can be enclosed by empty cells. If cell E9 contained a
    value, then even though cells E8 and E9 are not directly connected via nonempty cells to the original block of
    cells, they would both be considered part of the block of contiguous nonempty cells.
</p>
<p>
    The method collapseToCurrentRegion() causes the cursor to contain the block of contiguous cells. The only caveat is
    that after the range is collapsed, it always contains the original range, even if this range includes unnecessary
    empty cells. The method collapseToCurrentArray() is similar to collapseToCurrentRegion(), except that it returns a
    range that contains an array formula. The upper-left corner of the region must include an array formula for the
    collapseToCurrentArray() method to work.
</p>
<p>
    The code snippet in <strong> </strong>creates a cursor over a range and then demonstrates that getCellByPosition()
    and getCellRangeByPosition() are relative to the upper-left corner of the range. The method getCellRangeByName()
    generates an exception if a cell outside the range is requested.
</p>
<p>
    <strong>Listing .</strong> Some commands work only relative to the range.
</p>
<p>
    oCurs = oSheet.createCursorByRange(oSheet.getCellRangeByName("C3:F12"))
</p>
<p>
    oCell = oCurs.getCellByPosition(0, 0) REM Cell C3
</p>
<p>
    oRange = oCurs.getCellRangeByPosition(1, 0, 3, 2) REM D3:F5
</p>
<p>
    oRange = oCurs.getCellRangeByName("C4:D6") REM C4:D6
</p>
<p>
    oRange = oCurs.getCellRangeByName("C2:D6") REM Error C2 not in range!
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                The methods getCellByPosition(), getCellRangeByPosition(), and getCellRangeByName() cannot return a
                value that is not in the range.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="calc-documents-1">
                    <span id="anchor-376"></span>Calc documents
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Many of the document-level methods and properties affect the entire document<em><em> — </em></em>for example, the
    ability to save and print a document. Other methods and properties exist purely as a convenience and the information
    is also available at the sheet level. For example, the Calc document acts as a draw-page supplier to access all of
    the draw pages, even though they are available individually from the sheet that contains them.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="named-range">
                            <span id="anchor-377"></span>Named range
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The official definition of a named range is a named formula expression. Typically, a named range represents a cell
    range, but it may also refer to external data. Naming ranges allows you to give meaningful names to things that you
    reference. Named ranges may therefore be used as an address in a formula; for example, after defining a range named
    Scores, I can use the formula =Sum(Scores). The NamedRangeFlag constants define how a named range may be used (see
    ).
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Constants defined by the
    com.sun.star.sheet.NamedRangeFlag constant group.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                FILTER_CRITERIA
            </td>
            <td>
                The range contains filter criteria.
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                PRINT_AREA
            </td>
            <td>
                The range can be used as a print range.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                COLUMN_HEADER
            </td>
            <td>
                The range can be used as column headers for printing.
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                ROW_HEADER
            </td>
            <td>
                The range can be used as row headers for printing.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Each named range service supports the methods in .
</p>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Methods implemented by the
    com.sun.star.sheet.NamedRange service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getReferredCells()
            </td>
            <td>
                Get the CellRange referenced by named range.
            </td>
        </tr>
        <tr class="even">
            <td>
                getContent()
            </td>
            <td>
                The named range content is a string and can be a reference to a cell, cell range,<br /> or formula
                expression.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setContent(String)
            </td>
            <td>
                Set the content of the named range.
            </td>
        </tr>
        <tr class="even">
            <td>
                getReferencePosition()
            </td>
            <td>
                Get the CellAddress used as a base for relative references in the content.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setReferencePosition(CellAddress)
            </td>
            <td>
                Set the reference position.
            </td>
        </tr>
        <tr class="even">
            <td>
                getType()
            </td>
            <td>
                Get the type as a NamedRangeFlag constant (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                setType(NamedRangeFlag)
            </td>
            <td>
                Set the type of the named range.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The document’s NamedRanges property contains the collection of named ranges in the document. You can extract each
    individual named range by using named and indexed access.
</p>
<p>
    The method addNewByname() accepts four arguments; the name, content, position, and type. The fourth argument to the
    method addNewByName() is a combination of flags that specify how the named range will be used — the most common
    value is 0, which is not a defined constant value. The name and the content are both of type String. The CellAddress
    specifies the base address for relative cell references.
</p>
<p>
    <strong>Listing .</strong> Create a named range that references $Sheet1.$B$3:$D$6.
</p>
<p>
    Sub AddNamedRange()
</p>
<p>
    Dim oRange ' The created range.
</p>
<p>
    Dim oRanges ' All named ranges.
</p>
<p>
    Dim sName$ ' Name of the named range to create.
</p>
<p>
    Dim oCell ' Cell object.
</p>
<p>
    Dim s$
</p>
<p>
    sName$ = "MyNRange"
</p>
<p>
    oRanges = ThisComponent.NamedRanges
</p>
<p>
    If NOT oRanges.hasByName(sName$) Then
</p>
<p>
    REM I can obtain the cell address by obtaining the cell
</p>
<p>
    REM and then extracting the address from the cell.
</p>
<p>
    Dim oCellAddress As new com.sun.star.table.CellAddress
</p>
<p>
    oCellAddress.Sheet = 0 'The first sheet.
</p>
<p>
    oCellAddress.Column = 1 'Column B.
</p>
<p>
    oCellAddress.Row = 2 'Row 3.
</p>
<p>
    REM The first argument is the range name.
</p>
<p>
    REM The second argument is formula or expression to
</p>
<p>
    REM use. The second argument is usually a string that
</p>
<p>
    REM defines a range.
</p>
<p>
    REM The third argument specifies the base address for
</p>
<p>
    REM relative cell references.
</p>
<p>
    REM The fourth argument is a set of flags that define
</p>
<p>
    REM how the range is used, but most ranges use 0.
</p>
<p>
    REM The fourth argument uses values from the
</p>
<p>
    REM NamedRangeFlag constants.
</p>
<p>
    s$ = "$Sheet1.$B$3:$D$6"
</p>
<p>
    oRanges.addNewByName(sName$, s$, oCellAddress, 0)
</p>
<p>
    End If
</p>
<p>
    REM Get a range using the created named range.
</p>
<p>
    oRange = ThisComponent.NamedRanges.getByName(sName$)
</p>
<p>
    REM Print the string contained in cell $Sheet1.$B$3
</p>
<p>
    oCell = oRange.getReferredCells().getCellByPosition(0,0)
</p>
<p>
    Print oCell.getString()
</p>
<p>
    End Sub
</p>
<p>
    The third argument, a cell address, acts as the base address for cells referenced in a relative way. If the cell
    range is not specified as an absolute address, the referenced range will be different based on where in the
    spreadsheet the range is used. The relative behavior is illustrated in , which also illustrates another usage of a
    named range—defining an equation. The macro creates the named range AddLeft, which refers to the equation A3+B3 with
    C3 as the reference cell. The cells A3 and B3 are the two cells directly to the left of C3, so, the equation
    =AddLeft calculates the sum of the two cells directly to the left of the cell that contains the equation. Changing
    the reference cell to C4, which is below A3 and B3, causes the AddLeft equation to calculate the sum of the two
    cells that are to the left on the previous row.
</p>
<p>
    <strong>Listing .</strong> Create the AddLeft named range.
</p>
<p>
    Sub AddNamedFunction()
</p>
<p>
    Dim oSheet 'Sheet that contains the named range.
</p>
<p>
    Dim oCellAddress 'Address for relative references.
</p>
<p>
    Dim oRanges 'The NamedRanges property.
</p>
<p>
    Dim oRange 'Single cell range.
</p>
<p>
    Dim sName As String 'Name of the equation to create.
</p>
<p>
    sName = "AddLeft"
</p>
<p>
    oRanges = ThisComponent.NamedRanges
</p>
<p>
    If NOT oRanges.hasByName(sName) Then
</p>
<p>
    oSheet = ThisComponent.getSheets().getByIndex(0)
</p>
<p>
    oRange = oSheet.getCellRangeByName("C3")
</p>
<p>
    oCellAddress = oRange.getCellAddress()
</p>
<p>
    oRanges.addNewByName(sName, "A3+B3", oCellAddress, 0)
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    Use the method addNewFromTitles(CellRangeAddress, Border) to create named cell ranges from titles in a cell range.
    The Border value is taken from <strong> </strong>and it specifies where the titles are located in the cell range.
</p>
<p>
    <strong>Table .</strong> Enumerated values defined by the com.sun.star.sheet.Border enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.sheet.Border.TOP
            </td>
            <td>
                Select the top border.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.Border.BOTTOM
            </td>
            <td>
                Select the bottom border.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.sheet.Border.RIGHT
            </td>
            <td>
                Select the right border.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.sheet.Border.LEFT
            </td>
            <td>
                Select the left border.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The next macro creates three named ranges based on the top row of a cell range.
</p>
<p>
    <strong>Listing .</strong> Create many named ranges.
</p>
<p>
    Sub AddManyNamedRanges()
</p>
<p>
    Dim oSheet 'Sheet that contains the named range.
</p>
<p>
    Dim oAddress 'Range address.
</p>
<p>
    Dim oRanges 'The NamedRanges property.
</p>
<p>
    Dim oRange 'Single cell range.
</p>
<p>
    oRanges = ThisComponent.NamedRanges
</p>
<p>
    oSheet = ThisComponent.getSheets().getByIndex(0)
</p>
<p>
    oRange = oSheet.getCellRangeByName("A1:C20")
</p>
<p>
    oAddress = oRange.getRangeAddress()
</p>
<p>
    oRanges.addNewFromTitles(oAddress, com.sun.star.sheet.Border.TOP)
</p>
<p>
    End Sub
</p>
<p>
    Use the method outputList(CellAddress) to write a list of the named ranges to a sheet. The first column contains the
    name of each named range, and the second column contains the content. Finally, use the removeByName(name) method to
    remove a named range.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="database-range">
                            <span id="anchor-378"></span>Database range
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Although a database range can be used as a regular named range, a database range also defines a range of cells in a
    spreadsheet to be used as a database. Each row in a range corresponds to a record and each cell corresponds to a
    field. You can sort, group, search, and perform calculations on the range as if it were a database.
</p>
<p>
    A database range provides behavior that is useful when performing database related activities. For example, you can
    mark the first row as headings. To create, modify, or delete a database range, use Data &gt; Define Range to open
    the Define Data Range dialog.
</p>
<p>
    In a macro, a database range is accesses, created, and deleted from the DatabaseRanges property. The following macro
    creates a database range named “MyName” and sets the range to be used as an auto filter.
</p>
<p>
    <strong>Listing .</strong> Create a database range and an auto filter.
</p>
<p>
    Sub AddNewDatabaseRange()
</p>
<p>
    Dim oRange 'DatabaseRange object.
</p>
<p>
    Dim oAddr 'Cell address range for the database range.
</p>
<p>
    Dim oSheet 'First sheet, which will contain the range.
</p>
<p>
    Dim oDoc 'Reference ThisComponent with a shorter name.
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    If NOT oDoc.DatabaseRanges.hasByName("MyName") Then
</p>
<p>
    oSheet = ThisComponent.getSheets().getByIndex(0)
</p>
<p>
    oRange = oSheet.getCellRangeByName("A1:F10")
</p>
<p>
    oAddr = oRange.getRangeAddress()
</p>
<p>
    oDoc.DatabaseRanges.addNewByName("MyName", oAddr)
</p>
<p>
    End If
</p>
<p>
    oRange = oDoc.DatabaseRanges.getByName("MyName")
</p>
<p>
    oRange.AutoFilter = True
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="filters">
                            <span id="anchor-379"></span>Filters
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Use filters to limit the visible rows in a spreadsheet. Generic filters, common to all sorts of data manipulations,
    are automatically provided by the auto filter capability. You can also define your own filters.
</p>
<p>
    <strong>Listing .</strong> Create a simple sheet filter.
</p>
<p>
    Sub SimpleSheetFilter()
</p>
<p>
    Dim oSheet ' Sheet that will contain the filter.
</p>
<p>
    Dim oFilterDesc ' Filter descriptor.
</p>
<p>
    Dim oFields(0) As New com.sun.star.sheet.TableFilterField
</p>
<p>
</p>
<p>
    oSheet = ThisComponent.getSheets().getByIndex(0)
</p>
<p>
</p>
<p>
    REM If argument is True, creates an empty filter
</p>
<p>
    REM descriptor. If argument is False, create a
</p>
<p>
    REM descriptor with the previous settings.
</p>
<p>
    oFilterDesc = oSheet.createFilterDescriptor(True)
</p>
<p>
</p>
<p>
    With oFields(0)
</p>
<p>
    REM I could use the Connection property to indicate
</p>
<p>
    REM how to connect to the previous field. This is
</p>
<p>
    REM the first field so this is not required.
</p>
<p>
    '.Connection = com.sun.star.sheet.FilterConnection.AND
</p>
<p>
    '.Connection = com.sun.star.sheet.FilterConnection.OR
</p>
<p>
    REM The Field property is the zero based column
</p>
<p>
    REM number to filter. If you have the cell, you
</p>
<p>
    REM can use .Field = oCell.CellAddress.Column.
</p>
<p>
    .Field = 5
</p>
<p>
    REM Compare using a numeric or a string?
</p>
<p>
    .IsNumeric = True
</p>
<p>
    REM The NumericValue property is used
</p>
<p>
    REM because .IsNumeric = True from above.
</p>
<p>
    .NumericValue = 80
</p>
<p>
    REM If IsNumeric was False, then the
</p>
<p>
    REM StringValue property would be used.
</p>
<p>
    REM .StringValue = "what ever"
</p>
<p>
    REM Valid operators include EMPTY, NOT_EMPTY, EQUAL,
</p>
<p>
    REM NOT_EQUAL, GREATER, GREATER_EQUAL, LESS,
</p>
<p>
    REM LESS_EQUAL, TOP_VALUES, TOP_PERCENT,
</p>
<p>
    REM BOTTOM_VALUES, and BOTTOM_PERCENT
</p>
<p>
    .Operator = com.sun.star.sheet.FilterOperator.GREATER_EQUAL
</p>
<p>
    End With
</p>
<p>
</p>
<p>
    REM The filter descriptor supports the following
</p>
<p>
    REM properties: IsCaseSensitive, SkipDuplicates,
</p>
<p>
    REM UseRegularExpressions,
</p>
<p>
    REM SaveOutputPosition, Orientation, ContainsHeader,
</p>
<p>
    REM CopyOutputData, OutputPosition, and MaxFieldCount.
</p>
<p>
    oFilterDesc.setFilterFields(oFields())
</p>
<p>
    oFilterDesc.ContainsHeader = True
</p>
<p>
    oSheet.filter(oFilterDesc)
</p>
<p>
    End Sub
</p>
<p>
    When a filter is applied to a sheet, it replaces any existing filter for the sheet. Setting an empty filter in a
    sheet will therefore remove all filters for that sheet.
</p>
<p>
    <strong>Listing .</strong> Remove the current sheet filter.
</p>
<p>
    Sub RemoveSheetFilter()
</p>
<p>
    Dim oSheet ' Sheet to filter.
</p>
<p>
    Dim oFilterDesc ' Filter descriptor.
</p>
<p>
</p>
<p>
    oSheet = ThisComponent.getSheets().getByIndex(0)
</p>
<p>
    oFilterDesc = oSheet.createFilterDescriptor(True)
</p>
<p>
    oSheet.filter(oFilterDesc)
</p>
<p>
    End Sub
</p>
<p>
    A more advanced filter may filter more than one column.
</p>
<p>
    <strong>Listing .</strong> A simple sheet filter using two columns.
</p>
<p>
    Sub SimpleSheetFilter_2()
</p>
<p>
    Dim oSheet ' Sheet to filter.
</p>
<p>
    Dim oRange ' Range to be filtered.
</p>
<p>
    Dim oFilterDesc ' Filter descriptor.
</p>
<p>
    Dim oFields(1) As New com.sun.star.sheet.TableFilterField
</p>
<p>
</p>
<p>
    oSheet = ThisComponent.getSheets().getByIndex(0)
</p>
<p>
    oRange = oSheet.getCellRangeByName("E12:G19")
</p>
<p>
</p>
<p>
    REM If argument is True, creates an
</p>
<p>
    REM empty filter descriptor.
</p>
<p>
    oFilterDesc = oRange.createFilterDescriptor(True)
</p>
<p>
    REM Setup a field to view cells with content that
</p>
<p>
    REM start with the letter b.
</p>
<p>
    With oFields(0)
</p>
<p>
    .Field = 0 ' Filter column A.
</p>
<p>
    .IsNumeric = False ' Use a string, not a number.
</p>
<p>
    .StringValue = "b.*" ' Everything starting with b.
</p>
<p>
    .Operator = com.sun.star.sheet.FilterOperator.EQUAL
</p>
<p>
    End With
</p>
<p>
    REM Setup a field that requires both conditions and
</p>
<p>
    REM this new condition requires a value greater or
</p>
<p>
    REM equal to 70.
</p>
<p>
    With oFields(1)
</p>
<p>
    .Connection = com.sun.star.sheet.FilterConnection.AND
</p>
<p>
    .Field = 5 ' Filter column F.
</p>
<p>
    .IsNumeric = True ' Use a number
</p>
<p>
    .NumericValue = 70 ' Values greater than or equal to 70
</p>
<p>
    .Operator = com.sun.star.sheet.FilterOperator.GREATER_EQUAL
</p>
<p>
    End With
</p>
<p>
    oFilterDesc.setFilterFields(oFields())
</p>
<p>
    oFilterDesc.ContainsHeader = False
</p>
<p>
    oFilterDesc.UseRegularExpressions = True
</p>
<p>
    oSheet.filter(oFilterDesc)
</p>
<p>
    End Sub
</p>
<p>
    An advanced filter supports up to eight filter conditions, as opposed to the three supported by the simple filter.
    The criteria for an advanced filter is stored in a sheet. The first step in creating an advanced filter is entering
    the filter criteria into the spreadsheet.
</p>
<ol type="1">
    <li>
        Select an empty space in the Calc document. The empty space may reside in any sheet in any location in the Calc
        document.
    </li>
    <li>
        Duplicate the column headings from the area to be filtered into the area that will contain the filter criteria.
    </li>
    <li>
        Enter the filter criteria underneath the column headings. The criterion in each column of a row is connected
        with AND. The criteria from each row are connected with OR.
    </li>
</ol>
<p>
    Applying an advanced filter using a macro is simple. The cell range containing the filter criteria is used to create
    a filter descriptor, which is then used to filter the range containing the data.
</p>
<p>
    <strong>Listing .</strong> Use an advanced filter.
</p>
<p>
    Sub UseAnAdvancedFilter()
</p>
<p>
    Dim oSheet 'A sheet from the Calc document.
</p>
<p>
    Dim oRanges 'The NamedRanges property.
</p>
<p>
    Dim oCritRange 'Range that contains the filter criteria.
</p>
<p>
    Dim oDataRange 'Range that contains the data to filter.
</p>
<p>
    Dim oFiltDesc 'Filter descriptor.
</p>
<p>
    REM Range that contains the filter criteria
</p>
<p>
    oSheet = ThisComponent.getSheets().getByIndex(1)
</p>
<p>
    oCritRange = oSheet.getCellRangeByName("A1:G3")
</p>
<p>
    REM You can also obtain the range containing the
</p>
<p>
    REM filter criteria from a named range.
</p>
<p>
    REM oRanges = ThisComponent.NamedRanges
</p>
<p>
    REM oRange = oRanges.getByName("AverageLess80")
</p>
<p>
    REM oCritRange = oRange.getReferredCells()
</p>
<p>
    REM The data that I want to filter
</p>
<p>
    oSheet = ThisComponent.getSheets().getByIndex(0)
</p>
<p>
    oDataRange = oSheet.getCellRangeByName("A1:G16")
</p>
<p>
    oFiltDesc = oCritRange.createFilterDescriptorByObject(oDataRange)
</p>
<p>
    oDataRange.filter(oFiltDesc)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="protecting-documents-and-sheets">
                            <span id="anchor-380"></span>Protecting documents and sheets
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Calc documents and individual spreadsheets support the XProtectable interface. Use the methods protect(password) and
    unprotect(password) to activate or disable protection. The password is passed in as a String. The isProtected()
    method returns True if protection is currently active.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="controlling-recalculation">
                            <span id="anchor-381"></span>Controlling recalculation
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    By default, a Calc document automatically recalculates formulas when the cells to which they refer are modified. At
    times, it is useful to disable automatic recalculation. The methods in <strong> </strong>allow you to control
    recalculation in the entire document.
</p>
<p>
    <strong>Table .</strong> Methods defined by the com.sun.star.sheet.XCalculatable interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                calculate()
            </td>
            <td>
                Recalculate all cells with changed content.
            </td>
        </tr>
        <tr class="even">
            <td>
                calculateAll()
            </td>
            <td>
                Recalculate all cells.
            </td>
        </tr>
        <tr class="odd">
            <td>
                isAutomaticCalculationEnabled()
            </td>
            <td>
                True if automatic calculation is enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                enableAutomaticCalculation(Boolean)
            </td>
            <td>
                Enable or disable automatic calculation.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="using-goal-seek">
                            <span id="anchor-382"></span>Using Goal Seek
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    “Goal Seek” attempts to solve equations with one unknown variable. In other words, after defining a formula with
    multiple fixed values and one variable value, Goal Seek tries to find an acceptable value for the unknown variable.
</p>
<p>
    Consider a very simple example. If you jump off a cliff, gravity will accelerate you toward the ground at 32 feet
    per second each second. In other words, in one second you will be traveling at 32 feet per second and in two seconds
    you will be traveling at 64 feet per second. The equation is given as “velocity = acceleration * time”. I have a
    constant value for the acceleration due to gravity, and I want to know how long before I am traveling at 100 feet
    per second. Admittedly, this is a trivial example, but it is easy to understand.
</p>
<p>
    Use the document method seekGoal(CellAddress, CellAddress, String) to perform a Goal Seek operation. The first cell
    address identifies the cell that contains the formula to solve. The second cell address identifies the cell that
    contains the variable that will change. Place the best guess that you can make into this cell. The final string
    contains the value that you want to obtain from the formula. The macro in sets the formula and then performs a Goal
    Seek operation.
</p>
<p>
    <strong>Listing .</strong> Set a simple goal seek.
</p>
<p>
    Sub GoalSeekExample
</p>
<p>
    Dim oSheet 'oSheet will contain the first sheet.
</p>
<p>
    Dim oGCell 'B24, gravity value of 32
</p>
<p>
    Dim oTCell 'C24, time value
</p>
<p>
    Dim oRCell 'Resulting equation "=B24*C24"
</p>
<p>
    Dim oGoal 'Returned goal object
</p>
<p>
    oSheet = ThisComponent.Sheets(0)
</p>
<p>
    oGCell = oSheet.getCellByPosition(1, 23)
</p>
<p>
    oGCell.setValue(32)
</p>
<p>
</p>
<p>
    oTCell = oSheet.getCellByPosition(2, 23)
</p>
<p>
    oTCell.setValue(1)
</p>
<p>
    oRCell = oSheet.getCellByPosition(0, 23)
</p>
<p>
    oRCell.setFormula("=B24 * C24")
</p>
<p>
</p>
<p>
    oGoal=ThisComponent.seekGoal(oRCell.CellAddress, oTCell.CellAddress, "100")
</p>
<p>
    MsgBox "Result = " &amp; oGoal.Result &amp; CHR$(10) &amp;_
</p>
<p>
    "The result changed by " &amp; oGoal.Divergence &amp;_
</p>
<p>
    " in the last iteration", 0, "Goal Seek"
</p>
<p>
    End Sub
</p>
<p>
    The seekGoal() method returns a structure containing two floating-point Double values. The Result property
    identifies the proposed solution. The Divergence property identifies the difference between the last guessed result
    and the current result. If the divergence is small, the result is probably reasonably accurate. If, however, the
    divergence is large, the result is probably inaccurate. I performed a test where there was no solution. The
    divergence value was roughly 1.0E308.
</p>
<p>
    Do not let the simplicity of the provided example fool you. I used the seekGoal() method to provide a solution to a
    problem that had no closed form solution<em><em> — </em></em>I had to use a numerical algorithm to solve the
    problem.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="write-your-own-calc-functions">
                    <span id="anchor-383"></span>Write your own Calc functions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    With OOo, it’s trivial to write and use your own functions that are recognized by the Calc document. It’s as simple
    as writing a macro and then addressing it directly. I wrote an example of this in that returns information about the
    passed argument as a String. <strong> </strong>shows the return values for different arguments.
</p>
<p>
    <strong>Listing .</strong> Print information about the argument.
</p>
<p>
    Function WahooFunc(Optional x) As Variant
</p>
<p>
    Dim s$
</p>
<p>
    s = "I am in WahooFunc. "
</p>
<p>
    If IsMissing(x) Then
</p>
<p>
    s = s &amp; "No argument was passed"
</p>
<p>
    ElseIf NOT IsArray(x) Then
</p>
<p>
    s = s &amp; "Scalar argument (" &amp; CStr(x) &amp; ") is type " &amp; TypeName(x)
</p>
<p>
    Else
</p>
<p>
    s = s &amp; "Argument is an array (" &amp; LBound(x, 1) &amp; " To " &amp; UBound(x, 1) &amp;_
</p>
<p>
    ", " &amp; LBound(x, 2) &amp; " To " &amp; UBound(x, 2) &amp; ")"
</p>
<p>
    End If
</p>
<p>
    WahooFunc = s
</p>
<p>
    End Function
</p>
<p>
    <strong>Table .</strong> Return values for different arguments to WahooFunc (assume cell E9 contains 2).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                “=WahooFunc()”
            </td>
            <td>
                I am in WahooFunc. No argument was passed.
            </td>
        </tr>
        <tr class="even">
            <td>
                “=WahooFunc(E9)”
            </td>
            <td>
                I am in WahooFunc. Scalar argument (2) is type Double.
            </td>
        </tr>
        <tr class="odd">
            <td>
                “=WahooFunc(2)”
            </td>
            <td>
                I am in WahooFunc. Scalar argument (2) is type Double.
            </td>
        </tr>
        <tr class="even">
            <td>
                “=WahooFunc(A11:C15)”
            </td>
            <td>
                I am in WahooFunc. Argument is an array (1 To 5, 1 To 3).
            </td>
        </tr>
    </tbody>
</table>
<p>
    The argument that is passed to the function that you write, may be missing. If the argument is declared as optional,
    use the IsMissing() method to test if a value has been passed. For example, “=WahooFunc()”.
</p>
<p>
    You can directly pass a single scalar value either as a constant, or by referencing a single cell. For example,
    “=WahooFunc(32)” and “=WahooFunc(E7)” both pass a scalar value to the function. The first example passes the numeric
    value 32 and the second example passes the contents of cell E7.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                The actual type of argument that is passed to your own functions depends on how it is called<br /> (see
                ). When a range is used as the argument, the data is passed as a two-dimensional array that does not use
                the traditional lower bound of zero.
            </td>
        </tr>
    </tbody>
</table>
<p>
    If the argument refers to a range, a two-dimensional array is passed to the function. For example,<br />
    “=WahooFunc(E7:F32)” passes the contents of the cells in the range E7 through F32 as a two-dimensional array. Be
    absolutely certain to use the functions LBound() and UBound(), because the lower bounds start at 1 rather than at
    the expected value of 0 (see ).
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Add all elements together.
</p>
<p>
    Function SumAll(myArray as Variant)
</p>
<p>
    Dim iRow%, iCol%
</p>
<p>
    Dim d As Double
</p>
<p>
    For iRow = LBound(myArray, 1) To UBound(myArray, 1)
</p>
<p>
    For iCol = LBound(myArray, 2) To UBound(myArray, 2)
</p>
<p>
    d = d + myArray(iRow, iCol)
</p>
<p>
    Next
</p>
<p>
    Next
</p>
<p>
    SumAll = d
</p>
<p>
    End Function
</p>
<p>
    The Calc function must be visible / available to the Calc document, so I store my Calc functions in the Standard
    library of the document that will use the functions. Sometimes, when I write a new function, the new function is not
    noticed until the document has been saved, closed, and then reopened.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                If Calc does not see a newly created function, save, close, and reopen the Calc document.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Warn
            </td>
            <td>
                Do not return a time or date in a Calc function, return a double instead.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Macros used as Calc functions have their values converted to a double or a string before they are stored in a cell.
    The date type is converted to a string, which is not useful for date calculations. The proper way to return a date
    and/or time is to convert the value to a Double and return the double. Calc will treat the value as a date / time
    based on the cell formatting.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="using-the-current-controller">
                    <span id="anchor-384"></span>Using the current controller
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Each OOo document contains a controller that interacts with the user. Therefore, the current controller knows what
    text is selected, the location of the current cursor, and which sheet is active.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="selected-cells">
                            <span id="anchor-385"></span>Selected cells
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The document’s controller interacts with the user and therefore knows which cells are selected. In a Calc document,
    a selected cell can be a few different things. The following cases are numbered to simply reference each case; the
    numbering serves no other purpose.
</p>
<ol type="1">
    <li>
        One cell selected. To select an entire cell, click in a cell once and then hold down the Shift key and click in
        the cell again.
    </li>
    <li>
        Partial text in a single cell selected. Double-click in a single cell and then select some text.
    </li>
    <li>
        Nothing appears selected. Single-click in a cell or tab between cells.
    </li>
    <li>
        Multiple cells selected. Single-click in a cell and then drag the cursor.
    </li>
    <li>
        Multiple disjointed selections. Select some cells. Hold down the Ctrl key and select some more.
    </li>
</ol>
<p>
    So far, I have not been able to distinguish between the first three cases; they all look like one cell is selected.
    If only one cell is selected, the current selection returned by the current controller is the sheet cell containing
    the cursor. If a single cell is selected (cases 1 through 3), the selections object supports the SheetCell service
    (see ).
</p>
<p>
    If multiple cells are selected as a single range (case 4), the selections object is a SheetCellRange. Check to see
    if the selections object supports the SheetCellRanges service. If so, then more than one cell range is selected. Use
    the getCount() method of the selections object to see how many ranges are selected.
</p>
<p>
    <strong>Listing .</strong> Determine if anything is selected.
</p>
<p>
    Function CalcIsAnythingSelected(oDoc) As Boolean
</p>
<p>
    Dim oSelections
</p>
<p>
    REM Assume that nothing is selected.
</p>
<p>
    CalcIsAnythingSelected = False
</p>
<p>
    If IsNull(oDoc) Then Exit Function
</p>
<p>
    REM The current selection in the current controller.
</p>
<p>
    REM If there is no current controller, this returns NULL.
</p>
<p>
    oSelections = oDoc.getCurrentSelection()
</p>
<p>
    If IsNull(oSelections) Then Exit Function
</p>
<p>
    If oSelections.supportsService("com.sun.star.sheet.SheetCell") Then
</p>
<p>
    Print "One Cell selected = " &amp; oSelections.getImplementationName()
</p>
<p>
    MsgBox "getString() = " &amp; oSelections.getString()
</p>
<p>
    ElseIf oSelections.supportsService("com.sun.star.sheet.SheetCellRange") Then
</p>
<p>
    Print "One Cell Range selected = " &amp; oSelections.getImplementationName()
</p>
<p>
    ElseIf oSelections.supportsService("com.sun.star.sheet.SheetCellRanges") Then
</p>
<p>
    Print "Multiple Cell Ranges selected = " &amp;_
</p>
<p>
    oSelections.getImplementationName()
</p>
<p>
    Print "Count = " &amp; oSelections.getCount()
</p>
<p>
    Else
</p>
<p>
    Print "Something else selected = " &amp; oSelections.getImplementationName()
</p>
<p>
    End If
</p>
<p>
    CalcIsAnythingSelected = True
</p>
<p>
    End Function
</p>
<h4 id="enumerating-the-selected-cells">
    <span id="anchor-386"></span>Enumerating the selected cells
</h4>
<p>
    is a utility routine that sets the text of the cells in a range to a specific value. Although is specifically
    designed to operate on a cell range, it uses methods that are also supported by a single cell. The macro, therefore,
    may be used by a cell or a cell range object. The method used in is a modification of an algorithm introduced to me
    by Sasa Kelecevic, on the OOo dev mailing list.
</p>
<p>
    <strong>Listing .</strong> Set all text in a range to a value.
</p>
<p>
    Sub SetRangeText(oRange, s As String)
</p>
<p>
    Dim nCol As Long 'Column index variable
</p>
<p>
    Dim nRow As Long 'Row index variable
</p>
<p>
    Dim oCols 'Columns in the selected range
</p>
<p>
    Dim oRows 'Rows in the selected range
</p>
<p>
    oCols = oRange.Columns : oRows = oRange.Rows
</p>
<p>
    For nCol = 0 To oCols.getCount() - 1
</p>
<p>
    For nRow = 0 To oRows.getCount() - 1
</p>
<p>
    oRange.getCellByPosition(nCol, nRow).setString(s)
</p>
<p>
    Next
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    To demonstrate how to inspect all of the selected cells, the macro in sets the text in every selected cell to a
    specific text value.
</p>
<p>
    <strong>Listing .</strong> Set all selected cells to a value.
</p>
<p>
    Sub SetSelectedCells(s As String)
</p>
<p>
    Dim oSelections 'The selections object
</p>
<p>
    Dim oCell 'If one cell is selected
</p>
<p>
    Dim oRanges 'If multiple ranges are selected, use this
</p>
<p>
    Dim i As Long 'General index variable
</p>
<p>
    REM The current selection in the current controller.
</p>
<p>
    REM If there is no current controller, this returns NULL.
</p>
<p>
    oSelections = ThisComponent.getCurrentSelection()
</p>
<p>
    If IsNull(oSelections) Then Exit Sub
</p>
<p>
    If oSelections.supportsService("com.sun.star.sheet.SheetCell") Then
</p>
<p>
    oCell = oSelections
</p>
<p>
    oCell.setString(s)
</p>
<p>
</p>
<p>
    REM For consistency, I could use the same call for a range as a cell
</p>
<p>
    REM but this is only because a cell can also return the columns and rows.
</p>
<p>
    REM SetRangeText(oSelections, s)
</p>
<p>
    ElseIf oSelections.supportsService("com.sun.star.sheet.SheetCellRange") Then
</p>
<p>
    SetRangeText(oSelections, s)
</p>
<p>
    ElseIf oSelections.supportsService("com.sun.star.sheet.SheetCellRanges") Then
</p>
<p>
    oRanges = oSelections
</p>
<p>
    For i = 0 To oRanges.getCount() - 1
</p>
<p>
    SetRangeText(oRanges.getByIndex(i), s)
</p>
<p>
    Next
</p>
<p>
    Else
</p>
<p>
    Print "Something else selected = " &amp; oSelections.getImplementationName()
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    While writing the macro in , I experienced some initially perplexing behavior. My initial version of would sometimes
    generate an error as it attempted to enter the subroutine, depending on the selected values. The run-time error
    would complain that an unsupported property or invalid value was used. To explain the problem (and the solution),
    notice that there are two places in the code where I assign oSelections to a temporary variable and then I use the
    variable. contains the small sections of code extracted from .
</p>
<p>
    <strong>Listing .</strong> I assign oSelections to a temporary variable before use.
</p>
<p>
    oCell = oSelections
</p>
<p>
    oCell.setString(s)
</p>
<p>
    .....
</p>
<p>
    oRanges = oSelections
</p>
<p>
    For i = 0 To oRanges.getCount() - 1
</p>
<p>
    SetRangeText(oRanges.getByIndex(i), s)
</p>
<p>
    Next
</p>
<p>
    If oSelections refers to a cell, it doesn’t support the object method getCount(). If oSelections refers to a
    SheetCellRanges object, it doesn’t support the setString() object method. I can but assume that the OOo Basic
    interpreter attempts to resolve the properties and methods that an object references when it is assigned a value.
    For example, if the selections object is a cell, an error is raised because a cell doesn’t support the getCount()
    method. On the other hand, if more than one cell is selected, the returned object does not support the setString()
    method. Although this is not the first time that I have experienced this problem, it is the first time that I
    determined the nature of the problem and how to avoid it.
</p>
<h4 id="selecting-text">
    <span id="anchor-387"></span>Selecting text
</h4>
<p>
    The current controller is used to determine the current selection, and it can also be used to set the current
    selection. Use the current controller’s select(obj) method to select cells in a sheet. The documentation essentially
    says that if the controller recognizes and is able to select the object passed as an argument, it will. demonstrates
    how to select cells.
</p>
<p>
    <strong>Listing .</strong> Select B28:D33 and then select cell A1 instead.
</p>
<p>
    Dim oSheet, oRange, oCell, oController
</p>
<p>
    oController = ThisComponent.getCurrentController()
</p>
<p>
    oSheet = ThisComponent.Sheets(3)
</p>
<p>
    oRange = oSheet.getCellRangeByName("B28:D33")
</p>
<p>
    oController.select(oRange)
</p>
<p>
    oCell = oSheet.getCellByPosition(0, 0)
</p>
<p>
    oController.select(oCell)
</p>
<h4 id="the-active-cell">
    <span id="anchor-388"></span>The active cell
</h4>
<p>
    The active cell contains the cursor. There is an active cell even when multiple cells are selected. Unfortunately,
    OOo does not provide a method to return the active cell when more than one cell is selected. Paolo Mantovani posted
    a very nice solution to this problem on the dev mailing list as shown in . The disadvantage to the macro in is that
    the active cell is no longer active after the macro runs.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong></strong> Obtain the active cell.
</p>
<p>
    REM Author: Paolo Mantovani
</p>
<p>
    REM email: mantovani.paolo@tin.it
</p>
<p>
    Sub RetrieveTheActiveCell()
</p>
<p>
    Dim oOldSelection 'The original selection of cell ranges
</p>
<p>
    Dim oRanges 'A blank range created by the document
</p>
<p>
    Dim oActiveCell 'The current active cell
</p>
<p>
    Dim oConv 'The cell address conversion service
</p>
<p>
    Dim oDoc
</p>
<p>
    oDoc = ThisComponent
</p>
<p>
    REM store the current selection
</p>
<p>
    oOldSelection = oDoc.CurrentSelection
</p>
<p>
    REM Create an empty SheetCellRanges service and then select it.
</p>
<p>
    REM This leaves ONLY the active cell selected.
</p>
<p>
    oRanges = oDoc.createInstance("com.sun.star.sheet.SheetCellRanges")
</p>
<p>
    oDoc.CurrentController.Select(oRanges)
</p>
<p>
    REM Get the active cell!
</p>
<p>
    oActiveCell = oDoc.CurrentSelection
</p>
<p>
    oConv = oDoc.createInstance("com.sun.star.table.CellAddressConversion")
</p>
<p>
    oConv.Address = oActiveCell.getCellAddress
</p>
<p>
    Print oConv.UserInterfaceRepresentation
</p>
<p>
    print oConv.PersistentRepresentation
</p>
<p>
    REM Restore the old selection, but lose the previously active cell
</p>
<p>
    oDoc.CurrentController.Select(oOldSelection)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="general-functionality">
                            <span id="anchor-389"></span>General functionality
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    When searching for view-related functionality, the current controller is a good place to start. and contain most of
    the methods and properties supported by the current controller that have not already been discussed.
</p>
<p>
    <strong>Table .</strong> Methods supported by the current controller not already discussed.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getActiveSheet()
            </td>
            <td>
                Get the active spreadsheet.
            </td>
        </tr>
        <tr class="even">
            <td>
                setActiveSheet(XSpreadsheet)
            </td>
            <td>
                Cause the specified sheet to become active.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getIsWindowSplit()
            </td>
            <td>
                Return True if the view is split.
            </td>
        </tr>
        <tr class="even">
            <td>
                getSplitHorizontal()
            </td>
            <td>
                Long Integer horizontal split position (in pixels).
            </td>
        </tr>
        <tr class="odd">
            <td>
                getSplitVertical()
            </td>
            <td>
                Long Integer vertical split position (in pixels).
            </td>
        </tr>
        <tr class="even">
            <td>
                getSplitColumn()
            </td>
            <td>
                Long Integer column before which the view is split.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getSplitRow()
            </td>
            <td>
                Long Integer row before which the view is split.
            </td>
        </tr>
        <tr class="even">
            <td>
                splitAtPosition(x, y)
            </td>
            <td>
                Split the view at the specified position. If x=0, the split is only horizontal.<br /> If y=0, the split
                is only vertical.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasFrozenPanes()
            </td>
            <td>
                True if the view contains frozen panes.
            </td>
        </tr>
        <tr class="even">
            <td>
                freezeAtPosition(nCol, nRow)
            </td>
            <td>
                Freeze panes with the specified number of columns and rows.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getFirstVisibleColumn()
            </td>
            <td>
                Get the first visible column in the pane as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                setFirstVisibleColumn(Long)
            </td>
            <td>
                Set the first visible column in the pane.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getFirstVisibleRow()
            </td>
            <td>
                Get the first visible row in the pane as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                setFirstVisibleRow(Long)
            </td>
            <td>
                Set the first visible row in the pane.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getVisibleRange()
            </td>
            <td>
                Get the visible range in the pane as a CellRangeAddress.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong><strong>Table </strong><strong></strong><strong>.</strong></strong> Properties supported by the current
    controller not already discussed.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                ShowFormulas
            </td>
            <td>
                If True, formulas are displayed instead of their results.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShowZeroValues
            </td>
            <td>
                If True, zero values are visible.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsValueHighlightingEnabled
            </td>
            <td>
                If True, strings, values, and formulas are displayed in different colors.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShowNotes
            </td>
            <td>
                If True, a marker is shown for notes in cells.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HasVerticalScrollBar
            </td>
            <td>
                If True, a vertical scroll bar is used in the view.
            </td>
        </tr>
        <tr class="even">
            <td>
                HasHorizontalScrollBar
            </td>
            <td>
                If True, a horizontal scroll bar is used in the view.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HasSheetTabs
            </td>
            <td>
                If True, sheet tabs are used in the view.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsOutlineSymbolsSet
            </td>
            <td>
                If True, outline symbols are displayed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HasColumnRowHeaders
            </td>
            <td>
                If True, column and row headers are visible.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShowGrid
            </td>
            <td>
                If True, cell grid lines are displayed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                GridColor
            </td>
            <td>
                Grid color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShowHelpLines
            </td>
            <td>
                If True, help lines are displayed while moving drawing objects.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ShowAnchor
            </td>
            <td>
                If True, anchor symbols are displayed when drawing objects are selected.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShowPageBreaks
            </td>
            <td>
                If True, page breaks are displayed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SolidHandles
            </td>
            <td>
                If True, solid (colored) handles are displayed when drawing objects are selected.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShowObjects
            </td>
            <td>
                If True, embedded objects are displayed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ShowCharts
            </td>
            <td>
                If True, charts are displayed.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShowDrawing
            </td>
            <td>
                If True, drawing objects are displayed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HideSpellMarks
            </td>
            <td>
                If True, spelling marks are not displayed; this seems to be disabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                ZoomType
            </td>
            <td>
                Document zoom type as a com.sun.star.view.DocumentZoomType with the following values:
            </td>
        </tr>
        <tr class="odd">
            <td>
                ZoomValue
            </td>
            <td>
                Zoom value if the ZoomType is set to BY_VALUE . ZoomType must be set before the ZoomValue is set.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="control-calc-from-microsoft-office">
                    <span id="anchor-390"></span>Control Calc from Microsoft Office
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    It turns out that you can control OOo from within the Microsoft Office family of products. The trick is to create a
    service manager, which starts OOo if it is not currently running. Accessing OOo documents from Microsoft Office is
    similar to accessing OOo documents using other non-StarBasic languages. OOo Basic provides nice shortcuts that are
    not available from Microsoft Office. For example, in OOo Basic, when I want the third sheet, I simply use
    oDoc.Sheets(2); in Microsoft Office, however, you cannot access the Sheets property as an array. I wrote and ran the
    macro in from Microsoft Visual Basic from Microsoft Excel.
</p>
<p>
    <strong>Listing .</strong> ControlOOo() demonstrates how to control OOo from Excel.
</p>
<p>
    Sub ControlOOo()
</p>
<p>
    Rem The service manager is always the first thing to create.
</p>
<p>
    Rem If OOo is not running, it is started.
</p>
<p>
    Set oManager = CreateObject("com.sun.star.ServiceManager")
</p>
<p>
    Rem Create the desktop.
</p>
<p>
    Set oDesktop = oManager.createInstance("com.sun.star.frame.Desktop")
</p>
<p>
    Rem Open a new empty Calc document.
</p>
<p>
    Dim args()
</p>
<p>
    Dim s As String
</p>
<p>
    Set s = "private:factory/scalc"
</p>
<p>
    Set oDoc = oDesktop.loadComponentFromURL(s, "_blank", 0, args())
</p>
<p>
    Dim oSheet As Object
</p>
<p>
    Dim oSheets As Object
</p>
<p>
    Dim oCell As Object
</p>
<p>
</p>
<p>
    Set oSheets = oDoc.sheets.CreateEnumeration
</p>
<p>
    Set oSheet = oSheets.nextElement
</p>
<p>
    Set oCell = oSheet.getCellByPosition(0, 0)
</p>
<p>
    oCell.setFormula ("Hello From Excel") 'Cell A1
</p>
<p>
    oCell.CellBackColor = RGB(127, 127, 127)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="accessing-calc-functions">
                    <span id="anchor-391"></span>Accessing Calc functions
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    You can call Calc functions from a macro.
</p>
<p>
    <strong>Listing .</strong> Call the MIN function directly.
</p>
<p>
    Sub callFunction
</p>
<p>
    Dim oFA
</p>
<p>
    oFA = createUnoService( "com.sun.star.sheet.FunctionAccess" )
</p>
<p>
    ' Calculate min of numbers.
</p>
<p>
    print oFA.callFunction( "MIN", array( 10, 23, 5, 345 ) )
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="finding-urls-in-calc">
                    <span id="anchor-392"></span>Finding URLs in Calc
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    In a Calc document, links (URLs) are stored in text fields. The following macro enumerates the text content in cell
    A1 of the first sheet for URLs. Note that the presentation and the URL may be different.
</p>
<p>
    <strong>Listing .</strong> Finds URLS in a sheet cell.
</p>
<p>
    Sub FindHyperLinkInCell
</p>
<p>
    Dim oCell, oText, oParEnum, oParElement
</p>
<p>
    Dim oEnum, oElement
</p>
<p>
    oCell = ThisComponent.Sheets(0).getCellByPosition(0, 0)
</p>
<p>
    oParEnum = oCell.getText().createEnumeration()
</p>
<p>
    Do While oParEnum.hasMoreElements ()
</p>
<p>
    oParElement = oParEnum.nextElement()
</p>
<p>
    oEnum = oParElement.createEnumeration()
</p>
<p>
    Do While oEnum.hasMoreElements ()
</p>
<p>
    oElement = oEnum.nextElement()
</p>
<p>
    If oElement.TextPortionType = "TextField" Then
</p>
<p>
    If oElement.TextField.supportsService("com.sun.star.text.TextField.URL") Then
</p>
<p>
    'STRING Representation =
</p>
<p>
    'STRING TargetFrame =
</p>
<p>
    'STRING URL =
</p>
<p>
    Print oElement.TextField.URL
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    Loop
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="importing-and-exporting-xml-files-using-calc">
                    <span id="anchor-393"></span>Importing and Exporting XML Files Using Calc
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    <em><em>This section, originally written by Volker Lenhardt, discusses simple methods for importing and exporting
            Extensible Markup Language (XML) files. The ideas and code are taken from a working project.</em></em>
</p>
<p>
    <em><em>XML is a formal description of tags and how tags can be combined to form a hierarchical data structure. You
            can choose the tag and attributes names as you like – within limits. HTML is XML with fewer rules – so valid
            HTML need not be valid XML. Wikipedia is a good place to learn more about XML.</em></em>
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Warn
            </td>
            <td>
                Some methods caused OOo version 3.3 to crash; for example, getElementsByTagName crashed for some tag
                names. The methods functioned correctly with LibreOffice, I have not checked them against AOO.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <em><em>XML files are simple text files. If you need to regularly convert XML to Calc or Base you could write an
            XSLT filter, which is not covered in this book.</em></em>
</p>
<p>
    <em><em>Most modern programming languages have implemented two tools to import XML data: SAX (Simple API for XML)
            and DOM (Document Object Model). UNO defines com.sun.star.xml.sax.XParser for SAX processing and
            com.sun.star.xml.dom.DocumentBuilder for DOM processing. The main difference between these two tools is the
            way that they read the data from the file. SAX reads the data continually, the Basic code implements a
            listener to handle the data as it is read. DOM, on the other hand, reads all of the data into an in memory
            hierarchically structured object. DOM is fast, but uses more memory, SAX can easily handle large files. This
            section covers DOM, not SAX. The coverage ignores complex topics such as validation, name spaces, and
            exceptions.</em></em>
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                It is very important that you are acquainted with the data structure of the XML file in question.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <em><em></em></em>
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="read-an-xml-file">
                            <span id="anchor-394"></span>Read an XML file
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The com.sun.star.xml.dom.DocumentBuilder service has two parse methods that return the entire data tree as a DOM
    object. The first parse method accepts an input stream, which may come from anywhere; for a simple text file,
    SimpleFileAccess can return an input stream. The second parse method accepts the URL of the file (see ).
</p>
<p>
    <strong>Listing .</strong> Read an XML file.
</p>
<p>
    REM Build a DOM Document tree from an XML file.
</p>
<p>
    Function BuildDOMDoc(sUrl As String)
</p>
<p>
    Dim oDocBuilder
</p>
<p>
    Dim oDOM
</p>
<p>
    BuildDOMDoc = oDOM
</p>
<p>
</p>
<p>
    On Error Goto Catch
</p>
<p>
</p>
<p>
    oDocBuilder = createUnoService("com.sun.star.xml.dom.DocumentBuilder")
</p>
<p>
</p>
<p>
    REM oDocBuilder reads the complete XML file and returns an object
</p>
<p>
    REM containing a tree structure of all "nodes".
</p>
<p>
    oDOM = oDocBuilder.parseURI(sURL)
</p>
<p>
</p>
<p>
    REM There were no errors.
</p>
<p>
    oDOM.normalize()
</p>
<p>
    BuildDOMDoc = oDOM
</p>
<p>
    Exit Function
</p>
<p>
</p>
<p>
    Catch:
</p>
<p>
    MsgBox "Error while importing the XML data " &amp; CHR$(10) &amp; CHR$(10) _
</p>
<p>
    &amp; Error$ &amp; " " &amp; CHR$(10) &amp; " ", 16, "XML Import"
</p>
<p>
    End Function
</p>
<p>
    The XML file in is based on a real example. The entire document contains an outer slots tag, which represents a
    database. Each record is called a slot, some are active, some are reserved, some are free. Each slot represents a
    single client.
</p>
<p>
    <strong>Listing .</strong> Sample XML file.
</p>
<p>
    &lt;<strong>slots</strong>&gt;
</p>
<p>
    &lt;<strong>slot</strong> <strong>status</strong>="active" ID="10317"&gt;
</p>
<p>
    &lt;<strong>document</strong> ID="1234" title="Boom boom" /&gt;
</p>
<p>
    &lt;<strong>validTo</strong>&gt;12/03/2011&lt;/<strong>validTo</strong>&gt;
</p>
<p>
    &lt;<strong>customer</strong> <strong>name</strong>="Becker" <strong>gender</strong>="m" ID="11051"
    <strong>email</strong>="<a href="mailto:bb@tennis.de">bb@tennis.de</a>" /&gt;
</p>
<p>
    &lt;/<strong>slot</strong>&gt;
</p>
<p>
    &lt;<strong>slot</strong> <strong>status</strong>="free" ID="60072"&gt;
</p>
<p>
    &lt;/<strong>slot</strong>&gt;
</p>
<p>
    &lt;/<strong>slots</strong>&gt;
</p>
<p>
    The problem was to create a mail merge to ask active clients about to expire if they desired to prolong their
    service. The macro needed to appropriately filter the data based on the status attribute and ValidTo element, then
    extract the name, gender, email, ID, and document title. The elements, attributes, and text contents are represented
    as “nodes” in the DOM tree; the entire document is the root node. The com.sun.star.xml.dom.XNode API documentation
    describes this primary DOM datatype as follows:
</p>
<p>
    “The Node interface is the primary datatype for the entire Document Object Model. It represents a single node in the
    document tree. While all objects implementing the Node interface expose methods for dealing with children, not all
    objects implementing the Node interface may have children. For example, Text nodes may not have children, and adding
    children to such nodes results in a DOMException being raised.
</p>
<p>
    The “nodeName”, “nodeValue”, and “attributes” properties provide access to commonly used data from a node. The
    property returns null if there is no obvious mapping of these attributes for a specific nodeType; for example, a
    comment cannot have attributes. Specific node types may contain additional more convenient mechanisms to get and set
    relevant information.
</p>
<p>
    shows the specialized node interfaces that are derived from XNode together with their types, names, and values. The
    node type is the corresponding value from the com.sun.star.xml.dom.NodeType enumeration.
</p>
<p>
    <strong>Table .</strong> Specialized Nodes.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                XAttr
            </td>
            <td>
                ATTRIBUTE_NODE
            </td>
            <td>
                The name of the attribute
            </td>
            <td>
                The value of the attribute
            </td>
        </tr>
        <tr class="even">
            <td>
                XCDATASection
            </td>
            <td>
                CDATA_SECTION_NODE
            </td>
            <td>
                "#cdata-section"
            </td>
            <td>
                The content of the CDATA section
            </td>
        </tr>
        <tr class="odd">
            <td>
                XComment
            </td>
            <td>
                COMMENT_NODE
            </td>
            <td>
                "#comment"
            </td>
            <td>
                The content of the comment
            </td>
        </tr>
        <tr class="even">
            <td>
                XDocument
            </td>
            <td>
                DOCUMENT_NODE
            </td>
            <td>
                "#document"
            </td>
            <td>
                Null
            </td>
        </tr>
        <tr class="odd">
            <td>
                XDocumentFragment
            </td>
            <td>
                DOCUMENT_FRAGMENT_NODE
            </td>
            <td>
                "#document-fragment"
            </td>
            <td>
                Null
            </td>
        </tr>
        <tr class="even">
            <td>
                XDocumentType
            </td>
            <td>
                DOCUMENT_TYPE_NODE
            </td>
            <td>
                The document type name
            </td>
            <td>
                Null
            </td>
        </tr>
        <tr class="odd">
            <td>
                XElement
            </td>
            <td>
                ELEMENT_NODE
            </td>
            <td>
                The tag name
            </td>
            <td>
                Null
            </td>
        </tr>
        <tr class="even">
            <td>
                XEntity
            </td>
            <td>
                ENTITY_NODE
            </td>
            <td>
                The entity name
            </td>
            <td>
                Null
            </td>
        </tr>
        <tr class="odd">
            <td>
                XEntityReference
            </td>
            <td>
                ENTITY_REFERENCE_NODE
            </td>
            <td>
                The name of entity referenced
            </td>
            <td>
                Null
            </td>
        </tr>
        <tr class="even">
            <td>
                XNotation
            </td>
            <td>
                NOTATION_NODE
            </td>
            <td>
                The notation name
            </td>
            <td>
                Null
            </td>
        </tr>
        <tr class="odd">
            <td>
                XProcessingInstruction
            </td>
            <td>
                PROCESSING_INSTRUCTION_NODE
            </td>
            <td>
                The target
            </td>
            <td>
                The entire content excluding the target
            </td>
        </tr>
        <tr class="even">
            <td>
                XText
            </td>
            <td>
                TEXT_NODE
            </td>
            <td>
                "#text"
            </td>
            <td>
                The content of the text node
            </td>
        </tr>
    </tbody>
</table>
<p>
    For the methods implemented with XNode see .
</p>
<p>
    <strong>Table .</strong> Methods implemented in the com.sun.star.xml.dom.XNode interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                <span id="anchor-395"></span><span id="anchor-396"></span>appendChild<span
                    id="anchor-397"></span>(newChild)
            </td>
            <td>
                Adds the node newChild to the end of the list of children of this node.
            </td>
        </tr>
        <tr class="even">
            <td>
                cloneNode(deep As boolean)
            </td>
            <td>
                Returns a duplicate of this node, i.e., serves as a generic copy constructor for nodes.<br /> Parameter
                deep: True = clone node together with any children, False = clone without children
            </td>
        </tr>
        <tr class="odd">
            <td>
                getAttributes()
            </td>
            <td>
                Returns a NamedNodeMap containing the attributes of this node (if it is an Element) or null otherwise.
            </td>
        </tr>
        <tr class="even">
            <td>
                getChildNodes()
            </td>
            <td>
                Returns a NodeList that contains all children of this node.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getFirstChild()
            </td>
            <td>
                Returns the first child of this node.
            </td>
        </tr>
        <tr class="even">
            <td>
                getLastChild()
            </td>
            <td>
                Returns the last child of this node.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getLocalName()
            </td>
            <td>
                Returns the local part of the qualified name of this node.
            </td>
        </tr>
        <tr class="even">
            <td>
                getNamespaceURI()
            </td>
            <td>
                The namespace URI of this node, or null if it is unspecified.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getNextSibling()
            </td>
            <td>
                Returns the node immediately following this node.
            </td>
        </tr>
        <tr class="even">
            <td>
                getNodeName()
            </td>
            <td>
                The name of this node, depending on its type; see the table above.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getNodeType()
            </td>
            <td>
                A code representing the type of the underlying object, as defined above.
            </td>
        </tr>
        <tr class="even">
            <td>
                getNodeValue()
            </td>
            <td>
                Returns the value of this node.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getOwnerDocument()
            </td>
            <td>
                The Document object associated with this node.
            </td>
        </tr>
        <tr class="even">
            <td>
                getParentNode()
            </td>
            <td>
                The parent of this node.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getPrefix()
            </td>
            <td>
                The namespace prefix of this node, or null if it is unspecified.
            </td>
        </tr>
        <tr class="even">
            <td>
                getPreviousSibling()
            </td>
            <td>
                The node immediately preceding this node.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasAttributes()
            </td>
            <td>
                Returns whether this node (if it is an element) has any attributes.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasChildNodes()
            </td>
            <td>
                Returns whether this node has any children.
            </td>
        </tr>
        <tr class="odd">
            <td>
                insertBefore(newChild, refChild)
            </td>
            <td>
                Inserts the node newChild before the existing child node refChild.
            </td>
        </tr>
        <tr class="even">
            <td>
                isSupported(feature, ver)
            </td>
            <td>
                Tests whether the DOM implementation implements a specific feature and that feature is supported by this
                node.
            </td>
        </tr>
        <tr class="odd">
            <td>
                normalize()
            </td>
            <td>
                Puts all Text nodes in the full depth of the sub-tree underneath this Node, including attribute nodes,
                into a "normal" form where only structure (e.g., elements, comments, processing instructions, CDATA
                sections, and entity references) separates Text nodes, i.e., there are neither adjacent Text nodes nor
                empty Text nodes.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeChild(oldChild)
            </td>
            <td>
                Removes the child node indicated by oldChild from the list of children, and returns it.
            </td>
        </tr>
        <tr class="odd">
            <td>
                replaceChild(newChild, oldChild)
            </td>
            <td>
                Replaces the child node oldChild with newChild in the list of children, and returns the oldChild node.
            </td>
        </tr>
        <tr class="even">
            <td>
                setNodeValue(nodeValue)
            </td>
            <td>
                The value of this node, depending on its type; see the table above.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setPrefix(prefix)
            </td>
            <td>
                The namespace prefix of this node, or null if it is unspecified.
            </td>
        </tr>
    </tbody>
</table>
<p>
    A node list is usually returned as a com.sun.star.xml.dom.XNodeList interface. The most used methods from the
    XNodeList interface are getLength(), to determine the number of listed nodes, and item(Long) to get a single node
    based on its location in the list. A node list is sometimes returned as a the com.sun.star.xml.dom.XNamedNodeMap
    interface, which provides access to the contained nodes by name. The following macro demonstrates three methods for
    getting the value of an element attribute.
</p>
<p>
    <strong>Listing .</strong> Three ways to get an attribute from an element.
</p>
<p>
    'The long way
</p>
<p>
    oAttList = oElement.getAttributes ' Get all attributes.
</p>
<p>
    oAttNode = oAttList.getNamedItem("ID") ' Get the attribute node from attributes.
</p>
<p>
    sAttVal = oAttNode.getValue ' Get the value from the attribute node.
</p>
<p>
    'A shorter way
</p>
<p>
    oAttNode = oElement.getAttributeNode("ID") ' Get the attribute node from the element.
</p>
<p>
    sAttVal = oAttNode.getValue ' Get the value from the attribute node.
</p>
<p>
    'The shortest way
</p>
<p>
    sAttVal = oElement.getAttribute("ID") ' Get the value directly from the node.
</p>
<p>
    Recursion is typically used to parse DOM documents.
</p>
<p>
    oElemList = oElem.getChildNodes 'At the very start oElem is oDOM
</p>
<p>
    For i = 0 To oElemList.getLength – 1
</p>
<p>
    oElem = oElemList.item(i)
</p>
<p>
    Select Case oElem.getNodeType
</p>
<p>
    Case com.sun.star.xml.dom.ELEMENT_NODE
</p>
<p>
    sName = oElem.getNodeName
</p>
<p>
    If oElem.hasAttributes Then
</p>
<p>
    oAtts = oElem.getAttributes
</p>
<p>
    For j = 0 To oAtts.getLength – 1
</p>
<p>
    sName = oAtts.item(j).getName
</p>
<p>
    sValue = oAtts.item(j).getValue
</p>
<p>
    'Further work to be done
</p>
<p>
    Next
</p>
<p>
    End If
</p>
<p>
    If oElem.hasChildNodes Then
</p>
<p>
    'Start the recursion here
</p>
<p>
    End If
</p>
<p>
    Case com.sun.star.xml.dom.TEXT_NODE
</p>
<p>
    sText = oElem.getNodeValue
</p>
<p>
    'Further work to be done
</p>
<p>
    'More Case statements for the node types in
</p>
<p>
    End Select
</p>
<p>
    Next
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                When you encounter a text node between different element nodes, you most probably have found ignorable
                white space; so you can probably ignore it.
            </td>
        </tr>
    </tbody>
</table>
<p>
    In the slots example, we do not need to iterate over all the nodes because we know the structure and we only need
    specific nodes. Use getElementsByTagName(name) to start with a limited number of elements. shows how to extract the
    desired data into a Calc sheet. First, the XML file is created, and then it is read into a new Calc document.
</p>
<p>
    <strong>Listing .</strong> Parse an XML file to extract specific data into a CalcFile..
</p>
<p>
    REM Import an XML file using DOM and extract specific data into a Calc file
</p>
<p>
    Sub XMLImport
</p>
<p>
    Dim sURL As String 'Whole path of the XML file in URL notation
</p>
<p>
    Dim oCalcDoc 'Destination spreadsheet document
</p>
<p>
    Dim oSheet 'Destination table
</p>
<p>
    Dim oWriterDoc 'Text document to show the original XML text file
</p>
<p>
    Dim oDOM 'The DOM document tree
</p>
<p>
    Dim tDeadline as Date 'A specific date to filter the data
</p>
<p>
</p>
<p>
    REM Create an example XML file with fancy data
</p>
<p>
    sURL = GetWorkDir() &amp; "/oome_xml_import.xml"
</p>
<p>
    MakeXMLExampleFile(sUrl)
</p>
<p>
    Wait 500 'Give the OS time to store the file to disk
</p>
<p>
    tDeadline = DateValue(CDate(Now + 20))
</p>
<p>
</p>
<p>
    REM Build the DOM tree
</p>
<p>
    oDOM = BuildDOMDoc(sUrl)
</p>
<p>
    If IsEmpty(oDOM) Then Exit Sub 'There was an error loading the XML file
</p>
<p>
</p>
<p>
    REM Copy specific data into a new Calc spreadsheet
</p>
<p>
    oCalcDoc = StarDesktop.loadComponentFromURL( _
</p>
<p>
    "private:factory/scalc", "_blank", 0, Array())
</p>
<p>
    oSheet = oCalcDoc.Sheets(0)
</p>
<p>
    GetData(oDOM, oSheet, tDeadline)
</p>
<p>
</p>
<p>
    REM Show the original XML text file in a new Writer text document
</p>
<p>
    REM LibreOffice requires that the FilterName be specified, AOO does not.
</p>
<p>
    Dim noArgs(1) As New com.sun.star.beans.PropertyValue
</p>
<p>
    noArgs(0).Name = "FilterName"
</p>
<p>
    noArgs(0).Value = "Text"
</p>
<p>
    oWriterDoc = StarDesktop.loadComponentFromURL(sUrl, "_blank", 0, noArgs() )
</p>
<p>
    End Sub
</p>
<p>
    REM Read the relevant data from the DOM document
</p>
<p>
    Sub GetData(oDOMDoc, oSheet, tDeadline as Date)
</p>
<p>
    Dim oVtList 'List of all validTo nodes in the DOM document
</p>
<p>
    Dim oSlotItem 'slot = parent node of the validTo node
</p>
<p>
    Dim oSlotChildList 'List of all child nodes of a slot
</p>
<p>
    Dim oSlotChild 'A specific child node of a slot
</p>
<p>
    Dim sID As string 'Value of the slot attribute "ID"
</p>
<p>
    Dim i%, j%, k%
</p>
<p>
    Dim iCustCount As Integer 'Number of custumers using a slot
</p>
<p>
    Dim aoCusts() 'Array of customer nodes within a slot
</p>
<p>
    Dim iCustLimit As Integer 'Default upper value for the array dimension
</p>
<p>
    Dim sTitle As String 'The title of the slot's document
</p>
<p>
    Dim iEntries As Integer 'The number of rows written to the sheet
</p>
<p>
</p>
<p>
    REM A slot node includes all information on the specific slot service.
</p>
<p>
    REM List all nodes named "validTo", so all slots with the "status"
</p>
<p>
    REM attribute's value "reserved" or "free" are not included.
</p>
<p>
    oVtList = oDOMDoc.getElementsByTagName("validTo")
</p>
<p>
    iCustLimit = 10 'There will seldom be more than 10 customers to a slot.
</p>
<p>
    For i = 0 To oVtList.getLength - 1
</p>
<p>
    ' Use item to get an element return by getElementsByTagName.
</p>
<p>
    ' Use getParentNode to get the parent "slot" node.
</p>
<p>
    oSlotItem = oVtList.item(i).getParentNode
</p>
<p>
    ' IsProperSlot checks to see if the node is active.
</p>
<p>
    If IsProperSlot(oSlotItem) Then
</p>
<p>
    sID = oSlotItem.getAttribute("ID")
</p>
<p>
    REM The validTo element has exactly one text node
</p>
<p>
    REM containing a date string, so getFirstChild is used to
</p>
<p>
    REM get the text element. GetNodeValue returns the text
</p>
<p>
    REM in that element, which is a date.
</p>
<p>
    If IsWithinDateTarget _
</p>
<p>
    (oVtList.item(i).getFirstChild.getNodeValue, tDeadline) &gt; 0 Then
</p>
<p>
    ' Everything passes, so collect data.
</p>
<p>
    ' A list of child elements of the slot is created to inspect
</p>
<p>
    ' each contained element in order to extract both the document title
</p>
<p>
    ' and the customers’ data. The Select Case construction is used:
</p>
<p>
    oSlotChildList = oSlotItem.getChildNodes
</p>
<p>
    REM Iterate over the list of child nodes to collect the data.
</p>
<p>
    ReDim aoCusts(1 To iCustLimit)
</p>
<p>
    iCustCount = 0
</p>
<p>
    sTitle = ""
</p>
<p>
    For j = 0 To oSlotChildList.getLength - 1
</p>
<p>
    oSlotChild = oSlotChildList.item(j)
</p>
<p>
    Select Case oSlotChild.getNodeName
</p>
<p>
    Case "document"
</p>
<p>
    If oSlotChild.hasAttribute("title") Then
</p>
<p>
    sTitle = oSlotChild.getAttribute("title")
</p>
<p>
    End If
</p>
<p>
    Case "customer"
</p>
<p>
    iCustCount = iCustCount + 1
</p>
<p>
    REM Just in case there really are more customers than thought
</p>
<p>
    If iCustCount &gt; iCustLimit Then
</p>
<p>
    ReDim Preserve aoCusts(1 To iCustCount)
</p>
<p>
    End If
</p>
<p>
    aoCusts(iCustCount) = oSlotChild
</p>
<p>
    Case Else
</p>
<p>
    End Select
</p>
<p>
    Next
</p>
<p>
    If sTitle &lt;&gt; "" AND iCustCount &gt; 0 Then
</p>
<p>
    For k = 1 To iCustCount
</p>
<p>
    REM Write the data to the Calc sheet
</p>
<p>
    ' Having collected all relevant data of a slot GetData
</p>
<p>
    ' can store it in the Calc sheet calling the ImportSlot
</p>
<p>
    ' subroutine. At last, when we are through with all
</p>
<p>
    ' slots, the Calc sheet is sorted for convenience.
</p>
<p>
    ImportSlot(aoCusts(k), sID, sTitle, oSheet)
</p>
<p>
    Next
</p>
<p>
    iEntries = iEntries + iCustCount
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    SortCustomers(oSheet, iEntries)
</p>
<p>
    End Sub
</p>
<p>
    REM Check, if the specific slot has the suiting attribute values
</p>
<p>
    Function IsProperSlot(oSlot) As Boolean
</p>
<p>
    IsProperSlot = False
</p>
<p>
    If oSlot.hasAttribute("status") AND oSlot.hasAttribute("ID") Then
</p>
<p>
    If oSlot.getAttribute("status") = "active" Then
</p>
<p>
    IsProperSlot = True
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<p>
    REM Check, if validTo shows a date earlier than the deadline
</p>
<p>
    Function IsWithinDateTarget(sDate As String, tDeadline as Date) As Integer
</p>
<p>
    Dim tValidTo As Date
</p>
<p>
    On Error Goto Catch
</p>
<p>
</p>
<p>
    REM If the OOo Basic function DateValue cannot convert the string
</p>
<p>
    REM to a date value, the runtime error 5 is thrown. In this case
</p>
<p>
    REM the return value of -1 lets the calling routine establish a
</p>
<p>
    REM device to track down erroneous database entries.
</p>
<p>
    tValidTo = DateValue(sDate)
</p>
<p>
    If tDeadline &lt; tValidTo Then
</p>
<p>
    IsWithinDateTarget = 0
</p>
<p>
    Else
</p>
<p>
    IsWithinDateTarget = 1
</p>
<p>
    End If
</p>
<p>
    Exit Function
</p>
<p>
</p>
<p>
    Catch:
</p>
<p>
    IsWithinDateTarget = -1
</p>
<p>
    End Function
</p>
<p>
    REM Writes the relevant slot data to the Calc sheet
</p>
<p>
    Sub ImportSlot(oCust, sID As String, sTitle As String, oSheet)
</p>
<p>
    REM There is one row for each document belonging to each customer.
</p>
<p>
    REM So if multiple customers share one document there are as many rows
</p>
<p>
    REM as there are customers to a document.
</p>
<p>
    Static iRow As Integer 'Row count
</p>
<p>
    If iRow = 0 Then 'The header
</p>
<p>
    oSheet.getCellByPosition(0, iRow).String = "Name"
</p>
<p>
    oSheet.getCellByPosition(1, iRow).String = "Email"
</p>
<p>
    oSheet.getCellByPosition(2, iRow).String = "Gender"
</p>
<p>
    oSheet.getCellByPosition(3, iRow).String = "ID"
</p>
<p>
    oSheet.getCellByPosition(4, iRow).String = "Title"
</p>
<p>
    End If
</p>
<p>
    iRow = iRow + 1
</p>
<p>
    If oCust.hasAttribute("name") Then
</p>
<p>
    oSheet.getCellByPosition(0, iRow).String = _
</p>
<p>
    oCust.getAttribute("name")
</p>
<p>
    End If
</p>
<p>
    If oCust.hasAttribute("email") Then
</p>
<p>
    oSheet.getCellByPosition(1, iRow).String = _
</p>
<p>
    oCust.getAttribute("email")
</p>
<p>
    End If
</p>
<p>
    If oCust.hasAttribute("gender") Then
</p>
<p>
    oSheet.getCellByPosition(2, iRow).String = _
</p>
<p>
    oCust.getAttribute("gender")
</p>
<p>
    End If
</p>
<p>
    oSheet.getCellByPosition(3, iRow).String = sID
</p>
<p>
    oSheet.getCellByPosition(4, iRow).String = sTitle
</p>
<p>
</p>
<p>
    End Sub
</p>
<p>
    REM Sort the sheet for convenience
</p>
<p>
    Sub SortCustomers(oSheet, iRows As Integer)
</p>
<p>
    Dim oRange
</p>
<p>
    Dim aSortFields(2) As new com.sun.star.util.SortField
</p>
<p>
    Dim aSortDesc(1) As new com.sun.star.beans.PropertyValue
</p>
<p>
    REM Sort options:
</p>
<p>
    REM (1) Customer's name
</p>
<p>
    REM (2) Customer's email (in case different persons have identical names)
</p>
<p>
    REM (3) Slot ID
</p>
<p>
    With aSortFields(0): .Field = 0
</p>
<p>
    .SortAscending = True: End With
</p>
<p>
    With aSortFields(1): .Field = 1
</p>
<p>
    .SortAscending = True: End With
</p>
<p>
    With aSortFields(2): .Field = 2
</p>
<p>
    .SortAscending = True: End With
</p>
<p>
</p>
<p>
    With aSortDesc(0): .Name = "SortFields"
</p>
<p>
    .Value = aSortFields(): End With
</p>
<p>
    With aSortDesc(1): .Name = "ContainsHeader"
</p>
<p>
    .Value = True : End With
</p>
<p>
</p>
<p>
    oRange = oSheet.getCellRangeByPosition(0, 0, 4, iRows)
</p>
<p>
    oRange.sort(aSortDesc())
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="write-xml-file">
                            <span id="anchor-398"></span>Write XML File
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Two steps are used to export the Calc document to an XML file.
</p>
<ol type="1">
    <li>
        Build the DOM document tree from scratch.
    </li>
    <li>
        Parse the tree and build the output simple text lines from the data. In other words, you have to add all the
        elements in angle brackets, the attribute pairs, the comments regarding the rules of XML – and format the tree
        output in a readable way.
    </li>
</ol>
<p>
    <em><em>As you can see from </em><em></em><em>, the DOM document is a specialized node. It can use the parent XNode
            methods and a couple of additional ones that are listed in </em><em></em><em>.</em></em>
</p>
<p>
    <strong>Table .</strong> Methods implemented in the com.sun.star.xml.dom.XDocument interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                <span id="anchor-399"></span>createAttribute(name)
            </td>
            <td>
                <span id="anchor-400"></span>Creates an Attr of the given name.
            </td>
        </tr>
        <tr class="even">
            <td>
                <span id="anchor-401"></span><span id="anchor-402"></span>createAttributeNS(namespaceURI, qualifiedName)
            </td>
            <td>
                <span id="anchor-403"></span>Creates an attribute of the given qualified name and namespace URI.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <span id="anchor-404"></span>createCDATASection(data)
            </td>
            <td>
                <span id="anchor-405"></span>Creates a CDATASection node whose value is the specified string.
            </td>
        </tr>
        <tr class="even">
            <td>
                <span id="anchor-406"></span>createComment(text)
            </td>
            <td>
                <span id="anchor-407"></span>Creates a Comment node given the specified string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <span id="anchor-408"></span><span id="anchor-409"></span>createDocumentFragment()
            </td>
            <td>
                <span id="anchor-410"></span>Creates an empty DocumentFragment object.
            </td>
        </tr>
        <tr class="even">
            <td>
                <span id="anchor-411"></span>createElement(tagName)
            </td>
            <td>
                <span id="anchor-412"></span>Creates an element of the type specified.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <span id="anchor-413"></span>createElementNS(namespaceURI, qualifiedName)
            </td>
            <td>
                <span id="anchor-414"></span>Creates an element of the given qualified name and namespace URI.
            </td>
        </tr>
        <tr class="even">
            <td>
                <span id="anchor-415"></span>createEntityReference(name)
            </td>
            <td>
                <span id="anchor-416"></span>Creates an EntityReference object.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <span id="anchor-417"></span>createProcessingInstruction(target, data)
            </td>
            <td>
                <span id="anchor-418"></span>Creates a ProcessingInstruction node given the specified name and data
                strings.
            </td>
        </tr>
        <tr class="even">
            <td>
                <span id="anchor-419"></span>createTextNode(text)
            </td>
            <td>
                <span id="anchor-420"></span>Creates a Text node given the specified string.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <span id="anchor-421"></span>getDoctype()
            </td>
            <td>
                <span id="anchor-422"></span>The Document Type Declaration (see DocumentType) associated with this
                document.
            </td>
        </tr>
        <tr class="even">
            <td>
                <span id="anchor-423"></span>getDocumentElement()
            </td>
            <td>
                <span id="anchor-424"></span>This is a convenience attribute that allows direct access to the child node
                that is the root element of the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <span id="anchor-425"></span>getElementById(elementIdstring)
            </td>
            <td>
                <span id="anchor-426"></span>Returns the Element whose ID is given by elementId.
            </td>
        </tr>
        <tr class="even">
            <td>
                <span id="anchor-427"></span>getElementsByTagName(tagname)
            </td>
            <td>
                <span id="anchor-428"></span>Returns a NodeList of all the Elements with a given tag name in the order
                in which they are encountered in a preorder traversal of the Document tree
            </td>
        </tr>
        <tr class="odd">
            <td>
                <span id="anchor-429"></span>GetElementsByTagNameNS<br /> (namespaceURI, localName)
            </td>
            <td>
                <span id="anchor-430"></span>Returns a NodeList of all the Elements with a given local name and
                namespace URI in the order in which they are encountered in a preorder traversal of the Document tree.
            </td>
        </tr>
        <tr class="even">
            <td>
                <span id="anchor-431"></span>getImplementation()
            </td>
            <td>
                <span id="anchor-432"></span>The DOMImplementation object that handles this document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <span id="anchor-433"></span>importNode(importedNode, deep)
            </td>
            <td>
                <span id="anchor-434"></span>Imports a node from another document to this document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the DocumentBuilder service to create an empty DOM document object.
</p>
<p>
    oDocBuilder = createUnoService("com.sun.star.xml.dom.DocumentBuilder")
</p>
<p>
    oDOM = oDocBuilder.newDocument
</p>
<p>
    Next, populate the document with child nodes. Child nodes are created and then added to the parent element. Child
    nodes must be created by the document’s create methods. It does not matter when the nodes are created, or in which
    order. Use appendChild to append a child to a node. Each new child is added to the end of the list of the already
    added child nodes. If the child elements are to be output in sequence, you must must take care to add them in the
    desired order. Use createComment to create a comment node with the comment text string as the argument. Use
    createElement to create an element node with the tag name as the argument.
</p>
<p>
    You must obey the XML naming rules: Names can contain letters, numbers, and other characters. Spaces are not
    allowed. The first character may not be a number or punctuation. The name may not start with the string “xml” (be it
    upper or lower case).
</p>
<p>
    REM Child nodes added to the root node
</p>
<p>
    oNComment = oDOM.createComment(sComment)
</p>
<p>
    oNPlayers = oDOM.createElement("Players")
</p>
<p>
    oDOM.appendChild(oNComment)
</p>
<p>
    oDOM.appendChild(oNPlayers)
</p>
<p>
    REM A child node added to another node
</p>
<p>
    oNPlayer = oDOM.createElement("Player")
</p>
<p>
    oNPlayers.appendChild(oNPlayer)
</p>
<p>
    Attributes need not be created by the DOM document. You can set – that means add – them directly using the XElement
    method setAttribute(name, value), because the order is not so relevant for the attributes. They are listed in a
    NamedNodeMap and can be retrieved by name. The setAttribute method has two arguments, the attribute's name and the
    attribute's value, both are strings:
</p>
<p>
    oNPlayer.setAttribute(oSheet.getCellByPosition(iCol, 0).String, sCellContent)
</p>
<p>
    Use the createTextNode method to create a text node with the text string as the argument. As a text node can have no
    attributes and no child nodes there is seldom a need to reference the node by a variable:
</p>
<p>
    oNName.appendChild(oDOM.createTextNode(sCellContent))
</p>
<p>
    To show the whole process with a real Calc sheet I devised a list of a couple of current and former tennis
    professionals (see ). This sheet is taken as the data source of the XML output.
</p>
<p>
    <img src="Pictures/10000000000002C50000006177D4E3CA.png" style="width:6.2992in;height:0.8661in" />
</p>
<p>
    <strong>Figure .</strong> Detail of the source sheet for the XML export.
</p>
<p>
    The macro in reads a sheet as shown in and returns a DOM document tree.
</p>
<p>
    <strong>Listing .</strong> Creation a DOM from a Calc sheet.
</p>
<p>
    REM Convert a sheet data table into XML using DOM.
</p>
<p>
    REM Each row is a record. The first row contains the headers.
</p>
<p>
    REM Assign each column to the proper node as text or attribute.
</p>
<p>
    REM This function is devised for the specific sheet data.
</p>
<p>
    REM The function returns a DOM document.
</p>
<p>
    Function MakeXMLFromSheet(oSheet)
</p>
<p>
    Dim oDocBuilder 'The DOM DocumentBuilder interface
</p>
<p>
    Dim oDOM 'The DOM document tree
</p>
<p>
    Dim iRow&amp;, iCol&amp;
</p>
<p>
    Dim sCellContent$ 'All XML values are strings
</p>
<p>
    Dim sComment$ 'A comment that is not part of the data
</p>
<p>
    Dim oNComment ' Comment node
</p>
<p>
    Dim oNPlayers ' "Players" element
</p>
<p>
    Dim oNPlayer ' "Player" element is a child of the "Players" element
</p>
<p>
    Dim oNName ' "Name" element is a child of a "Player" element
</p>
<p>
    Dim ONStats ' "Statistics" element is a child of the "Player" element
</p>
<p>
    Dim oNGSlams ' "GrandSlams" element node is a child of a "Player" element
</p>
<p>
    Dim oNGSlam ' Each Grand Slam element is a child of the "GrandSlams" element
</p>
<p>
    REM Create the empty DOM document tree.
</p>
<p>
    oDocBuilder = createUnoService("com.sun.star.xml.dom.DocumentBuilder")
</p>
<p>
    oDOM = oDocBuilder.newDocument
</p>
<p>
</p>
<p>
    REM The DOM document will hold the following tree:
</p>
<p>
    REM &lt;!-- ... --&gt;
</p>
<p>
    REM &lt;Players&gt;
</p>
<p>
    REM &lt;Player ID="..." Gender="..." Nationality="..."&gt;
</p>
<p>
    REM &lt;Name&gt;The player's name&lt;/Name&gt;
</p>
<p>
    REM &lt;Statistics Record="..." Titles="..." HighRank="..." /&gt;
</p>
<p>
    REM &lt;GrandSlams&gt;
</p>
<p>
    REM &lt;Melbourne&gt;List of victory years&lt;/Melbourne&gt;
</p>
<p>
    REM &lt;Paris&gt;...&lt;/Paris&gt;
</p>
<p>
    REM ... (more Grand Slam nodes)
</p>
<p>
    REM &lt;/GrandSlams&gt;
</p>
<p>
    REM &lt;/Player&gt;
</p>
<p>
    REM ... (more Player nodes)
</p>
<p>
    REM &lt;/Players&gt;
</p>
<p>
</p>
<p>
    sComment = "This is a list of famous tennis players who dominated" _
</p>
<p>
    &amp; CHR$(10) &amp; _
</p>
<p>
    " the world ATP tennis circus in the past decades."
</p>
<p>
    REM Create the comment node and the "Players" element and add them
</p>
<p>
    REM to the end of the list of children of the root node.
</p>
<p>
    oNComment = oDOM.createComment(sComment)
</p>
<p>
    oNPlayers = oDOM.createElement("Players")
</p>
<p>
    oDOM.appendChild(oNComment)
</p>
<p>
    oDOM.appendChild(oNPlayers)
</p>
<p>
</p>
<p>
    REM Access the record cells starting with row 1, as row 0 are the headers.
</p>
<p>
    iRow = 1
</p>
<p>
    Do While oSheet.getCellByPosition(0, iRow).Value &lt;&gt; 0
</p>
<p>
    REM With each new row a new "Player" element is created and added
</p>
<p>
    REM to the end of the list of children of the "Players" element.
</p>
<p>
    oNPlayer = oDOM.createElement("Player")
</p>
<p>
    oNPlayers.appendChild(oNPlayer)
</p>
<p>
    REM Create three elements and add them to the end
</p>
<p>
    REM of the list of children of the "Player" element.
</p>
<p>
    oNName = oDOM.createElement("Name")
</p>
<p>
    oNStats = oDOM.createElement("Statistics")
</p>
<p>
    oNGSlams = oDOM.createElement("GrandSlams")
</p>
<p>
    oNPlayer.appendChild(oNName)
</p>
<p>
    oNPlayer.appendChild(oNStats)
</p>
<p>
    oNPlayer.appendChild(oNGSlams)
</p>
<p>
    For iCol = 0 To 10
</p>
<p>
    sCellContent = Trim(oSheet.getCellByPosition(iCol, iRow).String)
</p>
<p>
    Select Case iCol
</p>
<p>
    Case 0, 1, 2 'The player's attributes ID, Gender, and Nationality
</p>
<p>
    REM Set the attribute with two arguments:
</p>
<p>
    REM name from the header, value from the current cell
</p>
<p>
    oNPlayer.setAttribute _
</p>
<p>
    (oSheet.getCellByPosition(iCol, 0).String, sCellContent)
</p>
<p>
    Case 3
</p>
<p>
    REM Append a new text node with the player's name as value
</p>
<p>
    REM as the only child of the "Name" element.
</p>
<p>
    oNName.appendChild(oDOM.createTextNode(sCellContent))
</p>
<p>
    Case 4, 5, 6 'The player's statistics
</p>
<p>
    REM Set the attribute with two arguments:
</p>
<p>
    REM name from the header, value from the current cell
</p>
<p>
    oNStats.setAttribute _
</p>
<p>
    (oSheet.getCellByPosition(iCol, 0).String, sCellContent)
</p>
<p>
    Case 7, 8, 9, 10 'The player's Grand Slam victories.
</p>
<p>
    REM Create a new Grand Slam element and add it to the end
</p>
<p>
    REM of the list of children of the "GrandSlams" element.
</p>
<p>
    REM The header is taken as its tag name.
</p>
<p>
    oNGSlam = oDOM.createElement _
</p>
<p>
    (oSheet.getCellByPosition(iCol, 0).String)
</p>
<p>
    oNGSlams.appendChild(oNGSlam)
</p>
<p>
    REM Append a new text node with the Grand Slam years as value
</p>
<p>
    REM as the only child of the Grand Slam element.
</p>
<p>
    oNGSlam.appendChild(oDOM.createTextNode(sCellContent))
</p>
<p>
    End Select
</p>
<p>
    Next
</p>
<p>
    iRow = iRow + 1
</p>
<p>
    Loop
</p>
<p>
    MakeXMLFromSheet = oDOM
</p>
<p>
    End Function
</p>
<p>
    The macro creates and adds a comment and the container element “Players” to the root node oDOM. For each new row
    (record), a “Player” element is created and added to the “Players” element. Each “Player” node contains the “Name”,
    “Statistics”, and “GrandSlams”child elements.
</p>
<p>
    The macro then iterates over the columns. Columns 0, 1, and 2 are attributes of the “Player” element. The attributes
    are set from the cell content as value and the column header as name – the headers were purposely named to be valid
    XML names. Column 3, the person’s name, is added as a text node to the “Name” element. Colums 4, 5, and 6 are
    attributes of the “Statistics” element. They are set in the same way as columns 0, 1, and 2. Finally, columns 7
    through 10 contain the years of victory in the four Grand Slam events. For each of the locations a new element is
    created using the header as its tag name and added to the “GrandSlams” element. The current cell content is added as
    a text node to this new Grand Slam element.
</p>
<p>
    <strong>Table .</strong> Methods implemented in the com.sun.star.xml.dom.XElement interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getAttribute(name)
            </td>
            <td>
                Retrieves an attribute value by name.
            </td>
        </tr>
        <tr class="even">
            <td>
                getAttributeNode(name)
            </td>
            <td>
                Retrieves an attribute node by name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getAttributeNodeNS(namespaceURI, name)
            </td>
            <td>
                Retrieves an Attr node by local name and namespace URI.
            </td>
        </tr>
        <tr class="even">
            <td>
                getAttributeNS(namespaceURI, name)
            </td>
            <td>
                Retrieves an attribute value by local name and namespace URI.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getElementsByTagName(name)
            </td>
            <td>
                Returns a NodeList of all descendant Elements with a given tag name, in the order in which they are
                encountered in a preorder traversal of this Element tree.
            </td>
        </tr>
        <tr class="even">
            <td>
                getElementsByTagNameNS(namespaceURI, name)
            </td>
            <td>
                Returns a NodeList of all the descendant Elements with a given local name and namespace URI in the order
                in which they are encountered in a preorder traversal of this Element tree.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getTagName()
            </td>
            <td>
                The name of the element.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasAttribute(name)
            </td>
            <td>
                Returns true when an attribute with a given name is specified on this element or has a default value,
                false otherwise.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasAttributeNS(namespaceURI, name)
            </td>
            <td>
                Returns true when an attribute with a given local name and namespace URI is specified on this element or
                has a default value, false otherwise.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeAttribute(name)
            </td>
            <td>
                Removes an attribute by name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeAttributeNode(oldAttr)
            </td>
            <td>
                Removes the specified attribute node.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeAttributeNS(namespaceURI, name)
            </td>
            <td>
                Removes an attribute by local name and namespace URI.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setAttribute(name, value)
            </td>
            <td>
                Adds a new attribute.
            </td>
        </tr>
        <tr class="even">
            <td>
                setAttributeNode(<span id="anchor-435"></span>newAttr)
            </td>
            <td>
                Adds a new attribute node.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setAttributeNodeNS(<span id="anchor-436"></span>newAttr)
            </td>
            <td>
                Adds a new attribute.
            </td>
        </tr>
        <tr class="even">
            <td>
                setAttributeNS(namespaceURI, <span id="anchor-437"></span>qualifiedName, <span
                    id="anchor-438"></span>value)
            </td>
            <td>
                Adds a new attribute.
            </td>
        </tr>
    </tbody>
</table>
<p>
    shows the methods that are implemented by the XElement interface. Every XElement is also an XNode so the methods in
    are also implemented.
</p>
<p>
    The following code snippet demonstrates how to iterate through child nodes and identify the specific node types:
</p>
<p>
    <strong>Listing .</strong> Processing child nodes.
</p>
<p>
    If oNode.hasChildNodes Then
</p>
<p>
    oChildren = oNode.getChildNodes
</p>
<p>
    For i = 0 To oChildren.getLength – 1
</p>
<p>
    oChild = oChildren.item(i)
</p>
<p>
    If oChild.getNodeType = com.sun.star.xml.dom.NodeType.COMMENT_NODE Then
</p>
<p>
    'Comment nodes can contain text, but not attributes or child nodes.
</p>
<p>
    sCommentText = oChild.getNodeValue
</p>
<p>
    Elseif Child.getNodeType = com.sun.star.xml.dom.NodeType.ELEMENT_NODE Then
</p>
<p>
    …
</p>
<p>
    Elseif Child.getNodeType = com.sun.star.xml.dom.NodeType.TEXT_NODE Then
</p>
<p>
    'Comment nodes can contain text, but not attributes or child nodes.
</p>
<p>
    sText = oChild.getNodeValue
</p>
<p>
    Element nodes can contain attributes. Comments and text nodes cannot have attributes. Use getAttributes to access
    the attribute nodes as a NamedNodeMap. Null is returned if no attributes are present. The following code iterates
    through the attributes, getting the attribute name and value.
</p>
<p>
    <strong>Listing .</strong> Iterate through each attribute for an element.
</p>
<p>
    oAttList = oElement.getAttributes
</p>
<p>
    If Not IsNull(oAttList) Then
</p>
<p>
    For i = 0 To oAttList.getLength – 1
</p>
<p>
    oAtt = oAttList.item(i)
</p>
<p>
    sValue = oAtt.getNodeValue
</p>
<p>
    sName = oAtt.getNodeName
</p>
<p>
    Element nodes can contain child nodes: multiple comments, multiple elements or one single text node. So the code
    inspects these child nodes recursively. The subroutine PrintDom is called for each element level.
</p>
<p>
    <strong>Listing .</strong> Macro to write a DOM document as an XML text file.
</p>
<p>
    REM Export the contents of a Calc sheet into an XML file.
</p>
<p>
    Sub ExportSheetToXML
</p>
<p>
    REM Typically this subroutine will be very short:
</p>
<p>
    'Dim sURL
</p>
<p>
    'sURL = ChooseAFileName 'Function stored in this file's UNO module
</p>
<p>
    'WriteDomToFile(MakeXMLFromSheet(ThisComponent.Sheets(0)), sURL)
</p>
<p>
    REM But for this example a new Calc document is created first,
</p>
<p>
    REM some data are written into sheet 0,
</p>
<p>
    REM and at the end the stored XML file is opened for inspection.
</p>
<p>
    Dim oCalcDoc 'The source Calc spreadsheet document
</p>
<p>
    Dim oSheet 'The source sheet
</p>
<p>
    Dim sURL As String 'The URL of the output file
</p>
<p>
</p>
<p>
    sURL = GetWorkDir() &amp; "/oome_xml_export.xml"
</p>
<p>
    oCalcDoc = StarDesktop.loadComponentFromURL( _
</p>
<p>
    "private:factory/scalc", "_blank", 0, Array())
</p>
<p>
    oSheet = oCalcDoc.Sheets(0)
</p>
<p>
    REM Fill the sheet with fancy data.
</p>
<p>
    CreateExampleSheet(oSheet)
</p>
<p>
    REM The following subroutine has to be devised using the specific sheet data.
</p>
<p>
    REM Typically it is placed in the document library.
</p>
<p>
    WriteDomToFile(MakeXMLFromSheet(oSheet), sURL)
</p>
<p>
    Wait 500 'Give the OS time to store the file to disk
</p>
<p>
    REM Load the XML file in a Writer document.
</p>
<p>
    REM LibreOffice requires that the FilterName be specified, AOO does not.
</p>
<p>
    Dim noArgs(1) As New com.sun.star.beans.PropertyValue
</p>
<p>
    noArgs(0).Name = "FilterName"
</p>
<p>
    noArgs(0).Value = "Text"
</p>
<p>
    StarDesktop.loadComponentFromURL(sUrl, "_blank", 0, noArgs() )
</p>
<p>
    End Sub
</p>
<p>
    REM Writes the structure of the current DOM document
</p>
<p>
    REM into a valid and nicely formatted XML text file.
</p>
<p>
    REM This subroutine and the called subroutines and functions are not
</p>
<p>
    REM document specific and needn't be part of the document library.
</p>
<p>
    REM They can be stored in the "My Macros" library.
</p>
<p>
    Sub WriteDomToFile(oDOM, sFilePath As String)
</p>
<p>
    Dim oSimpleFileAccess 'SimpleFileAccess service
</p>
<p>
    Dim oOutputStream 'Stream returned from SimpleFileAccess
</p>
<p>
    Dim oTextOutput 'TextOutputStream service
</p>
<p>
    Dim oNodes 'List of child nodes of the root node
</p>
<p>
    Dim i%
</p>
<p>
    Dim iIndentLevel As Integer 'Indentation level
</p>
<p>
    Dim iIndentSpaces As Integer 'Number of spaces added to each indentation level
</p>
<p>
</p>
<p>
    On Error Goto Catch
</p>
<p>
</p>
<p>
    iIndentSpaces = 2
</p>
<p>
    REM Set the output stream
</p>
<p>
    sFilePath = ConvertToURL(sFilePath)
</p>
<p>
    oSimpleFileAccess = createUnoService("com.sun.star.ucb.SimpleFileAccess")
</p>
<p>
    With oSimpleFileAccess
</p>
<p>
    If .exists(sFilePath) Then .kill(sFilePath)
</p>
<p>
    oOutputStream = .openFileWrite(sFilePath)
</p>
<p>
    End With
</p>
<p>
</p>
<p>
    oTextOutput = createUnoService("com.sun.star.io.TextOutputStream")
</p>
<p>
    With oTextOutput
</p>
<p>
    .OutputStream = oOutputStream
</p>
<p>
    .setEncoding("UTF-8")
</p>
<p>
    REM The first line is a processing instruction. It usually isn't part of
</p>
<p>
    REM the DOM tree. So we write it separately.
</p>
<p>
    .WriteString("&lt;?xml version=""1.0"" encoding=""UTF-8""?&gt;" &amp; CHR$(10))
</p>
<p>
</p>
<p>
    REM A DOM tree can consist of zero, one or more child nodes on the
</p>
<p>
    REM root level. The child nodes are treated hierarchically.
</p>
<p>
    If oDOM.hasChildNodes Then
</p>
<p>
    oNodes = oDOM.getChildNodes
</p>
<p>
    For i = 0 To oNodes.getLength - 1
</p>
<p>
    PrintDom(oNodes.item(i), oTextOutput, iIndentLevel, iIndentSpaces)
</p>
<p>
    Next
</p>
<p>
    End If
</p>
<p>
    .closeOutput
</p>
<p>
    End With
</p>
<p>
    oOutputStream.closeOutput
</p>
<p>
    Exit Sub
</p>
<p>
</p>
<p>
    Catch:
</p>
<p>
    Print "Error " &amp; Err &amp; " (" &amp; Error(Err) &amp; ")"
</p>
<p>
    End Sub
</p>
<p>
    REM Writes the elements of a DOM tree recursively line after line into a
</p>
<p>
    REM text file. Mark to start with iLevel 0.
</p>
<p>
    REM Indents lower levels by accumulating iIndent spaces, except for text nodes:
</p>
<p>
    REM they are written in the same line directly after the element start tag
</p>
<p>
    REM and are directly followed by the element end tag.
</p>
<p>
    REM It is assumed that there are either one text node or one or more other
</p>
<p>
    REM child nodes to an element, if any.
</p>
<p>
    Sub PrintDom(oNode, oStream, iLevel As Integer, iIndent As Integer)
</p>
<p>
    Dim oElementChildren
</p>
<p>
    Dim oChild
</p>
<p>
    Dim sLine As String
</p>
<p>
    Dim sAtt As String
</p>
<p>
    Dim sIndent As String
</p>
<p>
    Dim i%, iLen%
</p>
<p>
    Dim sNodeName As String
</p>
<p>
</p>
<p>
    sNodeName = oNode.getNodeName
</p>
<p>
    sIndent = String(iLevel * iIndent, " ")
</p>
<p>
</p>
<p>
    REM Only comments and elements are treated.
</p>
<p>
    If oNode.getNodeType = com.sun.star.xml.dom.NodeType.COMMENT_NODE Then
</p>
<p>
    REM XML comment
</p>
<p>
    sLine = sIndent &amp; "&lt;!-- " &amp; oNode.getNodeValue &amp; " --&gt;"
</p>
<p>
    oStream.writeString(sLine &amp; CHR$(10))
</p>
<p>
    Elseif oNode.getNodeType = _
</p>
<p>
    com.sun.star.xml.dom.NodeType.ELEMENT_NODE Then
</p>
<p>
    REM XML element
</p>
<p>
    sAtt = AttString(oNode.getAttributes)
</p>
<p>
    REM Check, if the element has data. Otherwise the element is skipped.
</p>
<p>
    If oNode.hasChildNodes OR sAtt &lt;&gt; "" Then
</p>
<p>
    oElementChildren = oNode.getChildNodes
</p>
<p>
    If HasContent(oElementChildren) Then
</p>
<p>
    sLine = sIndent &amp; "&lt;" &amp; sNodeName &amp; sAtt &amp; "&gt;" 'Start tag line
</p>
<p>
    iLen = oElementChildren.getLength
</p>
<p>
    If iLen = 1 Then
</p>
<p>
    REM Test for text node, assuming that there are no other
</p>
<p>
    REM sibling nodes besides a text node.
</p>
<p>
    oChild = oElementChildren.item(0)
</p>
<p>
    If oChild.getNodeType = com.sun.star.xml.dom.NodeType.TEXT_NODE Then
</p>
<p>
    sLine = sLine &amp; oChild.getNodeValue &amp; "&lt;/" &amp; sNodeName &amp; "&gt;"
</p>
<p>
    REM Write the line: start tag plus text value plus end tag.
</p>
<p>
    oStream.writeString(sLine &amp; CHR$(10))
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    REM At this point there are child elements other than text nodes.
</p>
<p>
    REM Write the start tag line.
</p>
<p>
    oStream.writeString(sLine &amp; CHR$(10))
</p>
<p>
    For i = 0 To iLen - 1
</p>
<p>
    REM Start the recursion, increment the indentation level
</p>
<p>
    PrintDom(oElementChildren.item(i), oStream, iLevel + 1, iIndent)
</p>
<p>
    Next
</p>
<p>
    sLine = sIndent &amp; "&lt;/" &amp; sNodeName &amp; "&gt;" 'End tag line
</p>
<p>
    REM Write the end tag line.
</p>
<p>
    oStream.writeString(sLine &amp; CHR$(10))
</p>
<p>
    Else
</p>
<p>
    REM There are no child elements to be written.
</p>
<p>
    REM If there are attributes, the short notation is used.
</p>
<p>
    REM If there are not even attributes, no element tag is written.
</p>
<p>
    If sAtt &lt;&gt; "" Then
</p>
<p>
    sLine = sIndent &amp; "&lt;" &amp; sNodeName &amp; sAtt &amp; " /&gt;"
</p>
<p>
    REM Write the element in a short notation line.
</p>
<p>
    oStream.writeString(sLine &amp; CHR$(10))
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    REM Returns a string of all the attributes of an element.
</p>
<p>
    Function AttString(oAttList) As String
</p>
<p>
    Dim oAtt 'A single attribute node
</p>
<p>
    Dim sValue As String 'A single attribute's value
</p>
<p>
    Dim sAtts As String 'The string containing all attributes
</p>
<p>
    Dim i%
</p>
<p>
</p>
<p>
    If Not IsNull(oAttList) Then
</p>
<p>
    For i = 0 To oAttList.getLength - 1
</p>
<p>
    oAtt = oAttList.item(i)
</p>
<p>
    sValue = oAtt.getNodeValue
</p>
<p>
    If sValue &lt;&gt; "" Then
</p>
<p>
    sAtts = sAtts &amp; " " &amp; oAtt.getNodeName &amp; "=""" &amp; sValue &amp; """"
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End If
</p>
<p>
    AttString = sAtts
</p>
<p>
    End Function
</p>
<p>
    REM Checks recursively, if there is some child node with content, be it text,
</p>
<p>
    REM comment or attribute value other than "". Returns True, if some content
</p>
<p>
    REM is found in the tree, otherwise False.
</p>
<p>
    REM It is called by PrintDom, before the actual element start tag is written,
</p>
<p>
    REM so PrintDom can abstain from printing an empty element.
</p>
<p>
    Function HasContent(oElementList) As Boolean
</p>
<p>
    Dim oChild 'A single child node of oElementList
</p>
<p>
    Dim oAttributes 'The attributes of oChild
</p>
<p>
    Dim oChildren 'The child nodes of oChild
</p>
<p>
    Dim i%, j%
</p>
<p>
</p>
<p>
    For i = 0 To oElementList.getLength - 1
</p>
<p>
    oChild = oElementList.item(i)
</p>
<p>
    If oChild.hasAttributes Then
</p>
<p>
    oAttributes = oChild.getAttributes
</p>
<p>
    For j = 0 To oAttributes.getLength - 1
</p>
<p>
    If oAttributes.item(j).getNodeValue &lt;&gt; "" Then
</p>
<p>
    HasContent = True
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End If
</p>
<p>
    If oChild.getNodeType = com.sun.star.xml.dom.NodeType.TEXT_NODE Then
</p>
<p>
    If oChild.getNodeValue &lt;&gt; "" Then
</p>
<p>
    HasContent = True
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    Elseif oChild.getNodeType = com.sun.star.xml.dom.NodeType.COMMENT_NODE Then
</p>
<p>
    If oChild.getNodeValue &lt;&gt; "" Then
</p>
<p>
    HasContent = True
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    Else
</p>
<p>
    oChildren = oChild.getChildNodes()
</p>
<p>
    If oChildren.getLength &lt;&gt; 0 Then
</p>
<p>
    REM Start the recursion
</p>
<p>
    If HasContent(oChildren) Then
</p>
<p>
    HasContent = True
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    HasContent = False
</p>
<p>
    End Function
</p>
<p>
    The WriteDomToFile subroutine takes two arguments, the DOM document and the file URL. An output stream is obtained
    from the SimpleFileAccess, which is then used by a TextOutputStream to write a UTF-8 encoded text file one line at a
    time.
</p>
<ol type="1">
    <li>
        The first line of an XML file is the xml processing instruction that is not part of the DOM document.
    </li>
    <li>
        The macro iterates over root nodes children and prints each using PrintDom. PrintDom calls itself to print
        children of the node with which it was called.
    </li>
    <li>
        PrintDom accepts four arguments: the current node, the output stream, the indentation level, and the number of
        spaces used for indentation. The first level is not indented, for each lower level – that is for each
        consecutive call of PrintDom – two spaces are added.
    </li>
    <li>
        If the current node is a comment, PrintDom writes the text of the comment in the XML comment notation: &lt;!--
        Text --&gt;. Line feed characters within the text break the output into new lines. PrintDom terminates.
    </li>
    <li>
        For element nodes, PrintDom uses the AttString function to print attributes.
    </li>
</ol>
<p>
    Special attention is made to print the XML in a “pretty” way; for example, if possible, a node is printed as
    &lt;Name/&gt; rather than &lt;Name&gt;&lt;/Name&gt;.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="charts">
                    <span id="anchor-439"></span>Charts
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Many things can be done with charts, but only a small portion of the capabilities are shown here in an attempt to
    provide an overview of what can be accomplished.
</p>
<p>
    Although a chart is a document (it has its own document model), charts are always embedded in other OOo documents.
    Objects that support embedded charts (Calc sheets) implement the getCharts method as defined by the
    XTtableChartsSupplier interface, which returns a TableCharts service.
</p>
<p>
    ThisComponent.Sheets(0).getCharts()
</p>
<p>
    <strong>Table .</strong> Methods implemented in the com.sun.star.table.XTableCharts interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                addNewByName ( name, size, data, bCol, bRow )
            </td>
            <td>
                Create and add the named chart.
            </td>
        </tr>
        <tr class="even">
            <td>
                createEnumeration()
            </td>
            <td>
                Create an enumeration.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getByIndex( i )
            </td>
            <td>
                Get chart by index.
            </td>
        </tr>
        <tr class="even">
            <td>
                getByName( name )
            </td>
            <td>
                Get chart by name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getCount( )
            </td>
            <td>
                Number of charts.
            </td>
        </tr>
        <tr class="even">
            <td>
                getElementNames( )
            </td>
            <td>
                Array of chart names.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasByName ( name )
            </td>
            <td>
                Determine if a named chart exists.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasElements ( )
            </td>
            <td>
                Determine if any charts exist.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeByName ( name )
            </td>
            <td>
                Delete a named chart.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Sample data is needed to discuss charts.
</p>
<p>
    <strong>Listing .</strong> Create sample chart data.
</p>
<p>
    Function CreateCalcForChart
</p>
<p>
    Dim oCalcDoc 'The source Calc spreadsheet document
</p>
<p>
    Dim oSheet 'The source sheet
</p>
<p>
    Dim sDataRng$ 'Where is the data
</p>
<p>
</p>
<p>
    oCalcDoc = StarDesktop.loadComponentFromURL( "private:factory/scalc", "_blank", 0, Array())
</p>
<p>
    oSheet = oCalcDoc.Sheets(0)
</p>
<p>
    sDataRng = "A1:D6"
</p>
<p>
    Dim oData
</p>
<p>
    oData = Array( Array("A", "B", "C", "D"), _
</p>
<p>
    Array(3, 1, 5, 4), _
</p>
<p>
    Array(2, 2, 4, 1), _
</p>
<p>
    Array(1, 3, 3, 0), _
</p>
<p>
    Array(2, 4, 2, 1), _
</p>
<p>
    Array(3, 5, 1, 4))
</p>
<p>
    oSheet.getCellRangeByName( sDataRng ).setDataArray(oData)
</p>
<p>
    CreateCalcForChart = oCalcDoc
</p>
<p>
    End Function
</p>
<p>
    The sample data is shown below:
</p>
<p>
    <strong>Table .</strong> Sample data for charts.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                A
            </td>
            <td>
                B
            </td>
            <td>
                C
            </td>
            <td>
                D
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                3
            </td>
            <td>
                1
            </td>
            <td>
                5
            </td>
            <td>
                4
            </td>
        </tr>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
                2
            </td>
            <td>
                2
            </td>
            <td>
                4
            </td>
            <td>
                1
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                1
            </td>
            <td>
                3
            </td>
            <td>
                3
            </td>
            <td>
                0
            </td>
        </tr>
        <tr class="odd">
            <td>
                5
            </td>
            <td>
                2
            </td>
            <td>
                4
            </td>
            <td>
                2
            </td>
            <td>
                1
            </td>
        </tr>
        <tr class="even">
            <td>
                6
            </td>
            <td>
                3
            </td>
            <td>
                5
            </td>
            <td>
                1
            </td>
            <td>
                4
            </td>
        </tr>
    </tbody>
</table>
<p>
    Consider the simple example below that creates a simple chart. A Calc document is created with simple data (see and
    ). If the chart does not exist, it is created 10 cm (about 4 inches) from the left edge and 1 cm from the top edge.
    The graph is 10 cm x 10 cm in size.An array of cell range addresses is passed as the third argument to addNewByName
    to define the data that is charted.
</p>
<p>
    <strong>Listing .</strong> Create a simple chart.
</p>
<p>
    Sub CreateCalcWithSimpleChart
</p>
<p>
    Dim oSheet 'Sheet containing the chart
</p>
<p>
    Dim oRect 'How big is the chart
</p>
<p>
    Dim oCharts 'Charts in the sheet
</p>
<p>
    Dim oChart 'Created chart
</p>
<p>
    Dim oAddress 'Address of data to plot
</p>
<p>
    Dim sName$ 'Chart name
</p>
<p>
    Dim oChartDoc 'Embedded chart object
</p>
<p>
    Dim oTitle 'Chart title object
</p>
<p>
    Dim oDiagram 'Inserted diagram (data).
</p>
<p>
    Dim sDataRng$ 'Where is the data
</p>
<p>
    Dim oCalcDoc
</p>
<p>
</p>
<p>
    oCalcDoc = CreateCalcForChart()
</p>
<p>
    sName = "ADP_Chart"
</p>
<p>
    sDataRng = "A1:D6"
</p>
<p>
    oSheet = oCalcDoc.sheets(0)
</p>
<p>
    oAddress = oSheet.getCellRangeByName( sDataRng ).getRangeAddress()
</p>
<p>
    oCharts = oSheet.getCharts()
</p>
<p>
    If NOT oCharts.hasByName(sName) Then
</p>
<p>
    oRect = createObject("com.sun.star.awt.Rectangle")
</p>
<p>
    oRect.X = 10000
</p>
<p>
    oRect.Y = 1000
</p>
<p>
    oRect.width = 10000
</p>
<p>
    oRect.Height= 10000
</p>
<p>
    ' The rectangle identifies the dimensions in 1/100 mm.
</p>
<p>
    ' The address is the location of the data.
</p>
<p>
    ' True indicates that column headings should be used.
</p>
<p>
    ' False indicates that Row headings should not be used.
</p>
<p>
    oCharts.addNewByName(sName, oRect, Array(oAddress), True, False)
</p>
<p>
    End If
</p>
<p>
    oChart = oCharts.getByName( sName )
</p>
<p>
    oChart.setRanges(Array(oAddress))
</p>
<p>
    oChartDoc = oChart.getEmbeddedObject()
</p>
<p>
    'oChartDoc.attachData(oAddress)
</p>
<p>
    oTitle = oChartDoc.getTitle()
</p>
<p>
    oTitle.String = "Andy - " &amp; Now
</p>
<p>
    ' Create a diagram.
</p>
<p>
    oDiagram = oChartDoc.createInstance( "com.sun.star.chart.LineDiagram" )
</p>
<p>
    oChartDoc.setDiagram( oDiagram )
</p>
<p>
    oDiagram = oChartDoc.getDiagram()
</p>
<p>
    oDiagram.DataCaption = com.sun.star.chart.ChartDataCaption.VALUE
</p>
<p>
    oDiagram.DataRowSource = com.sun.star.chart.ChartDataRowSource.COLUMNS
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001F4000001DFDCEE6CD5.png" style="width:5.2083in;height:4.9898in" />
</p>
<p>
    <strong>Figure .</strong> Simple chart created by .
</p>
<p>
    The chart can be modified after it is in the document. The following snippet changes the already inserted chart and
    uses three ranges that need not be contiguous.
</p>
<p>
    <strong>Listing .</strong> Modify an existing chart.
</p>
<p>
    sName = "ADP_Chart"
</p>
<p>
    sDataRng = "A1:D6"
</p>
<p>
    oSheet = ThisComponent.sheets(0)
</p>
<p>
    oCharts = oSheet.getCharts()
</p>
<p>
    If oCharts.hasByName(sName) Then
</p>
<p>
    oChart = oCharts.getByName(sName)
</p>
<p>
    oData = Array(oSheet.getCellRangeByName( "A1:A6").getRangeAddress(), _
</p>
<p>
    oSheet.getCellRangeByName( "C1:C6" ).getRangeAddress(), _
</p>
<p>
    oSheet.getCellRangeByName( "D1:D6" ).getRangeAddress())
</p>
<p>
    oChart.setRanges(oData)
</p>
<p>
    End If
</p>
<p>
    <img src="Pictures/10000000000001E7000001E46A0A3231.png" style="width:5.0728in;height:5.0417in" />
</p>
<p>
    <strong>Figure .</strong> Modify the chart.
</p>
<p>
    The chart supports the com.sun.star.table.TableChart service. The primary methods of interest are shown in . A
    TableChart object also implements methods to add and remove listeners.
</p>
<p>
    <strong>Table .</strong> Main methods to control a TableChart.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getEmbeddedObject()
            </td>
            <td>
                Get the chart model.
            </td>
        </tr>
        <tr class="even">
            <td>
                getHasColumnHeaders()
            </td>
            <td>
                Are the cells of the topmost row of the source data used as column headers.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getHasRowHeaders()
            </td>
            <td>
                Are the cells of the leftmost column of the source data used as row headers.
            </td>
        </tr>
        <tr class="even">
            <td>
                getName()
            </td>
            <td>
                Get the chart name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getRanges()
            </td>
            <td>
                Get an array of ranges used in the chart.
            </td>
        </tr>
        <tr class="even">
            <td>
                setHasColumnHeaders( b )
            </td>
            <td>
                Set if the cells of the topmost row of the source data are used as column headers.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setHasRowHeaders ( b )
            </td>
            <td>
                Set if the cells of the leftmost column of the source data are used as row headers.
            </td>
        </tr>
        <tr class="even">
            <td>
                setName ( name )
            </td>
            <td>
                Set the chart name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setRanges ( ranges )
            </td>
            <td>
                Set the ranges used in the report.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The chart model has significant complexity – you do remember that it is an embedded document. There are multiple
    methods for dealing with chart titles. The chart title object supports backgrounds, bitmaps, text rotation,
    paragraph styles, and an array of formatted text objects that represent the text of the title. In our example, the
    title has a single text element, which can be changed as follows:
</p>
<p>
    <strong>Listing .</strong> Set the chart title using getTitleObject().
</p>
<p>
    oChartDoc = oChart.getEmbeddedObject()
</p>
<p>
    Dim txtArray
</p>
<p>
    txtArray = oChartDoc.getTitleObject().getText()
</p>
<p>
    (0).setString("New Title Text")
</p>
<p>
    Formatted strings support properties related to formatting such as CharColor, CharEmphasis, CharFontName, and
    CharFontStyleName. I recommend object inspection to see what is supported. The chart doc also supports the
    getTitle() method which encapsulates the title as a single string and supports similar text formatting
    characteristics. The object returned by getTitle implements the XShape interface, so it can be used to change the
    position and size.
</p>
<p>
    <strong>Listing .</strong> Set the chart title using getTitle().
</p>
<p>
    oChartDoc.getTitle().String = "one two three"
</p>
<p>
    The subtitle, available using getSubtitle(), is also a com.sun.star.comp.chart.Title service, so, all methods that
    apply to the title, also apply to the subtitle.
</p>
<p>
    <strong>Listing .</strong> Set the chart subtitle.
</p>
<p>
    oChartDoc.getSubTitle().String = "I am the subtitle"
</p>
<p>
    Use getLegend() to get the legend (com.sun.star.comp.chart.Legend), which you can use to change the font, size,
    position, and other formatting characteristics. The legend object does not allow you to change the text of the
    legend, however.
</p>
<p>
    Changing the chart type involves asking the chart document for an appropriate diagram type, and then setting it (see
    ). Note that the TypesDocCanCreate macro in can also be used here.
</p>
<p>
    <strong>Listing .</strong> List services the chart document can create.
</p>
<p>
    Dim oWriteDoc
</p>
<p>
    Dim oText
</p>
<p>
    Dim sn
</p>
<p>
    oWriteDoc = StarDesktop.loadComponentFromURL("private:factory/swriter", "_blank", 0, Array())
</p>
<p>
    oText = oWriteDoc.getText()
</p>
<p>
    sn = oChartDoc.getAvailableServiceNames()
</p>
<p>
    MsgBox Join(sn, CHR$(10))
</p>
<p>
    oText.insertString ( oText.End, Join(sn, CHR$(10)), False )
</p>
<p>
    The list returned by Apache OpenOffice 3.4 is as follows:
</p>
<ol type="1">
    <li>
        com.sun.star.chart.AreaDiagram
    </li>
    <li>
        com.sun.star.chart.BarDiagram
    </li>
    <li>
        com.sun.star.chart.BubbleDiagram
    </li>
    <li>
        com.sun.star.chart.DonutDiagram
    </li>
    <li>
        com.sun.star.chart.FilledNetDiagram
    </li>
    <li>
        com.sun.star.chart.LineDiagram
    </li>
    <li>
        com.sun.star.chart.NetDiagram
    </li>
    <li>
        com.sun.star.chart.PieDiagram
    </li>
    <li>
        com.sun.star.chart.StockDiagram
    </li>
    <li>
        com.sun.star.chart.XYDiagram
    </li>
    <li>
        com.sun.star.document.ExportGraphicObjectResolver
    </li>
    <li>
        com.sun.star.document.ImportGraphicObjectResolver
    </li>
    <li>
        com.sun.star.drawing.BitmapTable
    </li>
    <li>
        com.sun.star.drawing.DashTable
    </li>
    <li>
        com.sun.star.drawing.GradientTable
    </li>
    <li>
        com.sun.star.drawing.HatchTable
    </li>
    <li>
        com.sun.star.drawing.MarkerTable
    </li>
    <li>
        com.sun.star.drawing.TransparencyGradientTable
    </li>
    <li>
        com.sun.star.xml.NamespaceMap
    </li>
</ol>
<p>
    The first 10 items are chart types. Changing the diagram type is trivial.
</p>
<p>
    <strong>Listing .</strong> Set chart type to PieDiagram.
</p>
<p>
    oChartDoc = oChart.getEmbeddedObject()
</p>
<p>
    oDiagram = oChartDoc.createInstance( "com.sun.star.chart.PieDiagram")
</p>
<p>
    oChartDoc.setDiagram( oDiagram )
</p>
<p>
    Use getArea() to get the com.sun.star.comp.chart.Area for the chart. Use the Area object to set visual
    characteristics such as colors, size, and position.
</p>
<p>
    The actual plot is contained in the diagram, available using getDiagram(). To get a feel for some of the properties
    supported by the diagram object, look at . Numerous other properties and methods are also supported, but they are
    omitted due to space constraints. Inspect the object to find properties related to axis, colors, bitmaps, and grids.
</p>
<p>
    <strong>Table .</strong> Properties used to set error bars.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Property
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                ConstantErrorLow
            </td>
            <td>
                Lower limit of the error range of a data row.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ConstantErrorHigh
            </td>
            <td>
                Upper limit of the error range of a data row.
            </td>
        </tr>
        <tr class="even">
            <td>
                ErrorBarStyle
            </td>
            <td>
                Use com.sun.star.chart.ErrorBarStyle constants to set the error bar style. Use: NONE, VARIANCE,
                STANDARD_DEVIATION, ABSOLUTE, RELATIVE, ERROR_MARGIN, STANDARD_ERROR, or FROM_DATA.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PercentageError
            </td>
            <td>
                Percentage used to display error bars.
            </td>
        </tr>
        <tr class="even">
            <td>
                ErrorMargin
            </td>
            <td>
                Percentage for the margin of errors.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ErrorIndicator
            </td>
            <td>
                Use com.sun.star.chart.ChartErrorIndicatorType enum to specify how the error is indicated. Valid values
                include NONE, TOP_AND_BOTTOM, UPPER, or LOWER.
            </td>
        </tr>
        <tr class="even">
            <td>
                ErrorBarRangePositive
            </td>
            <td>
                Cell range string for positive error bars – assuming the ErrorBarStyle is set to FROM_DATA.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ErrorBarRangeNegative
            </td>
            <td>
                Cell range string for negative error bars – assuming the ErrorBarStyle is set to FROM_DATA.
            </td>
        </tr>
        <tr class="even">
            <td>
                MeanValue
            </td>
            <td>
                Set to true to display the mean value for a data row as a line.
            </td>
        </tr>
        <tr class="odd">
            <td>
                RegressionCurves
            </td>
            <td>
                Use com.sun.star.chart.ChartRegressionCurveType enum to specify the type of regression for the data row
                values. Valid values include: NONE, LINEAR, LOGARITHM, EXPONENTIAL, or POWER.
            </td>
        </tr>
        <tr class="even">
            <td>
                DataCaption
            </td>
            <td>
                Use com.sun.star.chart.ChartDataCaption constants to determine how points are captioned. Valid values
                include NONE, VALUE, PERCENT, TEXT, or SYMBOL. The chart in is set to VALUE, so the numeric values are
                shown at each data point.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DataRowSource
            </td>
            <td>
                Use com.sun.star.chart.ChartDataRowSource enum values to to determine if data is in rows or columns.
                Valid values include ROWS, or COLUMNS.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-13">
                    <span id="anchor-440"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Calc documents are feature-rich and they support a wide variety of capabilities. In my opinion, Calc documents
    provide more functionality than any other document type supported by OOo. This chapter, therefore, is only the
    beginning of the wonderful things that you can do using Calc documents.
</p>
<ol type="1">
    <li>
        <h1 id="draw-and-impress-documents">
            <span id="anchor-441"></span><span id="anchor-236"></span>Draw and Impress Documents
        </h1>
    </li>
</ol>
<p>
    This chapter introduces methods to manipulate and modify the content contained in Draw and Impress documents.
    Although the drawing functionality is the same in Draw and Impress, Impress contains extra functionality to
    facilitate presentations.
</p>
<p>
    Draw and Impress are vector-oriented graphical applications. They can also display bitmap images, but their strength
    is not in photo editing. Vector-oriented applications represent many graphical objects as objects rather than as
    bit-mapped images. For example, lines, circles, rectangles, and text are each represented as special objects. One
    advantage of vector graphics is that you can independently manipulate and transform multiple overlapping elements
    without worrying about resolution and pixels.
</p>
<p>
    Photo-editing graphics packages typically represent and manipulate images as bitmaps. A bitmap representing an image
    is characterized by the width and height of the image in pixels. Each pixel represents a single, colored dot in the
    image. The drawing capability in OpenOffice.org, however, is focused on vector operations.
</p>
<p>
    Every Draw document supports the com.sun.star.drawing.DrawingDocument service and every Impress document supports
    the com.sun.star.presentation.PresentationDocument service. When I write a macro that must be user friendly and
    requires a specific document type, I verify that the document is the correct type by using the object method
    supportsService (see ).
</p>
<p>
    <strong>Listing .</strong> Check for an Impress document before checking for a Draw document.
</p>
<p>
    REM If it really matters, you should check the document type
</p>
<p>
    REM to avoid a run-time error.
</p>
<p>
    sDraw$ = "com.sun.star.drawing.DrawingDocument"
</p>
<p>
    sImpress$ = "com.sun.star.presentation.PresentationDocument"
</p>
<p>
    If ThisComponent.SupportsService(sImpress$) Then
</p>
<p>
    MsgBox "The current document is an Impress document", 0, "Impress Document"
</p>
<p>
    ElseIf ThisComponent.SupportsService(sDraw$) Then
</p>
<p>
    MsgBox "The current document is a Draw document", 0, "Draw Document"
</p>
<p>
    Else
</p>
<p>
    MsgBox "The current document is not the correct type", 48, "Error"
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Warn
            </td>
            <td>
                The PresentationDocument service implements the DrawingDocument service. This means that every
                presentation document looks like a drawing document. To distinguish between the two document types, you
                must first check for a presentation (Impress) document and then check for a drawing document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The simple function below returns a new document, this is used in other macros for this chapter.
</p>
<p>
    <strong>Listing .</strong> Create a new document.
</p>
<p>
    REM Create a new empty document
</p>
<p>
    REM consider document types of
</p>
<p>
    REM scalc, swriter, sdraw, smath, and simpress
</p>
<p>
    Function LoadEmptyDocument(docType$)
</p>
<p>
    Dim noArgs() 'An empty array for the arguments
</p>
<p>
    Dim sURL As String 'URL of the document to load
</p>
<p>
    sURL = "private:factory/" &amp; docType
</p>
<p>
    LoadEmptyDocument = StarDesktop.LoadComponentFromUrl(sURL, "_blank", 0, noArgs())
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="draw-pages">
                    <span id="anchor-442"></span>Draw pages
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The primary function of Draw and Impress documents is to contain graphical data, which is stored in draw pages. The
    primary draw-page functionality is implemented by a GenericDrawPage. There are two types of draw
    pages<em><em>—</em></em>the MasterPage and the DrawPage. Both draw-page types implement the GenericDrawPage and are
    therefore able to hold and manipulate the same content.
</p>
<p>
    A master page acts as a common background for zero or more draw pages. Each draw page may link to one master page.
    Each master page is constrained as follows:
</p>
<ul>
    <li>
        A master page, unlike a regular draw page, may not link to a master page.
    </li>
    <li>
        A master page may not be removed from a document if any draw page links to it.
    </li>
    <li>
        Modifications made to a master page are immediately visible on every draw page that uses that master page.
    </li>
</ul>
<p>
    The method getMasterPages() returns the document’s collection of master pages. The method getDrawPages() returns the
    document’s collection of draw pages. Both methods return the same object type; they differ only in how their
    contents are used (see ).
</p>
<p>
    <strong>Table .</strong> Methods supported by the com.sun.star.drawing.XDrawPages interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                duplicate(DrawPage)
            </td>
            <td>
                Duplicate the DrawPage and return the new DrawPage.
            </td>
        </tr>
        <tr class="even">
            <td>
                getByIndex(Long)
            </td>
            <td>
                Get the specified draw page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getByName(String)
            </td>
            <td>
                Get the specified draw page.
            </td>
        </tr>
        <tr class="even">
            <td>
                getCount()
            </td>
            <td>
                Return the number of contained objects as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasByName(String)
            </td>
            <td>
                Return True if the named page exists.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasElements()
            </td>
            <td>
                Return True if there are draw pages to return.
            </td>
        </tr>
        <tr class="odd">
            <td>
                insertNewByIndex(Long)
            </td>
            <td>
                Create and insert a new draw page at the specified index.
            </td>
        </tr>
        <tr class="even">
            <td>
                remove(DrawPage)
            </td>
            <td>
                Remove a specific draw page.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Each draw page has a name, which you can access by using the methods getName() and setName(). A draw page that is
    not a master supports the methods getMasterPage() and setMasterPage() to get and set the master page. demonstrates
    enumerating the document’s draw pages and their corresponding master pages.
</p>
<p>
    <strong>Listing .</strong> Print information related to draw pages and master pages.
</p>
<p>
    Sub getPages()
</p>
<p>
    Dim s$
</p>
<p>
    Dim oDoc
</p>
<p>
</p>
<p>
    oDoc = LoadEmptyDocument("simpress")
</p>
<p>
    s = s &amp; getPagesInfo(oDoc.getDrawPages(), "Draw Pages")
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    s = s &amp; getPagesInfo(oDoc.getMasterPages(), "Master Pages")
</p>
<p>
    MsgBox s, 0, "Pages"
</p>
<p>
    End Sub
</p>
<p>
    Function getPagesInfo(oDPages, sType$) As String
</p>
<p>
    Dim i%, s$
</p>
<p>
    Dim oDPage, oMPage
</p>
<p>
    s = s &amp; "*** There are " &amp; oDPages.getCount() &amp; " " &amp; sType &amp; CHR$(10)
</p>
<p>
    For i = 0 To oDPages.getCount()-1
</p>
<p>
    oDPage = oDPages.getByIndex(i)
</p>
<p>
    s = s &amp; "Page " &amp; i &amp; " = '" &amp; oDPage.getName() &amp; "'"
</p>
<p>
    If NOT oDPage.supportsService("com.sun.star.drawing.MasterPage") Then
</p>
<p>
    oMPage = oDPage.getMasterPage()
</p>
<p>
    s = s &amp; " master = "
</p>
<p>
    If NOT IsNull(oMPage) AND NOT IsEmpty(oMPage) Then
</p>
<p>
    s = s &amp; "'" &amp; oMPage.getName() &amp; "'"
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    s = s &amp; CHR$(10)
</p>
<p>
    Next
</p>
<p>
    getPagesInfo = s
</p>
<p>
    End Function
</p>
<p>
    Although you can get a draw page based on its name, you can have more than one draw page with the same name. If
    multiple draw pages use the same name and you retrieve the draw page based on the name, it is not specified which
    draw page is returned. The macro in , which searches for a draw page with a specific name, is used in numerous
    places in this chapter.
</p>
<p>
    <strong>Listing .</strong> Create a new page by name, avoiding multiple names.
</p>
<p>
    Function createDrawPage(oDoc, sName$, bForceNew As boolean) As Variant
</p>
<p>
    Dim oPages 'All of the draw pages
</p>
<p>
    Dim oPage 'A single draw page
</p>
<p>
    Dim i% 'General index variable
</p>
<p>
    oPages = oDoc.getDrawPages()
</p>
<p>
    If oPages.hasByName(sName) Then
</p>
<p>
    REM If we require a new page then delete
</p>
<p>
    REM the page.
</p>
<p>
    If bForceNew Then
</p>
<p>
    oPages.remove(oPages.getByName(sName))
</p>
<p>
    Else
</p>
<p>
    REM Did not request a new page so return the found page
</p>
<p>
    REM and then get out of the function.
</p>
<p>
    createDrawPage = oPages.getByName(sName)
</p>
<p>
    Exit Function
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    REM Did not find the page, or found the page and removed it.
</p>
<p>
    REM Create a new page, set the name, and return the page.
</p>
<p>
    oPages.insertNewByIndex(oPages.getCount())
</p>
<p>
    oPage = oPages.getByIndex(oPages.getCount()-1)
</p>
<p>
    oPage.setName(sName)
</p>
<p>
    createDrawPage = oPage
</p>
<p>
    End Function
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="generic-draw-page">
                            <span id="anchor-443"></span>Generic draw page
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Both regular and master draw pages support the GenericDrawPage service. As its name implies, the GenericDrawPage
    service provides the primary generic drawing functionality. Writer and Calc documents provide specific styles for
    formatting entire pages. Draw pages, however, use the properties shown in .
</p>
<p>
    <strong>Table .</strong> Properties defined by the com.sun.star.drawing.GenericDrawPage service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BorderBottom
            </td>
            <td>
                Bottom border in 1/100 mm, represented as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                BorderLeft
            </td>
            <td>
                Left border in 1/100 mm, represented as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                BorderRight
            </td>
            <td>
                Right border in 1/100 mm, represented as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                BorderTop
            </td>
            <td>
                Top border in 1/100 mm, represented as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Height
            </td>
            <td>
                Height in 1/100 mm, represented as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsBackgroundDark
            </td>
            <td>
                This is True if the averaged background fill color’s luminance is below a specified threshold value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                NavigationOrder
            </td>
            <td>
                Provides index access in navigation order for the top level shapes inside the page. By default this is
                equal to the index access of the slide itself, making the z-order the default navigation order for top
                level shapes.
            </td>
        </tr>
        <tr class="even">
            <td>
                Number
            </td>
            <td>
                Draw page number as a Short Integer. This read-only value labels the first page 1.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Orientation
            </td>
            <td>
                Page orientation as a com.sun.star.view.PaperOrientation enumeration. Two values are
                supported<em><em>—</em></em>PORTRAIT and LANDSCAPE.
            </td>
        </tr>
        <tr class="even">
            <td>
                UserDefinedAttributes
            </td>
            <td>
                User-defined XML attributes.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Width
            </td>
            <td>
                Width in 1/100 mm, represented as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The primary purpose of a draw page is to contain shapes. The methods addShape(Shape) and removeShape(Shape) add and
    remove a shape from a document. Before a shape can be added to a draw page, it must be created by the document. Each
    line produced by<strong> </strong> and shown in is a separate, unrelated shape. You can independently manipulate
    each shapes.
</p>
<p>
    <strong>Listing .</strong> Draw 20 lines in a Draw or Impress document.
</p>
<p>
    Function draw20Lines()
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oPoint 'Initial start point of the line
</p>
<p>
    Dim oSize 'Width and height of the line
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
    Dim n% 'Number of iterations to perform
</p>
<p>
    Dim nShift%'Shift the graphic down
</p>
<p>
    Dim oDoc
</p>
<p>
</p>
<p>
    oDoc = LoadEmptyDocument("sdraw")
</p>
<p>
    draw20Lines = oDoc
</p>
<p>
    oPage = createDrawPage(oDoc, "Test Draw", True)
</p>
<p>
    nShift = oPage.Height / 4
</p>
<p>
</p>
<p>
    n = 20
</p>
<p>
    For i = 0 To n
</p>
<p>
    oShape = oDoc.createInstance("com.sun.star.drawing.LineShape")
</p>
<p>
    oShape.LineColor = RGB( 255, 0, i+20 )
</p>
<p>
    oShape.LineWidth = 20
</p>
<p>
    oPoint = oShape.Position
</p>
<p>
    oPoint.X = oPage.Width / 4
</p>
<p>
    oPoint.Y = i * oPage.Height / n / 4 + nShift
</p>
<p>
    oShape.Position = oPoint
</p>
<p>
    oSize = oShape.Size
</p>
<p>
    oSize.Height = (oPage.Height - 2 * i * oPage.Height / n) / 4
</p>
<p>
    oSize.Width = oPage.Width / 2
</p>
<p>
    oShape.Size = oSize
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    Next
</p>
<p>
    End Function
</p>
<p>
    <img src="Pictures/10000000000001AA000001164B6F6A98.png" style="width:4.4374in;height:2.8957in" />
</p>
<p>
    <strong>Figure .</strong> Twenty lines in a Draw document.
</p>
<p>
    The macro in works with Draw and Impress. The 20 red lines are drawn on a page named “Test Draw”. If the page does
    not exist, it is created.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="combining-shapes">
                            <span id="anchor-444"></span>Combining shapes
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The macro in creates 20 independent lines. You can group shapes together and then manipulate them as a single shape.
    The method group(XShapes) accepts a collection of shapes and turns them into a single group; an XShapeObject is
    returned. The macro in starts by calling and then it adds all of the lines to a single group.
</p>
<p>
    <strong>Listing .</strong> Group many shapes into a single shape.
</p>
<p>
    Sub groupShapes
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShapes 'Shapes to group
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
    Dim oDoc
</p>
<p>
</p>
<p>
    REM Create the shapes!
</p>
<p>
    oDoc = draw20Lines()
</p>
<p>
    oPage = oDoc.getDrawPages().getByName("Test Draw")
</p>
<p>
    REM Create a shape collection object to group the shapes
</p>
<p>
    oShapes = createUnoService("com.sun.star.drawing.ShapeCollection")
</p>
<p>
    For i = 0 To oPage.getCount() - 1
</p>
<p>
    oShapes.add(oPage.getByIndex(i))
</p>
<p>
    Next
</p>
<p>
    oPage.group(oShapes)
</p>
<p>
    End Sub
</p>
<p>
    When several shapes are grouped together using the group() method, the entire group is added as a single shape into
    the draw page, which you can retrieve by using oPage.getByIndex(). It’s no longer possible to select a single line
    and independently manipulate it. To convert a group of shapes back to independent shapes, use the
    ungroup(XShapeObject) method. The ungroup() method removes the objects from the group and adds them back to the draw
    page as individual objects (see ).
</p>
<p>
    <strong>Listing .</strong> Convert a grouped shape back into multiple shapes.
</p>
<p>
    Sub unGroupShapes
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Single shape
</p>
<p>
    Dim i% 'Index variable
</p>
<p>
</p>
<p>
    oPage = ThisComponent.getDrawPages().getByName("Test Draw")
</p>
<p>
    For i = 0 To oPage.getCount() - 1
</p>
<p>
    oShape = oPage.getByIndex(i)
</p>
<p>
    If oShape.supportsService("com.sun.star.drawing.GroupShape") Then
</p>
<p>
    oPage.ungroup(oShape)
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    Although shapes that are grouped together are manipulated as one shape, they are really a collection of shapes. The
    combine(XShapes) method, on the other hand, converts each shape into a PolyPolygonShape and then combines them into
    one PolyPolygonShape. The new shape is added to the draw page, and the original shapes are removed and deleted. The
    split(XShape) method converts the shape to a PolyPolygonShape (if it is not already) and then the shape is split
    into several shapes of type PolyPolygonShape. The new shapes are added to the draw page and the original shape is
    removed and deleted.
</p>
<p>
    <strong>Listing .</strong> Combine all shapes into a ShapeCollection.
</p>
<p>
    Sub combineShapes
</p>
<p>
    Dim oPage, oShapes, i%, oDoc
</p>
<p>
</p>
<p>
    REM Create the shapes!
</p>
<p>
    oDoc = draw20Lines()
</p>
<p>
    oPage = oDoc.getDrawPages().getByName("Test Draw")
</p>
<p>
    oShapes = createUnoService("com.sun.star.drawing.ShapeCollection")
</p>
<p>
    For i = 0 To oPage.getCount() - 1
</p>
<p>
    oShapes.add(oPage.getByIndex(i))
</p>
<p>
    Next
</p>
<p>
    oPage.combine(oShapes)
</p>
<p>
    End Sub
</p>
<p>
    Combining a shape does not change how the shape appears so the output of is the same as . Binding a shape, as shown
    in , however, connects the lines together with a Bezier curve.
</p>
<p>
    <strong>Listing .</strong> Bind shapes together.
</p>
<p>
    Sub bindShapes()
</p>
<p>
    Dim oPage, oShapes, i%
</p>
<p>
</p>
<p>
    REM Create the shapes!
</p>
<p>
    draw20Lines()
</p>
<p>
    oPage = ThisComponent.getDrawPages().getByName("Test Draw")
</p>
<p>
    oShapes = createUnoService("com.sun.star.drawing.ShapeCollection")
</p>
<p>
    For i = 0 To oPage.getCount()-1
</p>
<p>
    oShapes.add(oPage.getByIndex(i))
</p>
<p>
    Next
</p>
<p>
    oPage.bind(oShapes)
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001DA00000137D305EEFF.png" style="width:4.9374in;height:3.2398in" />
</p>
<p>
    <strong>Figure .</strong> Using bind connects the lines with Bezier curves.
</p>
<p>
    The unbind(XShape) method converts the shape to a PolyPolygonShape (if it is not already) and then each line segment
    is converted to a new PolyPolygonShape. The original shape is removed from the draw page and deleted. The shape
    produced by , combines 21 lines into a one shape. Using unbind on the single shape does not change what the user
    sees, but each line is now its own shape, so there are 41 shapes rather than just one; the original 21 shapes and 20
    lines connecting the original 21.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="shapes">
                    <span id="anchor-445"></span>Shapes
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Graphical content is expressed as a shape object. Shape objects are created by the document and then added to the
    draw page. To quickly find out what objects a document can create, use the TypesDocCanCreate macro in with a Draw
    document to see the objects that a Draw document can create. Filter the list a little more if you only want to see
    the shape types.
</p>
<p>
    <strong>Listing .</strong> Shape services supported by Draw.
</p>
<p>
    Sub SupportedDrawDocShapes
</p>
<p>
    Dim oDrawDoc
</p>
<p>
    ' Create a temporary draw document.
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
    ' Generate the list
</p>
<p>
    TypesDocCanCreate(oDrawDoc, "shape")
</p>
<p>
    ' Close the temporary draw document.
</p>
<p>
    oDrawDoc.Close(true)
</p>
<p>
    End Sub
</p>
<p>
    Use the same method to find shapes supported by Impress.
</p>
<p>
    <strong>Listing .</strong> Shape services supported by Impress.
</p>
<p>
    Sub SupportedImpressDocShapes
</p>
<p>
    Dim oDoc
</p>
<p>
    ' Create a temporary Impress document.
</p>
<p>
    oDoc = LoadEmptyDocument("simpress")
</p>
<p>
    ' Generate the list
</p>
<p>
    TypesDocCanCreate(oDoc, "shape")
</p>
<p>
    ' Close the temporary Impress document.
</p>
<p>
    oDoc.Close(true)
</p>
<p>
    End Sub
</p>
<p>
    The general drawing shapes are shown in . The shapes specific to a presentation document are shown in . Many of the
    shapes are either not published, or not documented. If a service or interface is not “published”, the developers
    expect the service or interface to change in the future, be removed, or to be unsuitable for public use for some
    reason.If a service is not documented, then no documentation is easily available, so it is probably not published.
    Use objects that are not documented or published at your own risk, they may change in the future. Sadly, even the
    documented shapes may not be well documented.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Tip
            </td>
            <td>
                If a service or interface is not “published”, the developers expect the service or interface to change
                in the future, be removed, or to be unsuitable for public use for some reason.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Some shape types are not created directly by the document; for example the PolyPolygonBezierShape. Sadly, these
    types are also poorly documented. Some of the types may be created indirectly. As a test, I used an Impress document
    to create an instance of CalcShape, but the returned object did not support the CalcShape service. Inserting the
    created service in the Impress document caused the shape to become an OLE2Shape service – and it still did not
    support the CalcShape service.
</p>
<p>
    <strong>Table .</strong> Draw shapes (com.sun.star.drawing).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                AppletShape
            </td>
            <td>
                Encapsulate a Java Applet.
            </td>
        </tr>
        <tr class="even">
            <td>
                CaptionShape
            </td>
            <td>
                Rectangular drawing shape with an additional set of lines. It can be used as a description for a fixed
                point inside a drawing.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ClosedBezierShape
            </td>
            <td>
                A series of Bezier shapes that are closed.
            </td>
        </tr>
        <tr class="even">
            <td>
                ClosedFreeHandShape
            </td>
            <td>
                Closed Freehand shape drawn using the GUI.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ConnectorShape
            </td>
            <td>
                Used to connect shapes or glue points.
            </td>
        </tr>
        <tr class="even">
            <td>
                ControlShape
            </td>
            <td>
                A shape that displays a control such as a button.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CustomShape
            </td>
            <td>
                Create a custom shape; but it is not published.
            </td>
        </tr>
        <tr class="even">
            <td>
                EllipseShape
            </td>
            <td>
                Draw a circle, an ellipse, or an arc.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FrameShape
            </td>
            <td>
                Undocumented, but seems to be used by other things as a frame.
            </td>
        </tr>
        <tr class="even">
            <td>
                GraphicObjectShape
            </td>
            <td>
                Display a graphic object such as a bitmap image. There are separate types for presentation documents and
                drawing documents.
            </td>
        </tr>
        <tr class="odd">
            <td>
                GroupShape
            </td>
            <td>
                Represent multiple shapes as a single shape.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineShape
            </td>
            <td>
                A single line.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MeasureShape
            </td>
            <td>
                A shape used for measuring in a diagram.
            </td>
        </tr>
        <tr class="even">
            <td>
                MediaShape
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="odd">
            <td>
                OLE2Shape
            </td>
            <td>
                Display an OLE object in a Draw document.
            </td>
        </tr>
        <tr class="even">
            <td>
                OpenBezierShape
            </td>
            <td>
                A series of Bezier lines.
            </td>
        </tr>
        <tr class="odd">
            <td>
                OpenFreeHandShape
            </td>
            <td>
                Open Freehand shape drawn using the GUI.
            </td>
        </tr>
        <tr class="even">
            <td>
                PageShape
            </td>
            <td>
                Display a preview of another page in a Draw document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PluginShape
            </td>
            <td>
                Represent a media type that is not directly supported.
            </td>
        </tr>
        <tr class="even">
            <td>
                PolyLinePathShape
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PolyLineShape
            </td>
            <td>
                A series of connected straight lines.
            </td>
        </tr>
        <tr class="even">
            <td>
                PolyPolygonBezierShape
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PolyPolygonPathShape
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="even">
            <td>
                PolyPolygonShape
            </td>
            <td>
                A series of straight lines with the first and last points connected.
            </td>
        </tr>
        <tr class="odd">
            <td>
                RectangleShape
            </td>
            <td>
                Draw rectangles.
            </td>
        </tr>
        <tr class="even">
            <td>
                Shape3DCubeObject
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Shape3DExtrudeObject
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="even">
            <td>
                Shape3DLatheObject
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Shape3DPolygonObject
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="even">
            <td>
                Shape3DSceneObject
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Shape3DSphereObject
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="even">
            <td>
                TableShape
            </td>
            <td>
                Table object in a Draw document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextShape
            </td>
            <td>
                Box designed to hold text.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table .</strong> Impress shapes (com.sun.star.presentation).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CalcShape
            </td>
            <td>
                Calc sheet in an Impress document.
            </td>
        </tr>
        <tr class="even">
            <td>
                ChartShape
            </td>
            <td>
                Chart shape in an Impress document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DateTimeShape
            </td>
            <td>
                Not published.
            </td>
        </tr>
        <tr class="even">
            <td>
                FooterShape
            </td>
            <td>
                Not published.
            </td>
        </tr>
        <tr class="odd">
            <td>
                GraphicObjectShape
            </td>
            <td>
                Display a graphic object such as a bitmap image in an Impress document.
            </td>
        </tr>
        <tr class="even">
            <td>
                HandoutShape
            </td>
            <td>
                A drawing document PageShape for handouts in an Impress document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HeaderShape
            </td>
            <td>
                Not published.
            </td>
        </tr>
        <tr class="even">
            <td>
                MediaShape
            </td>
            <td>
                Undocumented.
            </td>
        </tr>
        <tr class="odd">
            <td>
                NotesShape
            </td>
            <td>
                A TextShape for notes in an Impress document.
            </td>
        </tr>
        <tr class="even">
            <td>
                OLE2Shape
            </td>
            <td>
                Display an OLE object in an Impress document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                OrgChartShape
            </td>
            <td>
                Not documented.
            </td>
        </tr>
        <tr class="even">
            <td>
                OutlinerShape
            </td>
            <td>
                A TextShape for outlines in an Impress document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PageShape
            </td>
            <td>
                Display a preview of another page in an Impress document.
            </td>
        </tr>
        <tr class="even">
            <td>
                SlideNumberShape
            </td>
            <td>
                Not published.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SubtitleShape
            </td>
            <td>
                A TextShape for subtitles in an Impress document.
            </td>
        </tr>
        <tr class="even">
            <td>
                TableShape
            </td>
            <td>
                Table object in an Impress document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TitleTextShape
            </td>
            <td>
                A TextShape for titles in an Impress document.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="common-attributes">
                            <span id="anchor-446"></span>Common attributes
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A shape’s position is stored in a com.sun.star.awt.Point structure, which contains two Long Integer values, X and Y,
    representing the upper-left corner in 1/100 mm. A shape’s size is stored in a com.sun.star.awt.Size structure, which
    contains two Long Integer values, Width and Height, in 1/100 mm.
</p>
<p>
    <strong>Table .</strong> Methods supported by Shape objects.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getPosition()
            </td>
            <td>
                Get the shape’s current position in 1/100 mm.
            </td>
        </tr>
        <tr class="even">
            <td>
                setPosition(Point)
            </td>
            <td>
                Set the shape’s current position in 1/100 mm.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getSize()
            </td>
            <td>
                Get the shape’s current size in 1/100 mm.
            </td>
        </tr>
        <tr class="even">
            <td>
                setSize(Size)
            </td>
            <td>
                Set the shape’s current size in 1/100 mm.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getGluePoints()
            </td>
            <td>
                Get an object that provides indexed access to a set of glue points used internally by the object. Each
                glue point is a com.sun.star.drawing.GluePoint2 structure (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                getShapeType()
            </td>
            <td>
                String representing the shape’s type.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Macros that deal with shape objects frequently require the Size and Point structures. The two methods in make it
    easier to create and set these structures.
</p>
<p>
    <strong>Listing .</strong> Create and return a Point or Size structure.
</p>
<p>
    Function CreatePoint(ByVal x As Long,ByVal y As Long) As com.sun.star.awt.Point
</p>
<p>
    Dim oPoint
</p>
<p>
    oPoint = createUnoStruct( "com.sun.star.awt.Point" )
</p>
<p>
    oPoint.X = x : oPoint.Y = y
</p>
<p>
    CreatePoint = oPoint
</p>
<p>
    End Function
</p>
<p>
    Function CreateSize(ByVal x As Long,ByVal y As Long) As com.sun.star.awt.Size
</p>
<p>
    Dim oSize
</p>
<p>
    oSize = createUnoStruct( "com.sun.star.awt.Size" )
</p>
<p>
    oSize.Width = x : oSize.Height = y
</p>
<p>
    CreateSize = oSize
</p>
<p>
    End Function
</p>
<p>
    Interfaces define methods and they may be derived from other interfaces. Services, on the other hand, implement
    interfaces and other services. Services also define properties. Some services are defined strictly to define a group
    of related properties. The properties defined by the Shape service are general and applicable to most shape types
    (see).
</p>
<p>
    <strong>Table .</strong> Properties defined by the com.sun.star.drawing.Shape service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                ZOrder
            </td>
            <td>
                Long Integer representing the ZOrder of this shape. This controls the drawing order of objects,
                effectively moving an object forward or backward.
            </td>
        </tr>
        <tr class="even">
            <td>
                LayerID
            </td>
            <td>
                Short Integer identifying the layer that contains the shape.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LayerName
            </td>
            <td>
                Name of the layer that contains the shape.
            </td>
        </tr>
        <tr class="even">
            <td>
                Printable
            </td>
            <td>
                If True, the shape is included in printed output.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MoveProtect
            </td>
            <td>
                If True, the shape cannot be moved interactively by the user.
            </td>
        </tr>
        <tr class="even">
            <td>
                Name
            </td>
            <td>
                Shape name as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SizeProtect
            </td>
            <td>
                If True, the user may not change the shape’s size.
            </td>
        </tr>
        <tr class="even">
            <td>
                Style
            </td>
            <td>
                Shape’s style as a com.sun.star.style.XStyle object.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Transformation
            </td>
            <td>
                Transformation matrix of type com.sun.star.drawing.HomogenMatrix3 that can contain translation,
                rotation, shearing, and scaling.
            </td>
        </tr>
    </tbody>
</table>
<p>
    OOo defines separate services that encapsulate properties and methods specific to lines, text, shadows, shape
    rotation, and filling area. Not all shape types support all of these services. For example, it makes no sense for a
    line shape to support the properties and methods related to filling areas. The services of interest for the common
    properties:
</p>
<ul>
    <li>
        com.sun.star.drawing.Text
    </li>
    <li>
        com.sun.star.drawing.LineProperties
    </li>
    <li>
        com.sun.star.drawing.FillProperties
    </li>
    <li>
        com.sun.star.drawing.ShadowProperties
    </li>
    <li>
        com.sun.star.drawing.RotationDescriptor
    </li>
</ul>
<p>
    I used a macro to quickly determine which shapes support which common service. First, a list of services where the
    service name contains the word shape; for example, “com.sun.star.presentation.TableShape”.
</p>
<p>
    <strong>Listing .</strong> Return a filtered list of services supported by an object.
</p>
<p>
    Function GetListCanCreate(oObj, nameFilter$)
</p>
<p>
    Dim allNames ' List of all the names.
</p>
<p>
    Dim s$
</p>
<p>
    Dim i%
</p>
<p>
</p>
<p>
    s = ""
</p>
<p>
    allNames = oObj.getAvailableServiceNames()
</p>
<p>
    For i = LBound(allNames) To UBound(allNames)
</p>
<p>
    If (InStr(allNames(i), nameFilter) &gt; 0) Then
</p>
<p>
    If Len(s) &gt; 0 Then
</p>
<p>
    s = s &amp; "," &amp; allNames(i)
</p>
<p>
    Else
</p>
<p>
    s = allNames(i)
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    GetListCanCreate = Split(s, ",")
</p>
<p>
    End Function
</p>
<p>
    The following macro creates an Impress document. The impress document is asked which services it can create that
    contain the word “Shape”. Each shape is then inspected to see if it supports the categories of interest. Sadly, none
    of the categories of interest are supported by the shape until after the shape is inserted into the document. Each
    shape, therefore, is added to the Impress document, inspected to see what services it supports, and then that shape
    is disposed.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                When a shape is created, it is not fully fleshed out and available until after it has been inserted into
                a document.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing .</strong> Categorize shape types.
</p>
<p>
    Sub CategorizeShapeTypes
</p>
<p>
    Dim oSize as New com.sun.star.awt.Size
</p>
<p>
    Dim oPos as New com.sun.star.awt.Point
</p>
<p>
</p>
<p>
    Dim Categories ' Service names of interest
</p>
<p>
    Dim iRow% ' Iterate over data rows.
</p>
<p>
    DIm iName% ' Iterate over supported service names.
</p>
<p>
</p>
<p>
    Dim oShape ' Created shapes.
</p>
<p>
    Dim oPage ' Draw page where shapes are inserted.
</p>
<p>
</p>
<p>
    Dim oCalc ' Calc document to hold results.
</p>
<p>
    Dim oImpress ' Impress document on which to test.
</p>
<p>
    Dim oData ' Holds temporary Cell data.
</p>
<p>
    Dim oCellRange ' Range to hold the results in Calc.
</p>
<p>
    Dim shapeNames ' List of supported shape names.
</p>
<p>
    Dim oSheet ' Calc sheet containing results.
</p>
<p>
    Dim oRow ' One row from the oData array.
</p>
<p>
</p>
<p>
    REM Load an Impress document and a Calc document.
</p>
<p>
    oImpress = LoadEmptyDocument("simpress")
</p>
<p>
    oCalc = LoadEmptyDocument("scalc")
</p>
<p>
</p>
<p>
    REM Get the list of supported shape names.
</p>
<p>
    shapeNames = GetListCanCreate(oImpress, "shape")
</p>
<p>
    Rem Make each shape the same size and position.
</p>
<p>
    oSize.Width = 6000
</p>
<p>
    oSize.Height = 6100
</p>
<p>
    oPos.X = 6000
</p>
<p>
    oPos.Y = 5000
</p>
<p>
</p>
<p>
    REM First draw page to contain the created shapes.
</p>
<p>
    oPage = oImpress.DrawPages.getByIndex(0)
</p>
<p>
</p>
<p>
    REM Categories of inerest.
</p>
<p>
    Categories = Array("com.sun.star.drawing.Text", _
</p>
<p>
    "com.sun.star.drawing.LineProperties", _
</p>
<p>
    "com.sun.star.drawing.FillProperties", _
</p>
<p>
    "com.sun.star.drawing.ShadowProperties", _
</p>
<p>
    "com.sun.star.drawing.RotationDescriptor")
</p>
<p>
</p>
<p>
    REM Get the cell range that will hold the results.
</p>
<p>
    oSheet = oCalc.getSheets().getByIndex(0)
</p>
<p>
    oCellRange = oSheet.getCellRangeByPosition(0, 0, _
</p>
<p>
    UBound(Categories) - LBound(Categories) + 1, _
</p>
<p>
    UBound(shapeNames) - LBound(shapeNames) + 1)
</p>
<p>
</p>
<p>
    oData = oCellRange.getDataArray()
</p>
<p>
    REM Set the row title
</p>
<p>
    oRow = oData(0)
</p>
<p>
    For iRow = 1 To UBound(oRow)
</p>
<p>
    oRow(iRow) = Categories(iRow - 1)
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    REM For each shape name
</p>
<p>
    For iName = 0 To UBound(shapeNames)
</p>
<p>
    REM Get the row for this shape name
</p>
<p>
    oRow = oData(iName + 1)
</p>
<p>
    oRow(0) = shapeNames(iName)
</p>
<p>
</p>
<p>
    REM Create the shape, add it to the draw page.
</p>
<p>
    oShape = oImpress.CreateInstance(shapeNames(iName))
</p>
<p>
    oPage.Add(oShape)
</p>
<p>
    oShape.setSize(oSize)
</p>
<p>
    oShape.setPosition(oPos)
</p>
<p>
</p>
<p>
    REM Find out which services are supported by the current shape.
</p>
<p>
    For iRow = LBound(Categories) To UBound(Categories)
</p>
<p>
    If oShape.supportsService(Categories(iRow)) Then
</p>
<p>
    oRow(iRow + 1) = "X"
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    REM Get rid of the created shape.
</p>
<p>
    oShape.dispose()
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    REM Set the results in the Calc document.
</p>
<p>
    oCellRange.setDataArray(oData)
</p>
<p>
    End Sub
</p>
<p>
    The Calc document created by is not sorted, and the full service names are used. The data is summarized here in two
    tables. , The com.sun.star.drawing shapes are shown in , and the com.sun.star.presentation shapes are in .
</p>
<p>
    <strong>Table .</strong> Which Drawing shapes support which service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                AppletShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                CaptionShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                ClosedBezierShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                ClosedFreeHandShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                ConnectorShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                ControlShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                CustomShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                EllipseShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                FrameShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                GraphicObjectShape
            </td>
            <td>
                X
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                GroupShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                LineShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                MeasureShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                MediaShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                OLE2Shape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                OpenBezierShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                OpenFreeHandShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                PageShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                PluginShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                PolyLinePathShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                PolyLineShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                PolyPolygonPathShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                PolyPolygonShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                RectangleShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                Shape3DCubeObject
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                Shape3DExtrudeObject
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                Shape3DLatheObject
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                Shape3DPolygonObject
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                Shape3DSceneObject
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                Shape3DSphereObject
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                TableShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                TextShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table .</strong> Which Impress shapes support which service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CalcShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                ChartShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                DateTimeShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                FooterShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                GraphicObjectShape
            </td>
            <td>
                X
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                HandoutShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                HeaderShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                MediaShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                NotesShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                OLE2Shape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                OrgChartShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                OutlinerShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                PageShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                SlideNumberShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="odd">
            <td>
                SubtitleShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
        <tr class="even">
            <td>
                TableShape
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr class="odd">
            <td>
                TitleTextShape
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
            <td>
                X
            </td>
        </tr>
    </tbody>
</table>
<h4 id="drawing-text-service">
    <span id="anchor-447"></span>Drawing text service
</h4>
<p>
    Any shape that supports the com.sun.star.drawing.Text service has the ability to contain text. The drawing text
    service supports the standard com.sun.star.text.XText interface and a special set of drawing text properties.
    Besides character and paragraph properties, the drawing text properties service defines properties specifically
    designed for shape objects (see ).
</p>
<p>
    <strong>Table .</strong> Properties defined by the com.sun.star.drawing.TextProperties service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                IsNumbering
            </td>
            <td>
                If True, numbering is ON for the text in this shape.
            </td>
        </tr>
        <tr class="even">
            <td>
                NumberingRules
            </td>
            <td>
                Describes the numbering levels as a sequence of com.sun.star.style.NumberingRule.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextAnimationAmount
            </td>
            <td>
                Number of pixels the text is moved in each animation step.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextAnimationCount
            </td>
            <td>
                Number of times the text animation is repeated.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextAnimationDelay
            </td>
            <td>
                Delay, in thousandths of a second, between each animation step.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextAnimationDirection
            </td>
            <td>
                Enumerated value of type com.sun.star.drawing.TextAnimationDirection: LEFT, RIGHT, UP, and DOWN.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextAnimationKind
            </td>
            <td>
                Enumerated value of type com.sun.star.drawing.TextAnimationKind:
            </td>
        </tr>
        <tr class="even">
            <td>
                TextAnimationStartInside
            </td>
            <td>
                If True, the text is visible at the start of the animation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextAnimationStopInside
            </td>
            <td>
                If True, the text is visible at the end of the animation.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextAutoGrowHeight
            </td>
            <td>
                If True, the shape height changes automatically when text is added or removed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextAutoGrowWidth
            </td>
            <td>
                If True, the shape width changes automatically when text is added or removed.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextContourFrame
            </td>
            <td>
                If True, the text is aligned with the left edge of the shape.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextFitToSize
            </td>
            <td>
                Enumerated value of type com.sun.star.drawing.TextFitToSizeType:
            </td>
        </tr>
        <tr class="even">
            <td>
                TextHorizontalAdjust
            </td>
            <td>
                Enumerated value of type com.sun.star.drawing.TextHorizontalAdjust:
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextLeftDistance
            </td>
            <td>
                Distance from the left edge of the shape to the text as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextLowerDistance
            </td>
            <td>
                Distance from the lower edge of the shape to the text as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextMaximumFrameHeight
            </td>
            <td>
                Limit a shape’s height as it grows automatically as you enter text.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextMaximumFrameWidth
            </td>
            <td>
                Limit a shape’s width as it grows automatically as you enter text.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextMinimumFrameHeight
            </td>
            <td>
                Limit a shape’s minimum height as it grows automatically as you enter text.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextMinimumFrameWidth
            </td>
            <td>
                Limit a shape’s minimum width as it grows automatically as you enter text.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextRightDistance
            </td>
            <td>
                Distance from the right edge of the shape to the text as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextUpperDistance
            </td>
            <td>
                Distance from the upper edge of the shape to the text as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextVerticalAdjust
            </td>
            <td>
                Enumerated value of type com.sun.star.drawing.TextVerticalAdjust:
            </td>
        </tr>
        <tr class="even">
            <td>
                TextWritingMode
            </td>
            <td>
                Enumerated value of type com.sun.star.text.TextWritingMode:
            </td>
        </tr>
    </tbody>
</table>
<h4 id="measureshape">
    <span id="anchor-448"></span>MeasureShape
</h4>
<p>
    The default behavior of a MeasureShape (see<strong> </strong>) is to display the actual length of the shape. The
    macro in<strong> </strong> creates two measure shapes and changes the text of one of them to “Width”. To help
    illustrate setting the properties in , the TextAnimationKind property is set to SCROLL so that the text continuously
    scrolls from right to left; or at least it would if it were in an Impress document.
</p>
<p>
    <strong>Listing .</strong> Draw a MeasureShape.
</p>
<p>
    Sub drawMeasureShape()
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oStart As new com.sun.star.awt.Point
</p>
<p>
    Dim oEnd As new com.sun.star.awt.Point
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.MeasureShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
</p>
<p>
    REM The following values MUST be set AFTER the object is inserted.
</p>
<p>
    oStart.X = oPage.Width / 4 : oEnd.X = oPage.Width / 2
</p>
<p>
    oStart.Y = oPage.Height/4 : oEnd.Y = oPage.Height/4
</p>
<p>
    oShape.StartPosition = oStart
</p>
<p>
    oShape.EndPosition = oEnd
</p>
<p>
    oShape.setString("Width")
</p>
<p>
    oShape.TextAnimationKind = com.sun.star.drawing.TextAnimationKind.SCROLL
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.MeasureShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oStart.X = oPage.Width / 5 : oEnd.X = oPage.Width / 5
</p>
<p>
    oStart.Y = oPage.Height/4 : oEnd.Y = oPage.Height/2.5
</p>
<p>
    oShape.StartPosition = oStart
</p>
<p>
    oShape.EndPosition = oEnd
</p>
<p>
    End Sub
</p>
<p>
    <strong>Figure .</strong> By default, measure shapes show the actual size—you can override this.
</p>
<h4 id="drawing-line-properties">
    <span id="anchor-449"></span>Drawing line properties
</h4>
<p>
    Shapes that support the com.sun.star.drawing.LineProperties service can influence how lines are drawn. Most shapes
    support line properties because most shapes contain lines of some sort. The specific properties dealing with line
    endpoints and start points are supported only by shapes with open ends.
</p>
<p>
    <strong>Table .</strong> Properties defined by the com.sun.star.drawing.LineProperties service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                LineColor
            </td>
            <td>
                Line color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineDash
            </td>
            <td>
                Enumerated value of type com.sun.star.drawing.LineDash that defines how dashed lines are drawn.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LineEnd
            </td>
            <td>
                Line end in the form of a PolyPolygonBezierCoords.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineEndCenter
            </td>
            <td>
                If True, the line ends in the center of the polygon.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LineEndName
            </td>
            <td>
                Name of the line end point’s PolyPolygonBezierCoords.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineEndWidth
            </td>
            <td>
                Width of the line end polygon.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LineJoint
            </td>
            <td>
                Enumerated value of type com.sun.star.drawing.LineJoint:
            </td>
        </tr>
        <tr class="even">
            <td>
                LineStart
            </td>
            <td>
                Line start in the form of a PolyPolygonBezierCoords .
            </td>
        </tr>
        <tr class="odd">
            <td>
                LineStartCenter
            </td>
            <td>
                If True, the line starts from the center of the polygon.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineStartName
            </td>
            <td>
                Name of the line start point’s PolyPolygonBezierCoords.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LineStartWidth
            </td>
            <td>
                Width of the line start polygon.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineStyle
            </td>
            <td>
                Enumerated value of type com.sun.star.drawing.LineStyle: NONE (the line is hidden), SOLID, and DASH.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LineTransparence
            </td>
            <td>
                Line transparency percentage as a Short Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineWidth
            </td>
            <td>
                Line width in 1/100 mm as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<h4 id="filling-space-with-a-closedbeziershape">
    <span id="anchor-450"></span>Filling space with a ClosedBezierShape
</h4>
<p>
    Shapes that support the com.sun.star.drawing.FillProperties service are able to control how open area in the shape
    is filled. In general, if the shape is closed, it can be filled.
</p>
<p>
    <strong>Table .</strong> Properties defined by the com.sun.star.drawing.FillProperties service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                FillBackground
            </td>
            <td>
                If True, the transparent background of a hatch-filled area is drawn in the current background color.
            </td>
        </tr>
        <tr class="even">
            <td>
                FillBitmap
            </td>
            <td>
                If the FillStyle is BITMAP, this is the bitmap used.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FillBitmapLogicalSize
            </td>
            <td>
                Specifies if the size is given in percentage or as an absolute value.
            </td>
        </tr>
        <tr class="even">
            <td>
                FillBitmapMode
            </td>
            <td>
                com.sun.star.drawing.BitmapMode enum:
            </td>
        </tr>
        <tr class="odd">
            <td>
                FillBitmapName
            </td>
            <td>
                If the FillStyle is BITMAP, this is the name of the fill bitmap style used.
            </td>
        </tr>
        <tr class="even">
            <td>
                FillBitmapOffsetX
            </td>
            <td>
                The horizontal offset where the tile starts. It is given as a percentage in relation to the width of the
                bitmap.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FillBitmapOffsetY
            </td>
            <td>
                The vertical offset where the tile starts. It is given as a percentage in relation to the height of the
                bitmap.
            </td>
        </tr>
        <tr class="even">
            <td>
                FillBitmapPositionOffsetX
            </td>
            <td>
                Every second line of tiles is moved the given percentage of the width of the bitmap.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FillBitmapPositionOffsetY
            </td>
            <td>
                Every second row of tiles is moved the given percentage of the height of the bitmap.
            </td>
        </tr>
        <tr class="even">
            <td>
                FillBitmapRectanglePoint
            </td>
            <td>
                The RectanglePoint specifies the position inside the bitmap to use as the top-left position for
                rendering.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FillBitmapSizeX
            </td>
            <td>
                The width of the tile for filling.
            </td>
        </tr>
        <tr class="even">
            <td>
                FillBitmapSizeY
            </td>
            <td>
                The height of the tile for filling.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FillBitmapURL
            </td>
            <td>
                If the FillStyle is BITMAP, this is a URL to the bitmap used.
            </td>
        </tr>
        <tr class="even">
            <td>
                FillColor
            </td>
            <td>
                Color to use if the FillStyle is SOLID.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FillGradient
            </td>
            <td>
                If the FillStyle is GRADIENT, this describes the gradient used (see).
            </td>
        </tr>
        <tr class="even">
            <td>
                FillGradientName
            </td>
            <td>
                If the FillStyle is GRADIENT, this is the name of the fill gradient style used.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FillHatch
            </td>
            <td>
                If the FillStyle is HATCH, this describes the hatch used.
            </td>
        </tr>
        <tr class="even">
            <td>
                FillHatchName
            </td>
            <td>
                If the FillStyle is GRADIENT, this is the name of the fill hatch style used.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FillStyle
            </td>
            <td>
                com.sun.star.drawing.FillStyle enum:
            </td>
        </tr>
        <tr class="even">
            <td>
                FillTransparence
            </td>
            <td>
                Transparency percentage if the FillStyle is SOLID.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FillTransparenceGradient
            </td>
            <td>
                Defines the gradient with a com.sun.star.awt.Gradient structure (see).
            </td>
        </tr>
        <tr class="even">
            <td>
                FillTransparenceGradientName
            </td>
            <td>
                Name of the gradient style to use; empty is okay.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Gradients are defined as follows:
</p>
<p>
    <strong>Table .</strong> com.sun.star.awt.Gradient structure.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Style
            </td>
            <td>
                Gradient style using an com.sun.star.awt.GradientStyle enum:
            </td>
        </tr>
        <tr class="even">
            <td>
                StartColor
            </td>
            <td>
                Gradient start color.
            </td>
        </tr>
        <tr class="odd">
            <td>
                EndColor
            </td>
            <td>
                Gradient end color.
            </td>
        </tr>
        <tr class="even">
            <td>
                Angle
            </td>
            <td>
                Gradient angle in 1/10 degree.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Border
            </td>
            <td>
                Per cent of the total width where just the start color is used.
            </td>
        </tr>
        <tr class="even">
            <td>
                XOffset
            </td>
            <td>
                X-coordinate, where the gradient begins.
            </td>
        </tr>
        <tr class="odd">
            <td>
                YOffset
            </td>
            <td>
                Y-coordinate, where the gradient begins.
            </td>
        </tr>
        <tr class="even">
            <td>
                StartIntensity
            </td>
            <td>
                Intensity at the start point of the gradient.
            </td>
        </tr>
        <tr class="odd">
            <td>
                EndIntensity
            </td>
            <td>
                Intensity at the end point of the gradient.
            </td>
        </tr>
        <tr class="even">
            <td>
                StepCount
            </td>
            <td>
                Number of steps of change color.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in draws a closed Bezier shape. The fill style is set to use a gradient, which means that the darkness of
    the shape changes over the shape. The resulting figure contains narrow bands of each color or intensity. You can
    smooth the appearance of the gradient by using the FillTransparenceGradient property as mentioned in .
</p>
<p>
    <strong>Listing .</strong> Draw a ClosedBezierShape with a gradient.
</p>
<p>
    Sub DrawClosedBezierShape
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oCoords 'Coordinates of the polygon to insert
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
    oCoords = createUnoStruct("com.sun.star.drawing.PolyPolygonBezierCoords")
</p>
<p>
    REM Fill in the actual coordinates. The first and last points
</p>
<p>
    REM are normal points and the middle points are Bezier control points.
</p>
<p>
    oCoords.Coordinates = Array(_
</p>
<p>
    Array(_
</p>
<p>
    CreatePoint( 1000, 1000 ),_
</p>
<p>
    CreatePoint( 3000, 4000 ),_
</p>
<p>
    CreatePoint( 3000, 4000 ),_
</p>
<p>
    CreatePoint( 5000, 1000 )_
</p>
<p>
    )_
</p>
<p>
    )
</p>
<p>
    oCoords.Flags = Array(_
</p>
<p>
    Array(_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.NORMAL,_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.CONTROL,_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.CONTROL,_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.NORMAL _
</p>
<p>
    )_
</p>
<p>
    )
</p>
<p>
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.ClosedBezierShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.FillStyle = com.sun.star.drawing.FillStyle.GRADIENT
</p>
<p>
    oShape.PolyPolygonBezier = oCoords
</p>
<p>
    End Sub
</p>
<p>
    Sub drawRectangleWithShadow()
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(createPoint(1000, 1000))
</p>
<p>
    oShape.setSize(createSize(4000, 1000))
</p>
<p>
    oShape.setString("box 1")
</p>
<p>
    oShape.Shadow = True
</p>
<p>
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(createPoint(6000, 1000))
</p>
<p>
    oShape.setSize(createSize(4000, 1000))
</p>
<p>
    oShape.setString("box 2")
</p>
<p>
    oShape.Shadow = True
</p>
<p>
    oShape.ShadowXDistance = -150
</p>
<p>
    oShape.CornerRadius = 100
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000A200000063057BFC0F.png" style="width:1.6874in;height:1.0311in" />
</p>
<p>
    <strong>Figure .</strong> Bezier shape using a gradient fill.
</p>
<h4 id="shadows-and-a-rectangleshape">
    <span id="anchor-451"></span>Shadows and a RectangleShape
</h4>
<p>
    Shapes that support the ShadowProperties service can be drawn with a shadow. You can set the shadow location and
    color by using the properties in .
</p>
<p>
    <strong>Table .</strong> Properties defined by the com.sun.star.drawing.ShadowProperties service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Shadow
            </td>
            <td>
                If True, the shape has a shadow.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShadowColor
            </td>
            <td>
                Color of the shadow as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ShadowTransparence
            </td>
            <td>
                Shadow transparency as a percentage.
            </td>
        </tr>
        <tr class="even">
            <td>
                ShadowXDistance
            </td>
            <td>
                Horizontal distance of the left edge of the shape to the shadow.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ShadowYDistance
            </td>
            <td>
                Vertical distance of the top edge of the shape to the shadow.
            </td>
        </tr>
    </tbody>
</table>
<p>
    A common method for drawing shadows is to draw the shape at an offset location using a shadow color, and then draw
    the shape normally (see ). With this in mind, consider the properties ShadowXDistance and ShadowYDistance as the
    distance that the “shadow object” is shifted when it is drawn. The default values for ShadowXDistance and
    ShadowYDistance are positive, which shifts the shadow right and down. A negative shadow distance shifts the shadow
    left and up. The macro in draws two boxes; the first box uses a standard shadow that is shifted right and down, and
    the second box has the shadow shifted left and down (see ).
</p>
<p>
    <strong>Listing .</strong> Draw rectangles with text, rounded corners, and drop shadows.
</p>
<p>
    Sub drawRectangleWithShadow()
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(createPoint(1000, 1000))
</p>
<p>
    oShape.setSize(createSize(4000, 1000))
</p>
<p>
    oShape.setString("box 1")
</p>
<p>
    oShape.Shadow = True
</p>
<p>
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(createPoint(6000, 1000))
</p>
<p>
    oShape.setSize(createSize(4000, 1000))
</p>
<p>
    oShape.setString("box 2")
</p>
<p>
    oShape.Shadow = True
</p>
<p>
    oShape.ShadowXDistance = -150
</p>
<p>
    oShape.CornerRadius = 100
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000002100000005D27B99945.png" style="width:5.5in;height:0.9689in" />
</p>
<p>
    <strong>Figure .</strong> Notice the different shadows and that box 2 has rounded corners.
</p>
<h4 id="rotation-and-shearing">
    <span id="anchor-452"></span>Rotation and shearing
</h4>
<p>
    The com.sun.star.drawing.RotationDescriptor provides the ability to rotate and shear a shape. Shear stretches a
    shape and would, for example, change a rectangle into a parallelogram. The RotateAngle property is a Long Integer
    measured in 1/100 degrees. The shape is rotated counterclockwise around the center of the shape’s bounding box. The
    ShearAngle property is also a Long Integer measured in 1/100 degrees, but the shape is sheared clockwise around the
    center of the bounding box.
</p>
<p>
    The macro in rotates a rectangle 20 degrees counterclockwise and shears a rectangle 25 degrees clockwise. This code
    also draws a normal rectangle with no rotation or shear to help you visualize the effects (see ).
</p>
<p>
    <strong>Listing .</strong> Rotate and shear rectangles with text.
</p>
<p>
    Sub drawRotateRectangle()
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(createPoint(1000, 1000))
</p>
<p>
    oShape.setSize(createSize(4000, 1500))
</p>
<p>
    oShape.setString("box 1")
</p>
<p>
    oShape.RotateAngle = 2000 '20 degrees
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(createPoint(1000, 1000))
</p>
<p>
    oShape.setSize(createSize(4000, 1500))
</p>
<p>
    oShape.FillStyle = com.sun.star.drawing.FillStyle.NONE
</p>
<p>
    oShape.LineStyle = com.sun.star.drawing.LineStyle.DASH
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(createPoint(6000, 1000))
</p>
<p>
    oShape.setSize(createSize(4000, 1500))
</p>
<p>
    oShape.setString("box 2")
</p>
<p>
    oShape.ShearAngle = 2500 '25 degrees
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(createPoint(6000, 1000))
</p>
<p>
    oShape.setSize(createSize(4000, 1500))
</p>
<p>
    oShape.FillStyle = com.sun.star.drawing.FillStyle.NONE
</p>
<p>
    oShape.LineStyle = com.sun.star.drawing.LineStyle.DASH
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000022E000000AE053674C5.png" style="width:5.8126in;height:1.8126in" />
</p>
<p>
    <strong>Figure .</strong> The rectangles with dashed lines are the original rectangles.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="shape-types">
                            <span id="anchor-453"></span>Shape types
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo supports many different shape types, which build on each other. Most of the shape types are obvious from their
    names. For example, a LineShape is a line. I was initially confused, however, by the gratuitous use of the word
    “Poly” in shape names such as PolyLineShape and PolyPolygonShape. The prefix “Poly” comes from the Greek and it
    means “many.” So in OOo, a Polygon is a figure containing many angles, a PolyLineShape contains many line shapes,
    and a PolyPolygonShape contains many polygon shapes.
</p>
<h4 id="simple-lines">
    <span id="anchor-454"></span>Simple lines
</h4>
<p>
    The purpose of the LineShape service is to draw a simple line. A LineShape requires an initial position and a size.
    The macro in draws a line from the point (1000, 1000) to the point (1999, 1999). The endpoint of the line is set by
    setting the shape’s size.
</p>
<p>
    <strong>Listing .</strong> Draw a line.
</p>
<p>
    Sub SimpleLine
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.LineShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(CreatePoint(1000, 1000))
</p>
<p>
    oShape.setSize(CreateSize(1000, 1000))
</p>
<p>
    End Sub
</p>
<p>
    Although I have never seen it used, the LineShape service supports the service PolyPolygonDescriptor (see ). The
    implication is that internally simple lines are represented as an open polygon that contains one line. The
    PolyPolygonDescriptor is used in other services as well.
</p>
<p>
    <strong>Table .</strong> Properties in the com.sun.star.drawing.PolyPolygonDescriptor service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                PolygonKind
            </td>
            <td>
                This read-only property identifies the polygon type (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                PolyPolygon
            </td>
            <td>
                Reference points for this polygon. This is an array of arrays. Each contained array is an array of
                com.sun.star.awt.Point structures. These points are used to draw the polygon and may have been
                transformed by a rotation or other transformation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Geometry
            </td>
            <td>
                These are the PolyPolygon points with no transformations.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The PolygonKind enumeration identifies the polygon type (see ). The PolygonKind is a read-only property in the
    PolyPolygonDescriptor service (see ). In other words, you can see what the type is, but you can’t set it.
</p>
<p>
    <strong>Table .</strong> Values defined by the com.sun.star.drawing.PolygonKind enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                LINE
            </td>
            <td>
                Identifies a LineShape.
            </td>
        </tr>
        <tr class="even">
            <td>
                POLY
            </td>
            <td>
                Identifies a PolyPolygonShape.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PLIN
            </td>
            <td>
                Identifies a PolyLineShape.
            </td>
        </tr>
        <tr class="even">
            <td>
                PATHLINE
            </td>
            <td>
                Identifies an OpenBezierShape.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PATHFILL
            </td>
            <td>
                Identifies a ClosedBezierShape.
            </td>
        </tr>
        <tr class="even">
            <td>
                FREELINE
            </td>
            <td>
                Identifies an OpenFreeHandShape.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FREEFILL
            </td>
            <td>
                Identifies a ClosedFreeHandShape.
            </td>
        </tr>
        <tr class="even">
            <td>
                PATHPOLY
            </td>
            <td>
                Identifies a PolyPolygonPathShape.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PATHPLIN
            </td>
            <td>
                Identifies a PolyLinePathShape.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The PolyPolygon property in allows you to inspect the actual points used in the creation of the line. The code in
    assumes that oShape contains a LineShape object and it displays the two points in the line.
</p>
<p>
    <strong>Listing .</strong> Inspect the points used in a LineShape.
</p>
<p>
    x = oShape.PolyPolygon(0)
</p>
<p>
    MsgBox "" &amp; x(0).X &amp; " and " &amp; x(0).Y
</p>
<p>
    MsgBox "" &amp; x(1).X &amp; " and " &amp; x(1).Y
</p>
<h4 id="polylineshape">
    <span id="anchor-455"></span>PolyLineShape
</h4>
<p>
    The LineShape service defines a single line, and the PolyLineShape service defines a series of lines. A LineShape is
    defined by setting its position and size. A PolyLineShape, however, is defined by the PolyPolygonDescriptor (see ).
    Although it’s easy to create a PolyLineShape when you know how, it isn’t widely understood.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The PolyPolygon property is an array of arrays that contain points.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The lines in the PolyLineShape are defined by the PolyPolygon property, which is an array that contains one or more
    arrays of points. Each array of points is drawn as a series of connected lines, but each array is not specifically
    connected to the other. The macro in <strong> </strong>generates two arrays of points (oPoints_1 and oPoints_2) and
    then the arrays are stored in another array.
</p>
<p>
    <strong>Listing .</strong> Draw a simple PolyLineShape.
</p>
<p>
    Sub SimplePolyLineShape
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oPoints_1 'First set of points to plot
</p>
<p>
    Dim oPoints_2 'Second set of points to plot
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
</p>
<p>
    oPoints_1 = Array(_
</p>
<p>
    CreatePoint( 1000, 1000 ),_
</p>
<p>
    CreatePoint( 3000, 2000 ),_
</p>
<p>
    CreatePoint( 1000, 2000 ),_
</p>
<p>
    CreatePoint( 3000, 1000 )_
</p>
<p>
    )
</p>
<p>
    oPoints_2 = Array(_
</p>
<p>
    CreatePoint( 4000, 1200 ),_
</p>
<p>
    CreatePoint( 4000, 2000 ),_
</p>
<p>
    CreatePoint( 5000, 2000 ),_
</p>
<p>
    CreatePoint( 5000, 1200 )_
</p>
<p>
    )
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.PolyLineShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.PolyPolygon = Array(oPoints_1, oPoints_2)
</p>
<p>
    oShape.LineWidth = 50
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000F200000048EEA08A51.png" style="width:2.5209in;height:0.75in" />
</p>
<p>
    <strong>Figure .</strong> A single PolyLineShape produces two shapes that are not connected.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The shape is added to the draw page before points are assigned to the PolyPolygon property.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The PolyPolygon property is an array of arrays. You can run the macro in with only one set of points, but the single
    array of points must still reside inside a second array.
</p>
<p>
    <strong>Listing .</strong> The PolyPolygon property is an array of arrays of points.
</p>
<p>
    oShape.PolyPolygon = Array(oPoints_1)
</p>
<h4 id="polypolygonshape">
    <span id="anchor-456"></span>PolyPolygonShape
</h4>
<p>
    The PolyPolygonShape service defines a series of closed polygons that are not connected (see ). This service is
    essentially a closed-shape version of the PolyLineShape. Because it produces closed shapes, the PolyPolygonShape
    service supports fill properties.
</p>
<p>
    The macro in uses the same set of points as the macro in , but I moved things around to demonstrate different
    methods for creating an array of arrays of points. Both macros, however, create the shape and add it to the draw
    page before setting the properties.
</p>
<p>
    <strong>Listing .</strong> Draw a simply PolyPolygonShape that is filled.
</p>
<p>
    Sub SimplePolyPolygonShapeFilled
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.PolyPolygonShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.PolyPolygon = Array(_
</p>
<p>
    Array( CreatePoint( 1000, 1000 ),_
</p>
<p>
    CreatePoint( 3000, 2000 ),_
</p>
<p>
    CreatePoint( 1000, 2000 ),_
</p>
<p>
    CreatePoint( 3000, 1000 )_
</p>
<p>
    ),_
</p>
<p>
    Array( CreatePoint( 4000, 1200 ),_
</p>
<p>
    CreatePoint( 4000, 2000 ),_
</p>
<p>
    CreatePoint( 5000, 2000 ),_
</p>
<p>
    CreatePoint( 5000, 1200 )_
</p>
<p>
    )_
</p>
<p>
    )
</p>
<p>
    oShape.LineWidth = 50
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000009F0000002D4318454C.png" style="width:1.6563in;height:0.4689in" />
</p>
<p>
    <strong>Figure .</strong> The PolyPolygonShape produces a closed-shape version of the PolyLineShape.
</p>
<h4 id="rectangleshape-and-textshape">
    <span id="anchor-457"></span>RectangleShape and TextShape
</h4>
<p>
    Externally, the RectangleShape and the TextShape are virtually identical. The two shape types support the same set
    of services (except for the defining service, of course) and they can be configured to produce the same output. The
    primary difference between the two shape types is their default values while producing output. In principle,
    properties can be adjusted from default values, so that each type could produce either output. The macro in <strong>
    </strong>creates a rectangle shape and a text shape next to each other (see<strong> </strong>).
</p>
<p>
    <strong>Listing .</strong> Draw a rectangle and a text object.
</p>
<p>
    Sub SimpleRectangleShape2
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
</p>
<p>
    oShape.setPosition(createPoint(1000, 1000))
</p>
<p>
    oShape.setSize(createSize(6000, 1000))
</p>
<p>
    oShape.setString("rectangle")
</p>
<p>
    oShape.Shadow = True
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.TextShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
</p>
<p>
    oShape.setPosition(createPoint(8000, 1000))
</p>
<p>
    oShape.setSize(createSize(10000, 1000))
</p>
<p>
    oShape.setString("text")
</p>
<p>
    oShape.Shadow = True
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000014D00000036DB6ADAD1.png" style="width:3.4689in;height:0.5626in" />
</p>
<p>
    <strong>Figure .</strong> Two shapes that are drawn in the same way—but with different, nearly identical shape types
    that have different default values—produce different output.
</p>
<p>
    The RectangleShape and the TextShape types both support the CornerRadius property. The corner radius is a Long
    Integer that indicates the radius of the circle used to produce the corners. This is demonstrated in as produced by
    .
</p>
<h4 id="ellipseshape">
    <span id="anchor-458"></span>EllipseShape
</h4>
<p>
    A <span id="anchor-459"></span>mathematician would say that an ellipse is a closed curve that is formed from two
    points (called the foci) in which the sum of the distances from any point on the curve to the two points is a
    constant. If the two foci are at the same point, the ellipse is a circle. In simpler terms, an ellipse is a circle
    or a squashed circle.
</p>
<p>
    While drawing a rectangle, the position identifies the upper-left corner of the rectangle and then the size defines
    the width and height. If the same point and size is used to draw an ellipse, the ellipse will be contained inside
    the rectangle and will just barely touch the four sides of the rectangle. Mathematically, the sides of the rectangle
    are tangent to the ellipse at its principal axes, the maximum and minimum distances across the ellipse. The macro in
    starts by drawing four ellipse shapes. The final ellipse is rotated 30 degrees. The macro then draws a rectangle
    using the same position, size, and rotation as the last ellipse (see ). The final rectangle helps to illustrate the
    relationship between a rectangle and an ellipse.
</p>
<p>
    <strong>Listing .</strong> Draw ellipse shapes.
</p>
<p>
    Sub SimpleEllipseShapes
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim i% 'Loop variable.
</p>
<p>
    Dim x 'One location point.
</p>
<p>
    Dim nLocs 'Locations array.
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
    nLocs = Array(_
</p>
<p>
    Array(CreatePoint(1000, 1000), createSize(1000, 1000)),_
</p>
<p>
    Array(CreatePoint(3000, 1000), createSize(1000, 1500)),_
</p>
<p>
    Array(CreatePoint(5000, 1000), createSize(1500, 1000)),_
</p>
<p>
    Array(CreatePoint(7000, 1000), createSize(1500, 1000))_
</p>
<p>
    )
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    For i = LBound(nLocs) To UBound(nLocs)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.EllipseShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    x = nLocs(i)
</p>
<p>
    oShape.setPosition(x(0))
</p>
<p>
    oShape.setSize(x(1))
</p>
<p>
    oShape.setString(i)
</p>
<p>
    Next
</p>
<p>
    oShape.RotateAngle = 3000
</p>
<p>
    REM Now draw a rectangle the same size as the last ellipse.
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(x(0))
</p>
<p>
    oShape.setSize(x(1))
</p>
<p>
    oShape.RotateAngle = 3000
</p>
<p>
    oShape.FillStyle = com.sun.star.drawing.FillStyle.NONE
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000013200000056752BC998.png" style="width:3.1874in;height:0.8957in" />
</p>
<p>
    <strong>Figure .</strong> The size parameters determine shape; other parameters set position and orientation.
</p>
<p>
    The EllipseShape service contains a property of type CircleKind that determines whether the entire ellipse should be
    drawn, or only a portion of it (see ). In other words, you can draw an arc. The properties CircleStartAngle and
    CircleEndAngle define where the arc starts and ends. Each ellipse in uses a FULL CircleKind.
</p>
<p>
    <strong>Table .</strong> Values defined by the com.sun.star.drawing.CircleKind enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                com.sun.star.drawing.CircleKind.FULL
            </td>
            <td>
                A full ellipse.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.drawing.CircleKind.SECTION
            </td>
            <td>
                An ellipse with a cut connected by two lines.
            </td>
        </tr>
        <tr class="odd">
            <td>
                com.sun.star.drawing.CircleKind.CUT
            </td>
            <td>
                An ellipse with a cut connected by one line.
            </td>
        </tr>
        <tr class="even">
            <td>
                com.sun.star.drawing.CircleKind.ARC
            </td>
            <td>
                An ellipse with an open cut.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Warn
            </td>
            <td>
                Both AOO and LO incorrectly swapped the meaning for SECTION and CUT.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The four different circle kinds are drawn by<strong> </strong>and shown in .
</p>
<p>
    <strong>Listing .</strong> Draw Arcs.
</p>
<p>
    Sub ArcEllipseShapes
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim i%
</p>
<p>
    Dim x
</p>
<p>
    Dim nLocs
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
    nLocs = Array(_
</p>
<p>
    com.sun.star.drawing.CircleKind.FULL,_
</p>
<p>
    com.sun.star.drawing.CircleKind.SECTION,_
</p>
<p>
    com.sun.star.drawing.CircleKind.CUT,_
</p>
<p>
    com.sun.star.drawing.CircleKind.ARC,_
</p>
<p>
    )
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    For i = LBound(nLocs) To UBound(nLocs)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.EllipseShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.setPosition(CreatePoint((i+1)*2000, 1000))
</p>
<p>
    oShape.setSize(CreateSize(1000,700))
</p>
<p>
    oShape.setString(i)
</p>
<p>
    oShape.CircleStartAngle = 9000
</p>
<p>
    oShape.CircleEndAngle = 36000
</p>
<p>
    oShape.CircleKind = nLocs(i)
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001140000001F1F89ED2D.png" style="width:2.8752in;height:0.3228in" />
</p>
<p>
    <strong>Figure .</strong> Each supported CircleKind drawn in order.
</p>
<h4 id="bezier-curves">
    <span id="anchor-460"></span>Bezier curves
</h4>
<p>
    A Bezier curve is a smooth curve controlled by multiple points. Bezier curves connect the first and last points, but
    are only influenced by the other points. Mathematicians like Bezier curves because they are invariant under any
    affine mapping (any arbitrary combination of translation or rotation). Computer graphics professionals like Bezier
    curves because they are easy to manipulate and transform.
</p>
<p>
    Bezier curves are controlled by a PolyPolygonBezierDescriptor (see ), which is almost identical to the
    PolyPolygonDescriptor described in . The difference between the two descriptors is that each point in the Bezier
    curve is categorized based on how the point affects the curve.
</p>
<p>
    <strong>Table .</strong> Properties in the com.sun.star.drawing.PolyPolygonBezierDescriptor service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                PolygonKind
            </td>
            <td>
                This read-only property identifies the polygon type (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                PolyPolygonBezier
            </td>
            <td>
                Reference points for this Bezier curve. This is a PolyPolygonBezierCoords structure. The structure
                contains an array of points and an array of flags to categorize each point as to its function in the
                curve.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Geometry
            </td>
            <td>
                This is the PolyPolygonBezierCoords with no transformations.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The PolyPolygonBezier property (see ) is a PolyPolygonBezierCoords structure that contains two properties,
    Coordinates and Flags. The Coordinates property is an array of arrays of points that represent the control points
    for the Bezier curve. The Flags property is an array of arrays of PolygonFlags (see ) that identifies how the
    corresponding point affects the curve.
</p>
<p>
    <strong>Table .</strong> Values in the com.sun.star.drawing.PolygonFlags enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                NORMAL
            </td>
            <td>
                The curve travels through normal points.
            </td>
        </tr>
        <tr class="even">
            <td>
                SMOOTH
            </td>
            <td>
                The point is smooth through the point.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CONTROL
            </td>
            <td>
                Influence the curve.
            </td>
        </tr>
        <tr class="even">
            <td>
                SYMMETRIC
            </td>
            <td>
                The point is symmetric through the point.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in <strong> </strong>draws a small circle at each point in the Coordinates array. Drawing each point helps
    to visualize and understand how the different points affect the shape of a Bezier curve.
</p>
<p>
    <strong>Listing .</strong> Draw a circle at each point in an array.
</p>
<p>
    Sub DrawControlPoints(oCoords, oPage, oDoc, nWidth As Long)
</p>
<p>
    Dim oPoints 'One subarray of points
</p>
<p>
    Dim oPoint 'One point
</p>
<p>
    Dim oFlags 'One subarray of flags
</p>
<p>
    Dim oShape 'The circle to draw
</p>
<p>
    Dim nShape% 'Index into the oCoords arrays
</p>
<p>
    Dim i% 'General index variable
</p>
<p>
</p>
<p>
    For nShape = LBound(oCoords.Coordinates) To UBound (oCoords.Coordinates)
</p>
<p>
    oPoints = oCoords.Coordinates(nShape)
</p>
<p>
    oFlags = oCoords.Flags(nShape)
</p>
<p>
    For i = LBound(oPoints) To UBound(oPoints)
</p>
<p>
    oShape = oDoc.createInstance("com.sun.star.drawing.EllipseShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oPoint = oPoints(i)
</p>
<p>
    REM To center the circle, I need to set the position
</p>
<p>
    REM as half width back and half width up.
</p>
<p>
    oShape.setPosition(CreatePoint(oPoint.X-nWidth/2, oPoint.Y-nWidth/2))
</p>
<p>
    oShape.setSize(CreateSize(nWidth, nWidth)
</p>
<p>
    Next
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    draws two disconnected Bezier curves (see ). The second curve places two control points at the same location. The
    DrawControlPoints macro in is used to draw the control points along with the Bezier curve.
</p>
<p>
    <strong>Listing .</strong> Draw an Open Bezier Curve.
</p>
<p>
    Sub DrawOpenBezierCurves()
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim i%
</p>
<p>
    Dim oCoords 'Coordinates of the polygon to insert
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
    oCoords = createUnoStruct("com.sun.star.drawing.PolyPolygonBezierCoords")
</p>
<p>
    REM Fill in the actual coordinates. The first and last points
</p>
<p>
    REM are normal points and the middle points are Bezier control points.
</p>
<p>
    oCoords.Coordinates = Array(_
</p>
<p>
    Array(_
</p>
<p>
    CreatePoint( 1000, 1000 ),_
</p>
<p>
    CreatePoint( 2000, 3000 ),_
</p>
<p>
    CreatePoint( 3000, 0500 ),_
</p>
<p>
    CreatePoint( 4000, 1000 ),_
</p>
<p>
    ),_
</p>
<p>
    Array(_
</p>
<p>
    CreatePoint( 5000, 1000 ),_
</p>
<p>
    CreatePoint( 6500, 0200 ),_
</p>
<p>
    CreatePoint( 6500, 0200 ),_
</p>
<p>
    CreatePoint( 8000, 1000 ),_
</p>
<p>
    ),_
</p>
<p>
    )
</p>
<p>
    oCoords.Flags = Array(_
</p>
<p>
    Array(_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.NORMAL,_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.CONTROL,_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.CONTROL,_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.NORMAL,_
</p>
<p>
    ),_
</p>
<p>
    Array(_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.NORMAL,_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.CONTROL,_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.CONTROL,_
</p>
<p>
    com.sun.star.drawing.PolygonFlags.NORMAL,_
</p>
<p>
    )_
</p>
<p>
    )
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.OpenBezierShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.PolyPolygonBezier = oCoords
</p>
<p>
    DrawControlPoints(oCoords, oPage, oDrawDoc, 100)
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000011D0000007A88D6853F.png" style="width:2.9689in;height:1.2709in" />
</p>
<p>
    <strong>Figure .</strong> Notice how the control points influence the curve.
</p>
<p>
    Not all combinations of points and flags are valid. A complete discussion of what constitutes a valid combination of
    points and flags is beyond the scope of this book. A run-time error occurs if you use an incorrect number of points
    or an unsupported sequence of control flags.
</p>
<h4 id="connectorshape">
    <span id="anchor-461"></span>ConnectorShape
</h4>
<p>
    Use the ConnectorShape to provide a connection between two shapes. A “glue point” is a position inside a shape where
    the endpoint of a ConnectorShape can connect. Each glue point is defined by the GluePoint2 structure (see ).
</p>
<p>
    <strong>Table .</strong> Properties in the com.sun.star.drawing.GluePoint2 structure.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Position
            </td>
            <td>
                Glue-point position as a point structure.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsRelative
            </td>
            <td>
                If True, Position is given in 1/100 percent.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PositionAlignment
            </td>
            <td>
                com.sun.star.drawing.Alignment enumerated value that specifies how the point is moved if the shape is
                resized. Valid values include: TOP_LEFT, TOP, TOP_RIGHT, LEFT, CENTER, RIGHT, BOTTOM_LEFT, BOTTOM, and
                BOTTOM_RIGHT.
            </td>
        </tr>
        <tr class="even">
            <td>
                Escape
            </td>
            <td>
                com.sun.star.drawing.EscapeDirection enumerated value that specifies the escape direction for a glue
                point. Valid values include: SMART, LEFT, RIGHT, UP, DOWN, HORIZONTAL, and VERTICAL.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsUserDefined
            </td>
            <td>
                If False, this is a default glue point.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Each shape contains a default glue point at the top, right, bottom, and left of the shape. You can access a shape’s
    glue points by using the getGluePoints() method (see ). The index of the default glue points are 0 (top), 1 (right),
    2 (bottom), and 3 (left). You also can add new glue points to a shape’s default glue points (see ).
</p>
<p>
    Connector shapes contain StartPosition and EndPosition properties, which identify the connector’s start and end
    positions. The start and end positions are used only if the corresponding properties StartShape and EndShape are
    empty. If the StartShape and EndShape properties are not empty, the connector shape connects to a glue point in the
    corresponding shape. Connector shapes reference other shapes’ glue points by index using the StartGluePointIndex and
    EndGluePointIndex properties.
</p>
<p>
    <strong>Table .</strong> Properties in the com.sun.star.drawing.ConnectorShape service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                StartShape
            </td>
            <td>
                Start shape, or empty if the start point is not connected to a shape.
            </td>
        </tr>
        <tr class="even">
            <td>
                StartGluePointIndex
            </td>
            <td>
                Index of the glue point in the start shape.
            </td>
        </tr>
        <tr class="odd">
            <td>
                StartPosition
            </td>
            <td>
                Start point position in 1/100 mm. You can set the position only if the start point is not connected, but
                you can always read the point.
            </td>
        </tr>
        <tr class="even">
            <td>
                EndShape
            </td>
            <td>
                End shape, or empty if the start point is not connected to a shape.
            </td>
        </tr>
        <tr class="odd">
            <td>
                EndPosition
            </td>
            <td>
                End point position in 1/100 mm. You can set the position only if the end point is not connected, but you
                can always read the point.
            </td>
        </tr>
        <tr class="even">
            <td>
                EndGluePointIndex
            </td>
            <td>
                Index of the glue point in the end shape.
            </td>
        </tr>
        <tr class="odd">
            <td>
                EdgeLine1Delta
            </td>
            <td>
                Distance of line 1.
            </td>
        </tr>
        <tr class="even">
            <td>
                EdgeLine2Delta
            </td>
            <td>
                Distance of line 2.
            </td>
        </tr>
        <tr class="odd">
            <td>
                EdgeLine3Delta
            </td>
            <td>
                Distance of line 3.
            </td>
        </tr>
        <tr class="even">
            <td>
                EdgeKind
            </td>
            <td>
                Type of connector (see ).
            </td>
        </tr>
    </tbody>
</table>
<p>
    Four connector types are supported (see ). The connector type determines how the line is drawn between the two
    points. The STANDARD type prefers to use three lines to connect the shapes, but it will use more lines if required.
</p>
<p>
    <strong>Table .</strong> Properties in the com.sun.star.drawing.ConnectorType enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                STANDARD
            </td>
            <td>
                The ConnectorShape is drawn with three lines, with the middle line perpendicular to the other two.
            </td>
        </tr>
        <tr class="even">
            <td>
                CURVE
            </td>
            <td>
                The ConnectorShape is drawn as a curve.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LINE
            </td>
            <td>
                The ConnectorShape is drawn as one straight line.
            </td>
        </tr>
        <tr class="even">
            <td>
                LINES
            </td>
            <td>
                The ConnectorShape is drawn with three lines.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The macro in draws four rectangles and then connects the rectangles using a ConnectorShape. Although the macro
    specifies the initial glue point, the end glue point is automatically chosen by OOo. If the macro did not explicitly
    set the initial glue point, it also would be automatically chosen. When a glue point is automatically chosen, it is
    done intelligently, as you can see in .
</p>
<p>
    <strong>Listing .</strong> Illustrate four connector types.
</p>
<p>
    Sub DrawConnectorShapeNormal
</p>
<p>
    DrawConnectorShape(False, False)
</p>
<p>
    End Sub
</p>
<p>
    Sub DrawConnectorShape(doCustom As Boolean, useArrows as Boolean)
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShapes 'Shapes to insert
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim nConTypes 'Array of connection types
</p>
<p>
    Dim i%
</p>
<p>
    Dim oGlue 'Custom Glue Shape
</p>
<p>
    Dim oStyles
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
</p>
<p>
    nConTypes = Array(_
</p>
<p>
    com.sun.star.drawing.ConnectorType.STANDARD,_
</p>
<p>
    com.sun.star.drawing.ConnectorType.CURVE,_
</p>
<p>
    com.sun.star.drawing.ConnectorType.LINE,_
</p>
<p>
    com.sun.star.drawing.ConnectorType.LINES,_
</p>
<p>
    )
</p>
<p>
</p>
<p>
    oShapes = Array(_
</p>
<p>
    oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape"),_
</p>
<p>
    oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape"),_
</p>
<p>
    oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape"),_
</p>
<p>
    oDrawDoc.createInstance("com.sun.star.drawing.RectangleShape"),_
</p>
<p>
    )
</p>
<p>
</p>
<p>
    REM Create the draw page and then add the shapes before manipulating them.
</p>
<p>
    oPage = createDrawPage(oDrawDoc, "Test Draw", True)
</p>
<p>
    For i = 0 To 3
</p>
<p>
    oPage.add(oShapes(i))
</p>
<p>
    oShapes(i).setSize(createSize(1300, 1000))
</p>
<p>
    Next
</p>
<p>
</p>
<p>
    oShapes(0).setPosition(createPoint(3000, 3500))
</p>
<p>
    oShapes(1).setPosition(createPoint(6000, 3000))
</p>
<p>
    oShapes(2).setPosition(createPoint(9000, 2500))
</p>
<p>
    oShapes(3).setPosition(createPoint(6000, 4500))
</p>
<p>
    For i = 0 To 3
</p>
<p>
    oShapes(i).setString(i)
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.ConnectorShape")
</p>
<p>
    oPage.add(oShape)
</p>
<p>
    oShape.StartShape = oShapes(i)
</p>
<p>
    oShape.StartGluePointIndex = i
</p>
<p>
    oShape.EndShape = oShapes((i + 1) MOD 4)
</p>
<p>
    oShape.EdgeKind = nConTypes(i)
</p>
<p>
</p>
<p>
    If doCustom Then
</p>
<p>
    Rem Now create a glue point in the center of the shape.
</p>
<p>
    oGlue = createUnoStruct("com.sun.star.drawing.GluePoint2")
</p>
<p>
    oGlue.IsRelative = False
</p>
<p>
    oGlue.Escape = com.sun.star.drawing.EscapeDirection.SMART
</p>
<p>
    oGlue.PositionAlignment = com.sun.star.drawing.Alignment.CENTER
</p>
<p>
    oGlue.IsUserDefined = True
</p>
<p>
    oGlue.Position.X = oShapes(i).getPosition().X + 650
</p>
<p>
    oGlue.Position.Y = oShapes(i).getPosition().Y + 500
</p>
<p>
    oShape.StartGluePointIndex = oShapes(i).getGluePoints().insert(oGlue)
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    If useArrows Then
</p>
<p>
    oStyles = oDrawDoc.getStyleFamilies().getByName("graphics")
</p>
<p>
    oShape.Style = oStyles.getByName("objectwitharrow")
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000012900000088D351AE66.png" style="width:3.0937in;height:1.4165in" />
</p>
<p>
    <strong>Figure .</strong> Notice the different connector types.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Many of a shape’s properties are reset when the shape is added to a draw page. Therefore, you should set
                most properties after adding the shape to the draw page. It is also important to set properties in the
                correct order because setting some properties resets other properties. For example, setting a
                connector’s StartShape resets the StartGluePointIndex.
            </td>
        </tr>
    </tbody>
</table>
<h5 id="creating-your-own-glue-points">
    <span id="anchor-462"></span>Creating your own glue points
</h5>
<p>
    If you want to attach a connector to a shape at a location of your choosing, you must create a GluePoint2 structure
    and add it to the shape. Immediately after setting the EdgeKind property, create a glue point located at the center
    of the rectangle and then uses this point as the start point. contains a description of the GluePoint2 structure.
</p>
<p>
    <strong>Listing .</strong> Draw a connector shape from the center of the shape.
</p>
<p>
    Sub DrawConnectorShapeCenter
</p>
<p>
    DrawConnectorShape(True, False)
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000012A00000085F30E4145.png" style="width:3.1043in;height:1.3854in" />
</p>
<p>
    <strong>Figure .</strong> Custom glue points: Connectors start in the middle of the rectangles.
</p>
<h5 id="adding-arrows-by-using-styles">
    <span id="anchor-463"></span>Adding arrows by using styles
</h5>
<p>
    You can set many properties for a shape by creating a style. If you frequently use certain fill styles and shadow
    styles, create a special style so you can quickly change the objects if required. displays the style families and
    the graphics styles supported by a draw document.
</p>
<p>
    <strong>Listing .</strong> Print the supported graphics styles.
</p>
<p>
    Sub PrintGraphicsStyles
</p>
<p>
    Dim oStyles
</p>
<p>
    Dim oStyleFamilies
</p>
<p>
    Dim oDrawDoc 'Temporary draw document.
</p>
<p>
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
    oStyleFamilies = oDrawDoc.getStyleFamilies()
</p>
<p>
    MsgBox Join(oStyleFamilies.getElementNames(), CHR$(10)), 0, "Families"
</p>
<p>
    oStyles = oDrawDoc.getStyleFamilies().getByName("graphics")
</p>
<p>
    MsgBox Join(oStyles.getElementNames(), CHR$(10)), 0, "Graphics Styles"
</p>
<p>
    oDrawDoc.Close(True)
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/100000000000009E000000A185DEC2BB.png" style="width:1.6457in;height:1.6772in" /> <img
        src="Pictures/10000000000000B30000017D478723EF.png" style="width:1.8646in;height:3.9689in" />
</p>
<p>
    <strong>Figure .</strong> Graphics styles supported by Draw documents.
</p>
<p>
    You can add arrows to a shape by setting the shape’s style to “objectwitharrow”. If you don’t like the default
    values in the “objectwitharrow” style, which produces very wide lines (see ), you can create your own style and use
    that instead.
</p>
<p>
    <strong>Listing .</strong> Draw connectors with arrows.
</p>
<p>
    Sub ConnectorWithArrows
</p>
<p>
    DrawConnectorShape(False, True)
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000001280000008A22838528.png" style="width:3.0835in;height:1.4374in" />
</p>
<p>
    <strong>Figure .</strong> The default arrow style draws an arrow from the end shape to the start shape.
</p>
<h4 id="insert-a-tableshape">
    <span id="anchor-464"></span>Insert a TableShape
</h4>
<p>
    The following macro inserts a TableShape into the first draw page and sets a value into a single cell. Finally, one
    cell is set to contain a graphic as the background fill style.
</p>
<p>
    <strong>Listing .</strong> Insert a table into a Draw or Impress document.
</p>
<p>
    Sub DrawTableShape
</p>
<p>
    Dim oSize as New com.sun.star.awt.Size
</p>
<p>
    Dim oPos as New com.sun.star.awt.Point
</p>
<p>
    Dim oPage ' Draw page to contain the shape.
</p>
<p>
    Dim oTable ' Table to insert.
</p>
<p>
    Dim oCell ' A cell that will contain a value.
</p>
<p>
    Dim oDrawDoc ' Temporary draw document.
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
    ' Set a size and table position.
</p>
<p>
    oSize.Width = 6000 : oSize.Height = 6100
</p>
<p>
    oPos.X = 6000 : oPos.Y = 5000
</p>
<p>
</p>
<p>
    ' Get the first draw page
</p>
<p>
    oPage = oDrawDoc.DrawPages.getByIndex(0)
</p>
<p>
    oTable = oDrawDoc.createInstance("com.sun.star.drawing.TableShape")
</p>
<p>
    oPage.add(oTable)
</p>
<p>
</p>
<p>
    ' Set the number of rows and columns to 5
</p>
<p>
    oTable.Model.Rows.InsertByIndex(1,4)
</p>
<p>
    oTable.Model.Columns.InsertByIndex(1,4)
</p>
<p>
    oTable.setSize(oSize)
</p>
<p>
    oTable.setPosition(oPos)
</p>
<p>
</p>
<p>
    ' Get the cell in the first column and second row and set to contain the text X.
</p>
<p>
    oCell = oTable.Model.getCellByPosition(0,1)
</p>
<p>
    oCell.getText().setString("X")
</p>
<p>
</p>
<p>
    ' Get the cell in the third row and column.
</p>
<p>
    oCell = oTable.Model.getCellByPosition(2,2)
</p>
<p>
</p>
<p>
    ' Fill the cell with a bitmap of an image.
</p>
<p>
    oCell.FillStyle = com.sun.star.drawing.FillStyle.BITMAP
</p>
<p>
    oCell.FillBitmapURL = _
</p>
<p>
    "http://www.openoffice.org/images/AOO_logos/OOo_Website_v2_copy.png"
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="forms">
                    <span id="anchor-465"></span>Forms
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    When a control is inserted into a document, it is stored in a form. Forms are contained in draw pages, which
    implement the com.sun.star.form.XFormsSupplier interface. The visible portion of the control<em><em>—</em></em>what
    you see<em><em>—</em></em>is stored in a draw page and it is represented by a ControlShape. The data model for the
    control is stored in a form and it is referenced by the ControlShape. The method getForms() returns an object that
    contains the forms for the draw page (see ).
</p>
<p>
    <strong>Table .</strong> Some methods supported by the com.sun.star.form.Forms service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                createEnumeration()
            </td>
            <td>
                Create an enumeration of the forms.
            </td>
        </tr>
        <tr class="even">
            <td>
                getByIndex(Long)
            </td>
            <td>
                Get a form by index.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getByName(String)
            </td>
            <td>
                Get a form by name.
            </td>
        </tr>
        <tr class="even">
            <td>
                getCount()
            </td>
            <td>
                Get the number of forms.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasByName(String)
            </td>
            <td>
                Return True if the form with the specified name exists.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasElements()
            </td>
            <td>
                Return True if the page contains at least one form.
            </td>
        </tr>
        <tr class="odd">
            <td>
                insertByIndex(Long, Form)
            </td>
            <td>
                Insert a form by index.
            </td>
        </tr>
        <tr class="even">
            <td>
                insertByName(String, Form)
            </td>
            <td>
                Insert a form by name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeByIndex(Long)
            </td>
            <td>
                Remove a form by index.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeByName(String)
            </td>
            <td>
                Remove the named form.
            </td>
        </tr>
        <tr class="odd">
            <td>
                replaceByIndex(Long, Form)
            </td>
            <td>
                Replace a form by index.
            </td>
        </tr>
        <tr class="even">
            <td>
                replaceByName(String, Form)
            </td>
            <td>
                Replace a form by name.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The purpose of is to demonstrate how to add a form to a draw page. Forms are not interesting unless they contain a
    control, so adds a drop-down list box with some values to select. When I tested using AOO, the form was left in
    design mode, and you must exit design mode before you can test the control.
</p>
<p>
    <strong>Listing .</strong> Add a form with a control to the first draw page.
</p>
<p>
    Dim oPage 'Page on which to draw
</p>
<p>
    Dim oShape 'Shape to insert
</p>
<p>
    Dim oForm 'Individual form
</p>
<p>
    Dim oControlModel 'Model for a control
</p>
<p>
    Dim s (0 To 5) As String
</p>
<p>
    Dim oDrawDoc ' Temporary draw document.
</p>
<p>
    oDrawDoc = LoadEmptyDocument("sdraw")
</p>
<p>
</p>
<p>
    REM Data for the combo box!
</p>
<p>
    s(0) = "Zero" : s(1) = "One" : s(2) = "Two"
</p>
<p>
    s(3) = "Three" : s(4) = "Four" : s(5) = "Five"
</p>
<p>
    oPage = oDrawDoc.DrawPages.getByIndex(0)
</p>
<p>
    REM Create a shape for the control.
</p>
<p>
    oShape = oDrawDoc.createInstance("com.sun.star.drawing.ControlShape")
</p>
<p>
    oShape.Position = createPoint(3000, 4500)
</p>
<p>
    oShape.Size = createSize(2500, 800)
</p>
<p>
    REM Create a combo box model.
</p>
<p>
    oControlModel = oDrawDoc.createInstance("com.sun.star.form.component.ComboBox")
</p>
<p>
    oControlModel.Name = "NumberSelection"
</p>
<p>
    oControlModel.Text = "Zero"
</p>
<p>
    oControlModel.Dropdown = True
</p>
<p>
    oControlModel.StringItemList = s()
</p>
<p>
    REM Set the shape's control model!
</p>
<p>
    oShape.Control = oControlModel
</p>
<p>
    oForm = oDrawDoc.createInstance("com.sun.star.form.component.Form")
</p>
<p>
    oForm.Name = "NumberForm"
</p>
<p>
    oPage.Forms.insertByIndex( 0, oForm )
</p>
<p>
</p>
<p>
    REM Add the control model to the first form in the collection.
</p>
<p>
    oForm.insertByIndex( 0, oControlModel )
</p>
<p>
    oPage.add( oShape )
</p>
<p>
    End Sub
</p>
<p>
    Regular forms, as created by , group form components together. A DataForm, however, can connect to a database and
    display the results of SQL queries. An HTMLForm, on the other hand, contains controls specific to HTML pages.
</p>
<p>
    <strong>Table .</strong> Control component that can be added to forms.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CheckBox
            </td>
            <td>
                Check box control.
            </td>
        </tr>
        <tr class="even">
            <td>
                ComboBox
            </td>
            <td>
                Provides text input or selection from a list of text values.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CommandButton
            </td>
            <td>
                A clickable button.
            </td>
        </tr>
        <tr class="even">
            <td>
                CurrencyField
            </td>
            <td>
                An edit field with a currency value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DatabaseCheckBox
            </td>
            <td>
                A data-aware check box that can be bound to a database field.
            </td>
        </tr>
        <tr class="even">
            <td>
                DatabaseComboBox
            </td>
            <td>
                A data-aware combo box that can be bound to a database field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DatabaseCurrencyField
            </td>
            <td>
                A data-aware edit field with a currency value that can be bound to a database field.
            </td>
        </tr>
        <tr class="even">
            <td>
                DatabaseDateField
            </td>
            <td>
                A data-aware date field that can be bound to a database field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DatabaseFormattedField
            </td>
            <td>
                A data-aware formatted field that can be bound to a database field.
            </td>
        </tr>
        <tr class="even">
            <td>
                DatabaseImageControl
            </td>
            <td>
                A field for displaying images stored in a database.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DatabaseListBox
            </td>
            <td>
                A data-aware list box that can be bound to a database field.
            </td>
        </tr>
        <tr class="even">
            <td>
                DatabaseNumericField
            </td>
            <td>
                A data-aware numeric field that can be bound to a database field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DatabasePatternField
            </td>
            <td>
                A data-aware pattern field that can be bound to a database field.
            </td>
        </tr>
        <tr class="even">
            <td>
                DatabaseRadioButton
            </td>
            <td>
                A data-aware radio button that can be bound to a database field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DatabaseTextField
            </td>
            <td>
                A data-aware text field that can be bound to a database field.
            </td>
        </tr>
        <tr class="even">
            <td>
                DatabaseTimeField
            </td>
            <td>
                A data-aware time field that can be bound to a database field.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DateField
            </td>
            <td>
                An edit field with a date value.
            </td>
        </tr>
        <tr class="even">
            <td>
                FileControl
            </td>
            <td>
                An edit field for a file name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FixedText
            </td>
            <td>
                Display text that cannot be edited by the user.
            </td>
        </tr>
        <tr class="even">
            <td>
                FormattedField
            </td>
            <td>
                An edit field that contains formatted text.
            </td>
        </tr>
        <tr class="odd">
            <td>
                GridControl
            </td>
            <td>
                Display data in a table-like way.
            </td>
        </tr>
        <tr class="even">
            <td>
                GroupBox
            </td>
            <td>
                A control that can visually group controls.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HiddenControl
            </td>
            <td>
                A control that is hidden.
            </td>
        </tr>
        <tr class="even">
            <td>
                ImageButton
            </td>
            <td>
                A clickable button which is represented by an image.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ListBox
            </td>
            <td>
                A control with multiple values from which to choose.
            </td>
        </tr>
        <tr class="even">
            <td>
                NumericField
            </td>
            <td>
                An edit field with a numeric value.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PatternField
            </td>
            <td>
                An edit field with text that matches a pattern.
            </td>
        </tr>
        <tr class="even">
            <td>
                RadioButton
            </td>
            <td>
                A radio button.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextField
            </td>
            <td>
                A text-edit field that supports single-line and multi-line data.
            </td>
        </tr>
        <tr class="even">
            <td>
                TimeField
            </td>
            <td>
                An edit field with a time value.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="presentations">
                    <span id="anchor-466"></span>Presentations
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The Presentation service contains properties (see ) and methods that control a specific presentation. You can create
    multiple presentation objects for different types of presentations. For example, you might have one presentation
    that runs continuously at a trade show and one that requires manual intervention<em><em>—for example,</em></em> for
    a client sales visit. The document’s getPresentation() method returns a new presentation object. After setting a
    presentation’s properties as shown in , the methods start() and end() are used to start and stop a presentation. The
    method rehearseTimings() starts a presentation while displaying a running clock to help you determine the running
    time of your presentation.
</p>
<p>
    <strong>Table .</strong> Properties defined by the the com.sun.star.presentation.Presentation service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                AllowAnimations
            </td>
            <td>
                If True, animations are enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                CustomShow
            </td>
            <td>
                Name of a customized show to use for this presentation; an empty value is allowed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FirstPage
            </td>
            <td>
                Name of the first page in the presentation; an empty value is allowed.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsAlwaysOnTop
            </td>
            <td>
                If True, the presentation window is always the top window.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsAutomatic
            </td>
            <td>
                If True, page changes happen automatically.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsEndless
            </td>
            <td>
                If True, the presentation repeats endlessly.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsFullScreen
            </td>
            <td>
                If True, the presentation runs in full-screen mode.
            </td>
        </tr>
        <tr class="even">
            <td>
                IsLivePresentation
            </td>
            <td>
                If True, the presentation runs in live mode.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsMouseVisible
            </td>
            <td>
                If True, the mouse is visible during the presentation.
            </td>
        </tr>
        <tr class="even">
            <td>
                Pause
            </td>
            <td>
                Long Integer duration that the black screen is displayed after the presentation is finished.
            </td>
        </tr>
        <tr class="odd">
            <td>
                StartWithNavigator
            </td>
            <td>
                If True, the Navigator opens at the start of the presentation.
            </td>
        </tr>
        <tr class="even">
            <td>
                UsePen
            </td>
            <td>
                If True, a pen appears during the presentation so that you can draw on the screen.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong></strong>
</p>
<p>
    <strong>Listing .</strong> Start the current presentation.
</p>
<p>
    Sub SimplePresentation()
</p>
<p>
    Dim oPres
</p>
<p>
    oPres = ThisComponent.getPresentation()
</p>
<p>
    oPres.UsePen = True
</p>
<p>
    REM This will start the presentation.
</p>
<p>
    REM Be ready to press the space bar to move through the slides.
</p>
<p>
    oPres.Start()
</p>
<p>
    End Sub
</p>
<p>
    A custom presentation can show the presentation’s pages in any order. Pages can be shown multiple times or not at
    all. The getCustomPresentations() method returns a custom presentations object that contains all custom
    presentations (see ).
</p>
<p>
    <strong>Table .</strong> Some methods supported by the XCustomPresentationSupplier interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                createInstance()
            </td>
            <td>
                Create a custom presentation.
            </td>
        </tr>
        <tr class="even">
            <td>
                getByName(String)
            </td>
            <td>
                Get a custom presentation by name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getElementNames()
            </td>
            <td>
                Array of custom presentation names.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasByName(String)
            </td>
            <td>
                Return True if the custom presentation with the specified name exists.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasElements()
            </td>
            <td>
                Return True if the page contains at least one custom presentation.
            </td>
        </tr>
        <tr class="even">
            <td>
                insertByName(String, CustomPresentation)
            </td>
            <td>
                Insert a custom presentation by name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeByName(String)
            </td>
            <td>
                Remove the named custom presentation.
            </td>
        </tr>
        <tr class="even">
            <td>
                replaceByName(String, CustomPresentation)
            </td>
            <td>
                Replace a custom presentation by name.
            </td>
        </tr>
    </tbody>
</table>
<p>
    A custom presentation is a container for draw pages that supports the XNamed and XIndexedAccess interfaces. Create
    the custom presentation, add the draw pages in the order that you want them to appear, and then save the custom
    presentation. A custom presentation is displayed in exactly the same way that regular presentations are displayed,
    using a Presentation object, but the CustomShow attribute is set to reference the custom presentation.
</p>
<p>
    <strong>Listing .</strong> Creating a custom presentation.
</p>
<p>
    Sub CustomPresentation()
</p>
<p>
    Dim oPres 'Presentations, both customer and regular
</p>
<p>
    Dim oPages 'Draw pages
</p>
<p>
</p>
<p>
    oPres = ThisComponent.getCustomPresentations().createInstance()
</p>
<p>
    If NOT ThisComponent.getCustomPresentations().hasByName("custom") Then
</p>
<p>
    oPages = ThisComponent.getDrawPages()
</p>
<p>
    REM Display pages 0, 2, 1, 0
</p>
<p>
    oPres.insertByIndex(0, oPages.getByIndex(0))
</p>
<p>
    oPres.insertByIndex(1, oPages.getByIndex(2))
</p>
<p>
    oPres.insertByIndex(2, oPages.getByIndex(1))
</p>
<p>
    oPres.insertByIndex(3, oPages.getByIndex(0))
</p>
<p>
    ThisComponent.getCustomPresentations().insertByName("custom", oPres)
</p>
<p>
    End If
</p>
<p>
    REM Now, run the customer presentation.
</p>
<p>
    oPres = ThisComponent.getPresentation()
</p>
<p>
    oPres.CustomShow = "custom"
</p>
<p>
    oPres.Start()
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="presentation-draw-pages">
                            <span id="anchor-467"></span>Presentation draw pages
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Draw pages in a presentation document are slightly different from those in a drawing document. The properties in
    dictate how and when page transitions occur while showing presentations.
</p>
<p>
    <strong>Table .</strong> Properties defined by the com.sun.star.presentation.DrawPage service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Change
            </td>
            <td>
                Long Integer that specifies what causes a page change.
            </td>
        </tr>
        <tr class="even">
            <td>
                Duration
            </td>
            <td>
                Long Integer time in seconds the page is shown if the Change property is set to 1.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Effect
            </td>
            <td>
                Effect used to fade in or out (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                Layout
            </td>
            <td>
                Index of the presentation layout page if this is not zero.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Speed
            </td>
            <td>
                Speed of the fade-in effect using the com.sun.star.presentation.AnimationSpeed enumeration: SLOW,
                MEDIUM, or FAST.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Page transitions are governed by the Effect property of the presentation draw page (see ).
</p>
<p>
    <strong>Table .</strong> Values defined by the com.sun.star.presentation.FadeEffect enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                <p>
                    NONE
                </p>
                <p>
                    DISSOLVE
                </p>
                <p>
                    RANDOM
                </p>
            </td>
            <td>
                <p>
                    VERTICAL_STRIPES
                </p>
                <p>
                    VERTICAL_CHECKERBOARD
                </p>
                <p>
                    VERTICAL_LINES
                </p>
            </td>
            <td>
                <p>
                    HORIZONTAL_STRIPES
                </p>
                <p>
                    HORIZONTAL_CHECKERBOARD
                </p>
                <p>
                    HORIZONTAL_LINES
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    FADE_FROM_LEFT
                </p>
                <p>
                    FADE_FROM_TOP
                </p>
                <p>
                    FADE_FROM_RIGHT
                </p>
                <p>
                    FADE_FROM_BOTTOM
                </p>
                <p>
                    FADE_FROM_UPPERLEFT
                </p>
                <p>
                    FADE_FROM_UPPERRIGHT
                </p>
                <p>
                    FADE_FROM_LOWERLEFT
                </p>
                <p>
                    FADE_FROM_LOWERRIGHT
                </p>
            </td>
            <td>
                <p>
                    MOVE_FROM_LEFT
                </p>
                <p>
                    MOVE_FROM_TOP
                </p>
                <p>
                    MOVE_FROM_RIGHT
                </p>
                <p>
                    MOVE_FROM_BOTTOM
                </p>
                <p>
                    MOVE_FROM_UPPERLEFT
                </p>
                <p>
                    MOVE_FROM_UPPERRIGHT
                </p>
                <p>
                    MOVE_FROM_LOWERRIGHT
                </p>
                <p>
                    MOVE_FROM_LOWERLEFT
                </p>
            </td>
            <td>
                <p>
                    UNCOVER_TO_LEFT
                </p>
                <p>
                    UNCOVER_TO_UPPERLEFT
                </p>
                <p>
                    UNCOVER_TO_TOP
                </p>
                <p>
                    UNCOVER_TO_UPPERRIGHT
                </p>
                <p>
                    UNCOVER_TO_RIGHT
                </p>
                <p>
                    UNCOVER_TO_LOWERRIGHT
                </p>
                <p>
                    UNCOVER_TO_BOTTOM
                </p>
                <p>
                    UNCOVER_TO_LOWERLEFT
                </p>
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    FADE_TO_CENTER
                </p>
                <p>
                    FADE_FROM_CENTER
                </p>
                <p>
                    CLOCKWISE
                </p>
                <p>
                    COUNTERCLOCKWISE
                </p>
            </td>
            <td>
                <p>
                    ROLL_FROM_LEFT
                </p>
                <p>
                    ROLL_FROM_TOP
                </p>
                <p>
                    ROLL_FROM_RIGHT
                </p>
                <p>
                    ROLL_FROM_BOTTOM
                </p>
            </td>
            <td>
                <p>
                    CLOSE_VERTICAL
                </p>
                <p>
                    CLOSE_HORIZONTAL
                </p>
                <p>
                    OPEN_VERTICAL
                </p>
                <p>
                    OPEN_HORIZONTAL
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    STRETCH_FROM_LEFT
                </p>
                <p>
                    STRETCH_FROM_TOP
                </p>
                <p>
                    STRETCH_FROM_RIGHT
                </p>
                <p>
                    STRETCH_FROM_BOTTOM
                </p>
            </td>
            <td>
                <p>
                    WAVYLINE_FROM_LEFT
                </p>
                <p>
                    WAVYLINE_FROM_TOP
                </p>
                <p>
                    WAVYLINE_FROM_RIGHT
                </p>
                <p>
                    WAVYLINE_FROM_BOTTOM
                </p>
            </td>
            <td>
                <p>
                    SPIRALIN_LEFT
                </p>
                <p>
                    SPIRALIN_RIGHT
                </p>
                <p>
                    SPIRALOUT_LEFT
                </p>
                <p>
                    SPIRALOUT_RIGHT
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    The following macro sets the transitions on all draw pages to RANDOM.
</p>
<p>
    <strong>Listing .</strong> Set Transition Effects to RANDOM.
</p>
<p>
    Sub SetTransitionEffects()
</p>
<p>
    Dim oPages 'Draw pages
</p>
<p>
    Dim i%
</p>
<p>
</p>
<p>
    oPages = ThisComponent.getDrawPages()
</p>
<p>
    For i = 0 To oPages.getCount() - 1
</p>
<p>
    With oPages.getByIndex(i)
</p>
<p>
    .Effect = com.sun.star.presentation.FadeEffect.RANDOM
</p>
<p>
    .Change = 1
</p>
<p>
    .Duration = 2
</p>
<p>
    .Speed = com.sun.star.presentation.AnimationSpeed.FAST
</p>
<p>
    End With
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="presentation-shapes">
                            <span id="anchor-468"></span>Presentation shapes
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Shapes contained in Impress documents differ from shapes in Draw documents in that they support the
    com.sun.star.presentation.Shape service. The presentation Shape service provides properties that define special
    behavior to enhance presentations (see ).
</p>
<p>
    <strong>Table .</strong> Properties defined by the com.sun.star.presentation.Shape service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Bookmark
            </td>
            <td>
                Generic URL string used if the OnClick property requires a URL.
            </td>
        </tr>
        <tr class="even">
            <td>
                DimColor
            </td>
            <td>
                Color for dimming this shape if DimPrevious is True and DimHide is False.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DimHide
            </td>
            <td>
                If True and DimPrevious is True, the shape is hidden.
            </td>
        </tr>
        <tr class="even">
            <td>
                DimPrevious
            </td>
            <td>
                If True, the shape is dimmed after executing its animation effect.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Effect
            </td>
            <td>
                Animation effect for this shape (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                IsEmptyPresentationObject
            </td>
            <td>
                True if this is the default presentation shape and it is empty.
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsPresentationObject
            </td>
            <td>
                True if this is a presentation object.
            </td>
        </tr>
        <tr class="even">
            <td>
                OnClick
            </td>
            <td>
                Specify an action if the user clicks the shape (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                PlayFull
            </td>
            <td>
                If True, the sound of this shape is played in full.
            </td>
        </tr>
        <tr class="even">
            <td>
                PresentationOrder
            </td>
            <td>
                Long Integer representing the order in which the shapes are animated.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Sound
            </td>
            <td>
                URL string for a sound file that is played while the shape’s animation is running.
            </td>
        </tr>
        <tr class="even">
            <td>
                SoundOn
            </td>
            <td>
                If True, sound is played during the animation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Speed
            </td>
            <td>
                Speed of the fade-in effect using the com.sun.star.presentation.AnimationSpeed enumeration: SLOW,
                MEDIUM, or FAST.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextEffect
            </td>
            <td>
                Animation effect for the text inside this shape (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Verb
            </td>
            <td>
                Long Integer “ole2” verb if the ClickAction is VERB.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The animation effects supported by shapes (see ) are similar to, but more plentiful than, the animation effects
    supported by draw pages (see).
</p>
<p>
    <strong>Table .</strong> Values defined by the com.sun.star.presentation.AnimationEffect enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                <p>
                    NONE
                </p>
                <p>
                    RANDOM
                </p>
                <p>
                    PATH
                </p>
            </td>
            <td>
                <p>
                    DISSOLVE
                </p>
                <p>
                    APPEAR
                </p>
                <p>
                    HIDE
                </p>
            </td>
            <td>
                <p>
                    CLOCKWISE
                </p>
                <p>
                    COUNTERCLOCKWISE
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    MOVE_FROM_LEFT
                </p>
                <p>
                    MOVE_FROM_TOP
                </p>
                <p>
                    MOVE_FROM_RIGHT
                </p>
                <p>
                    MOVE_FROM_BOTTOM
                </p>
                <p>
                    MOVE_FROM_UPPERLEFT
                </p>
                <p>
                    MOVE_FROM_UPPERRIGHT
                </p>
                <p>
                    MOVE_FROM_LOWERRIGHT
                </p>
                <p>
                    MOVE_FROM_LOWERLEFT
                </p>
            </td>
            <td>
                <p>
                    MOVE_TO_LEFT
                </p>
                <p>
                    MOVE_TO_TOP
                </p>
                <p>
                    MOVE_TO_RIGHT
                </p>
                <p>
                    MOVE_TO_BOTTOM
                </p>
                <p>
                    MOVE_TO_UPPERLEFT
                </p>
                <p>
                    MOVE_TO_UPPERRIGHT
                </p>
                <p>
                    MOVE_TO_LOWERRIGHT
                </p>
                <p>
                    MOVE_TO_LOWERLEFT
                </p>
            </td>
            <td>
                <p>
                    MOVE_SHORT_TO_LEFT
                </p>
                <p>
                    MOVE_SHORT_TO_TOP
                </p>
                <p>
                    MOVE_SHORT_TO_RIGHT
                </p>
                <p>
                    MOVE_SHORT_TO_BOTTOM
                </p>
                <p>
                    MOVE_SHORT_TO_UPPERLEFT
                </p>
                <p>
                    MOVE_SHORT_TO_UPPERRIGHT
                </p>
                <p>
                    MOVE_SHORT_TO_LOWERRIGHT
                </p>
                <p>
                    MOVE_SHORT_TO_LOWERLEFT
                </p>
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    MOVE_SHORT_FROM_LEFT
                </p>
                <p>
                    MOVE_SHORT_FROM_TOP
                </p>
                <p>
                    MOVE_SHORT_FROM_RIGHT
                </p>
                <p>
                    MOVE_SHORT_FROM_BOTTOM
                </p>
                <p>
                    MOVE_SHORT_FROM_UPPERLEFT
                </p>
                <p>
                    MOVE_SHORT_FROM_UPPERRIGHT
                </p>
                <p>
                    MOVE_SHORT_FROM_LOWERRIGHT
                </p>
                <p>
                    MOVE_SHORT_FROM_LOWERLEFT
                </p>
            </td>
            <td>
                <p>
                    LASER_FROM_LEFT
                </p>
                <p>
                    LASER_FROM_TOP
                </p>
                <p>
                    LASER_FROM_RIGHT
                </p>
                <p>
                    LASER_FROM_BOTTOM
                </p>
                <p>
                    LASER_FROM_UPPERLEFT
                </p>
                <p>
                    LASER_FROM_UPPERRIGHT
                </p>
                <p>
                    LASER_FROM_LOWERLEFT
                </p>
                <p>
                    LASER_FROM_LOWERRIGHT
                </p>
            </td>
            <td>
                <p>
                    STRETCH_FROM_LEFT
                </p>
                <p>
                    STRETCH_FROM_UPPERLEFT
                </p>
                <p>
                    STRETCH_FROM_TOP
                </p>
                <p>
                    STRETCH_FROM_UPPERRIGHT
                </p>
                <p>
                    STRETCH_FROM_RIGHT
                </p>
                <p>
                    STRETCH_FROM_LOWERRIGHT
                </p>
                <p>
                    STRETCH_FROM_BOTTOM
                </p>
                <p>
                    STRETCH_FROM_LOWERLEFT
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    ZOOM_IN_FROM_LEFT
                </p>
                <p>
                    ZOOM_IN_FROM_TOP
                </p>
                <p>
                    ZOOM_IN_FROM_RIGHT
                </p>
                <p>
                    ZOOM_IN_FROM_BOTTOM
                </p>
                <p>
                    ZOOM_IN_FROM_CENTER
                </p>
                <p>
                    ZOOM_IN_FROM_UPPERLEFT
                </p>
                <p>
                    ZOOM_IN_FROM_UPPERRIGHT
                </p>
                <p>
                    ZOOM_IN_FROM_LOWERRIGHT
                </p>
                <p>
                    ZOOM_IN_FROM_LOWERLEFT
                </p>
            </td>
            <td>
                <p>
                    ZOOM_OUT_FROM_LEFT
                </p>
                <p>
                    ZOOM_OUT_FROM_TOP
                </p>
                <p>
                    ZOOM_OUT_FROM_RIGHT
                </p>
                <p>
                    ZOOM_OUT_FROM_BOTTOM
                </p>
                <p>
                    ZOOM_OUT_FROM_CENTER
                </p>
                <p>
                    ZOOM_OUT_FROM_UPPERLEFT
                </p>
                <p>
                    ZOOM_OUT_FROM_UPPERRIGHT
                </p>
                <p>
                    ZOOM_OUT_FROM_LOWERRIGHT
                </p>
                <p>
                    ZOOM_OUT_FROM_LOWERLEFT
                </p>
            </td>
            <td>
                <p>
                    FADE_FROM_LEFT
                </p>
                <p>
                    FADE_FROM_TOP
                </p>
                <p>
                    FADE_FROM_RIGHT
                </p>
                <p>
                    FADE_FROM_BOTTOM
                </p>
                <p>
                    FADE_FROM_CENTER
                </p>
                <p>
                    FADE_FROM_UPPERLEFT
                </p>
                <p>
                    FADE_FROM_UPPERRIGHT
                </p>
                <p>
                    FADE_FROM_LOWERLEFT
                </p>
                <p>
                    FADE_FROM_LOWERRIGHT
                </p>
                <p>
                    FADE_TO_CENTER
                </p>
            </td>
        </tr>
        <tr class="odd">
            <td>
                <p>
                    ZOOM_IN
                </p>
                <p>
                    ZOOM_IN_SMALL
                </p>
                <p>
                    ZOOM_IN_SPIRAL
                </p>
                <p>
                    ZOOM_OUT
                </p>
                <p>
                    ZOOM_OUT_SMALL
                </p>
                <p>
                    ZOOM_OUT_SPIRAL
                </p>
            </td>
            <td>
                <p>
                    VERTICAL_CHECKERBOARD
                </p>
                <p>
                    HORIZONTAL_CHECKERBOARD
                </p>
                <p>
                    HORIZONTAL_ROTATE
                </p>
                <p>
                    VERTICAL_ROTATE
                </p>
                <p>
                    HORIZONTAL_STRETCH
                </p>
                <p>
                    VERTICAL_STRETCH
                </p>
            </td>
            <td>
                <p>
                    VERTICAL_STRIPES
                </p>
                <p>
                    HORIZONTAL_STRIPES
                </p>
                <p>
                    VERTICAL_LINES
                </p>
                <p>
                    HORIZONTAL_LINES
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                <p>
                    WAVYLINE_FROM_LEFT
                </p>
                <p>
                    WAVYLINE_FROM_TOP
                </p>
                <p>
                    WAVYLINE_FROM_RIGHT
                </p>
                <p>
                    WAVYLINE_FROM_BOTTOM
                </p>
            </td>
            <td>
                <p>
                    SPIRALIN_LEFT
                </p>
                <p>
                    SPIRALIN_RIGHT
                </p>
                <p>
                    SPIRALOUT_LEFT
                </p>
                <p>
                    SPIRALOUT_RIGHT
                </p>
            </td>
            <td>
                <p>
                    CLOSE_VERTICAL
                </p>
                <p>
                    CLOSE_HORIZONTAL
                </p>
                <p>
                    OPEN_VERTICAL
                </p>
                <p>
                    OPEN_HORIZONTAL
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    Shapes contained in presentation documents support special actions by setting the shape’s OnClick property.
</p>
<p>
    <strong>Table .</strong> Values defined by the com.sun.star.presentation.ClickAction enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                NONE
            </td>
            <td>
                No action is performed.
            </td>
        </tr>
        <tr class="even">
            <td>
                PREVPAGE
            </td>
            <td>
                Jump to the previous page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                NEXTPAGE
            </td>
            <td>
                Jump to the next page.
            </td>
        </tr>
        <tr class="even">
            <td>
                FIRSTPAGE
            </td>
            <td>
                Jump to the first page.
            </td>
        </tr>
        <tr class="odd">
            <td>
                LASTPAGE
            </td>
            <td>
                Jump to the last page.
            </td>
        </tr>
        <tr class="even">
            <td>
                BOOKMARK
            </td>
            <td>
                Jump to a bookmark specified by the Bookmark property in .
            </td>
        </tr>
        <tr class="odd">
            <td>
                DOCUMENT
            </td>
            <td>
                Jump to another document specified by the Bookmark property in .
            </td>
        </tr>
        <tr class="even">
            <td>
                INVISIBLE
            </td>
            <td>
                The object becomes invisible.
            </td>
        </tr>
        <tr class="odd">
            <td>
                SOUND
            </td>
            <td>
                Play a sound specified by the Bookmark property in .
            </td>
        </tr>
        <tr class="even">
            <td>
                VERB
            </td>
            <td>
                An OLE verb is performed as specified by the Verb property in . An OLE object supports actions called
                verbs. An OLE object that displays a video clip might support the verb “play,” for example.
            </td>
        </tr>
        <tr class="odd">
            <td>
                VANISH
            </td>
            <td>
                The object vanishes.
            </td>
        </tr>
        <tr class="even">
            <td>
                PROGRAM
            </td>
            <td>
                Execute another program specified by the Bookmark property in .
            </td>
        </tr>
        <tr class="odd">
            <td>
                MACRO
            </td>
            <td>
                Execute a Star Basic macro specified by the Bookmark property in .
            </td>
        </tr>
        <tr class="even">
            <td>
                STOPPRESENTATION
            </td>
            <td>
                Stop the presentation.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-14">
                    <span id="anchor-469"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Impress and Draw documents contain numerous features supporting drawing and graphics in documents. Both types of
    documents have many drawing and graphical presentation features in common, and Impress documents facilitate the
    construction of graphic presentations with support for manual or automatic page presentation. Although these
    documents support the display of bit-mapped images, their strength is vector drawings rather than photographic
    images. The results possible with Impress and Draw documents range from simple to quite complex. Consider this
    chapter as only a starting point for your explorations on the capabilities of these two document types.
</p>
<ol type="1">
    <li>
        <h1 id="library-management">
            <span id="anchor-470"></span>Library Management
        </h1>
    </li>
</ol>
<p>
    This chapter discusses how and where macro libraries are stored, along with methods you can use to manipulate them.
    This chapter also covers the subtleties of the macro organizer as well as using the UNO API to manipulate libraries
    and modules.
</p>
<p>
    This chapter assumes a basic understanding of library containers, libraries, and modules. If the following summary
    is not familiar, review the material presented in Chapter <a href="#anchor-5">2</a>, “<a href="#anchor-5">Getting
        Started</a>.”
</p>
<ul>
    <li>
        A library container contains zero or more libraries.
    </li>
    <li>
        Each library contains zero or more modules and dialogs.
    </li>
    <li>
        Each module contains zero or more macros.
    </li>
    <li>
        The application is a library container. Libraries stored in the application are globally available to all
        macros.
    </li>
    <li>
        Every document is a library container.
    </li>
    <li>
        The library named Standard is special; it always exists and cannot be overwritten. I recommend against using the
        Standard library.
    </li>
    <li>
        Always give meaningful names to the libraries and modules that you create. For example, Library1 and Module4 are
        not meaningful names, although AXONInvoiceForm1 might be more descriptive and helpful.
    </li>
</ul>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="accessing-libraries-using-ooo-basic">
                    <span id="anchor-471"></span>Accessing libraries using OOo Basic
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    I packaged some of the macros that I use into an application-level library with the name “Pitonyak.” The next day, I
    started OpenOffice.org, and to my surprise, I was not able to use any macros in my new library. It turns out that
    libraries must be loaded before they are available.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                A library must be loaded before it is available.
            </td>
        </tr>
    </tbody>
</table>
<p>
    To manually load a library, open the Macro Organizer dialog (Tools | Macros | Macro) and double-click the library
    that you want to load. You can also access libraries by using a macro. OOo Basic provides the variable GlobalScope
    to manipulate application-level libraries (see).
</p>
<p>
    <strong>Listing . </strong>Use GlobalScope to load application-level libraries.
</p>
<p>
    GlobalScope.BasicLibraries.loadLibrary("Pitonyak")
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The GlobalScope variable does not support the “dbg” properties. In other words, you cannot inspect the
                GlobalScope variable.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Libraries contain two things<em><em>—</em></em>dialogs and macros. The GlobalScope variable has two
    properties<em><em>—</em></em>BasicLibraries and DialogLibraries<em><em>—</em></em>that provide access to the Basic
    and dialog library containers in the application library container. The BasicLibraries and DialogLibraries
    properties both support the same set of interfaces for accessing the contained library containers (see ).
</p>
<p>
    <strong>Table . </strong>Methods supported by library container objects.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                createLibrary(Name)
            </td>
            <td>
                Create a new library with the given name.
            </td>
        </tr>
        <tr class="even">
            <td>
                createLibraryLink(Name, Url, ReadOnly)
            </td>
            <td>
                Create a link to an “external” library. The Name and URL are both strings.<br /> If the ReadOnly flag is
                True, the library cannot be modified.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeLibrary(Name)
            </td>
            <td>
                Remove the named library. If the library is a link, only the link is removed, not the actual library.
            </td>
        </tr>
        <tr class="even">
            <td>
                isLibraryLoaded(Name)
            </td>
            <td>
                True if the library is loaded, False otherwise.
            </td>
        </tr>
        <tr class="odd">
            <td>
                loadLibrary(Name)
            </td>
            <td>
                Load a library if it is not already loaded.
            </td>
        </tr>
        <tr class="even">
            <td>
                isLibraryLink(Name)
            </td>
            <td>
                True if the library is a link to another library.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getLibraryLinkURL(Name)
            </td>
            <td>
                Return the URL of a linked library. An error occurs if the library is not a link.
            </td>
        </tr>
        <tr class="even">
            <td>
                isLibraryReadOnly(Name)
            </td>
            <td>
                Return True if the library is read-only.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setLibraryReadOnly(Name, ReadOnly)
            </td>
            <td>
                Set the named library to read-only if ReadOnly is True.
            </td>
        </tr>
        <tr class="even">
            <td>
                renameLibrary(Name, NewName)
            </td>
            <td>
                Rename a library. If the library is linked, only the link is renamed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                changeLibraryPassword(Name, Pass, NewPass)
            </td>
            <td>
                Change a library’s password.
            </td>
        </tr>
        <tr class="even">
            <td>
                getByName(Name)
            </td>
            <td>
                Get the named library.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getElementNames()
            </td>
            <td>
                Get an array of library names.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasByName(Name)
            </td>
            <td>
                True, if the named library exists.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasElements()
            </td>
            <td>
                True, if at least one library exists.
            </td>
        </tr>
        <tr class="even">
            <td>
                isLibraryPasswordProtected(Name)
            </td>
            <td>
                True, if the library is password protected.
            </td>
        </tr>
        <tr class="odd">
            <td>
                isLibraryPasswordVerified(Name)
            </td>
            <td>
                True, if the password has already been used to unlock a library.
            </td>
        </tr>
        <tr class="even">
            <td>
                verifyLibraryPassword(Name, Pass)
            </td>
            <td>
                Unlock a password-protected library.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The GlobalScope variable is not available outside of OOo Basic. It is, however, possible to create and
                use the undocumented UNO service com.sun.star.script.ApplicationScriptLibraryContainer to access the
                global Basic libraries.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The contained libraries are stored as XML strings inside named containers. contains the methods supported by library
    objects.
</p>
<p>
    <strong>Table . </strong>Methods supported by library objects.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getByName(Name)
            </td>
            <td>
                Get the named module as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                getElementNames()
            </td>
            <td>
                Get an array of module names.
            </td>
        </tr>
        <tr class="odd">
            <td>
                hasByName(Name)
            </td>
            <td>
                True, if the library contains the named module.
            </td>
        </tr>
        <tr class="even">
            <td>
                hasElements()
            </td>
            <td>
                True, if the library contains at least one module.
            </td>
        </tr>
        <tr class="odd">
            <td>
                insertByName(Name, Module)
            </td>
            <td>
                Insert the named module into the library.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeByName(Name)
            </td>
            <td>
                Remove the named module.
            </td>
        </tr>
        <tr class="odd">
            <td>
                replaceByName(Name, Module)
            </td>
            <td>
                Replace the named module.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When you use the macro organizer to create a library, it automatically creates both a dialog library and a Basic
    library. The newly created Basic library contains the module named “Module1,” which contains an empty subroutine
    named “Main.” The following steps illustrate the process:
</p>
<ol type="1">
    <li>
        Open the Macro dialog using Tools | Macros | Organize Macros | OpenOffice.org Basic.
    </li>
    <li>
        Click the Organizer button to open the <em>Basic Macro Organizer</em> dialog. The organizer dialog can also be
        opened using Tools | Macros | Organize Dialogs.
    </li>
    <li>
        Click the <em>Libraries</em> tab.
    </li>
    <li>
        Click the New button and give the library the name “TestLib” (see ).
    </li>
    <li>
        Click OK to close the <em>New Library</em> dialog.
    </li>
    <li>
        Click the Close button on the <em>Basic Macro Organizer</em> dialog.
    </li>
    <li>
        Click the Close button on the <em>Basic Macros</em> dialog.
    </li>
</ol>
<p>
    <img src="Pictures/100000000000025B000001A66CAF5044.png" style="width:6.2811in;height:4.3957in" />
</p>
<p>
    <strong>Figure . </strong>Creating a new library in the application library container.
</p>
<p>
    To see the contents of the TestLib library, enter and run the macro in . As seen in , TestLib contains a Module1
    with a single subroutine.
</p>
<p>
    <strong>Listing . </strong>Print Module1 in the newly created TestLib library.
</p>
<p>
    Sub PrintTestLib
</p>
<p>
    If GlobalScope.BasicLibraries.hasByName("TestLib") Then
</p>
<p>
    Dim oLib
</p>
<p>
    oLib = GlobalScope.BasicLibraries.getByName("TestLib")
</p>
<p>
    MsgBox oLib.getByName("Module1"), 0, "Module1 in TestLib"
</p>
<p>
    Else
</p>
<p>
    MsgBox "Library 'TestLib' does not exist"
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000002EE000001FAD1B35CDA.gif" style="width:1.8071in;height:1.2138in" />
</p>
<p>
    <strong>Figure . </strong>Module1 is automatically created by the dialog organizer.
</p>
<p>
    You can use the code in to verify that both a Basic and a dialog library exist. Although the dialog library exists,
    it does not contain any dialogs. If the TestLib library does not exist, the returned library is null.
</p>
<p>
    <strong>Listing . </strong>Obtain the Basic and the dialog library.
</p>
<p>
    oLib = GlobalScope.BasicLibraries.getByName("TestLib")
</p>
<p>
    oLib = GlobalScope.DialogLibraries.getByName("TestLib")
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Libraries created using the methods in do not automatically create both a dialog and a macro library.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Libraries created using the UNO API in cause only one library to be created. The macro in <strong> </strong>creates
    a dialog library and a corresponding Basic library, adds Module1 to the code library, and adds a subroutine to
    Module1. See .
</p>
<p>
    <strong>Listing . </strong>Create A Global Library.
</p>
<p>
    Sub CreateAGlobalLib
</p>
<p>
    Dim oLib
</p>
<p>
    Dim s$
</p>
<p>
    If GlobalScope.BasicLibraries.hasByName("TestLib") Then
</p>
<p>
    GlobalScope.BasicLibraries.removeLibrary("TestLib")
</p>
<p>
    GlobalScope.DialogLibraries.removeLibrary("TestLib")
</p>
<p>
    MsgBox "Deleted TestLib"
</p>
<p>
    Else
</p>
<p>
    GlobalScope.BasicLibraries.createLibrary("TestLib")
</p>
<p>
    GlobalScope.DialogLibraries.createLibrary("TestLib")
</p>
<p>
    oLib = GlobalScope.BasicLibraries.getByName("TestLib")
</p>
<p>
    s = "Sub Main" &amp; CHR$(10) &amp;_
</p>
<p>
    " x = x + 1" &amp; CHR$(10) &amp;_
</p>
<p>
    "End Sub"
</p>
<p>
    oLib.insertByName("Module1", s)
</p>
<p>
    s = "=== Basic Libs ===" &amp; CHR$(10)
</p>
<p>
    oLib = GlobalScope.BasicLibraries.getByName("TestLib")
</p>
<p>
    s = s &amp; Join(oLib.getElementNames(), CHR$(10))
</p>
<p>
    oLib = GlobalScope.DialogLibraries.getByName("TestLib")
</p>
<p>
    s = s &amp; CHR$(10) &amp; CHR$(10) &amp; "=== Dialog Libs ===" &amp; CHR$(10)
</p>
<p>
    s = s &amp; Join(oLib.getElementNames(), CHR$(10))
</p>
<p>
    MsgBox s, 0, "Modules in the TestLib Library"
</p>
<p>
    oLib = GlobalScope.BasicLibraries.getByName("TestLib")
</p>
<p>
    MsgBox oLib.getByName("Module1"), 0, "Module1 in TestLib"
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/10000000000000F900000086DFD95FA6.gif" style="width:2.5929in;height:1.3953in" />
</p>
<p>
    <strong>Figure . </strong>Although the dialog library exists, it contains no dialogs.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="libraries-contained-in-a-document">
                    <span id="anchor-472"></span>Libraries contained in a document
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    OOo Basic defines the variables BasicLibraries and DialogLibraries to access libraries contained in a document. The
    behavior is the same as their GlobalScope counterparts except that they access the library container for the current
    document. Modify by removing all references to GlobalScope, and the macro acts on the current document.
</p>
<p>
    Although the BasicLibraries and DialogLibraries variables provided by OOo Basic provide an excellent method of
    accessing dialogs and libraries contained in a document, you may find code that uses the deprecated method
    getLibraryContainer(). Each document supports the method getLibraryContainer(). The returned object supports the
    method getModuleContainer(), which returns the contained Basic modules, and the method getDialogContainer(), which
    in my testing always returns a null object. shows how to obtain a module using old and new methods.
</p>
<p>
    <strong>Table . </strong>Obtain the module aMod from the library TestLib contained in a document.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                <p>
                    oLibs = BasicLibraries
                </p>
                <p>
                    If oLibs.hasByName("TestLib") Then
                </p>
                <p>
                    oLib = oLibs.getByName("TestLib")
                </p>
                <p>
                    If oLib.hasByName("AMod") Then
                </p>
                <p>
                    oMod = oLib.getByName("AMod")
                </p>
                <p>
                    End If
                </p>
                <p>
                    End If
                </p>
            </td>
            <td>
                <p>
                    oLibs = oDoc.getLibraryContainer()
                </p>
                <p>
                    If oLibs.hasByName("TestLib") Then
                </p>
                <p>
                    oLib = oLibs.getByName("TestLib")
                </p>
                <p>
                    oMods = oLib.getModuleContainer()
                </p>
                <p>
                    If NOT IsNull(oMods) Then
                </p>
                <p>
                    If oMods.hasByName("AMod") Then
                </p>
                <p>
                    oMod = oMods.getByName("AMod")
                </p>
                <p>
                    End If
                </p>
                <p>
                    End If
                </p>
                <p>
                    End If
                </p>
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The BasicLibraries and DialogLibraries variables are only available if the currently running subroutine
                is contained in the document. Unfortunately, this leaves no way to obtain a dialog from a document
                except from code contained in the document. Write a dialog creation function that is contained in the
                document containing the dialog in question.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="writing-an-installer">
                    <span id="anchor-473"></span>Writing an installer
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    I make no attempt at writing a full-fledged installer, but I do provide some clues here as to how to do it. The
    macro in copies a single library, whose name may be changed when it is copied. The process is simple and
    straightforward. The modules in the source library are copied one at a time into the destination library. The final
    argument determines if the destination library is cleared before the copy begins. If the destination library is not
    cleared first and it contains modules that do not exist in the source library, those modules will still exist in the
    destination library after the library is copied.
</p>
<p>
    <strong>Listing . </strong>Copy a library.
</p>
<p>
    REM sSrcLib is the name of the source library contained in oSrcLibs
</p>
<p>
    REM sDestLib is the name of the destination library contained in oDestLibs
</p>
<p>
    REM oSrcLibs is the source library container
</p>
<p>
    REM oDestLibs is the destination library container
</p>
<p>
    REM if bClearDest is True, then the destination library is cleared
</p>
<p>
    Sub AddOneLib(sSrcLib$, sDestLib$, oSrcLibs, oDestLibs, bClearDest As Boolean)
</p>
<p>
    Dim oSrcLib 'The source library to copy
</p>
<p>
    Dim oDestLib 'The destination library to receive the modules in oSrcLib
</p>
<p>
    Dim sNames
</p>
<p>
    Dim i%
</p>
<p>
</p>
<p>
    REM If there is no destination library then simply return
</p>
<p>
    If IsNull(oDestLibs) OR IsEmpty(oDestLibs) Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    REM Clear the destination library if requested
</p>
<p>
    If bClearDest AND oDestLibs.hasByName(sDestLib) Then
</p>
<p>
    oDestLibs.removeLibrary(sDestLib)
</p>
<p>
    End If
</p>
<p>
    REM If there is no source library, then there is nothing else to do
</p>
<p>
    If IsNull(oSrcLibs) OR IsEmpty(oSrcLibs) Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    REM If the source library does not exist, then there is nothing else to do
</p>
<p>
    If NOT oSrcLibs.hasByName(sSrcLib) Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    REM If the destination library does not exist, then create it
</p>
<p>
    If NOT oDestLibs.hasByName(sDestLib) Then
</p>
<p>
    oDestLibs.createLibrary(sDestLib)
</p>
<p>
    End If
</p>
<p>
    REM This is where the real fun begins!
</p>
<p>
    REM It may seem obvious, but the libraries must be loaded first.
</p>
<p>
    REM Common mistake to not load the libraries first!
</p>
<p>
    oSrcLibs.loadLibrary(sSrcLib)
</p>
<p>
    oDestLibs.loadLibrary(sDestLib)
</p>
<p>
    REM Get the source and destination libraries
</p>
<p>
    REM Get all of the contained modules that should be copied
</p>
<p>
    oSrcLib = oSrcLibs.getByName(sSrcLib)
</p>
<p>
    oDestLib = oDestLibs.getByName(sDestLib)
</p>
<p>
    sNames = oSrcLib.getElementNames()
</p>
<p>
    REM For each module, either add it or replace it
</p>
<p>
    For i = LBound(sNames) To UBound(sNames)
</p>
<p>
    If oDestLib.hasByName(sNames(i)) Then
</p>
<p>
    oDestLib.replaceByName(sNames(i), oSrcLib.getByName(sNames(i)))
</p>
<p>
    Else
</p>
<p>
    oDestLib.insertByName(sNames(i), oSrcLib.getByName(sNames(i)))
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    Assume that you want to copy a specific library from the application into a document so that you can send it to a
    friend. The fastest method is to simply use the macro organizer and append the library from the application into the
    document. Sure, you can write a macro, but some things are done faster manually. If, on the other hand, you need to
    copy libraries frequently, it makes sense to write a macro to do the work. The macro in accepts the name of a
    library contained in the application and then copies the library into the current document. Both the code library
    and the dialog library are copied. The analogous macro to copy a library from the document back to the application
    is trivial and nearly identical to .
</p>
<p>
    <strong>Listing . </strong>Add a global library to to the current document.
</p>
<p>
    Sub AppLibToDocLib(sLibName$)
</p>
<p>
    Dim oGlobalLib
</p>
<p>
    oGlobalLib = GlobalScope.BasicLibraries
</p>
<p>
    AddOneLib(sLibName, sLibName, oGlobalLib, BasicLibraries, True)
</p>
<p>
    oGlobalLib = GlobalScope.DialogLibraries
</p>
<p>
    AddOneLib(sLibName, sLibName, oGlobalLib, DialogLibraries, True)
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-15">
                    <span id="anchor-474"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Although sometimes it’s quicker to manipulate libraries by hand, it’s easy to manipulate and copy them using macros.
    The methods outlined in this chapter will allow you to perform most of the operations that you need for libraries.
</p>
<ol type="1">
    <li>
        <h1 id="dialogs-and-controls">
            <span id="anchor-475"></span>Dialogs and Controls
        </h1>
    </li>
</ol>
<p>
    This chapter discusses how to create and use dialogs and the controls that they contain. It focuses on the Basic IDE
    as the primary method of creating dialogs. This chapter covers each of the different controls and provides examples
    for most of the control types. It also includes a method to build dialogs and controls at run time, rather than
    using the Basic IDE.
</p>
<p>
    In computer terms, a window is an area shown on the computer screen in which information is displayed. In most
    applications, it isn’t always easy to tell the difference between a dialog and a window. Although the word “dialog”
    has multiple definitions, the definition usually specifies an exchange of information between two
    entities<em><em>—</em></em>usually people. In OpenOffice, a dialog is a window that is displayed to interact with a
    user.
</p>
<p>
    A “modal window” blocks its parent application (or window) from further activity until the window has completed
    executing its code and has been closed successfully. In other words, when you open a “modal” window, it has the
    focus; you can't just move it out of the way and use the window underneath it. If a window is modal, it’s usually
    considered to be a dialog.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                While a modal dialog is displayed, you can access the dialog but not the document window. Dialogs are
                almost always modal, and general application windows, such as those displaying documents under user
                control, are almost never modal
            </td>
        </tr>
    </tbody>
</table>
<p>
    The Find &amp; Replace dialog in a Writer document is an example of a non-modal dialog. After opening the Find &amp;
    Replace dialog, you can still access and edit the document. Another criterion for a window being classified as a
    dialog is based on function. The primary display window for a program is typically not a dialog. The information
    displayed or requested in a dialog is usually secondary compared to the function of the program. For example,
    configuration information and error notices are frequently displayed in a dialog, but the primary text of a Writer
    document is not. Although the difference between a window and a dialog is somewhat arbitrary, you can create and use
    your own dialogs in Basic, but you can’t open and start a general application window. This is reasonable, because
    the usual purpose of a dialog is to communicate some details relevant to the configuration of an application,
    object, or document that is already active.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="my-first-dialog">
                    <span id="anchor-476"></span>My first dialog
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    To create a dialog in the IDE, you must first create an empty dialog. You can use one of two methods to add an empty
    dialog to a library. The first method is to use the Macro Organizer dialog. The advantage of using the Macro
    Organizer is that you can immediately provide a meaningful name for the dialog.
</p>
<p>
    You can also create dialogs and modules directly in the Basic IDE by right-clicking the Module tab. The tabs shown
    at the bottom of the Basic IDE identify the opened modules and dialogs. Place the cursor on any tab, right-click and
    select Insert | BASIC Dialog (see ).
</p>
<p>
    A new dialog is created with the name Dialog1. Right-click the Dialog1 tab and choose Rename to change the name of
    the dialog from Dialog1 to HelloDlg. An empty dialog appears in the middle of the IDE page. This dialog, which is
    currently empty, is the one that will be displayed when you are finished. To select the dialog, click in its lower
    right corner. After you’ve selected the dialog, you can use the mouse to change its size or location. If you had
    selected the dialog by clicking anywhere in it, the more common activity of selecting controls contained in the
    dialog would be more difficult.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                When something is selected, green boxes appear around the selected item. The green boxes are called
                handles.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Figure . </strong>Right-click the module tab and select Insert | BASIC Dialog.
</p>
<p>
    Click the Controls Dialog icon in the toolbar to open the Controls toolbar (see ). The Controls toolbar is
    non-modal, so you can leave it open and still manipulate the dialog. Click the lower right Test Mode button to open
    a copy of the dialog in test mode. This allows you to see how the dialog looks. To close the dialog after opening it
    in test mode, click the Close icon in the upper right corner of the dialog.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The Controls toolbar is sometimes referred to as the “design tools window” or “Toolbox”, differs in
                appearance and what it contains between LO and AOO.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Most of the icons in the Controls toolbar are used to add controls to your dialog. If you click any of the control
    icons in the Controls toolbar, the cursor changes from an arrow-shaped selection cursor to a cross-shaped cursor.
    You can click the Select icon to change the cursor back to the selection shape rather than insert a new control.
</p>
<p>
    <strong>Table . </strong>Dialog controls.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                AOO
            </td>
            <td>
                LO
            </td>
            <td>
                Description
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001000000014632B5E21.png" style="width:0.2402in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/1000000000000015000000205D802D06.png" style="width:0.2189in;height:0.3335in" />
            </td>
            <td>
                Select
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/10000000000000130000001396BEA6CF.png" style="width:0.3in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/10000000000000240000002044B28817.png" style="width:0.3752in;height:0.3335in" />
            </td>
            <td>
                Manage Language
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001500000013B34D1E0B.png" style="width:0.3098in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001C0000001DAE0E36A7.png" style="width:0.2917in;height:0.302in" />
            </td>
            <td>
                Test mode on / off.
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/10000000000000130000001189A0AE1A.png" style="width:0.3299in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/1000000000000028000000268778FB2F.png" style="width:0.4165in;height:0.3957in" />
            </td>
            <td>
                Properties
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/1000000000000013000000115AA44987.png" style="width:0.198in;height:0.1772in" />
            </td>
            <td>
                <img src="Pictures/100000000000001B00000012A89146E2.png" style="width:0.2811in;height:0.1874in" />
            </td>
            <td>
                Button
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000000F00000012B98B76AF.png" style="width:0.25in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001B0000001DBE9C90ED.png" style="width:0.2811in;height:0.302in" />
            </td>
            <td>
                Image control
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001000000011C72E2488.png" style="width:0.2299in;height:0.25in" />
            </td>
            <td>
                <img src="Pictures/1000000000000013000000153A135349.png" style="width:0.2299in;height:0.25in" />
            </td>
            <td>
                Check box
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000000C0000000DA717E85A.png" style="width:0.2201in;height:0.25in" />
            </td>
            <td>
                <img src="Pictures/1000000000000014000000150E8A0D17.png" style="width:0.2402in;height:0.25in" />
            </td>
            <td>
                Radio button
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/10000000000000130000000A0D088148.png" style="width:0.5in;height:0.25in" />
            </td>
            <td>
                <img src="Pictures/100000000000001C00000019F7D94082.png" style="width:0.2917in;height:0.2602in" />
            </td>
            <td>
                Label field
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/10000000000000120000000DBCD3B12A.png" style="width:0.3402in;height:0.25in" />
            </td>
            <td>
                <img src="Pictures/100000000000001C00000016B4479339.png" style="width:0.2917in;height:0.2291in" />
            </td>
            <td>
                Text box
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/10000000000000130000001497FA2125.png" style="width:0.2799in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001E0000001B696C82D8.png" style="width:0.3126in;height:0.2811in" />
            </td>
            <td>
                List box
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/1000000000000012000000146DF3B8CA.png" style="width:0.2701in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001B0000001BD17D1B8D.png" style="width:0.2811in;height:0.2811in" />
            </td>
            <td>
                Combo box
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000000D0000001349034E47.png" style="width:0.2098in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000000F0000001D655097E0.png" style="width:0.1563in;height:0.302in" />
            </td>
            <td>
                Vertical scroll bar
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/10000000000000130000000D0E550E54.png" style="width:0.3598in;height:0.25in" />
            </td>
            <td>
                <img src="Pictures/100000000000001E0000001D7B68630C.png" style="width:0.3126in;height:0.302in" />
            </td>
            <td>
                Horizontal scroll bar
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001400000015755EE187.png" style="width:0.2799in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001F0000001D3778A630.png" style="width:0.3228in;height:0.302in" />
            </td>
            <td>
                Goup box
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/10000000000000140000000F10ACD74C.png" style="width:0.3299in;height:0.25in" />
            </td>
            <td>
                <img src="Pictures/100000000000001F0000001D1D52F127.png" style="width:0.3228in;height:0.302in" />
            </td>
            <td>
                Progress bar
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001300000014E4D63F48.png" style="width:0.2799in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001A0000001DD48E864F.png" style="width:0.2709in;height:0.302in" />
            </td>
            <td>
                Horizontal line
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000001300000011DA599402.png" style="width:0.3299in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001C0000001D13DC37D5.png" style="width:0.2917in;height:0.302in" />
            </td>
            <td>
                Vertical line
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/1000000000000012000000135C98AE34.png" style="width:0.2799in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001E0000001D76CB939E.png" style="width:0.3126in;height:0.302in" />
            </td>
            <td>
                Date field
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000001300000015BE6414A5.png" style="width:0.2701in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001C0000001D7FFCB117.png" style="width:0.2917in;height:0.302in" />
            </td>
            <td>
                Time field
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/10000000000000120000000D28A99577.png" style="width:0.3402in;height:0.25in" />
            </td>
            <td>
                <img src="Pictures/100000000000001C0000001D0EBD7996.png" style="width:0.2917in;height:0.302in" />
            </td>
            <td>
                Numeric field
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000001400000013E5CE9095.png" style="width:0.3098in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001C0000001D11885DE9.png" style="width:0.2917in;height:0.302in" />
            </td>
            <td>
                Currency field
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000001400000013FB50F73F.png" style="width:0.3098in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001D0000001D11B1D84C.png" style="width:0.302in;height:0.302in" />
            </td>
            <td>
                Formatted field
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/100000000000001400000010392F43F3.png" style="width:0.3701in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001C0000001D79503E33.png" style="width:0.2917in;height:0.302in" />
            </td>
            <td>
                Pattern field
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/10000000000000110000001254EF260C.png" style="width:0.2799in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/10000000000000210000001DBE8A3C29.png" style="width:0.3437in;height:0.302in" />
            </td>
            <td>
                File selection
            </td>
        </tr>
        <tr class="odd">
            <td>
                <img src="Pictures/1000000000000010000000142BA55D17.png" style="width:0.2402in;height:0.3in" />
            </td>
            <td>
                <img src="Pictures/100000000000001C0000001D1B34F12A.png" style="width:0.2917in;height:0.302in" />
            </td>
            <td>
                Tree control
            </td>
        </tr>
        <tr class="even">
            <td>
                <img src="Pictures/100000000000000D000000135366528E.png" style="width:0.2299in;height:0.3299in" />
            </td>
            <td>
                <img src="Pictures/10000000000000150000001DA6C66000.png" style="width:0.2189in;height:0.302in" />
            </td>
            <td>
                Spin button is missing (by default) on the Toolbox bar in AOO and it is not usable in an AOO dialog
                anyway (I think).
            </td>
        </tr>
    </tbody>
</table>
<blockquote>
</blockquote>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Other controls do exist, but they are not shown in the Toolbox bar by default; for example, database
                controls such as a Table control. Just as well since they are not usable in a dialog.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <img src="Pictures/1000000000000168000000FAE7D258D2.png" style="width:3.75in;height:2.6043in" />
</p>
<p>
    <strong>Figure . </strong>Click the lower right corner to enable the green handles.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="the-properties-dialog">
                            <span id="anchor-477"></span>The Properties dialog
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Much of what a dialog or control does is controlled by properties, which you can set at both run time and design
    time. To set properties at design time, first select the object. After the object is selected, either right-click
    the object and select Properties, or click the Properties button in the Controls dialog (see ).
</p>
<p>
    The Name property (see ) sets the name used to retrieve the control from the dialog. For a dialog, there is no
    reason to change the name, because the dialog is not retrieved in the same way that a control is retrieved. The
    Title property exists for dialogs (and only for dialogs), and it sets the value of the dialog’s
    title<em><em>—</em></em>I set the title for my example dialog to “Hello World.” Although the Properties dialog
    supports setting the position and size, this is usually done using the mouse.
</p>
<p>
    <img src="Pictures/10000000000001590000027FD1F7D521.png" style="width:3.5937in;height:6.6563in" />
</p>
<p>
    <strong>Figure . </strong>Set the properties for the dialog.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The properties shown in the Properties dialog change based on the selected object
            </td>
        </tr>
    </tbody>
</table>
<p>
    Use the following steps to set up the dialog in this example.
</p>
<ol type="1">
    <li>
        Use View &gt; Toolbars &gt; Form Controls to open the Controls toolbar.
    </li>
    <li>
        Select the dialog by clicking the lower right corner of the dialog (see ).
    </li>
    <li>
        Click the Properties icon on the Controls toolbar to open the Properties dialog (see ).
    </li>
    <li>
        Set the dialog’s name to HelloDlg<em><em>—</em></em>I like to name things.
    </li>
    <li>
        Set the dialog’s title to “Hello World.” When the cursor leaves the Title property field, the title is displayed
        in the dialog’s title bar.
    </li>
    <li>
        Make certain that the Properties dialog is not covering the Hello World dialog.
    </li>
    <li>
        Click the Button icon in the Controls toolbar to add a button to the Hello World dialog. When the cursor moves
        over the dialog, it changes from the selection arrow to a cross. Position the cursor where you want the button,
        and then click the mouse button and drag to define the appropriate size.
    </li>
    <li>
        When the button is created, it defaults to the name CommandButton1. Use the Properties dialog to change the
        button’s name to OKButton and the button’s label to “OK”.
    </li>
    <li>
        Use the Properties dialog to change the button type to OK so that the button will automatically close the
        dialog. If you don’t do this, the button will do nothing unless a handler is registered for the
        button<em><em>—</em></em>event handlers are set from the Events tab in the Properties dialog.
    </li>
    <li>
        In the “Help text” field, enter the text “Click Here” so that some help text is displayed when the cursor rests
        over the button.
    </li>
</ol>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                OpenOffice.org includes numerous excellent examples of dialog and control manipulation in the module
                named ModuleControls contained in the Tools library.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="starting-a-dialog-from-a-macro">
                            <span id="anchor-478"></span>Starting a dialog from a macro
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Dialogs can be stored in the document or in a global library (see Chapter 16, “Library Management”). Regardless of
    where the dialog is stored, it must be loaded before it can be used. Remember that you can access the dialog
    libraries stored in the current document by using DialogLibraries, and the libraries stored in the application by
    using GlobalScope.DialogLibraries. Use the following sequence of steps to load, create, and execute a dialog:
</p>
<ol type="1">
    <li>
        Use the loadLibrary() method to load the library containing the dialog. Although you can skip this step if the
        library is already loaded, it is probably not prudent to assume this.
    </li>
    <li>
        Use the getByName() method to retrieve the library from DialogLibraries.
    </li>
    <li>
        Use the method getByName() to retrieve the dialog from the retrieved library.
    </li>
    <li>
        Create the dialog using CreateUnoDialog().
    </li>
    <li>
        Execute the dialog.
    </li>
</ol>
<p>
    loads and executes a dialog stored in the current document.
</p>
<p>
    <strong>Listing . </strong>Load and run the test dialog.
</p>
<p>
    Dim oHelloDlg 'The run-time dialog that is created
</p>
<p>
    Sub RunHelloDlg
</p>
<p>
    Dim oLib 'Library that contains the dialog
</p>
<p>
    Dim oLibDlg 'Dialog as stored in the library
</p>
<p>
    REM First, load the library.
</p>
<p>
    REM If the dialog is stored in an application-level library rather than
</p>
<p>
    REM in the document, then GlobalScope.DialogLibraries must be used.
</p>
<p>
    DialogLibraries.loadLibrary("OOME_30")
</p>
<p>
    REM Obtain the entire library now that it has been loaded.
</p>
<p>
    oLib = DialogLibraries.getByName("OOME_30")
</p>
<p>
    REM Obtain the dialog as stored in the library.
</p>
<p>
    REM I usually think of this as the definition of the dialog.
</p>
<p>
    oLibDlg = oLib.getByName("HelloDlg")
</p>
<p>
    REM Create a dialog that can be used.
</p>
<p>
    oHelloDlg = CreateUnoDialog(oLibDlg)
</p>
<p>
    REM Now start the dialog.
</p>
<p>
    REM The execute() method is really a function that returns 1 if OK
</p>
<p>
    REM is used to close the dialog and 0 if Cancel is used to close the
</p>
<p>
    REM dialog. Clicking the Close button in the upper right corner
</p>
<p>
    REM of the dialog is considered the same as clicking Cancel.
</p>
<p>
    oHelloDlg.execute()
</p>
<p>
    End Sub
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The variable that contains the dialog is declared outside of the subroutine that creates the dialog so
                that the dialog can be accessed in event handlers, which are implemented as subroutines.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="assign-an-event-handler">
                            <span id="anchor-479"></span>Assign an event handler
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Controls and dialogs can call external event handlers. You can assign individual subroutines as event handlers by
    using the Events tab of the Properties dialog (see ). A quick look at the title shows that the events in are for a
    command button. The supported events can change based on the selected object.
</p>
<p>
    <img src="Pictures/100000000000015E0000017F8BC225B9.png" style="width:3.6457in;height:3.9898in" />
</p>
<p>
    <strong>Figure . </strong>Events for a command button.
</p>
<p>
    You can use an event handler to close the Hello World dialog. Use the Properties dialog to change the Button type
    from OK to default; the dialog will no longer close on its own. You might want to do this, for example, if you want
    to validate input before closing a dialog. Now, write the event handler that will close the dialog (see ).
</p>
<p>
    <strong>Listing . </strong>Close the hello dialog.
</p>
<p>
    Sub ExitHelloDlg
</p>
<p>
    oHelloDlg.endExecute()
</p>
<p>
    End Sub
</p>
<p>
    To assign the “Execuate action” event to call the ExitHelloDlg macro, open the Properties dialog for the button and
    click the Events tab. Click the three dots to the right of the desired event (see ) to open the Assign action dialog
    (see ).
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Warn
            </td>
            <td>
                I have seen different behaviors depending on the OOo variant and version. In LO 4.0.2.2, if I click the
                dots for Execute action (see ) and then assign a macro to Item Status changed (see ), nothing was
                assigned. In other versions (not LO) I have assigned multiple actions and different actions and they
                worked.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <img src="Pictures/10000000000002CD00000209F8447ADB.png" style="width:7in;height:5.0902in" />
</p>
<p>
    <strong>Figure . </strong>Assign macros to event handlers.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Warn
            </td>
            <td>
                To assign an event handler, you must click the Assign button and not the OK button. The only purpose for
                the OK button is to close the Assign Macro dialog. It is a common and frustrating mistake to select an
                event handler for an event, and then click OK rather than Assign.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Highlight event and click the Macro button to open the <em>Macro Selector</em> dialog.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                If the dialog will be used with an XDialogEventHandler, then use the Component button in the <em>Assign
                    action</em> dialog (see ) and enter the name of the method to call.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <img src="Pictures/10000000000002C20000026862BE8951.png" style="width:7in;height:6.1098in" />
</p>
<p>
    <strong>Figure . </strong>Assign macros to event handlers.
</p>
<p>
    Use the <em>Library</em> tree control to select the macro library container (My Macros, application macros, or a
    document), the library, and module. Finally, select the desired macro in the <em>Library Name</em> list box.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="dialog-and-control-paradigm">
                    <span id="anchor-480"></span>Dialog and control paradigm
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    To understand how controls work, it is important that you understand the difference between a model, a view, and a
    controller. The model-view-control paradigm, sometimes referred to as MVC, is very widely used and accepted in the
    computer science community.
</p>
<p>
    The <em>model</em> describes a control’s appearance, data, and behavior. The model does not interact with a user and
    it is not able to display itself. When an object supports the MVC paradigm, the changes should be made to the
    object’s model and then these changes will automatically be propagated to the views by the controller. Only one
    model can exist for an object.
</p>
<p>
    The <em>view</em> is what the user sees. Although there can be only one model for an object, multiple views may
    exist to display an object.
</p>
<p>
    The <em>controller</em> is what interacts with the user. When the user tells the controller to perform some action,
    a change is made to the model, and then the view is updated.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                An OpenOffice.org document is distinguished from a non-document desktop component, such as the Basic IDE
                or the Help window, by the fact that it has a data model. In other words, OOo uses the MVC paradigm for
                documents.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The controls that are displayed in dialogs generally contain access methods in the view portion that update and
    affect the model. I recommend that you use the model rather than the view methods unless you have a compelling
    reason to do otherwise; I am told that it can lead to some inconsistencies. Apparently this problem is more
    pronounced with controls embedded in forms than in dialogs, but I have never observed the inconsistencies directly.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="dialog-and-control-similarities">
                            <span id="anchor-481"></span>Dialog and control similarities
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    In some respects, a dialog is also a control. Dialogs support the MVC paradigm and share many similarities with
    controls. For example, dialogs support the UnoControl service, which is common to all controls. UNO controls support
    the XComponent interface, which is also supported by numerous other objects in OpenOffice.org (see ).
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.lang.XComponent interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                dispose()
            </td>
            <td>
                The object’s owner calls this method to free all the object’s resources. You won’t usually call this
                method.
            </td>
        </tr>
        <tr class="even">
            <td>
                addEventListener(XEventListener)
            </td>
            <td>
                Add an event listener to the object.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeEventListener(XEventListener)
            </td>
            <td>
                Remove an event listener from the object’s listener list.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The XControl interface identifies an object as a control. All objects that support the UnoControl service also
    support the XControl interface. For Basic programmers, the most interesting method is probably getModel() because it
    returns the control’s data model (see ).
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.awt.XControl interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                setContext(XInterface)
            </td>
            <td>
                Set the control’s context.
            </td>
        </tr>
        <tr class="even">
            <td>
                getContext()
            </td>
            <td>
                Get the control’s context.
            </td>
        </tr>
        <tr class="odd">
            <td>
                createPeer(XToolkit, XWindowPeer)
            </td>
            <td>
                Create a child window. If the peer is null, the desktop is the parent. This method is used to create a
                window to display a dialog that was created in a macro rather than in the IDE (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                getPeer()
            </td>
            <td>
                Return the previously created or set peer XWindowPeer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setModel(XControlModel)
            </td>
            <td>
                Set the model’s control; return True if successful.
            </td>
        </tr>
        <tr class="even">
            <td>
                getModel()
            </td>
            <td>
                Return the control’s XModel.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getView()
            </td>
            <td>
                Return the control’s XView.
            </td>
        </tr>
        <tr class="even">
            <td>
                setDesignMode(Boolean)
            </td>
            <td>
                Turn the design mode on and off.
            </td>
        </tr>
        <tr class="odd">
            <td>
                isDesignMode()
            </td>
            <td>
                Return True if the control is in design mode; otherwise return False.
            </td>
        </tr>
        <tr class="even">
            <td>
                isTransparent()
            </td>
            <td>
                Return True if the control is transparent; otherwise return False.
            </td>
        </tr>
    </tbody>
</table>
<p>
    When you set a position and a size by using a single method (see ), the PosSize constant group is used to control
    which portions are actually updated (see ).
</p>
<p>
    <strong>Table . </strong>Constants defined by the com.sun.star.awt.PosSize constant group.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                1
            </td>
            <td>
                X
            </td>
            <td>
                Flag the X coordinate.
            </td>
        </tr>
        <tr class="even">
            <td>
                2
            </td>
            <td>
                Y
            </td>
            <td>
                Flag the Y coordinate.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                WIDTH
            </td>
            <td>
                Flag the width.
            </td>
        </tr>
        <tr class="even">
            <td>
                8
            </td>
            <td>
                HEIGHT
            </td>
            <td>
                Flag the height.
            </td>
        </tr>
        <tr class="odd">
            <td>
                3
            </td>
            <td>
                POS
            </td>
            <td>
                Flag the X and Y coordinates.
            </td>
        </tr>
        <tr class="even">
            <td>
                12
            </td>
            <td>
                SIZE
            </td>
            <td>
                Flag the width and height.
            </td>
        </tr>
        <tr class="odd">
            <td>
                15
            </td>
            <td>
                POSSIZE
            </td>
            <td>
                Flag everything.
            </td>
        </tr>
    </tbody>
</table>
<p>
    A window is a rectangular region on an output device defined primarily by its position and size. The constants in
    are used in the setPosSize() method shown in to set the position and size. The XWindow interface defines the basic
    operations for a window component. The methods to get and set the position are demonstrated in .
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.awt.XWindow interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                setPosSize (x, y, width, height, PosSize)
            </td>
            <td>
                Set the window’s outer bounds (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                getPosSize()
            </td>
            <td>
                Return the window’s outer bounds as a rectangle.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setVisible(Boolean)
            </td>
            <td>
                Show or hide the window.
            </td>
        </tr>
        <tr class="even">
            <td>
                setEnable(Boolean)
            </td>
            <td>
                Enable or disable the window.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setFocus()
            </td>
            <td>
                Focus this window.
            </td>
        </tr>
        <tr class="even">
            <td>
                addWindowListener(listener)
            </td>
            <td>
                Add the XWindowListener.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeWindowListener(listener)
            </td>
            <td>
                Remove the XWindowListener from the listener list.
            </td>
        </tr>
        <tr class="even">
            <td>
                addFocusListener(listener)
            </td>
            <td>
                Add the XFocusListener.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeFocusListener(listener)
            </td>
            <td>
                Remove the XFocusListener from the listener list.
            </td>
        </tr>
        <tr class="even">
            <td>
                addKeyListener(listener)
            </td>
            <td>
                Add the XKeyListener.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeKeyListener(listener)
            </td>
            <td>
                Remove the XKeyListener from the listener list.
            </td>
        </tr>
        <tr class="even">
            <td>
                addMouseListener(listener)
            </td>
            <td>
                Add the XMouseListener.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeMouseListener(listener)
            </td>
            <td>
                Remove the XMouseListener from the listener list.
            </td>
        </tr>
        <tr class="even">
            <td>
                addMouseMotionListener(listener)
            </td>
            <td>
                Add the XMouseMotionListener.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeMouseMotionListener(listener)
            </td>
            <td>
                Remove the XMouseMotionListener from the listener list.
            </td>
        </tr>
        <tr class="even">
            <td>
                addPaintListener(listener)
            </td>
            <td>
                Add the XPaintListener.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removePaintListener(listener)
            </td>
            <td>
                Remove the XPaintListener from the listener list.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The XView interface defines the methods required to display an object (see ). These methods are used primarily by
    advanced users and are included here only for completeness.
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.awt.XView interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                setGraphics(XGraphics)
            </td>
            <td>
                Set the output device.
            </td>
        </tr>
        <tr class="even">
            <td>
                getGraphics()
            </td>
            <td>
                Return the XGraphics output device.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getSize()
            </td>
            <td>
                Returns the size of the object in device units.
            </td>
        </tr>
        <tr class="even">
            <td>
                draw(x, y)
            </td>
            <td>
                Draws the object at the specified position.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setZoom(x, y)
            </td>
            <td>
                Set the zoom factor of the control’s contents.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="dialog-specific-methods">
                            <span id="anchor-482"></span>Dialog-specific methods
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The methods defined in through are common to all control types. As expected, however, dialogs support methods and
    properties that are specific to dialogs (see ).
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.awt.XDialog interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                setTitle()
            </td>
            <td>
                Set the dialog’s title.
            </td>
        </tr>
        <tr class="even">
            <td>
                getTitle()
            </td>
            <td>
                Get the dialog’s title.
            </td>
        </tr>
        <tr class="odd">
            <td>
                execute()
            </td>
            <td>
                Display the dialog.
            </td>
        </tr>
        <tr class="even">
            <td>
                endExecute()
            </td>
            <td>
                Hide the dialog and cause the execute() method to return.
            </td>
        </tr>
    </tbody>
</table>
<p>
    All controls act as a window: They are rectangular in shape, can receive focus, be enabled and disabled, and have
    listeners (see ). Top-level windows add extra functionality because they are not contained in another window (see ).
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.awt.XTopWindow interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                addTopWindowListener(XTopWindowListener)
            </td>
            <td>
                Add a listener for this window.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeTopWindowListener(XTopWindowListener)
            </td>
            <td>
                Remove a listener so that it no longer receives events from this window.
            </td>
        </tr>
        <tr class="odd">
            <td>
                toFront()
            </td>
            <td>
                Move this window in front of all other windows.
            </td>
        </tr>
        <tr class="even">
            <td>
                toBack()
            </td>
            <td>
                Move this window behind all other windows.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setMenuBar(XMenuBar)
            </td>
            <td>
                Set a menu bar for this window.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The primary function of a dialog is to contain controls. The methods in allow a dialog to add, remove, and get
    controls contained in a dialog. It is very common to extract a control from a dialog to read or set its value.
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.awt.XControlContainer interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                setStatusText(String)
            </td>
            <td>
                Set the text in the container’s status bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                getControls()
            </td>
            <td>
                Return all controls as an array of type XControl.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getControl(name)
            </td>
            <td>
                Return the XControl with the specified name.
            </td>
        </tr>
        <tr class="even">
            <td>
                addControl(name, XControl)
            </td>
            <td>
                Add the XControl to the container.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeControl(XControl)
            </td>
            <td>
                Remove the XControl from the container.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Controls are usually not added to or removed from the dialog. If you create a dialog using a macro, rather than
    designing the dialog in the IDE, you add control models to the dialog’s model, rather than adding controls directly
    to the dialog. As usual, the work is done in the model and the changes are reflected in the view. The most-used
    method in is getControl(name).
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="the-dialog-model">
                            <span id="anchor-483"></span>The dialog model
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    You can obtain a control’s model by using the method getModel() defined in . Dialogs support the
    UnoControlDialogModel service (see ) that defines many of the properties that you can set from the Basic IDE (see ).
    You can set some properties directly from the dialog object<em><em>—</em></em>the setTitle() method in , for
    example<em><em>—</em></em>but it is better to modify the model directly.
</p>
<p>
    <strong>Table . </strong>Properties defined by the com.sun.star.awt.UnoControlDialogModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BackgroundColor
            </td>
            <td>
                Dialog’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Closeable
            </td>
            <td>
                If True, the dialog is closeable.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontDescriptor
            </td>
            <td>
                Structure that defines and describes the font for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontEmphasisMark
            </td>
            <td>
                Constant that defines the type/position of the emphasis mark for text in dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontRelief
            </td>
            <td>
                Constant that specifies if the dialog’s caption bar contains embossed or engraved text.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpText
            </td>
            <td>
                Dialog’s help text as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpURL
            </td>
            <td>
                Dialog’s help URL as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Moveable
            </td>
            <td>
                If True, the dialog is moveable.
            </td>
        </tr>
        <tr class="even">
            <td>
                Sizeable
            </td>
            <td>
                If True, the dialog is sizeable.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextColor
            </td>
            <td>
                Dialog’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextLineColor
            </td>
            <td>
                Dialog’s text line color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Title
            </td>
            <td>
                Text string displayed in the dialog’s caption bar.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Controls that can be inserted into an UNO control dialog support the properties defined by the
    UnoControlDialogElement service (see ).
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlDialogElement service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Height
            </td>
            <td>
                Control’s height.
            </td>
        </tr>
        <tr class="even">
            <td>
                Name
            </td>
            <td>
                Control’s name.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PositionX
            </td>
            <td>
                Control’s horizontal position.
            </td>
        </tr>
        <tr class="even">
            <td>
                PositionY
            </td>
            <td>
                Control’s vertical position.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Step
            </td>
            <td>
                Control’s step.
            </td>
        </tr>
        <tr class="even">
            <td>
                TabIndex
            </td>
            <td>
                Control’s tab index.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Tag
            </td>
            <td>
                Control’s tag.
            </td>
        </tr>
        <tr class="even">
            <td>
                Width
            </td>
            <td>
                Control’s width.
            </td>
        </tr>
    </tbody>
</table>
<p>
    It is possible to create controls and dialogs by using a macro rather than designing them in the Basic IDE. The
    dialog’s model supports the createInstance() method defined by the com.sun.star.lang.XMultiServiceFactory interface.
    When a macro creates a control to be inserted into a dialog, that control should be created by the dialog’s model. A
    control that is created from the global service manager will not have the properties shown in . Creating controls by
    using a macro is an advanced topic that is discussed later in this chapter. The macro in shows the objects that a
    dialog model can create (see ).
</p>
<p>
    <strong>Listing . </strong>What services can the dialog model create?
</p>
<p>
    Sub ShowDialogServices
</p>
<p>
    Dim oLib 'Library that contains the dialog
</p>
<p>
    Dim oLibDlg 'Dialog as stored in the library
</p>
<p>
    DialogLibraries.loadLibrary("OOME_30")
</p>
<p>
    oLib = DialogLibraries.getByName("OOME_30")
</p>
<p>
    oLibDlg = oLib.getByName("HelloDlg")
</p>
<p>
    oHelloDlg = CreateUnoDialog(oLibDlg)
</p>
<p>
    MsgBox Join(oHelloDlg.getModel().getAvailableServiceNames(), CHR$(10))
</p>
<p>
    End Sub
</p>
<p>
    <img src="Pictures/1000000000000191000002327814A5D5.png" style="width:4.1772in;height:5.8543in" />
</p>
<p>
    <strong>Figure . </strong>Services that the dialog model in AOO 3.4.1 can create.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="controls">
                    <span id="anchor-484"></span>Controls
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    You can obtain a control directly from a dialog by calling the getControl() method. You can obtain a control’s model
    by calling the getModel() method on the control, or by calling getByName() on the model of the object in which it is
    contained. In other words, you can get a control’s model from the dialog’s model. The code in demonstrates the
    options available.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                You can insert controls into dialogs and forms, but not all controls work in dialogs. Some controls
                require a data source, but a dialog is not able to contain a data source. This chapter deals only with
                controls that can be inserted into a dialog.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing . </strong>Get the button or the button’s model.
</p>
<p>
    oHelloDlg.getControl("OKButton") 'Get the UnoControlButton
</p>
<p>
    oHelloDlg.getControl("OKButton").getModel() 'Get the UnoControlButtonModel
</p>
<p>
    oHelloDlg.getModel().getByName("OKButton") 'Get the UnoControlButtonModel
</p>
<p>
    The control types that can be inserted into a dialog are defined in the com.sun.star.awt module (see and ). Notice
    the similarity between the service name of the control and the service name of the control’s model.
</p>
<p>
    <strong>Table . </strong>Controls and their models defined in the com.sun.star.awt module.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TreeControl
            </td>
            <td>
                TreeControlModel
            </td>
            <td>
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlButton
            </td>
            <td>
                UnoControlButtonModel
            </td>
            <td>
                Button
            </td>
        </tr>
        <tr class="odd">
            <td>
                UnoControlCheckBox
            </td>
            <td>
                UnoControlCheckBoxModel
            </td>
            <td>
                Check box
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlComboBox
            </td>
            <td>
                UnoControlComboBoxModel
            </td>
            <td>
                Combo box
            </td>
        </tr>
        <tr class="odd">
            <td>
                UnoControlCurrencyField
            </td>
            <td>
                UnoControlCurrencyFieldModel
            </td>
            <td>
                Currency field
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlDateField
            </td>
            <td>
                UnoControlDateFieldModel
            </td>
            <td>
                Date field
            </td>
        </tr>
        <tr class="odd">
            <td>
                UnoControlDialog
            </td>
            <td>
                UnoControlDialogModel
            </td>
            <td>
                Dialog
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlEdit
            </td>
            <td>
                UnoControlEditModel
            </td>
            <td>
                Text edit field
            </td>
        </tr>
        <tr class="odd">
            <td>
                UnoControlFileControl
            </td>
            <td>
                UnoControlFileControlModel
            </td>
            <td>
                Select a file
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlFixedLine
            </td>
            <td>
                UnoControlFixedLineModel
            </td>
            <td>
                Fixed line
            </td>
        </tr>
        <tr class="odd">
            <td>
                UnoControlFixedText
            </td>
            <td>
                UnoControlFixedTextModel
            </td>
            <td>
                Display fixed
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlFormattedField
            </td>
            <td>
                UnoControlFormattedFieldModel
            </td>
            <td>
                Formatted field
            </td>
        </tr>
        <tr class="odd">
            <td>
                UnoControlGroupBox
            </td>
            <td>
                UnoControlGroupBoxModel
            </td>
            <td>
                Group box
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlImageControl
            </td>
            <td>
                UnoControlImageControlModel
            </td>
            <td>
                Display an image
            </td>
        </tr>
        <tr class="odd">
            <td>
                UnoControlListBox
            </td>
            <td>
                UnoControlListBoxModel
            </td>
            <td>
                List box
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlNumericField
            </td>
            <td>
                UnoControlNumericFieldModel
            </td>
            <td>
                Numeric field
            </td>
        </tr>
        <tr class="odd">
            <td>
                UnoControlPatternField
            </td>
            <td>
                UnoControlPatternFieldModel
            </td>
            <td>
                Pattern field
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlProgressBar
            </td>
            <td>
                UnoControlProgressBarModel
            </td>
            <td>
                Progress bar
            </td>
        </tr>
        <tr class="odd">
            <td>
                UnoControlRadioButton
            </td>
            <td>
                UnoControlRadioButtonModel
            </td>
            <td>
                Radio button
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlRoadmap
            </td>
            <td>
                UnoControlRoadmapModel
            </td>
            <td>
                Roadmap control
            </td>
        </tr>
        <tr class="odd">
            <td>
                UnoControlScrollBar
            </td>
            <td>
                UnoControlScrollBarModel
            </td>
            <td>
                Scroll bar
            </td>
        </tr>
        <tr class="even">
            <td>
                UnoControlTimeField
            </td>
            <td>
                UnoControlTimeFieldModel
            </td>
            <td>
                Time field
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                To assist in the demonstration of the different dialog controls, create a dialog called OOMESample. As
                the control types are discussed, I will direct you to add controls to the OOMESample dialog. See for the
                final dialog. Start by creating the OOMESample dialog and making it large enough to fill most of the
                screen. ?? How BIG ??
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="control-button">
                            <span id="anchor-485"></span>Control button
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A control button is a standard button that causes something to happen when it is “pressed.” A button’s type is
    controlled by the PushButtonType property in a button’s model. A button can be set to automatically close or cancel
    a dialog without writing an event handler; a default event handler is provided automatically for these predefined
    actions (see ).
</p>
<p>
    <strong>Table . </strong>Values defined by the com.sun.star.awt.PushButtonType enumeration.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                STANDARD
            </td>
            <td>
                The default value. You must write your own event handler.
            </td>
        </tr>
        <tr class="even">
            <td>
                OK
            </td>
            <td>
                Act like an OK button by closing the dialog and returning 1 from the execute() function.
            </td>
        </tr>
        <tr class="odd">
            <td>
                CANCEL
            </td>
            <td>
                Act like a Cancel button by closing the dialog and returning 0 from the execute() function.
            </td>
        </tr>
        <tr class="even">
            <td>
                HELP
            </td>
            <td>
                Act like a Help button and open the help URL.
            </td>
        </tr>
    </tbody>
</table>
<p>
    A control button can display a text label set by the Label property or a graphic image set by the ImageURL property.
    If the button displays an image rather than a label, the image is aligned based on a value defined by the ImageAlign
    constant group (see ).
</p>
<p>
    <strong>Table . </strong>Constants defined by the com.sun.star.awt.ImageAlign constant group.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                LEFT
            </td>
            <td>
                Align the image to the left.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                TOP
            </td>
            <td>
                Align the image to the top.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                RIGHT
            </td>
            <td>
                Align the image to the right.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                BOTTOM
            </td>
            <td>
                Align the image to the bottom.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Although a button can contain an image, it crops the image to fit. Use an Image control, rather than a
                button, if you need to scale the image.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The button model supports many of the same properties as the dialog model but it also supports some button-specific
    properties (see ).
</p>
<p>
    <strong>Table . </strong>Properties defined by the com.sun.star.awt.UnoControlButtonModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Align
            </td>
            <td>
                Optional, specifies the horizontal alignment of the text in the ctonrol.
            </td>
        </tr>
        <tr class="even">
            <td>
                BackgroundColor
            </td>
            <td>
                Dialog’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DefaultButton
            </td>
            <td>
                If True, this button is the default button.
            </td>
        </tr>
        <tr class="even">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the control.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpText
            </td>
            <td>
                Dialog’s help text as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpURL
            </td>
            <td>
                Dialog’s help URL as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                ImageAlign
            </td>
            <td>
                Specify how an image is aligned in the button (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                ImageURL
            </td>
            <td>
                URL of the image to display on the button. If the image is too large, it is cropped.
            </td>
        </tr>
        <tr class="even">
            <td>
                Label
            </td>
            <td>
                String label displayed on the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MultiLine
            </td>
            <td>
                Optional, specifies that the text may be displayed on more than one line.
            </td>
        </tr>
        <tr class="even">
            <td>
                Printable
            </td>
            <td>
                If True, the button is printed when the document is printed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                PushButtonType
            </td>
            <td>
                The default button action (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                State
            </td>
            <td>
                If 1, the button is activated; otherwise, the state is 0.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Tabstop
            </td>
            <td>
                If True, the control can be reached by using the Tab key.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextColor
            </td>
            <td>
                Dialog’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextLineColor
            </td>
            <td>
                Dialog’s text line color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Toggle
            </td>
            <td>
                Optional, specifies if the button should toggle in a single operation.
            </td>
        </tr>
        <tr class="odd">
            <td>
                VerticalAlign
            </td>
            <td>
                Optional, specifies the vertical alignment of the text in the control. Supported values are from
                com.sun.star.style.VerticalAlignment with supporting values of TOP, MIDDLE, or BOTTOM.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                Add an OK button to close the OOMESample dialog. Add a second button, named ClickButton, that calls
                OOMEDlgButton in .
            </td>
        </tr>
    </tbody>
</table>
<p>
    Add two buttons to the OOMESample dialog. Set one button to close the dialog when it is selected; label the button
    “Close” and set the button type to OK. The close button will automatically close the dialog when it is selected.
    Name the second button ClickButton and set the label to “Click Here”. Enter the code in and set the “Execute action”
    event of the ClickButton to call the OOMEDlgButton subroutine. When the ClickButton is selected, its label is
    changed to indicate the number of times that the button has been clicked.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong> </strong>Run the sample OOME Dialog.
</p>
<p>
    Option Explicit
</p>
<p>
    REM Global variables
</p>
<p>
    Dim oOOMEDlg 'The run-time dialog that is created
</p>
<p>
    Dim nClickCount% 'Number of times the button was clicked
</p>
<p>
    Sub RunOOMEDlg
</p>
<p>
    REM Declare the primary variables
</p>
<p>
    Dim oLib 'Library that contains the dialog
</p>
<p>
    Dim oLibDlg 'Dialog as stored in the library
</p>
<p>
    REM Load the library and the dialog
</p>
<p>
    DialogLibraries.loadLibrary("OOME_30")
</p>
<p>
    oLib = DialogLibraries.getByName("OOME_30")
</p>
<p>
    oLibDlg = oLib.getByName("OOMESample")
</p>
<p>
    oOOMEDlg = CreateUnoDialog(oLibDlg)
</p>
<p>
</p>
<p>
    REM Initial setup code here
</p>
<p>
    nClickCount = 0
</p>
<p>
    oOOMEDlg.getModel.Title = "OpenOffice.org Macros Explained Sample Dialog"
</p>
<p>
    REM This can be used with the check box to be added.
</p>
<p>
    REM oOOMEDlg.getModel().getByName("CheckBox").TriState = True
</p>
<p>
    REM Run the dialog
</p>
<p>
    oOOMEDlg.execute()
</p>
<p>
    End Sub
</p>
<p>
    Sub OOMEDlgButton
</p>
<p>
    Dim oButtonModel
</p>
<p>
    nClickCount = nClickCount + 1
</p>
<p>
    oButtonModel = oOOMEDlg.getModel().getByName("ClickButton")
</p>
<p>
    oButtonModel.Label = "Click " &amp; nClickCount
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="check-box">
                            <span id="anchor-486"></span>Check box
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Although a check box is usually used to indicate a single state of yes or no, the check box in OOo can be used as a
    tristate check box. The default behavior is for a check box to support the states 0 (not checked) and 1 (checked);
    this is the State property in the model. If the TriState property is True, however, a third state of 2 is allowed.
    The third state is displayed as checked, but the check box is dimmed. The properties in are supported by the check
    box button model.
</p>
<p>
    <strong>Table . </strong>Properties defined by com.sun.star.awt.UnoControlCheckBoxModel.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpText
            </td>
            <td>
                Dialog’s help text as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpURL
            </td>
            <td>
                Dialog’s help URL as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Label
            </td>
            <td>
                String label displayed on the control.
            </td>
        </tr>
        <tr class="even">
            <td>
                Printable
            </td>
            <td>
                If True, the button is printed when the document is printed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                State
            </td>
            <td>
                If 0, the button is not checked; if 1, the button is checked; 2 is the “don’t know” state.
            </td>
        </tr>
        <tr class="even">
            <td>
                Tabstop
            </td>
            <td>
                If True, the control can be reached by using the Tab key.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextColor
            </td>
            <td>
                Dialog’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextLineColor
            </td>
            <td>
                Dialog’s text line color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TriState
            </td>
            <td>
                If True, the button supports the “don’t know” state of 2.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                Add a check box to the OOMESample dialog and name it CheckBox. The “When initiating” event will call
                OOMEDlgCheckBox in .
            </td>
        </tr>
    </tbody>
</table>
<p>
    Add a check box to the sample dialog and set the button name to CheckBox. In the RunOOMEDlg routine, add code to the
    initialization section to set the check box to be a tristate check box. The TriState property can also be enabled in
    the Properties dialog for the control in the Basic IDE.
</p>
<p>
    oOOMEDlg.getModel().getByName("CheckBox").TriState = True
</p>
<p>
    Add the code in and then set the “When initiating” event to call the routine in . When the check box is selected,
    its label is updated to show its state.
</p>
<p>
    <strong>Listing .<strong> Change the label on the checkbox to indicate state.</strong></strong>
</p>
<p>
    Sub OOMEDlgCheckBox
</p>
<p>
    Dim oModel
</p>
<p>
    oModel = oOOMEDlg.getModel().getByName("CheckBox")
</p>
<p>
    oModel.Label = "State " &amp; oModel.state
</p>
<p>
    ' If oModel.state = 0 Then
</p>
<p>
    ' oOOMEDlg.getModel().getByName("OBClear").state = 1
</p>
<p>
    ' ElseIf oModel.state = 1 Then
</p>
<p>
    ' oOOMEDlg.getModel().getByName("OBSet").state = 1
</p>
<p>
    ' ElseIf oModel.state = 2 Then
</p>
<p>
    ' oOOMEDlg.getModel().getByName("OBUnknown").state = 1
</p>
<p>
    ' End If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="radio-button">
                            <span id="anchor-487"></span>Radio button
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Radio buttons are usually used to select one item from a small list. (For a large list, it’s common to use a combo
    box or a list box.) Radio buttons are always used in a group, and only one radio button in each group is active at a
    time. When a radio button is selected, OOo automatically marks all other radio buttons in the same group as not
    active.
</p>
<p>
    Every control supports the UnoControlDialogElement service (see ). The TabIndex property specifies the order in
    which controls are visited while repeatedly pressing the Tab key. The TabIndex property is usually set in the IDE at
    design time by setting the control’s “order” property. Unfortunately, a different name is used in the IDE than in
    the defining service.
</p>
<p>
    In OOo, a visual grouping that uses an UnoControlGroupBox has no effect other than to draw a frame around the
    controls. In other words, it provides a visual reminder that the radio buttons should be grouped, but it does not
    group them. Radio buttons are in the same group if (and only if) they have a sequential tab order; in Visual Basic,
    radio buttons are grouped based on the group box. Create all of the radio buttons that will exist in a single group
    in sequence. By creating the buttons sequentially, they will automatically have sequential tab stops and will
    therefore all be in the same group. If you then create a group box to place around the radio buttons, the group box
    will break the tab-stop sequence so that you can safely create a new sequence of radio buttons. See .
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlRadioButtonModel.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpText
            </td>
            <td>
                Dialog’s help text as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpURL
            </td>
            <td>
                Dialog’s help URL as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Label
            </td>
            <td>
                String label displayed on the control.
            </td>
        </tr>
        <tr class="even">
            <td>
                Printable
            </td>
            <td>
                If True, the button is printed when the document is printed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                State
            </td>
            <td>
                If 0, the button is not checked; if 1, the button is checked.
            </td>
        </tr>
        <tr class="even">
            <td>
                Tabstop
            </td>
            <td>
                If True, the control can be reached by using the Tab key.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextColor
            </td>
            <td>
                Dialog’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextLineColor
            </td>
            <td>
                Dialog’s text line color as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                Add three radio buttons to the OOMESample dialog.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Add three radio buttons to the sample dialog and name them OBSet, OBClear, and OBUnknown. The three radio buttons
    will influence the state of the check box, so set an appropriate label as well (see ). In other words, the OBSet
    button will set the check box, the OBClear radio button will clear the check box, and the OBUnknown radio button
    will set the check box to the “don’t know” state of 3. Enter the macro in <strong> </strong>and then set the “When
    initiating” event to call the OOMEDlgRadioButton routine for each of the three radio buttons. Each of the radio
    buttons is inspected to see which one is currently selected.
</p>
<p>
    <strong>Listing .<strong> Handle the sample radio buttons.</strong></strong>
</p>
<p>
    REM When a radio button is selected, set the state of the check box
</p>
<p>
    REM based on which radio button is selected. Set the check box
</p>
<p>
    REM label to indicate why the check box was set to that state.
</p>
<p>
    Sub OOMEDlgRadioButton
</p>
<p>
    Dim oModel
</p>
<p>
    Dim i As Integer
</p>
<p>
    Dim sBNames (0 To 2) As String
</p>
<p>
    REM These are ordered so that the button names are in the order
</p>
<p>
    REM that will set the check box state.
</p>
<p>
    sBNames(0) = "OBClear" : sBNames(1) = "OBSet" : sBNames(2) = "OBUnknown"
</p>
<p>
    For i = 0 To 2
</p>
<p>
    oModel = oOOMEDlg.getModel().getByName(sbNames(i))
</p>
<p>
    If oModel.State = 1 Then
</p>
<p>
    oOOMEDlg.getModel().getByName("CheckBox").State = i
</p>
<p>
    oOOMEDlg.getModel().getByName("CheckBox").Label = "Set by " &amp; sBNames(i)
</p>
<p>
    REM oOOMEDlg.getModel().getByName("RBFrame").Label = sBNames(i)
</p>
<p>
    Exit For
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<p>
    Change the code for the checkbox as follows
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="group-box">
                            <span id="anchor-488"></span>Group box
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The purpose of a group box is to draw a visual frame<em><em>—</em></em>a useful visual cue to the user that a group
    of controls are related in some way. The group box model supports the properties Enabled, FontDescriptor,
    FontEmphasisMark, FontRelief, HelpText, HelpURL, TextColor, TextLineColor, Label, and Printable.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                Draw a group box around the three radio buttons in the OOMESample dialog.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Draw a group box around the three radio buttons and name the group box RBFrame. The macro in contains one line of
    code that will set the frame label to the name of the currently selected radio button. Remove the comment mark (REM)
    from the front of this line or the frame label will not update.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="fixed-line-control">
                            <span id="anchor-489"></span>Fixed line control
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The fixed line control, like the group box control, provides a nice visual separator for the user. Its only purpose
    is to draw a separating line in the dialog. The only interesting property in the fixed-line-control model is the
    Orientation property, which specifies if the line is drawn horizontally (0) or vertically (1).
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="combo-box">
                            <span id="anchor-490"></span>Combo box
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A combo box, sometimes called a “drop-down” control, is an input field with an attached list box. The combo box
    control is used to select a single value. The attached list box facilitates selecting a value from a predefined
    list. The selected text is available from the Text property in the control’s model. See .
</p>
<p>
    <strong>Table . </strong>Properties defined by com.sun.star.awt.UnoControlComboBoxModel.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Autocomplete
            </td>
            <td>
                If True, automatic completion of text is enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2) as an Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Dropdown
            </td>
            <td>
                If True, the control contains a drop-down button.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineCount
            </td>
            <td>
                Maximum line count displayed in the drop-down box.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MaxTextLen
            </td>
            <td>
                Maximum character count. If 0, the text length is unlimited.
            </td>
        </tr>
        <tr class="even">
            <td>
                Printable
            </td>
            <td>
                If True, the button is printed when the document is printed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ReadOnly
            </td>
            <td>
                If True, the Text entry cannot be modified by the user.
            </td>
        </tr>
        <tr class="even">
            <td>
                StringItemList
            </td>
            <td>
                Array of strings that identify the items in the list.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Tabstop
            </td>
            <td>
                If True, the control can be reached by using the Tab key.
            </td>
        </tr>
        <tr class="even">
            <td>
                Text
            </td>
            <td>
                Text that is displayed in the input field section of the box.
            </td>
        </tr>
        <tr class="odd">
            <td>
                BackgroundColor
            </td>
            <td>
                Dialog’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpText
            </td>
            <td>
                Dialog’s help text as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpURL
            </td>
            <td>
                Dialog’s help URL as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextColor
            </td>
            <td>
                Dialog’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextLineColor
            </td>
            <td>
                Dialog’s text line color as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Although it is considered good practice to interact with a control through the control’s model, the combo box
    control contains some useful utility methods that are not directly available from the model. The methods listed in
    essentially provide a shortcut to writing your own array utility functions to add and remove items from the
    StringItemList array in .
</p>
<p>
    <strong>Table . </strong>Extra utility methods supported by the combo box control.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                addItem(String, position)
            </td>
            <td>
                Add an item at the specified position.
            </td>
        </tr>
        <tr class="even">
            <td>
                addItems(StringArray, position)
            </td>
            <td>
                Add multiple items at the specified position.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeItems(position, count)
            </td>
            <td>
                Remove a number of items at the specified position.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                Add a combo box to the OOMESample dialog and name it ColorBox.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Add a combo box to the dialog with a name of “ColorBox”. Select the “List entries” property and enter the three
    values “Red”, “Green”, and “Blue”. In earlier versions of OO, you entered multiple values by separating them with
    Ctrl+Enter. In AOO 3.4.1, use Shift+Enter. To place each entry on a separate line, type the word Red and press
    Shift+Enter, type the word Green and press Shift+Enter, and so on<em><em>—</em></em>it took me longer than it should
    have to figure out how to do this. It’s easy, of course, to simply set these values directly into the model by
    setting the StringItemList property shown in .
</p>
<p>
    Enter the code shown in and then set the “Text modified” event to call the OOMDDlgColorBox subroutine in . The “Text
    modified” event causes the subroutine to be called every time that the text in the input line changes. In other
    words, while typing text, the subroutine is called with every keystroke. If the “Item status changed” event is used,
    then the subroutine is called when a new selection is chosen from the drop-down list.
</p>
<p>
    The macro in changes the background color of the drop-down list box based on the value of the entered text. The text
    comparison is case sensitive, so the text in the drop-down box must match exactly.
</p>
<p>
    <strong>Listing .<strong> </strong><strong>Modify drop down list box background color.</strong></strong>
</p>
<p>
    Sub OOMEDlgColorBox
</p>
<p>
    Dim oModel
</p>
<p>
    Dim s As String
</p>
<p>
    oModel = oOOMEDlg.getModel().getByName("ColorBox")
</p>
<p>
    s = oModel.Text
</p>
<p>
    If s = "Red" Then
</p>
<p>
    REM Set to Red
</p>
<p>
    oModel.BackGroundColor = RGB(255, 0, 0)
</p>
<p>
    ElseIf s = "Green" Then
</p>
<p>
    REM Set to Green
</p>
<p>
    oModel.BackGroundColor = RGB(0, 255, 0)
</p>
<p>
    ElseIf s = "Blue" Then
</p>
<p>
    REM Set to Blue
</p>
<p>
    oModel.BackGroundColor = RGB(0, 0, 255)
</p>
<p>
    Else
</p>
<p>
    Rem set back to white
</p>
<p>
    oModel.BackGroundColor = RGB(255, 255, 255)
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="text-edit-controls">
                            <span id="anchor-491"></span>Text edit controls
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The UnoControlEdit service is a basic edit field that acts as the base service for the other edit fields. An edit
    control is used to hold regular text. It is possible to limit the length of the text and to even add scroll bars.
    The edit control model supports the properties shown in .
</p>
<p>
    <strong>Table . </strong>Properties defined by the com.sun.star.awt.UnoControlEditModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Align
            </td>
            <td>
                Specify that the text is aligned left (0), center (1), or right (2).
            </td>
        </tr>
        <tr class="even">
            <td>
                BackgroundColor
            </td>
            <td>
                Dialog’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2).
            </td>
        </tr>
        <tr class="even">
            <td>
                EchoChar
            </td>
            <td>
                A password field displays the character specified by this integer rather than the entered text.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HardLineBreaks
            </td>
            <td>
                If True, hard line breaks are returned by the control’s getText() method.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpText
            </td>
            <td>
                Dialog’s help text as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpURL
            </td>
            <td>
                Dialog’s help URL as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                HScroll
            </td>
            <td>
                If True, the text in the control can be scrolled in the horizontal direction.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MaxTextLen
            </td>
            <td>
                Maximum number of characters the control may contain. If zero, the text length is not purposely limited.
            </td>
        </tr>
        <tr class="even">
            <td>
                MultiLine
            </td>
            <td>
                If True, the text may use more than one line.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Printable
            </td>
            <td>
                If True, the control is printed with the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                ReadOnly
            </td>
            <td>
                If True, the control’s content cannot be modified by the user.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Tabstop
            </td>
            <td>
                If True, the control can be reached by using the Tab key.
            </td>
        </tr>
        <tr class="even">
            <td>
                Text
            </td>
            <td>
                The text that is displayed in the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextColor
            </td>
            <td>
                Dialog’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextLineColor
            </td>
            <td>
                Dialog’s text line color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                VScroll
            </td>
            <td>
                If True, the text in the control can be scrolled in the vertical direction.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Although I encourage you to use the model for most things, some features are not available without going directly to
    the control. For example, the control supplies the capability of selecting some or all of the text and determining
    which portion of the text is currently selected. In a regular document, the current controller provides this
    capability, but controls in dialogs combine the controller’s capabilities with the control itself. To obtain or set
    the selected range, use the Selection structure (see ).
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.Selection structure.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Min
            </td>
            <td>
                Lower limit of the range as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Max
            </td>
            <td>
                Upper limit of the range as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The control uses the Selection structure to get and set the current text selection range. The control is also able
    to directly return the text that is selected in a text control. The purpose is to allow a user to select only a
    portion of the text and to determine which portion is selected. contains the standard text methods supported by text
    type controls.
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.awt.XTextComponent interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                addTextListener(XTextListener)
            </td>
            <td>
                Add a text listener.
            </td>
        </tr>
        <tr class="even">
            <td>
                getMaxTextLen()
            </td>
            <td>
                Get the model’s MaxTextLen property (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                getSelectedText()
            </td>
            <td>
                Return the currently selected text string.
            </td>
        </tr>
        <tr class="even">
            <td>
                getSelection()
            </td>
            <td>
                Return a Selection object that identifies the selected text (see).
            </td>
        </tr>
        <tr class="odd">
            <td>
                getText()
            </td>
            <td>
                Get the model’s Text property (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                insertText(Selection, string)
            </td>
            <td>
                Insert the string at the specified Selection location.
            </td>
        </tr>
        <tr class="odd">
            <td>
                isEditable()
            </td>
            <td>
                Return the model’s ReadOnly flag (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                removeTextListener(XTextListener)
            </td>
            <td>
                Remove a text listener.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setEditable(boolean)
            </td>
            <td>
                Set the model’s ReadOnly flag (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                setMaxTextLen(len)
            </td>
            <td>
                Set the model’s MaxTextLen property (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                setSelection(Selection)
            </td>
            <td>
                Set the text that is selected (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                setText(string)
            </td>
            <td>
                Set the model’s Text property (see ).
            </td>
        </tr>
    </tbody>
</table>
<h4 id="currency-control">
    <span id="anchor-492"></span>Currency control
</h4>
<p>
    The currency control is used to input and edit monetary values. The currency control is defined by the
    UnoControlCurrencyField service, which also implements the standard edit control service. lists some properties that
    are unique to the currency model, all of which may also be set from the control’s property dialog in the IDE. Pay
    special attention to the default values, and notice that the property dialog uses Yes and No rather than True and
    False. Besides the specific properties in , the currency control model also supports these properties:
    BackgroundColor, Border, Enabled, FontDescriptor, FontEmphasisMark, FontRelief, HelpText, HelpURL, Printable,
    ReadOnly, Tabstop, TextColor, and TextLineColor.
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlCurrencyFieldModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                CurrencySymbol
            </td>
            <td>
                Currency symbol as a String.
            </td>
            <td>
                $
            </td>
        </tr>
        <tr class="even">
            <td>
                DecimalAccuracy
            </td>
            <td>
                Decimal accuracy as an Integer.
            </td>
            <td>
                2
            </td>
        </tr>
        <tr class="odd">
            <td>
                PrependCurrencySymbol
            </td>
            <td>
                If True, the currency symbol is prepended to the currency amount.
            </td>
            <td>
                No
            </td>
        </tr>
        <tr class="even">
            <td>
                ShowThousandsSeparator
            </td>
            <td>
                If True, the thousands separator is displayed.
            </td>
            <td>
                No
            </td>
        </tr>
        <tr class="odd">
            <td>
                Spin
            </td>
            <td>
                If True, the control has a spin button.
            </td>
            <td>
                No
            </td>
        </tr>
        <tr class="even">
            <td>
                StrictFormat
            </td>
            <td>
                If True, the entered text is checked during the user input.
            </td>
            <td>
                No
            </td>
        </tr>
        <tr class="odd">
            <td>
                Value
            </td>
            <td>
                The value displayed in the control as a floating-point Double.
            </td>
            <td>
                0
            </td>
        </tr>
        <tr class="even">
            <td>
                ValueMax
            </td>
            <td>
                The maximum value as a floating-point Double.
            </td>
            <td>
                1000000
            </td>
        </tr>
        <tr class="odd">
            <td>
                ValueMin
            </td>
            <td>
                The minimum value as a floating-point Double.
            </td>
            <td>
                -1000000.00
            </td>
        </tr>
        <tr class="even">
            <td>
                ValueStep
            </td>
            <td>
                The amount that the spin button changes the entered values as a Double.
            </td>
            <td>
                1
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The default values shown in are for the United States. Local specific default<br /> values are used.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The XCurrencyField interface implemented by the currency control defines methods to get and set the properties
    defined in . The XSpinField interface, which is also supported by the currency control, defines methods to interact
    with the spin control (see ).
</p>
<p>
    <strong>Table . </strong>Methods defined by the the com.sun.star.awt.XSpinField interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                addSpinListener(XSpinListener)
            </td>
            <td>
                Add a spin listener.
            </td>
        </tr>
        <tr class="even">
            <td>
                down()
            </td>
            <td>
                Decreases the value by ValueStep (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                enableRepeat(boolean)
            </td>
            <td>
                Enable/disable automatic repeat mode.
            </td>
        </tr>
        <tr class="even">
            <td>
                first()
            </td>
            <td>
                Set the value to ValueMin (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                last()
            </td>
            <td>
                Set the value to ValueMax (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                removeSpinListener(XSpinListener)
            </td>
            <td>
                Remove a spin listener.
            </td>
        </tr>
        <tr class="odd">
            <td>
                up()
            </td>
            <td>
                Increases the value by ValueStep (see ).
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                All of the edit controls that support spin buttons also support the methods in .
            </td>
        </tr>
    </tbody>
</table>
<h4 id="numeric-control">
    <span id="anchor-493"></span>Numeric control
</h4>
<p>
    The numeric control is used to accept numeric input. The numeric control is almost identical to the currency control
    except that the numeric control does not support the properties CurrencySymbol or
    PrependCurrencySymbol<em><em>—</em></em>even the default values are the same. If you know how to use a currency
    control, you know how to use a numeric control.
</p>
<h4 id="date-control">
    <span id="anchor-494"></span>Date control
</h4>
<p>
    The date control is a text-edit control that supports date input. The input formats supported by the date control
    are predefined and set based on a numeric constant (see ). The descriptions show formats such as (DD/MM/YY), but in
    reality, the separator is locale specific. In other words, dates are shown and edited in a way that is appropriate
    for where you live. The last two formats are not locale specific because they are described by the ISO 8601
    standard.
</p>
<p>
    The date control (see for its model properties) is similar to the currency control in that it supports a minimum
    value, a maximum value, and a spin control. The spin control works by incrementing or decrementing the portion of
    the date in which it resides. For example, if the cursor is in the month field, the spin control affects the month
    rather than the year or the day.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                The DropDown property allows for a drop-down calendar that greatly facilitates date entry.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table . </strong>Date input formats supported by a Date control.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                Default system short format.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                Default system short format with a two-digit year (YY).
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                Default system short format with a four-digit year (YYYY).
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                Default system long format.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                Short format (DD/MM/YY).
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                Short format (MM/DD/YY).
            </td>
        </tr>
        <tr class="odd">
            <td>
                6
            </td>
            <td>
                Short format (YY/MM/DD).
            </td>
        </tr>
        <tr class="even">
            <td>
                7
            </td>
            <td>
                Short format (DD/MM/YYYY).
            </td>
        </tr>
        <tr class="odd">
            <td>
                8
            </td>
            <td>
                Short format (MM/DD/YYYY).
            </td>
        </tr>
        <tr class="even">
            <td>
                9
            </td>
            <td>
                Short format (YYYY/MM/DD).
            </td>
        </tr>
        <tr class="odd">
            <td>
                10
            </td>
            <td>
                Short format for ISO 8601 (YY-MM-DD).
            </td>
        </tr>
        <tr class="even">
            <td>
                11
            </td>
            <td>
                Short format for ISO 8601 (YYYY-MM-DD).
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlDateFieldModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BackgroundColor
            </td>
            <td>
                Dialog’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Date
            </td>
            <td>
                <p>
                    The date:
                </p>
                <p>
                    – as a Long Integer (AOO and old versions of LO)
                </p>
                <p>
                    – as a structure com.sun.star.util.Date (LO new, see Table 282).
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                DateFormat
            </td>
            <td>
                Date format as an Integer (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                DateMax
            </td>
            <td>
                Maximum allowed date as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                DateMin
            </td>
            <td>
                Minimum allowed date as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                DropDown
            </td>
            <td>
                If True, a drop-down exists that shows a calendar for choosing a date.
            </td>
        </tr>
        <tr class="even">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpText
            </td>
            <td>
                Dialog’s help text as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpURL
            </td>
            <td>
                Dialog’s help URL as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                Spin
            </td>
            <td>
                If True, spin buttons are drawn.
            </td>
        </tr>
        <tr class="odd">
            <td>
                StrictFormat
            </td>
            <td>
                If True, the date is checked during the user input.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextColor
            </td>
            <td>
                Dialog’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextLineColor
            </td>
            <td>
                Dialog’s text line color as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                <p>
                    Add a date input control to the OOMESample dialog and name it MyDateField.
                </p>
                <p>
                    Use the code in to initialize the date control.
                </p>
            </td>
        </tr>
    </tbody>
</table>
<p>
    The Date data type that is used by Basic is not compatible with the Date property used in a date control. It depends
    from the OpenOffice application used which data format you have to choose for a date control.
</p>
<p>
    In older versions of LO and in AOO (still at least in the latest version 4.1.1) the date control uses a Long that
    represents the date in the form YYYYMMDD. For example, “February 3, 2004” is represented as the long integer
    20040203. The Basic function CDateToIso() converts a Basic Date variable to the required format. Add a date input
    control and name it MyDateField. The code in sets the date control to the current day using the old method.
</p>
<p>
    <strong>Listing . </strong>Initialize a date control to today’s date (AOO and old LO).
</p>
<p>
    REM Set the initial date to TODAY
</p>
<p>
    oOOMEDlg.getModel().getByName("MyDateField").Date = CdateToIso(Date())
</p>
<p>
    LibreOffice made a change to use a structure, so the above code will fail on LO. You must instead create a
    com.sun.star.util.Date object (see) and then set the date with the new object.
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.util.Date structure
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Day
            </td>
            <td>
                Day of month. Integer (1-31 or 0 for a void date).
            </td>
        </tr>
        <tr class="even">
            <td>
                Month
            </td>
            <td>
                Month of year. Integer (1-12 or 0 for a void date).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Year
            </td>
            <td>
                Year. Integer.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Listing . </strong>Initialize a date control to today’s date. (new/current versions of LO)
</p>
<p>
    Dim x As Date
</p>
<p>
    Dim x2 as New com.sun.star.util.Date
</p>
<p>
    ....
</p>
<p>
    x = Date() 'Start with a date, then populate the struct:
</p>
<p>
    x2.Year = Year(x) ' Year
</p>
<p>
    x2.Month = Month(x) ' Month
</p>
<p>
    x2.Day = Day(x) ' Day
</p>
<p>
    oOOMEDlg.getModel().getByName("MyDateField").Date = x2 'Set the model Date
</p>
<p>
    Sadly there seems to be no workaround to work for both variations. If you need a date control in a macro that runs
    on AOO as well as on all LO versions you can control it by an error handler (see Listing 534). If you forgot how
    this works, recall section <a href="#anchor-95">3.10</a> <a href="#anchor-95">Error handling using On Error</a>. You
    can also call the GetProductName() macro in the Misc module in the Tools library, which is included with both AOO
    and LO.
</p>
<p>
    <strong>Listing . </strong>Initialize a date control to today’s date (works with all versions of AOO and LO).
</p>
<p>
    REM Initialize the date control.
</p>
<p>
    REM Set the initial date to TODAY.
</p>
<p>
    Dim tToday As Date
</p>
<p>
    tToday = Date()
</p>
<p>
</p>
<p>
    On Error Goto LO
</p>
<p>
    REM Try to initialize the control with a Long Integer.
</p>
<p>
    REM This is the correct format for AOO and for older versions of LO.
</p>
<p>
    oOOMEDlg.getModel().getByName("MyDateField").Date = CdateToIso(tToday)
</p>
<p>
    On Error Goto 0 'Clear the error handler.
</p>
<p>
    Goto GoOn
</p>
<p>
</p>
<p>
    LO:
</p>
<p>
    REM On Error the control is initialized using a structure.
</p>
<p>
    REM This is the correct format for newer versions of LO.
</p>
<p>
    On Error Goto 0 'Clear the error handler to prevent an infinite loop,
</p>
<p>
    'in case the macro runs into some other runtime error.
</p>
<p>
    Dim oToday As New com.sun.star.util.Date
</p>
<p>
    oToday.Year = Year(tToday)
</p>
<p>
    oToday.Month = Month(tToday)
</p>
<p>
    oToday.Day = Day(tToday)
</p>
<p>
    oOOMEDlg.getModel().getByName("MyDateField").Date = oToday
</p>
<p>
</p>
<p>
    GoOn:
</p>
<p>
    Although the control implements methods that get and set properties in the model, the more interesting methods are
    related to the user interface. While using a date field, press the Page Up key to cause the control to jump to the
    “last” date. By default, the last date is the same as the DateMax property. The last date is set by the control and
    not by the model, and it may differ from the DateMax. Analogously, the pressing the Page Down key causes the control
    to jump to the “first” date. The first and last dates are set using the setFirst() and setLast() methods shown in .
    Use the method isEmpty() to determine if the control contains no value, and use the method setEmpty() to cause the
    control to contain no value.
</p>
<p>
    <strong>Table . </strong>Methods in the com.sun.star.awt.UnoControlDateField interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                <p>
                    setDate(long) [LO old and AOO]
                </p>
                <p>
                    setDate(com.sun.star.util.Date) [LO new]
                </p>
            </td>
            <td>
                Set the model’s Date property.
            </td>
        </tr>
        <tr class="even">
            <td>
                getDate()
            </td>
            <td>
                Get the model’s Date property.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setMin(long)
            </td>
            <td>
                Set the model’s DateMin property.
            </td>
        </tr>
        <tr class="even">
            <td>
                getMin(long)
            </td>
            <td>
                Get the model’s DateMin property.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setMax(long)
            </td>
            <td>
                Set the model’s DateMax property.
            </td>
        </tr>
        <tr class="even">
            <td>
                getMax(long)
            </td>
            <td>
                Get the model’s DateMax property.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setFirst(long)
            </td>
            <td>
                Set the date used for the Page Down key.
            </td>
        </tr>
        <tr class="even">
            <td>
                getFirst()
            </td>
            <td>
                Get the date used for the Page Down key.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setLast(long)
            </td>
            <td>
                Set the date used for the Page Up key.
            </td>
        </tr>
        <tr class="even">
            <td>
                getLast()
            </td>
            <td>
                Get the date used for the Page Up key.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setLongFormat(boolean)
            </td>
            <td>
                Set to use the long date format.
            </td>
        </tr>
        <tr class="even">
            <td>
                isLongFormat()
            </td>
            <td>
                Return True if the long date format is used.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setEmpty()
            </td>
            <td>
                Set the empty value.
            </td>
        </tr>
        <tr class="even">
            <td>
                isEmpty()
            </td>
            <td>
                Return True if the current value is empty.
            </td>
        </tr>
        <tr class="odd">
            <td>
                setStrictFormat(boolean)
            </td>
            <td>
                Set the model’s StrictFormat property.
            </td>
        </tr>
        <tr class="even">
            <td>
                isStrictFormat()
            </td>
            <td>
                Get the model’s StrictFormat property.
            </td>
        </tr>
    </tbody>
</table>
<h4 id="time-control">
    <span id="anchor-495"></span>Time control
</h4>
<p>
    The time control is very similar to the date control. Time values may indicate either a time on a clock or a length
    of time (duration). The supported formats are shown in .
</p>
<p>
    <strong>Table . </strong>Time input formats supported by a time control.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                Short 24-hour format.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                Long 24-hour format.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                Short 12-hour format.
            </td>
        </tr>
        <tr class="even">
            <td>
                3
            </td>
            <td>
                Long 12-hour format.
            </td>
        </tr>
        <tr class="odd">
            <td>
                4
            </td>
            <td>
                Short time duration.
            </td>
        </tr>
        <tr class="even">
            <td>
                5
            </td>
            <td>
                Long time duration.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The properties supported by the time-control model are shown in . Modify by changing the word Date to Time, and by
    removing the DropDown property, and becomes . In other words, the date and time models are almost identical.
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlTimeFieldModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Time
            </td>
            <td>
                <p>
                    The time displayed in the control:
                </p>
                <p>
                    – as a Long Integer (LO old and AOO)
                </p>
                <p>
                    – as a structure com.sun.star.util.Time (LO new, see Table 286).
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                TimeFormat
            </td>
            <td>
                Time format as an Integer (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                TimeMax
            </td>
            <td>
                Maximum allowed date as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TimeMin
            </td>
            <td>
                Minimum allowed date as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Spin
            </td>
            <td>
                If True, spin buttons are drawn.
            </td>
        </tr>
        <tr class="even">
            <td>
                StrictFormat
            </td>
            <td>
                If True, the date is checked during the user input.
            </td>
        </tr>
    </tbody>
</table>
<p>
    As expected, the methods supported by the date control are similar to the methods supported by the time control (see
    ). There are two differences: The time control has getTime() and setTime() rather than getDate() and setDate(), and
    the time control does not support the methods setLongFormat() and isLongFormat().
</p>
<p>
    In older versions of LO and in AOO (still at least in the latest version 4.1.1) the time control uses a Long Integer
    to store and return the entered value. The rightmost two digits represent fractions of a second, the next two digits
    represent seconds, the next two digits represent minutes, and the leftmost two digits represent hours. Leading zeros
    are, of course, not returned because the value is really a Long Integer. The good news, however, is that the values
    are easy to extract. Assuming that the dialog contains a time field named MyTimeField, the code in obtains the time
    value and extracts the hours, minutes, seconds, and portions of a second.
</p>
<p>
    <strong>Listing . </strong>Extracting values from a time control (AOO and old versions of LO).
</p>
<p>
    n = oOOMEDlg.getModel().getByName("MyTimeField").Time
</p>
<p>
    h = n / 1000000 MOD 100 REM Get the hours
</p>
<p>
    m = n / 10000 MOD 100 REM Get the minutes
</p>
<p>
    s = n / 100 MOD 100 REM Get the seconds
</p>
<p>
    ss = n MOD 100 REM portions of a second
</p>
<p>
    The new versions of LO use the com.sun.star.util.Time structure for the time control, see .
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.util.Time structure..
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                <p>
                    HundredthSeconds [LO old and AOO]
                </p>
                <p>
                    NanoSeconds [LO new]
                </p>
            </td>
            <td>
                <p>
                    Portions of a second:
                </p>
                <p>
                    Integer (0 – 99)
                </p>
                <p>
                    Long Integer (0 – 999 999 999)
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                Seconds
            </td>
            <td>
                Integer (0 – 59).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Minutes
            </td>
            <td>
                Integer (0 – 59).
            </td>
        </tr>
        <tr class="even">
            <td>
                Hours
            </td>
            <td>
                Integer (0 – 23).
            </td>
        </tr>
        <tr class="odd">
            <td>
                IsUTC [only LO new]
            </td>
            <td>
                True: time zone is UTC, False: unknown time zone.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Reading a time value from a time control in newer versions of LO needs a variable of the com.sun.star.util.Time
    structure type, see .
</p>
<p>
    <strong>Listing . </strong>Extracting values from a time control (LO new).
</p>
<p>
    Dim oTime As New com.sun.star.util.Time
</p>
<p>
    oTime = oOOMEDlg.getModel().getByName("MyTimeField").Time
</p>
<p>
    h = oTime.Hours REM Get the hours.
</p>
<p>
    m = oTime.Minutes REM Get the minutes.
</p>
<p>
    s = oTime.Seconds REM Get the seconds.
</p>
<p>
    ss = oTime.NanoSeconds REM Get the portions of a second.
</p>
<p>
    If you need a time control in a macro that runs with AOO as well as with all LO versions you can control it with an
    error handler like the one for the date control in .
</p>
<h4 id="formatted-control">
    <span id="anchor-496"></span>Formatted control
</h4>
<p>
    The formatted control is a generic number input field. Numbers can be entered as a formatted number, percent,
    currency, date, time, scientific, fraction, or Boolean number. Unfortunately, this level of control comes with a
    price. The formatted control requires a numeric formatter provided by OpenOffice.org to function. The easiest method
    to associate a formatted control to a numeric format object is to use the Properties dialog in the IDE. To use a
    number formatter, the following sequence of events is likely to occur:
</p>
<ul>
    <li>
        Choose a numeric format.
    </li>
    <li>
        Use the methods in to search the FormatsSupplier (see Table 29) using the constants in to find or create a
        suitable number formatter.
    </li>
    <li>
        Set the FormatKey (see ) to reference the desired format contained in the FormatsSupplier.
    </li>
</ul>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlFormattedFieldModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Align
            </td>
            <td>
                Specify that the text is aligned left (0), center (1), or right (2).
            </td>
        </tr>
        <tr class="even">
            <td>
                BackgroundColor
            </td>
            <td>
                Dialog's background color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2).
            </td>
        </tr>
        <tr class="even">
            <td>
                EffectiveDefault
            </td>
            <td>
                The default value of the formatted field. This is a number or a string based on TreatAsNumber.
            </td>
        </tr>
        <tr class="odd">
            <td>
                EffectiveMax
            </td>
            <td>
                The maximum value as a Double if TreatAsNumber is True.
            </td>
        </tr>
        <tr class="even">
            <td>
                EffectiveMin
            </td>
            <td>
                The minimum value as a Double if TreatAsNumber is True.
            </td>
        </tr>
        <tr class="odd">
            <td>
                EffectiveValue
            </td>
            <td>
                The current value as a Double or a String based on the value of TreatAsNumber.
            </td>
        </tr>
        <tr class="even">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                FormatKey
            </td>
            <td>
                Long Integer that specifies the format for formatting.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FormatsSupplier
            </td>
            <td>
                XNumberFormatsSupplier that supplies the formats used by this control.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpText
            </td>
            <td>
                Dialog’s help text as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpURL
            </td>
            <td>
                Dialog’s help URL as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                MaxTextLen
            </td>
            <td>
                Maximum number of characters the control may contain. If zero, the text length is not purposely limited.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Printable
            </td>
            <td>
                If True, the control is printed with the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                ReadOnly
            </td>
            <td>
                If True, the control’s content cannot be modified by the user.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Spin
            </td>
            <td>
                If True, a spin control is used.
            </td>
        </tr>
        <tr class="even">
            <td>
                StrictFormat
            </td>
            <td>
                If True, the text is checked during the user input.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Tabstop
            </td>
            <td>
                If True, the control can be reached by using the Tab key.
            </td>
        </tr>
        <tr class="even">
            <td>
                Text
            </td>
            <td>
                The text that is displayed in the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextColor
            </td>
            <td>
                Dialog’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextLineColor
            </td>
            <td>
                Dialog’s text line color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TreatAsNumber
            </td>
            <td>
                If True, the text is treated as a number. This property controls how the other values are treated.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The number formatter that controls the formatting in the input box must be created by the number format supplier in
    the FormatsSupplier property. In other words, you can’t simply take a number formatter created by the document or
    some other number formatter. When the formats supplier is searched to determine what numeric formats it contains,
    the constants in the NumberFormat constant group are used (see ).
</p>
<p>
    <strong>Table . </strong>Constants in the com.sun.star.util.NumberFormat constant group.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                0
            </td>
            <td>
                ALL
            </td>
            <td>
                All number formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                1
            </td>
            <td>
                DEFINED
            </td>
            <td>
                User-defined number formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2
            </td>
            <td>
                DATE
            </td>
            <td>
                Date formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                4
            </td>
            <td>
                TIME
            </td>
            <td>
                Time formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                8
            </td>
            <td>
                CURRENCY
            </td>
            <td>
                Currency formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                16
            </td>
            <td>
                NUMBER
            </td>
            <td>
                Decimal number formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                32
            </td>
            <td>
                SCIENTIFIC
            </td>
            <td>
                Scientific number formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                64
            </td>
            <td>
                FRACTION
            </td>
            <td>
                Number formats for fractions.
            </td>
        </tr>
        <tr class="odd">
            <td>
                128
            </td>
            <td>
                PERCENT
            </td>
            <td>
                Percentage number formats.
            </td>
        </tr>
        <tr class="even">
            <td>
                256
            </td>
            <td>
                TEXT
            </td>
            <td>
                Text number formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                6
            </td>
            <td>
                DATETIME
            </td>
            <td>
                Number formats that contain date and time.
            </td>
        </tr>
        <tr class="even">
            <td>
                1024
            </td>
            <td>
                LOGICAL
            </td>
            <td>
                Boolean number formats.
            </td>
        </tr>
        <tr class="odd">
            <td>
                2048
            </td>
            <td>
                UNDEFINED
            </td>
            <td>
                Used if no number format exists.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The formatted control model contains a number format supplier in the FormatsSupplier property. The supplier
    identifies its contained numeric formats based on a numeric key. The FormatKey property in must be set with the key
    obtained from the FormatsSupplier. Use the methods in to find or create the numeric format for the formatted
    control.
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlFormattedFieldModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                getByKey(key)
            </td>
            <td>
                Return the com.sun.star.util.NumberFormatProperties based on the numeric key.
            </td>
        </tr>
        <tr class="even">
            <td>
                queryKeys(NumberFormat, Locale, boolean)
            </td>
            <td>
                Return an array of Long Integer keys that identify numeric formats of the specified type (see ) for the
                specified locale. If the final Boolean parameter is True and if no formats exist, one will be created.
            </td>
        </tr>
        <tr class="odd">
            <td>
                queryKey(format, Locale, boolean)
            </td>
            <td>
                Return the Long Integer key for the specified format string.
            </td>
        </tr>
        <tr class="even">
            <td>
                addNew(format, Locale)
            </td>
            <td>
                Add a number format and return the Long Integer key.
            </td>
        </tr>
        <tr class="odd">
            <td>
                addNewConverted(format, Locale, Locale)
            </td>
            <td>
                Add a number format, using a format string in a locale that is different than the desired locale.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeByKey(key)
            </td>
            <td>
                Remove a number format based on the Long Integer key.
            </td>
        </tr>
        <tr class="odd">
            <td>
                generateFormat(key, Locale, bThousands, bRed, nDecimals, nLeading)
            </td>
            <td>
                Return a format string based on the input values, but do not actually create the number format.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                Add a formatted control to the OOMESample dialog.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Although it is not overly difficult to use the methods in to find and create your own numeric formats,<br /> the
    easiest method to associate a formatted control to a numeric format object is to use the Properties dialog in the
    IDE. Add a formatted control to the dialog and name it MyFormattedField. The code in initializes the control to use
    the current date as its initial value and sets the desired date format. The date is formatted using the format “DD.
    MMM YYYY”.
</p>
<p>
    <strong>Listing . </strong>Set a formatted control to use a date as “DD. MMM YYYY”.
</p>
<p>
    REM Set the formatted field to a specific format.
</p>
<p>
    Dim oFormats 'All of the format objects
</p>
<p>
    Dim oSupplier 'All of the format objects
</p>
<p>
    Dim nKey As Long 'Index of number format in the number formats
</p>
<p>
    Dim oLocale as new com.sun.star.lang.Locale
</p>
<p>
    Dim sFormat As String
</p>
<p>
</p>
<p>
    sFormat = "DD. MMM YYYY"
</p>
<p>
    oSupplier =oOOMEDlg.getModel().getByName("MyFormattedField").FormatsSupplier
</p>
<p>
    oFormats =oSupplier.getNumberFormats()
</p>
<p>
</p>
<p>
    REM See if the number format exists by obtaining the key.
</p>
<p>
    nKey = oFormats.queryKey(sFormat, oLocale, True)
</p>
<p>
</p>
<p>
    REM If the number format does not exist, add it.
</p>
<p>
    If (nKey = -1) Then
</p>
<p>
    nKey = oFormats.addNew(sFormat, oLocale)
</p>
<p>
    REM If it failed to add, and it should not fail to add, then use zero.
</p>
<p>
    If (nKey = -1) Then nKey = 0
</p>
<p>
    End If
</p>
<p>
    REM I can set the date using a string or the date.
</p>
<p>
    REM ....EffectiveValue = "12. Apr 2004"
</p>
<p>
    REM ...EffectiveValue = Date() fails but this works.
</p>
<p>
    oOOMEDlg.getModel().getByName("MyFormattedField").EffectiveValue = CStr(Date())
</p>
<p>
    REM Now, set the key for the desired date formatting.
</p>
<p>
    REM I set this to treat the value as a number.
</p>
<p>
    oOOMEDlg.getModel().getByName("MyFormattedField").FormatKey = nKey
</p>
<p>
    oOOMEDlg.getModel().getByName("MyFormattedField").TreatAsNumber = True
</p>
<p>
    There are a couple of interesting things to notice in . First, the EffectiveValue property is used rather than the
    Text property (which I can use). The TreatAsNumber property is set to True because the spin control does not
    properly increment an initial date if the TreatAsNumber property is set to False. Although it is not shown, the
    formatted control uses the same numeric values for dates as the Basic Date data type<em><em>—</em></em>unlike the
    Date control. Finally, the spin button in a formatted control always increments and decrements the value by
    1<em><em>—</em></em>unlike the Date control, which can independently increment and decrement each portion of the
    date.
</p>
<h4 id="pattern-control">
    <span id="anchor-497"></span>Pattern control
</h4>
<p>
    Use a pattern control to enter formatted strings based on an edit mask and a literal mask. The literal mask is the
    string value that is initially displayed when the control starts. The user then edits the value in the control but
    is limited by the edit mask. The edit mask contains special characters that define what value can be entered at
    which location. For example, the character L (literal) indicates that the user cannot enter a value at the specified
    location, and the value N (number) indicates that the user can only enter the characters 0 through 9.
</p>
<p>
    In the United States, each person is issued an identification number for tax purposes called a social security
    number. The social security number is composed of three numbers, a dash, two numbers, a dash, and four numbers. The
    edit mask is given as “NNNLNNLNNN”. This allows the user to enter numeric values at the appropriate locations, but
    prevents any modifications where the dashes are located. A literal mask of the form “___-__-___” provides the
    initial template for the user to see, as illustrated in . The use of the character “_” is an arbitrary choice; you
    may use any value that you desire, such as a space character.
</p>
<p>
    <strong>Listing . </strong>Edit mask and literal mask for a social security number.
</p>
<p>
    EditMask = "NNNLNNLNNN"
</p>
<p>
    LiteralMask = "___-__-___"
</p>
<p>
    The number of characters that can be entered is determined by the length of the edit mask. It is considered an error
    if the edit mask and the literal mask are not the same length. shows the edit mask characters supported by the
    pattern control. The pattern field supports the properties in .
</p>
<p>
    <strong>Table . </strong>Edit mask characters supported by the pattern control.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                L
            </td>
            <td>
                A text constant that is displayed but cannot be edited.
            </td>
        </tr>
        <tr class="even">
            <td>
                a
            </td>
            <td>
                The characters a<em><em>–</em></em>z and A<em><em>–</em></em>Z can be entered.
            </td>
        </tr>
        <tr class="odd">
            <td>
                A
            </td>
            <td>
                The characters a<em><em>–</em></em>z and A<em><em>–</em></em>Z are valid, but the letters
                a<em><em>–</em></em>z are converted to uppercase.
            </td>
        </tr>
        <tr class="even">
            <td>
                c
            </td>
            <td>
                The characters a<em><em>–</em></em>z, A<em><em>–</em></em>Z, and 0<em><em>–</em></em>9 can be entered.
            </td>
        </tr>
        <tr class="odd">
            <td>
                C
            </td>
            <td>
                The characters a<em><em>–</em></em>z, A<em><em>–</em></em>Z, and 0<em><em>–</em></em>9 are valid, but
                the letters a<em><em>–</em></em>z are converted to uppercase.
            </td>
        </tr>
        <tr class="even">
            <td>
                N
            </td>
            <td>
                The characters 0<em><em>–</em></em>9 can be entered.
            </td>
        </tr>
        <tr class="odd">
            <td>
                x
            </td>
            <td>
                Any printable character can be entered.
            </td>
        </tr>
        <tr class="even">
            <td>
                X
            </td>
            <td>
                Any printable character can be entered, but the letters a<em><em>–</em></em>z are converted to
                uppercase.
            </td>
        </tr>
    </tbody>
</table>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlPatternFieldModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BackgroundColor
            </td>
            <td>
                Dialog’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2).
            </td>
        </tr>
        <tr class="odd">
            <td>
                EditMask
            </td>
            <td>
                The edit mask.
            </td>
        </tr>
        <tr class="even">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the dialog’s caption bar.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpText
            </td>
            <td>
                Dialog’s help text as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpURL
            </td>
            <td>
                Dialog’s help URL as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                LiteralMask
            </td>
            <td>
                The literal mask.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MaxTextLen
            </td>
            <td>
                Maximum number of characters the control may contain. If zero, the text length is not purposely limited.
            </td>
        </tr>
        <tr class="even">
            <td>
                Printable
            </td>
            <td>
                If True, the control is printed with the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ReadOnly
            </td>
            <td>
                If True, the control’s content cannot be modified by the user.
            </td>
        </tr>
        <tr class="even">
            <td>
                StrictFormat
            </td>
            <td>
                If True, the text is checked during the user input.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Tabstop
            </td>
            <td>
                If True, the control can be reached by using the Tab key.
            </td>
        </tr>
        <tr class="even">
            <td>
                Text
            </td>
            <td>
                The text that is displayed in the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextColor
            </td>
            <td>
                Dialog’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextLineColor
            </td>
            <td>
                Dialog’s text line color as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                If the StrictFormat property is False, the pattern control ignores the edit mask and the literal mask.
            </td>
        </tr>
    </tbody>
</table>
<h4 id="fixed-text-control">
    <span id="anchor-498"></span>Fixed text control
</h4>
<p>
    Use the fixed text control to label other controls and areas in a dialog. In the IDE, the fixed text control is
    called a “label field.” The fixed text control is a very simple text edit field. The model supports the properties
    in .
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlFixedTextFieldModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Align
            </td>
            <td>
                Specify that the text is aligned left (0), center (1), or right (2).
            </td>
        </tr>
        <tr class="even">
            <td>
                BackgroundColor
            </td>
            <td>
                Control’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2).
            </td>
        </tr>
        <tr class="even">
            <td>
                Enabled
            </td>
            <td>
                If True, the control is enabled.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the control.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the control.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpText
            </td>
            <td>
                Control’s help text as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpURL
            </td>
            <td>
                Control’s help URL as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                Label
            </td>
            <td>
                Text label displayed in the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MultiLine
            </td>
            <td>
                If True, the text may use more than one line.
            </td>
        </tr>
        <tr class="even">
            <td>
                Printable
            </td>
            <td>
                If True, the control is printed with the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextColor
            </td>
            <td>
                Control’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextLineColor
            </td>
            <td>
                Control’s text line color as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<h4 id="file-control">
    <span id="anchor-499"></span>File control
</h4>
<p>
    The file control is a text edit control that contains a command button, which opens the File dialog. The initial
    directory that is used is set by the Text property. contains the properties defined by the file control model.
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlFileControlModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BackgroundColor
            </td>
            <td>
                Control’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Enabled
            </td>
            <td>
                If True, the control is enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the control.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpText
            </td>
            <td>
                Control’s help text as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpURL
            </td>
            <td>
                Control’s help URL as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Printable
            </td>
            <td>
                If True, the control is printed with the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                Text
            </td>
            <td>
                The text displayed in the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextColor
            </td>
            <td>
                Control’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextLineColor
            </td>
            <td>
                Control’s text line color as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<p>
    The file control is easy to use, but unfortunately it doesn’t support using filters. A frequent solution for this is
    to add a text input box with a button next to it. When the button is selected, it opens a file selection dialog with
    the desired filters. When the dialog is closed, it adds the selected file to the text control.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                Add a text field named FileTextField to the OOMESample dialog. Add a button next to the text field that
                calls the macro in .
            </td>
        </tr>
    </tbody>
</table>
<p>
    Create a text field and name it FileTextField. Add a button next to the text field and set the “When initiating”
    event to call the macro in . This macro opens a file selection dialog based on the directory or file stored in the
    FileTextfield. If the text field is empty, the macro checks the configuration information to determine the starting
    directory. The interesting thing about this example is that it uses multiple file
    filters<em><em>—</em></em>something that isn’t possible if a file control is used.
</p>
<p>
    <strong>Listing .<strong> </strong><strong>Select a file.</strong></strong>
</p>
<p>
    Sub FileButtonSelected
</p>
<p>
    Dim oFileDlg 'File selection dialog
</p>
<p>
    Dim oSettings 'Settings object to get the path settings
</p>
<p>
    Dim sFile As String 'File URL as a string
</p>
<p>
    Dim oFileAccess 'Simple file access object
</p>
<p>
    Dim oFiles 'The File dialog returns an array of selected files
</p>
<p>
</p>
<p>
    REM Start with the value in the text field
</p>
<p>
    sFile = oOOMEDlg.getModel().getByName("FileTextField").Text
</p>
<p>
    If sFile &lt;&gt; "" Then
</p>
<p>
    sFile = ConvertToURL(sFile)
</p>
<p>
    Else
</p>
<p>
    REM The text field is blank, so obtain the path settings
</p>
<p>
    oSettings = CreateUnoService("com.sun.star.util.PathSettings")
</p>
<p>
    sFile = oSettings.Work
</p>
<p>
    End If
</p>
<p>
    REM Dialog to select a file
</p>
<p>
    oFileDlg = CreateUnoService("com.sun.star.ui.dialogs.FilePicker")
</p>
<p>
</p>
<p>
    REM Set the supported filters
</p>
<p>
    oFileDlg.AppendFilter( "All files (*.*)", "*.*" )
</p>
<p>
    oFileDlg.AppendFilter( "JPG files (*.jpg)", "*.jpg" )
</p>
<p>
    oFileDlg.AppendFilter( "OOo Writer (*.sxw)", "*.sxw")
</p>
<p>
    oFileDlg.AppendFilter( "OOo Calc (*.sxc)", "*.sxc")
</p>
<p>
    oFileDlg.AppendFilter( "OOo Draw (*.sxd)", "*.sxd")
</p>
<p>
    oFileDlg.AppendFilter( "OOo Impress (*.sxi)", "*.sxi")
</p>
<p>
    oFileDlg.SetCurrentFilter( "All files (*.*)" )
</p>
<p>
</p>
<p>
    REM Determine if the "file" is a directory or a file!
</p>
<p>
    oFileAccess = CreateUnoService("com.sun.star.ucb.SimpleFileAccess")
</p>
<p>
    If oFileAccess.exists(sFile) Then
</p>
<p>
    REM I do not force the "display directory" to be a folder.
</p>
<p>
    REM I could do something fancy with this such as
</p>
<p>
    REM If NOT oFileAccess.isFolder(sFile) Then extract the folder...
</p>
<p>
    REM but I won't!
</p>
<p>
    oFileDlg.setDisplayDirectory(sFile)
</p>
<p>
    End If
</p>
<p>
    REM Execute the File dialog.
</p>
<p>
    If oFileDlg.execute() Then
</p>
<p>
    oFiles = oFileDlg.getFiles()
</p>
<p>
    If UBound(oFiles) &gt;= 0 Then
</p>
<p>
    sFile = ConvertFromURL(oFiles(0))
</p>
<p>
    oOOMEDlg.getModel().getByName("FileTextField").Text = sFile
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="image-control">
                            <span id="anchor-500"></span>Image control
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    An image control is used to display a graphic image. The image control is able to automatically scale an image to
    fit inside the image control. Use the ImageURL property to specify the image to load and the ScaleImage property to
    tell the control to scale the image automatically (see ).
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlImageControlModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BackgroundColor
            </td>
            <td>
                Control’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpText
            </td>
            <td>
                Control’s help text as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpURL
            </td>
            <td>
                Control’s help URL as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                ImageURL
            </td>
            <td>
                URL of the image to load.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Printable
            </td>
            <td>
                If True, the control is printed with the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                ScaleImage
            </td>
            <td>
                If True, the image is automatically scaled to the size of the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TabStop
            </td>
            <td>
                If True, the Tab key can reach this control.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="progress-control">
                            <span id="anchor-501"></span>Progress control
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A progress bar is a straight bar that fills in a solid color starting at the left and moving to the right. The idea
    is that at the start the progress bar is empty, and it fills as work is accomplished. A typical example is the
    “Saving document” progress bar at the bottom of OpenOffice when you click the Save icon to save an open document.
</p>
<p>
    Use the ProgressValueMin and ProgressValueMax properties to tell the control the range of values that it will
    contain. When the ProgressValue property is at the minimum value, the control is empty<em><em>—</em></em>nothing is
    filled. When the ProgressValue is halfway between the minimum and the maximum values, the control is half filled.
    Finally, when the ProgressValue is at the maximum value, the control is completely filled. The progress bar is not
    limited to the values of empty, full, and half; these values are only examples. contains the properties supported by
    the progress control model.
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlProgressBarModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BackgroundColor
            </td>
            <td>
                Control’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Enabled
            </td>
            <td>
                If True, the dialog is enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                FillColor
            </td>
            <td>
                Color used to fill the progress bar.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpText
            </td>
            <td>
                Control’s help text as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpURL
            </td>
            <td>
                Control’s help URL as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Printable
            </td>
            <td>
                If True, the control is printed with the document.
            </td>
        </tr>
        <tr class="even">
            <td>
                ProgressValue
            </td>
            <td>
                Current progress value as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ProgressValueMax
            </td>
            <td>
                Maximum progress value as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                ProgressValueMin
            </td>
            <td>
                Minimum progress value as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                You can set both BackgroundColor and FillColor.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="list-box-control">
                            <span id="anchor-502"></span>List box control
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    A list box contains a list of items<em><em>—</em></em>one per line<em><em>—from which</em></em> the user may select
    zero or more items. In other words, a list box provides a mechanism to select multiple items from a list. The list
    box control automatically adds scroll bars if they are required. contains a list of properties supported by the list
    box model.
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlListBoxModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BackgroundColor
            </td>
            <td>
                Control’s background color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Dropdown
            </td>
            <td>
                If True, the control has a drop-down button.
            </td>
        </tr>
        <tr class="even">
            <td>
                Enabled
            </td>
            <td>
                If True, the control is enabled.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontDescriptor
            </td>
            <td>
                FontDescriptor structure for the text in the control.
            </td>
        </tr>
        <tr class="even">
            <td>
                FontEmphasisMark
            </td>
            <td>
                FontEmphasis for the text in the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                FontRelief
            </td>
            <td>
                FontRelief for the text in the control.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpText
            </td>
            <td>
                Control’s help text as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpURL
            </td>
            <td>
                Control’s help URL as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineCount
            </td>
            <td>
                The maximum line count displayed in the drop-down box.
            </td>
        </tr>
        <tr class="odd">
            <td>
                MultiSelection
            </td>
            <td>
                If True, more than one entry can be selected.
            </td>
        </tr>
        <tr class="even">
            <td>
                Printable
            </td>
            <td>
                If True, the control is printed with the document.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ReadOnly
            </td>
            <td>
                If True, the user cannot modify the data in the control.
            </td>
        </tr>
        <tr class="even">
            <td>
                SelectedItems
            </td>
            <td>
                Array of Short Integers that represent the index of the selected items.
            </td>
        </tr>
        <tr class="odd">
            <td>
                StringItemList
            </td>
            <td>
                Array of strings that represent the items in the list box.
            </td>
        </tr>
        <tr class="even">
            <td>
                Tabstop
            </td>
            <td>
                If True, the control can be reached by using the Tab key.
            </td>
        </tr>
        <tr class="odd">
            <td>
                TextColor
            </td>
            <td>
                Control’s text color as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                TextLineColor
            </td>
            <td>
                Control’s text line color as a Long Integer.
            </td>
        </tr>
    </tbody>
</table>
<p>
    Although I recommend doing most manipulations through the model, many things are frequently done using methods
    defined for the control. The list box control supports the same special functions supported by the combo box control
    (see ) to add and remove items at specific locations. The list box control supports other useful methods that are
    primarily related to the user interaction (see ).
</p>
<p>
    <strong>Table . </strong>Methods defined by the com.sun.star.awt.XListBox interface.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                addItemListener(XItemListener)
            </td>
            <td>
                Add a listener for item events.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeItemListener(XItemListener)
            </td>
            <td>
                Remove a listener for item events.
            </td>
        </tr>
        <tr class="odd">
            <td>
                addActionListener(XActionListener)
            </td>
            <td>
                Add a listener for action events.
            </td>
        </tr>
        <tr class="even">
            <td>
                removeActionListener(XActionListener)
            </td>
            <td>
                Remove a listener for action events.
            </td>
        </tr>
        <tr class="odd">
            <td>
                addItem(String, position)
            </td>
            <td>
                Add an item at the specified position.
            </td>
        </tr>
        <tr class="even">
            <td>
                addItems(StringArray, position)
            </td>
            <td>
                Add multiple items at the specified position.
            </td>
        </tr>
        <tr class="odd">
            <td>
                removeItems(position, count)
            </td>
            <td>
                Remove a number of items at the specified position.
            </td>
        </tr>
        <tr class="even">
            <td>
                getItemCount()
            </td>
            <td>
                Get the number of items in the list box.
            </td>
        </tr>
        <tr class="odd">
            <td>
                getItem(position)
            </td>
            <td>
                Get the specified item.
            </td>
        </tr>
        <tr class="even">
            <td>
                getItems()
            </td>
            <td>
                Return the StringItemList property (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                getSelectedItemPos()
            </td>
            <td>
                Return the position of one of the selected items. This is useful if<br /> only one item can be selected.
            </td>
        </tr>
        <tr class="even">
            <td>
                getSelectedItemsPos()
            </td>
            <td>
                Return the SelectedItems property (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                getSelectedItem()
            </td>
            <td>
                <p>
                    Return one of the selected items. This is useful if only one item
                </p>
                <p>
                    can be selected.
                </p>
            </td>
        </tr>
        <tr class="even">
            <td>
                getSelectedItems()
            </td>
            <td>
                Return all selected items as an array of strings.
            </td>
        </tr>
        <tr class="odd">
            <td>
                selectItemPos(position, boolean)
            </td>
            <td>
                Select or deselect the item at the specified position.
            </td>
        </tr>
        <tr class="even">
            <td>
                selectItemsPos(positions, boolean)
            </td>
            <td>
                Select or deselect multiple items at the positions specified by the<br /> array of positions.
            </td>
        </tr>
        <tr class="odd">
            <td>
                selectItem(item, boolean)
            </td>
            <td>
                Select or deselect the specified item string.
            </td>
        </tr>
        <tr class="even">
            <td>
                isMutipleMode()
            </td>
            <td>
                Get the MultiSelection property (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                setMultipleMode(boolean)
            </td>
            <td>
                Set the MultiSelection property (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                getDropDownLineCount()
            </td>
            <td>
                Get the LineCount property (see ).
            </td>
        </tr>
        <tr class="odd">
            <td>
                setDropDownLineCount(integer)
            </td>
            <td>
                Set the LineCount property (see ).
            </td>
        </tr>
        <tr class="even">
            <td>
                makeVisible(position)
            </td>
            <td>
                Scroll the items in the list box so that the specified item is visible.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="scroll-bar-control">
                            <span id="anchor-503"></span>Scroll bar control
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The scroll bar control can be used to scroll a control or dialog that does not already contain or support a scroll
    bar. All of the work to control another object and synchronize the external object with the scroll bar must be done
    using a macro. In other words, the scroll bar control does not automatically connect to or control another object,
    but requires a macro to implement the connection. To use the scroll bar control, write a macro that responds to the
    control’s events and then manipulate another object based on what happens in the control. If you want the scroll bar
    to track changes in the controlled object, you must write handlers for the other object to update the scroll bar. As
    an input or an output, the scroll bar serves to indicate a relationship in another object; the relationship
    displayed and the corresponding action depends on the programming of a macro. See .
</p>
<p>
    <strong>Table . </strong>Properties in the com.sun.star.awt.UnoControlScrollBarModel service.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                BlockIncrement
            </td>
            <td>
                Increment for a block move as a Long Integer.
            </td>
        </tr>
        <tr class="even">
            <td>
                Border
            </td>
            <td>
                Specify no border (0), a 3-D border (1), or a simple border (2).
            </td>
        </tr>
        <tr class="odd">
            <td>
                Enabled
            </td>
            <td>
                If True, the control is enabled.
            </td>
        </tr>
        <tr class="even">
            <td>
                HelpText
            </td>
            <td>
                Control’s help text as a String.
            </td>
        </tr>
        <tr class="odd">
            <td>
                HelpURL
            </td>
            <td>
                Control’s help URL as a String.
            </td>
        </tr>
        <tr class="even">
            <td>
                LineIncrement
            </td>
            <td>
                Increment for a single-line move as a Long Integer.
            </td>
        </tr>
        <tr class="odd">
            <td>
                Orientation
            </td>
            <td>
                Scroll bar orientation with values com.sun.star.awt.ScrollBarOrientation.HORIZONTAL (0) and
                com.sun.star.awt.ScrollBarOrientation.VERTICAL (1).
            </td>
        </tr>
        <tr class="even">
            <td>
                Printable
            </td>
            <td>
                If a scroll bar is embedded into a document, setting this to True causes the scroll bar to be printed
                when the document is printed.
            </td>
        </tr>
        <tr class="odd">
            <td>
                ScrollValue
            </td>
            <td>
                Current scroll value.
            </td>
        </tr>
        <tr class="even">
            <td>
                ScrollValueMax
            </td>
            <td>
                Maximum scroll value of the control.
            </td>
        </tr>
        <tr class="odd">
            <td>
                VisibleSize
            </td>
            <td>
                Visible size of the scroll bar.
            </td>
        </tr>
    </tbody>
</table>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Note
            </td>
            <td>
                Add a horizontal scroll bar to the OOMESample dialog. Add the global variable oBPosSize<br /> to store a
                button’s original position and size (see ).
            </td>
        </tr>
    </tbody>
</table>
<p>
    To illustrate how the scroll bar functions, add a horizontal scroll bar to the sample dialog and name it
    ButtonScrollBar. All of the work done by a scroll bar control is done by a macro. A scroll bar doesn’t know if
    something is horizontal or vertical, so it’s just as easy to use a vertical scroll bar as a horizontal scroll bar
    for the same application<em><em>—</em></em>a person using a vertical scroll bar to move something horizontally might
    face ridicule by his peers, but the control doesn’t care. I chose a horizontal scroll bar because I want to use it
    to move the Close button horizontally on the dialog. Add a global variable to store the initial position of the
    Close button (see ).
</p>
<p>
    <strong>Listing . </strong>Global variables for the Close button’s initial position and size.
</p>
<p>
    Dim oBPosSize 'Button original position and size
</p>
<p>
    In my sample dialog, there is nothing between the Close button and the right edge of the dialog (see ). I want the
    scroll bar to cause the Close button to move right and left.
</p>
<p>
    <img src="Pictures/10000000000001D30000018A7DD7DEC1.png" style="width:4.8646in;height:4.1043in" />
</p>
<p>
    <strong>Figure . </strong>OOMESample dialog referred to throughout this chapter.
</p>
<p>
    The maximum scroll bar value defaults to 100. This is usually used as a percentage to scroll something. In the
    sample dialog, however, I calculate the maximum distance that I can move the Close button, and then I set the
    maximum value that the scroll bar can return as this number. This allows me to use the scroll value directly, rather
    than calculating a position based on a percentage, which is the usual case.
</p>
<p>
    In the initialization section, add code that saves the Close button’s initial position and size (see ); this
    information is used later as a reference point. Next, calculate how far the button can be shifted to the right based
    on the size and position of the button and the size of the dialog that contains the button.
</p>
<p>
    <strong>Listing . </strong>Save the initial button position and set the scroll bar’s maximum value.
</p>
<p>
    REM Get the Close button's original position and size.
</p>
<p>
    REM Set the maximum value that the scroll bar can become
</p>
<p>
    REM based on the maximum distance that I can move the Close button.
</p>
<p>
    oBPosSize = oOOMEDlg.getControl("CloseButton").getPosSize()
</p>
<p>
    oOOMEDlg.getModel().getByName("ButtonScrollBar").ScrollValueMax = _
</p>
<p>
    oOOMEDlg.getPosSize.Width - oBPosSize.X - oBPosSize.Width - 10
</p>
<p>
    Set the scroll bar to call the ScrollButton method in for the “While Adjusting” event. The ScrollButton method uses
    the scroll value to position the Close button.
</p>
<p>
    <strong>Listing . </strong>ScrollButton is in the DlgCode module.
</p>
<p>
    Sub ScrollButton
</p>
<p>
    Dim oModel 'Scroll bar model
</p>
<p>
    Dim oButton 'Close button
</p>
<p>
    Dim newX As Long 'New X location for the Close button
</p>
<p>
</p>
<p>
    oModel = oOOMEDlg.getModel().getByName("ButtonScrollBar")
</p>
<p>
    oButton = oOOMEDlg.getControl("CloseButton")
</p>
<p>
    REM The scroll bar was set so that its maximum value is
</p>
<p>
    REM the maximum desired value.
</p>
<p>
    newX = oBPosSize.X + oModel.ScrollValue
</p>
<p>
    oButton.setPosSize(newX, 0, 0, 0, com.sun.star.awt.PosSize.X)
</p>
<p>
    End Sub
</p>
<p>
    Now you can move the Close button to the right and to the left by moving the scroll bar.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="using-the-step-property-for-multi-page-autopilot-dialogs">
                    <span id="anchor-504"></span>Using the Step property for multi-page AutoPilot dialogs
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    A multi-page dialog can display different sets of controls in the same dialog. Each set of controls is sometimes
    referred to as a “page.” OpenOffice.org frequently refers to multi-page dialogs as AutoPilot dialogs because they
    are frequently used to guide you through some process. At each step in the process, a different set of controls is
    displayed in the same dialog. For example, OOo comes with an ImportWizard macro library. The Main() subroutine in
    the Main module opens a dialog that assists in converting multiple documents. The first page (or step) allows you to
    select what document types will be imported. The second page (or step) allows you to select the directory that
    contains the documents to import.
</p>
<p>
    The dialog model contains the Step property, which tells the dialog the current step in the process. If the dialog’s
    Step property is set to zero, the default value, then the dialog displays every control. The model for every control
    that the dialog contains, also supports the Step property. In a control, the Step property is used to determine at
    which step the control is displayed. If a control’s Step property is zero, the control is displayed for every step.
    A Cancel button is likely to be displayed at every step, for example.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="the-object-inspector-example">
                    <span id="anchor-189"></span>The object inspector example
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    This section discusses an object inspector, that I use to inspect objects to understand what I can do with them. I
    am taking code that I have changed over the years to accomplish specific tasks, and significant improvements are
    possible; but this serves my needs.
</p>
<p>
    The object inspector accepts an optional argument that identifies the object to inspect. If the object is a UNO
    object, then the object contains debug properties that list the supported properties, methods, services, and
    interfaces.
</p>
<p>
    In this example, a dialog is created without using the Basic IDE. The inspection information is stored in a
    multi-line text edit control. I use a text edit control rather than a list box, because the text control allows me
    to copy the contained text to the clipboard and the list box control does not. I frequently inspect an object and
    then copy the supported properties, methods, and interfaces to the clipboard so that I can use them as a reference.
</p>
<p>
    Radio buttons dictate what is displayed in the text control. The text control can display the supported properties,
    methods, interfaces and services, and general inspection information such as the object’s data type (see ).
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="utility-subroutines-and-functions">
                            <span id="anchor-505"></span>Utility subroutines and functions
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Numerous utility methods are required to generically inspect an object in OO. The utility methods do not control,
    access, or update the dialog or any controls so I have separated them from the common functionality. The techniques
    and methods used here should be somewhat familiar, so I haven’t discussed them in depth. All of the routines are
    contained in the Inspector module in this chapter’s source code.
</p>
<h4 id="identifying-and-removing-white-space-from-a-string">
    <span id="anchor-506"></span>Identifying and removing white space from a string
</h4>
<p>
    A text character that appears as open space is called a “white space character.” For example, in this book there is
    a single space between each word. The new-line character can create white space between lines. While inspecting an
    object, the resulting strings frequently contain leading and trailing white space of different types that must be
    removed. The functions in identify the different types of white space and remove them from a string.
</p>
<p>
    <strong>Listing . </strong>Identify and remove white space from a string.
</p>
<p>
    REM Utility Functions and Methods
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Is the specified character whitespace? The answer is true if the
</p>
<p>
    '** character is a tab, CR, LF, space, or a non-breaking space character!
</p>
<p>
    '** These correspond to the ASCII values 9, 10, 13, 32, and 160
</p>
<p>
    '*************************************************************************
</p>
<p>
    Function IsWhiteSpace(iChar As Integer) As Boolean
</p>
<p>
    Select Case iChar
</p>
<p>
    Case 9, 10, 13, 32, 160
</p>
<p>
    IsWhiteSpace = True
</p>
<p>
    Case Else
</p>
<p>
    IsWhiteSpace = False
</p>
<p>
    End Select
</p>
<p>
    End Function
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Find the first character starting at location i% that is not whitespace.
</p>
<p>
    '** If there are none, then the return value will be greater than the
</p>
<p>
    '** length of the string.
</p>
<p>
    '*************************************************************************
</p>
<p>
    Function FirstNonWhiteSpace(ByVal i%, s$) As Integer
</p>
<p>
    If i &lt;= Len(s) Then
</p>
<p>
    Do While IsWhiteSpace(Asc(Mid$(s, i, 1)))
</p>
<p>
    i = i + 1
</p>
<p>
    If i &gt; Len(s) Then
</p>
<p>
    Exit Do
</p>
<p>
    End If
</p>
<p>
    Loop
</p>
<p>
    End If
</p>
<p>
    FirstNonWhiteSpace = i
</p>
<p>
    End Function
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Remove white space text from both the front and the end of a string.
</p>
<p>
    '** This modifies the argument string and it returns the modified string.
</p>
<p>
    '** This removes all types of white space, not just a regular space.
</p>
<p>
    '*************************************************************************
</p>
<p>
    Function TrimWhite(s As String) As String
</p>
<p>
    s = Trim(s)
</p>
<p>
    Do While Len(s) &gt; 0
</p>
<p>
    If Not IsWhiteSpace(ASC(s)) Then Exit Do
</p>
<p>
    s = Right(s, Len(s) - 1)
</p>
<p>
    Loop
</p>
<p>
    Do While Len(s) &gt; 0
</p>
<p>
    If Not IsWhiteSpace(ASC(Right(s, 1))) Then Exit Do
</p>
<p>
    s = Left(s, Len(s) - 1)
</p>
<p>
    Loop
</p>
<p>
    TrimWhite = s
</p>
<p>
    End Function
</p>
<h4 id="convert-a-simple-object-to-a-string">
    <span id="anchor-507"></span>Convert a simple object to a string
</h4>
<p>
    The CStr() method converts most standard data types to a string. Not all variables are easily converted to a string
    using CStr(), so the ObjToString() method attempts to make an intelligent conversion. The most troublesome variable
    types are Object and Variant, which can contain the value Empty or Null<em><em>—</em></em>these two cases are
    identified and printed in . Variables of type Object cannot be trivially converted to a String, so they are not. The
    standard types are converted to a String by . The ObjToString() method truncates the string at 100 characters.
</p>
<p>
    <strong>Listing .<strong> </strong><strong>String representation of an object.</strong></strong>
</p>
<p>
    Function ObjToString(oInsObj, optional arraySep$, _
</p>
<p>
    Optional maxDepth%, Optional CRReplace As Boolean) As String
</p>
<p>
</p>
<p>
    Dim iMaxDepth% ' Maximum number of array elements to display
</p>
<p>
    Dim sArraySep$ ' Separator used for array elements
</p>
<p>
    Dim s$ ' Contains the results.
</p>
<p>
    Dim bCRReplace As Boolean
</p>
<p>
    ' Optional arguments
</p>
<p>
    If IsMissing(CRReplace) Then
</p>
<p>
    bCRReplace = False
</p>
<p>
    Else
</p>
<p>
    bCRReplace = CRReplace
</p>
<p>
    End If
</p>
<p>
    If IsArray(oInsObj) Then
</p>
<p>
    If IsMissing(arraySep) Then
</p>
<p>
    sArraySep = CHR$(10)
</p>
<p>
    Else
</p>
<p>
    sArraySep = arraySep
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    If IsMissing(maxDepth) THen
</p>
<p>
    iMaxDepth = 100
</p>
<p>
    Else
</p>
<p>
    iMaxDepth = maxDepth
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    s = ObjArrayToString(oInsObj, sArraySep, iMaxDepth)
</p>
<p>
    Else
</p>
<p>
    ' Not an array
</p>
<p>
    Select Case VarType(oInsObj)
</p>
<p>
    Case 0
</p>
<p>
    s = "Empty"
</p>
<p>
    Case 1
</p>
<p>
    s = "Null"
</p>
<p>
    Case 2, 3, 4, 5, 7, 8, 11, 16 To 23, 33 To 37
</p>
<p>
    s = CStr(oInsObj)
</p>
<p>
    Case Else
</p>
<p>
    If IsUnoStruct(oInsObj) Then
</p>
<p>
    s = "[Cannot convert an UnoStruct to a string]"
</p>
<p>
    Else
</p>
<p>
    Dim sImplName$ : sImplName = GetImplementationName(oInsObj)
</p>
<p>
    If sImplName = "" Then
</p>
<p>
    s = "[Cannot convert " &amp; TypeName(oInsObj) &amp; " to a string]"
</p>
<p>
    Else
</p>
<p>
    s = "[Cannot convert " &amp; TypeName(oInsObj) &amp; _
</p>
<p>
    " (" &amp; sImplName &amp; ") to a string]"
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End Select
</p>
<p>
    If bCRReplace Then
</p>
<p>
    s = Replace(s, CHR$(10), "|", 1, -1, 1)
</p>
<p>
    s = Replace(s, CHR$(13), "|", 1, -1, 1)
</p>
<p>
    End If
</p>
<p>
    If Len(s) &gt; 100 Then s = Left(s, 100) &amp; "...."
</p>
<p>
    End If
</p>
<p>
    ObjToString = s
</p>
<p>
    End Function
</p>
<p>
    Arrays are identified and converted separately. One and two dimensional arrays are supported.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong><strong> Convert an array to a string.
        </strong></strong>
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Convert an array of objects to a string if possible.
</p>
<p>
    '**
</p>
<p>
    '** oInsObj - Object to Inspect
</p>
<p>
    '** sArraySep - Separator character for arrays
</p>
<p>
    '** maxDepth - Maximum number of array elements to show
</p>
<p>
    '*************************************************************************
</p>
<p>
    Function ObjArrayToString(oInsObj, sArraySep$, Optional maxDepth%) As String
</p>
<p>
    Dim iMaxDepth%
</p>
<p>
    Dim iDimensions%
</p>
<p>
</p>
<p>
    If IsMissing(maxDepth) THen
</p>
<p>
    iMaxDepth = 100
</p>
<p>
    Else
</p>
<p>
    iMaxDepth = maxDepth
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    iDimensions = NumArrayDimensions(oInsObj)
</p>
<p>
    If iDimensions = 1 Then
</p>
<p>
    ObjArrayToString = ObjArray_1_ToString(oInsObj, iMaxDepth%, sArraySep)
</p>
<p>
    ElseIf iDimensions = 2 Then
</p>
<p>
    ObjArrayToString = ObjArray_2_ToString(oInsObj, iMaxDepth%, sArraySep)
</p>
<p>
    Else
</p>
<p>
    ObjArrayToString = "[Unable to convert array with dimension " &amp; iDimensions &amp; "]"
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Convert a 1-D array of objects to a string.
</p>
<p>
    '**
</p>
<p>
    '** oInsObj - Object to Inspect
</p>
<p>
    '** iMaxDepth - Maximum number of array elements to show
</p>
<p>
    '** sSep - Separator character for arrays
</p>
<p>
    '*************************************************************************
</p>
<p>
    Function ObjArray_1_ToString(oInsObj, iMaxDepth%, sSep$) As String
</p>
<p>
    Dim iDim_1%
</p>
<p>
    Dim iMax_1%
</p>
<p>
    Dim iCounter%
</p>
<p>
    Dim s$
</p>
<p>
    Dim sTempSep$
</p>
<p>
</p>
<p>
    sTempSep = ""
</p>
<p>
    iDim_1 = LBound(oInsObj, 1)
</p>
<p>
    iMax_1 = UBound(oInsObj, 1)
</p>
<p>
    Do While (iCounter &lt; iMaxDepth AND iDim_1 &lt;= iMax_1)
</p>
<p>
    iCounter = iCounter + 1
</p>
<p>
    s = s &amp; sTempSep &amp; "[" &amp; iDim_1 &amp; "] " _
</p>
<p>
    &amp; ObjToString(oInsObj(iDim_1), ", ")
</p>
<p>
    sTempSep = sSep
</p>
<p>
    iDim_1 = iDim_1 + 1
</p>
<p>
    Loop
</p>
<p>
    ObjArray_1_ToString = s
</p>
<p>
    End Function
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Convert a 2-D array of objects to a string.
</p>
<p>
    '**
</p>
<p>
    '** oInsObj - Object to Inspect
</p>
<p>
    '** iMaxDepth - Maximum number of array elements to show
</p>
<p>
    '** sSep - Separator character for arrays
</p>
<p>
    '*************************************************************************
</p>
<p>
    Function ObjArray_2_ToString(oInsObj, iMaxDepth%, sSep$) As String
</p>
<p>
    Dim iDim_1%, iDim_2%
</p>
<p>
    Dim iMax_1%, iMax_2%
</p>
<p>
    Dim iCounter%
</p>
<p>
    Dim s$
</p>
<p>
    Dim sTempSep$
</p>
<p>
</p>
<p>
    sTempSep = ""
</p>
<p>
    iDim_1 = LBound(oInsObj, 1)
</p>
<p>
    iMax_1 = UBound(oInsObj, 1)
</p>
<p>
    iMax_2 = UBound(oInsObj, 2)
</p>
<p>
    Do While (iCounter &lt; iMaxDepth AND iDim_1 &lt;= iMax_1)
</p>
<p>
    iCounter = iCounter + 1
</p>
<p>
    iDim_2 = LBound(oInsObj, 2)
</p>
<p>
    Do While (iCounter &lt; iMaxDepth AND iDim_2 &lt;= iMax_2)
</p>
<p>
    s = s &amp; sTempSep &amp; "[" &amp; iDim_1 &amp; ", " &amp; iDim_2 &amp; "] " _
</p>
<p>
    &amp; ObjToString(oInsObj(iDim_1, iDim_2), ", ")
</p>
<p>
    sTempSep = sSep
</p>
<p>
    iDim_2 = iDim_2 + 1
</p>
<p>
    Loop
</p>
<p>
    iDim_1 = iDim_1 + 1
</p>
<p>
    Loop
</p>
<p>
    ObjArray_2_ToString = s
</p>
<p>
    End Function
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Number of dimension for an array. a(4) returns 1 and a(3, 4) returns 2.
</p>
<p>
    '**
</p>
<p>
    '** oInsObj - Object to Inspect
</p>
<p>
    '*************************************************************************
</p>
<p>
    Function NumArrayDimensions(oInsObj) As Integer
</p>
<p>
    Dim i% : i = 0
</p>
<p>
    If IsArray(oInsObj) Then
</p>
<p>
    On Local Error Goto DebugBoundsError:
</p>
<p>
    Do While (i% &gt;= 0)
</p>
<p>
    LBound(oInsObj, i% + 1)
</p>
<p>
    UBound(oInsObj, i% + 1)
</p>
<p>
    i% = i% + 1
</p>
<p>
    Loop
</p>
<p>
    DebugBoundsError:
</p>
<p>
    On Local Error Goto 0
</p>
<p>
    End If
</p>
<p>
    NumArrayDimensions = i
</p>
<p>
    End Function
</p>
<p>
    The object implementation name is useful to have, and special care must be taken for objects that do not support the
    method.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong><strong> </strong><strong>Get
        </strong><strong>the object's implementation name (if it is an UNO Service).</strong></strong>
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Get an objects implementation name if it exists.
</p>
<p>
    '**
</p>
<p>
    '** oInsObj - Object to Inspect
</p>
<p>
    '*************************************************************************
</p>
<p>
    Function GetImplementationName(oInsObj) As String
</p>
<p>
    On Local Error GoTo DebugNoSet
</p>
<p>
    Dim oTmpObj
</p>
<p>
    oTmpObj = oInsObj
</p>
<p>
    GetImplementationName = oTmpObj.getImplementationName()
</p>
<p>
    DebugNoSet:
</p>
<p>
    End Function
</p>
<h4 id="object-inspection-using-basic-methods">
    <span id="anchor-508"></span>Object inspection using Basic methods
</h4>
<p>
    The ObjInfoString() method (shown in ) creates a string that describes an object. This string includes detailed
    information about the object type. If the object is an array, the array dimensions are listed. If possible, even the
    UNO implementation name is obtained. No other UNO-related information<em><em>—</em></em>such as supported properties
    or methods<em><em>—</em></em>is obtained.
</p>
<p>
    <strong>Listing .<strong> </strong><strong>Get information about an object.</strong></strong>
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Return a string that contains useful information about an object.
</p>
<p>
    '** This includes detailed information about the object type. If the
</p>
<p>
    '** object is an array, then the array dimensions are listed.
</p>
<p>
    '** If possible, even the UNO implementation name is obtained.
</p>
<p>
    '*************************************************************************
</p>
<p>
    Function ObjInfoString(oInsObj) As String
</p>
<p>
    Dim s As String
</p>
<p>
</p>
<p>
    REM We can always get the type name and variable type.
</p>
<p>
    s = "TypeName = " &amp; TypeName(oInsObj) &amp; CHR$(10) &amp;_
</p>
<p>
    "VarType = " &amp; VarType(oInsObj) &amp; CHR$(10)
</p>
<p>
</p>
<p>
    REM Check for NULL and EMPTY
</p>
<p>
    If IsNull(oInsObj) Then
</p>
<p>
    s = s &amp; "IsNull = True"
</p>
<p>
    ElseIf IsEmpty(oInsObj) Then
</p>
<p>
    s = s &amp; "IsEmpty = True"
</p>
<p>
    Else
</p>
<p>
    If IsObject(oInsObj) Then
</p>
<p>
    s = s &amp; "Implementation Name = " &amp; GetImplementationName(oInsObj)
</p>
<p>
    s = s &amp; CHR$(10) &amp; "IsObject = True" &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    If IsUnoStruct(oInsObj) Then s = s &amp; "IsUnoStruct = True" &amp; CHR$(10)
</p>
<p>
    If IsDate(oInsObj) Then s = s &amp; "IsDate = True" &amp; CHR$(10)
</p>
<p>
    If IsNumeric(oInsObj) Then s = s &amp; "IsNumeric = True" &amp; CHR$(10)
</p>
<p>
    If IsArray(oInsObj) Then
</p>
<p>
    On Local Error Goto DebugBoundsError:
</p>
<p>
    Dim i%, sTemp$
</p>
<p>
    s = s &amp; "IsArray = True" &amp; CHR$(10) &amp; "range = ("
</p>
<p>
    Do While (i% &gt;= 0)
</p>
<p>
    i% = i% + 1
</p>
<p>
    sTemp$ = LBound(oInsObj, i%) &amp; " To " &amp; UBound(oInsObj, i%)
</p>
<p>
    If i% &gt; 1 Then s = s &amp; ", "
</p>
<p>
    s = s &amp; sTemp$
</p>
<p>
    Loop
</p>
<p>
    DebugBoundsError:
</p>
<p>
    On Local Error Goto 0
</p>
<p>
    s = s &amp; ")" &amp; CHR$(10)
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    s = s &amp; "Value : " &amp; CHR$(10) &amp; ObjToString(oInsObj) &amp; CHR$(10)
</p>
<p>
    ObjInfoString = s
</p>
<p>
    End Function
</p>
<h4 id="sort-an-array">
    <span id="anchor-509"></span>Sort an array
</h4>
<p>
    Many objects contain so many properties and implement so many methods, that when they are displayed in the text box,
    it is difficult to find a specific entry. Sorting the output makes it easier to find individual entries.
</p>
<p>
    Assume that I have two arrays. The first array contains a list of names and the second array contains a list of
    ages. The third item in the age array contains the age of the third item in the name array. In computer science,
    these are referred to as “parallel arrays.” Parallel arrays are used in the object browser. When dealing with
    properties, the property type is stored in the first array, and the property name is stored in the second array. The
    same thing is done while dealing with the supported methods.
</p>
<p>
    While creating the data for inspection, parallel arrays are created and maintained. I want to sort the information,
    but I can’t sort one array unless I sort all of the arrays. A typical solution to this problem is to create an index
    array that contains integers, which are used to index into the array. The index array is sorted rather than the
    actual data. For example, sort the array oItems()=("B", "C", "A"). The sorted index array is (2, 0, 1), implying
    that oItems(2) is the first item, oItems(0) is the second item, and oItems(1) is the last item. The function
    SortMyArray() in sorts an array by using an index array.
</p>
<p>
    <strong>Listing .<strong> </strong><strong>Indirectly Sort an array by moving indexes.</strong></strong>
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Sort the oItems() array by arranging the iIdx() array.
</p>
<p>
    '** If oItems() = ("B", "C", "A") Then on output, iIdx() = (2, 0, 1)
</p>
<p>
    '** This means that the item that should come first is oItems(2), second
</p>
<p>
    '** is oItems(0), and finally, oItems(1)
</p>
<p>
    '*************************************************************************
</p>
<p>
    Sub SortMyArray(oItems(), iIdx() As Integer)
</p>
<p>
    Dim i As Integer 'Outer index variable
</p>
<p>
    Dim j As Integer 'Inner index variable
</p>
<p>
    Dim temp As Integer 'Temporary variable to swap two values.
</p>
<p>
    Dim bChanged As Boolean 'Becomes True when something changes
</p>
<p>
    For i = LBound(oItems()) To UBound(oItems()) - 1
</p>
<p>
    bChanged = False
</p>
<p>
    For j = UBound(oItems()) To i+1 Step -1
</p>
<p>
    If oItems(iIdx(j)) &lt; oItems(iIdx(j-1)) Then
</p>
<p>
    temp = iIdx(j)
</p>
<p>
    iIdx(j) = iIdx(j-1)
</p>
<p>
    iIdx(j-1) = temp
</p>
<p>
    bChanged = True
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    If Not bChanged Then Exit For
</p>
<p>
    Next
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="creating-a-dialog-at-run-time">
                            <span id="anchor-510"></span>Creating a dialog at run time
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    The Object Inspector uses Private variables for the dialog and frequently referenced objects. The dialog contains a
    progress bar that is updated while information is retrieved to fill the text control. The inspected object is also
    stored as a global variable because it is used in event handlers that have no other way to obtain the object. See .
</p>
<p>
    <strong>Listing . </strong>Global variables defined in the Inspector module.
</p>
<p>
    Private oDlg 'Displayed dialog
</p>
<p>
    Private oProgress 'Progress control model
</p>
<p>
    Private oTextEdit 'Text edit control model that displays information
</p>
<p>
    Private oObjects(100) 'Objects to inspect
</p>
<p>
    Private Titles(100) 'Titles
</p>
<p>
    Private iDepth% 'Which object / title to use
</p>
<p>
    Unfortunately, dialogs created in the IDE can only be created and run from within Basic. It is possible, however, to
    create and use a dialog at run time in any programming language that can use the OOo UNO API. The dialog
    functionality is scheduled to be improved in OOo 2.0 so that you can design dialogs in an IDE and display them using
    languages other than Basic. The Inspect() method in creates a dialog and all of its contained controls without using
    the IDE. Follow these steps to create and display the dialog:
</p>
<ol type="1">
    <li>
        Use CreateUnoService("com.sun.star.awt.UnoControlDialogModel") to create a dialog model and then set the model’s
        properties.
    </li>
    <li>
        Use the createInstance(name) method in the dialog model to create a model for each control that is inserted into
        the dialog model. Set the properties on the control’s model and then use the insertByName(name, oModel)
        method<em><em>—</em></em>defined by the dialog model<em><em>—</em></em>to insert the control’s model into the
        dialog’s model. This step is important! To insert a control into a dialog, you must use the dialog model to
        create a control model, which is then inserted into the dialog model. You don’t create or manipulate controls,
        only models.
    </li>
    <li>
        Use CreateUnoService("com.sun.star.awt.UnoControlDialog") to create a dialog.
    </li>
    <li>
        Use the setModel() method on the dialog to set the dialog’s model.
    </li>
    <li>
        Use CreateUnoListener(name) to create any desired listeners. Add the listener to the correct object; the correct
        object is usually a control.
    </li>
    <li>
        Use CreateUnoService("com.sun.star.awt.Toolkit") to create a window toolkit object.
    </li>
    <li>
        Use the createPeer(oWindow, null) method on the dialog to tell the dialog to create an appropriate window to
        use.
    </li>
    <li>
        Execute the dialog.
    </li>
</ol>
<p>
    <strong>Listing . </strong>Create the dialog, the controls, and the listeners.
</p>
<p>
    Sub Inspect(Optional oInsObj, Optional title$)
</p>
<p>
    Dim oDlgModel 'The dialog's model
</p>
<p>
    Dim oModel 'Model for a control
</p>
<p>
    Dim oListener 'A created listener object
</p>
<p>
    Dim oControl 'References a control
</p>
<p>
    Dim iTabIndex As Integer 'The current tab index while creating controls
</p>
<p>
    Dim iDlgHeight As Long 'The dialog's height
</p>
<p>
    Dim iDlgWidth As Long 'The dialog's width
</p>
<p>
    Dim sTitle$
</p>
<p>
</p>
<p>
    iDepth = LBound(oObjects)
</p>
<p>
    sTitle = ""
</p>
<p>
    If Not IsMissing(title) Then sTitle = title
</p>
<p>
</p>
<p>
    REM If no object is passed in, then use ThisComponent.
</p>
<p>
    If IsMissing(oInsObj) Then
</p>
<p>
    oObjects(iDepth) = ThisComponent
</p>
<p>
    If IsMissing(title) Then sTitle = "ThisComponent"
</p>
<p>
    Else
</p>
<p>
    oObjects(iDepth) = oInsObj
</p>
<p>
    If IsMissing(title) Then sTitle = "Obj"
</p>
<p>
    End If
</p>
<p>
    Titles(iDepth) = sTitle
</p>
<p>
    iDlgHeight = 300
</p>
<p>
    iDlgWidth = 350
</p>
<p>
</p>
<p>
    REM Create the dialog's model
</p>
<p>
    oDlgModel = CreateUnoService("com.sun.star.awt.UnoControlDialogModel")
</p>
<p>
    setProperties(oDlgModel, Array("PositionX", 50, "PositionY", 50,_
</p>
<p>
    "Width", iDlgWidth, "Height", iDlgHeight, "Title", sTitle))
</p>
<p>
    createInsertControl(oDlgModel, iTabIndex, "PropButton",_
</p>
<p>
    "com.sun.star.awt.UnoControlRadioButtonModel",_
</p>
<p>
    Array("PositionX", 10, "PositionY", 10, "Width", 50, "Height", 15,_
</p>
<p>
    "Label", "Properties"))
</p>
<p>
    createInsertControl(oDlgModel, iTabIndex, "MethodButton",_
</p>
<p>
    "com.sun.star.awt.UnoControlRadioButtonModel",_
</p>
<p>
    Array("PositionX", 65, "PositionY", 10, "Width", 50, "Height", 15,_
</p>
<p>
    "Label", "Methods"))
</p>
<p>
    createInsertControl(oDlgModel, iTabIndex, "ServiceButton",_
</p>
<p>
    "com.sun.star.awt.UnoControlRadioButtonModel",_
</p>
<p>
    Array("PositionX", 120, "PositionY", 10, "Width", 50, "Height", 15,_
</p>
<p>
    "Label", "Services"))
</p>
<p>
    createInsertControl(oDlgModel, iTabIndex, "ObjectButton",_
</p>
<p>
    "com.sun.star.awt.UnoControlRadioButtonModel",_
</p>
<p>
    Array("PositionX", 175, "PositionY", 10, "Width", 50, "Height", 15,_
</p>
<p>
    "Label", "Object"))
</p>
<p>
    createInsertControl(oDlgModel, iTabIndex, "EditControl",_
</p>
<p>
    "com.sun.star.awt.UnoControlEditModel",_
</p>
<p>
    Array("PositionX", 10, "PositionY", 25, "Width", iDlgWidth - 20,_
</p>
<p>
    "Height", (iDlgHeight - 75), "HScroll", True, "VScroll", True,_
</p>
<p>
    "MultiLine", True, "HardLineBreaks", True))
</p>
<p>
</p>
<p>
    REM Store the edit control's model in a global variable.
</p>
<p>
    oTextEdit = oDlgModel.getByName("EditControl")
</p>
<p>
    createInsertControl(oDlgModel, iTabIndex, "Progress",_
</p>
<p>
    "com.sun.star.awt.UnoControlProgressBarModel",_
</p>
<p>
    Array("PositionX", 10, "PositionY", (iDlgHeight - 45),_
</p>
<p>
    "Width", iDlgWidth - 20, "Height", 15, "ProgressValueMin", 0,_
</p>
<p>
    "ProgressValueMax", 100))
</p>
<p>
    REM Store a reference to the progress bar
</p>
<p>
    oProgress = oDlgModel.getByName("Progress")
</p>
<p>
    REM Notice that I set the type to OK so I do not require an action
</p>
<p>
    REM listener to close the dialog.
</p>
<p>
    createInsertControl(oDlgModel, iTabIndex, "OKButton",_
</p>
<p>
    "com.sun.star.awt.UnoControlButtonModel",_
</p>
<p>
    Array("PositionX", Clng(25), "PositionY", iDlgHeight-20,_
</p>
<p>
    "Width", 50, "Height", 15, "Label", "Close",_
</p>
<p>
    "PushButtonType", com.sun.star.awt.PushButtonType.OK))
</p>
<p>
    createInsertControl(oDlgModel, iTabIndex, "InspectButton",_
</p>
<p>
    "com.sun.star.awt.UnoControlButtonModel",_
</p>
<p>
    Array("PositionX", Clng(iDlgWidth / 2 - 50), "PositionY", iDlgHeight-20,_
</p>
<p>
    "Width", 50, "Height", 15, "Label", "Inspect Selected",_
</p>
<p>
    "PushButtonType", com.sun.star.awt.PushButtonType.STANDARD))
</p>
<p>
    createInsertControl(oDlgModel, iTabIndex, "BackButton",_
</p>
<p>
    "com.sun.star.awt.UnoControlButtonModel",_
</p>
<p>
    Array("PositionX", Clng(iDlgWidth / 2 + 50), "PositionY", iDlgHeight-20,_
</p>
<p>
    "Width", 50, "Height", 15, "Label", "Inspect Previous",_
</p>
<p>
    "Enabled", False, _
</p>
<p>
    "PushButtonType", com.sun.star.awt.PushButtonType.STANDARD))
</p>
<p>
    REM Create the dialog and set the model
</p>
<p>
    oDlg = CreateUnoService("com.sun.star.awt.UnoControlDialog")
</p>
<p>
    oDlg.setModel(oDlgModel)
</p>
<p>
</p>
<p>
    REM the item listener for all of the radio buttons.
</p>
<p>
    oListener = CreateUnoListener("radio_", "com.sun.star.awt.XItemListener")
</p>
<p>
    oControl = oDlg.getControl("PropButton")
</p>
<p>
    ocontrol.addItemListener(oListener)
</p>
<p>
    oControl = oDlg.getControl("MethodButton")
</p>
<p>
    ocontrol.addItemListener(oListener)
</p>
<p>
    oControl = oDlg.getControl("ServiceButton")
</p>
<p>
    ocontrol.addItemListener(oListener)
</p>
<p>
    oControl = oDlg.getControl("ObjectButton")
</p>
<p>
    ocontrol.addItemListener(oListener)
</p>
<p>
    oControl.getModel().State = 1
</p>
<p>
</p>
<p>
    oListener = CreateUnoListener("ins_", "com.sun.star.awt.XActionListener")
</p>
<p>
    oControl = oDlg.getControl("InspectButton")
</p>
<p>
    ocontrol.addActionListener(oListener)
</p>
<p>
</p>
<p>
    oListener = CreateUnoListener("back_", "com.sun.star.awt.XActionListener")
</p>
<p>
    oControl = oDlg.getControl("BackButton")
</p>
<p>
    ocontrol.addActionListener(oListener)
</p>
<p>
</p>
<p>
    REM Now, set the dialog to contain the standard dialog information
</p>
<p>
    DisplayNewObject()
</p>
<p>
</p>
<p>
    REM Create a window and then tell the dialog to use the created window.
</p>
<p>
    Dim oWindow
</p>
<p>
    oWindow = CreateUnoService("com.sun.star.awt.Toolkit")
</p>
<p>
    oDlg.createPeer(oWindow, null)
</p>
<p>
</p>
<p>
    REM Finally, execute the dialog.
</p>
<p>
    oDlg.execute()
</p>
<p>
    End Sub
</p>
<p>
    To shorten the code in , try using two utility methods to set properties, create a control model, and insert the
    control model into the dialog model. Notice that the control itself is never created<em><em>—</em></em>only the
    model is created. contains the methods to create the control models and to set the properties. Although properties
    are set using the setPropertyValue method, in Basic you can set the properties directly if desired.
</p>
<p>
    <strong>Listing . </strong>Create a control model and insert it into the dialog’s model.
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Create a control of type sType with name sName, and insert it into
</p>
<p>
    '** oDlgModel.
</p>
<p>
    '**
</p>
<p>
    '** oDlgModel - Dialog model into which the control will be placed.
</p>
<p>
    '** index - Tab index, which is incremented each time.
</p>
<p>
    '** sName - Control name.
</p>
<p>
    '** sType - Full service name for the control model.
</p>
<p>
    '** props - Arry of property name / property value pairs.
</p>
<p>
    '*************************************************************************
</p>
<p>
    Sub createInsertControl(oDlgModel, index%, sName$, sType$, props())
</p>
<p>
    Dim oModel
</p>
<p>
</p>
<p>
    oModel = oDlgModel.createInstance(sType$)
</p>
<p>
    setProperties(oModel, props())
</p>
<p>
    setProperties(oModel, Array("Name", sName$, "TabIndex", index%))
</p>
<p>
    oDlgModel.insertByName(sName$, oModel)
</p>
<p>
</p>
<p>
    REM This changes the value because it is not passed by value.
</p>
<p>
    index% = index% + 1
</p>
<p>
    End Sub
</p>
<p>
    The following macro is used to set many properties based on a single call.
</p>
<p>
    <strong><strong>Listing </strong><strong></strong><strong>.</strong><strong> Set many properties at one
            time.</strong></strong>
</p>
<p>
    REM Generically set properties based on an array of name/value pairs.
</p>
<p>
    Sub setProperties(oModel, props())
</p>
<p>
    Dim i As Integer
</p>
<p>
    For i=LBound(props()) To UBound(props()) Step 2
</p>
<p>
    oModel.setPropertyValue(props(i), props(i+1))
</p>
<p>
    Next
</p>
<p>
    End sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="listeners">
                            <span id="anchor-511"></span>Listeners
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<h4 id="radio-buttons">
    <span id="anchor-512"></span>Radio buttons
</h4>
<p>
    Each time a new radio button is selected, the method radio_itemStateChanged() is called (the listener is set up in
    ). The event handler calls the DisplayNewObject() subroutine, which handles the actual work when a new property type
    is requested. See<strong> </strong>. I wrote a separate routine so that it can be used apart from the event handler.
    For example, it calls DisplayNewObject() before the dialog is displayed so that the dialog contains useful
    information when it first appears.
</p>
<p>
    <strong>Listing . </strong>The event handler is very simple; it calls DisplayNewObject().
</p>
<p>
    REM This method is to support the com.sun.star.awt.XItemListener interface
</p>
<p>
    REM for the radio button listener. This method is called when a radio button
</p>
<p>
    REM is selected.
</p>
<p>
    Sub radio_itemStateChanged(oItemEvent)
</p>
<p>
    DisplayNewObject()
</p>
<p>
    End Sub
</p>
<p>
    Sub DisplayNewObject()
</p>
<p>
    REM Reset the progress bar!
</p>
<p>
    oProgress.ProgressValue = 0
</p>
<p>
    oTextEdit.Text = ""
</p>
<p>
    On Local Error GoTo IgnoreError:
</p>
<p>
    If IsNull(oObjects(iDepth)) OR IsEmpty(oObjects(iDepth)) Then
</p>
<p>
    oTextEdit.Text = ObjInfoString(oObjects(iDepth))
</p>
<p>
    ElseIf oDlg.getModel().getByName("PropButton").State = 1 Then
</p>
<p>
    processStateChange(oObjects(iDepth), "p")
</p>
<p>
    ElseIf oDlg.getModel().getByName("MethodButton").State = 1 Then
</p>
<p>
    processStateChange(oObjects(iDepth), "m")
</p>
<p>
    ElseIf oDlg.getModel().getByName("ServiceButton").State = 1 Then
</p>
<p>
    processStateChange(oObjects(iDepth), "s")
</p>
<p>
    Else
</p>
<p>
    oTextEdit.Text = ObjInfoString(oObjects(iDepth))
</p>
<p>
    End If
</p>
<p>
    oProgress.ProgressValue = 100
</p>
<p>
    IgnoreError:
</p>
<p>
    End Sub
</p>
<h4 id="inspect-selected">
    <span id="anchor-513"></span>Inspect selected
</h4>
<p>
    The handler for the Inspect Selected button looks at the text that is selected and then based on the selected text,
    attempts to inspect a new object. I considered making the processing more user friendly, but it meets my needs. If
    you select text, a property with the selected name is inspected. If you select a number, the current object is
    assumed to be an array, and the object at the specified index is inspected.
</p>
<p>
    <strong>Listing .<strong> </strong><strong>Inspect a new item.</strong></strong>
</p>
<p>
    Sub Ins_actionPerformed(oActionEvent)
</p>
<p>
    Dim oControl
</p>
<p>
    Dim oSel
</p>
<p>
    Dim sText$
</p>
<p>
    Dim v
</p>
<p>
    Dim oOldObj
</p>
<p>
    Dim sOldTitle$
</p>
<p>
    Dim sNewTitle$
</p>
<p>
</p>
<p>
    If iDepth = UBound(oObjects) Then
</p>
<p>
    Print "Sorry, already nested too deeply"
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    oControl = oDlg.getControl("EditControl")
</p>
<p>
    sText = oControl.getSelectedText()
</p>
<p>
    sOldTitle = oDlg.Title
</p>
<p>
    sNewTitle = sOldTitle &amp; "/" &amp; sText
</p>
<p>
</p>
<p>
    If IsNumeric(sText) Then
</p>
<p>
    ' oDlg.getModel().getByName("ObjButton").State = 1
</p>
<p>
    If NumArrayDimensions(oObjects(iDepth)) &lt;&gt; 1 Then
</p>
<p>
    Print "You can only select a number with a one dimensional array."
</p>
<p>
    Else
</p>
<p>
    oOldObj = oObjects(iDepth)
</p>
<p>
    iDepth = iDepth + 1
</p>
<p>
    oDlg.getControl("BackButton").GetModel().Enabled = True
</p>
<p>
    oObjects(iDepth) = oOldObj(sText)
</p>
<p>
    oDlg.Title = sNewTitle
</p>
<p>
    Titles(iDepth) = sNewTitle
</p>
<p>
    DisplayNewObject()
</p>
<p>
    End If
</p>
<p>
    Else
</p>
<p>
    v = RunFromLib(GlobalScope.BasicLibraries, _
</p>
<p>
    "xyzzylib", "TestMod", oObjects(iDepth), sText, False, False)
</p>
<p>
    If IsNull(v) OR IsEmpty(v) Then
</p>
<p>
    '
</p>
<p>
    Else
</p>
<p>
    iDepth = iDepth + 1
</p>
<p>
    oDlg.getControl("BackButton").GetModel().Enabled = True
</p>
<p>
    oObjects(iDepth) = v
</p>
<p>
    oDlg.Title = sNewTitle
</p>
<p>
    Titles(iDepth) = sNewTitle
</p>
<p>
    DisplayNewObject()
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    'oSel = oControl.getSelection ()
</p>
<p>
    'Print "Min: " &amp; oSel.Min &amp; " Max: " &amp; oSel.Max
</p>
<p>
    'sText = oControl.getText()
</p>
<p>
    'Inspect oControl
</p>
<p>
    End Sub
</p>
<h4 id="inspect-previous">
    <span id="anchor-514"></span>Inspect previous
</h4>
<p>
    A stack of inspected objects is maintained. The “previous item” means the last item on the stack.
</p>
<p>
    <strong>Listing .<strong> </strong><strong>Inspect a previous item.</strong></strong>
</p>
<p>
    Sub back_actionPerformed(oActionEvent)
</p>
<p>
    If iDepth &lt;= LBound(oObjects) Then
</p>
<p>
    Exit Sub
</p>
<p>
    End If
</p>
<p>
    iDepth = iDepth - 1
</p>
<p>
    If iDepth = LBound(oObjects) Then
</p>
<p>
    oDlg.getControl("BackButton").GetModel().Enabled = False
</p>
<p>
    End If
</p>
<p>
    oDlg.Title = Titles(iDepth)
</p>
<p>
    DisplayNewObject()
</p>
<p>
    End Sub
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="obtaining-the-debug-information">
                            <span id="anchor-515"></span>Obtaining the debug information
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    In , notice that if the properties, methods, or services are requested, then the processStateChange() subroutine
    (see ) is called. If properties, methods, or services are not requested, simple object information is added to the
    text control.
</p>
<p>
    Again, the processStateChange() subroutine contains very little logic. The primary purpose of is to add the
    supported services to the end of the text control after the interfaces are obtained from the dbg_SupportedInterfaces
    property.
</p>
<p>
    <strong>Listing .<strong> </strong><strong>Build the text string that is displayed about the
            object.</strong></strong>
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Set the text. For a service, show the interfaces and services in
</p>
<p>
    '** Separate sections so that they are easier to find.
</p>
<p>
    '*************************************************************************
</p>
<p>
    Sub processStateChange(oInsObj, sPropType$)
</p>
<p>
    Dim oItems()
</p>
<p>
    BuildItemArray(oInsObj, sPropType$, oItems())
</p>
<p>
    If sPropType$ = "s" Then
</p>
<p>
    Dim s As String
</p>
<p>
    On Local Error Resume Next
</p>
<p>
    s = "** INTERFACES **" &amp; CHR$(10) &amp; Join(oItems, CHR$(10))
</p>
<p>
    s = s &amp; CHR$(10) &amp; CHR$(10) &amp; "** SERVICES **" &amp; CHR$(10) &amp; _
</p>
<p>
    Join(oInsObj.getSupportedServiceNames(), CHR$(10))
</p>
<p>
    oTextEdit.Text = s
</p>
<p>
    Else
</p>
<p>
    oTextEdit.Text = Join(oItems, CHR$(10))
</p>
<p>
    End If
</p>
<p>
    End Sub
</p>
<p>
    The BuildItemArray() subroutine contains the majority of the important code for this dialog. First, the code
    inspects the dbg_ properties to obtain the list of properties, methods, or interfaces as a single string. It then
    separates the individual items from the single string and sorts them. If properties are displayed, the property set
    information object is used to obtain the value of each supported property. This allows you to see both the property
    name and its value. Although the property set information object does not support all of the properties returned by
    the property dbg_properties, it supports most of them. The individual data is returned as an array of strings in the
    oItems() array. See for an example.
</p>
<p>
    <strong>Listing . </strong>Build an array of properties, methods, or services.
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** This routine parses the strings returned from the dbg_Methods,
</p>
<p>
    '** dbg_Properties, and Dbg_SupportedInterfaces calls. The interesting
</p>
<p>
    '** data starts after the first colon.
</p>
<p>
    '**
</p>
<p>
    '** Because of this, all data before the first colon is discarded
</p>
<p>
    '** and then the string is separated into pieces based on the
</p>
<p>
    '** separator string that is passed in.
</p>
<p>
    '**
</p>
<p>
    '** All instances of the string Sbx are removed. If this string
</p>
<p>
    '** is valid and exists in a method name, it will still be removed so perhaps
</p>
<p>
    '** it is not the safest thing to do, but I have never seen this case and it
</p>
<p>
    '** makes the output easier to read.
</p>
<p>
    '**
</p>
<p>
    '** the oItems() contains all of the parsed sections on output.
</p>
<p>
    '*************************************************************************
</p>
<p>
    Sub BuildItemArray(oInsObj, sType$, oItems())
</p>
<p>
    On Error Goto BadErrorHere
</p>
<p>
    Dim s As String 'Primary list to parse
</p>
<p>
    Dim sSep As String 'Separates the items in the string
</p>
<p>
    Dim iCount% '
</p>
<p>
    Dim iPos% '
</p>
<p>
    Dim sNew$ '
</p>
<p>
    Dim i% '
</p>
<p>
    Dim j% '
</p>
<p>
    Dim sFront() As String 'When each piece is parsed, this is the front
</p>
<p>
    Dim sMid() As String 'When each piece is parsed, this is the middle
</p>
<p>
    Dim iIdx() As Integer 'Used to sort parallel arrays.
</p>
<p>
    Dim nFrontMax As Integer 'Maximum length of front section
</p>
<p>
    Dim sArraySep$ : sArraySep = ", "
</p>
<p>
    Dim iArrayMaxDepth% : iArrayMaxDepth = 10
</p>
<p>
    nFrontMax = 0
</p>
<p>
</p>
<p>
    REM First, see what should be inspected.
</p>
<p>
    s = ""
</p>
<p>
    On Local Error Resume Next
</p>
<p>
    If sType$ = "s" Then
</p>
<p>
    REM Dbg_SupportedInterfaces returns interfaces and
</p>
<p>
    REM getSupportedServiceNames() returns services.
</p>
<p>
    s = oInsObj.Dbg_SupportedInterfaces
</p>
<p>
    's = s &amp; Join(oInsObj.getSupportedServiceNames(), CHR$(10))
</p>
<p>
    sSep = CHR$(10)
</p>
<p>
    ElseIf sType$ = "m" Then
</p>
<p>
    s = oInsObj.DBG_Methods
</p>
<p>
    sSep = ";"
</p>
<p>
    ElseIf sType$ = "p" Then
</p>
<p>
    s = oInsObj.DBG_Properties
</p>
<p>
    sSep = ";"
</p>
<p>
    Else
</p>
<p>
    s = ""
</p>
<p>
    sSep = ""
</p>
<p>
    End If
</p>
<p>
    REM The dbg_ variables have some introductory information that
</p>
<p>
    REM we do not want so remove it.
</p>
<p>
    REM We only care about what is after the colon.
</p>
<p>
    iPos = InStr(1, s, ":") + 1
</p>
<p>
    If iPos &gt; 0 Then s = TrimWhite(Right(s, Len(s) - iPos))
</p>
<p>
    REM All data types are prefixed with the text Sbx.
</p>
<p>
    REM Remove all of the "SbX" charcters
</p>
<p>
    s = Join(Split(s, "Sbx"), "")
</p>
<p>
    REM If the separator is NOT CHR$(10), then remove
</p>
<p>
    REM all instances of CHR$(10)
</p>
<p>
    If ASC(sSep) &lt;&gt; 10 Then s = Join(Split(s, CHR$(10)), "")
</p>
<p>
</p>
<p>
    REM split on the separator character and update the progress bar.
</p>
<p>
    oItems() = Split(s, sSep)
</p>
<p>
    oProgress.ProgressValue = 20
</p>
<p>
    Rem Create arrays to hold the different portions of the text.
</p>
<p>
    Rem the string usually contains text similar to "SbxString getName()"
</p>
<p>
    Rem sFront() holds the data type if it exists and "" if it does not.
</p>
<p>
    Rem sMid() holds the rest
</p>
<p>
    ReDim sFront(UBound(oItems)) As String
</p>
<p>
    ReDim sMid(UBound(oItems)) As String
</p>
<p>
    ReDim iIdx(UBound(oItems)) As Integer
</p>
<p>
    REM Initialize the index array and remove leading and trailing
</p>
<p>
    REM spaces from each string.
</p>
<p>
    For i=LBound(oItems()) To UBound(oItems())
</p>
<p>
    oItems(i) = Trim(oItems(i))
</p>
<p>
    iIdx(i) = i
</p>
<p>
    j = InStr(1, oItems(i), " ")
</p>
<p>
    If (j &gt; 0) Then
</p>
<p>
    REM If the string contains more than one word, the first word is stored
</p>
<p>
    REM in sFront() and the rest of the string is stored in sMid().
</p>
<p>
    sFront(i) = Mid$(oItems(i), 1, j)
</p>
<p>
    sMid(i) = Mid$(oItems(i), j+1)
</p>
<p>
    If j &gt; nFrontMax Then nFrontMax = j
</p>
<p>
    Else
</p>
<p>
    REM If the string contains only one word, sFront() is empty
</p>
<p>
    REM and the string is stored in sMid().
</p>
<p>
    sFront(i) = ""
</p>
<p>
    sMid(i) = oItems(i)
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    oProgress.ProgressValue = 40
</p>
<p>
    Rem Sort the primary names. The array is left unchanged, but the
</p>
<p>
    Rem iIdx() array contains index values that allow a sorted traversal
</p>
<p>
    SortMyArray(sMid(), iIdx())
</p>
<p>
    oProgress.ProgressValue = 50
</p>
<p>
    REM Dealing with properties so attempt to find the value
</p>
<p>
    REM of each property.
</p>
<p>
    If sType$ = "p" Then
</p>
<p>
    Dim oPropInfo 'PropertySetInfo object
</p>
<p>
    Dim oProps 'Array of properties
</p>
<p>
    Dim oProp 'com.sun.star.beans.Property
</p>
<p>
    Dim v 'Value of a single property
</p>
<p>
    Dim bHasPI As Boolean
</p>
<p>
    Dim bUsePI As Boolean
</p>
<p>
    Dim bConvertReturns As Boolean
</p>
<p>
</p>
<p>
    bConvertReturns = True
</p>
<p>
    bHasPI = False
</p>
<p>
    bUsePI = False
</p>
<p>
    On Error Goto NoPropertySetInfo
</p>
<p>
    oPropInfo = oInsObj.getPropertySetInfo()
</p>
<p>
    bHasPI = True
</p>
<p>
    NoPropertySetInfo:
</p>
<p>
</p>
<p>
    On Error Goto BadErrorHere:
</p>
<p>
</p>
<p>
    For i=LBound(sMid()) To UBound(sMid())
</p>
<p>
    If bHasPI Then
</p>
<p>
    bUsePI = oPropInfo.hasPropertyByName(sMid(i))
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    If bUsePI Then
</p>
<p>
    v = oInsObj.getPropertyValue(sMid(i))
</p>
<p>
    Else
</p>
<p>
    v = RunFromLib(GlobalScope.BasicLibraries, _
</p>
<p>
    "xyzzylib", "TestMod", oInsObj, sMid(i), False, False)
</p>
<p>
    End If
</p>
<p>
    sMid(i) = sMid(i) &amp; " = " &amp; _
</p>
<p>
    ObjToString(v, sArraySep, iArrayMaxDepth, bConvertReturns)
</p>
<p>
    Next
</p>
<p>
    End If
</p>
<p>
    oProgress.ProgressValue = 60
</p>
<p>
    nFrontMax = nFrontMax + 1
</p>
<p>
    iCount = LBound(oItems())
</p>
<p>
    REM Now build the array of the items in sorted order
</p>
<p>
    REM Sometimes, a service is listed more than once.
</p>
<p>
    REM this routine removes multiple instances of the same service.
</p>
<p>
    For i = LBound(oItems()) To UBound(oItems())
</p>
<p>
    sNew = sFront(iIdx(i)) &amp; " " &amp; sMid(iIdx(i))
</p>
<p>
    'Uncomment these lines if you want to add uniform space
</p>
<p>
    'between front and mid. This is only useful if the font is fixed in width.
</p>
<p>
    'sNew = sFront(iIdx(i))
</p>
<p>
    'sNew = sNew &amp; Space(nFrontMax - Len(sNew)) &amp; sMid(iIdx(i))
</p>
<p>
    If i = LBound(oItems()) Then
</p>
<p>
    oItems(iCount) = sNew
</p>
<p>
    ElseIf oItems(iCount) &lt;&gt; sNew Then
</p>
<p>
    iCount = iCount + 1
</p>
<p>
    oItems(iCount) = sNew
</p>
<p>
    End If
</p>
<p>
    Next
</p>
<p>
    oProgress.ProgressValue = 75
</p>
<p>
    ReDim Preserve oItems(iCount)
</p>
<p>
    Exit Sub
</p>
<p>
    BadErrorHere:
</p>
<p>
    MsgBox "Error " &amp; err &amp; ": " &amp; error$ + chr(13) + "In line : " + Erl
</p>
<p>
    End Sub
</p>
<p>
    The object inspector is shown below. ThisComponent was inspected, I viewed properties, selected
    “ChapterNumberingRules”, and then I clicked Inspect Selected. The path is shown in the dialog title.
</p>
<p>
    <img src="Pictures/10000000000003CB0000030E4D77788E.png" style="width:7in;height:5.6402in" />
</p>
<p>
    <strong>Figure . </strong>The Object Inspector dialog.
</p>
<p>
    You can use the object inspector to investigate objects when you aren’t certain exactly what you can do with them.
    You might want to copy this to an application-level library so that you can access the macro from all of your other
    macros.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="getting-property-values">
                            <span id="anchor-516"></span>Getting property values
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    Most UNO objects have a PropertySetInfo object, which allows you to see what properties exist, get the properties,
    and set the properties. Oddly, not all of the properties are available through this interface, but they are
    available from the Dbg_Properties property. When the PropertySetInfo object is unable to get a property value, the
    RunFromLib method is used.
</p>
<p>
    The following macro creates a library, module, and function and then calls it. The library and module name are
    provided. The module is deleted if it exists, and replaced with a single function. The primary reason is to access a
    named property and return the value of the named property.
</p>
<p>
    <strong>Listing .<strong> </strong><strong>Create a library, module, and function, then call it.</strong></strong>
</p>
<p>
    '*************************************************************************
</p>
<p>
    '** Create a module that contains a function that returns the value from a
</p>
<p>
    '** property or makes a method call on an object.
</p>
<p>
    '**
</p>
<p>
    '** Not all properties are available from the PropertySetInfo object, and
</p>
<p>
    '** I am not aware of any other way to make a method call.
</p>
<p>
    '**
</p>
<p>
    '** oLibs - Library container to use
</p>
<p>
    '** sLName - Library name
</p>
<p>
    '** sMName - Module name
</p>
<p>
    '** oObj - Object of interest
</p>
<p>
    '** sCall - Method or property name to call
</p>
<p>
    '** bClean - If true, remove the module. Library is only removed if created.
</p>
<p>
    '** bIsMthd- If true, create as a method rather than a property.
</p>
<p>
    '** x - If exists, then used as parameter for the method call.
</p>
<p>
    '** y - If exists, then used as parameter for the method call.
</p>
<p>
    '**
</p>
<p>
    '*************************************************************************
</p>
<p>
    Function RunFromLib(oLibs, sLName$, sMName$, oObj, sCall$, _
</p>
<p>
    bClean As Boolean, bIsMthd As Boolean, _
</p>
<p>
    Optional x, optional y)
</p>
<p>
    Dim oLib 'The library to use to run the new function.
</p>
<p>
    Dim s$ 'Generic string variable.
</p>
<p>
    Dim bAddedLib As Boolean
</p>
<p>
    REM If the library does not exist, then create it.
</p>
<p>
    bAddedLib = False
</p>
<p>
    If NOT oLibs.hasByName(sLName) Then
</p>
<p>
    bAddedLib = True
</p>
<p>
    oLibs.createLibrary(sLName)
</p>
<p>
    End If
</p>
<p>
    oLibs.loadLibrary(sLName)
</p>
<p>
    oLib = oLibs.getByName(sLName)
</p>
<p>
    If oLib.hasByName(sMName) Then
</p>
<p>
    oLib.removeByName(sMName)
</p>
<p>
    End If
</p>
<p>
    s = "Option Explicit" &amp; CHR$(10) &amp; _
</p>
<p>
    "Function MyInsertedFunc(ByRef oObj"
</p>
<p>
</p>
<p>
    If NOT IsMissing(x) Then s = s &amp; ", x"
</p>
<p>
    If NOT IsMissing(y) Then s = s &amp; ", y"
</p>
<p>
    s = s &amp; ")" &amp; CHR$(10) &amp; "On Local Error Resume Next" &amp; CHR$(10)
</p>
<p>
    s = s &amp; "MyInsertedFunc = oObj." &amp; sCall
</p>
<p>
    If bIsMthd Then
</p>
<p>
    s = s &amp; "("
</p>
<p>
    If NOT IsMissing(x) Then s = s &amp; "x"
</p>
<p>
    If NOT IsMissing(y) Then s = s &amp; ", y"
</p>
<p>
    s = s &amp; ")"
</p>
<p>
    End If
</p>
<p>
</p>
<p>
    s = s &amp; CHR$(10) &amp; "End Function"
</p>
<p>
    oLib.insertByName(sMName, s)
</p>
<p>
    If IsMissing(x) Then
</p>
<p>
    RunFromLib = MyInsertedFunc(oObj)
</p>
<p>
    ElseIf IsMissing(y) Then
</p>
<p>
    RunFromLib = MyInsertedFunc(oObj, x)
</p>
<p>
    Else
</p>
<p>
    RunFromLib = MyInsertedFunc(oObj, x, y)
</p>
<p>
    End If
</p>
<p>
    If bClean Then
</p>
<p>
    oLib.removeByName(sMName)
</p>
<p>
    If bAddedLib Then
</p>
<p>
    oLibs.removeLibrary(sLName)
</p>
<p>
    End If
</p>
<p>
    End If
</p>
<p>
    End Function
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                Warn
            </td>
            <td>
                While debugging the code used to inspect objects, the system was left in a strange state, and removing
                the existing module failed. I believe that this was related to calling a handler containing breakpoints
                and then killing the dialog while the breakpoints were active. The important thing to note, however, is
                that if the module cannot be deleted, stop the object inspector and then remove the library named
                “xyzzylib” using the macro organizer.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-16">
                    <span id="anchor-517"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    The methods outlined in this chapter should get you started in using dialogs and controls. The methods to access and
    use controls in dialogs are very similar to accessing controls in forms, so you’re well on your way to using forms
    as well. When a control is stored in a document rather than a dialog, the control is stored in a form.
</p>
<ol type="1">
    <li>
        <h1 id="sources-of-information">
            <span id="anchor-200"></span>Sources of Information
        </h1>
    </li>
</ol>
<p>
    The internals of OpenOffice.org are very extensive, not completely documented, and in a state of change due to
    ongoing feature development and bug fixes. This chapter introduces sources of information that can assist you in
    finding your own solutions.
</p>
<p>
    While solving any problem, it is most important to have a basic understanding of the problem, and to know how to
    find the relevant information that you don’t know about the problem and possible solutions. You might produce faster
    and more reliable code if you knew everything about OpenOffice.org, but this simply isn’t possible because of the
    broad scope of the product. Even if you could know it all, and keep up with the changes of successive releases of
    OOo, it is probably more productive to use some of that mental energy to remember the phone numbers of your closest
    friends, your wedding anniversary, or funny stories about your parents<em><em>—</em></em>or to remember how to order
    extra copies of this book as gifts for your friends, spouse, and parents!
</p>
<p>
    There are many excellent sources of information on OOo, each addressing different needs. Knowing which information
    is available at which location can save a lot of time and effort in solving problems.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="help-pages-included-with-openoffice.org">
                    <span id="anchor-518"></span>Help pages included with OpenOffice.org
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Do not neglect the excellent help that is included with OOo (see ). Although it may seem like I’m frequently
    complaining about inaccurate or missing items in the help pages, in reality those are few and far between. I mention
    this simply because it’s important to note when there are deficiencies, so you can be prepared to deal with some of
    the inevitable rough spots. (Hey, if I didn’t offer something of original value, what would be the point in writing
    this book? After all, I have a day job that keeps me busy<em><em>—</em></em>I don’t want this book to be a waste of
    time for either of us!)
</p>
<p>
    The help pages cover each of the components in OOo: Writer, Calc, Basic, Draw, Math, and Impress. The upper-left
    corner of the help page contains a drop-down list that determines which help set is displayed. To view the help for
    Basic, the drop-down must display “Help about OpenOffice.org Basic.” If you open the help window from the Basic IDE,
    this is the default. The included help contains a lot of current information on OOo Basic syntax and routines.
</p>
<p>
    <img src="Pictures/100002000000062700000221BA5420ED.png" style="width:5.4874in;height:1.7543in" />
</p>
<p>
    <strong>Figure . </strong>The included help is very good.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="macros-included-with-openoffice.org">
                    <span id="anchor-519"></span>Macros included with OpenOffice.org
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Many macros are included with OOo in libraries. Spend some time investigating these macros. Many wonderful examples
    are included. For example, the Gimmicks library contains a ReadDir module that reads an entire directory and creates
    a draw page with the information displayed in a tree structure. The Tools library also contains numerous excellent
    examples. The Debug module in the Tools library contains some useful macros, such as WriteDbgInfo and
    PrintDbgInfo<em><em>—</em></em>check them out.
</p>
<p>
    If you don’t know how to solve a problem, you should always try to find the answer first, rather than writing a
    completely new solution. The macros included with OOo are a good place to start. I once posted a request for help to
    determine the size of a control in a dialog. The response, which included the solution, indicated that I should look
    in the ModuleControls module in the Tools library that is included with OOo. In other words, the macros included
    with OOo contained the solution to my problem.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                <p>
                    You can see the libraries and modules included with OOo by selecting Tools | Macros | Organize
                    Macros
                </p>
                <p>
                    to open the Macro dialog. The macros available at the application level are in the OpenOffice
                    library
                </p>
                <p>
                    container.
                </p>
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="web-sites">
                    <span id="anchor-520"></span>Web sites
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    On more than one occasion, I knew what I needed to use to solve a problem, but I just couldn’t figure out the
    details. This is where a working example is invaluable. There are numerous sources for help on the Internet; more
    become available all the time. Here is a list of sites that may help you:
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                Although I have attempted to provide accurate links and descriptions, the OpenOffice Web sites are
                constantly changing and improving.
            </td>
        </tr>
    </tbody>
</table>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="reference-material">
                            <span id="anchor-521"></span>Reference material
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    <strong>http://www.openoffice.org/api/</strong> is the site where I spend most of my time. This site lists most
    interfaces and services and contains the primary Developer’s Guide. The guide has a reputation for being difficult
    to understand, but the authors are working to make the content more accessible to less technical readers.
</p>
<p>
    <strong>http://www.odfauthors.org/</strong> Documentation and books.
</p>
<p>
    <strong>http://wiki.openoffice.org/wiki/Documentation</strong>: Apache documentation project.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="macro-examples">
                            <span id="anchor-522"></span>Macro examples
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    <strong>http://www.pitonyak.org/oo.php</strong> is my personal Web site, created before I decided to write a book.
    This site contains numerous documents and links. “AndrewMacro” contains numerous examples. The direct link to my
    macro document is <strong>http://www.pitonyak.org/AndrewMacro.odt</strong>.
</p>
<p>
    <strong>http://kienlein.com/pages/oo.html</strong> contains some excellent macros, with short descriptions of the
    macros<br /> in German.
</p>
<p>
    <strong>http://www.darwinwars.com/lunatic/bugs/oo_macros.html</strong> is a good first stop when looking for Writer
    macros. The author of this site is a professional writer who uses the macros<em><em>—</em></em>so they work!
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <ol type="1">
                    <li>
                        <h3 id="miscellaneous">
                            <span id="anchor-523"></span>Miscellaneous
                        </h3>
                    </li>
                </ol>
            </li>
        </ol>
    </li>
</ol>
<p>
    <strong>http://www.openoffice.org/</strong> is the main OOo link. This site contains a lot of information, such as
    links to mailing lists that you can search, and the OOo bug-tracking system IssueZilla. You can join the site (it’s
    free) to gain more capabilities, such as entering bug reports and subscribing to mailing lists.
</p>
<p>
    <strong>http://www.openoffice.org/development/index.html</strong> is the developer project link from the main OOo
    Web page. Numerous links and resources are available from this page.
</p>
<p>
    <strong>http://forum.openoffice.org/</strong> The official OpenOffice forum.
</p>
<p>
    <strong>http://www.oooforum.org/</strong> contains numerous help forums. This site includes help for the different
    components of OOo<em><em>—</em></em>including macro programming.
</p>
<p>
    <strong>http://ooodocs.sourceforge.net/</strong> contains many help files separated into categories, including a
    section on macro programming.
</p>
<p>
    <strong>http://www.openoffice.org/documentation/</strong> is the home page for the documentation project. This site
    contains documentation on numerous topics. The How-To link references a document that discusses how to embed
    controls that call macros into documents. This is an excellent interactive document.<br />
    <strong>http://documentation.openoffice.org/HOW_TO/various_topics/How_to_use_basic_macros.sxw</strong>
</p>
<p>
    <strong>http://sourceforge.net/project/showfiles.php?group_id=43716</strong> contains numerous templates and
    examples.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="httpwww.openoffice.orgapi-or-httpapi.libreoffice.org">
                    <span id="anchor-524"></span><a
                        href="http://www.openoffice.org/api/">http://www.openoffice.org/api/</a> or <a
                        href="http://api.libreoffice.org/">http://api.libreoffice.org</a>
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    For the serious macro writer, the site <strong>http://www.openoffice.org/api/</strong> is very important. I spend
    most of my time here while investigating how to solve problems. The first accessible programming document for
    StarOffice version 5.x is available from this site. The document,
    <strong>www.openoffice.org/api/basic/man/tutorial/tutorial.pdf</strong>, may be old, but it contains some nice
    examples<em><em>—</em></em>and it is very accessible.
</p>
<p>
    <strong>http://wiki.openoffice.org/wiki/Documentation/DevGuide/OpenOffice.org_Developers_Guide</strong> contains the
    Developer’s Guide, which is kept up-to-date. The target audience for this document is the professional developer. A
    lot of information is here, and it requires some talent to find what you need. This is only because so much
    information is available. Basic programming is only a small portion of this document’s coverage. When you require
    the complete story, or at least the most complete story available, look in the Developer’s Guide. (But, be prepared
    for the <em>complete</em> story...)
</p>
<p>
    I spend most of my time in the portion investigating the individual modules, which list the interfaces and services
    available. A good starting point is
</p>
<p>
    <strong>http://www.openoffice.org/api/docs/common/ref/module-ix.html</strong>
</p>
<p>
    because it contains all of the main modules. Notice that the name of the Web page is “module-ix.html”. If you are
    looking at a Web page for a service or interface, you can usually remove the name of the Web page and substitute the
    name “module-ix.html”. For example, assume that you are looking at the TextCursor service at
    <strong>http://www.openoffice.org/api/docs/common/ref/com/sun/star/text/TextCursor.html</strong> and you want to see
    the services. Change “TextCursor.html” to “module-ix.html” and you can see all of the definitions, services,
    contained modules, constants, and interfaces in the com.sun.star.text module.
</p>
<p>
    You should start investigating the different modules at the main Sun module,
    <strong>http://www.openoffice.org/api/docs/common/ref/com/sun/star/module-ix.html</strong>, which will provide a
    feel for the different modules and their purposes. Because the modules group related functionality, I sometimes look
    here when I need to find a service that solves a specific problem but I don’t know what the service is.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="mailing-lists-and-newsgroups">
                    <span id="anchor-525"></span>Mailing lists and newsgroups
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Numerous mailing lists are available for OpenOffice users. Information on each mailing list is available from the
    lists-related Web site.
</p>
<ul>
    <li>
        <a href="http://www.openoffice.org/mail_list.html">http://www.openoffice.org/mail_list.html</a>
    </li>
    <li>
        <a
            href="http://www.libreoffice.org/get-help/mailing-lists/">http://www.libreoffice.org/get-help/mailing-lists/</a>
    </li>
</ul>
<p>
    When you ask a question on a mailing list, the answers go to the mailing list rather than directly to you. You must
    subscribe to the mailing list so that you can receive the answers. Instructions are provided to subscribe to each of
    the mailing lists. Although developers read the mailing lists and answer questions, this is not a support forum in
    the sense of guaranteed help. If other users or developers have a solution or an idea for a solution, they will post
    an answer. Answers requiring a lot of work or time are not likely to be answered. The LO development mailing list is
    expected to be used by people developing the LO software so you may not have much luck asking macro related
    questions on that mailing list.
</p>
<p>
    A good first step before asking a question is to subscribe to the mailing list. Remember, the people answering your
    questions are not paid to do so. It is appreciated if you answer other people’s questions if you know the answer.
    Here are some hints to ensure that you receive answers on the mailing lists.
</p>
<p>
    Before asking a question, try to find the answer yourself. Search the Web, search the mailing-list archives, search
    the Developer’s Guide, search Google, read a FAQ. Inspect returned objects. The user community members prefer to
    help people who can help themselves and give back to the community.
</p>
<p>
    Choose a meaningful message header. I receive hundreds of e-mails every day so I am likely to skip a message that is
    titled “Please Help,” “Urgent,” or “Macro Problem.” A better title is “How do I run a macro from the command line?”
    or “Searching macro fails to find attributes.” I can then look at questions that I am likely to already understand
    or that interest me. We all get more e-mail than we need. Vague or misleading subject lines often inspire liberal
    use of the Delete feature.
</p>
<p>
    Carefully word your question so that you ask the right question. “My macro has a run-time error” is rather vague.
    Including a little code certainly helps. Including the run-time error in your message also helps. The fact that your
    sort macro does not sort as it should might be specific, but I need more information and perhaps some code before I
    can comment. State the problem precisely, and include how you tried to solve the problem. Specific error
    messages<em><em>—</em></em>and anything you know about the circumstances or likely causes of the
    problem<em><em>—</em></em>are welcome.
</p>
<p>
    Do not expect someone else to do your work for you. “My client is paying me $2000 to convert this macro; will you do
    it for free?” is not likely to receive a response. I have translated macros from other systems because they were
    interesting and of broad scope, and I was allowed to then release them to the user community. If you are really in a
    bind, someone on the list might be willing to do your work for a fee.
</p>
<p>
    Do not directly ask a single individual, even if they are knowledgeable. Many people can answer your question using
    pooled knowledge, and you will often receive a better solution. In other words, ask the question on the list rather
    than directly to an individual, unless you have a good reason for doing so. The last question that I helped answer
    on the list generated roughly 10 messages from four different people.
</p>
<p>
    It’s considered bad form to request an answer to be e-mailed to you at a different address. If you don’t care enough
    to check the mailing list for the answer, why should someone else care enough to spend time answering your question
    in the first place? Again, remember that these folks are volunteers! Also, the answer to your
    question<em><em>—</em></em>an online discussion leading to the understanding of your circumstances and eventual
    solution<em><em>—</em></em>may be of value to others in the community. In this way, the shared pool of knowledge
    grows larger and better over time.
</p>
<p>
    When you do have a solution, post it to help others. A polite “thank you” is also appropriate. Again, courtesy and
    sharing are important to the development of a functioning community that benefits you and all the other members as
    well. (I feel like a public service announcement when I say these things, just in case you were wondering.)
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="how-to-find-answers">
                    <span id="anchor-526"></span>How to find answers
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    When I want to know about a specific issue, I usually search the Developer’s Guide and the old StarOffice tutorial,
    and finally I perform a Google search such as “cursor OpenOffice”. When I want to narrow the search to the
    api.openoffice.org site, I use “site:www.openoffice.org/api cursor”; the results usually include an interface or a
    service that I can inspect, such as:
</p>
<p>
    MsgBox vObj.dbg_methods
</p>
<p>
    MsgBox vObj.dbg_supportedInterfaces
</p>
<p>
    MsgBox vObj.dbg_properties
</p>
<p>
    If you aren’t certain what to do with an object, inspect it. For example, print the properties dbg_methods,
    dbg_supportedInterfaces, and dbg_properties. If you are still at a loss, you can search the Internet or other
    documents for the services, methods, or properties that are implemented.
</p>
<table border="1">
    <tbody>
        <tr class="odd">
            <td>
                TIP
            </td>
            <td>
                I don't really print the methods and properties, I use the object inspector or X-Ray (see section <a
                    href="#anchor-189">18.5</a> <a href="#anchor-189">The object inspector example</a>).
            </td>
        </tr>
    </tbody>
</table>
<p>
    Quickly search for examples that might solve the same problem that you face. This is an ideal situation because it
    requires less work on your part. As a last resort, post a message on a mailing list and ask for help.
</p>
<ol type="1">
    <li>
        <ol type="1">
            <li>
                <h2 id="conclusion-17">
                    <span id="anchor-527"></span>Conclusion
                </h2>
            </li>
        </ol>
    </li>
</ol>
<p>
    Many excellent sources of information discuss how to write code that directs OpenOffice.org. Becoming familiar with
    these sources can save you a lot of time, and regularly browsing the mailing lists also keeps you in touch with how
    things are changing. Participation in the community of a mailing list or newsgroup offers opportunity to gain
    solutions and to allow others to benefit from your experience as well.
</p>
<aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
    <hr />
    <ol>
        <li id="fn1">
            <p>
                I have not verified that a named frame does not work in OOo 3.3, but it did fail when I tested around
                version 2.0.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a>
            </p>
        </li>
    </ol>
</aside>